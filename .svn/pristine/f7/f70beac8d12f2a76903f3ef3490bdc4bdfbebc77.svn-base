<?xml version="1.0" encoding="utf-8" ?>
<!--============================================================================
//	CAUTION: This file is generated by IBatisNetGen.3.SQLMap.cst at 11/11/2015 9:27:48 AM
//				Any manual editing will be lost in re-generation.
//===========================================================================-->
<sqlMap namespace="eHospital" xmlns="http://ibatis.apache.org/mapping" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" >

  <statements>
    <statement id="DAO00088_GetList" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
      select * from TM_CONGTYBAOHIEM
    </statement>

    <statement id="DAO00088_TT_VIENPHI_GetList_BHTN" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
      select  a.*, b.TINHTRANG_BHTN, d.TINHTRANG AS TINHTRANG_MG, C.NOIYEUCAU_ID
      , g.GIATRIMIENGIAM_CTCT, g.TINHTRANG_MGCT, c.HUYYEUCAU
      <!--, c.BHYTDONGTIEN,-->
      ,b.MIENGIAMCHITIET_ID, d.GIATRIMIENGIAM_BH, f.GIATRIMIENGIAM_THANHVIEN
      , b.VIENPHI_MGTN, b.REF_TABLE_MGTN
      from
      (
      select VP.*
      from TT_VIENPHI VP
      where VP.BENHNHAN_PHAITHANHTOAN &gt; 0
      <isParameterPresent>
        <isNotEmpty prepend="and" property="LIST_VIENPHI">
          VP.VIENPHI_ID in ($LIST_VIENPHI$)
        </isNotEmpty>
        <isNotEmpty prepend="and" property="LIST_BENHNHAN_PHAITHANHTOAN">
          VP.BENHNHAN_PHAITHANHTOAN in ($LIST_BENHNHAN_PHAITHANHTOAN$)
        </isNotEmpty>
        <isNotEmpty prepend="and" property="VIENPHI_ID">
          VP.VIENPHI_ID = '$VIENPHI_ID$'
        </isNotEmpty>
        <isNotEmpty prepend="and" property="BENHNHAN_ID">
          VP.BENHNHAN_ID = '$BENHNHAN_ID$'
        </isNotEmpty>
        <isNotEmpty prepend="and" property="TIEPNHAN_ID">
          VP.TIEPNHAN_ID = '$TIEPNHAN_ID$'
        </isNotEmpty>
        <isNotEmpty prepend="and" property="BENHAN_ID">
          VP.BENHAN_ID = '$BENHAN_ID$'
        </isNotEmpty>
        <isNotEmpty prepend="and" property="REF_ID">
          VP.REF_ID = '$REF_ID$'
        </isNotEmpty>
        <isNotEmpty prepend="and" property="REF_TABLE">
          VP.REF_TABLE = '$REF_TABLE$'
        </isNotEmpty>
        <isNotEmpty prepend="and" property="DICHVU_ID">
          VP.DICHVU_ID is NULL
        </isNotEmpty>
        <isNotEmpty prepend="and" property="DUOC_ID">
          (DUOC_ID = '0' or DUOC_ID is NULL)
        </isNotEmpty>
        <isNotEmpty prepend="and" property="LOAI_CHIPHI">
          VP.LOAI_CHIPHI = '$LOAI_CHIPHI$'
        </isNotEmpty>
        <isNotEmpty prepend="and" property="LOAIGIA_ID">
          VP.LOAIGIA_ID = '$LOAIGIA_ID$'
        </isNotEmpty>
        <isNotEmpty prepend="and" property="SOLUONG">
          VP.SOLUONG = '$SOLUONG$'
        </isNotEmpty>
        <isNotEmpty prepend="and" property="DONGIA_DOANHTHU">
          VP.DONGIA_DOANHTHU = '$DONGIA_DOANHTHU$'
        </isNotEmpty>
        <isNotEmpty prepend="and" property="THANHTIEN_DOANHTHU">
          VP.THANHTIEN_DOANHTHU = '$THANHTIEN_DOANHTHU$'
        </isNotEmpty>
        <isNotEmpty prepend="and" property="BHYT_TL">
          VP.BHYT_TL = '$BHYT_TL$'
        </isNotEmpty>
        <isNotEmpty prepend="and" property="BHYT_DONGIA">
          VP.BHYT_DONGIA = '$BHYT_DONGIA$'
        </isNotEmpty>
        <isNotEmpty prepend="and" property="BHYT_THANHTIEN">
          VP.BHYT_THANHTIEN = '$BHYT_THANHTIEN$'
        </isNotEmpty>
        <isNotEmpty prepend="and" property="BHYT_DONGIA_CHITRA">
          VP.BHYT_DONGIA_CHITRA = '$BHYT_DONGIA_CHITRA$'
        </isNotEmpty>
        <isNotEmpty prepend="and" property="BHYT_THANHTIEN_CHITRA">
          VP.BHYT_THANHTIEN_CHITRA = '$BHYT_THANHTIEN_CHITRA$'
        </isNotEmpty>
        <isNotEmpty prepend="and" property="BENHNHAN_PHAITHANHTOAN">
          VP.BENHNHAN_PHAITHANHTOAN = '$BENHNHAN_PHAITHANHTOAN$'
        </isNotEmpty>
        <isNotEmpty prepend="and" property="GIATRI_HOADON">
          VP.GIATRI_HOADON = '$GIATRI_HOADON$'
        </isNotEmpty>
        <isNotEmpty prepend="and" property="GIATRI_HOADON_DATHANHTOAN">
          VP.GIATRI_HOADON_DATHANHTOAN = '$GIATRI_HOADON_DATHANHTOAN$'
        </isNotEmpty>
        <isNotEmpty prepend="and" property="GIATRI_BIENLAI">
          VP.GIATRI_BIENLAI = '$GIATRI_BIENLAI$'
        </isNotEmpty>
        <isNotEmpty prepend="and" property="GIATRI_BIENLAI_DATHANHTOAN">
          VP.GIATRI_BIENLAI_DATHANHTOAN = '$GIATRI_BIENLAI_DATHANHTOAN$'
        </isNotEmpty>
        <isNotEmpty prepend="and" property="GIATRI_BENHNHAN_DATHANHTOAN">
          VP.GIATRI_BENHNHAN_DATHANHTOAN = '$GIATRI_BENHNHAN_DATHANHTOAN$'
        </isNotEmpty>
        <isNotEmpty prepend="and" property="GIATRI_THATTHU">
          VP.GIATRI_THATTHU = '$GIATRI_THATTHU$'
        </isNotEmpty>
        <isNotEmpty prepend="and" property="MIENGIAM_TL">
          VP.MIENGIAM_TL = '$MIENGIAM_TL$'
        </isNotEmpty>
        <isNotEmpty prepend="and" property="MIENGIAM_GIATRI">
          VP.MIENGIAM_GIATRI = '$MIENGIAM_GIATRI$'
        </isNotEmpty>
        <isNotEmpty prepend="and" property="NGANSACH_TL">
          VP.NGANSACH_TL = '$NGANSACH_TL$'
        </isNotEmpty>
        <isNotEmpty prepend="and" property="NGANSACH_GIATRI">
          VP.NGANSACH_GIATRI = '$NGANSACH_GIATRI$'
        </isNotEmpty>
        <isNotEmpty prepend="and" property="TAITRO_TL">
          VP.TAITRO_TL = '$TAITRO_TL$'
        </isNotEmpty>
        <isNotEmpty prepend="and" property="TAITRO_GIATRI">
          VP.TAITRO_GIATRI = '$TAITRO_GIATRI$'
        </isNotEmpty>
        <isNotEmpty prepend="and" property="BHTN_TL">
          VP.BHTN_TL = '$BHTN_TL$'
        </isNotEmpty>
        <isNotEmpty prepend="and" property="BHTN_DONGIA">
          VP.BHTN_DONGIA = '$BHTN_DONGIA$'
        </isNotEmpty>
        <isNotEmpty prepend="and" property="BHTN_THANHTIEN">
          VP.BHTN_THANHTIEN = '$BHTN_THANHTIEN$'
        </isNotEmpty>
        <isNotEmpty prepend="and" property="BHTN_DONGIA_CHITRA">
          VP.BHTN_DONGIA_CHITRA = '$BHTN_DONGIA_CHITRA$'
        </isNotEmpty>
        <isNotEmpty prepend="and" property="BHTN_THANHTIEN_CHITRA">
          VP.BHTN_THANHTIEN_CHITRA = '$BHTN_THANHTIEN_CHITRA$'
        </isNotEmpty>
        <isNotEmpty prepend="and" property="DUOCPHEPTHUCHIEN">
          VP.DUOCPHEPTHUCHIEN = '$DUOCPHEPTHUCHIEN$'
        </isNotEmpty>
        <isNotEmpty prepend="and" property="HUY">
          VP.HUY = '$HUY$'
        </isNotEmpty>
        <isNotEmpty prepend="and" property="DATHANHTOAN">
          VP.DATHANHTOAN = '$DATHANHTOAN$'
        </isNotEmpty>
        <isNotEmpty prepend="and" property="DATHUCHIEN">
          VP.DATHUCHIEN = '$DATHUCHIEN$'
        </isNotEmpty>
        <isNotEmpty prepend="and" property="KHONGTHUTIEN">
          VP.KHONGTHUTIEN = '$KHONGTHUTIEN$'
        </isNotEmpty>
        <isNotEmpty prepend="and" property="HOADON_ID">
          VP.HOADON_ID = '$HOADON_ID$'
        </isNotEmpty>
        <isNotEmpty prepend="and" property="ACTIVE">
          VP.ACTIVE = '$ACTIVE$'
        </isNotEmpty>
        <isNotEmpty prepend="and" property="BENHVIEN_ID">
          VP.BENHVIEN_ID = '$BENHVIEN_ID$'
        </isNotEmpty>
        <isNotEmpty prepend="and" property="NGUOITAO_ID">
          VP.NGUOITAO_ID = '$NGUOITAO_ID$'
        </isNotEmpty>
        <isNotEmpty prepend="and" property="NGAYTAO">
          VP.NGAYTAO = '$NGAYTAO$'
        </isNotEmpty>
        <isNotEmpty prepend="and" property="NGUOICAPNHAT_ID">
          VP.NGUOICAPNHAT_ID = '$NGUOICAPNHAT_ID$'
        </isNotEmpty>
        <isNotEmpty prepend="and" property="NGAYCAPNHAT">
          VP.NGAYCAPNHAT = '$NGAYCAPNHAT$'
        </isNotEmpty>
        <isNotEmpty prepend="and" property="LISTDATE">
          CONVERT(date, NGAYTAO) IN ($LISTDATE$)
        </isNotEmpty>
      </isParameterPresent>

      )a left join
      (
      select VIENPHI_ID, MG.TINHTRANG as TINHTRANG_BHTN, MGCT.MIENGIAMCHITIET_ID, mgct.VIENPHI_ID as VIENPHI_MGTN
          , mgct.REF_TABLE as REF_TABLE_MGTN
      from TT_MIENGIAM_BHTN MG 
      INNER JOIN TT_MIENGIAM_CHITIET MGCT ON MG.MIENGIAM_BHTN_ID = MGCT.MIENGIAM_ID
      where
      MG.TIEPNHAN_ID= '$TIEPNHAN_ID$' and MGCT.REF_TABLE = 'TT_MIENGIAM_BHTN'
      <isParameterPresent>
        <isNotEmpty prepend="and" property="TINHTRANG">
          MG.TINHTRANG = '$TINHTRANG$'
        </isNotEmpty>
      </isParameterPresent>
      )b
      on a.VIENPHI_ID = b.VIENPHI_ID

      left join
      (
      select VIENPHI_ID, MG.TINHTRANG,sum(MGCT.GIATRIMIENGIAM) AS GIATRIMIENGIAM_BH
      from TT_MIENGIAM MG INNER JOIN TT_MIENGIAM_CHITIET MGCT ON MG.MIENGIAM_ID = MGCT.MIENGIAM_ID
      where
      MG.TIEPNHAN_ID= '$TIEPNHAN_ID$'and MGCT.REF_TABLE = 'TT_MIENGIAM'
      <!--<isParameterPresent>
        <isNotEmpty prepend="and" property="TINHTRANG">-->
      and MG.TINHTRANG = '1'
        <!--</isNotEmpty>
      </isParameterPresent>-->
      group by VIENPHI_ID, MG.TINHTRANG
      )d
      on a.VIENPHI_ID = d.VIENPHI_ID

      left join
      (
      select VIENPHI_ID,
      sum(MGCT.GIATRIMIENGIAM) AS GIATRIMIENGIAM_THANHVIEN
      from TT_MIENGIAM_THANHVIEN MG INNER JOIN TT_MIENGIAM_CHITIET MGCT ON MG.MIENGIAM_THANHVIEN_ID = MGCT.MIENGIAM_ID
      where
      MG.TIEPNHAN_ID= '$TIEPNHAN_ID$'
      and MGCT.REF_TABLE = 'TT_MIENGIAM_THANHVIEN'
      and MG.TINHTRANG = 1
      group by VIENPHI_ID
      )f
      on a.VIENPHI_ID = f.VIENPHI_ID
      left join
      (
      select VIENPHI_ID, MG.TINHTRANG as TINHTRANG_MGCT,
      sum(MGCT.GIATRIMIENGIAM) AS GIATRIMIENGIAM_CTCT
      from TT_MIENGIAM_CONGTY MG INNER JOIN TT_MIENGIAM_CHITIET MGCT ON MG.MIENGIAM_CONGTY_ID = MGCT.MIENGIAM_ID
      where
      MG.TIEPNHAN_ID= '$TIEPNHAN_ID$'
      and MGCT.REF_TABLE = 'TT_MIENGIAM_CONGTY'
      and MG.TINHTRANG = 1
      group by VIENPHI_ID, MG.TINHTRANG
      )g
      on a.VIENPHI_ID = g.VIENPHI_ID

      left join
      (
      select DVYEUCAU_ID, TRANGTHAI, BHYTDONGTIEN,HUYYEUCAU, NOIYEUCAU_ID
      from TT_DVYEUCAU
      <dynamic prepend="where">
        <isParameterPresent>
          <isNotEmpty prepend="and" property="TIEPNHAN_ID">
            TIEPNHAN_ID = '$TIEPNHAN_ID$'
          </isNotEmpty>
          <isNotEmpty prepend="and" property="HUYYEUCAU">
            HUYYEUCAU = '$HUYYEUCAU$'
          </isNotEmpty>
        </isParameterPresent>
      </dynamic>
      )c on c.DVYEUCAU_ID = a.REF_ID
      <dynamic prepend="where">
        <isParameterPresent>
          <isNotEmpty property="HUYYEUCAU">
            c.HUYYEUCAU = '$HUYYEUCAU$' or c.HUYYEUCAU is null
          </isNotEmpty>
        </isParameterPresent>
      </dynamic>
    </statement>
    <statement id="DAO00088_TT_VIENPHI_CheckList_BHTN" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
      select  a.*, b.TINHTRANG_BHTN, d.TINHTRANG AS TINHTRANG_MG, C.NOIYEUCAU_ID
      , g.GIATRIMIENGIAM_CTCT, g.TINHTRANG_MGCT, c.HUYYEUCAU
      <!--, c.BHYTDONGTIEN,-->
      ,b.MIENGIAMCHITIET_ID, d.GIATRIMIENGIAM_BH as GIATRIMIENGIAM, f.GIATRIMIENGIAM_THANHVIEN
      , b.VIENPHI_MGTN, b.REF_TABLE_MGTN
      from
      (
      select VP.*
      from TT_VIENPHI VP
      where VP.BENHNHAN_PHAITHANHTOAN &gt;= 0
      <isParameterPresent>
        <isNotEmpty prepend="and" property="LIST_VIENPHI">
          VP.VIENPHI_ID in ($LIST_VIENPHI$)
        </isNotEmpty>
        <isNotEmpty prepend="and" property="LIST_BENHNHAN_PHAITHANHTOAN">
          VP.BENHNHAN_PHAITHANHTOAN in ($LIST_BENHNHAN_PHAITHANHTOAN$)
        </isNotEmpty>
        <isNotEmpty prepend="and" property="VIENPHI_ID">
          VP.VIENPHI_ID = '$VIENPHI_ID$'
        </isNotEmpty>
        <isNotEmpty prepend="and" property="BENHNHAN_ID">
          VP.BENHNHAN_ID = '$BENHNHAN_ID$'
        </isNotEmpty>
        <isNotEmpty prepend="and" property="TIEPNHAN_ID">
          VP.TIEPNHAN_ID = '$TIEPNHAN_ID$'
        </isNotEmpty>
        <isNotEmpty prepend="and" property="BENHAN_ID">
          VP.BENHAN_ID = '$BENHAN_ID$'
        </isNotEmpty>
        <isNotEmpty prepend="and" property="REF_ID">
          VP.REF_ID = '$REF_ID$'
        </isNotEmpty>
        <isNotEmpty prepend="and" property="REF_TABLE">
          VP.REF_TABLE = '$REF_TABLE$'
        </isNotEmpty>
        <isNotEmpty prepend="and" property="DICHVU_ID">
          VP.DICHVU_ID is NULL
        </isNotEmpty>
        <isNotEmpty prepend="and" property="DUOC_ID">
          (DUOC_ID = '0' or DUOC_ID is NULL)
        </isNotEmpty>
        <isNotEmpty prepend="and" property="LOAI_CHIPHI">
          VP.LOAI_CHIPHI = '$LOAI_CHIPHI$'
        </isNotEmpty>
        <isNotEmpty prepend="and" property="LOAIGIA_ID">
          VP.LOAIGIA_ID = '$LOAIGIA_ID$'
        </isNotEmpty>
        <isNotEmpty prepend="and" property="SOLUONG">
          VP.SOLUONG = '$SOLUONG$'
        </isNotEmpty>
        <isNotEmpty prepend="and" property="DONGIA_DOANHTHU">
          VP.DONGIA_DOANHTHU = '$DONGIA_DOANHTHU$'
        </isNotEmpty>
        <isNotEmpty prepend="and" property="THANHTIEN_DOANHTHU">
          VP.THANHTIEN_DOANHTHU = '$THANHTIEN_DOANHTHU$'
        </isNotEmpty>
        <isNotEmpty prepend="and" property="BHYT_TL">
          VP.BHYT_TL = '$BHYT_TL$'
        </isNotEmpty>
        <isNotEmpty prepend="and" property="BHYT_DONGIA">
          VP.BHYT_DONGIA = '$BHYT_DONGIA$'
        </isNotEmpty>
        <isNotEmpty prepend="and" property="BHYT_THANHTIEN">
          VP.BHYT_THANHTIEN = '$BHYT_THANHTIEN$'
        </isNotEmpty>
        <isNotEmpty prepend="and" property="BHYT_DONGIA_CHITRA">
          VP.BHYT_DONGIA_CHITRA = '$BHYT_DONGIA_CHITRA$'
        </isNotEmpty>
        <isNotEmpty prepend="and" property="BHYT_THANHTIEN_CHITRA">
          VP.BHYT_THANHTIEN_CHITRA = '$BHYT_THANHTIEN_CHITRA$'
        </isNotEmpty>
        <isNotEmpty prepend="and" property="BENHNHAN_PHAITHANHTOAN">
          VP.BENHNHAN_PHAITHANHTOAN = '$BENHNHAN_PHAITHANHTOAN$'
        </isNotEmpty>
        <isNotEmpty prepend="and" property="GIATRI_HOADON">
          VP.GIATRI_HOADON = '$GIATRI_HOADON$'
        </isNotEmpty>
        <isNotEmpty prepend="and" property="GIATRI_HOADON_DATHANHTOAN">
          VP.GIATRI_HOADON_DATHANHTOAN = '$GIATRI_HOADON_DATHANHTOAN$'
        </isNotEmpty>
        <isNotEmpty prepend="and" property="GIATRI_BIENLAI">
          VP.GIATRI_BIENLAI = '$GIATRI_BIENLAI$'
        </isNotEmpty>
        <isNotEmpty prepend="and" property="GIATRI_BIENLAI_DATHANHTOAN">
          VP.GIATRI_BIENLAI_DATHANHTOAN = '$GIATRI_BIENLAI_DATHANHTOAN$'
        </isNotEmpty>
        <isNotEmpty prepend="and" property="GIATRI_BENHNHAN_DATHANHTOAN">
          VP.GIATRI_BENHNHAN_DATHANHTOAN = '$GIATRI_BENHNHAN_DATHANHTOAN$'
        </isNotEmpty>
        <isNotEmpty prepend="and" property="GIATRI_THATTHU">
          VP.GIATRI_THATTHU = '$GIATRI_THATTHU$'
        </isNotEmpty>
        <isNotEmpty prepend="and" property="MIENGIAM_TL">
          VP.MIENGIAM_TL = '$MIENGIAM_TL$'
        </isNotEmpty>
        <isNotEmpty prepend="and" property="MIENGIAM_GIATRI">
          VP.MIENGIAM_GIATRI = '$MIENGIAM_GIATRI$'
        </isNotEmpty>
        <isNotEmpty prepend="and" property="NGANSACH_TL">
          VP.NGANSACH_TL = '$NGANSACH_TL$'
        </isNotEmpty>
        <isNotEmpty prepend="and" property="NGANSACH_GIATRI">
          VP.NGANSACH_GIATRI = '$NGANSACH_GIATRI$'
        </isNotEmpty>
        <isNotEmpty prepend="and" property="TAITRO_TL">
          VP.TAITRO_TL = '$TAITRO_TL$'
        </isNotEmpty>
        <isNotEmpty prepend="and" property="TAITRO_GIATRI">
          VP.TAITRO_GIATRI = '$TAITRO_GIATRI$'
        </isNotEmpty>
        <isNotEmpty prepend="and" property="BHTN_TL">
          VP.BHTN_TL = '$BHTN_TL$'
        </isNotEmpty>
        <isNotEmpty prepend="and" property="BHTN_DONGIA">
          VP.BHTN_DONGIA = '$BHTN_DONGIA$'
        </isNotEmpty>
        <isNotEmpty prepend="and" property="BHTN_THANHTIEN">
          VP.BHTN_THANHTIEN = '$BHTN_THANHTIEN$'
        </isNotEmpty>
        <isNotEmpty prepend="and" property="BHTN_DONGIA_CHITRA">
          VP.BHTN_DONGIA_CHITRA = '$BHTN_DONGIA_CHITRA$'
        </isNotEmpty>
        <isNotEmpty prepend="and" property="BHTN_THANHTIEN_CHITRA">
          VP.BHTN_THANHTIEN_CHITRA = '$BHTN_THANHTIEN_CHITRA$'
        </isNotEmpty>
        <isNotEmpty prepend="and" property="DUOCPHEPTHUCHIEN">
          VP.DUOCPHEPTHUCHIEN = '$DUOCPHEPTHUCHIEN$'
        </isNotEmpty>
        <isNotEmpty prepend="and" property="HUY">
          VP.HUY = '$HUY$'
        </isNotEmpty>
        <isNotEmpty prepend="and" property="DATHANHTOAN">
          VP.DATHANHTOAN = '$DATHANHTOAN$'
        </isNotEmpty>
        <isNotEmpty prepend="and" property="DATHUCHIEN">
          VP.DATHUCHIEN = '$DATHUCHIEN$'
        </isNotEmpty>
        <isNotEmpty prepend="and" property="KHONGTHUTIEN">
          VP.KHONGTHUTIEN = '$KHONGTHUTIEN$'
        </isNotEmpty>
        <isNotEmpty prepend="and" property="HOADON_ID">
          VP.HOADON_ID = '$HOADON_ID$'
        </isNotEmpty>
        <isNotEmpty prepend="and" property="ACTIVE">
          VP.ACTIVE = '$ACTIVE$'
        </isNotEmpty>
        <isNotEmpty prepend="and" property="BENHVIEN_ID">
          VP.BENHVIEN_ID = '$BENHVIEN_ID$'
        </isNotEmpty>
        <isNotEmpty prepend="and" property="NGUOITAO_ID">
          VP.NGUOITAO_ID = '$NGUOITAO_ID$'
        </isNotEmpty>
        <isNotEmpty prepend="and" property="NGAYTAO">
          VP.NGAYTAO = '$NGAYTAO$'
        </isNotEmpty>
        <isNotEmpty prepend="and" property="NGUOICAPNHAT_ID">
          VP.NGUOICAPNHAT_ID = '$NGUOICAPNHAT_ID$'
        </isNotEmpty>
        <isNotEmpty prepend="and" property="NGAYCAPNHAT">
          VP.NGAYCAPNHAT = '$NGAYCAPNHAT$'
        </isNotEmpty>
        <isNotEmpty prepend="and" property="LISTDATE">
          CONVERT(date, NGAYTAO) IN ($LISTDATE$)
        </isNotEmpty>
      </isParameterPresent>

      )a left join
      (
      select VIENPHI_ID, MG.TINHTRANG as TINHTRANG_BHTN, MGCT.MIENGIAMCHITIET_ID, mgct.VIENPHI_ID as VIENPHI_MGTN
      , mgct.REF_TABLE as REF_TABLE_MGTN
      from TT_MIENGIAM_BHTN MG
      INNER JOIN TT_MIENGIAM_CHITIET MGCT ON MG.MIENGIAM_BHTN_ID = MGCT.MIENGIAM_ID
      where
      MG.TIEPNHAN_ID= '$TIEPNHAN_ID$' and MGCT.REF_TABLE = 'TT_MIENGIAM_BHTN'
      <isParameterPresent>
        <isNotEmpty prepend="and" property="TINHTRANG">
          MG.TINHTRANG = '$TINHTRANG$'
        </isNotEmpty>
      </isParameterPresent>
      )b
      on a.VIENPHI_ID = b.VIENPHI_ID

      left join
      (
      select VIENPHI_ID, MG.TINHTRANG,sum(MGCT.GIATRIMIENGIAM) AS GIATRIMIENGIAM_BH
      from TT_MIENGIAM MG INNER JOIN TT_MIENGIAM_CHITIET MGCT ON MG.MIENGIAM_ID = MGCT.MIENGIAM_ID
      where
      MG.TIEPNHAN_ID= '$TIEPNHAN_ID$'and MGCT.REF_TABLE = 'TT_MIENGIAM'
      <!--<isParameterPresent>
        <isNotEmpty prepend="and" property="TINHTRANG">-->
      and MG.TINHTRANG = '1'
      <!--</isNotEmpty>
      </isParameterPresent>-->
      group by VIENPHI_ID, MG.TINHTRANG
      )d
      on a.VIENPHI_ID = d.VIENPHI_ID

      left join
      (
      select VIENPHI_ID,
      sum(MGCT.GIATRIMIENGIAM) AS GIATRIMIENGIAM_THANHVIEN
      from TT_MIENGIAM_THANHVIEN MG INNER JOIN TT_MIENGIAM_CHITIET MGCT ON MG.MIENGIAM_THANHVIEN_ID = MGCT.MIENGIAM_ID
      where
      MG.TIEPNHAN_ID= '$TIEPNHAN_ID$'
      and MGCT.REF_TABLE = 'TT_MIENGIAM_THANHVIEN'
      and MG.TINHTRANG = 1
      group by VIENPHI_ID
      )f
      on a.VIENPHI_ID = f.VIENPHI_ID
      left join
      (
      select VIENPHI_ID, MG.TINHTRANG AS TINHTRANG_MGCT,
      sum(MGCT.GIATRIMIENGIAM) AS GIATRIMIENGIAM_CTCT
      from TT_MIENGIAM_CONGTY MG INNER JOIN TT_MIENGIAM_CHITIET MGCT ON MG.MIENGIAM_CONGTY_ID = MGCT.MIENGIAM_ID
      where
      MG.TIEPNHAN_ID= '$TIEPNHAN_ID$'
      and MGCT.REF_TABLE = 'TT_MIENGIAM_CONGTY'
      and MG.TINHTRANG = 1
      group by VIENPHI_ID, MG.TINHTRANG
      )g
      on a.VIENPHI_ID = g.VIENPHI_ID
      left join
      (
      select DVYEUCAU_ID, TRANGTHAI, BHYTDONGTIEN,HUYYEUCAU, NOIYEUCAU_ID
      from TT_DVYEUCAU
      <dynamic prepend="where">
        <isParameterPresent>
          <isNotEmpty prepend="and" property="TIEPNHAN_ID">
            TIEPNHAN_ID = '$TIEPNHAN_ID$'
          </isNotEmpty>
          <isNotEmpty prepend="and" property="HUYYEUCAU">
            HUYYEUCAU = '$HUYYEUCAU$'
          </isNotEmpty>
        </isParameterPresent>
      </dynamic>
      )c on c.DVYEUCAU_ID = a.REF_ID
      <dynamic prepend="where">
        <isParameterPresent>
          <isNotEmpty property="HUYYEUCAU">
            c.HUYYEUCAU = '$HUYYEUCAU$' or c.HUYYEUCAU is null
          </isNotEmpty>
        </isParameterPresent>
      </dynamic>
    </statement>
    
    <statement id="DAO00088_TT_MIENGIAM_BHTN_Add" parameterClass="System.Collections.IDictionary" resultClass="System.Int64">
      insert into TT_MIENGIAM_BHTN (
      SOPHIEUBHTN
      , TIEPNHAN_ID
      , BENHAN_ID
      , BENHNHAN_ID
      , CONGTYBHTN_ID
      , SOTHEBHTN
      , NGAYHIEULUC
      , NGAYHETHAN
      , TYLE_BHTN_CHITRA
      , GIATRI_BHTN_CHITRA
      , LYDO_ID
      , NGUOIDUYET_ID
      , GHICHU
      , TINHTRANG
      , BENHVIEN_ID
      , NGUOITAO_ID
      , NGAYTAO
      , NGUOICAPNHAT_ID
      , NGAYCAPNHAT
      ) values (
      #SOPHIEUBHTN#
      , #TIEPNHAN_ID#
      , #BENHAN_ID#
      , #BENHNHAN_ID#
      , #CONGTYBHTN_ID#
      , #SOTHEBHTN#
      , #NGAYHIEULUC#
      , #NGAYHETHAN#
      , #TYLE_BHTN_CHITRA#
      , #GIATRI_BHTN_CHITRA#
      , #LYDO_ID#
      , #NGUOIDUYET_ID#
      , #GHICHU#
      , #TINHTRANG#
      , #BENHVIEN_ID#
      , #NGUOITAO_ID#
      , #NGAYTAO#
      , #NGUOICAPNHAT_ID#
      , #NGAYCAPNHAT#
      )
      SELECT SCOPE_IDENTITY()
      <!--<selectKey resultClass="System.Int64" type="post" >
        SELECT @@IDENTITY as value
      </selectKey>-->
    </statement>

    <insert id="DAO00088_TT_MIENGIAM_CHITIET_BHTN_Add" parameterClass="System.Collections.IDictionary" resultClass="System.Int64">
      insert into TT_MIENGIAM_CHITIET (
      MIENGIAM_ID
      , REF_TABLE
      , VIENPHI_ID
      , TYLEMIENGIAM
      , GIATRIMIENGIAM
      , BENHVIEN_ID
      , NGUOITAO_ID
      , NGAYTAO
      , NGUOICAPNHAT_ID
      , NGAYCAPNHAT
      , GIATRISAUMIENGIAM
      ) values (
      #MIENGIAM_ID#
      , #REF_TABLE#
      , #VIENPHI_ID#
      , #TYLEMIENGIAM#
      , #GIATRIMIENGIAM#
      , #BENHVIEN_ID#
      , #NGUOITAO_ID#
      , #NGAYTAO#
      , #NGUOICAPNHAT_ID#
      , #NGAYCAPNHAT#
      , #GIATRISAUMIENGIAM#
      )
    </insert>
    
    <statement id="DAO00088_TT_MIENGIAM_BHTN_GetList" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
      select * from TT_MIENGIAM_BHTN
      <dynamic prepend="where">
      <isParameterPresent>
        <isNotEmpty prepend="and" property="MIENGIAM_BHTN_ID">
          TT_MIENGIAM_BHTN.MIENGIAM_BHTN_ID = '$MIENGIAM_BHTN_ID$'
        </isNotEmpty>
        <isNotEmpty prepend="and" property="SOPHIEUBHTN">
          TT_MIENGIAM_BHTN.SOPHIEUBHTN = '$SOPHIEUBHTN$'
        </isNotEmpty>
        <isNotEmpty prepend="and" property="TIEPNHAN_ID">
          TT_MIENGIAM_BHTN.TIEPNHAN_ID = '$TIEPNHAN_ID$'
        </isNotEmpty>
        <isNotEmpty prepend="and" property="BENHAN_ID">
          TT_MIENGIAM_BHTN.BENHAN_ID = '$BENHAN_ID$'
        </isNotEmpty>
        <isNotEmpty prepend="and" property="BENHNHAN_ID">
          TT_MIENGIAM_BHTN.BENHNHAN_ID = '$BENHNHAN_ID$'
        </isNotEmpty>
        <isNotEmpty prepend="and" property="CONGTYBHTN_ID">
          TT_MIENGIAM_BHTN.CONGTYBHTN_ID = '$CONGTYBHTN_ID$'
        </isNotEmpty>
        <isNotEmpty prepend="and" property="SOTHEBHTN">
          TT_MIENGIAM_BHTN.SOTHEBHTN = '$SOTHEBHTN$'
        </isNotEmpty>
        <isNotEmpty prepend="and" property="NGAYHIEULUC">
          Convert(date,TT_MIENGIAM_BHTN.NGAYHIEULUC) = Convert(date,'$NGAYHIEULUC$')
        </isNotEmpty>
        <isNotEmpty prepend="and" property="NGAYHETHAN">
          Convert(date,TT_MIENGIAM_BHTN.NGAYHETHAN) = Convert(date,'$NGAYHETHAN$')
        </isNotEmpty>
        <isNotEmpty prepend="and" property="TYLE_BHTN_CHITRA">
          Convert(date,TT_MIENGIAM_BHTN.TYLE_BHTN_CHITRA) = Convert(date,'$TYLE_BHTN_CHITRA$')
        </isNotEmpty>
        <isNotEmpty prepend="and" property="GIATRI_BHTN_CHITRA">
          TT_MIENGIAM_BHTN.GIATRI_BHTN_CHITRA = '$GIATRI_BHTN_CHITRA$'
        </isNotEmpty>
        <isNotEmpty prepend="and" property="NGUOIDUYET_ID">
          TT_MIENGIAM_BHTN.NGUOIDUYET_ID = '$NGUOIDUYET_ID$'
        </isNotEmpty>
        <isNotEmpty prepend="and" property="GHICHU">
          TT_MIENGIAM_BHTN.GHICHU = N'$GHICHU$'
        </isNotEmpty>
        <isNotEmpty prepend="and" property="TINHTRANG">
          TT_MIENGIAM_BHTN.TINHTRANG = '$TINHTRANG$'
        </isNotEmpty>
        <isNotEmpty prepend="and" property="BENHVIEN_ID">
          TT_MIENGIAM_BHTN.BENHVIEN_ID = '$BENHVIEN_ID$'
        </isNotEmpty>
        <isNotEmpty prepend="and" property="NGUOITAO_ID">
          TT_MIENGIAM_BHTN.NGUOITAO_ID = '$NGUOITAO_ID$'
        </isNotEmpty>
        <isNotEmpty prepend="and" property="NGAYTAO">
          TT_MIENGIAM_BHTN.NGAYTAO = '$NGAYTAO$'
        </isNotEmpty>
        <isNotEmpty prepend="and" property="NGUOICAPNHAT_ID">
          TT_MIENGIAM_BHTN.NGUOICAPNHAT_ID = '$NGUOICAPNHAT_ID$'
        </isNotEmpty>
        <isNotEmpty prepend="and" property="NGAYCAPNHAT">
          Convert(date,TT_MIENGIAM_BHTN.NGAYCAPNHAT) = Convert(date,'$NGAYCAPNHAT$')
        </isNotEmpty>
        
      </isParameterPresent>
    </dynamic>
    </statement>
    
    <statement id="DAO00088_TT_MIENGIAM_CHITIET_GetList" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
      select count(*) as SoLuong from TT_MIENGIAM_BHTN MGTN
      left join TT_MIENGIAM_CHITIET MGCT on MGCT.MIENGIAM_ID = MGTN.MIENGIAM_BHTN_ID
      <dynamic prepend="where">
      <isParameterPresent>
        <isNotEmpty prepend="and" property="MIENGIAM_BHTN_ID">
          MGTN.MIENGIAM_BHTN_ID = '$MIENGIAM_BHTN_ID$'
        </isNotEmpty>
        <isNotEmpty prepend="and" property="SOPHIEUBHTN">
          MGTN.SOPHIEUBHTN = '$SOPHIEUBHTN$'
        </isNotEmpty>
        <isNotEmpty prepend="and" property="TIEPNHAN_ID">
          MGTN.TIEPNHAN_ID = '$TIEPNHAN_ID$'
        </isNotEmpty>
        <isNotEmpty prepend="and" property="BENHAN_ID">
          MGTN.BENHAN_ID = '$BENHAN_ID$'
        </isNotEmpty>
        <isNotEmpty prepend="and" property="BENHNHAN_ID">
          MGTN.BENHNHAN_ID = '$BENHNHAN_ID$'
        </isNotEmpty>
        <isNotEmpty prepend="and" property="CONGTYBHTN_ID">
          MGTN.CONGTYBHTN_ID = '$CONGTYBHTN_ID$'
        </isNotEmpty>
        <isNotEmpty prepend="and" property="SOTHEBHTN">
          MGTN.SOTHEBHTN = '$SOTHEBHTN$'
        </isNotEmpty>
        <isNotEmpty prepend="and" property="NGAYHIEULUC">
          MGTN.NGAYHIEULUC = '$NGAYHIEULUC$'
        </isNotEmpty>
        <isNotEmpty prepend="and" property="NGAYHETHAN">
          MGTN.NGAYHETHAN = '$NGAYHETHAN$'
        </isNotEmpty>
        <isNotEmpty prepend="and" property="TYLE_BHTN_CHITRA">
          MGTN.TYLE_BHTN_CHITRA = '$TYLE_BHTN_CHITRA$'
        </isNotEmpty>
        <isNotEmpty prepend="and" property="GIATRI_BHTN_CHITRA">
          MGTN.GIATRI_BHTN_CHITRA = '$GIATRI_BHTN_CHITRA$'
        </isNotEmpty>
        <isNotEmpty prepend="and" property="NGUOIDUYET_ID">
          MGTN.NGUOIDUYET_ID = '$NGUOIDUYET_ID$'
        </isNotEmpty>
        <isNotEmpty prepend="and" property="GHICHU">
          MGTN.GHICHU = N'$GHICHU$'
        </isNotEmpty>
        <isNotEmpty prepend="and" property="TINHTRANG">
          MGTN.TINHTRANG = '$TINHTRANG$'
        </isNotEmpty>
        <isNotEmpty prepend="and" property="BENHVIEN_ID">
          MGTN.BENHVIEN_ID = '$BENHVIEN_ID$'
        </isNotEmpty>
        <isNotEmpty prepend="and" property="NGUOITAO_ID">
          MGTN.NGUOITAO_ID = '$NGUOITAO_ID$'
        </isNotEmpty>
        <isNotEmpty prepend="and" property="NGAYTAO">
          MGTN.NGAYTAO = '$NGAYTAO$'
        </isNotEmpty>
        <isNotEmpty prepend="and" property="NGUOICAPNHAT_ID">
          MGTN.NGUOICAPNHAT_ID = '$NGUOICAPNHAT_ID$'
        </isNotEmpty>
        <isNotEmpty prepend="and" property="NGAYCAPNHAT">
          MGTN.NGAYCAPNHAT = '$NGAYCAPNHAT$'
        </isNotEmpty>        
        <isNotEmpty prepend="and" property="TT_MIENGIAM_BHTN">
          MGTN.TT_MIENGIAM_BHTN = '$TT_MIENGIAM_BHTN$'
        </isNotEmpty>     
      <isNotEmpty prepend="and" property="LIST_VIENPHI">
          MGCT.VIENPHI_ID in ($LIST_VIENPHI$)
        </isNotEmpty>
        <isNotEmpty prepend="and" property="LIST_VIENPHI_UPDATE">
          MGCT.VIENPHI_ID not in ($LIST_VIENPHI_UPDATE$)
        </isNotEmpty>
        
      </isParameterPresent>
    </dynamic>
    </statement>
    
    <statement id="DAO00088_TT_MIENGIAM_BHTN_Search" parameterClass="System.Collections.IDictionary" resultClass="DataObject">

      select MG.*
      , TN.SOTIEPNHAN, BA.SOBENHAN, BN.TENBENHNHAN, BN.MAYTE
      , CASE ISNULL(BN.NGAYSINH,'')
      WHEN '' THEN CONVERT(VARCHAR(10), BN.NAMSINH)
      ELSE CONVERT(VARCHAR(10), BN.NGAYSINH, 103)
      END AS NAMSINH
      ,gt.DESCRIPTION as GIOITINH
      from TT_MIENGIAM_BHTN MG
      left join TT_TIEPNHAN TN on TN.TIEPNHAN_ID = MG.TIEPNHAN_ID
      <!--left join TT_MIENGIAM_CHITIET mgct on mgct.MIENGIAM_ID = mg.MIENGIAM_ID-->
      left join TT_NOITRU_BENHAN BA on BA.BENHAN_ID = MG.BENHAN_ID
      left join TT_BENHNHAN BN on BN.BENHNHAN_ID = MG.BENHNHAN_ID
      left join TM_GENDER gt on gt.ID = bn.GIOITINH
      <!--left join TT_VIENPHI vp on vp.VIENPHI_ID = MGct.VIENPHI_ID and vp.TIEPNHAN_ID = mg.TIEPNHAN_ID and vp.HUY=0-->

      <dynamic prepend="where">
        <isParameterPresent>
          <isNotEmpty prepend="and" property="TUKHOA">
            MG.SOPHIEUBHTN like '%$TUKHOA$%'
            or BN.TENBENHNHAN like N'%$TUKHOA$%'
            or BN.MAYTE like '%$TUKHOA$%'
          </isNotEmpty>
          <isNotEmpty prepend="and" property="TUKHOA1">
            BN.TENBENHNHAN like N'%$TUKHOA1$%'
            or BN.MAYTE like '%$TUKHOA1$%'
          </isNotEmpty>
          <isNotEmpty prepend="and" property="TUKHOA2">
            MG.SOPHIEUBHTN like '%$TUKHOA2$%'
          </isNotEmpty>
            <isNotEmpty prepend="and" property="USER_ID">
            (MG.NGUOIDUYET_ID = '$USER_ID$' or MG.NGUOITAO_ID = '$USER_ID$')
          </isNotEmpty>
          <isNotEmpty prepend="and" property="BENHVIEN_ID">
            MG.BENHVIEN_ID = '$BENHVIEN_ID$'
          </isNotEmpty>
          <isNotEmpty prepend="and" property="TINHTRANG">
            MG.TINHTRANG = '$TINHTRANG$'
          </isNotEmpty>
          <isNotEmpty prepend="and" property="BENHNHAN_ID">
            TN.BENHNHAN_ID = '$BENHNHAN_ID$'
          </isNotEmpty>
          <isNotEmpty prepend="and" property="DENNGAY">
            convert(date, MG.NGAYTAO) between convert(date, '$TUNGAY$') and convert(date, '$DENNGAY$')
          </isNotEmpty>

        </isParameterPresent>
      </dynamic>
      order by MG.MIENGIAM_BHTN_ID DESC
    </statement>

    <statement id="DAO00088_TT_MIENGIAM_CHITIET_BHTN_GetList" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
      select a.*, b.GIATRIMIENGIAM_BH, c.GIATRIMIENGIAM_CTCT, f.GIATRIMIENGIAM_THANHVIEN, a.GIATRIMIENGIAM as GIATRIMIENGIAM_BHTN
      , d.NOIYEUCAU_ID
      from
      (
      select VP.*, MGCT.MIENGIAMCHITIET_ID, MGCT.GIATRIMIENGIAM, MGCT.GIATRISAUMIENGIAM
      from TT_VIENPHI VP
      left join TT_MIENGIAM_CHITIET MGCT on VP.VIENPHI_ID = MGCT.VIENPHI_ID
      <dynamic prepend="where">
        <isParameterPresent>
          <isNotEmpty prepend="and" property="MIENGIAM_ID">
            MGCT.MIENGIAM_ID = '$MIENGIAM_ID$'
          </isNotEmpty>
          <isNotEmpty prepend="and" property="REF_TABLE">
            MGCT.REF_TABLE = '$REF_TABLE$'
          </isNotEmpty>
          <isNotEmpty prepend="and" property="TIEPNHAN_ID">
            VP.TIEPNHAN_ID = '$TIEPNHAN_ID$'
          </isNotEmpty>
          <isNotEmpty prepend="and" property="BENHAN_ID">
            VP.BENHAN_ID = '$BENHAN_ID$'
          </isNotEmpty>
          <isNotEmpty prepend="and" property="DATHANHTOAN">
            VP.DATHANHTOAN = '$DATHANHTOAN$'
          </isNotEmpty>
        </isParameterPresent>
      </dynamic>
      )
      a left join
      (
      select VIENPHI_ID,
      sum(MGCT.GIATRIMIENGIAM) AS GIATRIMIENGIAM_BH
      from TT_MIENGIAM MG INNER JOIN TT_MIENGIAM_CHITIET MGCT ON MG.MIENGIAM_ID = MGCT.MIENGIAM_ID
      where
      MG.TIEPNHAN_ID= '$TIEPNHAN_ID$'
      and MGCT.REF_TABLE = 'TT_MIENGIAM'
      and MG.TINHTRANG = 1
      group by VIENPHI_ID
      )b
      on a.VIENPHI_ID = b.VIENPHI_ID

      left join
      (
      select VIENPHI_ID,
      sum(MGCT.GIATRIMIENGIAM) AS GIATRIMIENGIAM_CTCT
      from TT_MIENGIAM_CONGTY MG
      INNER JOIN TT_MIENGIAM_CHITIET MGCT ON MG.MIENGIAM_CONGTY_ID = MGCT.MIENGIAM_ID
      where
      MG.TIEPNHAN_ID= '7122'
      and MGCT.REF_TABLE = 'TT_MIENGIAM_CONGTY'
      and MG.TINHTRANG = 1
      group by VIENPHI_ID
      )c
      on a.VIENPHI_ID = c.VIENPHI_ID
      left join
      (
      select VIENPHI_ID,
      sum(MGCT.GIATRIMIENGIAM) AS GIATRIMIENGIAM_THANHVIEN
      from TT_MIENGIAM_THANHVIEN MG INNER JOIN TT_MIENGIAM_CHITIET MGCT ON MG.MIENGIAM_THANHVIEN_ID = MGCT.MIENGIAM_ID
      where
      MG.TIEPNHAN_ID= '$TIEPNHAN_ID$'
      and MGCT.REF_TABLE = 'TT_MIENGIAM_THANHVIEN'
      and MG.TINHTRANG = 1
      group by VIENPHI_ID
      )f
      on a.VIENPHI_ID = f.VIENPHI_ID
      left join
      (
      select DVYEUCAU_ID, TRANGTHAI, BHYTDONGTIEN,HUYYEUCAU, NOIYEUCAU_ID
      from TT_DVYEUCAU
      <dynamic prepend="where">
        <isParameterPresent>
          <isNotEmpty prepend="and" property="TIEPNHAN_ID">
            TIEPNHAN_ID = '$TIEPNHAN_ID$'
          </isNotEmpty>
          <isNotEmpty prepend="and" property="HUYYEUCAU">
            HUYYEUCAU = '$HUYYEUCAU$'
          </isNotEmpty>
        </isParameterPresent>
      </dynamic>
      )d on d.DVYEUCAU_ID = a.REF_ID
    </statement>

    <statement id="DAO00088_TT_MIENGIAM_BHTN_Delete" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
      delete from TT_MIENGIAM_BHTN
      <dynamic prepend="where">
        <isParameterPresent>
          <isNotEmpty prepend="and" property="MIENGIAM_BHTN_ID">
            TT_MIENGIAM_BHTN.MIENGIAM_BHTN_ID = '$MIENGIAM_BHTN_ID$'
          </isNotEmpty>
          <isNotEmpty prepend="and" property="SOPHIEUBHTN">
            TT_MIENGIAM_BHTN.SOPHIEUBHTN = '$SOPHIEUBHTN$'
          </isNotEmpty>
          <isNotEmpty prepend="and" property="TIEPNHAN_ID">
            TT_MIENGIAM_BHTN.TIEPNHAN_ID = '$TIEPNHAN_ID$'
          </isNotEmpty>
          <isNotEmpty prepend="and" property="BENHAN_ID">
            TT_MIENGIAM_BHTN.BENHAN_ID = '$BENHAN_ID$'
          </isNotEmpty>
          <isNotEmpty prepend="and" property="BENHNHAN_ID">
            TT_MIENGIAM_BHTN.BENHNHAN_ID = '$BENHNHAN_ID$'
          </isNotEmpty>
          <isNotEmpty prepend="and" property="CONGTYBHTN_ID">
            TT_MIENGIAM_BHTN.CONGTYBHTN_ID = '$CONGTYBHTN_ID$'
          </isNotEmpty>
          <isNotEmpty prepend="and" property="SOTHEBHTN">
            TT_MIENGIAM_BHTN.SOTHEBHTN = '$SOTHEBHTN$'
          </isNotEmpty>
          <isNotEmpty prepend="and" property="TYLE_BHTN_CHITRA">
            TT_MIENGIAM_BHTN.TYLE_BHTN_CHITRA = '$TYLE_BHTN_CHITRA$'
          </isNotEmpty>
          <isNotEmpty prepend="and" property="GIATRI_BHTN_CHITRA">
            TT_MIENGIAM_BHTN.GIATRI_BHTN_CHITRA = '$GIATRI_BHTN_CHITRA$'
          </isNotEmpty>
          <isNotEmpty prepend="and" property="NGUOIDUYET_ID">
            TT_MIENGIAM_BHTN.NGUOIDUYET_ID = '$NGUOIDUYET_ID$'
          </isNotEmpty>
          <isNotEmpty prepend="and" property="GHICHU">
            TT_MIENGIAM_BHTN.GHICHU = N'$GHICHU$'
          </isNotEmpty>
          <isNotEmpty prepend="and" property="TINHTRANG">
            TT_MIENGIAM_BHTN.TINHTRANG = '$TINHTRANG$'
          </isNotEmpty>
          <isNotEmpty prepend="and" property="BENHVIEN_ID">
            TT_MIENGIAM_BHTN.BENHVIEN_ID = '$BENHVIEN_ID$'
          </isNotEmpty>
          <isNotEmpty prepend="and" property="NGUOITAO_ID">
            TT_MIENGIAM_BHTN.NGUOITAO_ID = '$NGUOITAO_ID$'
          </isNotEmpty>
          <isNotEmpty prepend="and" property="NGUOICAPNHAT_ID">
            TT_MIENGIAM_BHTN.NGUOICAPNHAT_ID = '$NGUOICAPNHAT_ID$'
          </isNotEmpty>
        </isParameterPresent>
      </dynamic>
    </statement>

    <statement id="DAO00088_TT_MIENGIAM_CHITIET_BHTN_Delete" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
      delete from TT_MIENGIAM_CHITIET
      <dynamic prepend="where">
          <isParameterPresent>
            <isNotEmpty prepend="and" property="MIENGIAM_ID">
              TT_MIENGIAM_CHITIET.MIENGIAM_ID = '$MIENGIAM_ID$'
            </isNotEmpty>
            <isNotEmpty prepend="and" property="REF_TABLE">
              TT_MIENGIAM_CHITIET.REF_TABLE = '$REF_TABLE$'
            </isNotEmpty>
            <isNotEmpty prepend="and" property="VIENPHI_ID">
              TT_MIENGIAM_CHITIET.VIENPHI_ID = '$VIENPHI_ID$'
            </isNotEmpty>
          </isParameterPresent>
      </dynamic>
    </statement>
    
    <statement id="DAO00088_TT_VIENPHI_GetList" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
      Select *
      from TT_VIENPHI
      <dynamic prepend="where">
          <isParameterPresent>
            <isNotEmpty prepend="and" property="TIEPNHAN_ID">
              TT_VIENPHI.TIEPNHAN_ID = '$TIEPNHAN_ID$'
            </isNotEmpty>
            <isNotEmpty prepend="and" property="BENHVIEN_ID">
              TT_VIENPHI.BENHVIEN_ID = '$BENHVIEN_ID$'
            </isNotEmpty>
          </isParameterPresent>
      </dynamic>
    </statement>

    <statement id="DAO00088_TT_MIENGIAM_BHTN_GetDetail" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
      select mg.*, ba.SOBENHAN
      from TT_MIENGIAM_BHTN mg
      left join TT_NOITRU_BENHAN ba on ba.BENHAN_ID = mg.BENHAN_ID
      where mg.MIENGIAM_BHTN_ID  = '$MIENGIAM_BHTN_ID$'
      and mg.BENHVIEN_ID = '$BENHVIEN_ID$'
    
      <!--select  a.*, b.GIATRIMIENGIAM_BH, c.GIATRIMIENGIAM_BHTN, f.GIATRIMIENGIAM_THANHVIEN

      from
      (
      select VP.*, 'DVKhongTruyThu' as TRUYTHU, c.TRANGTHAI
      , c.DANGKYGOI_ID
      from TT_VIENPHI VP
      left join TT_DVYEUCAU c on c.DVYEUCAU_ID = VP.REF_ID
      <dynamic prepend="where">
      --><!--VP.BENHNHAN_PHAITHANHTOAN &gt; 0--><!--
      <isParameterPresent>
        <isNotEmpty prepend="and" property="VIENPHI_ID">
          VP.VIENPHI_ID = '$VIENPHI_ID$'
        </isNotEmpty>
        <isNotEmpty prepend="and" property="TIEPNHAN_ID">
          VP.TIEPNHAN_ID = '$TIEPNHAN_ID$'
        </isNotEmpty>
        <isNotEmpty prepend="and" property="BENHNHAN_ID">
          VP.BENHNHAN_ID = '$BENHNHAN_ID$'
        </isNotEmpty>
        <isNotEmpty prepend="and" property="BENHAN_ID">
          VP.BENHAN_ID = '$BENHAN_ID$'
        </isNotEmpty>
        <isNotEmpty prepend="and" property="REF_ID">
          VP.REF_ID = '$REF_ID$'
        </isNotEmpty>
        <isNotEmpty prepend="and" property="REF_TABLE">
          VP.REF_TABLE = '$REF_TABLE$'
        </isNotEmpty>
        <isNotEmpty prepend="and" property="DICHVU_ID">
          VP.DICHVU_ID is NULL
        </isNotEmpty>
        <isNotEmpty prepend="and" property="DUOC_ID">
          (DUOC_ID = '0' or DUOC_ID is NULL)
        </isNotEmpty>
        <isNotEmpty prepend="and" property="LOAI_CHIPHI">
          VP.LOAI_CHIPHI = '$LOAI_CHIPHI$'
        </isNotEmpty>
        <isNotEmpty prepend="and" property="LOAIGIA_ID">
          VP.LOAIGIA_ID = '$LOAIGIA_ID$'
        </isNotEmpty>
        <isNotEmpty prepend="and" property="SOLUONG">
          VP.SOLUONG = '$SOLUONG$'
        </isNotEmpty>
        <isNotEmpty prepend="and" property="DONGIA_DOANHTHU">
          VP.DONGIA_DOANHTHU = '$DONGIA_DOANHTHU$'
        </isNotEmpty>
        <isNotEmpty prepend="and" property="THANHTIEN_DOANHTHU">
          VP.THANHTIEN_DOANHTHU = '$THANHTIEN_DOANHTHU$'
        </isNotEmpty>
        <isNotEmpty prepend="and" property="BHYT_TL">
          VP.BHYT_TL = '$BHYT_TL$'
        </isNotEmpty>
        <isNotEmpty prepend="and" property="BHYT_DONGIA">
          VP.BHYT_DONGIA = '$BHYT_DONGIA$'
        </isNotEmpty>
        <isNotEmpty prepend="and" property="BHYT_THANHTIEN">
          VP.BHYT_THANHTIEN = '$BHYT_THANHTIEN$'
        </isNotEmpty>
        <isNotEmpty prepend="and" property="BHYT_DONGIA_CHITRA">
          VP.BHYT_DONGIA_CHITRA = '$BHYT_DONGIA_CHITRA$'
        </isNotEmpty>
        <isNotEmpty prepend="and" property="BHYT_THANHTIEN_CHITRA">
          VP.BHYT_THANHTIEN_CHITRA = '$BHYT_THANHTIEN_CHITRA$'
        </isNotEmpty>
        <isNotEmpty prepend="and" property="BENHNHAN_PHAITHANHTOAN">
          VP.BENHNHAN_PHAITHANHTOAN = '$BENHNHAN_PHAITHANHTOAN$'
        </isNotEmpty>
        <isNotEmpty prepend="and" property="GIATRI_HOADON">
          VP.GIATRI_HOADON = '$GIATRI_HOADON$'
        </isNotEmpty>
        <isNotEmpty prepend="and" property="GIATRI_HOADON_DATHANHTOAN">
          VP.GIATRI_HOADON_DATHANHTOAN = '$GIATRI_HOADON_DATHANHTOAN$'
        </isNotEmpty>
        <isNotEmpty prepend="and" property="GIATRI_BIENLAI">
          VP.GIATRI_BIENLAI = '$GIATRI_BIENLAI$'
        </isNotEmpty>
        <isNotEmpty prepend="and" property="GIATRI_BIENLAI_DATHANHTOAN">
          VP.GIATRI_BIENLAI_DATHANHTOAN = '$GIATRI_BIENLAI_DATHANHTOAN$'
        </isNotEmpty>
        <isNotEmpty prepend="and" property="GIATRI_BENHNHAN_DATHANHTOAN">
          VP.GIATRI_BENHNHAN_DATHANHTOAN = '$GIATRI_BENHNHAN_DATHANHTOAN$'
        </isNotEmpty>
        <isNotEmpty prepend="and" property="GIATRI_THATTHU">
          VP.GIATRI_THATTHU = '$GIATRI_THATTHU$'
        </isNotEmpty>
        <isNotEmpty prepend="and" property="MIENGIAM_TL">
          VP.MIENGIAM_TL = '$MIENGIAM_TL$'
        </isNotEmpty>
        <isNotEmpty prepend="and" property="MIENGIAM_GIATRI">
          VP.MIENGIAM_GIATRI = '$MIENGIAM_GIATRI$'
        </isNotEmpty>
        <isNotEmpty prepend="and" property="NGANSACH_TL">
          VP.NGANSACH_TL = '$NGANSACH_TL$'
        </isNotEmpty>
        <isNotEmpty prepend="and" property="NGANSACH_GIATRI">
          VP.NGANSACH_GIATRI = '$NGANSACH_GIATRI$'
        </isNotEmpty>
        <isNotEmpty prepend="and" property="TAITRO_TL">
          VP.TAITRO_TL = '$TAITRO_TL$'
        </isNotEmpty>
        <isNotEmpty prepend="and" property="TAITRO_GIATRI">
          VP.TAITRO_GIATRI = '$TAITRO_GIATRI$'
        </isNotEmpty>
        <isNotEmpty prepend="and" property="BHTN_TL">
          VP.BHTN_TL = '$BHTN_TL$'
        </isNotEmpty>
        <isNotEmpty prepend="and" property="BHTN_DONGIA">
          VP.BHTN_DONGIA = '$BHTN_DONGIA$'
        </isNotEmpty>
        <isNotEmpty prepend="and" property="BHTN_THANHTIEN">
          VP.BHTN_THANHTIEN = '$BHTN_THANHTIEN$'
        </isNotEmpty>
        <isNotEmpty prepend="and" property="BHTN_DONGIA_CHITRA">
          VP.BHTN_DONGIA_CHITRA = '$BHTN_DONGIA_CHITRA$'
        </isNotEmpty>
        <isNotEmpty prepend="and" property="BHTN_THANHTIEN_CHITRA">
          VP.BHTN_THANHTIEN_CHITRA = '$BHTN_THANHTIEN_CHITRA$'
        </isNotEmpty>
        <isNotEmpty prepend="and" property="DUOCPHEPTHUCHIEN">
          VP.DUOCPHEPTHUCHIEN = '$DUOCPHEPTHUCHIEN$'
        </isNotEmpty>
        <isNotEmpty prepend="and" property="HUY">
          VP.HUY = '$HUY$'
        </isNotEmpty>
        <isNotEmpty prepend="and" property="DATHANHTOAN">
          VP.DATHANHTOAN = '$DATHANHTOAN$'
        </isNotEmpty>
        <isNotEmpty prepend="and" property="DATHUCHIEN">
          VP.DATHUCHIEN = '$DATHUCHIEN$'
        </isNotEmpty>
        <isNotEmpty prepend="and" property="KHONGTHUTIEN">
          VP.KHONGTHUTIEN = '$KHONGTHUTIEN$'
        </isNotEmpty>
        <isNotEmpty prepend="and" property="HOADON_ID">
          VP.HOADON_ID = '$HOADON_ID$'
        </isNotEmpty>
        <isNotEmpty prepend="and" property="ACTIVE">
          VP.ACTIVE = '$ACTIVE$'
        </isNotEmpty>
        <isNotEmpty prepend="and" property="BENHVIEN_ID">
          VP.BENHVIEN_ID = '$BENHVIEN_ID$'
        </isNotEmpty>
        <isNotEmpty prepend="and" property="NGUOITAO_ID">
          VP.NGUOITAO_ID = '$NGUOITAO_ID$'
        </isNotEmpty>
        <isNotEmpty prepend="and" property="NGAYTAO">
          VP.NGAYTAO = '$NGAYTAO$'
        </isNotEmpty>
        <isNotEmpty prepend="and" property="NGUOICAPNHAT_ID">
          VP.NGUOICAPNHAT_ID = '$NGUOICAPNHAT_ID$'
        </isNotEmpty>
        <isNotEmpty prepend="and" property="NGAYCAPNHAT">
          VP.NGAYCAPNHAT = '$NGAYCAPNHAT$'
        </isNotEmpty>
        <isNotEmpty prepend="and" property="LISTDATE">
          CONVERT(date, NGAYTAO) IN ($LISTDATE$)
        </isNotEmpty>
        <isNotEmpty prepend="and" property="HUYYEUCAU">
          (c.HUYYEUCAU = '$HUYYEUCAU$' or c.HUYYEUCAU is null)
        </isNotEmpty>
      </isParameterPresent>
    </dynamic>

      )a left join
      (
      select VIENPHI_ID,
      sum(MGCT.GIATRIMIENGIAM) AS GIATRIMIENGIAM_BH
      from TT_MIENGIAM MG INNER JOIN TT_MIENGIAM_CHITIET MGCT ON MG.MIENGIAM_ID = MGCT.MIENGIAM_ID
      where
      MG.TIEPNHAN_ID= '$TIEPNHAN_ID$'
      and MGCT.REF_TABLE = 'TT_MIENGIAM'
      and MG.TINHTRANG = 1
      group by VIENPHI_ID
      )b
      on a.VIENPHI_ID = b.VIENPHI_ID

      left join
      (
      select VIENPHI_ID,
      sum(MGCT.GIATRIMIENGIAM) AS GIATRIMIENGIAM_BHTN
      from TT_MIENGIAM_BHTN MG INNER JOIN TT_MIENGIAM_CHITIET MGCT ON MG.MIENGIAM_BHTN_ID = MGCT.MIENGIAM_ID
      where
      MG.TIEPNHAN_ID= '$TIEPNHAN_ID$'
      and MGCT.REF_TABLE = 'TT_MIENGIAM_BHTN'
      and MG.TINHTRANG = 1
      group by VIENPHI_ID
      )c
      on a.VIENPHI_ID = c.VIENPHI_ID
      left join
      (
      select VIENPHI_ID,
      sum(MGCT.GIATRIMIENGIAM) AS GIATRIMIENGIAM_THANHVIEN
      from TT_MIENGIAM_THANHVIEN MG INNER JOIN TT_MIENGIAM_CHITIET MGCT ON MG.MIENGIAM_THANHVIEN_ID = MGCT.MIENGIAM_ID
      where
      MG.TIEPNHAN_ID= '$TIEPNHAN_ID$'
      and MGCT.REF_TABLE = 'TT_MIENGIAM_THANHVIEN'
      and MG.TINHTRANG = 1
      group by VIENPHI_ID
      )f
      on a.VIENPHI_ID = f.VIENPHI_ID-->
    </statement>
  
    <update id="DAO00088_TT_VIENPHI_Update" parameterClass="System.Collections.IDictionary">
        update TT_VIENPHI set
        TIEPNHAN_ID = #TIEPNHAN_ID#
        , BENHAN_ID = #BENHAN_ID#
        , REF_ID = #REF_ID#
        , REF_TABLE = #REF_TABLE#
        , DICHVU_ID = #DICHVU_ID#
        , DUOC_ID = #DUOC_ID#
        , LOAI_CHIPHI = #LOAI_CHIPHI#
        , LOAIGIA_ID = #LOAIGIA_ID#
        , SOLUONG = #SOLUONG#
        , DONGIA_DOANHTHU = #DONGIA_DOANHTHU#
        , THANHTIEN_DOANHTHU = #THANHTIEN_DOANHTHU#
        , BHYT_TL = #BHYT_TL#
        , BHYT_DONGIA = #BHYT_DONGIA#
        , BHYT_THANHTIEN = #BHYT_THANHTIEN#
        , BHYT_DONGIA_CHITRA = #BHYT_DONGIA_CHITRA#
        , BHYT_THANHTIEN_CHITRA = #BHYT_THANHTIEN_CHITRA#
        , BENHNHAN_PHAITHANHTOAN = #BENHNHAN_PHAITHANHTOAN#
        , GIATRI_HOADON = #GIATRI_HOADON#
        , GIATRI_HOADON_DATHANHTOAN = #GIATRI_HOADON_DATHANHTOAN#
        , GIATRI_BIENLAI = #GIATRI_BIENLAI#
        , GIATRI_BIENLAI_DATHANHTOAN = #GIATRI_BIENLAI_DATHANHTOAN#
        , GIATRI_BENHNHAN_DATHANHTOAN = #GIATRI_BENHNHAN_DATHANHTOAN#
        , GIATRI_THATTHU = #GIATRI_THATTHU#
        , MIENGIAM_TL = #MIENGIAM_TL#
        , MIENGIAM_GIATRI = #MIENGIAM_GIATRI#
        , NGANSACH_TL = #NGANSACH_TL#
        , NGANSACH_GIATRI = #NGANSACH_GIATRI#
        , TAITRO_TL = #TAITRO_TL#
        , TAITRO_GIATRI = #TAITRO_GIATRI#
        , BHTN_TL = #BHTN_TL#
        , BHTN_DONGIA = #BHTN_DONGIA#
        , BHTN_THANHTIEN = #BHTN_THANHTIEN#
        , BHTN_DONGIA_CHITRA = #BHTN_DONGIA_CHITRA#
        , BHTN_THANHTIEN_CHITRA = #BHTN_THANHTIEN_CHITRA#
        , DUOCPHEPTHUCHIEN = #DUOCPHEPTHUCHIEN#
        , HUY = #HUY#
        , DATHANHTOAN = #DATHANHTOAN#
        , DATHUCHIEN = #DATHUCHIEN#
        , KHONGTHUTIEN = #KHONGTHUTIEN#
        , HOADON_ID = #HOADON_ID#
        , ACTIVE = #ACTIVE#
        <!--, BENHVIEN_ID = #BENHVIEN_ID#
        , NGUOITAO_ID = #NGUOITAO_ID#
        , NGAYTAO = #NGAYTAO#-->
      , NGUOICAPNHAT_ID = #NGUOICAPNHAT_ID#
      , NGAYCAPNHAT = #NGAYCAPNHAT#
      where
      VIENPHI_ID = '$VIENPHI_ID$'
      and BENHVIEN_ID = '$BENHVIEN_ID$'
    </update>
  
      <update id="DAO00088_TT_MIENGIAM_CHITIET_BHTN_Update" parameterClass="System.Collections.IDictionary">
      update TT_MIENGIAM_CHITIET set
      MIENGIAM_ID = #MIENGIAM_ID#
      , VIENPHI_ID = #VIENPHI_ID#
      , TYLEMIENGIAM = #TYLEMIENGIAM#
      , GIATRIMIENGIAM = #GIATRIMIENGIAM#
      <!--, BENHVIEN_ID = #BENHVIEN_ID#
      , NGUOITAO_ID = #NGUOITAO_ID#
      , NGAYTAO = #NGAYTAO#-->
        , NGUOICAPNHAT_ID = #NGUOICAPNHAT_ID#
        , NGAYCAPNHAT = #NGAYCAPNHAT#
        , GIATRISAUMIENGIAM = #GIATRISAUMIENGIAM#
        where
        MIENGIAMCHITIET_ID = '$MIENGIAMCHITIET_ID$'
        and BENHVIEN_ID = '$BENHVIEN_ID$'
      </update>
    
    <update id="DAO00088_TT_MIENGIAM_BHTN_Update" parameterClass="System.Collections.IDictionary">
      update TT_MIENGIAM_BHTN
      set
      <!--SOPHIEUBHTN=#SOPHIEUBHTN#-->
      TIEPNHAN_ID=#TIEPNHAN_ID#
      , BENHAN_ID=#BENHAN_ID#
      , BENHNHAN_ID=#BENHNHAN_ID#
      , CONGTYBHTN_ID=#CONGTYBHTN_ID#
      , SOTHEBHTN=#SOTHEBHTN#
      , NGAYHIEULUC= #NGAYHIEULUC#
      , NGAYHETHAN=#NGAYHETHAN#
      , TYLE_BHTN_CHITRA=#TYLE_BHTN_CHITRA#
      , GIATRI_BHTN_CHITRA= #GIATRI_BHTN_CHITRA#
      , NGUOIDUYET_ID=#NGUOIDUYET_ID#
      , GHICHU=#GHICHU#
      , TINHTRANG=#TINHTRANG#
      , LYDO_ID = #LYDO_ID#
      <!--, BENHVIEN_ID=#BENHVIEN_ID#-->
      <!--, NGUOITAO_ID= #NGUOITAO_ID#-->
      <!--, NGAYTAO= #NGAYTAO#-->
      , NGUOICAPNHAT_ID=#NGUOICAPNHAT_ID#
      , NGAYCAPNHAT=#NGAYCAPNHAT#
      where
      MIENGIAM_BHTN_ID = #MIENGIAM_BHTN_ID#
      and BENHVIEN_ID = '$BENHVIEN_ID$'
    </update>
    
    <update id="DAO00088_TT_APPROVE_DUYET_MIENGIAM_BHTN" parameterClass="System.Collections.IDictionary">
      update TT_MIENGIAM_BHTN
      set
      SOPHIEUBHTN=#SOPHIEUBHTN#
      , TIEPNHAN_ID=#TIEPNHAN_ID#
      , BENHAN_ID=#BENHAN_ID#
      , BENHNHAN_ID=#BENHNHAN_ID#
      , CONGTYBHTN_ID=#CONGTYBHTN_ID#
      , SOTHEBHTN=#SOTHEBHTN#
      , NGAYHIEULUC= #NGAYHIEULUC#
      , NGAYHETHAN=#NGAYHETHAN#
      , TYLE_BHTN_CHITRA=#TYLE_BHTN_CHITRA#
      , GIATRI_BHTN_CHITRA= #GIATRI_BHTN_CHITRA#
      , NGUOIDUYET_ID=#NGUOIDUYET_ID#
      , NGAYDUYET = #NGAYDUYET#
      , GHICHU=#GHICHU#
      , TINHTRANG=#TINHTRANG#
      , BENHVIEN_ID=#BENHVIEN_ID#
      , NGUOITAO_ID= #NGUOITAO_ID#
      , NGAYTAO= #NGAYTAO#
      , NGUOICAPNHAT_ID=#NGUOICAPNHAT_ID#
      , NGAYCAPNHAT=#NGAYCAPNHAT#
      where
      MIENGIAM_BHTN_ID = #MIENGIAM_BHTN_ID#
      and BENHVIEN_ID = '$BENHVIEN_ID$'
    </update>
  </statements>   
</sqlMap>