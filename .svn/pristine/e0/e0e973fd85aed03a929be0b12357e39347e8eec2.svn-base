<?xml version="1.0" encoding="utf-8" ?>
<!--============================================================================
//	CAUTION: This file is generated by IBatisNetGen.3.SQLMap.cst at 12/21/2015 2:22:43 PM
//				Any manual editing will be lost in re-generation.
//===========================================================================-->
<sqlMap namespace="eHospital" xmlns="http://ibatis.apache.org/mapping" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">

  <statements>
    <statement id="DAO00079_GetAll" resultClass="DataObject">
      select *
      from TT_BIENBANHOICHAN_EKIP
      order by BIENBANHOICHAN_BACSI_ID
    </statement>
    <statement id="DAO00079_GetDanhSachBienBanHoiChan_Duoc" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
      select *
      from TT_BIENBANHOICHAN_DUOC
      where BIENBANHOICHAN_ID='$BIENBANHOICHAN_ID$'
    </statement>
    <statement id="DAO00079_GetList" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
      select *
      from TT_BIENBANHOICHAN_EKIP
      <dynamic prepend="where">
        <isParameterPresent>
          <isNotEmpty prepend="and" property="BIENBANHOICHAN_BACSI_ID">
            TT_BIENBANHOICHAN_EKIP.BIENBANHOICHAN_BACSI_ID = '$BIENBANHOICHAN_BACSI_ID$'
          </isNotEmpty>
          <isNotEmpty prepend="and" property="BIENBANHOICHAN_ID">
            TT_BIENBANHOICHAN_EKIP.BIENBANHOICHAN_ID = '$BIENBANHOICHAN_ID$'
          </isNotEmpty>
          <isNotEmpty prepend="and" property="NHANVIEN_ID">
            TT_BIENBANHOICHAN_EKIP.NHANVIEN_ID = '$NHANVIEN_ID$'
          </isNotEmpty>
          <isNotEmpty prepend="and" property="VITRI_ID">
            TT_BIENBANHOICHAN_EKIP.VITRI_ID = '$VITRI_ID$'
          </isNotEmpty>
          <isNotEmpty prepend="and" property="CHUCVU_ID">
            TT_BIENBANHOICHAN_EKIP.CHUCVU_ID = '$CHUCVU_ID$'
          </isNotEmpty>
          <isNotEmpty prepend="and" property="CHUCDANH_ID">
            TT_BIENBANHOICHAN_EKIP.CHUCDANH_ID = '$CHUCDANH_ID$'
          </isNotEmpty>
          <isNotEmpty prepend="and" property="BENHVIEN_ID">
            TT_BIENBANHOICHAN_EKIP.BENHVIEN_ID = '$BENHVIEN_ID$'
          </isNotEmpty>
        </isParameterPresent>
      </dynamic>
      order by BIENBANHOICHAN_BACSI_ID
    </statement>
    <statement id="DAO00079_GetDetail" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
      select *
      from TT_BIENBANHOICHAN_EKIP
      where TT_BIENBANHOICHAN_EKIP.BIENBANHOICHAN_BACSI_ID  = '$value$'
      order by BIENBANHOICHAN_BACSI_ID
    </statement>
    <statement id="DAO00079_GetDetailP" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
      select *
      from TT_BIENBANHOICHAN_EKIP
      where TT_BIENBANHOICHAN_EKIP.BIENBANHOICHAN_BACSI_ID  = '$BIENBANHOICHAN_BACSI_ID$'
      order by BIENBANHOICHAN_BACSI_ID
    </statement>
    <statement id="DAO00079_Add" parameterClass="System.Collections.IDictionary" resultClass="System.Int64">
      insert into TT_BIENBANHOICHAN_EKIP (
      BIENBANHOICHAN_ID
      , NHANVIEN_ID
      , VITRI_ID
      , CHUCVU_ID
      , CHUCDANH_ID
      , BENHVIEN_ID
      ) values (
      #BIENBANHOICHAN_ID#
      , #NHANVIEN_ID#
      , #VITRI_ID#
      , #CHUCVU_ID#
      , #CHUCDANH_ID#
      , #BENHVIEN_ID#
      )
      SELECT SCOPE_IDENTITY()
      <!--<selectKey resultClass="System.Int64" type="post" >
        SELECT @@IDENTITY as value
      </selectKey>-->
    </statement>
    <statement id="DAO00079_Add_Duoc" parameterClass="System.Collections.IDictionary" resultClass="System.Int64">
      INSERT INTO [TT_BIENBANHOICHAN_DUOC]
      ([BIENBANHOICHAN_ID]
      ,[DUOC_ID]
      ,[DUONGDUNG_ID]
      ,[THOIGIANDUNG]
      ,[THOIGIANDEN]
      ,[LYDO]
      ,[BENHVIEN_ID])
      VALUES
      (#BIENBANHOICHAN_ID#
      ,#DUOC_ID#
      ,#DUONGDUNG_ID#
      ,#THOIGIANDUNG#
      ,#THOIGIANDEN#
      ,#LYDO#
      ,#BENHVIEN_ID#)
      
      SELECT SCOPE_IDENTITY()
      <!--<selectKey resultClass="System.Int64" type="post" >
        SELECT @@IDENTITY as value
      </selectKey>-->
    </statement>

    <update id="DAO00079_Update" parameterClass="System.Collections.IDictionary">
      update TT_BIENBANHOICHAN_EKIP set
      BIENBANHOICHAN_ID = #BIENBANHOICHAN_ID#
      , NHANVIEN_ID = #NHANVIEN_ID#
      , VITRI_ID = #VITRI_ID#
      , CHUCVU_ID = #CHUCVU_ID#
      , CHUCDANH_ID = #CHUCDANH_ID#
      , BENHVIEN_ID = #BENHVIEN_ID#
      where
      BIENBANHOICHAN_BACSI_ID = '$BIENBANHOICHAN_BACSI_ID$'
    </update>
    <update id="DAO00079_Update_Duoc" parameterClass="System.Collections.IDictionary">
      UPDATE [dbo].[TT_BIENBANHOICHAN_DUOC]
      SET [BIENBANHOICHAN_ID] = #BIENBANHOICHAN_ID#
      ,[DUOC_ID] = #DUOC_ID#
      ,[DUONGDUNG_ID] = #DUONGDUNG_ID#
      ,[THOIGIANDUNG] = #THOIGIANDUNG#
      ,[THOIGIANDEN] = #THOIGIANDEN#
      ,[LYDO] = #LYDO#
      ,[BENHVIEN_ID] = #BENHVIEN_ID#
      WHERE BIENBANHOICHAN_DUOC_ID='$BIENBANHOICHAN_DUOC_ID$'
    </update>

    <statement id="DAO00079_Delete" parameterClass="System.Collections.IDictionary" resultClass="System.Int32">
      delete from TT_BIENBANHOICHAN_EKIP
      where
      BIENBANHOICHAN_BACSI_ID = '$BIENBANHOICHAN_BACSI_ID$'
    </statement>
    <statement id="DAO00079_Delete_Duoc" parameterClass="System.Collections.IDictionary" resultClass="System.Int32">
      delete from TT_BIENBANHOICHAN_DUOC
      where
      BIENBANHOICHAN_ID = '$BIENBANHOICHAN_ID$'
    </statement>

    <statement id="DAO00079_DeleteHoiChanBacSi" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
      delete from TT_BIENBANHOICHAN_EKIP
      <dynamic prepend=" where BIENBANHOICHAN_BACSI_ID in ">
        <iterate open="(" close=")" conjunction=",  " property="DSDEL_EKIP_ID">#DSDEL_EKIP_ID[]#</iterate>
      </dynamic>
    </statement>
    <statement id="DAO00079_DeleteHoiChanDuoc" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
      delete from TT_BIENBANHOICHAN_DUOC
      <dynamic prepend=" where BIENBANHOICHAN_DUOC_ID in ">
        <iterate open="(" close=")" conjunction=",  " property="DSDEL_DUOC_ID">#DSDEL_DUOC_ID[]#</iterate>
      </dynamic>
    </statement>


    <statement id="DAO00079_DeleteP" parameterClass="System.Collections.IDictionary" resultClass="System.Int32">
      delete from TT_BIENBANHOICHAN_EKIP
      <dynamic prepend="where">
        <isParameterPresent>
          <isNotEmpty prepend="and" property="BIENBANHOICHAN_BACSI_ID">
            TT_BIENBANHOICHAN_EKIP.BIENBANHOICHAN_BACSI_ID = '$BIENBANHOICHAN_BACSI_ID$'
          </isNotEmpty>
          <isNotEmpty prepend="and" property="BIENBANHOICHAN_ID">
            TT_BIENBANHOICHAN_EKIP.BIENBANHOICHAN_ID = '$BIENBANHOICHAN_ID$'
          </isNotEmpty>
          <isNotEmpty prepend="and" property="NHANVIEN_ID">
            TT_BIENBANHOICHAN_EKIP.NHANVIEN_ID = '$NHANVIEN_ID$'
          </isNotEmpty>
          <isNotEmpty prepend="and" property="VITRI_ID">
            TT_BIENBANHOICHAN_EKIP.VITRI_ID = '$VITRI_ID$'
          </isNotEmpty>
          <isNotEmpty prepend="and" property="CHUCVU_ID">
            TT_BIENBANHOICHAN_EKIP.CHUCVU_ID = '$CHUCVU_ID$'
          </isNotEmpty>
          <isNotEmpty prepend="and" property="CHUCDANH_ID">
            TT_BIENBANHOICHAN_EKIP.CHUCDANH_ID = '$CHUCDANH_ID$'
          </isNotEmpty>
          <isNotEmpty prepend="and" property="BENHVIEN_ID">
            TT_BIENBANHOICHAN_EKIP.BENHVIEN_ID = '$BENHVIEN_ID$'
          </isNotEmpty>
        </isParameterPresent>
      </dynamic>
    </statement>
    <statement id="DAO00079_GetDichVuThucHienCuaTiepNhan" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
      select distinct A.TIEPNHAN_ID, vp.BENHAN_ID, A.BENHNHAN_ID, A.DVYEUCAU_ID, A.DICHVU_ID, E.TENDICHVU, E.NHOMDICHVU_ID,
      A.NOITHUCHIEN_ID, F.TENPHONGBAN, A.NGAYGIOYEUCAU, A.NGAYCAPNHAT, A.TRANGTHAI, left(G.MANHOMDICHVU,2) as MANHOMDICHVU,
      (select TENNHOMDICHVU from TM_NHOMDICHVU where MANHOMDICHVU = left(G.MANHOMDICHVU,2) and BENHVIEN_ID = '$BENHVIEN_ID$') as NHOMDICHVU,
      A.NGUOICAPNHAT_ID, isnull(A.BACSICHIDINH_ID, A.NGUOIGIOITHIEU_ID) as NGUOITAO_ID,
      CASE WHEN
      B.CLSKETQUA_ID is not null or A.KHAMBENH_NGOAITRU_ID is not null
      or D.PHAUTHUAT_ID is not null or L.CLSKETQUA_ID is not null
      or TM.KHAMTIENME_ID is not null
      THEN 'DATHUCHIEN' ELSE 'CHUATHUCHIEN' END AS TRANGTHAI_THUCHIEN , vp.DATHANHTOAN
      from TT_VIENPHI VP
      LEFT JOIN TT_DVYEUCAU A ON A.DVYEUCAU_ID = VP.REF_ID AND A.TIEPNHAN_ID = VP.TIEPNHAN_ID
      left join TT_CLSKETQUACHITIET B on A.DVYEUCAU_ID = B.DVYEUCAU_ID <!--and B.DICHVU_ID = A.DICHVU_ID-->
      left join TT_PHAUTHUAT_YEUCAU D on D.DVYEUCAU_ID = A.DVYEUCAU_ID
      left join TM_DICHVU E on E.DICHVU_ID = A.DICHVU_ID
      left join TM_PHONGBAN F on F.PHONGBAN_ID = A.NOITHUCHIEN_ID
      left join TM_NHOMDICHVU G on G.NHOMDICHVU_ID = E.NHOMDICHVU_ID
      left join TT_CLSKETQUA L on L.DVYEUCAU_ID = A.DVYEUCAU_ID and L.TIEPNHAN_ID = A.TIEPNHAN_ID
      left join TT_NOITRU_KHAMTIENME TM on TM.DVYEUCAU_ID = A.DVYEUCAU_ID
      where A.HUYYEUCAU='0'
      <isParameterPresent>
        <isNotEmpty prepend="and" property="TIEPNHAN_ID">
          A.TIEPNHAN_ID = '$TIEPNHAN_ID$'
        </isNotEmpty>
        <isNotEmpty prepend="and" property="BENHVIEN_ID">
          A.BENHVIEN_ID = '$BENHVIEN_ID$'
        </isNotEmpty>
        <isNotEmpty prepend="and" property="BENHAN_ID">
          A.BENHAN_ID = '$BENHAN_ID$'
        </isNotEmpty>
        <isNotEmpty prepend="and" property="DATHANHTOAN">
          <isEqual prepend="" property="TRATIENSAU" compareValue="0">
            (VP.DATHANHTOAN = '$DATHANHTOAN$' OR (VP.DATHANHTOAN = '0' AND VP.BENHNHAN_PHAITHANHTOAN = 0))
          </isEqual>
        </isNotEmpty>
        <isNotEmpty prepend="" property="COM_CHITHUCHIEN_DICHVU_KHONGTRA_KQ">
          <isEqual prepend="AND" property="COM_CHITHUCHIEN_DICHVU_KHONGTRA_KQ" compareValue="True">
            E.NORESULT = '1'
          </isEqual>
        </isNotEmpty>
      </isParameterPresent>
    </statement>
    <statement id="DAO00079_GetDichVuThucHienCuaTiepNhanNgoaiTru" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
      select distinct A.TIEPNHAN_ID, vp.BENHAN_ID, A.BENHNHAN_ID, A.DVYEUCAU_ID, A.DICHVU_ID, E.TENDICHVU, E.NHOMDICHVU_ID,
      A.NOITHUCHIEN_ID, F.TENPHONGBAN, A.NGAYGIOYEUCAU, A.NGAYCAPNHAT, A.TRANGTHAI, left(G.MANHOMDICHVU,2) as MANHOMDICHVU,
      (select TENNHOMDICHVU from TM_NHOMDICHVU where MANHOMDICHVU = left(G.MANHOMDICHVU,2) and BENHVIEN_ID = '$BENHVIEN_ID$') as NHOMDICHVU,
      A.NGUOICAPNHAT_ID, isnull(A.BACSICHIDINH_ID, A.NGUOIGIOITHIEU_ID) as NGUOITAO_ID,
      CASE WHEN
      B.CLSKETQUA_ID is not null or A.KHAMBENH_NGOAITRU_ID is not null
      or D.PHAUTHUAT_ID is not null or L.CLSKETQUA_ID is not null
      or TM.KHAMTIENME_ID is not null
      THEN 'DATHUCHIEN' ELSE 'CHUATHUCHIEN' END AS TRANGTHAI_THUCHIEN , vp.DATHANHTOAN,
      CASE WHEN vp.BHYT_DONGIA is not null and vp.BHYT_DONGIA > 0 then '1' else '0' end as BHYT
      from TT_VIENPHI VP
      LEFT JOIN TT_DVYEUCAU A ON A.DVYEUCAU_ID = VP.REF_ID AND A.TIEPNHAN_ID = VP.TIEPNHAN_ID
      left join TT_CLSKETQUACHITIET B on A.DVYEUCAU_ID = B.DVYEUCAU_ID <!--and B.DICHVU_ID = A.DICHVU_ID-->
      left join TT_PHAUTHUAT_YEUCAU D on D.DVYEUCAU_ID = A.DVYEUCAU_ID
      left join TM_DICHVU E on E.DICHVU_ID = A.DICHVU_ID
      left join TM_PHONGBAN F on F.PHONGBAN_ID = A.NOITHUCHIEN_ID
      left join TM_NHOMDICHVU G on G.NHOMDICHVU_ID = E.NHOMDICHVU_ID
      left join TT_CLSKETQUA L on L.DVYEUCAU_ID = A.DVYEUCAU_ID and L.TIEPNHAN_ID = A.TIEPNHAN_ID
      left join TT_NOITRU_KHAMTIENME TM on TM.DVYEUCAU_ID = A.DVYEUCAU_ID
      where VP.REF_TABLE = 'TT_DVYEUCAU' and A.HUYYEUCAU='0' 
      <isParameterPresent>
        <isNotEmpty prepend="and" property="TIEPNHAN_ID">
          A.TIEPNHAN_ID = '$TIEPNHAN_ID$'
        </isNotEmpty>
        <isNotEmpty prepend="and" property="BENHVIEN_ID">
          A.BENHVIEN_ID = '$BENHVIEN_ID$'
        </isNotEmpty>
        <isNotEmpty prepend="and" property="DATHANHTOAN">
          (VP.DATHANHTOAN in ($DATHANHTOAN$) <!--OR (VP.DATHANHTOAN = '0' AND VP.BENHNHAN_PHAITHANHTOAN = 0)--> OR isnull(VP.KHONGTHUTIEN, '0') = '1'
          or isnull(A.THUTIENSAU, '0') = '1' or ('1' = '$TRATIENSAU$')
          or (VP.BENHNHAN_PHAITHANHTOAN - VP.GIATRI_BENHNHAN_DATHANHTOAN = 0))
        </isNotEmpty>
        <isNotEmpty prepend="" property="COM_CHITHUCHIEN_DICHVU_KHONGTRA_KQ">
          <isEqual prepend="AND" property="COM_CHITHUCHIEN_DICHVU_KHONGTRA_KQ" compareValue="True">
            E.NORESULT = '1'
          </isEqual>
        </isNotEmpty>
      </isParameterPresent>
    </statement>
    <statement id="DAO00079_KiemTraDichVuThucHienCuaBenhAn" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
      <!--select A.*
      from TT_DVYEUCAU A
      inner join TT_NOITRU_BENHAN B on B.TIEPNHAN_ID = A.TIEPNHAN_ID
      where
      A.TIEPNHAN_ID = '$TIEPNHAN_ID$'
      and A.HUYYEUCAU = '0'
      and (A.TRANGTHAI = 'CHUAKETQUA' or A.TRANGTHAI = 'DANGTHUCHIEN' or A.TRANGTHAI = 'CHOXACNHAN')-->
      select * from TT_DVYEUCAU
      where
      exists (select REF_ID from TT_VIENPHI where TT_DVYEUCAU.DVYEUCAU_ID = REF_ID and BENHAN_ID = '$BENHAN_ID$' and REF_TABLE = 'TT_DVYEUCAU') and TIEPNHAN_ID = '$TIEPNHAN_ID$'
      and HUYYEUCAU = '0'
      and (TRANGTHAI = 'CHUAKETQUA' or TRANGTHAI = 'DANGTHUCHIEN' or TRANGTHAI = 'CHOXACNHAN') and BENHAN_ID is not null
    </statement>
    <statement id="DAO00079_KiemTraThuocVTYTThucHienCuaBenhAn" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
      select A.*
      from TT_NOITRU_TOATHUOC A
      inner join TT_NOITRU_KHAMBENH B on B.KHAMBENH_ID = A.KHAMBENH_ID
      left join TT_NOITRU_TRATHUOC_CHITIET ttct on a.TOATHUOC_ID = ttct.TOATHUOC_ID
      where
      A.TIEPNHAN_ID = '$TIEPNHAN_ID$'
      and (A.CHUNGTU_ID is null)
      <!--and B.ISTHUOCBV = '1'-->
      and ttct.TRATHUOC_ID is null
      <isNotEmpty prepend="and" property="BENHAN_ID">
        B.BENHAN_ID = '$BENHAN_ID$'
      </isNotEmpty>
    </statement>
    <statement id="DAO00079_KiemTraThuocVTYTThucHienCuaBenhAnNgoaiTru" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
      select A.*
      from TT_NOITRU_TOATHUOC A
      inner join TT_NOITRU_KHAMBENH B on B.KHAMBENH_ID = A.KHAMBENH_ID
      left join TT_NOITRU_TRATHUOC_CHITIET ttct on a.TOATHUOC_ID = ttct.TOATHUOC_ID
      where
      A.TIEPNHAN_ID = '$TIEPNHAN_ID$'
      and (A.CHUNGTU_ID is null)
      and B.RAVIEN = '0'
      and ttct.TRATHUOC_ID is null
    </statement>
    <statement id="DAO00079_KiemTraKhoaHienTaiCuaBenhAn" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
      select A.KHOACHUYENDEN_ID, E.TRANGTHAI
      from TT_NOITRU_BENHAN A
      left join TT_NOITRU_XACNHAN E on E.BENHAN_ID = A.BENHAN_ID
      where
      A.TIEPNHAN_ID = '$TIEPNHAN_ID$'
    </statement>
    <statement id="DAO00079_KiemTraThuocNhapNoiBo" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
      select A.TIEPNHAN_ID,
      CASE WHEN (A.TOATHUOC > B.TOATHUOC_NHAPNOIBO) THEN 'IN' ELSE 'OUT' END AS CHOPHEP
      from
      (select count(*) AS TOATHUOC, A.TIEPNHAN_ID
      from TT_NOITRU_TOATHUOC A
      where A.TIEPNHAN_ID = '$TIEPNHAN_ID$' group by A.TIEPNHAN_ID) A
      left join
      (select count(*) AS TOATHUOC_NHAPNOIBO, A.TIEPNHAN_ID
      from TT_NOITRU_TOATHUOC A
      left join TT_DUOC_PHIEULINH_CHITIET B on B.TOATHUOCNOITRU_ID = A.TOATHUOC_ID and B.REF_TABLE = 'TT_NOITRU_TOATHUOC'
      left join TT_DUOC_CHUNGTU C on C.PHIEULINH_ID = B.CHUNGTU_ID and C.LOAICHUNGTU = 'N'
      where A.TIEPNHAN_ID = '$TIEPNHAN_ID$' group by A.TIEPNHAN_ID) B on B.TIEPNHAN_ID = A.TIEPNHAN_ID
    </statement>
    <statement id="DAO00079_KiemTraVTYTCusBenhAn" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
      select A.* from TT_CLSKETQUA_VTYT A
      left join TT_DVYEUCAU B on A.DVYEUCAU_ID = B.DVYEUCAU_ID
      where B.BENHAN_ID = '$BENHAN_ID$' and A.CHUNGTU_ID is null
    </statement>
    <statement id="DAO00079_KiemTraVTYTCuaKhambenh" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
      select A.* from TT_NGOAITRU_KHAMBENH_VTYT A
      left join TT_DVYEUCAU B on A.DVYEUCAU_ID = B.DVYEUCAU_ID
      where B.BENHAN_ID = '$BENHAN_ID$' and A.CHUNGTU_ID is null
    </statement>
    <statement id="DAO00079_KiemTraSuatAnThucHienCuaBenhAn" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
      select B.NGAYTONGHOP, C.XACNHANSUATANCHITIET_ID, A.BENHAN_ID, A.CHIDINHKHAUPHAN_ID, A.CHIDINHKHAUPHANCHITIET_ID
      from TT_NUT_CHIDINHKHAUPHAN_CHITIET A
      INNER JOIN TT_NUT_CHIDINHKHAUPHAN CD ON CD.CHIDINHKHAUPHAN_ID = A.CHIDINHKHAUPHAN_ID
      left join TT_NUT_TONGHOPSUATAN_CHITIET B on A.CHIDINHKHAUPHANCHITIET_ID = B.CHIDINHKHAUPHANCHITIET_ID
      left join TT_NUT_XACNHANSUATAN_CHITIET C on C.TONGHOPSUATANCHITIET_ID = B.TONGHOPSUATANCHITIET_ID
      where A.XOA = '0' AND CD.XOA = '0'
      <!--and C.XACNHANSUATANCHITIET_ID is null-->
      and (C.HUY is null or C.HUY = '0')
      and A.BENHAN_ID = '$BENHAN_ID$'
      and A.BENHVIEN_ID = '$BENHVIEN_ID$'
      AND A.CHIDINHKHAUPHANCHITIET_ID NOT IN (SELECT CHIDINHKHAUPHANCHITIET_ID FROM TT_NUT_XACNHANSUATAN_CHITIET)
      <!--AND B.TONGHOPSUATANCHITIET_ID IS NULL-->
    </statement>
    <statement id="DAO00079_KiemThuThuatVTYTThucHienCuaBenhAn" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
      select * from TT_PHAUTHUAT_VTYT
      where
      exists (select PHAUTHUAT_ID from TT_PHAUTHUAT where TIEPNHAN_ID = '$TIEPNHAN_ID$' and TT_PHAUTHUAT_VTYT.PHAUTHUAT_ID = PHAUTHUAT_ID)
      and (CHUNGTU_ID is null or CHUNGTU_ID = 0)
    </statement>
    <statement id="DAO00079_KiemMauCuaBenhAnChuaxuat" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
      select * from TT_MAU_DANGKYMAU
      where BENHAN_ID = #BENHAN_ID# and TRANGTHAI = 'CHUAXUAT'
    </statement>
    <update id="DAO00079_UpdateDichVuThucHienCuaTiepNhan" parameterClass="System.Collections.IDictionary">
      update TT_DVYEUCAU set
      TRANGTHAI = '$TRANGTHAI$',
      NGAYCAPNHAT = '$NGAYCAPNHAT$',
      NGUOICAPNHAT_ID = '$NGUOICAPNHAT_ID$'
      where
      DVYEUCAU_ID in ($LST_DVYEUCAU_ID$)
      and TIEPNHAN_ID = '$TIEPNHAN_ID$'
      and BENHVIEN_ID = '$BENHVIEN_ID$'
      
    </update>
    <update id="DAO00079_UpdateDichVuThucHienCuaVienPhi" parameterClass="System.Collections.IDictionary">
      update TT_VIENPHI set
      DATHUCHIEN = '$DATHUCHIEN$',
      NGAYCAPNHAT = '$NGAYCAPNHAT$',
      NGUOICAPNHAT_ID = '$NGUOICAPNHAT_ID$'
      where
      REF_ID in ($LST_DVYEUCAU_ID$)
      and REF_TABLE = 'TT_DVYEUCAU'
      and TIEPNHAN_ID = '$TIEPNHAN_ID$'
      and BENHVIEN_ID = '$BENHVIEN_ID$'
    </update>
    <statement id="DAO00079_TT_PHAUTHUAT_THUCHIEN_Delete" parameterClass="System.Collections.IDictionary">
      delete from TT_PHAUTHUAT_THUCHIEN where DVYEUCAU_ID in ($LST_DVYEUCAU$)
    </statement>
    <statement id="DAO00079_TT_PHAUTHUAT_THUCHIEN_Insert" parameterClass="System.Collections.IDictionary">
      insert into TT_PHAUTHUAT_THUCHIEN
      (TIEPNHAN_ID
      , DVYEUCAU_ID
      , DICHVU_ID
      , THOIGIANBATDAU
      , THOIGIANKETTHUC
      , NGUOITHUCHIEN_ID
      , BENHVIEN_ID
      , NGAYTAO
      , NGUOITAO_ID
      , NGAYCAPNHAT
      , NGUOICAPNHAT_ID)
      values
      (#TIEPNHAN_ID#
      , #DVYEUCAU_ID#
      , #DICHVU_ID#
      , #THOIGIANBATDAU#
      , #THOIGIANKETTHUC#
      , #NGUOIPTTT_ID#
      , #BENHVIEN_ID#
      , GETDATE()
      , #NGUOICAPNHAT_ID#
      , GETDATE()
      , #NGUOICAPNHAT_ID#)
    </statement>
    <statement id="DAO00079_KiemTraNgayRavienNhoHonNgayYlenh" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
      select sum(TOTAL_DV_ROWS) as TOTAL_DV_ROWS, sum(TOTAL_YL_ROWS) as TOTAL_YL_ROWS from
      (
      select count(*) as TOTAL_DV_ROWS, 0 TOTAL_YL_ROWS from TT_DVYEUCAU
      where BENHAN_ID is not null and HUYYEUCAU = '0' and BENHAN_ID = '$BENHAN_ID$' and NGAYGIOYEUCAU > #NGAYRAVIEN#
      union
      select 0 TOTAL_DV_ROWS, count(*) as TOTAL_YL_ROWS
      from TT_NOITRU_KHAMBENH KB
      left join TT_NOITRU_TOATHUOC TT on TT.KHAMBENH_ID = KB.KHAMBENH_ID
      left join TT_NOITRU_TRATHUOC_CHITIET ttct on TT.TOATHUOC_ID = ttct.TOATHUOC_ID
      where KB.BENHAN_ID = '$BENHAN_ID$' and KB.THOIGIANKHAM > #NGAYRAVIEN#
      and tt.SOLUONG != isnull(ttct.SOLUONG,0)
      ) lst
    </statement>
    <statement id="DAO00079_KiemTraNgayRavienNhoHonNgayYlenhBHYT" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
      select sum(TOTAL_YL_BHYT_ROWS) as TOTAL_YL_BHYT_ROWS from
      (
      select count(*) as TOTAL_YL_BHYT_ROWS
      from TT_NOITRU_KHAMBENH KB
      left join TT_NOITRU_TOATHUOC TT on TT.KHAMBENH_ID = KB.KHAMBENH_ID
      left join TT_NOITRU_TRATHUOC_CHITIET ttct on TT.TOATHUOC_ID = ttct.TOATHUOC_ID
      left join TT_VIENPHI vp on vp.REF_ID = TT.TOATHUOC_ID and vp.REF_TABLE = 'TT_NOITRU_TOATHUOC'
      where KB.BENHAN_ID = '$BENHAN_ID$' and KB.THOIGIANKHAM > #NGAYRAVIEN#
      and tt.SOLUONG != isnull(ttct.SOLUONG,0) and vp.BHYT_DONGIA > 0 and isnull(vp.BHYTDONGTIEN, '0') = '0'
      ) lst
    </statement>
    <statement id="DAO00079_CheckThuocChuaXuat" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
      select TT.*
      from TT_NOITRU_TOATHUOC TT
      left join TT_NOITRU_TRATHUOC_CHITIET TT_CT on TT_CT.TOATHUOC_ID = TT.TOATHUOC_ID
      where TT.TIEPNHAN_ID = $TIEPNHAN_ID$
      and TT.BENHVIEN_ID = '$BENHVIEN_ID$'
      and TT.CHUNGTU_ID IS NULL
      and TT.SOLUONG != isnull(TT_CT.SOLUONG,0)
    </statement>
    <statement id="DAO00079_TT_NOITRU_GIUONGBENH_benhan" parameterClass="System.Collections.IDictionary" resultClass="System.Int32">
      <!--select count(*) from TT_NOITRU_GIUONGBENH where BENHAN_ID = #BENHAN_ID#-->
      select count(1)
      from TT_NOITRU_LUUTRU LT
      left join TT_NOITRU_LUUTRUCHITIET CT on CT.LUUTRU_ID = LT.LUUTRU_ID
      where LT.BENHAN_ID = $BENHAN_ID$ and LT.LUUTRU_CURRENT = '1' and CT.GIUONGBENH_ID IS NOT NULL
    </statement>
    <statement id="DAO00079_TT_NOITRU_BENHAN" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
      select * from TT_NOITRU_BENHAN where BENHAN_ID = $BENHAN_ID$
    </statement>
    <statement id="DAO00079_TT_PHIEULOCMAU" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
      select * from TT_PHIEULOCMAU where BENHAN_ID = '$BENHAN_ID$'
      <isNotEmpty prepend="and" property="LOCMAU_ID">
        LOCMAU_ID = '$LOCMAU_ID$'
      </isNotEmpty>
    </statement>
    <statement id="DAO00079_TT_PHIEULOCMAU_Delete" parameterClass="System.Collections.IDictionary">
      delete TT_PHIEULOCMAU where LOCMAU_ID = '$LOCMAU_ID$'
    </statement>
    <statement id="DAO00079_TT_PHIEULOCMAU_Add" parameterClass="System.Collections.IDictionary">
      insert into TT_PHIEULOCMAU
      (
      BENHAN_ID,
      TIEPNHAN_ID,
      CALOCMAU,
      NGAYGIOLOC,
      THOIGIANBATDAU,
      THOIGIANKETTHUC,
      MAYTHAN,
      TRUYENMAU,
      PROTEINTP,
      TOCDOBUDICH,
      CANKHO,
      CANTRUOCLOC,
      CANSAULOC,
      TOCDOBOMMAU,
      QUALOC,
      HATRUOCLOCTREN,
      HATRUOCLOCDUOI,
      HASAULOCTREN,
      HASAULOCDUOI,
      HCT,
      TONGDICHBU,
      UF,
      CHONGDONG,
      LAN,
      CHIEUCAO,
      LAMSANG,
      CHANDOAN,
      AVF,
      AVG,
      TRUOCMANG,
      SAUMANG,
      MADUOC,
      TENDUOC,
      DIENBIEN,
      CHIDINH,
      BACSIDIEUTRI_ID,
      KTVTHUCHIEN_ID,
      NGUOITAO_ID,
      NGAYTAO ,
      NGUOICAPNHAT_ID,
      NGAYCAPNHAT,
      BENHVIEN_ID
      )
      values
      (#BENHAN_ID#,
      #TIEPNHAN_ID#,
      #CALOCMAU#,
      #NGAYGIOLOC#,
      #THOIGIANBATDAU#,
      #THOIGIANKETTHUC#,
      #MAYTHAN#,
      #TRUYENMAU#,
      #PROTEINTP#,
      #TOCDOBUDICH#,
      #CANKHO#,
      #CANTRUOCLOC#,
      #CANSAULOC#,
      #TOCDOBOMMAU#,
      #QUALOC#,
      #HATRUOCLOCTREN#,
      #HATRUOCLOCDUOI#,
      #HASAULOCTREN#,
      #HASAULOCDUOI#,
      #HCT#,
      #TONGDICHBU#,
      #UF#,
      #CHONGDONG#,
      #LAN#,
      #CHIEUCAO#,
      #LAMSANG#,
      #CHANDOAN#,
      #AVF#,
      #AVG#,
      #TRUOCMANG#,
      #SAUMANG#,
      #MADUOC#,
      #TENDUOC#,
      #DIENBIEN#,
      #CHIDINH#,
      #BACSIDIEUTRI_ID#,
      #KTVTHUCHIEN_ID#,
      #NGUOITAO_ID#,
      #NGAYTAO #,
      #NGUOICAPNHAT_ID#,
      #NGAYCAPNHAT#,
      #BENHVIEN_ID#)
    </statement>
    <statement id="DAO00079_TT_PHIEULOCMAU_Update" parameterClass="System.Collections.IDictionary">
      update TT_PHIEULOCMAU set
      CALOCMAU = #CALOCMAU#,
      NGAYGIOLOC = #NGAYGIOLOC#,
      THOIGIANBATDAU = #THOIGIANBATDAU#,
      THOIGIANKETTHUC = #THOIGIANKETTHUC#,
      MAYTHAN = #MAYTHAN#,
      TRUYENMAU = #TRUYENMAU#,
      PROTEINTP = #PROTEINTP#,
      TOCDOBUDICH = #TOCDOBUDICH#,
      CANKHO = #CANKHO#,
      CANTRUOCLOC = #CANTRUOCLOC#,
      CANSAULOC = #CANSAULOC#,
      TOCDOBOMMAU = #TOCDOBOMMAU#,
      QUALOC = #QUALOC#,
      HATRUOCLOCTREN = #HATRUOCLOCTREN#,
      HATRUOCLOCDUOI = #HATRUOCLOCDUOI#,
      HASAULOCTREN = #HASAULOCTREN#,
      HASAULOCDUOI = #HASAULOCDUOI#,
      HCT = #HCT#,
      TONGDICHBU = #TONGDICHBU#,
      UF = #UF#,
      CHONGDONG = #CHONGDONG#,
      LAN = #LAN#,
      CHIEUCAO = #CHIEUCAO#,
      LAMSANG = #LAMSANG#,
      CHANDOAN = #CHANDOAN#,
      AVF = #AVF#,
      AVG = #AVG#,
      TRUOCMANG = #TRUOCMANG#,
      SAUMANG = #SAUMANG#,
      MADUOC = #MADUOC#,
      TENDUOC = #TENDUOC#,
      DIENBIEN = #DIENBIEN#,
      CHIDINH = #CHIDINH#,
      BACSIDIEUTRI_ID = #BACSIDIEUTRI_ID#,
      KTVTHUCHIEN_ID = #KTVTHUCHIEN_ID#,
      NGUOITAO_ID = #NGUOITAO_ID#,
      NGAYTAO = #NGAYTAO#,
      NGUOICAPNHAT_ID = #NGUOICAPNHAT_ID#,
      NGAYCAPNHAT = #NGAYCAPNHAT#,
      BENHVIEN_ID = #BENHVIEN_ID#
      where LOCMAU_ID = '$LOCMAU_ID$'
    </statement>
    <statement id="DAO00079_GetMayLocMau" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
      select * from LST_DICTIONARY where DICTIONARY_TYPE_CODE = 'MayThanLocMau'
    </statement>
    <statement id="DAO00079_GetChiDinh" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
      select c.TENDICHVU
      from TT_DVYEUCAU a
      join TT_NOITRU_BENHAN b on a.BENHAN_ID = b.BENHAN_ID
      join TM_DICHVU c on c.DICHVU_ID = a.DICHVU_ID
      join TM_NHOMDICHVU d on d.NHOMDICHVU_ID = c.NHOMDICHVU_ID
      where LEFT(d.MANHOMDICHVU,2) in ('01','03')
      and b.BENHAN_ID = '$BENHAN_ID$'
    </statement>
</statements>
</sqlMap>