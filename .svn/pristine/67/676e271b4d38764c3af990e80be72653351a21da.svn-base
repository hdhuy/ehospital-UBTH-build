<?xml version="1.0" encoding="utf-8" ?>
<!--iBatis Map File-->
<sqlMap namespace="eHospital" xmlns="http://ibatis.apache.org/mapping" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
  <statements>
    <!--Revision:0,d0c02d55591882830b2173548e8d6dc2-->
    <statement id="DAO00012_GetList" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
      select
      DICTIONARY_ID,
      DICTIONARY_CODE,
      DICTIONARY_NAME,
      ATTRIBUTE1,
      ATTRIBUTE2,
      DICTIONARY_NAME_EN,
      DICTIONARY_TYPE_CODE
      from LST_DICTIONARY
      where LST_DICTIONARY.Enabled = '1'
      <!--<dynamic prepend="where">
                <isParameterPresent>-->
      <!--where BENHVIEN_ID = '$BENHVIEN_ID$'-->
      <isPropertyAvailable prepend="AND" property="DICTIONARY_TYPE_CODE">
        LST_DICTIONARY.DICTIONARY_TYPE_CODE = '$DICTIONARY_TYPE_CODE$'
      </isPropertyAvailable>
      <isPropertyAvailable prepend="AND" property="DICTIONARY_TYPE_ID">
        LST_DICTIONARY.DICTIONARY_TYPE_ID = '$DICTIONARY_TYPE_ID$'
      </isPropertyAvailable>
      <isPropertyAvailable prepend="AND" property="Attribute1">
        LST_DICTIONARY.Attribute1 = '$Attribute1$'
      </isPropertyAvailable>
      <isPropertyAvailable prepend="AND" property="LST_DICTIONARY_TYPE_CODE">
        LST_DICTIONARY.DICTIONARY_TYPE_CODE in ($LST_DICTIONARY_TYPE_CODE$)
      </isPropertyAvailable>
      <!--<isPropertyAvailable prepend="AND" property="Enabled">
        LST_DICTIONARY.Enabled = '$Enabled$'
      </isPropertyAvailable>-->
      <!--</isParameterPresent>
            </dynamic>-->
      order by LST_DICTIONARY.IDX
    </statement>
    <!--Revision:0,e992bd61da83c3d75485a42461ecaab2-->
    <statement id="DAO00012_GetPhongBenhDicID" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
      select DICTIONARY_ID
      from LST_DICTIONARY
      where
      DICTIONARY_CODE = '$DICTIONARY_CODE$'
    </statement>
    <statement id="DAO00012_GetUserLogin" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
      select * from dbo.TBL_USERLOG
      <dynamic prepend="where">
        <isParameterPresent>
          <isNotEmpty prepend="and" property="USERID">
            USERID = $USERID$
          </isNotEmpty>
          <isNotEmpty prepend="and" property="FROMDATE">
            CONVERT(DATE,CREATEDDATE) &gt;= CONVERT(DATE,'$FROMDATE$')
          </isNotEmpty>
          <isNotEmpty prepend="and" property="TODATE">
            CONVERT(DATE,CREATEDDATE) &lt;= CONVERT(DATE,'$TODATE$')
        </isNotEmpty>
        </isParameterPresent>
      </dynamic>
      ORDER BY CREATEDDATE
    </statement>
    <statement id="DAO00012_GetLoaiTCLS" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
      select DICTIONARY_ID, DICTIONARY_CODE, DICTIONARY_NAME, cast('0' as Bit) CHON
      from LST_DICTIONARY      
      where DICTIONARY_TYPE_CODE = 'KHAMBENH_LOAI_TRIEUCHUNGLS'
      order by LST_DICTIONARY.IDX
    </statement>
    <statement id="DAO00012_GetAllTCLS" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
      select MALOAITRIEUCHUNG DICTIONARY_TYPE_CODE, MALOAITRIEUCHUNG DICTIONARY_CODE,
      TENTRIEUCHUNG DICTIONARY_NAME from TM_TRIEUCHUNGLS
    </statement>
    <statement id="DAO00012_GetDanhsachBNNoitru" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
      select * from
      (
      select *, COUNT(*) OVER() as TOTALROWS,  ROW_NUMBER() OVER(order by lst.SOBENHAN asc) as ROWNUMBER
      from
      (select distinct cast('0' as bit) CHON, ntba.*,
      bn.TENBENHNHAN, ISNULL(bn.NGAYSINH, bn.NAMSINH) NGAYSINH, bn.DIACHITHUONGTRU, bn.MAYTE,
      tn.SOBHYT SOTHE,
      dt.TENDOITUONG DOITUONG, nv.TENNHANVIEN BACSICHIDINH,
      (select top 1 LUUTRU_ID from TT_NOITRU_LUUTRU where BENHAN_ID = ntba.BENHAN_ID order by LUUTRU_ID desc) LUUTRU_ID
      from TT_NOITRU_BENHAN ntba
      left join TT_TIEPNHAN tn on tn.TIEPNHAN_ID = ntba.TIEPNHAN_ID
      left join TT_BENHNHAN bn on bn.BENHNHAN_ID = tn.BENHNHAN_ID
      left join TM_DOITUONG dt on dt.DOITUONG_ID = tn.DOITUONG_ID
      left join TM_NHANVIEN nv on nv.NHANVIEN_ID = ntba.BACSIDIEUTRI_ID
      where
      ntba.TRANGTHAI = 'DANGDIEUTRI' and ntba.KHOACHUYENDEN_ID = '$KHOACHUYENDEN_ID$'
      <isNotEmpty prepend="and" property="TUNGAY">
        ntba.NGAYVAOVIEN &#62;&#61; '$TUNGAY$'
    </isNotEmpty>
    <isNotEmpty prepend="and" property="DENNGAY">
      ntba.NGAYVAOVIEN &#60;&#61; '$DENNGAY$'
    </isNotEmpty>
      <isNotEmpty prepend="and" property="BACSIDIEUTRI_ID">
        ntba.BACSIDIEUTRI_ID = '$BACSIDIEUTRI_ID$'
      </isNotEmpty>
      <isNotEmpty prepend="and" property="MABENHNHAN">
        <!--B.SOTIEPNHAN = '$MABENHNHAN$'-->
        (bn.TENBENHNHAN like '%' + #MABENHNHAN# + '%' OR bn.MAYTE like '%' + #MABENHNHAN# + '%' OR ntba.SOBENHAN like '%' + #MABENHNHAN# + '%')
      </isNotEmpty>
      ) lst
      ) ds
      <isNotEmpty prepend="" property="FROMROW">
        where
        ds.ROWNUMBER between $FROMROW$ and $TOROW$
      </isNotEmpty>
    </statement>
  </statements>
</sqlMap>
