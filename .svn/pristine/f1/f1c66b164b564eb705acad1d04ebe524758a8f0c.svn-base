<?xml version="1.0" encoding="utf-8" ?>
<!--============================================================================
//	CAUTION: This file is generated by IBatisNetGen.3.SQLMap.cst at 11/11/2015 9:30:18 AM
//				Any manual editing will be lost in re-generation.
//===========================================================================-->
<sqlMap namespace="eHospital" xmlns="http://ibatis.apache.org/mapping" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
  <statements>
    <statement id="DAO00227_KiemTraLichMoDaTonTai" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
      SELECT LICHMO_ID FROM TT_NOITRU_XEPLICHMO WHERE DVYEUCAU_ID='$DVYEUCAU_ID$' AND BENHVIEN_ID='$BENHVIEN_ID$'
    </statement>
    <statement id="DAO00227_KiemTraTonTaiTuongTrinh" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
      SELECT PHAUTHUAT_YEUCAU_ID FROM TT_PHAUTHUAT_YEUCAU PTYC WHERE DVYEUCAU_ID='$DVYEUCAU_ID$' AND BENHVIEN_ID='$BENHVIEN_ID$'
    </statement>
    <statement id="DAO00227_LayThongTinXepLichMo_Schedule" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
  SELECT
      SC.[SCHEDULE_ID]
      ,SC.[SUBJECT]
      ,SC.[STARTDATE] 
      ,SC.[ENDDATE] 
      ,SC.[ALLDAY]
      ,SC.[DESCRIPTION]
      ,SC.[LICHMO_ID]
      ,SC.[BENHVIEN_ID]
      ,SC.[NGAYTAO]
      ,SC.[NGUOITAO_ID]
      ,SC.[NGAYCAPNHAT]
      ,SC.[NGUOICAPNHAT_ID]
      ,L.PHONGBAN_ID PHONGMO_ID
	    ,YC.BACSICHIDINH_ID NGUOICHIDINH_ID
	    ,YC.NGAYGIOYEUCAU NGAYCHIDINH
      ,SC.NGAYGHINHAN
	    ,SC.NGUOIGHINHAN_ID
      FROM [TT_NOITRU_XEPLICHMO_SCHEDULE] SC
      INNER JOIN TT_NOITRU_XEPLICHMO L ON SC.LICHMO_ID=L.LICHMO_ID
	     LEFT JOIN TT_DVYEUCAU YC ON L.DVYEUCAU_ID= YC.DVYEUCAU_ID
      WHERE SC.LICHMO_ID='$LICHMO_ID$'
    </statement>
    <statement id="DAO00227_LayThongTinXepLichMo_Ekip" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
      SELECT E.[XEPLICHMO_EKIPMO_ID]
      ,E.[LICHMO_ID]
      ,E.[NHANVIEN_ID]
      ,E.[VAITRO_ID]
      ,E.[BENHVIEN_ID]
      ,E.[NGAYTAO]
      ,E.[NGUOITAO_ID]
      ,E.[NGAYCAPNHAT]
      ,E.[NGUOICAPNHAT_ID]
      ,NV.TENNHANVIEN NHANVIEN
      ,VAITRO.DICTIONARY_NAME VAITRO
      FROM [TT_NOITRU_XEPLICHMO_EKIPMO] E
      INNER JOIN TM_NHANVIEN NV ON E.NHANVIEN_ID=NV.NHANVIEN_ID
      LEFT JOIN LST_DICTIONARY VAITRO ON E.VAITRO_ID=VAITRO.DICTIONARY_ID
      where LICHMO_ID='$LICHMO_ID$'
    </statement>
    <statement id="DAO00227_LayThongTinXepLichMo_DungCu" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
      SELECT DC.[XEPLICHMO_DUNGCUMO_ID]
      ,DC.[LICHMO_ID]
      ,DC.[DUNGCU_ID]
      ,DC.[SOLUONG]
      ,DC.[TRUOCMO]
      ,DC.[TRONGMO]
      ,DC.[SAUMO]
      ,DC.[BENHVIEN_ID]
      ,DC.[NGAYTAO]
      ,DC.[NGUOITAO_ID]
      ,DC.[NGAYCAPNHAT]
      ,DC.[NGUOICAPNHAT_ID]
      ,DUNG.DICTIONARY_NAME TENDUNGCU
      FROM [TT_NOITRU_XEPLICHMO_DUNGCUMO] DC
      INNER JOIN LST_DICTIONARY DUNG ON DC.DUNGCU_ID=DUNG.DICTIONARY_ID
      where LICHMO_ID='$LICHMO_ID$'
    </statement>
    <statement id="DAO00227_GetAppointments" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
      SELECT LM.[LICHMO_ID]
      ,[BENHAN_ID]
      ,[DVYEUCAU_ID]
      ,[NGAYMO]
      ,[THOIGIANMO]
      ,[CHANDOANVAPHAUTHUAT]
      ,[MAUDUTRU]
      ,[PPVOCAM_ID]
      ,LM.[PHONGBAN_ID] AS PHONGMO_ID
      ,lm.[BENHNHAN_ID]
      ,[TIEPNHAN_ID]
      ,T.STARTDATE THOIGIANHEN_BATDAU
      ,T.STARTDATE NGAYHEN_BATDAU
      ,T.ENDDATE THOIGIANHEN_KETTHUC
      ,T.ENDDATE NGAYHEN_KETTHUC
      ,T.STARTDATE THOIGIANBATDAU
      ,T.ENDDATE THOIGIANKETTHUC
      ,P.TENPHONGBAN TENPHONGMO
      ,bn.TENBENHNHAN
      ,T.DESCRIPTION GHICHU
      ,T.SUBJECT TIEUDE
      FROM [TT_NOITRU_XEPLICHMO] LM
      INNER JOIN TT_NOITRU_XEPLICHMO_SCHEDULE T ON LM.LICHMO_ID = T.LICHMO_ID
      INNER JOIN TM_PHONGBAN P ON LM.PHONGBAN_ID=P.PHONGBAN_ID
      inner join TT_BENHNHAN bn on lm.BENHNHAN_ID=bn.BENHNHAN_ID
      <dynamic prepend="where">
        <isParameterPresent>
          <isNotEmpty prepend="and" property="DANHSACHPHONGMO">
          P.PHONGBAN_ID IN
          <iterate open="(" close=")" conjunction=",  " property="DANHSACHPHONGMO" >#DANHSACHPHONGMO[]#</iterate>
        </isNotEmpty>
        </isParameterPresent>
      </dynamic>
    </statement>
    <statement id="DAO00227_GetList" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
      SELECT PHONGBAN_ID,MAPHONGBAN,TENPHONGBAN FROM TM_PHONGBAN P
      INNER JOIN LST_DICTIONARY LOAI ON P.LOAIPHONGBENH_ID= LOAI.DICTIONARY_ID
      WHERE LOAI.DICTIONARY_TYPE_CODE = '$DICTIONARY_TYPE_CODE$' and DICTIONARY_CODE='$DICTIONARY_CODE$' AND P.TAMNGUNG=0

    </statement>
    <!--<statement id="DAO00227_LoadDichVuPhauThuat_TheoMaTiepNhan" resultClass="DataObject" parameterClass="System.Collections.IDictionary">
      SELECT YC.SOPHIEUYEUCAU, YC.DVYEUCAU_ID,DM.TENDICHVU,YC.NGAYGIOYEUCAU NGAYCHIDINH,YC.BACSICHIDINH_ID NGUOIYEUCAU_ID
      FROM TT_DVYEUCAU YC
      LEFT JOIN  TM_DICHVU DM ON YC.DICHVU_ID= DM.DICHVU_ID
      LEFT JOIN TM_NHOMDICHVU NHOM ON DM.NHOMDICHVU_ID=NHOM.NHOMDICHVU_ID
      where yc.TIEPNHAN_ID='$TIEPNHAN_ID$'
    </statement>-->
    <statement id="DAO00227_LoadDichVuPhauThuat_TheoMaTiepNhan" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
      SELECT DISTINCT YC.DVYEUCAU_ID, SOPHIEUYEUCAU, NOITHUCHIEN_ID,DM.TENDICHVU,NGAYGIOYEUCAU NGAYCHIDINH,BACSICHIDINH_ID NGUOICHIDINH_ID
      FROM
      TT_DVYEUCAU YC
      LEFT JOIN  TM_DICHVU DM ON YC.DICHVU_ID= DM.DICHVU_ID
      left join TM_NHOMDICHVU C on C.NHOMDICHVU_ID = DM.NHOMDICHVU_ID
      where
      TIEPNHAN_ID = '$TIEPNHAN_ID$' and LEFT(C.MANHOMDICHVU, 2) in ('05', '06')
      <!--<dynamic>
        <isParameterPresent>
          <isNotEmpty prepend="and" property="LISTDICHVU_ID">
            <iterate open=" YC.DICHVU_ID in (" close=")" conjunction=",  " property="LISTDICHVU_ID">#LISTDICHVU_ID[]#</iterate>
          </isNotEmpty>
        </isParameterPresent>
      </dynamic>-->
    </statement>
    <insert id="DAO00227_Add" parameterClass="System.Collections.IDictionary" resultClass="System.Int64">
      INSERT INTO [TT_NOITRU_XEPLICHMO]
      ([BENHAN_ID]
      ,[DVYEUCAU_ID]
      ,[NGAYMO]
      ,[THOIGIANMO]
      ,[CHANDOANVAPHAUTHUAT]
      ,[MAUDUTRU]
      ,[PPVOCAM_ID]
      ,[PHONGBAN_ID]
      ,[BENHNHAN_ID]
      ,[TIEPNHAN_ID]
      ,[BENHVIEN_ID]
      ,[NGAYTAO]
      ,[NGUOITAO_ID]
      ,[NGAYCAPNHAT]
      ,[NGUOICAPNHAT_ID])
      VALUES
      (
      #BENHAN_ID#
      ,#DVYEUCAU_ID#
      ,#NGAYMO#
      ,#THOIGIANMO#
      ,#CHANDOANVAPHAUTHUAT#
      ,#MAUDUTRU#
      ,#PPVOCAM_ID#
      ,#PHONGMO_ID#
      ,#BENHNHAN_ID#
      ,#TIEPNHAN_ID#
      ,#BENHVIEN_ID#
      ,#NGAYTAO#
      ,#NGUOITAO_ID#
      ,#NGAYCAPNHAT#
      ,#NGUOICAPNHAT_ID#
      )

      <selectKey resultClass="System.Int64" type="post" >
        SELECT @@IDENTITY as value
      </selectKey>
    </insert>

    <insert id="DAO00227_Add_Ekip" parameterClass="System.Collections.IDictionary" resultClass="System.Int64">
      INSERT INTO [TT_NOITRU_XEPLICHMO_EKIPMO]
      ([LICHMO_ID]
      ,[NHANVIEN_ID]
      ,[VAITRO_ID]
      ,[BENHVIEN_ID]
      ,[NGAYTAO]
      ,[NGUOITAO_ID]
      ,[NGAYCAPNHAT]
      ,[NGUOICAPNHAT_ID])
      VALUES
      (
      #LICHMO_ID#
      ,#NHANVIEN_ID#
      ,#VAITRO_ID#
      ,#BENHVIEN_ID#
      ,#NGAYTAO#
      ,#NGUOITAO_ID#
      ,#NGAYCAPNHAT#
      ,#NGUOICAPNHAT_ID#
      )
      <selectKey resultClass="System.Int64" type="post" >
        SELECT @@IDENTITY as value
      </selectKey>
    </insert>
    <insert id="DAO00227_Add_SCHEDULE" parameterClass="System.Collections.IDictionary" resultClass="System.Int64">
      INSERT INTO [TT_NOITRU_XEPLICHMO_SCHEDULE]
      ([SUBJECT]
      ,[STARTDATE]
      ,[ENDDATE]
      ,[ALLDAY]
      ,[DESCRIPTION]
      ,[LICHMO_ID]
      ,[BENHVIEN_ID]
      ,[NGAYTAO]
      ,[NGUOITAO_ID]
      ,[NGAYCAPNHAT]
      ,[NGUOICAPNHAT_ID]
      ,[NGAYGHINHAN]
      ,[NGUOIGHINHAN_ID]
      )
      VALUES
      (#SUBJECT#
      ,#STARTDATE#
      ,#ENDDATE#
      ,#ALLDAY#
      ,#DESCRIPTION#
      ,#LICHMO_ID#
      ,#BENHVIEN_ID#
      ,#NGAYTAO#
      ,#NGUOITAO_ID#
      ,#NGAYCAPNHAT#
      ,#NGUOICAPNHAT_ID#
      ,#NGAYGHINHAN#
      ,#NGUOIGHINHAN_ID#
      )
      <selectKey resultClass="System.Int64" type="post" >
        SELECT @@IDENTITY as value
      </selectKey>
    </insert>
    <insert id="DAO00227_Add_DUNGCU" parameterClass="System.Collections.IDictionary" resultClass="System.Int64">
      INSERT INTO [TT_NOITRU_XEPLICHMO_DUNGCUMO]
      ([LICHMO_ID]
      ,[DUNGCU_ID]
      ,[SOLUONG]
      ,[TRUOCMO]
      ,[TRONGMO]
      ,[SAUMO]
      ,[BENHVIEN_ID]
      ,[NGAYTAO]
      ,[NGUOITAO_ID]
      ,[NGAYCAPNHAT]
      ,[NGUOICAPNHAT_ID])
      VALUES
      (
      #LICHMO_ID#
      ,#DUNGCU_ID#
      ,#SOLUONG#
      ,#TRUOCMO#
      ,#TRONGMO#
      ,#SAUMO#
      ,#BENHVIEN_ID#
      ,#NGAYTAO#
      ,#NGUOITAO_ID#
      ,#NGAYCAPNHAT#
      ,#NGUOICAPNHAT_ID#)
      <selectKey resultClass="System.Int64" type="post" >
        SELECT @@IDENTITY as value
      </selectKey>
    </insert>
    <update id="DAO00227_Update" parameterClass="System.Collections.IDictionary">
      UPDATE [TT_NOITRU_XEPLICHMO]
      SET
      [DVYEUCAU_ID] = #DVYEUCAU_ID#
      ,[CHANDOANVAPHAUTHUAT] = #CHANDOANVAPHAUTHUAT#
      ,[MAUDUTRU] = #MAUDUTRU#
      ,[PPVOCAM_ID] =#PPVOCAM_ID#
      ,[NGAYCAPNHAT] = #NGAYCAPNHAT#
      ,[NGUOICAPNHAT_ID] = #NGUOICAPNHAT_ID#
      ,[BENHNHAN_ID] = #BENHNHAN_ID#
      ,[TIEPNHAN_ID] = #TIEPNHAN_ID#
      WHERE LICHMO_ID=#LICHMO_ID#
    </update>
    <update id="DAO00227_Update_SCHEDULE" parameterClass="System.Collections.IDictionary">
      UPDATE [TT_NOITRU_XEPLICHMO_SCHEDULE]
      SET [SUBJECT] = #SUBJECT#
      ,[STARTDATE] =#STARTDATE#
      ,[ENDDATE] = #ENDDATE#
      ,[ALLDAY] = #ALLDAY#
      ,[DESCRIPTION] = #DESCRIPTION#
      ,[NGAYCAPNHAT] = #NGAYCAPNHAT#
      ,[NGUOICAPNHAT_ID] = #NGUOICAPNHAT_ID#
      ,[NGAYGHINHAN] = #NGAYGHINHAN#
      ,[NGUOIGHINHAN_ID] = #NGUOIGHINHAN_ID#
      WHERE SCHEDULE_ID=#SCHEDULE_ID#
    </update>
    <update id="DAO00227_SaveAppointment" parameterClass="System.Collections.IDictionary">
      UPDATE [TT_NOITRU_XEPLICHMO_SCHEDULE]
      SET
      [STARTDATE] =#THOIGIANHEN_BATDAU#
      ,[ENDDATE] = #THOIGIANHEN_KETTHUC#
      ,[NGAYCAPNHAT] = #NGAYDOI#
      ,[NGUOICAPNHAT_ID] = #NGUOIDOI#
      WHERE LICHMO_ID=#LICHMO_ID#
      UPDATE [TT_NOITRU_XEPLICHMO]
      SET
      [PHONGBAN_ID]=#PHONGMO_ID#
      ,[NGAYCAPNHAT] = #NGAYDOI#
      ,[NGUOICAPNHAT_ID] = #NGUOIDOI#
      WHERE LICHMO_ID=#LICHMO_ID#

    </update>
    <update id="DAO00227_Update_EKIP" parameterClass="System.Collections.IDictionary">
      UPDATE [TT_NOITRU_XEPLICHMO_EKIPMO]
      SET
      [NHANVIEN_ID] = #NHANVIEN_ID#
      ,[VAITRO_ID] = #VAITRO_ID#
      ,[NGAYCAPNHAT] = #NGAYCAPNHAT#
      ,[NGUOICAPNHAT_ID] = #NGUOICAPNHAT_ID#
      WHERE XEPLICHMO_EKIPMO_ID=#XEPLICHMO_EKIPMO_ID#
    </update>
    <update id="DAO00227_Update_DUNGCU" parameterClass="System.Collections.IDictionary">
      UPDATE [TT_NOITRU_XEPLICHMO_DUNGCUMO]
      SET
      [DUNGCU_ID] = #DUNGCU_ID#
      ,[SOLUONG] = #SOLUONG#
      ,[TRUOCMO] = #TRUOCMO#
      ,[TRONGMO] = #TRONGMO#
      ,[SAUMO] = #SAUMO#
      ,[NGAYCAPNHAT] = #NGAYCAPNHAT#
      ,[NGUOICAPNHAT_ID] = #NGUOICAPNHAT_ID#
      WHERE XEPLICHMO_DUNGCUMO_ID=#XEPLICHMO_DUNGCUMO_ID#
    </update>
    <statement id="DAO00227_Delete" parameterClass="System.Collections.IDictionary" resultClass="System.Int32">
    
    DELETE FROM [TT_NOITRU_XEPLICHMO_SCHEDULE] WHERE LICHMO_ID='$LICHMO_ID$'
      DELETE FROM [TT_NOITRU_XEPLICHMO_EKIPMO] WHERE LICHMO_ID='$LICHMO_ID$'
      DELETE FROM [TT_NOITRU_XEPLICHMO_DUNGCUMO] WHERE LICHMO_ID='$LICHMO_ID$'
      DELETE FROM [TT_NOITRU_XEPLICHMO] WHERE LICHMO_ID='$LICHMO_ID$'
    </statement>
    <statement id="DAO00227_Delete_Detail_Ekips" parameterClass="System.Collections.IDictionary" resultClass="System.Int32">
      DELETE FROM [TT_NOITRU_XEPLICHMO_EKIPMO] WHERE XEPLICHMO_EKIPMO_ID='$XEPLICHMO_EKIPMO_ID$'
    </statement>
    <statement id="DAO00227_Delete_Detail_DungCu" parameterClass="System.Collections.IDictionary" resultClass="System.Int32">
      DELETE FROM [TT_NOITRU_XEPLICHMO_DUNGCUMO] WHERE XEPLICHMO_DUNGCUMO_ID='$XEPLICHMO_DUNGCUMO_ID$'
    </statement>
     <statement id="DAO00227_LayThongTinXepLichMo" resultClass="DataObject" parameterClass="System.Collections.IDictionary">
       SELECT L.[LICHMO_ID]
       ,L.[BENHAN_ID]
       ,L.[DVYEUCAU_ID]
       ,L.[CHANDOANVAPHAUTHUAT]
       ,L.[MAUDUTRU]
       ,L.[PPVOCAM_ID]
       ,L.[TIEPNHAN_ID]
       ,L.[BENHVIEN_ID]
       ,L.[NGAYTAO]
       ,L.[NGUOITAO_ID]
       ,BA.SOBENHAN
       ,BN.MAYTE
       FROM TT_NOITRU_XEPLICHMO L
       LEFT JOIN TT_NOITRU_BENHAN  BA ON L.BENHAN_ID=BA.BENHAN_ID
       INNER JOIN TT_BENHNHAN BN ON L.BENHNHAN_ID=BN.BENHNHAN_ID
       WHERE L.LICHMO_ID='$LICHMO_ID$'
     </statement>
    <!--<statement id="DAO00227_GetCountList" resultClass="DataObject" parameterClass="System.Collections.IDictionary">
      SELECT count(*) as TOTALROWS
      FROM
      (
      SELECT  ROW_NUMBER() OVER(order by isnull(dv.SOTHUTU,'999999999')) as ROWNUMBER,        bn.MAYTE, bn.TENBENHNHAN, bn.NAMSINH,
      bn.NGAYSINH as TUOI, bn.NGAYSINH as NGAYSINH, bn.DIACHILIENLAC as DIACHI, bn.GIOITINH,        tn.DOITUONG_ID, tn.THOIGIANTIEPNHAN, tn.BENHNHAN_ID, tn.TIEPNHAN_ID,
      tn.TRAITUYEN, tn.SOTIEPNHAN,        dv.DICHVU_ID, dv.NOITHUCHIEN_ID, isnull(dv.NGAYTAO, dv.NGAYCAPNHAT) as THOIGIANDKDICHVU,        dv.KHAN, dv.NOIYEUCAU_ID,
      dv.NGAYGIOYEUCAU, dv.BACSICHIDINH_ID,BA.SOBENHAN,        tn.NOIGIOITHIEU_ID,        dv.DVYEUCAU_ID, dv.MARIS, dv.TRANGTHAI as TRANGTHAICODE, B.TENNHOMDICHVU, dv.SOPHIEUYEUCAU, dv.KHAMBENH_NGOAITRU_ID
      , B.MANHOMDICHVU as MANHOMDICHVUCHITIET, tn.TRANGTHAI as TRANGTHAI_TIEPNHAN,TN.SUDUNG_BHTN,BAOLANH_VIENPHI
      FROM TT_DVYEUCAU DV
      INNER JOIN TT_TIEPNHAN TN ON TN.TIEPNHAN_ID=DV.TIEPNHAN_ID
      join TT_BENHNHAN bn on tn.BENHNHAN_ID = bn.BENHNHAN_ID
      INNER join TM_DICHVU A on A.DICHVU_ID = dv.DICHVU_ID
      INNER join TM_NHOMDICHVU B on B.NHOMDICHVU_ID = A.NHOMDICHVU_ID
      INNER JOIN TT_VIENPHI VP ON VP.TIEPNHAN_ID=TN.TIEPNHAN_ID AND VP.DICHVU_ID=DV.DICHVU_ID AND VP.REF_ID= DV.DVYEUCAU_ID
      LEFT JOIN TT_NOITRU_BENHAN BA ON TN.TIEPNHAN_ID=BA.TIEPNHAN_ID
      <isNotEmpty prepend="" property="CHITIET_KHAMTIENME">
        <isEqual prepend="" property="CHITIET_KHAMTIENME" compareValue="True">
          LEFT JOIN ( SELECT KHAMTIENME_ID,DVYEUCAU_ID, NGAYTHUCHIEN , NOITHUCHIEN_ID,NGUOITAO_ID
          FROM  TT_NOITRU_KHAMTIENME M WHERE M.BENHVIEN_ID = '$BENHVIEN_ID$'
          ) TM ON DV.DVYEUCAU_ID=TM.DVYEUCAU_ID
        </isEqual>
      </isNotEmpty>
      <isNotEmpty prepend="" property="CHITIET_KHAMGAYME">
        <isEqual prepend="" property="CHITIET_KHAMGAYME" compareValue="True">
          LEFT JOIN ( SELECT KHAMGAYME_ID,DVYEUCAU_ID, NGAYTHUCHIEN , NOITHUCHIEN_ID,NGUOITAO_ID
          FROM  TT_KHAMGAYME M WHERE M.BENHVIEN_ID = '$BENHVIEN_ID$'
          ) GM ON DV.DVYEUCAU_ID=GM.DVYEUCAU_ID
        </isEqual>
      </isNotEmpty>
      WHERE      dv.DICHVU_ID IS NOT NULL
      and tn.BENHVIEN_ID = '$BENHVIEN_ID$'
      and HUYYEUCAU = 0
      and dv.NGAYHENCLS is NULL
      <isNotEmpty prepend="and" property="MADICHVU">
        A.MADICHVU = '$MADICHVU$'
      </isNotEmpty>
      <isNotEmpty prepend="and" property="TUNGAY">
        dv.NGAYYEUCAU &#62;&#61; '$TUNGAY$'
      </isNotEmpty>
      <isNotEmpty prepend="and" property="DENNGAY">
        dv.NGAYYEUCAU &#60;&#61; '$DENNGAY$'
      </isNotEmpty>
      <isNotEmpty prepend="and" property="NOIYEUCAU_ID">
        dv.NOIYEUCAU_ID = '$NOIYEUCAU_ID$'
      </isNotEmpty>
      <isNotEmpty prepend="" property="CHITIET_KHAMGAYME">
        <isEqual prepend="" property="CHITIET_KHAMGAYME" compareValue="True">
          <isEqual prepend="AND" property="DAKHAMGAYME" compareValue="True">
            (GM.KHAMGAYME_ID IS NOT NULL) and Left(B.MANHOMDICHVU,2) IN ('05','06')
          </isEqual>
          <isEqual prepend="AND" property="DAKHAMGAYME" compareValue="False">
            (GM.KHAMGAYME_ID IS NULL ) and Left(B.MANHOMDICHVU,2) IN ('05','06')
          </isEqual>
        </isEqual>
      </isNotEmpty>
      <isNotEmpty prepend="" property="CHITIET_KHAMTIENME">
        <isEqual prepend="" property="CHITIET_KHAMTIENME" compareValue="True">
          <isEqual prepend="AND" property="DAKHAMTIENME" compareValue="True">
            (TM.KHAMTIENME_ID IS NOT NULL)
          </isEqual>
          <isEqual prepend="AND" property="DAKHAMTIENME" compareValue="False">
            (TM.KHAMTIENME_ID IS NULL)
          </isEqual>
        </isEqual>
      </isNotEmpty>
      <isNotEmpty prepend="and" property="NOITHUCHIEN_ID">
        dv.NOITHUCHIEN_ID = '$NOITHUCHIEN_ID$'
      </isNotEmpty>
      <isNotEmpty prepend="and" property="TENBENHNHAN">
        (bn.TENBENHNHAN like '%$TENBENHNHAN$%' or bn.MAYTE like '%$TENBENHNHAN$%')
      </isNotEmpty>
      )AS T WHERE NOT EXISTS (SELECT * FROM  TT_VIENPHI VP  WHERE T.TIEPNHAN_ID=VP.TIEPNHAN_ID AND  T.TRANGTHAI_TIEPNHAN NOT IN('CAPCUU','NOITRU') AND  (isnull(SUDUNG_BHTN,'0') !='1'  )and (isnull(BAOLANH_VIENPHI,'0') !='1') AND VP.DATHANHTOAN=0)
    </statement>-->
    <!--<statement id="DAO00227_GetList_Kham" resultClass="DataObject" parameterClass="System.Collections.IDictionary">

      SELECT *
      FROM
      (
      SELECT  ROW_NUMBER() OVER(order by isnull(dv.SOTHUTU,'999999999')) as ROWNUMBER,        bn.MAYTE, bn.TENBENHNHAN, bn.NAMSINH,
      bn.NGAYSINH as TUOI, bn.NGAYSINH as NGAYSINH, bn.DIACHILIENLAC as DIACHI, bn.GIOITINH,        tn.DOITUONG_ID, tn.THOIGIANTIEPNHAN, tn.BENHNHAN_ID, tn.TIEPNHAN_ID,
      tn.TRAITUYEN, tn.SOTIEPNHAN,        dv.DICHVU_ID, dv.NOITHUCHIEN_ID, isnull(dv.NGAYTAO, dv.NGAYCAPNHAT) as THOIGIANDKDICHVU,        dv.KHAN, dv.NOIYEUCAU_ID,
      dv.NGAYGIOYEUCAU, dv.BACSICHIDINH_ID,BA.SOBENHAN,        tn.NOIGIOITHIEU_ID,        dv.DVYEUCAU_ID, dv.MARIS, dv.TRANGTHAI as TRANGTHAICODE, B.TENNHOMDICHVU, dv.SOPHIEUYEUCAU, dv.KHAMBENH_NGOAITRU_ID
      , B.MANHOMDICHVU as MANHOMDICHVUCHITIET, tn.TRANGTHAI as TRANGTHAI_TIEPNHAN,TN.SUDUNG_BHTN,BAOLANH_VIENPHI,DV.NGUOIGIOITHIEU_ID
      <isNotEmpty prepend="" property="CHITIET_KHAMGAYME">
        <isEqual prepend="," property="CHITIET_KHAMGAYME" compareValue="True">
          GM.NGAYTHUCHIEN NGAYGIOTHUCHIEN, GM.NOITHUCHIEN_ID NOITHUCHIENTIENME_ID ,GM.NGUOITAO_ID NGUOITHUCHIENTIENME_ID
        </isEqual>
      </isNotEmpty>
      <isNotEmpty prepend="" property="CHITIET_KHAMTIENME">
        <isEqual prepend="," property="CHITIET_KHAMTIENME" compareValue="True">
          TM.NGAYTHUCHIEN NGAYGIOTHUCHIEN, TM.NOITHUCHIEN_ID NOITHUCHIENGAYME_ID ,TM.NGUOITAO_ID NGUOITHUCHIENGAYME_ID
        </isEqual>
      </isNotEmpty>
      FROM TT_DVYEUCAU DV
      INNER JOIN TT_TIEPNHAN TN ON TN.TIEPNHAN_ID=DV.TIEPNHAN_ID
      join TT_BENHNHAN bn on tn.BENHNHAN_ID = bn.BENHNHAN_ID
      INNER join TM_DICHVU A on A.DICHVU_ID = dv.DICHVU_ID
      INNER join TM_NHOMDICHVU B on B.NHOMDICHVU_ID = A.NHOMDICHVU_ID
      INNER JOIN TT_VIENPHI VP ON VP.TIEPNHAN_ID=TN.TIEPNHAN_ID AND VP.DICHVU_ID=DV.DICHVU_ID AND VP.REF_ID= DV.DVYEUCAU_ID
      LEFT JOIN TT_NOITRU_BENHAN BA ON TN.TIEPNHAN_ID=BA.TIEPNHAN_ID
      <isNotEmpty prepend="" property="CHITIET_KHAMTIENME">
        <isEqual prepend="" property="CHITIET_KHAMTIENME" compareValue="True">
          LEFT JOIN ( SELECT KHAMTIENME_ID,DVYEUCAU_ID, NGAYTHUCHIEN , NOITHUCHIEN_ID,NGUOITAO_ID
          FROM  TT_NOITRU_KHAMTIENME M WHERE M.BENHVIEN_ID = '$BENHVIEN_ID$'
          ) TM ON DV.DVYEUCAU_ID=TM.DVYEUCAU_ID
        </isEqual>
      </isNotEmpty>
      <isNotEmpty prepend="" property="CHITIET_KHAMGAYME">
        <isEqual prepend="" property="CHITIET_KHAMGAYME" compareValue="True">
          LEFT JOIN ( SELECT KHAMGAYME_ID,DVYEUCAU_ID, NGAYTHUCHIEN , NOITHUCHIEN_ID,NGUOITAO_ID
          FROM  TT_KHAMGAYME M WHERE M.BENHVIEN_ID = '$BENHVIEN_ID$'
          ) GM ON DV.DVYEUCAU_ID=GM.DVYEUCAU_ID
        </isEqual>
      </isNotEmpty>
      WHERE  dv.DICHVU_ID IS NOT NULL
      and tn.BENHVIEN_ID = '$BENHVIEN_ID$'
      and HUYYEUCAU = 0
      and dv.NGAYHENCLS is NULL
      <isNotEmpty prepend="and" property="MADICHVU">
        A.MADICHVU = '$MADICHVU$'
      </isNotEmpty>
      <isNotEmpty prepend="and" property="TUNGAY">
        dv.NGAYYEUCAU &#62;&#61; '$TUNGAY$'
      </isNotEmpty>
      <isNotEmpty prepend="and" property="DENNGAY">
        dv.NGAYYEUCAU &#60;&#61; '$DENNGAY$'
      </isNotEmpty>
      <isNotEmpty prepend="and" property="NOIYEUCAU_ID">
        dv.NOIYEUCAU_ID = '$NOIYEUCAU_ID$'
      </isNotEmpty>
      <isNotEmpty prepend="" property="CHITIET_KHAMGAYME">
        <isEqual prepend="" property="CHITIET_KHAMGAYME" compareValue="True">
          <isEqual prepend="AND" property="DAKHAMGAYME" compareValue="True">
            (GM.KHAMGAYME_ID IS NOT NULL) and Left(B.MANHOMDICHVU,2) IN ('05','06')
          </isEqual>
          <isEqual prepend="AND" property="DAKHAMGAYME" compareValue="False">
            (GM.KHAMGAYME_ID IS NULL ) and Left(B.MANHOMDICHVU,2) IN ('05','06')
          </isEqual>
        </isEqual>
      </isNotEmpty>
      <isNotEmpty prepend="" property="CHITIET_KHAMTIENME">
        <isEqual prepend="" property="CHITIET_KHAMTIENME" compareValue="True">
          <isEqual prepend="AND" property="DAKHAMTIENME" compareValue="True">
            (TM.KHAMTIENME_ID IS NOT NULL)
          </isEqual>
          <isEqual prepend="AND" property="DAKHAMTIENME" compareValue="False">
            (TM.KHAMTIENME_ID IS NULL)
          </isEqual>
        </isEqual>
      </isNotEmpty>
      <isNotEmpty prepend="and" property="NOITHUCHIEN_ID">
        dv.NOITHUCHIEN_ID = '$NOITHUCHIEN_ID$'
      </isNotEmpty>
      <isNotEmpty prepend="and" property="TENBENHNHAN">
        (bn.TENBENHNHAN like '%$TENBENHNHAN$%' or bn.MAYTE like '%$TENBENHNHAN$%')
      </isNotEmpty>
      )AS T WHERE NOT EXISTS (SELECT * FROM  TT_VIENPHI VP  WHERE T.TIEPNHAN_ID=VP.TIEPNHAN_ID AND  T.TRANGTHAI_TIEPNHAN NOT IN('CAPCUU','NOITRU')AND  (isnull(SUDUNG_BHTN,'0') !='1'  )and (isnull(BAOLANH_VIENPHI,'0') !='1') AND VP.DATHANHTOAN=0)
      AND     T.ROWNUMBER between $FROMROW$ and $TOROW$
    </statement>-->
   
  </statements>
</sqlMap>

