<?xml version="1.0" encoding="utf-8" ?>
<!--============================================================================
//	CAUTION: This file is generated by IBatisNetGen.3.SQLMap.cst at 11/11/2015 9:30:18 AM
//				Any manual editing will be lost in re-generation.
//===========================================================================-->
<sqlMap namespace="eHospital" xmlns="http://ibatis.apache.org/mapping" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
  <statements>

    <statement id="DAO00083_GetCLSKetQua_ID" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
      select CLSKETQUA_ID
      from TT_CLSKETQUA
      where DVYEUCAU_ID  = '$DVYEUCAU_ID$'
    </statement>

    <statement id="DAO00083_GetCLSKQIDInCLSKQChiTiet" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
      select CLSKETQUA_ID
      from TT_CLSKETQUACHITIET
      where DVYEUCAU_ID  = '$DVYEUCAU_ID$'
    </statement>

    <statement id="DAO00083_GetAll" resultClass="DataObject">
      select *
      from $REF_TABLE$
      order by $COL_VTYT_ID$
    </statement>

    <statement id="DAO00083_GetDSVTYTGhiNhan" resultClass="DataObject">
      select A.*, dc.TENDUOCDAYDU, dc.BHYT DUOC_BHYT, ld.LOAIVATTU_ID, dc.DONVITINH
      from $REF_TABLE$ A
      left join TM_DUOC dc on A.DUOC_ID = dc.DUOC_ID
      left join TM_LOAIDUOC ld on dc.LOAIDUOC_ID = ld.LOAIDUOC_ID
      where A.DVYEUCAU_ID = #DVYEUCAU_ID#
      <isNotEmpty prepend="and" property="DICHVU_GHINHANVTYT_ID">
        A.DICHVU_GHINHANVTYT_ID = '$DICHVU_GHINHANVTYT_ID$'
      </isNotEmpty>
      order by A.$COL_VTYT_ID$

      <!--select VTYT.*,   PL.MACHUNGTU AS SOPHIEULINH, CT.MACHUNGTU AS SOPHIEUXUAT
      from $REF_TABLE$  VTYT
      left join TT_DUOC_PHIEULINH PL  on VTYT.CHUNGTUTONGHOP_ID = PL.CHUNGTU_ID
      left join TT_DUOC_CHUNGTU CT  on VTYT.CHUNGTU_ID = CT.CHUNGTU_ID
      where VTYT.DVYEUCAU_ID = #DVYEUCAU_ID#
      order by $COL_VTYT_ID$-->
    </statement>
    <statement id="DAO00083_GetTrangThaiTruocKhiXoa_Update_CLSKetQua_VTYT" resultClass="DataObject">
      IF EXISTS (
      SELECT CLSKETQUA_VTYT_ID
      FROM TT_CLSKETQUA_VTYT
      WHERE DVYEUCAU_ID ='$DVYEUCAU_ID$'
      AND BENHVIEN_ID ='$BENHVIEN_ID$'
      AND (CHUNGTU_ID IS NOT NULL OR CHUNGTUTONGHOP_ID IS NOT NULL)
	<isNotEmpty prepend="and" property="DICHVU_GHINHANVTYT_ID">
        DICHVU_GHINHANVTYT_ID = '$DICHVU_GHINHANVTYT_ID$'
      </isNotEmpty>
      )
      BEGIN
      SELECT -1 AS RESULT
      END
      ELSE
      BEGIN
      SELECT 1 AS RESULT
      END
    </statement>
    <statement id="DAO00083_GetTrangThaiTruocKhiXoa_Update_KhamBenh_VTYT" resultClass="DataObject">
      IF EXISTS (
      SELECT KHAMBENH_VTYT_ID
      FROM TT_NGOAITRU_KHAMBENH_VTYT
      WHERE DVYEUCAU_ID ='$DVYEUCAU_ID$'
      AND BENHVIEN_ID ='$BENHVIEN_ID$'
      AND (CHUNGTU_ID IS NOT NULL OR CHUNGTUTONGHOP_ID IS NOT NULL OR PHIEULINH_ID IS NOT NULL)
      <isNotEmpty prepend="and" property="DICHVU_GHINHANVTYT_ID">
        DICHVU_GHINHANVTYT_ID = '$DICHVU_GHINHANVTYT_ID$'
      </isNotEmpty>
      )
      BEGIN
      SELECT -1 AS RESULT
      END
      ELSE
      BEGIN
      SELECT 1 AS RESULT
      END
    </statement>

    <statement id="DAO00083_GetList" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
      select *
      from $REF_TABLE$
      <dynamic prepend="where">
        <isParameterPresent>
          <isNotEmpty prepend="and" property="$COL_VTYT_ID$">
            $COL_VTYT_ID$ = '$VTYT_ID$'
          </isNotEmpty>
          <isNotEmpty prepend="and" property="REF_ID">
            $REF_ID_COL$ = '$REF_ID$'
          </isNotEmpty>
          <isNotEmpty prepend="and" property="DVYEUCAU_ID">
            $DVYEUCAU_ID$ = '$DVYEUCAU_ID$'
          </isNotEmpty>
          <isNotEmpty prepend="and" property="DUOC_ID">
            DUOC_ID = '$DUOC_ID$'
          </isNotEmpty>
          <isNotEmpty prepend="and" property="SOLUONG">
            SOLUONG = '$SOLUONG$'
          </isNotEmpty>
          <isNotEmpty prepend="and" property="LOAIGIA_ID">
            LOAIGIA_ID = '$LOAIGIA_ID$'
          </isNotEmpty>
          <isNotEmpty prepend="and" property="DONGIAPHAITHU">
            DONGIAPHAITHU = '$DONGIAPHAITHU$'
          </isNotEmpty>
          <isNotEmpty prepend="and" property="DONGIA">
            DONGIA = '$DONGIA$'
          </isNotEmpty>
          <isNotEmpty prepend="and" property="TYLEVAT">
            TYLEVAT = '$TYLEVAT$'
          </isNotEmpty>
          <isNotEmpty prepend="and" property="GIATRIVAT">
            GIATRIVAT = '$GIATRIVAT$'
          </isNotEmpty>
          <isNotEmpty prepend="and" property="TIENTE_ID">
            TIENTE_ID = '$TIENTE_ID$'
          </isNotEmpty>
          <isNotEmpty prepend="and" property="TYGIA">
            TYGIA = '$TYGIA$'
          </isNotEmpty>
          <isNotEmpty prepend="and" property="CHUNGTU_ID">
            CHUNGTU_ID = '$CHUNGTU_ID$'
          </isNotEmpty>
          <isNotEmpty prepend="and" property="GHICHU">
            GHICHU = '$GHICHU$'
          </isNotEmpty>
          <isNotEmpty prepend="and" property="CHUNGTUTONGHOP_ID">
            CHUNGTUTONGHOP_ID = '$CHUNGTUTONGHOP_ID$'
          </isNotEmpty>
          <isNotEmpty prepend="and" property="KHOSUDUNG_ID">
            KHOSUDUNG_ID = '$KHOSUDUNG_ID$'
          </isNotEmpty>
          <isNotEmpty prepend="and" property="TINHTIEN">
            TINHTIEN = '$TINHTIEN$'
          </isNotEmpty>
          <isNotEmpty prepend="and" property="BHYTDONGTIEN">
            BHYTDONGTIEN = '$BHYTDONGTIEN$'
          </isNotEmpty>
          <isNotEmpty prepend="and" property="TRANGTHAI">
            TRANGTHAI = '$TRANGTHAI$'
          </isNotEmpty>
          <isNotEmpty prepend="and" property="NGAYSUDUNG">
            NGAYSUDUNG = '$NGAYSUDUNG$'
          </isNotEmpty>
          <isNotEmpty prepend="and" property="THOIGIANSUDUNG">
            THOIGIANSUDUNG = '$THOIGIANSUDUNG$'
          </isNotEmpty>
          <isNotEmpty prepend="and" property="NGUONHANG_ID">
            NGUONHANG_ID = '$NGUONHANG_ID$'
          </isNotEmpty>
          <isNotEmpty prepend="and" property="PHIEULINH_ID">
            PHIEULINH_ID = '$PHIEULINH_ID$'
          </isNotEmpty>
          <isNotEmpty prepend="and" property="BENHVIEN_ID">
            BENHVIEN_ID = '$BENHVIEN_ID$'
          </isNotEmpty>
          <isNotEmpty prepend="and" property="NGAYTAO">
            NGAYTAO = '$NGAYTAO$'
          </isNotEmpty>
          <isNotEmpty prepend="and" property="NGUOITAO_ID">
            NGUOITAO_ID = '$NGUOITAO_ID$'
          </isNotEmpty>
          <isNotEmpty prepend="and" property="NGAYCAPNHAT">
            NGAYCAPNHAT = '$NGAYCAPNHAT$'
          </isNotEmpty>
          <isNotEmpty prepend="and" property="NGUOICAPNHAT_ID">
            NGUOICAPNHAT_ID = '$NGUOICAPNHAT_ID$'
          </isNotEmpty>
        </isParameterPresent>
      </dynamic>
      order by $COL_VTYT_ID$
    </statement>

    <statement id="DAO00083_GetDetail" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
      select *
      from $REF_TABLE$
      where $COL_VTYT_ID$  = '$value$'
      order by $COL_VTYT_ID$
    </statement>

    <statement id="DAO00083_GetDetailP" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
      select *
      from $REF_TABLE$
      where $COL_VTYT_ID$  = '$VTYT_ID$'
      order by $COL_VTYT_ID$
    </statement>

    <statement id="DAO00083_Add" parameterClass="System.Collections.IDictionary" resultClass="System.Int64">
      insert into $REF_TABLE$ (
      $REF_ID_COL$
      ,COSO
      , DVYEUCAU_ID
      , DUOC_ID
      , SOLUONG
      , CHUNGTU_ID
      , GHICHU
      , CHUNGTUTONGHOP_ID
      , KHOSUDUNG_ID
      , KHOTAO_ID
      , TINHTIEN
      , BHYTDONGTIEN
      , TRANGTHAI
      , NGAYSUDUNG
      , THOIGIANSUDUNG
      , NGUONHANG_ID
      <isPropertyAvailable prepend="," property="PHONGBAN_ID">
        PHONGBAN_ID
      </isPropertyAvailable>
      , PHIEULINH_ID
      , BENHVIEN_ID
      , NGAYTAO
      , NGUOITAO_ID
      , NGAYCAPNHAT
      , NGUOICAPNHAT_ID
      <isNotEmpty prepend="," property="PHAMVI_ID">
        PHAMVI_ID
      </isNotEmpty>
      <isNotEmpty prepend="," property="KHOPHAT_ID">
        KHOPHAT_ID
      </isNotEmpty>
      <isNotEmpty prepend="," property="DICHVU_GHINHANVTYT_ID">
        DICHVU_GHINHANVTYT_ID
      </isNotEmpty>
      ) values (
      #REF_ID#
      ,#COSO#
      , #DVYEUCAU_ID#
      , #DUOC_ID#
      , #SOLUONG#
      , #CHUNGTU_ID#
      , #GHICHU#
      , #CHUNGTUTONGHOP_ID#
      , #KHOSUDUNG_ID#
      , #KHOTAO_ID#
      , #TINHTIEN#
      , #BHYTDONGTIEN#
      , #TRANGTHAI#
      , #NGAYSUDUNG#
      , #THOIGIANSUDUNG#
      , #NGUONHANG_ID#
      <isPropertyAvailable prepend="," property="PHONGBAN_ID">
        #PHONGBAN_ID#
      </isPropertyAvailable>
      , #PHIEULINH_ID#
      , #BENHVIEN_ID#
      , #NGAYTAO#
      , #NGUOITAO_ID#
      , #NGAYCAPNHAT#
      , #NGUOICAPNHAT_ID#
      <isNotEmpty prepend="," property="PHAMVI_ID">
        #PHAMVI_ID#
      </isNotEmpty>
      <isNotEmpty prepend="," property="KHOPHAT_ID">
        #KHOPHAT_ID#
      </isNotEmpty>
      <isNotEmpty prepend="," property="DICHVU_GHINHANVTYT_ID">
        #DICHVU_GHINHANVTYT_ID#
      </isNotEmpty>
      )
      SELECT SCOPE_IDENTITY()
      <!--<selectKey resultClass="System.Int64" type="post" >
        SELECT @@IDENTITY as value
      </selectKey>-->
    </statement>

    <update id="DAO00083_Update" parameterClass="System.Collections.IDictionary">
      update $REF_TABLE$ set
      <!--$REF_ID_COL$ = #REF_ID#-->
      DUOC_ID = #DUOC_ID#
      , SOLUONG = #SOLUONG#
      <!--, LOAIGIA_ID = #LOAIGIA_ID#
      , DONGIAPHAITHU = #DONGIAPHAITHU#
      , DONGIA = #DONGIA#
      , TYLEVAT = #TYLEVAT#
      , GIATRIVAT = #GIATRIVAT#
      , TIENTE_ID = #TIENTE_ID#
      , TYGIA = #TYGIA#-->
      , CHUNGTU_ID = #CHUNGTU_ID#
      , GHICHU = #GHICHU#
      , CHUNGTUTONGHOP_ID = #CHUNGTUTONGHOP_ID#
      , KHOSUDUNG_ID = #KHOSUDUNG_ID#
      , TINHTIEN = #TINHTIEN#
      , BHYTDONGTIEN = #BHYTDONGTIEN#
      , TRANGTHAI = #TRANGTHAI#
      , NGAYSUDUNG = #NGAYSUDUNG#
      , THOIGIANSUDUNG = #THOIGIANSUDUNG#
      , NGUONHANG_ID = #NGUONHANG_ID#
      <isPropertyAvailable prepend="," property="PHONGBAN_ID">
        PHONGBAN_ID = #PHONGBAN_ID#
      </isPropertyAvailable>
      , PHIEULINH_ID = #PHIEULINH_ID#
      <!--, BENHVIEN_ID = #BENHVIEN_ID#
      , NGAYTAO = #NGAYTAO#
      , NGUOITAO_ID = #NGUOITAO_ID#-->
      , NGAYCAPNHAT = #NGAYCAPNHAT#
      , NGUOICAPNHAT_ID = #NGUOICAPNHAT_ID#
      <isNotEmpty prepend="," property="PHAMVI_ID">
        PHAMVI_ID = #PHAMVI_ID#
      </isNotEmpty>
      <isNotEmpty prepend="," property="KHOPHAT_ID">
        KHOPHAT_ID = #KHOPHAT_ID#
      </isNotEmpty>
      <isNotEmpty prepend="," property="DICHVU_GHINHANVTYT_ID">
        DICHVU_GHINHANVTYT_ID = #DICHVU_GHINHANVTYT_ID#
      </isNotEmpty>
      where
      $COL_VTYT_ID$ = '$VTYT_ID$'
    </update>

    <statement id="DAO00083_Delete" parameterClass="System.Collections.IDictionary" resultClass="System.Int32">
      delete from $REF_TABLE$
      where
      $COL_VTYT_ID$ = '$VTYT_ID$'
    </statement>

    <statement id="DAO00083_DeleteVienPhiVTYT" parameterClass="System.Collections.IDictionary" resultClass="System.Int32">
      delete from TT_VIENPHI
      where
      REF_TABLE = '$REF_TABLE$'
      and REF_ID = '$REF_ID$'

    </statement>

    <statement id="DAO00083_DeleteBookingVTYT" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
      delete from TT_DUOC_TONKHO_BOOK_NGOAITRU
      where
      REF_TABLE = '$REF_TABLE$'
      and REF_ID = '$REF_ID$'
    </statement>
    <statement id="DAO00083_GetListDeleteBookingVTYT" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
      select * from TT_DUOC_TONKHO_BOOK_NGOAITRU
      where
      REF_TABLE = '$REF_TABLE$'
      and REF_ID = '$REF_ID$'
    </statement>

    <statement id="DAO00083_XoaPhieuGhiNhan" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
      delete from $REF_TABLE$
      where
      DVYEUCAU_ID = '$DVYEUCAU_ID$'
      <isNotEmpty prepend="and" property="DICHVU_GHINHANVTYT_ID">
        DICHVU_GHINHANVTYT_ID = '$DICHVU_GHINHANVTYT_ID$'
        
        IF EXISTS (SELECT 1 FROM TT_DICHVU_GHINHANVTYT WHERE DICHVU_GHINHANVTYT_ID = $DICHVU_GHINHANVTYT_ID$)
        BEGIN
        delete from TT_DICHVU_GHINHANVTYT where DICHVU_GHINHANVTYT_ID = $DICHVU_GHINHANVTYT_ID$
        END
      </isNotEmpty>
    </statement>
    <statement id="DAO00083_GetListXoaPhieuGhiNhan" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
      select * from $REF_TABLE$
      where
      DVYEUCAU_ID = '$DVYEUCAU_ID$'
    </statement>

    <statement id="DAO00083_DeleteP" parameterClass="System.Collections.IDictionary" resultClass="System.Int32">
      delete from $REF_TABLE$
      <dynamic prepend="where">
        <isParameterPresent>
          <isNotEmpty prepend="and" property="$COL_VTYT_ID$">
            $COL_VTYT_ID$ = '$VTYT_ID$'
          </isNotEmpty>
          <isNotEmpty prepend="and" property="CLSKETQUA_ID">
            CLSKETQUA_ID = '$CLSKETQUA_ID$'
          </isNotEmpty>
          <isNotEmpty prepend="and" property="DUOC_ID">
            DUOC_ID = '$DUOC_ID$'
          </isNotEmpty>
          <isNotEmpty prepend="and" property="SOLUONG">
            SOLUONG = '$SOLUONG$'
          </isNotEmpty>
          <isNotEmpty prepend="and" property="LOAIGIA_ID">
            LOAIGIA_ID = '$LOAIGIA_ID$'
          </isNotEmpty>
          <isNotEmpty prepend="and" property="DONGIAPHAITHU">
            DONGIAPHAITHU = '$DONGIAPHAITHU$'
          </isNotEmpty>
          <isNotEmpty prepend="and" property="DONGIA">
            DONGIA = '$DONGIA$'
          </isNotEmpty>
          <isNotEmpty prepend="and" property="TYLEVAT">
            TYLEVAT = '$TYLEVAT$'
          </isNotEmpty>
          <isNotEmpty prepend="and" property="GIATRIVAT">
            GIATRIVAT = '$GIATRIVAT$'
          </isNotEmpty>
          <isNotEmpty prepend="and" property="TIENTE_ID">
            TIENTE_ID = '$TIENTE_ID$'
          </isNotEmpty>
          <isNotEmpty prepend="and" property="TYGIA">
            TYGIA = '$TYGIA$'
          </isNotEmpty>
          <isNotEmpty prepend="and" property="CHUNGTU_ID">
            CHUNGTU_ID = '$CHUNGTU_ID$'
          </isNotEmpty>
          <isNotEmpty prepend="and" property="GHICHU">
            GHICHU = '$GHICHU$'
          </isNotEmpty>
          <isNotEmpty prepend="and" property="CHUNGTUTONGHOP_ID">
            CHUNGTUTONGHOP_ID = '$CHUNGTUTONGHOP_ID$'
          </isNotEmpty>
          <isNotEmpty prepend="and" property="KHOSUDUNG_ID">
            KHOSUDUNG_ID = '$KHOSUDUNG_ID$'
          </isNotEmpty>
          <isNotEmpty prepend="and" property="TINHTIEN">
            TINHTIEN = '$TINHTIEN$'
          </isNotEmpty>
          <isNotEmpty prepend="and" property="BHYTDONGTIEN">
            BHYTDONGTIEN = '$BHYTDONGTIEN$'
          </isNotEmpty>
          <isNotEmpty prepend="and" property="TRANGTHAI">
            TRANGTHAI = '$TRANGTHAI$'
          </isNotEmpty>
          <isNotEmpty prepend="and" property="NGAYSUDUNG">
            NGAYSUDUNG = '$NGAYSUDUNG$'
          </isNotEmpty>
          <isNotEmpty prepend="and" property="THOIGIANSUDUNG">
            THOIGIANSUDUNG = '$THOIGIANSUDUNG$'
          </isNotEmpty>
          <isNotEmpty prepend="and" property="NGUONHANG_ID">
            NGUONHANG_ID = '$NGUONHANG_ID$'
          </isNotEmpty>
          <isNotEmpty prepend="and" property="PHIEULINH_ID">
            PHIEULINH_ID = '$PHIEULINH_ID$'
          </isNotEmpty>
          <isNotEmpty prepend="and" property="BENHVIEN_ID">
            BENHVIEN_ID = '$BENHVIEN_ID$'
          </isNotEmpty>
          <isNotEmpty prepend="and" property="NGAYTAO">
            NGAYTAO = '$NGAYTAO$'
          </isNotEmpty>
          <isNotEmpty prepend="and" property="NGUOITAO_ID">
            NGUOITAO_ID = '$NGUOITAO_ID$'
          </isNotEmpty>
          <isNotEmpty prepend="and" property="NGAYCAPNHAT">
            NGAYCAPNHAT = '$NGAYCAPNHAT$'
          </isNotEmpty>
          <isNotEmpty prepend="and" property="NGUOICAPNHAT_ID">
            NGUOICAPNHAT_ID = '$NGUOICAPNHAT_ID$'
          </isNotEmpty>
        </isParameterPresent>
      </dynamic>
    </statement>

    <statement id="DAO00083_GetSLDuocDaLuu" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
      select sum(SOLUONG) as SOLUONG
      from $REF_TABLE$
      where $REF_ID_COL$  = '$REF_ID$'
      and DUOC_ID  = '$DUOC_ID$'
    </statement>

    <update id="DAO00083_UpdateTTGhiNhanVTYT" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
      update TT_DVYEUCAU
      set GHINHANVTYT = '$GHINHANVTYT$',
      NGUOICAPNHAT_ID = '$NGUOICAPNHAT_ID$',
      NGAYCAPNHAT = '$NGAYCAPNHAT$'
      where DVYEUCAU_ID  = '$DVYEUCAU_ID$'
    </update>

    <statement id="DAO00083_DeleteThuocInList" parameterClass="HashTable" resultClass="DataObject">
      select *
      from $REF_TABLE$
      where <!--$REF_ID_COL$ = #REF_ID#-->
      <dynamic prepend=" $COL_VTYT_ID$ in ">
        <iterate open="(" close=")" conjunction=",  " property="LSTTOATHUOC_ID">#LSTTOATHUOC_ID[]#</iterate>
      </dynamic>

      delete from $REF_TABLE$
      where <!--$REF_ID_COL$ = #REF_ID#-->
      <dynamic prepend=" $COL_VTYT_ID$ in ">
        <iterate open="(" close=")" conjunction=",  " property="LSTTOATHUOC_ID">#LSTTOATHUOC_ID[]#</iterate>
      </dynamic>
    </statement>

    <statement id="DAO00083_GetThongTinVTYT" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
      select vtyt.CHUNGTU_ID, vtyt.PHIEULINH_ID, vtyt.NGUOITAO_ID, vp.DATHANHTOAN
      from $REF_TABLE$ vtyt
      left join TT_VIENPHI vp
      on vtyt.$COL_VTYT_ID$ = vp.REF_ID
      where vtyt.$REF_ID_COL$ = '$REF_ID$'
      and vtyt.$COL_VTYT_ID$ = '$VTYT_ID$'
      and vp.REF_TABLE = '$REF_TABLE$'
    </statement>

    <statement id="DAO00083_GetBookingInfo" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
      select *
      from TT_DUOC_TONKHO_BOOK_NGOAITRU
      where
      <!--KHODUOC_ID  = '$KHODUOC_ID$'
      and-->
      DUOC_ID = '$DUOC_ID$'
      and NGUONHANG_ID = '$NGUONHANG_ID$'
      and REF_ID = '$VTYT_ID$'
      and REF_TABLE = '$REF_TABLE$'
      <isNotEmpty prepend="and" property="KHODUOC_ID">
        KHODUOC_ID = #KHODUOC_ID#
      </isNotEmpty>
      <isNotEmpty prepend="and" property="PHAMVI_ID">
        PHAMVI_ID = #PHAMVI_ID#
      </isNotEmpty>
    </statement>

    <update id="DAO00083_Update_Booking" parameterClass="HashTable" resultClass="System.Int64">
      update TT_DUOC_TONKHO_BOOK_NGOAITRU set
      KHODUOC_ID = #KHODUOC_ID#,
      NGUONHANG_ID = #NGUONHANG_ID#,
      DUOC_ID = #DUOC_ID#,
      SOLUONG = #SOLUONG#,
      NGAYHIEULUC = #NGAYHIEULUC#,
      NGUOICAPNHAT_ID = #NGUOICAPNHAT_ID#,
      NGAYCAPNHAT = #NGAYCAPNHAT#
      <isNotEmpty prepend="," property="PHAMVI_ID">
        PHAMVI_ID = #PHAMVI_ID#
      </isNotEmpty>
      where
      BOOKING_ID = '$BOOKING_ID$'
    </update>

    <insert id="DAO00083_Add_Booking" parameterClass="HashTable" resultClass="System.Int64">
      insert into TT_DUOC_TONKHO_BOOK_NGOAITRU (
      REF_TABLE
      , REF_ID
      , KHODUOC_ID
      , NGUONHANG_ID
      , DUOC_ID
      , BENHVIEN_ID
      , SOLUONG
      , NGAYHIEULUC
      , NGUOITAO_ID
      , NGAYTAO
      , NGUOICAPNHAT_ID
      , NGAYCAPNHAT
      <isNotEmpty prepend="," property="PHAMVI_ID">
        PHAMVI_ID
      </isNotEmpty>
      ) values (
      #REF_TABLE#
      , #VTYT_ID#
      , #KHODUOC_ID#
      , #NGUONHANG_ID#
      , #DUOC_ID#
      , #BENHVIEN_ID#
      , #SOLUONG#
      , #NGAYHIEULUC#
      , #NGUOITAO_ID#
      , #NGAYTAO#
      , #NGUOICAPNHAT_ID#
      , #NGAYCAPNHAT#
      <isNotEmpty prepend="," property="PHAMVI_ID">
        #PHAMVI_ID#
      </isNotEmpty>
      )
    </insert>
    <statement id="DAO00083_GetListKhamBenhNgoaiTru_ID_ByTiepNhanID" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
      select KB.*
      from TT_TIEPNHAN TN
      left join TT_NGOAITRU_KHAMBENH KB on KB.TIEPNHAN_ID = TN.TIEPNHAN_ID and KB.BENHVIEN_ID = TN.BENHVIEN_ID
      where TN.TIEPNHAN_ID = '$TIEPNHAN_ID$'
      and KB.KHAMBENH_ID is not null
      and TN.BENHVIEN_ID = '$BENHVIEN_ID$'
      <isNotEmpty prepend="and" property="DICHVU_ID">
        KB.DICHVU_ID = '$DICHVU_ID$'
      </isNotEmpty>
    </statement>
    <statement id="DAO00083_GetList_PhieuGhiNhanVTYT" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
      select DICHVU_GHINHANVTYT_ID, SOPHIEU, KHAMBENH_ID, TIEPNHAN_ID, DVYEUCAU_ID
      from TT_DICHVU_GHINHANVTYT
      where TIEPNHAN_ID = '$TIEPNHAN_ID$'
      and BENHVIEN_ID = '$BENHVIEN_ID$'
      <isNotEmpty prepend="and" property="KHAMBENH_ID">
        KHAMBENH_ID = '$KHAMBENH_ID$'
      </isNotEmpty>
      <isNotEmpty prepend="and" property="DVYEUCAU_ID">
        DVYEUCAU_ID = '$DVYEUCAU_ID$'
      </isNotEmpty>
      order by THOIGIANGHINHAN desc
    </statement>
    <statement id="DAO00083_Add_PhieuGhiNhanVTYT" parameterClass="HashTable" resultClass="System.Int64">
      insert into TT_DICHVU_GHINHANVTYT (
      SOPHIEU
      , KHAMBENH_ID
      , TIEPNHAN_ID
      , DVYEUCAU_ID
      , NGAYGHINHAN
      , THOIGIANGHINHAN
      , KHOXUAT_ID
      , BENHVIEN_ID
      , THOIGIANTAO
      , NGUOITAO_ID
      ) values (
      #SOPHIEU#
      , #KHAMBENH_ID#
      , #TIEPNHAN_ID#
      , #DVYEUCAU_ID#
      , #NGAYGHINHAN#
      , #THOIGIANGHINHAN#
      , #KHOXUAT_ID#
      , #BENHVIEN_ID#
      , #THOIGIANTAO#
      , #NGUOITAO_ID#
      )
      SELECT SCOPE_IDENTITY()
    </statement>
    <update id="DAO00083_Update_PhieuGhiNhanVTYT" parameterClass="HashTable" resultClass="System.Int64">
      update TT_DICHVU_GHINHANVTYT set
      KHOXUAT_ID = #KHOXUAT_ID#,
      THOIGIANCAPNHAT = #THOIGIANCAPNHAT#,
      NGUOICAPNHAT_ID = #NGUOICAPNHAT_ID#
      where
      DICHVU_GHINHANVTYT_ID = '$DICHVU_GHINHANVTYT_ID$'
    </update>
    <statement id="DAO00083_CheckTrangThaiDaGhiNhanVTYT" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
      IF EXISTS (
      SELECT KHAMBENH_VTYT_ID
      FROM TT_NGOAITRU_KHAMBENH_VTYT
      WHERE DVYEUCAU_ID ='$DVYEUCAU_ID$' AND BENHVIEN_ID ='$BENHVIEN_ID$'
      UNION ALL
      SELECT CLSKETQUA_VTYT_ID
      FROM TT_CLSKETQUA_VTYT
      WHERE DVYEUCAU_ID = '$DVYEUCAU_ID$' AND BENHVIEN_ID = '$BENHVIEN_ID$'
      )
      BEGIN
      SELECT -1 AS RESULT
      END
      ELSE
      BEGIN
      SELECT 1 AS RESULT
      END
    </statement>
    <statement id="DAO00083_GetDataGiayChungNhanNghiViecHuongBHXH" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
      declare @HoTenMe nvarchar(200), @HoTenCha nvarchar(200), @ChanDoan nvarchar(2000)
      select @HoTenMe = LH.TENNGUOILIENHE
      from TT_BENHNHAN_NGUOILIENHE LH
      left join LST_DICTIONARY QH on QH.DICTIONARY_ID = LH.QUANHE_ID and QH.BENHVIEN_ID = LH.BENHVIEN_ID
      where LH.BENHNHAN_ID = $BENHNHAN_ID$ and QH.DICTIONARY_CODE = '2' and LH.BENHVIEN_ID = '$BENHVIEN_ID$'

      select @HoTenCha = LH.TENNGUOILIENHE
      from TT_BENHNHAN_NGUOILIENHE LH
      left join LST_DICTIONARY QH on QH.DICTIONARY_ID = LH.QUANHE_ID and QH.BENHVIEN_ID = LH.BENHVIEN_ID
      where LH.BENHNHAN_ID = $BENHNHAN_ID$ and QH.DICTIONARY_CODE = '1' and LH.BENHVIEN_ID = '$BENHVIEN_ID$'

      SELECT @ChanDoan = COALESCE(@ChanDoan + ', ', '') + CHANDOANKHOAKHAM
      FROM TT_NGOAITRU_KHAMBENH
      WHERE TIEPNHAN_ID = $TIEPNHAN_ID$ and BENHVIEN_ID = '$BENHVIEN_ID$'

      select BN.BENHNHAN_ID, BN.MAYTE, BN.TENBENHNHAN, BN.GIOITINH, BN.NGAYSINH, TN.TIEPNHAN_ID, TN.SOBHYT,
      GCN.GIAYCHUNGNHAN_ID, GCN.SOSERI, GCN.DONVILAMVIEC, GCN.PHUONGPHAPDIEUTRI, GCN.NGHITUNGAY,
      GCN.NGHIDENNGAY, GCN.BACSI_ID,
      case when GCN.CHANDOAN is null then @ChanDoan else GCN.CHANDOAN end AS CHANDOAN,
      case when GCN.HOTENCHA is null then @HoTenCha else GCN.HOTENCHA end AS HOTENCHA,
      case when GCN.HOTENME is null then @HoTenMe else GCN.HOTENME end AS HOTENME
      from TT_TIEPNHAN TN
      inner join TT_BENHNHAN BN on BN.BENHNHAN_ID = TN.BENHNHAN_ID and BN.BENHVIEN_ID = TN.BENHVIEN_ID
      left join TT_GIAYCHUNGNHAN_NGHIVIEC GCN on GCN.TIEPNHAN_ID = TN.TIEPNHAN_ID and GCN.BENHVIEN_ID = TN.BENHVIEN_ID
      where
      TN.TIEPNHAN_ID = $TIEPNHAN_ID$
      and TN.BENHVIEN_ID = '$BENHVIEN_ID$'

    </statement>
    <statement id="DAO00083_AddGiayChungNhanNghiHuongBHXH" parameterClass="HashTable" resultClass="System.Int64">
      insert into TT_GIAYCHUNGNHAN_NGHIVIEC (
      SOSERI
      , BENHNHAN_ID
      , TIEPNHAN_ID
      , MAYTE
      , DONVILAMVIEC
      , HOTENCHA
      , HOTENME
      , CHANDOAN
      , PHUONGPHAPDIEUTRI
      , NGHITUNGAY
      , NGHIDENNGAY
      , BACSI_ID
      , NGUOITAO_ID
      , NGAYTAO
      , BENHVIEN_ID
      ) values (
      #SOSERI#
      , #BENHNHAN_ID#
      , #TIEPNHAN_ID#
      , #MAYTE#
      , #DONVILAMVIEC#
      , #HOTENCHA#
      , #HOTENME#
      , #CHANDOAN#
      , #PHUONGPHAPDIEUTRI#
      , #NGHITUNGAY#
      , #NGHIDENNGAY#
      , #BACSI_ID#
      , #NGUOITAO_ID#
      , #NGAYTAO#
      , #BENHVIEN_ID#
      )
      SELECT SCOPE_IDENTITY()
    </statement>
    <update id="DAO00083_UpdateGiayChungNhanNghiHuongBHXH" parameterClass="HashTable" resultClass="System.Int64">
      update TT_GIAYCHUNGNHAN_NGHIVIEC set
      DONVILAMVIEC = #DONVILAMVIEC#,
      HOTENCHA = #HOTENCHA#,
      HOTENME = #HOTENME#,
      CHANDOAN = #CHANDOAN#,
      PHUONGPHAPDIEUTRI = #PHUONGPHAPDIEUTRI#,
      NGHITUNGAY = #NGHITUNGAY#,
      NGHIDENNGAY = #NGHIDENNGAY#,
      BACSI_ID = #BACSI_ID#,
      NGUOICAPNHAT_ID = #NGUOICAPNHAT_ID#,
      NGAYCAPNHAT = #NGAYCAPNHAT#
      where
      GIAYCHUNGNHAN_ID = $GIAYCHUNGNHAN_ID$ 
    </update>
    <statement id="DAO00083_XoaThongTinGiayChungNhanNghiHuongBHXH" parameterClass="HashTable" resultClass="DataObject">

      delete from TT_GIAYCHUNGNHAN_NGHIVIEC
      where GIAYCHUNGNHAN_ID = $GIAYCHUNGNHAN_ID$ 
      
    </statement>
  </statements>
</sqlMap>
