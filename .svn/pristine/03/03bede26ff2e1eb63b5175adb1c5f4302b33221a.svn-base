<?xml version="1.0" encoding="utf-8" ?>
<!--============================================================================
//	CAUTION: This file is generated by IBatisNetGen.3.SQLMap.cst at 5/24/2016 11:05:56 AM
//				Any manual editing will be lost in re-generation.
//===========================================================================-->
<sqlMap namespace="eHospital" xmlns="http://ibatis.apache.org/mapping" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">

  <statements>

    <statement id="DAO00110_GetPhieuByDVYeuCauID" resultClass="DataObject">
      select top (1) *
      from TT_QUANLYBENHPHAM_CHITIET
      where DVYEUCAU_ID = #DVYEUCAU_ID#
      order by QUANLYBENHPHAM_ID
    </statement>
    
    <statement id="DAO00110_GetAll" resultClass="DataObject">
      select *
      from TT_QUANLYBENHPHAM_CHITIET
      order by QUANLYBENHPHAM_CHITIET_ID
    </statement>
    
    <statement id="DAO00110_GetList" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
      select q.*, 
      d.DICHVU_ID as DICHVUCAPTREN_ID, d.BACSICHIDINH_ID, d.NOITHUCHIEN_ID, d.NOIYEUCAU_ID, d.TRANGTHAI, d.KHAN, d.NGAYGIOYEUCAU, d.CHANDOAN
      from TT_QUANLYBENHPHAM_CHITIET q
      left join TT_DVYEUCAU d
      on q.DVYEUCAU_ID = d.DVYEUCAU_ID

      <dynamic prepend="where">
        <isParameterPresent>
          <isNotEmpty prepend="and" property="QUANLYBENHPHAM_CHITIET_ID">
            q.QUANLYBENHPHAM_CHITIET_ID = '$QUANLYBENHPHAM_CHITIET_ID$'
          </isNotEmpty>
          <isNotEmpty prepend="and" property="QUANLYBENHPHAM_ID">
            q.QUANLYBENHPHAM_ID = '$QUANLYBENHPHAM_ID$'
          </isNotEmpty>
          <isNotEmpty prepend="and" property="DVYEUCAU_ID">
            q.DVYEUCAU_ID = '$DVYEUCAU_ID$'
          </isNotEmpty>
          <isNotEmpty prepend="and" property="NHOMDICHVU_ID">
            q.NHOMDICHVU_ID = '$NHOMDICHVU_ID$'
          </isNotEmpty>
          <isNotEmpty prepend="and" property="DICHVU_ID">
            q.DICHVU_ID = '$DICHVU_ID$'
          </isNotEmpty>
          <isNotEmpty prepend="and" property="SID">
            q.SID = '$SID$'
          </isNotEmpty>
          <isNotEmpty prepend="and" property="GHICHULAYMAU">
            q.GHICHULAYMAU = '$GHICHULAYMAU$'
          </isNotEmpty>
        </isParameterPresent>
      </dynamic>            
      
      order by q.QUANLYBENHPHAM_CHITIET_ID
    </statement>
    
    <statement id="DAO00110_GetDetail" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
      select *
      from TT_QUANLYBENHPHAM_CHITIET
      where QUANLYBENHPHAM_CHITIET_ID  = '$value$'
      order by QUANLYBENHPHAM_CHITIET_ID
    </statement>
    
    <statement id="DAO00110_GetDetailP" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
      select *
      from TT_QUANLYBENHPHAM_CHITIET
      where QUANLYBENHPHAM_CHITIET_ID  = '$QUANLYBENHPHAM_CHITIET_ID$'
      order by QUANLYBENHPHAM_CHITIET_ID
    </statement>
    
    <statement id="DAO00110_Add" parameterClass="System.Collections.IDictionary" resultClass="System.Int64">
      insert into TT_QUANLYBENHPHAM_CHITIET (
      QUANLYBENHPHAM_ID
      , DVYEUCAU_ID
      , NHOMDICHVU_ID
      , DICHVU_ID
      , SID
      , GHICHULAYMAU
      , BENHVIEN_ID
      ) values (
      #QUANLYBENHPHAM_ID#
      , #DVYEUCAU_ID#
      , #NHOMDICHVU_ID#
      , #DICHVU_ID#
      , #SID#
      , #GHICHULAYMAU#
      , #BENHVIEN_ID#
      )
      SELECT SCOPE_IDENTITY()

      update TT_DVYEUCAU
      set DALAYMAU = 1
      where DVYEUCAU_ID = '$DVYEUCAU_ID$'

    </statement>

    <update id="DAO00110_Update" parameterClass="System.Collections.IDictionary">
      update TT_QUANLYBENHPHAM_CHITIET set
      QUANLYBENHPHAM_ID = #QUANLYBENHPHAM_ID#
      , DVYEUCAU_ID = #DVYEUCAU_ID#
      , NHOMDICHVU_ID = #NHOMDICHVU_ID#
      , DICHVU_ID = #DICHVU_ID#
      , SID = #SID#
      , GHICHULAYMAU = #GHICHULAYMAU#
      where
      QUANLYBENHPHAM_CHITIET_ID = '$QUANLYBENHPHAM_CHITIET_ID$'
    </update>

    <statement id="DAO00110_Delete" parameterClass="System.Collections.IDictionary" resultClass="System.Int32">
      delete from TT_QUANLYBENHPHAM_CHITIET
      where
      QUANLYBENHPHAM_CHITIET_ID = '$QUANLYBENHPHAM_CHITIET_ID$'
    </statement>

    <statement id="DAO00110_DeleteP" parameterClass="System.Collections.IDictionary" resultClass="System.Int32">
      delete from TT_QUANLYBENHPHAM_CHITIET
      <dynamic prepend="where">
        <isParameterPresent>
          <isNotEmpty prepend="and" property="QUANLYBENHPHAM_CHITIET_ID">
            QUANLYBENHPHAM_CHITIET_ID = '$QUANLYBENHPHAM_CHITIET_ID$'
          </isNotEmpty>
          <isNotEmpty prepend="and" property="QUANLYBENHPHAM_ID">
            QUANLYBENHPHAM_ID = '$QUANLYBENHPHAM_ID$'
          </isNotEmpty>
          <isNotEmpty prepend="and" property="DVYEUCAU_ID">
            DVYEUCAU_ID = '$DVYEUCAU_ID$'
          </isNotEmpty>
          <isNotEmpty prepend="and" property="NHOMDICHVU_ID">
            NHOMDICHVU_ID = '$NHOMDICHVU_ID$'
          </isNotEmpty>
          <isNotEmpty prepend="and" property="DICHVU_ID">
            DICHVU_ID = '$DICHVU_ID$'
          </isNotEmpty>
          <isNotEmpty prepend="and" property="SID">
            SID = '$SID$'
          </isNotEmpty>
          <isNotEmpty prepend="and" property="GHICHULAYMAU">
            GHICHULAYMAU = '$GHICHULAYMAU$'
          </isNotEmpty>
        </isParameterPresent>
      </dynamic>
    </statement>

    <statement id="DAO00110_DeleteByListID" parameterClass="System.Collections.IDictionary" resultClass="System.Int32">
      delete from TT_QUANLYBENHPHAM_CHITIET
      where
      QUANLYBENHPHAM_CHITIET_ID in
      <iterate open="(" close=")" conjunction=",  " property="LST_QUANLYBENHPHAM_CHITIET_ID">#LST_QUANLYBENHPHAM_CHITIET_ID[]#</iterate>

      update TT_DVYEUCAU
      set DALAYMAU = 0,
      ,TRANGTHAI='CHUAKETQUA'
      NGUOICAPNHAT_ID = '$NGUOICAPNHAT_ID$',
      NGAYCAPNHAT = '$NGAYCAPNHAT$'
      where DVYEUCAU_ID in
      <iterate open="(" close=")" conjunction=",  " property="LST_DVYEUCAU_ID">#LST_DVYEUCAU_ID[]#</iterate>
    </statement>
    
    <statement id="DAO00110_DeleteByMasterID" parameterClass="System.Collections.IDictionary" resultClass="System.Int32">
      delete from TT_QUANLYBENHPHAM_CHITIET
      where
      QUANLYBENHPHAM_ID = '$QUANLYBENHPHAM_ID$'

      <dynamic>
        <isParameterPresent>
          <isNotEmpty property="LST_DVYEUCAU_ID">
            update TT_DVYEUCAU
            set DALAYMAU = 0
            ,TRANGTHAI='CHUAKETQUA'
            , DANHANBENHPHAM = 0
            , THOIGIANNHANBENHPHAM = null
            , NGAYNHANBENHPHAM = null
            , NGUOINHANBENHPHAM_ID = null
            , NGUOICAPNHAT_ID = #NGUOICAPNHAT_ID#
            , NGAYCAPNHAT = #NGAYCAPNHAT#
            where DVYEUCAU_ID in
            <iterate open="(" close=")" conjunction=",  " property="LST_DVYEUCAU_ID">#LST_DVYEUCAU_ID[]#</iterate>
          </isNotEmpty>
        </isParameterPresent>
      </dynamic>
      
    </statement>

    <statement id="DAO00110_UpdateTTNhanBenhPham" parameterClass="System.Collections.IDictionary">
      update TT_DVYEUCAU set
      DANHANBENHPHAM = #DANHANBENHPHAM#
      , THOIGIANNHANBENHPHAM = #THOIGIANNHANBENHPHAM#
      , NGAYNHANBENHPHAM = #NGAYNHANBENHPHAM#
      , NGUOINHANBENHPHAM_ID = #NGUOINHANBENHPHAM_ID#
      , NGUOICAPNHAT_ID = #NGUOICAPNHAT_ID#
      , NGAYCAPNHAT = #NGAYCAPNHAT#
      ,TRANGTHAI=#TRANGTHAI#
      where
      DVYEUCAU_ID = '$DVYEUCAU_ID$'
    </statement>

    <statement id="DAO00110_CheckDVDaCoKQ" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
      select CLSKETQUACHITIET_ID from TT_CLSKETQUACHITIET
      where
      DVYEUCAU_ID in
      <iterate open="(" close=")" conjunction=",  " property="LST_DVYEUCAU_ID">#LST_DVYEUCAU_ID[]#</iterate>
    </statement>

    <delete id="DAO00110_XoaSID" parameterClass="System.Collections.IDictionary" resultClass="System.Int32">
      delete from TT_QUANLYBENHPHAM_CHITIET
      where
      QUANLYBENHPHAM_CHITIET_ID = '$QUANLYBENHPHAM_CHITIET_ID$'      

      update TT_DVYEUCAU
      set DALAYMAU = 0
      where DVYEUCAU_ID = '$DVYEUCAU_ID$'
    </delete>

    <update id="DAO00110_CapLaiSID" parameterClass="System.Collections.IDictionary">

      update TT_QUANLYBENHPHAM_CHITIET
      set SID = '$SID$'
      where
      <!--COR-5888 theo loi dungttk5 là dùng chung 1 sid - 20170712 - begin-->
      <isNotEmpty prepend="" property="QUANLYBENHPHAM_CHITIET_ID">
        QUANLYBENHPHAM_CHITIET_ID = '$QUANLYBENHPHAM_CHITIET_ID$'
      </isNotEmpty>
      <isNotEmpty prepend="" property="QUANLYBENHPHAM_ID">
        QUANLYBENHPHAM_ID = '$QUANLYBENHPHAM_ID$'
      </isNotEmpty>
      <!--COR-5888 theo loi dungttk5 là dùng chung 1 sid - 20170712 - end-->
    </update>
    
  </statements>

</sqlMap>
