<?xml version="1.0" encoding="utf-8" ?>
<!--============================================================================
//	CAUTION: This file is generated by IBatisNetGen.3.SQLMap.cst at 11/11/2015 9:27:48 AM
//				Any manual editing will be lost in re-generation.
//===========================================================================-->
<sqlMap namespace="eHospital" xmlns="http://ibatis.apache.org/mapping" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" >

  <statements>
    <statement id="DAO00066_GetListTiepNhanNhapVien" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
      select
      A.KHOADIEUTRI_ID, A.NGAYNHAPVIEN, A.THOIGIANNHAPVIEN  as THOIGIANCHIDINH, A.CHANDOAN,
      B.SOTIEPNHAN, B.THOIGIANTIEPNHAN, A.BACSICHIDINH_ID, B.DOITUONG_ID,
      C.MAYTE, C.TENBENHNHAN, C.NAMSINH, C.NGAYSINH, A.SOBENHAN, A.BENHVIEN_ID, C.GIOITINH,
      A.BENHNHAN_ID, A.TIEPNHAN_ID, A.NOINHAPVIEN_ID, A.NHAPVIEN_ID, A.ICD_CHANDOAN,
      B.TRANGTHAI, A.BENHAN_ID, B.NGUOIGIOITHIEU_ID, A.TRANGTHAI as TRANGTHAINHAPVIEN, A.CHUYENKHOA_ID
      from TT_NOITRU_NHAPVIEN A
      inner join TT_TIEPNHAN B on A.TIEPNHAN_ID = B.TIEPNHAN_ID
      inner join TT_BENHNHAN C on B.BENHNHAN_ID = C.BENHNHAN_ID
      where
      (A.TRANGTHAI = 'CHOXACNHAN' OR A.TRANGTHAI = 'CHONHAPKHOA')
      <isNotEmpty prepend="and" property="TUNGAY">
        A.NGAYNHAPVIEN &#62;&#61; '$TUNGAY$'
      </isNotEmpty>
      <isNotEmpty prepend="and" property="DENNGAY">
        A.NGAYNHAPVIEN &#60;&#61; '$DENNGAY$'
      </isNotEmpty>
      <!--(A.NGAYNHAPVIEN BETWEEN '$TUNGAY$' AND '$DENNGAY$')-->

      <isNotEmpty prepend="And" property="LIST_KHOADIEUTRI_ID">
        A.KHOADIEUTRI_ID in ($LIST_KHOADIEUTRI_ID$)
      </isNotEmpty>
      <isNotEmpty prepend="and" property="MABENHNHAN">
        (C.MAYTE like '%' + #MABENHNHAN# + '%' or C.TENBENHNHAN like '%' + #MABENHNHAN# + '%')
      </isNotEmpty>
      <isNotEmpty prepend="and" property="BENHVIEN_ID">
        A.BENHVIEN_ID = '$BENHVIEN_ID$'
      </isNotEmpty>
      <isNotEmpty prepend="" property="TRANGTHAI">
        <isEqual prepend="AND" property="TRANGTHAI" compareValue="02">
          A.BENHAN_ID is NULL
        </isEqual>
        <isEqual prepend="AND" property="TRANGTHAI" compareValue="03">
          A.BENHAN_ID is not NULL
        </isEqual>
      </isNotEmpty>
      order by B.SOTIEPNHAN
    </statement>
    <statement id="DAO00066_GetListTiepNhanCapCuuNhapVien" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
      select
      A.KHOACHUYENDEN_ID as KHOADIEUTRI_ID, A.NGAYVAOVIEN as NGAYNHAPVIEN, A.THOIGIANVAOVIEN as THOIGIANCHIDINH, '' as CHANDOAN,
      B.SOTIEPNHAN, B.THOIGIANTIEPNHAN, '-1' as BACSICHIDINH_ID, B.DOITUONG_ID,
      C.MAYTE, C.TENBENHNHAN, C.NAMSINH, A.SOBENHAN, A.BENHVIEN_ID,
      A.TIEPNHAN_ID, C.BENHNHAN_ID, 0 as NOINHAPVIEN_ID, A.BENHAN_ID as NHAPVIEN_ID, A.ICD_BENHCHINH as ICD_CHANDOAN
      from TT_NOITRU_BENHAN A
      inner join TT_TIEPNHAN B on A.TIEPNHAN_ID = B.TIEPNHAN_ID
      inner join TT_BENHNHAN C on B.BENHNHAN_ID = C.BENHNHAN_ID
      where
      <!--(A.NGAYVAOVIEN BETWEEN '$TUNGAY$' AND '$DENNGAY$')-->
      A.SOCAPCUU = A.SOBENHAN
      <isNotEmpty prepend="and" property="TUNGAY">
        A.NGAYVAOVIEN &#62;&#61; '$TUNGAY$'
      </isNotEmpty>
      <isNotEmpty prepend="and" property="DENNGAY">
        A.NGAYVAOVIEN &#60;&#61; '$DENNGAY$'
      </isNotEmpty>
      <!--And A.KETQUADIEUTRI_ID in (select * from LST_DICTIONARY where DICTIONARY_TYPE_CODE like 'XuTriKhamCapCuu' and DICTIONARY_CODE = '04')-->
      And A.KETQUADIEUTRI_ID in (select DICTIONARY_ID from LST_DICTIONARY where DICTIONARY_TYPE_CODE like 'KetQuaDieuTri' and DICTIONARY_CODE = 'IPD') <!--and DICTIONARY_TYPE_ID = '63')-->
      <isNotEmpty prepend="And" property="LIST_KHOADIEUTRI_ID">
        A.KHOACHUYENDEN_ID in ($LIST_KHOADIEUTRI_ID$)
      </isNotEmpty>
      <isNotEmpty prepend="and" property="MABENHNHAN">
        C.MAYTE = '$MABENHNHAN$'
      </isNotEmpty>
      <isNotEmpty prepend="and" property="BENHVIEN_ID">
        A.BENHVIEN_ID = '$BENHVIEN_ID$'
      </isNotEmpty>
      <isNotEmpty prepend="" property="TRANGTHAI">
        <isEqual prepend="AND" property="TRANGTHAI" compareValue="02">
          A.BENHAN_ID is NULL
        </isEqual>
        <isEqual prepend="AND" property="TRANGTHAI" compareValue="03">
          A.BENHAN_ID is not NULL
        </isEqual>
      </isNotEmpty>
      order by B.SOTIEPNHAN
    </statement>
    <statement id="DAO00066_GetBENHAN_TIEPNHAN" resultClass="DataObject">
      select top 1 *
      from TT_NOITRU_BENHAN
      where TIEPNHAN_ID = '$TIEPNHAN_ID$' <!--and TRANGTHAI = 'DANGDIEUTRI'--> and BENHVIEN_ID = '$BENHVIEN_ID$'
      order by NGAYTAO desc
    </statement>

    <statement id="DAO00066_GetTrangThaiByBenhAnID" resultClass="DataObject">
      select TRANGTHAI, CHANDOANVAOKHOA
      from TT_NOITRU_BENHAN
      where BENHAN_ID = '$BENHAN_ID$'
      and BENHVIEN_ID = '$BENHVIEN_ID$'
    </statement>

    <update id="DAO00066_Update_TRANGTHAI_Huy" parameterClass="System.Collections.IDictionary">
      update TT_NOITRU_NHAPVIEN
      set TRANGTHAI = 'HUYXACNHAN'
      where SOBENHAN = '$SOBENHAN$'
    </update>
    <statement id="DAO00066_GetAll" resultClass="DataObject">
      select *
      from TT_NOITRU_NHAPVIEN
      order by NHAPVIEN_ID
    </statement>
    <statement id="DAO00066_GetNhapVienById" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
      select *
      from TT_NOITRU_NHAPVIEN
      where TT_NOITRU_NHAPVIEN.TIEPNHAN_ID  = '$TIEPNHAN_ID$' and TT_NOITRU_NHAPVIEN.TRANGTHAI = 'CHOXACNHAN' and TT_NOITRU_NHAPVIEN.LOAIBENHAN != 2
      order by NHAPVIEN_ID desc
    </statement>
    <statement id="DAO00066_GetXacNhanNhapVienById" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
      select *
      from TT_NOITRU_NHAPVIEN
      where TT_NOITRU_NHAPVIEN.TIEPNHAN_ID  = '$TIEPNHAN_ID$' and TT_NOITRU_NHAPVIEN.TRANGTHAI != 'CHOXACNHAN'
      order by NHAPVIEN_ID desc
    </statement>
    <statement id="DAO00066_GetList" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
      select TT_NOITRU_NHAPVIEN.*, TT_TIEPNHAN.SOTIEPNHAN, TT_NOITRU_BENHAN.TRANGTHAI as TT_NOITRU_BENHAN_TRANGTHAI
      from TT_NOITRU_NHAPVIEN
      left join TT_TIEPNHAN on TT_TIEPNHAN.BENHNHAN_ID = TT_NOITRU_NHAPVIEN.BENHNHAN_ID
      left join TT_NOITRU_BENHAN on TT_NOITRU_BENHAN.TIEPNHAN_ID = TT_NOITRU_NHAPVIEN.TIEPNHAN_ID
      <dynamic prepend="where">
        <isParameterPresent>
          <isNotEmpty prepend="and" property="NHAPVIEN_ID">
            TT_NOITRU_NHAPVIEN.NHAPVIEN_ID = '$NHAPVIEN_ID$'
          </isNotEmpty>
          <isNotEmpty prepend="and" property="BENHNHAN_ID">
            TT_NOITRU_NHAPVIEN.BENHNHAN_ID = '$BENHNHAN_ID$'
          </isNotEmpty>
          <isNotEmpty prepend="and" property="TIEPNHAN_ID">
            TT_NOITRU_NHAPVIEN.TIEPNHAN_ID = '$TIEPNHAN_ID$'
          </isNotEmpty>
          <isNotEmpty prepend="and" property="NGAYNHAPVIEN">
            TT_NOITRU_NHAPVIEN.NGAYNHAPVIEN = '$NGAYNHAPVIEN$'
          </isNotEmpty>
          <isNotEmpty prepend="and" property="THOIGIANNHAPVIEN">
            TT_NOITRU_NHAPVIEN.THOIGIANNHAPVIEN = '$THOIGIANNHAPVIEN$'
          </isNotEmpty>
          <isNotEmpty prepend="and" property="NOINHAPVIEN_ID">
            TT_NOITRU_NHAPVIEN.NOINHAPVIEN_ID = '$NOINHAPVIEN_ID$'
          </isNotEmpty>
          <isNotEmpty prepend="and" property="BACSICHIDINH_ID">
            TT_NOITRU_NHAPVIEN.BACSICHIDINH_ID = '$BACSICHIDINH_ID$'
          </isNotEmpty>
          <isNotEmpty prepend="and" property="LYDONHAPVIEN_ID">
            TT_NOITRU_NHAPVIEN.LYDONHAPVIEN_ID = '$LYDONHAPVIEN_ID$'
          </isNotEmpty>
          <isNotEmpty prepend="and" property="KHOADIEUTRI_ID">
            TT_NOITRU_NHAPVIEN.KHOADIEUTRI_ID = '$KHOADIEUTRI_ID$'
          </isNotEmpty>
          <isNotEmpty prepend="and" property="BENHAN_ID">
            TT_NOITRU_NHAPVIEN.BENHAN_ID = '$BENHAN_ID$'
          </isNotEmpty>
          <isNotEmpty prepend="and" property="SOBENHAN">
            TT_NOITRU_NHAPVIEN.SOBENHAN = '$SOBENHAN$'
          </isNotEmpty>
          <isNotEmpty prepend="and" property="KHAMBENH_ID">
            TT_NOITRU_NHAPVIEN.KHAMBENH_ID = '$KHAMBENH_ID$'
          </isNotEmpty>
          <isNotEmpty prepend="and" property="LOAIBENHAN_ID">
            TT_NOITRU_NHAPVIEN.LOAIBENHAN_ID = '$LOAIBENHAN_ID$'
          </isNotEmpty>
          <isNotEmpty prepend="and" property="ICD_CHANDOAN">
            TT_NOITRU_NHAPVIEN.ICD_CHANDOAN = '$ICD_CHANDOAN$'
          </isNotEmpty>
          <isNotEmpty prepend="and" property="CHANDOAN">
            TT_NOITRU_NHAPVIEN.CHANDOAN = '$CHANDOAN$'
          </isNotEmpty>
          <isNotEmpty prepend="and" property="CAPCUU">
            TT_NOITRU_NHAPVIEN.CAPCUU = '$CAPCUU$'
          </isNotEmpty>
          <isNotEmpty prepend="and" property="TRANGTHAI">
            TT_NOITRU_NHAPVIEN.TRANGTHAI = '$TRANGTHAI$'
          </isNotEmpty>
          <isNotEmpty prepend="and" property="CHUYENKHOA_ID">
            TT_NOITRU_NHAPVIEN.CHUYENKHOA_ID = '$CHUYENKHOA_ID$'
          </isNotEmpty>
          <isNotEmpty prepend="and" property="BENHVIEN_ID">
            TT_NOITRU_NHAPVIEN.BENHVIEN_ID = '$BENHVIEN_ID$'
          </isNotEmpty>
          <isNotEmpty prepend="and" property="NGAYTAO">
            TT_NOITRU_NHAPVIEN.NGAYTAO = '$NGAYTAO$'
          </isNotEmpty>
          <isNotEmpty prepend="and" property="NGUOITAO_ID">
            TT_NOITRU_NHAPVIEN.NGUOITAO_ID = '$NGUOITAO_ID$'
          </isNotEmpty>
          <isNotEmpty prepend="and" property="NGAYCAPNHAT">
            TT_NOITRU_NHAPVIEN.NGAYCAPNHAT = '$NGAYCAPNHAT$'
          </isNotEmpty>
          <isNotEmpty prepend="and" property="NGUOICAPNHAT_ID">
            TT_NOITRU_NHAPVIEN.NGUOICAPNHAT_ID = '$NGUOICAPNHAT_ID$'
          </isNotEmpty>
          <isNotEmpty prepend="and" property="BENHNHAN_ID">
            TT_NOITRU_BENHAN.BENHNHAN_ID = '$BENHNHAN_ID$'
          </isNotEmpty>
        </isParameterPresent>
      </dynamic>
      order by NHAPVIEN_ID
    </statement>
    <statement id="DAO00066_GetDetail" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
      select *
      from TT_NOITRU_NHAPVIEN
      where TT_NOITRU_NHAPVIEN.NHAPVIEN_ID  = '$value$'
      order by NHAPVIEN_ID
    </statement>
    <statement id="DAO00066_GetDetailP" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
      select *
      from TT_NOITRU_NHAPVIEN
      where TT_NOITRU_NHAPVIEN.NHAPVIEN_ID  = '$NHAPVIEN_ID$'
      order by NHAPVIEN_ID
    </statement>
    <statement id="DAO00066_GetDetailBySoBenhAn" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
      select *
      from TT_NOITRU_NHAPVIEN
      where TT_NOITRU_NHAPVIEN.SOBENHAN  = '$SOBENHAN$'
      and TT_NOITRU_NHAPVIEN.BENHVIEN_ID = '$BENHVIEN_ID$'
      order by NHAPVIEN_ID
    </statement>
    <statement id="DAO00066_Add" parameterClass="System.Collections.IDictionary" resultClass="System.Int64">
      insert into TT_NOITRU_NHAPVIEN (
      BENHNHAN_ID
      , TIEPNHAN_ID
      , NGAYNHAPVIEN
      , THOIGIANNHAPVIEN
      , NOINHAPVIEN_ID
      , BACSICHIDINH_ID
      , LYDONHAPVIEN_ID
      , KHOADIEUTRI_ID
      , BENHAN_ID
      , SOBENHAN
      , KHAMBENH_ID
      , LOAIBENHAN_ID
      , ICD_CHANDOAN
      , CHANDOAN
      , CAPCUU
      , TRANGTHAI
      , CHUYENKHOA_ID
      , BENHVIEN_ID
      , NGAYTAO
      , NGUOITAO_ID
      , NGAYCAPNHAT
      , NGUOICAPNHAT_ID
      , LOAIBENHAN
      ) values (
      #BENHNHAN_ID#
      , #TIEPNHAN_ID#
      , #NGAYNHAPVIEN#
      , #THOIGIANNHAPVIEN#
      , #NOINHAPVIEN_ID#
      , #BACSICHIDINH_ID#
      , #LYDONHAPVIEN_ID#
      , #KHOADIEUTRI_ID#
      , #BENHAN_ID#
      , #SOBENHAN#
      , #KHAMBENH_ID#
      , #LOAIBENHAN_ID#
      , #ICD_CHANDOAN#
      , #CHANDOAN#
      , #CAPCUU#
      , #TRANGTHAI#
      , #CHUYENKHOA_ID#
      , #BENHVIEN_ID#
      , #NGAYTAO#
      , #NGUOITAO_ID#
      , #NGAYCAPNHAT#
      , #NGUOICAPNHAT_ID#
      , #LOAIBENHAN#
      )
      SELECT SCOPE_IDENTITY()
    </statement>

    <update id="DAO00066_Update" parameterClass="System.Collections.IDictionary">
      update TT_NOITRU_NHAPVIEN set
      BENHNHAN_ID = #BENHNHAN_ID#
      , TIEPNHAN_ID = #TIEPNHAN_ID#
      , NGAYNHAPVIEN = #NGAYNHAPVIEN#
      , THOIGIANNHAPVIEN = #THOIGIANNHAPVIEN#
      , NOINHAPVIEN_ID = #NOINHAPVIEN_ID#
      , BACSICHIDINH_ID = #BACSICHIDINH_ID#
      , LYDONHAPVIEN_ID = #LYDONHAPVIEN_ID#
      , KHOADIEUTRI_ID = #KHOADIEUTRI_ID#
      , BENHAN_ID = #BENHAN_ID#
      , SOBENHAN = #SOBENHAN#
      , KHAMBENH_ID = #KHAMBENH_ID#
      , LOAIBENHAN_ID = #LOAIBENHAN_ID#
      , ICD_CHANDOAN = #ICD_CHANDOAN#
      , CHANDOAN = #CHANDOAN#
      , CAPCUU = #CAPCUU#
      , TRANGTHAI = #TRANGTHAI#
      , CHUYENKHOA_ID = #CHUYENKHOA_ID#
      <!--, BENHVIEN_ID = #BENHVIEN_ID#
      , NGAYTAO = #NGAYTAO#
      , NGUOITAO_ID = #NGUOITAO_ID#-->
      , NGAYCAPNHAT = #NGAYCAPNHAT#
      , NGUOICAPNHAT_ID = #NGUOICAPNHAT_ID#
      where
      NHAPVIEN_ID = '$NHAPVIEN_ID$'
    </update>

    <statement id="DAO00066_Delete" parameterClass="System.Collections.IDictionary" resultClass="System.Int32">
      delete from TT_NOITRU_NHAPVIEN
      where
      NHAPVIEN_ID = '$NHAPVIEN_ID$'
    </statement>

    <statement id="DAO00066_DeleteP" parameterClass="System.Collections.IDictionary" resultClass="System.Int32">
      delete from TT_NOITRU_NHAPVIEN
      <dynamic prepend="where">
        <isParameterPresent>
          <isNotEmpty prepend="and" property="NHAPVIEN_ID">
            TT_NOITRU_NHAPVIEN.NHAPVIEN_ID = '$NHAPVIEN_ID$'
          </isNotEmpty>
          <isNotEmpty prepend="and" property="TIEPNHAN_ID">
            TT_NOITRU_NHAPVIEN.BENHNHAN_ID = '$BENHNHAN_ID$'
          </isNotEmpty>
          <isNotEmpty prepend="and" property="NGAYNHAPVIEN">
            TT_NOITRU_NHAPVIEN.NGAYNHAPVIEN = '$NGAYNHAPVIEN$'
          </isNotEmpty>
          <isNotEmpty prepend="and" property="THOIGIANNHAPVIEN">
            TT_NOITRU_NHAPVIEN.THOIGIANNHAPVIEN = '$THOIGIANNHAPVIEN$'
          </isNotEmpty>
          <isNotEmpty prepend="and" property="NOINHAPVIEN_ID">
            TT_NOITRU_NHAPVIEN.NOINHAPVIEN_ID = '$NOINHAPVIEN_ID$'
          </isNotEmpty>
          <isNotEmpty prepend="and" property="BACSICHIDINH_ID">
            TT_NOITRU_NHAPVIEN.BACSICHIDINH_ID = '$BACSICHIDINH_ID$'
          </isNotEmpty>
          <isNotEmpty prepend="and" property="LYDONHAPVIEN_ID">
            TT_NOITRU_NHAPVIEN.LYDONHAPVIEN_ID = '$LYDONHAPVIEN_ID$'
          </isNotEmpty>
          <isNotEmpty prepend="and" property="KHOADIEUTRI_ID">
            TT_NOITRU_NHAPVIEN.KHOADIEUTRI_ID = '$KHOADIEUTRI_ID$'
          </isNotEmpty>
          <isNotEmpty prepend="and" property="BENHAN_ID">
            TT_NOITRU_NHAPVIEN.BENHAN_ID = '$BENHAN_ID$'
          </isNotEmpty>
          <isNotEmpty prepend="and" property="SOBENHAN">
            TT_NOITRU_NHAPVIEN.SOBENHAN = '$SOBENHAN$'
          </isNotEmpty>
          <isNotEmpty prepend="and" property="KHAMBENH_ID">
            TT_NOITRU_NHAPVIEN.KHAMBENH_ID = '$KHAMBENH_ID$'
          </isNotEmpty>
          <isNotEmpty prepend="and" property="LOAIBENHAN_ID">
            TT_NOITRU_NHAPVIEN.LOAIBENHAN_ID = '$LOAIBENHAN_ID$'
          </isNotEmpty>
          <isNotEmpty prepend="and" property="ICD_CHANDOAN">
            TT_NOITRU_NHAPVIEN.ICD_CHANDOAN = '$ICD_CHANDOAN$'
          </isNotEmpty>
          <isNotEmpty prepend="and" property="CHANDOAN">
            TT_NOITRU_NHAPVIEN.CHANDOAN = '$CHANDOAN$'
          </isNotEmpty>
          <isNotEmpty prepend="and" property="CAPCUU">
            TT_NOITRU_NHAPVIEN.CAPCUU = '$CAPCUU$'
          </isNotEmpty>
          <isNotEmpty prepend="and" property="TRANGTHAI">
            TT_NOITRU_NHAPVIEN.TRANGTHAI = '$TRANGTHAI$'
          </isNotEmpty>
          <isNotEmpty prepend="and" property="CHUYENKHOA_ID">
            TT_NOITRU_NHAPVIEN.CHUYENKHOA_ID = '$CHUYENKHOA_ID$'
          </isNotEmpty>
          <isNotEmpty prepend="and" property="BENHVIEN_ID">
            TT_NOITRU_NHAPVIEN.BENHVIEN_ID = '$BENHVIEN_ID$'
          </isNotEmpty>
          <isNotEmpty prepend="and" property="NGAYTAO">
            TT_NOITRU_NHAPVIEN.NGAYTAO = '$NGAYTAO$'
          </isNotEmpty>
          <isNotEmpty prepend="and" property="NGUOITAO_ID">
            TT_NOITRU_NHAPVIEN.NGUOITAO_ID = '$NGUOITAO_ID$'
          </isNotEmpty>
          <isNotEmpty prepend="and" property="NGAYCAPNHAT">
            TT_NOITRU_NHAPVIEN.NGAYCAPNHAT = '$NGAYCAPNHAT$'
          </isNotEmpty>
          <isNotEmpty prepend="and" property="NGUOICAPNHAT_ID">
            TT_NOITRU_NHAPVIEN.NGUOICAPNHAT_ID = '$NGUOICAPNHAT_ID$'
          </isNotEmpty>
        </isParameterPresent>
      </dynamic>
    </statement>

    <statement id="DAO00066_Add_ntXacNhan" parameterClass="System.Collections.IDictionary" resultClass="System.Int64">
      insert into TT_NOITRU_XACNHAN (
      SOBENHAN
      , SOLUUTRU
      , LOAIBENHAN_ID
      , BENHAN_ID
      , PHONGBAN_ID
      , TIEPNHAN_ID
      , BENHNHAN_ID
      , NGAYLAP
      , THOIGIANLAP
      , LYDOVAO_ID
      , LYDOVAO_CODE
      , NGAYRAKHOA
      , THOIGIANRAKHOA
      , NOILAP_ID
      , LYDORA_ID
      , LYDORA_CODE
      , NGUOILAP_ID
      , ICD_RAKHOA
      , CHANDOANRAKHOA
      , PHONGBANTRUOC_ID
      , PHONGBANCHUYENDEN_ID
      , PHONGBANCHUYENDI_ID
      , LUUTRU_PREV
      , LUUTRU_CURRENT
      , BACSICHIDINH_ID
      , BACSIDIEUTRICHINH_ID
      , BACSIDIEUTRI_ID
      , KHOACHUYENDEN_ID
      <isPropertyAvailable prepend="," property="GIUONGDATTRUOC_ID">
        GIUONGDATTRUOC_ID
      </isPropertyAvailable>
      , LYDOCHUYENKHOA_ID
      , NGUOINHAP_ID
      , LANVAOVIEN
      , KHOAVAO_ID
      , NGAYVAOKHOA
      , THOIGIANVAOKHOA
      , KHOARA_ID
      , NGAYVAOVIEN
      , THOIGIANVAOVIEN
      , ICD_BENHCHINH
      , ICD_KHAMBENH
      , CHANDOANKHAMBENH
      , ICD_VAOKHOA
      , CHANDOANVAOKHOA
      , DSICDID
      , DOITUONG_ID
      , TRANGTHAI
      , CHUYENKHOA_ID
      , BENHVIEN_ID
      , NGAYTAO
      , NGUOITAO_ID
      , NGAYCAPNHAT
      , NGUOICAPNHAT_ID
      ) values (
      #SOBENHAN#
      , #SOLUUTRU#
      , #LOAIBENHAN_ID#
      , #BENHAN_ID#
      , #PHONGBAN_ID#
      , #TIEPNHAN_ID#
      , #BENHNHAN_ID#
      , #NGAYLAP#
      , #THOIGIANLAP#
      , #LYDOVAO_ID#
      , #LYDOVAO_CODE#
      , #NGAYRAKHOA#
      , #THOIGIANRAKHOA#
      , #NOILAP_ID#
      , #LYDORA_ID#
      , #LYDORA_CODE#
      , #NGUOILAP_ID#
      , #ICD_RAKHOA#
      , #CHANDOANRAKHOA#
      , #PHONGBANTRUOC_ID#
      , #PHONGBANCHUYENDEN_ID#
      , #PHONGBANCHUYENDI_ID#
      , #LUUTRU_PREV#
      , #LUUTRU_CURRENT#
      , #BACSICHIDINH_ID#
      , #BACSIDIEUTRICHINH_ID#
      , #BACSIDIEUTRI_ID#
      , #KHOACHUYENDEN_ID#
      <isPropertyAvailable prepend="," property="GIUONGDATTRUOC_ID">
        #GIUONGDATTRUOC_ID#
      </isPropertyAvailable>
      , #LYDOCHUYENKHOA_ID#
      , #NGUOINHAP_ID#
      , #LANVAOVIEN#
      , #KHOAVAO_ID#
      , #NGAYVAOKHOA#
      , #THOIGIANVAOKHOA#
      , #KHOARA_ID#
      , #NGAYVAOVIEN#
      , #THOIGIANVAOVIEN#
      , #ICD_BENHCHINH#
      , #ICD_KHAMBENH#
      , #CHANDOANKHAMBENH#
      , #ICD_VAOKHOA#
      , #CHANDOANVAOKHOA#
      , #DSICDID#
      , #DOITUONG_ID#
      , #TRANGTHAI#
      , #CHUYENKHOA_ID#
      , #BENHVIEN_ID#
      , #NGAYTAO#
      , #NGUOITAO_ID#
      , #NGAYCAPNHAT#
      , #NGUOICAPNHAT_ID#
      )
      SELECT SCOPE_IDENTITY()
    </statement>
    <statement id="DAO00066_Delete_ntXacNhan" parameterClass="System.Collections.IDictionary" resultClass="System.Int32">
      delete from TT_NOITRU_XACNHAN
      where
      SOBENHAN = '$SOBENHAN$'
    </statement>

    <statement id="DAO00066_DelNhapVienByTiepNhan" parameterClass="System.Collections.IDictionary" resultClass="System.Int32">
      delete from TT_NOITRU_NHAPVIEN
      where
      TIEPNHAN_ID = '$TIEPNHAN_ID$' and KHAMBENH_ID = '$KHAMBENH_ID$'
    </statement>
    <statement id="DAO00066_TT_NOITRU_BENHAN_LaySoCapCuu" parameterClass="System.Collections.IDictionary">
      select SOCAPCUU from  TT_NOITRU_BENHAN where BENHAN_ID = '$BENHAN_ID$'
    </statement>
    <update id="DAO00066_Update_TRANGTHAI_NOITRUXACNHAN" parameterClass="System.Collections.IDictionary">
      update TT_NOITRU_NHAPVIEN
      set
      TRANGTHAI = '$TRANGTHAI$',
      NGUOICAPNHAT_ID = '$NGUOICAPNHAT_ID$',
      NGAYCAPNHAT = '$NGAYCAPNHAT$'
      <isPropertyAvailable prepend="," property="KHOACHUYENDEN_ID">
        KHOADIEUTRI_ID = '$KHOACHUYENDEN_ID$'
      </isPropertyAvailable>
      where TIEPNHAN_ID = '$TIEPNHAN_ID$'
    </update>
    <update id="DAO00066_Update_TRANGTHAI_ntXacNhan_Huy" parameterClass="System.Collections.IDictionary">
      update TT_NOITRU_XACNHAN
      set TRANGTHAI = 'HUYXACNHAN'
      where SOBENHAN = '$SOBENHAN$'
    </update>
    <update id="DAO00066_Update_TRANGTHAI" parameterClass="System.Collections.IDictionary">
      update TT_NOITRU_XACNHAN
      set TRANGTHAI = 'DAXACNHAN', BENHAN_ID = #BENHAN_ID#
      where SOBENHAN = '$SOBENHAN$'
    </update>
    <update id="DAO00066_Update_TRANGTHAI_XACNHANCHUYENKHOA" parameterClass="System.Collections.IDictionary">
      update TT_NOITRU_XACNHAN
      set TRANGTHAI = 'DAXACNHAN'
      where SOBENHAN = '$SOBENHAN$'
    </update>
    <statement id="DAO00066_GetListXacNhanNhapVien" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
      select * from
      (
      SELECT ROW_NUMBER() OVER(order by A.SOTIEPNHAN) as ROWNUMBER, A.* From(
      select distinct A.*, B.SOTIEPNHAN, B.THOIGIANTIEPNHAN,
      C.MAYTE, C.TENBENHNHAN, C.NAMSINH, C.NGAYSINH, C.GIOITINH, B.NGUOIGIOITHIEU_ID,
      B.TRANGTHAI as TRANGTHAITIEPNHAN,
      case when A.TRANGTHAI = 'CHUYENKHOA' then N'Chuyển khoa' else N'Mới' end NGUONBENH,
      case when A.TRANGTHAI = 'CHUYENKHOA' then '1' else '0' end TRANGTHAI_CHUYENKHOA, D.NOINHAPVIEN_ID
		, DIACHITHUONGTRU, DANTOC_ID, B.SOBHYT as SOTHE
      ,BENHVIEN_STT_ID
      <!--, (select TOP 1 BENHVIEN_STT_ID from TM_BENHVIEN where MABENHVIEN = BENHVIEN_KCB_ID) AS BENHVIEN_STT_ID-->
      from TT_NOITRU_XACNHAN A
      inner join TT_TIEPNHAN B on A.TIEPNHAN_ID = B.TIEPNHAN_ID
      inner join TT_BENHNHAN C on B.BENHNHAN_ID = C.BENHNHAN_ID
      inner join TT_NOITRU_NHAPVIEN D on D.TIEPNHAN_ID = B.TIEPNHAN_ID
      left join (select MABENHVIEN, BENHVIEN_STT_ID from TM_BENHVIEN) H on SUBSTRING(B.SOBHYT, 16, 5)=H.MABENHVIEN
      where
      A.TRANGTHAI in ($TRANGTHAI$)
      <isNotEmpty prepend="" property="XACNHANVAOKHOA">
        <isEqual prepend="AND" property="XACNHANVAOKHOA" compareValue="1">
          A.KHOACHUYENDEN_ID = '$KHOACHUYENDEN_ID$'
        </isEqual>
        <isEqual prepend="AND" property="XACNHANVAOKHOA" compareValue="0">
          A.NOILAP_ID = '$KHOACHUYENDEN_ID$'
        </isEqual>
      </isNotEmpty>
      <!--and A.KHOACHUYENDEN_ID = '$KHOACHUYENDEN_ID$'-->
      <isNotEmpty prepend="and" property="TUNGAY">
        A.NGAYVAOVIEN &#62;&#61; '$TUNGAY$'
      </isNotEmpty>
      <isNotEmpty prepend="and" property="DENNGAY">
        A.NGAYVAOVIEN &#60;&#61; '$DENNGAY$'
      </isNotEmpty>
      <isNotEmpty prepend="and" property="MABENHNHAN">
        <!--C.MAYTE = '$MABENHNHAN$'-->
        (A.SOBENHAN like '%' + #MABENHNHAN# + '%' OR C.TENBENHNHAN like '%' + #MABENHNHAN# + '%')
      </isNotEmpty>
      <isNotEmpty prepend="and" property="BENHVIEN_ID">
        A.BENHVIEN_ID = '$BENHVIEN_ID$'
      </isNotEmpty>
      )A
      )lst
      where
      lst.ROWNUMBER between $FROMROW$ and $TOROW$
      order by lst.SOTIEPNHAN
    </statement>
    <statement id="DAO00066_GetCountXacNhanNhapVien" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
      SELECT count(*) as TOTALROWS
      from TT_NOITRU_XACNHAN A
      inner join TT_TIEPNHAN B on A.TIEPNHAN_ID = B.TIEPNHAN_ID
      inner join TT_BENHNHAN C on B.BENHNHAN_ID = C.BENHNHAN_ID
      inner join TT_NOITRU_NHAPVIEN D on D.TIEPNHAN_ID = B.TIEPNHAN_ID
      where
      A.TRANGTHAI in ($TRANGTHAI$)
      <isNotEmpty prepend="" property="XACNHANVAOKHOA">
        <isEqual prepend="AND" property="XACNHANVAOKHOA" compareValue="1">
          A.KHOACHUYENDEN_ID = '$KHOACHUYENDEN_ID$'
        </isEqual>
        <isEqual prepend="AND" property="XACNHANVAOKHOA" compareValue="0">
          A.NOILAP_ID = '$KHOACHUYENDEN_ID$'
        </isEqual>
      </isNotEmpty>
      <!--and A.KHOACHUYENDEN_ID = '$KHOACHUYENDEN_ID$'-->
      <isNotEmpty prepend="and" property="TUNGAY">
        A.NGAYVAOVIEN &#62;&#61; '$TUNGAY$'
      </isNotEmpty>
      <isNotEmpty prepend="and" property="DENNGAY">
        A.NGAYVAOVIEN &#60;&#61; '$DENNGAY$'
      </isNotEmpty>
      <isNotEmpty prepend="and" property="MABENHNHAN">
        <!--C.MAYTE = '$MABENHNHAN$'-->
        (A.SOBENHAN like '%' + #MABENHNHAN# + '%' OR C.TENBENHNHAN like '%' + #MABENHNHAN# + '%')
      </isNotEmpty>
      <isNotEmpty prepend="and" property="BENHVIEN_ID">
        A.BENHVIEN_ID = '$BENHVIEN_ID$'
      </isNotEmpty>
    </statement>
    <statement id="DAO00066_Update_ntXacNhan" parameterClass="System.Collections.IDictionary">
      update TT_NOITRU_XACNHAN set
      SOBENHAN = #SOBENHAN#
      <isPropertyAvailable prepend="," property="SOLUUTRU">
        SOLUUTRU = #SOLUUTRU#
      </isPropertyAvailable>
      <isPropertyAvailable prepend="," property="LOAIBENHAN_ID">
        LOAIBENHAN_ID = #LOAIBENHAN_ID#
      </isPropertyAvailable>
      <isPropertyAvailable prepend="," property="BENHAN_ID">
        BENHAN_ID = #BENHAN_ID#
      </isPropertyAvailable>
      <isPropertyAvailable prepend="," property="PHONGBAN_ID">
        PHONGBAN_ID = #PHONGBAN_ID#
      </isPropertyAvailable>
      <isPropertyAvailable prepend="," property="TIEPNHAN_ID">
        TIEPNHAN_ID = #TIEPNHAN_ID#
      </isPropertyAvailable>
      <isPropertyAvailable prepend="," property="BENHNHAN_ID">
        BENHNHAN_ID = #BENHNHAN_ID#
      </isPropertyAvailable>
      <isPropertyAvailable prepend="," property="NGAYLAP">
        NGAYLAP = #NGAYLAP#
      </isPropertyAvailable>
      <isPropertyAvailable prepend="," property="THOIGIANLAP">
        THOIGIANLAP = #THOIGIANLAP#
      </isPropertyAvailable>
      <isPropertyAvailable prepend="," property="LYDOVAO_ID">
        LYDOVAO_ID = #LYDOVAO_ID#
      </isPropertyAvailable>
      <isPropertyAvailable prepend="," property="LYDOVAO_CODE">
        LYDOVAO_CODE = #LYDOVAO_CODE#
      </isPropertyAvailable>
      <isPropertyAvailable prepend="," property="NGAYRAKHOA">
        NGAYRAKHOA = #NGAYRAKHOA#
      </isPropertyAvailable>
      <isPropertyAvailable prepend="," property="THOIGIANRAKHOA">
        THOIGIANRAKHOA = #THOIGIANRAKHOA#
      </isPropertyAvailable>
      <isPropertyAvailable prepend="," property="NOILAP_ID">
        NOILAP_ID = #NOILAP_ID#
      </isPropertyAvailable>
      <isPropertyAvailable prepend="," property="LYDORA_ID">
        LYDORA_ID = #LYDORA_ID#
      </isPropertyAvailable>
      <isPropertyAvailable prepend="," property="LYDORA_CODE">
        LYDORA_CODE = #LYDORA_CODE#
      </isPropertyAvailable>
      <isPropertyAvailable prepend="," property="NGUOILAP_ID">
        NGUOILAP_ID = #NGUOILAP_ID#
      </isPropertyAvailable>
      <isPropertyAvailable prepend="," property="ICD_RAKHOA">
        ICD_RAKHOA = #ICD_RAKHOA#
      </isPropertyAvailable>
      <isPropertyAvailable prepend="," property="CHANDOANRAKHOA">
        CHANDOANRAKHOA = #CHANDOANRAKHOA#
      </isPropertyAvailable>
      <isPropertyAvailable prepend="," property="PHONGBANTRUOC_ID">
        PHONGBANTRUOC_ID = #PHONGBANTRUOC_ID#
      </isPropertyAvailable>
      <isPropertyAvailable prepend="," property="PHONGBANCHUYENDEN_ID">
        PHONGBANCHUYENDEN_ID = #PHONGBANCHUYENDEN_ID#
      </isPropertyAvailable>
      <isPropertyAvailable prepend="," property="PHONGBANCHUYENDI_ID">
        PHONGBANCHUYENDI_ID = #PHONGBANCHUYENDI_ID#
      </isPropertyAvailable>
      <isPropertyAvailable prepend="," property="GIUONGDATTRUOC_ID">
        GIUONGDATTRUOC_ID = #GIUONGDATTRUOC_ID#
      </isPropertyAvailable>
      <isPropertyAvailable prepend="," property="LUUTRU_PREV">
        LUUTRU_PREV = #LUUTRU_PREV#
      </isPropertyAvailable>
      <isPropertyAvailable prepend="," property="LUUTRU_CURRENT">
        LUUTRU_CURRENT = #LUUTRU_CURRENT#
      </isPropertyAvailable>
      <isPropertyAvailable prepend="," property="BACSICHIDINH_ID">
        BACSICHIDINH_ID = #BACSICHIDINH_ID#
      </isPropertyAvailable>
      <isPropertyAvailable prepend="," property="BACSIDIEUTRICHINH_ID">
        BACSIDIEUTRICHINH_ID = #BACSIDIEUTRICHINH_ID#
      </isPropertyAvailable>
      <isPropertyAvailable prepend="," property="BACSIDIEUTRI_ID">
        BACSIDIEUTRI_ID = #BACSIDIEUTRI_ID#
      </isPropertyAvailable>
      <isPropertyAvailable prepend="," property="KHOACHUYENDEN_ID">
        KHOACHUYENDEN_ID = #KHOACHUYENDEN_ID#
      </isPropertyAvailable>
      <isPropertyAvailable prepend="," property="LYDOCHUYENKHOA_ID">
        LYDOCHUYENKHOA_ID = #LYDOCHUYENKHOA_ID#
      </isPropertyAvailable>
      <isPropertyAvailable prepend="," property="NGUOINHAP_ID">
        NGUOINHAP_ID = #NGUOINHAP_ID#
      </isPropertyAvailable>
      <isPropertyAvailable prepend="," property="LANVAOVIEN">
        LANVAOVIEN = #LANVAOVIEN#
      </isPropertyAvailable>
      <isPropertyAvailable prepend="," property="KHOAVAO_ID">
        KHOAVAO_ID = #KHOAVAO_ID#
      </isPropertyAvailable>
      <isPropertyAvailable prepend="," property="NGAYVAOKHOA">
        NGAYVAOKHOA = #NGAYVAOKHOA#
      </isPropertyAvailable>
      <isPropertyAvailable prepend="," property="THOIGIANVAOKHOA">
        THOIGIANVAOKHOA = #THOIGIANVAOKHOA#
      </isPropertyAvailable>
      <isPropertyAvailable prepend="," property="KHOARA_ID">
        KHOARA_ID = #KHOARA_ID#
      </isPropertyAvailable>
      <isPropertyAvailable prepend="," property="NGAYVAOVIEN">
        NGAYVAOVIEN = #NGAYVAOVIEN#
      </isPropertyAvailable>
      <isPropertyAvailable prepend="," property="THOIGIANVAOVIEN">
        THOIGIANVAOVIEN = #THOIGIANVAOVIEN#
      </isPropertyAvailable>
      <isPropertyAvailable prepend="," property="ICD_BENHCHINH">
        ICD_BENHCHINH = #ICD_BENHCHINH#
      </isPropertyAvailable>
      <isPropertyAvailable prepend="," property="ICD_KHAMBENH">
        ICD_KHAMBENH = #ICD_KHAMBENH#
      </isPropertyAvailable>
      <isPropertyAvailable prepend="," property="CHANDOANKHAMBENH">
        CHANDOANKHAMBENH = #CHANDOANKHAMBENH#
      </isPropertyAvailable>
      <isPropertyAvailable prepend="," property="ICD_VAOKHOA">
        ICD_VAOKHOA = #ICD_VAOKHOA#
      </isPropertyAvailable>
      <isPropertyAvailable prepend="," property="CHANDOANVAOKHOA">
        CHANDOANVAOKHOA = #CHANDOANVAOKHOA#
      </isPropertyAvailable>
      <isPropertyAvailable prepend="," property="DSICDID">
        DSICDID = #DSICDID#
      </isPropertyAvailable>
      <isPropertyAvailable prepend="," property="DOITUONG_ID">
        DOITUONG_ID = #DOITUONG_ID#
      </isPropertyAvailable>
      <isPropertyAvailable prepend="," property="TRANGTHAI">
        TRANGTHAI = #TRANGTHAI#
      </isPropertyAvailable>
      <isPropertyAvailable prepend="," property="CHUYENKHOA_ID">
        CHUYENKHOA_ID = #CHUYENKHOA_ID#
      </isPropertyAvailable>
      <!--<isPropertyAvailable prepend="," property="BENHVIEN_ID">
        BENHVIEN_ID = #BENHVIEN_ID#
      </isPropertyAvailable>
      <isPropertyAvailable prepend="," property="NGAYTAO">
        NGAYTAO = #NGAYTAO#
      </isPropertyAvailable>
      <isPropertyAvailable prepend="," property="NGUOITAO_ID">
        NGUOITAO_ID = #NGUOITAO_ID#
      </isPropertyAvailable>-->
      <isPropertyAvailable prepend="," property="NGAYCAPNHAT">
        NGAYCAPNHAT = #NGAYCAPNHAT#
      </isPropertyAvailable>
      <isPropertyAvailable prepend="," property="NGUOICAPNHAT_ID">
        NGUOICAPNHAT_ID = #NGUOICAPNHAT_ID#
      </isPropertyAvailable>
      where
      SOBENHAN = '$SOBENHAN$'
      <!--SELECT SCOPE_IDENTITY()-->
      <!--<selectKey resultClass="System.Int64" type="post" >
        SELECT @@IDENTITY as value
      </selectKey>-->
    </statement>
    <statement id="DAO00066_GetNoiTruNhapVienWithSoBenhAn"  parameterClass="System.Collections.IDictionary" resultClass="DataObject">
      select *
      from TT_NOITRU_XACNHAN
      where SOBENHAN = '$SOBENHAN$'
      order by SOBENHAN
    </statement>
    <statement id="DAO00066_GetBenhNhanTiepNhanChoVaoKhoa"  parameterClass="System.Collections.IDictionary" resultClass="DataObject">
      select *
      from TT_NOITRU_XACNHAN
      where
      TIEPNHAN_ID = '$TIEPNHAN_ID$'
      and BENHNHAN_ID = '$BENHNHAN_ID$'
      and TRANGTHAI = 'CHOXACNHAN'
      and BENHVIEN_ID = '$BENHVIEN_ID$'
      order by SOBENHAN
    </statement>
    <statement id="DAO00066_GetBenhNhanTiepNhanDaXacNhanVaoKhoa"  parameterClass="System.Collections.IDictionary" resultClass="DataObject">
      select *
      from TT_NOITRU_XACNHAN
      where
      TIEPNHAN_ID = '$TIEPNHAN_ID$'
      and BENHNHAN_ID = '$BENHNHAN_ID$'
      and TRANGTHAI = 'DAXACNHAN'
      and SOBENHAN
      in (select SOBENHAN from TT_NOITRU_BENHAN where BENHNHAN_ID = '$BENHNHAN_ID$' and TRANGTHAI != 'DAKHOA' and BENHVIEN_ID = '$BENHVIEN_ID$')
      and BENHVIEN_ID = '$BENHVIEN_ID$'
      order by SOBENHAN
    </statement>

    <update id="DAO00066_CapNhatTrangThaiXacNhan" parameterClass="System.Collections.IDictionary">
      update TT_NOITRU_XACNHAN
      set TRANGTHAI = '$TRANGTHAI$',
      NGAYCAPNHAT = '$NGAYCAPNHAT$',
      NGUOICAPNHAT_ID = '$NGUOICAPNHAT_ID$'
      where NOITRU_XACNHAN_ID = '$NOITRU_XACNHAN_ID$'

    </update>
    <statement id="DAO00066_GetListTiepNhanNhapVienNgoaiTru" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
      select
      A.KHOADIEUTRI_ID, A.NGAYNHAPVIEN, A.THOIGIANNHAPVIEN  as THOIGIANCHIDINH, A.CHANDOAN,
      B.SOTIEPNHAN, B.THOIGIANTIEPNHAN, A.BACSICHIDINH_ID, B.DOITUONG_ID,
      C.MAYTE, C.TENBENHNHAN, C.NAMSINH, C.NGAYSINH, A.SOBENHAN, A.BENHVIEN_ID, C.GIOITINH,
      A.BENHNHAN_ID, A.TIEPNHAN_ID, A.NOINHAPVIEN_ID, A.NHAPVIEN_ID, A.ICD_CHANDOAN,
      B.TRANGTHAI, A.BENHAN_ID, B.NGUOIGIOITHIEU_ID, A.TRANGTHAI as TRANGTHAINHAPVIEN, A.CHUYENKHOA_ID
      from TT_NOITRU_NHAPVIEN A
      inner join TT_TIEPNHAN B on A.BENHNHAN_ID = B.BENHNHAN_ID and  A.TIEPNHAN_ID = B.TIEPNHAN_ID
      inner join TT_BENHNHAN C on B.BENHNHAN_ID = C.BENHNHAN_ID
      where
      (A.TRANGTHAI = 'CHOXACNHAN' OR A.TRANGTHAI = 'CHONHAPKHOA')
      AND A.LOAIBENHAN = '$LOAIBENHAN$'
      <isNotEmpty prepend="and" property="TUNGAY">
        cast(A.NGAYNHAPVIEN as date) >= cast(#TUNGAY# as date)
      </isNotEmpty>
      <isNotEmpty prepend="and" property="DENNGAY">
        cast(A.NGAYNHAPVIEN as date) &lt;= cast(#DENNGAY# as date)
      </isNotEmpty>
      <isNotEmpty prepend="And" property="LIST_KHOADIEUTRI_ID">
        A.KHOADIEUTRI_ID in ($LIST_KHOADIEUTRI_ID$)
      </isNotEmpty>
      <isNotEmpty prepend="and" property="MABENHNHAN">
        (C.MAYTE like '%' + #MABENHNHAN# + '%' or C.TENBENHNHAN like '%' + #MABENHNHAN# + '%')
      </isNotEmpty>
      <isNotEmpty prepend="and" property="BENHVIEN_ID">
        A.BENHVIEN_ID = '$BENHVIEN_ID$'
      </isNotEmpty>
      <isNotEmpty prepend="" property="TRANGTHAI">
        <isEqual prepend="AND" property="TRANGTHAI" compareValue="02">
          A.BENHAN_ID is NULL
        </isEqual>
        <isEqual prepend="AND" property="TRANGTHAI" compareValue="03">
          A.BENHAN_ID is not NULL
        </isEqual>
      </isNotEmpty>
      order by B.SOTIEPNHAN
    </statement>
    <statement id="DAO00066_GetListNgoaiTruDaChuyenKhoa" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
      select * from
      (
      SELECT ROW_NUMBER() OVER(order by B.SOTIEPNHAN) as ROWNUMBER,
      A.*, B.SOTIEPNHAN, B.THOIGIANTIEPNHAN, khoachuyenden.TENPHONGBAN as KHOACHUYENDEN,
      C.MAYTE, C.TENBENHNHAN, C.NAMSINH, C.NGAYSINH, C.GIOITINH, B.NGUOIGIOITHIEU_ID,
      B.TRANGTHAI as TRANGTHAITIEPNHAN,
      case when A.PHONGBANCHUYENDEN_ID is not null then N'Chuyển khoa' else N'Mới' end NGUONBENH,
      E.TENPHONGBAN as NOICHIDINH
      from TT_NOITRU_XACNHAN A
      inner join TT_TIEPNHAN B on A.TIEPNHAN_ID = B.TIEPNHAN_ID
      inner join TT_BENHNHAN C on B.BENHNHAN_ID = C.BENHNHAN_ID
      inner join TT_NOITRU_NHAPVIEN D on D.TIEPNHAN_ID = B.TIEPNHAN_ID
      left join TM_PHONGBAN E on E.PHONGBAN_ID = A.NOILAP_ID
      left join TM_PHONGBAN khoachuyenden on khoachuyenden.PHONGBAN_ID = A.PHONGBANCHUYENDI_ID
      where
      A.TRANGTHAI='CHUYENKHOA'
      and A.PHONGBANCHUYENDEN_ID = '$KHOACHUYENDEN_ID$'
      and D.LOAIBENHAN = '$LOAIBENHAN$'
      <isNotEmpty prepend="and" property="TUNGAY">
        A.NGAYVAOVIEN &#62;&#61; '$TUNGAY$'
      </isNotEmpty>
      <isNotEmpty prepend="and" property="DENNGAY">
        A.NGAYVAOVIEN &#60;&#61; '$DENNGAY$'
      </isNotEmpty>
      <isNotEmpty prepend="and" property="MABENHNHAN">
        (A.SOBENHAN like '%' + #MABENHNHAN# + '%' OR C.TENBENHNHAN like '%' + #MABENHNHAN# + '%' OR C.MAYTE like '%' + #MABENHNHAN# + '%')
      </isNotEmpty>
      <isNotEmpty prepend="and" property="BENHVIEN_ID">
        A.BENHVIEN_ID = '$BENHVIEN_ID$'
      </isNotEmpty>
      )lst
      where
      lst.ROWNUMBER between $FROMROW$ and $TOROW$
      order by lst.SOTIEPNHAN
    </statement>
    <statement id="DAO00066_GetCountNhapVienNgoaiTruDaChuyenKhoa" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
      select count(B.SOTIEPNHAN) as TOTALROWS
      from TT_NOITRU_XACNHAN A
      inner join TT_TIEPNHAN B on A.TIEPNHAN_ID = B.TIEPNHAN_ID
      inner join TT_BENHNHAN C on B.BENHNHAN_ID = C.BENHNHAN_ID
      inner join TT_NOITRU_NHAPVIEN D on D.TIEPNHAN_ID = B.TIEPNHAN_ID
      where
      A.TRANGTHAI='CHUYENKHOA'
      and A.PHONGBANCHUYENDEN_ID = '$KHOACHUYENDEN_ID$'
      and D.LOAIBENHAN = '$LOAIBENHAN$'
      <isNotEmpty prepend="and" property="TUNGAY">
        A.NGAYVAOVIEN &#62;&#61; '$TUNGAY$'
      </isNotEmpty>
      <isNotEmpty prepend="and" property="DENNGAY">
        A.NGAYVAOVIEN &#60;&#61; '$DENNGAY$'
      </isNotEmpty>
      <isNotEmpty prepend="and" property="MABENHNHAN">
        (A.SOBENHAN like '%' + #MABENHNHAN# + '%' OR C.TENBENHNHAN like '%' + #MABENHNHAN# + '%')
      </isNotEmpty>
      <isNotEmpty prepend="and" property="BENHVIEN_ID">
        A.BENHVIEN_ID = '$BENHVIEN_ID$'
      </isNotEmpty>
    </statement>
    <statement id="DAO00066_GetCountXacNhanNhapVienNgoaiTru" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
      select count(B.SOTIEPNHAN) as TOTALROWS
      from TT_NOITRU_XACNHAN A
      inner join TT_TIEPNHAN B on A.TIEPNHAN_ID = B.TIEPNHAN_ID
      inner join TT_BENHNHAN C on B.BENHNHAN_ID = C.BENHNHAN_ID
      inner join TT_NOITRU_NHAPVIEN D on D.TIEPNHAN_ID = B.TIEPNHAN_ID
      where
      (A.TRANGTHAI='CHOXACNHAN' or A.TRANGTHAI='CHUYENKHOA')
      and A.KHOACHUYENDEN_ID = '$KHOACHUYENDEN_ID$'
      and D.LOAIBENHAN = '$LOAIBENHAN$'
      <isNotEmpty prepend="and" property="TUNGAY">
        A.NGAYVAOVIEN &#62;&#61; '$TUNGAY$'
      </isNotEmpty>
      <isNotEmpty prepend="and" property="DENNGAY">
        A.NGAYVAOVIEN &#60;&#61; '$DENNGAY$'
      </isNotEmpty>
      <isNotEmpty prepend="and" property="MABENHNHAN">
        (A.SOBENHAN like '%' + #MABENHNHAN# + '%' OR C.TENBENHNHAN like '%' + #MABENHNHAN# + '%')
      </isNotEmpty>
      <isNotEmpty prepend="and" property="BENHVIEN_ID">
        A.BENHVIEN_ID = '$BENHVIEN_ID$'
      </isNotEmpty>
    </statement>
    <statement id="DAO00066_GetListXacNhanNhapVienNgoaiTru" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
      select * from
      (
      SELECT ROW_NUMBER() OVER(order by B.SOTIEPNHAN) as ROWNUMBER,
      A.*, B.SOTIEPNHAN, B.THOIGIANTIEPNHAN,
      C.MAYTE, C.TENBENHNHAN, C.NAMSINH, C.NGAYSINH, C.GIOITINH, B.NGUOIGIOITHIEU_ID,
      B.TRANGTHAI as TRANGTHAITIEPNHAN, D.NOINHAPVIEN_ID,
      case when A.PHONGBANCHUYENDEN_ID is not null then N'Chuyển khoa' else N'Mới' end NGUONBENH
      from TT_NOITRU_XACNHAN A
      inner join TT_TIEPNHAN B on A.TIEPNHAN_ID = B.TIEPNHAN_ID
      inner join TT_BENHNHAN C on B.BENHNHAN_ID = C.BENHNHAN_ID
      inner join TT_NOITRU_NHAPVIEN D on D.TIEPNHAN_ID = B.TIEPNHAN_ID
      where
      (A.TRANGTHAI='CHOXACNHAN' or A.TRANGTHAI='CHUYENKHOA')
      and A.KHOACHUYENDEN_ID = '$KHOACHUYENDEN_ID$'
      and D.LOAIBENHAN = '$LOAIBENHAN$'
      <isNotEmpty prepend="and" property="TUNGAY">
        A.NGAYVAOVIEN &#62;&#61; '$TUNGAY$'
      </isNotEmpty>
      <isNotEmpty prepend="and" property="DENNGAY">
        A.NGAYVAOVIEN &#60;&#61; '$DENNGAY$'
      </isNotEmpty>
      <isNotEmpty prepend="and" property="MABENHNHAN">
        (A.SOBENHAN like '%' + #MABENHNHAN# + '%' OR C.TENBENHNHAN like '%' + #MABENHNHAN# + '%' OR C.MAYTE like '%' + #MABENHNHAN# + '%')
      </isNotEmpty>
      <isNotEmpty prepend="and" property="BENHVIEN_ID">
        A.BENHVIEN_ID = '$BENHVIEN_ID$'
      </isNotEmpty>
      )lst
      where
      lst.ROWNUMBER between $FROMROW$ and $TOROW$
      order by lst.SOTIEPNHAN
    </statement>
    <statement id="DAO00066_GetListDieuTriNgoaiTruHoanTat" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
      select
      A.KHOACHUYENDEN_ID as KHOADIEUTRI_ID, A.NGAYRAVIEN, A.THOIGIANVAOVIEN, A.CHANDOANVAOKHOA as CHANDOAN,
      B.SOTIEPNHAN, B.THOIGIANTIEPNHAN, A.BACSIDIEUTRI_ID, B.DOITUONG_ID,
      C.MAYTE, C.TENBENHNHAN, C.NAMSINH, C.NGAYSINH, A.SOBENHAN, A.BENHVIEN_ID, C.GIOITINH,
      A.BENHNHAN_ID, A.TIEPNHAN_ID, A.NOILAP_ID as NOINHAPVIEN_ID, A.ICD_BENHCHINH as ICD_CHANDOAN,
      B.TRANGTHAI, A.BENHAN_ID, B.NGUOIGIOITHIEU_ID, A.TRANGTHAI as TRANGTHAINHAPVIEN, A.CHUYENKHOA_ID, A.KHOAVAO_ID,
      B.SOBHYT as SOTHE
      from TT_NOITRU_BENHAN A
      inner join TT_TIEPNHAN B on A.BENHNHAN_ID = B.BENHNHAN_ID and  A.TIEPNHAN_ID = B.TIEPNHAN_ID
      inner join TT_BENHNHAN C on B.BENHNHAN_ID = C.BENHNHAN_ID
      where
      (A.TRANGTHAI like '%DAXUATVIEN%' OR A.TRANGTHAI like '%DATHANHTOAN%')
      AND A.LOAIBENHAN = '$LOAIBENHAN$'
      <isNotEmpty prepend="and" property="TUNGAY">
        A.NGAYRAVIEN &#62;&#61; '$TUNGAY$'
      </isNotEmpty>
      <isNotEmpty prepend="and" property="DENNGAY">
        A.NGAYRAVIEN &#60;&#61; '$DENNGAY$'
      </isNotEmpty>
      <isNotEmpty prepend="And" property="KHOADIEUTRI_ID">
        A.KHOACHUYENDEN_ID = '$KHOADIEUTRI_ID$'
      </isNotEmpty>
      <isNotEmpty prepend="and" property="MABENHNHAN">
        (C.MAYTE like '%' + #MABENHNHAN# + '%' or C.TENBENHNHAN like '%' + #MABENHNHAN# + '%')
      </isNotEmpty>
      <isNotEmpty prepend="and" property="BENHVIEN_ID">
        A.BENHVIEN_ID = '$BENHVIEN_ID$'
      </isNotEmpty>
      <isNotEmpty prepend="" property="TRANGTHAI">
        <isEqual prepend="AND" property="TRANGTHAI" compareValue="02">
          A.BENHAN_ID is NULL
        </isEqual>
        <isEqual prepend="AND" property="TRANGTHAI" compareValue="03">
          A.BENHAN_ID is not NULL
        </isEqual>
      </isNotEmpty>
      order by B.SOTIEPNHAN
    </statement>
    <statement id="DAO00066_GetNoiTruNhapVienByTiepNhan" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
      SELECT *
      FROM TT_NOITRU_NHAPVIEN
      WHERE BENHVIEN_ID = '$BENHVIEN_ID$' AND TIEPNHAN_ID = '$TIEPNHAN_ID$'
    </statement>
    <statement id="DAO00066_TT_NOITRU_NHAPVIEN_NhapVienID_Exist" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
      SELECT *
      FROM TT_NOITRU_NHAPVIEN
      WHERE NHAPVIEN_ID = '$NHAPVIEN_ID$'
    </statement>
    <statement id="DAO00066_TT_NOITRU_XACNHANGetBenhNhanTiepNhan"  parameterClass="System.Collections.IDictionary" resultClass="DataObject">
      select *
      from TT_NOITRU_XACNHAN
      where
      TIEPNHAN_ID = '$TIEPNHAN_ID$'
      and BENHNHAN_ID = '$BENHNHAN_ID$'
      and BENHVIEN_ID = '$BENHVIEN_ID$'
      order by SOBENHAN
    </statement>
  </statements>
</sqlMap>