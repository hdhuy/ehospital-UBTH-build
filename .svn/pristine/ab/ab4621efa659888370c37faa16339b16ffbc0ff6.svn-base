<?xml version="1.0" encoding="utf-8" ?>
<!--============================================================================
//	CAUTION: This file is generated by IBatisNetGen.3.SQLMap.cst at 10/19/2015 7:57:18 AM
//				Any manual editing will be lost in re-generation.
//===========================================================================-->
<sqlMap namespace="eHospital" xmlns="http://ibatis.apache.org/mapping" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" >
  <statements>
    <statement id="DAOWF004_kiemtratiepnhan" resultClass="DataObject">
      select * from TT_REQUEST
      where
      PARA = '$PARA$'      
      AND ISACTIVE = '1'
    </statement>
    <statement id="DAOWF004_laytrangthaiDV" resultClass="DataObject">
      <!--select A.CURR_STATE_CODE as STATE_CODE, isNull(C.SHORT_NAME,C.NAME) as TRANGTHAI, C.NAME as TRANGTHAI_CHITIET, '1' as ACTIVE, C.STATUS_CODE
      from TT_REQUEST_SERVICE A
      inner join TT_REQUEST B on B.ID = A.REQUEST_ID and B.ISACTIVE = '1' and B.PARA = '$PARA$'
      left join TM_STATE C on A.CURR_STATE_CODE = C.STATE_CODE and C.PROCESS_CODE = B.PROCESS_CODE
      where
      A.PARA = '$SERVICEPARA$' AND
      A.ISACTIVE = '1'
      union
      select A.CURR_STATE_CODE as STATE_CODE, isNull(C.SHORT_NAME,C.NAME) as TRANGTHAI, C.NAME as TRANGTHAI_CHITIET, '0' as ACTIVE, C.STATUS_CODE
      from TT_REQUEST_SERVICE A
      inner join TT_REQUEST B on B.ID = A.REQUEST_ID and B.ISACTIVE = '1' and B.PARA = '$PARA$'
      left join TM_STATE C on A.CURR_STATE_CODE = C.STATE_CODE and C.PROCESS_CODE = B.PROCESS_CODE
      where
      A.PARA = '$SERVICEPARA$' AND
      A.ISACTIVE = '0'-->
      <!--select top 1 A.CURR_STATE_CODE as STATE_CODE, isNull(C.SHORT_NAME,C.NAME) as TRANGTHAI, C.NAME as TRANGTHAI_CHITIET, C.STATUS_CODE, D.ISACTIVE as ACTIVE, E.STATUS_CODE  as OLD_STATUSCODE
      from TT_REQUEST_SERVICE_DETAIL A
      left join (select * from TT_REQUEST where PARA = '$PARA$') B on B.ID = A.REQUEST_ID
      left join (select * from TT_REQUEST_SERVICE where PARA = '$SERVICEPARA$') D on D.ID = A.REQUEST_SERVICE_ID
      left join TM_STATE C on A.CURR_STATE_CODE = C.STATE_CODE and C.PROCESS_CODE = B.PROCESS_CODE
      left join TM_STATE E on A.OLD_STATE_CODE = E.STATE_CODE and E.PROCESS_CODE = B.PROCESS_CODE
      where
      A.REQUEST_ID = (select ID from TT_REQUEST where PARA = '$PARA$')
      and A.REQUEST_SERVICE_ID = (select ID from TT_REQUEST_SERVICE where PARA = '$SERVICEPARA$')
      order by A.ID desc-->
      
      select top 1 A.CURR_STATE_CODE as STATE_CODE, isNull(C.SHORT_NAME,C.NAME) as TRANGTHAI, C.NAME as TRANGTHAI_CHITIET, C.STATUS_CODE, D.ISACTIVE as ACTIVE, E.STATUS_CODE  as OLD_STATUSCODE
      from TT_REQUEST_SERVICE_DETAIL A
      <!--left join (select * from TT_REQUEST where PARA = '$PARA$') B on B.ID = A.REQUEST_ID-->
      left join (select * from TT_REQUEST_SERVICE where PARA = '$SERVICEPARA$') D on D.ID = A.REQUEST_SERVICE_ID
      left join TM_STATE C on A.CURR_STATE_CODE = C.STATE_CODE and C.PROCESS_CODE = D.PROCESS_CODE
      left join TM_STATE E on A.OLD_STATE_CODE = E.STATE_CODE and E.PROCESS_CODE = D.PROCESS_CODE
      where
      A.REQUEST_SERVICE_ID = (select ID from TT_REQUEST_SERVICE where PARA = '$SERVICEPARA$')
      order by A.ID desc
    </statement>
  </statements>
</sqlMap>