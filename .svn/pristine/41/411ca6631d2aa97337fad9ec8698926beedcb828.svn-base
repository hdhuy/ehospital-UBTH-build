<?xml version="1.0" encoding="utf-8" ?>
<!--============================================================================
//	CAUTION: This file is generated by IBatisNetGen.3.SQLMap.cst at 11/11/2015 9:30:18 AM
//				Any manual editing will be lost in re-generation.
//===========================================================================-->
<sqlMap namespace="eHospital" xmlns="http://ibatis.apache.org/mapping" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
  <statements>
    <statement id="DAO00062_GetAll" resultClass="DataObject">
      select *
      from TT_NOITRU_KHAMBENH
      order by KHAMBENH_ID
    </statement>
    <statement id="DAO00062_GetList" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
      select *
      from TT_NOITRU_KHAMBENH
      <dynamic prepend="where">
        <isParameterPresent>
          <isNotEmpty prepend="and" property="KHAMBENH_ID">
            KHAMBENH_ID = '$KHAMBENH_ID$'
          </isNotEmpty>
          <isNotEmpty prepend="and" property="BENHAN_ID">
            BENHAN_ID = '$BENHAN_ID$'
          </isNotEmpty>
          <isNotEmpty prepend="and" property="LUUTRU_ID">
            LUUTRU_ID = '$LUUTRU_ID$'
          </isNotEmpty>
          <isNotEmpty prepend="and" property="LANKHAM">
            LANKHAM = '$LANKHAM$'
          </isNotEmpty>
          <isNotEmpty prepend="and" property="NGAYKHAM">
            NGAYKHAM = '$NGAYKHAM$'
          </isNotEmpty>
          <isNotEmpty prepend="and" property="THOIGIANKHAM">
            THOIGIANKHAM = '$THOIGIANKHAM$'
          </isNotEmpty>
          <isNotEmpty prepend="and" property="BACSIKHAM_ID">
            BACSIKHAM_ID = '$BACSIKHAM_ID$'
          </isNotEmpty>
          <isNotEmpty prepend="and" property="DIEUDUONG_ID">
            DIEUDUONG_ID = '$DIEUDUONG_ID$'
          </isNotEmpty>
          <isNotEmpty prepend="and" property="CAPHOLY_ID">
            CAPHOLY_ID = '$CAPHOLY_ID$'
          </isNotEmpty>
          <isNotEmpty prepend="and" property="DOITUONG_ID">
            DOITUONG_ID = '$DOITUONG_ID$'
          </isNotEmpty>
          <isNotEmpty prepend="and" property="PHATDO_DIEUTRI_ID">
            PHATDO_DIEUTRI_ID = '$PHATDO_DIEUTRI_ID$'
          </isNotEmpty>
          <isNotEmpty prepend="and" property="DINHBENH">
            DINHBENH = '$DINHBENH$'
          </isNotEmpty>
          <isNotEmpty prepend="and" property="DIENBIEN">
            DIENBIEN = '$DIENBIEN$'
          </isNotEmpty>
          <isNotEmpty prepend="and" property="LOIDAN">
            LOIDAN = '$LOIDAN$'
          </isNotEmpty>
          <isNotEmpty prepend="and" property="CHEDOANUONG_ID">
            CHEDOANUONG_ID = '$CHEDOANUONG_ID$'
          </isNotEmpty>
          <isNotEmpty prepend="and" property="CHEDOCHAMSOC_ID">
            CHEDOCHAMSOC_ID = '$CHEDOCHAMSOC_ID$'
          </isNotEmpty>
          <isNotEmpty prepend="and" property="CHUNGTUPHATTHUOC_ID">
            CHUNGTUPHATTHUOC_ID = '$CHUNGTUPHATTHUOC_ID$'
          </isNotEmpty>
          <isNotEmpty prepend="and" property="KHODUOC_ID">
            KHODUOC_ID = '$KHODUOC_ID$'
          </isNotEmpty>
          <isNotEmpty prepend="and" property="NOINHANTHUOC_ID">
            NOINHANTHUOC_ID = '$NOINHANTHUOC_ID$'
          </isNotEmpty>
          <isNotEmpty prepend="and" property="LOAITOATHUOC">
            LOAITOATHUOC = '$LOAITOATHUOC$'
          </isNotEmpty>
          <isNotEmpty prepend="and" property="THUOCDACTRI">
            THUOCDACTRI = '$THUOCDACTRI$'
          </isNotEmpty>
          <isNotEmpty prepend="and" property="NGAYTAIKHAM">
            NGAYTAIKHAM = '$NGAYTAIKHAM$'
          </isNotEmpty>
          <isNotEmpty prepend="and" property="SONGAYHENTAIKHAM">
            SONGAYHENTAIKHAM = '$SONGAYHENTAIKHAM$'
          </isNotEmpty>
          <isNotEmpty prepend="and" property="RAVIEN">
            RAVIEN = '$RAVIEN$'
          </isNotEmpty>
          <isNotEmpty prepend="and" property="ISTHUOCBV">
            ISTHUOCBV = '$ISTHUOCBV$'
          </isNotEmpty>
          <isNotEmpty prepend="and" property="ISYLENHVTYT">
            ISYLENHVTYT = '$ISYLENHVTYT$'
          </isNotEmpty>
          <isNotEmpty prepend="and" property="BENHVIEN_ID">
            BENHVIEN_ID = '$BENHVIEN_ID$'
          </isNotEmpty>
          <isNotEmpty prepend="and" property="NGAYTAO">
            NGAYTAO = '$NGAYTAO$'
          </isNotEmpty>
          <isNotEmpty prepend="and" property="NGUOITAO_ID">
            NGUOITAO_ID = '$NGUOITAO_ID$'
          </isNotEmpty>
          <isNotEmpty prepend="and" property="NGAYCAPNHAT">
            NGAYCAPNHAT = '$NGAYCAPNHAT$'
          </isNotEmpty>
          <isNotEmpty prepend="and" property="NGUOICAPNHAT_ID">
            NGUOICAPNHAT_ID = '$NGUOICAPNHAT_ID$'
          </isNotEmpty>
        </isParameterPresent>
      </dynamic>
      order by KHAMBENH_ID
    </statement>
    <statement id="DAO00062_GetDetail" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
      select *
      from TT_NOITRU_KHAMBENH
      where KHAMBENH_ID  = '$KHAMBENH_ID$'
    </statement>
    <!--<statement id="DAO00062_GetDetailP" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
      select *
      from TT_NOITRU_KHAMBENH
      where KHAMBENH_ID  = '$KHAMBENH_ID$'
    </statement>-->
    <insert id="DAO00062_Add" parameterClass="System.Collections.IDictionary" resultClass="System.Int64">
      insert into TT_NOITRU_KHAMBENH (
      BENHAN_ID
      , LUUTRU_ID
      , LANKHAM
      , NGAYKHAM
      , THOIGIANKHAM
      , BACSIKHAM_ID
      , PHONGBAN_ID
      , DIEUDUONG_ID
      , CAPHOLY_ID
      , DOITUONG_ID
      , PHATDO_DIEUTRI_ID
      , DINHBENH
      , DIENBIEN
      , LOIDAN
      , CHEDOANUONG_ID
      , CHEDOCHAMSOC_ID
      , PHANCAPCHAMSOC_ID
      , CHUNGTUPHATTHUOC_ID
      , KHODUOC_ID
      , NOINHANTHUOC_ID
      , LOAITOATHUOC
      , THUOCDACTRI
      , NGAYTAIKHAM
      , SONGAYHENTAIKHAM
      , RAVIEN
      , ISTHUOCBV      
      , ISYLENHVTYT
      , BENHVIEN_ID
      , NGAYTAO
      , NGUOITAO_ID
      , NGAYCAPNHAT
      , NGUOICAPNHAT_ID
      <isPropertyAvailable prepend="," property="GHICHU_KHAMBENH">
        GHICHU_KHAMBENH
      </isPropertyAvailable>
      <isPropertyAvailable prepend="," property="CHEDODINHDUONG">
        CHEDODINHDUONG
      </isPropertyAvailable>
      ) values (
      #BENHAN_ID#
      , #LUUTRU_ID#
      , #LANKHAM#
      , #NGAYKHAM#
      , #THOIGIANKHAM#
      , #BACSIKHAM_ID#
      , #PHONGBAN_ID#
      , #DIEUDUONG_ID#
      , #CAPHOLY_ID#
      , #DOITUONG_ID#
      , #PHATDO_DIEUTRI_ID#
      , #DINHBENH#
      , #DIENBIEN#
      , #LOIDAN#
      , #CHEDOANUONG_ID#
      , #CHEDOCHAMSOC_ID#
      , #PHANCAPCHAMSOC_ID#
      , #CHUNGTUPHATTHUOC_ID#
      , #KHODUOC_ID#
      , #NOINHANTHUOC_ID#
      , #LOAITOATHUOC#
      , #THUOCDACTRI#
      , #NGAYTAIKHAM#
      , #SONGAYHENTAIKHAM#
      , #RAVIEN#
      , #ISTHUOCBV#
      , #ISYLENHVTYT#
      , #BENHVIEN_ID#
      , #NGAYTAO#
      , #NGUOITAO_ID#
      , #NGAYCAPNHAT#
      , #NGUOICAPNHAT_ID#
      <isPropertyAvailable prepend="," property="GHICHU_KHAMBENH">
        #GHICHU_KHAMBENH#
      </isPropertyAvailable>
      <isPropertyAvailable prepend="," property="CHEDODINHDUONG">
       #CHEDODINHDUONG#
      </isPropertyAvailable>
      )
      <selectKey resultClass="System.Int64" type="post" >
        SELECT @@IDENTITY as value
      </selectKey>
    </insert>

    <update id="DAO00062_Update" parameterClass="System.Collections.IDictionary">
      update TT_NOITRU_KHAMBENH set
      BENHAN_ID = #BENHAN_ID#
      , LUUTRU_ID = #LUUTRU_ID#
      , LANKHAM = #LANKHAM#
      , NGAYKHAM = #NGAYKHAM#
      , THOIGIANKHAM = #THOIGIANKHAM#
      , BACSIKHAM_ID = #BACSIKHAM_ID#
      , PHONGBAN_ID = #PHONGBAN_ID#
      , DIEUDUONG_ID = #DIEUDUONG_ID#
      , CAPHOLY_ID = #CAPHOLY_ID#
      , DOITUONG_ID = #DOITUONG_ID#
      , PHATDO_DIEUTRI_ID = #PHATDO_DIEUTRI_ID#
      , DINHBENH = #DINHBENH#
      , DIENBIEN = #DIENBIEN#
      , LOIDAN = #LOIDAN#
      , CHEDOANUONG_ID = #CHEDOANUONG_ID#
      , CHEDOCHAMSOC_ID = #CHEDOCHAMSOC_ID#
      , PHANCAPCHAMSOC_ID = #PHANCAPCHAMSOC_ID#
      , CHUNGTUPHATTHUOC_ID = #CHUNGTUPHATTHUOC_ID#
      , KHODUOC_ID = #KHODUOC_ID#
      , NOINHANTHUOC_ID = #NOINHANTHUOC_ID#
      <!--, LOAITOATHUOC = #LOAITOATHUOC#-->
      , THUOCDACTRI = #THUOCDACTRI#
      , NGAYTAIKHAM = #NGAYTAIKHAM#
      , SONGAYHENTAIKHAM = #SONGAYHENTAIKHAM#
      , RAVIEN = #RAVIEN#
      , ISTHUOCBV = #ISTHUOCBV#
      , ISYLENHVTYT = #ISYLENHVTYT#
      <!--, BENHVIEN_ID = #BENHVIEN_ID#
      , NGAYTAO = #NGAYTAO#
      , NGUOITAO_ID = #NGUOITAO_ID#-->
      , NGAYCAPNHAT = #NGAYCAPNHAT#
      , NGUOICAPNHAT_ID = #NGUOICAPNHAT_ID#
      <isPropertyAvailable prepend="," property="GHICHU_KHAMBENH">
        GHICHU_KHAMBENH = #GHICHU_KHAMBENH#
      </isPropertyAvailable>
      <isPropertyAvailable prepend="," property="CHEDODINHDUONG">
        CHEDODINHDUONG = #CHEDODINHDUONG#
      </isPropertyAvailable>
      where
      KHAMBENH_ID = '$KHAMBENH_ID$'
    </update>

    <statement id="DAO00062_Delete" parameterClass="System.Collections.IDictionary" resultClass="System.Int32">
      delete from TT_NOITRU_KHAMBENH
      where
      KHAMBENH_ID = '$KHAMBENH_ID$'
    </statement>

    <statement id="DAO00062_DeleteP" parameterClass="System.Collections.IDictionary" resultClass="System.Int32">
      delete from TT_NOITRU_KHAMBENH
      <dynamic prepend="where">
        <isParameterPresent>
          <isNotEmpty prepend="and" property="KHAMBENH_ID">
            KHAMBENH_ID = '$KHAMBENH_ID$'
          </isNotEmpty>
          <isNotEmpty prepend="and" property="BENHAN_ID">
            BENHAN_ID = '$BENHAN_ID$'
          </isNotEmpty>
          <isNotEmpty prepend="and" property="LUUTRU_ID">
            LUUTRU_ID = '$LUUTRU_ID$'
          </isNotEmpty>
          <isNotEmpty prepend="and" property="LANKHAM">
            LANKHAM = '$LANKHAM$'
          </isNotEmpty>
          <isNotEmpty prepend="and" property="NGAYKHAM">
            NGAYKHAM = '$NGAYKHAM$'
          </isNotEmpty>
          <isNotEmpty prepend="and" property="THOIGIANKHAM">
            THOIGIANKHAM = '$THOIGIANKHAM$'
          </isNotEmpty>
          <isNotEmpty prepend="and" property="BACSIKHAM_ID">
            BACSIKHAM_ID = '$BACSIKHAM_ID$'
          </isNotEmpty>
          <isNotEmpty prepend="and" property="DIEUDUONG_ID">
            DIEUDUONG_ID = '$DIEUDUONG_ID$'
          </isNotEmpty>
          <isNotEmpty prepend="and" property="CAPHOLY_ID">
            CAPHOLY_ID = '$CAPHOLY_ID$'
          </isNotEmpty>
          <isNotEmpty prepend="and" property="DOITUONG_ID">
            DOITUONG_ID = '$DOITUONG_ID$'
          </isNotEmpty>
          <isNotEmpty prepend="and" property="PHATDO_DIEUTRI_ID">
            PHATDO_DIEUTRI_ID = '$PHATDO_DIEUTRI_ID$'
          </isNotEmpty>
          <isNotEmpty prepend="and" property="DINHBENH">
            DINHBENH = '$DINHBENH$'
          </isNotEmpty>
          <isNotEmpty prepend="and" property="DIENBIEN">
            DIENBIEN = '$DIENBIEN$'
          </isNotEmpty>
          <isNotEmpty prepend="and" property="LOIDAN">
            LOIDAN = '$LOIDAN$'
          </isNotEmpty>
          <isNotEmpty prepend="and" property="CHEDOANUONG_ID">
            CHEDOANUONG_ID = '$CHEDOANUONG_ID$'
          </isNotEmpty>
          <isNotEmpty prepend="and" property="CHEDOCHAMSOC_ID">
            CHEDOCHAMSOC_ID = '$CHEDOCHAMSOC_ID$'
          </isNotEmpty>
          <isNotEmpty prepend="and" property="CHUNGTUPHATTHUOC_ID">
            CHUNGTUPHATTHUOC_ID = '$CHUNGTUPHATTHUOC_ID$'
          </isNotEmpty>
          <isNotEmpty prepend="and" property="KHODUOC_ID">
            KHODUOC_ID = '$KHODUOC_ID$'
          </isNotEmpty>
          <isNotEmpty prepend="and" property="NOINHANTHUOC_ID">
            NOINHANTHUOC_ID = '$NOINHANTHUOC_ID$'
          </isNotEmpty>
          <isNotEmpty prepend="and" property="LOAITOATHUOC">
            LOAITOATHUOC = '$LOAITOATHUOC$'
          </isNotEmpty>
          <isNotEmpty prepend="and" property="THUOCDACTRI">
            THUOCDACTRI = '$THUOCDACTRI$'
          </isNotEmpty>
          <isNotEmpty prepend="and" property="NGAYTAIKHAM">
            NGAYTAIKHAM = '$NGAYTAIKHAM$'
          </isNotEmpty>
          <isNotEmpty prepend="and" property="SONGAYHENTAIKHAM">
            SONGAYHENTAIKHAM = '$SONGAYHENTAIKHAM$'
          </isNotEmpty>
          <isNotEmpty prepend="and" property="RAVIEN">
            RAVIEN = '$RAVIEN$'
          </isNotEmpty>
            <isNotEmpty prepend="and" property="ISTHUOCBV">
            ISTHUOCBV = '$ISTHUOCBV$'
          </isNotEmpty>
          <isNotEmpty prepend="and" property="ISYLENHVTYT">
            ISYLENHVTYT = '$ISYLENHVTYT$'
          </isNotEmpty>
          <isNotEmpty prepend="and" property="BENHVIEN_ID">
            BENHVIEN_ID = '$BENHVIEN_ID$'
          </isNotEmpty>
          <isNotEmpty prepend="and" property="NGAYTAO">
            NGAYTAO = '$NGAYTAO$'
          </isNotEmpty>
          <isNotEmpty prepend="and" property="NGUOITAO_ID">
            NGUOITAO_ID = '$NGUOITAO_ID$'
          </isNotEmpty>
          <isNotEmpty prepend="and" property="NGAYCAPNHAT">
            NGAYCAPNHAT = '$NGAYCAPNHAT$'
          </isNotEmpty>
          <isNotEmpty prepend="and" property="NGUOICAPNHAT_ID">
            NGUOICAPNHAT_ID = '$NGUOICAPNHAT_ID$'
          </isNotEmpty>
        </isParameterPresent>
      </dynamic>
    </statement>

    <statement id="DAO00062_GetChungTuPhatThuocID" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
      select CHUNGTUPHATTHUOC_ID
      from TT_NOITRU_KHAMBENH
      where KHAMBENH_ID = '$KHAMBENH_ID$'
    </statement>
    <statement id="DAO00062_GetThongTinNhapVienCuaBenhNhan" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
      select top 1 lt.THOIGIANVAO
      from TT_NOITRU_BENHAN ba
      inner join  TT_NOITRU_LUUTRU lt on ba.BENHAN_ID =lt.BENHAN_ID
      where lt.LUUTRU_CURRENT=1 and ba.TIEPNHAN_ID ='$TIEPNHAN_ID$'
    </statement>

    <statement id="DAO00062_GetTrangThaiYLenh" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
      select tt.CHUNGTU_ID, tt.PHIEULINH_ID, tt.TRANGTHAI, pl.DUYET as DUYETPHIEULINH,
      ct.CHUNGTU_ID as CHUNGTUXUATNOIBO_ID, ct.LOAICHUNGTU
      from TT_NOITRU_TOATHUOC tt
      
      left join TT_DUOC_PHIEULINH pl
      on tt.PHIEULINH_ID = pl.CHUNGTU_ID
      
      left join TT_DUOC_CHUNGTU ct
      on pl.CHUNGTU_ID = ct.PHIEULINH_ID
      
      where tt.KHAMBENH_ID = '$KHAMBENH_ID$'
      and (tt.PHIEULINH_ID is not null or tt.CHUNGTU_ID is not null or (tt.TRANGTHAI = 'DADUYET'))
    </statement>

    <statement id="DAO00062_GetKhamBenhByTiepNhanID" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
      select *
      from TT_NOITRU_KHAMBENH
      where BENHAN_ID in
      (select BENHAN_ID from TT_NOITRU_BENHAN
      where TIEPNHAN_ID = '$TIEPNHAN_ID$')
      and ISYLENHVTYT = '$ISYLENHVTYT$'
      <isNotEmpty prepend="and" property="BENHAN_ID">
        BENHAN_ID = '$BENHAN_ID$'
      </isNotEmpty>
      order by KHAMBENH_ID desc
    </statement>

    <statement id="DAO00062_GetListKhoThuocPhongBan" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
      select kd.* , lst.DICTIONARY_CODE  LOAIKHO from TM_KHODUOC kd
      left join TM_PHONGBAN_KHODUOC pbkd
      on kd.KHODUOC_ID = pbkd.KHODUOC_ID
      and kd.BENHVIEN_ID = pbkd.BENHVIEN_ID
      left join LST_DICTIONARY lst on lst.DICTIONARY_ID = kd.LOAIKHO_ID
      where pbkd.PHONGBAN_ID = '$PHONGBAN_ID$'
      and kd.BENHVIEN_ID = '$BENHVIEN_ID$'
    </statement>

    <statement id="DAO00062_GetKhoThuocCosoKhongCoso" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
      select distinct kd.KHODUOC_ID, lst.DICTIONARY_CODE  LOAIKHO from TM_KHODUOC kd
      left join TM_PHONGBAN_KHODUOC pbkd
      on kd.KHODUOC_ID = pbkd.KHODUOC_ID
      and kd.BENHVIEN_ID = pbkd.BENHVIEN_ID
      left join LST_DICTIONARY lst on lst.DICTIONARY_ID = kd.LOAIKHO_ID
      where lst.DICTIONARY_CODE = 'Coso'
      <!--where kd.KHODUOC_ID = '$KHOPHAT_ID$'-->
    </statement>
    <statement id="DAO00062_GetAllPhamviKhoDuoc" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
      select distinct dmap.*
      from TM_DUOC_PHAMVISD_MAPPING dmap
      left join TM_DUOC_PHAMVISUDUNG dpv on dpv.PHAMVI_ID = dmap.PHAMVI_ID
    </statement>
    <statement id="DAO00062_GetDSYLenhThuocByBenhNhanID" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
      select ba.SOBENHAN, ba.TIEPNHAN_ID, kb.* from TT_NOITRU_KHAMBENH kb
      left join TT_NOITRU_BENHAN ba
      on kb.BENHAN_ID = ba.BENHAN_ID
      where ba.BENHNHAN_ID = '$BENHNHAN_ID$'
      and kb.ISYLENHVTYT = '$ISYLENHVTYT$'
      and kb.BENHVIEN_ID = '$BENHVIEN_ID$'
      <isNotEmpty prepend="and" property="TUNGAY">
        convert(date, NGAYLAP) &#62;&#61; convert(date, '$TUNGAY$')
      </isNotEmpty>
      <isNotEmpty prepend="and" property="DENNGAY">
        convert(date, NGAYLAP) &#60;&#61; convert(date, '$DENNGAY$')
      </isNotEmpty>
      <isNotEmpty prepend="and" property="BACSIKHAM_ID">
        BACSIKHAM_ID = '$BACSIKHAM_ID$'
      </isNotEmpty>
      <isNotEmpty prepend="and" property="PHONGBAN_ID">
        PHONGBAN_ID = '$PHONGBAN_ID$'
      </isNotEmpty>
      <isNotEmpty prepend="and" property="DIEUDUONG_ID">
        DIEUDUONG_ID = '$DIEUDUONG_ID$'
      </isNotEmpty>
      order by KHAMBENH_ID
      desc
    </statement>
    
  </statements>
</sqlMap>
