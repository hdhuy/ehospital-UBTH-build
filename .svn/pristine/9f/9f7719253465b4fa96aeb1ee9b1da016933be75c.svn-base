<?xml version="1.0" encoding="utf-8" ?>
<!--============================================================================
//	CAUTION: This file is generated by IBatisNetGen.3.SQLMap.cst at 10/3/2016 10:12:54 AM
//				Any manual editing will be lost in re-generation.
//===========================================================================-->
<sqlMap namespace="eHospital" xmlns="http://ibatis.apache.org/mapping" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
  <statements>
    <statement id="DAO00305_GetList" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
      select DOTDIEUTRI_ID, MADOTDIEUTRI, TENDOTDIEUTRI, BENHAN_ID
      from TT_NOITRU_DOTDIEUTRI
    </statement>
    <statement id="DAO00305_GetDotDieuTri_ByBenhAn" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
      select DOTDIEUTRI_ID, MADOTDIEUTRI, TENDOTDIEUTRI, BENHAN_ID
      from TT_NOITRU_DOTDIEUTRI
      where BENHAN_ID = $BENHAN_ID$
    </statement>
    <statement id="DAO00305_GetChiTietVienphiBANTTheoDotDieuTri" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
      select distinct
      C.GIATRIMIENGIAM as GIATRIMIENGIAM, D.GIATRIMIENGIAM as GIATRIMIENGIAM_BHTN, E.GIATRIMIENGIAM as GIATRIMIENGIAM_THANHVIEN,
      A.*, dv.NGAYGIOYEUCAU, dv.NOIYEUCAU_ID, dv.NOITHUCHIEN_ID, dv.TRANGTHAI, dv.NGAYYEUCAU, hd.SOHOADON,
      mgct.GIATRIMIENGIAM as GIATRIMIENGIAM_CONGTY
      from TT_VIENPHI A
      left join TT_HOADON hd on hd.HOADON_ID = A.HOADON_ID and hd.BENHAN_ID is null
      <!--left join TT_NOITRU_DOTDIEUTRI_CHITIET dtct on dtct.VIENPHI_ID = a.VIENPHI_ID-->
	    left join TT_NOITRU_DOTDIEUTRI ddt on ddt.DOTDIEUTRI_ID = A.DOTDIEUTRI_ID
      left join (select sum(GIATRIMIENGIAM) as GIATRIMIENGIAM, VIENPHI_ID, REF_TABLE
      from TT_MIENGIAM_CHITIET
      where REF_TABLE = 'TT_MIENGIAM'
      and MIENGIAM_ID in (select MIENGIAM_ID from TT_MIENGIAM where TINHTRANG = 1 and TIEPNHAN_ID = '$TIEPNHAN_ID$')
      group by VIENPHI_ID, REF_TABLE) C on C.REF_TABLE = 'TT_MIENGIAM' and C.VIENPHI_ID = A.VIENPHI_ID
      left join (select sum(GIATRIMIENGIAM) as GIATRIMIENGIAM, VIENPHI_ID, REF_TABLE
      from TT_MIENGIAM_CHITIET
      where REF_TABLE = 'TT_MIENGIAM_BHTN'
      and MIENGIAM_ID in (select MIENGIAM_BHTN_ID from TT_MIENGIAM_BHTN where TINHTRANG = 1 and TIEPNHAN_ID = '$TIEPNHAN_ID$')
      group by VIENPHI_ID, REF_TABLE) D on D.REF_TABLE = 'TT_MIENGIAM_BHTN' and D.VIENPHI_ID = A.VIENPHI_ID
      left join (select sum(GIATRIMIENGIAM) as GIATRIMIENGIAM, VIENPHI_ID, REF_TABLE
      from TT_MIENGIAM_CHITIET
      where REF_TABLE = 'TT_MIENGIAM_THANHVIEN'
      and MIENGIAM_ID in (select MIENGIAM_THANHVIEN_ID from TT_MIENGIAM_THANHVIEN where TINHTRANG = 1 and TIEPNHAN_ID = '$TIEPNHAN_ID$')
      group by VIENPHI_ID, REF_TABLE) E on E.REF_TABLE = 'TT_MIENGIAM_THANHVIEN' and E.VIENPHI_ID = A.VIENPHI_ID
      left join (select sum(GIATRIMIENGIAM) as GIATRIMIENGIAM, VIENPHI_ID, REF_TABLE
      from TT_MIENGIAM_CHITIET
      where REF_TABLE = 'TT_MIENGIAM_CONGTY'
      and MIENGIAM_ID in (select MIENGIAM_CONGTY_ID from TT_MIENGIAM_CONGTY where  TIEPNHAN_ID = '$TIEPNHAN_ID$')
      group by VIENPHI_ID, REF_TABLE) mgct on mgct.REF_TABLE = 'TT_MIENGIAM_CONGTY' and mgct.VIENPHI_ID = A.VIENPHI_ID
      left join (select DVYEUCAU_ID as REF_ID, DICHVU_ID, NGAYGIOYEUCAU, CONVERT(VARCHAR(10), NGAYGIOYEUCAU, 103) as NGAYYEUCAU, NOIYEUCAU_ID, NOITHUCHIEN_ID, TRANGTHAI, 'TT_DVYEUCAU' as REF_TABLE
      from TT_DVYEUCAU where TIEPNHAN_ID = '$TIEPNHAN_ID$' and DANGKY_ID is null  and HUYYEUCAU = '0'
      union
      select A.TOATHUOC_ID as REF_ID, A.DUOC_ID as DICHVU_ID, B.THOIGIANKHAM as NGAYGIOYEUCAU, CONVERT(VARCHAR(10), B.THOIGIANKHAM, 103) as NGAYYEUCAU, A.PHONGBANRATOA_ID as NOIYEUCAU_ID, A.KHOPHAT_ID as NOITHUCHIEN_ID, CASE WHEN A.CHUNGTU_ID is null THEN 'CHUAXUAT' ELSE 'DAXUAT' END AS TRANGTHAI, 'TT_NOITRU_TOATHUOC' as REF_TABLE
      from TT_NOITRU_TOATHUOC A
      left join TT_NOITRU_KHAMBENH B on A.KHAMBENH_ID = B.KHAMBENH_ID
      where TIEPNHAN_ID = '$TIEPNHAN_ID$'
      union
      select CLSKETQUA_VTYT_ID as REF_ID, DUOC_ID as DICHVU_ID, NGAYTAO as NGAYGIOYEUCAU, CONVERT(VARCHAR(10), NGAYTAO, 103) as NGAYYEUCAU, PHONGBAN_ID as NOIYEUCAU_ID, KHOSUDUNG_ID as NOITHUCHIEN_ID, CASE WHEN CHUNGTU_ID is null THEN 'CHUAXUAT' ELSE 'DAXUAT' END AS TRANGTHAI, 'TT_CLSKETQUA_VTYT' as REF_TABLE
      from TT_CLSKETQUA_VTYT
      where CLSKETQUA_ID in (select CLSKETQUA_ID from TT_CLSKETQUA where TIEPNHAN_ID= '$TIEPNHAN_ID$')
      union
      select B.PHAUTHUAT_VTYT_ID as REF_ID, B.DUOC_ID as DICHVU_ID, A.NGAYTHUCHIEN as NGAYGIOYEUCAU, CONVERT(VARCHAR(10), A.NGAYTHUCHIEN, 103) as NGAYYEUCAU, A.PHONGBANTHUCHIEN_ID as NOIYEUCAU_ID, B.KHOSUDUNG_ID, CASE WHEN B.CHUNGTU_ID is null THEN 'CHUAXUAT' ELSE 'DAXUAT' END AS TRANGTHAI, 'TT_PHAUTHUAT_VTYT' as REF_TABLE
      from TT_PHAUTHUAT A
      left join TT_PHAUTHUAT_VTYT B on A.PHAUTHUAT_ID = B.PHAUTHUAT_ID
      left join TT_PHAUTHUAT_YEUCAU C on C.PHAUTHUAT_ID = A.PHAUTHUAT_ID
      left join TT_DVYEUCAU D on C.DVYEUCAU_ID = D.DVYEUCAU_ID and D.TIEPNHAN_ID= '$TIEPNHAN_ID$' and D.DANGKY_ID is null
      where A.TIEPNHAN_ID= '$TIEPNHAN_ID$' and B.DUOC_ID is not null) dv on dv.REF_TABLE = A.REF_TABLE and dv.REF_ID = A.REF_ID and dv.DICHVU_ID = isnull(A.DICHVU_ID, A.DUOC_ID)
      where
      A.TIEPNHAN_ID = '$TIEPNHAN_ID$' and A.BENHVIEN_ID = '$BENHVIEN_ID$' and A.BENHAN_ID = '$BENHAN_ID$'
      and dv.NGAYYEUCAU is not null and A.ACTIVE = '1' 
      <isNotEmpty prepend="and" property="DOTDIEUTRI_ID">
        ddt.DOTDIEUTRI_ID = $DOTDIEUTRI_ID$
      </isNotEmpty>
      ORDER BY A.VIENPHI_ID
    </statement>
    <statement id="DAO00305_CheckRaVien" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
      select isnull(KHOACHUYENDEN_ID, KHOAVAO_ID) as KHOAHIENTAI, *
      from TT_NOITRU_BENHAN where BENHAN_ID = '$BENHAN_ID$'
    </statement>
    <statement id="DAO00305_GetListBenhNhanNgoaiTru" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
      select * from
      (select COUNT(*) OVER() as TOTALROWS,  ROW_NUMBER() OVER(order by T.MADOTDIEUTRI desc) as ROWNUMBER, * from
      (select distinct
      E.CHANDOANKHAMBENH as CHANDOAN, E.KHOAVAO_ID  as PHONGBAN_ID,  E.BENHAN_ID,
      E.ICD_BENHCHINH as MABENH, E.ICD_BENHPHU as BENHKHAC, E.SOBENHAN, E.SOCAPCUU,
      B.SOBHYT, B.NGAYTIEPNHAN , B.THOIGIANTIEPNHAN as NGAYVAO, B.SOTIEPNHAN, B.DOITUONG_ID, B.TIEPNHAN_ID,
      C.MAYTE as MABN, C.TENBENHNHAN as TENBN, C.NAMSINH , C.BENHNHAN_ID, E.BENHVIEN_ID,
      E.TRANGTHAI,
      F.NGAYCHUNGTU as NGAYXUATTHUOC, D.NGUOICAPNHAT_ID as NGUOIKHOABENHAN, E.LOAIBENHAN, N'Điều trị ngoại trú' + ' - ' + E.SOBENHAN as NOIDUNG2,
      dt.MADOTDIEUTRI, dt.TENDOTDIEUTRI, dt.DAXACNHAN_BHYT, dt.DOTDIEUTRI_ID,
      case when DAXACNHAN_BHYT is null then 0 else 1 end XACNHANBHYT,
      case when dt.DAXACNHAN_BHYT is not null then convert(varchar(10),dt.NGAYCAPNHAT,103) else '' end NGAYXACNHANBHYT, nv.TENNHANVIEN, pb.TENPHONGBAN
      from TT_NOITRU_BENHAN E
      inner join TT_TIEPNHAN B on B.TIEPNHAN_ID = E.TIEPNHAN_ID
      left join TT_BENHNHAN C on E.BENHNHAN_ID = C.BENHNHAN_ID
      left join TT_XACNHANCHIPHI D on D.BENHAN_ID = E.BENHAN_ID
      left join TT_NOITRU_KHAMBENH A on E.BENHAN_ID = A.BENHAN_ID
      left join TT_DUOC_CHUNGTU F on F.KHAMBENH_ID = A.KHAMBENH_ID
      left join TM_NHANVIEN nv on nv.NHANVIEN_ID = e.BACSIDIEUTRICHINH_ID
      left join TM_PHONGBAN pb on pb.PHONGBAN_ID = e.KHOACHUYENDEN_ID
      left join (select vp.BENHAN_ID, SUM(GIATRI_BENHNHAN_DATHANHTOAN) as GIATRI_BENHNHAN_DATHANHTOAN
      from TT_VIENPHI vp
      where vp.BENHVIEN_ID = '$BENHVIEN_ID$' group by vp.BENHAN_ID) G on E.BENHAN_ID = A.BENHAN_ID
      inner join TT_NOITRU_DOTDIEUTRI dt on dt.BENHAN_ID = e.BENHAN_ID
      <!--inner join TT_NOITRU_DOTDIEUTRI_CHITIET ct ON ct.DOTDIEUTRI_ID = DT.DOTDIEUTRI_ID-->
      where
      (len(B.SOBHYT) > 0) AND E.LOAIBENHAN = 2
      <isNotEmpty prepend="and" property="OPT_KHO_RAVIEN_DUNG_KHO_OPD">
        <isEqual prepend="" property="OPT_KHO_RAVIEN_DUNG_KHO_OPD" compareValue="True">
          (E.TRANGTHAI = 'DANGDIEUTRI'  or E.TRANGTHAI = 'DAXUATVIEN')
          <isNotEmpty prepend="and" property="TUNGAY">
          cast(dt.TUNGAY as date) &#62;&#61; cast(#TUNGAY# as date)
        </isNotEmpty>
        <isNotEmpty prepend="and" property="DENNGAY">
          cast(dt.TUNGAY as date) &#60;&#61; cast(#DENNGAY# as date)
        </isNotEmpty>
          and dt.TRANGTHAI='0'
        </isEqual>
        <isEqual prepend="" property="OPT_KHO_RAVIEN_DUNG_KHO_OPD" compareValue="False">
          (E.TRANGTHAI = 'DANGDIEUTRI' or (E.TRANGTHAI = 'DAXUATVIEN' and (G.GIATRI_BENHNHAN_DATHANHTOAN = 0 or G.GIATRI_BENHNHAN_DATHANHTOAN is null)))
          and dt.TRANGTHAI='1'
          <isNotEmpty prepend="and" property="TUNGAY">
            cast(dt.DENNGAY as date) &#62;&#61; cast(#TUNGAY# as date)
          </isNotEmpty>
          <isNotEmpty prepend="and" property="DENNGAY">
            cast(dt.DENNGAY as date) &#60;&#61; cast(#DENNGAY# as date)
          </isNotEmpty>
        </isEqual>
      </isNotEmpty>      
      
      and E.BENHVIEN_ID = '$BENHVIEN_ID$'
      <isNotEmpty prepend="and" property="MABENHAN">
        (C.TENBENHNHAN LIKE '%' + #MABENHAN# + '%' OR C.MAYTE LIKE '%' + #MABENHAN# + '%')
      </isNotEmpty>
      <isNotEmpty prepend="and" property="NGAYXACNHAN">
        D.NGAYXACNHAN = '$NGAYXACNHAN$'
      </isNotEmpty>
      <isNotEmpty prepend="" property="TRANGTHAI">
        <isEqual prepend="AND" property="TRANGTHAI" compareValue="2">
          D.XACNHANCHIPHI_ID is NULL
        </isEqual>
        <isEqual prepend="AND" property="TRANGTHAI" compareValue="3">
          D.XACNHANCHIPHI_ID is not NULL
        </isEqual>
        <isEqual prepend="AND" property="TRANGTHAI" compareValue="02">
          D.XACNHANCHIPHI_ID is NULL
        </isEqual>
        <isEqual prepend="AND" property="TRANGTHAI" compareValue="03">
          D.XACNHANCHIPHI_ID is not NULL
        </isEqual>
      </isNotEmpty>
      )T)LST where LST.ROWNUMBER between '$FROMROW$' and '$TOROW$'
    </statement>
    <statement id="DAO00305_GetVienphiBenhAnNgoaiTru" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
      select
      D.KHOAVAO_ID  as PHONGBAN_ID,
      ISNULL(A.DICHVU_ID, A.DUOC_ID) as NOIDUNG_ID, A.REF_ID as IDREF, A.VIENPHI_ID,
      A.SOLUONG as SOLUONG, A.SOLUONG as SOLUONG_NEW, A.DICHVU_ID, A.DUOC_ID,
      A.DONGIA_DOANHTHU, A.DONGIA_DOANHTHU as DONGIADOANHTHU, A.BHYT_DONGIA_CHITRA,
      A.BHYT_DONGIA as DONGIAHOTRO, A.BHYT_THANHTIEN_CHITRA as DONGIAHOTROCHITRA,
      A.REF_TABLE as LOAI, A.BHYT_DONGIA, A.BHYT_THANHTIEN, A.BHYT_THANHTIEN_CHITRA, A.BENHNHAN_PHAITHANHTOAN,
      A.GIATRI_BENHNHAN_DATHANHTOAN, A.BENHVIEN_ID, A.THANHTIEN_DOANHTHU,
      A.LOAI_CHIPHI, A.LOAIGIA_ID, A.REF_TABLE, A.KHAMBENH_ID, A.REF_ID, A.DUOCPHEPTHUCHIEN,
      A.HUY, A.KHONGTHUTIEN, A.DATHANHTOAN, A.HOADON_ID, A.ACTIVE,
      DT.MADOTDIEUTRI + ' - ' + DT.TENDOTDIEUTRI AS TENDOT
      from TT_VIENPHI A
      inner join TT_NOITRU_BENHAN D on D.BENHAN_ID = A.BENHAN_ID
      left join TT_NOITRU_DOTDIEUTRI_CHITIET DTCT ON DTCT.VIENPHI_ID = A.VIENPHI_ID
      left join TT_NOITRU_DOTDIEUTRI DT ON A.BENHAN_ID = DT.BENHAN_ID
      where A.BENHAN_ID = '$BENHAN_ID$' and A.BENHVIEN_ID = '$BENHVIEN_ID$' and (A.DICHVU_ID is not null or A.DUOC_ID is not null)
      <isNotEmpty prepend="" property="OPT_KHO_RAVIEN_DUNG_KHO_OPD">
        <isEqual prepend="and" property="OPT_KHO_RAVIEN_DUNG_KHO_OPD" compareValue="False">
          A.DATHANHTOAN='1'
        </isEqual>
      </isNotEmpty>
      and MADOTDIEUTRI = '$MADOTDIEUTRI$'
      and A.BHYT_DONGIA > 0
      ORDER BY A.VIENPHI_ID
    </statement>
    <statement id="DAO00305_GetDVChuaThanhToan" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
      select vp.*
      from TT_VIENPHI vp
      left join TT_DVYEUCAU dvyc on dvyc.DVYEUCAU_ID = vp.REF_ID
      where vp.BENHAN_ID = '$BENHAN_ID$' AND vp.BENHVIEN_ID = '$BENHVIEN_ID$' and DATHANHTOAN='0' and dvyc.HUYYEUCAU = '0'
    </statement>
    <statement id="DAO00305_GetListBenhNhanNgoaiTruXacNhan" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
      select * from
      (select COUNT(*) OVER() as TOTALROWS,  ROW_NUMBER() OVER(order by T.SOTIEPNHAN desc) as ROWNUMBER, * from
      (select distinct
      E.CHANDOANKHAMBENH as CHANDOAN, E.KHOAVAO_ID  as PHONGBAN_ID,  E.BENHAN_ID,
      E.ICD_BENHCHINH as MABENH, E.ICD_BENHPHU as BENHKHAC, E.SOBENHAN, E.SOCAPCUU,
      B.SOBHYT, B.NGAYTIEPNHAN , B.THOIGIANTIEPNHAN as NGAYVAO, E.THOIGIANRAVIEN, B.SOTIEPNHAN, B.DOITUONG_ID, B.TIEPNHAN_ID,
      C.MAYTE as MABN, C.TENBENHNHAN as TENBN, isnull(C.NGAYSINH, C.NAMSINH) as NGAYSINH, C.NAMSINH , C.BENHNHAN_ID, E.BENHVIEN_ID,
      E.TRANGTHAI,
      F.NGAYCHUNGTU as NGAYXUATTHUOC,
      gd.DESCRIPTION  as TENGIOITINH, pb.TENPHONGBAN, D.NGUOICAPNHAT_ID as NGUOIKHOABENHAN, C.DIACHILIENLAC,
      CASE WHEN balt.MABENHAN is null THEN 0 ELSE 1 END as CHUYENLUUTRU,
      E.LOAIBENHAN,
      case when E.TRANGTHAI = 'DAKHOA' then convert(varchar(10),E.NGAYCAPNHAT,103) else '' end NGAYXACNHAN
      from TT_NOITRU_BENHAN E
      inner join TT_TIEPNHAN B on B.TIEPNHAN_ID = E.TIEPNHAN_ID
      left join TT_BENHNHAN C on E.BENHNHAN_ID = C.BENHNHAN_ID
      left join TT_XACNHANCHIPHI D on D.BENHAN_ID = E.BENHAN_ID
      left join TT_NOITRU_KHAMBENH A on E.BENHAN_ID = A.BENHAN_ID
      left join TT_DUOC_CHUNGTU F on F.KHAMBENH_ID = A.KHAMBENH_ID
      left join TM_GENDER gd on gd.ID = C.GIOITINH
      left join TT_BENHAN_LUUTRU balt on balt.BENHAN_ID = E.BENHAN_ID and balt.REF_TABLE = 'TT_NOITRU_BENHAN'
      left join TM_PHONGBAN pb on pb.PHONGBAN_ID = isnull(E.KHOACHUYENDEN_ID, E.KHOAVAO_ID)
      left join (select BENHAN_ID, SUM(GIATRI_BENHNHAN_DATHANHTOAN) as GIATRI_BENHNHAN_DATHANHTOAN
      from TT_VIENPHI where BENHVIEN_ID = '$BENHVIEN_ID$' group by BENHAN_ID) G on E.BENHAN_ID = A.BENHAN_ID
      where
      E.LOAIBENHAN = 2 and
      (E.TRANGTHAI = 'DANGDIEUTRI' or E.TRANGTHAI = 'DATHANHTOAN' or E.TRANGTHAI = 'DAKHOA' or E.TRANGTHAI = 'DAXUATVIEN')
      <isNotEmpty prepend="and" property="TUNGAY">
        E.NGAYRAVIEN &#62;&#61; '$TUNGAY$'
      </isNotEmpty>
      <isNotEmpty prepend="and" property="DENNGAY">
        E.NGAYRAVIEN &#60;&#61; '$DENNGAY$'
      </isNotEmpty>
      and E.BENHVIEN_ID = '$BENHVIEN_ID$'
      <isNotEmpty prepend="and" property="MABENHAN">
        (E.SOBENHAN LIKE '%' + #MABENHAN# + '%' or C.TENBENHNHAN LIKE '%' + #MABENHAN# + '%')
      </isNotEmpty>
      <isNotEmpty prepend="and" property="NGAYXACNHAN">
        D.NGAYXACNHAN = '$NGAYXACNHAN$'
      </isNotEmpty>
      <isNotEmpty prepend="" property="TRANGTHAI">
        <isEqual prepend="AND" property="TRANGTHAI" compareValue="2">
          D.XACNHANCHIPHI_ID is NULL
        </isEqual>
        <isEqual prepend="AND" property="TRANGTHAI" compareValue="3">
          D.XACNHANCHIPHI_ID is not NULL
        </isEqual>
        <isEqual prepend="AND" property="TRANGTHAI" compareValue="02">
          D.XACNHANCHIPHI_ID is NULL
        </isEqual>
        <isEqual prepend="AND" property="TRANGTHAI" compareValue="03">
          D.XACNHANCHIPHI_ID is not NULL
        </isEqual>
      </isNotEmpty>
      )T
      )lst where lst.ROWNUMBER between '$FROMROW$' and '$TOROW$'
    </statement>
    <statement id="DAO00305_GetTrangThaiBenhAn" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
      select TRANGTHAI,LOAIBENHAN from TT_NOITRU_BENHAN where BENHAN_ID = '$BENHAN_ID$' and BENHVIEN_ID = '$BENHVIEN_ID$'
    </statement>
    <statement id="DAO00305_XacNhanChiPhiExists" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
      select *
      from TT_XACNHANCHIPHI where BENHAN_ID = '$BENHAN_ID$' and BENHVIEN_ID = '$BENHVIEN_ID$'
    </statement>
    <statement id="DAO00305_GetNhapVienByIdNgoaiTru" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
      select bn.TENBENHNHAN, bn.MAYTE, tn.SOTIEPNHAN, nv.*
      from TT_NOITRU_NHAPVIEN nv
      left join TT_BENHNHAN bn on bn.BENHNHAN_ID = nv.BENHNHAN_ID
      left join TT_TIEPNHAN tn on tn.TIEPNHAN_ID = nv.TIEPNHAN_ID
      where nv.BENHNHAN_ID  = '$BENHNHAN_ID$' and tn.TRANGTHAI != 'HOANTHANH'
      and (nv.TRANGTHAI = 'CHOXACNHAN' or nv.TRANGTHAI = 'CHONHAPKHOA' or nv.TRANGTHAI = 'DAXACNHAN')
      and nv.LOAIBENHAN = '$LOAIBENHAN$'
      order by nv.NHAPVIEN_ID desc
    </statement>
    <statement id="DAO00305_GetXacNhanChiPhiId" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
      select distinct dt.DAXACNHAN_BHYT as XACNHANCHIPHI_ID
      from TT_NOITRU_DOTDIEUTRI dt
      inner join TT_NOITRU_DOTDIEUTRI_CHITIET ct on dt.DOTDIEUTRI_ID = ct.DOTDIEUTRI_ID
      inner join TT_XACNHANCHIPHI xn on xn.BENHAN_ID = dt.BENHAN_ID
      where dt.MADOTDIEUTRI = '$MADOTDIEUTRI$' and dt.DAXACNHAN_BHYT = '$DAXACNHAN_BHYT$' and xn.BENHVIEN_ID = '$BENHVIEN_ID$'
    </statement>
    <statement id="DAO00305_CheckHuyDot" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
      select dt.*
      from TT_NOITRU_DOTDIEUTRI dt
      inner join TT_NOITRU_DOTDIEUTRI_CHITIET ct on dt.DOTDIEUTRI_ID = ct.DOTDIEUTRI_ID
      inner join TT_VIENPHI vp on vp.VIENPHI_ID = ct.VIENPHI_ID
      where vp.DATHANHTOAN = '1' and dt.MADOTDIEUTRI = '$MADOTDIEUTRI$'
      and dt.BENHAN_ID = '$BENHAN_ID$' and vp.BENHVIEN_ID = '$BENHVIEN_ID$'
    </statement>
    <statement id="DAO00305_CheckNew" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
      select *
      from TT_NOITRU_DOTDIEUTRI
      where BENHAN_ID = '$BENHAN_ID$'
      <isNotEmpty prepend="and" property="TRANGTHAI">
        TRANGTHAI = '$TRANGTHAI$'
      </isNotEmpty>
    </statement>
    <statement id="DAO00305_MaxDot" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
      select max(DOTDIEUTRI_ID) as Max
      from TT_NOITRU_DOTDIEUTRI
      where BENHAN_ID = '$BENHAN_ID$'
    </statement>
    <statement id="DAO00305_GetDataDotDieuTriDangMo" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
      select *
      from TT_NOITRU_DOTDIEUTRI
      where BENHAN_ID = '$BENHAN_ID$' and TRANGTHAI = '0'
    </statement>
    <statement id="DAO00305_CheckInFormationNhapVien" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
      select *
      from TT_NOITRU_NHAPVIEN
      where BENHNHAN_ID = '$BENHNHAN_ID$' and TIEPNHAN_ID = '$TIEPNHAN_ID$' and LOAIBENHAN = '$LOAIBENHAN$' 
      and BENHVIEN_ID = '$BENHVIEN_ID$'
    </statement>
    <statement id="DAO00305_CheckOnDepartment" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
      select *
      from TT_NOITRU_BENHAN
      where BENHNHAN_ID = '$BENHNHAN_ID$' and TIEPNHAN_ID = '$TIEPNHAN_ID$' and LOAIBENHAN = '$LOAIBENHAN$'
      and BENHVIEN_ID = '$BENHVIEN_ID$'
    </statement>
    <statement id="DAO00305_KiemTraVTYTCuaBenhAn" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
      select A.* from TT_CLSKETQUA_VTYT A
      left join TT_DVYEUCAU B on A.DVYEUCAU_ID = B.DVYEUCAU_ID
      inner join TT_NOITRU_BENHAN C on C.BENHAN_ID = B.BENHAN_ID
      inner join TT_NOITRU_DOTDIEUTRI D on D.BENHAN_ID = C.BENHAN_ID
      where B.BENHAN_ID = '$BENHAN_ID$' and A.CHUNGTU_ID is null and D.MADOTDIEUTRI = '$MADOTDIEUTRI$'
    </statement>
    <statement id="DAO00305_KiemThuThuatVTYT" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
      select * from TT_PHAUTHUAT_VTYT
      where
      PHAUTHUAT_ID in (select PHAUTHUAT_ID from TT_PHAUTHUAT pt
      inner join TT_NOITRU_BENHAN ba on ba.BENHAN_ID = pt.BENHAN_ID
      inner join TT_NOITRU_DOTDIEUTRI dt on dt.BENHAN_ID = ba.BENHAN_ID
      where pt.BENHAN_ID = '$BENHAN_ID$' and dt.MADOTDIEUTRI = '$MADOTDIEUTRI$')
      and (CHUNGTU_ID is null or CHUNGTU_ID = 0)
    </statement>
    <statement id="DAO00305_CheckBilProvisional" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
      select vp.*
      from TT_VIENPHI as vp
      inner join TT_HOADON as hd on hd.HOADON_ID = vp.HOADON_ID
      inner join TT_NOITRU_DOTDIEUTRI_CHITIET as ct on ct.VIENPHI_ID = vp.VIENPHI_ID
      inner join TT_NOITRU_DOTDIEUTRI as dt on dt.DOTDIEUTRI_ID = ct.DOTDIEUTRI_ID
      where vp.BENHAN_ID = '$BENHAN_ID$' and dt.MADOTDIEUTRI = '$MADOTDIEUTRI$' and hd.TRANGTHAI = 'CHUATHUTIEN'
    </statement>
    <statement id="DAO00305_CheckYLenhRaVien" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
      select VP.*
      from TT_NOITRU_KHAMBENH KB
      join TT_NOITRU_TOATHUOC TT on KB.KHAMBENH_ID = TT.KHAMBENH_ID
      join TT_VIENPHI VP on VP.REF_ID = TT.TOATHUOC_ID and VP.REF_TABLE = 'TT_NOITRU_TOATHUOC'
      join TT_XACNHANCHIPHICHITIET CT on CT.VIENPHI_ID = VP.VIENPHI_ID
      join TT_TIEPNHAN TN on TN.TIEPNHAN_ID = VP.TIEPNHAN_ID
      join TM_DOITUONG DT on DT.DOITUONG_ID = TN.DOITUONG_ID
      <dynamic prepend="where">
        <isParameterPresent>
          <isNotEmpty prepend="and" property="RAVIEN">
            KB.RAVIEN = '$RAVIEN$'
          </isNotEmpty>
          <isNotEmpty prepend="and" property="TRANGTHAI">
            TT.TRANGTHAI = '$TRANGTHAI$'
          </isNotEmpty>
          <isNotEmpty prepend="and" property="TIEPNHAN_ID">
            VP.TIEPNHAN_ID = '$TIEPNHAN_ID$'
          </isNotEmpty>
          <isNotEmpty prepend="and" property="BENHAN_ID">
            VP.BENHAN_ID = '$BENHAN_ID$'
          </isNotEmpty>
          <isNotEmpty prepend="and" property="DATHANHTOAN">
            VP.DATHANHTOAN = '$DATHANHTOAN$'
          </isNotEmpty>
          <isNotEmpty prepend="and" property="ACTIVE">
            VP.ACTIVE = '$ACTIVE$'
          </isNotEmpty>
          <isNotEmpty prepend="and" property="MADOITUONG">
            DT.MADOITUONG != '$MADOITUONG$'
          </isNotEmpty>
        </isParameterPresent>
      </dynamic>
    </statement>
  </statements>
</sqlMap>
