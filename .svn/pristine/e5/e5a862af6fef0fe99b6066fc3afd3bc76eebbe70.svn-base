<?xml version="1.0" encoding="utf-8" ?>
<!--============================================================================
//	CAUTION: This file is generated by IBatisNetGen.3.SQLMap.cst at 12/21/2015 2:22:43 PM
//				Any manual editing will be lost in re-generation.
//===========================================================================-->
<sqlMap namespace="eHospital" xmlns="http://ibatis.apache.org/mapping" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
  
  <statements>
    <statement id="DAO00089_GetAll" resultClass="DataObject">
      select *
      from TT_NOITRU_TRATHUOC
      order by TRATHUOC_ID
    </statement>
    <statement id="DAO00089_GetList" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
      select *
      from TT_NOITRU_TRATHUOC
      <dynamic prepend="where">
        <isParameterPresent>
          <isNotEmpty prepend="and" property="TRATHUOC_ID">
            TT_NOITRU_TRATHUOC.TRATHUOC_ID = '$TRATHUOC_ID$'
          </isNotEmpty>
          <isNotEmpty prepend="and" property="SOPHIEU">
            TT_NOITRU_TRATHUOC.SOPHIEU = '$SOPHIEU$'
          </isNotEmpty>
          <isNotEmpty prepend="and" property="BENHAN_ID">
            TT_NOITRU_TRATHUOC.BENHAN_ID = '$BENHAN_ID$'
          </isNotEmpty>
          <isNotEmpty prepend="and" property="LUUTRU_ID">
            TT_NOITRU_TRATHUOC.LUUTRU_ID = '$LUUTRU_ID$'
          </isNotEmpty>
          <isNotEmpty prepend="and" property="NGAYTRA">
            TT_NOITRU_TRATHUOC.NGAYTRA = '$NGAYTRA$'
          </isNotEmpty>
          <isNotEmpty prepend="and" property="NGUOINHAN_ID">
            TT_NOITRU_TRATHUOC.NGUOINHAN_ID = '$NGUOINHAN_ID$'
          </isNotEmpty>
          <isNotEmpty prepend="and" property="CHUNGTU_ID">
            TT_NOITRU_TRATHUOC.CHUNGTU_ID = '$CHUNGTU_ID$'
          </isNotEmpty>
          <isNotEmpty prepend="and" property="DIENGIAINGHIEPVUPHATSINH">
            TT_NOITRU_TRATHUOC.DIENGIAINGHIEPVUPHATSINH = '$DIENGIAINGHIEPVUPHATSINH$'
          </isNotEmpty>
          <isNotEmpty prepend="and" property="THOIGIANTRA">
            TT_NOITRU_TRATHUOC.THOIGIANTRA = '$THOIGIANTRA$'
          </isNotEmpty>
          <isNotEmpty prepend="and" property="TRANGTHAI">
            TT_NOITRU_TRATHUOC.TRANGTHAI = '$TRANGTHAI$'
          </isNotEmpty>
          <isNotEmpty prepend="and" property="GHICHU">
            TT_NOITRU_TRATHUOC.GHICHU = '$GHICHU$'
          </isNotEmpty>
          <isNotEmpty prepend="and" property="BENHVIEN_ID">
            TT_NOITRU_TRATHUOC.BENHVIEN_ID = '$BENHVIEN_ID$'
          </isNotEmpty>
          <isNotEmpty prepend="and" property="NGAYTAO">
            TT_NOITRU_TRATHUOC.NGAYTAO = '$NGAYTAO$'
          </isNotEmpty>
          <isNotEmpty prepend="and" property="NGUOITAO_ID">
            TT_NOITRU_TRATHUOC.NGUOITAO_ID = '$NGUOITAO_ID$'
          </isNotEmpty>
          <isNotEmpty prepend="and" property="NGAYCAPNHAT">
            TT_NOITRU_TRATHUOC.NGAYCAPNHAT = '$NGAYCAPNHAT$'
          </isNotEmpty>
          <isNotEmpty prepend="and" property="NGUOICAPNHAT_ID">
            TT_NOITRU_TRATHUOC.NGUOICAPNHAT_ID = '$NGUOICAPNHAT_ID$'
          </isNotEmpty>
        </isParameterPresent>
      </dynamic>
      order by TRATHUOC_ID
    </statement>
    <statement id="DAO00089_GetDetail" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
      select *
      from TT_NOITRU_TRATHUOC
      where TT_NOITRU_TRATHUOC.TRATHUOC_ID  = '$value$'
      order by TRATHUOC_ID
    </statement>
    <statement id="DAO00089_GetDetailP" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
      select *
      from TT_NOITRU_TRATHUOC
      where TT_NOITRU_TRATHUOC.TRATHUOC_ID  = '$TRATHUOC_ID$'
      order by TRATHUOC_ID
    </statement>
    <statement id="DAO00089_Add" parameterClass="System.Collections.IDictionary" resultClass="System.Int64">
      insert into TT_NOITRU_TRATHUOC (
      SOPHIEU
      , BENHAN_ID
      , LUUTRU_ID
      , NGAYTRA
      , NGUOINHAN_ID
      , CHUNGTU_ID
      , KHAMBENH_ID
      , DIENGIAINGHIEPVUPHATSINH
      , THOIGIANTRA
      , TRANGTHAI
      , GHICHU
      , BENHVIEN_ID
      , NGAYTAO
      , NGUOITAO_ID
      , NGAYCAPNHAT
      , NGUOICAPNHAT_ID
      ) values (
      #SOPHIEU#
      , #BENHAN_ID#
      , #LUUTRU_ID#
      , #NGAYTRA#
      , #NGUOINHAN_ID#
      , #CHUNGTU_ID#
      , #KHAMBENH_ID#
      , #DIENGIAINGHIEPVUPHATSINH#
      , #THOIGIANTRA#
      , #TRANGTHAI#
      , #GHICHU#
      , #BENHVIEN_ID#
      , #NGAYTAO#
      , #NGUOITAO_ID#
      , #NGAYCAPNHAT#
      , #NGUOICAPNHAT_ID#
      )
      SELECT SCOPE_IDENTITY()
      <!--<selectKey resultClass="System.Int64" type="post" >
        SELECT @@IDENTITY as value
      </selectKey>-->
    </statement>

    <update id="DAO00089_Update" parameterClass="System.Collections.IDictionary">
      update TT_NOITRU_TRATHUOC set
      SOPHIEU = #SOPHIEU#
      , BENHAN_ID = #BENHAN_ID#
      , LUUTRU_ID = #LUUTRU_ID#
      , NGAYTRA = #NGAYTRA#
      , NGUOINHAN_ID = #NGUOINHAN_ID#
      , CHUNGTU_ID = #CHUNGTU_ID#
      , DIENGIAINGHIEPVUPHATSINH = #DIENGIAINGHIEPVUPHATSINH#
      , THOIGIANTRA = #THOIGIANTRA#
      , TRANGTHAI = #TRANGTHAI#
      , GHICHU = #GHICHU#
      , BENHVIEN_ID = #BENHVIEN_ID#
      , NGAYCAPNHAT = #NGAYCAPNHAT#
      , NGUOICAPNHAT_ID = #NGUOICAPNHAT_ID#
      where
      TRATHUOC_ID = '$TRATHUOC_ID$'
    </update>

    <statement id="DAO00089_Delete" parameterClass="System.Collections.IDictionary" resultClass="System.Int32">
      delete from TT_NOITRU_TRATHUOC
      where
      TRATHUOC_ID = '$TRATHUOC_ID$'
    </statement>
    <statement id="DAO00089_XoaPhieuTraByID" parameterClass="System.Collections.IDictionary" resultClass="System.Int32">
      delete from TT_NOITRU_TRATHUOC
      where
      TRATHUOC_ID = '$TRATHUOC_ID$'
    </statement>


    <statement id="DAO00089_DeleteP" parameterClass="System.Collections.IDictionary" resultClass="System.Int32">
      delete from TT_NOITRU_TRATHUOC
      <dynamic prepend="where">
        <isParameterPresent>
          <isNotEmpty prepend="and" property="TRATHUOC_ID">
            TT_NOITRU_TRATHUOC.TRATHUOC_ID = '$TRATHUOC_ID$'
          </isNotEmpty>
          <isNotEmpty prepend="and" property="SOPHIEU">
            TT_NOITRU_TRATHUOC.SOPHIEU = '$SOPHIEU$'
          </isNotEmpty>
          <isNotEmpty prepend="and" property="BENHAN_ID">
            TT_NOITRU_TRATHUOC.BENHAN_ID = '$BENHAN_ID$'
          </isNotEmpty>
          <isNotEmpty prepend="and" property="LUUTRU_ID">
            TT_NOITRU_TRATHUOC.LUUTRU_ID = '$LUUTRU_ID$'
          </isNotEmpty>
          <isNotEmpty prepend="and" property="NGAYTRA">
            TT_NOITRU_TRATHUOC.NGAYTRA = '$NGAYTRA$'
          </isNotEmpty>
          <isNotEmpty prepend="and" property="NGUOINHAN_ID">
            TT_NOITRU_TRATHUOC.NGUOINHAN_ID = '$NGUOINHAN_ID$'
          </isNotEmpty>
          <isNotEmpty prepend="and" property="CHUNGTU_ID">
            TT_NOITRU_TRATHUOC.CHUNGTU_ID = '$CHUNGTU_ID$'
          </isNotEmpty>
          <isNotEmpty prepend="and" property="DIENGIAINGHIEPVUPHATSINH">
            TT_NOITRU_TRATHUOC.DIENGIAINGHIEPVUPHATSINH = '$DIENGIAINGHIEPVUPHATSINH$'
          </isNotEmpty>
          <isNotEmpty prepend="and" property="THOIGIANTRA">
            TT_NOITRU_TRATHUOC.THOIGIANTRA = '$THOIGIANTRA$'
          </isNotEmpty>
          <isNotEmpty prepend="and" property="TRANGTHAI">
            TT_NOITRU_TRATHUOC.TRANGTHAI = '$TRANGTHAI$'
          </isNotEmpty>
          <isNotEmpty prepend="and" property="GHICHU">
            TT_NOITRU_TRATHUOC.GHICHU = '$GHICHU$'
          </isNotEmpty>
          <isNotEmpty prepend="and" property="BENHVIEN_ID">
            TT_NOITRU_TRATHUOC.BENHVIEN_ID = '$BENHVIEN_ID$'
          </isNotEmpty>
          <isNotEmpty prepend="and" property="NGAYTAO">
            TT_NOITRU_TRATHUOC.NGAYTAO = '$NGAYTAO$'
          </isNotEmpty>
          <isNotEmpty prepend="and" property="NGUOITAO_ID">
            TT_NOITRU_TRATHUOC.NGUOITAO_ID = '$NGUOITAO_ID$'
          </isNotEmpty>
          <isNotEmpty prepend="and" property="NGAYCAPNHAT">
            TT_NOITRU_TRATHUOC.NGAYCAPNHAT = '$NGAYCAPNHAT$'
          </isNotEmpty>
          <isNotEmpty prepend="and" property="NGUOICAPNHAT_ID">
            TT_NOITRU_TRATHUOC.NGUOICAPNHAT_ID = '$NGUOICAPNHAT_ID$'
          </isNotEmpty>
        </isParameterPresent>
      </dynamic>
    </statement>

    <statement id="DAO00089_TimKiemPhieuNgungYLenh" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
      select tt.*, ba.BENHNHAN_ID, ba.SOBENHAN, bn.MAYTE as MABENHNHAN, bn.TENBENHNHAN from TT_NOITRU_TRATHUOC tt
      left join TT_NOITRU_BENHAN ba
      on tt.BENHAN_ID = ba.BENHAN_ID
      left join TT_BENHNHAN bn
      on ba.BENHNHAN_ID = bn.BENHNHAN_ID

      <dynamic prepend="where">
        <isParameterPresent>
          <isNotEmpty prepend="and" property="TUKHOA">
            tt.SOPHIEU like '%' + #TUKHOA# + '%'
          </isNotEmpty>
          <isNotEmpty prepend="and" property="USER_ID">
            (tt.NGUOICAPNHAT_ID = '$USER_ID$')
          </isNotEmpty>
          <isNotEmpty prepend="and" property="KHAMBENH_ID">
            (tt.KHAMBENH_ID = '$KHAMBENH_ID$')
          </isNotEmpty>
          <isNotEmpty prepend="and" property="BENHVIEN_ID">
            tt.BENHVIEN_ID = '$BENHVIEN_ID$'
          </isNotEmpty>
          <isNotEmpty prepend="and" property="BENHNHAN_ID">
            ba.BENHNHAN_ID = '$BENHNHAN_ID$'
          </isNotEmpty>
          <isNotEmpty prepend="and" property="TUNGAY">
            convert(date, tt.NGAYTRA) between convert(date, '$TUNGAY$') and convert(date, '$DENNGAY$')
          </isNotEmpty>

        </isParameterPresent>
      </dynamic>
      order by tt.TRATHUOC_ID DESC
    </statement>

    <statement id="DAO00089_KiemTraDieuKienChoPhepNgungYLenh" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
      SELECT * FROM TT_NOITRU_TOATHUOC tt
      WHERE
      tt.TOATHUOC_ID = '$TOATHUOC_ID$'
      <!-- Da co phieu linh-->
      <isEqual prepend="" property="PHA_DIEUKIEN_NGUNGYLENH" compareValue="0">
        AND tt.PHIEULINH_ID is not null
      </isEqual>
      <!-- Da co phieu linh va da nhap noi bo-->
      <isEqual prepend="" property="PHA_DIEUKIEN_NGUNGYLENH" compareValue="1">
      AND tt.PHIEULINH_ID IN (
      SELECT PHIEULINH_ID FROM TT_DUOC_CHUNGTU ct
      INNER JOIN TT_DUOC_CHUNGTU_CHITIET ctct on ct.CHUNGTU_ID = ctct.CHUNGTU_ID
      WHERE MUCDICHCHUNGTU_CODE = 'N05'
      AND  CTCT.TOATHUOCNOITRU_ID =  '$TOATHUOC_ID$'
      AND PHIEULINH_ID IS NOT NULL)
     </isEqual>
      <!-- PHA_DIEUKIEN_NGUNGYLENH = 2 thi khong kiem tra 2 dk tren-->
      <!--Chua xuat su dung-->
      AND tt.PHIEULINH_ID NOT IN (SELECT DISTINCT PHIEULINH_ID
      FROM TT_DUOC_CHUNGTU ct
      INNER JOIN TT_DUOC_CHUNGTU_CHITIET ctct on ct.CHUNGTU_ID = ctct.CHUNGTU_ID
      WHERE MUCDICHCHUNGTU_CODE = 'X13'
      AND  CTCT.TOATHUOCNOITRU_ID =  '$TOATHUOC_ID$'
      AND PHIEULINH_ID IS NOT NULL)
    </statement>
  
</statements>
  
</sqlMap>
