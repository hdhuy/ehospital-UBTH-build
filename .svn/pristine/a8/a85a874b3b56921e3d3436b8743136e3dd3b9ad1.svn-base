<?xml version="1.0" encoding="utf-8" ?>
<!--============================================================================
//	CAUTION: This file is generated by IBatisNetGen.3.SQLMap.cst at 10/3/2016 10:12:54 AM
//				Any manual editing will be lost in re-generation.
//===========================================================================-->
<sqlMap namespace="eHospital" xmlns="http://ibatis.apache.org/mapping" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
  <statements>
    <statement id="DAO00086_GetHoSoBenhAn" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
      SELECT A.PHONGBAN_ID, isnull(E.TENPHONGBAN,'') as TENPHONGBAN, A.BENHAN_ID, ISNULL(D.REF_TABLE,'TT_NOITRU_BENHAN') AS REF_TABLE,
      A.SOBENHAN AS MABENHAN, C.TENBENHNHAN AS TENBENHAN, A.SOLUUTRU, D.SOBIA, C.MAYTE AS MABENHNHAN, C.TENBENHNHAN, C.GIOITINH, F.DESCRIPTION AS GENDER, C.NAMSINH, A.LOAIBENHAN_ID
      , CASE WHEN A.LOAIBENHAN = 1 THEN N'CẤP CỨU'
      WHEN A.LOAIBENHAN = 2 THEN N'NGOẠI TRÚ'
      ELSE N'NỘI TRÚ' END AS LOAIBENHAN,
      A.DOITUONG_ID, G.TENDOITUONG, C.DIACHILIENLAC AS DIACHI,
      convert(date,A.NGAYVAOVIEN) NGAYVAOVIEN, convert(date,A.NGAYRAVIEN) NGAYRAVIEN,
      HS.DICTIONARY_ID, HS.DICTIONARY_NAME,
      A.LYDONHAPVIEN_ID, CT.LYDOVAOVIEN AS LyDoNhapVien
      , icd.MAICD, icd.TENICD AS CHANDOAN
      , A.LOAIBENHAN as LOAIBENHANNT, B.SOTIEPNHAN
      FROM (SELECT ISNULL(KHOACHUYENDEN_ID, KHOAVAO_ID) AS PHONGBAN_ID, * FROM TT_NOITRU_BENHAN) A
      LEFT JOIN TT_NOITRU_BENHAN_CHITIET CT ON CT.BENHAN_ID = A.BENHAN_ID
      INNER JOIN TT_TIEPNHAN B ON B.TIEPNHAN_ID = A.TIEPNHAN_ID
      INNER JOIN TT_BENHNHAN C  ON C.BENHNHAN_ID = B.BENHNHAN_ID
      LEFT JOIN TT_BENHAN_LUUTRU D ON D.BENHAN_ID = A.BENHAN_ID
      LEFT JOIN TM_PHONGBAN E ON E.PHONGBAN_ID = A.PHONGBAN_ID
      LEFT JOIN TM_GENDER F ON F.ID = C.GIOITINH
      LEFT JOIN TM_DOITUONG G ON G.DOITUONG_ID = A.DOITUONG_ID
      LEFT JOIN LST_DICTIONARY H ON H.DICTIONARY_ID = A.LOAIBENHAN_ID
      LEFT JOIN LST_DICTIONARY HS ON D.LOAIHSBA_ID = HS.DICTIONARY_ID
      left join LST_DICTIONARY lst on lst.DICTIONARY_ID = A.LYDONHAPVIEN_ID
      left join TM_ICD icd on icd.ICD_ID = A.ICD_BENHCHINH
      left join TT_XACNHANCHIPHI X on X.TIEPNHAN_ID = B.TIEPNHAN_ID
      where A.TRANGTHAI='DAKHOA' and D.BENHAN_ID IS NULL and a.PHONGBAN_ID is not null
      and (CONVERT(DATE, X.NGAYXACNHAN) BETWEEN CONVERT(DATE,case when '$TUNGAY$' is null then '1900-01-01' else '$TUNGAY$' end) AND CONVERT(DATE,'$DENNGAY$')
      or CONVERT(DATE, A.NGAYKHOABENHAN) BETWEEN CONVERT(DATE,case when '$TUNGAY$' is null then '1900-01-01' else '$TUNGAY$' end) AND CONVERT(DATE,'$DENNGAY$'))
      AND NOT EXISTS (SELECT 1 FROM dbo.TT_BENHAN_LUUTRU WHERE BENHAN_ID = c.BENHNHAN_ID AND REF_TABLE = 'TT_NOITRU_BENHAN')
      <dynamic>
        <isParameterPresent>
          <isNotEmpty prepend="AND" property="PHONGBAN">
            A.PHONGBAN_ID = '$PHONGBAN$'
          </isNotEmpty>
          <isNotEmpty prepend="AND" property="THONGTINTIMKIEM">
            (C.MAYTE LIKE '%' + #THONGTINTIMKIEM# + '%' OR C.TENBENHNHAN LIKE '%' + #THONGTINTIMKIEM# + '%')
          </isNotEmpty>
          <isNotEmpty prepend="AND" property="LOAIHOSO">
            (($LOAIHOSO$ = 3 and SOBENHAN like '%CC') or ($LOAIHOSO$ = 2 and SOBENHAN not like '%CC'))
          </isNotEmpty>
        </isParameterPresent>
      </dynamic>
      union
      SELECT A.PHONGBAN_ID, isnull(E.TENPHONGBAN,'') as TENPHONGBAN, A.BENHAN_ID, ISNULL(D.REF_TABLE,'TT_NGOAITRU_KHAMBENH') AS REF_TABLE,
      b.SOTIEPNHAN AS MABENHAN, C.TENBENHNHAN AS TENBENHAN, null as SOLUUTRU, D.SOBIA, C.MAYTE AS MABENHNHAN, C.TENBENHNHAN, C.GIOITINH, F.DESCRIPTION AS GENDER, C.NAMSINH, null as LOAIBENHAN_ID, N'KHÁM BỆNH NGOẠI TRÚ' AS LOAIBENHAN,
      a.DOITUONG_ID, G.TENDOITUONG, C.DIACHILIENLAC AS DIACHI,
      convert(date,a.NGAYKHAM) NGAYVAOVIEN, convert(date,X.NGAYXACNHAN) as NGAYRAVIEN,
      HS.DICTIONARY_ID, HS.DICTIONARY_NAME,
      A.LYDONHAPVIEN_ID, BA.LYDOVAOVIEN LyDoNhapVien
      ,isnull(icd.MAICD,icd2.MAICD) MAICD, isnull(icd.TENICD,icd2.TENICD) AS CHANDOAN
      ,0 as LOAIBENHANNT, B.SOTIEPNHAN
      FROM TT_TIEPNHAN B
      INNER JOIN TT_NGOAITRU_KHAMBENH A ON B.TIEPNHAN_ID = A.TIEPNHAN_ID
      left join TT_NGOAITRU_KHAMBENH_BENHAN ba on ba.TIEPNHAN_ID = b.TIEPNHAN_ID
      INNER JOIN TT_BENHNHAN C  ON C.BENHNHAN_ID = B.BENHNHAN_ID
      LEFT JOIN TT_BENHAN_LUUTRU D ON D.BENHAN_ID = A.BENHAN_ID
      LEFT JOIN TM_PHONGBAN E ON E.PHONGBAN_ID = A.PHONGBAN_ID
      LEFT JOIN TM_GENDER F ON F.ID = C.GIOITINH
      LEFT JOIN TM_DOITUONG G ON G.DOITUONG_ID = A.DOITUONG_ID
      LEFT JOIN LST_DICTIONARY HS ON D.LOAIHSBA_ID = HS.DICTIONARY_ID
      left join LST_DICTIONARY lst on lst.DICTIONARY_ID = A.LYDONHAPVIEN_ID
      left join TM_ICD icd on icd.ICD_ID = ba.ICD_BENHCHINH
      left join TM_ICD icd2 on icd2.ICD_ID = a.CHANDOANICD_ID
      left join TT_XACNHANCHIPHI X on X.TIEPNHAN_ID = B.TIEPNHAN_ID
      where C.MAYTE not in (select MABENHNHAN from TT_BENHAN_LUUTRU) and b.TRANGTHAI='HOANTHANH' and A.PHONGBAN_ID IS NOT NULL
      and (CONVERT(DATE, X.NGAYXACNHAN) BETWEEN CONVERT(DATE,case when '$TUNGAY$' is null then '1900-01-01' else '$TUNGAY$' end) AND CONVERT(DATE,'$DENNGAY$')
      or CONVERT(DATE, B.NGAYKHOA) BETWEEN CONVERT(DATE,case when '$TUNGAY$' is null then '1900-01-01' else '$TUNGAY$' end) AND CONVERT(DATE,'$DENNGAY$'))
      AND NOT EXISTS (SELECT 1 FROM dbo.TT_BENHAN_LUUTRU WHERE BENHAN_ID = A.BENHAN_ID AND REF_TABLE = 'TT_NGOAITRU_KHAMBENH')
      <dynamic>
        <isParameterPresent>
          <isNotEmpty prepend="AND" property="PHONGBAN">
            A.PHONGBAN_ID = '$PHONGBAN$'
          </isNotEmpty>
          <isNotEmpty prepend="AND" property="THONGTINTIMKIEM">
            (C.MAYTE LIKE '%' + #THONGTINTIMKIEM# + '%' OR C.TENBENHNHAN LIKE '%' + #THONGTINTIMKIEM# + '%')
          </isNotEmpty>
          <isNotEmpty prepend="AND" property="LOAIHOSO">
            $LOAIHOSO$ = 1
          </isNotEmpty>
        </isParameterPresent>
      </dynamic>
    </statement>
    <statement id="DAO00086_GetHoSoBenhAnDaChuyen" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
      SELECT  A.PHONGBAN_ID ,
      ISNULL(E.TENPHONGBAN, '') AS TENPHONGBAN ,
      A.BENHAN_ID ,
      ISNULL(D.REF_TABLE, 'TT_NOITRU_BENHAN') AS REF_TABLE ,
      A.SOBENHAN AS MABENHAN ,
      C.TENBENHNHAN AS TENBENHAN ,
      A.SOLUUTRU ,
      D.SOBIA ,
      C.MAYTE AS MABENHNHAN ,
      C.TENBENHNHAN ,
      C.GIOITINH ,
      F.DESCRIPTION AS GENDER ,
      C.NAMSINH ,
      A.LOAIBENHAN_ID ,
      H.DICTIONARY_NAME AS LOAIBENHAN ,
      A.DOITUONG_ID ,
      G.TENDOITUONG ,
      C.DIACHILIENLAC AS DIACHI ,
      CONVERT(DATE, A.NGAYVAOVIEN) NGAYVAOVIEN ,
      CONVERT(DATE, A.NGAYRAVIEN) NGAYRAVIEN ,
      HS.DICTIONARY_ID ,
      HS.DICTIONARY_NAME ,
      A.LYDONHAPVIEN_ID ,
      CT.LYDOVAOVIEN AS LyDoNhapVien ,
      icd.MAICD ,
      icd.TENICD AS CHANDOAN,
      LT.HOSO_ID
      FROM    ( SELECT    ISNULL(KHOACHUYENDEN_ID, KHOAVAO_ID) AS PHONGBAN_ID ,
      * FROM      TT_NOITRU_BENHAN
      ) A
      LEFT JOIN TT_NOITRU_BENHAN_CHITIET CT ON CT.BENHAN_ID = A.BENHAN_ID
      INNER JOIN TT_BENHNHAN C ON C.BENHNHAN_ID = a.BENHNHAN_ID
      LEFT JOIN TT_BENHAN_LUUTRU D ON D.BENHAN_ID = A.BENHAN_ID
      LEFT JOIN TM_PHONGBAN E ON E.PHONGBAN_ID = A.PHONGBAN_ID
      LEFT JOIN TM_GENDER F ON F.ID = C.GIOITINH
      LEFT JOIN TM_DOITUONG G ON G.DOITUONG_ID = A.DOITUONG_ID
      LEFT JOIN LST_DICTIONARY H ON H.DICTIONARY_ID = A.LOAIBENHAN_ID
      LEFT JOIN LST_DICTIONARY HS ON D.LOAIHSBA_ID = HS.DICTIONARY_ID
      LEFT JOIN LST_DICTIONARY lst ON lst.DICTIONARY_ID = A.LYDONHAPVIEN_ID
      LEFT JOIN TM_ICD icd ON icd.ICD_ID = A.ICD_BENHCHINH
      LEFT JOIN TT_XACNHANCHIPHI X ON X.TIEPNHAN_ID = a.TIEPNHAN_ID
      JOIN dbo.TT_BENHAN_LUUTRU LT ON LT.BENHAN_ID = A.BENHAN_ID AND LT.REF_TABLE = 'TT_NOITRU_BENHAN'
      where A.TRANGTHAI='DAKHOA' and a.PHONGBAN_ID is not null
      and CONVERT(DATE, LT.NGAYCHUYEN) BETWEEN CONVERT(DATE,case when '$TUNGAY$' is null then '1900-01-01' else '$TUNGAY$' end) AND CONVERT(DATE,'$DENNGAY$')
      AND ISNULL(LT.TINHTRANG,'0') = '0'
      <dynamic>
        <isParameterPresent>
          <isNotEmpty prepend="AND" property="PHONGBAN">
            A.PHONGBAN_ID = '$PHONGBAN$'
          </isNotEmpty>
          <isNotEmpty prepend="AND" property="THONGTINTIMKIEM">
            (C.MAYTE LIKE '%' + #THONGTINTIMKIEM# + '%' OR C.TENBENHNHAN LIKE '%' + #THONGTINTIMKIEM# + '%')
          </isNotEmpty>
        </isParameterPresent>
      </dynamic>
      union
      SELECT  A.PHONGBAN_ID ,
      ISNULL(E.TENPHONGBAN, '') AS TENPHONGBAN ,
      A.BENHAN_ID ,
      ISNULL(D.REF_TABLE, 'TT_NGOAITRU_KHAMBENH') AS REF_TABLE ,
      B.SOTIEPNHAN AS MABENHAN ,
      C.TENBENHNHAN AS TENBENHAN ,
      NULL AS SOLUUTRU ,
      D.SOBIA ,
      C.MAYTE AS MABENHNHAN ,
      C.TENBENHNHAN ,
      C.GIOITINH ,
      F.DESCRIPTION AS GENDER ,
      C.NAMSINH ,
      NULL AS LOAIBENHAN_ID ,
      NULL AS LOAIBENHAN ,
      A.DOITUONG_ID ,
      G.TENDOITUONG ,
      C.DIACHILIENLAC AS DIACHI ,
      CONVERT(DATE, A.NGAYKHAM) NGAYVAOVIEN ,
      CONVERT(DATE, X.NGAYXACNHAN) AS NGAYRAVIEN ,
      HS.DICTIONARY_ID ,
      HS.DICTIONARY_NAME ,
      A.LYDONHAPVIEN_ID ,
      ba.LYDOVAOVIEN LyDoNhapVien ,
      ISNULL(icd.MAICD, icd2.MAICD) MAICD ,
      ISNULL(icd.TENICD, icd2.TENICD) AS CHANDOAN ,
      LT.HOSO_ID
      FROM    TT_TIEPNHAN B
      INNER JOIN TT_NGOAITRU_KHAMBENH A ON B.TIEPNHAN_ID = A.TIEPNHAN_ID
      LEFT JOIN TT_NGOAITRU_KHAMBENH_BENHAN ba ON ba.TIEPNHAN_ID = B.TIEPNHAN_ID
      INNER JOIN TT_BENHNHAN C ON C.BENHNHAN_ID = B.BENHNHAN_ID
      LEFT JOIN TT_BENHAN_LUUTRU D ON D.BENHAN_ID = A.BENHAN_ID
      LEFT JOIN TM_PHONGBAN E ON E.PHONGBAN_ID = A.PHONGBAN_ID
      LEFT JOIN TM_GENDER F ON F.ID = C.GIOITINH
      LEFT JOIN TM_DOITUONG G ON G.DOITUONG_ID = A.DOITUONG_ID
      LEFT JOIN LST_DICTIONARY HS ON D.LOAIHSBA_ID = HS.DICTIONARY_ID
      LEFT JOIN LST_DICTIONARY lst ON lst.DICTIONARY_ID = A.LYDONHAPVIEN_ID
      LEFT JOIN TM_ICD icd ON icd.ICD_ID = ba.ICD_BENHCHINH
      LEFT JOIN TM_ICD icd2 ON icd2.ICD_ID = A.CHANDOANICD_ID
      LEFT JOIN TT_XACNHANCHIPHI X ON X.TIEPNHAN_ID = B.TIEPNHAN_ID
      JOIN dbo.TT_BENHAN_LUUTRU LT ON LT.MABENHAN = b.SOTIEPNHAN AND LT.REF_TABLE = 'TT_NGOAITRU_KHAMBENH'
      where b.TRANGTHAI='HOANTHANH' and A.PHONGBAN_ID IS NOT NULL
      and CONVERT(DATE, LT.NGAYCHUYEN) BETWEEN CONVERT(DATE,case when '$TUNGAY$' is null then '1900-01-01' else '$TUNGAY$' end) AND CONVERT(DATE,'$DENNGAY$')
      AND ISNULL(LT.TINHTRANG,'0') = '0'
      <dynamic>
        <isParameterPresent>
          <isNotEmpty prepend="AND" property="PHONGBAN">
            A.PHONGBAN_ID = '$PHONGBAN$'
          </isNotEmpty>
          <isNotEmpty prepend="AND" property="THONGTINTIMKIEM">
            (C.MAYTE LIKE '%' + #THONGTINTIMKIEM# + '%' OR C.TENBENHNHAN LIKE '%' + #THONGTINTIMKIEM# + '%')
          </isNotEmpty>
        </isParameterPresent>
      </dynamic>
    </statement>
    <statement id="DAO00086_GetBenhAnLuuTru" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
      SELECT DISTINCT A.MABENHAN, A.TENBENHNHAN AS TENBENHAN, A.SOLUUTRU, A.SOBIA, A.MABENHNHAN, A.TENBENHNHAN, F.DESCRIPTION AS GENDER, A.NAMSINH, H.DICTIONARY_NAME AS TRANGTHAI,
      A.LOAIBENHAN_ID, G.TENDOITUONG, A.CHANDOAN, A.DIACHI, convert(varchar(10),A.NGAYVAOVIEN,103) NGAYVAOVIEN, convert(varchar(10),A.NGAYRAVIEN,103) NGAYRAVIEN, A.LYDONHAPVIEN_ID, A.NOIDUNGTHANHLY
      , CASE WHEN B.LOAIBENHAN = 1 THEN N'CẤP CỨU'
      WHEN B.LOAIBENHAN = 2 THEN N'NGOẠI TRÚ'
      ELSE N'NỘI TRÚ' END AS LOAIBENHAN,
      A.NGUOIGIAO_ID, A.NGUOINHAN_ID, A.NGUOICHUYEN_ID, A.NGAYCHUYEN, A.TRANGTHAILUUTRU_ID, A.MAKE, A.MATANG, A.HOSO_ID, HS.DICTIONARY_NAME,
      DATEDIFF(YEAR,A.NGAYCHUYEN,GETDATE()) AS SONAM, A.LOAIHSBA_ID, A.MACHUNGTUNHAPKHO,
      A.SOHOSOTRAVE, A.NHANXET, A.KIEUHSBA_ID, H.DICTIONARY_CODE
      , isnull(E.TENPHONGBAN,'') as TENPHONGBAN
      FROM TT_BENHAN_LUUTRU A
      right JOIN (SELECT ISNULL(KHOACHUYENDEN_ID, KHOAVAO_ID) AS PHONGBAN_ID, * FROM TT_NOITRU_BENHAN) B ON B.BENHAN_ID = A.BENHAN_ID
      <!--LEFT JOIN TT_TIEPNHAN C ON C.TIEPNHAN_ID = B.TIEPNHAN_ID
      LEFT JOIN TT_BENHNHAN D ON D.BENHNHAN_ID = C.BENHNHAN_ID-->
      LEFT JOIN TM_PHONGBAN E ON E.PHONGBAN_ID = B.PHONGBAN_ID
      LEFT JOIN TM_GENDER F ON F.ID = A.GIOITINH
      LEFT JOIN TM_DOITUONG G ON G.DOITUONG_ID = A.DOITUONG_ID
      LEFT JOIN LST_DICTIONARY H ON H.DICTIONARY_ID = A.TRANGTHAILUUTRU_ID
      LEFT JOIN LST_DICTIONARY I ON I.DICTIONARY_ID = A.LOAIBENHAN_ID
      LEFT JOIN LST_DICTIONARY HS ON A.LOAIHSBA_ID = HS.DICTIONARY_ID
      where CONVERT(DATE, A.NGAYCHUYEN) BETWEEN CONVERT(DATE,'$TUNGAY$') AND CONVERT(DATE,'$DENNGAY$')
      AND ISNULL(A.TINHTRANG,'0') = '1'
      <dynamic>
        <isParameterPresent>
          <!--<isNotEmpty prepend="AND">
           CONVERT(DATE, A.NGAYCHUYEN) BETWEEN CONVERT(DATE,case when '$TUNGAY$' is null then '1900-01-01' else '$TUNGAY$' end) AND CONVERT(DATE,'$DENNGAY$')
          </isNotEmpty>-->
          <isNotEmpty prepend="AND" property="TRANGTHAILUUTRU">
            H.DICTIONARY_ID LIKE '%$TRANGTHAILUUTRU$%'
          </isNotEmpty>
          <isNotEmpty prepend="AND" property="THONGTINTIMKIEM">
            (A.MABENHNHAN LIKE '%' + #THONGTINTIMKIEM# + '%' OR A.TENBENHNHAN LIKE '%' + #THONGTINTIMKIEM# + '%')
          </isNotEmpty>
          <isNotEmpty prepend="AND" property="MACHUNGTU">
            A.MACHUNGTUNHAPKHO LIKE '%' + #MACHUNGTU# + '%'
          </isNotEmpty>
          <isNotEmpty prepend="AND" property="LOAIHOSO">
            (($LOAIHOSO$ = 3 and SOBENHAN like '%CC') or ($LOAIHOSO$ = 2 and SOBENHAN not like '%CC'))
          </isNotEmpty>
        </isParameterPresent>
      </dynamic>
      union
      SELECT DISTINCT A.MABENHAN, A.TENBENHNHAN AS TENBENHAN, A.SOLUUTRU, A.SOBIA, A.MABENHNHAN, A.TENBENHNHAN, F.DESCRIPTION AS GENDER, A.NAMSINH, H.DICTIONARY_NAME AS TRANGTHAI,
      A.LOAIBENHAN_ID, G.TENDOITUONG, A.CHANDOAN, A.DIACHI, convert(varchar(10),A.NGAYVAOVIEN,103) NGAYVAOVIEN, convert(varchar(10),A.NGAYRAVIEN,103) NGAYRAVIEN, A.LYDONHAPVIEN_ID, A.NOIDUNGTHANHLY
      , N'KHÁM BỆNH NGOẠI TRÚ' AS LOAIBENHAN,
      A.NGUOIGIAO_ID, A.NGUOINHAN_ID, A.NGUOICHUYEN_ID, A.NGAYCHUYEN, A.TRANGTHAILUUTRU_ID, A.MAKE, A.MATANG, A.HOSO_ID, HS.DICTIONARY_NAME,
      DATEDIFF(YEAR,A.NGAYCHUYEN,GETDATE()) AS SONAM, A.LOAIHSBA_ID, A.MACHUNGTUNHAPKHO,
      A.SOHOSOTRAVE, A.NHANXET, A.KIEUHSBA_ID, H.DICTIONARY_CODE
      , isnull(E.TENPHONGBAN,'') as TENPHONGBAN
      FROM TT_BENHAN_LUUTRU A
      LEFT JOIN TT_NGOAITRU_KHAMBENH B ON B.BENHAN_ID = A.BENHAN_ID
      <!--LEFT JOIN TT_TIEPNHAN C ON C.TIEPNHAN_ID = B.TIEPNHAN_ID
      left join TT_NGOAITRU_KHAMBENH_BENHAN ba on ba.TIEPNHAN_ID = b.TIEPNHAN_ID
      LEFT JOIN TT_BENHNHAN D ON D.BENHNHAN_ID = C.BENHNHAN_ID-->
      LEFT JOIN TM_PHONGBAN E ON E.PHONGBAN_ID = A.PHONGBAN_ID
      LEFT JOIN TM_GENDER F ON F.ID = A.GIOITINH
      LEFT JOIN TM_DOITUONG G ON G.DOITUONG_ID = A.DOITUONG_ID
      LEFT JOIN LST_DICTIONARY H ON H.DICTIONARY_ID = A.TRANGTHAILUUTRU_ID
      LEFT JOIN TM_LOAIBENHAN I ON I.LOAIBENHAN_ID = A.LOAIBENHAN_ID
      LEFT JOIN LST_DICTIONARY HS ON A.LOAIHSBA_ID = HS.DICTIONARY_ID
      where CONVERT(DATE, A.NGAYCHUYEN) BETWEEN CONVERT(DATE,'$TUNGAY$') AND CONVERT(DATE,'$DENNGAY$')
      AND ISNULL(A.TINHTRANG,'0') = '1' and A.ref_table='TT_NGOAITRU_KHAMBENH'
      <dynamic>
        <isParameterPresent>
          <!--<isNotEmpty prepend="AND">
            CONVERT(DATE, A.NGAYCHUYEN) BETWEEN CONVERT(DATE, case when '$TUNGAY$' is null then '1900-01-01' else '$TUNGAY$' end) AND CONVERT(DATE,'$DENNGAY$')
          </isNotEmpty>-->
          <isNotEmpty prepend="AND" property="TRANGTHAILUUTRU">
            H.DICTIONARY_ID = '$TRANGTHAILUUTRU$'
          </isNotEmpty>
          <isNotEmpty prepend="AND" property="THONGTINTIMKIEM">
            (A.MABENHNHAN LIKE '%' + #THONGTINTIMKIEM# + '%' OR A.TENBENHNHAN LIKE '%' + #THONGTINTIMKIEM# + '%')
          </isNotEmpty>
          <isNotEmpty prepend="AND" property="MACHUNGTU">
            A.MACHUNGTUNHAPKHO LIKE '%' + #MACHUNGTU# + '%'
          </isNotEmpty>
          <isNotEmpty prepend="AND" property="LOAIHOSO">
            $LOAIHOSO$ = 1
          </isNotEmpty>
        </isParameterPresent>
      </dynamic>
      order by a.MACHUNGTUNHAPKHO desc
    </statement>
    <statement id="DAO00086_GetBenhAnLuuTruThanhLy_Count" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
      SELECT COUNT(*) as TOTALROWS FROM
      (
      SELECT A.MABENHAN, A.TENBENHNHAN AS TENBENHAN
      FROM TT_BENHAN_LUUTRU A
      LEFT JOIN TT_NOITRU_BENHAN B ON B.BENHAN_ID = A.BENHAN_ID
      LEFT JOIN TT_TIEPNHAN C ON C.TIEPNHAN_ID = B.TIEPNHAN_ID
      LEFT JOIN TT_BENHNHAN D ON D.BENHNHAN_ID = C.BENHNHAN_ID
      LEFT JOIN TM_PHONGBAN E ON E.PHONGBAN_ID = A.PHONGBAN_ID
      LEFT JOIN TM_GENDER F ON F.ID = A.GIOITINH
      LEFT JOIN TM_DOITUONG G ON G.DOITUONG_ID = A.DOITUONG_ID
      LEFT JOIN LST_DICTIONARY H ON H.DICTIONARY_ID = A.TRANGTHAILUUTRU_ID
      LEFT JOIN TM_LOAIBENHAN I ON I.LOAIBENHAN_ID = A.LOAIBENHAN_ID
      LEFT JOIN LST_DICTIONARY HS ON A.LOAIHSBA_ID = HS.DICTIONARY_ID
      LEFT JOIN LST_DICTIONARY LST ON LST.DICTIONARY_ID = A.TRANGTHAILUUTRU_ID
      where datediff(year,a.NGAYCHUYEN,GETDATE()) > '$BATT$' and HS.DICTIONARY_CODE = 'BATT'
      and (LST.DICTIONARY_CODE IN ('NhapKho','DangMuon','TamNgung'))
      <dynamic>
        <isParameterPresent>
          <isNotEmpty prepend="AND" property="PHONGBAN">
            A.PHONGBAN_ID = '$PHONGBAN$'
          </isNotEmpty>
          <isNotEmpty prepend="AND" property="LOAIHSBA">
            A.LOAIHSBA_ID = '$LOAIHSBA$'
          </isNotEmpty>
          <isNotEmpty prepend="AND" property="TRANGTHAILUUTRU">
            H.DICTIONARY_ID = '$TRANGTHAILUUTRU$'
          </isNotEmpty>
          <isNotEmpty prepend="AND" property="THONGTINTIMKIEM">
            (D.MAYTE LIKE '%' + #THONGTINTIMKIEM# + '%' OR D.TENBENHNHAN LIKE '%' + #THONGTINTIMKIEM# + '%')
          </isNotEmpty>
        </isParameterPresent>
      </dynamic>
      union
      SELECT A.MABENHAN, A.TENBENHNHAN AS TENBENHAN
      FROM TT_BENHAN_LUUTRU A
      LEFT JOIN TT_NOITRU_BENHAN B ON B.BENHAN_ID = A.BENHAN_ID
      LEFT JOIN TT_TIEPNHAN C ON C.TIEPNHAN_ID = B.TIEPNHAN_ID
      LEFT JOIN TT_BENHNHAN D ON D.BENHNHAN_ID = C.BENHNHAN_ID
      LEFT JOIN TM_PHONGBAN E ON E.PHONGBAN_ID = A.PHONGBAN_ID
      LEFT JOIN TM_GENDER F ON F.ID = A.GIOITINH
      LEFT JOIN TM_DOITUONG G ON G.DOITUONG_ID = A.DOITUONG_ID
      LEFT JOIN LST_DICTIONARY H ON H.DICTIONARY_ID = A.TRANGTHAILUUTRU_ID
      LEFT JOIN TM_LOAIBENHAN I ON I.LOAIBENHAN_ID = A.LOAIBENHAN_ID
      LEFT JOIN LST_DICTIONARY HS ON A.LOAIHSBA_ID = HS.DICTIONARY_ID
      LEFT JOIN LST_DICTIONARY LST ON LST.DICTIONARY_ID = A.TRANGTHAILUUTRU_ID
      where datediff(year,a.NGAYCHUYEN,GETDATE()) > '$BATN$' and HS.DICTIONARY_CODE = 'BATN'
      and (LST.DICTIONARY_CODE IN ('NhapKho','DangMuon','TamNgung'))
      <dynamic>
        <isParameterPresent>
          <isNotEmpty prepend="AND" property="PHONGBAN">
            A.PHONGBAN_ID = '$PHONGBAN$'
          </isNotEmpty>
          <isNotEmpty prepend="AND" property="LOAIHSBA">
            A.LOAIHSBA_ID = '$LOAIHSBA$'
          </isNotEmpty>
          <isNotEmpty prepend="AND" property="TRANGTHAILUUTRU">
            H.DICTIONARY_ID = '$TRANGTHAILUUTRU$'
          </isNotEmpty>
          <isNotEmpty prepend="AND" property="THONGTINTIMKIEM">
            (D.MAYTE LIKE '%' + #THONGTINTIMKIEM# + '%' OR D.TENBENHNHAN LIKE '%' + #THONGTINTIMKIEM# + '%')
          </isNotEmpty>
        </isParameterPresent>
      </dynamic>
      union
      SELECT A.MABENHAN, A.TENBENHNHAN AS TENBENHAN
      FROM TT_BENHAN_LUUTRU A
      LEFT JOIN TT_NOITRU_BENHAN B ON B.BENHAN_ID = A.BENHAN_ID
      LEFT JOIN TT_TIEPNHAN C ON C.TIEPNHAN_ID = B.TIEPNHAN_ID
      LEFT JOIN TT_BENHNHAN D ON D.BENHNHAN_ID = C.BENHNHAN_ID
      LEFT JOIN TM_PHONGBAN E ON E.PHONGBAN_ID = A.PHONGBAN_ID
      LEFT JOIN TM_GENDER F ON F.ID = A.GIOITINH
      LEFT JOIN TM_DOITUONG G ON G.DOITUONG_ID = A.DOITUONG_ID
      LEFT JOIN LST_DICTIONARY H ON H.DICTIONARY_ID = A.TRANGTHAILUUTRU_ID
      LEFT JOIN TM_LOAIBENHAN I ON I.LOAIBENHAN_ID = A.LOAIBENHAN_ID
      LEFT JOIN LST_DICTIONARY HS ON A.LOAIHSBA_ID = HS.DICTIONARY_ID
      LEFT JOIN LST_DICTIONARY LST ON LST.DICTIONARY_ID = A.TRANGTHAILUUTRU_ID
      where datediff(year,a.NGAYCHUYEN,GETDATE()) > '$BATV$' and HS.DICTIONARY_CODE = 'BATV'
      and (LST.DICTIONARY_CODE IN ('NhapKho','DangMuon','TamNgung'))
      <dynamic>
        <isParameterPresent>
          <isNotEmpty prepend="AND" property="PHONGBAN">
            A.PHONGBAN_ID = '$PHONGBAN$'
          </isNotEmpty>
          <isNotEmpty prepend="AND" property="LOAIHSBA">
            A.LOAIHSBA_ID = '$LOAIHSBA$'
          </isNotEmpty>
          <isNotEmpty prepend="AND" property="TRANGTHAILUUTRU">
            H.DICTIONARY_ID = '$TRANGTHAILUUTRU$'
          </isNotEmpty>
          <isNotEmpty prepend="AND" property="THONGTINTIMKIEM">
            (D.MAYTE LIKE '%' + #THONGTINTIMKIEM# + '%' OR D.TENBENHNHAN LIKE '%' + #THONGTINTIMKIEM# + '%')
          </isNotEmpty>
        </isParameterPresent>
      </dynamic>
      union
      SELECT A.MABENHAN, A.TENBENHNHAN AS TENBENHAN
      FROM TT_BENHAN_LUUTRU A
      LEFT JOIN TT_NOITRU_BENHAN B ON B.BENHAN_ID = A.BENHAN_ID
      LEFT JOIN TT_TIEPNHAN C ON C.TIEPNHAN_ID = B.TIEPNHAN_ID
      LEFT JOIN TT_BENHNHAN D ON D.BENHNHAN_ID = C.BENHNHAN_ID
      LEFT JOIN TM_PHONGBAN E ON E.PHONGBAN_ID = A.PHONGBAN_ID
      LEFT JOIN TM_GENDER F ON F.ID = A.GIOITINH
      LEFT JOIN TM_DOITUONG G ON G.DOITUONG_ID = A.DOITUONG_ID
      LEFT JOIN LST_DICTIONARY H ON H.DICTIONARY_ID = A.TRANGTHAILUUTRU_ID
      LEFT JOIN TM_LOAIBENHAN I ON I.LOAIBENHAN_ID = A.LOAIBENHAN_ID
      LEFT JOIN LST_DICTIONARY HS ON A.LOAIHSBA_ID = HS.DICTIONARY_ID
      LEFT JOIN LST_DICTIONARY LST ON LST.DICTIONARY_ID = A.TRANGTHAILUUTRU_ID
      where datediff(year,a.NGAYCHUYEN,GETDATE()) > (SELECT VALUE FROM TM_SYS_APPSETTINGS WHERE CODE = 'MRA_THOIGIANLUUTRU_BENHANTAMTHAN') and HS.DICTIONARY_CODE = 'BATTHAN'
      and (LST.DICTIONARY_CODE IN ('NhapKho','DangMuon','TamNgung'))
      <dynamic>
        <isParameterPresent>
          <isNotEmpty prepend="AND" property="PHONGBAN">
            A.PHONGBAN_ID = '$PHONGBAN$'
          </isNotEmpty>
          <isNotEmpty prepend="AND" property="LOAIHSBA">
            A.LOAIHSBA_ID = '$LOAIHSBA$'
          </isNotEmpty>
          <isNotEmpty prepend="AND" property="TRANGTHAILUUTRU">
            H.DICTIONARY_ID = '$TRANGTHAILUUTRU$'
          </isNotEmpty>
          <isNotEmpty prepend="AND" property="THONGTINTIMKIEM">
            (D.MAYTE LIKE '%' + #THONGTINTIMKIEM# + '%' OR D.TENBENHNHAN LIKE '%' + #THONGTINTIMKIEM# + '%')
          </isNotEmpty>
        </isParameterPresent>
      </dynamic>
      )T
    </statement>
    <statement id="DAO00086_GetBenhAnLuuTruThanhLy" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
      SELECT * FROM (
      SELECT COUNT(*) OVER() as TOTALROWS, ROW_NUMBER() OVER (ORDER BY T.MABENHNHAN) AS ROWNUMBER, * FROM
      (
      SELECT A.MABENHAN, A.TENBENHNHAN AS TENBENHAN, A.SOLUUTRU, A.SOBIA, A.MABENHNHAN, A.TENBENHNHAN, F.DESCRIPTION AS GENDER, A.NAMSINH, H.DICTIONARY_NAME AS TRANGTHAI,
      A.LOAIBENHAN_ID, G.TENDOITUONG, A.CHANDOAN, A.DIACHI, convert(varchar(10),A.NGAYVAOVIEN,103) NGAYVAOVIEN, convert(varchar(10),A.NGAYRAVIEN,103) NGAYRAVIEN, A.LYDONHAPVIEN_ID, A.NOIDUNGTHANHLY, I.TENLOAIBENHAN AS LOAIBENHAN,
      A.NGUOIGIAO_ID, A.NGUOINHAN_ID, A.NGUOICHUYEN_ID, A.NGAYCHUYEN, A.TRANGTHAILUUTRU_ID, A.MAKE, A.MATANG, A.HOSO_ID, H.DICTIONARY_CODE,
      datediff(year,A.NGAYCHUYEN,getdate()) as SONAM, HS.DICTIONARY_NAME TENLOAIHSBA, A.NGAYTHANHLY, H.DICTIONARY_ID, E.TENPHONGBAN
      FROM TT_BENHAN_LUUTRU A
      LEFT JOIN TT_NOITRU_BENHAN B ON B.BENHAN_ID = A.BENHAN_ID
      LEFT JOIN TT_TIEPNHAN C ON C.TIEPNHAN_ID = B.TIEPNHAN_ID
      LEFT JOIN TT_BENHNHAN D ON D.BENHNHAN_ID = C.BENHNHAN_ID
      LEFT JOIN TM_PHONGBAN E ON E.PHONGBAN_ID = A.PHONGBAN_ID
      LEFT JOIN TM_GENDER F ON F.ID = A.GIOITINH
      LEFT JOIN TM_DOITUONG G ON G.DOITUONG_ID = A.DOITUONG_ID
      LEFT JOIN LST_DICTIONARY H ON H.DICTIONARY_ID = A.TRANGTHAILUUTRU_ID
      LEFT JOIN TM_LOAIBENHAN I ON I.LOAIBENHAN_ID = A.LOAIBENHAN_ID
      LEFT JOIN LST_DICTIONARY HS ON A.LOAIHSBA_ID = HS.DICTIONARY_ID
      LEFT JOIN LST_DICTIONARY LST ON LST.DICTIONARY_ID = A.TRANGTHAILUUTRU_ID
      where datediff(year,a.NGAYCHUYEN,GETDATE()) > '$BATT$' and HS.DICTIONARY_CODE = 'BATT'
      and (LST.DICTIONARY_CODE IN ('NhapKho','DangMuon','TamNgung'))
      <dynamic>
          <isParameterPresent>
            <isNotEmpty prepend="AND" property="PHONGBAN">
              A.PHONGBAN_ID = '$PHONGBAN$'
            </isNotEmpty>
            <isNotEmpty prepend="AND" property="LOAIHSBA">
              A.LOAIHSBA_ID = '$LOAIHSBA$'
            </isNotEmpty>
            <isNotEmpty prepend="AND" property="TRANGTHAILUUTRU">
              H.DICTIONARY_ID = '$TRANGTHAILUUTRU$'
            </isNotEmpty>
            <isNotEmpty prepend="AND" property="THONGTINTIMKIEM">
              (D.MAYTE LIKE '%' + #THONGTINTIMKIEM# + '%' OR D.TENBENHNHAN LIKE '%' + #THONGTINTIMKIEM# + '%')
            </isNotEmpty>
          </isParameterPresent>
        </dynamic>
        union
        SELECT A.MABENHAN, A.TENBENHNHAN AS TENBENHAN, A.SOLUUTRU, A.SOBIA, A.MABENHNHAN, A.TENBENHNHAN, F.DESCRIPTION AS GENDER, A.NAMSINH, H.DICTIONARY_NAME AS TRANGTHAI,
        A.LOAIBENHAN_ID, G.TENDOITUONG, A.CHANDOAN, A.DIACHI, convert(varchar(10),A.NGAYVAOVIEN,103) NGAYVAOVIEN, convert(varchar(10),A.NGAYRAVIEN,103) NGAYRAVIEN, A.LYDONHAPVIEN_ID, A.NOIDUNGTHANHLY, I.TENLOAIBENHAN AS LOAIBENHAN,
        A.NGUOIGIAO_ID, A.NGUOINHAN_ID, A.NGUOICHUYEN_ID, A.NGAYCHUYEN, A.TRANGTHAILUUTRU_ID, A.MAKE, A.MATANG, A.HOSO_ID, H.DICTIONARY_CODE,
        datediff(year,A.NGAYCHUYEN,getdate()) as SONAM, HS.DICTIONARY_NAME TENLOAIHSBA,A.NGAYTHANHLY, H.DICTIONARY_ID, E.TENPHONGBAN
        FROM TT_BENHAN_LUUTRU A
        LEFT JOIN TT_NOITRU_BENHAN B ON B.BENHAN_ID = A.BENHAN_ID
        LEFT JOIN TT_TIEPNHAN C ON C.TIEPNHAN_ID = B.TIEPNHAN_ID
        LEFT JOIN TT_BENHNHAN D ON D.BENHNHAN_ID = C.BENHNHAN_ID
        LEFT JOIN TM_PHONGBAN E ON E.PHONGBAN_ID = A.PHONGBAN_ID
        LEFT JOIN TM_GENDER F ON F.ID = A.GIOITINH
        LEFT JOIN TM_DOITUONG G ON G.DOITUONG_ID = A.DOITUONG_ID
        LEFT JOIN LST_DICTIONARY H ON H.DICTIONARY_ID = A.TRANGTHAILUUTRU_ID
        LEFT JOIN TM_LOAIBENHAN I ON I.LOAIBENHAN_ID = A.LOAIBENHAN_ID
        LEFT JOIN LST_DICTIONARY HS ON A.LOAIHSBA_ID = HS.DICTIONARY_ID
        LEFT JOIN LST_DICTIONARY LST ON LST.DICTIONARY_ID = A.TRANGTHAILUUTRU_ID
        where datediff(year,a.NGAYCHUYEN,GETDATE()) > '$BATN$' and HS.DICTIONARY_CODE = 'BATN'
        and (LST.DICTIONARY_CODE IN ('NhapKho','DangMuon','TamNgung'))
        <dynamic>
          <isParameterPresent>
            <isNotEmpty prepend="AND" property="PHONGBAN">
              A.PHONGBAN_ID = '$PHONGBAN$'
            </isNotEmpty>
            <isNotEmpty prepend="AND" property="LOAIHSBA">
              A.LOAIHSBA_ID = '$LOAIHSBA$'
            </isNotEmpty>
            <isNotEmpty prepend="AND" property="TRANGTHAILUUTRU">
              H.DICTIONARY_ID = '$TRANGTHAILUUTRU$'
            </isNotEmpty>
            <isNotEmpty prepend="AND" property="THONGTINTIMKIEM">
              (D.MAYTE LIKE '%' + #THONGTINTIMKIEM# + '%' OR D.TENBENHNHAN LIKE '%' + #THONGTINTIMKIEM# + '%')
            </isNotEmpty>
          </isParameterPresent>
        </dynamic>
        union
        SELECT A.MABENHAN, A.TENBENHNHAN AS TENBENHAN, A.SOLUUTRU, A.SOBIA, A.MABENHNHAN, A.TENBENHNHAN, F.DESCRIPTION AS GENDER, A.NAMSINH, H.DICTIONARY_NAME AS TRANGTHAI,
        A.LOAIBENHAN_ID, G.TENDOITUONG, A.CHANDOAN, A.DIACHI, convert(varchar(10),A.NGAYVAOVIEN,103) NGAYVAOVIEN, convert(varchar(10),A.NGAYRAVIEN,103) NGAYRAVIEN, A.LYDONHAPVIEN_ID, A.NOIDUNGTHANHLY, I.TENLOAIBENHAN AS LOAIBENHAN,
        A.NGUOIGIAO_ID, A.NGUOINHAN_ID, A.NGUOICHUYEN_ID, A.NGAYCHUYEN, A.TRANGTHAILUUTRU_ID, A.MAKE, A.MATANG, A.HOSO_ID, H.DICTIONARY_CODE,
        datediff(year,A.NGAYCHUYEN,getdate()) as SONAM, HS.DICTIONARY_NAME TENLOAIHSBA,A.NGAYTHANHLY, H.DICTIONARY_ID, E.TENPHONGBAN
        FROM TT_BENHAN_LUUTRU A
        LEFT JOIN TT_NOITRU_BENHAN B ON B.BENHAN_ID = A.BENHAN_ID
        LEFT JOIN TT_TIEPNHAN C ON C.TIEPNHAN_ID = B.TIEPNHAN_ID
        LEFT JOIN TT_BENHNHAN D ON D.BENHNHAN_ID = C.BENHNHAN_ID
        LEFT JOIN TM_PHONGBAN E ON E.PHONGBAN_ID = A.PHONGBAN_ID
        LEFT JOIN TM_GENDER F ON F.ID = A.GIOITINH
        LEFT JOIN TM_DOITUONG G ON G.DOITUONG_ID = A.DOITUONG_ID
        LEFT JOIN LST_DICTIONARY H ON H.DICTIONARY_ID = A.TRANGTHAILUUTRU_ID
        LEFT JOIN TM_LOAIBENHAN I ON I.LOAIBENHAN_ID = A.LOAIBENHAN_ID
        LEFT JOIN LST_DICTIONARY HS ON A.LOAIHSBA_ID = HS.DICTIONARY_ID
        LEFT JOIN LST_DICTIONARY LST ON LST.DICTIONARY_ID = A.TRANGTHAILUUTRU_ID
        where datediff(year,a.NGAYCHUYEN,GETDATE()) > '$BATV$' and HS.DICTIONARY_CODE = 'BATV'
        and (LST.DICTIONARY_CODE IN ('NhapKho','DangMuon','TamNgung'))
        <dynamic>
          <isParameterPresent>
            <isNotEmpty prepend="AND" property="PHONGBAN">
              A.PHONGBAN_ID = '$PHONGBAN$'
            </isNotEmpty>
            <isNotEmpty prepend="AND" property="LOAIHSBA">
              A.LOAIHSBA_ID = '$LOAIHSBA$'
            </isNotEmpty>
            <isNotEmpty prepend="AND" property="TRANGTHAILUUTRU">
              H.DICTIONARY_ID = '$TRANGTHAILUUTRU$'
            </isNotEmpty>
            <isNotEmpty prepend="AND" property="THONGTINTIMKIEM">
              (D.MAYTE LIKE '%' + #THONGTINTIMKIEM# + '%' OR D.TENBENHNHAN LIKE '%' + #THONGTINTIMKIEM# + '%')
            </isNotEmpty>
          </isParameterPresent>
        </dynamic>
      union
      SELECT A.MABENHAN, A.TENBENHNHAN AS TENBENHAN, A.SOLUUTRU, A.SOBIA, A.MABENHNHAN, A.TENBENHNHAN, F.DESCRIPTION AS GENDER, A.NAMSINH, H.DICTIONARY_NAME AS TRANGTHAI,
      A.LOAIBENHAN_ID, G.TENDOITUONG, A.CHANDOAN, A.DIACHI, convert(varchar(10),A.NGAYVAOVIEN,103) NGAYVAOVIEN, convert(varchar(10),A.NGAYRAVIEN,103) NGAYRAVIEN, A.LYDONHAPVIEN_ID, A.NOIDUNGTHANHLY, I.TENLOAIBENHAN AS LOAIBENHAN,
      A.NGUOIGIAO_ID, A.NGUOINHAN_ID, A.NGUOICHUYEN_ID, A.NGAYCHUYEN, A.TRANGTHAILUUTRU_ID, A.MAKE, A.MATANG, A.HOSO_ID, H.DICTIONARY_CODE,
      datediff(year,A.NGAYCHUYEN,getdate()) as SONAM, HS.DICTIONARY_NAME TENLOAIHSBA, A.NGAYTHANHLY, H.DICTIONARY_ID, E.TENPHONGBAN
      FROM TT_BENHAN_LUUTRU A
      LEFT JOIN TT_NOITRU_BENHAN B ON B.BENHAN_ID = A.BENHAN_ID
      LEFT JOIN TT_TIEPNHAN C ON C.TIEPNHAN_ID = B.TIEPNHAN_ID
      LEFT JOIN TT_BENHNHAN D ON D.BENHNHAN_ID = C.BENHNHAN_ID
      LEFT JOIN TM_PHONGBAN E ON E.PHONGBAN_ID = A.PHONGBAN_ID
      LEFT JOIN TM_GENDER F ON F.ID = A.GIOITINH
      LEFT JOIN TM_DOITUONG G ON G.DOITUONG_ID = A.DOITUONG_ID
      LEFT JOIN LST_DICTIONARY H ON H.DICTIONARY_ID = A.TRANGTHAILUUTRU_ID
      LEFT JOIN TM_LOAIBENHAN I ON I.LOAIBENHAN_ID = A.LOAIBENHAN_ID
      LEFT JOIN LST_DICTIONARY HS ON A.LOAIHSBA_ID = HS.DICTIONARY_ID
      LEFT JOIN LST_DICTIONARY LST ON LST.DICTIONARY_ID = A.TRANGTHAILUUTRU_ID
      where datediff(year,a.NGAYCHUYEN,GETDATE()) > (SELECT VALUE FROM TM_SYS_APPSETTINGS WHERE CODE = 'MRA_THOIGIANLUUTRU_BENHANTAMTHAN') and HS.DICTIONARY_CODE = 'BATTHAN'
      and (LST.DICTIONARY_CODE IN ('NhapKho','DangMuon','TamNgung'))
      <dynamic>
        <isParameterPresent>
          <isNotEmpty prepend="AND" property="PHONGBAN">
            A.PHONGBAN_ID = '$PHONGBAN$'
          </isNotEmpty>
          <isNotEmpty prepend="AND" property="LOAIHSBA">
            A.LOAIHSBA_ID = '$LOAIHSBA$'
          </isNotEmpty>
          <isNotEmpty prepend="AND" property="TRANGTHAILUUTRU">
            H.DICTIONARY_ID = '$TRANGTHAILUUTRU$'
          </isNotEmpty>
          <isNotEmpty prepend="AND" property="THONGTINTIMKIEM">
            (D.MAYTE LIKE '%' + #THONGTINTIMKIEM# + '%' OR D.TENBENHNHAN LIKE '%' + #THONGTINTIMKIEM# + '%')
          </isNotEmpty>
        </isParameterPresent>
      </dynamic>
      )T
      )LST
      WHERE LST.ROWNUMBER BETWEEN '$FROMROW$' AND '$TOROW$'
      ORDER BY LST.MABENHNHAN ASC
    </statement>
    <statement id="DAO00086_GetDanhSachHSDaThanhLy" resultClass="DataObject">
      select * from
      (
      SELECT COUNT(*) OVER() as TOTALROWS, ROW_NUMBER() OVER(ORDER BY A.NGAYTHANHLY) ROWNUMBER, A.MACHUNGTUTHANHLY, A.NOIDUNGTHANHLY, A.NGAYTHANHLY,
      B.TENNHANVIEN NGUOITHANHLY
      FROM TT_BENHAN_LUUTRU A
      LEFT JOIN TM_NHANVIEN B ON A.NGUOICAPNHAT_ID = B.NHANVIEN_ID
      LEFT JOIN LST_DICTIONARY LST ON LST.DICTIONARY_ID = A.TRANGTHAILUUTRU_ID
      where (LST.DICTIONARY_CODE='ThanhLy')
      and Convert(date,A.NGAYTHANHLY) between convert(date,'$TUNGAY$') and convert(date,'$DENNGAY$')
      <dynamic>
        <isParameterPresent>
          <isNotEmpty prepend="AND" property="MACHUNGTU">
            A.MACHUNGTUTHANHLY like '%' + #MACHUNGTU# + '%'
          </isNotEmpty>
          <isNotEmpty prepend="AND" property="PHONGBAN">
            A.PHONGBAN_ID = '$PHONGBAN$'
          </isNotEmpty>
        </isParameterPresent>
      </dynamic>
      group by MACHUNGTUTHANHLY,NGAYTHANHLY,NOIDUNGTHANHLY,TENNHANVIEN
      ) lst
      where lst.ROWNUMBER between '$FROMROW$' and '$TOROW$'
    </statement>
    <statement id="DAO00086_GetAll" resultClass="DataObject">
      select *
      from TT_BENHAN_LUUTRU
      order by HOSO_ID
    </statement>
    <statement id="DAO00086_GetCodeNhapKho" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
      select DICTIONARY_ID from LST_DICTIONARY where DICTIONARY_CODE='NhapKho' and DICTIONARY_TYPE_CODE ='TrangThaiBenhAnLuuTru'
    </statement>
    <statement id="DAO00086_GetList" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
      SELECT DICTIONARY_ID, DICTIONARY_NAME FROM LST_DICTIONARY WHERE DICTIONARY_TYPE_CODE='KieuHoSoBenhAn'
    </statement>
    <statement id="DAO00086_GetDetail" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
      select *
      from TT_BENHAN_LUUTRU
      where TT_BENHAN_LUUTRU.HOSO_ID  = '$value$'
      order by HOSO_ID
    </statement>
    <statement id="DAO00086_GetDetailP" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
      select *
      from TT_BENHAN_LUUTRU
      where TT_BENHAN_LUUTRU.HOSO_ID  = '$HOSO_ID$'
      order by HOSO_ID
    </statement>
    <insert id="DAO00086_Add" parameterClass="System.Collections.IDictionary" resultClass="System.Int64">
      insert into TT_BENHAN_LUUTRU (
      BENHAN_ID
      , REF_TABLE
      , MABENHAN
      , TENBENHAN
      , SOLUUTRU
      , MABENHNHAN
      , TENBENHNHAN
      , SOBIA
      , MACHUNGTUNHAPKHO
      , LOAIBENHANLT
      , LOAIHSBA_ID
      , MAKE
      , MATANG
      , NGUOIGIAO_ID
      , NGUOICHUYEN_ID
      , NGUOINHAN_ID
      , NGAYCHUYEN
      , BENHVIEN_ID
      , NGUOITAO_ID
      , NGAYTAO
      , NGUOICAPNHAT_ID
      , NGAYCAPNHAT
      , GIOITINH
      , NAMSINH
      , CHANDOAN
      , DIACHI
      , NGAYVAOVIEN
      , NGAYRAVIEN
      , PHONGBAN_ID
      , LYDONHAPVIEN_ID
      , LOAIBENHAN_ID
      , DOITUONG_ID
      , TRANGTHAILUUTRU_ID
      , SOHOSOTRAVE
      , NHANXET
      , KIEUHSBA_ID
      , TINHTRANG
      ) values (
      #BENHAN_ID#
      , #REF_TABLE#
      , #MABENHAN#
      , #TENBENHAN#
      , #SOLUUTRU#
      , #MABENHNHAN#
      , #TENBENHNHAN#
      , #SOBIA#
      , #MACHUNGTUNHAPKHO#
      , #LOAIBENHANLT#
      , #LOAIHSBA_ID#
      , #MAKE#
      , #MATANG#
      , #NGUOIGIAO_ID#
      , #NGUOICHUYEN_ID#
      , #NGUOINHAN_ID#
      , #NGAYCHUYEN#
      , #BENHVIEN_ID#
      , #NGUOITAO_ID#
      , #NGAYTAO#
      , #NGUOICAPNHAT_ID#
      , #NGAYCAPNHAT#
      , #GIOITINH#
      , #NAMSINH#
      , #CHANDOAN#
      , #DIACHI#
      , #NGAYVAOVIEN#
      , #NGAYRAVIEN#
      , #PHONGBAN_ID#
      , #LYDONHAPVIEN_ID#
      , #LOAIBENHAN_ID#
      , #DOITUONG_ID#
      , #TRANGTHAILUUTRU_ID#
      , #SOHOSOTRAVE#
      , #NHANXET#
      , #KIEUHSBA_ID#
      , #TINHTRANG#
      )
    </insert>
    <update id="DAO00086_UpdateXacNhan" parameterClass="System.Collections.IDictionary">
      update TT_BENHAN_LUUTRU set
      SOLUUTRU = #SOLUUTRU#
      , SOBIA = #SOBIA#
      , LOAIBENHANLT = #LOAIBENHANLT#
      , MAKE = #MAKE#
      , MATANG = #MATANG#
      , NGUOIGIAO_ID = #NGUOIGIAO_ID#
      , NGUOICHUYEN_ID = #NGUOICHUYEN_ID#
      , NGUOINHAN_ID = #NGUOINHAN_ID#
      , TRANGTHAILUUTRU_ID = #TRANGTHAILUUTRU_ID#
      , LOAIHSBA_ID = #LOAIHSBA_ID#
      , MACHUNGTUNHAPKHO = #MACHUNGTUNHAPKHO#
      , SOHOSOTRAVE = #SOHOSOTRAVE#
      , NHANXET = #NHANXET#
      , KIEUHSBA_ID = #KIEUHSBA_ID#
      , TINHTRANG = #TINHTRANG#
      where
      HOSO_ID = '$HOSO_ID$'
    </update>
    <update id="DAO00086_Update" parameterClass="System.Collections.IDictionary">
      update TT_BENHAN_LUUTRU set
      TRANGTHAILUUTRU_ID = #TRANGTHAIBENHAN#
      , MAKE = #MAKE#
      , MATANG = #MATANG#
      , SOBIA= #SOBIA#
      , LOAIHSBA_ID = #LOAIHSBA_ID#
      , KIEUHSBa_ID = #KIEUHSBA_ID#
      where
      HOSO_ID = '$HOSO_ID$'
    </update>
    <update id="DAO00086_UpdateHSThanhLy" parameterClass="System.Collections.IDictionary">
      update TT_BENHAN_LUUTRU set
      TRANGTHAILUUTRU_ID = 8341
      , NOIDUNGTHANHLY = #NOIDUNGTHANHLY#
      , NGAYTHANHLY = #NGAYTHANHLY#
      , MACHUNGTUTHANHLY = #MACHUNGTUTHANHLY#
      , NGUOICAPNHAT_ID = #NGUOICAPNHAT_ID#
      where
      HOSO_ID = '$HOSO_ID$'
    </update>
    <update id="DAO00086_UpdateNoiDungThanhLy" parameterClass="System.Collections.IDictionary">
      update TT_BENHAN_LUUTRU set
      NOIDUNGTHANHLY = #NOIDUNGTHANHLY#,
      MACHUNGTUTHANHLY = #MACHUNGTUTHANHLY#,
      NGAYTHANHLY = #NGAYTHANHLY#
      where
      HOSO_ID = '$HOSO_ID$'
    </update>
    <statement id="DAO00086_Delete" parameterClass="System.Collections.IDictionary" resultClass="System.Int32">
      delete from TT_BENHAN_LUUTRU
      where
      HOSO_ID = '$HOSO_ID$'
    </statement>
    <statement id="DAO00086_DeleteHSBA" parameterClass="System.Collections.IDictionary" resultClass="System.Int32">
      delete from TT_BENHAN_LUUTRU
      where
      HOSO_ID IN (SELECT * FROM DBO.SPLIT('$HOSO_ID$',', '))
    </statement>
    <statement id="DAO00086_DeleteP" parameterClass="System.Collections.IDictionary" resultClass="System.Int32">
      delete from TT_BENHAN_LUUTRU
      <dynamic prepend="where">
        <isParameterPresent>
          <isNotEmpty prepend="and" property="HOSO_ID">
            TT_BENHAN_LUUTRU.HOSO_ID = '$HOSO_ID$'
          </isNotEmpty>
          <isNotEmpty prepend="and" property="BENHAN_ID">
            TT_BENHAN_LUUTRU.BENHAN_ID = '$BENHAN_ID$'
          </isNotEmpty>
          <isNotEmpty prepend="and" property="REF_TABLE">
            TT_BENHAN_LUUTRU.REF_TABLE = '$REF_TABLE$'
          </isNotEmpty>
          <isNotEmpty prepend="and" property="MABENHAN">
            TT_BENHAN_LUUTRU.MABENHAN = '$MABENHAN$'
          </isNotEmpty>
          <isNotEmpty prepend="and" property="SOLUUTRU">
            TT_BENHAN_LUUTRU.SOLUUTRU = '$SOLUUTRU$'
          </isNotEmpty>
          <isNotEmpty prepend="and" property="MABENHNHAN">
            TT_BENHAN_LUUTRU.MABENHNHAN = '$MABENHNHAN$'
          </isNotEmpty>
          <isNotEmpty prepend="and" property="TENBENHNHAN">
            TT_BENHAN_LUUTRU.TENBENHNHAN = '$TENBENHNHAN$'
          </isNotEmpty>
          <isNotEmpty prepend="and" property="MAKE">
            TT_BENHAN_LUUTRU.MAKE = '$MAKE$'
          </isNotEmpty>
          <isNotEmpty prepend="and" property="MATANG">
            TT_BENHAN_LUUTRU.MATANG = '$MATANG$'
          </isNotEmpty>
          <isNotEmpty prepend="and" property="NGUOIGIAO_ID">
            TT_BENHAN_LUUTRU.NGUOIGIAO_ID = '$NGUOIGIAO_ID$'
          </isNotEmpty>
          <isNotEmpty prepend="and" property="NGUOICHUYEN_ID">
            TT_BENHAN_LUUTRU.NGUOICHUYEN_ID = '$NGUOICHUYEN_ID$'
          </isNotEmpty>
          <isNotEmpty prepend="and" property="NGUOINHAN_ID">
            TT_BENHAN_LUUTRU.NGUOINHAN_ID = '$NGUOINHAN_ID$'
          </isNotEmpty>
          <isNotEmpty prepend="and" property="NGAYCHUYEN">
            TT_BENHAN_LUUTRU.NGAYCHUYEN = '$NGAYCHUYEN$'
          </isNotEmpty>
          <isNotEmpty prepend="and" property="BENHVIEN_ID">
            TT_BENHAN_LUUTRU.BENHVIEN_ID = '$BENHVIEN_ID$'
          </isNotEmpty>
          <isNotEmpty prepend="and" property="NGUOITAO_ID">
            TT_BENHAN_LUUTRU.NGUOITAO_ID = '$NGUOITAO_ID$'
          </isNotEmpty>
          <isNotEmpty prepend="and" property="NGAYTAO">
            TT_BENHAN_LUUTRU.NGAYTAO = '$NGAYTAO$'
          </isNotEmpty>
          <isNotEmpty prepend="and" property="NGUOICAPNHAT_ID">
            TT_BENHAN_LUUTRU.NGUOICAPNHAT_ID = '$NGUOICAPNHAT_ID$'
          </isNotEmpty>
          <isNotEmpty prepend="and" property="NGAYCAPNHAT">
            TT_BENHAN_LUUTRU.NGAYCAPNHAT = '$NGAYCAPNHAT$'
          </isNotEmpty>
          <isNotEmpty prepend="and" property="GIOITINH">
            TT_BENHAN_LUUTRU.GIOITINH = '$GIOITINH$'
          </isNotEmpty>
          <isNotEmpty prepend="and" property="NAMSINH">
            TT_BENHAN_LUUTRU.NAMSINH = '$NAMSINH$'
          </isNotEmpty>
          <isNotEmpty prepend="and" property="CHANDOAN">
            TT_BENHAN_LUUTRU.CHANDOAN = '$CHANDOAN$'
          </isNotEmpty>
          <isNotEmpty prepend="and" property="DIACHI">
            TT_BENHAN_LUUTRU.DIACHI = '$DIACHI$'
          </isNotEmpty>
          <isNotEmpty prepend="and" property="NGAYVAOVIEN">
            TT_BENHAN_LUUTRU.NGAYVAOVIEN = '$NGAYVAOVIEN$'
          </isNotEmpty>
          <isNotEmpty prepend="and" property="NGAYRAVIEN">
            TT_BENHAN_LUUTRU.NGAYRAVIEN = '$NGAYRAVIEN$'
          </isNotEmpty>
          <isNotEmpty prepend="and" property="PHONGBAN_ID">
            TT_BENHAN_LUUTRU.PHONGBAN_ID = '$PHONGBAN_ID$'
          </isNotEmpty>
          <isNotEmpty prepend="and" property="LYDONHAPVIEN_ID">
            TT_BENHAN_LUUTRU.LYDONHAPVIEN_ID = '$LYDONHAPVIEN_ID$'
          </isNotEmpty>
          <isNotEmpty prepend="and" property="LOAIBENHAN_ID">
            TT_BENHAN_LUUTRU.LOAIBENHAN_ID = '$LOAIBENHAN_ID$'
          </isNotEmpty>
          <isNotEmpty prepend="and" property="DOITUONG_ID">
            TT_BENHAN_LUUTRU.DOITUONG_ID = '$DOITUONG_ID$'
          </isNotEmpty>
          <isNotEmpty prepend="and" property="TRANGTHAILUUTRU_ID">
            TT_BENHAN_LUUTRU.TRANGTHAILUUTRU_ID = '$TRANGTHAILUUTRU_ID$'
          </isNotEmpty>
        </isParameterPresent>
      </dynamic>
    </statement>
  </statements>
</sqlMap>
