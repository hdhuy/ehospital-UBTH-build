<?xml version="1.0" encoding="utf-8" ?>
<!--============================================================================
//	CAUTION: This file is generated by IBatisNetGen.3.SQLMap.cst at 04/24/2017 1:59:01 PM
//				Any manual editing will be lost in re-generation.
//===========================================================================-->
<sqlMap namespace="eHospital" xmlns="http://ibatis.apache.org/mapping" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
  <statements>
    <statement id="DAO00309_GetList" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
      select DICTIONARY_ID, DICTIONARY_CODE, DICTIONARY_NAME
      from LST_DICTIONARY
      where DICTIONARY_TYPE_CODE = 'XepLoaiKSK'
      <isNotEmpty prepend="and" property="BENHVIEN_ID">
        BENHVIEN_ID = '$BENHVIEN_ID$'
      </isNotEmpty>
    </statement>
    <statement id="DAO00309_GetAll" resultClass="DataObject">
      select *
      from TT_KSK_KETQUA
      where HOPDONG_BENHNHAN_ID = $HOPDONG_BENHNHAN_ID$
      <isNotEmpty prepend="and" property="BENHVIEN_ID">
        BENHVIEN_ID = '$BENHVIEN_ID$'
      </isNotEmpty>
      order by KETQUA_ID
    </statement>
    <statement id="DAO00309_Add" parameterClass="System.Collections.IDictionary" resultClass="System.Int64">
      insert into TT_KSK_KETQUA (
      HOPDONG_ID
      , HOPDONG_BENHNHAN_ID
      , MACH
      , CANNANG
      , CHIEUCAO
      , HUYETAPCAO
      , HUYETAPTHAP
      , NHIPTHO
      , NHIETDO
      , BMI
      , TUANHOAN
      , PLTUANHOAN_ID
      , HOHAP
      , PLHOHAP_ID
      , TIEUHOA
      , PLTIEUHOA_ID
      , THAN
      , PLTHAN_ID
      , NOITIET
      , PLNOITIET_ID
      , COXUONGKHOP
      , PLCOXUONGKHOP_ID
      , THANKINH
      , PLTHANKINH_ID
      , TAMTHAN
      , PLTAMTHAN_ID
      , BACSIKHAMNOI_ID
      , NGOAIKHOA
      , PLNGOAIKHOA_ID
      , BACSINGOAIKHOA_ID
      , SANPHUKHOA
      , PLSANPHUKHOA_ID
      , PHUKHOA
      , PLPHUKHOA_ID
      , NHUBO
      , PLNHUBO_ID
      , BACSISANPHUKHOA_ID
      , COKINHMATTRAI
      , COKINHMATPHAI
      , KHONGKINHMATTRAI
      , KHONGKINHMATPHAI
      , CACBENHVEMAT
      , PLMAT_ID
      , BACSIMAT_ID
      , TAITRAINOITHUONG
      , TAITRAINOITHAM
      , TAIPHAINOITHUONG
      , TAIPHAINOITHAM
      , CACBENHVETAI
      , PLTAIMH_ID
      , BACSITMH_ID
      , HAMTREN
      , HAMDUOI
      , CACBENHVERHM
      , PLRHM_ID
      , BACSIRHM_ID
      , DALIEU
      , PLDALIEU_ID
      , BACSIDALIEU_ID
      , MAICD
      , TENICD
      , BACSIKETLUAN_ID
      , XEPLOAI_ID
      , NHANXET
      , BENHVIEN_ID
      , NGAYTAO
      , NGUOITAO_ID
      , NGAYCAPNHAT
      , NGUOICAPNHAT_ID
      ) values (
      #HOPDONG_ID#
      , #HOPDONG_BENHNHAN_ID#
      , #MACH#
      , #CANNANG#
      , #CHIEUCAO#
      , #HUYETAPCAO#
      , #HUYETAPTHAP#
      , #NHIPTHO#
      , #NHIETDO#
      , #BMI#
      , #TUANHOAN#
      , #PLTUANHOAN_ID#
      , #HOHAP#
      , #PLHOHAP_ID#
      , #TIEUHOA#
      , #PLTIEUHOA_ID#
      , #THAN#
      , #PLTHAN_ID#
      , #NOITIET#
      , #PLNOITIET_ID#
      , #COXUONGKHOP#
      , #PLCOXUONGKHOP_ID#
      , #THANKINH#
      , #PLTHANKINH_ID#
      , #TAMTHAN#
      , #PLTAMTHAN_ID#
      , #BACSIKHAMNOI_ID#
      , #NGOAIKHOA#
      , #PLNGOAIKHOA_ID#
      , #BACSINGOAIKHOA_ID#
      , #SANPHUKHOA#
      , #PLSANPHUKHOA_ID#
      , #PHUKHOA#
      , #PLPHUKHOA_ID#
      , #NHUBO#
      , #PLNHUBO_ID#
      , #BACSISANPHUKHOA_ID#
      , #COKINHMATTRAI#
      , #COKINHMATPHAI#
      , #KHONGKINHMATTRAI#
      , #KHONGKINHMATPHAI#
      , #CACBENHVEMAT#
      , #PLMAT_ID#
      , #BACSIMAT_ID#
      , #TAITRAINOITHUONG#
      , #TAITRAINOITHAM#
      , #TAIPHAINOITHUONG#
      , #TAIPHAINOITHAM#
      , #CACBENHVETAI#
      , #PLTAIMH_ID#
      , #BACSITMH_ID#
      , #HAMTREN#
      , #HAMDUOI#
      , #CACBENHVERHM#
      , #PLRHM_ID#
      , #BACSIRHM_ID#
      , #DALIEU#
      , #PLDALIEU_ID#
      , #BACSIDALIEU_ID#
      , #MAICD#
      , #TENICD#
      , #BACSIKETLUAN_ID#
      , #XEPLOAI_ID#
      , #NHANXET#
      , #BENHVIEN_ID#
      , #NGAYTAO#
      , #NGUOITAO_ID#
      , #NGAYCAPNHAT#
      , #NGUOICAPNHAT_ID#
      )
      select SCOPE_identity() as value
    </statement>

    <update id="DAO00309_Update" parameterClass="System.Collections.IDictionary">
      update TT_KSK_KETQUA set
      HOPDONG_ID = #HOPDONG_ID#
      , HOPDONG_BENHNHAN_ID = #HOPDONG_BENHNHAN_ID#
      , MACH = #MACH#
      , CANNANG = #CANNANG#
      , CHIEUCAO = #CHIEUCAO#
      , HUYETAPCAO = #HUYETAPCAO#
      , HUYETAPTHAP = #HUYETAPTHAP#
      , NHIPTHO = #NHIPTHO#
      , NHIETDO = #NHIETDO#
      , BMI = #BMI#
      , TUANHOAN = #TUANHOAN#
      , PLTUANHOAN_ID = #PLTUANHOAN_ID#
      , HOHAP = #HOHAP#
      , PLHOHAP_ID = #PLHOHAP_ID#
      , TIEUHOA = #TIEUHOA#
      , PLTIEUHOA_ID = #PLTIEUHOA_ID#
      , THAN = #THAN#
      , PLTHAN_ID = #PLTHAN_ID#
      , NOITIET = #NOITIET#
      , PLNOITIET_ID = #PLNOITIET_ID#
      , COXUONGKHOP = #COXUONGKHOP#
      , PLCOXUONGKHOP_ID = #PLCOXUONGKHOP_ID#
      , THANKINH = #THANKINH#
      , PLTHANKINH_ID = #PLTHANKINH_ID#
      , TAMTHAN = #TAMTHAN#
      , PLTAMTHAN_ID = #PLTAMTHAN_ID#
      , BACSIKHAMNOI_ID = #BACSIKHAMNOI_ID#
      , NGOAIKHOA = #NGOAIKHOA#
      , PLNGOAIKHOA_ID = #PLNGOAIKHOA_ID#
      , PHUKHOA = #PHUKHOA#
      , PLPHUKHOA_ID = #PLPHUKHOA_ID#
      , NHUBO = #NHUBO#
      , PLNHUBO_ID = #PLNHUBO_ID#
      , BACSINGOAIKHOA_ID = #BACSINGOAIKHOA_ID#
      , SANPHUKHOA = #SANPHUKHOA#
      , PLSANPHUKHOA_ID = #PLSANPHUKHOA_ID#
      , BACSISANPHUKHOA_ID = #BACSISANPHUKHOA_ID#
      , COKINHMATTRAI = #COKINHMATTRAI#
      , COKINHMATPHAI = #COKINHMATPHAI#
      , KHONGKINHMATTRAI = #KHONGKINHMATTRAI#
      , KHONGKINHMATPHAI = #KHONGKINHMATPHAI#
      , CACBENHVEMAT = #CACBENHVEMAT#
      , PLMAT_ID = #PLMAT_ID#
      , BACSIMAT_ID = #BACSIMAT_ID#
      , TAITRAINOITHUONG = #TAITRAINOITHUONG#
      , TAITRAINOITHAM = #TAITRAINOITHAM#
      , TAIPHAINOITHUONG = #TAIPHAINOITHUONG#
      , TAIPHAINOITHAM = #TAIPHAINOITHAM#
      , CACBENHVETAI = #CACBENHVETAI#
      , PLTAIMH_ID = #PLTAIMH_ID#
      , BACSITMH_ID = #BACSITMH_ID#
      , HAMTREN = #HAMTREN#
      , HAMDUOI = #HAMDUOI#
      , CACBENHVERHM = #CACBENHVERHM#
      , PLRHM_ID = #PLRHM_ID#
      , BACSIRHM_ID = #BACSIRHM_ID#
      , DALIEU = #DALIEU#
      , PLDALIEU_ID = #PLDALIEU_ID#
      , BACSIDALIEU_ID = #BACSIDALIEU_ID#
      , MAICD = #MAICD#
      , TENICD = #TENICD#
      , BACSIKETLUAN_ID = #BACSIKETLUAN_ID#
      , XEPLOAI_ID = #XEPLOAI_ID#
      , NHANXET = #NHANXET#
      , BENHVIEN_ID = #BENHVIEN_ID#
      , NGAYTAO = #NGAYTAO#
      , NGUOITAO_ID = #NGUOITAO_ID#
      , NGAYCAPNHAT = #NGAYCAPNHAT#
      , NGUOICAPNHAT_ID = #NGUOICAPNHAT_ID#
      where
      KETQUA_ID = $KETQUA_ID$
    </update>
    <statement id="DAO00309_Delete" parameterClass="System.Collections.IDictionary" resultClass="System.Int32">
      delete from TT_KSK_KETQUA
      where
      KETQUA_ID = $KETQUA_ID$
    </statement>
    <statement id="DAO00309_GetBenhNhanKQ" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
      SELECT HD_BN.*, LST.DICTIONARY_NAME AS HONNHAN
      , CASE WHEN HD_BN.GIOITINH = '1' THEN N'Nam' ELSE N'Nữ' END AS GENDER
      <!--, CASE WHEN HD_BN.HOPDONG_BENHNHAN_ID IN (SELECT HOPDONG_BENHNHAN_ID FROM TT_KSK_HOPDONG_BENHNHAN_DICHVU) THEN 1 ELSE 0 END BENHNHAN_DANGKYKSK_DICHVU-->
      , KQ.KETQUA_ID
      FROM TT_KSK_HOPDONG_BENHNHAN HD_BN
      LEFT JOIN TT_KSK_HOPDONG HD ON HD.HOPDONG_ID = HD_BN.HOPDONG_ID
      LEFT JOIN LST_DICTIONARY LST ON LST.DICTIONARY_ID = HD_BN.TINHTRANGHONNHAN_ID AND LST.DICTIONARY_TYPE_CODE = 'TinhTrangGiaDinh'
      LEFT JOIN TT_KSK_KETQUA KQ ON KQ.HOPDONG_BENHNHAN_ID = HD_BN.HOPDONG_BENHNHAN_ID
      WHERE HD.HOPDONG_ID = $HOPDONG_ID$
      <dynamic>
        <isParameterPresent>
          <isNotEmpty prepend="AND" property="BENHVIEN_ID">
            HD_BN.BENHVIEN_ID = '$BENHVIEN_ID$'
          </isNotEmpty>
        </isParameterPresent>
      </dynamic>
      ORDER BY HD_BN.STT
    </statement>
    <statement id="DAO00309_GetDichVuKQ" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
      SELECT
      NDV.TENNHOMDICHVU, DV.TENDICHVU, PB.TENPHONGBAN AS NOITHUCHIEN, HD_DV.SOPHIEUYEUCAU
      FROM TT_KSK_HOPDONG_BENHNHAN HD_BN
      LEFT JOIN TT_KSK_HOPDONG_BENHNHAN_DICHVU HD_DV ON HD_DV.HOPDONG_BENHNHAN_ID = HD_BN.HOPDONG_BENHNHAN_ID AND HD_DV.HOPDONG_ID = HD_BN.HOPDONG_ID
      INNER JOIN TM_DICHVU DV ON DV.DICHVU_ID = HD_DV.DICHVU_ID
      LEFT JOIN TM_NHOMDICHVU NDV ON NDV.NHOMDICHVU_ID = DV.NHOMDICHVU_ID
      INNER JOIN TM_PHONGBAN PB ON PB.PHONGBAN_ID = HD_DV.PHONGBAN_ID
      WHERE HD_BN.HOPDONG_BENHNHAN_ID = $HOPDONG_BENHNHAN_ID$ AND HD_DV.TRANGTHAI='DAXACNHAN'
      <dynamic>
        <isParameterPresent>
          <isNotEmpty prepend="AND" property="BENHVIEN_ID">
            HD_BN.BENHVIEN_ID = '$BENHVIEN_ID$'
          </isNotEmpty>
        </isParameterPresent>
      </dynamic>
    </statement>
    <statement id="DAO00309_GetAllCongTy" resultClass="DataObject">
      select * from(
      select COUNT(*) OVER() as TOTALROWS,ROW_NUMBER() OVER (ORDER BY a.CONGTY_ID) as ROWNUMBER, * from
      (select ct.*, lst.DICTIONARY_NAME as LOAICONGTY, CASE WHEN CT.XAPHUONG_ID IS NOT NULL THEN ISNULL(ct.SONHA,'') + ',' + ISNULL(XP.TENDONVI,'') + ',' + ISNULL(QH.TENDONVI,'') + ',' + ISNULL(TP.TENDONVI,'') ELSE '' END as DIACHILIENLAC
      , ct.TAMNGUNG as TRANGTHAI
      from TT_KSK_CONGTY ct
      left join LST_DICTIONARY lst on lst.DICTIONARY_ID = ct.LOAICONGTY_ID
      left join TM_DONVIHANHCHINH XP on XP.MADONVI = ct.XAPHUONG_ID
      <!--left join TM_DONVIHANHCHINH XP on XP.DONVIHANHCHINH_ID = ct.XAPHUONG_ID-->
      left join TM_DONVIHANHCHINH QH on QH.DONVIHANHCHINH_ID = XP.CAPTREN_ID
      left join TM_DONVIHANHCHINH TP on TP.DONVIHANHCHINH_ID = QH.CAPTREN_ID
      <dynamic prepend="where">
        <isParameterPresent>
          <isNotEmpty prepend="and" property="BENHVIEN_ID">
            ct.BENHVIEN_ID = '$BENHVIEN_ID$'
          </isNotEmpty>
          <isNotEmpty prepend="and" property="TENCONGTY">
            ct.TENCONGTY = N'$TENCONGTY$'
          </isNotEmpty>
          <isNotEmpty prepend="and" property="LOAICONGTY_ID">
            ct.LOAICONGTY_ID = $LOAICONGTY_ID$
          </isNotEmpty>
          <!--<isNotEmpty prepend="and" property="TAMNGUNG">
            ct.TAMNGUNG = '$TAMNGUNG$'
          </isNotEmpty>-->
          <isNotEmpty prepend="" property="TAMNGUNG">
            <isEqual prepend="AND" property="TAMNGUNG" compareValue="01">
              ct.TAMNGUNG = '1'
            </isEqual>
            <isEqual prepend="AND" property="TAMNGUNG" compareValue="02">
              ct.TAMNGUNG = '0'
            </isEqual>
          </isNotEmpty>
        </isParameterPresent>
      </dynamic>
      )a
      )b
      where b.ROWNUMBER between '$FROMROW$' AND '$TOROW$'
      order by b.CONGTY_ID
    </statement>
    <statement id="DAO00309_GetLoaiCongTy" resultClass="DataObject">
      select *
      from LST_DICTIONARY where DICTIONARY_TYPE_CODE = 'LoaiCongTy'
      <isNotEmpty prepend="and" property="BENHVIEN_ID">
        BENHVIEN_ID = '$BENHVIEN_ID$'
      </isNotEmpty>
    </statement>
    <statement id="DAO00309_CheckCompanyCode" resultClass="DataObject">
      select * from TT_KSK_CONGTY where MACONGTY = '$MACONGTY$'
      <isNotEmpty prepend="and" property="BENHVIEN_ID">
        BENHVIEN_ID = '$BENHVIEN_ID$'
      </isNotEmpty>
    </statement>
    <statement id="DAO00309_CheckCompanyUsing" resultClass="DataObject">
      select top 1 * from TT_KSK_HOPDONG where CONGTY_ID = $CONGTY_ID$
      <isNotEmpty prepend="and" property="BENHVIEN_ID">
        BENHVIEN_ID = '$BENHVIEN_ID$'
      </isNotEmpty>
    </statement>
    <statement id="DAO00309_CheckContactUsing" resultClass="DataObject">
      select top 1 * from TT_KSK_HOPDONG_BENHNHAN where HOPDONG_ID = $HOPDONG_ID$
      <isNotEmpty prepend="and" property="BENHVIEN_ID">
        BENHVIEN_ID = '$BENHVIEN_ID$'
      </isNotEmpty>
    </statement>
    <statement id="DAO00309_GetCompany" resultClass="DataObject">
      select * from TT_KSK_CONGTY
      <dynamic prepend="where">
        <isParameterPresent>
          <isNotEmpty prepend="and" property="BENHVIEN_ID">
            BENHVIEN_ID = '$BENHVIEN_ID$'
          </isNotEmpty>
          <isNotEmpty prepend="and" property="CONGTY_ID">
            CONGTY_ID = $CONGTY_ID$
          </isNotEmpty>
        </isParameterPresent>
      </dynamic>
    </statement>
    <statement id="DAO00309_GetBenhNhanKSK" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
      SELECT HD_BN.*, LST.DICTIONARY_NAME AS HONNHAN
      , CASE WHEN HD_BN.GIOITINH = '1' THEN N'Nam' ELSE N'Nữ' END AS GENDER
      , NV.TENNHANVIEN, GOI.TENGOI
      , DT.DICTIONARY_NAME as DOITUONG
      , HC.TENDONVI as NOICAP
      , convert(varchar(10),HD_BN.NGAYSINH,103) as NGAYTHANGNAMSINH
      FROM TT_KSK_HOPDONG_BENHNHAN HD_BN
      LEFT JOIN TT_KSK_HOPDONG HD ON HD.HOPDONG_ID = HD_BN.HOPDONG_ID
      LEFT JOIN LST_DICTIONARY LST ON LST.DICTIONARY_ID = HD_BN.TINHTRANGHONNHAN_ID AND LST.DICTIONARY_TYPE_CODE = 'TinhTrangGiaDinh'
      LEFT JOIN TM_NHANVIEN NV ON NV.NHANVIEN_ID = HD_BN.NHANVIEN_ID
      LEFT JOIN TM_CSKH_GOI GOI ON GOI.GOI_ID = HD_BN.GOI_ID
      LEFT JOIN LST_DICTIONARY DT ON DT.DICTIONARY_ID = HD_BN.DOITUONG_ID AND DT.DICTIONARY_TYPE_CODE = 'DoiTuongKhamSucKhoe'
      LEFT JOIN TM_DONVIHANHCHINH HC ON HC.DONVIHANHCHINH_ID = HD_BN.NOICAP_ID
      WHERE HD_BN.HOPDONG_ID IS NULL
      <dynamic>
        <isParameterPresent>
          <isNotEmpty prepend="and" property="STATUS_CODE">
            1 = case
            when '$STATUS_CODE$' = 'ChuaCap' then case when HD_BN.MAYTE is null then 1 end
            when HD_BN.MAYTE is not null then 1 end
          </isNotEmpty>
          <isNotEmpty prepend="and" property="KEY">
            (HD_BN.MAYTE LIKE '%' + #KEY# + '%' OR HD_BN.TENBENHNHAN LIKE '%' + #KEY# + '%')
          </isNotEmpty>
          <isNotEmpty prepend="and" property="FGIOITINH">
            HD_BN.GIOITINH = '$FGIOITINH$'
          </isNotEmpty>
          <isNotEmpty prepend="and" property="BENHVIEN_ID">
            HD_BN.BENHVIEN_ID = '$BENHVIEN_ID$'
          </isNotEmpty>
        </isParameterPresent>
        ORDER BY HD_BN.STT
      </dynamic>
    </statement>
    <statement id="DAO00309_GetPatientSignPackage" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
      SELECT HD_BN.*, LST.DICTIONARY_NAME AS HONNHAN
      , CASE WHEN HD_BN.GIOITINH = '1' THEN N'Nam' ELSE N'Nữ' END AS GENDER
      , CASE WHEN HD_BN.HOPDONG_BENHNHAN_ID IN (SELECT HOPDONG_BENHNHAN_ID FROM TT_KSK_HOPDONG_BENHNHAN_DICHVU) THEN 1 ELSE 0 END BENHNHAN_DANGKYKSK_DICHVU
      , CASE WHEN HD_BN.BENHNHAN_ID IN (SELECT BENHNHAN_ID FROM TT_TIEPNHAN) THEN 1 ELSE 0 END TIEPNHAN_BENHNHAN
      , GOI.TENGOI, BN_DV.TIEPNHAN_ID, TN.SOTIEPNHAN
      FROM TT_KSK_HOPDONG_BENHNHAN HD_BN
      LEFT JOIN (SELECT TOP 1 * FROM TT_KSK_HOPDONG_BENHNHAN_DICHVU WHERE HOPDONG_BENHNHAN_ID = $HOPDONG_BENHNHAN_ID$ AND TIEPNHAN_ID IS NOT NULL) BN_DV ON BN_DV.HOPDONG_BENHNHAN_ID = HD_BN.HOPDONG_BENHNHAN_ID
      LEFT JOIN LST_DICTIONARY LST ON LST.DICTIONARY_ID = HD_BN.TINHTRANGHONNHAN_ID AND LST.DICTIONARY_TYPE_CODE = 'TinhTrangGiaDinh'
      LEFT JOIN TM_CSKH_GOI GOI ON GOI.GOI_ID = HD_BN.GOI_ID
      LEFT JOIN TT_TIEPNHAN TN ON TN.BENHNHAN_ID = HD_BN.BENHNHAN_ID
      WHERE HD_BN.HOPDONG_ID IS NULL
      <dynamic>
        <isParameterPresent>
          <isNotEmpty prepend="AND" property="BENHVIEN_ID">
            HD_BN.BENHVIEN_ID = '$BENHVIEN_ID$'
          </isNotEmpty>
          <isNotEmpty prepend="AND" property="KEYTIMKIEM">
            (HD_BN.MAYTE LIKE '%' + #KEYTIMKIEM# + '%' or HD_BN.TENBENHNHAN LIKE '%' + #KEYTIMKIEM# + '%')
          </isNotEmpty>
        </isParameterPresent>
      </dynamic>
    </statement>
    <statement id="DAO00309_GetBenhNhanDichVu" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
      SELECT distinct HD_BN.HOPDONG_ID, DV.TENDICHVU, PB.TENPHONGBAN AS NOITHUCHIEN, NDV.TENNHOMDICHVU, PB.PHONGBAN_ID, DV.DICHVU_ID
      , ISNULL(GOI_CT.DONGIATRONGGOI,0) AS DONGIA_DOANHTHU, ISNULL(GOI_CT.SOLAN,0) AS SOLUONG, GOI_CT.THANHTIENTRONGGOI AS BENHNHANTRA
      , CASE WHEN DV.DICHVU_ID IN (SELECT DICHVU_ID FROM TT_KSK_HOPDONG_BENHNHAN_DICHVU WHERE HOPDONG_BENHNHAN_ID = '$HOPDONG_BENHNHAN_ID$') THEN 1 ELSE 0 END AS DANGKY
      , BN_DV.HOPDONG_DICHVU_BENHNHAN_ID, BN_DV.TIEPNHAN_ID, BN_DV.VIENPHI_ID, BN_DV.DVYEUCAU_ID
      FROM TT_KSK_HOPDONG_BENHNHAN HD_BN
      INNER JOIN TM_CSKH_GOI_CHITIET GOI_CT ON GOI_CT.GOI_ID = HD_BN.GOI_ID
      LEFT JOIN TT_KSK_HOPDONG_BENHNHAN_DICHVU BN_DV ON BN_DV.HOPDONG_BENHNHAN_ID = HD_BN.HOPDONG_BENHNHAN_ID and BN_DV.DICHVU_ID = GOI_CT.DICHVU_ID
      INNER JOIN TM_DICHVU DV ON DV.DICHVU_ID = GOI_CT.DICHVU_ID
      LEFT JOIN TM_NHOMDICHVU NDV ON NDV.NHOMDICHVU_ID = DV.NHOMDICHVU_ID
      INNER JOIN TM_PHONGBAN_DICHVU PB_DV ON PB_DV.DICHVU_ID = DV.DICHVU_ID
      LEFT JOIN TM_PHONGBAN PB ON PB.PHONGBAN_ID = PB_DV.PHONGBAN_ID
      WHERE GOI_CT.GOI_ID = $GOI_ID$ and HD_BN.HOPDONG_BENHNHAN_ID = $HOPDONG_BENHNHAN_ID$
      and PB_DV.PHONGBAN_ID =(select top 1 PHONGBAN_ID from TM_PHONGBAN_DICHVU where DICHVU_ID = DV.DICHVU_ID)
    </statement>
    <statement id="DAO00309_GhiChu" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
      select GHICHU from TT_KSK_HOPDONG_BENHNHAN where HOPDONG_BENHNHAN_ID = $HOPDONG_BENHNHAN_ID$
    </statement>
    <statement id="DAO00309_GetListGoiDVKhamSucKhoe" resultClass="DataObject">
      select A.* from TM_CSKH_GOI A join LST_DICTIONARY B ON A.LOAIGOI_ID = B.DICTIONARY_ID
      where B.DICTIONARY_CODE = 'KhamSucKhoe'
      <isNotEmpty prepend="and" property="TUKHOA">
        (A.TENGOI LIKE '%' + #TUKHOA# + '%' or A.MAGOI LIKE '%' + #TUKHOA# + '%')
      </isNotEmpty>
      <isNotEmpty prepend="and" property="NGAYHIENTAI">
        A.TRANGTHAI = '$TRANGTHAIGOI$'
      </isNotEmpty>
      <isNotEmpty prepend="and" property="TRANGTHAI">
        A.TRANGTHAI = '$TRANGTHAI$'
      </isNotEmpty>
      <isNotEmpty prepend="and" property="DENNGAY">
        convert(date,A.NGAYTAO) between convert(date, '$TUNGAY$') and convert(date, '$DENNGAY$')
      </isNotEmpty>
      <isNotEmpty prepend="and" property="BENHVIEN_ID">
        A.BENHVIEN_ID = '$BENHVIEN_ID$'
      </isNotEmpty>
      <isNotEmpty prepend="and" property="NGAYKETTHUCBAN">
        convert(date,A.NGAYTAO) between convert(date, '$NGAYBATDAUBAN$') and convert(date, '$NGAYKETTHUCBAN$')
      </isNotEmpty>
      <isNotEmpty prepend="and" property="NGAYHIENTAI">
        convert(date,'$NGAYHIENTAI$') between convert(date, A.NGAYBATDAUBAN) and convert(date, NGAYKETTHUCBAN)
      </isNotEmpty>
    </statement>
  </statements>
</sqlMap>
