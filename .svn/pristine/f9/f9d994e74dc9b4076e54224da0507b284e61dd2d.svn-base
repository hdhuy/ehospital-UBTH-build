<?xml version="1.0" encoding="utf-8" ?>
<!--============================================================================
//	CAUTION: This file is generated by IBatisNetGen.3.SQLMap.cst at 4/1/2016 9:22:01 AM
//				Any manual editing will be lost in re-generation.
//===========================================================================-->
<sqlMap namespace="eHospital" xmlns="http://ibatis.apache.org/mapping" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">

  <statements>   
    <statement id="DAO00217_Execute_Stored" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
      exec $PROCEDURE_NAME$
      <iterate property="PARAMETERS" open="" close="" conjunction=",">
        #PARAMETERS[]#
      </iterate>
    </statement>
    <statement id="DAO00217_Get_ListMaYTe" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
      select MAYTE from TT_BENHNHAN
    </statement>
    <statement id="DAO00217_LoadThongTinLichSuKetQuaXetNghiem" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
      DECLARE @DICHVU_ID INT
      SET @DICHVU_ID =(SELECT TOP 1 DICHVU_ID FROM TT_DVYEUCAU A WHERE A.DVYEUCAU_ID='$DVYEUCAU_ID$')

      SELECT CT.MUCBINHTHUONG GIOIHAN, CT.KETQUA,KQ.CLSKETQUA_ID,KQ.NGAYTAO
      ,CASE WHEN  DVCT.CAPTREN_ID IS NULL THEN DVCT.DICHVU_ID ELSE DVCT.CAPTREN_ID END CAPTREN,DVCT.DICHVU_ID
      ,CT.MUCBINHTHUONGMIN,CT.MUCBINHTHUONGMAX,TM.TENDICHVU DICHVUCHA,isnull(DVCT.TENDICHVU,tm.tendichvu) TENDICHVU,YC.DVYEUCAU_ID, KQ.NGAYKHOADULIEU
      FROM TM_DICHVU TM
      INNER JOIN TT_DVYEUCAU YC ON TM.DICHVU_ID=YC.DICHVU_ID
      INNER JOIN TT_BENHNHAN BN ON YC.BENHNHAN_ID=BN.BENHNHAN_ID
      INNER JOIN VIEW_CLS_KETQUA_DICHVU VKQ  on YC.DVYEUCAU_ID =VKQ.DVYEUCAU_ID AND VKQ.DICHVUCHA_ID=@DICHVU_ID
      LEFT JOIN TT_CLSKETQUACHITIET CT ON VKQ .CLSKETQUACHITIET_ID = CT.CLSKETQUACHITIET_ID
      LEFT JOIN TT_CLSKETQUA KQ ON CT.CLSKETQUA_ID =KQ.CLSKETQUA_ID
      LEFT JOIN TM_DICHVU DVCT ON CT.DICHVU_ID= DVCT.DICHVU_ID
      WHERE BN.BENHNHAN_ID='$BENHNHAN_ID$' AND YC.DICHVU_ID=@DICHVU_ID
      AND convert(date,yc.NGAYTAO) between convert(date,'$TUNGAY$') and convert(date,'$DENNGAY$')
      order by yc.DVYEUCAU_ID DESC
      <!--where dv.dichvu_id=10328 OR DV.CAPTREN_ID=10328-->

    </statement>
    <statement id="DAO00217_GetDSTTDichVuByBenhNhanID" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
      select ba.SOBENHAN, isnull(dv.THOIGIANKHOADULIEU, dv.NGAYGIOYEUCAU) as THOIGIANTHUCHIEN
      , isnull(dv.NGUOIKHOA_ID,dv.NGUOICAPNHAT_ID) as BACSITHUCHIEN_ID,
      tn.SOTIEPNHAN, dv.*, vp.SOLUONG
      , nv.TENNHANVIEN as TENBACSICHIDINH
      , nv2.TENNHANVIEN as TENNGUOITHUCHIEN
      from TT_DVYEUCAU dv
      left join TT_NOITRU_BENHAN ba on dv.BENHAN_ID = ba.BENHAN_ID
      left join TT_CLSKETQUA clskq on clskq.DVYEUCAU_ID = dv.DVYEUCAU_ID
      left join TT_NGOAITRU_KHAMBENH kb on dv.KHAMBENH_NGOAITRU_ID = kb.KHAMBENH_ID
      left join TT_PHAUTHUAT pt on pt.PHAUTHUAT_ID in (select PHAUTHUAT_ID from TT_PHAUTHUAT_YEUCAU where DVYEUCAU_ID = dv.DVYEUCAU_ID)
      left join TT_TIEPNHAN tn on dv.TIEPNHAN_ID = tn.TIEPNHAN_ID
      left join TT_VIENPHI vp on vp.REF_ID = dv.DVYEUCAU_ID and REF_TABLE = 'TT_DVYEUCAU'
      inner join TM_NHANVIEN nv on nv.NHANVIEN_ID = dv.BACSICHIDINH_ID
      left join TM_NHANVIEN nv2 on nv2.NHANVIEN_ID = dv.NGUOIKHOA_ID
      where tn.BENHNHAN_ID = '$BENHNHAN_ID$'
      and dv.BENHVIEN_ID = '$BENHVIEN_ID$' and dv.HUYYEUCAU='0'

      <isNotEmpty prepend="and" property="TUNGAY">
        convert(date, NGAYGIOYEUCAU) &#62;&#61; convert(date, '$TUNGAY$')
      </isNotEmpty>
      <isNotEmpty prepend="and" property="DENNGAY">
        convert(date, NGAYGIOYEUCAU) &#60;&#61; convert(date, '$DENNGAY$')
      </isNotEmpty>
      <isNotEmpty prepend="and" property="BACSICHIDINH_ID">
        dv.BACSICHIDINH_ID = '$BACSICHIDINH_ID$'
      </isNotEmpty>
      <isNotEmpty prepend="and" property="NOIYEUCAU_ID">
        dv.NOIYEUCAU_ID = '$NOIYEUCAU_ID$'
      </isNotEmpty>
      order by DVYEUCAU_ID
      desc
    </statement>
    <statement id="DAO00217_GetDepartmentAll" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
      select * from TM_PHONGBAN
    </statement>
    <statement id="DAO00217_GetEmployeeAll" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
      select * from TM_NHANVIEN
    </statement>
  </statements>

</sqlMap>
