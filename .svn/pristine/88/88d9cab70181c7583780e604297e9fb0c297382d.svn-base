<?xml version="1.0" encoding="utf-8" ?>
<!--iBatis Map File-->
<sqlMap namespace="eHospital" xmlns="http://ibatis.apache.org/mapping" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
    <statements>
        <!--Revision:0,8989646ed88fc370b353bd47ed43eafe-->
        <statement id="DAO00024_GetKhoduoc_id" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
            select KHODUOC_ID
            from TM_KHODUOC
            where
            MAKHO = '$MAKHO$'
        </statement>
        <!--Revision:0,69e291f15026ec51bc49508d0d6979bc-->
        <statement id="DAO00024_CheckPhatSinhHoaDon" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
            select *
            from TT_VIENPHI
            where
            TIEPNHAN_ID = '$TIEPNHAN_ID$'
            AND HOADON_ID IS NOT NULL
        </statement>
        <!--Revision:0,b287a14bd3769c522b1310950eb5580c-->
        <statement id="DAO00024_TT_HOADON_GetAll" resultClass="DataObject">
            select *
            from TT_HOADON
            order by HOADON_ID
        </statement>
        <!--Revision:0,80821576a5f49052fe17db37e0f35126-->
        <statement id="DAO00024_TT_HOADON_GetList_TamUng" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
            select A.*, B.HUYHOADON as HUYHOANUNG
            from TT_HOADON A LEFT JOIN  TT_HOADON B ON A.HOADONLIENQUAN_ID = B.HOADON_ID
            where
            A.DATHANHTOAN = '1'
            and A.TRANGTHAI = 'DATHUTIEN'
            <!--HOADONLIENQUAN_ID is NULL-->
            <isParameterPresent>
                <isNotEmpty prepend="and" property="LOAIHOADON">
                    A.LOAIHOADON = '$LOAIHOADON$'
                </isNotEmpty>
                <isNotEmpty prepend="and" property="TIEPNHAN_ID">
                    A.TIEPNHAN_ID = '$TIEPNHAN_ID$'
                </isNotEmpty>
                <isNotEmpty prepend="and" property="BENHNHAN_ID">
                    A.BENHNHAN_ID = '$BENHNHAN_ID$'
                </isNotEmpty>
              <isNotEmpty prepend="and" property="BENHAN_ID">
                A.BENHAN_ID = '$BENHAN_ID$'
              </isNotEmpty>
                <isNotEmpty prepend="and" property="HUYHOADON">
                    A.HUYHOADON = '$HUYHOADON$'
                </isNotEmpty>
              <isNotEmpty prepend="and" property="HOANTRA">
                A.HOANTRA = '$HOANTRA$'
              </isNotEmpty>
            </isParameterPresent>
            order by HOADON_ID
        </statement>
        <!--Revision:0,eb5c3528062a4b6e7e92c2934afcd749-->
        <statement id="DAO00024_TT_HOADON_KiemTraBienLai_TamUng" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
            select A.*
            from TT_HOADON A LEFT JOIN  TT_HOADON B ON A.HOADONLIENQUAN_ID = B.HOADON_ID
            where
            A.DATHANHTOAN = '1'
            and A.TRANGTHAI = 'DATHUTIEN'
            and A.HUYHOADON = '0'
            <!--HOADONLIENQUAN_ID is NULL-->
            <isParameterPresent>
                <isNotEmpty prepend="and" property="LOAIHOADON">
                    A.LOAIHOADON = '$LOAIHOADON$'
                </isNotEmpty>
                <isNotEmpty prepend="and" property="TIEPNHAN_ID">
                    A.TIEPNHAN_ID = '$TIEPNHAN_ID$'
                </isNotEmpty>
                <isNotEmpty prepend="and" property="BENHAN_ID">
                  A.BENHAN_ID = '$BENHAN_ID$'
                </isNotEmpty>
                <isNotEmpty prepend="and" property="BENHNHAN_ID">
                    A.BENHNHAN_ID = '$BENHNHAN_ID$'
                </isNotEmpty>
            </isParameterPresent>
            order by HOADON_ID
        </statement>
        <!--Revision:0,e26d55833f3b9d73d8d1cce319c83456-->
        <statement id="DAO00024_TT_HOADON_Search" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
          select distinct A.*, B.SOHOADON AS HOADONLIENQUAN, bn.MAYTE
          , CASE ISNULL(BN.NGAYSINH,'')
          WHEN '' THEN CONVERT(VARCHAR(10), BN.NAMSINH)
          ELSE CONVERT(VARCHAR(10), BN.NGAYSINH, 103)
          END AS NAMSINH, ntba.SOBENHAN, bn.TENBENHNHAN, '' as TENBENHNHAN2,
          ntba.TRANGTHAI as TRANGTHAINOITRU, tn.TRANGTHAI as TRANGTHAINGOAITRU, ntba.LOAIBENHAN
          <!--, ntba.BENHAN_ID-->
          from TT_HOADON A 
          LEFT JOIN  TT_HOADON B ON A.HOADONLIENQUAN_ID = B.HOADON_ID
          left join TT_TIEPNHAN tn on tn.TIEPNHAN_ID = a.TIEPNHAN_ID
          inner join TT_BENHNHAN bn on bn.BENHNHAN_ID = tn.BENHNHAN_ID
          <isNotEmpty prepend="" property="NOITRU">
              <isEqual prepend="" property="NOITRU" compareValue="true">
                left join TT_HOADON_CHITIET_NOITRU VP on VP.HOADON_ID = A.HOADON_ID
                left join TT_NOITRU_BENHAN ntba on ntba.BENHAN_ID = a.BENHAN_ID
              </isEqual>
              <isEqual prepend="" property="NOITRU" compareValue="false">
                left join TT_HOADON_CHITIET_NGOAITRU VP on VP.HOADON_ID = A.HOADON_ID
                left join TT_NOITRU_BENHAN ntba on ntba.TIEPNHAN_ID = a.TIEPNHAN_ID
              </isEqual>
          </isNotEmpty>                        
            <dynamic prepend="where(">
                <isParameterPresent>
                    <isNotEmpty prepend="and" property="DATHANHTOAN">
                      (A.DATHANHTOAN = '$DATHANHTOAN$'
                      <isEqual prepend="and" property="DATHANHTOAN" compareValue="1">
                        A.TRANGTHAI != 'DADUYETCONGNO'
                      </isEqual>)
                        and (A.HUYHOADON is null or A.HUYHOADON = '0')
                        and (A.HOANTRA is null or A.HOANTRA = '0')
                    </isNotEmpty>
                    <isNotEmpty prepend="or" property="HUYHOADON">
                        A.HUYHOADON = '$HUYHOADON$'
                    </isNotEmpty>
                    <isNotEmpty prepend="or" property="HOANTRA">
                        A.HOANTRA = '$HOANTRA$'
                    </isNotEmpty>
                    <isNotEmpty prepend="or" property="CHUATHANHTOAN">
                        A.DATHANHTOAN = 0
                    </isNotEmpty>
                    )
                    <isNotEmpty prepend="and" property="TIEPNHAN_ID">
                        A.TIEPNHAN_ID = '$TIEPNHAN_ID$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="BENHAN_ID">
                        A.BENHAN_ID = '$BENHAN_ID$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="TUKHOA">
                      A.SOHOADON like '%' + #TUKHOA# + '%'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="TENBENHNHAN">
                      (bn.TENBENHNHAN like '%' + #TENBENHNHAN# + '%' or bn.MAYTE like '%' + #TENBENHNHAN# + '%')
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="DENNGAY">
                        convert(date,A.NGAYHOADON) between convert(date, '$TUNGAY$') and convert(date, '$DENNGAY$')
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="TRANGTHAI">
                        A.TRANGTHAI = '$TRANGTHAI$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="USER_ID">
                        (A.NGUOICAPNHAT_ID = '$USER_ID$' or A.NGUOITAO_ID = '$USER_ID$')
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="BENHNHAN_ID">
                        A.BENHNHAN_ID = '$BENHNHAN_ID$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="BENHVIEN_ID">
                        A.BENHVIEN_ID = '$BENHVIEN_ID$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="LIST_REF_TABLE">
                        (VP.REF_TABLE IS NULL OR VP.REF_TABLE not in ($LIST_REF_TABLE$))
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="LIST_IN_REF_TABLE">
                        VP.REF_TABLE in ($LIST_IN_REF_TABLE$)
                    </isNotEmpty>
                  <isNotEmpty prepend=" and " property="NOITRU">
                    <isEqual prepend="" property="NOITRU" compareValue="true">
                      A.BENHAN_ID is not null <!--and ntba.BENHAN_ID = '$BENHAN_ID$'-->
                      <isNotEmpty prepend="and" property="BENHAN_ID">
                        ntba.BENHAN_ID = '$BENHAN_ID$'
                      </isNotEmpty>
                    </isEqual>
                    <isEqual prepend="" property="NOITRU" compareValue="false">
                      A.BENHAN_ID is null or A.BENHAN_ID = 0
                    </isEqual>                    
                  </isNotEmpty>                  
                </isParameterPresent>
            </dynamic>
            order by A.NGAYHOADON
        </statement>
        <!--Revision:0,344cdbaf004d557c553ec61cb0ac1a7a-->
        <statement id="DAO00024_TT_HOADON_Search_ToaMuaNgoai" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
          select distinct A.*, B.SOHOADON AS HOADONLIENQUAN,
          nps.TENPHONGBAN as NOIPHATSINH, ntt.TENPHONGBAN as NOITHUTIEN,
          bn.MAYTE, bn.TENBENHNHAN, NM.TENNGUOIMUA TENBENHNHAN2
          from TT_HOADON A LEFT JOIN  TT_HOADON B ON A.HOADONLIENQUAN_ID = B.HOADON_ID
          left join TT_HOADON_CHITIET_NGOAITRU VP on VP.HOADON_ID = A.HOADON_ID
          left join TT_BENHNHAN bn on (bn.BENHNHAN_ID = a.BENHNHAN_ID)
          left join TT_DUOC_CHUNGTU_CHITIET ctct on ctct.CHUNGTUCHITIET_ID= vp.REF_ID
          left join TT_DUOC_CHUNGTU ct on ct.CHUNGTU_ID = ctct.CHUNGTU_ID
          left join TT_NGOAITRU_TOATHUOC_NGUOIMUA NM on NM.NGOAITRU_TOATHUOC_NGUOIMUA_ID = CT.NGOAITRU_TOATHUOC_NGUOIMUA_ID
          left join TM_PHONGBAN nps on nps.PHONGBAN_ID = a.NOIPHATSINH_ID
          left join TM_PHONGBAN ntt on ntt.PHONGBAN_ID = a.NOITHUTIEN_ID
          <dynamic prepend="where(">
                <isParameterPresent>
                    <isNotEmpty prepend="and" property="DATHANHTOAN">
                        A.DATHANHTOAN = '$DATHANHTOAN$'
                        and (A.HUYHOADON is null or A.HUYHOADON = '0')
                        and (A.HOANTRA is null or A.HOANTRA = '0')
                    </isNotEmpty>
                    <isNotEmpty prepend="or" property="HUYHOADON">
                        A.HUYHOADON = '$HUYHOADON$'
                    </isNotEmpty>
                    <isNotEmpty prepend="or" property="HOANTRA">
                        A.HOANTRA = '$HOANTRA$'
                    </isNotEmpty>
                    <isNotEmpty prepend="or" property="CHUATHANHTOAN">
                        A.DATHANHTOAN = 0
                    </isNotEmpty>
                    )
                    <isNotEmpty prepend="and" property="TIEPNHAN_ID">
                        A.TIEPNHAN_ID = '$TIEPNHAN_ID$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="BENHAN_ID">
                        A.BENHAN_ID = '$BENHAN_ID$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="TUKHOA">
                      A.SOHOADON like '%' + #TUKHOA# + '%'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="TENBENHNHAN">
                      (bn.TENBENHNHAN like '%' + #TENBENHNHAN# + '%' or bn.MAYTE like '%' + #TENBENHNHAN# + '%' or NM.TENNGUOIMUA like  '%' + #TENBENHNHAN# + '%')
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="DENNGAY">
                        convert(date,A.NGAYHOADON) between convert(date, '$TUNGAY$') and convert(date, '$DENNGAY$')
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="TRANGTHAI">
                        A.TRANGTHAI = '$TRANGTHAI$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="USER_ID">
                        (A.NGUOICAPNHAT_ID = '$USER_ID$' or A.NGUOITAO_ID = '$USER_ID$')
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="BENHNHAN_ID">
                        A.BENHNHAN_ID = '$BENHNHAN_ID$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="BENHVIEN_ID">
                        A.BENHVIEN_ID = '$BENHVIEN_ID$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="LIST_REF_TABLE">
                        (VP.REF_TABLE IS NULL OR VP.REF_TABLE not in ($LIST_REF_TABLE$))
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="LIST_IN_REF_TABLE">
                        VP.REF_TABLE in ($LIST_IN_REF_TABLE$)
                    </isNotEmpty>
                </isParameterPresent>
            </dynamic>
            order by A.NGAYHOADON
        </statement>
        <!--Revision:0,08a8849a2b7a65aa094f2724b830cb0f-->
        <statement id="DAO00024_TT_HOADON_SearchGoi" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
            select distinct A.*, B.SOHOADON AS HOADONLIENQUAN, bn.MAYTE
            , CASE ISNULL(BN.NGAYSINH,'')
            WHEN '' THEN CONVERT(VARCHAR(10), BN.NAMSINH)
            ELSE CONVERT(VARCHAR(10), BN.NGAYSINH, 103)
            END AS NAMSINH, ntba.SOBENHAN, bn.TENBENHNHAN
            , ntba.TRANGTHAI as TRANGTHAINOITRU, tn.TRANGTHAI as TRANGTHAINGOAITRU
            from TT_HOADON A LEFT JOIN  TT_HOADON B ON A.HOADONLIENQUAN_ID = B.HOADON_ID
            inner join TT_HOADON_CHITIET_NGOAITRU VP on VP.HOADON_ID = A.HOADON_ID
            left join TT_TIEPNHAN tn on tn.TIEPNHAN_ID = a.TIEPNHAN_ID
            left join TT_BENHNHAN bn on bn.BENHNHAN_ID = A.BENHNHAN_ID
            left join TT_NOITRU_BENHAN ntba on ntba.TIEPNHAN_ID = a.TIEPNHAN_ID
            <dynamic prepend="where(">
                <isParameterPresent>
                    <isNotEmpty prepend="and" property="DATHANHTOAN">
                        A.DATHANHTOAN = '$DATHANHTOAN$'
                        and (A.HUYHOADON is null or A.HUYHOADON = '0')
                        and (A.HOANTRA is null or A.HOANTRA = '0')
                    </isNotEmpty>
                    <isNotEmpty prepend="or" property="HUYHOADON">
                        A.HUYHOADON = '$HUYHOADON$'
                    </isNotEmpty>
                    <isNotEmpty prepend="or" property="HOANTRA">
                        A.HOANTRA = '$HOANTRA$'
                    </isNotEmpty>
                    <isNotEmpty prepend="or" property="CHUATHANHTOAN">
                        A.DATHANHTOAN = 0
                    </isNotEmpty>
                    )
                    <isNotEmpty prepend="and" property="TIEPNHAN_ID">
                        A.TIEPNHAN_ID = '$TIEPNHAN_ID$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="TUKHOA">
                      A.SOHOADON like '%' + #TUKHOA# + '%'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="TENBENHNHAN">
                      (bn.TENBENHNHAN like '%' + #TENBENHNHAN# + '%' or bn.MAYTE like '%' + #TENBENHNHAN# + '%')
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="DENNGAY">
                        convert(date,A.NGAYHOADON) between convert(date, '$TUNGAY$') and convert(date, '$DENNGAY$')
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="TRANGTHAI">
                        A.TRANGTHAI = '$TRANGTHAI$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="USER_ID">
                        (A.NGUOICAPNHAT_ID = '$USER_ID$' or A.NGUOITAO_ID = '$USER_ID$')
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="REF_TABLE">
                        (VP.REF_TABLE = '$REF_TABLE$')
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="LIST_REF_TABLE">
                        (VP.REF_TABLE in ($LIST_REF_TABLE$))
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="BENHVIEN_ID">
                        A.BENHVIEN_ID = '$BENHVIEN_ID$'
                    </isNotEmpty>
                </isParameterPresent>
            </dynamic>
            order by A.NGAYHOADON
        </statement>
        <!--Revision:0,16e6724a76a6fb2c63c1eee65fae6281-->
        <statement id="DAO00024_TT_HOADON_GHINHAN_Search" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
          select A.*, B.SOHOADON AS HOADONLIENQUAN, bn.MAYTE
          , CASE ISNULL(BN.NGAYSINH,'') WHEN '' THEN CONVERT(VARCHAR(10), BN.NAMSINH)
          ELSE CONVERT(VARCHAR(10), BN.NGAYSINH, 103) END AS NAMSINH, ntba.SOBENHAN,
          bn.TENBENHNHAN, bn.DIACHITHUONGTRU as DIACHI
          , ntba.TRANGTHAI as TRANGTHAINOITRU, tn.TRANGTHAI as TRANGTHAINGOAITRU
          , dt.MADOITUONG,gt.DESCRIPTION as GIOITINH, ntba.LOAIBENHAN
          from TT_HOADON A LEFT JOIN  TT_HOADON B ON A.HOADONLIENQUAN_ID = B.HOADON_ID
          left join TT_TIEPNHAN tn on (tn.TIEPNHAN_ID = a.TIEPNHAN_ID)
          left join TM_DOITUONG DT on DT.DOITUONG_ID = tn.doituong_id
          left join TT_BENHNHAN bn on bn.BENHNHAN_ID = isnull(tn.benhnhan_id, A.BENHNHAN_ID)
          <isNotEmpty prepend="" property="PATIENTTYPE">
            <isEqual prepend="" property="PATIENTTYPE" compareValue="1">
              inner join TT_NOITRU_BENHAN ntba on ntba.BENHAN_ID = a.BENHAN_ID
            </isEqual>
          <isEqual prepend="" property="PATIENTTYPE" compareValue="0">
              left join TT_NOITRU_BENHAN ntba on ntba.BENHAN_ID = a.BENHAN_ID
            </isEqual>
          </isNotEmpty>
          <isNotPropertyAvailable prepend="" property="PATIENTTYPE">
            inner join TT_NOITRU_BENHAN ntba on ntba.BENHAN_ID = a.BENHAN_ID
          </isNotPropertyAvailable>
          left join TM_GENDER gt on gt.ID = bn.GIOITINH
          <dynamic prepend="where(">
                <isParameterPresent>
                    <isNotEmpty prepend="and" property="DATHANHTOAN">
                        A.DATHANHTOAN = '$DATHANHTOAN$'
                    </isNotEmpty>
                    <isNotEmpty prepend="or" property="HUYHOADON">
                        A.HUYHOADON = '$HUYHOADON$'
                    </isNotEmpty>
                    <isNotEmpty prepend="or" property="HOANTRA">
                        A.HOANTRA = '$HOANTRA$'
                    </isNotEmpty>
                    <isNotEmpty prepend="or" property="CHUATHANHTOAN">
                        A.DATHANHTOAN = 0
                    </isNotEmpty>
                    )
                    <isNotEmpty prepend="and" property="TIEPNHAN_ID">
                        A.TIEPNHAN_ID = '$TIEPNHAN_ID$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="TUKHOA">
                      A.SOHOADON like '%' + #TUKHOA# + '%'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="TENBENHNHAN">
                      (bn.TENBENHNHAN like '%' + #TENBENHNHAN# + '%' or bn.MAYTE like '%' + #TENBENHNHAN# + '%')
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="DENNGAY">
                        convert(date, A.THOIGIAN_GHINHANHUY) between convert(date, '$TUNGAY$') and convert(date, '$DENNGAY$')
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="TRANGTHAI">
                        A.TRANGTHAI = '$TRANGTHAI$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="USER_ID">
                        (A.NGUOICAPNHAT_ID = '$USER_ID$' or A.NGUOITAO_ID = '$USER_ID$')
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="BENHVIEN_ID">
                        A.BENHVIEN_ID = '$BENHVIEN_ID$'
                    </isNotEmpty>
                </isParameterPresent>
            </dynamic>
            and a.HOADON_ID not in
            (
            select vp.HOADON_ID
            from TT_VIENPHI vp
            where vp.REF_TABLE like '%TT_DUOC_CHUNGTU%'
            and vp.HOADON_ID is not null
            and vp.BENHVIEN_ID = '$BENHVIEN_ID$'
            )
            order by A.NGAYHOADON
        </statement>
        <!--Revision:0,ebfef12e1956e42e96764c0b3f47f2db-->
        <statement id="DAO00024_TT_HOADON_GHINHAN_DADUYET_Search" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
          select A.*, B.SOHOADON AS HOADONLIENQUAN, bn.MAYTE
          , CASE ISNULL(BN.NGAYSINH,'') WHEN '' THEN CONVERT(VARCHAR(10), BN.NAMSINH)
          ELSE CONVERT(VARCHAR(10), BN.NGAYSINH, 103) END AS NAMSINH, ntba.SOBENHAN,
          bn.TENBENHNHAN, bn.DIACHITHUONGTRU as DIACHI
          , ntba.TRANGTHAI as TRANGTHAINOITRU, tn.TRANGTHAI as TRANGTHAINGOAITRU
          , dt.MADOITUONG,gt.DESCRIPTION as GIOITINH, ntba.LOAIBENHAN
          from TT_HOADON A LEFT JOIN  TT_HOADON B ON A.HOADONLIENQUAN_ID = B.HOADON_ID
          left join TT_TIEPNHAN tn on (tn.TIEPNHAN_ID = a.TIEPNHAN_ID)
          left join TM_DOITUONG DT on DT.DOITUONG_ID = tn.doituong_id
          left join TT_BENHNHAN bn on bn.BENHNHAN_ID = isnull(tn.benhnhan_id, A.BENHNHAN_ID)
          <isNotEmpty prepend="" property="PATIENTTYPE">
            <isEqual prepend="" property="PATIENTTYPE" compareValue="1">
              inner join TT_NOITRU_BENHAN ntba on ntba.BENHAN_ID = a.BENHAN_ID
            </isEqual>
          <isEqual prepend="" property="PATIENTTYPE" compareValue="0">
              left join TT_NOITRU_BENHAN ntba on ntba.BENHAN_ID = a.BENHAN_ID
            </isEqual>
          </isNotEmpty>
          <isNotPropertyAvailable prepend="" property="PATIENTTYPE">
            inner join TT_NOITRU_BENHAN ntba on ntba.BENHAN_ID = a.BENHAN_ID
          </isNotPropertyAvailable>
          left join TM_GENDER gt on gt.ID = bn.GIOITINH
          <dynamic prepend="where(">
                <isParameterPresent>
                    <isNotEmpty prepend="and" property="DATHANHTOAN">
                        A.DATHANHTOAN = '$DATHANHTOAN$'
                    </isNotEmpty>
                    <isNotEmpty prepend="or" property="HUYHOADON">
                        A.HUYHOADON = '$HUYHOADON$'
                    </isNotEmpty>
                    <isNotEmpty prepend="or" property="HOANTRA">
                        A.HOANTRA = '$HOANTRA$'
                    </isNotEmpty>
                    <isNotEmpty prepend="or" property="CHUATHANHTOAN">
                        A.DATHANHTOAN = 0
                    </isNotEmpty>
                    )
                    <isNotEmpty prepend="and" property="TIEPNHAN_ID">
                        A.TIEPNHAN_ID = '$TIEPNHAN_ID$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="TUKHOA">
                      A.SOHOADON like '%' + #TUKHOA# + '%'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="TENBENHNHAN">
                      (bn.TENBENHNHAN like '%' + #TENBENHNHAN# + '%' or bn.MAYTE like '%' + #TENBENHNHAN# + '%')
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="DENNGAY">
                        convert(date, A.THOIGIAN_DUYET_HUY) between convert(date, '$TUNGAY$') and convert(date, '$DENNGAY$')
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="TRANGTHAI">
                        A.TRANGTHAI = '$TRANGTHAI$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="USER_ID">
                        (A.NGUOICAPNHAT_ID = '$USER_ID$' or A.NGUOITAO_ID = '$USER_ID$')
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="BENHVIEN_ID">
                        A.BENHVIEN_ID = '$BENHVIEN_ID$'
                    </isNotEmpty>
                </isParameterPresent>
            </dynamic>
            and a.HOADON_ID not in
            (
            select vp.HOADON_ID
            from TT_VIENPHI vp
            where vp.REF_TABLE like '%TT_DUOC_CHUNGTU%'
            and vp.HOADON_ID is not null
            and vp.BENHVIEN_ID = '$BENHVIEN_ID$'
            )
            order by A.NGAYHOADON
        </statement>
      <statement id="DAO00024_TT_HOADON_GHINHAN_DADUYET_CONGNO_Search" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
        select A.*, B.SOHOADON AS HOADONLIENQUAN, bn.MAYTE
        , CASE ISNULL(BN.NGAYSINH,'') WHEN '' THEN CONVERT(VARCHAR(10), BN.NAMSINH)
        ELSE CONVERT(VARCHAR(10), BN.NGAYSINH, 103) END AS NAMSINH, ntba.SOBENHAN,
        bn.TENBENHNHAN, bn.DIACHITHUONGTRU as DIACHI
        , ntba.TRANGTHAI as TRANGTHAINOITRU, tn.TRANGTHAI as TRANGTHAINGOAITRU
        , dt.MADOITUONG,gt.DESCRIPTION as GIOITINH, ntba.LOAIBENHAN
        from TT_HOADON A LEFT JOIN  TT_HOADON B ON A.HOADONLIENQUAN_ID = B.HOADON_ID
        left join TT_TIEPNHAN tn on (tn.TIEPNHAN_ID = a.TIEPNHAN_ID)
        left join TM_DOITUONG DT on DT.DOITUONG_ID = tn.doituong_id
        left join TT_BENHNHAN bn on bn.BENHNHAN_ID = isnull(tn.benhnhan_id, A.BENHNHAN_ID)
        <isNotEmpty prepend="" property="PATIENTTYPE">
          <isEqual prepend="" property="PATIENTTYPE" compareValue="1">
            inner join TT_NOITRU_BENHAN ntba on ntba.BENHAN_ID = a.BENHAN_ID
          </isEqual>
          <isEqual prepend="" property="PATIENTTYPE" compareValue="0">
            left join TT_NOITRU_BENHAN ntba on ntba.BENHAN_ID = a.BENHAN_ID
          </isEqual>
        </isNotEmpty>
        <isNotPropertyAvailable prepend="" property="PATIENTTYPE">
          inner join TT_NOITRU_BENHAN ntba on ntba.BENHAN_ID = a.BENHAN_ID
        </isNotPropertyAvailable>
        left join TM_GENDER gt on gt.ID = bn.GIOITINH
        <dynamic prepend="where(">
          <isParameterPresent>
            <isNotEmpty prepend="and" property="DATHANHTOAN">
              A.DATHANHTOAN = '$DATHANHTOAN$'
            </isNotEmpty>
            <isNotEmpty prepend="or" property="HUYHOADON">
              A.HUYHOADON = '$HUYHOADON$'
            </isNotEmpty>
            <isNotEmpty prepend="or" property="HOANTRA">
              A.HOANTRA = '$HOANTRA$'
            </isNotEmpty>
            <isNotEmpty prepend="or" property="CHUATHANHTOAN">
              A.DATHANHTOAN = 0
            </isNotEmpty>
            )
            <isNotEmpty prepend="and" property="TIEPNHAN_ID">
              A.TIEPNHAN_ID = '$TIEPNHAN_ID$'
            </isNotEmpty>
            <isNotEmpty prepend="and" property="TUKHOA">
              A.SOHOADON like '%' + #TUKHOA# + '%'
            </isNotEmpty>
            <isNotEmpty prepend="and" property="TENBENHNHAN">
              (bn.TENBENHNHAN like '%' + #TENBENHNHAN# + '%' or bn.MAYTE like '%' + #TENBENHNHAN# + '%')
            </isNotEmpty>
            <isNotEmpty prepend="and" property="DENNGAY">
              convert(date, A.THOIGIAN_DUYET_HUY) between convert(date, '$TUNGAY$') and convert(date, '$DENNGAY$')
            </isNotEmpty>
            <isNotEmpty prepend="and" property="TRANGTHAI">
              A.TRANGTHAI = '$TRANGTHAI$'
            </isNotEmpty>
            <isNotEmpty prepend="and" property="USER_ID">
              (A.NGUOICAPNHAT_ID = '$USER_ID$' or A.NGUOITAO_ID = '$USER_ID$')
            </isNotEmpty>
            <isNotEmpty prepend="and" property="BENHVIEN_ID">
              A.BENHVIEN_ID = '$BENHVIEN_ID$'
            </isNotEmpty>
          </isParameterPresent>
        </dynamic>
        and a.HOADON_ID not in
        (
        select vp.HOADON_ID from TT_VIENPHI vp where vp.REF_TABLE like '%TT_DUOC_CHUNGTU%' and vp.HOADON_ID is not null and vp.BENHVIEN_ID = '$BENHVIEN_ID$'
        )
        and a.HOADON_ID not in
        (
        select HOADONLIENQUAN_ID from TT_HOADON where BENHVIEN_ID = '$BENHVIEN_ID$' and   HOADONLIENQUAN_ID is not null
        )
        order by A.NGAYHOADON
      </statement>
        <!--Revision:0,ef04a6ddbbf21f3cf04f38d6d048dd73-->
        <statement id="DAO00024_TT_HOADON_GetList" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
            select *
            from TT_HOADON
            <dynamic prepend="where">
                <isParameterPresent>
                    <isNotEmpty prepend="and" property="HOADON_ID">
                        TT_HOADON.HOADON_ID = '$HOADON_ID$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="SOHOADON">
                        TT_HOADON.SOHOADON = '$SOHOADON$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="LOAIHOADON">
                        TT_HOADON.LOAIHOADON = '$LOAIHOADON$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="TIEPNHAN_ID">
                        TT_HOADON.TIEPNHAN_ID = '$TIEPNHAN_ID$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="BENHNHAN_ID">
                        TT_HOADON.BENHNHAN_ID = '$BENHNHAN_ID$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="DOITUONG_ID">
                        TT_HOADON.DOITUONG_ID = '$DOITUONG_ID$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="BENHAN_NGOAITRU_ID">
                        TT_HOADON.BENHAN_NGOAITRU_ID = '$BENHAN_NGOAITRU_ID$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="NGAYPHATSINH">
                        TT_HOADON.NGAYPHATSINH = '$NGAYPHATSINH$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="NGAYHOADON">
                        TT_HOADON.NGAYHOADON = '$NGAYHOADON$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="NOIPHATSINH_ID">
                        TT_HOADON.NOIPHATSINH_ID = '$NOIPHATSINH_ID$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="NGUOILAP_ID">
                        TT_HOADON.NGUOILAP_ID = '$NGUOILAP_ID$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="NOITHUTIEN_ID">
                        TT_HOADON.NOITHUTIEN_ID = '$NOITHUTIEN_ID$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="NGUOITHUTIEN_ID">
                        TT_HOADON.NGUOITHUTIEN_ID = '$NGUOITHUTIEN_ID$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="NOITRA_ID">
                        TT_HOADON.NOITRA_ID = '$NOITRA_ID$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="NGUOITRA_ID">
                        TT_HOADON.NGUOITRA_ID = '$NGUOITRA_ID$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="NGAYTRA">
                        TT_HOADON.NGAYTRA = '$NGAYTRA$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="GIATRIHOADON">
                        TT_HOADON.GIATRIHOADON = '$GIATRIHOADON$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="GIATRITHUCTHU">
                        TT_HOADON.GIATRITHUCTHU = '$GIATRITHUCTHU$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="TIENTE_ID">
                        TT_HOADON.TIENTE_ID = '$TIENTE_ID$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="TYGIA">
                        TT_HOADON.TYGIA = '$TYGIA$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="GIATRIVND">
                        TT_HOADON.GIATRIVND = '$GIATRIVND$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="DANGKYHOADON_ID">
                        TT_HOADON.DANGKYHOADON_ID = '$DANGKYHOADON_ID$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="SOSERIEVAT">
                        TT_HOADON.SOSERIEVAT = '$SOSERIEVAT$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="SOHOADONVAT">
                        TT_HOADON.SOHOADONVAT = '$SOHOADONVAT$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="GIATRIVAT">
                        TT_HOADON.GIATRIVAT = '$GIATRIVAT$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="NGOAIGIO">
                        TT_HOADON.NGOAIGIO = '$NGOAIGIO$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="THUHD_BL">
                        TT_HOADON.THUHD_BL = '$THUHD_BL$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="GHICHU">
                        TT_HOADON.GHICHU = '$GHICHU$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="TRANGTHAI">
                        TT_HOADON.TRANGTHAI = '$TRANGTHAI$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="DATHANHTOAN">
                        TT_HOADON.DATHANHTOAN = '$DATHANHTOAN$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="HUYHOADON">
                        TT_HOADON.HUYHOADON = '$HUYHOADON$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="LYDOHUY_ID">
                        TT_HOADON.LYDOHUY_ID = '$LYDOHUY_ID$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="HOANTRA">
                        TT_HOADON.HOANTRA = '$HOANTRA$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="IDCHUYEN">
                        TT_HOADON.IDCHUYEN = '$IDCHUYEN$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="IDCHUYENHUY">
                        TT_HOADON.IDCHUYENHUY = '$IDCHUYENHUY$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="IDCHUYENHOAN">
                        TT_HOADON.IDCHUYENHOAN = '$IDCHUYENHOAN$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="HOADONLIENQUAN_ID">
                        TT_HOADON.HOADONLIENQUAN_ID = '$HOADONLIENQUAN_ID$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="TRANSFER_VIENPHI_ID">
                        TT_HOADON.TRANSFER_VIENPHI_ID = '$TRANSFER_VIENPHI_ID$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="NGAYKHOAGOI">
                        TT_HOADON.NGAYKHOAGOI = '$NGAYKHOAGOI$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="NHOMTHANHTOAN_ID">
                        TT_HOADON.NHOMTHANHTOAN_ID = '$NHOMTHANHTOAN_ID$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="HOADONDOIUNG">
                        TT_HOADON.HOADONDOIUNG = '$HOADONDOIUNG$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="CHUYENCHUNGTUID">
                        TT_HOADON.CHUYENCHUNGTUID = '$CHUYENCHUNGTUID$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="CHUYENCHUNGTUHOANID">
                        TT_HOADON.CHUYENCHUNGTUHOANID = '$CHUYENCHUNGTUHOANID$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="CHUYENCHUNGTUHUYID">
                        TT_HOADON.CHUYENCHUNGTUHUYID = '$CHUYENCHUNGTUHUYID$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="CHUYENDOANHTHUID">
                        TT_HOADON.CHUYENDOANHTHUID = '$CHUYENDOANHTHUID$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="CHUYENDOANHTHUHOANID">
                        TT_HOADON.CHUYENDOANHTHUHOANID = '$CHUYENDOANHTHUHOANID$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="CHUYENDOANHTHUHUYID">
                        TT_HOADON.CHUYENDOANHTHUHUYID = '$CHUYENDOANHTHUHUYID$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="KH_TENCONGTY">
                        TT_HOADON.KH_TENCONGTY = '$KH_TENCONGTY$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="KH_MASOTHUE">
                        TT_HOADON.KH_MASOTHUE = '$KH_MASOTHUE$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="KH_DIACHI">
                        TT_HOADON.KH_DIACHI = '$KH_DIACHI$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="KH_NGUOIDAIDIEN">
                        TT_HOADON.KH_NGUOIDAIDIEN = '$KH_NGUOIDAIDIEN$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="INLAI">
                        TT_HOADON.INLAI = '$INLAI$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="INLAI_USER_ID">
                        TT_HOADON.INLAI_USER_ID = '$INLAI_USER_ID$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="BENHVIEN_ID">
                        TT_HOADON.BENHVIEN_ID = '$BENHVIEN_ID$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="NGAYTAO">
                        TT_HOADON.NGAYTAO = '$NGAYTAO$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="NGUOITAO_ID">
                        TT_HOADON.NGUOITAO_ID = '$NGUOITAO_ID$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="NGAYCAPNHAT">
                        TT_HOADON.NGAYCAPNHAT = '$NGAYCAPNHAT$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="NGUOICAPNHAT_ID">
                        TT_HOADON.NGUOICAPNHAT_ID = '$NGUOICAPNHAT_ID$'
                    </isNotEmpty>
                </isParameterPresent>
            </dynamic>
            order by HOADON_ID
        </statement>
        <!--Revision:0,2b7fbc4a84ec0c5e9c02b3fb173a9513-->
        <statement id="DAO00024_TT_HOADON_GetDetail" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
            select bn.MAYTE,hd.*
            from TT_HOADON hd
            left join TT_BENHNHAN bn on bn.BENHNHAN_ID = hd.BENHNHAN_ID
            <dynamic prepend="where">
                <isParameterPresent>
                    <isNotEmpty prepend="and" property="HOADON_ID">
                        hd.HOADON_ID = '$HOADON_ID$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="LIST_BIENLAI">
                        hd.HOADON_ID in ($LIST_BIENLAI$)
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="BENHVIEN_ID">
                        hd.BENHVIEN_ID ='$BENHVIEN_ID$'
                    </isNotEmpty>
                </isParameterPresent>
            </dynamic>
            <!--where hd.HOADON_ID  = '$HOADON_ID$'
      and HOADON_ID in ($LIST_BIENLAI$)
      and hd.BENHVIEN_ID ='$BENHVIEN_ID$'-->
            <!--<isNotEmpty prepend="and" property="TRANGTHAI">
              hd.TRANGTHAI = '$TRANGTHAI$'
            </isNotEmpty>-->
            order by hd.HOADON_ID
        </statement>
        <!--Revision:0,ea11952f713ce1af87aa04437329dcd1-->
        <statement id="DAO00024_GetBienLaiDuyet" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
            select bn.MAYTE,hd.*
            from TT_HOADON hd
            left join TT_BENHNHAN bn on bn.BENHNHAN_ID = hd.BENHNHAN_ID
            where hd.HOADON_ID in ($LIST_BIENLAI$)
            and hd.BENHVIEN_ID ='$BENHVIEN_ID$'
            <!--<isNotEmpty prepend="and" property="TRANGTHAI">
              hd.TRANGTHAI = '$TRANGTHAI$'
            </isNotEmpty>-->
            order by hd.HOADON_ID
        </statement>
        <!--Revision:0,0d53d3c4add2f1957e46190f9a4bc689-->
        <statement id="DAO00024_TT_HOADON_MUATHUOCNGOAI_GetDetail" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
            select distinct bn.MAYTE,ct.NGOAITRU_TOATHUOC_NGUOIMUA_ID, ct.SOCHUNGTU, ct.CHUNGTU_ID,hd.*
            from TT_HOADON hd
            left join TT_HOADON_CHITIET_NGOAITRU hdct on hdct.HOADON_ID = hd.HOADON_ID and ref_table = 'TT_DUOC_CHUNGTU_CHITIET'
            left join TT_DUOC_CHUNGTU_CHITIET ctct on ctct.CHUNGTUCHITIET_ID = hdct.REF_ID
            left join TT_DUOC_CHUNGTU ct on ct.CHUNGTU_ID = ctct.chungtu_id
            left join TT_BENHNHAN bn on bn.BENHNHAN_ID = hd.BENHNHAN_ID
            where hd.HOADON_ID  = '$HOADON_ID$'
            and hd.BENHVIEN_ID ='$BENHVIEN_ID$'
            order by hd.HOADON_ID
        </statement>
        <!--Revision:0,b515fd52e8d212e740189e825d4472fa-->
        <statement id="DAO00024_TT_HOADON_GetDetailP" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
            select *
            from TT_HOADON
            <dynamic prepend="where">
                <isParameterPresent>
                    <isNotEmpty prepend="and" property="HOADON_ID">
                        TT_HOADON.HOADON_ID = '$HOADON_ID$'
                    </isNotEmpty>
                    <!--<isNotEmpty prepend="and" property="OLD_HOADON_ID">
          TT_HOADON.HOADON_ID = '$OLD_HOADON_ID$'
        </isNotEmpty>-->
                </isParameterPresent>
            </dynamic>
            order by HOADON_ID
        </statement>
        <!--Revision:0,fe5195e6160927c610a53fa0b563605e-->
        <statement id="DAO00024_TT_HOADON_Add" parameterClass="System.Collections.IDictionary" resultClass="System.Int64">
            insert into TT_HOADON (
            SOHOADON
            , LOAIHOADON
            , TIEPNHAN_ID
            , BENHNHAN_ID
            , BENHAN_ID
            , DOITUONG_ID
            , BENHAN_NGOAITRU_ID
            , NGAYPHATSINH
            , NGAYHOADON
            , NOIPHATSINH_ID
            , NGUOILAP_ID
            , NOITHUTIEN_ID
            , NGUOITHUTIEN_ID
            , NOITRA_ID
            , NGUOITRA_ID
            , NGAYTRA
            , GIATRIHOADON
            , GIATRITHUCTHU
            , TIENTE_ID
            , TYGIA
            , GIATRIVND
            , DANGKYHOADON_ID
            , SOSERIEVAT
            , SOHOADONVAT
            , GIATRIVAT
            , NGOAIGIO
            , THUHD_BL
            , GHICHU
            , TRANGTHAI
            , DATHANHTOAN
            , HUYHOADON
            , LYDOHUY_ID
            , HOANTRA
            , IDCHUYEN
            , IDCHUYENHUY
            , IDCHUYENHOAN
            , HOADONLIENQUAN_ID
            , TRANSFER_VIENPHI_ID
            , NGAYKHOAGOI
            , NHOMTHANHTOAN_ID
            , HOADONDOIUNG
            , CHUYENCHUNGTUID
            , CHUYENCHUNGTUHOANID
            , CHUYENCHUNGTUHUYID
            , CHUYENDOANHTHUID
            , CHUYENDOANHTHUHOANID
            , CHUYENDOANHTHUHUYID
            , KH_TENCONGTY
            , KH_MASOTHUE
            , KH_DIACHI
            , KH_NGUOIDAIDIEN
            , INLAI
            , INLAI_USER_ID
            <isNotEmpty prepend="" property="NGUOI_GHINHANHUY_ID">
                , NGUOI_GHINHANHUY_ID
                , THOIGIAN_GHINHANHUY
            </isNotEmpty>
          <isNotEmpty prepend="" property="NGUOITHANHTOAN_ID">
            , NGUOITHANHTOAN_ID
            , THOIGIANTHANHTOAN
          </isNotEmpty>
          , BENHVIEN_ID
          , NGAYTAO
          , NGUOITAO_ID
          , NGAYCAPNHAT
          , NGUOICAPNHAT_ID
          <isNotEmpty prepend="" property="YEUCAUVP">
            , YEUCAUVP
          </isNotEmpty>
            ) values (
            #SOHOADON#
            , #LOAIHOADON#
            , #TIEPNHAN_ID#
            , #BENHNHAN_ID#
            , #BENHAN_ID#
            , #DOITUONG_ID#
            , #BENHAN_NGOAITRU_ID#
            , #NGAYPHATSINH#
            , #NGAYHOADON#
            , #NOIPHATSINH_ID#
            , #NGUOILAP_ID#
            , #NOITHUTIEN_ID#
            , #NGUOITHUTIEN_ID#
            , #NOITRA_ID#
            , #NGUOITRA_ID#
            , #NGAYTRA#
            , #GIATRIHOADON#
            , #GIATRITHUCTHU#
            , #TIENTE_ID#
            , #TYGIA#
            , #GIATRIVND#
            , #DANGKYHOADON_ID#
            , #SOSERIEVAT#
            , #SOHOADONVAT#
            , #GIATRIVAT#
            , #NGOAIGIO#
            , #THUHD_BL#
            , #GHICHU#
            , #TRANGTHAI#
            , #DATHANHTOAN#
            , #HUYHOADON#
            , #LYDOHUY_ID#
            , #HOANTRA#
            , #IDCHUYEN#
            , #IDCHUYENHUY#
            , #IDCHUYENHOAN#
            , #HOADONLIENQUAN_ID#
            , #TRANSFER_VIENPHI_ID#
            , #NGAYKHOAGOI#
            , #NHOMTHANHTOAN_ID#
            , #HOADONDOIUNG#
            , #CHUYENCHUNGTUID#
            , #CHUYENCHUNGTUHOANID#
            , #CHUYENCHUNGTUHUYID#
            , #CHUYENDOANHTHUID#
            , #CHUYENDOANHTHUHOANID#
            , #CHUYENDOANHTHUHUYID#
            , #KH_TENCONGTY#
            , #KH_MASOTHUE#
            , #KH_DIACHI#
            , #KH_NGUOIDAIDIEN#
            , #INLAI#
            , #INLAI_USER_ID#
            <isNotEmpty prepend="" property="NGUOI_GHINHANHUY_ID">
                , #NGUOI_GHINHANHUY_ID#
                , #THOIGIAN_GHINHANHUY#
            </isNotEmpty>
          <isNotEmpty prepend="" property="NGUOITHANHTOAN_ID">
            , #NGUOITHANHTOAN_ID#
            , #THOIGIANTHANHTOAN#
          </isNotEmpty>
          , #BENHVIEN_ID#
          , #NGAYTAO#
          , #NGUOITAO_ID#
          , #NGAYCAPNHAT#
          , #NGUOICAPNHAT_ID#
          <isNotEmpty prepend="" property="YEUCAUVP">
            ,#YEUCAUVP#
          </isNotEmpty>
            )
            SELECT SCOPE_IDENTITY()
            <!--<selectKey resultClass="System.Int64" type="post" >
        SELECT @@IDENTITY as value
      </selectKey>-->
        </statement>
        <!--Revision:0,96859a1221386caefba1d4f17ede2c09-->
        <update id="DAO00024_TT_HOADON_Update" parameterClass="System.Collections.IDictionary">
            update TT_HOADON set
            SOHOADON = #SOHOADON#
            , LOAIHOADON = #LOAIHOADON#
            , TIEPNHAN_ID = #TIEPNHAN_ID#
            , BENHNHAN_ID = #BENHNHAN_ID#
            , DOITUONG_ID = #DOITUONG_ID#
            , BENHAN_NGOAITRU_ID = #BENHAN_NGOAITRU_ID#
            , NGAYPHATSINH = #NGAYPHATSINH#
            , NGAYHOADON = #NGAYHOADON#
            , NOIPHATSINH_ID = #NOIPHATSINH_ID#
            , NGUOILAP_ID = #NGUOILAP_ID#
            , NOITHUTIEN_ID = #NOITHUTIEN_ID#
            , NGUOITHUTIEN_ID = #NGUOITHUTIEN_ID#
            , NOITRA_ID = #NOITRA_ID#
            , NGUOITRA_ID = #NGUOITRA_ID#
            , NGAYTRA = #NGAYTRA#
            , GIATRIHOADON = #GIATRIHOADON#
            , GIATRITHUCTHU = #GIATRITHUCTHU#
            , TIENTE_ID = #TIENTE_ID#
            , TYGIA = #TYGIA#
            , GIATRIVND = #GIATRIVND#
            , DANGKYHOADON_ID = #DANGKYHOADON_ID#
            , SOSERIEVAT = #SOSERIEVAT#
            , SOHOADONVAT = #SOHOADONVAT#
            , GIATRIVAT = #GIATRIVAT#
            , NGOAIGIO = #NGOAIGIO#
            , THUHD_BL = #THUHD_BL#
            , GHICHU = #GHICHU#
            , TRANGTHAI = #TRANGTHAI#
            , DATHANHTOAN = #DATHANHTOAN#
            , HUYHOADON = #HUYHOADON#
            , LYDOHUY_ID = #LYDOHUY_ID#
            , HOANTRA = #HOANTRA#
            , IDCHUYEN = #IDCHUYEN#
            , IDCHUYENHUY = #IDCHUYENHUY#
            , IDCHUYENHOAN = #IDCHUYENHOAN#
            , HOADONLIENQUAN_ID = #HOADONLIENQUAN_ID#
            , TRANSFER_VIENPHI_ID = #TRANSFER_VIENPHI_ID#
            , NGAYKHOAGOI = #NGAYKHOAGOI#
            , NHOMTHANHTOAN_ID = #NHOMTHANHTOAN_ID#
            , HOADONDOIUNG = #HOADONDOIUNG#
            , CHUYENCHUNGTUID = #CHUYENCHUNGTUID#
            , CHUYENCHUNGTUHOANID = #CHUYENCHUNGTUHOANID#
            , CHUYENCHUNGTUHUYID = #CHUYENCHUNGTUHUYID#
            , CHUYENDOANHTHUID = #CHUYENDOANHTHUID#
            , CHUYENDOANHTHUHOANID = #CHUYENDOANHTHUHOANID#
            , CHUYENDOANHTHUHUYID = #CHUYENDOANHTHUHUYID#
            , KH_TENCONGTY = #KH_TENCONGTY#
            , KH_MASOTHUE = #KH_MASOTHUE#
            , KH_DIACHI = #KH_DIACHI#
            , KH_NGUOIDAIDIEN = #KH_NGUOIDAIDIEN#
            , INLAI = #INLAI#
            , INLAI_USER_ID = #INLAI_USER_ID#
            <!--, BENHVIEN_ID = #BENHVIEN_ID#
      , NGAYTAO = #NGAYTAO#
      , NGUOITAO_ID = #NGUOITAO_ID#-->
            , NGAYCAPNHAT = #NGAYCAPNHAT#
            , NGUOICAPNHAT_ID = #NGUOICAPNHAT_ID#
            where
            HOADON_ID = '$HOADON_ID$'
        </update>
        <!--Revision:0,72314ef102fa4e1be678fc13d2dbe6e4-->
        <update id="DAO00024_TT_HOADON_UpdateHoaDonLienQuan" parameterClass="System.Collections.IDictionary">
            update TT_HOADON
            set
            HOADONLIENQUAN_ID = #HOADON_ID#
            , NGAYCAPNHAT = #NGAYCAPNHAT#
            , NGUOICAPNHAT_ID = #NGUOICAPNHAT_ID#
            where
            HOADON_ID IN ($LIST_HOADON_ID$)
        </update>
        <!--Revision:0,06374466a48dd5beb93ab23cac02b26b-->
        <update id="DAO00024_TT_HOADON_UpdateThuThay" parameterClass="System.Collections.IDictionary">
            update TT_HOADON
            set
            HOADONLIENQUAN_ID = #HOADON_ID#
            , NGAYCAPNHAT = #NGAYCAPNHAT#
            , NGUOICAPNHAT_ID = #NGUOICAPNHAT_ID#
            , HOANTRA = #HOANTRA#
            , HUYHOADON = #HUYHOADON#
            where
            SOHOADON = '$SOHOADON_THUTHAY$'
        </update>
        <!--Revision:0,7bda53f8b14472b0e85dbc17a1c3ef39-->
        <update id="DAO00024_TT_HOADON_Huy" parameterClass="System.Collections.IDictionary">
            update TT_VIENPHI
            set
            HUY = '1',
            DATHANHTOAN = '0',
            DUOCPHEPTHUCHIEN = '0',
            GIATRI_BENHNHAN_DATHANHTOAN = 0,
            NGUOICAPNHAT_ID = #NGUOICAPNHAT_ID#,
            NGAYCAPNHAT = #NGAYCAPNHAT#
            where
            HOADON_ID in ($LIST_BIENLAI$)
            update TT_HOADON
            set
            HUYHOADON = '1',
            NGUOICAPNHAT_ID = #NGUOICAPNHAT_ID#,
            NGAYCAPNHAT = #NGAYCAPNHAT#
            where
            HOADON_ID in ($LIST_BIENLAI$)
            <!--Update các biên lai tạm ứng-->
            update TT_HOADON
            set
            TRANGTHAI = 'DATHUTIEN',
            NGUOICAPNHAT_ID = #NGUOICAPNHAT_ID#,
            NGAYCAPNHAT = #NGAYCAPNHAT#
            where
            HOADONLIENQUAN_ID = #HOADON_ID#
        </update>
        <!--Revision:0,81b2f64bd020ead9e0c96d02933f3256-->
        <update id="DAO00024_TT_HOADON_Huy_CSKH" parameterClass="System.Collections.IDictionary">
            <!--Update các biên lai tạm ứng-->
            update TT_CSKH_GOI_DANGKY
            set
            TRANGTHAI = 'CHUATHUTIEN',
            <!--DATHANHTOAN = '0',-->
            NGUOICAPNHAT_ID = #NGUOICAPNHAT_ID#,
            NGAYCAPNHAT = #NGAYCAPNHAT#
            where
            DANGKY_ID = #DANGKY_ID#
        </update>
        <!--Revision:0,30cb1e6e0545898799dd3b90c6e59cb2-->
        <update id="DAO00024_TT_HOADON_Huy_CSKH_The" parameterClass="System.Collections.IDictionary">
            <!--Update các biên lai tạm ứng-->
            update TT_CSKH_THANHVIEN_CAPTHE
            set
            DATHUTIEN = '0',
            NGUOICAPNHAT_ID = #NGUOICAPNHAT_ID#,
            NGAYCAPNHAT = #NGAYCAPNHAT#
            where
            THE_ID = #THE_ID#
        </update>
        <!--Revision:0,c173c44fcf8b21e6245077ca3f1d9a16-->
        <update id="DAO00024_TT_GHINHAN_DUYETHOADON" parameterClass="System.Collections.IDictionary">
            update TT_HOADON
            set
            TRANGTHAI = #TRANGTHAI#,
            <!--DATHANHTOAN = '0',-->
            NGUOICAPNHAT_ID = #NGUOICAPNHAT_ID#,
            NGAYCAPNHAT = #NGAYCAPNHAT#,
            <!--NGUOI_GHINHANHUY_ID = #NGUOI_GHINHANHUY_ID#,
      THOIGIAN_GHINHANHUY = #THOIGIAN_GHINHANHUY#,-->
            NGUOI_DUYET_HUY_ID = #NGUOI_DUYET_HUY_ID#,
            THOIGIAN_DUYET_HUY = #THOIGIAN_DUYET_HUY#,
            LYDOHUY_ID = #LYDOHUY_ID#
            where
            hoadon_id in ($LIST_BIENLAI$)
            <!--HOADON_ID = #HOADON_ID#-->
        </update>
        <!--Revision:0,bafa0c061f2e9e843eaa696970d9a896-->
        <update id="DAO00024_TT_HOADON_HoanTra" parameterClass="System.Collections.IDictionary">
            update TT_VIENPHI
            set
            HUY = '1',
            DATHANHTOAN = '0',
            DUOCPHEPTHUCHIEN = '0',
            GIATRI_BENHNHAN_DATHANHTOAN = 0,
            NGUOICAPNHAT_ID = #NGUOICAPNHAT_ID#,
            NGAYCAPNHAT = #NGAYCAPNHAT#
            where
            HOADON_ID = #HOADON_ID#
            update TT_HOADON
            set
            HOANTRA = '1',
            <!--DATHANHTOAN = '0',-->
            NGUOICAPNHAT_ID = #NGUOICAPNHAT_ID#,
            NGAYCAPNHAT = #NGAYCAPNHAT#
            where
            HOADON_ID = #HOADON_ID#
        </update>
        <!--Revision:0,de6610fa8fac32e8f400e49279b32509-->
        <statement id="DAO00024_TT_HOADON_Delete" parameterClass="System.Collections.IDictionary" resultClass="System.Int32">
            delete from TT_HOADON
            where
            HOADON_ID = '$HOADON_ID$'
        </statement>
        <!--Revision:0,5b6e059341a552b32de4e5bae0e0a779-->
        <statement id="DAO00024_TT_HOADON_DeleteP" parameterClass="System.Collections.IDictionary" resultClass="System.Int32">
            delete from TT_HOADON
            <dynamic prepend="where">
                <isParameterPresent>
                    <isNotEmpty prepend="and" property="HOADON_ID">
                        TT_HOADON.HOADON_ID = '$HOADON_ID$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="SOHOADON">
                        TT_HOADON.SOHOADON = '$SOHOADON$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="LOAIHOADON">
                        TT_HOADON.LOAIHOADON = '$LOAIHOADON$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="TIEPNHAN_ID">
                        TT_HOADON.TIEPNHAN_ID = '$TIEPNHAN_ID$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="BENHNHAN_ID">
                        TT_HOADON.BENHNHAN_ID = '$BENHNHAN_ID$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="DOITUONG_ID">
                        TT_HOADON.DOITUONG_ID = '$DOITUONG_ID$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="BENHAN_NGOAITRU_ID">
                        TT_HOADON.BENHAN_NGOAITRU_ID = '$BENHAN_NGOAITRU_ID$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="NGAYPHATSINH">
                        TT_HOADON.NGAYPHATSINH = '$NGAYPHATSINH$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="NGAYHOADON">
                        TT_HOADON.NGAYHOADON = '$NGAYHOADON$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="NOIPHATSINH_ID">
                        TT_HOADON.NOIPHATSINH_ID = '$NOIPHATSINH_ID$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="NGUOILAP_ID">
                        TT_HOADON.NGUOILAP_ID = '$NGUOILAP_ID$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="NOITHUTIEN_ID">
                        TT_HOADON.NOITHUTIEN_ID = '$NOITHUTIEN_ID$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="NGUOITHUTIEN_ID">
                        TT_HOADON.NGUOITHUTIEN_ID = '$NGUOITHUTIEN_ID$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="NOITRA_ID">
                        TT_HOADON.NOITRA_ID = '$NOITRA_ID$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="NGUOITRA_ID">
                        TT_HOADON.NGUOITRA_ID = '$NGUOITRA_ID$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="NGAYTRA">
                        TT_HOADON.NGAYTRA = '$NGAYTRA$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="GIATRIHOADON">
                        TT_HOADON.GIATRIHOADON = '$GIATRIHOADON$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="GIATRITHUCTHU">
                        TT_HOADON.GIATRITHUCTHU = '$GIATRITHUCTHU$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="TIENTE_ID">
                        TT_HOADON.TIENTE_ID = '$TIENTE_ID$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="TYGIA">
                        TT_HOADON.TYGIA = '$TYGIA$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="GIATRIVND">
                        TT_HOADON.GIATRIVND = '$GIATRIVND$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="DANGKYHOADON_ID">
                        TT_HOADON.DANGKYHOADON_ID = '$DANGKYHOADON_ID$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="SOSERIEVAT">
                        TT_HOADON.SOSERIEVAT = '$SOSERIEVAT$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="SOHOADONVAT">
                        TT_HOADON.SOHOADONVAT = '$SOHOADONVAT$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="GIATRIVAT">
                        TT_HOADON.GIATRIVAT = '$GIATRIVAT$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="NGOAIGIO">
                        TT_HOADON.NGOAIGIO = '$NGOAIGIO$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="THUHD_BL">
                        TT_HOADON.THUHD_BL = '$THUHD_BL$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="GHICHU">
                        TT_HOADON.GHICHU = '$GHICHU$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="TRANGTHAI">
                        TT_HOADON.TRANGTHAI = '$TRANGTHAI$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="DATHANHTOAN">
                        TT_HOADON.DATHANHTOAN = '$DATHANHTOAN$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="HUYHOADON">
                        TT_HOADON.HUYHOADON = '$HUYHOADON$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="LYDOHUY_ID">
                        TT_HOADON.LYDOHUY_ID = '$LYDOHUY_ID$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="HOANTRA">
                        TT_HOADON.HOANTRA = '$HOANTRA$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="IDCHUYEN">
                        TT_HOADON.IDCHUYEN = '$IDCHUYEN$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="IDCHUYENHUY">
                        TT_HOADON.IDCHUYENHUY = '$IDCHUYENHUY$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="IDCHUYENHOAN">
                        TT_HOADON.IDCHUYENHOAN = '$IDCHUYENHOAN$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="HOADONLIENQUAN_ID">
                        TT_HOADON.HOADONLIENQUAN_ID = '$HOADONLIENQUAN_ID$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="TRANSFER_VIENPHI_ID">
                        TT_HOADON.TRANSFER_VIENPHI_ID = '$TRANSFER_VIENPHI_ID$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="NGAYKHOAGOI">
                        TT_HOADON.NGAYKHOAGOI = '$NGAYKHOAGOI$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="NHOMTHANHTOAN_ID">
                        TT_HOADON.NHOMTHANHTOAN_ID = '$NHOMTHANHTOAN_ID$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="HOADONDOIUNG">
                        TT_HOADON.HOADONDOIUNG = '$HOADONDOIUNG$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="CHUYENCHUNGTUID">
                        TT_HOADON.CHUYENCHUNGTUID = '$CHUYENCHUNGTUID$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="CHUYENCHUNGTUHOANID">
                        TT_HOADON.CHUYENCHUNGTUHOANID = '$CHUYENCHUNGTUHOANID$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="CHUYENCHUNGTUHUYID">
                        TT_HOADON.CHUYENCHUNGTUHUYID = '$CHUYENCHUNGTUHUYID$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="CHUYENDOANHTHUID">
                        TT_HOADON.CHUYENDOANHTHUID = '$CHUYENDOANHTHUID$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="CHUYENDOANHTHUHOANID">
                        TT_HOADON.CHUYENDOANHTHUHOANID = '$CHUYENDOANHTHUHOANID$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="CHUYENDOANHTHUHUYID">
                        TT_HOADON.CHUYENDOANHTHUHUYID = '$CHUYENDOANHTHUHUYID$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="KH_TENCONGTY">
                        TT_HOADON.KH_TENCONGTY = '$KH_TENCONGTY$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="KH_MASOTHUE">
                        TT_HOADON.KH_MASOTHUE = '$KH_MASOTHUE$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="KH_DIACHI">
                        TT_HOADON.KH_DIACHI = '$KH_DIACHI$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="KH_NGUOIDAIDIEN">
                        TT_HOADON.KH_NGUOIDAIDIEN = '$KH_NGUOIDAIDIEN$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="INLAI">
                        TT_HOADON.INLAI = '$INLAI$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="INLAI_USER_ID">
                        TT_HOADON.INLAI_USER_ID = '$INLAI_USER_ID$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="BENHVIEN_ID">
                        TT_HOADON.BENHVIEN_ID = '$BENHVIEN_ID$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="NGAYTAO">
                        TT_HOADON.NGAYTAO = '$NGAYTAO$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="NGUOITAO_ID">
                        TT_HOADON.NGUOITAO_ID = '$NGUOITAO_ID$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="NGAYCAPNHAT">
                        TT_HOADON.NGAYCAPNHAT = '$NGAYCAPNHAT$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="NGUOICAPNHAT_ID">
                        TT_HOADON.NGUOICAPNHAT_ID = '$NGUOICAPNHAT_ID$'
                    </isNotEmpty>
                </isParameterPresent>
            </dynamic>
        </statement>
        <!--Revision:0,1c25fc1143d18c8301492fa80bedaa86-->
        <statement id="DAO00024_TT_HOADON_CHITIET_NGOAITRU_GetAll" resultClass="DataObject">
            select *
            from TT_HOADON_CHITIET_NGOAITRU
            order by HOADONCHITIET_ID
        </statement>
        <!--Revision:0,922fe56d36f486251de58df86ad8f4b6-->
        <statement id="DAO00024_TT_HOADON_CHITIET_NGOAITRU_GetList" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
            select a.*, b.GIATRIMIENGIAM_BH, c.GIATRIMIENGIAM_BHTN, f.GIATRIMIENGIAM_THANHVIEN
            from
            (
            select
            TT_HOADON_CHITIET_NGOAITRU.*, 'DVKhongTruyThu' as TRUYTHU
            , c.TRANGTHAI as TRANGTHAI_DVYC
            <!--, gdk.GOI_ID-->
            from TT_HOADON_CHITIET_NGOAITRU
            left join TT_DVYEUCAU c on c.DVYEUCAU_ID = TT_HOADON_CHITIET_NGOAITRU.REF_ID
            and TT_HOADON_CHITIET_NGOAITRU.DICHVU_ID is not null
            <!--left join TT_CSKH_GOI_DANGKY gdk on gdk.DANGKY_ID = TT_HOADON_CHITIET_NGOAITRU.REF_ID
      and TT_HOADON_CHITIET_NGOAITRU.REF_TABLE = 'TT_CSKH_GOI_DANGKY'-->
            <dynamic prepend="where">
                <isParameterPresent>
                    <isNotEmpty prepend="and" property="HOADONCHITIET_ID">
                        TT_HOADON_CHITIET_NGOAITRU.HOADONCHITIET_ID = '$HOADONCHITIET_ID$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="HOADON_ID">
                        TT_HOADON_CHITIET_NGOAITRU.HOADON_ID = '$HOADON_ID$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="VIENPHI_ID">
                        TT_HOADON_CHITIET_NGOAITRU.VIENPHI_ID = '$VIENPHI_ID$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="REF_ID">
                        TT_HOADON_CHITIET_NGOAITRU.REF_ID = '$REF_ID$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="REF_TABLE">
                        TT_HOADON_CHITIET_NGOAITRU.REF_TABLE = '$REF_TABLE$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="DICHVU_ID">
                        TT_HOADON_CHITIET_NGOAITRU.DICHVU_ID = '$DICHVU_ID$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="DUOC_ID">
                        TT_HOADON_CHITIET_NGOAITRU.DUOC_ID = '$DUOC_ID$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="LOAI_CHIPHI">
                        TT_HOADON_CHITIET_NGOAITRU.LOAI_CHIPHI = '$LOAI_CHIPHI$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="LOAIGIA_ID">
                        TT_HOADON_CHITIET_NGOAITRU.LOAIGIA_ID = '$LOAIGIA_ID$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="SOLUONG">
                        TT_HOADON_CHITIET_NGOAITRU.SOLUONG = '$SOLUONG$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="DONGIA_DOANHTHU">
                        TT_HOADON_CHITIET_NGOAITRU.DONGIA_DOANHTHU = '$DONGIA_DOANHTHU$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="THANHTIEN_DOANHTHU">
                        TT_HOADON_CHITIET_NGOAITRU.THANHTIEN_DOANHTHU = '$THANHTIEN_DOANHTHU$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="BHYT_TL">
                        TT_HOADON_CHITIET_NGOAITRU.BHYT_TL = '$BHYT_TL$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="BHYT_DONGIA">
                        TT_HOADON_CHITIET_NGOAITRU.BHYT_DONGIA = '$BHYT_DONGIA$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="BHYT_THANHTIEN">
                        TT_HOADON_CHITIET_NGOAITRU.BHYT_THANHTIEN = '$BHYT_THANHTIEN$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="BHYT_DONGIA_CHITRA">
                        TT_HOADON_CHITIET_NGOAITRU.BHYT_DONGIA_CHITRA = '$BHYT_DONGIA_CHITRA$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="BHYT_THANHTIEN_CHITRA">
                        TT_HOADON_CHITIET_NGOAITRU.BHYT_THANHTIEN_CHITRA = '$BHYT_THANHTIEN_CHITRA$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="BENHNHAN_PHAITHANHTOAN">
                        TT_HOADON_CHITIET_NGOAITRU.BENHNHAN_PHAITHANHTOAN = '$BENHNHAN_PHAITHANHTOAN$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="GIATRI_HOADON">
                        TT_HOADON_CHITIET_NGOAITRU.GIATRI_HOADON = '$GIATRI_HOADON$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="GIATRI_HOADON_DATHANHTOAN">
                        TT_HOADON_CHITIET_NGOAITRU.GIATRI_HOADON_DATHANHTOAN = '$GIATRI_HOADON_DATHANHTOAN$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="GIATRI_BIENLAI">
                        TT_HOADON_CHITIET_NGOAITRU.GIATRI_BIENLAI = '$GIATRI_BIENLAI$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="GIATRI_BIENLAI_DATHANHTOAN">
                        TT_HOADON_CHITIET_NGOAITRU.GIATRI_BIENLAI_DATHANHTOAN = '$GIATRI_BIENLAI_DATHANHTOAN$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="GIATRI_BENHNHAN_DATHANHTOAN">
                        TT_HOADON_CHITIET_NGOAITRU.GIATRI_BENHNHAN_DATHANHTOAN = '$GIATRI_BENHNHAN_DATHANHTOAN$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="TYLE_THATTHU">
                        TT_HOADON_CHITIET_NGOAITRU.TYLE_THATTHU = '$TYLE_THATTHU$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="GIATRI_THATTHU">
                        TT_HOADON_CHITIET_NGOAITRU.GIATRI_THATTHU = '$GIATRI_THATTHU$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="MIENGIAM_TL">
                        TT_HOADON_CHITIET_NGOAITRU.MIENGIAM_TL = '$MIENGIAM_TL$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="MIENGIAM_GIATRI">
                        TT_HOADON_CHITIET_NGOAITRU.MIENGIAM_GIATRI = '$MIENGIAM_GIATRI$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="NGANSACH_TL">
                        TT_HOADON_CHITIET_NGOAITRU.NGANSACH_TL = '$NGANSACH_TL$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="NGANSACH_GIATRI">
                        TT_HOADON_CHITIET_NGOAITRU.NGANSACH_GIATRI = '$NGANSACH_GIATRI$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="TAITRO_TL">
                        TT_HOADON_CHITIET_NGOAITRU.TAITRO_TL = '$TAITRO_TL$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="TAITRO_GIATRI">
                        TT_HOADON_CHITIET_NGOAITRU.TAITRO_GIATRI = '$TAITRO_GIATRI$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="BHTN_GIATRI">
                        TT_HOADON_CHITIET_NGOAITRU.BHTN_GIATRI = '$BHTN_GIATRI$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="NOIDUNGTHU">
                        TT_HOADON_CHITIET_NGOAITRU.NOIDUNGTHU = '$NOIDUNGTHU$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="CHUNGTUXUATBN_ID">
                        TT_HOADON_CHITIET_NGOAITRU.CHUNGTUXUATBN_ID = '$CHUNGTUXUATBN_ID$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="TYLEVAT">
                        TT_HOADON_CHITIET_NGOAITRU.TYLEVAT = '$TYLEVAT$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="GIATRIVAT">
                        TT_HOADON_CHITIET_NGOAITRU.GIATRIVAT = '$GIATRIVAT$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="MASOTHUE">
                        TT_HOADON_CHITIET_NGOAITRU.MASOTHUE = '$MASOTHUE$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="SOCHUNGTUKETOAN">
                        TT_HOADON_CHITIET_NGOAITRU.SOCHUNGTUKETOAN = '$SOCHUNGTUKETOAN$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="DAHOANTRA">
                        TT_HOADON_CHITIET_NGOAITRU.DAHOANTRA = '$DAHOANTRA$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="TRANGTHAI">
                        TT_HOADON_CHITIET_NGOAITRU.TRANGTHAI = '$TRANGTHAI$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="PHONGBAN_ID">
                        TT_HOADON_CHITIET_NGOAITRU.PHONGBAN_ID = '$PHONGBAN_ID$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="PHONGBAN_THAYDOI_ID">
                        TT_HOADON_CHITIET_NGOAITRU.PHONGBAN_THAYDOI_ID = '$PHONGBAN_THAYDOI_ID$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="BENHVIEN_ID">
                        TT_HOADON_CHITIET_NGOAITRU.BENHVIEN_ID = '$BENHVIEN_ID$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="NGAYTAO">
                        TT_HOADON_CHITIET_NGOAITRU.NGAYTAO = '$NGAYTAO$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="NGUOITAO_ID">
                        TT_HOADON_CHITIET_NGOAITRU.NGUOITAO_ID = '$NGUOITAO_ID$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="NGAYCAPNHAT">
                        TT_HOADON_CHITIET_NGOAITRU.NGAYCAPNHAT = '$NGAYCAPNHAT$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="NGUOICAPNHAT_ID">
                        TT_HOADON_CHITIET_NGOAITRU.NGUOICAPNHAT_ID = '$NGUOICAPNHAT_ID$'
                    </isNotEmpty>
                </isParameterPresent>
            </dynamic>
            ) a
            left join
            (
            select vp.HOADON_ID, vp.REF_ID
            ,sum(MGCT.GIATRIMIENGIAM) AS GIATRIMIENGIAM_BH
            from TT_MIENGIAM MG INNER JOIN TT_MIENGIAM_CHITIET MGCT ON MG.MIENGIAM_ID = MGCT.MIENGIAM_ID
            left join TT_VIENPHI vp on vp.VIENPHI_ID = mgct.VIENPHI_ID
            where
            MGCT.REF_TABLE = 'TT_MIENGIAM'
            and MG.TINHTRANG = 1
            and vp.HOADON_ID = '$HOADON_ID$'
            group by vp.HOADON_ID, vp.REF_ID
            )b on b.HOADON_ID = a.HOADON_ID and b.REF_ID = a.REF_ID
            left join
            (
            select vp.HOADON_ID, vp.REF_ID
            ,sum(MGCT.GIATRIMIENGIAM) AS GIATRIMIENGIAM_BHTN
            from TT_MIENGIAM_BHTN MG INNER JOIN TT_MIENGIAM_CHITIET MGCT ON MG.MIENGIAM_BHTN_ID = MGCT.MIENGIAM_ID
            left join TT_VIENPHI vp on vp.VIENPHI_ID = mgct.VIENPHI_ID
            where
            MGCT.REF_TABLE = 'TT_MIENGIAM_BHTN'
            and MG.TINHTRANG = 1
            and vp.HOADON_ID = '$HOADON_ID$'
            group by vp.HOADON_ID, vp.REF_ID
            )c on c.HOADON_ID = a.HOADON_ID and c.REF_ID = a.REF_ID
            left join
            (
            select vp.HOADON_ID, vp.REF_ID,
            sum(MGCT.GIATRIMIENGIAM) AS GIATRIMIENGIAM_THANHVIEN
            from TT_MIENGIAM_THANHVIEN MG INNER JOIN TT_MIENGIAM_CHITIET MGCT ON MG.MIENGIAM_THANHVIEN_ID = MGCT.MIENGIAM_ID
            left join TT_VIENPHI vp on vp.VIENPHI_ID = mgct.VIENPHI_ID
            where
            MGCT.REF_TABLE = 'TT_MIENGIAM_THANHVIEN'
            and MG.TINHTRANG = 1
            and vp.HOADON_ID = '$HOADON_ID$'
            group by vp.HOADON_ID, vp.REF_ID
            )f on f.HOADON_ID = a.HOADON_ID and f.REF_ID = a.REF_ID
        </statement>
        <!--Revision:0,50aeaaf51713029d3369a91d755df0bc-->
        <statement id="DAO00024_TT_HOADON_CHITIET_NGOAITRU_GetDetail" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
            select *
            from TT_HOADON_CHITIET_NGOAITRU
            where TT_HOADON_CHITIET_NGOAITRU.HOADONCHITIET_ID  = '$value$'
            order by HOADONCHITIET_ID
        </statement>
        <!--Revision:0,4224f95bdf8b38be26871ed4ab72fc13-->
        <statement id="DAO00024_TT_HOADON_CHITIET_NGOAITRU_GetDetailP" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
            select *
            from TT_HOADON_CHITIET_NGOAITRU
            where TT_HOADON_CHITIET_NGOAITRU.HOADONCHITIET_ID  = '$HOADONCHITIET_ID$'
            order by HOADONCHITIET_ID
        </statement>
        <!--Revision:0,54b6ad592a9fc19f9588a95e249e1fce-->
        <statement id="DAO00024_TT_HOADON_CHITIET_NGOAITRU_Add" parameterClass="System.Collections.IDictionary" resultClass="System.Int64">
            insert into TT_HOADON_CHITIET_NGOAITRU (
            HOADON_ID
            , VIENPHI_ID
            , REF_ID
            , REF_TABLE
            , DICHVU_ID
            , DUOC_ID
            , LOAI_CHIPHI
            , LOAIGIA_ID
            , SOLUONG
            , DONGIA_DOANHTHU
            , THANHTIEN_DOANHTHU
            , BHYT_TL
            , BHYT_DONGIA
            , BHYT_THANHTIEN
            , BHYT_DONGIA_CHITRA
            , BHYT_THANHTIEN_CHITRA
            , BENHNHAN_PHAITHANHTOAN
            , GIATRI_HOADON
            , GIATRI_HOADON_DATHANHTOAN
            , GIATRI_BIENLAI
            , GIATRI_BIENLAI_DATHANHTOAN
            , GIATRI_BENHNHAN_DATHANHTOAN
            , TYLE_THATTHU
            , GIATRI_THATTHU
            , MIENGIAM_TL
            , MIENGIAM_GIATRI
            , NGANSACH_TL
            , NGANSACH_GIATRI
            , TAITRO_TL
            , TAITRO_GIATRI
            , BHTN_GIATRI
            , NOIDUNGTHU
            , CHUNGTUXUATBN_ID
            , TYLEVAT
            , GIATRIVAT
            , MASOTHUE
            , SOCHUNGTUKETOAN
            , DAHOANTRA
            , TRANGTHAI
            , PHONGBAN_ID
            , PHONGBAN_THAYDOI_ID
            , BENHVIEN_ID
            , NGAYTAO
            , NGUOITAO_ID
            , NGAYCAPNHAT
            , NGUOICAPNHAT_ID
            , CONGTYCHITRA_GIATRI
            , HOIVIEN_GIATRI
            ) values (
            #HOADON_ID#
            , #VIENPHI_ID#
            , #REF_ID#
            , #REF_TABLE#
            , #DICHVU_ID#
            , #DUOC_ID#
            , #LOAI_CHIPHI#
            , #LOAIGIA_ID#
            , #SOLUONG#
            , #DONGIA_DOANHTHU#
            , #THANHTIEN_DOANHTHU#
            , #BHYT_TL#
            , #BHYT_DONGIA#
            , #BHYT_THANHTIEN#
            , #BHYT_DONGIA_CHITRA#
            , #BHYT_THANHTIEN_CHITRA#
            , #BENHNHAN_PHAITHANHTOAN#
            , #GIATRI_HOADON#
            , #GIATRI_HOADON_DATHANHTOAN#
            , #GIATRI_BIENLAI#
            , #GIATRI_BIENLAI_DATHANHTOAN#
            , #GIATRI_BENHNHAN_DATHANHTOAN#
            , #TYLE_THATTHU#
            , #GIATRI_THATTHU#
            , #MIENGIAM_TL#
            , #MIENGIAM_GIATRI#
            , #NGANSACH_TL#
            , #NGANSACH_GIATRI#
            , #TAITRO_TL#
            , #TAITRO_GIATRI#
            , #BHTN_GIATRI#
            , #NOIDUNGTHU#
            , #CHUNGTUXUATBN_ID#
            , #TYLEVAT#
            , #GIATRIVAT#
            , #MASOTHUE#
            , #SOCHUNGTUKETOAN#
            , #DAHOANTRA#
            , #TRANGTHAI#
            , #PHONGBAN_ID#
            , #PHONGBAN_THAYDOI_ID#
            , #BENHVIEN_ID#
            , #NGAYTAO#
            , #NGUOITAO_ID#
            , #NGAYCAPNHAT#
            , #NGUOICAPNHAT_ID#
            , #CONGTYCHITRA_GIATRI#
            , #HOIVIEN_GIATRI#
            )
            SELECT SCOPE_IDENTITY()
            <!--<selectKey resultClass="System.Int64" type="post" >
        SELECT @@IDENTITY as value
      </selectKey>-->
        </statement>
        <!--Revision:0,39bf7de810b2fff20dc5b4a4df37e0bb-->
        <update id="DAO00024_TT_HOADON_CHITIET_NGOAITRU_Update" parameterClass="System.Collections.IDictionary">
            update TT_HOADON_CHITIET_NGOAITRU set
            <!--HOADON_ID = #HOADON_ID#-->
            <!--, VIENPHI_ID = #VIENPHI_ID#-->
            REF_ID = #REF_ID#
            , REF_TABLE = #REF_TABLE#
            , DICHVU_ID = #DICHVU_ID#
            , DUOC_ID = #DUOC_ID#
            , LOAI_CHIPHI = #LOAI_CHIPHI#
            , LOAIGIA_ID = #LOAIGIA_ID#
            , SOLUONG = #SOLUONG#
            , DONGIA_DOANHTHU = #DONGIA_DOANHTHU#
            , THANHTIEN_DOANHTHU = #THANHTIEN_DOANHTHU#
            , BHYT_TL = #BHYT_TL#
            , BHYT_DONGIA = #BHYT_DONGIA#
            , BHYT_THANHTIEN = #BHYT_THANHTIEN#
            , BHYT_DONGIA_CHITRA = #BHYT_DONGIA_CHITRA#
            , BHYT_THANHTIEN_CHITRA = #BHYT_THANHTIEN_CHITRA#
            , BENHNHAN_PHAITHANHTOAN = #BENHNHAN_PHAITHANHTOAN#
            , GIATRI_HOADON = #GIATRI_HOADON#
            , GIATRI_HOADON_DATHANHTOAN = #GIATRI_HOADON_DATHANHTOAN#
            , GIATRI_BIENLAI = #GIATRI_BIENLAI#
            , GIATRI_BIENLAI_DATHANHTOAN = #GIATRI_BIENLAI_DATHANHTOAN#
            , GIATRI_BENHNHAN_DATHANHTOAN = #GIATRI_BENHNHAN_DATHANHTOAN#
            , TYLE_THATTHU = #TYLE_THATTHU#
            , GIATRI_THATTHU = #GIATRI_THATTHU#
            , MIENGIAM_TL = #MIENGIAM_TL#
            , MIENGIAM_GIATRI = #MIENGIAM_GIATRI#
            , NGANSACH_TL = #NGANSACH_TL#
            , NGANSACH_GIATRI = #NGANSACH_GIATRI#
            , TAITRO_TL = #TAITRO_TL#
            , TAITRO_GIATRI = #TAITRO_GIATRI#
            , BHTN_GIATRI = #BHTN_GIATRI#
            , NOIDUNGTHU = #NOIDUNGTHU#
            , CHUNGTUXUATBN_ID = #CHUNGTUXUATBN_ID#
            , TYLEVAT = #TYLEVAT#
            , GIATRIVAT = #GIATRIVAT#
            , MASOTHUE = #MASOTHUE#
            , SOCHUNGTUKETOAN = #SOCHUNGTUKETOAN#
            , DAHOANTRA = #DAHOANTRA#
            , TRANGTHAI = #TRANGTHAI#
            , PHONGBAN_ID = #PHONGBAN_ID#
            , PHONGBAN_THAYDOI_ID = #PHONGBAN_THAYDOI_ID#
            <!--, BENHVIEN_ID = #BENHVIEN_ID#
      , NGAYTAO = #NGAYTAO#
      , NGUOITAO_ID = #NGUOITAO_ID#-->
            , NGAYCAPNHAT = #NGAYCAPNHAT#
            , NGUOICAPNHAT_ID = #NGUOICAPNHAT_ID#
            <dynamic prepend="where">
                <isParameterPresent>
                    <isNotEmpty prepend="and" property="HOADONCHITIET_ID">
                        HOADONCHITIET_ID = '$HOADONCHITIET_ID$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="VIENPHI_ID">
                        VIENPHI_ID = '$VIENPHI_ID$'
                    </isNotEmpty>
                </isParameterPresent>
            </dynamic>
        </update>
        <!--Revision:0,baef3eefbe35f940911bbf82b88bfe5f-->
        <statement id="DAO00024_TT_HOADON_CHITIET_NGOAITRU_Delete" parameterClass="System.Collections.IDictionary" resultClass="System.Int32">
            delete from TT_HOADON_CHITIET_NGOAITRU
            where
            HOADONCHITIET_ID = '$HOADONCHITIET_ID$'
        </statement>
        <!--Revision:0,580bc91bf4990ad4dfff9fbd83016648-->
        <statement id="DAO00024_TT_HOADON_CHITIET_NGOAITRU_DeleteP" parameterClass="System.Collections.IDictionary" resultClass="System.Int32">
            delete from TT_HOADON_CHITIET_NGOAITRU
            <dynamic prepend="where">
                <isParameterPresent>
                    <isNotEmpty prepend="and" property="HOADONCHITIET_ID">
                        TT_HOADON_CHITIET_NGOAITRU.HOADONCHITIET_ID = '$HOADONCHITIET_ID$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="HOADON_ID">
                        TT_HOADON_CHITIET_NGOAITRU.HOADON_ID = '$HOADON_ID$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="VIENPHI_ID">
                        TT_HOADON_CHITIET_NGOAITRU.VIENPHI_ID = '$VIENPHI_ID$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="REF_ID">
                        TT_HOADON_CHITIET_NGOAITRU.REF_ID = '$REF_ID$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="REF_TABLE">
                        TT_HOADON_CHITIET_NGOAITRU.REF_TABLE = '$REF_TABLE$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="DICHVU_ID">
                        TT_HOADON_CHITIET_NGOAITRU.DICHVU_ID = '$DICHVU_ID$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="DUOC_ID">
                        TT_HOADON_CHITIET_NGOAITRU.DUOC_ID = '$DUOC_ID$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="LOAI_CHIPHI">
                        TT_HOADON_CHITIET_NGOAITRU.LOAI_CHIPHI = '$LOAI_CHIPHI$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="LOAIGIA_ID">
                        TT_HOADON_CHITIET_NGOAITRU.LOAIGIA_ID = '$LOAIGIA_ID$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="SOLUONG">
                        TT_HOADON_CHITIET_NGOAITRU.SOLUONG = '$SOLUONG$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="DONGIA_DOANHTHU">
                        TT_HOADON_CHITIET_NGOAITRU.DONGIA_DOANHTHU = '$DONGIA_DOANHTHU$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="THANHTIEN_DOANHTHU">
                        TT_HOADON_CHITIET_NGOAITRU.THANHTIEN_DOANHTHU = '$THANHTIEN_DOANHTHU$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="BHYT_TL">
                        TT_HOADON_CHITIET_NGOAITRU.BHYT_TL = '$BHYT_TL$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="BHYT_DONGIA">
                        TT_HOADON_CHITIET_NGOAITRU.BHYT_DONGIA = '$BHYT_DONGIA$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="BHYT_THANHTIEN">
                        TT_HOADON_CHITIET_NGOAITRU.BHYT_THANHTIEN = '$BHYT_THANHTIEN$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="BHYT_DONGIA_CHITRA">
                        TT_HOADON_CHITIET_NGOAITRU.BHYT_DONGIA_CHITRA = '$BHYT_DONGIA_CHITRA$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="BHYT_THANHTIEN_CHITRA">
                        TT_HOADON_CHITIET_NGOAITRU.BHYT_THANHTIEN_CHITRA = '$BHYT_THANHTIEN_CHITRA$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="BENHNHAN_PHAITHANHTOAN">
                        TT_HOADON_CHITIET_NGOAITRU.BENHNHAN_PHAITHANHTOAN = '$BENHNHAN_PHAITHANHTOAN$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="GIATRI_HOADON">
                        TT_HOADON_CHITIET_NGOAITRU.GIATRI_HOADON = '$GIATRI_HOADON$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="GIATRI_HOADON_DATHANHTOAN">
                        TT_HOADON_CHITIET_NGOAITRU.GIATRI_HOADON_DATHANHTOAN = '$GIATRI_HOADON_DATHANHTOAN$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="GIATRI_BIENLAI">
                        TT_HOADON_CHITIET_NGOAITRU.GIATRI_BIENLAI = '$GIATRI_BIENLAI$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="GIATRI_BIENLAI_DATHANHTOAN">
                        TT_HOADON_CHITIET_NGOAITRU.GIATRI_BIENLAI_DATHANHTOAN = '$GIATRI_BIENLAI_DATHANHTOAN$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="GIATRI_BENHNHAN_DATHANHTOAN">
                        TT_HOADON_CHITIET_NGOAITRU.GIATRI_BENHNHAN_DATHANHTOAN = '$GIATRI_BENHNHAN_DATHANHTOAN$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="TYLE_THATTHU">
                        TT_HOADON_CHITIET_NGOAITRU.TYLE_THATTHU = '$TYLE_THATTHU$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="GIATRI_THATTHU">
                        TT_HOADON_CHITIET_NGOAITRU.GIATRI_THATTHU = '$GIATRI_THATTHU$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="MIENGIAM_TL">
                        TT_HOADON_CHITIET_NGOAITRU.MIENGIAM_TL = '$MIENGIAM_TL$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="MIENGIAM_GIATRI">
                        TT_HOADON_CHITIET_NGOAITRU.MIENGIAM_GIATRI = '$MIENGIAM_GIATRI$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="NGANSACH_TL">
                        TT_HOADON_CHITIET_NGOAITRU.NGANSACH_TL = '$NGANSACH_TL$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="NGANSACH_GIATRI">
                        TT_HOADON_CHITIET_NGOAITRU.NGANSACH_GIATRI = '$NGANSACH_GIATRI$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="TAITRO_TL">
                        TT_HOADON_CHITIET_NGOAITRU.TAITRO_TL = '$TAITRO_TL$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="TAITRO_GIATRI">
                        TT_HOADON_CHITIET_NGOAITRU.TAITRO_GIATRI = '$TAITRO_GIATRI$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="BHTN_GIATRI">
                        TT_HOADON_CHITIET_NGOAITRU.BHTN_GIATRI = '$BHTN_GIATRI$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="NOIDUNGTHU">
                        TT_HOADON_CHITIET_NGOAITRU.NOIDUNGTHU = '$NOIDUNGTHU$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="CHUNGTUXUATBN_ID">
                        TT_HOADON_CHITIET_NGOAITRU.CHUNGTUXUATBN_ID = '$CHUNGTUXUATBN_ID$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="TYLEVAT">
                        TT_HOADON_CHITIET_NGOAITRU.TYLEVAT = '$TYLEVAT$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="GIATRIVAT">
                        TT_HOADON_CHITIET_NGOAITRU.GIATRIVAT = '$GIATRIVAT$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="MASOTHUE">
                        TT_HOADON_CHITIET_NGOAITRU.MASOTHUE = '$MASOTHUE$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="SOCHUNGTUKETOAN">
                        TT_HOADON_CHITIET_NGOAITRU.SOCHUNGTUKETOAN = '$SOCHUNGTUKETOAN$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="DAHOANTRA">
                        TT_HOADON_CHITIET_NGOAITRU.DAHOANTRA = '$DAHOANTRA$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="TRANGTHAI">
                        TT_HOADON_CHITIET_NGOAITRU.TRANGTHAI = '$TRANGTHAI$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="PHONGBAN_ID">
                        TT_HOADON_CHITIET_NGOAITRU.PHONGBAN_ID = '$PHONGBAN_ID$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="PHONGBAN_THAYDOI_ID">
                        TT_HOADON_CHITIET_NGOAITRU.PHONGBAN_THAYDOI_ID = '$PHONGBAN_THAYDOI_ID$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="BENHVIEN_ID">
                        TT_HOADON_CHITIET_NGOAITRU.BENHVIEN_ID = '$BENHVIEN_ID$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="NGAYTAO">
                        TT_HOADON_CHITIET_NGOAITRU.NGAYTAO = '$NGAYTAO$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="NGUOITAO_ID">
                        TT_HOADON_CHITIET_NGOAITRU.NGUOITAO_ID = '$NGUOITAO_ID$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="NGAYCAPNHAT">
                        TT_HOADON_CHITIET_NGOAITRU.NGAYCAPNHAT = '$NGAYCAPNHAT$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="NGUOICAPNHAT_ID">
                        TT_HOADON_CHITIET_NGOAITRU.NGUOICAPNHAT_ID = '$NGUOICAPNHAT_ID$'
                    </isNotEmpty>
                </isParameterPresent>
            </dynamic>
        </statement>
        <!--Revision:0,ddddbef2302d953c4c5fbeb6f1829f86-->
        <statement id="DAO00024_TT_HOADON_CHITIET_NOITRU_GetAll" resultClass="DataObject">
            select *
            from TT_HOADON_CHITIET_NOITRU
            order by HOADON_CHITIET_NOITRU_ID
        </statement>
        <!--Revision:0,bf2fa2bed12e258593854a9426641cd1-->
        <statement id="DAO00024_TT_HOADON_CHITIET_NOITRU_GetList" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
            select a.*, b.GIATRIMIENGIAM_BH, c.GIATRIMIENGIAM_BHTN, f.GIATRIMIENGIAM_THANHVIEN
            from
            (
            select TT_HOADON_CHITIET_NOITRU.*, c.TRANGTHAI as TRANGTHAI_DVYC, vp.DATHUCHIEN, ba.LOAIBENHAN
            from TT_HOADON_CHITIET_NOITRU
            left join TT_VIENPHI vp on vp.VIENPHI_ID = TT_HOADON_CHITIET_NOITRU.VIENPHI_ID
            left join TT_NOITRU_BENHAN ba on ba.BENHAN_ID = vp.BENHAN_ID
            left join TT_DVYEUCAU c on c.DVYEUCAU_ID = vp.REF_ID
            and TT_HOADON_CHITIET_NOITRU.DICHVU_ID is not null
            <dynamic prepend="where">
                <isParameterPresent>
                    <isNotEmpty prepend="and" property="HOADON_CHITIET_NOITRU_ID">
                        TT_HOADON_CHITIET_NOITRU.HOADON_CHITIET_NOITRU_ID = '$HOADON_CHITIET_NOITRU_ID$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="HOADON_ID">
                        TT_HOADON_CHITIET_NOITRU.HOADON_ID = '$HOADON_ID$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="VIENPHI_ID">
                        TT_HOADON_CHITIET_NOITRU.VIENPHI_ID = '$VIENPHI_ID$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="PHONGBAN_ID">
                        TT_HOADON_CHITIET_NOITRU.PHONGBAN_ID = '$PHONGBAN_ID$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="BENHANPHAUTHUAT_VTYT_ID">
                        TT_HOADON_CHITIET_NOITRU.BENHANPHAUTHUAT_VTYT_ID = '$BENHANPHAUTHUAT_VTYT_ID$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="NOITRU_GIUONGBENH_ID">
                        TT_HOADON_CHITIET_NOITRU.NOITRU_GIUONGBENH_ID = '$NOITRU_GIUONGBENH_ID$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="CLSGHINHANHOACHAT_ID">
                        TT_HOADON_CHITIET_NOITRU.CLSGHINHANHOACHAT_ID = '$CLSGHINHANHOACHAT_ID$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="DOITUONG_ID">
                        TT_HOADON_CHITIET_NOITRU.DOITUONG_ID = '$DOITUONG_ID$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="SOLUONG">
                        TT_HOADON_CHITIET_NOITRU.SOLUONG = '$SOLUONG$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="DONGIA_DOANHTHU">
                        TT_HOADON_CHITIET_NOITRU.DONGIA_DOANHTHU = '$DONGIA_DOANHTHU$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="THANHTIEN_DOANHTHU">
                        TT_HOADON_CHITIET_NOITRU.THANHTIEN_DOANHTHU = '$THANHTIEN_DOANHTHU$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="BHYT_TL">
                        TT_HOADON_CHITIET_NOITRU.BHYT_TL = '$BHYT_TL$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="BHYT_DONGIA">
                        TT_HOADON_CHITIET_NOITRU.BHYT_DONGIA = '$BHYT_DONGIA$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="BHYT_THANHTIEN">
                        TT_HOADON_CHITIET_NOITRU.BHYT_THANHTIEN = '$BHYT_THANHTIEN$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="BHYT_DONGIA_CHITRA">
                        TT_HOADON_CHITIET_NOITRU.BHYT_DONGIA_CHITRA = '$BHYT_DONGIA_CHITRA$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="BHYT_THANHTIEN_CHITRA">
                        TT_HOADON_CHITIET_NOITRU.BHYT_THANHTIEN_CHITRA = '$BHYT_THANHTIEN_CHITRA$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="BENHNHAN_PHAITHANHTOAN">
                        TT_HOADON_CHITIET_NOITRU.BENHNHAN_PHAITHANHTOAN = '$BENHNHAN_PHAITHANHTOAN$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="GIATRI_HOADON">
                        TT_HOADON_CHITIET_NOITRU.GIATRI_HOADON = '$GIATRI_HOADON$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="GIATRI_HOADON_DATHANHTOAN">
                        TT_HOADON_CHITIET_NOITRU.GIATRI_HOADON_DATHANHTOAN = '$GIATRI_HOADON_DATHANHTOAN$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="GIATRI_BIENLAI">
                        TT_HOADON_CHITIET_NOITRU.GIATRI_BIENLAI = '$GIATRI_BIENLAI$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="GIATRI_BIENLAI_DATHANHTOAN">
                        TT_HOADON_CHITIET_NOITRU.GIATRI_BIENLAI_DATHANHTOAN = '$GIATRI_BIENLAI_DATHANHTOAN$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="GIATRI_BENHNHAN_DATHANHTOAN">
                        TT_HOADON_CHITIET_NOITRU.GIATRI_BENHNHAN_DATHANHTOAN = '$GIATRI_BENHNHAN_DATHANHTOAN$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="TYLE_THATTHU">
                        TT_HOADON_CHITIET_NOITRU.TYLE_THATTHU = '$TYLE_THATTHU$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="GIATRI_THATTHU">
                        TT_HOADON_CHITIET_NOITRU.GIATRI_THATTHU = '$GIATRI_THATTHU$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="MIENGIAM_TL">
                        TT_HOADON_CHITIET_NOITRU.MIENGIAM_TL = '$MIENGIAM_TL$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="MIENGIAM_GIATRI">
                        TT_HOADON_CHITIET_NOITRU.MIENGIAM_GIATRI = '$MIENGIAM_GIATRI$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="NGANSACH_TL">
                        TT_HOADON_CHITIET_NOITRU.NGANSACH_TL = '$NGANSACH_TL$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="NGANSACH_GIATRI">
                        TT_HOADON_CHITIET_NOITRU.NGANSACH_GIATRI = '$NGANSACH_GIATRI$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="TAITRO_TL">
                        TT_HOADON_CHITIET_NOITRU.TAITRO_TL = '$TAITRO_TL$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="TAITRO_GIATRI">
                        TT_HOADON_CHITIET_NOITRU.TAITRO_GIATRI = '$TAITRO_GIATRI$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="BHTN_GIATRI">
                        TT_HOADON_CHITIET_NOITRU.BHTN_GIATRI = '$BHTN_GIATRI$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="DAHOANTRA">
                        TT_HOADON_CHITIET_NOITRU.DAHOANTRA = '$DAHOANTRA$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="GHICHU">
                        TT_HOADON_CHITIET_NOITRU.GHICHU = '$GHICHU$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="DICHVU_ID">
                        TT_HOADON_CHITIET_NOITRU.DICHVU_ID = '$DICHVU_ID$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="NOITRU_TOATHUOC_ID">
                        TT_HOADON_CHITIET_NOITRU.NOITRU_TOATHUOC_ID = '$NOITRU_TOATHUOC_ID$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="NOITRU_TRATHUOC_ID">
                        TT_HOADON_CHITIET_NOITRU.NOITRU_TRATHUOC_ID = '$NOITRU_TRATHUOC_ID$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="BENHVIEN_ID">
                        TT_HOADON_CHITIET_NOITRU.BENHVIEN_ID = '$BENHVIEN_ID$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="NGUOITAO_ID">
                        TT_HOADON_CHITIET_NOITRU.NGUOITAO_ID = '$NGUOITAO_ID$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="NGAYTAO">
                        TT_HOADON_CHITIET_NOITRU.NGAYTAO = '$NGAYTAO$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="NGUOICAPNHAT_ID">
                        TT_HOADON_CHITIET_NOITRU.NGUOICAPNHAT_ID = '$NGUOICAPNHAT_ID$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="NGAYCAPNHAT">
                        TT_HOADON_CHITIET_NOITRU.NGAYCAPNHAT = '$NGAYCAPNHAT$'
                    </isNotEmpty>
                </isParameterPresent>
            </dynamic>
            ) a
            left join
            (
            select vp.HOADON_ID, vp.REF_ID
            ,sum(MGCT.GIATRIMIENGIAM) AS GIATRIMIENGIAM_BH
            from TT_MIENGIAM MG INNER JOIN TT_MIENGIAM_CHITIET MGCT ON MG.MIENGIAM_ID = MGCT.MIENGIAM_ID
            left join TT_VIENPHI vp on vp.VIENPHI_ID = mgct.VIENPHI_ID
            where
            MGCT.REF_TABLE = 'TT_MIENGIAM'
            and MG.TINHTRANG = 1
            and vp.HOADON_ID = '$HOADON_ID$'
            group by vp.HOADON_ID, vp.REF_ID
            )b on b.HOADON_ID = a.HOADON_ID and b.REF_ID = a.REF_ID
            left join
            (
            select vp.HOADON_ID, vp.REF_ID
            ,sum(MGCT.GIATRIMIENGIAM) AS GIATRIMIENGIAM_BHTN
            from TT_MIENGIAM_BHTN MG INNER JOIN TT_MIENGIAM_CHITIET MGCT ON MG.MIENGIAM_BHTN_ID = MGCT.MIENGIAM_ID
            left join TT_VIENPHI vp on vp.VIENPHI_ID = mgct.VIENPHI_ID
            where
            MGCT.REF_TABLE = 'TT_MIENGIAM_BHTN'
            and MG.TINHTRANG = 1
            and vp.HOADON_ID = '$HOADON_ID$'
            group by vp.HOADON_ID, vp.REF_ID
            )c on c.HOADON_ID = a.HOADON_ID and c.REF_ID = a.REF_ID
            left join
            (
            select vp.HOADON_ID, vp.REF_ID,
            sum(MGCT.GIATRIMIENGIAM) AS GIATRIMIENGIAM_THANHVIEN
            from TT_MIENGIAM_THANHVIEN MG INNER JOIN TT_MIENGIAM_CHITIET MGCT ON MG.MIENGIAM_THANHVIEN_ID = MGCT.MIENGIAM_ID
            left join TT_VIENPHI vp on vp.VIENPHI_ID = mgct.VIENPHI_ID
            where
            MGCT.REF_TABLE = 'TT_MIENGIAM_THANHVIEN'
            and MG.TINHTRANG = 1
            and vp.HOADON_ID = '$HOADON_ID$'
            group by vp.HOADON_ID, vp.REF_ID
            )f on f.HOADON_ID = a.HOADON_ID and f.REF_ID = a.REF_ID
        </statement>
        <!--Revision:0,0e21d0f3eb8f4aa73a2c7296290c8072-->
        <statement id="DAO00024_TT_HOADON_CHITIET_NOITRU_GetDetail" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
            select *
            from TT_HOADON_CHITIET_NOITRU
            where TT_HOADON_CHITIET_NOITRU.HOADON_CHITIET_NOITRU_ID  = '$value$'
            order by HOADON_CHITIET_NOITRU_ID
        </statement>
        <!--Revision:0,1db539732ac9000604ebb2ae5031803e-->
        <statement id="DAO00024_TT_HOADON_CHITIET_NOITRU_GetDetailP" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
            select *
            from TT_HOADON_CHITIET_NOITRU
            where TT_HOADON_CHITIET_NOITRU.HOADON_CHITIET_NOITRU_ID  = '$HOADON_CHITIET_NOITRU_ID$'
            order by HOADON_CHITIET_NOITRU_ID
        </statement>
        <!--Revision:0,389743b0c1eb4b1e1788d42e64080e6f-->
        <insert id="DAO00024_TT_HOADON_CHITIET_NOITRU_Add" parameterClass="System.Collections.IDictionary" resultClass="System.Int64">
            insert into TT_HOADON_CHITIET_NOITRU (
            HOADON_ID
            , VIENPHI_ID
            , REF_ID
            , REF_TABLE
            , DUOC_ID
            , LOAI_CHIPHI
            , LOAIGIA_ID
            , PHONGBAN_ID
            , BENHANPHAUTHUAT_VTYT_ID
            , NOITRU_GIUONGBENH_ID
            , CLSGHINHANHOACHAT_ID
            , SOLUONG
            , DONGIA_DOANHTHU
            , THANHTIEN_DOANHTHU
            , BHYT_TL
            , BHYT_DONGIA
            , BHYT_THANHTIEN
            , BHYT_DONGIA_CHITRA
            , BHYT_THANHTIEN_CHITRA
            , BENHNHAN_PHAITHANHTOAN
            , GIATRI_HOADON
            , GIATRI_HOADON_DATHANHTOAN
            , GIATRI_BIENLAI
            , GIATRI_BIENLAI_DATHANHTOAN
            , GIATRI_BENHNHAN_DATHANHTOAN
            , TYLE_THATTHU
            , GIATRI_THATTHU
            , MIENGIAM_TL
            , MIENGIAM_GIATRI
            , NGANSACH_TL
            , NGANSACH_GIATRI
            , TAITRO_TL
            , TAITRO_GIATRI
            , BHTN_GIATRI
            , DAHOANTRA
            , GHICHU
            , DICHVU_ID
            , NOITRU_TOATHUOC_ID
            , NOITRU_TRATHUOC_ID
            , BENHVIEN_ID
            , NGUOITAO_ID
            , NGAYTAO
            , NGUOICAPNHAT_ID
            , NGAYCAPNHAT
            , CONGTYCHITRA_GIATRI
            , HOIVIEN_GIATRI
            ) values (
            #HOADON_ID#
            , #VIENPHI_ID#
            , #REF_ID#
            , #REF_TABLE#
            , #DUOC_ID#
            , #LOAI_CHIPHI#
            , #LOAIGIA_ID#
            , #PHONGBAN_ID#
            , #BENHANPHAUTHUAT_VTYT_ID#
            , #NOITRU_GIUONGBENH_ID#
            , #CLSGHINHANHOACHAT_ID#
            , #SOLUONG#
            , #DONGIA_DOANHTHU#
            , #THANHTIEN_DOANHTHU#
            , #BHYT_TL#
            , #BHYT_DONGIA#
            , #BHYT_THANHTIEN#
            , #BHYT_DONGIA_CHITRA#
            , #BHYT_THANHTIEN_CHITRA#
            , #BENHNHAN_PHAITHANHTOAN#
            , #GIATRI_HOADON#
            , #GIATRI_HOADON_DATHANHTOAN#
            , #GIATRI_BIENLAI#
            , #GIATRI_BIENLAI_DATHANHTOAN#
            , #GIATRI_BENHNHAN_DATHANHTOAN#
            , #TYLE_THATTHU#
            , #GIATRI_THATTHU#
            , #MIENGIAM_TL#
            , #MIENGIAM_GIATRI#
            , #NGANSACH_TL#
            , #NGANSACH_GIATRI#
            , #TAITRO_TL#
            , #TAITRO_GIATRI#
            , #BHTN_GIATRI#
            , #DAHOANTRA#
            , #GHICHU#
            , #DICHVU_ID#
            , #NOITRU_TOATHUOC_ID#
            , #NOITRU_TRATHUOC_ID#
            , #BENHVIEN_ID#
            , #NGUOITAO_ID#
            , #NGAYTAO#
            , #NGUOICAPNHAT_ID#
            , #NGAYCAPNHAT#
            , #CONGTYCHITRA_GIATRI#
            , #HOIVIEN_GIATRI#
            )
        </insert>
        <!--Revision:0,4474b1a22e1c6a182944d05d4ac562f9-->
        <update id="DAO00024_TT_HOADON_CHITIET_NOITRU_Update" parameterClass="System.Collections.IDictionary">
            update TT_HOADON_CHITIET_NOITRU set
            HOADON_ID = #HOADON_ID#
            , VIENPHI_ID = #VIENPHI_ID#
            , PHONGBAN_ID = #PHONGBAN_ID#
            , BENHANPHAUTHUAT_VTYT_ID = #BENHANPHAUTHUAT_VTYT_ID#
            , NOITRU_GIUONGBENH_ID = #NOITRU_GIUONGBENH_ID#
            , CLSGHINHANHOACHAT_ID = #CLSGHINHANHOACHAT_ID#
            , DOITUONG_ID = #DOITUONG_ID#
            , SOLUONG = #SOLUONG#
            , DONGIA_DOANHTHU = #DONGIA_DOANHTHU#
            , THANHTIEN_DOANHTHU = #THANHTIEN_DOANHTHU#
            , BHYT_TL = #BHYT_TL#
            , BHYT_DONGIA = #BHYT_DONGIA#
            , BHYT_THANHTIEN = #BHYT_THANHTIEN#
            , BHYT_DONGIA_CHITRA = #BHYT_DONGIA_CHITRA#
            , BHYT_THANHTIEN_CHITRA = #BHYT_THANHTIEN_CHITRA#
            , BENHNHAN_PHAITHANHTOAN = #BENHNHAN_PHAITHANHTOAN#
            , GIATRI_HOADON = #GIATRI_HOADON#
            , GIATRI_HOADON_DATHANHTOAN = #GIATRI_HOADON_DATHANHTOAN#
            , GIATRI_BIENLAI = #GIATRI_BIENLAI#
            , GIATRI_BIENLAI_DATHANHTOAN = #GIATRI_BIENLAI_DATHANHTOAN#
            , GIATRI_BENHNHAN_DATHANHTOAN = #GIATRI_BENHNHAN_DATHANHTOAN#
            , TYLE_THATTHU = #TYLE_THATTHU#
            , GIATRI_THATTHU = #GIATRI_THATTHU#
            , MIENGIAM_TL = #MIENGIAM_TL#
            , MIENGIAM_GIATRI = #MIENGIAM_GIATRI#
            , NGANSACH_TL = #NGANSACH_TL#
            , NGANSACH_GIATRI = #NGANSACH_GIATRI#
            , TAITRO_TL = #TAITRO_TL#
            , TAITRO_GIATRI = #TAITRO_GIATRI#
            , BHTN_GIATRI = #BHTN_GIATRI#
            , DAHOANTRA = #DAHOANTRA#
            , GHICHU = #GHICHU#
            , DICHVU_ID = #DICHVU_ID#
            , NOITRU_TOATHUOC_ID = #NOITRU_TOATHUOC_ID#
            , NOITRU_TRATHUOC_ID = #NOITRU_TRATHUOC_ID#
            <!--, BENHVIEN_ID = #BENHVIEN_ID#
      , NGUOITAO_ID = #NGUOITAO_ID#
      , NGAYTAO = #NGAYTAO#-->
            , NGUOICAPNHAT_ID = #NGUOICAPNHAT_ID#
            , NGAYCAPNHAT = #NGAYCAPNHAT#
            where
            HOADON_CHITIET_NOITRU_ID = '$HOADON_CHITIET_NOITRU_ID$'
        </update>
        <!--Revision:0,9734437faa2a57cf3a868e92b04dfe13-->
        <statement id="DAO00024_TT_HOADON_CHITIET_NOITRU_Delete" parameterClass="System.Collections.IDictionary" resultClass="System.Int32">
            delete from TT_HOADON_CHITIET_NOITRU
            where
            HOADON_CHITIET_NOITRU_ID = '$HOADON_CHITIET_NOITRU_ID$'
        </statement>
        <!--Revision:0,6ac771c5ea02b797bf1204052d02a27e-->
        <statement id="DAO00024_TT_HOADON_CHITIET_NOITRU_DeleteP" parameterClass="System.Collections.IDictionary" resultClass="System.Int32">
            delete from TT_HOADON_CHITIET_NOITRU
            <dynamic prepend="where">
                <isParameterPresent>
                    <isNotEmpty prepend="and" property="HOADON_CHITIET_NOITRU_ID">
                        TT_HOADON_CHITIET_NOITRU.HOADON_CHITIET_NOITRU_ID = '$HOADON_CHITIET_NOITRU_ID$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="HOADON_ID">
                        TT_HOADON_CHITIET_NOITRU.HOADON_ID = '$HOADON_ID$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="VIENPHI_ID">
                        TT_HOADON_CHITIET_NOITRU.VIENPHI_ID = '$VIENPHI_ID$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="PHONGBAN_ID">
                        TT_HOADON_CHITIET_NOITRU.PHONGBAN_ID = '$PHONGBAN_ID$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="BENHANPHAUTHUAT_VTYT_ID">
                        TT_HOADON_CHITIET_NOITRU.BENHANPHAUTHUAT_VTYT_ID = '$BENHANPHAUTHUAT_VTYT_ID$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="NOITRU_GIUONGBENH_ID">
                        TT_HOADON_CHITIET_NOITRU.NOITRU_GIUONGBENH_ID = '$NOITRU_GIUONGBENH_ID$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="CLSGHINHANHOACHAT_ID">
                        TT_HOADON_CHITIET_NOITRU.CLSGHINHANHOACHAT_ID = '$CLSGHINHANHOACHAT_ID$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="DOITUONG_ID">
                        TT_HOADON_CHITIET_NOITRU.DOITUONG_ID = '$DOITUONG_ID$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="SOLUONG">
                        TT_HOADON_CHITIET_NOITRU.SOLUONG = '$SOLUONG$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="DONGIA_DOANHTHU">
                        TT_HOADON_CHITIET_NOITRU.DONGIA_DOANHTHU = '$DONGIA_DOANHTHU$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="THANHTIEN_DOANHTHU">
                        TT_HOADON_CHITIET_NOITRU.THANHTIEN_DOANHTHU = '$THANHTIEN_DOANHTHU$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="BHYT_TL">
                        TT_HOADON_CHITIET_NOITRU.BHYT_TL = '$BHYT_TL$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="BHYT_DONGIA">
                        TT_HOADON_CHITIET_NOITRU.BHYT_DONGIA = '$BHYT_DONGIA$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="BHYT_THANHTIEN">
                        TT_HOADON_CHITIET_NOITRU.BHYT_THANHTIEN = '$BHYT_THANHTIEN$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="BHYT_DONGIA_CHITRA">
                        TT_HOADON_CHITIET_NOITRU.BHYT_DONGIA_CHITRA = '$BHYT_DONGIA_CHITRA$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="BHYT_THANHTIEN_CHITRA">
                        TT_HOADON_CHITIET_NOITRU.BHYT_THANHTIEN_CHITRA = '$BHYT_THANHTIEN_CHITRA$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="BENHNHAN_PHAITHANHTOAN">
                        TT_HOADON_CHITIET_NOITRU.BENHNHAN_PHAITHANHTOAN = '$BENHNHAN_PHAITHANHTOAN$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="GIATRI_HOADON">
                        TT_HOADON_CHITIET_NOITRU.GIATRI_HOADON = '$GIATRI_HOADON$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="GIATRI_HOADON_DATHANHTOAN">
                        TT_HOADON_CHITIET_NOITRU.GIATRI_HOADON_DATHANHTOAN = '$GIATRI_HOADON_DATHANHTOAN$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="GIATRI_BIENLAI">
                        TT_HOADON_CHITIET_NOITRU.GIATRI_BIENLAI = '$GIATRI_BIENLAI$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="GIATRI_BIENLAI_DATHANHTOAN">
                        TT_HOADON_CHITIET_NOITRU.GIATRI_BIENLAI_DATHANHTOAN = '$GIATRI_BIENLAI_DATHANHTOAN$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="GIATRI_BENHNHAN_DATHANHTOAN">
                        TT_HOADON_CHITIET_NOITRU.GIATRI_BENHNHAN_DATHANHTOAN = '$GIATRI_BENHNHAN_DATHANHTOAN$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="TYLE_THATTHU">
                        TT_HOADON_CHITIET_NOITRU.TYLE_THATTHU = '$TYLE_THATTHU$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="GIATRI_THATTHU">
                        TT_HOADON_CHITIET_NOITRU.GIATRI_THATTHU = '$GIATRI_THATTHU$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="MIENGIAM_TL">
                        TT_HOADON_CHITIET_NOITRU.MIENGIAM_TL = '$MIENGIAM_TL$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="MIENGIAM_GIATRI">
                        TT_HOADON_CHITIET_NOITRU.MIENGIAM_GIATRI = '$MIENGIAM_GIATRI$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="NGANSACH_TL">
                        TT_HOADON_CHITIET_NOITRU.NGANSACH_TL = '$NGANSACH_TL$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="NGANSACH_GIATRI">
                        TT_HOADON_CHITIET_NOITRU.NGANSACH_GIATRI = '$NGANSACH_GIATRI$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="TAITRO_TL">
                        TT_HOADON_CHITIET_NOITRU.TAITRO_TL = '$TAITRO_TL$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="TAITRO_GIATRI">
                        TT_HOADON_CHITIET_NOITRU.TAITRO_GIATRI = '$TAITRO_GIATRI$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="BHTN_GIATRI">
                        TT_HOADON_CHITIET_NOITRU.BHTN_GIATRI = '$BHTN_GIATRI$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="DAHOANTRA">
                        TT_HOADON_CHITIET_NOITRU.DAHOANTRA = '$DAHOANTRA$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="GHICHU">
                        TT_HOADON_CHITIET_NOITRU.GHICHU = '$GHICHU$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="DICHVU_ID">
                        TT_HOADON_CHITIET_NOITRU.DICHVU_ID = '$DICHVU_ID$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="NOITRU_TOATHUOC_ID">
                        TT_HOADON_CHITIET_NOITRU.NOITRU_TOATHUOC_ID = '$NOITRU_TOATHUOC_ID$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="NOITRU_TRATHUOC_ID">
                        TT_HOADON_CHITIET_NOITRU.NOITRU_TRATHUOC_ID = '$NOITRU_TRATHUOC_ID$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="BENHVIEN_ID">
                        TT_HOADON_CHITIET_NOITRU.BENHVIEN_ID = '$BENHVIEN_ID$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="NGUOITAO_ID">
                        TT_HOADON_CHITIET_NOITRU.NGUOITAO_ID = '$NGUOITAO_ID$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="NGAYTAO">
                        TT_HOADON_CHITIET_NOITRU.NGAYTAO = '$NGAYTAO$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="NGUOICAPNHAT_ID">
                        TT_HOADON_CHITIET_NOITRU.NGUOICAPNHAT_ID = '$NGUOICAPNHAT_ID$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="NGAYCAPNHAT">
                        TT_HOADON_CHITIET_NOITRU.NGAYCAPNHAT = '$NGAYCAPNHAT$'
                    </isNotEmpty>
                </isParameterPresent>
            </dynamic>
        </statement>
        <!--Revision:0,6cb51cc2a31f175e50e56a31f845e962-->
        <statement id="DAO00024_TT_HOADON_HINHTHUCTHANHTOAN_GetAll" resultClass="DataObject">
            select *
            from TT_HOADON_HINHTHUCTHANHTOAN
            order by HOADON_HTTT_ID
        </statement>
        <!--Revision:0,82a7b1c05d269382fd0012f5e9f83bcf-->
        <statement id="DAO00024_TT_HOADON_HINHTHUCTHANHTOAN_GetList" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
            select *
            from TT_HOADON_HINHTHUCTHANHTOAN
            <dynamic prepend="where">
                <isParameterPresent>
                    <isNotEmpty prepend="and" property="HOADON_HTTT_ID">
                        TT_HOADON_HINHTHUCTHANHTOAN.HOADON_HTTT_ID = '$HOADON_HTTT_ID$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="HOADON_ID">
                        TT_HOADON_HINHTHUCTHANHTOAN.HOADON_ID = '$HOADON_ID$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="HINHTHUCTHANHTOAN_ID">
                        TT_HOADON_HINHTHUCTHANHTOAN.HINHTHUCTHANHTOAN_ID = '$HINHTHUCTHANHTOAN_ID$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="TENHINHTHUCTHANHTOAN">
                        TT_HOADON_HINHTHUCTHANHTOAN.TENHINHTHUCTHANHTOAN = '$TENHINHTHUCTHANHTOAN$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="GIATRITHUCTHU">
                        TT_HOADON_HINHTHUCTHANHTOAN.GIATRITHUCTHU = '$GIATRITHUCTHU$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="TIENTE">
                        TT_HOADON_HINHTHUCTHANHTOAN.TIENTE = '$TIENTE$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="TIENTE_ID">
                        TT_HOADON_HINHTHUCTHANHTOAN.TIENTE_ID = '$TIENTE_ID$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="TYGIA">
                        TT_HOADON_HINHTHUCTHANHTOAN.TYGIA = '$TYGIA$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="GIATRIVND">
                        TT_HOADON_HINHTHUCTHANHTOAN.GIATRIVND = '$GIATRIVND$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="BENHVIEN_ID">
                        TT_HOADON_HINHTHUCTHANHTOAN.BENHVIEN_ID = '$BENHVIEN_ID$'
                    </isNotEmpty>
                </isParameterPresent>
            </dynamic>
            order by HOADON_HTTT_ID
        </statement>
        <!--Revision:0,ca0caae573ff2067920ee3cee4e05ac1-->
        <statement id="DAO00024_TT_HOADON_HINHTHUCTHANHTOAN_GetDetail" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
            select *
            from TT_HOADON_HINHTHUCTHANHTOAN
            where TT_HOADON_HINHTHUCTHANHTOAN.HOADON_HTTT_ID  = '$value$'
            order by HOADON_HTTT_ID
        </statement>
        <!--Revision:0,9b7de4f725746748b8a424d7018f4acb-->
        <statement id="DAO00024_TT_HOADON_HINHTHUCTHANHTOAN_GetDetailP" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
            select *
            from TT_HOADON_HINHTHUCTHANHTOAN
            where TT_HOADON_HINHTHUCTHANHTOAN.HOADON_HTTT_ID  = '$HOADON_HTTT_ID$'
            order by HOADON_HTTT_ID
        </statement>
        <!--Revision:0,2e7f319b5dad5e7e5f1be1002d00d1b8-->
        <insert id="DAO00024_TT_HOADON_HINHTHUCTHANHTOAN_Add" parameterClass="System.Collections.IDictionary" resultClass="System.Int64">
            insert into TT_HOADON_HINHTHUCTHANHTOAN (
            HOADON_ID
            , HINHTHUCTHANHTOAN_ID
            , TENHINHTHUCTHANHTOAN
            , GIATRITHUCTHU
            , TIENTE
            , TIENTE_ID
            , TYGIA
            , GIATRIVND
            , BENHVIEN_ID
            ) values (
            #HOADON_ID#
            , #HINHTHUCTHANHTOAN_ID#
            , #TENHINHTHUCTHANHTOAN#
            , #GIATRITHUCTHU#
            , #TIENTE#
            , #TIENTE_ID#
            , #TYGIA#
            , #GIATRIVND#
            , #BENHVIEN_ID#
            )
        </insert>
        <!--Revision:0,99dabfda77e7b198c53ec00a7cfd79ee-->
        <update id="DAO00024_TT_HOADON_HINHTHUCTHANHTOAN_Update" parameterClass="System.Collections.IDictionary">
            update TT_HOADON_HINHTHUCTHANHTOAN set
            HOADON_ID = #HOADON_ID#
            , HINHTHUCTHANHTOAN_ID = #HINHTHUCTHANHTOAN_ID#
            , TENHINHTHUCTHANHTOAN = #TENHINHTHUCTHANHTOAN#
            , GIATRITHUCTHU = #GIATRITHUCTHU#
            , TIENTE = #TIENTE#
            , TIENTE_ID = #TIENTE_ID#
            , TYGIA = #TYGIA#
            , GIATRIVND = #GIATRIVND#
            , BENHVIEN_ID = #BENHVIEN_ID#
            where
            HOADON_HTTT_ID = '$HOADON_HTTT_ID$'
        </update>
        <!--Revision:0,facea597b83310aa0eadf98cda210907-->
        <statement id="DAO00024_TT_HOADON_HINHTHUCTHANHTOAN_Delete" parameterClass="System.Collections.IDictionary" resultClass="System.Int32">
            delete from TT_HOADON_HINHTHUCTHANHTOAN
            where
            HOADON_HTTT_ID = '$HOADON_HTTT_ID$'
        </statement>
        <!--Revision:0,80d5eaa5d3bc206e507c6816a4e45d71-->
        <statement id="DAO00024_TT_HOADON_HINHTHUCTHANHTOAN_DeleteP" parameterClass="System.Collections.IDictionary" resultClass="System.Int32">
            delete from TT_HOADON_HINHTHUCTHANHTOAN
            <dynamic prepend="where">
                <isParameterPresent>
                    <isNotEmpty prepend="and" property="HOADON_HTTT_ID">
                        TT_HOADON_HINHTHUCTHANHTOAN.HOADON_HTTT_ID = '$HOADON_HTTT_ID$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="HOADON_ID">
                        TT_HOADON_HINHTHUCTHANHTOAN.HOADON_ID = '$HOADON_ID$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="HINHTHUCTHANHTOAN_ID">
                        TT_HOADON_HINHTHUCTHANHTOAN.HINHTHUCTHANHTOAN_ID = '$HINHTHUCTHANHTOAN_ID$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="TENHINHTHUCTHANHTOAN">
                        TT_HOADON_HINHTHUCTHANHTOAN.TENHINHTHUCTHANHTOAN = '$TENHINHTHUCTHANHTOAN$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="GIATRITHUCTHU">
                        TT_HOADON_HINHTHUCTHANHTOAN.GIATRITHUCTHU = '$GIATRITHUCTHU$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="TIENTE">
                        TT_HOADON_HINHTHUCTHANHTOAN.TIENTE = '$TIENTE$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="TIENTE_ID">
                        TT_HOADON_HINHTHUCTHANHTOAN.TIENTE_ID = '$TIENTE_ID$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="TYGIA">
                        TT_HOADON_HINHTHUCTHANHTOAN.TYGIA = '$TYGIA$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="GIATRIVND">
                        TT_HOADON_HINHTHUCTHANHTOAN.GIATRIVND = '$GIATRIVND$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="BENHVIEN_ID">
                        TT_HOADON_HINHTHUCTHANHTOAN.BENHVIEN_ID = '$BENHVIEN_ID$'
                    </isNotEmpty>
                </isParameterPresent>
            </dynamic>
        </statement>
        <!--Revision:0,0dd42f5abedaaa3007f1e9352cb99b43-->
        <statement id="DAO00024_TT_VIENPHI_GetList" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
            select  a.*, b.GIATRIMIENGIAM, c.TRANGTHAI, d.GIATRIMIENGIAM_BHTN, f.GIATRIMIENGIAM_THANHVIEN
            , c.HUYYEUCAU
            from
            (
            select VP.*, 'DVKhongTruyThu' as TRUYTHU
            from TT_VIENPHI VP
            <dynamic prepend="where">
                <isParameterPresent>
                    <isNotEmpty prepend="and" property="VIENPHI_ID">
                        VP.VIENPHI_ID = '$VIENPHI_ID$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="TIEPNHAN_ID">
                        VP.TIEPNHAN_ID = '$TIEPNHAN_ID$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="BENHAN_ID">
                        VP.BENHAN_ID = '$BENHAN_ID$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="REF_ID">
                        VP.REF_ID = '$REF_ID$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="REF_TABLE">
                        VP.REF_TABLE = '$REF_TABLE$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="DICHVU_ID">
                        VP.DICHVU_ID is NULL
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="DUOC_ID">
                        (DUOC_ID = '0' or DUOC_ID is NULL)
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="LOAI_CHIPHI">
                        VP.LOAI_CHIPHI = '$LOAI_CHIPHI$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="LOAIGIA_ID">
                        VP.LOAIGIA_ID = '$LOAIGIA_ID$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="SOLUONG">
                        VP.SOLUONG = '$SOLUONG$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="DONGIA_DOANHTHU">
                        VP.DONGIA_DOANHTHU = '$DONGIA_DOANHTHU$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="THANHTIEN_DOANHTHU">
                        VP.THANHTIEN_DOANHTHU = '$THANHTIEN_DOANHTHU$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="BHYT_TL">
                        VP.BHYT_TL = '$BHYT_TL$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="BHYT_DONGIA">
                        VP.BHYT_DONGIA = '$BHYT_DONGIA$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="BHYT_THANHTIEN">
                        VP.BHYT_THANHTIEN = '$BHYT_THANHTIEN$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="BHYT_DONGIA_CHITRA">
                        VP.BHYT_DONGIA_CHITRA = '$BHYT_DONGIA_CHITRA$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="BHYT_THANHTIEN_CHITRA">
                        VP.BHYT_THANHTIEN_CHITRA = '$BHYT_THANHTIEN_CHITRA$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="BENHNHAN_PHAITHANHTOAN">
                        VP.BENHNHAN_PHAITHANHTOAN = '$BENHNHAN_PHAITHANHTOAN$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="GIATRI_HOADON">
                        VP.GIATRI_HOADON = '$GIATRI_HOADON$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="GIATRI_HOADON_DATHANHTOAN">
                        VP.GIATRI_HOADON_DATHANHTOAN = '$GIATRI_HOADON_DATHANHTOAN$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="GIATRI_BIENLAI">
                        VP.GIATRI_BIENLAI = '$GIATRI_BIENLAI$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="GIATRI_BIENLAI_DATHANHTOAN">
                        VP.GIATRI_BIENLAI_DATHANHTOAN = '$GIATRI_BIENLAI_DATHANHTOAN$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="GIATRI_BENHNHAN_DATHANHTOAN">
                        VP.GIATRI_BENHNHAN_DATHANHTOAN = '$GIATRI_BENHNHAN_DATHANHTOAN$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="GIATRI_THATTHU">
                        VP.GIATRI_THATTHU = '$GIATRI_THATTHU$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="MIENGIAM_TL">
                        VP.MIENGIAM_TL = '$MIENGIAM_TL$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="MIENGIAM_GIATRI">
                        VP.MIENGIAM_GIATRI = '$MIENGIAM_GIATRI$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="NGANSACH_TL">
                        VP.NGANSACH_TL = '$NGANSACH_TL$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="NGANSACH_GIATRI">
                        VP.NGANSACH_GIATRI = '$NGANSACH_GIATRI$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="TAITRO_TL">
                        VP.TAITRO_TL = '$TAITRO_TL$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="TAITRO_GIATRI">
                        VP.TAITRO_GIATRI = '$TAITRO_GIATRI$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="BHTN_TL">
                        VP.BHTN_TL = '$BHTN_TL$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="BHTN_DONGIA">
                        VP.BHTN_DONGIA = '$BHTN_DONGIA$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="BHTN_THANHTIEN">
                        VP.BHTN_THANHTIEN = '$BHTN_THANHTIEN$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="BHTN_DONGIA_CHITRA">
                        VP.BHTN_DONGIA_CHITRA = '$BHTN_DONGIA_CHITRA$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="BHTN_THANHTIEN_CHITRA">
                        VP.BHTN_THANHTIEN_CHITRA = '$BHTN_THANHTIEN_CHITRA$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="DUOCPHEPTHUCHIEN">
                        VP.DUOCPHEPTHUCHIEN = '$DUOCPHEPTHUCHIEN$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="HUY">
                        VP.HUY = '$HUY$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="DATHANHTOAN">
                        VP.DATHANHTOAN = '$DATHANHTOAN$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="DATHUCHIEN">
                        VP.DATHUCHIEN = '$DATHUCHIEN$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="KHONGTHUTIEN">
                        VP.KHONGTHUTIEN = '$KHONGTHUTIEN$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="HOADON_ID">
                        VP.HOADON_ID = '$HOADON_ID$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="ACTIVE">
                        VP.ACTIVE = '$ACTIVE$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="BENHVIEN_ID">
                        VP.BENHVIEN_ID = '$BENHVIEN_ID$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="NGUOITAO_ID">
                        VP.NGUOITAO_ID = '$NGUOITAO_ID$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="NGAYTAO">
                        VP.NGAYTAO = '$NGAYTAO$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="NGUOICAPNHAT_ID">
                        VP.NGUOICAPNHAT_ID = '$NGUOICAPNHAT_ID$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="NGAYCAPNHAT">
                        VP.NGAYCAPNHAT = '$NGAYCAPNHAT$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="LISTDATE">
                        CONVERT(date, NGAYTAO) IN ($LISTDATE$)
                    </isNotEmpty>
                </isParameterPresent>
            </dynamic>
            )a left join
            (
            select VIENPHI_ID,
            sum(MGCT.GIATRIMIENGIAM) AS GIATRIMIENGIAM
            from TT_MIENGIAM MG INNER JOIN TT_MIENGIAM_CHITIET MGCT ON MG.MIENGIAM_ID = MGCT.MIENGIAM_ID
            where
            MG.TIEPNHAN_ID= '$TIEPNHAN_ID$'
            and MG.TINHTRANG = 1
            group by VIENPHI_ID
            )b
            on a.VIENPHI_ID = b.VIENPHI_ID
            left join
            (
            select VIENPHI_ID,
            sum(MGCT.GIATRIMIENGIAM) AS GIATRIMIENGIAM_BHTN
            from TT_MIENGIAM_BHTN MG INNER JOIN TT_MIENGIAM_CHITIET MGCT ON MG.MIENGIAM_BHTN_ID = MGCT.MIENGIAM_ID
            where
            MG.TIEPNHAN_ID= '$TIEPNHAN_ID$'
            and MGCT.REF_TABLE = 'TT_MIENGIAM_BHTN'
            and MG.TINHTRANG = 0
            group by VIENPHI_ID
            )d
            on a.VIENPHI_ID = d.VIENPHI_ID
            left join
            (
            select VIENPHI_ID,
            sum(MGCT.GIATRIMIENGIAM) AS GIATRIMIENGIAM_THANHVIEN
            from TT_MIENGIAM_THANHVIEN MG INNER JOIN TT_MIENGIAM_CHITIET MGCT ON MG.MIENGIAM_THANHVIEN_ID = MGCT.MIENGIAM_ID
            where
            MG.TIEPNHAN_ID= '$TIEPNHAN_ID$'
            and MGCT.REF_TABLE = 'TT_MIENGIAM_THANHVIEN'
            and MG.TINHTRANG = 1
            group by VIENPHI_ID
            )f
            on a.VIENPHI_ID = f.VIENPHI_ID
            left join
            (
            select DVYEUCAU_ID, TRANGTHAI, HUYYEUCAU from TT_DVYEUCAU
            <dynamic prepend="where">
                <isParameterPresent>
                    <isNotEmpty prepend="and" property="TIEPNHAN_ID">
                        TIEPNHAN_ID = '$TIEPNHAN_ID$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="HUYYEUCAU">
                        HUYYEUCAU = '$HUYYEUCAU$'
                    </isNotEmpty>
                </isParameterPresent>
            </dynamic>
            )c on c.DVYEUCAU_ID = a.REF_ID
        </statement>
        <!--Revision:0,8177cbbe8453a0abf8e3cfc4c2a6c93b-->
        <statement id="DAO00024_TT_VIENPHI_GetList_ThanhToan" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
            select  a.*, b.GIATRIMIENGIAM_BH, c.GIATRIMIENGIAM_BHTN, f.GIATRIMIENGIAM_THANHVIEN
            , g.GIATRIMIENGIAM_CTCT
            from
            (select VP.*, 'DVKhongTruyThu' as TRUYTHU, c.TRANGTHAI
            , c.DANGKY_ID, C.NOIYEUCAU_ID, C.NOITHUCHIEN_ID
            from TT_VIENPHI VP left join TT_DVYEUCAU c on c.DVYEUCAU_ID = VP.REF_ID
            <dynamic prepend="where">
                <isParameterPresent>
                    <isNotEmpty prepend="and" property="TIEPNHAN_ID">
                        VP.TIEPNHAN_ID = '$TIEPNHAN_ID$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="HUY">
                        VP.HUY = '$HUY$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="DATHANHTOAN">
                        VP.DATHANHTOAN = '$DATHANHTOAN$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="KHONGTHUTIEN">
                        VP.KHONGTHUTIEN = '$KHONGTHUTIEN$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="BENHVIEN_ID">
                        VP.BENHVIEN_ID = '$BENHVIEN_ID$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="HUYYEUCAU">
                        (c.HUYYEUCAU = '$HUYYEUCAU$' or c.HUYYEUCAU is null)
                    </isNotEmpty>
                </isParameterPresent>
            </dynamic>
            ) a
            left join(select VIENPHI_ID,
            sum(MGCT.GIATRIMIENGIAM) AS GIATRIMIENGIAM_BH
            from TT_MIENGIAM MG INNER JOIN TT_MIENGIAM_CHITIET MGCT ON MG.MIENGIAM_ID = MGCT.MIENGIAM_ID
            where
            MG.TIEPNHAN_ID= '$TIEPNHAN_ID$'
            and MGCT.REF_TABLE = 'TT_MIENGIAM'
            and MG.TINHTRANG = 1
            group by VIENPHI_ID
            )b on a.VIENPHI_ID = b.VIENPHI_ID
            left join (select VIENPHI_ID,
            sum(MGCT.GIATRIMIENGIAM) AS GIATRIMIENGIAM_BHTN
            from TT_MIENGIAM_BHTN MG INNER JOIN TT_MIENGIAM_CHITIET MGCT ON MG.MIENGIAM_BHTN_ID = MGCT.MIENGIAM_ID
            where
            MG.TIEPNHAN_ID= '$TIEPNHAN_ID$'
            and MGCT.REF_TABLE = 'TT_MIENGIAM_BHTN'
            and MG.TINHTRANG = 1
            group by VIENPHI_ID
            )c on a.VIENPHI_ID = c.VIENPHI_ID
            left join (select VIENPHI_ID,
            sum(MGCT.GIATRIMIENGIAM) AS GIATRIMIENGIAM_THANHVIEN
            from TT_MIENGIAM_THANHVIEN MG INNER JOIN TT_MIENGIAM_CHITIET MGCT ON MG.MIENGIAM_THANHVIEN_ID = MGCT.MIENGIAM_ID
            where
            MG.TIEPNHAN_ID= '$TIEPNHAN_ID$'
            and MGCT.REF_TABLE = 'TT_MIENGIAM_THANHVIEN'
            and MG.TINHTRANG = 1
            group by VIENPHI_ID
            )f on a.VIENPHI_ID = f.VIENPHI_ID
            left join(select VIENPHI_ID,
            sum(MGCT.GIATRIMIENGIAM) AS GIATRIMIENGIAM_CTCT
            from TT_MIENGIAM_CONGTY MG INNER JOIN TT_MIENGIAM_CHITIET MGCT ON MG.MIENGIAM_CONGTY_ID = MGCT.MIENGIAM_ID
            where
            MG.TIEPNHAN_ID= '$TIEPNHAN_ID$'
            and MGCT.REF_TABLE = 'TT_MIENGIAM_CONGTY'
            and MG.TINHTRANG = 1
            group by VIENPHI_ID
            )g on a.VIENPHI_ID = g.VIENPHI_ID
        </statement>
        <!--Revision:0,6c1b4072fdd99d17b78dc09e438923fd-->
        <statement id="DAO00024_TT_VIENPHI_GetList_ThanhToan_CSKH" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
            select  a.*, b.GIATRIMIENGIAM_BH, c.GIATRIMIENGIAM_BHTN, f.GIATRIMIENGIAM_THANHVIEN
            , g.GIATRIMIENGIAM_CTCT
            from
            (
            select VP.*, 'DVKhongTruyThu' as TRUYTHU, c.TRANGTHAI
            , c.DANGKY_ID
            from TT_VIENPHI VP
            left join TT_CSKH_GOI_DANGKY c on
            c.DANGKY_ID = VP.REF_ID and REF_TABLE = 'TT_CSKH_GOI_DANGKY'
            <dynamic prepend="where">
                <isParameterPresent>
                    <isNotEmpty prepend="and" property="VIENPHI_ID">
                        VP.VIENPHI_ID = '$VIENPHI_ID$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="BENHNHAN_ID">
                        VP.BENHNHAN_ID = '$BENHNHAN_ID$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="BENHAN_ID">
                        VP.BENHAN_ID = '$BENHAN_ID$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="DATHANHTOAN">
                        VP.DATHANHTOAN = '$DATHANHTOAN$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="DATHUCHIEN">
                        VP.DATHUCHIEN = '$DATHUCHIEN$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="KHONGTHUTIEN">
                        VP.KHONGTHUTIEN = '$KHONGTHUTIEN$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="LISTDATE">
                        CONVERT(date, NGAYTAO) IN ($LISTDATE$)
                    </isNotEmpty>
                </isParameterPresent>
            </dynamic>
            )a left join
            (
            select VIENPHI_ID,
            sum(MGCT.GIATRIMIENGIAM) AS GIATRIMIENGIAM_BH
            from TT_MIENGIAM MG INNER JOIN TT_MIENGIAM_CHITIET MGCT ON MG.MIENGIAM_ID = MGCT.MIENGIAM_ID
            where
            MG.TIEPNHAN_ID= '$TIEPNHAN_ID$'
            and MGCT.REF_TABLE = 'TT_MIENGIAM'
            and MG.TINHTRANG = 1
            group by VIENPHI_ID
            )b
            on a.VIENPHI_ID = b.VIENPHI_ID
            left join
            (
            select VIENPHI_ID,
            sum(MGCT.GIATRIMIENGIAM) AS GIATRIMIENGIAM_BHTN
            from TT_MIENGIAM_BHTN MG INNER JOIN TT_MIENGIAM_CHITIET MGCT ON MG.MIENGIAM_BHTN_ID = MGCT.MIENGIAM_ID
            where
            MG.TIEPNHAN_ID= '$TIEPNHAN_ID$'
            and MGCT.REF_TABLE = 'TT_MIENGIAM_BHTN'
            and MG.TINHTRANG = 1
            group by VIENPHI_ID
            )c
            on a.VIENPHI_ID = c.VIENPHI_ID
            left join
            (
            select VIENPHI_ID,
            sum(MGCT.GIATRIMIENGIAM) AS GIATRIMIENGIAM_THANHVIEN
            from TT_MIENGIAM_THANHVIEN MG INNER JOIN TT_MIENGIAM_CHITIET MGCT ON MG.MIENGIAM_THANHVIEN_ID = MGCT.MIENGIAM_ID
            where
            MG.TIEPNHAN_ID= '$TIEPNHAN_ID$'
            and MGCT.REF_TABLE = 'TT_MIENGIAM_THANHVIEN'
            and MG.TINHTRANG = 1
            group by VIENPHI_ID
            )f
            on a.VIENPHI_ID = f.VIENPHI_ID
            left join
            (
            select VIENPHI_ID,
            sum(MGCT.GIATRIMIENGIAM) AS GIATRIMIENGIAM_CTCT
            from TT_MIENGIAM_CONGTY MG INNER JOIN TT_MIENGIAM_CHITIET MGCT ON MG.MIENGIAM_CONGTY_ID = MGCT.MIENGIAM_ID
            where
            MG.TIEPNHAN_ID = '$TIEPNHAN_ID$'
            and MGCT.REF_TABLE = 'TT_MIENGIAM_CONGTY'
            and MG.TINHTRANG = 1
            group by VIENPHI_ID
            )g
            on a.VIENPHI_ID = g.VIENPHI_ID
        </statement>
        <!--Revision:0,0300419896f48fd72d8d2b0646851218-->
        <statement id="DAO00024_TT_VIENPHI_GetList_ThanhToan_TruyThu" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
            select  a.*, b.GIATRIMIENGIAM_BH, e.GIATRIMIENGIAM_BHTN
            , c.TRANGTHAI, f.GIATRIMIENGIAM_THANHVIEN , g.GIATRIMIENGIAM_CTCT
            , C.NOIYEUCAU_ID, C.NOITHUCHIEN_ID
            from
            (
            select VP.*, 'DVTruyThu' as TRUYTHU
            from TT_VIENPHI VP  left join TT_DVYEUCAU c on c.DVYEUCAU_ID = VP.REF_ID
            where VP.BENHNHAN_PHAITHANHTOAN &gt; VP.GIATRI_BENHNHAN_DATHANHTOAN
            <isParameterPresent>
                <isNotEmpty prepend="and" property="VIENPHI_ID">
                    VP.VIENPHI_ID = '$VIENPHI_ID$'
                </isNotEmpty>
                <isNotEmpty prepend="and" property="TIEPNHAN_ID">
                    VP.TIEPNHAN_ID = '$TIEPNHAN_ID$'
                </isNotEmpty>
                <isNotEmpty prepend="and" property="BENHAN_ID">
                    VP.BENHAN_ID = '$BENHAN_ID$'
                </isNotEmpty>
                <isNotEmpty prepend="and" property="DATHANHTOAN">
                    VP.DATHANHTOAN = '$DATHANHTOAN$'
                </isNotEmpty>
                <isNotEmpty prepend="and" property="DATHUCHIEN">
                    VP.DATHUCHIEN = '$DATHUCHIEN$'
                </isNotEmpty>
                <isNotEmpty prepend="and" property="KHONGTHUTIEN">
                    VP.KHONGTHUTIEN = '$KHONGTHUTIEN$'
                </isNotEmpty>
                <isNotEmpty prepend="and" property="BENHVIEN_ID">
                    VP.BENHVIEN_ID = '$BENHVIEN_ID$'
                </isNotEmpty>
                <isNotEmpty prepend="and" property="LISTDATE">
                    CONVERT(date, NGAYTAO) IN ($LISTDATE$)
                </isNotEmpty>
                <isNotEmpty prepend="and" property="HUYYEUCAU">
                    (c.HUYYEUCAU = '$HUYYEUCAU$' or c.HUYYEUCAU is null)
                </isNotEmpty>
            </isParameterPresent>
            )a left join
            (
            select VIENPHI_ID,
            sum(MGCT.GIATRIMIENGIAM) AS GIATRIMIENGIAM_BH
            from TT_MIENGIAM MG INNER JOIN TT_MIENGIAM_CHITIET MGCT ON MG.MIENGIAM_ID = MGCT.MIENGIAM_ID
            where
            MG.TIEPNHAN_ID= '$TIEPNHAN_ID$'
            and MGCT.REF_TABLE = 'TT_MIENGIAM_BHTN'
            and MG.TINHTRANG = 1
            group by VIENPHI_ID
            )b
            on a.VIENPHI_ID = b.VIENPHI_ID
            left join
            (
            select VIENPHI_ID,
            sum(MGCT.GIATRIMIENGIAM) AS GIATRIMIENGIAM_BHTN
            from TT_MIENGIAM_BHTN MG INNER JOIN TT_MIENGIAM_CHITIET MGCT ON MG.MIENGIAM_BHTN_ID = MGCT.MIENGIAM_ID
            where
            MG.TIEPNHAN_ID= '$TIEPNHAN_ID$'
            and MGCT.REF_TABLE = 'TT_MIENGIAM_BHTN'
            and MG.TINHTRANG = 1
            group by VIENPHI_ID
            )e
            on a.VIENPHI_ID = e.VIENPHI_ID
            left join
            (
            select VIENPHI_ID,
            sum(MGCT.GIATRIMIENGIAM) AS GIATRIMIENGIAM_THANHVIEN
            from TT_MIENGIAM_THANHVIEN MG INNER JOIN TT_MIENGIAM_CHITIET MGCT ON MG.MIENGIAM_THANHVIEN_ID = MGCT.MIENGIAM_ID
            where
            MG.TIEPNHAN_ID= '$TIEPNHAN_ID$'
            and MGCT.REF_TABLE = 'TT_MIENGIAM_THANHVIEN'
            and MG.TINHTRANG = 1
            group by VIENPHI_ID
            )f
            on a.VIENPHI_ID = f.VIENPHI_ID
            left join
            (
            select VIENPHI_ID,
            sum(MGCT.GIATRIMIENGIAM) AS GIATRIMIENGIAM_CTCT
            from TT_MIENGIAM_CONGTY MG INNER JOIN TT_MIENGIAM_CHITIET MGCT ON MG.MIENGIAM_CONGTY_ID = MGCT.MIENGIAM_ID
            where
            MG.TIEPNHAN_ID= '$TIEPNHAN_ID$'
            and MGCT.REF_TABLE = 'TT_MIENGIAM_CONGTY'
            and MG.TINHTRANG = 1
            group by VIENPHI_ID
            )g
            on a.VIENPHI_ID = g.VIENPHI_ID
            left join
            (
            select DVYEUCAU_ID, TRANGTHAI,NOIYEUCAU_ID, NOITHUCHIEN_ID from TT_DVYEUCAU
            <dynamic prepend="where">
                <isParameterPresent>
                    <isNotEmpty prepend="and" property="TIEPNHAN_ID">
                        TIEPNHAN_ID = '$TIEPNHAN_ID$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="HUYYEUCAU">
                        HUYYEUCAU = '$HUYYEUCAU$'
                    </isNotEmpty>
                </isParameterPresent>
            </dynamic>
            )c on c.DVYEUCAU_ID = a.REF_ID
            left join
            (
            select sum(hdct.GIATRI_BENHNHAN_DATHANHTOAN) as GIATRI_BENHNHAN_DATHANHTOAN, VIENPHI_ID from TT_HOADON hd
            left join TT_HOADON_CHITIET_NGOAITRU hdct on hdct.HOADON_ID = hd.HOADON_ID
            <dynamic prepend="where">
                <isParameterPresent>
                    <isNotEmpty prepend="and" property="TIEPNHAN_ID">
                        hd.TIEPNHAN_ID = '$TIEPNHAN_ID$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="DATHANHTOAN">
                        hd.DATHANHTOAN = '$DATHANHTOAN$'
                    </isNotEmpty>
                </isParameterPresent>
            </dynamic>
            group by hdct.VIENPHI_ID
            )d on d.VIENPHI_ID = a.VIENPHI_ID
            where a.BENHNHAN_PHAITHANHTOAN &gt; d.GIATRI_BENHNHAN_DATHANHTOAN
            and a.VIENPHI_ID = d.VIENPHI_ID
            and TIEPNHAN_ID = '$TIEPNHAN_ID$'
        </statement>
        <!--Revision:0,10e82db4cd2fb58a04eca30c7ae5b3d9-->
        <update id="DAO00024_TT_VIENPHI_Update" parameterClass="System.Collections.IDictionary">
          update TT_VIENPHI set
          TIEPNHAN_ID = #TIEPNHAN_ID#
          <!--, BENHAN_ID = #BENHAN_ID#-->
          , REF_ID = #REF_ID#
          , REF_TABLE = #REF_TABLE#
          , DICHVU_ID = #DICHVU_ID#
          , DUOC_ID = #DUOC_ID#
          , LOAI_CHIPHI = #LOAI_CHIPHI#
          , LOAIGIA_ID = #LOAIGIA_ID#
          , SOLUONG = #SOLUONG#
          , DONGIA_DOANHTHU = #DONGIA_DOANHTHU#
          , THANHTIEN_DOANHTHU = #THANHTIEN_DOANHTHU#
          , BHYT_TL = #BHYT_TL#
          , BHYT_DONGIA = #BHYT_DONGIA#
          , BHYT_THANHTIEN = #BHYT_THANHTIEN#
          , BHYT_DONGIA_CHITRA = #BHYT_DONGIA_CHITRA#
          , BHYT_THANHTIEN_CHITRA = #BHYT_THANHTIEN_CHITRA#
          , BENHNHAN_PHAITHANHTOAN = #BENHNHAN_PHAITHANHTOAN#
          , GIATRI_HOADON = #GIATRI_HOADON#
          , GIATRI_HOADON_DATHANHTOAN = #GIATRI_HOADON_DATHANHTOAN#
          , GIATRI_BIENLAI = #GIATRI_BIENLAI#
          , GIATRI_BIENLAI_DATHANHTOAN = #GIATRI_BIENLAI_DATHANHTOAN#
          , GIATRI_BENHNHAN_DATHANHTOAN = #GIATRI_BENHNHAN_DATHANHTOAN#
          , GIATRI_THATTHU = #GIATRI_THATTHU#
          , MIENGIAM_TL = #MIENGIAM_TL#
          , MIENGIAM_GIATRI = #MIENGIAM_GIATRI#
          , NGANSACH_TL = #NGANSACH_TL#
          , NGANSACH_GIATRI = #NGANSACH_GIATRI#
          , TAITRO_TL = #TAITRO_TL#
          , TAITRO_GIATRI = #TAITRO_GIATRI#
          , BHTN_TL = #BHTN_TL#
          , BHTN_DONGIA = #BHTN_DONGIA#
          , BHTN_THANHTIEN = #BHTN_THANHTIEN#
          , BHTN_DONGIA_CHITRA = #BHTN_DONGIA_CHITRA#
          , BHTN_THANHTIEN_CHITRA = #BHTN_THANHTIEN_CHITRA#
          <isNotEmpty prepend="" property="DUOCPHEPTHUCHIEN">
          , DUOCPHEPTHUCHIEN = #DUOCPHEPTHUCHIEN#
          </isNotEmpty>
          <isNotEmpty prepend="" property="HUY">
            , HUY = #HUY#
          </isNotEmpty>
          <isNotEmpty prepend="" property="DATHANHTOAN">
            , DATHANHTOAN = #DATHANHTOAN#
          </isNotEmpty>
          <isNotEmpty prepend="" property="DATHUCHIEN">
            , DATHUCHIEN = #DATHUCHIEN#
          </isNotEmpty>
          <isNotEmpty prepend="" property="KHONGTHUTIEN">
            , KHONGTHUTIEN = #KHONGTHUTIEN#
          </isNotEmpty>
          , HOADON_ID = #HOADON_ID#
          <isNotEmpty prepend="" property="ACTIVE">
          , ACTIVE = #ACTIVE#
        </isNotEmpty>
          <isPropertyAvailable prepend="" property="YEUCAUVP">
            , YEUCAUVP = #YEUCAUVP#
          </isPropertyAvailable>
          <isPropertyAvailable prepend="" property="BHYTDONGTIEN">
            , BHYTDONGTIEN = #BHYTDONGTIEN#
          </isPropertyAvailable>
          <isPropertyAvailable prepend="" property="DOITUONG_HUONG_ID">
            , DOITUONG_HUONG_ID = #DOITUONG_HUONG_ID#
          </isPropertyAvailable>
          <isPropertyAvailable prepend="" property="SOBHYT_HUONG_ID">
            , SOBHYT_HUONG_ID = #SOBHYT_HUONG_ID#
          </isPropertyAvailable>
          <isPropertyAvailable prepend="" property="BHYT_DONGIA_DONGCT_DAU">
            , BHYT_DONGIA_DONGCT_DAU = #BHYT_DONGIA_DONGCT_DAU#
          </isPropertyAvailable>
            <!--, BENHVIEN_ID = #BENHVIEN_ID#
      , NGUOITAO_ID = #NGUOITAO_ID#
      , NGAYTAO = #NGAYTAO#-->
            , NGUOICAPNHAT_ID = #NGUOICAPNHAT_ID#
            , NGAYCAPNHAT = #NGAYCAPNHAT#
            where
            VIENPHI_ID = '$VIENPHI_ID$'
        </update>
        <!--Revision:0,541f1faeef16105152f01696e2868725-->
        <update id="DAO00024_TT_VIENPHI_CSKH_Update" parameterClass="System.Collections.IDictionary">
            update TT_VIENPHI set
            KHONGTHUTIEN = #KHONGTHUTIEN#
            , NGUOICAPNHAT_ID = #NGUOICAPNHAT_ID#
            , NGAYCAPNHAT = #NGAYCAPNHAT#
            where
            VIENPHI_ID = '$VIENPHI_ID$'
        </update>
        <!--Revision:0,b80a14e9d9c7c248208af97631945b63-->
        <update id="DAO00024_TT_HOADON_Update_Status_Print" parameterClass="System.Collections.IDictionary">
          update TT_HOADON
          set
          TT_HOADON.INLAI = isNull(TT_HOADON.INLAI,0) + 1,
          TT_HOADON.INLAI_USER_ID = #INLAI_USER_ID#
          where
          TT_HOADON.SOHOADON = '$SOHOADON$'
        </update>
        <!--Revision:0,2552da6a19162813775b3a735113398a-->
        <statement id="DAO00024_TT_VIENPHI_GetList_ChuaThucHien" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
            SELECT *
            FROM TT_VIENPHI
            WHERE
            HOADON_ID = '$HOADON_ID$'
            AND DATHUCHIEN = 0
        </statement>
        <!--Revision:0,93dd79de539233cd5b5ca1d5b0e809dd-->
        <statement id="DAO00024_TT_VIENPHI_GetList_ChuaDuyetMG" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
            SELECT B.VIENPHI_ID
            FROM
            (
            SELECT * FROM TT_VIENPHI
            WHERE TIEPNHAN_ID = #TIEPNHAN_ID#
            <dynamic prepend=" and REF_ID in ">
                <iterate property="REF_ID" open="(" close=")" conjunction=",">
                    #REF_ID[]#
                </iterate>
            </dynamic>
            ) A
            INNER JOIN
            (
            SELECT VIENPHI_ID
            FROM TT_MIENGIAM MG
            INNER JOIN TT_MIENGIAM_CHITIET MGCT ON MG.MIENGIAM_ID = MGCT.MIENGIAM_ID
            WHERE
            MG.TIEPNHAN_ID= #TIEPNHAN_ID#
            AND MG.TINHTRANG = 0
            )B
            ON A.VIENPHI_ID = B.VIENPHI_ID
        </statement>
        <!--Revision:0,640bcf9fb271120e52f7cb0131906fe1-->
        <statement id="DAO00024_TT_HOADON_CHITIET_DSDichVuChuaThucHien" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
            select *
            from TT_HOADON_CHITIET_NGOAITRU
            where
            HOADON_ID = '$HOADON_ID$'
            AND TRANGTHAI = 'CHUATHUCHIEN'
        </statement>
        <!--Revision:0,4bfcda3835e2fef63e3a611272575c9a-->
        <statement id="DAO00024_TT_VIENPHI_GetList_DSDichVuChuaThuTien" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
            SELECT TOP 1 VIENPHI_ID
            FROM TT_VIENPHI
            WHERE
            DATHANHTOAN = 0
        </statement>
        <!--Revision:0,1f867f7e9a2a5bed5593568b941e6a6d-->
        <statement id="DAO00024_TT_VIENPHI_GetList_DSDichVu" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
            SELECT *
            FROM TT_VIENPHI
            WHERE HUY = 0 and HOADON_ID IS NOT NULL and DATHANHTOAN = 1
            <!--and HOADON_ID &gt; '$HOADON_ID$'-->
            <dynamic prepend=" and REF_ID in ">
                <iterate property="REF_ID" open="(" close=")" conjunction=",">
                    #REF_ID[]#
                </iterate>
            </dynamic>
        </statement>
        <!--Revision:0,5a5212b5c9bf597b9c83ffa586063d98-->
        <statement id="DAO00024_TT_HOADON_ThanhToan" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
            select HD.DATHANHTOAN, HD.HOADON_ID, VP.BENHNHAN_PHAITHANHTOAN, VP.GIATRI_BENHNHAN_DATHANHTOAN from TT_HOADON HD
            LEFT JOIN TT_HOADON_CHITIET_NGOAITRU HDCT ON HDCT.HOADON_ID = HD.HOADON_ID
            left join TT_VIENPHI VP on VP.VIENPHI_ID = HDCT.VIENPHI_ID
            where HD.HUYHOADON = '0'
            <isParameterPresent>
                <isNotEmpty prepend="and" property="DATHANHTOAN">
                    HD.DATHANHTOAN = '$DATHANHTOAN$'
                </isNotEmpty>
                <isNotEmpty prepend="and" property="TIEPNHAN_ID">
                    HD.TIEPNHAN_ID = '$TIEPNHAN_ID$'
                </isNotEmpty>
                <isNotEmpty prepend="and" property="HUYHOADON">
                    HD.HUYHOADON = '$HUYHOADON$'
                </isNotEmpty>
                <isNotEmpty prepend="and" property="HOANTRA">
                    HD.HOANTRA = '$HOANTRA$'
                </isNotEmpty>
                <isNotEmpty prepend="and" property="BENHNHAN_ID">
                    HD.BENHNHAN_ID = '$BENHNHAN_ID$'
                </isNotEmpty>
            </isParameterPresent>
            <dynamic prepend=" and HDCT.REF_ID in ">
                <iterate property="REF_ID" open="(" close=")" conjunction=",">
                    #REF_ID[]#
                </iterate>
            </dynamic>
        </statement>
        <!--Revision:0,a9d0e0f3d234fb43ac5a9404911de555-->
        <statement id="DAO00024_TT_HOADON_NOITRU_ThanhToan" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
            select HD.DATHANHTOAN
            from TT_HOADON HD
            LEFT JOIN TT_HOADON_CHITIET_NOITRU HDCT ON HDCT.HOADON_ID = HD.HOADON_ID
            left join TT_VIENPHI vp on vp.VIENPHI_ID = HDCT.VIENPHI_ID
            WHERE HD.DATHANHTOAN = '$DATHANHTOAN$' and HD.HOADON_ID &gt; '$HOADON_ID$'
            <isNotEmpty prepend="and" property="HUYHOADON">
                hd.HUYHOADON = '$HUYHOADON$'
            </isNotEmpty>
            <isNotEmpty prepend="and" property="HOANTRA">
                hd.HOANTRA = '$HOANTRA$'
            </isNotEmpty>
            <dynamic prepend=" and REF_ID in ">
                <iterate property="REF_ID" open="(" close=")" conjunction=",">
                    #REF_ID[]#
                </iterate>
            </dynamic>
        </statement>
        <!--Revision:0,f2f8afd868dfd7de3d242c097c396bfd-->
        <statement id="DAO00024_TT_HOADON_GetDetail_DUYET" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
            select  a.*, b.GIATRIMIENGIAM_BH, c.GIATRIMIENGIAM_BHTN, f.GIATRIMIENGIAM_THANHVIEN
            from
            (
            select hd.*,hdct.VIENPHI_ID,hdct.DICHVU_ID, hdct.DUOC_ID, hdct.SOLUONG, hdct.DONGIA_DOANHTHU
            , hdct.LOAIGIA_ID, hdct.BENHNHAN_PHAITHANHTOAN
            , c.TRANGTHAI as TRANGTHAI_DVYC
            from TT_HOADON hd
            left join (select * from TT_HOADON_CHITIET_NGOAITRU where HOADON_ID = '$HOADON_ID$') hdct on hdct.HOADON_ID = hd.HOADON_ID
            left join (select * from TT_DVYEUCAU where TIEPNHAN_ID = '$TIEPNHAN_ID$') c on c.DVYEUCAU_ID = hdct.REF_ID
            and hdct.DICHVU_ID is not null
            <dynamic prepend="where">
                <isParameterPresent>
                    <isNotEmpty prepend="and" property="HOADONCHITIET_ID">
                        hdct.HOADONCHITIET_ID = '$HOADONCHITIET_ID$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="HOADON_ID">
                        hdct.HOADON_ID = '$HOADON_ID$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="VIENPHI_ID">
                        hdct.VIENPHI_ID = '$VIENPHI_ID$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="REF_ID">
                        hdct.REF_ID = '$REF_ID$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="REF_TABLE">
                        hdct.REF_TABLE = '$REF_TABLE$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="DICHVU_ID">
                        hdct.DICHVU_ID = '$DICHVU_ID$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="DUOC_ID">
                        hdct.DUOC_ID = '$DUOC_ID$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="LOAI_CHIPHI">
                        hdct.LOAI_CHIPHI = '$LOAI_CHIPHI$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="LOAIGIA_ID">
                        hdct.LOAIGIA_ID = '$LOAIGIA_ID$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="SOLUONG">
                        hdct.SOLUONG = '$SOLUONG$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="DONGIA_DOANHTHU">
                        hdct.DONGIA_DOANHTHU = '$DONGIA_DOANHTHU$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="THANHTIEN_DOANHTHU">
                        hdct.THANHTIEN_DOANHTHU = '$THANHTIEN_DOANHTHU$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="BHYT_TL">
                        hdct.BHYT_TL = '$BHYT_TL$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="BHYT_DONGIA">
                        hdct.BHYT_DONGIA = '$BHYT_DONGIA$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="BHYT_THANHTIEN">
                        hdct.BHYT_THANHTIEN = '$BHYT_THANHTIEN$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="BHYT_DONGIA_CHITRA">
                        hdct.BHYT_DONGIA_CHITRA = '$BHYT_DONGIA_CHITRA$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="BHYT_THANHTIEN_CHITRA">
                        hdct.BHYT_THANHTIEN_CHITRA = '$BHYT_THANHTIEN_CHITRA$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="BENHNHAN_PHAITHANHTOAN">
                        hdct.BENHNHAN_PHAITHANHTOAN = '$BENHNHAN_PHAITHANHTOAN$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="GIATRI_HOADON">
                        hdct.GIATRI_HOADON = '$GIATRI_HOADON$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="GIATRI_HOADON_DATHANHTOAN">
                        hdct.GIATRI_HOADON_DATHANHTOAN = '$GIATRI_HOADON_DATHANHTOAN$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="GIATRI_BIENLAI">
                        hdct.GIATRI_BIENLAI = '$GIATRI_BIENLAI$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="GIATRI_BIENLAI_DATHANHTOAN">
                        hdct.GIATRI_BIENLAI_DATHANHTOAN = '$GIATRI_BIENLAI_DATHANHTOAN$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="GIATRI_BENHNHAN_DATHANHTOAN">
                        hdct.GIATRI_BENHNHAN_DATHANHTOAN = '$GIATRI_BENHNHAN_DATHANHTOAN$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="TYLE_THATTHU">
                        hdct.TYLE_THATTHU = '$TYLE_THATTHU$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="GIATRI_THATTHU">
                        hdct.GIATRI_THATTHU = '$GIATRI_THATTHU$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="MIENGIAM_TL">
                        hdct.MIENGIAM_TL = '$MIENGIAM_TL$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="MIENGIAM_GIATRI">
                        hdct.MIENGIAM_GIATRI = '$MIENGIAM_GIATRI$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="NGANSACH_TL">
                        hdct.NGANSACH_TL = '$NGANSACH_TL$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="NGANSACH_GIATRI">
                        hdct.NGANSACH_GIATRI = '$NGANSACH_GIATRI$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="TAITRO_TL">
                        hdct.TAITRO_TL = '$TAITRO_TL$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="TAITRO_GIATRI">
                        hdct.TAITRO_GIATRI = '$TAITRO_GIATRI$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="BHTN_GIATRI">
                        hdct.BHTN_GIATRI = '$BHTN_GIATRI$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="NOIDUNGTHU">
                        hdct.NOIDUNGTHU = '$NOIDUNGTHU$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="CHUNGTUXUATBN_ID">
                        hdct.CHUNGTUXUATBN_ID = '$CHUNGTUXUATBN_ID$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="TYLEVAT">
                        hdct.TYLEVAT = '$TYLEVAT$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="GIATRIVAT">
                        hdct.GIATRIVAT = '$GIATRIVAT$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="MASOTHUE">
                        hdct.MASOTHUE = '$MASOTHUE$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="SOCHUNGTUKETOAN">
                        hdct.SOCHUNGTUKETOAN = '$SOCHUNGTUKETOAN$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="DAHOANTRA">
                        hdct.DAHOANTRA = '$DAHOANTRA$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="TRANGTHAI">
                        hdct.TRANGTHAI = '$TRANGTHAI$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="PHONGBAN_ID">
                        hdct.PHONGBAN_ID = '$PHONGBAN_ID$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="PHONGBAN_THAYDOI_ID">
                        hdct.PHONGBAN_THAYDOI_ID = '$PHONGBAN_THAYDOI_ID$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="BENHVIEN_ID">
                        hdct.BENHVIEN_ID = '$BENHVIEN_ID$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="NGAYTAO">
                        hdct.NGAYTAO = '$NGAYTAO$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="NGUOITAO_ID">
                        hdct.NGUOITAO_ID = '$NGUOITAO_ID$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="NGAYCAPNHAT">
                        hdct.NGAYCAPNHAT = '$NGAYCAPNHAT$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="NGUOICAPNHAT_ID">
                        hdct.NGUOICAPNHAT_ID = '$NGUOICAPNHAT_ID$'
                    </isNotEmpty>
                </isParameterPresent>
            </dynamic>
            )
            a left join
            (
            select VIENPHI_ID,
            sum(MGCT.GIATRIMIENGIAM) AS GIATRIMIENGIAM_BH
            from TT_MIENGIAM MG INNER JOIN TT_MIENGIAM_CHITIET MGCT ON MG.MIENGIAM_ID = MGCT.MIENGIAM_ID
            where
            MG.TIEPNHAN_ID= '$TIEPNHAN_ID$'
            and MGCT.REF_TABLE = 'TT_MIENGIAM'
            and MG.TINHTRANG = 1
            group by VIENPHI_ID
            )b
            on a.VIENPHI_ID = b.VIENPHI_ID
            left join
            (
            select VIENPHI_ID,
            sum(MGCT.GIATRIMIENGIAM) AS GIATRIMIENGIAM_BHTN
            from TT_MIENGIAM_BHTN MG INNER JOIN TT_MIENGIAM_CHITIET MGCT ON MG.MIENGIAM_BHTN_ID = MGCT.MIENGIAM_ID
            where
            MG.TIEPNHAN_ID= '$TIEPNHAN_ID$'
            and MGCT.REF_TABLE = 'TT_MIENGIAM_BHTN'
            and MG.TINHTRANG = 1
            group by VIENPHI_ID
            )c
            on a.VIENPHI_ID = c.VIENPHI_ID
            left join
            (
            select VIENPHI_ID,
            sum(MGCT.GIATRIMIENGIAM) AS GIATRIMIENGIAM_THANHVIEN
            from TT_MIENGIAM_THANHVIEN MG INNER JOIN TT_MIENGIAM_CHITIET MGCT ON MG.MIENGIAM_THANHVIEN_ID = MGCT.MIENGIAM_ID
            where
            MG.TIEPNHAN_ID= '$TIEPNHAN_ID$'
            and MGCT.REF_TABLE = 'TT_MIENGIAM_THANHVIEN'
            and MG.TINHTRANG = 1
            group by VIENPHI_ID
            )f
            on a.VIENPHI_ID = f.VIENPHI_ID
            order by HOADONCHITIET_ID
        </statement>
        <!--Revision:0,a078f9111eee1e8f32a2eb5183d5e8d9-->
        <statement id="DAO00024_TT_HOADON_GetDetail_NoiTru_DUYET" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
            select  a.*, b.GIATRIMIENGIAM_BH, c.GIATRIMIENGIAM_BHTN, f.GIATRIMIENGIAM_THANHVIEN
            from
            (
            select hd.*,hdct.VIENPHI_ID,hdct.DICHVU_ID, hdct.DUOC_ID, hdct.SOLUONG, hdct.DONGIA_DOANHTHU
            , hdct.LOAIGIA_ID, hdct.BENHNHAN_PHAITHANHTOAN
            , c.TRANGTHAI as TRANGTHAI_DVYC
            from TT_HOADON hd
            left join (select * from TT_HOADON_CHITIET_NGOAITRU where HOADON_ID = '$HOADON_ID$') hdct on hdct.HOADON_ID = hd.HOADON_ID
            left join (select * from TT_DVYEUCAU where TIEPNHAN_ID = '$TIEPNHAN_ID$') c on c.DVYEUCAU_ID = hdct.REF_ID
            and hdct.DICHVU_ID is not null
            <dynamic prepend="where">
                <isParameterPresent>
                    <isNotEmpty prepend="and" property="HOADONCHITIET_ID">
                        hdct.HOADONCHITIET_ID = '$HOADONCHITIET_ID$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="HOADON_ID">
                        hdct.HOADON_ID = '$HOADON_ID$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="VIENPHI_ID">
                        hdct.VIENPHI_ID = '$VIENPHI_ID$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="REF_ID">
                        hdct.REF_ID = '$REF_ID$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="REF_TABLE">
                        hdct.REF_TABLE = '$REF_TABLE$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="DICHVU_ID">
                        hdct.DICHVU_ID = '$DICHVU_ID$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="DUOC_ID">
                        hdct.DUOC_ID = '$DUOC_ID$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="LOAI_CHIPHI">
                        hdct.LOAI_CHIPHI = '$LOAI_CHIPHI$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="LOAIGIA_ID">
                        hdct.LOAIGIA_ID = '$LOAIGIA_ID$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="SOLUONG">
                        hdct.SOLUONG = '$SOLUONG$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="DONGIA_DOANHTHU">
                        hdct.DONGIA_DOANHTHU = '$DONGIA_DOANHTHU$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="THANHTIEN_DOANHTHU">
                        hdct.THANHTIEN_DOANHTHU = '$THANHTIEN_DOANHTHU$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="BHYT_TL">
                        hdct.BHYT_TL = '$BHYT_TL$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="BHYT_DONGIA">
                        hdct.BHYT_DONGIA = '$BHYT_DONGIA$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="BHYT_THANHTIEN">
                        hdct.BHYT_THANHTIEN = '$BHYT_THANHTIEN$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="BHYT_DONGIA_CHITRA">
                        hdct.BHYT_DONGIA_CHITRA = '$BHYT_DONGIA_CHITRA$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="BHYT_THANHTIEN_CHITRA">
                        hdct.BHYT_THANHTIEN_CHITRA = '$BHYT_THANHTIEN_CHITRA$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="BENHNHAN_PHAITHANHTOAN">
                        hdct.BENHNHAN_PHAITHANHTOAN = '$BENHNHAN_PHAITHANHTOAN$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="GIATRI_HOADON">
                        hdct.GIATRI_HOADON = '$GIATRI_HOADON$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="GIATRI_HOADON_DATHANHTOAN">
                        hdct.GIATRI_HOADON_DATHANHTOAN = '$GIATRI_HOADON_DATHANHTOAN$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="GIATRI_BIENLAI">
                        hdct.GIATRI_BIENLAI = '$GIATRI_BIENLAI$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="GIATRI_BIENLAI_DATHANHTOAN">
                        hdct.GIATRI_BIENLAI_DATHANHTOAN = '$GIATRI_BIENLAI_DATHANHTOAN$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="GIATRI_BENHNHAN_DATHANHTOAN">
                        hdct.GIATRI_BENHNHAN_DATHANHTOAN = '$GIATRI_BENHNHAN_DATHANHTOAN$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="TYLE_THATTHU">
                        hdct.TYLE_THATTHU = '$TYLE_THATTHU$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="GIATRI_THATTHU">
                        hdct.GIATRI_THATTHU = '$GIATRI_THATTHU$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="MIENGIAM_TL">
                        hdct.MIENGIAM_TL = '$MIENGIAM_TL$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="MIENGIAM_GIATRI">
                        hdct.MIENGIAM_GIATRI = '$MIENGIAM_GIATRI$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="NGANSACH_TL">
                        hdct.NGANSACH_TL = '$NGANSACH_TL$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="NGANSACH_GIATRI">
                        hdct.NGANSACH_GIATRI = '$NGANSACH_GIATRI$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="TAITRO_TL">
                        hdct.TAITRO_TL = '$TAITRO_TL$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="TAITRO_GIATRI">
                        hdct.TAITRO_GIATRI = '$TAITRO_GIATRI$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="BHTN_GIATRI">
                        hdct.BHTN_GIATRI = '$BHTN_GIATRI$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="NOIDUNGTHU">
                        hdct.NOIDUNGTHU = '$NOIDUNGTHU$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="CHUNGTUXUATBN_ID">
                        hdct.CHUNGTUXUATBN_ID = '$CHUNGTUXUATBN_ID$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="TYLEVAT">
                        hdct.TYLEVAT = '$TYLEVAT$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="GIATRIVAT">
                        hdct.GIATRIVAT = '$GIATRIVAT$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="MASOTHUE">
                        hdct.MASOTHUE = '$MASOTHUE$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="SOCHUNGTUKETOAN">
                        hdct.SOCHUNGTUKETOAN = '$SOCHUNGTUKETOAN$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="DAHOANTRA">
                        hdct.DAHOANTRA = '$DAHOANTRA$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="TRANGTHAI">
                        hdct.TRANGTHAI = '$TRANGTHAI$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="PHONGBAN_ID">
                        hdct.PHONGBAN_ID = '$PHONGBAN_ID$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="PHONGBAN_THAYDOI_ID">
                        hdct.PHONGBAN_THAYDOI_ID = '$PHONGBAN_THAYDOI_ID$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="BENHVIEN_ID">
                        hdct.BENHVIEN_ID = '$BENHVIEN_ID$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="NGAYTAO">
                        hdct.NGAYTAO = '$NGAYTAO$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="NGUOITAO_ID">
                        hdct.NGUOITAO_ID = '$NGUOITAO_ID$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="NGAYCAPNHAT">
                        hdct.NGAYCAPNHAT = '$NGAYCAPNHAT$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="NGUOICAPNHAT_ID">
                        hdct.NGUOICAPNHAT_ID = '$NGUOICAPNHAT_ID$'
                    </isNotEmpty>
                </isParameterPresent>
            </dynamic>
            )
            a left join
            (
            select VIENPHI_ID,
            sum(MGCT.GIATRIMIENGIAM) AS GIATRIMIENGIAM_BH
            from TT_MIENGIAM MG INNER JOIN TT_MIENGIAM_CHITIET MGCT ON MG.MIENGIAM_ID = MGCT.MIENGIAM_ID
            where
            MG.TIEPNHAN_ID= '$TIEPNHAN_ID$'
            and MGCT.REF_TABLE = 'TT_MIENGIAM'
            and MG.TINHTRANG = 1
            group by VIENPHI_ID
            )b
            on a.VIENPHI_ID = b.VIENPHI_ID
            left join
            (
            select VIENPHI_ID,
            sum(MGCT.GIATRIMIENGIAM) AS GIATRIMIENGIAM_BHTN
            from TT_MIENGIAM_BHTN MG INNER JOIN TT_MIENGIAM_CHITIET MGCT ON MG.MIENGIAM_BHTN_ID = MGCT.MIENGIAM_ID
            where
            MG.TIEPNHAN_ID= '$TIEPNHAN_ID$'
            and MGCT.REF_TABLE = 'TT_MIENGIAM_BHTN'
            and MG.TINHTRANG = 1
            group by VIENPHI_ID
            )c
            on a.VIENPHI_ID = c.VIENPHI_ID
            left join
            (
            select VIENPHI_ID,
            sum(MGCT.GIATRIMIENGIAM) AS GIATRIMIENGIAM_THANHVIEN
            from TT_MIENGIAM_THANHVIEN MG INNER JOIN TT_MIENGIAM_CHITIET MGCT ON MG.MIENGIAM_THANHVIEN_ID = MGCT.MIENGIAM_ID
            where
            MG.TIEPNHAN_ID= '$TIEPNHAN_ID$'
            and MGCT.REF_TABLE = 'TT_MIENGIAM_THANHVIEN'
            and MG.TINHTRANG = 1
            group by VIENPHI_ID
            )f
            on a.VIENPHI_ID = f.VIENPHI_ID
        </statement>
        <!--Revision:0,cb7af35ed396e04c17d924614a2ec3fb-->
        <statement id="DAO00024_TT_HOADON_Update_Transaction" parameterClass="System.Collections.IDictionary">
            SET TRANSACTION ISOLATION LEVEL READ COMMITTED;
            if(select count(*)
            from tt_vienphi
            where vienphi_id in ($LIST_VIENPHI$)
            and (DATHANHTOAN = 0 or (Dathanhtoan = 1 and GIATRI_BENHNHAN_DATHANHTOAN &lt; BENHNHAN_PHAITHANHTOAN))
            ) = $SL$
            BEGIN
            BEGIN TRY
            BEGIN TRANSACTION
            UPDATE TT_VIENPHI
            SET Dathanhtoan = '1', GIATRI_BENHNHAN_DATHANHTOAN = BENHNHAN_PHAITHANHTOAN
            WHERE vienphi_id IN ($LIST_VIENPHI$)
            SELECT 1 as result
            COMMIT TRANSACTION
            END TRY
            BEGIN CATCH
            IF @@TRANCOUNT &gt; 0
            ROLLBACK TRANSACTION
            SELECT -1 as result
            END CATCH
            END
            ELSE
            SELECT 0 AS RESULT
        </statement>
        <!--Revision:0-->
        <statement id="DAO00024_TT_HOADON_Huy_Transaction" parameterClass="System.Collections.IDictionary">
            SET TRANSACTION ISOLATION LEVEL READ COMMITTED;
            if(select distinct huy
            from tt_vienphi
            where hoadon_id = $HOADON_ID$) = 0
            BEGIN
            BEGIN TRY
            BEGIN TRANSACTION
            UPDATE TT_VIENPHI
            SET Huy = '1'
            WHERE hoadon_id = $HOADON_ID$
            SELECT 1 as result
            COMMIT TRANSACTION
            END TRY
            BEGIN CATCH
            IF @@TRANCOUNT &gt; 0
            ROLLBACK TRANSACTION
            SELECT -1 as result
            END CATCH
            END
            ELSE
            SELECT 0 AS RESULT
        </statement>
        <!--Revision:0-->
        <statement id="DAO00024_TT_HOADON_TamUng_Huy_Transaction" parameterClass="System.Collections.IDictionary">
            SET TRANSACTION ISOLATION LEVEL READ COMMITTED;
            if(select HUYHOADON
            from TT_HOADON
            where hoadon_id = $HOADON_ID$) = 0
            BEGIN
            BEGIN TRY
            BEGIN TRANSACTION
            UPDATE TT_HOADON
            SET HUYHOADON = '1'
            WHERE hoadon_id = $HOADON_ID$
            SELECT 1 as result
            COMMIT TRANSACTION
            END TRY
            BEGIN CATCH
            IF @@TRANCOUNT &gt; 0
            ROLLBACK TRANSACTION
            SELECT -1 as result
            END CATCH
            END
            ELSE
            SELECT 0 AS RESULT
        </statement>
        <!--Revision:0,cdbade46c7df27ef1d0a2b26caa0dc79-->
        <statement id="DAO00024_TT_HOADON_Huy_TamUng" parameterClass="System.Collections.IDictionary">
            UPDATE TT_HOADON
            SET TRANGTHAI = 'DAHOANUNG'
            WHERE HOADON_ID IN ($LIST_HOADON$)
        </statement>
        <!--Revision:0-->
        <statement id="DAO00024_TT_HOADON_HoanUng_Transaction" parameterClass="System.Collections.IDictionary">
            SET TRANSACTION ISOLATION LEVEL READ COMMITTED;
            declare @HU int
            select @HU = count(*)
            from TT_HOADON A
            where hoadon_id in ($LIST_HOADON$)
            and (TRANGTHAI = 'DAHOANUNG')
            if @HU = 0
            BEGIN
            BEGIN TRY
            BEGIN TRANSACTION
            UPDATE TT_HOADON
            SET TRANGTHAI = 'DAHOANUNG'
            WHERE HOADON_ID IN ($LIST_HOADON$)
            SELECT 1 as result
            COMMIT TRANSACTION
            END TRY
            BEGIN CATCH
            IF @@TRANCOUNT &gt; 0
            ROLLBACK TRANSACTION
            SELECT -1 as result
            END CATCH
            END
            ELSE if @HU = '$SL$'
            SELECT 2 AS RESULT
            else
            select 0 as RESULT
        </statement>
        <!--Revision:0-->
        <statement id="DAO00024_TT_HOADON_HoanTra_Transaction" parameterClass="System.Collections.IDictionary">
            SET TRANSACTION ISOLATION LEVEL READ COMMITTED;
            if(select distinct Huy
            from tt_vienphi
            where hoadon_id = $HOADON_ID$) = 0
            BEGIN
            BEGIN TRY
            BEGIN TRANSACTION
            UPDATE TT_VIENPHI
            SET Huy = '1'
            WHERE hoadon_id = $HOADON_ID$
            SELECT 1 as result
            COMMIT TRANSACTION
            END TRY
            BEGIN CATCH
            IF @@TRANCOUNT &gt; 0
            ROLLBACK TRANSACTION
            SELECT -1 as result
            END CATCH
            END
            ELSE
            SELECT 0 AS RESULT
        </statement>
        <!--Revision:0-->
        <statement id="DAO00024_TT_HOADON_TamUng_HoanTra_Transaction" parameterClass="System.Collections.IDictionary">
            SET TRANSACTION ISOLATION LEVEL READ COMMITTED;
            if(select HOANTRA
            from TT_HOADON
            where hoadon_id = $HOADON_ID$) = 0
            BEGIN
            BEGIN TRY
            BEGIN TRANSACTION
            UPDATE TT_HOADON
            SET HOANTRA = '1'
            WHERE hoadon_id = $HOADON_ID$
            SELECT 1 as result
            COMMIT TRANSACTION
            END TRY
            BEGIN CATCH
            IF @@TRANCOUNT &gt; 0
            ROLLBACK TRANSACTION
            SELECT -1 as result
            END CATCH
            END
            ELSE
            SELECT 0 AS RESULT
        </statement>
        <!--Revision:0-->
        <statement id="DAO00024_BienLai_Huy_Transaction" parameterClass="System.Collections.IDictionary">
            SET TRANSACTION ISOLATION LEVEL READ COMMITTED;
            if(select count(*)
            from tt_vienphi
            where hoadon_id in ($LIST_BIENLAI$)
            and Huy = 1) = 0
            BEGIN
            BEGIN TRY
            BEGIN TRANSACTION
            UPDATE TT_VIENPHI
            SET Huy = '1'
            WHERE hoadon_id in ($LIST_BIENLAI$)
            SELECT 1 as result
            COMMIT TRANSACTION
            END TRY
            BEGIN CATCH
            IF @@TRANCOUNT &gt; 0
            ROLLBACK TRANSACTION
            SELECT -1 as result
            END CATCH
            END
            ELSE
            SELECT 0 AS RESULT
        </statement>
        <!--Revision:0,740cc455e48b630db0b1e0ff78fd88c9-->
        <statement id="DAO00024_TT_VIENPHI_LayDichVuTuToaThuocNgoaiTru" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
            select distinct DICHVU_ID, DVYEUCAU_ID from TT_DVYEUCAU where KHAMBENH_NGOAITRU_ID in
            (select KHAMBENH_ID from TT_NGOAITRU_TOATHUOC
            where TOATHUOC_ID = '$REF_ID$')
        </statement>
      <statement id="DAO00024_TM_TIEPNHAN_BANGGIA_DICHVU_getlist" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
        select * from TM_TIEPNHAN_BANGGIA_DICHVU where TAMNGUNG != '1' and BENHVIEN_ID = '$BENHVIEN_ID$'
      </statement>
      <statement id="DAO00024_TT_TIEPNHAN_getngaytiepnhan" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
        select BANGGIA_ID
        from TM_TIEPNHAN_BANGGIA_DICHVU
        where NGAYTIEPNHAN >= (select NGAYTIEPNHAN from TT_TIEPNHAN where TIEPNHAN_ID = '$TIEPNHAN_ID$' and BENHVIEN_ID = '$BENHVIEN_ID$')
        and TAMNGUNG != '1' and BENHVIEN_ID = '$BENHVIEN_ID$'
      </statement>
      <statement id="DAO00024_TM_DUOC_PHAMVISD_MAPPINGU_getlist" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
        select top 1 * from TM_DUOC_PHAMVISD_MAPPING
        where PHAMVI_ID = '$PHAMVI_ID$'
      </statement>
      <!--Revision:0-->
      <statement id="DAO00024_HoaDon_BHYT_ChiTra" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
        select VIENPHI_ID, vp.DICHVU_ID, vp.BENHNHAN_ID, NGAYGIOYEUCAU, VP.LOAIGIA_ID, MALOAIGIA
        from TT_DVYEUCAU yc inner join TT_VIENPHI vp on yc.DVYEUCAU_ID = REF_ID and REF_TABLE = 'TT_DVYEUCAU'
        INNER JOIN TM_LOAIGIA LG ON LG.LOAIGIA_ID = VP.LOAIGIA_ID
        where BHYT_DONGIA_CHITRA > 0
        and vp.BENHVIEN_ID = '$BENHVIEN_ID$' and vp.BENHNHAN_ID = #BENHNHAN_ID# and vp.DICHVU_ID = #DICHVU_ID#
      </statement>
      <statement id="DAO00024_GetListSoBienLai_TheoLoaiBL" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
        select
        BLCT.BIENLAICHITIET_ID
        ,BL.BIENLAI_ID
        ,BL.LOAIBIENLAI_ID
        ,BL.LOAIBIENLAI
        ,BL.NGAYPHATHANH
        ,BL.THOIGIANPHATHANH
        ,BL.KYHIEU
        ,BL.SERIES
        ,BL.KYHIEU + '/' + SERIES AS 'KYHIEU_SOQUYEN'
        ,BL.MIN_NUMBER
        ,BL.MAX_NUMBER
        ,BLCT.START_NUMBER
        ,BLCT.CURRENT_NUMBER
        ,BLCT.HIEULUC
        ,BLCT.NGUOISUDUNG_ID
        from TT_BIENLAICHITIET BLCT
        left join TT_BIENLAI BL on BL.BIENLAI_ID = BLCT.BIENLAI_ID
        where
        (bl.MAX_NUMBER > (select MAX(CURRENT_NUMBER) from TT_BIENLAICHITIET where BIENLAI_ID = BLCT.BIENLAI_ID) or BLCT.CURRENT_NUMBER is null)
        and BLCT.HIEULUC = 1
        and BLCT.NGUOISUDUNG_ID =  #NGUOISUDUNG_ID#
        and BL.BENHVIEN_ID = #BENHVIEN_ID#
        and BL.LOAIBIENLAI = #LOAIBIENLAI#
        order by BLCT.THOIGIANSUDUNG DESC
      </statement>
      <statement id="DAO00024_Insert_TT_VIENPHI_CAPNHAT" parameterClass="System.Collections.IDictionary">
        insert into TT_VIENPHI_CAPNHAT
        (TIEPNHAN_ID
        <isNotEmpty prepend="," property="BENHAN_ID">
          BENHAN_ID
        </isNotEmpty>
        ,VIENPHI_ID
        ,DONGIA_DOANHTHU
        ,BHYT_DONGIA
        ,NGAYCAPNHAT
        ,NGUOICAPNHAT_ID
        ,BENHVIEN_ID)
        values
        (#TIEPNHAN_ID#
        <isNotEmpty prepend="," property="BENHAN_ID">
          #BENHAN_ID#
        </isNotEmpty>
        ,#VIENPHI_ID#
        ,#DONGIA_DOANHTHU#
        ,#BHYT_DONGIA#
        ,GETDATE()
        ,#NGUOICAPNHAT_ID#
        ,#BENHVIEN_ID#)
      </statement>
      <statement id="DAO00024_TT_VIENPHI_Thanhtoan_Json" parameterClass="System.Collections.IDictionary">
        declare @jsonVienPhi nvarchar(max) = N'$JSON_DATA$';
        update TT_VIENPHI
        set DATHANHTOAN = '1'
        , DUOCPHEPTHUCHIEN = '1'
        , HUY = '0'
        , ACTIVE = '1'
        , TT_VIENPHI.GIATRI_BENHNHAN_DATHANHTOAN = TT_VIENPHI.GIATRI_BENHNHAN_DATHANHTOAN + json.GIATRI_BENHNHAN_DATHANHTOAN
        , TT_VIENPHI.GIATRI_HOADON_DATHANHTOAN = TT_VIENPHI.GIATRI_HOADON_DATHANHTOAN + json.GIATRI_HOADON_DATHANHTOAN
        , TT_VIENPHI.GIATRI_BIENLAI_DATHANHTOAN = TT_VIENPHI.GIATRI_BIENLAI_DATHANHTOAN + json.GIATRI_BIENLAI_DATHANHTOAN
        , HOADON_ID = json.HOADON_ID
        FROM OPENJSON (@jsonVienPhi)
        WITH (
        VIENPHI_ID int,
        HOADON_ID int,
        GIATRI_HOADON_DATHANHTOAN numeric(25, 4),
        GIATRI_BIENLAI_DATHANHTOAN numeric(25, 4),
        GIATRI_BENHNHAN_DATHANHTOAN numeric(25, 4))  json
        WHERE TT_VIENPHI.VIENPHI_ID = json.VIENPHI_ID
      </statement>
    </statements>
</sqlMap>
