<?xml version="1.0" encoding="utf-8" ?>
<!--============================================================================
//	CAUTION: This file is generated by IBatisNetGen.3.SQLMap.cst at 11/11/2015 9:30:18 AM
//				Any manual editing will be lost in re-generation.
//===========================================================================-->
<sqlMap namespace="eHospital" xmlns="http://ibatis.apache.org/mapping" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">

  <statements>

    <statement id="DAO00016_GetKhoDuoc_IDByMaKho" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
      select KHODUOC_ID
      from TM_KHODUOC
      where MAKHO  = '$MAKHO$'
    </statement>

    <statement id="DAO00016_GetAll" resultClass="DataObject">
      select D.*, SDK.SODANGKY_VISA AS SOVISA
      from TM_DUOC D left join TM_DUOC_SODANGKY SDK on (D.DUOC_ID = SDK.DUOC_ID AND HIEULUC = '1')
      order by DUOC_ID
    </statement>
    
    <statement id="DAO00016_GetList" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
      select TM_LOAIDUOC.MALOAIDUOC, TM_DUOC.*, TM_TENDUOC.TENDUOC, TM_TENDUOC.TENDUOC_EN, TM_TENDUOC.TENDUOC_RU, TM_TENDUOC.MAQUOCTE, TM_TENDUOC.MAQUOCTEBT,
      TM_LOAIDUOC.LOAIVATTU_ID,TM_LOAIVATTU.TENLOAIVATTU
      from TM_DUOC
      left join TM_TENDUOC on TM_DUOC.TENDUOC_ID = TM_TENDUOC.TENDUOC_ID and TM_TENDUOC.BENHVIEN_ID = '$BENHVIEN_ID$'
      left join TM_LOAIDUOC on TM_LOAIDUOC.LOAIDUOC_ID = TM_DUOC.LOAIDUOC_ID and TM_LOAIDUOC.BENHVIEN_ID = '$BENHVIEN_ID$'
      left join TM_LOAIVATTU on TM_LOAIDUOC.LOAIVATTU_ID=TM_LOAIVATTU.LOAIVATTU_ID and TM_LOAIVATTU.BENHVIEN_ID = '$BENHVIEN_ID$'
      where
      TM_DUOC.BENHVIEN_ID = '$BENHVIEN_ID$'
      <!--and TM_DUOC.TAMNGUNG = '0'-->
      <isParameterPresent>
        <isNotEmpty prepend="and" property="DUOC_ID">
          TM_DUOC.DUOC_ID = '$DUOC_ID$'
        </isNotEmpty>
        <isNotEmpty prepend="and" property="MADUOC">
          TM_DUOC.MADUOC = '$MADUOC$'
        </isNotEmpty>
        <isNotEmpty prepend="and" property="TENDUOC_ID">
          TM_DUOC.TENDUOC_ID = '$TENDUOC_ID$'
        </isNotEmpty>
        <isNotEmpty prepend="and" property="DONVITINH_ID">
          TM_DUOC.DONVITINH_ID = '$DONVITINH_ID$'
        </isNotEmpty>
        
        <isNotEmpty prepend="and" property="QUOCGIA_ID">
          TM_DUOC.QUOCGIA_ID = '$QUOCGIA_ID$'
        </isNotEmpty>
        <isNotEmpty prepend="and" property="HANGSANXUAT_ID">
          TM_DUOC.HANGSANXUAT_ID = '$HANGSANXUAT_ID$'
        </isNotEmpty>
        <isNotEmpty prepend="and" property="LOAIDUOC_ID">
          TM_DUOC.LOAIDUOC_ID = '$LOAIDUOC_ID$'
        </isNotEmpty>
        <isNotEmpty prepend="and" property="PHANNHOMDUOC_ID">
          TM_DUOC.PHANNHOMDUOC_ID = '$PHANNHOMDUOC_ID$'
        </isNotEmpty>
        <isNotEmpty prepend="and" property="PHANLOAIDUOC">
          TM_DUOC.PHANLOAIDUOC = '$PHANLOAIDUOC$'
        </isNotEmpty>
        <isNotEmpty prepend="and" property="DUONGDUNG_ID">
          TM_DUOC.DUONGDUNG_ID = '$DUONGDUNG_ID$'
        </isNotEmpty>
        <isNotEmpty prepend="and" property="BHYT">
          TM_DUOC.BHYT = '$BHYT$'
        </isNotEmpty>
        <isNotEmpty prepend="and" property="QUANTAMDACBIET">
          TM_DUOC.QUANTAMDACBIET = '$QUANTAMDACBIET$'
        </isNotEmpty>
        
        <isNotEmpty prepend="and" property="TAMNGUNG">
          TM_DUOC.TAMNGUNG = '$TAMNGUNG$'
        </isNotEmpty>
        
        
        <isNotEmpty prepend="and" property="SOTHAMCHIEU">
          TM_DUOC.SOTHAMCHIEU = '$SOTHAMCHIEU$'
        </isNotEmpty>
        <isNotEmpty prepend="and" property="TAMNGUNGDUTRU">
          TM_DUOC.TAMNGUNGDUTRU = '$TAMNGUNGDUTRU$'
        </isNotEmpty>
        
        <isNotEmpty prepend="and" property="TENDUOCDAYDU">
          TM_DUOC.TENDUOCDAYDU = '$TENDUOCDAYDU$'
        </isNotEmpty>
        <isNotEmpty prepend="and" property="AUTOCOMPLETEFIELD">
          TM_DUOC.AUTOCOMPLETEFIELD = '$AUTOCOMPLETEFIELD$'
        </isNotEmpty>
        
        <isNotEmpty prepend="and" property="HOATCHAT_ID">
          TM_DUOC.HOATCHAT_ID = '$HOATCHAT_ID$'
        </isNotEmpty>
        <isNotEmpty prepend="and" property="MADUOC_1">
          TM_DUOC.MADUOC_1 = '$MADUOC_1$'
        </isNotEmpty>
        <isNotEmpty prepend="and" property="MADUOC_2">
          TM_DUOC.MADUOC_2 = '$MADUOC_2$'
        </isNotEmpty>
        
        <isNotEmpty prepend="and" property="KHOQUANLY_ID">
          TM_DUOC.KHOQUANLY_ID = '$KHOQUANLY_ID$'
        </isNotEmpty>
        
        <isNotEmpty prepend="and" property="QUICACH_ID">
          TM_DUOC.QUICACH_ID = '$QUICACH_ID$'
        </isNotEmpty>
        
        <isNotEmpty prepend="and" property="LOAIVATTU_ID">
          TM_LOAIDUOC.LOAIVATTU_ID = '$LOAIVATTU_ID$'
        </isNotEmpty>
      </isParameterPresent>
      order by DUOC_ID
    </statement>
    
    <statement id="DAO00016_GetDetail" parameterClass="System.String" resultClass="DataObject">
      select *
      from TM_DUOC
      where TM_DUOC.DUOC_ID  = '$value$'
      order by DUOC_ID
    </statement>
    <statement id="DAO00016_GetDetailP" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
      select *
      from TM_DUOC
      where TM_DUOC.DUOC_ID  = '$DUOC_ID$'
      order by DUOC_ID
    </statement>
    <statement id="DAO00016_GetMedicineInfo" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
      select TENHOATCHAT, DONVITINH, TENDUOCDAYDU, DONGIA
      from TM_DUOC
      left join TM_DUOC_DONGIA
      on [TM_DUOC].DUOC_ID = [TM_DUOC_DONGIA].DUOC_ID
      where [TM_DUOC].DUOC_ID  = '$DUOC_ID$'
      order by [TM_DUOC].DUOC_ID
    </statement>
    <statement id="DAO00016_CheckThuocUngThu" parameterClass="System.String" resultClass="System.Int32">
      <!--select count(*)
      from TM_DOITUONG_GIADUOC_TYLE
      where TM_DOITUONG_GIADUOC_TYLE.DUOC_ID  = '$value$'-->
      SELECT count(*)
      from TM_DOITUONG_GIADUOC_TYLE
      WHERE DOITUONG_ID = '$DOITUONG_ID$'
      AND DUOC_ID = '$DUOC_ID$'
      AND BENHVIEN_ID = '$BENHVIEN_ID$'
    </statement>
    
    <statement id="DAO00016_GetDuocRutGon" resultClass="DataObject">
      select [DUOC_ID], [MADUOC], [TENDUOCDAYDU]
      from TM_DUOC where BENHVIEN_ID = '$BENHVIEN_ID$' ;
    </statement>

    <statement id="DAO00016_GetTTinTuongTacThuoc" resultClass="DataObject">
      select s.LEVELSEVERITY_NAME, s.LEVELSEVERITY_CODE, s.DESCRIPTION as LEVELDESCRIPTION,
      d.LEVELDOCUMENT_NAME, d.LEVELDOCUMENT_CODE, d.DESCRIPTION as DOCUMENTDESCRIPTION, i.*
      from TM_DUOC_INTERACTIONDETAIL i
      left join TM_DUOC_LEVELSEVERITY s
      on i.LEVELSEVERITY_ID = s.LEVELSEVERITY_ID
      and i.BENHVIEN_ID = s.BENHVIEN_ID
      left join TM_DUOC_LEVELDOCUMENT d
      on i.LEVELDOCUMENT_ID = d.LEVELDOCUMENT_ID
      and i.BENHVIEN_ID = d.BENHVIEN_ID

      where ((HOATCHAT_FIRST_ID = $HOATCHAT_FIRST_ID$ and HOATCHAT_SECOND_ID = $HOATCHAT_SECOND_ID$)
      or (HOATCHAT_FIRST_ID = $HOATCHAT_SECOND_ID$ and HOATCHAT_SECOND_ID = $HOATCHAT_FIRST_ID$))
      and i.BENHVIEN_ID = '$BENHVIEN_ID$'
    </statement>

    <statement id="DAO00016_CheckThuocTrung" resultClass="DataObject">
      declare @date date=getdate()
      select N'Người bệnh có thuốc ' + TENDUOCDAYDU + N' sử dụng đến ngày ' + CONVERT(char(10), DATEADD(DAY, SONGAY, nttt.NGAYTAO),103) as THUOCTRUNG
      from TT_BENHNHAN bn
      left join TT_NGOAITRU_KHAMBENH ntkb on bn.BENHNHAN_ID=ntkb.BENHNHAN_ID
      left join TT_NGOAITRU_KHAMBENH_TOATHUOC kbtt on kbtt.KHAMBENH_ID = ntkb.KHAMBENH_ID
      left join TT_NGOAITRU_TOATHUOC nttt on ntkb.KHAMBENH_ID=nttt.KHAMBENH_ID
      left join TM_DUOC d on nttt.DUOC_ID=d.DUOC_ID
      where SONGAY is not null and DATEADD(DAY, SONGAY, CONVERT(date, ntkb.NGAYKHAM)) > @date
      and MAYTE='$MAYTE$' and nttt.DUOC_ID=$DUOC_ID$ and bn.BENHVIEN_ID='$BENHVIEN_ID$' and kbtt.LOAITOATHUOC = '$LOAITOATHUOC$'
      union
      select N'Người bệnh có thuốc ' + TENDUOCDAYDU + N' sử dụng đến ngày ' + CONVERT(char(10), DATEADD(DAY, SONGAY, nttt.NGAYTAO),103) as THUOCTRUNG
      from TT_BENHNHAN bn
      left join TT_NOITRU_TOATHUOC nttt on bn.BENHNHAN_ID=nttt.BENHNHAN_ID
      left join TM_DUOC d on nttt.DUOC_ID=d.DUOC_ID
      left join TT_NOITRU_BENHAN ntba on bn.BENHNHAN_ID=ntba.BENHNHAN_ID
      left join TT_NOITRU_KHAMBENH ntkb on ntba.BENHAN_ID=ntkb.BENHAN_ID
      where SONGAY is not null and ntkb.RAVIEN=1 and DATEADD(DAY, SONGAY, CONVERT(date, ntkb.NGAYKHAM)) > @date
      and MAYTE='$MAYTE$' and nttt.DUOC_ID=$DUOC_ID$ and bn.BENHVIEN_ID='$BENHVIEN_ID$'
    </statement>

    <statement id="DAO00016_GetTTDuocCanhBao" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
      select *
      from TM_DUOC_CANHBAO
      <dynamic prepend="where">
        <isParameterPresent>
          <isNotEmpty prepend="and" property="DUOC_ID">
            DUOC_ID = '$DUOC_ID$'
          </isNotEmpty>
          <isNotEmpty prepend="and" property="THANGSINH">
            '$THANGSINH$' not between TUTHANG and DENTHANG
          </isNotEmpty>
          <isNotEmpty prepend="and" property="NAMSINH">
            '$NAMSINH$' not between TUNAMSINH and DENNAMSINH
          </isNotEmpty>
          <isNotEmpty prepend="and" property="NGAYSINH">
            '$NGAYSINH$' not between TUNGAYSINH and DENNGAYSINH
          </isNotEmpty>
          <isNotEmpty prepend="and" property="CANNANG">
            '$CANNANG$' not between CANNANGTU and CANNANGDEN
          </isNotEmpty>
          <isNotEmpty prepend="and" property="SOLUONG_NGAY">
            '$SOLUONG_NGAY$' not between SOLUONG_NGAYTU and SOLUONG_NGAYDEN
          </isNotEmpty>
          <isNotEmpty prepend="and" property="VIEN">
            VIEN > '$VIEN$'
          </isNotEmpty>
          <isNotEmpty prepend="and" property="BENHVIEN_ID">
            BENHVIEN_ID = '$BENHVIEN_ID$'
          </isNotEmpty>
        </isParameterPresent>
      </dynamic>
      order by DUOC_CANHBAO_ID
    </statement>

    <statement id="DAO00016_GetKhoDuocByDoiTuong" resultClass="DataObject">
      select *
      from TM_DOITUONG_KHODUOC
      where BENHVIEN_ID = '$BENHVIEN_ID$'
      and DOITUONG_ID = '$DOITUONG_ID$'
      and NGAYTRONGTUAN = '$NGAYTRONGTUAN$'
    </statement>

    <statement id="DAO00016_GetDSThuocByTiepNhan" resultClass="DataObject">
      select *
      from TT_NGOAITRU_TOATHUOC
      where BENHVIEN_ID = '$BENHVIEN_ID$'
      and exists (select KHAMBENH_ID from TT_NGOAITRU_KHAMBENH where TT_NGOAITRU_TOATHUOC.KHAMBENH_ID = KHAMBENH_ID and TIEPNHAN_ID = '$TIEPNHAN_ID$')
    </statement>

    <statement id="DAO00016_GetDSThuocDaDungByTiepNhan" resultClass="DataObject">
      select *, dc.TENDUOCDAYDU
      from TT_NGOAITRU_TOATHUOC A
      left join TM_DUOC dc on A.DUOC_ID = dc.DUOC_ID
      where exists (select KHAMBENH_ID from TT_NGOAITRU_KHAMBENH where A.KHAMBENH_ID = KHAMBENH_ID and  TIEPNHAN_ID = '$TIEPNHAN_ID$')
      and exists (select KHAMBENH_TOATHUOC_ID from TT_NGOAITRU_KHAMBENH_TOATHUOC where A.KHAMBENH_TOATHUOC_ID = KHAMBENH_TOATHUOC_ID and CHUNGTUPHATTHUOC_ID is not null)
      and A.BENHVIEN_ID = '$BENHVIEN_ID$'
    </statement>

    <statement id="DAO00016_GetDSThuocDVKhac" resultClass="DataObject">
      select *
      from TT_NGOAITRU_TOATHUOC
      where BENHVIEN_ID = '$BENHVIEN_ID$'
      and exists (select KHAMBENH_ID from TT_NGOAITRU_KHAMBENH
      where TIEPNHAN_ID = '$TIEPNHAN_ID$'
      and KHAMBENH_ID != '$KHAMBENH_ID$' and TT_NGOAITRU_TOATHUOC.KHAMBENH_ID = KHAMBENH_ID)
    </statement>

  </statements>
</sqlMap>
