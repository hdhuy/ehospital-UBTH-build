--------------------------------------------------------------------------------
2019-10-31 09:59:31,539 [1] DEBUG - Statement Id: [DAO00001_DBList] PreparedStatement : [select *              from TM_SYS_SERVER              where HOSPITAL_ID = '_SYSTEM_' and TYPE = 'D']
2019-10-31 09:59:31,892 [1] DEBUG - Statement Id: [DAO00001_DaoList] PreparedStatement : [select              TM_SYS_SERVICEMAP.ID,              TM_SYS_SERVICEMAP.HOSPITAL_ID,              TM_SYS_SERVICEMAP.DB_NAME,              TM_SYS_SERVICEMAP.TYPE,              TM_SYS_SERVICEMAP.NAME,              TM_SYS_SERVICEMAP.CLASS,              (TM_SYS_DIC.VALUE + '.' + TM_SYS_SERVICEMAP.CLASS) as CLASSFULL,              TM_SYS_SERVICEMAP.ASSEMBLY              from TM_SYS_SERVICEMAP              inner join TM_SYS_DIC              on TM_SYS_SERVICEMAP.NAMESPACE = TM_SYS_DIC.ID              where HOSPITAL_ID = '_SYSTEM_' AND TYPE = 'D' AND ACTIVE = '1'              order by DB_NAME]
2019-10-31 09:59:31,957 [1] DEBUG - Statement Id: [DAO00001_ServiceList] PreparedStatement : [select              TM_SYS_SERVICEMAP.ID,              TM_SYS_SERVICEMAP.HOSPITAL_ID,              TM_SYS_SERVICEMAP.DB_NAME,              TM_SYS_SERVICEMAP.TYPE,              TM_SYS_SERVICEMAP.NAME,              TM_SYS_SERVICEMAP.CLASS,              (TM_SYS_DIC.VALUE + '.' + TM_SYS_SERVICEMAP.CLASS) as CLASSFULL,              TM_SYS_SERVICEMAP.ASSEMBLY,              TM_SYS_SERVER.URL              from TM_SYS_SERVICEMAP              inner join TM_SYS_DIC on TM_SYS_SERVICEMAP.NAMESPACE = TM_SYS_DIC.ID              inner join TM_SYS_SERVER on (TM_SYS_SERVICEMAP.DB_NAME = TM_SYS_SERVER.NAME) and (TM_SYS_SERVER.HOSPITAL_ID = '_SYSTEM_')              where TM_SYS_SERVICEMAP.HOSPITAL_ID = '_SYSTEM_' AND TM_SYS_SERVICEMAP.TYPE = 'S'  AND ACTIVE = '1'              order by URL]
2019-10-31 09:59:33,033 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = '_SYSTEM_'               AND                   TM_SYS_SCREEN.PAGE = 'LOGIN'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2019-10-31 09:59:33,416 [1] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = '_SYSTEM_'               AND                   TM_SYS_CACHE.ACTIVE = '1']
2019-10-31 09:59:41,940 [1] DEBUG - Statement Id: [DAO00001_DBList] PreparedStatement : [select *              from TM_SYS_SERVER              where HOSPITAL_ID = 'HLU01' and TYPE = 'D']
2019-10-31 09:59:41,969 [1] DEBUG - Statement Id: [DAO00001_DaoList] PreparedStatement : [select              TM_SYS_SERVICEMAP.ID,              TM_SYS_SERVICEMAP.HOSPITAL_ID,              TM_SYS_SERVICEMAP.DB_NAME,              TM_SYS_SERVICEMAP.TYPE,              TM_SYS_SERVICEMAP.NAME,              TM_SYS_SERVICEMAP.CLASS,              (TM_SYS_DIC.VALUE + '.' + TM_SYS_SERVICEMAP.CLASS) as CLASSFULL,              TM_SYS_SERVICEMAP.ASSEMBLY              from TM_SYS_SERVICEMAP              inner join TM_SYS_DIC              on TM_SYS_SERVICEMAP.NAMESPACE = TM_SYS_DIC.ID              where HOSPITAL_ID = 'HLU01' AND TYPE = 'D' AND ACTIVE = '1'              order by DB_NAME]
2019-10-31 09:59:50,324 [1] DEBUG - Statement Id: [DAO00001_ServiceList] PreparedStatement : [select              TM_SYS_SERVICEMAP.ID,              TM_SYS_SERVICEMAP.HOSPITAL_ID,              TM_SYS_SERVICEMAP.DB_NAME,              TM_SYS_SERVICEMAP.TYPE,              TM_SYS_SERVICEMAP.NAME,              TM_SYS_SERVICEMAP.CLASS,              (TM_SYS_DIC.VALUE + '.' + TM_SYS_SERVICEMAP.CLASS) as CLASSFULL,              TM_SYS_SERVICEMAP.ASSEMBLY,              TM_SYS_SERVER.URL              from TM_SYS_SERVICEMAP              inner join TM_SYS_DIC on TM_SYS_SERVICEMAP.NAMESPACE = TM_SYS_DIC.ID              inner join TM_SYS_SERVER on (TM_SYS_SERVICEMAP.DB_NAME = TM_SYS_SERVER.NAME) and (TM_SYS_SERVER.HOSPITAL_ID = 'HLU01')              where TM_SYS_SERVICEMAP.HOSPITAL_ID = 'HLU01' AND TM_SYS_SERVICEMAP.TYPE = 'S'  AND ACTIVE = '1'              order by URL]
2019-10-31 09:59:50,671 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1']
2019-10-31 09:59:53,016 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM005']
2019-10-31 09:59:56,726 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM015']
2019-10-31 09:59:56,930 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM067']
2019-10-31 09:59:57,179 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM008']
2019-10-31 09:59:58,522 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM068']
2019-10-31 09:59:59,013 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM006']
2019-10-31 09:59:59,138 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM030']
2019-10-31 09:59:59,381 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM025']
2019-10-31 09:59:59,462 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM024']
2019-10-31 10:00:00,388 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM033']
2019-10-31 10:00:01,188 [5] DEBUG - Statement Id: [DAO00027_GetListDuocKyGuiTonKho] PreparedStatement : [select  distinct TT_TONKHO.DUOC_KEY, LTRIM(TT_TONKHO.KHODUOC_ID) as KHODUOC_ID, TM_DUOC.DUOC_ID, TM_LOAIDUOC.MALOAIDUOC,TM_DUOC.SOVISA,TM_DUOC.TYLE_VAT,TM_DUOC.COTOA,        TM_DUOC.MADUOC, TM_DUOC.TENHANG, TM_DUOC.TENDUOCDAYDU, dvt.TENDONVITINH as DONVITINH,  TM_DUOC.DONVITINH_ID,TM_DUOC.BHYT,TM_DUOC.PHAMVI,        TM_DUOC.TENHOATCHAT, TM_DUOC.HAMLUONG, TM_DUOC.HANGSANXUAT, TM_DUOC.QUOCGIA, TM_DUOC.LOAIDUOC_ID, TM_DUOC.DUONGDUNG_ID,        TM_TENDUOC.TENDUOC, TM_TENDUOC.TENDUOC_EN, TM_TENDUOC.MAQUOCTE, TM_TENDUOC.MAQUOCTEBT,        TM_LOAIDUOC.LOAIVATTU_ID, TM_DUOC.BENHVIEN_ID,TT_TONKHO.SOLUONG, TT_TONKHO.NGUONDUOC_ID, NH.TENNGUONDUOC        , TAMNGUNG = CASE WHEN TM_DUOC.TAMNGUNG = '1' OR nh.TAMNGUNG = '1' OR KD.TAMNGUNG = '1' THEN '1' ELSE '0' END        , TM_DUOC.DANGTRINHBAY        from TM_DUOC        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = TM_DUOC.DONVITINH_ID        left join TM_TENDUOC on TM_DUOC.TENDUOC_ID = TM_TENDUOC.TENDUOC_ID and TM_DUOC.BENHVIEN_ID = 'HLU01' and TM_DUOC.TAMNGUNG = '0'        left join TM_LOAIDUOC on TM_LOAIDUOC.LOAIDUOC_ID = TM_DUOC.LOAIDUOC_ID and TM_LOAIDUOC.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG on (TM_LOAIDUOC.LOAIVATTU_ID = TM_DUOC_HANDUNG.LOAIDUOC and TM_DUOC_HANDUNG.BENHVIEN_ID = 'HLU01')        inner join        (select LTRIM(A.KHODUOC_ID) + '_' + LTRIM(A.DUOC_ID) + '_' + LTRIM(ISNULL(A.NGUONDUOC_ID,'')) as DUOC_KEY, A.KHODUOC_ID, A.DUOC_ID,A.NGUONDUOC_ID,        SUM(isnull(A.SOLUONG,0)) as SOLUONG        from        (select SUM(SOLUONG) as SOLUONG, KHODUOC_ID, DUOC_ID, NGUONDUOC_ID from TT_DUOC_KYGUI_TONKHO        where BENHVIEN_ID = 'HLU01' group by KHODUOC_ID, DUOC_ID, NGUONDUOC_ID) A        group by LTRIM(A.KHODUOC_ID) + '_' + LTRIM(A.DUOC_ID) + '_' + LTRIM(A.NGUONDUOC_ID), A.KHODUOC_ID, A.DUOC_ID, A.NGUONDUOC_ID)        TT_TONKHO on TT_TONKHO.DUOC_ID = TM_DUOC.DUOC_ID        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = TT_TONKHO.NGUONDUOC_ID and nh.BENHVIEN_ID = 'HLU01'        LEFT JOIN TM_KHODUOC KD ON KD.KHODUOC_ID = TT_TONKHO.KHODUOC_ID        where TM_DUOC.BENHVIEN_ID = 'HLU01' AND TT_TONKHO.SOLUONG >= 0]
2019-10-31 10:00:01,630 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM018']
2019-10-31 10:00:01,723 [5] DEBUG - Statement Id: [DAO00027_GetListDuocTonKho] PreparedStatement : [select distinct TT_TONKHO.DUOC_KEY, LTRIM(TT_TONKHO.KHODUOC_ID) as KHODUOC_ID, TM_DUOC.DUOC_ID, TM_LOAIDUOC.MALOAIDUOC,TM_DUOC.SOVISA,TM_DUOC.TYLE_VAT,TM_DUOC.COTOA,        TM_DUOC.MADUOC, TM_DUOC.TENHANG, TM_DUOC.TENDUOCDAYDU, dvt.TENDONVITINH as DONVITINH,  TM_DUOC.DONVITINH_ID,TM_DUOC.BHYT,                TM_DUOC.TENHOATCHAT,          TM_DUOC.HAMLUONG, TM_DUOC.HANGSANXUAT, TM_DUOC.QUOCGIA, TM_DUOC.LOAIDUOC_ID, TM_DUOC.DUONGDUNG_ID,        TM_TENDUOC.TENDUOC, TM_TENDUOC.TENDUOC_EN, TM_TENDUOC.MAQUOCTE, TM_TENDUOC.MAQUOCTEBT,        TM_LOAIDUOC.LOAIVATTU_ID, TM_DUOC.BENHVIEN_ID,        TT_TONKHO.SOLUONG, TM_DUOC.VTYT_PHANLOAI, TM_DUOC.PHAMVI, TT_TONKHO.NGUONDUOC_ID, NG.TENNGUONDUOC AS TENNGUONDUOC        , TAMNGUNG = CASE WHEN TM_DUOC.TAMNGUNG = '1' OR NG.TAMNGUNG = '1' OR KD.TAMNGUNG = '1' THEN '1' ELSE '0' END        , TM_DUOC.DANGTRINHBAY        from TM_DUOC        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = TM_DUOC.DONVITINH_ID        left join TM_TENDUOC on TM_DUOC.TENDUOC_ID = TM_TENDUOC.TENDUOC_ID and TM_DUOC.BENHVIEN_ID = 'HLU01' and TM_DUOC.TAMNGUNG = '0'        left join TM_LOAIDUOC on TM_LOAIDUOC.LOAIDUOC_ID = TM_DUOC.LOAIDUOC_ID and TM_LOAIDUOC.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG on (TM_LOAIDUOC.LOAIVATTU_ID = TM_DUOC_HANDUNG.LOAIDUOC and TM_DUOC_HANDUNG.BENHVIEN_ID = 'HLU01')        inner join        (select LTRIM(A.KHODUOC_ID) + '_' + LTRIM(A.DUOC_ID) + '_' + LTRIM(ISNULL(A.NGUONDUOC_ID,'')) as DUOC_KEY, A.KHODUOC_ID, A.DUOC_ID, A.NGUONDUOC_ID,        SUM(isnull(A.SOLUONG,0)) as SOLUONG        from        (select SUM(SOLUONG) as SOLUONG, KHODUOC_ID, DUOC_ID, NGUONDUOC_ID from TT_DUOC_TONKHO        where BENHVIEN_ID = 'HLU01' group by KHODUOC_ID, DUOC_ID, NGUONDUOC_ID) A        group by LTRIM(A.KHODUOC_ID) + '_' + LTRIM(A.DUOC_ID) + '_' + LTRIM(ISNULL(A.NGUONDUOC_ID,'')), A.KHODUOC_ID, A.DUOC_ID, NGUONDUOC_ID        ) TT_TONKHO on TT_TONKHO.DUOC_ID = TM_DUOC.DUOC_ID        LEFT JOIN TM_NGUONHANG NG ON NG.NGUONDUOC_ID = TT_TONKHO.NGUONDUOC_ID        LEFT JOIN TM_KHODUOC KD ON KD.KHODUOC_ID = TT_TONKHO.KHODUOC_ID        where TM_DUOC.BENHVIEN_ID = 'HLU01' and TT_TONKHO.SOLUONG >= 0]
2019-10-31 10:00:03,883 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM023']
2019-10-31 10:00:04,408 [5] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoVaBooking] PreparedStatement : [declare @NGUONDUOC_MACDINH varchar(5) = '0';        declare @TOAMUANGOAI int = 0;        select @NGUONDUOC_MACDINH = isnull(VALUE,0) from TM_SYS_APPSETTINGS where CODE = 'PHA_NGUONDUOC'        select @TOAMUANGOAI = isnull(VALUE,0) from TM_SYS_APPSETTINGS where CODE = 'OPD_TOAMUANGOAI_DUNGDANHMUC_DUOC'                if @TOAMUANGOAI = 1        begin        select  distinct '0' + '_' + LTRIM(d.DUOC_ID) + '_' + @NGUONDUOC_MACDINH as DUOC_KEY, 0 as PHAMVI_ID, @NGUONDUOC_MACDINH as NGUONDUOC_ID, null as TENNGUONDUOC, null as TINHTIEN, d.DUOC_ID, ld.MALOAIDUOC,        d.SOVISA,d.TYLE_VAT,d.COTOA, d.MADUOC, d.TENHANG, d.TENDUOCDAYDU, d.DONVITINH as DONVITINH, d.BHYT,        d.TENHOATCHAT, d.HAMLUONG, d.HANGSANXUAT, d.QUOCGIA, d.LOAIDUOC_ID, d.DUONGDUNG_ID, d.TINHTIEN_PTTT,        ten.TENDUOC, ten.TENDUOC_EN, ten.MAQUOCTE, ten.MAQUOCTEBT,        '' as BHYT_TEXT        , ld.LOAIVATTU_ID        , d.BENHVIEN_ID,        999999999 as SOLUONG, d.VTYT_PHANLOAI, d.PHAMVI, d.SUASOLUONGTONGHOP, d.MADUOCBV, d.DANGTRINHBAY        , TAMNGUNG = CASE WHEN d.TAMNGUNG = '1' THEN '1' ELSE '0' END        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        union all        select  distinct tk.DUOC_KEY, LTRIM(tk.PHAMVI_ID) as PHAMVI_ID, tk.NGUONDUOC_ID, nh.TENNGUONDUOC, nh.TINHTIEN, d.DUOC_ID, ld.MALOAIDUOC,        d.SOVISA,d.TYLE_VAT,d.COTOA, d.MADUOC, d.TENHANG, d.TENDUOCDAYDU, d.DONVITINH as DONVITINH, d.BHYT,        d.TENHOATCHAT, d.HAMLUONG, d.HANGSANXUAT, d.QUOCGIA, d.LOAIDUOC_ID, d.DUONGDUNG_ID, d.TINHTIEN_PTTT,        ten.TENDUOC, ten.TENDUOC_EN, ten.MAQUOCTE, ten.MAQUOCTEBT,        CASE WHEN d.BHYT = '1' THEN 'BHYT' ELSE '' END as BHYT_TEXT        , ld.LOAIVATTU_ID        , d.BENHVIEN_ID,        tk.SOLUONG, d.VTYT_PHANLOAI, d.PHAMVI, d.SUASOLUONGTONGHOP, d.MADUOCBV, d.DANGTRINHBAY        , TAMNGUNG = CASE WHEN d.TAMNGUNG = '1' OR nh.TAMNGUNG = '1' OR kd.TAMNGUNG = '1' THEN '1' ELSE '0' END        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        inner join        (        select  LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')) DUOC_KEY, (SUM(dtk.SOLUONG) - isnull(sum(A.SOLUONG),0) - isnull(sum(B.SOLUONG),0)) SOLUONG, pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        from (select sum(soluong) soluong,duoc_id,nguonduoc_id,khoduoc_id,benhvien_id from TT_DUOC_TONKHO  group by duoc_id,nguonduoc_id,khoduoc_id,benhvien_id) dtk        inner join TM_DUOC_PHAMVISD_MAPPING pvsd on dtk.KHODUOC_ID = pvsd.KHODUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NOITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) B on B.DUOC_ID = dtk.DUOC_ID and B.SOLUONG > 0 and B.PHAMVI_ID = pvsd.PHAMVI_ID and B.NGUONHANG_ID = dtk.NGUONDUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NGOAITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) A on A.DUOC_ID = dtk.DUOC_ID and A.SOLUONG > 0 and A.PHAMVI_ID = pvsd.PHAMVI_ID and A.NGUONHANG_ID = dtk.NGUONDUOC_ID        where dtk.SOLUONG > 0 and dtk.BENHVIEN_ID = 'HLU01'        group by LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')), pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        ) tk on tk.DUOC_ID = d.DUOC_ID        left join TM_DUOC_PHAMVISUDUNG kd on kd.PHAMVI_ID = tk.PHAMVI_ID and kd.BENHVIEN_ID = 'HLU01'        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = tk.NGUONDUOC_ID and nh.BENHVIEN_ID = 'HLU01'        where d.BENHVIEN_ID = 'HLU01'  and tk.SOLUONG >= 0        end        else        begin                  select  distinct tk.DUOC_KEY, LTRIM(tk.PHAMVI_ID) as PHAMVI_ID, tk.NGUONDUOC_ID, nh.TENNGUONDUOC, nh.TINHTIEN, d.DUOC_ID, ld.MALOAIDUOC,        d.SOVISA,d.TYLE_VAT,d.COTOA, d.MADUOC, d.TENHANG, d.TENDUOCDAYDU, d.DONVITINH as DONVITINH, d.BHYT,        d.TENHOATCHAT, d.HAMLUONG, d.HANGSANXUAT, d.QUOCGIA, d.LOAIDUOC_ID, d.DUONGDUNG_ID, d.TINHTIEN_PTTT,        ten.TENDUOC, ten.TENDUOC_EN, ten.MAQUOCTE, ten.MAQUOCTEBT,        CASE WHEN d.BHYT = '1' THEN 'BHYT' ELSE '' END as BHYT_TEXT        , ld.LOAIVATTU_ID        , d.BENHVIEN_ID,        tk.SOLUONG, d.VTYT_PHANLOAI, d.PHAMVI, d.SUASOLUONGTONGHOP, d.MADUOCBV, d.DANGTRINHBAY        , TAMNGUNG = CASE WHEN d.TAMNGUNG = '1' OR nh.TAMNGUNG = '1' OR kd.TAMNGUNG = '1' THEN '1' ELSE '0' END        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        inner join        (        select  LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')) DUOC_KEY, (SUM(dtk.SOLUONG) - isnull(sum(A.SOLUONG),0) - isnull(sum(B.SOLUONG),0)) SOLUONG, pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        from (select sum(soluong) soluong,duoc_id,nguonduoc_id,khoduoc_id,benhvien_id from TT_DUOC_TONKHO  group by duoc_id,nguonduoc_id,khoduoc_id,benhvien_id) dtk        inner join TM_DUOC_PHAMVISD_MAPPING pvsd on dtk.KHODUOC_ID = pvsd.KHODUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NOITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) B on B.DUOC_ID = dtk.DUOC_ID and B.SOLUONG > 0 and B.PHAMVI_ID = pvsd.PHAMVI_ID and B.NGUONHANG_ID = dtk.NGUONDUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NGOAITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) A on A.DUOC_ID = dtk.DUOC_ID and A.SOLUONG > 0 and A.PHAMVI_ID = pvsd.PHAMVI_ID and A.NGUONHANG_ID = dtk.NGUONDUOC_ID        where dtk.SOLUONG > 0 and dtk.BENHVIEN_ID = 'HLU01'        group by LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')), pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        ) tk on tk.DUOC_ID = d.DUOC_ID        left join TM_DUOC_PHAMVISUDUNG kd on kd.PHAMVI_ID = tk.PHAMVI_ID and kd.BENHVIEN_ID = 'HLU01'        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = tk.NGUONDUOC_ID and nh.BENHVIEN_ID = 'HLU01'        where d.BENHVIEN_ID = 'HLU01'  and tk.SOLUONG >= 0        end]
2019-10-31 10:00:07,002 [5] DEBUG - Statement Id: [DAO00320_GetList] PreparedStatement : [select M.*            from TM_MAU M            LEFT JOIN TM_MAU_DONVITINH DVT on M.DONVITINH_ID=DVT.DONVITINH_ID            where            M.TAMNGUNG = '0'            and M.BENHVIEN_ID = 'HLU01'            order by M.TENMAU]
2019-10-31 10:00:07,073 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM071']
2019-10-31 10:00:07,125 [5] DEBUG - Statement Id: [DAO00322_GetListMauTonKhoForCreateCached] PreparedStatement : [SELECT DISTINCT        TK.MAU_KEY, TK.KHOMAU_ID, M.MAU_ID, M.MAMAU, M.TENMAU, M.NHOM_ABO, M.NHOM_RH, M.LOAIMAU_ID,        TK.SOLONHAP_ID, SLN.SOLONHAP, SLN.SOKIEMSOAT, TK.NGUONHANG_ID, NG.TENNGUONMAU, M.BENHVIEN_ID, M.DONVITINH_ID,        SUM(tk.SOLUONG) AS SOLUONG,K.TENKHO,DVT.TENDONVITINH        FROM TT_MAU_TONKHO TK        JOIN TM_KHO K ON TK.KHOMAU_ID = K.KHO_ID        JOIN TT_MAU_CHUNGTU_SOLONHAP SLN ON TK.SOLONHAP_ID = SLN.SOLONHAP_ID        JOIN TM_MAU M on TK.MAU_ID = M.MAU_ID and M.TAMNGUNG = '0'        LEFT JOIN TM_MAU_DONVITINH DVT on M.DONVITINH_ID=DVT.DONVITINH_ID        LEFT JOIN TM_NGUONMAU NG ON NG.NGUONMAU_ID = TK.NGUONHANG_ID        WHERE TK.SOLUONG > 0        GROUP BY TK.MAU_KEY, TK.KHOMAU_ID, M.MAU_ID, M.MAMAU, M.TENMAU, M.NHOM_ABO, M.NHOM_RH, M.LOAIMAU_ID,        TK.SOLONHAP_ID, SLN.SOLONHAP, SLN.SOKIEMSOAT,TK.NGUONHANG_ID, NG.TENNGUONMAU, M.BENHVIEN_ID, M.DONVITINH_ID,K.TENKHO,DVT.TENDONVITINH]
2019-10-31 10:00:07,245 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM073']
2019-10-31 10:00:07,280 [5] DEBUG - Statement Id: [DAO00322_GetListMauTonKhoTruBooking] PreparedStatement : [select distinct        TK.MAU_KEY, TK.KHOMAU_ID, M.MAU_ID, M.MAMAU, M.TENMAU, M.NHOM_ABO, M.NHOM_RH, M.LOAIMAU_ID, M.DONVITINH_ID,        TK.SOLONHAP_ID, TK.SOLONHAP, TK.SOKIEMSOAT,M.PHAMVI, TK.NGUONHANG_ID, NG.TENNGUONMAU, M.BENHVIEN_ID,        TK.SOLUONG,TK.TENKHO,DVT.TENDONVITINH        from TM_MAU M        JOIN        (        select        A.MAU_KEY, A.KHOMAU_ID, A.MAU_ID ,a.NGUONHANG_ID, A.SOLONHAP_ID, A.SOLONHAP, A.SOKIEMSOAT, A.SOLUONG,A.TENKHO        from        (        select KHOMAU_ID, TK.MAU_ID, TK.NGUONHANG_ID, TK.MAU_KEY, SLN.SOLONHAP_ID, SLN.SOLONHAP, SLN.SOKIEMSOAT, ISNULL(TK.SOLUONG,0) - ISNULL(book.SOLUONG,0) as SOLUONG,K.TENKHO        from TT_MAU_TONKHO TK        JOIN TM_KHO K ON TK.KHOMAU_ID = K.KHO_ID        inner join TT_MAU_CHUNGTU_SOLONHAP SLN ON TK.SOLONHAP_ID = SLN.SOLONHAP_ID        left join dbo.TT_MAU_TONKHO_BOOK book ON book.MAU_KEY = TK.MAU_KEY AND book.TRANGTHAI = 'HIEULUC'        where ISNULL(TK.SOLUONG,0) - ISNULL(book.SOLUONG,0) > 0        ) A        )TK on TK.MAU_ID = M.MAU_ID and M.TAMNGUNG = '0'        LEFT JOIN TM_MAU_DONVITINH DVT on M.DONVITINH_ID=DVT.DONVITINH_ID        LEFT JOIN TM_NGUONMAU NG ON NG.NGUONMAU_ID = TK.NGUONHANG_ID]
2019-10-31 10:00:07,384 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM072']
2019-10-31 10:00:08,567 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'MAIN'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2019-10-31 10:00:13,137 [1] DEBUG - Statement Id: [DAO00002_FormList] PreparedStatement : [select              TM_SYS_FORM.HOSPITAL_ID,              TM_SYS_FORM.NAME,              TM_SYS_FORM.CLASS,              TM_SYS_FORM.ASSEMBLY,              TM_SYS_FORM.TITLE_VI as TITLE              from TM_SYS_FORM              where HOSPITAL_ID = 'HLU01']
2019-10-31 10:00:28,741 [1] DEBUG - Statement Id: [DAO00300_GetShortcutListByUserID] PreparedStatement : [SELECT S.SHORTCUT_CODE, S.SHORTCUT_VALUE              FROM TM_SHORTCUT AS S              WHERE S.BENHVIEN_ID = 'HLU01' AND S.USER_ID = '1' AND TAMNGUNG = '0']
2019-10-31 10:00:28,811 [1] DEBUG - Statement Id: [DAO00087_GetList] PreparedStatement : [select CODE, VALUE, BENHVIEN_ID              from TM_SYS_APPSETTINGS              where LOCKED = '0' and BENHVIEN_ID = 'HLU01'              order by SETTING_ID]
2019-10-31 10:00:28,950 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'MSG01'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2019-10-31 10:00:29,495 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'MSG02'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2019-10-31 10:00:30,195 [1] DEBUG - Statement Id: [DAO00008_GetUserSettings] PreparedStatement : [select A.*, B.TENKHO , C.TENPHONGBAN, B.MAKHO, C.MAPHONGBAN          from TM_SYS_USERS A          left join TM_KHODUOC B on B.KHODUOC_ID = A.INVENTORY_ID          left join TM_PHONGBAN C on (C.PHONGBAN_ID = A.WORKING_DEPT_ID and C.BENHVIEN_ID =  @param0 )          left join TM_SYS_USERKHO D on (D.ACCOUNT_ID = A.ACCOUNT_ID and D.HOSPITAL_ID =  @param0 )          where          A.HOSPITAL_ID =  @param0            and                 A.ACCOUNT_ID =  @param1]
2019-10-31 10:00:30,235 [1] DEBUG - Statement Id: [DAO00008_GetUserSettings] Parameters: [@param0=[HOSPITAL_ID,HLU01], @param1=[ACCOUNT_ID,113]]
2019-10-31 10:00:30,235 [1] DEBUG - Statement Id: [DAO00008_GetUserSettings] Types: [@param0=[String, System.String], @param1=[String, System.String]]
2019-10-31 10:00:30,298 [1] DEBUG - Statement Id: [DAO00008_GetUserInvSettings] PreparedStatement : [select A.*, B.TENKHO, B.MAKHO, B.LOAIKHO_ID, B.KHOQUANLY_ID          from TM_SYS_USERKHO A          left join TM_KHO B on B.MODULE_ID = A.MODULE_ID and B.KHO_ID = A.KHO_ID          where A.HOSPITAL_ID =  @param0  and A.ACCOUNT_ID =  @param1           order by B.TENKHO]
2019-10-31 10:00:30,298 [1] DEBUG - Statement Id: [DAO00008_GetUserInvSettings] Parameters: [@param0=[HOSPITAL_ID,HLU01], @param1=[ACCOUNT_ID,113]]
2019-10-31 10:00:30,298 [1] DEBUG - Statement Id: [DAO00008_GetUserInvSettings] Types: [@param0=[String, System.String], @param1=[String, System.String]]
2019-10-31 10:00:30,748 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'COM30'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2019-10-31 10:00:31,458 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'RIS04'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2019-10-31 10:00:52,031 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'MENU1'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2019-10-31 10:00:52,228 [1] DEBUG - Statement Id: [DAO00011_GetList] PreparedStatement : [select              TM_SYS_MENU.ID,              TM_SYS_MENU.PARENTID,              TM_SYS_MENU.SCREEN,              TM_SYS_MENU.SMALLIMAGE,              TM_SYS_MENU.LARGEIMAGE,              TM_SYS_MENU.DESCRIPTION,              TM_SYS_MENU.TYPE,              TM_SYS_MENU.TITLE_VI as TITLE              from TM_SYS_MENU              where TM_SYS_MENU.HOSPITAL_ID = 'HLU01' and TM_SYS_MENU.ACTIVE = '1'               AND                   (TM_SYS_MENU.TYPE & '8' = '8')                             order by TM_SYS_MENU.ORDERNUM]
2019-10-31 10:00:52,968 [1] DEBUG - Statement Id: [DAO00011_usermenu_list] PreparedStatement : [select              TM_SYS_HOMEMENU.MENUID as ID,              TM_SYS_MENU.TITLE_VI as TITLE,              TM_SYS_MENU.SCREEN,              TM_SYS_MENU.SMALLIMAGE,              TM_SYS_MENU.LARGEIMAGE,              TM_SYS_MENU.TYPE              from TM_SYS_HOMEMENU              left join TM_SYS_MENU on TM_SYS_MENU.ID = TM_SYS_HOMEMENU.MENUID and TM_SYS_MENU.HOSPITAL_ID = TM_SYS_HOMEMENU.HOSPITAL_ID              where TM_SYS_HOMEMENU.HOSPITAL_ID = 'HLU01' and TM_SYS_HOMEMENU.USERID = '113' and TM_SYS_MENU.ACTIVE = '1'               AND                   (TM_SYS_MENU.TYPE & '8' = '8')                             ORDER BY TM_SYS_HOMEMENU.ORDERNUM]
2019-10-31 10:01:36,354 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'COM31'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2019-10-31 10:01:36,734 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'BIL11'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2019-10-31 10:01:39,246 [1] DEBUG - Statement Id: [DAO00012_GetList] PreparedStatement : [select        DICTIONARY_ID,        DICTIONARY_CODE,        DICTIONARY_NAME,        ATTRIBUTE1,        ATTRIBUTE2,        DICTIONARY_NAME_EN        from LST_DICTIONARY        where LST_DICTIONARY.Enabled = '1'         AND           LST_DICTIONARY.DICTIONARY_TYPE_CODE = 'NguonBN'                 order by LST_DICTIONARY.IDX]
2019-10-31 10:01:48,970 [1] DEBUG - Statement Id: [DAO00059_GetList] PreparedStatement : [select A.* from TM_PHONGBAN A            inner join LST_DICTIONARY B on A.LOAIPHONGBAN_ID = B.DICTIONARY_ID            and B.DICTIONARY_TYPE_CODE = 'LoaiPhongBan' and (B.DICTIONARY_CODE = 'KhoaNoi' or B.DICTIONARY_CODE = 'KhoaNgoai')            where A.BENHVIEN_ID = 'HLU01'            and A.MAPHONGBAN != '' AND A.TAMNGUNG = '0' order by A.TENPHONGBAN asc]
2019-10-31 10:01:50,593 [1] DEBUG - Statement Id: [DAO00014_GetInPatientStatus] PreparedStatement : [select TRANGTHAI, isnull(KHOACHUYENDEN_ID, KHOAVAO_ID) as KHOAHIENTAI from TT_NOITRU_BENHAN        where        TIEPNHAN_ID = '27327'        and BENHVIEN_ID = 'HLU01'         and           BENHAN_ID = '5849']
2019-10-31 10:01:51,236 [1] DEBUG - Statement Id: [DAO00024_TT_VIENPHI_GetList_DSDichVuChuaThuTien] PreparedStatement : [SELECT TOP 1 VIENPHI_ID              FROM TT_VIENPHI              WHERE              DATHANHTOAN = 0]
2019-10-31 10:01:51,276 [1] DEBUG - Statement Id: [DAO00087_GetServiceParams] PreparedStatement : [select CODE, VALUE              from TM_SYS_APPSETTINGS              where LOCKED = '0' and BENHVIEN_ID = 'HLU01']
2019-10-31 10:01:51,318 [1] DEBUG - Statement Id: [DAO00067_laytrangthaibenhannoitru] PreparedStatement : [select isnull(TRANGTHAI, '') TRANGTHAI from TT_NOITRU_BENHAN where BENHAN_ID =  @param0]
2019-10-31 10:01:51,318 [1] DEBUG - Statement Id: [DAO00067_laytrangthaibenhannoitru] Parameters: [@param0=[BENHAN_ID,5849]]
2019-10-31 10:01:51,318 [1] DEBUG - Statement Id: [DAO00067_laytrangthaibenhannoitru] Types: [@param0=[Int64, System.Int64]]
2019-10-31 10:01:51,350 [1] DEBUG - Statement Id: [DAO00067_ClearDataVienPhi] PreparedStatement : [delete from TT_VIENPHI where TIEPNHAN_ID = 27327 and REF_ID = 0           and             BENHAN_ID = '5849'                     update TT_VIENPHI set SOLUONG = 0          where REF_TABLE = 'TT_DVYEUCAU' and TIEPNHAN_ID =  @param0           and not exists (select DVYEUCAU_ID from TT_DVYEUCAU where TT_VIENPHI.REF_ID = DVYEUCAU_ID and TIEPNHAN_ID =  @param0 )                       update TT_VIENPHI set SOLUONG = 0          where REF_TABLE = 'TT_NGOAITRU_TOATHUOC'          and TIEPNHAN_ID =  @param0           and HOADON_ID is null and TIEPNHAN_ID =  @param0           and not exists (select TOATHUOC_ID from TT_NGOAITRU_TOATHUOC where TT_VIENPHI.REF_ID = TOATHUOC_ID and TIEPNHAN_ID =  @param0 )                          update TT_VIENPHI            set SOLUONG = (TraThuoc.SOLUONG - TraThuoc.SOLUONG_NGUNG)            from (select distinct nttt.SOLUONG, ttct.TOATHUOC_ID, ttct.DUOC_ID , ttct.SOLUONG SOLUONG_NGUNG            from TT_NOITRU_TRATHUOC_CHITIET ttct            left join TT_NOITRU_TRATHUOC tt on tt.TRATHUOC_ID = ttct.TRATHUOC_ID            left join TT_NOITRU_TOATHUOC nttt on nttt.TOATHUOC_ID = ttct.TOATHUOC_ID            where tt.BENHAN_ID =  @param1 ) TraThuoc            where TT_VIENPHI.REF_ID = TraThuoc.TOATHUOC_ID and TT_VIENPHI.DUOC_ID = TraThuoc.DUOC_ID            and TT_VIENPHI.REF_TABLE = 'TT_NOITRU_TOATHUOC' and TT_VIENPHI.BENHAN_ID =  @param1             and TT_VIENPHI.SOLUONG > (TraThuoc.SOLUONG - TraThuoc.SOLUONG_NGUNG)                         update TT_VIENPHI set SOLUONG = 0            where REF_TABLE = 'TT_NOITRU_TOATHUOC'            and TIEPNHAN_ID =  @param0             and KHAMBENH_ID not in (select KHAMBENH_ID from TT_NOITRU_TOATHUOC where TIEPNHAN_ID =  @param0 )            and HOADON_ID is null and BENHAN_ID =  @param1                    delete TT_DUOC_TONKHO_BOOK_NOITRU where REF_TABLE = 'TT_NOITRU_TOATHUOC' and (REF_ID is null or REF_ID = 0)        delete TT_DUOC_TONKHO_BOOK_NGOAITRU where REF_ID is null or REF_ID = 0                      update TT_VIENPHI          set BENHAN_ID =  @param1           from (select TOATHUOC_ID from TT_NOITRU_TOATHUOC where TIEPNHAN_ID =  @param0 ) nttt          where REF_TABLE = 'TT_NOITRU_TOATHUOC' and REF_ID = nttt.TOATHUOC_ID and isnull(BENHAN_ID, 0) = 0          and TIEPNHAN_ID =  @param0             update TT_VIENPHI          set TT_VIENPHI.BENHAN_ID =  @param1           from (select DVYEUCAU_ID, BENHAN_ID from TT_DVYEUCAU where TIEPNHAN_ID =  @param0 ) nttt          where TT_VIENPHI.REF_TABLE = 'TT_DVYEUCAU' and TT_VIENPHI.REF_ID = nttt.DVYEUCAU_ID          and isnull(TT_VIENPHI.BENHAN_ID, 0) = 0 and isnull(nttt.BENHAN_ID, 0) > 0          and TT_VIENPHI.TIEPNHAN_ID =  @param0                     update TT_VIENPHI set          THANHTIEN_DOANHTHU = 0, BHYT_THANHTIEN = 0, BHYT_THANHTIEN_CHITRA = 0          , GIATRI_BENHNHAN_DATHANHTOAN = 0, BENHNHAN_PHAITHANHTOAN = 0          where TIEPNHAN_ID = 27327 and SOLUONG = 0           and             BENHAN_ID = 5849                       update TT_VIENPHI set          GIATRI_BENHNHAN_DATHANHTOAN = 0          where TIEPNHAN_ID = '27327' and GIATRI_BENHNHAN_DATHANHTOAN is null            update TT_VIENPHI set          BENHNHAN_PHAITHANHTOAN = 0          where TIEPNHAN_ID = '27327' and BENHNHAN_PHAITHANHTOAN is null]
2019-10-31 10:01:51,350 [1] DEBUG - Statement Id: [DAO00067_ClearDataVienPhi] Parameters: [@param0=[TIEPNHAN_ID,27327], @param1=[BENHAN_ID,5849]]
2019-10-31 10:01:51,350 [1] DEBUG - Statement Id: [DAO00067_ClearDataVienPhi] Types: [@param0=[Int64, System.Int64], @param1=[Int64, System.Int64]]
2019-10-31 10:01:52,633 [1] DEBUG - Statement Id: [DAO00064_GetlistTT_TIEPNHAN_SOTHEBHYT] PreparedStatement : [select stbhyt.*, ba.SOBENHAN,         tn.SOTIEPNHAN, tn.LOAITHANHVIEN_ID, tn.THE_ID, tn.THANHVIEN_ID,        tn.SUDUNG_BHTN, tn.BAOLANH_VIENPHI, tn.VIP, tn.NGUOINUOCNGOAI        from TT_TIEPNHAN_SOTHEBHYT stbhyt        left join TT_TIEPNHAN tn on tn.TIEPNHAN_ID = stbhyt.TIEPNHAN_ID        left join TT_NOITRU_BENHAN ba on ba.TIEPNHAN_ID = stbhyt.TIEPNHAN_ID        where         stbhyt.TIEPNHAN_ID = '27327' and isnull(stbhyt.KHONGSUDUNG, '0') = '0'         and           ba.BENHAN_ID = '5849']
2019-10-31 10:01:53,700 [1] DEBUG - Statement Id: [DAO00064_GetListVienPhiByTiepNnan] PreparedStatement : [select distinct        B.DOITUONG_ID, B.NGAYMIENDONGCHITRA, B.BENHNHAN_ID as TIEPNHAN_BENHNHAN_ID, B.TRAITUYEN,        B.BHYTTREN3NAM as TREN3NAM, B.BHYTTREN5NAM as TREN5NAM, B.SOTIEPNHAN, B.SOBENHAN,        B.LOAITHANHVIEN_ID, B.SUDUNG_BHTN, B.THE_ID, B.THANHVIEN_ID, B.BAOLANH_VIENPHI, B.VIP, B.NGUOINUOCNGOAI,        C.GIATRIMIENGIAM as GIATRIMIENGIAM, D.GIATRIMIENGIAM as GIATRIMIENGIAM_BHTN, E.GIATRIMIENGIAM as GIATRIMIENGIAM_THANHVIEN,        F.GIATRIMIENGIAM as GIATRIMIENGIAM_CONGTY, DVYC.THE_ID as DVDUNGTHE, DVYC.TRANGTHAI as TRANGTHAIDICHVU, ndv.MANHOMDICHVU,        A.* from TT_VIENPHI A        left join        (select B.*, C.SOBENHAN, C.BENHAN_ID        from TT_TIEPNHAN B        left join TT_NOITRU_BENHAN C on B.TIEPNHAN_ID = C.TIEPNHAN_ID         and           C.BENHAN_ID = '5849'                 where B.TIEPNHAN_ID = '27327') B on B.TIEPNHAN_ID = A.TIEPNHAN_ID        left join (select sum(GIATRIMIENGIAM) as GIATRIMIENGIAM, VIENPHI_ID, REF_TABLE        from TT_MIENGIAM_CHITIET        where REF_TABLE = 'TT_MIENGIAM'        and exists (select MIENGIAM_ID from TT_MIENGIAM where TT_MIENGIAM_CHITIET.MIENGIAM_ID = MIENGIAM_ID and TINHTRANG = 1 and TIEPNHAN_ID = '27327')        group by VIENPHI_ID, REF_TABLE) C on C.REF_TABLE = 'TT_MIENGIAM' and C.VIENPHI_ID = A.VIENPHI_ID        left join (select sum(GIATRIMIENGIAM) as GIATRIMIENGIAM, VIENPHI_ID, REF_TABLE        from TT_MIENGIAM_CHITIET        where REF_TABLE = 'TT_MIENGIAM_BHTN'        and exists (select MIENGIAM_BHTN_ID from TT_MIENGIAM_BHTN where TT_MIENGIAM_CHITIET.MIENGIAM_ID = MIENGIAM_BHTN_ID and  TINHTRANG = 1 and TIEPNHAN_ID = '27327')        group by VIENPHI_ID, REF_TABLE) D on D.REF_TABLE = 'TT_MIENGIAM_BHTN' and D.VIENPHI_ID = A.VIENPHI_ID        left join (select sum(GIATRIMIENGIAM) as GIATRIMIENGIAM, VIENPHI_ID, REF_TABLE        from TT_MIENGIAM_CHITIET        where REF_TABLE = 'TT_MIENGIAM_THANHVIEN'        and exists (select MIENGIAM_THANHVIEN_ID from TT_MIENGIAM_THANHVIEN where TT_MIENGIAM_CHITIET.MIENGIAM_ID = MIENGIAM_THANHVIEN_ID and TINHTRANG = 1 and TIEPNHAN_ID = '27327')        group by VIENPHI_ID, REF_TABLE) E on E.REF_TABLE = 'TT_MIENGIAM_THANHVIEN' and E.VIENPHI_ID = A.VIENPHI_ID        left join (select sum(GIATRIMIENGIAM) as GIATRIMIENGIAM, VIENPHI_ID, REF_TABLE        from TT_MIENGIAM_CHITIET        where REF_TABLE = 'TT_MIENGIAM_CONGTY'        and exists (select MIENGIAM_CONGTY_ID from TT_MIENGIAM_CONGTY where TT_MIENGIAM_CHITIET.MIENGIAM_ID = MIENGIAM_CONGTY_ID and TINHTRANG = 1 and TIEPNHAN_ID = '27327')        group by VIENPHI_ID, REF_TABLE) F on F.REF_TABLE = 'TT_MIENGIAM_CONGTY' and F.VIENPHI_ID = A.VIENPHI_ID        left join TT_DVYEUCAU DVYC on DVYC.DVYEUCAU_ID = A.REF_ID and A.REF_TABLE = 'TT_DVYEUCAU'        left join TM_DICHVU DV on DVYC.DICHVU_ID = DV.DICHVU_ID and A.REF_TABLE = 'TT_DVYEUCAU'        left join TM_NHOMDICHVU ndv on ndv.NHOMDICHVU_ID = DV.NHOMDICHVU_ID and A.REF_TABLE = 'TT_DVYEUCAU'        where        A.TIEPNHAN_ID = '27327' and ((DVYC.HUYYEUCAU = '0' and A.DICHVU_ID is not null)        or A.DUOC_ID is not null or A.REF_TABLE = 'TT_NUT_XACNHANSUATAN_CHITIET')        and A.ACTIVE = '1'         and           A.BENHAN_ID = '5849'                 and A.BENHVIEN_ID = 'HLU01'        order by A.VIENPHI_ID]
2019-10-31 10:01:54,031 [1] DEBUG - Statement Id: [DAO00080_LayLoaiBenhanCuNoitru] PreparedStatement : [select LOAIBENHAN from TT_NOITRU_BENHAN where TIEPNHAN_ID =  @param0]
2019-10-31 10:01:54,031 [1] DEBUG - Statement Id: [DAO00080_LayLoaiBenhanCuNoitru] Parameters: [@param0=[TIEPNHAN_ID,27327]]
2019-10-31 10:01:54,031 [1] DEBUG - Statement Id: [DAO00080_LayLoaiBenhanCuNoitru] Types: [@param0=[Int32, System.Int32]]
2019-10-31 10:01:54,072 [1] DEBUG - Statement Id: [DAO00006_GetListDuocTyle] PreparedStatement : [select DUOC_ID, DOITUONG_ID, (TYLE/100) as TYLE, DONGIA MUCTRAN_THANHTOAN from TM_DOITUONG_GIADUOC_TYLE            where            BENHVIEN_ID = 'HLU01'            and DOITUONG_ID = '3']
2019-10-31 10:01:54,129 [1] DEBUG - Statement Id: [DAO00027_GetListTuongTrinhDichVuPhauThuatCuaTiepNhan] PreparedStatement : [declare @ManhomDSA varchar(10);        declare @PhanLoaiNhomDV varchar(20) = '05';        select top 1  @ManhomDSA = VALUE from TM_SYS_APPSETTINGS where CODE = 'MANHOM_DICHVU_DSA'        if (@ManhomDSA is not null) set @PhanLoaiNhomDV += ',' + @ManhomDSA        select distinct ptyc.*        from TT_PHAUTHUAT_YEUCAU ptyc        inner join TM_DICHVU dv on dv.DICHVU_ID = ptyc.DICHVU_ID        inner join TM_NHOMDICHVU ndv on ndv.NHOMDICHVU_ID = dv.NHOMDICHVU_ID        inner join TT_PHAUTHUAT pt on pt.PHAUTHUAT_ID = ptyc.PHAUTHUAT_ID        where        pt.TIEPNHAN_ID = 27327        and (left(ndv.MANHOMDICHVU, 2) in (select * from STRING_SPLIT(@PhanLoaiNhomDV,',')) or ndv.MANHOMDICHVU in (select * from STRING_SPLIT(@PhanLoaiNhomDV,',')))]
2019-10-31 10:01:56,458 [1] DEBUG - Statement Id: [DAO00006_GetList] PreparedStatement : [select dv.*, loaiDV.MALOAIDICHVU, captren.NHOMDICHVU_ID as NHOMDICHVU_CAPTREN_ID, captren.TENNHOMDICHVU as NHOMDICHVU_CAPTREN,              nhom_dv.TENNHOMDICHVU as TENNHOMDICHVU, nhom_dv.MANHOMDICHVU,              case when dv.ATTRIBUTE5 is null then 'TT' else 'KTC' end as LOAI_CHIPHI              from TM_DICHVU as dv              left join TM_NHOMDICHVU as nhom_dv on nhom_dv.NHOMDICHVU_ID = dv.NHOMDICHVU_ID and nhom_dv.BENHVIEN_ID = 'HLU01'              left join TM_NHOMDICHVU as captren on nhom_dv.CAPTREN_ID = captren.NHOMDICHVU_ID and captren.BENHVIEN_ID = 'HLU01'              left join TM_LOAIDICHVU loaiDV on nhom_dv.LOAIDICHVU_ID = loaiDV.LOAIDICHVU_ID and loaiDV.BENHVIEN_ID = 'HLU01'              where nhom_dv.TAMNGUNG = '0' and dv.BENHVIEN_ID = 'HLU01'              and dv.TAMNGUNG = '0'               AND                   loaiDV.MALOAIDICHVU = 'KhamBenh']
2019-10-31 10:01:56,636 [1] DEBUG - Statement Id: [DAO00023_UpdateNhieuVP] PreparedStatement : [declare @jsonVienPhi nvarchar(max) = N'[{"VIENPHI_ID":670984,"TIEPNHAN_ID":27327,"DICHVU_ID":5492,"BENHAN_ID":5849,"SOLUONG":1.0000,"DONGIA_DOANHTHU":33000.0000,"THANHTIEN_DOANHTHU":33000.00,"BHYT_TL":0.0,"BHYT_DONGIA":0.0,"BHYT_THANHTIEN":0.0,"BHYT_DONGIA_CONGKHAM_DAU":0.0,"BHYT_CONGKHAM_DAU_TYLE":1.0,"BHYT_DONGIA_CHITRA":0.0,"BHYT_THANHTIEN_CHITRA":0.0,"BENHNHAN_PHAITHANHTOAN":33000.00,"GIATRI_HOADON":0.0,"GIATRI_HOADON_DATHANHTOAN":0.0,"GIATRI_BIENLAI":33000.00000000,"GIATRI_BIENLAI_DATHANHTOAN":0.0,"GIATRI_BENHNHAN_DATHANHTOAN":0.0,"DATHUCHIEN":"1","KHONGTHUTIEN":"0","BHYTDONGTIEN":"0","DICHVU_TL":1.0,"BHYT_DONGIA_DONGCT_DAU":0.0,"SOBHYT":"CN338382379621138289","SOBHYT_HUONG_ID":28354,"GIATRIMIENGIAM":0.0,"GIATRIMIENGIAM_BHTN":0.0,"GIATRIMIENGIAM_THANHVIEN":0.0,"GIATRIMIENGIAM_CONGTY":0.0,"BHYT_CK2_KHONGTHANHTOAN":false},{"VIENPHI_ID":671017,"TIEPNHAN_ID":27327,"DICHVU_ID":4523,"BENHAN_ID":5849,"SOLUONG":1.0000,"DONGIA_DOANHTHU":40000.0000,"THANHTIEN_DOANHTHU":40000.00,"BHYT_TL":1.0,"BHYT_DONGIA":40000.0000,"BHYT_THANHTIEN":40000.00,"BHYT_DONGIA_CONGKHAM_DAU":0.0,"BHYT_CONGKHAM_DAU_TYLE":1.0,"BHYT_DONGIA_CHITRA":40000.0,"BHYT_THANHTIEN_CHITRA":40000.00,"BENHNHAN_PHAITHANHTOAN":0.00,"GIATRI_HOADON":0.0,"GIATRI_HOADON_DATHANHTOAN":0.0,"GIATRI_BIENLAI":0.0,"GIATRI_BIENLAI_DATHANHTOAN":0.0,"GIATRI_BENHNHAN_DATHANHTOAN":0.0,"DATHUCHIEN":"1","KHONGTHUTIEN":"0","BHYTDONGTIEN":"0","DICHVU_TL":1.0,"BHYT_DONGIA_DONGCT_DAU":0.0,"SOBHYT":"CN338382379621138289","SOBHYT_HUONG_ID":28354,"GIATRIMIENGIAM":0.0,"GIATRIMIENGIAM_BHTN":0.0,"GIATRIMIENGIAM_THANHVIEN":0.0,"GIATRIMIENGIAM_CONGTY":0.0,"BHYT_CK2_KHONGTHANHTOAN":false},{"VIENPHI_ID":671375,"TIEPNHAN_ID":27327,"DICHVU_ID":null,"BENHAN_ID":5849,"SOLUONG":2.0000,"DONGIA_DOANHTHU":630.0000,"THANHTIEN_DOANHTHU":1260.00,"BHYT_TL":0.0,"BHYT_DONGIA":0.0,"BHYT_THANHTIEN":0.0,"BHYT_DONGIA_CONGKHAM_DAU":0.0,"BHYT_CONGKHAM_DAU_TYLE":1.0,"BHYT_DONGIA_CHITRA":0.0,"BHYT_THANHTIEN_CHITRA":0.0,"BENHNHAN_PHAITHANHTOAN":1260.00,"GIATRI_HOADON":0.0,"GIATRI_HOADON_DATHANHTOAN":0.0,"GIATRI_BIENLAI":1260.00000000,"GIATRI_BIENLAI_DATHANHTOAN":0.0,"GIATRI_BENHNHAN_DATHANHTOAN":0.0,"DATHUCHIEN":"1","KHONGTHUTIEN":"0","BHYTDONGTIEN":"0","DICHVU_TL":1.0,"BHYT_DONGIA_DONGCT_DAU":0.0,"SOBHYT":"CN338382379621138289","SOBHYT_HUONG_ID":28354,"GIATRIMIENGIAM":0.0,"GIATRIMIENGIAM_BHTN":0.0,"GIATRIMIENGIAM_THANHVIEN":0.0,"GIATRIMIENGIAM_CONGTY":0.0,"BHYT_CK2_KHONGTHANHTOAN":false},{"VIENPHI_ID":671376,"TIEPNHAN_ID":27327,"DICHVU_ID":null,"BENHAN_ID":5849,"SOLUONG":2.0000,"DONGIA_DOANHTHU":4000.0000,"THANHTIEN_DOANHTHU":8000.00,"BHYT_TL":0.0,"BHYT_DONGIA":0.0,"BHYT_THANHTIEN":0.0,"BHYT_DONGIA_CONGKHAM_DAU":0.0,"BHYT_CONGKHAM_DAU_TYLE":1.0,"BHYT_DONGIA_CHITRA":0.0,"BHYT_THANHTIEN_CHITRA":0.0,"BENHNHAN_PHAITHANHTOAN":8000.00,"GIATRI_HOADON":0.0,"GIATRI_HOADON_DATHANHTOAN":0.0,"GIATRI_BIENLAI":8000.00000000,"GIATRI_BIENLAI_DATHANHTOAN":0.0,"GIATRI_BENHNHAN_DATHANHTOAN":0.0,"DATHUCHIEN":"1","KHONGTHUTIEN":"0","BHYTDONGTIEN":"0","DICHVU_TL":1.0,"BHYT_DONGIA_DONGCT_DAU":0.0,"SOBHYT":"CN338382379621138289","SOBHYT_HUONG_ID":28354,"GIATRIMIENGIAM":0.0,"GIATRIMIENGIAM_BHTN":0.0,"GIATRIMIENGIAM_THANHVIEN":0.0,"GIATRIMIENGIAM_CONGTY":0.0,"BHYT_CK2_KHONGTHANHTOAN":false},{"VIENPHI_ID":671377,"TIEPNHAN_ID":27327,"DICHVU_ID":null,"BENHAN_ID":5849,"SOLUONG":2.0000,"DONGIA_DOANHTHU":1000.0000,"THANHTIEN_DOANHTHU":2000.00,"BHYT_TL":0.0,"BHYT_DONGIA":0.0,"BHYT_THANHTIEN":0.0,"BHYT_DONGIA_CONGKHAM_DAU":0.0,"BHYT_CONGKHAM_DAU_TYLE":1.0,"BHYT_DONGIA_CHITRA":0.0,"BHYT_THANHTIEN_CHITRA":0.0,"BENHNHAN_PHAITHANHTOAN":2000.00,"GIATRI_HOADON":0.0,"GIATRI_HOADON_DATHANHTOAN":0.0,"GIATRI_BIENLAI":2000.00000000,"GIATRI_BIENLAI_DATHANHTOAN":0.0,"GIATRI_BENHNHAN_DATHANHTOAN":0.0,"DATHUCHIEN":"1","KHONGTHUTIEN":"0","BHYTDONGTIEN":"0","DICHVU_TL":1.0,"BHYT_DONGIA_DONGCT_DAU":0.0,"SOBHYT":"CN338382379621138289","SOBHYT_HUONG_ID":28354,"GIATRIMIENGIAM":0.0,"GIATRIMIENGIAM_BHTN":0.0,"GIATRIMIENGIAM_THANHVIEN":0.0,"GIATRIMIENGIAM_CONGTY":0.0,"BHYT_CK2_KHONGTHANHTOAN":false},{"VIENPHI_ID":671742,"TIEPNHAN_ID":27327,"DICHVU_ID":null,"BENHAN_ID":5849,"SOLUONG":2.0000,"DONGIA_DOANHTHU":45000.0000,"THANHTIEN_DOANHTHU":90000.00,"BHYT_TL":1.0,"BHYT_DONGIA":36410.0000,"BHYT_THANHTIEN":72820.00,"BHYT_DONGIA_CONGKHAM_DAU":0.0,"BHYT_CONGKHAM_DAU_TYLE":1.0,"BHYT_DONGIA_CHITRA":36410.0,"BHYT_THANHTIEN_CHITRA":72820.00,"BENHNHAN_PHAITHANHTOAN":17180.00,"GIATRI_HOADON":0.0,"GIATRI_HOADON_DATHANHTOAN":0.0,"GIATRI_BIENLAI":17180.00,"GIATRI_BIENLAI_DATHANHTOAN":0.0,"GIATRI_BENHNHAN_DATHANHTOAN":0.0,"DATHUCHIEN":"1","KHONGTHUTIEN":"0","BHYTDONGTIEN":"0","DICHVU_TL":0.0,"BHYT_DONGIA_DONGCT_DAU":0.0,"SOBHYT":"CN338382379621138289","SOBHYT_HUONG_ID":28354,"GIATRIMIENGIAM":0.0,"GIATRIMIENGIAM_BHTN":0.0,"GIATRIMIENGIAM_THANHVIEN":0.0,"GIATRIMIENGIAM_CONGTY":0.0,"BHYT_CK2_KHONGTHANHTOAN":false},{"VIENPHI_ID":671761,"TIEPNHAN_ID":27327,"DICHVU_ID":null,"BENHAN_ID":5849,"SOLUONG":1.0000,"DONGIA_DOANHTHU":720.0000,"THANHTIEN_DOANHTHU":720.00,"BHYT_TL":1.0,"BHYT_DONGIA":720.0000,"BHYT_THANHTIEN":720.00,"BHYT_DONGIA_CONGKHAM_DAU":0.0,"BHYT_CONGKHAM_DAU_TYLE":1.0,"BHYT_DONGIA_CHITRA":720.0,"BHYT_THANHTIEN_CHITRA":720.00,"BENHNHAN_PHAITHANHTOAN":0.00,"GIATRI_HOADON":0.0,"GIATRI_HOADON_DATHANHTOAN":0.0,"GIATRI_BIENLAI":0.0,"GIATRI_BIENLAI_DATHANHTOAN":0.0,"GIATRI_BENHNHAN_DATHANHTOAN":0.0,"DATHUCHIEN":"1","KHONGTHUTIEN":"0","BHYTDONGTIEN":"0","DICHVU_TL":0.0,"BHYT_DONGIA_DONGCT_DAU":0.0,"SOBHYT":"CN338382379621138289","SOBHYT_HUONG_ID":28354,"GIATRIMIENGIAM":0.0,"GIATRIMIENGIAM_BHTN":0.0,"GIATRIMIENGIAM_THANHVIEN":0.0,"GIATRIMIENGIAM_CONGTY":0.0,"BHYT_CK2_KHONGTHANHTOAN":false},{"VIENPHI_ID":672718,"TIEPNHAN_ID":27327,"DICHVU_ID":4681,"BENHAN_ID":5849,"SOLUONG":1.0000,"DONGIA_DOANHTHU":21400.0000,"THANHTIEN_DOANHTHU":21400.00,"BHYT_TL":1.0,"BHYT_DONGIA":21400.0000,"BHYT_THANHTIEN":21400.00,"BHYT_DONGIA_CONGKHAM_DAU":0.0,"BHYT_CONGKHAM_DAU_TYLE":1.0,"BHYT_DONGIA_CHITRA":21400.0,"BHYT_THANHTIEN_CHITRA":21400.00,"BENHNHAN_PHAITHANHTOAN":0.00,"GIATRI_HOADON":0.0,"GIATRI_HOADON_DATHANHTOAN":0.0,"GIATRI_BIENLAI":0.0,"GIATRI_BIENLAI_DATHANHTOAN":0.0,"GIATRI_BENHNHAN_DATHANHTOAN":0.0,"DATHUCHIEN":"1","KHONGTHUTIEN":"0","BHYTDONGTIEN":"0","DICHVU_TL":1.0,"BHYT_DONGIA_DONGCT_DAU":0.0,"SOBHYT":"CN338382379621138289","SOBHYT_HUONG_ID":28354,"GIATRIMIENGIAM":0.0,"GIATRIMIENGIAM_BHTN":0.0,"GIATRIMIENGIAM_THANHVIEN":0.0,"GIATRIMIENGIAM_CONGTY":0.0,"BHYT_CK2_KHONGTHANHTOAN":false},{"VIENPHI_ID":672719,"TIEPNHAN_ID":27327,"DICHVU_ID":4722,"BENHAN_ID":5849,"SOLUONG":1.0000,"DONGIA_DOANHTHU":21400.0000,"THANHTIEN_DOANHTHU":21400.00,"BHYT_TL":1.0,"BHYT_DONGIA":21400.0000,"BHYT_THANHTIEN":21400.00,"BHYT_DONGIA_CONGKHAM_DAU":0.0,"BHYT_CONGKHAM_DAU_TYLE":1.0,"BHYT_DONGIA_CHITRA":21400.0,"BHYT_THANHTIEN_CHITRA":21400.00,"BENHNHAN_PHAITHANHTOAN":0.00,"GIATRI_HOADON":0.0,"GIATRI_HOADON_DATHANHTOAN":0.0,"GIATRI_BIENLAI":0.0,"GIATRI_BIENLAI_DATHANHTOAN":0.0,"GIATRI_BENHNHAN_DATHANHTOAN":0.0,"DATHUCHIEN":"1","KHONGTHUTIEN":"0","BHYTDONGTIEN":"0","DICHVU_TL":1.0,"BHYT_DONGIA_DONGCT_DAU":0.0,"SOBHYT":"CN338382379621138289","SOBHYT_HUONG_ID":28354,"GIATRIMIENGIAM":0.0,"GIATRIMIENGIAM_BHTN":0.0,"GIATRIMIENGIAM_THANHVIEN":0.0,"GIATRIMIENGIAM_CONGTY":0.0,"BHYT_CK2_KHONGTHANHTOAN":false},{"VIENPHI_ID":672720,"TIEPNHAN_ID":27327,"DICHVU_ID":4668,"BENHAN_ID":5849,"SOLUONG":1.0000,"DONGIA_DOANHTHU":21400.0000,"THANHTIEN_DOANHTHU":21400.00,"BHYT_TL":1.0,"BHYT_DONGIA":21400.0000,"BHYT_THANHTIEN":21400.00,"BHYT_DONGIA_CONGKHAM_DAU":0.0,"BHYT_CONGKHAM_DAU_TYLE":1.0,"BHYT_DONGIA_CHITRA":21400.0,"BHYT_THANHTIEN_CHITRA":21400.00,"BENHNHAN_PHAITHANHTOAN":0.00,"GIATRI_HOADON":0.0,"GIATRI_HOADON_DATHANHTOAN":0.0,"GIATRI_BIENLAI":0.0,"GIATRI_BIENLAI_DATHANHTOAN":0.0,"GIATRI_BENHNHAN_DATHANHTOAN":0.0,"DATHUCHIEN":"1","KHONGTHUTIEN":"0","BHYTDONGTIEN":"0","DICHVU_TL":1.0,"BHYT_DONGIA_DONGCT_DAU":0.0,"SOBHYT":"CN338382379621138289","SOBHYT_HUONG_ID":28354,"GIATRIMIENGIAM":0.0,"GIATRIMIENGIAM_BHTN":0.0,"GIATRIMIENGIAM_THANHVIEN":0.0,"GIATRIMIENGIAM_CONGTY":0.0,"BHYT_CK2_KHONGTHANHTOAN":false},{"VIENPHI_ID":672721,"TIEPNHAN_ID":27327,"DICHVU_ID":4642,"BENHAN_ID":5849,"SOLUONG":1.0000,"DONGIA_DOANHTHU":21400.0000,"THANHTIEN_DOANHTHU":21400.00,"BHYT_TL":1.0,"BHYT_DONGIA":21400.0000,"BHYT_THANHTIEN":21400.00,"BHYT_DONGIA_CONGKHAM_DAU":0.0,"BHYT_CONGKHAM_DAU_TYLE":1.0,"BHYT_DONGIA_CHITRA":21400.0,"BHYT_THANHTIEN_CHITRA":21400.00,"BENHNHAN_PHAITHANHTOAN":0.00,"GIATRI_HOADON":0.0,"GIATRI_HOADON_DATHANHTOAN":0.0,"GIATRI_BIENLAI":0.0,"GIATRI_BIENLAI_DATHANHTOAN":0.0,"GIATRI_BENHNHAN_DATHANHTOAN":0.0,"DATHUCHIEN":"1","KHONGTHUTIEN":"0","BHYTDONGTIEN":"0","DICHVU_TL":1.0,"BHYT_DONGIA_DONGCT_DAU":0.0,"SOBHYT":"CN338382379621138289","SOBHYT_HUONG_ID":28354,"GIATRIMIENGIAM":0.0,"GIATRIMIENGIAM_BHTN":0.0,"GIATRIMIENGIAM_THANHVIEN":0.0,"GIATRIMIENGIAM_CONGTY":0.0,"BHYT_CK2_KHONGTHANHTOAN":false},{"VIENPHI_ID":672722,"TIEPNHAN_ID":27327,"DICHVU_ID":4641,"BENHAN_ID":5849,"SOLUONG":1.0000,"DONGIA_DOANHTHU":21400.0000,"THANHTIEN_DOANHTHU":21400.00,"BHYT_TL":1.0,"BHYT_DONGIA":21400.0000,"BHYT_THANHTIEN":21400.00,"BHYT_DONGIA_CONGKHAM_DAU":0.0,"BHYT_CONGKHAM_DAU_TYLE":1.0,"BHYT_DONGIA_CHITRA":21400.0,"BHYT_THANHTIEN_CHITRA":21400.00,"BENHNHAN_PHAITHANHTOAN":0.00,"GIATRI_HOADON":0.0,"GIATRI_HOADON_DATHANHTOAN":0.0,"GIATRI_BIENLAI":0.0,"GIATRI_BIENLAI_DATHANHTOAN":0.0,"GIATRI_BENHNHAN_DATHANHTOAN":0.0,"DATHUCHIEN":"1","KHONGTHUTIEN":"0","BHYTDONGTIEN":"0","DICHVU_TL":1.0,"BHYT_DONGIA_DONGCT_DAU":0.0,"SOBHYT":"CN338382379621138289","SOBHYT_HUONG_ID":28354,"GIATRIMIENGIAM":0.0,"GIATRIMIENGIAM_BHTN":0.0,"GIATRIMIENGIAM_THANHVIEN":0.0,"GIATRIMIENGIAM_CONGTY":0.0,"BHYT_CK2_KHONGTHANHTOAN":false},{"VIENPHI_ID":672724,"TIEPNHAN_ID":27327,"DICHVU_ID":4017,"BENHAN_ID":5849,"SOLUONG":1.0000,"DONGIA_DOANHTHU":42100.0000,"THANHTIEN_DOANHTHU":42100.00,"BHYT_TL":1.0,"BHYT_DONGIA":42100.0000,"BHYT_THANHTIEN":42100.00,"BHYT_DONGIA_CONGKHAM_DAU":0.0,"BHYT_CONGKHAM_DAU_TYLE":1.0,"BHYT_DONGIA_CHITRA":42100.0,"BHYT_THANHTIEN_CHITRA":42100.00,"BENHNHAN_PHAITHANHTOAN":0.00,"GIATRI_HOADON":0.0,"GIATRI_HOADON_DATHANHTOAN":0.0,"GIATRI_BIENLAI":0.0,"GIATRI_BIENLAI_DATHANHTOAN":0.0,"GIATRI_BENHNHAN_DATHANHTOAN":0.0,"DATHUCHIEN":"0","KHONGTHUTIEN":"0","BHYTDONGTIEN":"0","DICHVU_TL":1.0,"BHYT_DONGIA_DONGCT_DAU":0.0,"SOBHYT":"CN338382379621138289","SOBHYT_HUONG_ID":28354,"GIATRIMIENGIAM":0.0,"GIATRIMIENGIAM_BHTN":0.0,"GIATRIMIENGIAM_THANHVIEN":0.0,"GIATRIMIENGIAM_CONGTY":0.0,"BHYT_CK2_KHONGTHANHTOAN":false},{"VIENPHI_ID":672725,"TIEPNHAN_ID":27327,"DICHVU_ID":4129,"BENHAN_ID":5849,"SOLUONG":1.0000,"DONGIA_DOANHTHU":64200.0000,"THANHTIEN_DOANHTHU":64200.00,"BHYT_TL":1.0,"BHYT_DONGIA":64200.0000,"BHYT_THANHTIEN":64200.00,"BHYT_DONGIA_CONGKHAM_DAU":0.0,"BHYT_CONGKHAM_DAU_TYLE":1.0,"BHYT_DONGIA_CHITRA":64200.0,"BHYT_THANHTIEN_CHITRA":64200.00,"BENHNHAN_PHAITHANHTOAN":0.00,"GIATRI_HOADON":0.0,"GIATRI_HOADON_DATHANHTOAN":0.0,"GIATRI_BIENLAI":0.0,"GIATRI_BIENLAI_DATHANHTOAN":0.0,"GIATRI_BENHNHAN_DATHANHTOAN":0.0,"DATHUCHIEN":"0","KHONGTHUTIEN":"0","BHYTDONGTIEN":"0","DICHVU_TL":1.0,"BHYT_DONGIA_DONGCT_DAU":0.0,"SOBHYT":"CN338382379621138289","SOBHYT_HUONG_ID":28354,"GIATRIMIENGIAM":0.0,"GIATRIMIENGIAM_BHTN":0.0,"GIATRIMIENGIAM_THANHVIEN":0.0,"GIATRIMIENGIAM_CONGTY":0.0,"BHYT_CK2_KHONGTHANHTOAN":false},{"VIENPHI_ID":672881,"TIEPNHAN_ID":27327,"DICHVU_ID":4683,"BENHAN_ID":5849,"SOLUONG":1.0000,"DONGIA_DOANHTHU":19200.0000,"THANHTIEN_DOANHTHU":19200.00,"BHYT_TL":1.0,"BHYT_DONGIA":19200.0000,"BHYT_THANHTIEN":19200.00,"BHYT_DONGIA_CONGKHAM_DAU":0.0,"BHYT_CONGKHAM_DAU_TYLE":1.0,"BHYT_DONGIA_CHITRA":19200.0,"BHYT_THANHTIEN_CHITRA":19200.00,"BENHNHAN_PHAITHANHTOAN":0.00,"GIATRI_HOADON":0.0,"GIATRI_HOADON_DATHANHTOAN":0.0,"GIATRI_BIENLAI":0.0,"GIATRI_BIENLAI_DATHANHTOAN":0.0,"GIATRI_BENHNHAN_DATHANHTOAN":0.0,"DATHUCHIEN":"1","KHONGTHUTIEN":"0","BHYTDONGTIEN":"0","DICHVU_TL":1.0,"BHYT_DONGIA_DONGCT_DAU":0.0,"SOBHYT":"CN338382379621138289","SOBHYT_HUONG_ID":28354,"GIATRIMIENGIAM":0.0,"GIATRIMIENGIAM_BHTN":0.0,"GIATRIMIENGIAM_THANHVIEN":0.0,"GIATRIMIENGIAM_CONGTY":0.0,"BHYT_CK2_KHONGTHANHTOAN":false},{"VIENPHI_ID":673566,"TIEPNHAN_ID":27327,"DICHVU_ID":4747,"BENHAN_ID":5849,"SOLUONG":1.0000,"DONGIA_DOANHTHU":27300.0000,"THANHTIEN_DOANHTHU":27300.00,"BHYT_TL":1.0,"BHYT_DONGIA":27300.0000,"BHYT_THANHTIEN":27300.00,"BHYT_DONGIA_CONGKHAM_DAU":0.0,"BHYT_CONGKHAM_DAU_TYLE":1.0,"BHYT_DONGIA_CHITRA":27300.0,"BHYT_THANHTIEN_CHITRA":27300.00,"BENHNHAN_PHAITHANHTOAN":0.00,"GIATRI_HOADON":0.0,"GIATRI_HOADON_DATHANHTOAN":0.0,"GIATRI_BIENLAI":0.0,"GIATRI_BIENLAI_DATHANHTOAN":0.0,"GIATRI_BENHNHAN_DATHANHTOAN":0.0,"DATHUCHIEN":"0","KHONGTHUTIEN":"0","BHYTDONGTIEN":"0","DICHVU_TL":1.0,"BHYT_DONGIA_DONGCT_DAU":0.0,"SOBHYT":"CN338382379621138289","SOBHYT_HUONG_ID":28354,"GIATRIMIENGIAM":0.0,"GIATRIMIENGIAM_BHTN":0.0,"GIATRIMIENGIAM_THANHVIEN":0.0,"GIATRIMIENGIAM_CONGTY":0.0,"BHYT_CK2_KHONGTHANHTOAN":false}]';        begin        UPDATE TT_VIENPHI        SET        SOLUONG = json.SOLUONG,        DONGIA_DOANHTHU = json.DONGIA_DOANHTHU,        THANHTIEN_DOANHTHU = json.THANHTIEN_DOANHTHU,        BHYT_TL = json.BHYT_TL,        BHYT_DONGIA = json.BHYT_DONGIA,        BHYT_THANHTIEN = json.BHYT_THANHTIEN,        BHYT_DONGIA_CONGKHAM_DAU = json.BHYT_DONGIA_CONGKHAM_DAU,        BHYT_CONGKHAM_DAU_TYLE = json.BHYT_CONGKHAM_DAU_TYLE,        BHYT_DONGIA_CHITRA = json.BHYT_DONGIA_CHITRA,        BHYT_THANHTIEN_CHITRA = json.BHYT_THANHTIEN_CHITRA,        BENHNHAN_PHAITHANHTOAN = json.BENHNHAN_PHAITHANHTOAN,        GIATRI_HOADON = json.GIATRI_HOADON,                GIATRI_BIENLAI = json.GIATRI_BIENLAI,                DATHUCHIEN = json.DATHUCHIEN,                DICHVU_TL = json.DICHVU_TL,        BHYT_DONGIA_DONGCT_DAU = json.BHYT_DONGIA_DONGCT_DAU,        NGAYCAPNHAT = GETDATE()        FROM OPENJSON (@jsonVienPhi)        WITH (        VIENPHI_ID int,        SOLUONG numeric(25, 4),        DONGIA_DOANHTHU numeric(25, 4),        THANHTIEN_DOANHTHU numeric(25, 4),        BHYT_TL numeric(25, 4),        BHYT_DONGIA numeric(25, 4),        BHYT_THANHTIEN numeric(25, 4),        BHYT_DONGIA_CONGKHAM_DAU numeric(25, 4),        BHYT_CONGKHAM_DAU_TYLE numeric(25, 4),        BHYT_DONGIA_CHITRA numeric(25, 4),        BHYT_THANHTIEN_CHITRA numeric(25, 4),        BENHNHAN_PHAITHANHTOAN numeric(25, 4),        GIATRI_HOADON numeric(25, 4),                GIATRI_BIENLAI numeric(25, 4),                DATHUCHIEN char(1),        KHONGTHUTIEN char(1),        BHYTDONGTIEN char(1),        DICHVU_TL numeric(25, 4),        BHYT_DONGIA_DONGCT_DAU numeric(25, 4))  json        WHERE TT_VIENPHI.VIENPHI_ID = json.VIENPHI_ID and json.DONGIA_DOANHTHU > 0                  insert into TT_TINH_VIENPHI_LOG        SELECT json.VIENPHI_ID, json.TIEPNHAN_ID, json.BENHAN_ID, json.SOLUONG, json.BHYT_TL, json.DONGIA_DOANHTHU,        json.THANHTIEN_DOANHTHU, json.BHYT_DONGIA, json.BHYT_THANHTIEN, json.BHYT_DONGIA_CHITRA, json.BHYT_THANHTIEN_CHITRA, json.BENHNHAN_PHAITHANHTOAN,        json.SOBHYT_HUONG_ID, json.SOBHYT, GETDATE(), -1, 'HLU01'        FROM OPENJSON(@jsonVienPhi)        WITH (        VIENPHI_ID int,        TIEPNHAN_ID int,        BENHAN_ID int,        SOLUONG numeric(25, 4),        DONGIA_DOANHTHU numeric(25, 4),        THANHTIEN_DOANHTHU numeric(25, 4),        BHYT_TL numeric(25, 4),        BHYT_DONGIA numeric(25, 4),        BHYT_THANHTIEN numeric(25, 4),        BHYT_DONGIA_CHITRA numeric(25, 4),        BHYT_THANHTIEN_CHITRA numeric(25, 4),        BENHNHAN_PHAITHANHTOAN numeric(25, 4),        SOBHYT_HUONG_ID int,        SOBHYT nvarchar(30)) json        end]
2019-10-31 10:01:56,949 [1] DEBUG - Statement Id: [DAO00067_UpdateDataVienPhiDongiaBHYT] PreparedStatement : [update TT_VIENPHI          set BHYT_DONGIA_CHITRA = 0, BHYT_THANHTIEN = 0, BHYT_THANHTIEN_CHITRA = 0          where          TIEPNHAN_ID = 27327 and BHYT_DONGIA = 0          and (BHYT_DONGIA_CHITRA > 0 or BHYT_THANHTIEN > 0 or BHYT_THANHTIEN_CHITRA > 0)]
2019-10-31 10:01:56,992 [1] DEBUG - Statement Id: [DAO00067_CapnhatDataVienphiKhiHuyThanhtoanHoadon] PreparedStatement : [update TT_VIENPHI        set TT_VIENPHI.HOADON_ID = hdct.HOADON_ID, TT_VIENPHI.GIATRI_BENHNHAN_DATHANHTOAN = TT_VIENPHI.GIATRI_BENHNHAN_DATHANHTOAN + hdct.GIATRI_BENHNHAN_DATHANHTOAN        from (select CT.HOADON_ID, CT.VIENPHI_ID, CT.GIATRI_BENHNHAN_DATHANHTOAN        from TT_HOADON_CHITIET_NGOAITRU CT        join TT_HOADON HD on HD.HOADON_ID = CT.HOADON_ID        join TT_VIENPHI vp on vp.VIENPHI_ID = ct.VIENPHI_ID        where HD.DATHANHTOAN = 1 and HD.HUYHOADON = 0 and HD.HOANTRA = 0 and vp.TIEPNHAN_ID =  @param0 ) hdct        where        TT_VIENPHI.VIENPHI_ID = hdct.VIENPHI_ID and TT_VIENPHI.HOADON_ID is null and isnull(TT_VIENPHI.GIATRI_BENHNHAN_DATHANHTOAN,0) = 0        and TT_VIENPHI.TIEPNHAN_ID =  @param0           update TT_VIENPHI        set TT_VIENPHI.HOADON_ID = null, TT_VIENPHI.GIATRI_BENHNHAN_DATHANHTOAN = TT_VIENPHI.GIATRI_BENHNHAN_DATHANHTOAN - hdct.GIATRI_BENHNHAN_DATHANHTOAN,        TT_VIENPHI.DATHANHTOAN = '0'        from (select CT.HOADON_ID, CT.VIENPHI_ID, CT.GIATRI_BENHNHAN_DATHANHTOAN        from TT_HOADON_CHITIET_NGOAITRU CT        join TT_HOADON HD on HD.HOADON_ID = CT.HOADON_ID        join TT_VIENPHI vp on vp.VIENPHI_ID = ct.VIENPHI_ID and vp.HOADON_ID = ct.HOADON_ID        where HD.DATHANHTOAN = 0 and (HD.HUYHOADON = 1 or HD.HOANTRA = 1) and vp.TIEPNHAN_ID =  @param0 ) hdct        where        TT_VIENPHI.VIENPHI_ID = hdct.VIENPHI_ID and TT_VIENPHI.HOADON_ID = hdct.HOADON_ID        and TT_VIENPHI.TIEPNHAN_ID =  @param0]
2019-10-31 10:01:56,992 [1] DEBUG - Statement Id: [DAO00067_CapnhatDataVienphiKhiHuyThanhtoanHoadon] Parameters: [@param0=[TIEPNHAN_ID,27327]]
2019-10-31 10:01:56,992 [1] DEBUG - Statement Id: [DAO00067_CapnhatDataVienphiKhiHuyThanhtoanHoadon] Types: [@param0=[Int64, System.Int64]]
2019-10-31 10:02:03,418 [1] DEBUG - Statement Id: [DAO00000_GetDoiTuongIsBHYT] PreparedStatement : [select * from TM_DOITUONG Where DOITUONG_ID = 3 and MADOITUONG like '%BHYT%']
2019-10-31 10:02:03,512 [1] DEBUG - Statement Id: [DAO00064_GetDOITUONG] PreparedStatement : [SELECT TOP 1      DT.TENDOITUONG,      BHYT.SOTHE,      BHYT.NGAYHIEULUC,      BHYT.NGAYHETHIEULUC,      BHYT.BENHVIEN_KCB_ID AS MABENHVIEN,      BV.TENBENHVIEN,      BHYT.NGAYMIENDONGCHITRA,      BHYT.TREN5NAM        FROM TT_BENHNHAN_BHYT BHYT, TM_DOITUONG DT, TM_BENHVIEN BV      WHERE      DT.NHOMTHE LIKE '%' + LEFT(BHYT.SOTHE,3) + '%'      AND BHYT.BENHNHAN_ID = '23301'      AND BHYT.BENHVIEN_KCB_ID = BV.MABENHVIEN      ORDER BY BHYT.NGAYTAO DESC]
2019-10-31 10:02:05,215 [1] DEBUG - Statement Id: [DAO00064_GetNgayDangKyDichVu] PreparedStatement : [SELECT        DISTINCT CONVERT(date, NGAYTAO) as NGAYCHIPHI        FROM TT_VIENPHI        WHERE        TIEPNHAN_ID = '27327'         and           BENHAN_ID = '5849'                 ORDER BY NGAYCHIPHI]
2019-10-31 10:02:05,255 [1] DEBUG - Statement Id: [DAO00064_GetAllNgayYeucauDV] PreparedStatement : [SELECT        DISTINCT DVYEUCAU_ID, DICHVU_ID, CONVERT(date, NGAYYEUCAU) NGAYYEUCAU        FROM TT_DVYEUCAU        WHERE        TIEPNHAN_ID = '27327'         and           BENHAN_ID = '5849']
2019-10-31 10:02:05,355 [1] DEBUG - Statement Id: [DAO00064_GetAllNgayYeucauYlenh] PreparedStatement : [SELECT        DISTINCT A.TOATHUOC_ID, A.KHAMBENH_ID, A.DUOC_ID, CONVERT(date, B.THOIGIANKHAM) NGAYYEUCAU        FROM TT_NOITRU_TOATHUOC A        inner join TT_NOITRU_KHAMBENH B on B.KHAMBENH_ID = A.KHAMBENH_ID        WHERE        B.BENHAN_ID = '5849']
2019-10-31 10:02:05,754 [1] DEBUG - Statement Id: [DAO00063_AllGetTrangThaiThuocbyBenan_Id] PreparedStatement : [select A.CHUNGTU_ID, A.PHIEULINH_ID, A.HUYTOATHUOC, A.NGUOITAO_ID, A.TOATHUOC_ID        from TT_NOITRU_TOATHUOC A        inner join TT_NOITRU_KHAMBENH B on B.KHAMBENH_ID = A.KHAMBENH_ID        where B.BENHAN_ID  = '5849']
2019-10-31 10:02:05,795 [1] DEBUG - Statement Id: [DAO00064_TT_VIENPHI_GetList] PreparedStatement : [select distinct a.*, b.TINHTRANG AS TINHTRANG_MG, d.TINHTRANG_BHTN, e.TINHTRANG_MGCT        , b.MIENGIAMCHITIET_ID, b.GIATRIMIENGIAM, d.GIATRIMIENGIAM_BHTN, e.GIATRIMIENGIAM_CONGTY, e.GIATRIMIENGIAM_CONGTY as GIATRIMIENGIAM_CTCT, f.GIATRIMIENGIAM_THANHVIEN        , c.DVKEMTHEO, c.DVKEMTHEO_KHACEKIP, isnull(ttnt.PHONGBANRATOA_ID,c.NOIYEUCAU_ID) NOIYEUCAU_ID, c.NOITHUCHIEN_ID, c.DVYEUCAU_ID, c.HUYYEUCAU, c.DANGKY_ID,        isnull(dv.TENDICHVU, dc.TENDUOCDAYDU) NOIDUNG, isnull(dv.MADICHVU, dc.MADUOC) MADICHVU, dv.NORESULT, dc.DONVITINH, ld.MALOAIDUOC, dc.BHYT DUOC_BHYT, ld.LOAIVATTU_ID, ndv.MANHOMDICHVU        from        (select VP.*, sbh.SOBHYT as SOBHYT_HUONG        from TT_VIENPHI VP        left join TT_TIEPNHAN_SOTHEBHYT sbh on sbh.SOBHYT_HUONG_ID = VP.SOBHYT_HUONG_ID        where        ((isnull(VP.GIATRI_BENHNHAN_DATHANHTOAN, 0) = 0 and isnull(VP.DATHANHTOAN, 0) = 0)        and VP.REF_TABLE != 'TT_MAU_CHUNGTU_CHITIET'                 )         and             VP.TIEPNHAN_ID = '27327'           and           VP.BENHAN_ID = '5849'         and             VP.BENHVIEN_ID = 'HLU01'                   )a left join                         (        select VIENPHI_ID, MG.TINHTRANG, MGCT.MIENGIAMCHITIET_ID, Sum(MGCT.GIATRIMIENGIAM) as GIATRIMIENGIAM        from TT_MIENGIAM MG INNER JOIN TT_MIENGIAM_CHITIET MGCT ON MG.MIENGIAM_ID = MGCT.MIENGIAM_ID        where MG.TIEPNHAN_ID= '27327' and MGCT.REF_TABLE = 'TT_MIENGIAM'        group by VIENPHI_ID, MG.TINHTRANG, MGCT.MIENGIAMCHITIET_ID        )b        on a.VIENPHI_ID = b.VIENPHI_ID          left join(        select VIENPHI_ID, MG.TINHTRANG AS TINHTRANG_BHTN, SUM(MGCT.GIATRIMIENGIAM) as GIATRIMIENGIAM_BHTN        from TT_MIENGIAM_BHTN MG INNER JOIN TT_MIENGIAM_CHITIET MGCT ON MG.MIENGIAM_BHTN_ID = MGCT.MIENGIAM_ID        where MG.TIEPNHAN_ID= '27327' and MGCT.REF_TABLE = 'TT_MIENGIAM_BHTN'        group by VIENPHI_ID, MG.TINHTRANG        )d        on a.VIENPHI_ID = d.VIENPHI_ID          left join(        select VIENPHI_ID, MG.TINHTRANG AS TINHTRANG_MGCT, Sum(MGCT.GIATRIMIENGIAM) as GIATRIMIENGIAM_CONGTY        from TT_MIENGIAM_CONGTY MG INNER JOIN TT_MIENGIAM_CHITIET MGCT ON MG.MIENGIAM_CONGTY_ID = MGCT.MIENGIAM_ID        where MG.TIEPNHAN_ID= '27327' and MGCT.REF_TABLE = 'TT_MIENGIAM_CONGTY'        group by VIENPHI_ID, MG.TINHTRANG        )e        on a.VIENPHI_ID = e.VIENPHI_ID          left join(        select VIENPHI_ID, MG.TINHTRANG AS TINHTRANG_MGCT, Sum(MGCT.GIATRIMIENGIAM) as GIATRIMIENGIAM_THANHVIEN        from TT_MIENGIAM_THANHVIEN MG INNER JOIN TT_MIENGIAM_CHITIET MGCT ON MG.MIENGIAM_THANHVIEN_ID = MGCT.MIENGIAM_ID        where MG.TIEPNHAN_ID= '27327' and MGCT.REF_TABLE = 'TT_MIENGIAM_THANHVIEN'        group by VIENPHI_ID, MG.TINHTRANG        )f        on a.VIENPHI_ID = f.VIENPHI_ID          left join        (        select DVYEUCAU_ID, TRANGTHAI, BHYTDONGTIEN, HUYYEUCAU, DVKEMTHEO, DVKEMTHEO_KHACEKIP, NOIYEUCAU_ID, NOITHUCHIEN_ID, DANGKY_ID from TT_DVYEUCAU        where TIEPNHAN_ID = '27327'        )c on c.DVYEUCAU_ID = a.REF_ID and a.REF_TABLE = 'TT_DVYEUCAU'        left join        (        select PHONGBANRATOA_ID, TOATHUOC_ID, 'TT_NOITRU_TOATHUOC' REF_TABLE  from TT_NOITRU_TOATHUOC where TIEPNHAN_ID  = '27327'        union        select PHONGBAN_ID as PHONGBANRATOA_ID, CLSKETQUA_VTYT_ID as TOATHUOC_ID, 'TT_CLSKETQUA_VTYT' REF_TABLE        from TT_CLSKETQUA_VTYT where exists (select DVYEUCAU_ID from TT_DVYEUCAU where TT_CLSKETQUA_VTYT.DVYEUCAU_ID = DVYEUCAU_ID and TIEPNHAN_ID  = '27327')        union        select PHONGBAN_ID as PHONGBANRATOA_ID, KHAMBENH_VTYT_ID as TOATHUOC_ID, 'TT_NGOAITRU_KHAMBENH_VTYT' REF_TABLE        from TT_NGOAITRU_KHAMBENH_VTYT where exists (select DVYEUCAU_ID from TT_DVYEUCAU where TT_NGOAITRU_KHAMBENH_VTYT.DVYEUCAU_ID = DVYEUCAU_ID and  TIEPNHAN_ID  = '27327')        union        select B.PHONGBANTHUCHIEN_ID as PHONGBANRATOA_ID, PHAUTHUAT_VTYT_ID as TOATHUOC_ID, 'TT_PHAUTHUAT_VTYT' REF_TABLE        from TT_PHAUTHUAT_VTYT A        left join TT_PHAUTHUAT B on A.PHAUTHUAT_ID = B.PHAUTHUAT_ID        where B.TIEPNHAN_ID  = '27327'        union        select B.PHONGBAN_ID as PHONGBANRATOA_ID, TOATHUOC_ID, 'TT_NGOAITRU_TOATHUOC' REF_TABLE        from TT_NGOAITRU_TOATHUOC A        left join TT_NGOAITRU_KHAMBENH B on A.KHAMBENH_ID = B.KHAMBENH_ID        where B.TIEPNHAN_ID  = '27327'        ) ttnt on ttnt.TOATHUOC_ID = a.REF_ID and a.REF_TABLE = ttnt.REF_TABLE        left join TM_DUOC dc on A.DUOC_ID = dc.DUOC_ID        left join TM_LOAIDUOC ld on dc.LOAIDUOC_ID = ld.LOAIDUOC_ID        left join TM_DICHVU dv on A.DICHVU_ID = dv.DICHVU_ID and A.REF_TABLE = 'TT_DVYEUCAU'        left join TM_NHOMDICHVU ndv on ndv.NHOMDICHVU_ID = dv.NHOMDICHVU_ID        where        c.HUYYEUCAU = '0' or c.HUYYEUCAU is null]
2019-10-31 10:02:06,459 [1] DEBUG - Statement Id: [DAO00009_TT_TIEPNHAN_GetProcess] PreparedStatement : [select PROCESS_ID from TT_TIEPNHAN where SOTIEPNHAN = 'TN190604.0000201']
2019-10-31 10:02:06,677 [1] DEBUG - Statement Id: [DAOWF004_laytrangthaiDV] PreparedStatement : [select top 1 A.CURR_STATE_CODE as STATE_CODE, isNull(C.SHORT_NAME,C.NAME) as TRANGTHAI, C.NAME as TRANGTHAI_CHITIET, C.STATUS_CODE, D.ISACTIVE as ACTIVE, E.STATUS_CODE  as OLD_STATUSCODE        from TT_REQUEST_SERVICE_DETAIL A                left join (select * from TT_REQUEST_SERVICE where PARA = '{"DICHVU_ID":"5492","DVYEUCAU_ID":"204342"}') D on D.ID = A.REQUEST_SERVICE_ID        left join TM_STATE C on A.CURR_STATE_CODE = C.STATE_CODE and C.PROCESS_CODE = D.PROCESS_CODE        left join TM_STATE E on A.OLD_STATE_CODE = E.STATE_CODE and E.PROCESS_CODE = D.PROCESS_CODE        where        A.REQUEST_SERVICE_ID = (select top 1 ID from TT_REQUEST_SERVICE where PARA = '{"DICHVU_ID":"5492","DVYEUCAU_ID":"204342"}' order by ID desc)        order by A.ID desc]
2019-10-31 10:02:11,011 [1] DEBUG - Statement Id: [DAO00091_GetList] PreparedStatement : [select DICHVU_ID from TM_DICHVU_PHANNHOMDICHVU        where PHANNHOMDICHVU_ID in (select PHANNHOMDICHVU_ID                                    from TM_PHANNHOMDICHVU                                    where MAPHANNHOMDICHVU = 'KTC')        and BENHVIEN_ID = 'HLU01']
2019-10-31 10:02:11,047 [1] DEBUG - Statement Id: [DAO00056_GetList] PreparedStatement : [select * from TM_LOAIGIA where BENHVIEN_ID = 'HLU01']
2019-10-31 10:02:11,590 [1] DEBUG - Statement Id: [DAO00009_TT_TIEPNHAN_GetProcess] PreparedStatement : [select PROCESS_ID from TT_TIEPNHAN where SOTIEPNHAN = 'TN190604.0000201']
2019-10-31 10:02:11,669 [1] DEBUG - Statement Id: [DAOWF004_laytrangthaiDV] PreparedStatement : [select top 1 A.CURR_STATE_CODE as STATE_CODE, isNull(C.SHORT_NAME,C.NAME) as TRANGTHAI, C.NAME as TRANGTHAI_CHITIET, C.STATUS_CODE, D.ISACTIVE as ACTIVE, E.STATUS_CODE  as OLD_STATUSCODE        from TT_REQUEST_SERVICE_DETAIL A                left join (select * from TT_REQUEST_SERVICE where PARA = '{"DICHVU_ID":"4523","DVYEUCAU_ID":"204364"}') D on D.ID = A.REQUEST_SERVICE_ID        left join TM_STATE C on A.CURR_STATE_CODE = C.STATE_CODE and C.PROCESS_CODE = D.PROCESS_CODE        left join TM_STATE E on A.OLD_STATE_CODE = E.STATE_CODE and E.PROCESS_CODE = D.PROCESS_CODE        where        A.REQUEST_SERVICE_ID = (select top 1 ID from TT_REQUEST_SERVICE where PARA = '{"DICHVU_ID":"4523","DVYEUCAU_ID":"204364"}' order by ID desc)        order by A.ID desc]
2019-10-31 10:02:11,804 [1] DEBUG - Statement Id: [DAO00009_TT_TIEPNHAN_GetProcess] PreparedStatement : [select PROCESS_ID from TT_TIEPNHAN where SOTIEPNHAN = 'TN190604.0000201']
2019-10-31 10:02:11,898 [1] DEBUG - Statement Id: [DAOWF004_laytrangthaiDV] PreparedStatement : [select top 1 A.CURR_STATE_CODE as STATE_CODE, isNull(C.SHORT_NAME,C.NAME) as TRANGTHAI, C.NAME as TRANGTHAI_CHITIET, C.STATUS_CODE, D.ISACTIVE as ACTIVE, E.STATUS_CODE  as OLD_STATUSCODE        from TT_REQUEST_SERVICE_DETAIL A                left join (select * from TT_REQUEST_SERVICE where PARA = '{"DICHVU_ID":"4681","DVYEUCAU_ID":"204870"}') D on D.ID = A.REQUEST_SERVICE_ID        left join TM_STATE C on A.CURR_STATE_CODE = C.STATE_CODE and C.PROCESS_CODE = D.PROCESS_CODE        left join TM_STATE E on A.OLD_STATE_CODE = E.STATE_CODE and E.PROCESS_CODE = D.PROCESS_CODE        where        A.REQUEST_SERVICE_ID = (select top 1 ID from TT_REQUEST_SERVICE where PARA = '{"DICHVU_ID":"4681","DVYEUCAU_ID":"204870"}' order by ID desc)        order by A.ID desc]
2019-10-31 10:02:12,429 [1] DEBUG - Statement Id: [DAO00009_TT_TIEPNHAN_GetProcess] PreparedStatement : [select PROCESS_ID from TT_TIEPNHAN where SOTIEPNHAN = 'TN190604.0000201']
2019-10-31 10:02:12,529 [1] DEBUG - Statement Id: [DAOWF004_laytrangthaiDV] PreparedStatement : [select top 1 A.CURR_STATE_CODE as STATE_CODE, isNull(C.SHORT_NAME,C.NAME) as TRANGTHAI, C.NAME as TRANGTHAI_CHITIET, C.STATUS_CODE, D.ISACTIVE as ACTIVE, E.STATUS_CODE  as OLD_STATUSCODE        from TT_REQUEST_SERVICE_DETAIL A                left join (select * from TT_REQUEST_SERVICE where PARA = '{"DICHVU_ID":"4722","DVYEUCAU_ID":"204871"}') D on D.ID = A.REQUEST_SERVICE_ID        left join TM_STATE C on A.CURR_STATE_CODE = C.STATE_CODE and C.PROCESS_CODE = D.PROCESS_CODE        left join TM_STATE E on A.OLD_STATE_CODE = E.STATE_CODE and E.PROCESS_CODE = D.PROCESS_CODE        where        A.REQUEST_SERVICE_ID = (select top 1 ID from TT_REQUEST_SERVICE where PARA = '{"DICHVU_ID":"4722","DVYEUCAU_ID":"204871"}' order by ID desc)        order by A.ID desc]
2019-10-31 10:02:12,690 [1] DEBUG - Statement Id: [DAO00009_TT_TIEPNHAN_GetProcess] PreparedStatement : [select PROCESS_ID from TT_TIEPNHAN where SOTIEPNHAN = 'TN190604.0000201']
2019-10-31 10:02:12,757 [1] DEBUG - Statement Id: [DAOWF004_laytrangthaiDV] PreparedStatement : [select top 1 A.CURR_STATE_CODE as STATE_CODE, isNull(C.SHORT_NAME,C.NAME) as TRANGTHAI, C.NAME as TRANGTHAI_CHITIET, C.STATUS_CODE, D.ISACTIVE as ACTIVE, E.STATUS_CODE  as OLD_STATUSCODE        from TT_REQUEST_SERVICE_DETAIL A                left join (select * from TT_REQUEST_SERVICE where PARA = '{"DICHVU_ID":"4668","DVYEUCAU_ID":"204872"}') D on D.ID = A.REQUEST_SERVICE_ID        left join TM_STATE C on A.CURR_STATE_CODE = C.STATE_CODE and C.PROCESS_CODE = D.PROCESS_CODE        left join TM_STATE E on A.OLD_STATE_CODE = E.STATE_CODE and E.PROCESS_CODE = D.PROCESS_CODE        where        A.REQUEST_SERVICE_ID = (select top 1 ID from TT_REQUEST_SERVICE where PARA = '{"DICHVU_ID":"4668","DVYEUCAU_ID":"204872"}' order by ID desc)        order by A.ID desc]
2019-10-31 10:02:12,911 [1] DEBUG - Statement Id: [DAO00009_TT_TIEPNHAN_GetProcess] PreparedStatement : [select PROCESS_ID from TT_TIEPNHAN where SOTIEPNHAN = 'TN190604.0000201']
2019-10-31 10:02:12,986 [1] DEBUG - Statement Id: [DAOWF004_laytrangthaiDV] PreparedStatement : [select top 1 A.CURR_STATE_CODE as STATE_CODE, isNull(C.SHORT_NAME,C.NAME) as TRANGTHAI, C.NAME as TRANGTHAI_CHITIET, C.STATUS_CODE, D.ISACTIVE as ACTIVE, E.STATUS_CODE  as OLD_STATUSCODE        from TT_REQUEST_SERVICE_DETAIL A                left join (select * from TT_REQUEST_SERVICE where PARA = '{"DICHVU_ID":"4642","DVYEUCAU_ID":"204873"}') D on D.ID = A.REQUEST_SERVICE_ID        left join TM_STATE C on A.CURR_STATE_CODE = C.STATE_CODE and C.PROCESS_CODE = D.PROCESS_CODE        left join TM_STATE E on A.OLD_STATE_CODE = E.STATE_CODE and E.PROCESS_CODE = D.PROCESS_CODE        where        A.REQUEST_SERVICE_ID = (select top 1 ID from TT_REQUEST_SERVICE where PARA = '{"DICHVU_ID":"4642","DVYEUCAU_ID":"204873"}' order by ID desc)        order by A.ID desc]
2019-10-31 10:02:13,141 [1] DEBUG - Statement Id: [DAO00009_TT_TIEPNHAN_GetProcess] PreparedStatement : [select PROCESS_ID from TT_TIEPNHAN where SOTIEPNHAN = 'TN190604.0000201']
2019-10-31 10:02:13,211 [1] DEBUG - Statement Id: [DAOWF004_laytrangthaiDV] PreparedStatement : [select top 1 A.CURR_STATE_CODE as STATE_CODE, isNull(C.SHORT_NAME,C.NAME) as TRANGTHAI, C.NAME as TRANGTHAI_CHITIET, C.STATUS_CODE, D.ISACTIVE as ACTIVE, E.STATUS_CODE  as OLD_STATUSCODE        from TT_REQUEST_SERVICE_DETAIL A                left join (select * from TT_REQUEST_SERVICE where PARA = '{"DICHVU_ID":"4641","DVYEUCAU_ID":"204874"}') D on D.ID = A.REQUEST_SERVICE_ID        left join TM_STATE C on A.CURR_STATE_CODE = C.STATE_CODE and C.PROCESS_CODE = D.PROCESS_CODE        left join TM_STATE E on A.OLD_STATE_CODE = E.STATE_CODE and E.PROCESS_CODE = D.PROCESS_CODE        where        A.REQUEST_SERVICE_ID = (select top 1 ID from TT_REQUEST_SERVICE where PARA = '{"DICHVU_ID":"4641","DVYEUCAU_ID":"204874"}' order by ID desc)        order by A.ID desc]
2019-10-31 10:02:13,382 [1] DEBUG - Statement Id: [DAO00009_TT_TIEPNHAN_GetProcess] PreparedStatement : [select PROCESS_ID from TT_TIEPNHAN where SOTIEPNHAN = 'TN190604.0000201']
2019-10-31 10:02:13,458 [1] DEBUG - Statement Id: [DAOWF004_laytrangthaiDV] PreparedStatement : [select top 1 A.CURR_STATE_CODE as STATE_CODE, isNull(C.SHORT_NAME,C.NAME) as TRANGTHAI, C.NAME as TRANGTHAI_CHITIET, C.STATUS_CODE, D.ISACTIVE as ACTIVE, E.STATUS_CODE  as OLD_STATUSCODE        from TT_REQUEST_SERVICE_DETAIL A                left join (select * from TT_REQUEST_SERVICE where PARA = '{"DICHVU_ID":"4017","DVYEUCAU_ID":"204876"}') D on D.ID = A.REQUEST_SERVICE_ID        left join TM_STATE C on A.CURR_STATE_CODE = C.STATE_CODE and C.PROCESS_CODE = D.PROCESS_CODE        left join TM_STATE E on A.OLD_STATE_CODE = E.STATE_CODE and E.PROCESS_CODE = D.PROCESS_CODE        where        A.REQUEST_SERVICE_ID = (select top 1 ID from TT_REQUEST_SERVICE where PARA = '{"DICHVU_ID":"4017","DVYEUCAU_ID":"204876"}' order by ID desc)        order by A.ID desc]
2019-10-31 10:02:13,607 [1] DEBUG - Statement Id: [DAO00009_TT_TIEPNHAN_GetProcess] PreparedStatement : [select PROCESS_ID from TT_TIEPNHAN where SOTIEPNHAN = 'TN190604.0000201']
2019-10-31 10:02:13,672 [1] DEBUG - Statement Id: [DAOWF004_laytrangthaiDV] PreparedStatement : [select top 1 A.CURR_STATE_CODE as STATE_CODE, isNull(C.SHORT_NAME,C.NAME) as TRANGTHAI, C.NAME as TRANGTHAI_CHITIET, C.STATUS_CODE, D.ISACTIVE as ACTIVE, E.STATUS_CODE  as OLD_STATUSCODE        from TT_REQUEST_SERVICE_DETAIL A                left join (select * from TT_REQUEST_SERVICE where PARA = '{"DICHVU_ID":"4129","DVYEUCAU_ID":"204877"}') D on D.ID = A.REQUEST_SERVICE_ID        left join TM_STATE C on A.CURR_STATE_CODE = C.STATE_CODE and C.PROCESS_CODE = D.PROCESS_CODE        left join TM_STATE E on A.OLD_STATE_CODE = E.STATE_CODE and E.PROCESS_CODE = D.PROCESS_CODE        where        A.REQUEST_SERVICE_ID = (select top 1 ID from TT_REQUEST_SERVICE where PARA = '{"DICHVU_ID":"4129","DVYEUCAU_ID":"204877"}' order by ID desc)        order by A.ID desc]
2019-10-31 10:02:13,825 [1] DEBUG - Statement Id: [DAO00009_TT_TIEPNHAN_GetProcess] PreparedStatement : [select PROCESS_ID from TT_TIEPNHAN where SOTIEPNHAN = 'TN190604.0000201']
2019-10-31 10:02:13,896 [1] DEBUG - Statement Id: [DAOWF004_laytrangthaiDV] PreparedStatement : [select top 1 A.CURR_STATE_CODE as STATE_CODE, isNull(C.SHORT_NAME,C.NAME) as TRANGTHAI, C.NAME as TRANGTHAI_CHITIET, C.STATUS_CODE, D.ISACTIVE as ACTIVE, E.STATUS_CODE  as OLD_STATUSCODE        from TT_REQUEST_SERVICE_DETAIL A                left join (select * from TT_REQUEST_SERVICE where PARA = '{"DICHVU_ID":"4683","DVYEUCAU_ID":"204915"}') D on D.ID = A.REQUEST_SERVICE_ID        left join TM_STATE C on A.CURR_STATE_CODE = C.STATE_CODE and C.PROCESS_CODE = D.PROCESS_CODE        left join TM_STATE E on A.OLD_STATE_CODE = E.STATE_CODE and E.PROCESS_CODE = D.PROCESS_CODE        where        A.REQUEST_SERVICE_ID = (select top 1 ID from TT_REQUEST_SERVICE where PARA = '{"DICHVU_ID":"4683","DVYEUCAU_ID":"204915"}' order by ID desc)        order by A.ID desc]
2019-10-31 10:02:14,053 [1] DEBUG - Statement Id: [DAO00009_TT_TIEPNHAN_GetProcess] PreparedStatement : [select PROCESS_ID from TT_TIEPNHAN where SOTIEPNHAN = 'TN190604.0000201']
2019-10-31 10:02:14,124 [1] DEBUG - Statement Id: [DAOWF004_laytrangthaiDV] PreparedStatement : [select top 1 A.CURR_STATE_CODE as STATE_CODE, isNull(C.SHORT_NAME,C.NAME) as TRANGTHAI, C.NAME as TRANGTHAI_CHITIET, C.STATUS_CODE, D.ISACTIVE as ACTIVE, E.STATUS_CODE  as OLD_STATUSCODE        from TT_REQUEST_SERVICE_DETAIL A                left join (select * from TT_REQUEST_SERVICE where PARA = '{"DICHVU_ID":"4747","DVYEUCAU_ID":"205093"}') D on D.ID = A.REQUEST_SERVICE_ID        left join TM_STATE C on A.CURR_STATE_CODE = C.STATE_CODE and C.PROCESS_CODE = D.PROCESS_CODE        left join TM_STATE E on A.OLD_STATE_CODE = E.STATE_CODE and E.PROCESS_CODE = D.PROCESS_CODE        where        A.REQUEST_SERVICE_ID = (select top 1 ID from TT_REQUEST_SERVICE where PARA = '{"DICHVU_ID":"4747","DVYEUCAU_ID":"205093"}' order by ID desc)        order by A.ID desc]
2019-10-31 10:02:14,455 [1] DEBUG - Statement Id: [DAO00017_GetLoaiGiaDoiTuongDichVu] PreparedStatement : [select a.LOAIGIA_ID, a.TENLOAIGIA, a.MALOAIGIA, a.CAPTREN_ID, MIN(a.UUTIEN_NGUON) AS UUTIEN_NGUON          , MAX(a.DOUUTIEN) AS DOUUTIEN, MIN(ISNULL(a.GIAHOTRO,0)) AS GIAHOTRO          from(                        select distinct A.LOAIGIA_ID, C.TENLOAIGIA, C.MALOAIGIA, 0 as UUTIEN_NGUON, isnull(B.DOUUTIEN,0) as DOUUTIEN, B.GIAHOTRO, C.CAPTREN_ID            from TM_DOITUONG_GIADICHVU A            left join TM_DOITUONG_LOAIGIA B on A.LOAIGIA_ID = B.LOAIGIA_ID and A.DOITUONG_ID = B.DOITUONG_ID and B.BENHVIEN_ID = 'HLU01'            inner join TM_LOAIGIA C on A.LOAIGIA_ID = C.LOAIGIA_ID and C.BENHVIEN_ID = 'HLU01'            where A.DOITUONG_ID = '3'                            and C.CAPTREN_ID = (select LOAIGIA_ID from TM_LOAIGIA              where MALOAIGIA = 'GiaDichVu'              and BENHVIEN_ID = 'HLU01')                         and A.BENHVIEN_ID = 'HLU01'                     ) a          where a.DOUUTIEN != 0 and a.DOUUTIEN is not null          group by a.LOAIGIA_ID, a.TENLOAIGIA, a.MALOAIGIA, a.CAPTREN_ID          order by MAX(a.UUTIEN_NGUON) desc ,MAX(a.DOUUTIEN) asc]
2019-10-31 10:02:16,222 [1] DEBUG - Statement Id: [DAO00019_Get_TiepNhan_ThongtinChuyenVien] PreparedStatement : [select CHANDOANNGT, ICDNOIGIOITHIEU_ID, LYDOCHUYENVIEN_ID, NOIGIOITHIEU_ID, HINHTHUCCHUYENVIEN_ID, THOIGIANCHUYENTUYEN, SOCHUYENVIEN        from TT_TIEPNHAN        where TIEPNHAN_ID = '27327']
2019-10-31 10:02:16,264 [1] DEBUG - Statement Id: [DAO00019_GetBenhNhanThanhVien] PreparedStatement : [select A.*, B.TENTHETHANHVIEN, convert(varchar, A.NGAYHIEULUC, 103) as NGAYHIEULUCTHE, B.SOTIEN        from TT_CSKH_THANHVIEN_CAPTHE A        left join TM_CSKH_THETHANHVIEN B on B.THETHANHVIEN_ID = A.THETHANHVIEN_ID        where   THANHVIEN_ID in (        select THANHVIEN_ID from TT_CSKH_THANHVIEN        where (BENHNHAN_ID = '23301' and TAMNGUNG is null or TAMNGUNG = '0')        and (DAXOA is null or DAXOA = '0'))        and A.KICHHOAT = '1' and (A.TAMNGUNG = '0' or A.TAMNGUNG is null)                 and A.BENHVIEN_ID = 'HLU01'        order by THE_ID desc]
2019-10-31 10:02:16,303 [1] DEBUG - Statement Id: [DAO00019_GetBenhNhanThanhVien] PreparedStatement : [select A.*, B.TENTHETHANHVIEN, convert(varchar, A.NGAYHIEULUC, 103) as NGAYHIEULUCTHE, B.SOTIEN        from TT_CSKH_THANHVIEN_CAPTHE A        left join TM_CSKH_THETHANHVIEN B on B.THETHANHVIEN_ID = A.THETHANHVIEN_ID        where   THANHVIEN_ID in (        select THANHVIEN_ID from TT_CSKH_THANHVIEN        where (BENHNHAN_ID = '23301' and TAMNGUNG is null or TAMNGUNG = '0')        and (DAXOA is null or DAXOA = '0'))        and A.KICHHOAT = '1' and (A.TAMNGUNG = '0' or A.TAMNGUNG is null)                 and A.BENHVIEN_ID = 'HLU01'        order by THE_ID desc]
2019-10-31 10:02:24,610 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'IPD62'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2019-10-31 10:02:25,117 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'COM98'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2019-10-31 10:02:25,926 [1] DEBUG - Statement Id: [DAO00012_GetList] PreparedStatement : [select        DICTIONARY_ID,        DICTIONARY_CODE,        DICTIONARY_NAME,        ATTRIBUTE1,        ATTRIBUTE2,        DICTIONARY_NAME_EN        from LST_DICTIONARY        where LST_DICTIONARY.Enabled = '1'         AND           LST_DICTIONARY.DICTIONARY_TYPE_CODE = 'PhanLoaiTiepNhan'                 order by LST_DICTIONARY.IDX]
2019-10-31 10:02:25,964 [1] DEBUG - Statement Id: [DAO00019_GetThongTinTiepNhanByKey] PreparedStatement : [select top 1 A.*, B.MAYTE, B.TENBENHNHAN, B.NAMSINH, B.NGAYSINH        from TT_TIEPNHAN A        inner join TT_BENHNHAN B on B.BENHNHAN_ID = A.BENHNHAN_ID and B.BENHVIEN_ID = A.BENHVIEN_ID        where A.TIEPNHAN_ID = 27327        and A.BENHVIEN_ID = 'HLU01']
--------------------------------------------------------------------------------
2019-10-31 10:04:35,421 [1] DEBUG - Statement Id: [DAO00001_DBList] PreparedStatement : [select *              from TM_SYS_SERVER              where HOSPITAL_ID = '_SYSTEM_' and TYPE = 'D']
2019-10-31 10:04:35,708 [1] DEBUG - Statement Id: [DAO00001_DaoList] PreparedStatement : [select              TM_SYS_SERVICEMAP.ID,              TM_SYS_SERVICEMAP.HOSPITAL_ID,              TM_SYS_SERVICEMAP.DB_NAME,              TM_SYS_SERVICEMAP.TYPE,              TM_SYS_SERVICEMAP.NAME,              TM_SYS_SERVICEMAP.CLASS,              (TM_SYS_DIC.VALUE + '.' + TM_SYS_SERVICEMAP.CLASS) as CLASSFULL,              TM_SYS_SERVICEMAP.ASSEMBLY              from TM_SYS_SERVICEMAP              inner join TM_SYS_DIC              on TM_SYS_SERVICEMAP.NAMESPACE = TM_SYS_DIC.ID              where HOSPITAL_ID = '_SYSTEM_' AND TYPE = 'D' AND ACTIVE = '1'              order by DB_NAME]
2019-10-31 10:04:35,748 [1] DEBUG - Statement Id: [DAO00001_ServiceList] PreparedStatement : [select              TM_SYS_SERVICEMAP.ID,              TM_SYS_SERVICEMAP.HOSPITAL_ID,              TM_SYS_SERVICEMAP.DB_NAME,              TM_SYS_SERVICEMAP.TYPE,              TM_SYS_SERVICEMAP.NAME,              TM_SYS_SERVICEMAP.CLASS,              (TM_SYS_DIC.VALUE + '.' + TM_SYS_SERVICEMAP.CLASS) as CLASSFULL,              TM_SYS_SERVICEMAP.ASSEMBLY,              TM_SYS_SERVER.URL              from TM_SYS_SERVICEMAP              inner join TM_SYS_DIC on TM_SYS_SERVICEMAP.NAMESPACE = TM_SYS_DIC.ID              inner join TM_SYS_SERVER on (TM_SYS_SERVICEMAP.DB_NAME = TM_SYS_SERVER.NAME) and (TM_SYS_SERVER.HOSPITAL_ID = '_SYSTEM_')              where TM_SYS_SERVICEMAP.HOSPITAL_ID = '_SYSTEM_' AND TM_SYS_SERVICEMAP.TYPE = 'S'  AND ACTIVE = '1'              order by URL]
2019-10-31 10:04:36,315 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = '_SYSTEM_'               AND                   TM_SYS_SCREEN.PAGE = 'LOGIN'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2019-10-31 10:04:36,622 [1] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = '_SYSTEM_'               AND                   TM_SYS_CACHE.ACTIVE = '1']
2019-10-31 10:04:48,285 [1] DEBUG - Statement Id: [DAO00001_DBList] PreparedStatement : [select *              from TM_SYS_SERVER              where HOSPITAL_ID = 'HLU01' and TYPE = 'D']
2019-10-31 10:04:48,313 [1] DEBUG - Statement Id: [DAO00001_DaoList] PreparedStatement : [select              TM_SYS_SERVICEMAP.ID,              TM_SYS_SERVICEMAP.HOSPITAL_ID,              TM_SYS_SERVICEMAP.DB_NAME,              TM_SYS_SERVICEMAP.TYPE,              TM_SYS_SERVICEMAP.NAME,              TM_SYS_SERVICEMAP.CLASS,              (TM_SYS_DIC.VALUE + '.' + TM_SYS_SERVICEMAP.CLASS) as CLASSFULL,              TM_SYS_SERVICEMAP.ASSEMBLY              from TM_SYS_SERVICEMAP              inner join TM_SYS_DIC              on TM_SYS_SERVICEMAP.NAMESPACE = TM_SYS_DIC.ID              where HOSPITAL_ID = 'HLU01' AND TYPE = 'D' AND ACTIVE = '1'              order by DB_NAME]
2019-10-31 10:04:50,291 [1] DEBUG - Statement Id: [DAO00001_ServiceList] PreparedStatement : [select              TM_SYS_SERVICEMAP.ID,              TM_SYS_SERVICEMAP.HOSPITAL_ID,              TM_SYS_SERVICEMAP.DB_NAME,              TM_SYS_SERVICEMAP.TYPE,              TM_SYS_SERVICEMAP.NAME,              TM_SYS_SERVICEMAP.CLASS,              (TM_SYS_DIC.VALUE + '.' + TM_SYS_SERVICEMAP.CLASS) as CLASSFULL,              TM_SYS_SERVICEMAP.ASSEMBLY,              TM_SYS_SERVER.URL              from TM_SYS_SERVICEMAP              inner join TM_SYS_DIC on TM_SYS_SERVICEMAP.NAMESPACE = TM_SYS_DIC.ID              inner join TM_SYS_SERVER on (TM_SYS_SERVICEMAP.DB_NAME = TM_SYS_SERVER.NAME) and (TM_SYS_SERVER.HOSPITAL_ID = 'HLU01')              where TM_SYS_SERVICEMAP.HOSPITAL_ID = 'HLU01' AND TM_SYS_SERVICEMAP.TYPE = 'S'  AND ACTIVE = '1'              order by URL]
2019-10-31 10:04:50,404 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1']
2019-10-31 10:04:51,265 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM005']
2019-10-31 10:04:51,437 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM015']
2019-10-31 10:04:51,517 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM067']
2019-10-31 10:04:51,608 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM008']
2019-10-31 10:04:51,695 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM068']
2019-10-31 10:04:51,801 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM006']
2019-10-31 10:04:51,932 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM030']
2019-10-31 10:04:52,036 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM025']
2019-10-31 10:04:52,133 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM024']
2019-10-31 10:04:52,651 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM033']
2019-10-31 10:04:53,096 [5] DEBUG - Statement Id: [DAO00027_GetListDuocKyGuiTonKho] PreparedStatement : [select  distinct TT_TONKHO.DUOC_KEY, LTRIM(TT_TONKHO.KHODUOC_ID) as KHODUOC_ID, TM_DUOC.DUOC_ID, TM_LOAIDUOC.MALOAIDUOC,TM_DUOC.SOVISA,TM_DUOC.TYLE_VAT,TM_DUOC.COTOA,        TM_DUOC.MADUOC, TM_DUOC.TENHANG, TM_DUOC.TENDUOCDAYDU, dvt.TENDONVITINH as DONVITINH,  TM_DUOC.DONVITINH_ID,TM_DUOC.BHYT,TM_DUOC.PHAMVI,        TM_DUOC.TENHOATCHAT, TM_DUOC.HAMLUONG, TM_DUOC.HANGSANXUAT, TM_DUOC.QUOCGIA, TM_DUOC.LOAIDUOC_ID, TM_DUOC.DUONGDUNG_ID,        TM_TENDUOC.TENDUOC, TM_TENDUOC.TENDUOC_EN, TM_TENDUOC.MAQUOCTE, TM_TENDUOC.MAQUOCTEBT,        TM_LOAIDUOC.LOAIVATTU_ID, TM_DUOC.BENHVIEN_ID,TT_TONKHO.SOLUONG, TT_TONKHO.NGUONDUOC_ID, NH.TENNGUONDUOC        , TAMNGUNG = CASE WHEN TM_DUOC.TAMNGUNG = '1' OR nh.TAMNGUNG = '1' OR KD.TAMNGUNG = '1' THEN '1' ELSE '0' END        , TM_DUOC.DANGTRINHBAY        from TM_DUOC        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = TM_DUOC.DONVITINH_ID        left join TM_TENDUOC on TM_DUOC.TENDUOC_ID = TM_TENDUOC.TENDUOC_ID and TM_DUOC.BENHVIEN_ID = 'HLU01' and TM_DUOC.TAMNGUNG = '0'        left join TM_LOAIDUOC on TM_LOAIDUOC.LOAIDUOC_ID = TM_DUOC.LOAIDUOC_ID and TM_LOAIDUOC.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG on (TM_LOAIDUOC.LOAIVATTU_ID = TM_DUOC_HANDUNG.LOAIDUOC and TM_DUOC_HANDUNG.BENHVIEN_ID = 'HLU01')        inner join        (select LTRIM(A.KHODUOC_ID) + '_' + LTRIM(A.DUOC_ID) + '_' + LTRIM(ISNULL(A.NGUONDUOC_ID,'')) as DUOC_KEY, A.KHODUOC_ID, A.DUOC_ID,A.NGUONDUOC_ID,        SUM(isnull(A.SOLUONG,0)) as SOLUONG        from        (select SUM(SOLUONG) as SOLUONG, KHODUOC_ID, DUOC_ID, NGUONDUOC_ID from TT_DUOC_KYGUI_TONKHO        where BENHVIEN_ID = 'HLU01' group by KHODUOC_ID, DUOC_ID, NGUONDUOC_ID) A        group by LTRIM(A.KHODUOC_ID) + '_' + LTRIM(A.DUOC_ID) + '_' + LTRIM(A.NGUONDUOC_ID), A.KHODUOC_ID, A.DUOC_ID, A.NGUONDUOC_ID)        TT_TONKHO on TT_TONKHO.DUOC_ID = TM_DUOC.DUOC_ID        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = TT_TONKHO.NGUONDUOC_ID and nh.BENHVIEN_ID = 'HLU01'        LEFT JOIN TM_KHODUOC KD ON KD.KHODUOC_ID = TT_TONKHO.KHODUOC_ID        where TM_DUOC.BENHVIEN_ID = 'HLU01' AND TT_TONKHO.SOLUONG >= 0]
2019-10-31 10:04:53,209 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM018']
2019-10-31 10:04:53,278 [5] DEBUG - Statement Id: [DAO00027_GetListDuocTonKho] PreparedStatement : [select distinct TT_TONKHO.DUOC_KEY, LTRIM(TT_TONKHO.KHODUOC_ID) as KHODUOC_ID, TM_DUOC.DUOC_ID, TM_LOAIDUOC.MALOAIDUOC,TM_DUOC.SOVISA,TM_DUOC.TYLE_VAT,TM_DUOC.COTOA,        TM_DUOC.MADUOC, TM_DUOC.TENHANG, TM_DUOC.TENDUOCDAYDU, dvt.TENDONVITINH as DONVITINH,  TM_DUOC.DONVITINH_ID,TM_DUOC.BHYT,                TM_DUOC.TENHOATCHAT,          TM_DUOC.HAMLUONG, TM_DUOC.HANGSANXUAT, TM_DUOC.QUOCGIA, TM_DUOC.LOAIDUOC_ID, TM_DUOC.DUONGDUNG_ID,        TM_TENDUOC.TENDUOC, TM_TENDUOC.TENDUOC_EN, TM_TENDUOC.MAQUOCTE, TM_TENDUOC.MAQUOCTEBT,        TM_LOAIDUOC.LOAIVATTU_ID, TM_DUOC.BENHVIEN_ID,        TT_TONKHO.SOLUONG, TM_DUOC.VTYT_PHANLOAI, TM_DUOC.PHAMVI, TT_TONKHO.NGUONDUOC_ID, NG.TENNGUONDUOC AS TENNGUONDUOC        , TAMNGUNG = CASE WHEN TM_DUOC.TAMNGUNG = '1' OR NG.TAMNGUNG = '1' OR KD.TAMNGUNG = '1' THEN '1' ELSE '0' END        , TM_DUOC.DANGTRINHBAY        from TM_DUOC        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = TM_DUOC.DONVITINH_ID        left join TM_TENDUOC on TM_DUOC.TENDUOC_ID = TM_TENDUOC.TENDUOC_ID and TM_DUOC.BENHVIEN_ID = 'HLU01' and TM_DUOC.TAMNGUNG = '0'        left join TM_LOAIDUOC on TM_LOAIDUOC.LOAIDUOC_ID = TM_DUOC.LOAIDUOC_ID and TM_LOAIDUOC.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG on (TM_LOAIDUOC.LOAIVATTU_ID = TM_DUOC_HANDUNG.LOAIDUOC and TM_DUOC_HANDUNG.BENHVIEN_ID = 'HLU01')        inner join        (select LTRIM(A.KHODUOC_ID) + '_' + LTRIM(A.DUOC_ID) + '_' + LTRIM(ISNULL(A.NGUONDUOC_ID,'')) as DUOC_KEY, A.KHODUOC_ID, A.DUOC_ID, A.NGUONDUOC_ID,        SUM(isnull(A.SOLUONG,0)) as SOLUONG        from        (select SUM(SOLUONG) as SOLUONG, KHODUOC_ID, DUOC_ID, NGUONDUOC_ID from TT_DUOC_TONKHO        where BENHVIEN_ID = 'HLU01' group by KHODUOC_ID, DUOC_ID, NGUONDUOC_ID) A        group by LTRIM(A.KHODUOC_ID) + '_' + LTRIM(A.DUOC_ID) + '_' + LTRIM(ISNULL(A.NGUONDUOC_ID,'')), A.KHODUOC_ID, A.DUOC_ID, NGUONDUOC_ID        ) TT_TONKHO on TT_TONKHO.DUOC_ID = TM_DUOC.DUOC_ID        LEFT JOIN TM_NGUONHANG NG ON NG.NGUONDUOC_ID = TT_TONKHO.NGUONDUOC_ID        LEFT JOIN TM_KHODUOC KD ON KD.KHODUOC_ID = TT_TONKHO.KHODUOC_ID        where TM_DUOC.BENHVIEN_ID = 'HLU01' and TT_TONKHO.SOLUONG >= 0]
2019-10-31 10:04:54,269 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM023']
2019-10-31 10:04:54,310 [5] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoVaBooking] PreparedStatement : [declare @NGUONDUOC_MACDINH varchar(5) = '0';        declare @TOAMUANGOAI int = 0;        select @NGUONDUOC_MACDINH = isnull(VALUE,0) from TM_SYS_APPSETTINGS where CODE = 'PHA_NGUONDUOC'        select @TOAMUANGOAI = isnull(VALUE,0) from TM_SYS_APPSETTINGS where CODE = 'OPD_TOAMUANGOAI_DUNGDANHMUC_DUOC'                if @TOAMUANGOAI = 1        begin        select  distinct '0' + '_' + LTRIM(d.DUOC_ID) + '_' + @NGUONDUOC_MACDINH as DUOC_KEY, 0 as PHAMVI_ID, @NGUONDUOC_MACDINH as NGUONDUOC_ID, null as TENNGUONDUOC, null as TINHTIEN, d.DUOC_ID, ld.MALOAIDUOC,        d.SOVISA,d.TYLE_VAT,d.COTOA, d.MADUOC, d.TENHANG, d.TENDUOCDAYDU, d.DONVITINH as DONVITINH, d.BHYT,        d.TENHOATCHAT, d.HAMLUONG, d.HANGSANXUAT, d.QUOCGIA, d.LOAIDUOC_ID, d.DUONGDUNG_ID, d.TINHTIEN_PTTT,        ten.TENDUOC, ten.TENDUOC_EN, ten.MAQUOCTE, ten.MAQUOCTEBT,        '' as BHYT_TEXT        , ld.LOAIVATTU_ID        , d.BENHVIEN_ID,        999999999 as SOLUONG, d.VTYT_PHANLOAI, d.PHAMVI, d.SUASOLUONGTONGHOP, d.MADUOCBV, d.DANGTRINHBAY        , TAMNGUNG = CASE WHEN d.TAMNGUNG = '1' THEN '1' ELSE '0' END        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        union all        select  distinct tk.DUOC_KEY, LTRIM(tk.PHAMVI_ID) as PHAMVI_ID, tk.NGUONDUOC_ID, nh.TENNGUONDUOC, nh.TINHTIEN, d.DUOC_ID, ld.MALOAIDUOC,        d.SOVISA,d.TYLE_VAT,d.COTOA, d.MADUOC, d.TENHANG, d.TENDUOCDAYDU, d.DONVITINH as DONVITINH, d.BHYT,        d.TENHOATCHAT, d.HAMLUONG, d.HANGSANXUAT, d.QUOCGIA, d.LOAIDUOC_ID, d.DUONGDUNG_ID, d.TINHTIEN_PTTT,        ten.TENDUOC, ten.TENDUOC_EN, ten.MAQUOCTE, ten.MAQUOCTEBT,        CASE WHEN d.BHYT = '1' THEN 'BHYT' ELSE '' END as BHYT_TEXT        , ld.LOAIVATTU_ID        , d.BENHVIEN_ID,        tk.SOLUONG, d.VTYT_PHANLOAI, d.PHAMVI, d.SUASOLUONGTONGHOP, d.MADUOCBV, d.DANGTRINHBAY        , TAMNGUNG = CASE WHEN d.TAMNGUNG = '1' OR nh.TAMNGUNG = '1' OR kd.TAMNGUNG = '1' THEN '1' ELSE '0' END        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        inner join        (        select  LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')) DUOC_KEY, (SUM(dtk.SOLUONG) - isnull(sum(A.SOLUONG),0) - isnull(sum(B.SOLUONG),0)) SOLUONG, pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        from (select sum(soluong) soluong,duoc_id,nguonduoc_id,khoduoc_id,benhvien_id from TT_DUOC_TONKHO  group by duoc_id,nguonduoc_id,khoduoc_id,benhvien_id) dtk        inner join TM_DUOC_PHAMVISD_MAPPING pvsd on dtk.KHODUOC_ID = pvsd.KHODUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NOITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) B on B.DUOC_ID = dtk.DUOC_ID and B.SOLUONG > 0 and B.PHAMVI_ID = pvsd.PHAMVI_ID and B.NGUONHANG_ID = dtk.NGUONDUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NGOAITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) A on A.DUOC_ID = dtk.DUOC_ID and A.SOLUONG > 0 and A.PHAMVI_ID = pvsd.PHAMVI_ID and A.NGUONHANG_ID = dtk.NGUONDUOC_ID        where dtk.SOLUONG > 0 and dtk.BENHVIEN_ID = 'HLU01'        group by LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')), pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        ) tk on tk.DUOC_ID = d.DUOC_ID        left join TM_DUOC_PHAMVISUDUNG kd on kd.PHAMVI_ID = tk.PHAMVI_ID and kd.BENHVIEN_ID = 'HLU01'        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = tk.NGUONDUOC_ID and nh.BENHVIEN_ID = 'HLU01'        where d.BENHVIEN_ID = 'HLU01'  and tk.SOLUONG >= 0        end        else        begin                  select  distinct tk.DUOC_KEY, LTRIM(tk.PHAMVI_ID) as PHAMVI_ID, tk.NGUONDUOC_ID, nh.TENNGUONDUOC, nh.TINHTIEN, d.DUOC_ID, ld.MALOAIDUOC,        d.SOVISA,d.TYLE_VAT,d.COTOA, d.MADUOC, d.TENHANG, d.TENDUOCDAYDU, d.DONVITINH as DONVITINH, d.BHYT,        d.TENHOATCHAT, d.HAMLUONG, d.HANGSANXUAT, d.QUOCGIA, d.LOAIDUOC_ID, d.DUONGDUNG_ID, d.TINHTIEN_PTTT,        ten.TENDUOC, ten.TENDUOC_EN, ten.MAQUOCTE, ten.MAQUOCTEBT,        CASE WHEN d.BHYT = '1' THEN 'BHYT' ELSE '' END as BHYT_TEXT        , ld.LOAIVATTU_ID        , d.BENHVIEN_ID,        tk.SOLUONG, d.VTYT_PHANLOAI, d.PHAMVI, d.SUASOLUONGTONGHOP, d.MADUOCBV, d.DANGTRINHBAY        , TAMNGUNG = CASE WHEN d.TAMNGUNG = '1' OR nh.TAMNGUNG = '1' OR kd.TAMNGUNG = '1' THEN '1' ELSE '0' END        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        inner join        (        select  LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')) DUOC_KEY, (SUM(dtk.SOLUONG) - isnull(sum(A.SOLUONG),0) - isnull(sum(B.SOLUONG),0)) SOLUONG, pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        from (select sum(soluong) soluong,duoc_id,nguonduoc_id,khoduoc_id,benhvien_id from TT_DUOC_TONKHO  group by duoc_id,nguonduoc_id,khoduoc_id,benhvien_id) dtk        inner join TM_DUOC_PHAMVISD_MAPPING pvsd on dtk.KHODUOC_ID = pvsd.KHODUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NOITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) B on B.DUOC_ID = dtk.DUOC_ID and B.SOLUONG > 0 and B.PHAMVI_ID = pvsd.PHAMVI_ID and B.NGUONHANG_ID = dtk.NGUONDUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NGOAITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) A on A.DUOC_ID = dtk.DUOC_ID and A.SOLUONG > 0 and A.PHAMVI_ID = pvsd.PHAMVI_ID and A.NGUONHANG_ID = dtk.NGUONDUOC_ID        where dtk.SOLUONG > 0 and dtk.BENHVIEN_ID = 'HLU01'        group by LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')), pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        ) tk on tk.DUOC_ID = d.DUOC_ID        left join TM_DUOC_PHAMVISUDUNG kd on kd.PHAMVI_ID = tk.PHAMVI_ID and kd.BENHVIEN_ID = 'HLU01'        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = tk.NGUONDUOC_ID and nh.BENHVIEN_ID = 'HLU01'        where d.BENHVIEN_ID = 'HLU01'  and tk.SOLUONG >= 0        end]
2019-10-31 10:04:56,295 [5] DEBUG - Statement Id: [DAO00320_GetList] PreparedStatement : [select M.*            from TM_MAU M            LEFT JOIN TM_MAU_DONVITINH DVT on M.DONVITINH_ID=DVT.DONVITINH_ID            where            M.TAMNGUNG = '0'            and M.BENHVIEN_ID = 'HLU01'            order by M.TENMAU]
2019-10-31 10:04:56,367 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM071']
2019-10-31 10:04:56,414 [5] DEBUG - Statement Id: [DAO00322_GetListMauTonKhoForCreateCached] PreparedStatement : [SELECT DISTINCT        TK.MAU_KEY, TK.KHOMAU_ID, M.MAU_ID, M.MAMAU, M.TENMAU, M.NHOM_ABO, M.NHOM_RH, M.LOAIMAU_ID,        TK.SOLONHAP_ID, SLN.SOLONHAP, SLN.SOKIEMSOAT, TK.NGUONHANG_ID, NG.TENNGUONMAU, M.BENHVIEN_ID, M.DONVITINH_ID,        SUM(tk.SOLUONG) AS SOLUONG,K.TENKHO,DVT.TENDONVITINH        FROM TT_MAU_TONKHO TK        JOIN TM_KHO K ON TK.KHOMAU_ID = K.KHO_ID        JOIN TT_MAU_CHUNGTU_SOLONHAP SLN ON TK.SOLONHAP_ID = SLN.SOLONHAP_ID        JOIN TM_MAU M on TK.MAU_ID = M.MAU_ID and M.TAMNGUNG = '0'        LEFT JOIN TM_MAU_DONVITINH DVT on M.DONVITINH_ID=DVT.DONVITINH_ID        LEFT JOIN TM_NGUONMAU NG ON NG.NGUONMAU_ID = TK.NGUONHANG_ID        WHERE TK.SOLUONG > 0        GROUP BY TK.MAU_KEY, TK.KHOMAU_ID, M.MAU_ID, M.MAMAU, M.TENMAU, M.NHOM_ABO, M.NHOM_RH, M.LOAIMAU_ID,        TK.SOLONHAP_ID, SLN.SOLONHAP, SLN.SOKIEMSOAT,TK.NGUONHANG_ID, NG.TENNGUONMAU, M.BENHVIEN_ID, M.DONVITINH_ID,K.TENKHO,DVT.TENDONVITINH]
2019-10-31 10:04:56,517 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM073']
2019-10-31 10:04:56,567 [5] DEBUG - Statement Id: [DAO00322_GetListMauTonKhoTruBooking] PreparedStatement : [select distinct        TK.MAU_KEY, TK.KHOMAU_ID, M.MAU_ID, M.MAMAU, M.TENMAU, M.NHOM_ABO, M.NHOM_RH, M.LOAIMAU_ID, M.DONVITINH_ID,        TK.SOLONHAP_ID, TK.SOLONHAP, TK.SOKIEMSOAT,M.PHAMVI, TK.NGUONHANG_ID, NG.TENNGUONMAU, M.BENHVIEN_ID,        TK.SOLUONG,TK.TENKHO,DVT.TENDONVITINH        from TM_MAU M        JOIN        (        select        A.MAU_KEY, A.KHOMAU_ID, A.MAU_ID ,a.NGUONHANG_ID, A.SOLONHAP_ID, A.SOLONHAP, A.SOKIEMSOAT, A.SOLUONG,A.TENKHO        from        (        select KHOMAU_ID, TK.MAU_ID, TK.NGUONHANG_ID, TK.MAU_KEY, SLN.SOLONHAP_ID, SLN.SOLONHAP, SLN.SOKIEMSOAT, ISNULL(TK.SOLUONG,0) - ISNULL(book.SOLUONG,0) as SOLUONG,K.TENKHO        from TT_MAU_TONKHO TK        JOIN TM_KHO K ON TK.KHOMAU_ID = K.KHO_ID        inner join TT_MAU_CHUNGTU_SOLONHAP SLN ON TK.SOLONHAP_ID = SLN.SOLONHAP_ID        left join dbo.TT_MAU_TONKHO_BOOK book ON book.MAU_KEY = TK.MAU_KEY AND book.TRANGTHAI = 'HIEULUC'        where ISNULL(TK.SOLUONG,0) - ISNULL(book.SOLUONG,0) > 0        ) A        )TK on TK.MAU_ID = M.MAU_ID and M.TAMNGUNG = '0'        LEFT JOIN TM_MAU_DONVITINH DVT on M.DONVITINH_ID=DVT.DONVITINH_ID        LEFT JOIN TM_NGUONMAU NG ON NG.NGUONMAU_ID = TK.NGUONHANG_ID]
2019-10-31 10:04:56,671 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM072']
2019-10-31 10:04:57,693 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'MAIN'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2019-10-31 10:04:59,176 [1] DEBUG - Statement Id: [DAO00002_FormList] PreparedStatement : [select              TM_SYS_FORM.HOSPITAL_ID,              TM_SYS_FORM.NAME,              TM_SYS_FORM.CLASS,              TM_SYS_FORM.ASSEMBLY,              TM_SYS_FORM.TITLE_VI as TITLE              from TM_SYS_FORM              where HOSPITAL_ID = 'HLU01']
2019-10-31 10:05:05,336 [1] DEBUG - Statement Id: [DAO00300_GetShortcutListByUserID] PreparedStatement : [SELECT S.SHORTCUT_CODE, S.SHORTCUT_VALUE              FROM TM_SHORTCUT AS S              WHERE S.BENHVIEN_ID = 'HLU01' AND S.USER_ID = '1' AND TAMNGUNG = '0']
2019-10-31 10:05:05,706 [1] DEBUG - Statement Id: [DAO00087_GetList] PreparedStatement : [select CODE, VALUE, BENHVIEN_ID              from TM_SYS_APPSETTINGS              where LOCKED = '0' and BENHVIEN_ID = 'HLU01'              order by SETTING_ID]
2019-10-31 10:05:05,811 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'MSG01'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2019-10-31 10:05:06,340 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'MSG02'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2019-10-31 10:05:07,176 [1] DEBUG - Statement Id: [DAO00008_GetUserSettings] PreparedStatement : [select A.*, B.TENKHO , C.TENPHONGBAN, B.MAKHO, C.MAPHONGBAN          from TM_SYS_USERS A          left join TM_KHODUOC B on B.KHODUOC_ID = A.INVENTORY_ID          left join TM_PHONGBAN C on (C.PHONGBAN_ID = A.WORKING_DEPT_ID and C.BENHVIEN_ID =  @param0 )          left join TM_SYS_USERKHO D on (D.ACCOUNT_ID = A.ACCOUNT_ID and D.HOSPITAL_ID =  @param0 )          where          A.HOSPITAL_ID =  @param0            and                 A.ACCOUNT_ID =  @param1]
2019-10-31 10:05:07,178 [1] DEBUG - Statement Id: [DAO00008_GetUserSettings] Parameters: [@param0=[HOSPITAL_ID,HLU01], @param1=[ACCOUNT_ID,113]]
2019-10-31 10:05:07,178 [1] DEBUG - Statement Id: [DAO00008_GetUserSettings] Types: [@param0=[String, System.String], @param1=[String, System.String]]
2019-10-31 10:05:07,216 [1] DEBUG - Statement Id: [DAO00008_GetUserInvSettings] PreparedStatement : [select A.*, B.TENKHO, B.MAKHO, B.LOAIKHO_ID, B.KHOQUANLY_ID          from TM_SYS_USERKHO A          left join TM_KHO B on B.MODULE_ID = A.MODULE_ID and B.KHO_ID = A.KHO_ID          where A.HOSPITAL_ID =  @param0  and A.ACCOUNT_ID =  @param1           order by B.TENKHO]
2019-10-31 10:05:07,216 [1] DEBUG - Statement Id: [DAO00008_GetUserInvSettings] Parameters: [@param0=[HOSPITAL_ID,HLU01], @param1=[ACCOUNT_ID,113]]
2019-10-31 10:05:07,216 [1] DEBUG - Statement Id: [DAO00008_GetUserInvSettings] Types: [@param0=[String, System.String], @param1=[String, System.String]]
2019-10-31 10:05:07,366 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'COM30'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2019-10-31 10:05:07,571 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'RIS04'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2019-10-31 10:05:18,416 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'MENU1'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2019-10-31 10:05:18,530 [1] DEBUG - Statement Id: [DAO00011_GetList] PreparedStatement : [select              TM_SYS_MENU.ID,              TM_SYS_MENU.PARENTID,              TM_SYS_MENU.SCREEN,              TM_SYS_MENU.SMALLIMAGE,              TM_SYS_MENU.LARGEIMAGE,              TM_SYS_MENU.DESCRIPTION,              TM_SYS_MENU.TYPE,              TM_SYS_MENU.TITLE_VI as TITLE              from TM_SYS_MENU              where TM_SYS_MENU.HOSPITAL_ID = 'HLU01' and TM_SYS_MENU.ACTIVE = '1'               AND                   (TM_SYS_MENU.TYPE & '8' = '8')                             order by TM_SYS_MENU.ORDERNUM]
2019-10-31 10:05:18,997 [1] DEBUG - Statement Id: [DAO00011_usermenu_list] PreparedStatement : [select              TM_SYS_HOMEMENU.MENUID as ID,              TM_SYS_MENU.TITLE_VI as TITLE,              TM_SYS_MENU.SCREEN,              TM_SYS_MENU.SMALLIMAGE,              TM_SYS_MENU.LARGEIMAGE,              TM_SYS_MENU.TYPE              from TM_SYS_HOMEMENU              left join TM_SYS_MENU on TM_SYS_MENU.ID = TM_SYS_HOMEMENU.MENUID and TM_SYS_MENU.HOSPITAL_ID = TM_SYS_HOMEMENU.HOSPITAL_ID              where TM_SYS_HOMEMENU.HOSPITAL_ID = 'HLU01' and TM_SYS_HOMEMENU.USERID = '113' and TM_SYS_MENU.ACTIVE = '1'               AND                   (TM_SYS_MENU.TYPE & '8' = '8')                             ORDER BY TM_SYS_HOMEMENU.ORDERNUM]
2019-10-31 10:18:13,593 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'COM31'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2019-10-31 10:18:15,383 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'BIL11'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2019-10-31 10:18:16,705 [1] DEBUG - Statement Id: [DAO00012_GetList] PreparedStatement : [select        DICTIONARY_ID,        DICTIONARY_CODE,        DICTIONARY_NAME,        ATTRIBUTE1,        ATTRIBUTE2,        DICTIONARY_NAME_EN        from LST_DICTIONARY        where LST_DICTIONARY.Enabled = '1'         AND           LST_DICTIONARY.DICTIONARY_TYPE_CODE = 'NguonBN'                 order by LST_DICTIONARY.IDX]
2019-10-31 10:18:21,968 [1] DEBUG - Statement Id: [DAO00014_GetInPatientStatus] PreparedStatement : [select TRANGTHAI, isnull(KHOACHUYENDEN_ID, KHOAVAO_ID) as KHOAHIENTAI from TT_NOITRU_BENHAN        where        TIEPNHAN_ID = '27344'        and BENHVIEN_ID = 'HLU01'         and           BENHAN_ID = '5859']
2019-10-31 10:18:22,216 [1] DEBUG - Statement Id: [DAO00024_TT_VIENPHI_GetList_DSDichVuChuaThuTien] PreparedStatement : [SELECT TOP 1 VIENPHI_ID              FROM TT_VIENPHI              WHERE              DATHANHTOAN = 0]
2019-10-31 10:18:22,272 [1] DEBUG - Statement Id: [DAO00087_GetServiceParams] PreparedStatement : [select CODE, VALUE              from TM_SYS_APPSETTINGS              where LOCKED = '0' and BENHVIEN_ID = 'HLU01']
2019-10-31 10:18:22,325 [1] DEBUG - Statement Id: [DAO00067_laytrangthaibenhannoitru] PreparedStatement : [select isnull(TRANGTHAI, '') TRANGTHAI from TT_NOITRU_BENHAN where BENHAN_ID =  @param0]
2019-10-31 10:18:22,325 [1] DEBUG - Statement Id: [DAO00067_laytrangthaibenhannoitru] Parameters: [@param0=[BENHAN_ID,5859]]
2019-10-31 10:18:22,325 [1] DEBUG - Statement Id: [DAO00067_laytrangthaibenhannoitru] Types: [@param0=[Int64, System.Int64]]
2019-10-31 10:18:22,363 [1] DEBUG - Statement Id: [DAO00067_ClearDataVienPhi] PreparedStatement : [delete from TT_VIENPHI where TIEPNHAN_ID = 27344 and REF_ID = 0           and             BENHAN_ID = '5859'                     update TT_VIENPHI set SOLUONG = 0          where REF_TABLE = 'TT_DVYEUCAU' and TIEPNHAN_ID =  @param0           and not exists (select DVYEUCAU_ID from TT_DVYEUCAU where TT_VIENPHI.REF_ID = DVYEUCAU_ID and TIEPNHAN_ID =  @param0 )                       update TT_VIENPHI set SOLUONG = 0          where REF_TABLE = 'TT_NGOAITRU_TOATHUOC'          and TIEPNHAN_ID =  @param0           and HOADON_ID is null and TIEPNHAN_ID =  @param0           and not exists (select TOATHUOC_ID from TT_NGOAITRU_TOATHUOC where TT_VIENPHI.REF_ID = TOATHUOC_ID and TIEPNHAN_ID =  @param0 )                          update TT_VIENPHI            set SOLUONG = (TraThuoc.SOLUONG - TraThuoc.SOLUONG_NGUNG)            from (select distinct nttt.SOLUONG, ttct.TOATHUOC_ID, ttct.DUOC_ID , ttct.SOLUONG SOLUONG_NGUNG            from TT_NOITRU_TRATHUOC_CHITIET ttct            left join TT_NOITRU_TRATHUOC tt on tt.TRATHUOC_ID = ttct.TRATHUOC_ID            left join TT_NOITRU_TOATHUOC nttt on nttt.TOATHUOC_ID = ttct.TOATHUOC_ID            where tt.BENHAN_ID =  @param1 ) TraThuoc            where TT_VIENPHI.REF_ID = TraThuoc.TOATHUOC_ID and TT_VIENPHI.DUOC_ID = TraThuoc.DUOC_ID            and TT_VIENPHI.REF_TABLE = 'TT_NOITRU_TOATHUOC' and TT_VIENPHI.BENHAN_ID =  @param1             and TT_VIENPHI.SOLUONG > (TraThuoc.SOLUONG - TraThuoc.SOLUONG_NGUNG)                         update TT_VIENPHI set SOLUONG = 0            where REF_TABLE = 'TT_NOITRU_TOATHUOC'            and TIEPNHAN_ID =  @param0             and KHAMBENH_ID not in (select KHAMBENH_ID from TT_NOITRU_TOATHUOC where TIEPNHAN_ID =  @param0 )            and HOADON_ID is null and BENHAN_ID =  @param1                    delete TT_DUOC_TONKHO_BOOK_NOITRU where REF_TABLE = 'TT_NOITRU_TOATHUOC' and (REF_ID is null or REF_ID = 0)        delete TT_DUOC_TONKHO_BOOK_NGOAITRU where REF_ID is null or REF_ID = 0                      update TT_VIENPHI          set BENHAN_ID =  @param1           from (select TOATHUOC_ID from TT_NOITRU_TOATHUOC where TIEPNHAN_ID =  @param0 ) nttt          where REF_TABLE = 'TT_NOITRU_TOATHUOC' and REF_ID = nttt.TOATHUOC_ID and isnull(BENHAN_ID, 0) = 0          and TIEPNHAN_ID =  @param0             update TT_VIENPHI          set TT_VIENPHI.BENHAN_ID =  @param1           from (select DVYEUCAU_ID, BENHAN_ID from TT_DVYEUCAU where TIEPNHAN_ID =  @param0 ) nttt          where TT_VIENPHI.REF_TABLE = 'TT_DVYEUCAU' and TT_VIENPHI.REF_ID = nttt.DVYEUCAU_ID          and isnull(TT_VIENPHI.BENHAN_ID, 0) = 0 and isnull(nttt.BENHAN_ID, 0) > 0          and TT_VIENPHI.TIEPNHAN_ID =  @param0                     update TT_VIENPHI set          THANHTIEN_DOANHTHU = 0, BHYT_THANHTIEN = 0, BHYT_THANHTIEN_CHITRA = 0          , GIATRI_BENHNHAN_DATHANHTOAN = 0, BENHNHAN_PHAITHANHTOAN = 0          where TIEPNHAN_ID = 27344 and SOLUONG = 0           and             BENHAN_ID = 5859                       update TT_VIENPHI set          GIATRI_BENHNHAN_DATHANHTOAN = 0          where TIEPNHAN_ID = '27344' and GIATRI_BENHNHAN_DATHANHTOAN is null            update TT_VIENPHI set          BENHNHAN_PHAITHANHTOAN = 0          where TIEPNHAN_ID = '27344' and BENHNHAN_PHAITHANHTOAN is null]
2019-10-31 10:18:22,363 [1] DEBUG - Statement Id: [DAO00067_ClearDataVienPhi] Parameters: [@param0=[TIEPNHAN_ID,27344], @param1=[BENHAN_ID,5859]]
2019-10-31 10:18:22,363 [1] DEBUG - Statement Id: [DAO00067_ClearDataVienPhi] Types: [@param0=[Int64, System.Int64], @param1=[Int64, System.Int64]]
2019-10-31 10:18:22,856 [1] DEBUG - Statement Id: [DAO00064_GetlistTT_TIEPNHAN_SOTHEBHYT] PreparedStatement : [select stbhyt.*, ba.SOBENHAN,         tn.SOTIEPNHAN, tn.LOAITHANHVIEN_ID, tn.THE_ID, tn.THANHVIEN_ID,        tn.SUDUNG_BHTN, tn.BAOLANH_VIENPHI, tn.VIP, tn.NGUOINUOCNGOAI        from TT_TIEPNHAN_SOTHEBHYT stbhyt        left join TT_TIEPNHAN tn on tn.TIEPNHAN_ID = stbhyt.TIEPNHAN_ID        left join TT_NOITRU_BENHAN ba on ba.TIEPNHAN_ID = stbhyt.TIEPNHAN_ID        where         stbhyt.TIEPNHAN_ID = '27344' and isnull(stbhyt.KHONGSUDUNG, '0') = '0'         and           ba.BENHAN_ID = '5859']
2019-10-31 10:18:22,921 [1] DEBUG - Statement Id: [DAO00064_GetListVienPhiByTiepNnan] PreparedStatement : [select distinct        B.DOITUONG_ID, B.NGAYMIENDONGCHITRA, B.BENHNHAN_ID as TIEPNHAN_BENHNHAN_ID, B.TRAITUYEN,        B.BHYTTREN3NAM as TREN3NAM, B.BHYTTREN5NAM as TREN5NAM, B.SOTIEPNHAN, B.SOBENHAN,        B.LOAITHANHVIEN_ID, B.SUDUNG_BHTN, B.THE_ID, B.THANHVIEN_ID, B.BAOLANH_VIENPHI, B.VIP, B.NGUOINUOCNGOAI,        C.GIATRIMIENGIAM as GIATRIMIENGIAM, D.GIATRIMIENGIAM as GIATRIMIENGIAM_BHTN, E.GIATRIMIENGIAM as GIATRIMIENGIAM_THANHVIEN,        F.GIATRIMIENGIAM as GIATRIMIENGIAM_CONGTY, DVYC.THE_ID as DVDUNGTHE, DVYC.TRANGTHAI as TRANGTHAIDICHVU, ndv.MANHOMDICHVU,        A.* from TT_VIENPHI A        left join        (select B.*, C.SOBENHAN, C.BENHAN_ID        from TT_TIEPNHAN B        left join TT_NOITRU_BENHAN C on B.TIEPNHAN_ID = C.TIEPNHAN_ID         and           C.BENHAN_ID = '5859'                 where B.TIEPNHAN_ID = '27344') B on B.TIEPNHAN_ID = A.TIEPNHAN_ID        left join (select sum(GIATRIMIENGIAM) as GIATRIMIENGIAM, VIENPHI_ID, REF_TABLE        from TT_MIENGIAM_CHITIET        where REF_TABLE = 'TT_MIENGIAM'        and exists (select MIENGIAM_ID from TT_MIENGIAM where TT_MIENGIAM_CHITIET.MIENGIAM_ID = MIENGIAM_ID and TINHTRANG = 1 and TIEPNHAN_ID = '27344')        group by VIENPHI_ID, REF_TABLE) C on C.REF_TABLE = 'TT_MIENGIAM' and C.VIENPHI_ID = A.VIENPHI_ID        left join (select sum(GIATRIMIENGIAM) as GIATRIMIENGIAM, VIENPHI_ID, REF_TABLE        from TT_MIENGIAM_CHITIET        where REF_TABLE = 'TT_MIENGIAM_BHTN'        and exists (select MIENGIAM_BHTN_ID from TT_MIENGIAM_BHTN where TT_MIENGIAM_CHITIET.MIENGIAM_ID = MIENGIAM_BHTN_ID and  TINHTRANG = 1 and TIEPNHAN_ID = '27344')        group by VIENPHI_ID, REF_TABLE) D on D.REF_TABLE = 'TT_MIENGIAM_BHTN' and D.VIENPHI_ID = A.VIENPHI_ID        left join (select sum(GIATRIMIENGIAM) as GIATRIMIENGIAM, VIENPHI_ID, REF_TABLE        from TT_MIENGIAM_CHITIET        where REF_TABLE = 'TT_MIENGIAM_THANHVIEN'        and exists (select MIENGIAM_THANHVIEN_ID from TT_MIENGIAM_THANHVIEN where TT_MIENGIAM_CHITIET.MIENGIAM_ID = MIENGIAM_THANHVIEN_ID and TINHTRANG = 1 and TIEPNHAN_ID = '27344')        group by VIENPHI_ID, REF_TABLE) E on E.REF_TABLE = 'TT_MIENGIAM_THANHVIEN' and E.VIENPHI_ID = A.VIENPHI_ID        left join (select sum(GIATRIMIENGIAM) as GIATRIMIENGIAM, VIENPHI_ID, REF_TABLE        from TT_MIENGIAM_CHITIET        where REF_TABLE = 'TT_MIENGIAM_CONGTY'        and exists (select MIENGIAM_CONGTY_ID from TT_MIENGIAM_CONGTY where TT_MIENGIAM_CHITIET.MIENGIAM_ID = MIENGIAM_CONGTY_ID and TINHTRANG = 1 and TIEPNHAN_ID = '27344')        group by VIENPHI_ID, REF_TABLE) F on F.REF_TABLE = 'TT_MIENGIAM_CONGTY' and F.VIENPHI_ID = A.VIENPHI_ID        left join TT_DVYEUCAU DVYC on DVYC.DVYEUCAU_ID = A.REF_ID and A.REF_TABLE = 'TT_DVYEUCAU'        left join TM_DICHVU DV on DVYC.DICHVU_ID = DV.DICHVU_ID and A.REF_TABLE = 'TT_DVYEUCAU'        left join TM_NHOMDICHVU ndv on ndv.NHOMDICHVU_ID = DV.NHOMDICHVU_ID and A.REF_TABLE = 'TT_DVYEUCAU'        where        A.TIEPNHAN_ID = '27344' and ((DVYC.HUYYEUCAU = '0' and A.DICHVU_ID is not null)        or A.DUOC_ID is not null or A.REF_TABLE = 'TT_NUT_XACNHANSUATAN_CHITIET')        and A.ACTIVE = '1'         and           A.BENHAN_ID = '5859'                 and A.BENHVIEN_ID = 'HLU01'        order by A.VIENPHI_ID]
2019-10-31 10:18:23,152 [1] DEBUG - Statement Id: [DAO00080_LayLoaiBenhanCuNoitru] PreparedStatement : [select LOAIBENHAN from TT_NOITRU_BENHAN where TIEPNHAN_ID =  @param0]
2019-10-31 10:18:23,152 [1] DEBUG - Statement Id: [DAO00080_LayLoaiBenhanCuNoitru] Parameters: [@param0=[TIEPNHAN_ID,27344]]
2019-10-31 10:18:23,152 [1] DEBUG - Statement Id: [DAO00080_LayLoaiBenhanCuNoitru] Types: [@param0=[Int32, System.Int32]]
2019-10-31 10:18:23,191 [1] DEBUG - Statement Id: [DAO00006_GetListDuocTyle] PreparedStatement : [select DUOC_ID, DOITUONG_ID, (TYLE/100) as TYLE, DONGIA MUCTRAN_THANHTOAN from TM_DOITUONG_GIADUOC_TYLE            where            BENHVIEN_ID = 'HLU01'            and DOITUONG_ID = '6']
2019-10-31 10:18:23,219 [1] DEBUG - Statement Id: [DAO00027_GetListTuongTrinhDichVuPhauThuatCuaTiepNhan] PreparedStatement : [declare @ManhomDSA varchar(10);        declare @PhanLoaiNhomDV varchar(20) = '05';        select top 1  @ManhomDSA = VALUE from TM_SYS_APPSETTINGS where CODE = 'MANHOM_DICHVU_DSA'        if (@ManhomDSA is not null) set @PhanLoaiNhomDV += ',' + @ManhomDSA        select distinct ptyc.*        from TT_PHAUTHUAT_YEUCAU ptyc        inner join TM_DICHVU dv on dv.DICHVU_ID = ptyc.DICHVU_ID        inner join TM_NHOMDICHVU ndv on ndv.NHOMDICHVU_ID = dv.NHOMDICHVU_ID        inner join TT_PHAUTHUAT pt on pt.PHAUTHUAT_ID = ptyc.PHAUTHUAT_ID        where        pt.TIEPNHAN_ID = 27344        and (left(ndv.MANHOMDICHVU, 2) in (select * from STRING_SPLIT(@PhanLoaiNhomDV,',')) or ndv.MANHOMDICHVU in (select * from STRING_SPLIT(@PhanLoaiNhomDV,',')))]
2019-10-31 10:18:23,302 [1] DEBUG - Statement Id: [DAO00006_GetList] PreparedStatement : [select dv.*, loaiDV.MALOAIDICHVU, captren.NHOMDICHVU_ID as NHOMDICHVU_CAPTREN_ID, captren.TENNHOMDICHVU as NHOMDICHVU_CAPTREN,              nhom_dv.TENNHOMDICHVU as TENNHOMDICHVU, nhom_dv.MANHOMDICHVU,              case when dv.ATTRIBUTE5 is null then 'TT' else 'KTC' end as LOAI_CHIPHI              from TM_DICHVU as dv              left join TM_NHOMDICHVU as nhom_dv on nhom_dv.NHOMDICHVU_ID = dv.NHOMDICHVU_ID and nhom_dv.BENHVIEN_ID = 'HLU01'              left join TM_NHOMDICHVU as captren on nhom_dv.CAPTREN_ID = captren.NHOMDICHVU_ID and captren.BENHVIEN_ID = 'HLU01'              left join TM_LOAIDICHVU loaiDV on nhom_dv.LOAIDICHVU_ID = loaiDV.LOAIDICHVU_ID and loaiDV.BENHVIEN_ID = 'HLU01'              where nhom_dv.TAMNGUNG = '0' and dv.BENHVIEN_ID = 'HLU01'              and dv.TAMNGUNG = '0'               AND                   loaiDV.MALOAIDICHVU = 'KhamBenh']
2019-10-31 10:18:23,461 [1] DEBUG - Statement Id: [DAO00023_UpdateNhieuVP] PreparedStatement : [declare @jsonVienPhi nvarchar(max) = N'[{"VIENPHI_ID":671148,"TIEPNHAN_ID":27344,"DICHVU_ID":5445,"BENHAN_ID":5859,"SOLUONG":1.0000,"DONGIA_DOANHTHU":33000.0000,"THANHTIEN_DOANHTHU":33000.00,"BHYT_TL":0.0,"BHYT_DONGIA":0.0,"BHYT_THANHTIEN":0.0,"BHYT_DONGIA_CONGKHAM_DAU":0.0,"BHYT_CONGKHAM_DAU_TYLE":1.0,"BHYT_DONGIA_CHITRA":0.0,"BHYT_THANHTIEN_CHITRA":0.0,"BENHNHAN_PHAITHANHTOAN":33000.00,"GIATRI_HOADON":0.0,"GIATRI_HOADON_DATHANHTOAN":0.0,"GIATRI_BIENLAI":33000.00000000,"GIATRI_BIENLAI_DATHANHTOAN":0.0,"GIATRI_BENHNHAN_DATHANHTOAN":0.0,"DATHUCHIEN":"1","KHONGTHUTIEN":"0","BHYTDONGTIEN":"0","DICHVU_TL":1.0,"BHYT_DONGIA_DONGCT_DAU":0.0,"SOBHYT":"HN238382272757838523","SOBHYT_HUONG_ID":28371,"GIATRIMIENGIAM":0.0,"GIATRIMIENGIAM_BHTN":0.0,"GIATRIMIENGIAM_THANHVIEN":0.0,"GIATRIMIENGIAM_CONGTY":0.0,"BHYT_CK2_KHONGTHANHTOAN":false},{"VIENPHI_ID":671398,"TIEPNHAN_ID":27344,"DICHVU_ID":4017,"BENHAN_ID":5859,"SOLUONG":1.0000,"DONGIA_DOANHTHU":42100.0000,"THANHTIEN_DOANHTHU":42100.00,"BHYT_TL":1.0000,"BHYT_DONGIA":0.0,"BHYT_THANHTIEN":0.0,"BHYT_DONGIA_CONGKHAM_DAU":0.0,"BHYT_CONGKHAM_DAU_TYLE":1.0,"BHYT_DONGIA_CHITRA":0.0,"BHYT_THANHTIEN_CHITRA":0.0,"BENHNHAN_PHAITHANHTOAN":42100.00,"GIATRI_HOADON":0.0,"GIATRI_HOADON_DATHANHTOAN":0.0,"GIATRI_BIENLAI":42100.00000000,"GIATRI_BIENLAI_DATHANHTOAN":0.0,"GIATRI_BENHNHAN_DATHANHTOAN":0.0,"DATHUCHIEN":"1","KHONGTHUTIEN":"0","BHYTDONGTIEN":"0","DICHVU_TL":1.0,"BHYT_DONGIA_DONGCT_DAU":0.0,"SOBHYT":"HN238382272757838523","SOBHYT_HUONG_ID":28371,"GIATRIMIENGIAM":0.0,"GIATRIMIENGIAM_BHTN":0.0,"GIATRIMIENGIAM_THANHVIEN":0.0,"GIATRIMIENGIAM_CONGTY":0.0,"BHYT_CK2_KHONGTHANHTOAN":false},{"VIENPHI_ID":671399,"TIEPNHAN_ID":27344,"DICHVU_ID":4523,"BENHAN_ID":5859,"SOLUONG":1.0000,"DONGIA_DOANHTHU":40000.0000,"THANHTIEN_DOANHTHU":40000.00,"BHYT_TL":0.0,"BHYT_DONGIA":0.0,"BHYT_THANHTIEN":0.0,"BHYT_DONGIA_CONGKHAM_DAU":0.0,"BHYT_CONGKHAM_DAU_TYLE":1.0,"BHYT_DONGIA_CHITRA":0.0,"BHYT_THANHTIEN_CHITRA":0.0,"BENHNHAN_PHAITHANHTOAN":40000.00,"GIATRI_HOADON":0.0,"GIATRI_HOADON_DATHANHTOAN":0.0,"GIATRI_BIENLAI":40000.00000000,"GIATRI_BIENLAI_DATHANHTOAN":0.0,"GIATRI_BENHNHAN_DATHANHTOAN":0.0,"DATHUCHIEN":"1","KHONGTHUTIEN":"0","BHYTDONGTIEN":"0","DICHVU_TL":1.0,"BHYT_DONGIA_DONGCT_DAU":0.0,"SOBHYT":"HN238382272757838523","SOBHYT_HUONG_ID":28371,"GIATRIMIENGIAM":0.0,"GIATRIMIENGIAM_BHTN":0.0,"GIATRIMIENGIAM_THANHVIEN":0.0,"GIATRIMIENGIAM_CONGTY":0.0,"BHYT_CK2_KHONGTHANHTOAN":false},{"VIENPHI_ID":674464,"TIEPNHAN_ID":27344,"DICHVU_ID":null,"BENHAN_ID":5859,"SOLUONG":1.0000,"DONGIA_DOANHTHU":13500.0000,"THANHTIEN_DOANHTHU":13500.00,"BHYT_TL":1.0,"BHYT_DONGIA":8925.0000,"BHYT_THANHTIEN":8925.00,"BHYT_DONGIA_CONGKHAM_DAU":0.0,"BHYT_CONGKHAM_DAU_TYLE":1.0,"BHYT_DONGIA_CHITRA":8925.0,"BHYT_THANHTIEN_CHITRA":8925.00,"BENHNHAN_PHAITHANHTOAN":4575.00,"GIATRI_HOADON":0.0,"GIATRI_HOADON_DATHANHTOAN":0.0,"GIATRI_BIENLAI":4575.00,"GIATRI_BIENLAI_DATHANHTOAN":0.0,"GIATRI_BENHNHAN_DATHANHTOAN":0.0,"DATHUCHIEN":"0","KHONGTHUTIEN":"0","BHYTDONGTIEN":"0","DICHVU_TL":0.0,"BHYT_DONGIA_DONGCT_DAU":0.0,"SOBHYT":"HN238382272757838523","SOBHYT_HUONG_ID":28371,"GIATRIMIENGIAM":0.0,"GIATRIMIENGIAM_BHTN":0.0,"GIATRIMIENGIAM_THANHVIEN":0.0,"GIATRIMIENGIAM_CONGTY":0.0,"BHYT_CK2_KHONGTHANHTOAN":false},{"VIENPHI_ID":674465,"TIEPNHAN_ID":27344,"DICHVU_ID":null,"BENHAN_ID":5859,"SOLUONG":2.0000,"DONGIA_DOANHTHU":16000.0000,"THANHTIEN_DOANHTHU":32000.00,"BHYT_TL":1.0,"BHYT_DONGIA":16000.0000,"BHYT_THANHTIEN":32000.00,"BHYT_DONGIA_CONGKHAM_DAU":0.0,"BHYT_CONGKHAM_DAU_TYLE":1.0,"BHYT_DONGIA_CHITRA":16000.0,"BHYT_THANHTIEN_CHITRA":32000.00,"BENHNHAN_PHAITHANHTOAN":0.00,"GIATRI_HOADON":0.0,"GIATRI_HOADON_DATHANHTOAN":0.0,"GIATRI_BIENLAI":0.0,"GIATRI_BIENLAI_DATHANHTOAN":0.0,"GIATRI_BENHNHAN_DATHANHTOAN":0.0,"DATHUCHIEN":"0","KHONGTHUTIEN":"0","BHYTDONGTIEN":"0","DICHVU_TL":0.0,"BHYT_DONGIA_DONGCT_DAU":0.0,"SOBHYT":"HN238382272757838523","SOBHYT_HUONG_ID":28371,"GIATRIMIENGIAM":0.0,"GIATRIMIENGIAM_BHTN":0.0,"GIATRIMIENGIAM_THANHVIEN":0.0,"GIATRIMIENGIAM_CONGTY":0.0,"BHYT_CK2_KHONGTHANHTOAN":false},{"VIENPHI_ID":674466,"TIEPNHAN_ID":27344,"DICHVU_ID":null,"BENHAN_ID":5859,"SOLUONG":3.0000,"DONGIA_DOANHTHU":13500.0000,"THANHTIEN_DOANHTHU":40500.00,"BHYT_TL":1.0,"BHYT_DONGIA":8715.0000,"BHYT_THANHTIEN":26145.00,"BHYT_DONGIA_CONGKHAM_DAU":0.0,"BHYT_CONGKHAM_DAU_TYLE":1.0,"BHYT_DONGIA_CHITRA":8715.0,"BHYT_THANHTIEN_CHITRA":26145.00,"BENHNHAN_PHAITHANHTOAN":14355.00,"GIATRI_HOADON":0.0,"GIATRI_HOADON_DATHANHTOAN":0.0,"GIATRI_BIENLAI":14355.00,"GIATRI_BIENLAI_DATHANHTOAN":0.0,"GIATRI_BENHNHAN_DATHANHTOAN":0.0,"DATHUCHIEN":"0","KHONGTHUTIEN":"0","BHYTDONGTIEN":"0","DICHVU_TL":0.0,"BHYT_DONGIA_DONGCT_DAU":0.0,"SOBHYT":"HN238382272757838523","SOBHYT_HUONG_ID":28371,"GIATRIMIENGIAM":0.0,"GIATRIMIENGIAM_BHTN":0.0,"GIATRIMIENGIAM_THANHVIEN":0.0,"GIATRIMIENGIAM_CONGTY":0.0,"BHYT_CK2_KHONGTHANHTOAN":false},{"VIENPHI_ID":674467,"TIEPNHAN_ID":27344,"DICHVU_ID":null,"BENHAN_ID":5859,"SOLUONG":3.0000,"DONGIA_DOANHTHU":52500.0000,"THANHTIEN_DOANHTHU":157500.00,"BHYT_TL":1.0,"BHYT_DONGIA":52500.0000,"BHYT_THANHTIEN":157500.00,"BHYT_DONGIA_CONGKHAM_DAU":0.0,"BHYT_CONGKHAM_DAU_TYLE":1.0,"BHYT_DONGIA_CHITRA":52500.0,"BHYT_THANHTIEN_CHITRA":157500.00,"BENHNHAN_PHAITHANHTOAN":0.00,"GIATRI_HOADON":0.0,"GIATRI_HOADON_DATHANHTOAN":0.0,"GIATRI_BIENLAI":0.0,"GIATRI_BIENLAI_DATHANHTOAN":0.0,"GIATRI_BENHNHAN_DATHANHTOAN":0.0,"DATHUCHIEN":"0","KHONGTHUTIEN":"0","BHYTDONGTIEN":"0","DICHVU_TL":0.0,"BHYT_DONGIA_DONGCT_DAU":0.0,"SOBHYT":"HN238382272757838523","SOBHYT_HUONG_ID":28371,"GIATRIMIENGIAM":0.0,"GIATRIMIENGIAM_BHTN":0.0,"GIATRIMIENGIAM_THANHVIEN":0.0,"GIATRIMIENGIAM_CONGTY":0.0,"BHYT_CK2_KHONGTHANHTOAN":false},{"VIENPHI_ID":674468,"TIEPNHAN_ID":27344,"DICHVU_ID":null,"BENHAN_ID":5859,"SOLUONG":1.0000,"DONGIA_DOANHTHU":945.0000,"THANHTIEN_DOANHTHU":945.00,"BHYT_TL":1.0,"BHYT_DONGIA":945.0000,"BHYT_THANHTIEN":945.00,"BHYT_DONGIA_CONGKHAM_DAU":0.0,"BHYT_CONGKHAM_DAU_TYLE":1.0,"BHYT_DONGIA_CHITRA":945.0,"BHYT_THANHTIEN_CHITRA":945.00,"BENHNHAN_PHAITHANHTOAN":0.00,"GIATRI_HOADON":0.0,"GIATRI_HOADON_DATHANHTOAN":0.0,"GIATRI_BIENLAI":0.0,"GIATRI_BIENLAI_DATHANHTOAN":0.0,"GIATRI_BENHNHAN_DATHANHTOAN":0.0,"DATHUCHIEN":"0","KHONGTHUTIEN":"0","BHYTDONGTIEN":"0","DICHVU_TL":0.0,"BHYT_DONGIA_DONGCT_DAU":0.0,"SOBHYT":"HN238382272757838523","SOBHYT_HUONG_ID":28371,"GIATRIMIENGIAM":0.0,"GIATRIMIENGIAM_BHTN":0.0,"GIATRIMIENGIAM_THANHVIEN":0.0,"GIATRIMIENGIAM_CONGTY":0.0,"BHYT_CK2_KHONGTHANHTOAN":false},{"VIENPHI_ID":674469,"TIEPNHAN_ID":27344,"DICHVU_ID":null,"BENHAN_ID":5859,"SOLUONG":2.0000,"DONGIA_DOANHTHU":10500.0000,"THANHTIEN_DOANHTHU":21000.00,"BHYT_TL":1.0,"BHYT_DONGIA":10500.0000,"BHYT_THANHTIEN":21000.00,"BHYT_DONGIA_CONGKHAM_DAU":0.0,"BHYT_CONGKHAM_DAU_TYLE":1.0,"BHYT_DONGIA_CHITRA":10500.0,"BHYT_THANHTIEN_CHITRA":21000.00,"BENHNHAN_PHAITHANHTOAN":0.00,"GIATRI_HOADON":0.0,"GIATRI_HOADON_DATHANHTOAN":0.0,"GIATRI_BIENLAI":0.0,"GIATRI_BIENLAI_DATHANHTOAN":0.0,"GIATRI_BENHNHAN_DATHANHTOAN":0.0,"DATHUCHIEN":"0","KHONGTHUTIEN":"0","BHYTDONGTIEN":"0","DICHVU_TL":0.0,"BHYT_DONGIA_DONGCT_DAU":0.0,"SOBHYT":"HN238382272757838523","SOBHYT_HUONG_ID":28371,"GIATRIMIENGIAM":0.0,"GIATRIMIENGIAM_BHTN":0.0,"GIATRIMIENGIAM_THANHVIEN":0.0,"GIATRIMIENGIAM_CONGTY":0.0,"BHYT_CK2_KHONGTHANHTOAN":false},{"VIENPHI_ID":674470,"TIEPNHAN_ID":27344,"DICHVU_ID":null,"BENHAN_ID":5859,"SOLUONG":1.0000,"DONGIA_DOANHTHU":158000.0000,"THANHTIEN_DOANHTHU":158000.00,"BHYT_TL":1.0,"BHYT_DONGIA":158000.0000,"BHYT_THANHTIEN":158000.00,"BHYT_DONGIA_CONGKHAM_DAU":0.0,"BHYT_CONGKHAM_DAU_TYLE":1.0,"BHYT_DONGIA_CHITRA":158000.0,"BHYT_THANHTIEN_CHITRA":158000.00,"BENHNHAN_PHAITHANHTOAN":0.00,"GIATRI_HOADON":0.0,"GIATRI_HOADON_DATHANHTOAN":0.0,"GIATRI_BIENLAI":0.0,"GIATRI_BIENLAI_DATHANHTOAN":0.0,"GIATRI_BENHNHAN_DATHANHTOAN":0.0,"DATHUCHIEN":"0","KHONGTHUTIEN":"0","BHYTDONGTIEN":"0","DICHVU_TL":0.0,"BHYT_DONGIA_DONGCT_DAU":0.0,"SOBHYT":"HN238382272757838523","SOBHYT_HUONG_ID":28371,"GIATRIMIENGIAM":0.0,"GIATRIMIENGIAM_BHTN":0.0,"GIATRIMIENGIAM_THANHVIEN":0.0,"GIATRIMIENGIAM_CONGTY":0.0,"BHYT_CK2_KHONGTHANHTOAN":false},{"VIENPHI_ID":674471,"TIEPNHAN_ID":27344,"DICHVU_ID":null,"BENHAN_ID":5859,"SOLUONG":2.0000,"DONGIA_DOANHTHU":5500.0000,"THANHTIEN_DOANHTHU":11000.00,"BHYT_TL":1.0,"BHYT_DONGIA":5500.0000,"BHYT_THANHTIEN":11000.00,"BHYT_DONGIA_CONGKHAM_DAU":0.0,"BHYT_CONGKHAM_DAU_TYLE":1.0,"BHYT_DONGIA_CHITRA":5500.0,"BHYT_THANHTIEN_CHITRA":11000.00,"BENHNHAN_PHAITHANHTOAN":0.00,"GIATRI_HOADON":0.0,"GIATRI_HOADON_DATHANHTOAN":0.0,"GIATRI_BIENLAI":0.0,"GIATRI_BIENLAI_DATHANHTOAN":0.0,"GIATRI_BENHNHAN_DATHANHTOAN":0.0,"DATHUCHIEN":"0","KHONGTHUTIEN":"0","BHYTDONGTIEN":"0","DICHVU_TL":0.0,"BHYT_DONGIA_DONGCT_DAU":0.0,"SOBHYT":"HN238382272757838523","SOBHYT_HUONG_ID":28371,"GIATRIMIENGIAM":0.0,"GIATRIMIENGIAM_BHTN":0.0,"GIATRIMIENGIAM_THANHVIEN":0.0,"GIATRIMIENGIAM_CONGTY":0.0,"BHYT_CK2_KHONGTHANHTOAN":false},{"VIENPHI_ID":674472,"TIEPNHAN_ID":27344,"DICHVU_ID":null,"BENHAN_ID":5859,"SOLUONG":1.0000,"DONGIA_DOANHTHU":7000.0000,"THANHTIEN_DOANHTHU":7000.00,"BHYT_TL":1.0,"BHYT_DONGIA":4410.0000,"BHYT_THANHTIEN":4410.00,"BHYT_DONGIA_CONGKHAM_DAU":0.0,"BHYT_CONGKHAM_DAU_TYLE":1.0,"BHYT_DONGIA_CHITRA":4410.0,"BHYT_THANHTIEN_CHITRA":4410.00,"BENHNHAN_PHAITHANHTOAN":2590.00,"GIATRI_HOADON":0.0,"GIATRI_HOADON_DATHANHTOAN":0.0,"GIATRI_BIENLAI":2590.00,"GIATRI_BIENLAI_DATHANHTOAN":0.0,"GIATRI_BENHNHAN_DATHANHTOAN":0.0,"DATHUCHIEN":"0","KHONGTHUTIEN":"0","BHYTDONGTIEN":"0","DICHVU_TL":0.0,"BHYT_DONGIA_DONGCT_DAU":0.0,"SOBHYT":"HN238382272757838523","SOBHYT_HUONG_ID":28371,"GIATRIMIENGIAM":0.0,"GIATRIMIENGIAM_BHTN":0.0,"GIATRIMIENGIAM_THANHVIEN":0.0,"GIATRIMIENGIAM_CONGTY":0.0,"BHYT_CK2_KHONGTHANHTOAN":false},{"VIENPHI_ID":674473,"TIEPNHAN_ID":27344,"DICHVU_ID":null,"BENHAN_ID":5859,"SOLUONG":3.0000,"DONGIA_DOANHTHU":630.0000,"THANHTIEN_DOANHTHU":1890.00,"BHYT_TL":1.0,"BHYT_DONGIA":630.0000,"BHYT_THANHTIEN":1890.00,"BHYT_DONGIA_CONGKHAM_DAU":0.0,"BHYT_CONGKHAM_DAU_TYLE":1.0,"BHYT_DONGIA_CHITRA":630.0,"BHYT_THANHTIEN_CHITRA":1890.00,"BENHNHAN_PHAITHANHTOAN":0.00,"GIATRI_HOADON":0.0,"GIATRI_HOADON_DATHANHTOAN":0.0,"GIATRI_BIENLAI":0.0,"GIATRI_BIENLAI_DATHANHTOAN":0.0,"GIATRI_BENHNHAN_DATHANHTOAN":0.0,"DATHUCHIEN":"0","KHONGTHUTIEN":"0","BHYTDONGTIEN":"0","DICHVU_TL":0.0,"BHYT_DONGIA_DONGCT_DAU":0.0,"SOBHYT":"HN238382272757838523","SOBHYT_HUONG_ID":28371,"GIATRIMIENGIAM":0.0,"GIATRIMIENGIAM_BHTN":0.0,"GIATRIMIENGIAM_THANHVIEN":0.0,"GIATRIMIENGIAM_CONGTY":0.0,"BHYT_CK2_KHONGTHANHTOAN":false},{"VIENPHI_ID":674474,"TIEPNHAN_ID":27344,"DICHVU_ID":null,"BENHAN_ID":5859,"SOLUONG":3.0000,"DONGIA_DOANHTHU":1030.0000,"THANHTIEN_DOANHTHU":3090.00,"BHYT_TL":1.0,"BHYT_DONGIA":1030.0000,"BHYT_THANHTIEN":3090.00,"BHYT_DONGIA_CONGKHAM_DAU":0.0,"BHYT_CONGKHAM_DAU_TYLE":1.0,"BHYT_DONGIA_CHITRA":1030.0,"BHYT_THANHTIEN_CHITRA":3090.00,"BENHNHAN_PHAITHANHTOAN":0.00,"GIATRI_HOADON":0.0,"GIATRI_HOADON_DATHANHTOAN":0.0,"GIATRI_BIENLAI":0.0,"GIATRI_BIENLAI_DATHANHTOAN":0.0,"GIATRI_BENHNHAN_DATHANHTOAN":0.0,"DATHUCHIEN":"0","KHONGTHUTIEN":"0","BHYTDONGTIEN":"0","DICHVU_TL":0.0,"BHYT_DONGIA_DONGCT_DAU":0.0,"SOBHYT":"HN238382272757838523","SOBHYT_HUONG_ID":28371,"GIATRIMIENGIAM":0.0,"GIATRIMIENGIAM_BHTN":0.0,"GIATRIMIENGIAM_THANHVIEN":0.0,"GIATRIMIENGIAM_CONGTY":0.0,"BHYT_CK2_KHONGTHANHTOAN":false},{"VIENPHI_ID":674475,"TIEPNHAN_ID":27344,"DICHVU_ID":null,"BENHAN_ID":5859,"SOLUONG":3.0000,"DONGIA_DOANHTHU":348.0000,"THANHTIEN_DOANHTHU":1044.00,"BHYT_TL":1.0,"BHYT_DONGIA":348.0000,"BHYT_THANHTIEN":1044.00,"BHYT_DONGIA_CONGKHAM_DAU":0.0,"BHYT_CONGKHAM_DAU_TYLE":1.0,"BHYT_DONGIA_CHITRA":348.0,"BHYT_THANHTIEN_CHITRA":1044.00,"BENHNHAN_PHAITHANHTOAN":0.00,"GIATRI_HOADON":0.0,"GIATRI_HOADON_DATHANHTOAN":0.0,"GIATRI_BIENLAI":0.0,"GIATRI_BIENLAI_DATHANHTOAN":0.0,"GIATRI_BENHNHAN_DATHANHTOAN":0.0,"DATHUCHIEN":"0","KHONGTHUTIEN":"0","BHYTDONGTIEN":"0","DICHVU_TL":0.0,"BHYT_DONGIA_DONGCT_DAU":0.0,"SOBHYT":"HN238382272757838523","SOBHYT_HUONG_ID":28371,"GIATRIMIENGIAM":0.0,"GIATRIMIENGIAM_BHTN":0.0,"GIATRIMIENGIAM_THANHVIEN":0.0,"GIATRIMIENGIAM_CONGTY":0.0,"BHYT_CK2_KHONGTHANHTOAN":false},{"VIENPHI_ID":674476,"TIEPNHAN_ID":27344,"DICHVU_ID":null,"BENHAN_ID":5859,"SOLUONG":2.0000,"DONGIA_DOANHTHU":4000.0000,"THANHTIEN_DOANHTHU":8000.00,"BHYT_TL":1.0000,"BHYT_DONGIA":0.0,"BHYT_THANHTIEN":0.0,"BHYT_DONGIA_CONGKHAM_DAU":0.0,"BHYT_CONGKHAM_DAU_TYLE":1.0,"BHYT_DONGIA_CHITRA":0.0,"BHYT_THANHTIEN_CHITRA":0.0,"BENHNHAN_PHAITHANHTOAN":8000.00,"GIATRI_HOADON":0.0,"GIATRI_HOADON_DATHANHTOAN":0.0,"GIATRI_BIENLAI":8000.00000000,"GIATRI_BIENLAI_DATHANHTOAN":0.0,"GIATRI_BENHNHAN_DATHANHTOAN":0.0,"DATHUCHIEN":"0","KHONGTHUTIEN":"0","BHYTDONGTIEN":"0","DICHVU_TL":0.0,"BHYT_DONGIA_DONGCT_DAU":0.0,"SOBHYT":"HN238382272757838523","SOBHYT_HUONG_ID":28371,"GIATRIMIENGIAM":0.0,"GIATRIMIENGIAM_BHTN":0.0,"GIATRIMIENGIAM_THANHVIEN":0.0,"GIATRIMIENGIAM_CONGTY":0.0,"BHYT_CK2_KHONGTHANHTOAN":false},{"VIENPHI_ID":674477,"TIEPNHAN_ID":27344,"DICHVU_ID":null,"BENHAN_ID":5859,"SOLUONG":0.5000,"DONGIA_DOANHTHU":25000.0000,"THANHTIEN_DOANHTHU":12500.00,"BHYT_TL":1.0000,"BHYT_DONGIA":0.0,"BHYT_THANHTIEN":0.0,"BHYT_DONGIA_CONGKHAM_DAU":0.0,"BHYT_CONGKHAM_DAU_TYLE":1.0,"BHYT_DONGIA_CHITRA":0.0,"BHYT_THANHTIEN_CHITRA":0.0,"BENHNHAN_PHAITHANHTOAN":12500.00,"GIATRI_HOADON":0.0,"GIATRI_HOADON_DATHANHTOAN":0.0,"GIATRI_BIENLAI":12500.00000000,"GIATRI_BIENLAI_DATHANHTOAN":0.0,"GIATRI_BENHNHAN_DATHANHTOAN":0.0,"DATHUCHIEN":"0","KHONGTHUTIEN":"0","BHYTDONGTIEN":"0","DICHVU_TL":0.0,"BHYT_DONGIA_DONGCT_DAU":0.0,"SOBHYT":"HN238382272757838523","SOBHYT_HUONG_ID":28371,"GIATRIMIENGIAM":0.0,"GIATRIMIENGIAM_BHTN":0.0,"GIATRIMIENGIAM_THANHVIEN":0.0,"GIATRIMIENGIAM_CONGTY":0.0,"BHYT_CK2_KHONGTHANHTOAN":false},{"VIENPHI_ID":674544,"TIEPNHAN_ID":27344,"DICHVU_ID":null,"BENHAN_ID":5859,"SOLUONG":1.0000,"DONGIA_DOANHTHU":13500.0000,"THANHTIEN_DOANHTHU":13500.00,"BHYT_TL":1.0,"BHYT_DONGIA":8925.0000,"BHYT_THANHTIEN":8925.00,"BHYT_DONGIA_CONGKHAM_DAU":0.0,"BHYT_CONGKHAM_DAU_TYLE":1.0,"BHYT_DONGIA_CHITRA":8925.0,"BHYT_THANHTIEN_CHITRA":8925.00,"BENHNHAN_PHAITHANHTOAN":4575.00,"GIATRI_HOADON":0.0,"GIATRI_HOADON_DATHANHTOAN":0.0,"GIATRI_BIENLAI":4575.00,"GIATRI_BIENLAI_DATHANHTOAN":0.0,"GIATRI_BENHNHAN_DATHANHTOAN":0.0,"DATHUCHIEN":"0","KHONGTHUTIEN":"0","BHYTDONGTIEN":"0","DICHVU_TL":0.0,"BHYT_DONGIA_DONGCT_DAU":0.0,"SOBHYT":"HN238382272757838523","SOBHYT_HUONG_ID":28371,"GIATRIMIENGIAM":0.0,"GIATRIMIENGIAM_BHTN":0.0,"GIATRIMIENGIAM_THANHVIEN":0.0,"GIATRIMIENGIAM_CONGTY":0.0,"BHYT_CK2_KHONGTHANHTOAN":false},{"VIENPHI_ID":674545,"TIEPNHAN_ID":27344,"DICHVU_ID":null,"BENHAN_ID":5859,"SOLUONG":2.0000,"DONGIA_DOANHTHU":16000.0000,"THANHTIEN_DOANHTHU":32000.00,"BHYT_TL":1.0,"BHYT_DONGIA":16000.0000,"BHYT_THANHTIEN":32000.00,"BHYT_DONGIA_CONGKHAM_DAU":0.0,"BHYT_CONGKHAM_DAU_TYLE":1.0,"BHYT_DONGIA_CHITRA":16000.0,"BHYT_THANHTIEN_CHITRA":32000.00,"BENHNHAN_PHAITHANHTOAN":0.00,"GIATRI_HOADON":0.0,"GIATRI_HOADON_DATHANHTOAN":0.0,"GIATRI_BIENLAI":0.0,"GIATRI_BIENLAI_DATHANHTOAN":0.0,"GIATRI_BENHNHAN_DATHANHTOAN":0.0,"DATHUCHIEN":"0","KHONGTHUTIEN":"0","BHYTDONGTIEN":"0","DICHVU_TL":0.0,"BHYT_DONGIA_DONGCT_DAU":0.0,"SOBHYT":"HN238382272757838523","SOBHYT_HUONG_ID":28371,"GIATRIMIENGIAM":0.0,"GIATRIMIENGIAM_BHTN":0.0,"GIATRIMIENGIAM_THANHVIEN":0.0,"GIATRIMIENGIAM_CONGTY":0.0,"BHYT_CK2_KHONGTHANHTOAN":false},{"VIENPHI_ID":674546,"TIEPNHAN_ID":27344,"DICHVU_ID":null,"BENHAN_ID":5859,"SOLUONG":3.0000,"DONGIA_DOANHTHU":13500.0000,"THANHTIEN_DOANHTHU":40500.00,"BHYT_TL":1.0,"BHYT_DONGIA":8715.0000,"BHYT_THANHTIEN":26145.00,"BHYT_DONGIA_CONGKHAM_DAU":0.0,"BHYT_CONGKHAM_DAU_TYLE":1.0,"BHYT_DONGIA_CHITRA":8715.0,"BHYT_THANHTIEN_CHITRA":26145.00,"BENHNHAN_PHAITHANHTOAN":14355.00,"GIATRI_HOADON":0.0,"GIATRI_HOADON_DATHANHTOAN":0.0,"GIATRI_BIENLAI":14355.00,"GIATRI_BIENLAI_DATHANHTOAN":0.0,"GIATRI_BENHNHAN_DATHANHTOAN":0.0,"DATHUCHIEN":"0","KHONGTHUTIEN":"0","BHYTDONGTIEN":"0","DICHVU_TL":0.0,"BHYT_DONGIA_DONGCT_DAU":0.0,"SOBHYT":"HN238382272757838523","SOBHYT_HUONG_ID":28371,"GIATRIMIENGIAM":0.0,"GIATRIMIENGIAM_BHTN":0.0,"GIATRIMIENGIAM_THANHVIEN":0.0,"GIATRIMIENGIAM_CONGTY":0.0,"BHYT_CK2_KHONGTHANHTOAN":false},{"VIENPHI_ID":674547,"TIEPNHAN_ID":27344,"DICHVU_ID":null,"BENHAN_ID":5859,"SOLUONG":3.0000,"DONGIA_DOANHTHU":52500.0000,"THANHTIEN_DOANHTHU":157500.00,"BHYT_TL":1.0,"BHYT_DONGIA":52500.0000,"BHYT_THANHTIEN":157500.00,"BHYT_DONGIA_CONGKHAM_DAU":0.0,"BHYT_CONGKHAM_DAU_TYLE":1.0,"BHYT_DONGIA_CHITRA":52500.0,"BHYT_THANHTIEN_CHITRA":157500.00,"BENHNHAN_PHAITHANHTOAN":0.00,"GIATRI_HOADON":0.0,"GIATRI_HOADON_DATHANHTOAN":0.0,"GIATRI_BIENLAI":0.0,"GIATRI_BIENLAI_DATHANHTOAN":0.0,"GIATRI_BENHNHAN_DATHANHTOAN":0.0,"DATHUCHIEN":"0","KHONGTHUTIEN":"0","BHYTDONGTIEN":"0","DICHVU_TL":0.0,"BHYT_DONGIA_DONGCT_DAU":0.0,"SOBHYT":"HN238382272757838523","SOBHYT_HUONG_ID":28371,"GIATRIMIENGIAM":0.0,"GIATRIMIENGIAM_BHTN":0.0,"GIATRIMIENGIAM_THANHVIEN":0.0,"GIATRIMIENGIAM_CONGTY":0.0,"BHYT_CK2_KHONGTHANHTOAN":false},{"VIENPHI_ID":674548,"TIEPNHAN_ID":27344,"DICHVU_ID":null,"BENHAN_ID":5859,"SOLUONG":1.0000,"DONGIA_DOANHTHU":945.0000,"THANHTIEN_DOANHTHU":945.00,"BHYT_TL":1.0,"BHYT_DONGIA":945.0000,"BHYT_THANHTIEN":945.00,"BHYT_DONGIA_CONGKHAM_DAU":0.0,"BHYT_CONGKHAM_DAU_TYLE":1.0,"BHYT_DONGIA_CHITRA":945.0,"BHYT_THANHTIEN_CHITRA":945.00,"BENHNHAN_PHAITHANHTOAN":0.00,"GIATRI_HOADON":0.0,"GIATRI_HOADON_DATHANHTOAN":0.0,"GIATRI_BIENLAI":0.0,"GIATRI_BIENLAI_DATHANHTOAN":0.0,"GIATRI_BENHNHAN_DATHANHTOAN":0.0,"DATHUCHIEN":"0","KHONGTHUTIEN":"0","BHYTDONGTIEN":"0","DICHVU_TL":0.0,"BHYT_DONGIA_DONGCT_DAU":0.0,"SOBHYT":"HN238382272757838523","SOBHYT_HUONG_ID":28371,"GIATRIMIENGIAM":0.0,"GIATRIMIENGIAM_BHTN":0.0,"GIATRIMIENGIAM_THANHVIEN":0.0,"GIATRIMIENGIAM_CONGTY":0.0,"BHYT_CK2_KHONGTHANHTOAN":false},{"VIENPHI_ID":674549,"TIEPNHAN_ID":27344,"DICHVU_ID":null,"BENHAN_ID":5859,"SOLUONG":2.0000,"DONGIA_DOANHTHU":10500.0000,"THANHTIEN_DOANHTHU":21000.00,"BHYT_TL":1.0,"BHYT_DONGIA":10500.0000,"BHYT_THANHTIEN":21000.00,"BHYT_DONGIA_CONGKHAM_DAU":0.0,"BHYT_CONGKHAM_DAU_TYLE":1.0,"BHYT_DONGIA_CHITRA":10500.0,"BHYT_THANHTIEN_CHITRA":21000.00,"BENHNHAN_PHAITHANHTOAN":0.00,"GIATRI_HOADON":0.0,"GIATRI_HOADON_DATHANHTOAN":0.0,"GIATRI_BIENLAI":0.0,"GIATRI_BIENLAI_DATHANHTOAN":0.0,"GIATRI_BENHNHAN_DATHANHTOAN":0.0,"DATHUCHIEN":"0","KHONGTHUTIEN":"0","BHYTDONGTIEN":"0","DICHVU_TL":0.0,"BHYT_DONGIA_DONGCT_DAU":0.0,"SOBHYT":"HN238382272757838523","SOBHYT_HUONG_ID":28371,"GIATRIMIENGIAM":0.0,"GIATRIMIENGIAM_BHTN":0.0,"GIATRIMIENGIAM_THANHVIEN":0.0,"GIATRIMIENGIAM_CONGTY":0.0,"BHYT_CK2_KHONGTHANHTOAN":false},{"VIENPHI_ID":674550,"TIEPNHAN_ID":27344,"DICHVU_ID":null,"BENHAN_ID":5859,"SOLUONG":1.0000,"DONGIA_DOANHTHU":158000.0000,"THANHTIEN_DOANHTHU":158000.00,"BHYT_TL":1.0,"BHYT_DONGIA":158000.0000,"BHYT_THANHTIEN":158000.00,"BHYT_DONGIA_CONGKHAM_DAU":0.0,"BHYT_CONGKHAM_DAU_TYLE":1.0,"BHYT_DONGIA_CHITRA":158000.0,"BHYT_THANHTIEN_CHITRA":158000.00,"BENHNHAN_PHAITHANHTOAN":0.00,"GIATRI_HOADON":0.0,"GIATRI_HOADON_DATHANHTOAN":0.0,"GIATRI_BIENLAI":0.0,"GIATRI_BIENLAI_DATHANHTOAN":0.0,"GIATRI_BENHNHAN_DATHANHTOAN":0.0,"DATHUCHIEN":"0","KHONGTHUTIEN":"0","BHYTDONGTIEN":"0","DICHVU_TL":0.0,"BHYT_DONGIA_DONGCT_DAU":0.0,"SOBHYT":"HN238382272757838523","SOBHYT_HUONG_ID":28371,"GIATRIMIENGIAM":0.0,"GIATRIMIENGIAM_BHTN":0.0,"GIATRIMIENGIAM_THANHVIEN":0.0,"GIATRIMIENGIAM_CONGTY":0.0,"BHYT_CK2_KHONGTHANHTOAN":false},{"VIENPHI_ID":674551,"TIEPNHAN_ID":27344,"DICHVU_ID":null,"BENHAN_ID":5859,"SOLUONG":2.0000,"DONGIA_DOANHTHU":5500.0000,"THANHTIEN_DOANHTHU":11000.00,"BHYT_TL":1.0,"BHYT_DONGIA":5500.0000,"BHYT_THANHTIEN":11000.00,"BHYT_DONGIA_CONGKHAM_DAU":0.0,"BHYT_CONGKHAM_DAU_TYLE":1.0,"BHYT_DONGIA_CHITRA":5500.0,"BHYT_THANHTIEN_CHITRA":11000.00,"BENHNHAN_PHAITHANHTOAN":0.00,"GIATRI_HOADON":0.0,"GIATRI_HOADON_DATHANHTOAN":0.0,"GIATRI_BIENLAI":0.0,"GIATRI_BIENLAI_DATHANHTOAN":0.0,"GIATRI_BENHNHAN_DATHANHTOAN":0.0,"DATHUCHIEN":"0","KHONGTHUTIEN":"0","BHYTDONGTIEN":"0","DICHVU_TL":0.0,"BHYT_DONGIA_DONGCT_DAU":0.0,"SOBHYT":"HN238382272757838523","SOBHYT_HUONG_ID":28371,"GIATRIMIENGIAM":0.0,"GIATRIMIENGIAM_BHTN":0.0,"GIATRIMIENGIAM_THANHVIEN":0.0,"GIATRIMIENGIAM_CONGTY":0.0,"BHYT_CK2_KHONGTHANHTOAN":false},{"VIENPHI_ID":674552,"TIEPNHAN_ID":27344,"DICHVU_ID":null,"BENHAN_ID":5859,"SOLUONG":1.0000,"DONGIA_DOANHTHU":7000.0000,"THANHTIEN_DOANHTHU":7000.00,"BHYT_TL":1.0,"BHYT_DONGIA":4410.0000,"BHYT_THANHTIEN":4410.00,"BHYT_DONGIA_CONGKHAM_DAU":0.0,"BHYT_CONGKHAM_DAU_TYLE":1.0,"BHYT_DONGIA_CHITRA":4410.0,"BHYT_THANHTIEN_CHITRA":4410.00,"BENHNHAN_PHAITHANHTOAN":2590.00,"GIATRI_HOADON":0.0,"GIATRI_HOADON_DATHANHTOAN":0.0,"GIATRI_BIENLAI":2590.00,"GIATRI_BIENLAI_DATHANHTOAN":0.0,"GIATRI_BENHNHAN_DATHANHTOAN":0.0,"DATHUCHIEN":"0","KHONGTHUTIEN":"0","BHYTDONGTIEN":"0","DICHVU_TL":0.0,"BHYT_DONGIA_DONGCT_DAU":0.0,"SOBHYT":"HN238382272757838523","SOBHYT_HUONG_ID":28371,"GIATRIMIENGIAM":0.0,"GIATRIMIENGIAM_BHTN":0.0,"GIATRIMIENGIAM_THANHVIEN":0.0,"GIATRIMIENGIAM_CONGTY":0.0,"BHYT_CK2_KHONGTHANHTOAN":false},{"VIENPHI_ID":674553,"TIEPNHAN_ID":27344,"DICHVU_ID":null,"BENHAN_ID":5859,"SOLUONG":3.0000,"DONGIA_DOANHTHU":630.0000,"THANHTIEN_DOANHTHU":1890.00,"BHYT_TL":1.0,"BHYT_DONGIA":630.0000,"BHYT_THANHTIEN":1890.00,"BHYT_DONGIA_CONGKHAM_DAU":0.0,"BHYT_CONGKHAM_DAU_TYLE":1.0,"BHYT_DONGIA_CHITRA":630.0,"BHYT_THANHTIEN_CHITRA":1890.00,"BENHNHAN_PHAITHANHTOAN":0.00,"GIATRI_HOADON":0.0,"GIATRI_HOADON_DATHANHTOAN":0.0,"GIATRI_BIENLAI":0.0,"GIATRI_BIENLAI_DATHANHTOAN":0.0,"GIATRI_BENHNHAN_DATHANHTOAN":0.0,"DATHUCHIEN":"0","KHONGTHUTIEN":"0","BHYTDONGTIEN":"0","DICHVU_TL":0.0,"BHYT_DONGIA_DONGCT_DAU":0.0,"SOBHYT":"HN238382272757838523","SOBHYT_HUONG_ID":28371,"GIATRIMIENGIAM":0.0,"GIATRIMIENGIAM_BHTN":0.0,"GIATRIMIENGIAM_THANHVIEN":0.0,"GIATRIMIENGIAM_CONGTY":0.0,"BHYT_CK2_KHONGTHANHTOAN":false},{"VIENPHI_ID":674554,"TIEPNHAN_ID":27344,"DICHVU_ID":null,"BENHAN_ID":5859,"SOLUONG":3.0000,"DONGIA_DOANHTHU":1030.0000,"THANHTIEN_DOANHTHU":3090.00,"BHYT_TL":1.0,"BHYT_DONGIA":1030.0000,"BHYT_THANHTIEN":3090.00,"BHYT_DONGIA_CONGKHAM_DAU":0.0,"BHYT_CONGKHAM_DAU_TYLE":1.0,"BHYT_DONGIA_CHITRA":1030.0,"BHYT_THANHTIEN_CHITRA":3090.00,"BENHNHAN_PHAITHANHTOAN":0.00,"GIATRI_HOADON":0.0,"GIATRI_HOADON_DATHANHTOAN":0.0,"GIATRI_BIENLAI":0.0,"GIATRI_BIENLAI_DATHANHTOAN":0.0,"GIATRI_BENHNHAN_DATHANHTOAN":0.0,"DATHUCHIEN":"0","KHONGTHUTIEN":"0","BHYTDONGTIEN":"0","DICHVU_TL":0.0,"BHYT_DONGIA_DONGCT_DAU":0.0,"SOBHYT":"HN238382272757838523","SOBHYT_HUONG_ID":28371,"GIATRIMIENGIAM":0.0,"GIATRIMIENGIAM_BHTN":0.0,"GIATRIMIENGIAM_THANHVIEN":0.0,"GIATRIMIENGIAM_CONGTY":0.0,"BHYT_CK2_KHONGTHANHTOAN":false},{"VIENPHI_ID":674555,"TIEPNHAN_ID":27344,"DICHVU_ID":null,"BENHAN_ID":5859,"SOLUONG":3.0000,"DONGIA_DOANHTHU":348.0000,"THANHTIEN_DOANHTHU":1044.00,"BHYT_TL":1.0,"BHYT_DONGIA":348.0000,"BHYT_THANHTIEN":1044.00,"BHYT_DONGIA_CONGKHAM_DAU":0.0,"BHYT_CONGKHAM_DAU_TYLE":1.0,"BHYT_DONGIA_CHITRA":348.0,"BHYT_THANHTIEN_CHITRA":1044.00,"BENHNHAN_PHAITHANHTOAN":0.00,"GIATRI_HOADON":0.0,"GIATRI_HOADON_DATHANHTOAN":0.0,"GIATRI_BIENLAI":0.0,"GIATRI_BIENLAI_DATHANHTOAN":0.0,"GIATRI_BENHNHAN_DATHANHTOAN":0.0,"DATHUCHIEN":"0","KHONGTHUTIEN":"0","BHYTDONGTIEN":"0","DICHVU_TL":0.0,"BHYT_DONGIA_DONGCT_DAU":0.0,"SOBHYT":"HN238382272757838523","SOBHYT_HUONG_ID":28371,"GIATRIMIENGIAM":0.0,"GIATRIMIENGIAM_BHTN":0.0,"GIATRIMIENGIAM_THANHVIEN":0.0,"GIATRIMIENGIAM_CONGTY":0.0,"BHYT_CK2_KHONGTHANHTOAN":false},{"VIENPHI_ID":674556,"TIEPNHAN_ID":27344,"DICHVU_ID":null,"BENHAN_ID":5859,"SOLUONG":2.0000,"DONGIA_DOANHTHU":4000.0000,"THANHTIEN_DOANHTHU":8000.00,"BHYT_TL":1.0000,"BHYT_DONGIA":0.0,"BHYT_THANHTIEN":0.0,"BHYT_DONGIA_CONGKHAM_DAU":0.0,"BHYT_CONGKHAM_DAU_TYLE":1.0,"BHYT_DONGIA_CHITRA":0.0,"BHYT_THANHTIEN_CHITRA":0.0,"BENHNHAN_PHAITHANHTOAN":8000.00,"GIATRI_HOADON":0.0,"GIATRI_HOADON_DATHANHTOAN":0.0,"GIATRI_BIENLAI":8000.00000000,"GIATRI_BIENLAI_DATHANHTOAN":0.0,"GIATRI_BENHNHAN_DATHANHTOAN":0.0,"DATHUCHIEN":"0","KHONGTHUTIEN":"0","BHYTDONGTIEN":"0","DICHVU_TL":0.0,"BHYT_DONGIA_DONGCT_DAU":0.0,"SOBHYT":"HN238382272757838523","SOBHYT_HUONG_ID":28371,"GIATRIMIENGIAM":0.0,"GIATRIMIENGIAM_BHTN":0.0,"GIATRIMIENGIAM_THANHVIEN":0.0,"GIATRIMIENGIAM_CONGTY":0.0,"BHYT_CK2_KHONGTHANHTOAN":false}]';        begin        UPDATE TT_VIENPHI        SET        SOLUONG = json.SOLUONG,        DONGIA_DOANHTHU = json.DONGIA_DOANHTHU,        THANHTIEN_DOANHTHU = json.THANHTIEN_DOANHTHU,        BHYT_TL = json.BHYT_TL,        BHYT_DONGIA = json.BHYT_DONGIA,        BHYT_THANHTIEN = json.BHYT_THANHTIEN,        BHYT_DONGIA_CONGKHAM_DAU = json.BHYT_DONGIA_CONGKHAM_DAU,        BHYT_CONGKHAM_DAU_TYLE = json.BHYT_CONGKHAM_DAU_TYLE,        BHYT_DONGIA_CHITRA = json.BHYT_DONGIA_CHITRA,        BHYT_THANHTIEN_CHITRA = json.BHYT_THANHTIEN_CHITRA,        BENHNHAN_PHAITHANHTOAN = json.BENHNHAN_PHAITHANHTOAN,        GIATRI_HOADON = json.GIATRI_HOADON,                GIATRI_BIENLAI = json.GIATRI_BIENLAI,                DATHUCHIEN = json.DATHUCHIEN,                DICHVU_TL = json.DICHVU_TL,        BHYT_DONGIA_DONGCT_DAU = json.BHYT_DONGIA_DONGCT_DAU,        NGAYCAPNHAT = GETDATE()        FROM OPENJSON (@jsonVienPhi)        WITH (        VIENPHI_ID int,        SOLUONG numeric(25, 4),        DONGIA_DOANHTHU numeric(25, 4),        THANHTIEN_DOANHTHU numeric(25, 4),        BHYT_TL numeric(25, 4),        BHYT_DONGIA numeric(25, 4),        BHYT_THANHTIEN numeric(25, 4),        BHYT_DONGIA_CONGKHAM_DAU numeric(25, 4),        BHYT_CONGKHAM_DAU_TYLE numeric(25, 4),        BHYT_DONGIA_CHITRA numeric(25, 4),        BHYT_THANHTIEN_CHITRA numeric(25, 4),        BENHNHAN_PHAITHANHTOAN numeric(25, 4),        GIATRI_HOADON numeric(25, 4),                GIATRI_BIENLAI numeric(25, 4),                DATHUCHIEN char(1),        KHONGTHUTIEN char(1),        BHYTDONGTIEN char(1),        DICHVU_TL numeric(25, 4),        BHYT_DONGIA_DONGCT_DAU numeric(25, 4))  json        WHERE TT_VIENPHI.VIENPHI_ID = json.VIENPHI_ID and json.DONGIA_DOANHTHU > 0                  insert into TT_TINH_VIENPHI_LOG        SELECT json.VIENPHI_ID, json.TIEPNHAN_ID, json.BENHAN_ID, json.SOLUONG, json.BHYT_TL, json.DONGIA_DOANHTHU,        json.THANHTIEN_DOANHTHU, json.BHYT_DONGIA, json.BHYT_THANHTIEN, json.BHYT_DONGIA_CHITRA, json.BHYT_THANHTIEN_CHITRA, json.BENHNHAN_PHAITHANHTOAN,        json.SOBHYT_HUONG_ID, json.SOBHYT, GETDATE(), -1, 'HLU01'        FROM OPENJSON(@jsonVienPhi)        WITH (        VIENPHI_ID int,        TIEPNHAN_ID int,        BENHAN_ID int,        SOLUONG numeric(25, 4),        DONGIA_DOANHTHU numeric(25, 4),        THANHTIEN_DOANHTHU numeric(25, 4),        BHYT_TL numeric(25, 4),        BHYT_DONGIA numeric(25, 4),        BHYT_THANHTIEN numeric(25, 4),        BHYT_DONGIA_CHITRA numeric(25, 4),        BHYT_THANHTIEN_CHITRA numeric(25, 4),        BENHNHAN_PHAITHANHTOAN numeric(25, 4),        SOBHYT_HUONG_ID int,        SOBHYT nvarchar(30)) json        end]
2019-10-31 10:18:23,570 [1] DEBUG - Statement Id: [DAO00067_UpdateDataVienPhiDongiaBHYT] PreparedStatement : [update TT_VIENPHI          set BHYT_DONGIA_CHITRA = 0, BHYT_THANHTIEN = 0, BHYT_THANHTIEN_CHITRA = 0          where          TIEPNHAN_ID = 27344 and BHYT_DONGIA = 0          and (BHYT_DONGIA_CHITRA > 0 or BHYT_THANHTIEN > 0 or BHYT_THANHTIEN_CHITRA > 0)]
2019-10-31 10:18:23,623 [1] DEBUG - Statement Id: [DAO00067_CapnhatDataVienphiKhiHuyThanhtoanHoadon] PreparedStatement : [update TT_VIENPHI        set TT_VIENPHI.HOADON_ID = hdct.HOADON_ID, TT_VIENPHI.GIATRI_BENHNHAN_DATHANHTOAN = TT_VIENPHI.GIATRI_BENHNHAN_DATHANHTOAN + hdct.GIATRI_BENHNHAN_DATHANHTOAN        from (select CT.HOADON_ID, CT.VIENPHI_ID, CT.GIATRI_BENHNHAN_DATHANHTOAN        from TT_HOADON_CHITIET_NGOAITRU CT        join TT_HOADON HD on HD.HOADON_ID = CT.HOADON_ID        join TT_VIENPHI vp on vp.VIENPHI_ID = ct.VIENPHI_ID        where HD.DATHANHTOAN = 1 and HD.HUYHOADON = 0 and HD.HOANTRA = 0 and vp.TIEPNHAN_ID =  @param0 ) hdct        where        TT_VIENPHI.VIENPHI_ID = hdct.VIENPHI_ID and TT_VIENPHI.HOADON_ID is null and isnull(TT_VIENPHI.GIATRI_BENHNHAN_DATHANHTOAN,0) = 0        and TT_VIENPHI.TIEPNHAN_ID =  @param0           update TT_VIENPHI        set TT_VIENPHI.HOADON_ID = null, TT_VIENPHI.GIATRI_BENHNHAN_DATHANHTOAN = TT_VIENPHI.GIATRI_BENHNHAN_DATHANHTOAN - hdct.GIATRI_BENHNHAN_DATHANHTOAN,        TT_VIENPHI.DATHANHTOAN = '0'        from (select CT.HOADON_ID, CT.VIENPHI_ID, CT.GIATRI_BENHNHAN_DATHANHTOAN        from TT_HOADON_CHITIET_NGOAITRU CT        join TT_HOADON HD on HD.HOADON_ID = CT.HOADON_ID        join TT_VIENPHI vp on vp.VIENPHI_ID = ct.VIENPHI_ID and vp.HOADON_ID = ct.HOADON_ID        where HD.DATHANHTOAN = 0 and (HD.HUYHOADON = 1 or HD.HOANTRA = 1) and vp.TIEPNHAN_ID =  @param0 ) hdct        where        TT_VIENPHI.VIENPHI_ID = hdct.VIENPHI_ID and TT_VIENPHI.HOADON_ID = hdct.HOADON_ID        and TT_VIENPHI.TIEPNHAN_ID =  @param0]
2019-10-31 10:18:23,623 [1] DEBUG - Statement Id: [DAO00067_CapnhatDataVienphiKhiHuyThanhtoanHoadon] Parameters: [@param0=[TIEPNHAN_ID,27344]]
2019-10-31 10:18:23,623 [1] DEBUG - Statement Id: [DAO00067_CapnhatDataVienphiKhiHuyThanhtoanHoadon] Types: [@param0=[Int64, System.Int64]]
2019-10-31 10:18:23,768 [1] DEBUG - Statement Id: [DAO00000_GetDoiTuongIsBHYT] PreparedStatement : [select * from TM_DOITUONG Where DOITUONG_ID = 6 and MADOITUONG like '%BHYT%']
2019-10-31 10:18:23,878 [1] DEBUG - Statement Id: [DAO00064_GetDOITUONG] PreparedStatement : [SELECT TOP 1      DT.TENDOITUONG,      BHYT.SOTHE,      BHYT.NGAYHIEULUC,      BHYT.NGAYHETHIEULUC,      BHYT.BENHVIEN_KCB_ID AS MABENHVIEN,      BV.TENBENHVIEN,      BHYT.NGAYMIENDONGCHITRA,      BHYT.TREN5NAM        FROM TT_BENHNHAN_BHYT BHYT, TM_DOITUONG DT, TM_BENHVIEN BV      WHERE      DT.NHOMTHE LIKE '%' + LEFT(BHYT.SOTHE,3) + '%'      AND BHYT.BENHNHAN_ID = '23317'      AND BHYT.BENHVIEN_KCB_ID = BV.MABENHVIEN      ORDER BY BHYT.NGAYTAO DESC]
2019-10-31 10:18:24,035 [1] DEBUG - Statement Id: [DAO00064_GetNgayDangKyDichVu] PreparedStatement : [SELECT        DISTINCT CONVERT(date, NGAYTAO) as NGAYCHIPHI        FROM TT_VIENPHI        WHERE        TIEPNHAN_ID = '27344'         and           BENHAN_ID = '5859'                 ORDER BY NGAYCHIPHI]
2019-10-31 10:18:24,378 [1] DEBUG - Statement Id: [DAO00064_GetAllNgayYeucauDV] PreparedStatement : [SELECT        DISTINCT DVYEUCAU_ID, DICHVU_ID, CONVERT(date, NGAYYEUCAU) NGAYYEUCAU        FROM TT_DVYEUCAU        WHERE        TIEPNHAN_ID = '27344'         and           BENHAN_ID = '5859']
2019-10-31 10:18:24,415 [1] DEBUG - Statement Id: [DAO00064_GetAllNgayYeucauYlenh] PreparedStatement : [SELECT        DISTINCT A.TOATHUOC_ID, A.KHAMBENH_ID, A.DUOC_ID, CONVERT(date, B.THOIGIANKHAM) NGAYYEUCAU        FROM TT_NOITRU_TOATHUOC A        inner join TT_NOITRU_KHAMBENH B on B.KHAMBENH_ID = A.KHAMBENH_ID        WHERE        B.BENHAN_ID = '5859']
2019-10-31 10:18:24,530 [1] DEBUG - Statement Id: [DAO00063_AllGetTrangThaiThuocbyBenan_Id] PreparedStatement : [select A.CHUNGTU_ID, A.PHIEULINH_ID, A.HUYTOATHUOC, A.NGUOITAO_ID, A.TOATHUOC_ID        from TT_NOITRU_TOATHUOC A        inner join TT_NOITRU_KHAMBENH B on B.KHAMBENH_ID = A.KHAMBENH_ID        where B.BENHAN_ID  = '5859']
2019-10-31 10:18:24,572 [1] DEBUG - Statement Id: [DAO00064_TT_VIENPHI_GetList] PreparedStatement : [select distinct a.*, b.TINHTRANG AS TINHTRANG_MG, d.TINHTRANG_BHTN, e.TINHTRANG_MGCT        , b.MIENGIAMCHITIET_ID, b.GIATRIMIENGIAM, d.GIATRIMIENGIAM_BHTN, e.GIATRIMIENGIAM_CONGTY, e.GIATRIMIENGIAM_CONGTY as GIATRIMIENGIAM_CTCT, f.GIATRIMIENGIAM_THANHVIEN        , c.DVKEMTHEO, c.DVKEMTHEO_KHACEKIP, isnull(ttnt.PHONGBANRATOA_ID,c.NOIYEUCAU_ID) NOIYEUCAU_ID, c.NOITHUCHIEN_ID, c.DVYEUCAU_ID, c.HUYYEUCAU, c.DANGKY_ID,        isnull(dv.TENDICHVU, dc.TENDUOCDAYDU) NOIDUNG, isnull(dv.MADICHVU, dc.MADUOC) MADICHVU, dv.NORESULT, dc.DONVITINH, ld.MALOAIDUOC, dc.BHYT DUOC_BHYT, ld.LOAIVATTU_ID, ndv.MANHOMDICHVU        from        (select VP.*, sbh.SOBHYT as SOBHYT_HUONG        from TT_VIENPHI VP        left join TT_TIEPNHAN_SOTHEBHYT sbh on sbh.SOBHYT_HUONG_ID = VP.SOBHYT_HUONG_ID        where        ((isnull(VP.GIATRI_BENHNHAN_DATHANHTOAN, 0) = 0 and isnull(VP.DATHANHTOAN, 0) = 0)        and VP.REF_TABLE != 'TT_MAU_CHUNGTU_CHITIET'                 )         and             VP.TIEPNHAN_ID = '27344'           and           VP.BENHAN_ID = '5859'         and             VP.BENHVIEN_ID = 'HLU01'                   )a left join                         (        select VIENPHI_ID, MG.TINHTRANG, MGCT.MIENGIAMCHITIET_ID, Sum(MGCT.GIATRIMIENGIAM) as GIATRIMIENGIAM        from TT_MIENGIAM MG INNER JOIN TT_MIENGIAM_CHITIET MGCT ON MG.MIENGIAM_ID = MGCT.MIENGIAM_ID        where MG.TIEPNHAN_ID= '27344' and MGCT.REF_TABLE = 'TT_MIENGIAM'        group by VIENPHI_ID, MG.TINHTRANG, MGCT.MIENGIAMCHITIET_ID        )b        on a.VIENPHI_ID = b.VIENPHI_ID          left join(        select VIENPHI_ID, MG.TINHTRANG AS TINHTRANG_BHTN, SUM(MGCT.GIATRIMIENGIAM) as GIATRIMIENGIAM_BHTN        from TT_MIENGIAM_BHTN MG INNER JOIN TT_MIENGIAM_CHITIET MGCT ON MG.MIENGIAM_BHTN_ID = MGCT.MIENGIAM_ID        where MG.TIEPNHAN_ID= '27344' and MGCT.REF_TABLE = 'TT_MIENGIAM_BHTN'        group by VIENPHI_ID, MG.TINHTRANG        )d        on a.VIENPHI_ID = d.VIENPHI_ID          left join(        select VIENPHI_ID, MG.TINHTRANG AS TINHTRANG_MGCT, Sum(MGCT.GIATRIMIENGIAM) as GIATRIMIENGIAM_CONGTY        from TT_MIENGIAM_CONGTY MG INNER JOIN TT_MIENGIAM_CHITIET MGCT ON MG.MIENGIAM_CONGTY_ID = MGCT.MIENGIAM_ID        where MG.TIEPNHAN_ID= '27344' and MGCT.REF_TABLE = 'TT_MIENGIAM_CONGTY'        group by VIENPHI_ID, MG.TINHTRANG        )e        on a.VIENPHI_ID = e.VIENPHI_ID          left join(        select VIENPHI_ID, MG.TINHTRANG AS TINHTRANG_MGCT, Sum(MGCT.GIATRIMIENGIAM) as GIATRIMIENGIAM_THANHVIEN        from TT_MIENGIAM_THANHVIEN MG INNER JOIN TT_MIENGIAM_CHITIET MGCT ON MG.MIENGIAM_THANHVIEN_ID = MGCT.MIENGIAM_ID        where MG.TIEPNHAN_ID= '27344' and MGCT.REF_TABLE = 'TT_MIENGIAM_THANHVIEN'        group by VIENPHI_ID, MG.TINHTRANG        )f        on a.VIENPHI_ID = f.VIENPHI_ID          left join        (        select DVYEUCAU_ID, TRANGTHAI, BHYTDONGTIEN, HUYYEUCAU, DVKEMTHEO, DVKEMTHEO_KHACEKIP, NOIYEUCAU_ID, NOITHUCHIEN_ID, DANGKY_ID from TT_DVYEUCAU        where TIEPNHAN_ID = '27344'        )c on c.DVYEUCAU_ID = a.REF_ID and a.REF_TABLE = 'TT_DVYEUCAU'        left join        (        select PHONGBANRATOA_ID, TOATHUOC_ID, 'TT_NOITRU_TOATHUOC' REF_TABLE  from TT_NOITRU_TOATHUOC where TIEPNHAN_ID  = '27344'        union        select PHONGBAN_ID as PHONGBANRATOA_ID, CLSKETQUA_VTYT_ID as TOATHUOC_ID, 'TT_CLSKETQUA_VTYT' REF_TABLE        from TT_CLSKETQUA_VTYT where exists (select DVYEUCAU_ID from TT_DVYEUCAU where TT_CLSKETQUA_VTYT.DVYEUCAU_ID = DVYEUCAU_ID and TIEPNHAN_ID  = '27344')        union        select PHONGBAN_ID as PHONGBANRATOA_ID, KHAMBENH_VTYT_ID as TOATHUOC_ID, 'TT_NGOAITRU_KHAMBENH_VTYT' REF_TABLE        from TT_NGOAITRU_KHAMBENH_VTYT where exists (select DVYEUCAU_ID from TT_DVYEUCAU where TT_NGOAITRU_KHAMBENH_VTYT.DVYEUCAU_ID = DVYEUCAU_ID and  TIEPNHAN_ID  = '27344')        union        select B.PHONGBANTHUCHIEN_ID as PHONGBANRATOA_ID, PHAUTHUAT_VTYT_ID as TOATHUOC_ID, 'TT_PHAUTHUAT_VTYT' REF_TABLE        from TT_PHAUTHUAT_VTYT A        left join TT_PHAUTHUAT B on A.PHAUTHUAT_ID = B.PHAUTHUAT_ID        where B.TIEPNHAN_ID  = '27344'        union        select B.PHONGBAN_ID as PHONGBANRATOA_ID, TOATHUOC_ID, 'TT_NGOAITRU_TOATHUOC' REF_TABLE        from TT_NGOAITRU_TOATHUOC A        left join TT_NGOAITRU_KHAMBENH B on A.KHAMBENH_ID = B.KHAMBENH_ID        where B.TIEPNHAN_ID  = '27344'        ) ttnt on ttnt.TOATHUOC_ID = a.REF_ID and a.REF_TABLE = ttnt.REF_TABLE        left join TM_DUOC dc on A.DUOC_ID = dc.DUOC_ID        left join TM_LOAIDUOC ld on dc.LOAIDUOC_ID = ld.LOAIDUOC_ID        left join TM_DICHVU dv on A.DICHVU_ID = dv.DICHVU_ID and A.REF_TABLE = 'TT_DVYEUCAU'        left join TM_NHOMDICHVU ndv on ndv.NHOMDICHVU_ID = dv.NHOMDICHVU_ID        where        c.HUYYEUCAU = '0' or c.HUYYEUCAU is null]
2019-10-31 10:18:25,503 [1] DEBUG - Statement Id: [DAO00009_TT_TIEPNHAN_GetProcess] PreparedStatement : [select PROCESS_ID from TT_TIEPNHAN where SOTIEPNHAN = 'TN190604.0000218']
2019-10-31 10:18:25,642 [1] DEBUG - Statement Id: [DAOWF004_laytrangthaiDV] PreparedStatement : [select top 1 A.CURR_STATE_CODE as STATE_CODE, isNull(C.SHORT_NAME,C.NAME) as TRANGTHAI, C.NAME as TRANGTHAI_CHITIET, C.STATUS_CODE, D.ISACTIVE as ACTIVE, E.STATUS_CODE  as OLD_STATUSCODE        from TT_REQUEST_SERVICE_DETAIL A                left join (select * from TT_REQUEST_SERVICE where PARA = '{"DICHVU_ID":"5445","DVYEUCAU_ID":"204435"}') D on D.ID = A.REQUEST_SERVICE_ID        left join TM_STATE C on A.CURR_STATE_CODE = C.STATE_CODE and C.PROCESS_CODE = D.PROCESS_CODE        left join TM_STATE E on A.OLD_STATE_CODE = E.STATE_CODE and E.PROCESS_CODE = D.PROCESS_CODE        where        A.REQUEST_SERVICE_ID = (select top 1 ID from TT_REQUEST_SERVICE where PARA = '{"DICHVU_ID":"5445","DVYEUCAU_ID":"204435"}' order by ID desc)        order by A.ID desc]
2019-10-31 10:18:26,320 [1] DEBUG - Statement Id: [DAO00009_TT_TIEPNHAN_GetProcess] PreparedStatement : [select PROCESS_ID from TT_TIEPNHAN where SOTIEPNHAN = 'TN190604.0000218']
2019-10-31 10:18:26,715 [1] DEBUG - Statement Id: [DAOWF004_laytrangthaiDV] PreparedStatement : [select top 1 A.CURR_STATE_CODE as STATE_CODE, isNull(C.SHORT_NAME,C.NAME) as TRANGTHAI, C.NAME as TRANGTHAI_CHITIET, C.STATUS_CODE, D.ISACTIVE as ACTIVE, E.STATUS_CODE  as OLD_STATUSCODE        from TT_REQUEST_SERVICE_DETAIL A                left join (select * from TT_REQUEST_SERVICE where PARA = '{"DICHVU_ID":"4017","DVYEUCAU_ID":"204558"}') D on D.ID = A.REQUEST_SERVICE_ID        left join TM_STATE C on A.CURR_STATE_CODE = C.STATE_CODE and C.PROCESS_CODE = D.PROCESS_CODE        left join TM_STATE E on A.OLD_STATE_CODE = E.STATE_CODE and E.PROCESS_CODE = D.PROCESS_CODE        where        A.REQUEST_SERVICE_ID = (select top 1 ID from TT_REQUEST_SERVICE where PARA = '{"DICHVU_ID":"4017","DVYEUCAU_ID":"204558"}' order by ID desc)        order by A.ID desc]
2019-10-31 10:18:27,011 [1] DEBUG - Statement Id: [DAO00009_TT_TIEPNHAN_GetProcess] PreparedStatement : [select PROCESS_ID from TT_TIEPNHAN where SOTIEPNHAN = 'TN190604.0000218']
2019-10-31 10:18:27,091 [1] DEBUG - Statement Id: [DAOWF004_laytrangthaiDV] PreparedStatement : [select top 1 A.CURR_STATE_CODE as STATE_CODE, isNull(C.SHORT_NAME,C.NAME) as TRANGTHAI, C.NAME as TRANGTHAI_CHITIET, C.STATUS_CODE, D.ISACTIVE as ACTIVE, E.STATUS_CODE  as OLD_STATUSCODE        from TT_REQUEST_SERVICE_DETAIL A                left join (select * from TT_REQUEST_SERVICE where PARA = '{"DICHVU_ID":"4523","DVYEUCAU_ID":"204559"}') D on D.ID = A.REQUEST_SERVICE_ID        left join TM_STATE C on A.CURR_STATE_CODE = C.STATE_CODE and C.PROCESS_CODE = D.PROCESS_CODE        left join TM_STATE E on A.OLD_STATE_CODE = E.STATE_CODE and E.PROCESS_CODE = D.PROCESS_CODE        where        A.REQUEST_SERVICE_ID = (select top 1 ID from TT_REQUEST_SERVICE where PARA = '{"DICHVU_ID":"4523","DVYEUCAU_ID":"204559"}' order by ID desc)        order by A.ID desc]
2019-10-31 10:18:27,391 [1] DEBUG - Statement Id: [DAO00017_GetLoaiGiaDoiTuongDichVu] PreparedStatement : [select a.LOAIGIA_ID, a.TENLOAIGIA, a.MALOAIGIA, a.CAPTREN_ID, MIN(a.UUTIEN_NGUON) AS UUTIEN_NGUON          , MAX(a.DOUUTIEN) AS DOUUTIEN, MIN(ISNULL(a.GIAHOTRO,0)) AS GIAHOTRO          from(                        select distinct A.LOAIGIA_ID, C.TENLOAIGIA, C.MALOAIGIA, 0 as UUTIEN_NGUON, isnull(B.DOUUTIEN,0) as DOUUTIEN, B.GIAHOTRO, C.CAPTREN_ID            from TM_DOITUONG_GIADICHVU A            left join TM_DOITUONG_LOAIGIA B on A.LOAIGIA_ID = B.LOAIGIA_ID and A.DOITUONG_ID = B.DOITUONG_ID and B.BENHVIEN_ID = 'HLU01'            inner join TM_LOAIGIA C on A.LOAIGIA_ID = C.LOAIGIA_ID and C.BENHVIEN_ID = 'HLU01'            where A.DOITUONG_ID = '6'                            and C.CAPTREN_ID = (select LOAIGIA_ID from TM_LOAIGIA              where MALOAIGIA = 'GiaDichVu'              and BENHVIEN_ID = 'HLU01')                         and A.BENHVIEN_ID = 'HLU01'                     ) a          where a.DOUUTIEN != 0 and a.DOUUTIEN is not null          group by a.LOAIGIA_ID, a.TENLOAIGIA, a.MALOAIGIA, a.CAPTREN_ID          order by MAX(a.UUTIEN_NGUON) desc ,MAX(a.DOUUTIEN) asc]
2019-10-31 10:18:27,949 [1] DEBUG - Statement Id: [DAO00019_Get_TiepNhan_ThongtinChuyenVien] PreparedStatement : [select CHANDOANNGT, ICDNOIGIOITHIEU_ID, LYDOCHUYENVIEN_ID, NOIGIOITHIEU_ID, HINHTHUCCHUYENVIEN_ID, THOIGIANCHUYENTUYEN, SOCHUYENVIEN        from TT_TIEPNHAN        where TIEPNHAN_ID = '27344']
2019-10-31 10:18:28,146 [1] DEBUG - Statement Id: [DAO00019_GetBenhNhanThanhVien] PreparedStatement : [select A.*, B.TENTHETHANHVIEN, convert(varchar, A.NGAYHIEULUC, 103) as NGAYHIEULUCTHE, B.SOTIEN        from TT_CSKH_THANHVIEN_CAPTHE A        left join TM_CSKH_THETHANHVIEN B on B.THETHANHVIEN_ID = A.THETHANHVIEN_ID        where   THANHVIEN_ID in (        select THANHVIEN_ID from TT_CSKH_THANHVIEN        where (BENHNHAN_ID = '23317' and TAMNGUNG is null or TAMNGUNG = '0')        and (DAXOA is null or DAXOA = '0'))        and A.KICHHOAT = '1' and (A.TAMNGUNG = '0' or A.TAMNGUNG is null)                 and A.BENHVIEN_ID = 'HLU01'        order by THE_ID desc]
2019-10-31 10:18:28,208 [1] DEBUG - Statement Id: [DAO00019_GetBenhNhanThanhVien] PreparedStatement : [select A.*, B.TENTHETHANHVIEN, convert(varchar, A.NGAYHIEULUC, 103) as NGAYHIEULUCTHE, B.SOTIEN        from TT_CSKH_THANHVIEN_CAPTHE A        left join TM_CSKH_THETHANHVIEN B on B.THETHANHVIEN_ID = A.THETHANHVIEN_ID        where   THANHVIEN_ID in (        select THANHVIEN_ID from TT_CSKH_THANHVIEN        where (BENHNHAN_ID = '23317' and TAMNGUNG is null or TAMNGUNG = '0')        and (DAXOA is null or DAXOA = '0'))        and A.KICHHOAT = '1' and (A.TAMNGUNG = '0' or A.TAMNGUNG is null)                 and A.BENHVIEN_ID = 'HLU01'        order by THE_ID desc]
2019-10-31 10:18:31,673 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'IPD62'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2019-10-31 10:18:32,158 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'COM98'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2019-10-31 10:18:32,782 [1] DEBUG - Statement Id: [DAO00012_GetList] PreparedStatement : [select        DICTIONARY_ID,        DICTIONARY_CODE,        DICTIONARY_NAME,        ATTRIBUTE1,        ATTRIBUTE2,        DICTIONARY_NAME_EN        from LST_DICTIONARY        where LST_DICTIONARY.Enabled = '1'         AND           LST_DICTIONARY.DICTIONARY_TYPE_CODE = 'PhanLoaiTiepNhan'                 order by LST_DICTIONARY.IDX]
2019-10-31 10:18:32,820 [1] DEBUG - Statement Id: [DAO00019_GetThongTinTiepNhanByKey] PreparedStatement : [select top 1 A.*, B.MAYTE, B.TENBENHNHAN, B.NAMSINH, B.NGAYSINH        from TT_TIEPNHAN A        inner join TT_BENHNHAN B on B.BENHNHAN_ID = A.BENHNHAN_ID and B.BENHVIEN_ID = A.BENHVIEN_ID        where A.TIEPNHAN_ID = 27344        and A.BENHVIEN_ID = 'HLU01']
2019-10-31 10:18:48,666 [1] DEBUG - Statement Id: [DAO00019_UpdateLoaiTiepNhan_VIP_NNG] PreparedStatement : [update TT_TIEPNHAN        set NGAYCAPNHAT = getdate()         ,           SUDUNG_BHTN =  @param0                  where TIEPNHAN_ID =  @param1                      select  @param1]
2019-10-31 10:18:48,666 [1] DEBUG - Statement Id: [DAO00019_UpdateLoaiTiepNhan_VIP_NNG] Parameters: [@param0=[SUDUNG_BHTN,True], @param1=[TIEPNHAN_ID,27344]]
2019-10-31 10:18:48,666 [1] DEBUG - Statement Id: [DAO00019_UpdateLoaiTiepNhan_VIP_NNG] Types: [@param0=[Boolean, System.Boolean], @param1=[Int64, System.Int64]]
2019-10-31 11:13:05,616 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'BIL63'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2019-10-31 11:13:06,321 [1] DEBUG - Statement Id: [DAO00012_GetList] PreparedStatement : [select        DICTIONARY_ID,        DICTIONARY_CODE,        DICTIONARY_NAME,        ATTRIBUTE1,        ATTRIBUTE2,        DICTIONARY_NAME_EN        from LST_DICTIONARY        where LST_DICTIONARY.Enabled = '1'         AND           LST_DICTIONARY.DICTIONARY_TYPE_CODE = 'LyDoKhongThu'                 order by LST_DICTIONARY.IDX]
2019-10-31 11:13:08,957 [1] DEBUG - Statement Id: [DAO00120_MIENGIAM_GetTotalList] PreparedStatement : [SELECT T.TIEPNHAN_ID, CONVERT(VARCHAR,MAX(CASE WHEN VP1.VIENPHI_ID IS NULL THEN 0 ELSE 1 END))        + CONVERT(VARCHAR,MAX(CASE WHEN VP2.VIENPHI_ID IS NULL THEN 0 ELSE 1 END))        + CONVERT(VARCHAR,MAX(CASE WHEN VP3.VIENPHI_ID IS NULL THEN 0 ELSE 1 END)) AS MIENGIAM_STATUS        , CONVERT(VARCHAR,MIN(ISNULL(M1.TINHTRANG,1)))        + CONVERT(VARCHAR,MIN(ISNULL(M2.TINHTRANG,1)))        + CONVERT(VARCHAR,MIN(ISNULL(M3.TINHTRANG,1))) AS MIENGIAM_DUYET_STATUS        FROM TT_TIEPNHAN AS T          LEFT JOIN TT_MIENGIAM_BHTN AS M1 ON M1.TIEPNHAN_ID = T.TIEPNHAN_ID        LEFT JOIN TT_MIENGIAM_CHITIET AS MC1 ON MC1.MIENGIAM_ID = M1.MIENGIAM_BHTN_ID AND MC1.REF_TABLE = 'TT_MIENGIAM_BHTN'        LEFT JOIN TT_VIENPHI AS VP1 ON VP1.VIENPHI_ID = MC1.VIENPHI_ID AND VP1.DATHANHTOAN = '0'          LEFT JOIN TT_MIENGIAM_CONGTY AS M2 ON M2.TIEPNHAN_ID = T.TIEPNHAN_ID        LEFT JOIN TT_MIENGIAM_CHITIET AS MC2 ON MC2.MIENGIAM_ID = M2.MIENGIAM_CONGTY_ID AND MC2.REF_TABLE = 'TT_MIENGIAM_CONGTY'        LEFT JOIN TT_VIENPHI AS VP2 ON VP2.VIENPHI_ID = MC2.VIENPHI_ID AND VP2.DATHANHTOAN = '0'          LEFT JOIN TT_MIENGIAM AS M3 ON M3.TIEPNHAN_ID = T.TIEPNHAN_ID        LEFT JOIN TT_MIENGIAM_CHITIET AS MC3 ON MC3.MIENGIAM_ID = M3.MIENGIAM_ID AND MC3.REF_TABLE = 'TT_MIENGIAM'        LEFT JOIN TT_VIENPHI AS VP3 ON VP3.VIENPHI_ID = MC3.VIENPHI_ID AND VP3.DATHANHTOAN = '0'          WHERE T.TIEPNHAN_ID = 27344 AND T.BENHVIEN_ID = 'HLU01'        GROUP BY T.TIEPNHAN_ID]
2019-10-31 11:13:09,523 [1] DEBUG - Statement Id: [DAO00067_laytrangthaibenhannoitru] PreparedStatement : [select isnull(TRANGTHAI, '') TRANGTHAI from TT_NOITRU_BENHAN where BENHAN_ID =  @param0]
2019-10-31 11:13:09,523 [1] DEBUG - Statement Id: [DAO00067_laytrangthaibenhannoitru] Parameters: [@param0=[BENHAN_ID,5859]]
2019-10-31 11:13:09,523 [1] DEBUG - Statement Id: [DAO00067_laytrangthaibenhannoitru] Types: [@param0=[Int64, System.Int64]]
2019-10-31 11:13:09,564 [1] DEBUG - Statement Id: [DAO00067_ClearDataVienPhi] PreparedStatement : [delete from TT_VIENPHI where TIEPNHAN_ID = 27344 and REF_ID = 0           and             BENHAN_ID = '5859'                     update TT_VIENPHI set SOLUONG = 0          where REF_TABLE = 'TT_DVYEUCAU' and TIEPNHAN_ID =  @param0           and not exists (select DVYEUCAU_ID from TT_DVYEUCAU where TT_VIENPHI.REF_ID = DVYEUCAU_ID and TIEPNHAN_ID =  @param0 )                       update TT_VIENPHI set SOLUONG = 0          where REF_TABLE = 'TT_NGOAITRU_TOATHUOC'          and TIEPNHAN_ID =  @param0           and HOADON_ID is null and TIEPNHAN_ID =  @param0           and not exists (select TOATHUOC_ID from TT_NGOAITRU_TOATHUOC where TT_VIENPHI.REF_ID = TOATHUOC_ID and TIEPNHAN_ID =  @param0 )                          update TT_VIENPHI            set SOLUONG = (TraThuoc.SOLUONG - TraThuoc.SOLUONG_NGUNG)            from (select distinct nttt.SOLUONG, ttct.TOATHUOC_ID, ttct.DUOC_ID , ttct.SOLUONG SOLUONG_NGUNG            from TT_NOITRU_TRATHUOC_CHITIET ttct            left join TT_NOITRU_TRATHUOC tt on tt.TRATHUOC_ID = ttct.TRATHUOC_ID            left join TT_NOITRU_TOATHUOC nttt on nttt.TOATHUOC_ID = ttct.TOATHUOC_ID            where tt.BENHAN_ID =  @param1 ) TraThuoc            where TT_VIENPHI.REF_ID = TraThuoc.TOATHUOC_ID and TT_VIENPHI.DUOC_ID = TraThuoc.DUOC_ID            and TT_VIENPHI.REF_TABLE = 'TT_NOITRU_TOATHUOC' and TT_VIENPHI.BENHAN_ID =  @param1             and TT_VIENPHI.SOLUONG > (TraThuoc.SOLUONG - TraThuoc.SOLUONG_NGUNG)                         update TT_VIENPHI set SOLUONG = 0            where REF_TABLE = 'TT_NOITRU_TOATHUOC'            and TIEPNHAN_ID =  @param0             and KHAMBENH_ID not in (select KHAMBENH_ID from TT_NOITRU_TOATHUOC where TIEPNHAN_ID =  @param0 )            and HOADON_ID is null and BENHAN_ID =  @param1                    delete TT_DUOC_TONKHO_BOOK_NOITRU where REF_TABLE = 'TT_NOITRU_TOATHUOC' and (REF_ID is null or REF_ID = 0)        delete TT_DUOC_TONKHO_BOOK_NGOAITRU where REF_ID is null or REF_ID = 0                      update TT_VIENPHI          set BENHAN_ID =  @param1           from (select TOATHUOC_ID from TT_NOITRU_TOATHUOC where TIEPNHAN_ID =  @param0 ) nttt          where REF_TABLE = 'TT_NOITRU_TOATHUOC' and REF_ID = nttt.TOATHUOC_ID and isnull(BENHAN_ID, 0) = 0          and TIEPNHAN_ID =  @param0             update TT_VIENPHI          set TT_VIENPHI.BENHAN_ID =  @param1           from (select DVYEUCAU_ID, BENHAN_ID from TT_DVYEUCAU where TIEPNHAN_ID =  @param0 ) nttt          where TT_VIENPHI.REF_TABLE = 'TT_DVYEUCAU' and TT_VIENPHI.REF_ID = nttt.DVYEUCAU_ID          and isnull(TT_VIENPHI.BENHAN_ID, 0) = 0 and isnull(nttt.BENHAN_ID, 0) > 0          and TT_VIENPHI.TIEPNHAN_ID =  @param0                     update TT_VIENPHI set          THANHTIEN_DOANHTHU = 0, BHYT_THANHTIEN = 0, BHYT_THANHTIEN_CHITRA = 0          , GIATRI_BENHNHAN_DATHANHTOAN = 0, BENHNHAN_PHAITHANHTOAN = 0          where TIEPNHAN_ID = 27344 and SOLUONG = 0           and             BENHAN_ID = 5859                       update TT_VIENPHI set          GIATRI_BENHNHAN_DATHANHTOAN = 0          where TIEPNHAN_ID = '27344' and GIATRI_BENHNHAN_DATHANHTOAN is null            update TT_VIENPHI set          BENHNHAN_PHAITHANHTOAN = 0          where TIEPNHAN_ID = '27344' and BENHNHAN_PHAITHANHTOAN is null]
2019-10-31 11:13:09,564 [1] DEBUG - Statement Id: [DAO00067_ClearDataVienPhi] Parameters: [@param0=[TIEPNHAN_ID,27344], @param1=[BENHAN_ID,5859]]
2019-10-31 11:13:09,564 [1] DEBUG - Statement Id: [DAO00067_ClearDataVienPhi] Types: [@param0=[Int64, System.Int64], @param1=[Int64, System.Int64]]
2019-10-31 11:13:09,877 [1] DEBUG - Statement Id: [DAO00064_GetlistTT_TIEPNHAN_SOTHEBHYT] PreparedStatement : [select stbhyt.*, ba.SOBENHAN,         tn.SOTIEPNHAN, tn.LOAITHANHVIEN_ID, tn.THE_ID, tn.THANHVIEN_ID,        tn.SUDUNG_BHTN, tn.BAOLANH_VIENPHI, tn.VIP, tn.NGUOINUOCNGOAI        from TT_TIEPNHAN_SOTHEBHYT stbhyt        left join TT_TIEPNHAN tn on tn.TIEPNHAN_ID = stbhyt.TIEPNHAN_ID        left join TT_NOITRU_BENHAN ba on ba.TIEPNHAN_ID = stbhyt.TIEPNHAN_ID        where         stbhyt.TIEPNHAN_ID = '27344' and isnull(stbhyt.KHONGSUDUNG, '0') = '0'         and           ba.BENHAN_ID = '5859']
2019-10-31 11:13:10,078 [1] DEBUG - Statement Id: [DAO00064_GetListVienPhiByTiepNnan] PreparedStatement : [select distinct        B.DOITUONG_ID, B.NGAYMIENDONGCHITRA, B.BENHNHAN_ID as TIEPNHAN_BENHNHAN_ID, B.TRAITUYEN,        B.BHYTTREN3NAM as TREN3NAM, B.BHYTTREN5NAM as TREN5NAM, B.SOTIEPNHAN, B.SOBENHAN,        B.LOAITHANHVIEN_ID, B.SUDUNG_BHTN, B.THE_ID, B.THANHVIEN_ID, B.BAOLANH_VIENPHI, B.VIP, B.NGUOINUOCNGOAI,        C.GIATRIMIENGIAM as GIATRIMIENGIAM, D.GIATRIMIENGIAM as GIATRIMIENGIAM_BHTN, E.GIATRIMIENGIAM as GIATRIMIENGIAM_THANHVIEN,        F.GIATRIMIENGIAM as GIATRIMIENGIAM_CONGTY, DVYC.THE_ID as DVDUNGTHE, DVYC.TRANGTHAI as TRANGTHAIDICHVU, ndv.MANHOMDICHVU,        A.* from TT_VIENPHI A        left join        (select B.*, C.SOBENHAN, C.BENHAN_ID        from TT_TIEPNHAN B        left join TT_NOITRU_BENHAN C on B.TIEPNHAN_ID = C.TIEPNHAN_ID         and           C.BENHAN_ID = '5859'                 where B.TIEPNHAN_ID = '27344') B on B.TIEPNHAN_ID = A.TIEPNHAN_ID        left join (select sum(GIATRIMIENGIAM) as GIATRIMIENGIAM, VIENPHI_ID, REF_TABLE        from TT_MIENGIAM_CHITIET        where REF_TABLE = 'TT_MIENGIAM'        and exists (select MIENGIAM_ID from TT_MIENGIAM where TT_MIENGIAM_CHITIET.MIENGIAM_ID = MIENGIAM_ID and TINHTRANG = 1 and TIEPNHAN_ID = '27344')        group by VIENPHI_ID, REF_TABLE) C on C.REF_TABLE = 'TT_MIENGIAM' and C.VIENPHI_ID = A.VIENPHI_ID        left join (select sum(GIATRIMIENGIAM) as GIATRIMIENGIAM, VIENPHI_ID, REF_TABLE        from TT_MIENGIAM_CHITIET        where REF_TABLE = 'TT_MIENGIAM_BHTN'        and exists (select MIENGIAM_BHTN_ID from TT_MIENGIAM_BHTN where TT_MIENGIAM_CHITIET.MIENGIAM_ID = MIENGIAM_BHTN_ID and  TINHTRANG = 1 and TIEPNHAN_ID = '27344')        group by VIENPHI_ID, REF_TABLE) D on D.REF_TABLE = 'TT_MIENGIAM_BHTN' and D.VIENPHI_ID = A.VIENPHI_ID        left join (select sum(GIATRIMIENGIAM) as GIATRIMIENGIAM, VIENPHI_ID, REF_TABLE        from TT_MIENGIAM_CHITIET        where REF_TABLE = 'TT_MIENGIAM_THANHVIEN'        and exists (select MIENGIAM_THANHVIEN_ID from TT_MIENGIAM_THANHVIEN where TT_MIENGIAM_CHITIET.MIENGIAM_ID = MIENGIAM_THANHVIEN_ID and TINHTRANG = 1 and TIEPNHAN_ID = '27344')        group by VIENPHI_ID, REF_TABLE) E on E.REF_TABLE = 'TT_MIENGIAM_THANHVIEN' and E.VIENPHI_ID = A.VIENPHI_ID        left join (select sum(GIATRIMIENGIAM) as GIATRIMIENGIAM, VIENPHI_ID, REF_TABLE        from TT_MIENGIAM_CHITIET        where REF_TABLE = 'TT_MIENGIAM_CONGTY'        and exists (select MIENGIAM_CONGTY_ID from TT_MIENGIAM_CONGTY where TT_MIENGIAM_CHITIET.MIENGIAM_ID = MIENGIAM_CONGTY_ID and TINHTRANG = 1 and TIEPNHAN_ID = '27344')        group by VIENPHI_ID, REF_TABLE) F on F.REF_TABLE = 'TT_MIENGIAM_CONGTY' and F.VIENPHI_ID = A.VIENPHI_ID        left join TT_DVYEUCAU DVYC on DVYC.DVYEUCAU_ID = A.REF_ID and A.REF_TABLE = 'TT_DVYEUCAU'        left join TM_DICHVU DV on DVYC.DICHVU_ID = DV.DICHVU_ID and A.REF_TABLE = 'TT_DVYEUCAU'        left join TM_NHOMDICHVU ndv on ndv.NHOMDICHVU_ID = DV.NHOMDICHVU_ID and A.REF_TABLE = 'TT_DVYEUCAU'        where        A.TIEPNHAN_ID = '27344' and ((DVYC.HUYYEUCAU = '0' and A.DICHVU_ID is not null)        or A.DUOC_ID is not null or A.REF_TABLE = 'TT_NUT_XACNHANSUATAN_CHITIET')        and A.ACTIVE = '1'         and           A.BENHAN_ID = '5859'                 and A.BENHVIEN_ID = 'HLU01'        order by A.VIENPHI_ID]
2019-10-31 11:13:10,124 [1] DEBUG - Statement Id: [DAO00080_LayLoaiBenhanCuNoitru] PreparedStatement : [select LOAIBENHAN from TT_NOITRU_BENHAN where TIEPNHAN_ID =  @param0]
2019-10-31 11:13:10,124 [1] DEBUG - Statement Id: [DAO00080_LayLoaiBenhanCuNoitru] Parameters: [@param0=[TIEPNHAN_ID,27344]]
2019-10-31 11:13:10,124 [1] DEBUG - Statement Id: [DAO00080_LayLoaiBenhanCuNoitru] Types: [@param0=[Int32, System.Int32]]
2019-10-31 11:13:10,156 [1] DEBUG - Statement Id: [DAO00006_GetListDuocTyle] PreparedStatement : [select DUOC_ID, DOITUONG_ID, (TYLE/100) as TYLE, DONGIA MUCTRAN_THANHTOAN from TM_DOITUONG_GIADUOC_TYLE            where            BENHVIEN_ID = 'HLU01'            and DOITUONG_ID = '6']
2019-10-31 11:13:10,187 [1] DEBUG - Statement Id: [DAO00027_GetListTuongTrinhDichVuPhauThuatCuaTiepNhan] PreparedStatement : [declare @ManhomDSA varchar(10);        declare @PhanLoaiNhomDV varchar(20) = '05';        select top 1  @ManhomDSA = VALUE from TM_SYS_APPSETTINGS where CODE = 'MANHOM_DICHVU_DSA'        if (@ManhomDSA is not null) set @PhanLoaiNhomDV += ',' + @ManhomDSA        select distinct ptyc.*        from TT_PHAUTHUAT_YEUCAU ptyc        inner join TM_DICHVU dv on dv.DICHVU_ID = ptyc.DICHVU_ID        inner join TM_NHOMDICHVU ndv on ndv.NHOMDICHVU_ID = dv.NHOMDICHVU_ID        inner join TT_PHAUTHUAT pt on pt.PHAUTHUAT_ID = ptyc.PHAUTHUAT_ID        where        pt.TIEPNHAN_ID = 27344        and (left(ndv.MANHOMDICHVU, 2) in (select * from STRING_SPLIT(@PhanLoaiNhomDV,',')) or ndv.MANHOMDICHVU in (select * from STRING_SPLIT(@PhanLoaiNhomDV,',')))]
2019-10-31 11:13:10,225 [1] DEBUG - Statement Id: [DAO00006_GetList] PreparedStatement : [select dv.*, loaiDV.MALOAIDICHVU, captren.NHOMDICHVU_ID as NHOMDICHVU_CAPTREN_ID, captren.TENNHOMDICHVU as NHOMDICHVU_CAPTREN,              nhom_dv.TENNHOMDICHVU as TENNHOMDICHVU, nhom_dv.MANHOMDICHVU,              case when dv.ATTRIBUTE5 is null then 'TT' else 'KTC' end as LOAI_CHIPHI              from TM_DICHVU as dv              left join TM_NHOMDICHVU as nhom_dv on nhom_dv.NHOMDICHVU_ID = dv.NHOMDICHVU_ID and nhom_dv.BENHVIEN_ID = 'HLU01'              left join TM_NHOMDICHVU as captren on nhom_dv.CAPTREN_ID = captren.NHOMDICHVU_ID and captren.BENHVIEN_ID = 'HLU01'              left join TM_LOAIDICHVU loaiDV on nhom_dv.LOAIDICHVU_ID = loaiDV.LOAIDICHVU_ID and loaiDV.BENHVIEN_ID = 'HLU01'              where nhom_dv.TAMNGUNG = '0' and dv.BENHVIEN_ID = 'HLU01'              and dv.TAMNGUNG = '0'               AND                   loaiDV.MALOAIDICHVU = 'KhamBenh']
2019-10-31 11:13:10,337 [1] DEBUG - Statement Id: [DAO00023_UpdateNhieuVP] PreparedStatement : [declare @jsonVienPhi nvarchar(max) = N'[{"VIENPHI_ID":671148,"TIEPNHAN_ID":27344,"DICHVU_ID":5445,"BENHAN_ID":5859,"SOLUONG":1.0000,"DONGIA_DOANHTHU":33000.0000,"THANHTIEN_DOANHTHU":33000.00,"BHYT_TL":0.0,"BHYT_DONGIA":0.0,"BHYT_THANHTIEN":0.0,"BHYT_DONGIA_CONGKHAM_DAU":0.0,"BHYT_CONGKHAM_DAU_TYLE":1.0,"BHYT_DONGIA_CHITRA":0.0,"BHYT_THANHTIEN_CHITRA":0.0,"BENHNHAN_PHAITHANHTOAN":33000.00,"GIATRI_HOADON":0.0,"GIATRI_HOADON_DATHANHTOAN":0.0,"GIATRI_BIENLAI":33000.00000000,"GIATRI_BIENLAI_DATHANHTOAN":0.0,"GIATRI_BENHNHAN_DATHANHTOAN":0.0,"DATHUCHIEN":"1","KHONGTHUTIEN":"0","BHYTDONGTIEN":"0","DICHVU_TL":1.0,"BHYT_DONGIA_DONGCT_DAU":0.0,"SOBHYT":"HN238382272757838523","SOBHYT_HUONG_ID":28371,"GIATRIMIENGIAM":0.0,"GIATRIMIENGIAM_BHTN":0.0,"GIATRIMIENGIAM_THANHVIEN":0.0,"GIATRIMIENGIAM_CONGTY":0.0,"BHYT_CK2_KHONGTHANHTOAN":false},{"VIENPHI_ID":671398,"TIEPNHAN_ID":27344,"DICHVU_ID":4017,"BENHAN_ID":5859,"SOLUONG":1.0000,"DONGIA_DOANHTHU":42100.0000,"THANHTIEN_DOANHTHU":42100.00,"BHYT_TL":1.0000,"BHYT_DONGIA":0.0,"BHYT_THANHTIEN":0.0,"BHYT_DONGIA_CONGKHAM_DAU":0.0,"BHYT_CONGKHAM_DAU_TYLE":1.0,"BHYT_DONGIA_CHITRA":0.0,"BHYT_THANHTIEN_CHITRA":0.0,"BENHNHAN_PHAITHANHTOAN":42100.00,"GIATRI_HOADON":0.0,"GIATRI_HOADON_DATHANHTOAN":0.0,"GIATRI_BIENLAI":42100.00000000,"GIATRI_BIENLAI_DATHANHTOAN":0.0,"GIATRI_BENHNHAN_DATHANHTOAN":0.0,"DATHUCHIEN":"1","KHONGTHUTIEN":"0","BHYTDONGTIEN":"0","DICHVU_TL":1.0,"BHYT_DONGIA_DONGCT_DAU":0.0,"SOBHYT":"HN238382272757838523","SOBHYT_HUONG_ID":28371,"GIATRIMIENGIAM":0.0,"GIATRIMIENGIAM_BHTN":0.0,"GIATRIMIENGIAM_THANHVIEN":0.0,"GIATRIMIENGIAM_CONGTY":0.0,"BHYT_CK2_KHONGTHANHTOAN":false},{"VIENPHI_ID":671399,"TIEPNHAN_ID":27344,"DICHVU_ID":4523,"BENHAN_ID":5859,"SOLUONG":1.0000,"DONGIA_DOANHTHU":40000.0000,"THANHTIEN_DOANHTHU":40000.00,"BHYT_TL":0.0,"BHYT_DONGIA":0.0,"BHYT_THANHTIEN":0.0,"BHYT_DONGIA_CONGKHAM_DAU":0.0,"BHYT_CONGKHAM_DAU_TYLE":1.0,"BHYT_DONGIA_CHITRA":0.0,"BHYT_THANHTIEN_CHITRA":0.0,"BENHNHAN_PHAITHANHTOAN":40000.00,"GIATRI_HOADON":0.0,"GIATRI_HOADON_DATHANHTOAN":0.0,"GIATRI_BIENLAI":40000.00000000,"GIATRI_BIENLAI_DATHANHTOAN":0.0,"GIATRI_BENHNHAN_DATHANHTOAN":0.0,"DATHUCHIEN":"1","KHONGTHUTIEN":"0","BHYTDONGTIEN":"0","DICHVU_TL":1.0,"BHYT_DONGIA_DONGCT_DAU":0.0,"SOBHYT":"HN238382272757838523","SOBHYT_HUONG_ID":28371,"GIATRIMIENGIAM":0.0,"GIATRIMIENGIAM_BHTN":0.0,"GIATRIMIENGIAM_THANHVIEN":0.0,"GIATRIMIENGIAM_CONGTY":0.0,"BHYT_CK2_KHONGTHANHTOAN":false},{"VIENPHI_ID":674464,"TIEPNHAN_ID":27344,"DICHVU_ID":null,"BENHAN_ID":5859,"SOLUONG":1.0000,"DONGIA_DOANHTHU":13500.0000,"THANHTIEN_DOANHTHU":13500.00,"BHYT_TL":1.0,"BHYT_DONGIA":8925.0000,"BHYT_THANHTIEN":8925.00,"BHYT_DONGIA_CONGKHAM_DAU":0.0,"BHYT_CONGKHAM_DAU_TYLE":1.0,"BHYT_DONGIA_CHITRA":8925.0,"BHYT_THANHTIEN_CHITRA":8925.00,"BENHNHAN_PHAITHANHTOAN":4575.00,"GIATRI_HOADON":0.0,"GIATRI_HOADON_DATHANHTOAN":0.0,"GIATRI_BIENLAI":4575.00,"GIATRI_BIENLAI_DATHANHTOAN":0.0,"GIATRI_BENHNHAN_DATHANHTOAN":0.0,"DATHUCHIEN":"0","KHONGTHUTIEN":"0","BHYTDONGTIEN":"0","DICHVU_TL":0.0,"BHYT_DONGIA_DONGCT_DAU":0.0,"SOBHYT":"HN238382272757838523","SOBHYT_HUONG_ID":28371,"GIATRIMIENGIAM":0.0,"GIATRIMIENGIAM_BHTN":0.0,"GIATRIMIENGIAM_THANHVIEN":0.0,"GIATRIMIENGIAM_CONGTY":0.0,"BHYT_CK2_KHONGTHANHTOAN":false},{"VIENPHI_ID":674465,"TIEPNHAN_ID":27344,"DICHVU_ID":null,"BENHAN_ID":5859,"SOLUONG":2.0000,"DONGIA_DOANHTHU":16000.0000,"THANHTIEN_DOANHTHU":32000.00,"BHYT_TL":1.0,"BHYT_DONGIA":16000.0000,"BHYT_THANHTIEN":32000.00,"BHYT_DONGIA_CONGKHAM_DAU":0.0,"BHYT_CONGKHAM_DAU_TYLE":1.0,"BHYT_DONGIA_CHITRA":16000.0,"BHYT_THANHTIEN_CHITRA":32000.00,"BENHNHAN_PHAITHANHTOAN":0.00,"GIATRI_HOADON":0.0,"GIATRI_HOADON_DATHANHTOAN":0.0,"GIATRI_BIENLAI":0.0,"GIATRI_BIENLAI_DATHANHTOAN":0.0,"GIATRI_BENHNHAN_DATHANHTOAN":0.0,"DATHUCHIEN":"0","KHONGTHUTIEN":"0","BHYTDONGTIEN":"0","DICHVU_TL":0.0,"BHYT_DONGIA_DONGCT_DAU":0.0,"SOBHYT":"HN238382272757838523","SOBHYT_HUONG_ID":28371,"GIATRIMIENGIAM":0.0,"GIATRIMIENGIAM_BHTN":0.0,"GIATRIMIENGIAM_THANHVIEN":0.0,"GIATRIMIENGIAM_CONGTY":0.0,"BHYT_CK2_KHONGTHANHTOAN":false},{"VIENPHI_ID":674466,"TIEPNHAN_ID":27344,"DICHVU_ID":null,"BENHAN_ID":5859,"SOLUONG":3.0000,"DONGIA_DOANHTHU":13500.0000,"THANHTIEN_DOANHTHU":40500.00,"BHYT_TL":1.0,"BHYT_DONGIA":8715.0000,"BHYT_THANHTIEN":26145.00,"BHYT_DONGIA_CONGKHAM_DAU":0.0,"BHYT_CONGKHAM_DAU_TYLE":1.0,"BHYT_DONGIA_CHITRA":8715.0,"BHYT_THANHTIEN_CHITRA":26145.00,"BENHNHAN_PHAITHANHTOAN":14355.00,"GIATRI_HOADON":0.0,"GIATRI_HOADON_DATHANHTOAN":0.0,"GIATRI_BIENLAI":14355.00,"GIATRI_BIENLAI_DATHANHTOAN":0.0,"GIATRI_BENHNHAN_DATHANHTOAN":0.0,"DATHUCHIEN":"0","KHONGTHUTIEN":"0","BHYTDONGTIEN":"0","DICHVU_TL":0.0,"BHYT_DONGIA_DONGCT_DAU":0.0,"SOBHYT":"HN238382272757838523","SOBHYT_HUONG_ID":28371,"GIATRIMIENGIAM":0.0,"GIATRIMIENGIAM_BHTN":0.0,"GIATRIMIENGIAM_THANHVIEN":0.0,"GIATRIMIENGIAM_CONGTY":0.0,"BHYT_CK2_KHONGTHANHTOAN":false},{"VIENPHI_ID":674467,"TIEPNHAN_ID":27344,"DICHVU_ID":null,"BENHAN_ID":5859,"SOLUONG":3.0000,"DONGIA_DOANHTHU":52500.0000,"THANHTIEN_DOANHTHU":157500.00,"BHYT_TL":1.0,"BHYT_DONGIA":52500.0000,"BHYT_THANHTIEN":157500.00,"BHYT_DONGIA_CONGKHAM_DAU":0.0,"BHYT_CONGKHAM_DAU_TYLE":1.0,"BHYT_DONGIA_CHITRA":52500.0,"BHYT_THANHTIEN_CHITRA":157500.00,"BENHNHAN_PHAITHANHTOAN":0.00,"GIATRI_HOADON":0.0,"GIATRI_HOADON_DATHANHTOAN":0.0,"GIATRI_BIENLAI":0.0,"GIATRI_BIENLAI_DATHANHTOAN":0.0,"GIATRI_BENHNHAN_DATHANHTOAN":0.0,"DATHUCHIEN":"0","KHONGTHUTIEN":"0","BHYTDONGTIEN":"0","DICHVU_TL":0.0,"BHYT_DONGIA_DONGCT_DAU":0.0,"SOBHYT":"HN238382272757838523","SOBHYT_HUONG_ID":28371,"GIATRIMIENGIAM":0.0,"GIATRIMIENGIAM_BHTN":0.0,"GIATRIMIENGIAM_THANHVIEN":0.0,"GIATRIMIENGIAM_CONGTY":0.0,"BHYT_CK2_KHONGTHANHTOAN":false},{"VIENPHI_ID":674468,"TIEPNHAN_ID":27344,"DICHVU_ID":null,"BENHAN_ID":5859,"SOLUONG":1.0000,"DONGIA_DOANHTHU":945.0000,"THANHTIEN_DOANHTHU":945.00,"BHYT_TL":1.0,"BHYT_DONGIA":945.0000,"BHYT_THANHTIEN":945.00,"BHYT_DONGIA_CONGKHAM_DAU":0.0,"BHYT_CONGKHAM_DAU_TYLE":1.0,"BHYT_DONGIA_CHITRA":945.0,"BHYT_THANHTIEN_CHITRA":945.00,"BENHNHAN_PHAITHANHTOAN":0.00,"GIATRI_HOADON":0.0,"GIATRI_HOADON_DATHANHTOAN":0.0,"GIATRI_BIENLAI":0.0,"GIATRI_BIENLAI_DATHANHTOAN":0.0,"GIATRI_BENHNHAN_DATHANHTOAN":0.0,"DATHUCHIEN":"0","KHONGTHUTIEN":"0","BHYTDONGTIEN":"0","DICHVU_TL":0.0,"BHYT_DONGIA_DONGCT_DAU":0.0,"SOBHYT":"HN238382272757838523","SOBHYT_HUONG_ID":28371,"GIATRIMIENGIAM":0.0,"GIATRIMIENGIAM_BHTN":0.0,"GIATRIMIENGIAM_THANHVIEN":0.0,"GIATRIMIENGIAM_CONGTY":0.0,"BHYT_CK2_KHONGTHANHTOAN":false},{"VIENPHI_ID":674469,"TIEPNHAN_ID":27344,"DICHVU_ID":null,"BENHAN_ID":5859,"SOLUONG":2.0000,"DONGIA_DOANHTHU":10500.0000,"THANHTIEN_DOANHTHU":21000.00,"BHYT_TL":1.0,"BHYT_DONGIA":10500.0000,"BHYT_THANHTIEN":21000.00,"BHYT_DONGIA_CONGKHAM_DAU":0.0,"BHYT_CONGKHAM_DAU_TYLE":1.0,"BHYT_DONGIA_CHITRA":10500.0,"BHYT_THANHTIEN_CHITRA":21000.00,"BENHNHAN_PHAITHANHTOAN":0.00,"GIATRI_HOADON":0.0,"GIATRI_HOADON_DATHANHTOAN":0.0,"GIATRI_BIENLAI":0.0,"GIATRI_BIENLAI_DATHANHTOAN":0.0,"GIATRI_BENHNHAN_DATHANHTOAN":0.0,"DATHUCHIEN":"0","KHONGTHUTIEN":"0","BHYTDONGTIEN":"0","DICHVU_TL":0.0,"BHYT_DONGIA_DONGCT_DAU":0.0,"SOBHYT":"HN238382272757838523","SOBHYT_HUONG_ID":28371,"GIATRIMIENGIAM":0.0,"GIATRIMIENGIAM_BHTN":0.0,"GIATRIMIENGIAM_THANHVIEN":0.0,"GIATRIMIENGIAM_CONGTY":0.0,"BHYT_CK2_KHONGTHANHTOAN":false},{"VIENPHI_ID":674470,"TIEPNHAN_ID":27344,"DICHVU_ID":null,"BENHAN_ID":5859,"SOLUONG":1.0000,"DONGIA_DOANHTHU":158000.0000,"THANHTIEN_DOANHTHU":158000.00,"BHYT_TL":1.0,"BHYT_DONGIA":158000.0000,"BHYT_THANHTIEN":158000.00,"BHYT_DONGIA_CONGKHAM_DAU":0.0,"BHYT_CONGKHAM_DAU_TYLE":1.0,"BHYT_DONGIA_CHITRA":158000.0,"BHYT_THANHTIEN_CHITRA":158000.00,"BENHNHAN_PHAITHANHTOAN":0.00,"GIATRI_HOADON":0.0,"GIATRI_HOADON_DATHANHTOAN":0.0,"GIATRI_BIENLAI":0.0,"GIATRI_BIENLAI_DATHANHTOAN":0.0,"GIATRI_BENHNHAN_DATHANHTOAN":0.0,"DATHUCHIEN":"0","KHONGTHUTIEN":"0","BHYTDONGTIEN":"0","DICHVU_TL":0.0,"BHYT_DONGIA_DONGCT_DAU":0.0,"SOBHYT":"HN238382272757838523","SOBHYT_HUONG_ID":28371,"GIATRIMIENGIAM":0.0,"GIATRIMIENGIAM_BHTN":0.0,"GIATRIMIENGIAM_THANHVIEN":0.0,"GIATRIMIENGIAM_CONGTY":0.0,"BHYT_CK2_KHONGTHANHTOAN":false},{"VIENPHI_ID":674471,"TIEPNHAN_ID":27344,"DICHVU_ID":null,"BENHAN_ID":5859,"SOLUONG":2.0000,"DONGIA_DOANHTHU":5500.0000,"THANHTIEN_DOANHTHU":11000.00,"BHYT_TL":1.0,"BHYT_DONGIA":5500.0000,"BHYT_THANHTIEN":11000.00,"BHYT_DONGIA_CONGKHAM_DAU":0.0,"BHYT_CONGKHAM_DAU_TYLE":1.0,"BHYT_DONGIA_CHITRA":5500.0,"BHYT_THANHTIEN_CHITRA":11000.00,"BENHNHAN_PHAITHANHTOAN":0.00,"GIATRI_HOADON":0.0,"GIATRI_HOADON_DATHANHTOAN":0.0,"GIATRI_BIENLAI":0.0,"GIATRI_BIENLAI_DATHANHTOAN":0.0,"GIATRI_BENHNHAN_DATHANHTOAN":0.0,"DATHUCHIEN":"0","KHONGTHUTIEN":"0","BHYTDONGTIEN":"0","DICHVU_TL":0.0,"BHYT_DONGIA_DONGCT_DAU":0.0,"SOBHYT":"HN238382272757838523","SOBHYT_HUONG_ID":28371,"GIATRIMIENGIAM":0.0,"GIATRIMIENGIAM_BHTN":0.0,"GIATRIMIENGIAM_THANHVIEN":0.0,"GIATRIMIENGIAM_CONGTY":0.0,"BHYT_CK2_KHONGTHANHTOAN":false},{"VIENPHI_ID":674472,"TIEPNHAN_ID":27344,"DICHVU_ID":null,"BENHAN_ID":5859,"SOLUONG":1.0000,"DONGIA_DOANHTHU":7000.0000,"THANHTIEN_DOANHTHU":7000.00,"BHYT_TL":1.0,"BHYT_DONGIA":4410.0000,"BHYT_THANHTIEN":4410.00,"BHYT_DONGIA_CONGKHAM_DAU":0.0,"BHYT_CONGKHAM_DAU_TYLE":1.0,"BHYT_DONGIA_CHITRA":4410.0,"BHYT_THANHTIEN_CHITRA":4410.00,"BENHNHAN_PHAITHANHTOAN":2590.00,"GIATRI_HOADON":0.0,"GIATRI_HOADON_DATHANHTOAN":0.0,"GIATRI_BIENLAI":2590.00,"GIATRI_BIENLAI_DATHANHTOAN":0.0,"GIATRI_BENHNHAN_DATHANHTOAN":0.0,"DATHUCHIEN":"0","KHONGTHUTIEN":"0","BHYTDONGTIEN":"0","DICHVU_TL":0.0,"BHYT_DONGIA_DONGCT_DAU":0.0,"SOBHYT":"HN238382272757838523","SOBHYT_HUONG_ID":28371,"GIATRIMIENGIAM":0.0,"GIATRIMIENGIAM_BHTN":0.0,"GIATRIMIENGIAM_THANHVIEN":0.0,"GIATRIMIENGIAM_CONGTY":0.0,"BHYT_CK2_KHONGTHANHTOAN":false},{"VIENPHI_ID":674473,"TIEPNHAN_ID":27344,"DICHVU_ID":null,"BENHAN_ID":5859,"SOLUONG":3.0000,"DONGIA_DOANHTHU":630.0000,"THANHTIEN_DOANHTHU":1890.00,"BHYT_TL":1.0,"BHYT_DONGIA":630.0000,"BHYT_THANHTIEN":1890.00,"BHYT_DONGIA_CONGKHAM_DAU":0.0,"BHYT_CONGKHAM_DAU_TYLE":1.0,"BHYT_DONGIA_CHITRA":630.0,"BHYT_THANHTIEN_CHITRA":1890.00,"BENHNHAN_PHAITHANHTOAN":0.00,"GIATRI_HOADON":0.0,"GIATRI_HOADON_DATHANHTOAN":0.0,"GIATRI_BIENLAI":0.0,"GIATRI_BIENLAI_DATHANHTOAN":0.0,"GIATRI_BENHNHAN_DATHANHTOAN":0.0,"DATHUCHIEN":"0","KHONGTHUTIEN":"0","BHYTDONGTIEN":"0","DICHVU_TL":0.0,"BHYT_DONGIA_DONGCT_DAU":0.0,"SOBHYT":"HN238382272757838523","SOBHYT_HUONG_ID":28371,"GIATRIMIENGIAM":0.0,"GIATRIMIENGIAM_BHTN":0.0,"GIATRIMIENGIAM_THANHVIEN":0.0,"GIATRIMIENGIAM_CONGTY":0.0,"BHYT_CK2_KHONGTHANHTOAN":false},{"VIENPHI_ID":674474,"TIEPNHAN_ID":27344,"DICHVU_ID":null,"BENHAN_ID":5859,"SOLUONG":3.0000,"DONGIA_DOANHTHU":1030.0000,"THANHTIEN_DOANHTHU":3090.00,"BHYT_TL":1.0,"BHYT_DONGIA":1030.0000,"BHYT_THANHTIEN":3090.00,"BHYT_DONGIA_CONGKHAM_DAU":0.0,"BHYT_CONGKHAM_DAU_TYLE":1.0,"BHYT_DONGIA_CHITRA":1030.0,"BHYT_THANHTIEN_CHITRA":3090.00,"BENHNHAN_PHAITHANHTOAN":0.00,"GIATRI_HOADON":0.0,"GIATRI_HOADON_DATHANHTOAN":0.0,"GIATRI_BIENLAI":0.0,"GIATRI_BIENLAI_DATHANHTOAN":0.0,"GIATRI_BENHNHAN_DATHANHTOAN":0.0,"DATHUCHIEN":"0","KHONGTHUTIEN":"0","BHYTDONGTIEN":"0","DICHVU_TL":0.0,"BHYT_DONGIA_DONGCT_DAU":0.0,"SOBHYT":"HN238382272757838523","SOBHYT_HUONG_ID":28371,"GIATRIMIENGIAM":0.0,"GIATRIMIENGIAM_BHTN":0.0,"GIATRIMIENGIAM_THANHVIEN":0.0,"GIATRIMIENGIAM_CONGTY":0.0,"BHYT_CK2_KHONGTHANHTOAN":false},{"VIENPHI_ID":674475,"TIEPNHAN_ID":27344,"DICHVU_ID":null,"BENHAN_ID":5859,"SOLUONG":3.0000,"DONGIA_DOANHTHU":348.0000,"THANHTIEN_DOANHTHU":1044.00,"BHYT_TL":1.0,"BHYT_DONGIA":348.0000,"BHYT_THANHTIEN":1044.00,"BHYT_DONGIA_CONGKHAM_DAU":0.0,"BHYT_CONGKHAM_DAU_TYLE":1.0,"BHYT_DONGIA_CHITRA":348.0,"BHYT_THANHTIEN_CHITRA":1044.00,"BENHNHAN_PHAITHANHTOAN":0.00,"GIATRI_HOADON":0.0,"GIATRI_HOADON_DATHANHTOAN":0.0,"GIATRI_BIENLAI":0.0,"GIATRI_BIENLAI_DATHANHTOAN":0.0,"GIATRI_BENHNHAN_DATHANHTOAN":0.0,"DATHUCHIEN":"0","KHONGTHUTIEN":"0","BHYTDONGTIEN":"0","DICHVU_TL":0.0,"BHYT_DONGIA_DONGCT_DAU":0.0,"SOBHYT":"HN238382272757838523","SOBHYT_HUONG_ID":28371,"GIATRIMIENGIAM":0.0,"GIATRIMIENGIAM_BHTN":0.0,"GIATRIMIENGIAM_THANHVIEN":0.0,"GIATRIMIENGIAM_CONGTY":0.0,"BHYT_CK2_KHONGTHANHTOAN":false},{"VIENPHI_ID":674476,"TIEPNHAN_ID":27344,"DICHVU_ID":null,"BENHAN_ID":5859,"SOLUONG":2.0000,"DONGIA_DOANHTHU":4000.0000,"THANHTIEN_DOANHTHU":8000.00,"BHYT_TL":1.0000,"BHYT_DONGIA":0.0,"BHYT_THANHTIEN":0.0,"BHYT_DONGIA_CONGKHAM_DAU":0.0,"BHYT_CONGKHAM_DAU_TYLE":1.0,"BHYT_DONGIA_CHITRA":0.0,"BHYT_THANHTIEN_CHITRA":0.0,"BENHNHAN_PHAITHANHTOAN":8000.00,"GIATRI_HOADON":0.0,"GIATRI_HOADON_DATHANHTOAN":0.0,"GIATRI_BIENLAI":8000.00000000,"GIATRI_BIENLAI_DATHANHTOAN":0.0,"GIATRI_BENHNHAN_DATHANHTOAN":0.0,"DATHUCHIEN":"0","KHONGTHUTIEN":"0","BHYTDONGTIEN":"0","DICHVU_TL":0.0,"BHYT_DONGIA_DONGCT_DAU":0.0,"SOBHYT":"HN238382272757838523","SOBHYT_HUONG_ID":28371,"GIATRIMIENGIAM":0.0,"GIATRIMIENGIAM_BHTN":0.0,"GIATRIMIENGIAM_THANHVIEN":0.0,"GIATRIMIENGIAM_CONGTY":0.0,"BHYT_CK2_KHONGTHANHTOAN":false},{"VIENPHI_ID":674477,"TIEPNHAN_ID":27344,"DICHVU_ID":null,"BENHAN_ID":5859,"SOLUONG":0.5000,"DONGIA_DOANHTHU":25000.0000,"THANHTIEN_DOANHTHU":12500.00,"BHYT_TL":1.0000,"BHYT_DONGIA":0.0,"BHYT_THANHTIEN":0.0,"BHYT_DONGIA_CONGKHAM_DAU":0.0,"BHYT_CONGKHAM_DAU_TYLE":1.0,"BHYT_DONGIA_CHITRA":0.0,"BHYT_THANHTIEN_CHITRA":0.0,"BENHNHAN_PHAITHANHTOAN":12500.00,"GIATRI_HOADON":0.0,"GIATRI_HOADON_DATHANHTOAN":0.0,"GIATRI_BIENLAI":12500.00000000,"GIATRI_BIENLAI_DATHANHTOAN":0.0,"GIATRI_BENHNHAN_DATHANHTOAN":0.0,"DATHUCHIEN":"0","KHONGTHUTIEN":"0","BHYTDONGTIEN":"0","DICHVU_TL":0.0,"BHYT_DONGIA_DONGCT_DAU":0.0,"SOBHYT":"HN238382272757838523","SOBHYT_HUONG_ID":28371,"GIATRIMIENGIAM":0.0,"GIATRIMIENGIAM_BHTN":0.0,"GIATRIMIENGIAM_THANHVIEN":0.0,"GIATRIMIENGIAM_CONGTY":0.0,"BHYT_CK2_KHONGTHANHTOAN":false},{"VIENPHI_ID":674544,"TIEPNHAN_ID":27344,"DICHVU_ID":null,"BENHAN_ID":5859,"SOLUONG":1.0000,"DONGIA_DOANHTHU":13500.0000,"THANHTIEN_DOANHTHU":13500.00,"BHYT_TL":1.0,"BHYT_DONGIA":8925.0000,"BHYT_THANHTIEN":8925.00,"BHYT_DONGIA_CONGKHAM_DAU":0.0,"BHYT_CONGKHAM_DAU_TYLE":1.0,"BHYT_DONGIA_CHITRA":8925.0,"BHYT_THANHTIEN_CHITRA":8925.00,"BENHNHAN_PHAITHANHTOAN":4575.00,"GIATRI_HOADON":0.0,"GIATRI_HOADON_DATHANHTOAN":0.0,"GIATRI_BIENLAI":4575.00,"GIATRI_BIENLAI_DATHANHTOAN":0.0,"GIATRI_BENHNHAN_DATHANHTOAN":0.0,"DATHUCHIEN":"0","KHONGTHUTIEN":"0","BHYTDONGTIEN":"0","DICHVU_TL":0.0,"BHYT_DONGIA_DONGCT_DAU":0.0,"SOBHYT":"HN238382272757838523","SOBHYT_HUONG_ID":28371,"GIATRIMIENGIAM":0.0,"GIATRIMIENGIAM_BHTN":0.0,"GIATRIMIENGIAM_THANHVIEN":0.0,"GIATRIMIENGIAM_CONGTY":0.0,"BHYT_CK2_KHONGTHANHTOAN":false},{"VIENPHI_ID":674545,"TIEPNHAN_ID":27344,"DICHVU_ID":null,"BENHAN_ID":5859,"SOLUONG":2.0000,"DONGIA_DOANHTHU":16000.0000,"THANHTIEN_DOANHTHU":32000.00,"BHYT_TL":1.0,"BHYT_DONGIA":16000.0000,"BHYT_THANHTIEN":32000.00,"BHYT_DONGIA_CONGKHAM_DAU":0.0,"BHYT_CONGKHAM_DAU_TYLE":1.0,"BHYT_DONGIA_CHITRA":16000.0,"BHYT_THANHTIEN_CHITRA":32000.00,"BENHNHAN_PHAITHANHTOAN":0.00,"GIATRI_HOADON":0.0,"GIATRI_HOADON_DATHANHTOAN":0.0,"GIATRI_BIENLAI":0.0,"GIATRI_BIENLAI_DATHANHTOAN":0.0,"GIATRI_BENHNHAN_DATHANHTOAN":0.0,"DATHUCHIEN":"0","KHONGTHUTIEN":"0","BHYTDONGTIEN":"0","DICHVU_TL":0.0,"BHYT_DONGIA_DONGCT_DAU":0.0,"SOBHYT":"HN238382272757838523","SOBHYT_HUONG_ID":28371,"GIATRIMIENGIAM":0.0,"GIATRIMIENGIAM_BHTN":0.0,"GIATRIMIENGIAM_THANHVIEN":0.0,"GIATRIMIENGIAM_CONGTY":0.0,"BHYT_CK2_KHONGTHANHTOAN":false},{"VIENPHI_ID":674546,"TIEPNHAN_ID":27344,"DICHVU_ID":null,"BENHAN_ID":5859,"SOLUONG":3.0000,"DONGIA_DOANHTHU":13500.0000,"THANHTIEN_DOANHTHU":40500.00,"BHYT_TL":1.0,"BHYT_DONGIA":8715.0000,"BHYT_THANHTIEN":26145.00,"BHYT_DONGIA_CONGKHAM_DAU":0.0,"BHYT_CONGKHAM_DAU_TYLE":1.0,"BHYT_DONGIA_CHITRA":8715.0,"BHYT_THANHTIEN_CHITRA":26145.00,"BENHNHAN_PHAITHANHTOAN":14355.00,"GIATRI_HOADON":0.0,"GIATRI_HOADON_DATHANHTOAN":0.0,"GIATRI_BIENLAI":14355.00,"GIATRI_BIENLAI_DATHANHTOAN":0.0,"GIATRI_BENHNHAN_DATHANHTOAN":0.0,"DATHUCHIEN":"0","KHONGTHUTIEN":"0","BHYTDONGTIEN":"0","DICHVU_TL":0.0,"BHYT_DONGIA_DONGCT_DAU":0.0,"SOBHYT":"HN238382272757838523","SOBHYT_HUONG_ID":28371,"GIATRIMIENGIAM":0.0,"GIATRIMIENGIAM_BHTN":0.0,"GIATRIMIENGIAM_THANHVIEN":0.0,"GIATRIMIENGIAM_CONGTY":0.0,"BHYT_CK2_KHONGTHANHTOAN":false},{"VIENPHI_ID":674547,"TIEPNHAN_ID":27344,"DICHVU_ID":null,"BENHAN_ID":5859,"SOLUONG":3.0000,"DONGIA_DOANHTHU":52500.0000,"THANHTIEN_DOANHTHU":157500.00,"BHYT_TL":1.0,"BHYT_DONGIA":52500.0000,"BHYT_THANHTIEN":157500.00,"BHYT_DONGIA_CONGKHAM_DAU":0.0,"BHYT_CONGKHAM_DAU_TYLE":1.0,"BHYT_DONGIA_CHITRA":52500.0,"BHYT_THANHTIEN_CHITRA":157500.00,"BENHNHAN_PHAITHANHTOAN":0.00,"GIATRI_HOADON":0.0,"GIATRI_HOADON_DATHANHTOAN":0.0,"GIATRI_BIENLAI":0.0,"GIATRI_BIENLAI_DATHANHTOAN":0.0,"GIATRI_BENHNHAN_DATHANHTOAN":0.0,"DATHUCHIEN":"0","KHONGTHUTIEN":"0","BHYTDONGTIEN":"0","DICHVU_TL":0.0,"BHYT_DONGIA_DONGCT_DAU":0.0,"SOBHYT":"HN238382272757838523","SOBHYT_HUONG_ID":28371,"GIATRIMIENGIAM":0.0,"GIATRIMIENGIAM_BHTN":0.0,"GIATRIMIENGIAM_THANHVIEN":0.0,"GIATRIMIENGIAM_CONGTY":0.0,"BHYT_CK2_KHONGTHANHTOAN":false},{"VIENPHI_ID":674548,"TIEPNHAN_ID":27344,"DICHVU_ID":null,"BENHAN_ID":5859,"SOLUONG":1.0000,"DONGIA_DOANHTHU":945.0000,"THANHTIEN_DOANHTHU":945.00,"BHYT_TL":1.0,"BHYT_DONGIA":945.0000,"BHYT_THANHTIEN":945.00,"BHYT_DONGIA_CONGKHAM_DAU":0.0,"BHYT_CONGKHAM_DAU_TYLE":1.0,"BHYT_DONGIA_CHITRA":945.0,"BHYT_THANHTIEN_CHITRA":945.00,"BENHNHAN_PHAITHANHTOAN":0.00,"GIATRI_HOADON":0.0,"GIATRI_HOADON_DATHANHTOAN":0.0,"GIATRI_BIENLAI":0.0,"GIATRI_BIENLAI_DATHANHTOAN":0.0,"GIATRI_BENHNHAN_DATHANHTOAN":0.0,"DATHUCHIEN":"0","KHONGTHUTIEN":"0","BHYTDONGTIEN":"0","DICHVU_TL":0.0,"BHYT_DONGIA_DONGCT_DAU":0.0,"SOBHYT":"HN238382272757838523","SOBHYT_HUONG_ID":28371,"GIATRIMIENGIAM":0.0,"GIATRIMIENGIAM_BHTN":0.0,"GIATRIMIENGIAM_THANHVIEN":0.0,"GIATRIMIENGIAM_CONGTY":0.0,"BHYT_CK2_KHONGTHANHTOAN":false},{"VIENPHI_ID":674549,"TIEPNHAN_ID":27344,"DICHVU_ID":null,"BENHAN_ID":5859,"SOLUONG":2.0000,"DONGIA_DOANHTHU":10500.0000,"THANHTIEN_DOANHTHU":21000.00,"BHYT_TL":1.0,"BHYT_DONGIA":10500.0000,"BHYT_THANHTIEN":21000.00,"BHYT_DONGIA_CONGKHAM_DAU":0.0,"BHYT_CONGKHAM_DAU_TYLE":1.0,"BHYT_DONGIA_CHITRA":10500.0,"BHYT_THANHTIEN_CHITRA":21000.00,"BENHNHAN_PHAITHANHTOAN":0.00,"GIATRI_HOADON":0.0,"GIATRI_HOADON_DATHANHTOAN":0.0,"GIATRI_BIENLAI":0.0,"GIATRI_BIENLAI_DATHANHTOAN":0.0,"GIATRI_BENHNHAN_DATHANHTOAN":0.0,"DATHUCHIEN":"0","KHONGTHUTIEN":"0","BHYTDONGTIEN":"0","DICHVU_TL":0.0,"BHYT_DONGIA_DONGCT_DAU":0.0,"SOBHYT":"HN238382272757838523","SOBHYT_HUONG_ID":28371,"GIATRIMIENGIAM":0.0,"GIATRIMIENGIAM_BHTN":0.0,"GIATRIMIENGIAM_THANHVIEN":0.0,"GIATRIMIENGIAM_CONGTY":0.0,"BHYT_CK2_KHONGTHANHTOAN":false},{"VIENPHI_ID":674550,"TIEPNHAN_ID":27344,"DICHVU_ID":null,"BENHAN_ID":5859,"SOLUONG":1.0000,"DONGIA_DOANHTHU":158000.0000,"THANHTIEN_DOANHTHU":158000.00,"BHYT_TL":1.0,"BHYT_DONGIA":158000.0000,"BHYT_THANHTIEN":158000.00,"BHYT_DONGIA_CONGKHAM_DAU":0.0,"BHYT_CONGKHAM_DAU_TYLE":1.0,"BHYT_DONGIA_CHITRA":158000.0,"BHYT_THANHTIEN_CHITRA":158000.00,"BENHNHAN_PHAITHANHTOAN":0.00,"GIATRI_HOADON":0.0,"GIATRI_HOADON_DATHANHTOAN":0.0,"GIATRI_BIENLAI":0.0,"GIATRI_BIENLAI_DATHANHTOAN":0.0,"GIATRI_BENHNHAN_DATHANHTOAN":0.0,"DATHUCHIEN":"0","KHONGTHUTIEN":"0","BHYTDONGTIEN":"0","DICHVU_TL":0.0,"BHYT_DONGIA_DONGCT_DAU":0.0,"SOBHYT":"HN238382272757838523","SOBHYT_HUONG_ID":28371,"GIATRIMIENGIAM":0.0,"GIATRIMIENGIAM_BHTN":0.0,"GIATRIMIENGIAM_THANHVIEN":0.0,"GIATRIMIENGIAM_CONGTY":0.0,"BHYT_CK2_KHONGTHANHTOAN":false},{"VIENPHI_ID":674551,"TIEPNHAN_ID":27344,"DICHVU_ID":null,"BENHAN_ID":5859,"SOLUONG":2.0000,"DONGIA_DOANHTHU":5500.0000,"THANHTIEN_DOANHTHU":11000.00,"BHYT_TL":1.0,"BHYT_DONGIA":5500.0000,"BHYT_THANHTIEN":11000.00,"BHYT_DONGIA_CONGKHAM_DAU":0.0,"BHYT_CONGKHAM_DAU_TYLE":1.0,"BHYT_DONGIA_CHITRA":5500.0,"BHYT_THANHTIEN_CHITRA":11000.00,"BENHNHAN_PHAITHANHTOAN":0.00,"GIATRI_HOADON":0.0,"GIATRI_HOADON_DATHANHTOAN":0.0,"GIATRI_BIENLAI":0.0,"GIATRI_BIENLAI_DATHANHTOAN":0.0,"GIATRI_BENHNHAN_DATHANHTOAN":0.0,"DATHUCHIEN":"0","KHONGTHUTIEN":"0","BHYTDONGTIEN":"0","DICHVU_TL":0.0,"BHYT_DONGIA_DONGCT_DAU":0.0,"SOBHYT":"HN238382272757838523","SOBHYT_HUONG_ID":28371,"GIATRIMIENGIAM":0.0,"GIATRIMIENGIAM_BHTN":0.0,"GIATRIMIENGIAM_THANHVIEN":0.0,"GIATRIMIENGIAM_CONGTY":0.0,"BHYT_CK2_KHONGTHANHTOAN":false},{"VIENPHI_ID":674552,"TIEPNHAN_ID":27344,"DICHVU_ID":null,"BENHAN_ID":5859,"SOLUONG":1.0000,"DONGIA_DOANHTHU":7000.0000,"THANHTIEN_DOANHTHU":7000.00,"BHYT_TL":1.0,"BHYT_DONGIA":4410.0000,"BHYT_THANHTIEN":4410.00,"BHYT_DONGIA_CONGKHAM_DAU":0.0,"BHYT_CONGKHAM_DAU_TYLE":1.0,"BHYT_DONGIA_CHITRA":4410.0,"BHYT_THANHTIEN_CHITRA":4410.00,"BENHNHAN_PHAITHANHTOAN":2590.00,"GIATRI_HOADON":0.0,"GIATRI_HOADON_DATHANHTOAN":0.0,"GIATRI_BIENLAI":2590.00,"GIATRI_BIENLAI_DATHANHTOAN":0.0,"GIATRI_BENHNHAN_DATHANHTOAN":0.0,"DATHUCHIEN":"0","KHONGTHUTIEN":"0","BHYTDONGTIEN":"0","DICHVU_TL":0.0,"BHYT_DONGIA_DONGCT_DAU":0.0,"SOBHYT":"HN238382272757838523","SOBHYT_HUONG_ID":28371,"GIATRIMIENGIAM":0.0,"GIATRIMIENGIAM_BHTN":0.0,"GIATRIMIENGIAM_THANHVIEN":0.0,"GIATRIMIENGIAM_CONGTY":0.0,"BHYT_CK2_KHONGTHANHTOAN":false},{"VIENPHI_ID":674553,"TIEPNHAN_ID":27344,"DICHVU_ID":null,"BENHAN_ID":5859,"SOLUONG":3.0000,"DONGIA_DOANHTHU":630.0000,"THANHTIEN_DOANHTHU":1890.00,"BHYT_TL":1.0,"BHYT_DONGIA":630.0000,"BHYT_THANHTIEN":1890.00,"BHYT_DONGIA_CONGKHAM_DAU":0.0,"BHYT_CONGKHAM_DAU_TYLE":1.0,"BHYT_DONGIA_CHITRA":630.0,"BHYT_THANHTIEN_CHITRA":1890.00,"BENHNHAN_PHAITHANHTOAN":0.00,"GIATRI_HOADON":0.0,"GIATRI_HOADON_DATHANHTOAN":0.0,"GIATRI_BIENLAI":0.0,"GIATRI_BIENLAI_DATHANHTOAN":0.0,"GIATRI_BENHNHAN_DATHANHTOAN":0.0,"DATHUCHIEN":"0","KHONGTHUTIEN":"0","BHYTDONGTIEN":"0","DICHVU_TL":0.0,"BHYT_DONGIA_DONGCT_DAU":0.0,"SOBHYT":"HN238382272757838523","SOBHYT_HUONG_ID":28371,"GIATRIMIENGIAM":0.0,"GIATRIMIENGIAM_BHTN":0.0,"GIATRIMIENGIAM_THANHVIEN":0.0,"GIATRIMIENGIAM_CONGTY":0.0,"BHYT_CK2_KHONGTHANHTOAN":false},{"VIENPHI_ID":674554,"TIEPNHAN_ID":27344,"DICHVU_ID":null,"BENHAN_ID":5859,"SOLUONG":3.0000,"DONGIA_DOANHTHU":1030.0000,"THANHTIEN_DOANHTHU":3090.00,"BHYT_TL":1.0,"BHYT_DONGIA":1030.0000,"BHYT_THANHTIEN":3090.00,"BHYT_DONGIA_CONGKHAM_DAU":0.0,"BHYT_CONGKHAM_DAU_TYLE":1.0,"BHYT_DONGIA_CHITRA":1030.0,"BHYT_THANHTIEN_CHITRA":3090.00,"BENHNHAN_PHAITHANHTOAN":0.00,"GIATRI_HOADON":0.0,"GIATRI_HOADON_DATHANHTOAN":0.0,"GIATRI_BIENLAI":0.0,"GIATRI_BIENLAI_DATHANHTOAN":0.0,"GIATRI_BENHNHAN_DATHANHTOAN":0.0,"DATHUCHIEN":"0","KHONGTHUTIEN":"0","BHYTDONGTIEN":"0","DICHVU_TL":0.0,"BHYT_DONGIA_DONGCT_DAU":0.0,"SOBHYT":"HN238382272757838523","SOBHYT_HUONG_ID":28371,"GIATRIMIENGIAM":0.0,"GIATRIMIENGIAM_BHTN":0.0,"GIATRIMIENGIAM_THANHVIEN":0.0,"GIATRIMIENGIAM_CONGTY":0.0,"BHYT_CK2_KHONGTHANHTOAN":false},{"VIENPHI_ID":674555,"TIEPNHAN_ID":27344,"DICHVU_ID":null,"BENHAN_ID":5859,"SOLUONG":3.0000,"DONGIA_DOANHTHU":348.0000,"THANHTIEN_DOANHTHU":1044.00,"BHYT_TL":1.0,"BHYT_DONGIA":348.0000,"BHYT_THANHTIEN":1044.00,"BHYT_DONGIA_CONGKHAM_DAU":0.0,"BHYT_CONGKHAM_DAU_TYLE":1.0,"BHYT_DONGIA_CHITRA":348.0,"BHYT_THANHTIEN_CHITRA":1044.00,"BENHNHAN_PHAITHANHTOAN":0.00,"GIATRI_HOADON":0.0,"GIATRI_HOADON_DATHANHTOAN":0.0,"GIATRI_BIENLAI":0.0,"GIATRI_BIENLAI_DATHANHTOAN":0.0,"GIATRI_BENHNHAN_DATHANHTOAN":0.0,"DATHUCHIEN":"0","KHONGTHUTIEN":"0","BHYTDONGTIEN":"0","DICHVU_TL":0.0,"BHYT_DONGIA_DONGCT_DAU":0.0,"SOBHYT":"HN238382272757838523","SOBHYT_HUONG_ID":28371,"GIATRIMIENGIAM":0.0,"GIATRIMIENGIAM_BHTN":0.0,"GIATRIMIENGIAM_THANHVIEN":0.0,"GIATRIMIENGIAM_CONGTY":0.0,"BHYT_CK2_KHONGTHANHTOAN":false},{"VIENPHI_ID":674556,"TIEPNHAN_ID":27344,"DICHVU_ID":null,"BENHAN_ID":5859,"SOLUONG":2.0000,"DONGIA_DOANHTHU":4000.0000,"THANHTIEN_DOANHTHU":8000.00,"BHYT_TL":1.0000,"BHYT_DONGIA":0.0,"BHYT_THANHTIEN":0.0,"BHYT_DONGIA_CONGKHAM_DAU":0.0,"BHYT_CONGKHAM_DAU_TYLE":1.0,"BHYT_DONGIA_CHITRA":0.0,"BHYT_THANHTIEN_CHITRA":0.0,"BENHNHAN_PHAITHANHTOAN":8000.00,"GIATRI_HOADON":0.0,"GIATRI_HOADON_DATHANHTOAN":0.0,"GIATRI_BIENLAI":8000.00000000,"GIATRI_BIENLAI_DATHANHTOAN":0.0,"GIATRI_BENHNHAN_DATHANHTOAN":0.0,"DATHUCHIEN":"0","KHONGTHUTIEN":"0","BHYTDONGTIEN":"0","DICHVU_TL":0.0,"BHYT_DONGIA_DONGCT_DAU":0.0,"SOBHYT":"HN238382272757838523","SOBHYT_HUONG_ID":28371,"GIATRIMIENGIAM":0.0,"GIATRIMIENGIAM_BHTN":0.0,"GIATRIMIENGIAM_THANHVIEN":0.0,"GIATRIMIENGIAM_CONGTY":0.0,"BHYT_CK2_KHONGTHANHTOAN":false}]';        begin        UPDATE TT_VIENPHI        SET        SOLUONG = json.SOLUONG,        DONGIA_DOANHTHU = json.DONGIA_DOANHTHU,        THANHTIEN_DOANHTHU = json.THANHTIEN_DOANHTHU,        BHYT_TL = json.BHYT_TL,        BHYT_DONGIA = json.BHYT_DONGIA,        BHYT_THANHTIEN = json.BHYT_THANHTIEN,        BHYT_DONGIA_CONGKHAM_DAU = json.BHYT_DONGIA_CONGKHAM_DAU,        BHYT_CONGKHAM_DAU_TYLE = json.BHYT_CONGKHAM_DAU_TYLE,        BHYT_DONGIA_CHITRA = json.BHYT_DONGIA_CHITRA,        BHYT_THANHTIEN_CHITRA = json.BHYT_THANHTIEN_CHITRA,        BENHNHAN_PHAITHANHTOAN = json.BENHNHAN_PHAITHANHTOAN,        GIATRI_HOADON = json.GIATRI_HOADON,                GIATRI_BIENLAI = json.GIATRI_BIENLAI,                DATHUCHIEN = json.DATHUCHIEN,                DICHVU_TL = json.DICHVU_TL,        BHYT_DONGIA_DONGCT_DAU = json.BHYT_DONGIA_DONGCT_DAU,        NGAYCAPNHAT = GETDATE()        FROM OPENJSON (@jsonVienPhi)        WITH (        VIENPHI_ID int,        SOLUONG numeric(25, 4),        DONGIA_DOANHTHU numeric(25, 4),        THANHTIEN_DOANHTHU numeric(25, 4),        BHYT_TL numeric(25, 4),        BHYT_DONGIA numeric(25, 4),        BHYT_THANHTIEN numeric(25, 4),        BHYT_DONGIA_CONGKHAM_DAU numeric(25, 4),        BHYT_CONGKHAM_DAU_TYLE numeric(25, 4),        BHYT_DONGIA_CHITRA numeric(25, 4),        BHYT_THANHTIEN_CHITRA numeric(25, 4),        BENHNHAN_PHAITHANHTOAN numeric(25, 4),        GIATRI_HOADON numeric(25, 4),                GIATRI_BIENLAI numeric(25, 4),                DATHUCHIEN char(1),        KHONGTHUTIEN char(1),        BHYTDONGTIEN char(1),        DICHVU_TL numeric(25, 4),        BHYT_DONGIA_DONGCT_DAU numeric(25, 4))  json        WHERE TT_VIENPHI.VIENPHI_ID = json.VIENPHI_ID and json.DONGIA_DOANHTHU > 0                  insert into TT_TINH_VIENPHI_LOG        SELECT json.VIENPHI_ID, json.TIEPNHAN_ID, json.BENHAN_ID, json.SOLUONG, json.BHYT_TL, json.DONGIA_DOANHTHU,        json.THANHTIEN_DOANHTHU, json.BHYT_DONGIA, json.BHYT_THANHTIEN, json.BHYT_DONGIA_CHITRA, json.BHYT_THANHTIEN_CHITRA, json.BENHNHAN_PHAITHANHTOAN,        json.SOBHYT_HUONG_ID, json.SOBHYT, GETDATE(), -1, 'HLU01'        FROM OPENJSON(@jsonVienPhi)        WITH (        VIENPHI_ID int,        TIEPNHAN_ID int,        BENHAN_ID int,        SOLUONG numeric(25, 4),        DONGIA_DOANHTHU numeric(25, 4),        THANHTIEN_DOANHTHU numeric(25, 4),        BHYT_TL numeric(25, 4),        BHYT_DONGIA numeric(25, 4),        BHYT_THANHTIEN numeric(25, 4),        BHYT_DONGIA_CHITRA numeric(25, 4),        BHYT_THANHTIEN_CHITRA numeric(25, 4),        BENHNHAN_PHAITHANHTOAN numeric(25, 4),        SOBHYT_HUONG_ID int,        SOBHYT nvarchar(30)) json        end]
2019-10-31 11:13:10,492 [1] DEBUG - Statement Id: [DAO00067_UpdateDataVienPhiDongiaBHYT] PreparedStatement : [update TT_VIENPHI          set BHYT_DONGIA_CHITRA = 0, BHYT_THANHTIEN = 0, BHYT_THANHTIEN_CHITRA = 0          where          TIEPNHAN_ID = 27344 and BHYT_DONGIA = 0          and (BHYT_DONGIA_CHITRA > 0 or BHYT_THANHTIEN > 0 or BHYT_THANHTIEN_CHITRA > 0)]
2019-10-31 11:13:10,521 [1] DEBUG - Statement Id: [DAO00067_CapnhatDataVienphiKhiHuyThanhtoanHoadon] PreparedStatement : [update TT_VIENPHI        set TT_VIENPHI.HOADON_ID = hdct.HOADON_ID, TT_VIENPHI.GIATRI_BENHNHAN_DATHANHTOAN = TT_VIENPHI.GIATRI_BENHNHAN_DATHANHTOAN + hdct.GIATRI_BENHNHAN_DATHANHTOAN        from (select CT.HOADON_ID, CT.VIENPHI_ID, CT.GIATRI_BENHNHAN_DATHANHTOAN        from TT_HOADON_CHITIET_NGOAITRU CT        join TT_HOADON HD on HD.HOADON_ID = CT.HOADON_ID        join TT_VIENPHI vp on vp.VIENPHI_ID = ct.VIENPHI_ID        where HD.DATHANHTOAN = 1 and HD.HUYHOADON = 0 and HD.HOANTRA = 0 and vp.TIEPNHAN_ID =  @param0 ) hdct        where        TT_VIENPHI.VIENPHI_ID = hdct.VIENPHI_ID and TT_VIENPHI.HOADON_ID is null and isnull(TT_VIENPHI.GIATRI_BENHNHAN_DATHANHTOAN,0) = 0        and TT_VIENPHI.TIEPNHAN_ID =  @param0           update TT_VIENPHI        set TT_VIENPHI.HOADON_ID = null, TT_VIENPHI.GIATRI_BENHNHAN_DATHANHTOAN = TT_VIENPHI.GIATRI_BENHNHAN_DATHANHTOAN - hdct.GIATRI_BENHNHAN_DATHANHTOAN,        TT_VIENPHI.DATHANHTOAN = '0'        from (select CT.HOADON_ID, CT.VIENPHI_ID, CT.GIATRI_BENHNHAN_DATHANHTOAN        from TT_HOADON_CHITIET_NGOAITRU CT        join TT_HOADON HD on HD.HOADON_ID = CT.HOADON_ID        join TT_VIENPHI vp on vp.VIENPHI_ID = ct.VIENPHI_ID and vp.HOADON_ID = ct.HOADON_ID        where HD.DATHANHTOAN = 0 and (HD.HUYHOADON = 1 or HD.HOANTRA = 1) and vp.TIEPNHAN_ID =  @param0 ) hdct        where        TT_VIENPHI.VIENPHI_ID = hdct.VIENPHI_ID and TT_VIENPHI.HOADON_ID = hdct.HOADON_ID        and TT_VIENPHI.TIEPNHAN_ID =  @param0]
2019-10-31 11:13:10,521 [1] DEBUG - Statement Id: [DAO00067_CapnhatDataVienphiKhiHuyThanhtoanHoadon] Parameters: [@param0=[TIEPNHAN_ID,27344]]
2019-10-31 11:13:10,522 [1] DEBUG - Statement Id: [DAO00067_CapnhatDataVienphiKhiHuyThanhtoanHoadon] Types: [@param0=[Int64, System.Int64]]
2019-10-31 11:13:10,601 [1] DEBUG - Statement Id: [DAO00120_TT_VIENPHI_GetList] PreparedStatement : [SELECT VP.*, MG_STATUS.MIENGIAM_STATUS, MG_STATUS.MIENGIAM_DUYET_STATUS        , MG.MIENGIAM_CHITRA, MGCT.CONGTY_CHITRA, MGTV.THEHOIVIEN_CHITRA, MG_BHTN.BHTN_CHITRA, 0 AS GIATRI_CHITRA, 0 AS TYLE_CHITRA        , DVYC.HUYYEUCAU, DV.MADICHVU, DV.TENDICHVU, D.MADUOC, D.TENDUOCDAYDU AS TENDUOC, LD.LOAIVATTU_ID, NDV.MANHOMDICHVU        , NK.MAKHAUPHANAN, NK.TENKHAUPHANAN, ITKB.NGAYKHAM as NGAYPHATSINH_YLENH        , DATAOBIENLAI = CASE WHEN ISNULL(HD.SOHOADON,0) != 0 THEN '1' ELSE '0' END           , PB.TENPHONGBAN AS NOITHUCHIEN        FROM TT_VIENPHI AS VP        LEFT JOIN TM_DICHVU AS DV ON DV.DICHVU_ID = VP.DICHVU_ID AND VP.REF_TABLE != 'TT_NUT_XACNHANSUATAN_CHITIET'        LEFT JOIN TM_NUT_KHAUPHANAN AS NK ON NK.KHAUPHANAN_ID = VP.DICHVU_ID AND VP.REF_TABLE = 'TT_NUT_XACNHANSUATAN_CHITIET'        LEFT JOIN TM_NHOMDICHVU AS NDV ON NDV.NHOMDICHVU_ID = DV.NHOMDICHVU_ID        LEFT JOIN TM_DUOC AS D ON D.DUOC_ID = VP.DUOC_ID        LEFT JOIN TM_LOAIDUOC AS LD ON LD.LOAIDUOC_ID = D.LOAIDUOC_ID        LEFT JOIN TT_DVYEUCAU AS DVYC ON DVYC.DVYEUCAU_ID = VP.REF_ID AND VP.REF_TABLE = 'TT_DVYEUCAU'        LEFT JOIN TM_PHONGBAN PB ON PB.PHONGBAN_ID = DVYC.NOITHUCHIEN_ID        LEFT JOIN TT_NOITRU_TOATHUOC AS IT ON IT.TOATHUOC_ID = VP.REF_ID AND VP.REF_TABLE = 'TT_NOITRU_TOATHUOC'        LEFT JOIN TT_NOITRU_KHAMBENH AS ITKB ON IT.KHAMBENH_ID = ITKB.KHAMBENH_ID AND VP.REF_TABLE = 'TT_NOITRU_TOATHUOC'        LEFT JOIN TT_NGOAITRU_TOATHUOC AS OT ON OT.TOATHUOC_ID = VP.REF_ID AND VP.REF_TABLE = 'TT_NGOAITRU_TOATHUOC'        LEFT JOIN TT_NGOAITRU_KHAMBENH_TOATHUOC AS OKT ON OKT.KHAMBENH_TOATHUOC_ID = OT.KHAMBENH_TOATHUOC_ID        LEFT JOIN TT_PHAUTHUAT_VTYT AS PV ON PV.PHAUTHUAT_VTYT_ID = VP.REF_ID AND VP.REF_TABLE = 'TT_PHAUTHUAT_VTYT'        LEFT JOIN TT_CLSKETQUA_VTYT AS CV ON CV.CLSKETQUA_VTYT_ID = VP.REF_ID AND VP.REF_TABLE = 'TT_CLSKETQUA_VTYT'        LEFT JOIN TT_NGOAITRU_KHAMBENH_VTYT AS OKV ON OKV.KHAMBENH_VTYT_ID = VP.REF_ID AND VP.REF_TABLE = 'TT_NGOAITRU_KHAMBENH_VTYT'        LEFT JOIN TT_NUT_XACNHANSUATAN_CHITIET AS NXC ON NXC.XACNHANSUATANCHITIET_ID = VP.REF_ID AND VP.REF_TABLE = 'TT_NUT_XACNHANSUATAN_CHITIET'        LEFT JOIN TT_DUOC_CHUNGTU_CHITIET AS CTCT ON CTCT.CHUNGTUCHITIET_ID = VP.REF_ID AND VP.REF_TABLE = 'TT_DUOC_CHUNGTU_CHITIET'        LEFT JOIN        (        SELECT VIENPHI_ID, SUM(MGCT.GIATRIMIENGIAM) AS BHTN_CHITRA        FROM TT_MIENGIAM_BHTN AS MG INNER JOIN TT_MIENGIAM_CHITIET AS MGCT ON MG.MIENGIAM_BHTN_ID = MGCT.MIENGIAM_ID        WHERE MG.TIEPNHAN_ID= 27344 AND MGCT.REF_TABLE = 'TT_MIENGIAM_BHTN'                 GROUP BY VIENPHI_ID        ) AS MG_BHTN ON VP.VIENPHI_ID = MG_BHTN.VIENPHI_ID          LEFT JOIN        (        SELECT VIENPHI_ID, SUM(MGCT.GIATRIMIENGIAM) AS MIENGIAM_CHITRA, MG.MIENGIAM_ID        FROM TT_MIENGIAM AS MG INNER JOIN TT_MIENGIAM_CHITIET AS MGCT ON MG.MIENGIAM_ID = MGCT.MIENGIAM_ID        WHERE MG.TIEPNHAN_ID= 27344 AND MGCT.REF_TABLE = 'TT_MIENGIAM'                 GROUP BY VIENPHI_ID, MG.MIENGIAM_ID        ) AS MG ON VP.VIENPHI_ID = MG.VIENPHI_ID          LEFT JOIN        (        SELECT VIENPHI_ID, SUM(MGCT.GIATRIMIENGIAM) AS THEHOIVIEN_CHITRA        FROM TT_MIENGIAM_THANHVIEN AS MG INNER JOIN TT_MIENGIAM_CHITIET AS MGCT ON MG.MIENGIAM_THANHVIEN_ID = MGCT.MIENGIAM_ID        WHERE MG.TIEPNHAN_ID= 27344 AND MGCT.REF_TABLE = 'TT_MIENGIAM_THANHVIEN'                 GROUP BY VIENPHI_ID        ) AS MGTV ON VP.VIENPHI_ID = MGTV.VIENPHI_ID          LEFT JOIN        (        SELECT VIENPHI_ID, SUM(MGCT.GIATRIMIENGIAM) AS CONGTY_CHITRA        FROM TT_MIENGIAM_CONGTY AS MG INNER JOIN TT_MIENGIAM_CHITIET AS MGCT ON MG.MIENGIAM_CONGTY_ID = MGCT.MIENGIAM_ID        WHERE MG.TIEPNHAN_ID= 27344 and MGCT.REF_TABLE = 'TT_MIENGIAM_CONGTY'                 GROUP BY VIENPHI_ID        ) AS MGCT ON VP.VIENPHI_ID = MGCT.VIENPHI_ID          LEFT JOIN        (        SELECT VP.VIENPHI_ID, CONVERT(VARCHAR,MAX(CASE WHEN MC_BHTN.MIENGIAMCHITIET_ID IS NULL THEN 0 ELSE 1 END))        + CONVERT(VARCHAR,MAX(CASE WHEN MC_CTCT.MIENGIAMCHITIET_ID IS NULL THEN 0 ELSE 1 END))        + CONVERT(VARCHAR,MAX(CASE WHEN MC_MG.MIENGIAMCHITIET_ID IS NULL THEN 0 ELSE 1 END)) AS MIENGIAM_STATUS        , CONVERT(VARCHAR,MIN(ISNULL(M1.TINHTRANG,1)))        + CONVERT(VARCHAR,MIN(ISNULL(M2.TINHTRANG,1)))        + CONVERT(VARCHAR,MIN(ISNULL(M3.TINHTRANG,1))) AS MIENGIAM_DUYET_STATUS        FROM TT_VIENPHI AS VP        LEFT JOIN TT_MIENGIAM_CHITIET AS MC_BHTN ON MC_BHTN.REF_TABLE = 'TT_MIENGIAM_BHTN' AND MC_BHTN.VIENPHI_ID = VP.VIENPHI_ID        LEFT JOIN TT_MIENGIAM_BHTN AS M1 ON M1.MIENGIAM_BHTN_ID = MC_BHTN.MIENGIAM_ID        LEFT JOIN TT_MIENGIAM_CHITIET AS MC_CTCT ON MC_CTCT.REF_TABLE = 'TT_MIENGIAM_CONGTY' AND MC_CTCT.VIENPHI_ID = VP.VIENPHI_ID        LEFT JOIN TT_MIENGIAM_CONGTY AS M2 ON M2.MIENGIAM_CONGTY_ID = MC_CTCT.MIENGIAM_ID        LEFT JOIN TT_MIENGIAM_CHITIET AS MC_MG ON MC_MG.REF_TABLE = 'TT_MIENGIAM' AND MC_MG.VIENPHI_ID = VP.VIENPHI_ID        LEFT JOIN TT_MIENGIAM AS M3 ON M3.MIENGIAM_ID = MC_MG.MIENGIAM_ID        WHERE VP.TIEPNHAN_ID = 27344 AND VP.BENHVIEN_ID = 'HLU01'        GROUP BY VP.VIENPHI_ID        ) AS MG_STATUS ON MG_STATUS.VIENPHI_ID = VP.VIENPHI_ID          LEFT JOIN        (        SELECT ISNULL(HCO.VIENPHI_ID, HCI.VIENPHI_ID) AS VIENPHI_ID, COUNT(H.HOADON_ID) AS SOHOADON        FROM TT_HOADON AS H        LEFT JOIN TT_HOADON_CHITIET_NGOAITRU AS HCO ON HCO.HOADON_ID = H.HOADON_ID        LEFT JOIN TT_HOADON_CHITIET_NOITRU AS HCI ON HCI.HOADON_ID = H.HOADON_ID        WHERE H.TIEPNHAN_ID = 27344 AND H.BENHVIEN_ID = 'HLU01' AND H.HUYHOADON = '0' AND H.HOANTRA = '0'        GROUP BY HCO.VIENPHI_ID, HCI.VIENPHI_ID        ) AS HD ON HD.VIENPHI_ID = VP.VIENPHI_ID            WHERE VP.BENHNHAN_PHAITHANHTOAN >= 0 AND VP.TIEPNHAN_ID = 27344   and             VP.DATHANHTOAN = '0'            and             VP.BENHAN_ID = 5859                   AND VP.KHONGTHUTIEN = '0' AND VP.BENHVIEN_ID = 'HLU01'        AND (DVYC.DVYEUCAU_ID IS NULL OR DVYC.HUYYEUCAU != '1')        AND (IT.TOATHUOC_ID IS NULL OR IT.CHUNGTU_ID IS NOT NULL)        AND (OT.TOATHUOC_ID IS NULL OR OKT.CHUNGTUPHATTHUOC_ID IS NOT NULL)        AND (PV.PHAUTHUAT_VTYT_ID IS NULL OR PV.CHUNGTU_ID IS NOT NULL)        AND (CV.CLSKETQUA_VTYT_ID IS NULL OR CV.CHUNGTU_ID IS NOT NULL)        AND (OKV.KHAMBENH_VTYT_ID IS NULL OR OKV.CHUNGTU_ID IS NOT NULL)        AND (NXC.XACNHANSUATANCHITIET_ID IS NULL OR NXC.TONGHOPSUATANCHITIET_ID IS NOT NULL)        and ((VP.DICHVU_ID is not null and VP.DUOC_ID is null) or (VP.DUOC_ID is not null and CTCT.CHUNGTU_ID is not null) or (VP.DUOC_ID is not null and VP.REF_TABLE != 'TT_DUOC_CHUNGTU_CHITIET')        and VP.REF_ID != 0 and VP.KHONGTHUTIEN = '0')]
