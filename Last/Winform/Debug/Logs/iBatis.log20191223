--------------------------------------------------------------------------------
2019-12-23 15:45:55,050 [1] DEBUG - Statement Id: [DAO00001_DBList] PreparedStatement : [select *              from TM_SYS_SERVER              where HOSPITAL_ID = '_SYSTEM_' and TYPE = 'D']
2019-12-23 15:45:55,839 [1] DEBUG - Statement Id: [DAO00001_DaoList] PreparedStatement : [select              TM_SYS_SERVICEMAP.ID,              TM_SYS_SERVICEMAP.HOSPITAL_ID,              TM_SYS_SERVICEMAP.DB_NAME,              TM_SYS_SERVICEMAP.TYPE,              TM_SYS_SERVICEMAP.NAME,              TM_SYS_SERVICEMAP.CLASS,              (TM_SYS_DIC.VALUE + '.' + TM_SYS_SERVICEMAP.CLASS) as CLASSFULL,              TM_SYS_SERVICEMAP.ASSEMBLY              from TM_SYS_SERVICEMAP              inner join TM_SYS_DIC              on TM_SYS_SERVICEMAP.NAMESPACE = TM_SYS_DIC.ID              where HOSPITAL_ID = '_SYSTEM_' AND TYPE = 'D' AND ACTIVE = '1'              order by DB_NAME]
2019-12-23 15:45:55,934 [1] DEBUG - Statement Id: [DAO00001_ServiceList] PreparedStatement : [select              TM_SYS_SERVICEMAP.ID,              TM_SYS_SERVICEMAP.HOSPITAL_ID,              TM_SYS_SERVICEMAP.DB_NAME,              TM_SYS_SERVICEMAP.TYPE,              TM_SYS_SERVICEMAP.NAME,              TM_SYS_SERVICEMAP.CLASS,              (TM_SYS_DIC.VALUE + '.' + TM_SYS_SERVICEMAP.CLASS) as CLASSFULL,              TM_SYS_SERVICEMAP.ASSEMBLY,              TM_SYS_SERVER.URL              from TM_SYS_SERVICEMAP              inner join TM_SYS_DIC on TM_SYS_SERVICEMAP.NAMESPACE = TM_SYS_DIC.ID              inner join TM_SYS_SERVER on (TM_SYS_SERVICEMAP.DB_NAME = TM_SYS_SERVER.NAME) and (TM_SYS_SERVER.HOSPITAL_ID = '_SYSTEM_')              where TM_SYS_SERVICEMAP.HOSPITAL_ID = '_SYSTEM_' AND TM_SYS_SERVICEMAP.TYPE = 'S'  AND ACTIVE = '1'              order by URL]
2019-12-23 15:45:56,984 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = '_SYSTEM_'               AND                   TM_SYS_SCREEN.PAGE = 'LOGIN'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2019-12-23 15:45:57,753 [1] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = '_SYSTEM_'               AND                   TM_SYS_CACHE.ACTIVE = '1']
2019-12-23 15:46:12,322 [1] DEBUG - Statement Id: [DAO00001_DBList] PreparedStatement : [select *              from TM_SYS_SERVER              where HOSPITAL_ID = 'HLU01' and TYPE = 'D']
2019-12-23 15:46:12,352 [1] DEBUG - Statement Id: [DAO00001_DaoList] PreparedStatement : [select              TM_SYS_SERVICEMAP.ID,              TM_SYS_SERVICEMAP.HOSPITAL_ID,              TM_SYS_SERVICEMAP.DB_NAME,              TM_SYS_SERVICEMAP.TYPE,              TM_SYS_SERVICEMAP.NAME,              TM_SYS_SERVICEMAP.CLASS,              (TM_SYS_DIC.VALUE + '.' + TM_SYS_SERVICEMAP.CLASS) as CLASSFULL,              TM_SYS_SERVICEMAP.ASSEMBLY              from TM_SYS_SERVICEMAP              inner join TM_SYS_DIC              on TM_SYS_SERVICEMAP.NAMESPACE = TM_SYS_DIC.ID              where HOSPITAL_ID = 'HLU01' AND TYPE = 'D' AND ACTIVE = '1'              order by DB_NAME]
2019-12-23 15:46:19,614 [1] DEBUG - Statement Id: [DAO00001_ServiceList] PreparedStatement : [select              TM_SYS_SERVICEMAP.ID,              TM_SYS_SERVICEMAP.HOSPITAL_ID,              TM_SYS_SERVICEMAP.DB_NAME,              TM_SYS_SERVICEMAP.TYPE,              TM_SYS_SERVICEMAP.NAME,              TM_SYS_SERVICEMAP.CLASS,              (TM_SYS_DIC.VALUE + '.' + TM_SYS_SERVICEMAP.CLASS) as CLASSFULL,              TM_SYS_SERVICEMAP.ASSEMBLY,              TM_SYS_SERVER.URL              from TM_SYS_SERVICEMAP              inner join TM_SYS_DIC on TM_SYS_SERVICEMAP.NAMESPACE = TM_SYS_DIC.ID              inner join TM_SYS_SERVER on (TM_SYS_SERVICEMAP.DB_NAME = TM_SYS_SERVER.NAME) and (TM_SYS_SERVER.HOSPITAL_ID = 'HLU01')              where TM_SYS_SERVICEMAP.HOSPITAL_ID = 'HLU01' AND TM_SYS_SERVICEMAP.TYPE = 'S'  AND ACTIVE = '1'              order by URL]
2019-12-23 15:46:19,795 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1']
2019-12-23 15:46:21,596 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM005']
2019-12-23 15:46:24,311 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM015']
2019-12-23 15:46:24,618 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM067']
2019-12-23 15:46:24,821 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM008']
2019-12-23 15:46:24,939 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM068']
2019-12-23 15:46:25,046 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM006']
2019-12-23 15:46:25,225 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM030']
2019-12-23 15:46:25,440 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM025']
2019-12-23 15:46:25,891 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM024']
2019-12-23 15:46:26,750 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM033']
2019-12-23 15:46:26,805 [5] DEBUG - Statement Id: [DAO00027_GetListDuocKyGuiTonKho] PreparedStatement : [select  distinct TT_TONKHO.DUOC_KEY, LTRIM(TT_TONKHO.KHODUOC_ID) as KHODUOC_ID, TM_DUOC.DUOC_ID, TM_LOAIDUOC.MALOAIDUOC,TM_DUOC.SOVISA,TM_DUOC.TYLE_VAT,TM_DUOC.COTOA,        TM_DUOC.MADUOC, TM_DUOC.TENHANG, TM_DUOC.TENDUOCDAYDU, dvt.TENDONVITINH as DONVITINH,  TM_DUOC.DONVITINH_ID,TM_DUOC.BHYT,TM_DUOC.PHAMVI,        TM_DUOC.TENHOATCHAT, TM_DUOC.HAMLUONG, TM_DUOC.HANGSANXUAT, TM_DUOC.QUOCGIA, TM_DUOC.LOAIDUOC_ID, TM_DUOC.DUONGDUNG_ID,        TM_TENDUOC.TENDUOC, TM_TENDUOC.TENDUOC_EN, TM_TENDUOC.MAQUOCTE, TM_TENDUOC.MAQUOCTEBT,        TM_LOAIDUOC.LOAIVATTU_ID, TM_DUOC.BENHVIEN_ID,TT_TONKHO.SOLUONG, TT_TONKHO.NGUONDUOC_ID, NH.TENNGUONDUOC        , TAMNGUNG = CASE WHEN TM_DUOC.TAMNGUNG = '1' OR nh.TAMNGUNG = '1' OR KD.TAMNGUNG = '1' THEN '1' ELSE '0' END        , TM_DUOC.DANGTRINHBAY        from TM_DUOC        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = TM_DUOC.DONVITINH_ID        left join TM_TENDUOC on TM_DUOC.TENDUOC_ID = TM_TENDUOC.TENDUOC_ID and TM_DUOC.BENHVIEN_ID = 'HLU01' and TM_DUOC.TAMNGUNG = '0'        left join TM_LOAIDUOC on TM_LOAIDUOC.LOAIDUOC_ID = TM_DUOC.LOAIDUOC_ID and TM_LOAIDUOC.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG on (TM_LOAIDUOC.LOAIVATTU_ID = TM_DUOC_HANDUNG.LOAIDUOC and TM_DUOC_HANDUNG.BENHVIEN_ID = 'HLU01')        inner join        (select LTRIM(A.KHODUOC_ID) + '_' + LTRIM(A.DUOC_ID) + '_' + LTRIM(ISNULL(A.NGUONDUOC_ID,'')) as DUOC_KEY, A.KHODUOC_ID, A.DUOC_ID,A.NGUONDUOC_ID,        SUM(isnull(A.SOLUONG,0)) as SOLUONG        from        (select SUM(SOLUONG) as SOLUONG, KHODUOC_ID, DUOC_ID, NGUONDUOC_ID from TT_DUOC_KYGUI_TONKHO        where BENHVIEN_ID = 'HLU01' group by KHODUOC_ID, DUOC_ID, NGUONDUOC_ID) A        group by LTRIM(A.KHODUOC_ID) + '_' + LTRIM(A.DUOC_ID) + '_' + LTRIM(A.NGUONDUOC_ID), A.KHODUOC_ID, A.DUOC_ID, A.NGUONDUOC_ID)        TT_TONKHO on TT_TONKHO.DUOC_ID = TM_DUOC.DUOC_ID        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = TT_TONKHO.NGUONDUOC_ID and nh.BENHVIEN_ID = 'HLU01'        LEFT JOIN TM_KHODUOC KD ON KD.KHODUOC_ID = TT_TONKHO.KHODUOC_ID        where TM_DUOC.BENHVIEN_ID = 'HLU01' AND TT_TONKHO.SOLUONG >= 0]
2019-12-23 15:46:26,995 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM018']
2019-12-23 15:46:27,168 [5] DEBUG - Statement Id: [DAO00027_GetListDuocTonKho] PreparedStatement : [select distinct TT_TONKHO.DUOC_KEY, LTRIM(TT_TONKHO.KHODUOC_ID) as KHODUOC_ID, TM_DUOC.DUOC_ID, TM_LOAIDUOC.MALOAIDUOC,TM_DUOC.SOVISA,TM_DUOC.TYLE_VAT,TM_DUOC.COTOA,        TM_DUOC.MADUOC, TM_DUOC.TENHANG, TM_DUOC.TENDUOCDAYDU, dvt.TENDONVITINH as DONVITINH,  TM_DUOC.DONVITINH_ID,TM_DUOC.BHYT,                TM_DUOC.TENHOATCHAT,          TM_DUOC.HAMLUONG, TM_DUOC.HANGSANXUAT, TM_DUOC.QUOCGIA, TM_DUOC.LOAIDUOC_ID, TM_DUOC.DUONGDUNG_ID,        TM_TENDUOC.TENDUOC, TM_TENDUOC.TENDUOC_EN, TM_TENDUOC.MAQUOCTE, TM_TENDUOC.MAQUOCTEBT,        TM_LOAIDUOC.LOAIVATTU_ID, TM_DUOC.BENHVIEN_ID,        TT_TONKHO.SOLUONG, TM_DUOC.VTYT_PHANLOAI, TM_DUOC.PHAMVI, TT_TONKHO.NGUONDUOC_ID, NG.TENNGUONDUOC AS TENNGUONDUOC        , TAMNGUNG = CASE WHEN TM_DUOC.TAMNGUNG = '1' OR NG.TAMNGUNG = '1' OR KD.TAMNGUNG = '1' THEN '1' ELSE '0' END        , TM_DUOC.DANGTRINHBAY        from TM_DUOC        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = TM_DUOC.DONVITINH_ID        left join TM_TENDUOC on TM_DUOC.TENDUOC_ID = TM_TENDUOC.TENDUOC_ID and TM_DUOC.BENHVIEN_ID = 'HLU01' and TM_DUOC.TAMNGUNG = '0'        left join TM_LOAIDUOC on TM_LOAIDUOC.LOAIDUOC_ID = TM_DUOC.LOAIDUOC_ID and TM_LOAIDUOC.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG on (TM_LOAIDUOC.LOAIVATTU_ID = TM_DUOC_HANDUNG.LOAIDUOC and TM_DUOC_HANDUNG.BENHVIEN_ID = 'HLU01')        inner join        (select LTRIM(A.KHODUOC_ID) + '_' + LTRIM(A.DUOC_ID) + '_' + LTRIM(ISNULL(A.NGUONDUOC_ID,'')) as DUOC_KEY, A.KHODUOC_ID, A.DUOC_ID, A.NGUONDUOC_ID,        SUM(isnull(A.SOLUONG,0)) as SOLUONG        from        (select SUM(SOLUONG) as SOLUONG, KHODUOC_ID, DUOC_ID, NGUONDUOC_ID from TT_DUOC_TONKHO        where BENHVIEN_ID = 'HLU01' group by KHODUOC_ID, DUOC_ID, NGUONDUOC_ID) A        group by LTRIM(A.KHODUOC_ID) + '_' + LTRIM(A.DUOC_ID) + '_' + LTRIM(ISNULL(A.NGUONDUOC_ID,'')), A.KHODUOC_ID, A.DUOC_ID, NGUONDUOC_ID        ) TT_TONKHO on TT_TONKHO.DUOC_ID = TM_DUOC.DUOC_ID        LEFT JOIN TM_NGUONHANG NG ON NG.NGUONDUOC_ID = TT_TONKHO.NGUONDUOC_ID        LEFT JOIN TM_KHODUOC KD ON KD.KHODUOC_ID = TT_TONKHO.KHODUOC_ID        where TM_DUOC.BENHVIEN_ID = 'HLU01' and TT_TONKHO.SOLUONG >= 0]
2019-12-23 15:46:30,858 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM023']
2019-12-23 15:46:30,915 [5] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoVaBooking] PreparedStatement : [declare @NGUONDUOC_MACDINH varchar(5) = '0';        declare @TOAMUANGOAI int = 0;        select @NGUONDUOC_MACDINH = isnull(VALUE,0) from TM_SYS_APPSETTINGS where CODE = 'PHA_NGUONDUOC'        select @TOAMUANGOAI = isnull(VALUE,0) from TM_SYS_APPSETTINGS where CODE = 'OPD_TOAMUANGOAI_DUNGDANHMUC_DUOC'                if @TOAMUANGOAI = 1        begin        select  distinct '0' + '_' + LTRIM(d.DUOC_ID) + '_' + @NGUONDUOC_MACDINH as DUOC_KEY, 0 as PHAMVI_ID, @NGUONDUOC_MACDINH as NGUONDUOC_ID, null as TENNGUONDUOC, null as TINHTIEN, d.DUOC_ID, ld.MALOAIDUOC,        d.SOVISA,d.TYLE_VAT,d.COTOA, d.MADUOC, d.TENHANG, d.TENDUOCDAYDU, d.DONVITINH as DONVITINH, d.BHYT,        d.TENHOATCHAT, d.HAMLUONG, d.HANGSANXUAT, d.QUOCGIA, d.LOAIDUOC_ID, d.DUONGDUNG_ID, d.TINHTIEN_PTTT,        ten.TENDUOC, ten.TENDUOC_EN, ten.MAQUOCTE, ten.MAQUOCTEBT,d.CONGDUNG,        '' as BHYT_TEXT        , ld.LOAIVATTU_ID        , d.BENHVIEN_ID,        999999999 as SOLUONG, d.VTYT_PHANLOAI, d.PHAMVI, d.SUASOLUONGTONGHOP, d.MADUOCBV, d.DANGTRINHBAY        , TAMNGUNG = CASE WHEN d.TAMNGUNG = '1' THEN '1' ELSE '0' END        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        union all        select  distinct tk.DUOC_KEY, LTRIM(tk.PHAMVI_ID) as PHAMVI_ID, tk.NGUONDUOC_ID, nh.TENNGUONDUOC, nh.TINHTIEN, d.DUOC_ID, ld.MALOAIDUOC,        d.SOVISA,d.TYLE_VAT,d.COTOA, d.MADUOC, d.TENHANG, d.TENDUOCDAYDU, d.DONVITINH as DONVITINH, d.BHYT,        d.TENHOATCHAT, d.HAMLUONG, d.HANGSANXUAT, d.QUOCGIA, d.LOAIDUOC_ID, d.DUONGDUNG_ID, d.TINHTIEN_PTTT,        ten.TENDUOC, ten.TENDUOC_EN, ten.MAQUOCTE, ten.MAQUOCTEBT,d.CONGDUNG,        CASE WHEN d.BHYT = '1' THEN 'BHYT' ELSE '' END as BHYT_TEXT        , ld.LOAIVATTU_ID        , d.BENHVIEN_ID,        tk.SOLUONG, d.VTYT_PHANLOAI, d.PHAMVI, d.SUASOLUONGTONGHOP, d.MADUOCBV, d.DANGTRINHBAY        , TAMNGUNG = CASE WHEN d.TAMNGUNG = '1' OR nh.TAMNGUNG = '1' OR kd.TAMNGUNG = '1' THEN '1' ELSE '0' END        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        inner join        (        select  LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')) DUOC_KEY, (SUM(dtk.SOLUONG) - isnull(sum(A.SOLUONG),0) - isnull(sum(B.SOLUONG),0)) SOLUONG, pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        from (select sum(soluong) soluong,duoc_id,nguonduoc_id,khoduoc_id,benhvien_id from TT_DUOC_TONKHO  group by duoc_id,nguonduoc_id,khoduoc_id,benhvien_id) dtk        inner join TM_DUOC_PHAMVISD_MAPPING pvsd on dtk.KHODUOC_ID = pvsd.KHODUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NOITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) B on B.DUOC_ID = dtk.DUOC_ID and B.SOLUONG > 0 and B.PHAMVI_ID = pvsd.PHAMVI_ID and B.NGUONHANG_ID = dtk.NGUONDUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NGOAITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) A on A.DUOC_ID = dtk.DUOC_ID and A.SOLUONG > 0 and A.PHAMVI_ID = pvsd.PHAMVI_ID and A.NGUONHANG_ID = dtk.NGUONDUOC_ID        where dtk.SOLUONG > 0 and dtk.BENHVIEN_ID = 'HLU01'        group by LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')), pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        ) tk on tk.DUOC_ID = d.DUOC_ID        left join TM_DUOC_PHAMVISUDUNG kd on kd.PHAMVI_ID = tk.PHAMVI_ID and kd.BENHVIEN_ID = 'HLU01'        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = tk.NGUONDUOC_ID and nh.BENHVIEN_ID = 'HLU01'        where d.BENHVIEN_ID = 'HLU01'  and tk.SOLUONG >= 0        end        else        begin                  select  distinct tk.DUOC_KEY, LTRIM(tk.PHAMVI_ID) as PHAMVI_ID, tk.NGUONDUOC_ID, nh.TENNGUONDUOC, nh.TINHTIEN, d.DUOC_ID, ld.MALOAIDUOC,        d.SOVISA,d.TYLE_VAT,d.COTOA, d.MADUOC, d.TENHANG, d.TENDUOCDAYDU, d.DONVITINH as DONVITINH, d.BHYT,        d.TENHOATCHAT, d.HAMLUONG, d.HANGSANXUAT, d.QUOCGIA, d.LOAIDUOC_ID, d.DUONGDUNG_ID, d.TINHTIEN_PTTT,        ten.TENDUOC, ten.TENDUOC_EN, ten.MAQUOCTE, ten.MAQUOCTEBT,d.CONGDUNG,        CASE WHEN d.BHYT = '1' THEN 'BHYT' ELSE '' END as BHYT_TEXT        , ld.LOAIVATTU_ID        , d.BENHVIEN_ID,        tk.SOLUONG, d.VTYT_PHANLOAI, d.PHAMVI, d.SUASOLUONGTONGHOP, d.MADUOCBV, d.DANGTRINHBAY        , TAMNGUNG = CASE WHEN d.TAMNGUNG = '1' OR nh.TAMNGUNG = '1' OR kd.TAMNGUNG = '1' THEN '1' ELSE '0' END        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        inner join        (        select  LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')) DUOC_KEY, (SUM(dtk.SOLUONG) - isnull(sum(A.SOLUONG),0) - isnull(sum(B.SOLUONG),0)) SOLUONG, pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        from (select sum(soluong) soluong,duoc_id,nguonduoc_id,khoduoc_id,benhvien_id from TT_DUOC_TONKHO  group by duoc_id,nguonduoc_id,khoduoc_id,benhvien_id) dtk        inner join TM_DUOC_PHAMVISD_MAPPING pvsd on dtk.KHODUOC_ID = pvsd.KHODUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NOITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) B on B.DUOC_ID = dtk.DUOC_ID and B.SOLUONG > 0 and B.PHAMVI_ID = pvsd.PHAMVI_ID and B.NGUONHANG_ID = dtk.NGUONDUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NGOAITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) A on A.DUOC_ID = dtk.DUOC_ID and A.SOLUONG > 0 and A.PHAMVI_ID = pvsd.PHAMVI_ID and A.NGUONHANG_ID = dtk.NGUONDUOC_ID        where dtk.SOLUONG > 0 and dtk.BENHVIEN_ID = 'HLU01'        group by LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')), pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        ) tk on tk.DUOC_ID = d.DUOC_ID        left join TM_DUOC_PHAMVISUDUNG kd on kd.PHAMVI_ID = tk.PHAMVI_ID and kd.BENHVIEN_ID = 'HLU01'        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = tk.NGUONDUOC_ID and nh.BENHVIEN_ID = 'HLU01'        where d.BENHVIEN_ID = 'HLU01'  and tk.SOLUONG >= 0        end]
2019-12-23 15:46:41,757 [5] DEBUG - Statement Id: [DAO00320_GetList] PreparedStatement : [select M.*            from TM_MAU M            LEFT JOIN TM_MAU_DONVITINH DVT on M.DONVITINH_ID=DVT.DONVITINH_ID            where            M.TAMNGUNG = '0'            and M.BENHVIEN_ID = 'HLU01'            order by M.TENMAU]
2019-12-23 15:46:41,837 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM071']
2019-12-23 15:46:41,869 [5] DEBUG - Statement Id: [DAO00322_GetListMauTonKhoForCreateCached] PreparedStatement : [SELECT DISTINCT        TK.MAU_KEY, TK.KHOMAU_ID, M.MAU_ID, M.MAMAU, M.TENMAU, M.NHOM_ABO, M.NHOM_RH, M.LOAIMAU_ID,        TK.SOLONHAP_ID, SLN.SOLONHAP, SLN.SOKIEMSOAT, TK.NGUONHANG_ID, NG.TENNGUONMAU, M.BENHVIEN_ID, M.DONVITINH_ID,        SUM(tk.SOLUONG) AS SOLUONG,K.TENKHO,DVT.TENDONVITINH        FROM TT_MAU_TONKHO TK        JOIN TM_KHO K ON TK.KHOMAU_ID = K.KHO_ID        JOIN TT_MAU_CHUNGTU_SOLONHAP SLN ON TK.SOLONHAP_ID = SLN.SOLONHAP_ID        JOIN TM_MAU M on TK.MAU_ID = M.MAU_ID and M.TAMNGUNG = '0'        LEFT JOIN TM_MAU_DONVITINH DVT on M.DONVITINH_ID=DVT.DONVITINH_ID        LEFT JOIN TM_NGUONMAU NG ON NG.NGUONMAU_ID = TK.NGUONHANG_ID        WHERE TK.SOLUONG > 0        GROUP BY TK.MAU_KEY, TK.KHOMAU_ID, M.MAU_ID, M.MAMAU, M.TENMAU, M.NHOM_ABO, M.NHOM_RH, M.LOAIMAU_ID,        TK.SOLONHAP_ID, SLN.SOLONHAP, SLN.SOKIEMSOAT,TK.NGUONHANG_ID, NG.TENNGUONMAU, M.BENHVIEN_ID, M.DONVITINH_ID,K.TENKHO,DVT.TENDONVITINH]
2019-12-23 15:46:42,005 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM073']
2019-12-23 15:46:42,037 [5] DEBUG - Statement Id: [DAO00322_GetListMauTonKhoTruBooking] PreparedStatement : [select distinct        TK.MAU_KEY, TK.KHOMAU_ID, M.MAU_ID, M.MAMAU, M.TENMAU, M.NHOM_ABO, M.NHOM_RH, M.LOAIMAU_ID, M.DONVITINH_ID,        TK.SOLONHAP_ID, TK.SOLONHAP, TK.SOKIEMSOAT,M.PHAMVI, TK.NGUONHANG_ID, NG.TENNGUONMAU, M.BENHVIEN_ID,        TK.SOLUONG,TK.TENKHO,DVT.TENDONVITINH        from TM_MAU M        JOIN        (        select        A.MAU_KEY, A.KHOMAU_ID, A.MAU_ID ,a.NGUONHANG_ID, A.SOLONHAP_ID, A.SOLONHAP, A.SOKIEMSOAT, A.SOLUONG,A.TENKHO        from        (        select KHOMAU_ID, TK.MAU_ID, TK.NGUONHANG_ID, TK.MAU_KEY, SLN.SOLONHAP_ID, SLN.SOLONHAP, SLN.SOKIEMSOAT, ISNULL(TK.SOLUONG,0) - ISNULL(book.SOLUONG,0) as SOLUONG,K.TENKHO        from TT_MAU_TONKHO TK        JOIN TM_KHO K ON TK.KHOMAU_ID = K.KHO_ID        inner join TT_MAU_CHUNGTU_SOLONHAP SLN ON TK.SOLONHAP_ID = SLN.SOLONHAP_ID        left join dbo.TT_MAU_TONKHO_BOOK book ON book.MAU_KEY = TK.MAU_KEY AND book.TRANGTHAI = 'HIEULUC'        where ISNULL(TK.SOLUONG,0) - ISNULL(book.SOLUONG,0) > 0        ) A        )TK on TK.MAU_ID = M.MAU_ID and M.TAMNGUNG = '0'        LEFT JOIN TM_MAU_DONVITINH DVT on M.DONVITINH_ID=DVT.DONVITINH_ID        LEFT JOIN TM_NGUONMAU NG ON NG.NGUONMAU_ID = TK.NGUONHANG_ID]
2019-12-23 15:46:42,128 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM072']
2019-12-23 15:46:43,721 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'MAIN'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2019-12-23 15:46:49,395 [1] DEBUG - Statement Id: [DAO00002_FormList] PreparedStatement : [select              TM_SYS_FORM.HOSPITAL_ID,              TM_SYS_FORM.NAME,              TM_SYS_FORM.CLASS,              TM_SYS_FORM.ASSEMBLY,              TM_SYS_FORM.TITLE_VI as TITLE              from TM_SYS_FORM              where HOSPITAL_ID = 'HLU01']
2019-12-23 15:47:00,403 [1] DEBUG - Statement Id: [DAO00300_GetShortcutListByUserID] PreparedStatement : [SELECT S.SHORTCUT_CODE, S.SHORTCUT_VALUE              FROM TM_SHORTCUT AS S              WHERE S.BENHVIEN_ID = 'HLU01' AND S.USER_ID = '1' AND TAMNGUNG = '0']
2019-12-23 15:47:00,536 [1] DEBUG - Statement Id: [DAO00087_GetList] PreparedStatement : [select CODE, VALUE, BENHVIEN_ID              from TM_SYS_APPSETTINGS              where LOCKED = '0' and BENHVIEN_ID = 'HLU01'              order by SETTING_ID]
2019-12-23 15:47:00,624 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'MSG01'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2019-12-23 15:47:00,927 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'MSG02'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2019-12-23 15:47:01,902 [1] DEBUG - Statement Id: [DAO00008_GetUserSettings] PreparedStatement : [select A.*, B.TENKHO , C.TENPHONGBAN, B.MAKHO, C.MAPHONGBAN          from TM_SYS_USERS A          left join TM_KHODUOC B on B.KHODUOC_ID = A.INVENTORY_ID          left join TM_PHONGBAN C on (C.PHONGBAN_ID = A.WORKING_DEPT_ID and C.BENHVIEN_ID =  @param0 )          left join TM_SYS_USERKHO D on (D.ACCOUNT_ID = A.ACCOUNT_ID and D.HOSPITAL_ID =  @param0 )          where          A.HOSPITAL_ID =  @param0            and                 A.ACCOUNT_ID =  @param1]
2019-12-23 15:47:01,941 [1] DEBUG - Statement Id: [DAO00008_GetUserSettings] Parameters: [@param0=[HOSPITAL_ID,HLU01], @param1=[ACCOUNT_ID,113]]
2019-12-23 15:47:01,941 [1] DEBUG - Statement Id: [DAO00008_GetUserSettings] Types: [@param0=[String, System.String], @param1=[String, System.String]]
2019-12-23 15:47:02,031 [1] DEBUG - Statement Id: [DAO00008_GetUserInvSettings] PreparedStatement : [select A.*, B.TENKHO, B.MAKHO, B.LOAIKHO_ID, B.KHOQUANLY_ID          from TM_SYS_USERKHO A          left join TM_KHO B on B.MODULE_ID = A.MODULE_ID and B.KHO_ID = A.KHO_ID          where A.HOSPITAL_ID =  @param0  and A.ACCOUNT_ID =  @param1           order by B.TENKHO]
2019-12-23 15:47:02,031 [1] DEBUG - Statement Id: [DAO00008_GetUserInvSettings] Parameters: [@param0=[HOSPITAL_ID,HLU01], @param1=[ACCOUNT_ID,113]]
2019-12-23 15:47:02,031 [1] DEBUG - Statement Id: [DAO00008_GetUserInvSettings] Types: [@param0=[String, System.String], @param1=[String, System.String]]
2019-12-23 15:47:02,389 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'COM30'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2019-12-23 15:47:02,873 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'RIS04'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2019-12-23 15:47:30,087 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'MENU1'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2019-12-23 15:47:30,279 [1] DEBUG - Statement Id: [DAO00011_GetList] PreparedStatement : [select              TM_SYS_MENU.ID,              TM_SYS_MENU.PARENTID,              TM_SYS_MENU.SCREEN,              TM_SYS_MENU.SMALLIMAGE,              TM_SYS_MENU.LARGEIMAGE,              TM_SYS_MENU.DESCRIPTION,              TM_SYS_MENU.TYPE,              TM_SYS_MENU.TITLE_VI as TITLE              from TM_SYS_MENU              where TM_SYS_MENU.HOSPITAL_ID = 'HLU01' and TM_SYS_MENU.ACTIVE = '1'               AND                   (TM_SYS_MENU.TYPE & '8' = '8')                             order by TM_SYS_MENU.ORDERNUM]
2019-12-23 15:47:30,817 [1] DEBUG - Statement Id: [DAO00011_usermenu_list] PreparedStatement : [select              TM_SYS_HOMEMENU.MENUID as ID,              TM_SYS_MENU.TITLE_VI as TITLE,              TM_SYS_MENU.SCREEN,              TM_SYS_MENU.SMALLIMAGE,              TM_SYS_MENU.LARGEIMAGE,              TM_SYS_MENU.TYPE              from TM_SYS_HOMEMENU              left join TM_SYS_MENU on TM_SYS_MENU.ID = TM_SYS_HOMEMENU.MENUID and TM_SYS_MENU.HOSPITAL_ID = TM_SYS_HOMEMENU.HOSPITAL_ID              where TM_SYS_HOMEMENU.HOSPITAL_ID = 'HLU01' and TM_SYS_HOMEMENU.USERID = '113' and TM_SYS_MENU.ACTIVE = '1'               AND                   (TM_SYS_MENU.TYPE & '8' = '8')                             ORDER BY TM_SYS_HOMEMENU.ORDERNUM]
2019-12-23 15:47:38,259 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'COM98'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2019-12-23 15:47:39,205 [1] DEBUG - Statement Id: [DAO00020_ListKhoDuocOfPhongBan] PreparedStatement : [select B.* from TM_PHONGBAN_KHODUOC A        inner join TM_KHODUOC B on B.KHODUOC_ID = A.KHODUOC_ID        where        A.PHONGBAN_ID = '32'        and A.BENHVIEN_ID = 'HLU01']
2019-12-23 15:47:48,969 [1] DEBUG - Statement Id: [DAO00020_ListKhoDuocOfPhongBan] PreparedStatement : [select B.* from TM_PHONGBAN_KHODUOC A        inner join TM_KHODUOC B on B.KHODUOC_ID = A.KHODUOC_ID        where        A.PHONGBAN_ID = ''        and A.BENHVIEN_ID = 'HLU01']
2019-12-23 15:47:50,990 [1] DEBUG - Statement Id: [DAO00020_ListKhoDuocOfPhongBan] PreparedStatement : [select B.* from TM_PHONGBAN_KHODUOC A        inner join TM_KHODUOC B on B.KHODUOC_ID = A.KHODUOC_ID        where        A.PHONGBAN_ID = '32'        and A.BENHVIEN_ID = 'HLU01']
2019-12-23 15:48:04,213 [1] DEBUG - Statement Id: [DAO00020_ListKhoDuocOfPhongBan] PreparedStatement : [select B.* from TM_PHONGBAN_KHODUOC A        inner join TM_KHODUOC B on B.KHODUOC_ID = A.KHODUOC_ID        where        A.PHONGBAN_ID = ''        and A.BENHVIEN_ID = 'HLU01']
2019-12-23 15:48:09,044 [1] DEBUG - Statement Id: [DAO00020_ListKhoDuocOfPhongBan] PreparedStatement : [select B.* from TM_PHONGBAN_KHODUOC A        inner join TM_KHODUOC B on B.KHODUOC_ID = A.KHODUOC_ID        where        A.PHONGBAN_ID = '38'        and A.BENHVIEN_ID = 'HLU01']
2019-12-23 15:48:18,030 [1] DEBUG - Statement Id: [DAO00008_UpdateUserIdPhongBanKhoDuoc] PreparedStatement : [IF EXISTS            (SELECT ACCOUNT_ID FROM TM_SYS_USERS WHERE ACCOUNT_ID =  @param0  and HOSPITAL_ID =  @param1 )            BEGIN            update TM_SYS_USERS set INVENTORY_ID =  @param2 , WORKING_DEPT_ID =  @param3             WHERE ACCOUNT_ID =  @param0  and HOSPITAL_ID =  @param1             END            ELSE            BEGIN            insert into TM_SYS_USERS ([ACCOUNT_ID], [ACCOUNT_NAME], [INVENTORY_ID], [WORKING_DEPT_ID], [HOSPITAL_ID])            values ( @param0 ,  @param4 ,  @param2 ,  @param3 ,  @param1 )            END]
2019-12-23 15:48:18,031 [1] DEBUG - Statement Id: [DAO00008_UpdateUserIdPhongBanKhoDuoc] Parameters: [@param0=[ACCOUNT_ID,113], @param1=[HOSPITAL_ID,HLU01], @param2=[INVENTORY_ID,9], @param3=[WORKING_DEPT_ID,38], @param4=[ACCOUNT_NAME,admin]]
2019-12-23 15:48:18,031 [1] DEBUG - Statement Id: [DAO00008_UpdateUserIdPhongBanKhoDuoc] Types: [@param0=[String, System.String], @param1=[String, System.String], @param2=[String, System.String], @param3=[String, System.String], @param4=[String, System.String]]
2019-12-23 15:48:24,341 [1] DEBUG - Statement Id: [DAO00087_GetServiceParams] PreparedStatement : [select CODE, VALUE              from TM_SYS_APPSETTINGS              where LOCKED = '0' and BENHVIEN_ID = 'HLU01']
2019-12-23 15:48:24,715 [1] DEBUG - Statement Id: [DAO00030_GetMucDichChungTuID] PreparedStatement : [SELECT DICTIONARY_ID              FROM              LST_DICTIONARY              WHERE              DICTIONARY_TYPE_CODE = 'MucDichChungTu'              and DICTIONARY_CODE = 'X08']
2019-12-23 15:48:25,046 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'PHA18'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2019-12-23 15:48:26,653 [1] DEBUG - Statement Id: [DAO00030_GET_SOLONHAP_BANGGIA] PreparedStatement : [SELECT DISTINCT            SLN.SOLONHAP_ID, SLN.SOLONHAP, SLN.SOLOSANPHAM, SLN.SOKIEMSOAT, SLN.SOVISA, CONVERT(varchar(20), SLN.SOLOSANPHAM) + '/' + CONVERT(varchar(20), TK.SOLUONG) AS SOLOSOTON,            SLN.NGAYNHAP AS NGAYNHAPLO, SLN.HANDUNG AS HANSUDUNG,  SLN.HANDUNG, SLN.NGUONDUOC_ID, SLN.NGUONDUOC_ID as NGUONHANG_ID,            SLNGB.DONGIAMUA, SLNGB.DONGIAVON, SLNGB.TYLEVAT_DAUVAO as TYLEVAT, d.TYLE_VAT, SLNGB.DONGIAVONVAT,            dg.DONGIA AS DONGIABAN, dg.DONGIA AS DONGIABAN_VAT,            TK.KHODUOC_ID, TK.DUOC_ID, TK.SOLUONG, TK.SOLUONG AS SOLUONGTON,            D.TENDUOCDAYDU,D.DONVITINH_ID, D.DONVITINH, D.BHYT, NH.TENNGUONDUOC AS NGUONHANG            FROM            TT_DUOC_CHUNGTU_SOLONHAP SLN            INNER JOIN TT_DUOC_TONKHO TK on SLN.SOLONHAP_ID = TK.SOLONHAP_ID            INNER JOIN TT_DUOC_SOLONHAP_GIABAN SLNGB on SLN.SOLONHAP_ID = SLNGB.SOLONHAP_ID            INNER JOIN TM_NGUONHANG NH on SLN.NGUONDUOC_ID = NH.NGUONDUOC_ID            INNER JOIN TM_DUOC D on SLN.DUOC_ID = D.DUOC_ID            INNER JOIN TM_DUOC_DONGIA dg on dg.DUOC_ID = SLN.DUOC_ID            INNER JOIN TM_LOAIGIA lg on (lg.LOAIGIA_ID = dg.LOAIGIA_ID AND lg.MALOAIGIA = 'Gianhathuoc')            WHERE            SLN.DUOC_ID = ''            AND TK.KHODUOC_ID = ''            AND SLN.BENHVIEN_ID = 'HLU01'            AND TK.SOLUONG > 0                 and                     SLN.NGUONDUOC_ID = '1'                                      ORDER BY NGAYNHAP]
2019-12-23 15:48:26,999 [1] DEBUG - Statement Id: [DAO00030_GetMucDichChungTuID] PreparedStatement : [SELECT DICTIONARY_ID              FROM              LST_DICTIONARY              WHERE              DICTIONARY_TYPE_CODE = 'MucDichChungTu'              and DICTIONARY_CODE = 'X08']
2019-12-23 15:48:28,362 [1] DEBUG - Statement Id: [DAO00030_GetKhoDuocDoiTuong] PreparedStatement : [select kd.* from TM_DOITUONG_KHODUOC kd              inner join TM_DOITUONG dt on dt.DOITUONG_ID = kd.DOITUONG_ID              WHERE              kd.NGAYTRONGTUAN = '2'                          and dt.MADOITUONG = 'VP'              and kd.KHODUOC_ID = '9'              and kd.BENHVIEN_ID = 'HLU01']
2019-12-23 15:48:28,536 [1] DEBUG - Statement Id: [DAO00030_GetPhamViByKhoDuoc] PreparedStatement : [SELECT DISTINCT pv.PHAMVI_ID          FROM TM_DUOC_PHAMVISD_MAPPING mp          INNER JOIN TM_DUOC_PHAMVISUDUNG pv ON mp.PHAMVI_ID = pv.PHAMVI_ID          WHERE          mp.KHODUOC_ID IN (9)          AND mp.BENHVIEN_ID ='HLU01'          AND mp.TAMNGUNG = '0'          AND pv.TAMNGUNG = '0']
2019-12-23 15:48:28,796 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'PHA85'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2019-12-23 15:49:08,521 [1] DEBUG - Statement Id: [DAO00030_GET_SOLONHAP_BANGGIA] PreparedStatement : [SELECT DISTINCT            SLN.SOLONHAP_ID, SLN.SOLONHAP, SLN.SOLOSANPHAM, SLN.SOKIEMSOAT, SLN.SOVISA, CONVERT(varchar(20), SLN.SOLOSANPHAM) + '/' + CONVERT(varchar(20), TK.SOLUONG) AS SOLOSOTON,            SLN.NGAYNHAP AS NGAYNHAPLO, SLN.HANDUNG AS HANSUDUNG,  SLN.HANDUNG, SLN.NGUONDUOC_ID, SLN.NGUONDUOC_ID as NGUONHANG_ID,            SLNGB.DONGIAMUA, SLNGB.DONGIAVON, SLNGB.TYLEVAT_DAUVAO as TYLEVAT, d.TYLE_VAT, SLNGB.DONGIAVONVAT,            dg.DONGIA AS DONGIABAN, dg.DONGIA AS DONGIABAN_VAT,            TK.KHODUOC_ID, TK.DUOC_ID, TK.SOLUONG, TK.SOLUONG AS SOLUONGTON,            D.TENDUOCDAYDU,D.DONVITINH_ID, D.DONVITINH, D.BHYT, NH.TENNGUONDUOC AS NGUONHANG            FROM            TT_DUOC_CHUNGTU_SOLONHAP SLN            INNER JOIN TT_DUOC_TONKHO TK on SLN.SOLONHAP_ID = TK.SOLONHAP_ID            INNER JOIN TT_DUOC_SOLONHAP_GIABAN SLNGB on SLN.SOLONHAP_ID = SLNGB.SOLONHAP_ID            INNER JOIN TM_NGUONHANG NH on SLN.NGUONDUOC_ID = NH.NGUONDUOC_ID            INNER JOIN TM_DUOC D on SLN.DUOC_ID = D.DUOC_ID            INNER JOIN TM_DUOC_DONGIA dg on dg.DUOC_ID = SLN.DUOC_ID            INNER JOIN TM_LOAIGIA lg on (lg.LOAIGIA_ID = dg.LOAIGIA_ID AND lg.MALOAIGIA = 'Gianhathuoc')            WHERE            SLN.DUOC_ID = '1207'            AND TK.KHODUOC_ID = '9'            AND SLN.BENHVIEN_ID = 'HLU01'            AND TK.SOLUONG > 0                 and                     SLN.NGUONDUOC_ID = '1'                                      ORDER BY NGAYNHAP]
2019-12-23 15:49:18,206 [1] DEBUG - Statement Id: [DAO00030_GET_SOLONHAP_BANGGIA] PreparedStatement : [SELECT DISTINCT            SLN.SOLONHAP_ID, SLN.SOLONHAP, SLN.SOLOSANPHAM, SLN.SOKIEMSOAT, SLN.SOVISA, CONVERT(varchar(20), SLN.SOLOSANPHAM) + '/' + CONVERT(varchar(20), TK.SOLUONG) AS SOLOSOTON,            SLN.NGAYNHAP AS NGAYNHAPLO, SLN.HANDUNG AS HANSUDUNG,  SLN.HANDUNG, SLN.NGUONDUOC_ID, SLN.NGUONDUOC_ID as NGUONHANG_ID,            SLNGB.DONGIAMUA, SLNGB.DONGIAVON, SLNGB.TYLEVAT_DAUVAO as TYLEVAT, d.TYLE_VAT, SLNGB.DONGIAVONVAT,            dg.DONGIA AS DONGIABAN, dg.DONGIA AS DONGIABAN_VAT,            TK.KHODUOC_ID, TK.DUOC_ID, TK.SOLUONG, TK.SOLUONG AS SOLUONGTON,            D.TENDUOCDAYDU,D.DONVITINH_ID, D.DONVITINH, D.BHYT, NH.TENNGUONDUOC AS NGUONHANG            FROM            TT_DUOC_CHUNGTU_SOLONHAP SLN            INNER JOIN TT_DUOC_TONKHO TK on SLN.SOLONHAP_ID = TK.SOLONHAP_ID            INNER JOIN TT_DUOC_SOLONHAP_GIABAN SLNGB on SLN.SOLONHAP_ID = SLNGB.SOLONHAP_ID            INNER JOIN TM_NGUONHANG NH on SLN.NGUONDUOC_ID = NH.NGUONDUOC_ID            INNER JOIN TM_DUOC D on SLN.DUOC_ID = D.DUOC_ID            INNER JOIN TM_DUOC_DONGIA dg on dg.DUOC_ID = SLN.DUOC_ID            INNER JOIN TM_LOAIGIA lg on (lg.LOAIGIA_ID = dg.LOAIGIA_ID AND lg.MALOAIGIA = 'Gianhathuoc')            WHERE            SLN.DUOC_ID = '1207'            AND TK.KHODUOC_ID = '9'            AND SLN.BENHVIEN_ID = 'HLU01'            AND TK.SOLUONG > 0                 and                     SLN.NGUONDUOC_ID = '1'                                      ORDER BY NGAYNHAP]
2019-12-23 15:49:32,734 [1] DEBUG - Statement Id: [DAO00030_GET_SOLONHAP_BANGGIA] PreparedStatement : [SELECT DISTINCT            SLN.SOLONHAP_ID, SLN.SOLONHAP, SLN.SOLOSANPHAM, SLN.SOKIEMSOAT, SLN.SOVISA, CONVERT(varchar(20), SLN.SOLOSANPHAM) + '/' + CONVERT(varchar(20), TK.SOLUONG) AS SOLOSOTON,            SLN.NGAYNHAP AS NGAYNHAPLO, SLN.HANDUNG AS HANSUDUNG,  SLN.HANDUNG, SLN.NGUONDUOC_ID, SLN.NGUONDUOC_ID as NGUONHANG_ID,            SLNGB.DONGIAMUA, SLNGB.DONGIAVON, SLNGB.TYLEVAT_DAUVAO as TYLEVAT, d.TYLE_VAT, SLNGB.DONGIAVONVAT,            dg.DONGIA AS DONGIABAN, dg.DONGIA AS DONGIABAN_VAT,            TK.KHODUOC_ID, TK.DUOC_ID, TK.SOLUONG, TK.SOLUONG AS SOLUONGTON,            D.TENDUOCDAYDU,D.DONVITINH_ID, D.DONVITINH, D.BHYT, NH.TENNGUONDUOC AS NGUONHANG            FROM            TT_DUOC_CHUNGTU_SOLONHAP SLN            INNER JOIN TT_DUOC_TONKHO TK on SLN.SOLONHAP_ID = TK.SOLONHAP_ID            INNER JOIN TT_DUOC_SOLONHAP_GIABAN SLNGB on SLN.SOLONHAP_ID = SLNGB.SOLONHAP_ID            INNER JOIN TM_NGUONHANG NH on SLN.NGUONDUOC_ID = NH.NGUONDUOC_ID            INNER JOIN TM_DUOC D on SLN.DUOC_ID = D.DUOC_ID            INNER JOIN TM_DUOC_DONGIA dg on dg.DUOC_ID = SLN.DUOC_ID            INNER JOIN TM_LOAIGIA lg on (lg.LOAIGIA_ID = dg.LOAIGIA_ID AND lg.MALOAIGIA = 'Gianhathuoc')            WHERE            SLN.DUOC_ID = '1013'            AND TK.KHODUOC_ID = '9'            AND SLN.BENHVIEN_ID = 'HLU01'            AND TK.SOLUONG > 0                 and                     SLN.NGUONDUOC_ID = '1'                                      ORDER BY NGAYNHAP]
2019-12-23 15:49:38,262 [1] DEBUG - Statement Id: [DAO00030_GET_SOLONHAP_BANGGIA] PreparedStatement : [SELECT DISTINCT            SLN.SOLONHAP_ID, SLN.SOLONHAP, SLN.SOLOSANPHAM, SLN.SOKIEMSOAT, SLN.SOVISA, CONVERT(varchar(20), SLN.SOLOSANPHAM) + '/' + CONVERT(varchar(20), TK.SOLUONG) AS SOLOSOTON,            SLN.NGAYNHAP AS NGAYNHAPLO, SLN.HANDUNG AS HANSUDUNG,  SLN.HANDUNG, SLN.NGUONDUOC_ID, SLN.NGUONDUOC_ID as NGUONHANG_ID,            SLNGB.DONGIAMUA, SLNGB.DONGIAVON, SLNGB.TYLEVAT_DAUVAO as TYLEVAT, d.TYLE_VAT, SLNGB.DONGIAVONVAT,            dg.DONGIA AS DONGIABAN, dg.DONGIA AS DONGIABAN_VAT,            TK.KHODUOC_ID, TK.DUOC_ID, TK.SOLUONG, TK.SOLUONG AS SOLUONGTON,            D.TENDUOCDAYDU,D.DONVITINH_ID, D.DONVITINH, D.BHYT, NH.TENNGUONDUOC AS NGUONHANG            FROM            TT_DUOC_CHUNGTU_SOLONHAP SLN            INNER JOIN TT_DUOC_TONKHO TK on SLN.SOLONHAP_ID = TK.SOLONHAP_ID            INNER JOIN TT_DUOC_SOLONHAP_GIABAN SLNGB on SLN.SOLONHAP_ID = SLNGB.SOLONHAP_ID            INNER JOIN TM_NGUONHANG NH on SLN.NGUONDUOC_ID = NH.NGUONDUOC_ID            INNER JOIN TM_DUOC D on SLN.DUOC_ID = D.DUOC_ID            INNER JOIN TM_DUOC_DONGIA dg on dg.DUOC_ID = SLN.DUOC_ID            INNER JOIN TM_LOAIGIA lg on (lg.LOAIGIA_ID = dg.LOAIGIA_ID AND lg.MALOAIGIA = 'Gianhathuoc')            WHERE            SLN.DUOC_ID = '1013'            AND TK.KHODUOC_ID = '9'            AND SLN.BENHVIEN_ID = 'HLU01'            AND TK.SOLUONG > 0                 and                     SLN.NGUONDUOC_ID = '1'                                      ORDER BY NGAYNHAP]
2019-12-23 15:49:57,071 [1] DEBUG - Statement Id: [DAO00030_DUOCTONKHO_GetSoTonTheoDuoc] PreparedStatement : [SELECT              DUOC_ID,              SUM(SOLUONG) AS TONGTON              FROM              TT_DUOC_TONKHO              WHERE              KHODUOC_ID = '9'              and BENHVIEN_ID = 'HLU01'              and DUOC_ID IN (1013)              GROUP BY DUOC_ID]
2019-12-23 15:49:59,159 [1] DEBUG - Statement Id: [DAO00030_DUOCTONKHO_GetSoTonTheoDuocTheoLo] PreparedStatement : [SELECT              DUOC_ID,SOLONHAP_ID,              SUM(SOLUONG) AS SOLUONGTONLO              FROM              TT_DUOC_TONKHO              WHERE              KHODUOC_ID = '9'              and BENHVIEN_ID = 'HLU01'              and DUOC_ID IN (1013)              and SOLONHAP_ID IN (1648)              GROUP BY DUOC_ID, SOLONHAP_ID]
2019-12-23 15:49:59,254 [1] DEBUG - Statement Id: [DAO00030_LayNgayKhoaSoCuoi] PreparedStatement : [SELECT TOP 1 KHOADENNGAY              FROM TT_DUOC_KHOASOCHUNGTU              WHERE              KHODUOC_ID = '9'              and BENHVIEN_ID = 'HLU01'              and KHOASO = '1'              ORDER BY KHOADENNGAY DESC]
2019-12-23 15:49:59,773 [1] DEBUG - Statement Id: [DAO00036_GetDetail] PreparedStatement : [select KEYTYPE, KEYYEAR, KEYMONTH, KEYDAY, SEGMENT_1, SEGMENT_2, SEGMENT_3, KEYVALUE              from LST_KEYDATA_DUOCPHAM as kd               WHERE                        kd.KEYTYPE = 'SOCHUNGTUNHAPXUATBENNGOAI'                   AND                       kd.KEYYEAR = '2019'                   AND                       kd.KEYMONTH = '12'                   AND                       kd.KEYDAY = '0'                   AND                       kd.SEGMENT_1 = 'KHO_NT'                   AND                       kd.SEGMENT_2 = 'X08'                   AND                       kd.SEGMENT_3 = ' ']
2019-12-23 15:50:00,118 [1] DEBUG - Statement Id: [DAO00036_Add] PreparedStatement : [insert into LST_KEYDATA_DUOCPHAM (            KEYTYPE            , KEYYEAR            , KEYMONTH            , KEYDAY            , SEGMENT_1            , SEGMENT_2            , SEGMENT_3            , KEYVALUE            , BENHVIEN_ID            ) values (             @param0             ,  @param1             ,  @param2             ,  @param3             ,  @param4             ,  @param5             ,  @param6             ,  @param7             ,  @param8             )]
2019-12-23 15:50:00,118 [1] DEBUG - Statement Id: [DAO00036_Add] Parameters: [@param0=[KEYTYPE,SOCHUNGTUNHAPXUATBENNGOAI], @param1=[KEYYEAR,2019], @param2=[KEYMONTH,12], @param3=[KEYDAY,0], @param4=[SEGMENT_1,KHO_NT], @param5=[SEGMENT_2,X08], @param6=[SEGMENT_3, ], @param7=[KEYVALUE,000001], @param8=[BENHVIEN_ID,HLU01]]
2019-12-23 15:50:00,118 [1] DEBUG - Statement Id: [DAO00036_Add] Types: [@param0=[String, System.String], @param1=[Int32, System.Int32], @param2=[Int32, System.Int32], @param3=[Int32, System.Int32], @param4=[String, System.String], @param5=[String, System.String], @param6=[String, System.String], @param7=[String, System.String], @param8=[String, System.String]]
2019-12-23 15:50:00,166 [1] DEBUG - Statement Id: [DAO00030_TT_NGOAITRU_TOATHUOC_NGUOIMUA_Add] PreparedStatement : [INSERT INTO TT_NGOAITRU_TOATHUOC_NGUOIMUA            (            TENNGUOIMUA            ,HO            ,TEN            ,GIOITINH            ,NGAYSINH            ,NAMSINH            ,SODIENTHOAI            ,SONHA            ,DIACHI            ,DIACHICOQUAN            ,TINHTHANH_ID            ,QUANHUYEN_ID            ,XAPHUONG_ID            ,NGHENGHIEP_ID            ,QUOCTICH_ID            ,DANTOC_ID            ,BENHVIEN_ID            ,NGAYTAO            ,NGUOITAO_ID            ,NGAYCAPNHAT            ,NGUOICAPNHAT_ID            ,BACSIKEDON            ,CHANDOAN            )            VALUES            (             @param0             , @param1             , @param2             , @param3             , @param4             , @param5             , @param6             , @param7             , @param8             , @param9             , @param10             , @param11             , @param12             , @param13             , @param14             , @param15             , @param16             , @param17             , @param18             , @param19             , @param20             , @param21             , @param22             )            select SCOPE_identity() as value]
2019-12-23 15:50:00,166 [1] DEBUG - Statement Id: [DAO00030_TT_NGOAITRU_TOATHUOC_NGUOIMUA_Add] Parameters: [@param0=[TENNGUOIMUA,test bán thuốc], @param1=[HO,null], @param2=[TEN,null], @param3=[GIOITINH,1], @param4=[NGAYSINH,3/3/1990 12:00:00 AM], @param5=[NAMSINH,1990], @param6=[SODIENTHOAI,null], @param7=[SONHA,null], @param8=[DIACHI,], @param9=[DIACHICOQUAN,null], @param10=[TINHTHANH_ID,null], @param11=[QUANHUYEN_ID,null], @param12=[XAPHUONG_ID,14797], @param13=[NGHENGHIEP_ID,null], @param14=[QUOCTICH_ID,null], @param15=[DANTOC_ID,null], @param16=[BENHVIEN_ID,HLU01], @param17=[NGAYTAO,12/23/2019 3:50:00 PM], @param18=[NGUOITAO_ID,null], @param19=[NGAYCAPNHAT,12/23/2019 3:50:00 PM], @param20=[NGUOICAPNHAT_ID,null], @param21=[BACSIKEDON,null], @param22=[CHANDOAN,null]]
2019-12-23 15:50:00,166 [1] DEBUG - Statement Id: [DAO00030_TT_NGOAITRU_TOATHUOC_NGUOIMUA_Add] Types: [@param0=[String, System.String], @param1=[System.DBNull, null], @param2=[System.DBNull, null], @param3=[String, System.String], @param4=[DateTime, System.DateTime], @param5=[Int64, System.Int64], @param6=[System.DBNull, null], @param7=[System.DBNull, null], @param8=[String, System.String], @param9=[System.DBNull, null], @param10=[System.DBNull, null], @param11=[System.DBNull, null], @param12=[String, System.String], @param13=[System.DBNull, null], @param14=[System.DBNull, null], @param15=[System.DBNull, null], @param16=[String, System.String], @param17=[DateTime, System.DateTime], @param18=[System.DBNull, null], @param19=[DateTime, System.DateTime], @param20=[System.DBNull, null], @param21=[System.DBNull, null], @param22=[System.DBNull, null]]
2019-12-23 15:50:01,134 [1] DEBUG - Statement Id: [DAO00030_Add] PreparedStatement : [insert into TT_DUOC_CHUNGTU (              MACHUNGTU              , SOCHUNGTU              , NGAYCHUNGTU              , LOAICHUNGTU              , MUCDICHCHUNGTU_ID              , MUCDICHCHUNGTU_CODE              , KHOXUAT_ID              , NGUOIGIAO_ID              , NGUOIGIAO              , KHONHAP_ID              , NGUOINHAN_ID              , NGUOINHAN              , NGUOIKIEMTRA_ID              , NGUOIKIEMTRA              , NGUOIDUYET_ID              , NGUOIDUYET              , PHUONGPHAPXUAT              , KETOANTRUONG_ID              , KETOANTRUONG              , THUKHO_ID              , THUKHO              , MAUHOADON              , SOHOADON              , SOSERI              , NGAYHOADON              , DIENGIAI              , GIATRI              , GIATRITHANHTOAN              , TYLEVAT              , GIATRIVAT              , THUESUAT              , GIATRITHUE              , TYLECHIETKHAU              , GIATRICHIETKHAU              , TIENTE_ID              , TYGIA              , SOCHUNGTUGOC              , NGAYCHUNGTUGOC              , NHACUNGCAP_ID              , HINHTHUCTHANHTOAN_ID              , NGUONDUOC_ID              , CHUNGTULIENQUAN_ID              , KHAMBENH_ID              , TOATHUOCNOITRU_ID              , TIEPNHAN_ID              , BENHAN_ID              , DANHANTHUOC              , NGUOINHAP_ID              , NGAYNHAP              , TRANGTHAI              , LOAITOATHUOC              , PHIEULINH_ID              , DIENGIAINGHIEPVUPHATSINH              , DONVIGIAO_ID              , KHOSUDUNG_ID              , LOAIVATTU_ID              , BENHNHAN_ID              , NGOAITRU_TOATHUOC_NGUOIMUA_ID              , TENBENHNHAN              , BACSIGIOITHIEU_ID              , DOITUONG_ID              , IDCHUYEN              , CHUNGTUKETOAN              , STATUS              , TRANSFER_VIENPHI_ID              , PHONGBAN_ID              , BACSI_ID              , TKNO              , TKCO              , MACHUNGTUREF              , LOAICHUNGTUREF              , PHIEULINHCANTRU_ID              , KHOTHUCHIEN_ID              , KHODOIUNG_ID              , MENU_LOAIDUOC_ID              , NGUOISUDUNGMAY_ID              , GOITHAU_ID              , XUATTHUOCBANGOAITRU              , NGAYGIOCHUNGTU              , NOIDAKHAM              , HOIDONGKIEMNHAP_ID              , HOIDONGTHANHLY_ID              , CHUYENCHUNGTUID              , CHUYENDOANHTHUID              , LYDOXUATSUDUNG_ID              , BENHVIEN_ID              , NGAYTAO              , NGUOITAO_ID              , NGAYCAPNHAT              , NGUOICAPNHAT_ID              ) values (               @param0               ,  @param1               ,  @param2               ,  @param3               ,  @param4               ,  @param5               ,  @param6               ,  @param7               ,  @param8               ,  @param9               ,  @param10               ,  @param11               ,  @param12               ,  @param13               ,  @param14               ,  @param15               ,  @param16               ,  @param17               ,  @param18               ,  @param19               ,  @param20               ,  @param21               ,  @param22               ,  @param23               ,  @param24               ,  @param25               ,  @param26               ,  @param27               ,  @param28               ,  @param29               ,  @param30               ,  @param31               ,  @param32               ,  @param33               ,  @param34               ,  @param35               ,  @param36               ,  @param37               ,  @param38               ,  @param39               ,  @param40               ,  @param41               ,  @param42               ,  @param43               ,  @param44               ,  @param45               ,  @param46               ,  @param47               ,  @param48               ,  @param49               ,  @param50               ,  @param51               ,  @param52               ,  @param53               ,  @param54               ,  @param55               ,  @param56               ,  @param57               ,  @param58               ,  @param59               ,  @param60               ,  @param61               ,  @param62               ,  @param63               ,  @param64               ,  @param65               ,  @param66               ,  @param67               ,  @param68               ,  @param69               ,  @param70               ,  @param71               ,  @param72               ,  @param73               ,  @param74               ,  @param75               ,  @param76               ,  @param77               ,  @param78               ,  @param79               ,  @param80               ,  @param81               ,  @param82               ,  @param83               ,  @param84               ,  @param85               ,  @param2               ,  @param86               ,  @param87               ,  @param88               )              select SCOPE_identity() as value]
2019-12-23 15:50:01,134 [1] DEBUG - Statement Id: [DAO00030_Add] Parameters: [@param0=[MACHUNGTU,KHO_NTX081912000001], @param1=[SOCHUNGTU,000001], @param2=[NGAYCHUNGTU,12/23/2019 3:50:01 PM], @param3=[LOAICHUNGTU,X], @param4=[MUCDICHCHUNGTU_ID,827], @param5=[MUCDICHCHUNGTU_CODE,X08], @param6=[KHOXUAT_ID,9], @param7=[NGUOIGIAO_ID,1], @param8=[NGUOIGIAO,null], @param9=[KHONHAP_ID,null], @param10=[NGUOINHAN_ID,null], @param11=[NGUOINHAN,null], @param12=[NGUOIKIEMTRA_ID,null], @param13=[NGUOIKIEMTRA,null], @param14=[NGUOIDUYET_ID,null], @param15=[NGUOIDUYET,null], @param16=[PHUONGPHAPXUAT,0], @param17=[KETOANTRUONG_ID,null], @param18=[KETOANTRUONG,null], @param19=[THUKHO_ID,null], @param20=[THUKHO,null], @param21=[MAUHOADON,null], @param22=[SOHOADON,null], @param23=[SOSERI,null], @param24=[NGAYHOADON,null], @param25=[DIENGIAI,test], @param26=[GIATRI,100000], @param27=[GIATRITHANHTOAN,null], @param28=[TYLEVAT,0], @param29=[GIATRIVAT,0], @param30=[THUESUAT,null], @param31=[GIATRITHUE,null], @param32=[TYLECHIETKHAU,null], @param33=[GIATRICHIETKHAU,null], @param34=[TIENTE_ID,null], @param35=[TYGIA,null], @param36=[SOCHUNGTUGOC,null], @param37=[NGAYCHUNGTUGOC,null], @param38=[NHACUNGCAP_ID,null], @param39=[HINHTHUCTHANHTOAN_ID,null], @param40=[NGUONDUOC_ID,1], @param41=[CHUNGTULIENQUAN_ID,null], @param42=[KHAMBENH_ID,null], @param43=[TOATHUOCNOITRU_ID,null], @param44=[TIEPNHAN_ID,null], @param45=[BENHAN_ID,null], @param46=[DANHANTHUOC,0], @param47=[NGUOINHAP_ID,null], @param48=[NGAYNHAP,null], @param49=[TRANGTHAI,CHUATHANHTOAN], @param50=[LOAITOATHUOC,TBN], @param51=[PHIEULINH_ID,null], @param52=[DIENGIAINGHIEPVUPHATSINH,null], @param53=[DONVIGIAO_ID,null], @param54=[KHOSUDUNG_ID,null], @param55=[LOAIVATTU_ID,null], @param56=[BENHNHAN_ID,null], @param57=[NGOAITRU_TOATHUOC_NGUOIMUA_ID,3789], @param58=[TENBENHNHAN,test bán thuốc], @param59=[BACSIGIOITHIEU_ID,null], @param60=[DOITUONG_ID,null], @param61=[IDCHUYEN,null], @param62=[CHUNGTUKETOAN,null], @param63=[STATUS,null], @param64=[TRANSFER_VIENPHI_ID,null], @param65=[PHONGBAN_ID,38], @param66=[BACSI_ID,null], @param67=[TKNO,null], @param68=[TKCO,null], @param69=[MACHUNGTUREF,null], @param70=[LOAICHUNGTUREF,null], @param71=[PHIEULINHCANTRU_ID,null], @param72=[KHOTHUCHIEN_ID,null], @param73=[KHODOIUNG_ID,null], @param74=[MENU_LOAIDUOC_ID,null], @param75=[NGUOISUDUNGMAY_ID,null], @param76=[GOITHAU_ID,null], @param77=[XUATTHUOCBANGOAITRU,null], @param78=[NGAYGIOCHUNGTU,null], @param79=[NOIDAKHAM,null], @param80=[HOIDONGKIEMNHAP_ID,null], @param81=[HOIDONGTHANHLY_ID,null], @param82=[CHUYENCHUNGTUID,null], @param83=[CHUYENDOANHTHUID,null], @param84=[LYDOXUATSUDUNG_ID,null], @param85=[BENHVIEN_ID,HLU01], @param86=[NGUOITAO_ID,1], @param87=[NGAYCAPNHAT,12/23/2019 3:50:01 PM], @param88=[NGUOICAPNHAT_ID,1]]
2019-12-23 15:50:01,134 [1] DEBUG - Statement Id: [DAO00030_Add] Types: [@param0=[String, System.String], @param1=[String, System.String], @param2=[DateTime, System.DateTime], @param3=[String, System.String], @param4=[Int64, System.Int64], @param5=[String, System.String], @param6=[Int64, System.Int64], @param7=[Int64, System.Int64], @param8=[System.DBNull, null], @param9=[System.DBNull, null], @param10=[System.DBNull, null], @param11=[System.DBNull, null], @param12=[System.DBNull, null], @param13=[System.DBNull, null], @param14=[System.DBNull, null], @param15=[System.DBNull, null], @param16=[Int64, System.Int64], @param17=[System.DBNull, null], @param18=[System.DBNull, null], @param19=[System.DBNull, null], @param20=[System.DBNull, null], @param21=[System.DBNull, null], @param22=[System.DBNull, null], @param23=[System.DBNull, null], @param24=[System.DBNull, null], @param25=[String, System.String], @param26=[Double, System.Double], @param27=[System.DBNull, null], @param28=[Double, System.Double], @param29=[Double, System.Double], @param30=[System.DBNull, null], @param31=[System.DBNull, null], @param32=[System.DBNull, null], @param33=[System.DBNull, null], @param34=[System.DBNull, null], @param35=[System.DBNull, null], @param36=[System.DBNull, null], @param37=[System.DBNull, null], @param38=[System.DBNull, null], @param39=[System.DBNull, null], @param40=[Int64, System.Int64], @param41=[System.DBNull, null], @param42=[System.DBNull, null], @param43=[System.DBNull, null], @param44=[System.DBNull, null], @param45=[System.DBNull, null], @param46=[String, System.String], @param47=[System.DBNull, null], @param48=[System.DBNull, null], @param49=[String, System.String], @param50=[String, System.String], @param51=[System.DBNull, null], @param52=[System.DBNull, null], @param53=[System.DBNull, null], @param54=[System.DBNull, null], @param55=[System.DBNull, null], @param56=[System.DBNull, null], @param57=[Int64, System.Int64], @param58=[String, System.String], @param59=[System.DBNull, null], @param60=[System.DBNull, null], @param61=[System.DBNull, null], @param62=[System.DBNull, null], @param63=[System.DBNull, null], @param64=[System.DBNull, null], @param65=[Int64, System.Int64], @param66=[System.DBNull, null], @param67=[System.DBNull, null], @param68=[System.DBNull, null], @param69=[System.DBNull, null], @param70=[System.DBNull, null], @param71=[System.DBNull, null], @param72=[System.DBNull, null], @param73=[System.DBNull, null], @param74=[System.DBNull, null], @param75=[System.DBNull, null], @param76=[System.DBNull, null], @param77=[System.DBNull, null], @param78=[System.DBNull, null], @param79=[System.DBNull, null], @param80=[System.DBNull, null], @param81=[System.DBNull, null], @param82=[System.DBNull, null], @param83=[System.DBNull, null], @param84=[System.DBNull, null], @param85=[String, System.String], @param86=[Int64, System.Int64], @param87=[DateTime, System.DateTime], @param88=[Int64, System.Int64]]
2019-12-23 15:50:01,265 [1] DEBUG - Statement Id: [DAOLOG01_LockBegin] PreparedStatement : [INSERT into TT_LOG_UPDATE ( REF_TABLE , REF_ID , BENHVIEN_ID )         values ( @param0 ,  @param1 ,  @param2 );]
2019-12-23 15:50:01,265 [1] DEBUG - Statement Id: [DAOLOG01_LockBegin] Parameters: [@param0=[REF_TABLE,TT_DUOC_CHUNGTU], @param1=[REF_ID,138710], @param2=[BENHVIEN_ID,HLU01]]
2019-12-23 15:50:01,265 [1] DEBUG - Statement Id: [DAOLOG01_LockBegin] Types: [@param0=[String, System.String], @param1=[Int64, System.Int64], @param2=[String, System.String]]
2019-12-23 15:50:01,296 [1] DEBUG - Statement Id: [DAO00030_CHUNGTUCT_Add] PreparedStatement : [insert into TT_DUOC_CHUNGTU_CHITIET (            CHUNGTU_ID            , DUOC_ID            , SOLONHAP_ID            , SOKIEMSOAT            , SOVISA            , HANDUNG            , DONVITINH_ID            , SOLUONGYEUCAU            , SOLUONGTHUCTE            , SOLUONGDAXUAT            , TIENTE_ID            , TYGIA            , DONGIAMUA            , DONGIA_BHYT            , DONGIABAN            , DONGIABAN_VAT            , DONGIAVON            , DONGIATHANHTOAN            , SOQUYEN            , SOHOADONVAT            , TYLEVAT            , GIATRIVAT            , TYLECHIETKHAU            , GIATRICHIETKHAU            , MIENPHI            , LYDOMIENPHI_ID            , SOCHUNGTUKETOAN            , SOCHUNGTUTIENMAT            , TRANGTHAI            , DAPHATSINHPHIEUXUAT            , DAPHATSINHPHIEUHOANTRA            , KHUYENMAI            , PHUONGPHAPXUAT            , DONDATHANG_ID            , GHICHUCHITIET            , NGUONHANG_ID            , DONGIAVONVAT            , THANHTIENMUA            , THANHTIENVON            , THANHTIENHOPDONG            , ISTACHLO            , DONVITINHBANDAU_ID            , SOLUONGBANDAU            , GOITHAU_ID            , DONGIATHAU            , DONGIAPO            , TYLEQUIDOI            , TOATHUOCNOITRU_ID            , KHAMBENH_VTYT_ID            , PHAUTHUAT_VTYT_ID            , CLSKETQUA_VTYT_ID            , TOATHUOCNGOAITRU_ID            , MASTER_ID            , BENHNHAN            , YLENH                                   , BENHVIEN_ID            , NGAYTAO            , NGUOITAO_ID            , NGAYCAPNHAT            , NGUOICAPNHAT_ID            , THANHTIENMUABANDAU            , SOLUONGQUIDOI            ) values (             @param0             ,  @param1             ,  @param2             ,  @param3             ,  @param4             ,  @param5             ,  @param6             ,  @param7             ,  @param8             ,  @param9             ,  @param10             ,  @param11             ,  @param12             ,  @param13             ,  @param14             ,  @param15             ,  @param16             ,  @param17             ,  @param18             ,  @param19             ,  @param20             ,  @param21             ,  @param22             ,  @param23             ,  @param24             ,  @param25             ,  @param26             ,  @param27             ,  @param28             ,  @param29             ,  @param30             ,  @param31             ,  @param32             ,  @param33             ,  @param34             ,  @param35             ,  @param36             ,  @param37             ,  @param38             ,  @param39             ,  @param40             ,  @param41             ,  @param42             ,  @param43             ,  @param44             ,  @param45             ,  @param46             ,  @param47             ,  @param48             ,  @param49             ,  @param50             ,  @param51             ,  @param52             ,  @param53             ,  @param54                          ,  @param55             ,  @param56             ,  @param57             ,  @param58             ,  @param59             ,  @param60             ,  @param61             )            select SCOPE_identity() as value]
2019-12-23 15:50:01,296 [1] DEBUG - Statement Id: [DAO00030_CHUNGTUCT_Add] Parameters: [@param0=[CHUNGTU_ID,138710], @param1=[DUOC_ID,1013], @param2=[SOLONHAP_ID,1648], @param3=[SOKIEMSOAT,null], @param4=[SOVISA,], @param5=[HANDUNG,1/1/2030 12:00:00 AM], @param6=[DONVITINH_ID,5], @param7=[SOLUONGYEUCAU,10], @param8=[SOLUONGTHUCTE,null], @param9=[SOLUONGDAXUAT,10], @param10=[TIENTE_ID,VND], @param11=[TYGIA,1], @param12=[DONGIAMUA,7999], @param13=[DONGIA_BHYT,7999], @param14=[DONGIABAN,10000], @param15=[DONGIABAN_VAT,10000], @param16=[DONGIAVON,7999], @param17=[DONGIATHANHTOAN,0], @param18=[SOQUYEN,null], @param19=[SOHOADONVAT,null], @param20=[TYLEVAT,0], @param21=[GIATRIVAT,79990], @param22=[TYLECHIETKHAU,0], @param23=[GIATRICHIETKHAU,0], @param24=[MIENPHI,0], @param25=[LYDOMIENPHI_ID,null], @param26=[SOCHUNGTUKETOAN,null], @param27=[SOCHUNGTUTIENMAT,null], @param28=[TRANGTHAI,], @param29=[DAPHATSINHPHIEUXUAT,null], @param30=[DAPHATSINHPHIEUHOANTRA,null], @param31=[KHUYENMAI,0], @param32=[PHUONGPHAPXUAT,0], @param33=[DONDATHANG_ID,null], @param34=[GHICHUCHITIET,null], @param35=[NGUONHANG_ID,1], @param36=[DONGIAVONVAT,7999], @param37=[THANHTIENMUA,79990], @param38=[THANHTIENVON,79990], @param39=[THANHTIENHOPDONG,79990], @param40=[ISTACHLO,null], @param41=[DONVITINHBANDAU_ID,null], @param42=[SOLUONGBANDAU,null], @param43=[GOITHAU_ID,null], @param44=[DONGIATHAU,0], @param45=[DONGIAPO,null], @param46=[TYLEQUIDOI,null], @param47=[TOATHUOCNOITRU_ID,null], @param48=[KHAMBENH_VTYT_ID,null], @param49=[PHAUTHUAT_VTYT_ID,null], @param50=[CLSKETQUA_VTYT_ID,null], @param51=[TOATHUOCNGOAITRU_ID,null], @param52=[MASTER_ID,0], @param53=[BENHNHAN,], @param54=[YLENH,], @param55=[BENHVIEN_ID,HLU01], @param56=[NGAYTAO,12/23/2019 3:50:01 PM], @param57=[NGUOITAO_ID,null], @param58=[NGAYCAPNHAT,12/23/2019 3:50:01 PM], @param59=[NGUOICAPNHAT_ID,null], @param60=[THANHTIENMUABANDAU,null], @param61=[SOLUONGQUIDOI,null]]
2019-12-23 15:50:01,296 [1] DEBUG - Statement Id: [DAO00030_CHUNGTUCT_Add] Types: [@param0=[Int32, System.Int32], @param1=[Int64, System.Int64], @param2=[Int64, System.Int64], @param3=[System.DBNull, null], @param4=[String, System.String], @param5=[DateTime, System.DateTime], @param6=[Int64, System.Int64], @param7=[Double, System.Double], @param8=[System.DBNull, null], @param9=[Double, System.Double], @param10=[String, System.String], @param11=[Double, System.Double], @param12=[Double, System.Double], @param13=[Double, System.Double], @param14=[Double, System.Double], @param15=[Double, System.Double], @param16=[Double, System.Double], @param17=[Double, System.Double], @param18=[System.DBNull, null], @param19=[System.DBNull, null], @param20=[Double, System.Double], @param21=[Double, System.Double], @param22=[Double, System.Double], @param23=[Double, System.Double], @param24=[String, System.String], @param25=[System.DBNull, null], @param26=[System.DBNull, null], @param27=[System.DBNull, null], @param28=[String, System.String], @param29=[System.DBNull, null], @param30=[System.DBNull, null], @param31=[String, System.String], @param32=[Int64, System.Int64], @param33=[System.DBNull, null], @param34=[System.DBNull, null], @param35=[Int64, System.Int64], @param36=[Double, System.Double], @param37=[Double, System.Double], @param38=[Double, System.Double], @param39=[Double, System.Double], @param40=[System.DBNull, null], @param41=[System.DBNull, null], @param42=[System.DBNull, null], @param43=[System.DBNull, null], @param44=[Double, System.Double], @param45=[System.DBNull, null], @param46=[System.DBNull, null], @param47=[System.DBNull, null], @param48=[System.DBNull, null], @param49=[System.DBNull, null], @param50=[System.DBNull, null], @param51=[System.DBNull, null], @param52=[Int64, System.Int64], @param53=[String, System.String], @param54=[String, System.String], @param55=[String, System.String], @param56=[DateTime, System.DateTime], @param57=[System.DBNull, null], @param58=[DateTime, System.DateTime], @param59=[System.DBNull, null], @param60=[System.DBNull, null], @param61=[System.DBNull, null]]
2019-12-23 15:50:01,484 [1] DEBUG - Statement Id: [DAO00030_TT_VIENPHI_Add] PreparedStatement : [INSERT INTO TT_VIENPHI (              TIEPNHAN_ID              , BENHNHAN_ID              , KHAMBENH_ID              , REF_ID              , REF_TABLE              , DUOC_ID              , SOLONHAP_ID              , LOAI_CHIPHI              , LOAIGIA_ID              , SOLUONG              , DONGIA_DOANHTHU              , THANHTIEN_DOANHTHU              , BHYT_TL              , BENHNHAN_PHAITHANHTOAN              , GIATRI_HOADON              , GIATRI_HOADON_DATHANHTOAN              , GIATRI_BIENLAI              , GIATRI_BIENLAI_DATHANHTOAN              , GIATRI_BENHNHAN_DATHANHTOAN              , TYLE_VAT              , GIAVON              , BANGGIA_ID              , DUOCPHEPTHUCHIEN              , HUY              , KHONGTHUTIEN              , DATHANHTOAN              , DATHUCHIEN              , HOADON_ID              , ACTIVE              , DUYET              , BENHVIEN_ID              , NGUOITAO_ID              , NGAYTAO              , NGUOICAPNHAT_ID              , NGAYCAPNHAT              ) values (               @param0               ,  @param1               ,  @param2               ,  @param3               ,  @param4               ,  @param5               ,  @param6               ,  @param7               ,  @param8               ,  @param9               ,  @param10               ,  @param11               ,  @param12               ,  @param13               ,  @param14               ,  @param15               ,  @param16               ,  @param17               ,  @param18               ,  @param19               ,  @param20               ,  @param21               ,  @param22               ,  @param23               ,  @param24               ,  @param25               ,  @param26               ,  @param27               ,  @param28               ,  @param29               ,  @param30               ,  @param31               ,  @param32               ,  @param33               ,  @param34               )              select SCOPE_identity() as value]
2019-12-23 15:50:01,484 [1] DEBUG - Statement Id: [DAO00030_TT_VIENPHI_Add] Parameters: [@param0=[TIEPNHAN_ID,null], @param1=[BENHNHAN_ID,null], @param2=[KHAMBENH_ID,null], @param3=[REF_ID,1300062], @param4=[REF_TABLE,TT_DUOC_CHUNGTU_CHITIET], @param5=[DUOC_ID,1013], @param6=[SOLONHAP_ID,1648], @param7=[LOAI_CHIPHI,TT], @param8=[LOAIGIA_ID,36], @param9=[SOLUONG,10], @param10=[DONGIA_DOANHTHU,10000], @param11=[THANHTIEN_DOANHTHU,100000], @param12=[BHYT_TL,0], @param13=[BENHNHAN_PHAITHANHTOAN,100000], @param14=[GIATRI_HOADON,0], @param15=[GIATRI_HOADON_DATHANHTOAN,0], @param16=[GIATRI_BIENLAI,100000], @param17=[GIATRI_BIENLAI_DATHANHTOAN,0], @param18=[GIATRI_BENHNHAN_DATHANHTOAN,0], @param19=[TYLE_VAT,0], @param20=[GIAVON,7999], @param21=[BANGGIA_ID,null], @param22=[DUOCPHEPTHUCHIEN,0], @param23=[HUY,0], @param24=[KHONGTHUTIEN,0], @param25=[DATHANHTOAN,0], @param26=[DATHUCHIEN,0], @param27=[HOADON_ID,null], @param28=[ACTIVE,1], @param29=[DUYET,0], @param30=[BENHVIEN_ID,HLU01], @param31=[NGUOITAO_ID,1], @param32=[NGAYTAO,12/23/2019 3:50:01 PM], @param33=[NGUOICAPNHAT_ID,1], @param34=[NGAYCAPNHAT,12/23/2019 3:50:01 PM]]
2019-12-23 15:50:01,484 [1] DEBUG - Statement Id: [DAO00030_TT_VIENPHI_Add] Types: [@param0=[System.DBNull, null], @param1=[System.DBNull, null], @param2=[System.DBNull, null], @param3=[Int64, System.Int64], @param4=[String, System.String], @param5=[Int64, System.Int64], @param6=[Int64, System.Int64], @param7=[String, System.String], @param8=[String, System.String], @param9=[Double, System.Double], @param10=[Double, System.Double], @param11=[Double, System.Double], @param12=[Int32, System.Int32], @param13=[Double, System.Double], @param14=[Int32, System.Int32], @param15=[Int32, System.Int32], @param16=[Double, System.Double], @param17=[Int32, System.Int32], @param18=[Int32, System.Int32], @param19=[Double, System.Double], @param20=[Double, System.Double], @param21=[System.DBNull, null], @param22=[String, System.String], @param23=[String, System.String], @param24=[String, System.String], @param25=[String, System.String], @param26=[String, System.String], @param27=[System.DBNull, null], @param28=[String, System.String], @param29=[String, System.String], @param30=[String, System.String], @param31=[Int64, System.Int64], @param32=[DateTime, System.DateTime], @param33=[Int64, System.Int64], @param34=[DateTime, System.DateTime]]
2019-12-23 15:50:01,582 [1] DEBUG - Statement Id: [DAO00030_TT_DUOC_TONKHO_LOG_Add] PreparedStatement : [DECLARE @KHODUOC_ID int               DECLARE @TONTRUOC numeric(18, 4)               DECLARE @TONSAU numeric(18, 4)               DECLARE @SOLUONGNHAP numeric(18, 4)               DECLARE @SOLUONGXUAT numeric(18, 4)                              IF( @param0  = 'N')               BEGIN                SET @KHODUOC_ID =  @param1                END               ELSE               BEGIN                 SET @KHODUOC_ID =  @param2                END                              SELECT @TONTRUOC = SOLUONG FROM TT_DUOC_TONKHO WHERE KHODUOC_ID = @KHODUOC_ID  AND DUOC_ID =  @param3  AND SOLONHAP_ID =  @param4  AND NGUONDUOC_ID =  @param5                               IF( @param0  = 'N' AND  @param6  = 'ADD')               BEGIN                SET @TONSAU = ISNULL(@TONTRUOC,0) +  @param7                 SET @SOLUONGNHAP =  @param7                 SET @SOLUONGXUAT = 0               END               IF( @param0  = 'N' AND  @param6  = 'DEL')               BEGIN                SET @TONSAU = ISNULL(@TONTRUOC,0) -  @param7                 SET @SOLUONGXUAT =  @param7                 SET @SOLUONGNHAP = 0               END                                         IF( @param0  = 'X' AND  @param6  = 'ADD')               BEGIN                SET @TONSAU = ISNULL(@TONTRUOC,0) -  @param8                 SET @SOLUONGXUAT =  @param8                 SET @SOLUONGNHAP = 0               END               IF( @param0  = 'X' AND  @param6  = 'DEL')               BEGIN                SET @TONSAU = ISNULL(@TONTRUOC,0) +  @param8                 SET @SOLUONGNHAP =  @param8                 SET @SOLUONGXUAT = 0                             END                        insert into TT_DUOC_TONKHO_LOG (                           CHUNGTUCHITIET_ID              ,CHUNGTU_ID              ,MACHUNGTU              ,LOAICHUNGTU              ,MUCDICHCHUNGTU_CODE              ,KHONHAP_ID              ,KHOXUAT_ID              ,DUOC_ID              ,SOLONHAP_ID              ,NGUONDUOC_ID              ,SOLUONGNHAP              ,SOLUONGXUAT              ,DONGIAMUA              ,DONGIAVON              ,TYLE_VAT              ,DONGIAVONVAT              ,TONTRUOC              ,TONSAU              ,ACTION              ,BENHVIEN_ID              ,NGAYTAO              ,NGUOITAO_ID                          ) values (              @param9               , @param10               , @param11               , @param0               , @param12               , @param1               , @param2               , @param3               , @param4               , @param5               ,@SOLUONGNHAP              ,@SOLUONGXUAT              , @param13               , @param14               , @param15               , @param16               ,@TONTRUOC              ,@TONSAU              , @param6               , @param17               , @param18               , @param19               )]
2019-12-23 15:50:01,582 [1] DEBUG - Statement Id: [DAO00030_TT_DUOC_TONKHO_LOG_Add] Parameters: [@param0=[LOAICHUNGTU,X], @param1=[KHONHAP_ID,null], @param2=[KHOXUAT_ID,9], @param3=[DUOC_ID,1013], @param4=[SOLONHAP_ID,1648], @param5=[NGUONDUOC_ID,1], @param6=[ACTION,ADD], @param7=[SOLUONGNHAP,null], @param8=[SOLUONGXUAT,10], @param9=[CHUNGTUCHITIET_ID,1300062], @param10=[CHUNGTU_ID,138710], @param11=[MACHUNGTU,KHO_NTX081912000001], @param12=[MUCDICHCHUNGTU_CODE,X08], @param13=[DONGIAMUA,7999], @param14=[DONGIAVON,7999], @param15=[TYLE_VAT,0], @param16=[DONGIAVONVAT,7999], @param17=[BENHVIEN_ID,HLU01], @param18=[NGAYTAO,12/23/2019 3:50:01 PM], @param19=[NGUOITAO_ID,1]]
2019-12-23 15:50:01,582 [1] DEBUG - Statement Id: [DAO00030_TT_DUOC_TONKHO_LOG_Add] Types: [@param0=[String, System.String], @param1=[System.DBNull, null], @param2=[Int64, System.Int64], @param3=[Int64, System.Int64], @param4=[Int64, System.Int64], @param5=[Int64, System.Int64], @param6=[String, System.String], @param7=[System.DBNull, null], @param8=[Decimal, System.Decimal], @param9=[Int64, System.Int64], @param10=[Int32, System.Int32], @param11=[String, System.String], @param12=[String, System.String], @param13=[Decimal, System.Decimal], @param14=[Decimal, System.Decimal], @param15=[Double, System.Double], @param16=[Double, System.Double], @param17=[String, System.String], @param18=[DateTime, System.DateTime], @param19=[Int64, System.Int64]]
2019-12-23 15:50:01,663 [1] DEBUG - Statement Id: [DAO00114_CHUNGTUTHUOC_MUANGOAI_ChiTiet_BIL12] PreparedStatement : [select distinct ct.*, isnull(bn.MAYTE, 'VANGLAI') as MAYTE, isnull(bn.NAMSINH, ntnm.NAMSINH) as NAMSINH        from TT_DUOC_CHUNGTU ct        left join TT_BENHNHAN bn on bn.benhnhan_id = ct.benhnhan_id        inner join TT_DUOC_CHUNGTU_CHITIET ctct on ct.CHUNGTU_ID = ctct.CHUNGTU_ID        left join TT_NGOAITRU_TOATHUOC_NGUOIMUA ntnm on ntnm.NGOAITRU_TOATHUOC_NGUOIMUA_ID = ct.NGOAITRU_TOATHUOC_NGUOIMUA_ID        inner join TT_VIENPHI vp on vp.REF_ID = ctct.CHUNGTUCHITIET_ID and REF_TABLE = 'TT_DUOC_CHUNGTU_CHITIET' and vp.DATHANHTOAN = '0' and vp.REF_ID = '1300062'        where              ct.MUCDICHCHUNGTU_CODE = 'X08'        and ct.BENHVIEN_ID = 'HLU01'        order by ct.MACHUNGTU desc]
2019-12-23 15:50:01,970 [1] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM034']
2019-12-23 15:50:12,791 [1] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoVaBookingCOM23UpdateRedis] PreparedStatement : [declare @NGUONDUOC_MACDINH varchar(5) = '0';        declare @TOAMUANGOAI int = 0;        select @NGUONDUOC_MACDINH = isnull(VALUE,0) from TM_SYS_APPSETTINGS where CODE = 'PHA_NGUONDUOC'        select @TOAMUANGOAI = isnull(VALUE,0) from TM_SYS_APPSETTINGS where CODE = 'OPD_TOAMUANGOAI_DUNGDANHMUC_DUOC'                if @TOAMUANGOAI = 1        begin        select  distinct '0' + '_' + LTRIM(d.DUOC_ID) + '_' + @NGUONDUOC_MACDINH as DUOC_KEY, 0 as PHAMVI_ID, @NGUONDUOC_MACDINH as NGUONDUOC_ID, null as TENNGUONDUOC, null as TINHTIEN, d.DUOC_ID, ld.MALOAIDUOC,        d.SOVISA,d.TYLE_VAT,d.COTOA, d.MADUOC, d.TENHANG, d.TENDUOCDAYDU, dvt.TENDONVITINH as DONVITINH, d.BHYT,        d.TENHOATCHAT, d.HAMLUONG, d.HANGSANXUAT, d.QUOCGIA, d.LOAIDUOC_ID, d.DUONGDUNG_ID, d.TINHTIEN_PTTT,        ten.TENDUOC, ten.TENDUOC_EN, ten.MAQUOCTE, ten.MAQUOCTEBT,d.CONGDUNG,        '' as BHYT_TEXT        , ld.LOAIVATTU_ID        , d.BENHVIEN_ID,        999999999 as SOLUONG, d.VTYT_PHANLOAI, d.PHAMVI, d.SUASOLUONGTONGHOP, d.MADUOCBV, d.DANGTRINHBAY        , TAMNGUNG = CASE WHEN d.TAMNGUNG = '1' THEN '1' ELSE '0' END        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        where d.DUOC_ID in (1013)        union all        select  distinct tk.DUOC_KEY, LTRIM(tk.PHAMVI_ID) as PHAMVI_ID, tk.NGUONDUOC_ID, nh.TENNGUONDUOC, nh.TINHTIEN, d.DUOC_ID, ld.MALOAIDUOC,        d.SOVISA,d.TYLE_VAT,d.COTOA, d.MADUOC, d.TENHANG, d.TENDUOCDAYDU, dvt.TENDONVITINH as DONVITINH, d.BHYT,        d.TENHOATCHAT, d.HAMLUONG, d.HANGSANXUAT, d.QUOCGIA, d.LOAIDUOC_ID, d.DUONGDUNG_ID, d.TINHTIEN_PTTT,        ten.TENDUOC, ten.TENDUOC_EN, ten.MAQUOCTE, ten.MAQUOCTEBT,d.CONGDUNG,        CASE WHEN d.BHYT = '1' THEN 'BHYT' ELSE '' END as BHYT_TEXT        , ld.LOAIVATTU_ID        , d.BENHVIEN_ID,        tk.SOLUONG, d.VTYT_PHANLOAI, d.PHAMVI, d.SUASOLUONGTONGHOP, d.MADUOCBV, d.DANGTRINHBAY        , TAMNGUNG = CASE WHEN d.TAMNGUNG = '1' OR nh.TAMNGUNG = '1' OR kd.TAMNGUNG = '1' THEN '1' ELSE '0' END        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        inner join        (        select  LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')) DUOC_KEY, (SUM(dtk.SOLUONG) - isnull(sum(A.SOLUONG),0) - isnull(sum(B.SOLUONG),0)) SOLUONG, pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        from (select sum(soluong) soluong,duoc_id,nguonduoc_id,khoduoc_id,benhvien_id from TT_DUOC_TONKHO  group by duoc_id,nguonduoc_id,khoduoc_id,benhvien_id) dtk        inner join TM_DUOC_PHAMVISD_MAPPING pvsd on dtk.KHODUOC_ID = pvsd.KHODUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NOITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) B on B.DUOC_ID = dtk.DUOC_ID and B.SOLUONG > 0 and B.PHAMVI_ID = pvsd.PHAMVI_ID and B.NGUONHANG_ID = dtk.NGUONDUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NGOAITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) A on A.DUOC_ID = dtk.DUOC_ID and A.SOLUONG > 0 and A.PHAMVI_ID = pvsd.PHAMVI_ID and A.NGUONHANG_ID = dtk.NGUONDUOC_ID        where dtk.SOLUONG > 0 and dtk.BENHVIEN_ID = 'HLU01'        group by LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')), pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        ) tk on tk.DUOC_ID = d.DUOC_ID        left join TM_DUOC_PHAMVISUDUNG kd on kd.PHAMVI_ID = tk.PHAMVI_ID and kd.BENHVIEN_ID = 'HLU01'        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = tk.NGUONDUOC_ID and nh.BENHVIEN_ID = 'HLU01'        where  d.BENHVIEN_ID = 'HLU01' and d.DUOC_ID in (1013)        end        else        begin        select  distinct tk.DUOC_KEY, LTRIM(tk.PHAMVI_ID) as PHAMVI_ID, tk.NGUONDUOC_ID, nh.TENNGUONDUOC, nh.TINHTIEN, d.DUOC_ID, ld.MALOAIDUOC,        d.SOVISA,d.TYLE_VAT,d.COTOA, d.MADUOC, d.TENHANG, d.TENDUOCDAYDU, dvt.TENDONVITINH as DONVITINH, d.BHYT,        d.TENHOATCHAT, d.HAMLUONG, d.HANGSANXUAT, d.QUOCGIA, d.LOAIDUOC_ID, d.DUONGDUNG_ID, d.TINHTIEN_PTTT,        ten.TENDUOC, ten.TENDUOC_EN, ten.MAQUOCTE, ten.MAQUOCTEBT,d.CONGDUNG,        CASE WHEN d.BHYT = '1' THEN 'BHYT' ELSE '' END as BHYT_TEXT        , ld.LOAIVATTU_ID        , d.BENHVIEN_ID,        tk.SOLUONG, d.VTYT_PHANLOAI, d.PHAMVI, d.SUASOLUONGTONGHOP, d.MADUOCBV, d.DANGTRINHBAY        , TAMNGUNG = CASE WHEN d.TAMNGUNG = '1' OR nh.TAMNGUNG = '1' OR kd.TAMNGUNG = '1' THEN '1' ELSE '0' END        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        inner join        (        select  LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')) DUOC_KEY, (SUM(dtk.SOLUONG) - isnull(sum(A.SOLUONG),0) - isnull(sum(B.SOLUONG),0)) SOLUONG, pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        from (select sum(soluong) soluong,duoc_id,nguonduoc_id,khoduoc_id,benhvien_id from TT_DUOC_TONKHO  group by duoc_id,nguonduoc_id,khoduoc_id,benhvien_id) dtk        inner join TM_DUOC_PHAMVISD_MAPPING pvsd on dtk.KHODUOC_ID = pvsd.KHODUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NOITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) B on B.DUOC_ID = dtk.DUOC_ID and B.SOLUONG > 0 and B.PHAMVI_ID = pvsd.PHAMVI_ID and B.NGUONHANG_ID = dtk.NGUONDUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NGOAITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) A on A.DUOC_ID = dtk.DUOC_ID and A.SOLUONG > 0 and A.PHAMVI_ID = pvsd.PHAMVI_ID and A.NGUONHANG_ID = dtk.NGUONDUOC_ID        where dtk.SOLUONG > 0 and dtk.BENHVIEN_ID = 'HLU01'        group by LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')), pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        ) tk on tk.DUOC_ID = d.DUOC_ID        left join TM_DUOC_PHAMVISUDUNG kd on kd.PHAMVI_ID = tk.PHAMVI_ID and kd.BENHVIEN_ID = 'HLU01'        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = tk.NGUONDUOC_ID and nh.BENHVIEN_ID = 'HLU01'        where  d.BENHVIEN_ID = 'HLU01' and d.DUOC_ID in (1013)        end]
2019-12-23 15:50:13,271 [1] DEBUG - Statement Id: [DAO00030_MergSoLuongTonKho] PreparedStatement : [BEGIN          BEGIN TRY          BEGIN TRANSACTION            UPDATE TT_DUOC_TONKHO SET SOLUONG=0,DONGIAMUA=null WHERE KHODUOC_ID IN(9);          MERGE TT_DUOC_TONKHO AS X USING          (          select aa.SoLoNhap_ID,aa.KHODUOC_ID,aa.DUOC_ID,  aa.NGUONDUOC_ID,aa.BENHVIEN_ID, (case when sum(aa.soluong) < 0 then 0 else sum(aa.soluong) end) as SOLUONG from (          Select (case when CTU.LoaiChungTu = 'N' then CTU.KhoNhap_ID else ctu.KhoXuat_ID end) as KHODUOC_ID, CT.SOLONHAP_ID,          (case when CTU.LoaiChungTu = 'N' then SoLuongThucTe*ISNULL(CT.TYLEQUIDOI,1) else - SOLUONGDAXUAT end) as SOLUONG,CT.DUOC_ID,          Lo.NGUONDUOC_ID,CTU.BENHVIEN_ID          from TT_DUOC_CHUNGTU_CHITIET CT          join TT_DUOC_CHUNGTU CTU on CT.ChungTu_ID = CTU.ChungTu_ID AND CT.BENHVIEN_ID=CTU.BENHVIEN_ID          join TT_DUOC_CHUNGTU_SOLONHAP Lo on Lo.SoLoNhap_ID = CT.SoLoNhap_ID          join TM_DUOC duoc on CT.DUOC_ID = duoc.DUOC_ID          where ((CTU.TRANGTHAI not in ('PNCXN','CXN','HUY','PNCNK')) or CTU.TRANGTHAI is null) AND CTU.BENHVIEN_ID='HLU01'          ) aa where aa.KHODUOC_ID IN(9)          Group by AA.SoLoNhap_ID,AA.KHODUOC_ID,AA.DUOC_ID,  AA.NGUONDUOC_ID,AA.BENHVIEN_ID          ) AS Y          ON (X.KHODUOC_ID =Y.KHODUOC_ID AND X.SOLONHAP_ID=Y.SOLONHAP_ID AND X.DUOC_ID=Y.DUOC_ID AND X.NGUONDUOC_ID=Y.NGUONDUOC_ID AND X.BENHVIEN_ID=Y.BENHVIEN_ID)          WHEN MATCHED THEN UPDATE SET X.SOLUONG=Y.SOLUONG          WHEN NOT MATCHED THEN          INSERT (KHODUOC_ID,DUOC_ID,SOLONHAP_ID,SOLUONG,NGUONDUOC_ID,BENHVIEN_ID,NGAYTAO,NGUOITAO_ID,NGAYCAPNHAT,NGUOICAPNHAT_ID) VALUES          (Y.KHODUOC_ID,Y.DUOC_ID,Y.SOLONHAP_ID,Y.SOLUONG,Y.NGUONDUOC_ID,Y.BENHVIEN_ID,GETDATE(),NULL,GETDATE(),NULL);            COMMIT TRANSACTION          END TRY          BEGIN CATCH          IF @@TRANCOUNT > 0          ROLLBACK TRANSACTION          END CATCH          END]
2019-12-23 15:50:15,303 [1] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoCOM18] PreparedStatement : [select  distinct TT_TONKHO.DUOC_KEY, LTRIM(TT_TONKHO.KHODUOC_ID) as KHODUOC_ID, TM_DUOC.DUOC_ID, TM_LOAIDUOC.MALOAIDUOC,TM_DUOC.SOVISA,TM_DUOC.TYLE_VAT,TM_DUOC.COTOA,        TM_DUOC.MADUOC, TM_DUOC.TENHANG, TM_DUOC.TENDUOCDAYDU, dvt.TENDONVITINH as DONVITINH, TM_DUOC.DONVITINH_ID, TM_DUOC.BHYT,        TM_DUOC.TENHOATCHAT, TM_DUOC.HAMLUONG, TM_DUOC.HANGSANXUAT, TM_DUOC.QUOCGIA, TM_DUOC.LOAIDUOC_ID, TM_DUOC.DUONGDUNG_ID,        TM_TENDUOC.TENDUOC, TM_TENDUOC.TENDUOC_EN, TM_TENDUOC.MAQUOCTE, TM_TENDUOC.MAQUOCTEBT,        TM_LOAIDUOC.LOAIVATTU_ID, TM_DUOC.BENHVIEN_ID,        TT_TONKHO.SOLUONG, TM_DUOC.VTYT_PHANLOAI, TM_DUOC.PHAMVI, TT_TONKHO.NGUONDUOC_ID, NG.TENNGUONDUOC        , TAMNGUNG = CASE WHEN TM_DUOC.TAMNGUNG = '1' OR NG.TAMNGUNG = '1' OR KD.TAMNGUNG = '1' THEN '1' ELSE '0' END        , TM_DUOC.DANGTRINHBAY        from TM_DUOC        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = TM_DUOC.DONVITINH_ID        left join TM_TENDUOC on TM_DUOC.TENDUOC_ID = TM_TENDUOC.TENDUOC_ID and TM_DUOC.BENHVIEN_ID = 'HLU01'  and TM_DUOC.TAMNGUNG = '0'        left join TM_LOAIDUOC on TM_LOAIDUOC.LOAIDUOC_ID = TM_DUOC.LOAIDUOC_ID and TM_LOAIDUOC.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG on (TM_LOAIDUOC.LOAIVATTU_ID = TM_DUOC_HANDUNG.LOAIDUOC and TM_DUOC_HANDUNG.BENHVIEN_ID = 'HLU01')        inner join        (select LTRIM(A.KHODUOC_ID) + '_' + LTRIM(A.DUOC_ID) + '_' + LTRIM(ISNULL(A.NGUONDUOC_ID,'')) as DUOC_KEY, A.KHODUOC_ID, A.DUOC_ID ,a.NGUONDUOC_ID,        SUM(isnull(A.SOLUONG,0)) as SOLUONG        from        (select SUM(SOLUONG) as SOLUONG, KHODUOC_ID, DUOC_ID, NGUONDUOC_ID from TT_DUOC_TONKHO        where KHODUOC_ID in (9) and DUOC_ID in (1013) group by KHODUOC_ID, DUOC_ID, NGUONDUOC_ID        ) A        where A.KHODUOC_ID in (9) and A.DUOC_ID in (1013)        group by LTRIM(A.KHODUOC_ID) + '_' + LTRIM(A.DUOC_ID) + '_' + LTRIM(A.NGUONDUOC_ID), A.KHODUOC_ID, A.DUOC_ID, A.NGUONDUOC_ID)        TT_TONKHO on TT_TONKHO.DUOC_ID = TM_DUOC.DUOC_ID        LEFT JOIN TM_NGUONHANG NG ON NG.NGUONDUOC_ID = TT_TONKHO.NGUONDUOC_ID        LEFT JOIN TM_KHODUOC KD ON KD.KHODUOC_ID = TT_TONKHO.KHODUOC_ID        where TM_DUOC.BENHVIEN_ID = 'HLU01' and TM_DUOC.DUOC_ID in (1013)]
2019-12-23 15:50:15,435 [1] DEBUG - Statement Id: [DAO00030_GetListPhamViByKhoDuoc] PreparedStatement : [SELECT DISTINCT PHAMVI_ID          FROM TM_DUOC_PHAMVISD_MAPPING          WHERE          KHODUOC_ID IN (9)          AND BENHVIEN_ID ='HLU01'          AND TAMNGUNG = '0']
2019-12-23 15:50:15,464 [1] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoVaBookingCOM23] PreparedStatement : [declare @NGUONDUOC_MACDINH varchar(5) = '0';        declare @TOAMUANGOAI int = 0;        select @NGUONDUOC_MACDINH = isnull(VALUE,0) from TM_SYS_APPSETTINGS where CODE = 'PHA_NGUONDUOC'        select @TOAMUANGOAI = isnull(VALUE,0) from TM_SYS_APPSETTINGS where CODE = 'OPD_TOAMUANGOAI_DUNGDANHMUC_DUOC'                if @TOAMUANGOAI = 1        begin        select  distinct '0' + '_' + LTRIM(d.DUOC_ID) + '_' + @NGUONDUOC_MACDINH as DUOC_KEY, 0 as PHAMVI_ID, @NGUONDUOC_MACDINH as NGUONDUOC_ID, null as TENNGUONDUOC, null as TINHTIEN, d.DUOC_ID, ld.MALOAIDUOC,        d.SOVISA,d.TYLE_VAT,d.COTOA, d.MADUOC, d.TENHANG, d.TENDUOCDAYDU, dvt.TENDONVITINH as DONVITINH, d.BHYT,        d.TENHOATCHAT, d.HAMLUONG, d.HANGSANXUAT, d.QUOCGIA, d.LOAIDUOC_ID, d.DUONGDUNG_ID, d.TINHTIEN_PTTT,        ten.TENDUOC, ten.TENDUOC_EN, ten.MAQUOCTE, ten.MAQUOCTEBT, d.CONGDUNG,        '' as BHYT_TEXT        , ld.LOAIVATTU_ID        , d.BENHVIEN_ID,        999999999 as SOLUONG, d.VTYT_PHANLOAI, d.PHAMVI, d.SUASOLUONGTONGHOP, d.MADUOCBV, d.DANGTRINHBAY        , TAMNGUNG = CASE WHEN d.TAMNGUNG = '1' THEN '1' ELSE '0' END        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        where d.DUOC_ID in (1013)        union all        select  distinct tk.DUOC_KEY, LTRIM(tk.PHAMVI_ID) as PHAMVI_ID, tk.NGUONDUOC_ID, nh.TENNGUONDUOC, nh.TINHTIEN, d.DUOC_ID, ld.MALOAIDUOC,        d.SOVISA,d.TYLE_VAT,d.COTOA, d.MADUOC, d.TENHANG, d.TENDUOCDAYDU, dvt.TENDONVITINH as DONVITINH, d.BHYT,        d.TENHOATCHAT, d.HAMLUONG, d.HANGSANXUAT, d.QUOCGIA, d.LOAIDUOC_ID, d.DUONGDUNG_ID, d.TINHTIEN_PTTT,        ten.TENDUOC, ten.TENDUOC_EN, ten.MAQUOCTE, ten.MAQUOCTEBT,d.CONGDUNG,        CASE WHEN d.BHYT = '1' THEN 'BHYT' ELSE '' END as BHYT_TEXT        , ld.LOAIVATTU_ID        , d.BENHVIEN_ID,        tk.SOLUONG, d.VTYT_PHANLOAI, d.PHAMVI, d.SUASOLUONGTONGHOP, d.MADUOCBV, d.DANGTRINHBAY        , TAMNGUNG = CASE WHEN d.TAMNGUNG = '1' OR nh.TAMNGUNG = '1' OR kd.TAMNGUNG = '1' THEN '1' ELSE '0' END        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        inner join        (        select  LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')) DUOC_KEY, (SUM(dtk.SOLUONG) - isnull(sum(A.SOLUONG),0) - isnull(sum(B.SOLUONG),0)) SOLUONG, pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        from (select sum(soluong) soluong,duoc_id,nguonduoc_id,khoduoc_id,benhvien_id from TT_DUOC_TONKHO  group by duoc_id,nguonduoc_id,khoduoc_id,benhvien_id) dtk        inner join TM_DUOC_PHAMVISD_MAPPING pvsd on dtk.KHODUOC_ID = pvsd.KHODUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NOITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) B on B.DUOC_ID = dtk.DUOC_ID and B.SOLUONG > 0 and B.PHAMVI_ID = pvsd.PHAMVI_ID and B.NGUONHANG_ID = dtk.NGUONDUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NGOAITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) A on A.DUOC_ID = dtk.DUOC_ID and A.SOLUONG > 0 and A.PHAMVI_ID = pvsd.PHAMVI_ID and A.NGUONHANG_ID = dtk.NGUONDUOC_ID        where dtk.SOLUONG > 0 and dtk.BENHVIEN_ID = 'HLU01'        group by LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')), pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        ) tk on tk.DUOC_ID = d.DUOC_ID        left join TM_DUOC_PHAMVISUDUNG kd on kd.PHAMVI_ID = tk.PHAMVI_ID and kd.BENHVIEN_ID = 'HLU01'        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = tk.NGUONDUOC_ID and nh.BENHVIEN_ID = 'HLU01'        where  d.BENHVIEN_ID = 'HLU01' and d.DUOC_ID in (1013) and TK.PHAMVI_ID in (1033)        and tk.NGUONDUOC_ID in (1)         end        else        begin                select  distinct tk.DUOC_KEY, LTRIM(tk.PHAMVI_ID) as PHAMVI_ID, tk.NGUONDUOC_ID, nh.TENNGUONDUOC, nh.TINHTIEN, d.DUOC_ID, ld.MALOAIDUOC,        d.SOVISA,d.TYLE_VAT,d.COTOA, d.MADUOC, d.TENHANG, d.TENDUOCDAYDU, dvt.TENDONVITINH as DONVITINH, d.BHYT,        d.TENHOATCHAT, d.HAMLUONG, d.HANGSANXUAT, d.QUOCGIA, d.LOAIDUOC_ID, d.DUONGDUNG_ID, d.TINHTIEN_PTTT,        ten.TENDUOC, ten.TENDUOC_EN, ten.MAQUOCTE, ten.MAQUOCTEBT,d.CONGDUNG,        CASE WHEN d.BHYT = '1' THEN 'BHYT' ELSE '' END as BHYT_TEXT        , ld.LOAIVATTU_ID        , d.BENHVIEN_ID,        tk.SOLUONG, d.VTYT_PHANLOAI, d.PHAMVI, d.SUASOLUONGTONGHOP, d.MADUOCBV, d.DANGTRINHBAY        , TAMNGUNG = CASE WHEN d.TAMNGUNG = '1' OR nh.TAMNGUNG = '1' OR kd.TAMNGUNG = '1' THEN '1' ELSE '0' END        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        inner join        (        select  LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')) DUOC_KEY, (SUM(dtk.SOLUONG) - isnull(sum(A.SOLUONG),0) - isnull(sum(B.SOLUONG),0)) SOLUONG, pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        from (select sum(soluong) soluong,duoc_id,nguonduoc_id,khoduoc_id,benhvien_id from TT_DUOC_TONKHO  group by duoc_id,nguonduoc_id,khoduoc_id,benhvien_id) dtk        inner join TM_DUOC_PHAMVISD_MAPPING pvsd on dtk.KHODUOC_ID = pvsd.KHODUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NOITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) B on B.DUOC_ID = dtk.DUOC_ID and B.SOLUONG > 0 and B.PHAMVI_ID = pvsd.PHAMVI_ID and B.NGUONHANG_ID = dtk.NGUONDUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NGOAITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) A on A.DUOC_ID = dtk.DUOC_ID and A.SOLUONG > 0 and A.PHAMVI_ID = pvsd.PHAMVI_ID and A.NGUONHANG_ID = dtk.NGUONDUOC_ID        where dtk.SOLUONG > 0 and dtk.BENHVIEN_ID = 'HLU01'        group by LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')), pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        ) tk on tk.DUOC_ID = d.DUOC_ID        left join TM_DUOC_PHAMVISUDUNG kd on kd.PHAMVI_ID = tk.PHAMVI_ID and kd.BENHVIEN_ID = 'HLU01'        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = tk.NGUONDUOC_ID and nh.BENHVIEN_ID = 'HLU01'        where  d.BENHVIEN_ID = 'HLU01' and d.DUOC_ID in (1013) and TK.PHAMVI_ID in (1033)        and tk.NGUONDUOC_ID in (1)         end]
2019-12-23 15:50:16,046 [1] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoCOM18UpdateRedis] PreparedStatement : [select distinct TT_TONKHO.DUOC_KEY, LTRIM(TT_TONKHO.KHODUOC_ID) as KHODUOC_ID, TM_DUOC.DUOC_ID, TM_LOAIDUOC.MALOAIDUOC,TM_DUOC.SOVISA,TM_DUOC.TYLE_VAT,TM_DUOC.COTOA,        TM_DUOC.MADUOC, TM_DUOC.TENHANG, TM_DUOC.TENDUOCDAYDU, dvt.TENDONVITINH as DONVITINH,  TM_DUOC.DONVITINH_ID,TM_DUOC.BHYT,        TM_DUOC.TENHOATCHAT,        TM_DUOC.HAMLUONG, TM_DUOC.HANGSANXUAT, TM_DUOC.QUOCGIA, TM_DUOC.LOAIDUOC_ID, TM_DUOC.DUONGDUNG_ID,        TM_TENDUOC.TENDUOC, TM_TENDUOC.TENDUOC_EN, TM_TENDUOC.MAQUOCTE, TM_TENDUOC.MAQUOCTEBT,        TM_LOAIDUOC.LOAIVATTU_ID, TM_DUOC.BENHVIEN_ID,        TT_TONKHO.SOLUONG, TM_DUOC.VTYT_PHANLOAI, TM_DUOC.PHAMVI, TT_TONKHO.NGUONDUOC_ID, NG.TENNGUONDUOC AS TENNGUONDUOC        , TAMNGUNG = CASE WHEN TM_DUOC.TAMNGUNG = '1' OR NG.TAMNGUNG = '1' OR KD.TAMNGUNG = '1' THEN '1' ELSE '0' END        , TM_DUOC.DANGTRINHBAY        from TM_DUOC        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = TM_DUOC.DONVITINH_ID        left join TM_TENDUOC on TM_DUOC.TENDUOC_ID = TM_TENDUOC.TENDUOC_ID and TM_DUOC.BENHVIEN_ID = 'HLU01' and TM_DUOC.TAMNGUNG = '0'        left join TM_LOAIDUOC on TM_LOAIDUOC.LOAIDUOC_ID = TM_DUOC.LOAIDUOC_ID and TM_LOAIDUOC.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG on (TM_LOAIDUOC.LOAIVATTU_ID = TM_DUOC_HANDUNG.LOAIDUOC and TM_DUOC_HANDUNG.BENHVIEN_ID = 'HLU01')        inner join        (select LTRIM(A.KHODUOC_ID) + '_' + LTRIM(A.DUOC_ID) + '_' + LTRIM(ISNULL(A.NGUONDUOC_ID,'')) as DUOC_KEY, A.KHODUOC_ID, A.DUOC_ID, A.NGUONDUOC_ID,        SUM(isnull(A.SOLUONG,0)) as SOLUONG        from        (select SUM(SOLUONG) as SOLUONG, KHODUOC_ID, DUOC_ID, NGUONDUOC_ID from TT_DUOC_TONKHO        where BENHVIEN_ID = 'HLU01' group by KHODUOC_ID, DUOC_ID, NGUONDUOC_ID) A        group by LTRIM(A.KHODUOC_ID) + '_' + LTRIM(A.DUOC_ID) + '_' + LTRIM(ISNULL(A.NGUONDUOC_ID,'')), A.KHODUOC_ID, A.DUOC_ID, NGUONDUOC_ID        ) TT_TONKHO on TT_TONKHO.DUOC_ID = TM_DUOC.DUOC_ID        LEFT JOIN TM_NGUONHANG NG ON NG.NGUONDUOC_ID = TT_TONKHO.NGUONDUOC_ID        LEFT JOIN TM_KHODUOC KD ON KD.KHODUOC_ID = TT_TONKHO.KHODUOC_ID        where TM_DUOC.BENHVIEN_ID = 'HLU01' and TT_TONKHO.SOLUONG >= 0        and TM_DUOC.DUOC_ID in (1013)]
2019-12-23 15:50:16,155 [1] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoVaBookingCOM23UpdateRedis] PreparedStatement : [declare @NGUONDUOC_MACDINH varchar(5) = '0';        declare @TOAMUANGOAI int = 0;        select @NGUONDUOC_MACDINH = isnull(VALUE,0) from TM_SYS_APPSETTINGS where CODE = 'PHA_NGUONDUOC'        select @TOAMUANGOAI = isnull(VALUE,0) from TM_SYS_APPSETTINGS where CODE = 'OPD_TOAMUANGOAI_DUNGDANHMUC_DUOC'                if @TOAMUANGOAI = 1        begin        select  distinct '0' + '_' + LTRIM(d.DUOC_ID) + '_' + @NGUONDUOC_MACDINH as DUOC_KEY, 0 as PHAMVI_ID, @NGUONDUOC_MACDINH as NGUONDUOC_ID, null as TENNGUONDUOC, null as TINHTIEN, d.DUOC_ID, ld.MALOAIDUOC,        d.SOVISA,d.TYLE_VAT,d.COTOA, d.MADUOC, d.TENHANG, d.TENDUOCDAYDU, dvt.TENDONVITINH as DONVITINH, d.BHYT,        d.TENHOATCHAT, d.HAMLUONG, d.HANGSANXUAT, d.QUOCGIA, d.LOAIDUOC_ID, d.DUONGDUNG_ID, d.TINHTIEN_PTTT,        ten.TENDUOC, ten.TENDUOC_EN, ten.MAQUOCTE, ten.MAQUOCTEBT,d.CONGDUNG,        '' as BHYT_TEXT        , ld.LOAIVATTU_ID        , d.BENHVIEN_ID,        999999999 as SOLUONG, d.VTYT_PHANLOAI, d.PHAMVI, d.SUASOLUONGTONGHOP, d.MADUOCBV, d.DANGTRINHBAY        , TAMNGUNG = CASE WHEN d.TAMNGUNG = '1' THEN '1' ELSE '0' END        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        where d.DUOC_ID in (1013)        union all        select  distinct tk.DUOC_KEY, LTRIM(tk.PHAMVI_ID) as PHAMVI_ID, tk.NGUONDUOC_ID, nh.TENNGUONDUOC, nh.TINHTIEN, d.DUOC_ID, ld.MALOAIDUOC,        d.SOVISA,d.TYLE_VAT,d.COTOA, d.MADUOC, d.TENHANG, d.TENDUOCDAYDU, dvt.TENDONVITINH as DONVITINH, d.BHYT,        d.TENHOATCHAT, d.HAMLUONG, d.HANGSANXUAT, d.QUOCGIA, d.LOAIDUOC_ID, d.DUONGDUNG_ID, d.TINHTIEN_PTTT,        ten.TENDUOC, ten.TENDUOC_EN, ten.MAQUOCTE, ten.MAQUOCTEBT,d.CONGDUNG,        CASE WHEN d.BHYT = '1' THEN 'BHYT' ELSE '' END as BHYT_TEXT        , ld.LOAIVATTU_ID        , d.BENHVIEN_ID,        tk.SOLUONG, d.VTYT_PHANLOAI, d.PHAMVI, d.SUASOLUONGTONGHOP, d.MADUOCBV, d.DANGTRINHBAY        , TAMNGUNG = CASE WHEN d.TAMNGUNG = '1' OR nh.TAMNGUNG = '1' OR kd.TAMNGUNG = '1' THEN '1' ELSE '0' END        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        inner join        (        select  LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')) DUOC_KEY, (SUM(dtk.SOLUONG) - isnull(sum(A.SOLUONG),0) - isnull(sum(B.SOLUONG),0)) SOLUONG, pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        from (select sum(soluong) soluong,duoc_id,nguonduoc_id,khoduoc_id,benhvien_id from TT_DUOC_TONKHO  group by duoc_id,nguonduoc_id,khoduoc_id,benhvien_id) dtk        inner join TM_DUOC_PHAMVISD_MAPPING pvsd on dtk.KHODUOC_ID = pvsd.KHODUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NOITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) B on B.DUOC_ID = dtk.DUOC_ID and B.SOLUONG > 0 and B.PHAMVI_ID = pvsd.PHAMVI_ID and B.NGUONHANG_ID = dtk.NGUONDUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NGOAITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) A on A.DUOC_ID = dtk.DUOC_ID and A.SOLUONG > 0 and A.PHAMVI_ID = pvsd.PHAMVI_ID and A.NGUONHANG_ID = dtk.NGUONDUOC_ID        where dtk.SOLUONG > 0 and dtk.BENHVIEN_ID = 'HLU01'        group by LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')), pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        ) tk on tk.DUOC_ID = d.DUOC_ID        left join TM_DUOC_PHAMVISUDUNG kd on kd.PHAMVI_ID = tk.PHAMVI_ID and kd.BENHVIEN_ID = 'HLU01'        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = tk.NGUONDUOC_ID and nh.BENHVIEN_ID = 'HLU01'        where  d.BENHVIEN_ID = 'HLU01' and d.DUOC_ID in (1013)        end        else        begin        select  distinct tk.DUOC_KEY, LTRIM(tk.PHAMVI_ID) as PHAMVI_ID, tk.NGUONDUOC_ID, nh.TENNGUONDUOC, nh.TINHTIEN, d.DUOC_ID, ld.MALOAIDUOC,        d.SOVISA,d.TYLE_VAT,d.COTOA, d.MADUOC, d.TENHANG, d.TENDUOCDAYDU, dvt.TENDONVITINH as DONVITINH, d.BHYT,        d.TENHOATCHAT, d.HAMLUONG, d.HANGSANXUAT, d.QUOCGIA, d.LOAIDUOC_ID, d.DUONGDUNG_ID, d.TINHTIEN_PTTT,        ten.TENDUOC, ten.TENDUOC_EN, ten.MAQUOCTE, ten.MAQUOCTEBT,d.CONGDUNG,        CASE WHEN d.BHYT = '1' THEN 'BHYT' ELSE '' END as BHYT_TEXT        , ld.LOAIVATTU_ID        , d.BENHVIEN_ID,        tk.SOLUONG, d.VTYT_PHANLOAI, d.PHAMVI, d.SUASOLUONGTONGHOP, d.MADUOCBV, d.DANGTRINHBAY        , TAMNGUNG = CASE WHEN d.TAMNGUNG = '1' OR nh.TAMNGUNG = '1' OR kd.TAMNGUNG = '1' THEN '1' ELSE '0' END        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        inner join        (        select  LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')) DUOC_KEY, (SUM(dtk.SOLUONG) - isnull(sum(A.SOLUONG),0) - isnull(sum(B.SOLUONG),0)) SOLUONG, pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        from (select sum(soluong) soluong,duoc_id,nguonduoc_id,khoduoc_id,benhvien_id from TT_DUOC_TONKHO  group by duoc_id,nguonduoc_id,khoduoc_id,benhvien_id) dtk        inner join TM_DUOC_PHAMVISD_MAPPING pvsd on dtk.KHODUOC_ID = pvsd.KHODUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NOITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) B on B.DUOC_ID = dtk.DUOC_ID and B.SOLUONG > 0 and B.PHAMVI_ID = pvsd.PHAMVI_ID and B.NGUONHANG_ID = dtk.NGUONDUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NGOAITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) A on A.DUOC_ID = dtk.DUOC_ID and A.SOLUONG > 0 and A.PHAMVI_ID = pvsd.PHAMVI_ID and A.NGUONHANG_ID = dtk.NGUONDUOC_ID        where dtk.SOLUONG > 0 and dtk.BENHVIEN_ID = 'HLU01'        group by LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')), pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        ) tk on tk.DUOC_ID = d.DUOC_ID        left join TM_DUOC_PHAMVISUDUNG kd on kd.PHAMVI_ID = tk.PHAMVI_ID and kd.BENHVIEN_ID = 'HLU01'        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = tk.NGUONDUOC_ID and nh.BENHVIEN_ID = 'HLU01'        where  d.BENHVIEN_ID = 'HLU01' and d.DUOC_ID in (1013)        end]
2019-12-23 15:50:16,410 [1] DEBUG - Statement Id: [DAOLOG01_LockEnd] PreparedStatement : [DELETE TT_LOG_UPDATE        where REF_TABLE = 'TT_DUOC_CHUNGTU' and REF_ID = '138710' and BENHVIEN_ID = 'HLU01']
2019-12-23 15:50:16,496 [1] DEBUG - Statement Id: [DAO00030_GetList] PreparedStatement : [select *              from TT_DUOC_CHUNGTU              where BENHVIEN_ID = 'HLU01'                and                   TT_DUOC_CHUNGTU.CHUNGTU_ID = '138710'                               order by CHUNGTU_ID]
2019-12-23 15:50:16,627 [1] DEBUG - Statement Id: [DAO00030_CHUNGTUXUAT_CHITIET_GetList] PreparedStatement : [SELECT            ctct.*,            d.MADUOC, d.TENHANG, d.TENDUOCDAYDU, dvt.TENDONVITINH as DONVITINH,n.TENNGUONDUOC as NGUONHANG,            sln.SOLONHAP, sln.SOLOSANPHAM, sln.NGAYNHAP as NGAYNHAPLO, sln.HANDUNG as HANSUDUNG,            isnull(tk.SOLUONG,0) as SOLUONGTON,            LTRIM(ct.KHOXUAT_ID) + '_' + LTRIM(sln.DUOC_ID) + '_' + LTRIM(sln.NGUONDUOC_ID) as DUOC_KEY            , NLD.MANHOMLOAIDUOC, ld.MALOAIDUOC, D.SO_QDTT            FROM            TT_DUOC_CHUNGTU_CHITIET ctct            INNER JOIN TT_DUOC_CHUNGTU ct ON (ct.CHUNGTU_ID = ctct.CHUNGTU_ID)            INNER JOIN TT_DUOC_CHUNGTU_SOLONHAP sln ON (sln.SOLONHAP_ID = ctct.SOLONHAP_ID)            LEFT JOIN (            select xx.DUOCTONKHO_ID, xx.KHODUOC_ID, xx.DUOC_ID, xx.SOLONHAP_ID, xx.SOLUONG, xx.NGUONDUOC_ID, xx.BENHVIEN_ID from TT_DUOC_TONKHO xx            join ( select max(DUOCTONKHO_ID) as DUOCTONKHO_ID, KHODUOC_ID, DUOC_ID, SOLONHAP_ID, NGUONDUOC_ID            from TT_DUOC_TONKHO group by KHODUOC_ID, DUOC_ID, SOLONHAP_ID, NGUONDUOC_ID) yy on xx.DUOCTONKHO_ID=yy.DUOCTONKHO_ID            ) tk ON (tk.SOLONHAP_ID = sln.SOLONHAP_ID AND tk.DUOC_ID = sln.DUOC_ID and tk.KHODUOC_ID = ct.KHOXUAT_ID)            INNER JOIN TM_DUOC d ON (d.DUOC_ID = ctct.DUOC_ID)            INNER JOIN TM_NGUONHANG n ON (n.NGUONDUOC_ID = ctct.NGUONHANG_ID)            LEFT JOIN TM_DONVITINH dvt ON (dvt.DONVITINH_ID = ctct.DONVITINH_ID)            left join TM_LOAIDUOC LD on LD.LOAIDUOC_ID = D.LOAIDUOC_ID            LEFT JOIN TM_NHOMLOAIDUOC NLD on NLD.NHOMLOAIDUOC_ID = LD.NHOMLOAIDUOC_ID             where                             ct.CHUNGTU_ID = '138710'                       and                           ct.BENHVIEN_ID = 'HLU01'                                     order by CHUNGTUCHITIET_ID]
2019-12-23 15:50:16,946 [1] DEBUG - Statement Id: [DAO00030_KiemTraChungTuKhoaSo] PreparedStatement : [SELECT CHUNGTU_ID              FROM TT_DUOC_CHUNGTU              WHERE              MACHUNGTU = 'KHO_NTX081912000001'              and BENHVIEN_ID = 'HLU01'              and              convert(date, NGAYCHUNGTU) <=              (              SELECT TOP 1 convert(date, KHOADENNGAY)              FROM TT_DUOC_KHOASOCHUNGTU              WHERE              KHODUOC_ID = '9'              and BENHVIEN_ID = 'HLU01'              AND KHOASO = '1'              ORDER BY KHOADENNGAY DESC              )]
2019-12-23 15:50:16,992 [1] DEBUG - Statement Id: [DAO00030_KiemTraChungTuDaChuyenKeToan] PreparedStatement : [SELECT CHUNGTU_ID            FROM TT_DUOC_CHUNGTU            WHERE            CHUNGTU_ID = '138710'            and IDCHUYEN IS NOT NULL            and BENHVIEN_ID = 'HLU01']
2019-12-23 15:50:17,028 [1] DEBUG - Statement Id: [DAO00030_KiemTraBenhNhanXuatVien] PreparedStatement : [select              TT.TOATHUOC_ID              from              TT_NOITRU_TOATHUOC TT              inner join TT_NOITRU_KHAMBENH KB on TT.KHAMBENH_ID = KB.KHAMBENH_ID              inner join TT_NOITRU_BENHAN BA on BA.BENHAN_ID = KB.BENHAN_ID              WHERE              BA.TRANGTHAI = 'DAXUATVIEN'              AND TT.CHUNGTU_ID =138710                             union all              select                          VTYT.PHAUTHUAT_VTYT_ID as TOATHUOC_ID                          from                          TT_PHAUTHUAT_VTYT VTYT                          inner join TT_PHAUTHUAT PT on VTYT.PHAUTHUAT_ID = PT.PHAUTHUAT_ID                          inner join TT_NOITRU_BENHAN BA on BA.BENHAN_ID =PT.BENHAN_ID                          WHERE                          BA.TRANGTHAI = 'DAXUATVIEN'                          AND vtyt.CHUNGTU_ID =138710               union all                            select                          VTYT.CLSKETQUA_VTYT_ID as TOATHUOC_ID                          from                          TT_CLSKETQUA_VTYT VTYT                          inner join TT_VIENPHI VP on vtyt.CLSKETQUA_VTYT_ID=VP.REF_ID and vp.REF_TABLE='TT_CLSKETQUA_VTYT'                          inner join TT_NOITRU_BENHAN BA on BA.BENHAN_ID =vp.BENHAN_ID                          WHERE                          BA.TRANGTHAI = 'DAXUATVIEN'                          AND vtyt.CHUNGTU_ID =138710              union all                            select                          VTYT.KHAMBENH_VTYT_ID as TOATHUOC_ID                          from                          TT_NGOAITRU_KHAMBENH_VTYT VTYT                          inner join TT_VIENPHI VP on vtyt.KHAMBENH_VTYT_ID=VP.REF_ID and vp.REF_TABLE='TT_NGOAITRU_KHAMBENH_VTYT'                          inner join TT_NOITRU_BENHAN BA on BA.BENHAN_ID =vp.BENHAN_ID                          WHERE                          BA.TRANGTHAI = 'DAXUATVIEN'                          AND vtyt.CHUNGTU_ID =  138710]
2019-12-23 15:50:17,627 [1] DEBUG - Statement Id: [DAO00030_GetPhamViByKhoDuoc] PreparedStatement : [SELECT DISTINCT pv.PHAMVI_ID          FROM TM_DUOC_PHAMVISD_MAPPING mp          INNER JOIN TM_DUOC_PHAMVISUDUNG pv ON mp.PHAMVI_ID = pv.PHAMVI_ID          WHERE          mp.KHODUOC_ID IN (9)          AND mp.BENHVIEN_ID ='HLU01'          AND mp.TAMNGUNG = '0'          AND pv.TAMNGUNG = '0']
2019-12-23 15:50:17,657 [1] DEBUG - Statement Id: [DAO00030_DUOCTONKHO_GetSoTonTheoDuoc] PreparedStatement : [SELECT              DUOC_ID,              SUM(SOLUONG) AS TONGTON              FROM              TT_DUOC_TONKHO              WHERE              KHODUOC_ID = '9'              and BENHVIEN_ID = 'HLU01'              and DUOC_ID IN (1013)              GROUP BY DUOC_ID]
2019-12-23 15:50:17,683 [1] DEBUG - Statement Id: [DAO00030_DUOCTONKHO_GetSoTonTheoDuocTheoLo] PreparedStatement : [SELECT              DUOC_ID,SOLONHAP_ID,              SUM(SOLUONG) AS SOLUONGTONLO              FROM              TT_DUOC_TONKHO              WHERE              KHODUOC_ID = '9'              and BENHVIEN_ID = 'HLU01'              and DUOC_ID IN (1013)              and SOLONHAP_ID IN (1648)              GROUP BY DUOC_ID, SOLONHAP_ID]
2019-12-23 15:50:17,712 [1] DEBUG - Statement Id: [DAO00030_GetPhamViByKhoDuoc] PreparedStatement : [SELECT DISTINCT pv.PHAMVI_ID          FROM TM_DUOC_PHAMVISD_MAPPING mp          INNER JOIN TM_DUOC_PHAMVISUDUNG pv ON mp.PHAMVI_ID = pv.PHAMVI_ID          WHERE          mp.KHODUOC_ID IN (9)          AND mp.BENHVIEN_ID ='HLU01'          AND mp.TAMNGUNG = '0'          AND pv.TAMNGUNG = '0']
2019-12-23 15:50:17,736 [1] DEBUG - Statement Id: [DAO00030_DUOCTONKHO_GetSoTonTheoDuoc] PreparedStatement : [SELECT              DUOC_ID,              SUM(SOLUONG) AS TONGTON              FROM              TT_DUOC_TONKHO              WHERE              KHODUOC_ID = '9'              and BENHVIEN_ID = 'HLU01'              and DUOC_ID IN (1013)              GROUP BY DUOC_ID]
2019-12-23 15:50:17,766 [1] DEBUG - Statement Id: [DAO00030_KTDaPhatSinhBienLai] PreparedStatement : [SELECT CHUNGTU_ID            FROM TT_NOITRU_TOATHUOC tt            INNER JOIN TT_VIENPHI vp on (tt.TOATHUOC_ID = vp.REF_ID and REF_TABLE = 'TT_NOITRU_TOATHUOC')            WHERE            CHUNGTU_ID = '138710'            AND tt.BENHVIEN_ID = 'HLU01'            AND HOADON_ID is not NULL            AND vp.HUY = '0'              union all            SELECT  kbtt.CHUNGTUPHATTHUOC_ID as CHUNGTU_ID            FROM TT_NGOAITRU_TOATHUOC tt            INNER JOIN TT_NGOAITRU_KHAMBENH_TOATHUOC kbtt on (kbtt.KHAMBENH_TOATHUOC_ID = tt.KHAMBENH_TOATHUOC_ID)            INNER JOIN TT_VIENPHI vp on (tt.TOATHUOC_ID = vp.REF_ID and REF_TABLE = 'TT_NGOAITRU_TOATHUOC')            WHERE            kbtt.CHUNGTUPHATTHUOC_ID = '138710'            AND tt.BENHVIEN_ID = 'HLU01'            AND HOADON_ID is not NULL            AND vp.HUY = '0'              union all            SELECT ctct.CHUNGTU_ID from            TT_DUOC_CHUNGTU_CHITIET ctct            INNER JOIN TT_HOADON_CHITIET_NGOAITRU hdct on (hdct.REF_ID = ctct.CHUNGTUCHITIET_ID and hdct.REF_TABLE = 'TT_DUOC_CHUNGTU_CHITIET')            INNER JOIN TT_HOADON hd on hd.HOADON_ID = hdct.HOADON_ID            WHERE            ctct.CHUNGTU_ID = '138710'                            AND hd.HUYHOADON = '0'              AND hd.HOANTRA = '0'                                  AND ctct.BENHVIEN_ID = 'HLU01'                        union all            SELECT CHUNGTU_ID            FROM TT_NGOAITRU_KHAMBENH_VTYT tt            INNER JOIN TT_VIENPHI vp on (tt.KHAMBENH_VTYT_ID = vp.REF_ID and REF_TABLE = 'TT_NGOAITRU_KHAMBENH_VTYT')            WHERE            CHUNGTU_ID = '138710'            AND tt.BENHVIEN_ID = 'HLU01'            AND HOADON_ID is not NULL            AND vp.HUY = '0'                        union all            SELECT CHUNGTU_ID            FROM TT_PHAUTHUAT_VTYT tt            INNER JOIN TT_VIENPHI vp on (tt.PHAUTHUAT_VTYT_ID = vp.REF_ID and REF_TABLE = 'TT_PHAUTHUAT_VTYT')            WHERE            CHUNGTU_ID = '138710'            AND tt.BENHVIEN_ID = 'HLU01'            AND HOADON_ID is not NULL            AND vp.HUY = '0'                        union all            SELECT CHUNGTU_ID            FROM TT_CLSKETQUA_VTYT tt            INNER JOIN TT_VIENPHI vp on (tt.CLSKETQUA_VTYT_ID = vp.REF_ID and REF_TABLE = 'TT_CLSKETQUA_VTYT')            WHERE            CHUNGTU_ID = '138710'            AND tt.BENHVIEN_ID = 'HLU01'            AND HOADON_ID is not NULL            AND vp.HUY = '0']
2019-12-23 15:50:24,144 [1] DEBUG - Statement Id: [DAO00030_KTDaPhatSinhPhieuBHTN] PreparedStatement : [SELECT vp.VIENPHI_ID              FROM TT_VIENPHI vp              INNER JOIN TT_MIENGIAM_CHITIET  mgct on mgct.VIENPHI_ID = vp.VIENPHI_ID              INNER JOIN TT_DUOC_CHUNGTU ct on ct.TIEPNHAN_ID = vp.TIEPNHAN_ID              WHERE              ct.CHUNGTU_ID = '138710'              AND vp.DUOC_ID is not null              AND vp.BENHVIEN_ID = 'HLU01']
2019-12-23 15:50:24,247 [1] DEBUG - Statement Id: [DAO00116_File_GetList] PreparedStatement : [select *              from TT_FILE_DINHKEM               where                             TT_FILE_DINHKEM.REF_TABLE = 'TT_DUOC_CHUNGTU'                       and                           TT_FILE_DINHKEM.REF_ID = '138710'                       and                           TT_FILE_DINHKEM.BENHVIEN_ID = 'HLU01'                                     order by FILE_ID]
2019-12-23 15:50:24,450 [1] DEBUG - Statement Id: [DAO00030_KTDaPhatSinhBienLai] PreparedStatement : [SELECT CHUNGTU_ID            FROM TT_NOITRU_TOATHUOC tt            INNER JOIN TT_VIENPHI vp on (tt.TOATHUOC_ID = vp.REF_ID and REF_TABLE = 'TT_NOITRU_TOATHUOC')            WHERE            CHUNGTU_ID = '138710'            AND tt.BENHVIEN_ID = 'HLU01'            AND HOADON_ID is not NULL            AND vp.HUY = '0'              union all            SELECT  kbtt.CHUNGTUPHATTHUOC_ID as CHUNGTU_ID            FROM TT_NGOAITRU_TOATHUOC tt            INNER JOIN TT_NGOAITRU_KHAMBENH_TOATHUOC kbtt on (kbtt.KHAMBENH_TOATHUOC_ID = tt.KHAMBENH_TOATHUOC_ID)            INNER JOIN TT_VIENPHI vp on (tt.TOATHUOC_ID = vp.REF_ID and REF_TABLE = 'TT_NGOAITRU_TOATHUOC')            WHERE            kbtt.CHUNGTUPHATTHUOC_ID = '138710'            AND tt.BENHVIEN_ID = 'HLU01'            AND HOADON_ID is not NULL            AND vp.HUY = '0'              union all            SELECT ctct.CHUNGTU_ID from            TT_DUOC_CHUNGTU_CHITIET ctct            INNER JOIN TT_HOADON_CHITIET_NGOAITRU hdct on (hdct.REF_ID = ctct.CHUNGTUCHITIET_ID and hdct.REF_TABLE = 'TT_DUOC_CHUNGTU_CHITIET')            INNER JOIN TT_HOADON hd on hd.HOADON_ID = hdct.HOADON_ID            WHERE            ctct.CHUNGTU_ID = '138710'                            AND hd.HUYHOADON = '0'              AND hd.HOANTRA = '0'                                  AND ctct.BENHVIEN_ID = 'HLU01'                        union all            SELECT CHUNGTU_ID            FROM TT_NGOAITRU_KHAMBENH_VTYT tt            INNER JOIN TT_VIENPHI vp on (tt.KHAMBENH_VTYT_ID = vp.REF_ID and REF_TABLE = 'TT_NGOAITRU_KHAMBENH_VTYT')            WHERE            CHUNGTU_ID = '138710'            AND tt.BENHVIEN_ID = 'HLU01'            AND HOADON_ID is not NULL            AND vp.HUY = '0'                        union all            SELECT CHUNGTU_ID            FROM TT_PHAUTHUAT_VTYT tt            INNER JOIN TT_VIENPHI vp on (tt.PHAUTHUAT_VTYT_ID = vp.REF_ID and REF_TABLE = 'TT_PHAUTHUAT_VTYT')            WHERE            CHUNGTU_ID = '138710'            AND tt.BENHVIEN_ID = 'HLU01'            AND HOADON_ID is not NULL            AND vp.HUY = '0'                        union all            SELECT CHUNGTU_ID            FROM TT_CLSKETQUA_VTYT tt            INNER JOIN TT_VIENPHI vp on (tt.CLSKETQUA_VTYT_ID = vp.REF_ID and REF_TABLE = 'TT_CLSKETQUA_VTYT')            WHERE            CHUNGTU_ID = '138710'            AND tt.BENHVIEN_ID = 'HLU01'            AND HOADON_ID is not NULL            AND vp.HUY = '0']
2019-12-23 15:51:49,034 [1] DEBUG - Statement Id: [DAO00001_DBList] PreparedStatement : [select *              from TM_SYS_SERVER              where HOSPITAL_ID = '_SYSTEM_' and TYPE = 'D']
2019-12-23 15:51:49,513 [1] DEBUG - Statement Id: [DAO00001_DaoList] PreparedStatement : [select              TM_SYS_SERVICEMAP.ID,              TM_SYS_SERVICEMAP.HOSPITAL_ID,              TM_SYS_SERVICEMAP.DB_NAME,              TM_SYS_SERVICEMAP.TYPE,              TM_SYS_SERVICEMAP.NAME,              TM_SYS_SERVICEMAP.CLASS,              (TM_SYS_DIC.VALUE + '.' + TM_SYS_SERVICEMAP.CLASS) as CLASSFULL,              TM_SYS_SERVICEMAP.ASSEMBLY              from TM_SYS_SERVICEMAP              inner join TM_SYS_DIC              on TM_SYS_SERVICEMAP.NAMESPACE = TM_SYS_DIC.ID              where HOSPITAL_ID = '_SYSTEM_' AND TYPE = 'D' AND ACTIVE = '1'              order by DB_NAME]
2019-12-23 15:51:49,558 [1] DEBUG - Statement Id: [DAO00001_ServiceList] PreparedStatement : [select              TM_SYS_SERVICEMAP.ID,              TM_SYS_SERVICEMAP.HOSPITAL_ID,              TM_SYS_SERVICEMAP.DB_NAME,              TM_SYS_SERVICEMAP.TYPE,              TM_SYS_SERVICEMAP.NAME,              TM_SYS_SERVICEMAP.CLASS,              (TM_SYS_DIC.VALUE + '.' + TM_SYS_SERVICEMAP.CLASS) as CLASSFULL,              TM_SYS_SERVICEMAP.ASSEMBLY,              TM_SYS_SERVER.URL              from TM_SYS_SERVICEMAP              inner join TM_SYS_DIC on TM_SYS_SERVICEMAP.NAMESPACE = TM_SYS_DIC.ID              inner join TM_SYS_SERVER on (TM_SYS_SERVICEMAP.DB_NAME = TM_SYS_SERVER.NAME) and (TM_SYS_SERVER.HOSPITAL_ID = '_SYSTEM_')              where TM_SYS_SERVICEMAP.HOSPITAL_ID = '_SYSTEM_' AND TM_SYS_SERVICEMAP.TYPE = 'S'  AND ACTIVE = '1'              order by URL]
2019-12-23 15:51:49,677 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = '_SYSTEM_'               AND                   TM_SYS_SCREEN.PAGE = 'LOGIN'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2019-12-23 15:51:49,750 [1] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = '_SYSTEM_'               AND                   TM_SYS_CACHE.ACTIVE = '1']
2019-12-23 15:52:12,290 [1] DEBUG - Statement Id: [DAO00001_DBList] PreparedStatement : [select *              from TM_SYS_SERVER              where HOSPITAL_ID = 'HLU01' and TYPE = 'D']
2019-12-23 15:52:12,319 [1] DEBUG - Statement Id: [DAO00001_DaoList] PreparedStatement : [select              TM_SYS_SERVICEMAP.ID,              TM_SYS_SERVICEMAP.HOSPITAL_ID,              TM_SYS_SERVICEMAP.DB_NAME,              TM_SYS_SERVICEMAP.TYPE,              TM_SYS_SERVICEMAP.NAME,              TM_SYS_SERVICEMAP.CLASS,              (TM_SYS_DIC.VALUE + '.' + TM_SYS_SERVICEMAP.CLASS) as CLASSFULL,              TM_SYS_SERVICEMAP.ASSEMBLY              from TM_SYS_SERVICEMAP              inner join TM_SYS_DIC              on TM_SYS_SERVICEMAP.NAMESPACE = TM_SYS_DIC.ID              where HOSPITAL_ID = 'HLU01' AND TYPE = 'D' AND ACTIVE = '1'              order by DB_NAME]
2019-12-23 15:52:13,585 [1] DEBUG - Statement Id: [DAO00001_ServiceList] PreparedStatement : [select              TM_SYS_SERVICEMAP.ID,              TM_SYS_SERVICEMAP.HOSPITAL_ID,              TM_SYS_SERVICEMAP.DB_NAME,              TM_SYS_SERVICEMAP.TYPE,              TM_SYS_SERVICEMAP.NAME,              TM_SYS_SERVICEMAP.CLASS,              (TM_SYS_DIC.VALUE + '.' + TM_SYS_SERVICEMAP.CLASS) as CLASSFULL,              TM_SYS_SERVICEMAP.ASSEMBLY,              TM_SYS_SERVER.URL              from TM_SYS_SERVICEMAP              inner join TM_SYS_DIC on TM_SYS_SERVICEMAP.NAMESPACE = TM_SYS_DIC.ID              inner join TM_SYS_SERVER on (TM_SYS_SERVICEMAP.DB_NAME = TM_SYS_SERVER.NAME) and (TM_SYS_SERVER.HOSPITAL_ID = 'HLU01')              where TM_SYS_SERVICEMAP.HOSPITAL_ID = 'HLU01' AND TM_SYS_SERVICEMAP.TYPE = 'S'  AND ACTIVE = '1'              order by URL]
2019-12-23 15:52:13,673 [16] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1']
2019-12-23 15:52:14,246 [16] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM005']
2019-12-23 15:52:14,385 [16] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM015']
2019-12-23 15:52:14,467 [16] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM067']
2019-12-23 15:52:14,544 [16] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM008']
2019-12-23 15:52:14,622 [16] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM068']
2019-12-23 15:52:14,709 [16] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM006']
2019-12-23 15:52:14,830 [16] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM030']
2019-12-23 15:52:15,211 [16] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM025']
2019-12-23 15:52:15,309 [16] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM024']
2019-12-23 15:52:15,787 [16] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM033']
2019-12-23 15:52:15,829 [16] DEBUG - Statement Id: [DAO00027_GetListDuocKyGuiTonKho] PreparedStatement : [select  distinct TT_TONKHO.DUOC_KEY, LTRIM(TT_TONKHO.KHODUOC_ID) as KHODUOC_ID, TM_DUOC.DUOC_ID, TM_LOAIDUOC.MALOAIDUOC,TM_DUOC.SOVISA,TM_DUOC.TYLE_VAT,TM_DUOC.COTOA,        TM_DUOC.MADUOC, TM_DUOC.TENHANG, TM_DUOC.TENDUOCDAYDU, dvt.TENDONVITINH as DONVITINH,  TM_DUOC.DONVITINH_ID,TM_DUOC.BHYT,TM_DUOC.PHAMVI,        TM_DUOC.TENHOATCHAT, TM_DUOC.HAMLUONG, TM_DUOC.HANGSANXUAT, TM_DUOC.QUOCGIA, TM_DUOC.LOAIDUOC_ID, TM_DUOC.DUONGDUNG_ID,        TM_TENDUOC.TENDUOC, TM_TENDUOC.TENDUOC_EN, TM_TENDUOC.MAQUOCTE, TM_TENDUOC.MAQUOCTEBT,        TM_LOAIDUOC.LOAIVATTU_ID, TM_DUOC.BENHVIEN_ID,TT_TONKHO.SOLUONG, TT_TONKHO.NGUONDUOC_ID, NH.TENNGUONDUOC        , TAMNGUNG = CASE WHEN TM_DUOC.TAMNGUNG = '1' OR nh.TAMNGUNG = '1' OR KD.TAMNGUNG = '1' THEN '1' ELSE '0' END        , TM_DUOC.DANGTRINHBAY        from TM_DUOC        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = TM_DUOC.DONVITINH_ID        left join TM_TENDUOC on TM_DUOC.TENDUOC_ID = TM_TENDUOC.TENDUOC_ID and TM_DUOC.BENHVIEN_ID = 'HLU01' and TM_DUOC.TAMNGUNG = '0'        left join TM_LOAIDUOC on TM_LOAIDUOC.LOAIDUOC_ID = TM_DUOC.LOAIDUOC_ID and TM_LOAIDUOC.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG on (TM_LOAIDUOC.LOAIVATTU_ID = TM_DUOC_HANDUNG.LOAIDUOC and TM_DUOC_HANDUNG.BENHVIEN_ID = 'HLU01')        inner join        (select LTRIM(A.KHODUOC_ID) + '_' + LTRIM(A.DUOC_ID) + '_' + LTRIM(ISNULL(A.NGUONDUOC_ID,'')) as DUOC_KEY, A.KHODUOC_ID, A.DUOC_ID,A.NGUONDUOC_ID,        SUM(isnull(A.SOLUONG,0)) as SOLUONG        from        (select SUM(SOLUONG) as SOLUONG, KHODUOC_ID, DUOC_ID, NGUONDUOC_ID from TT_DUOC_KYGUI_TONKHO        where BENHVIEN_ID = 'HLU01' group by KHODUOC_ID, DUOC_ID, NGUONDUOC_ID) A        group by LTRIM(A.KHODUOC_ID) + '_' + LTRIM(A.DUOC_ID) + '_' + LTRIM(A.NGUONDUOC_ID), A.KHODUOC_ID, A.DUOC_ID, A.NGUONDUOC_ID)        TT_TONKHO on TT_TONKHO.DUOC_ID = TM_DUOC.DUOC_ID        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = TT_TONKHO.NGUONDUOC_ID and nh.BENHVIEN_ID = 'HLU01'        LEFT JOIN TM_KHODUOC KD ON KD.KHODUOC_ID = TT_TONKHO.KHODUOC_ID        where TM_DUOC.BENHVIEN_ID = 'HLU01' AND TT_TONKHO.SOLUONG >= 0]
2019-12-23 15:52:15,901 [16] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM018']
2019-12-23 15:52:15,943 [16] DEBUG - Statement Id: [DAO00027_GetListDuocTonKho] PreparedStatement : [select distinct TT_TONKHO.DUOC_KEY, LTRIM(TT_TONKHO.KHODUOC_ID) as KHODUOC_ID, TM_DUOC.DUOC_ID, TM_LOAIDUOC.MALOAIDUOC,TM_DUOC.SOVISA,TM_DUOC.TYLE_VAT,TM_DUOC.COTOA,        TM_DUOC.MADUOC, TM_DUOC.TENHANG, TM_DUOC.TENDUOCDAYDU, dvt.TENDONVITINH as DONVITINH,  TM_DUOC.DONVITINH_ID,TM_DUOC.BHYT,                TM_DUOC.TENHOATCHAT,          TM_DUOC.HAMLUONG, TM_DUOC.HANGSANXUAT, TM_DUOC.QUOCGIA, TM_DUOC.LOAIDUOC_ID, TM_DUOC.DUONGDUNG_ID,        TM_TENDUOC.TENDUOC, TM_TENDUOC.TENDUOC_EN, TM_TENDUOC.MAQUOCTE, TM_TENDUOC.MAQUOCTEBT,        TM_LOAIDUOC.LOAIVATTU_ID, TM_DUOC.BENHVIEN_ID,        TT_TONKHO.SOLUONG, TM_DUOC.VTYT_PHANLOAI, TM_DUOC.PHAMVI, TT_TONKHO.NGUONDUOC_ID, NG.TENNGUONDUOC AS TENNGUONDUOC        , TAMNGUNG = CASE WHEN TM_DUOC.TAMNGUNG = '1' OR NG.TAMNGUNG = '1' OR KD.TAMNGUNG = '1' THEN '1' ELSE '0' END        , TM_DUOC.DANGTRINHBAY        from TM_DUOC        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = TM_DUOC.DONVITINH_ID        left join TM_TENDUOC on TM_DUOC.TENDUOC_ID = TM_TENDUOC.TENDUOC_ID and TM_DUOC.BENHVIEN_ID = 'HLU01' and TM_DUOC.TAMNGUNG = '0'        left join TM_LOAIDUOC on TM_LOAIDUOC.LOAIDUOC_ID = TM_DUOC.LOAIDUOC_ID and TM_LOAIDUOC.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG on (TM_LOAIDUOC.LOAIVATTU_ID = TM_DUOC_HANDUNG.LOAIDUOC and TM_DUOC_HANDUNG.BENHVIEN_ID = 'HLU01')        inner join        (select LTRIM(A.KHODUOC_ID) + '_' + LTRIM(A.DUOC_ID) + '_' + LTRIM(ISNULL(A.NGUONDUOC_ID,'')) as DUOC_KEY, A.KHODUOC_ID, A.DUOC_ID, A.NGUONDUOC_ID,        SUM(isnull(A.SOLUONG,0)) as SOLUONG        from        (select SUM(SOLUONG) as SOLUONG, KHODUOC_ID, DUOC_ID, NGUONDUOC_ID from TT_DUOC_TONKHO        where BENHVIEN_ID = 'HLU01' group by KHODUOC_ID, DUOC_ID, NGUONDUOC_ID) A        group by LTRIM(A.KHODUOC_ID) + '_' + LTRIM(A.DUOC_ID) + '_' + LTRIM(ISNULL(A.NGUONDUOC_ID,'')), A.KHODUOC_ID, A.DUOC_ID, NGUONDUOC_ID        ) TT_TONKHO on TT_TONKHO.DUOC_ID = TM_DUOC.DUOC_ID        LEFT JOIN TM_NGUONHANG NG ON NG.NGUONDUOC_ID = TT_TONKHO.NGUONDUOC_ID        LEFT JOIN TM_KHODUOC KD ON KD.KHODUOC_ID = TT_TONKHO.KHODUOC_ID        where TM_DUOC.BENHVIEN_ID = 'HLU01' and TT_TONKHO.SOLUONG >= 0]
2019-12-23 15:52:24,506 [16] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM023']
2019-12-23 15:52:24,570 [16] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoVaBooking] PreparedStatement : [declare @NGUONDUOC_MACDINH varchar(5) = '0';        declare @TOAMUANGOAI int = 0;        select @NGUONDUOC_MACDINH = isnull(VALUE,0) from TM_SYS_APPSETTINGS where CODE = 'PHA_NGUONDUOC'        select @TOAMUANGOAI = isnull(VALUE,0) from TM_SYS_APPSETTINGS where CODE = 'OPD_TOAMUANGOAI_DUNGDANHMUC_DUOC'                if @TOAMUANGOAI = 1        begin        select  distinct '0' + '_' + LTRIM(d.DUOC_ID) + '_' + @NGUONDUOC_MACDINH as DUOC_KEY, 0 as PHAMVI_ID, @NGUONDUOC_MACDINH as NGUONDUOC_ID, null as TENNGUONDUOC, null as TINHTIEN, d.DUOC_ID, ld.MALOAIDUOC,        d.SOVISA,d.TYLE_VAT,d.COTOA, d.MADUOC, d.TENHANG, d.TENDUOCDAYDU, d.DONVITINH as DONVITINH, d.BHYT,        d.TENHOATCHAT, d.HAMLUONG, d.HANGSANXUAT, d.QUOCGIA, d.LOAIDUOC_ID, d.DUONGDUNG_ID, d.TINHTIEN_PTTT,        ten.TENDUOC, ten.TENDUOC_EN, ten.MAQUOCTE, ten.MAQUOCTEBT,d.CONGDUNG,        '' as BHYT_TEXT        , ld.LOAIVATTU_ID        , d.BENHVIEN_ID,        999999999 as SOLUONG, d.VTYT_PHANLOAI, d.PHAMVI, d.SUASOLUONGTONGHOP, d.MADUOCBV, d.DANGTRINHBAY        , TAMNGUNG = CASE WHEN d.TAMNGUNG = '1' THEN '1' ELSE '0' END        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        union all        select  distinct tk.DUOC_KEY, LTRIM(tk.PHAMVI_ID) as PHAMVI_ID, tk.NGUONDUOC_ID, nh.TENNGUONDUOC, nh.TINHTIEN, d.DUOC_ID, ld.MALOAIDUOC,        d.SOVISA,d.TYLE_VAT,d.COTOA, d.MADUOC, d.TENHANG, d.TENDUOCDAYDU, d.DONVITINH as DONVITINH, d.BHYT,        d.TENHOATCHAT, d.HAMLUONG, d.HANGSANXUAT, d.QUOCGIA, d.LOAIDUOC_ID, d.DUONGDUNG_ID, d.TINHTIEN_PTTT,        ten.TENDUOC, ten.TENDUOC_EN, ten.MAQUOCTE, ten.MAQUOCTEBT,d.CONGDUNG,        CASE WHEN d.BHYT = '1' THEN 'BHYT' ELSE '' END as BHYT_TEXT        , ld.LOAIVATTU_ID        , d.BENHVIEN_ID,        tk.SOLUONG, d.VTYT_PHANLOAI, d.PHAMVI, d.SUASOLUONGTONGHOP, d.MADUOCBV, d.DANGTRINHBAY        , TAMNGUNG = CASE WHEN d.TAMNGUNG = '1' OR nh.TAMNGUNG = '1' OR kd.TAMNGUNG = '1' THEN '1' ELSE '0' END        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        inner join        (        select  LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')) DUOC_KEY, (SUM(dtk.SOLUONG) - isnull(sum(A.SOLUONG),0) - isnull(sum(B.SOLUONG),0)) SOLUONG, pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        from (select sum(soluong) soluong,duoc_id,nguonduoc_id,khoduoc_id,benhvien_id from TT_DUOC_TONKHO  group by duoc_id,nguonduoc_id,khoduoc_id,benhvien_id) dtk        inner join TM_DUOC_PHAMVISD_MAPPING pvsd on dtk.KHODUOC_ID = pvsd.KHODUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NOITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) B on B.DUOC_ID = dtk.DUOC_ID and B.SOLUONG > 0 and B.PHAMVI_ID = pvsd.PHAMVI_ID and B.NGUONHANG_ID = dtk.NGUONDUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NGOAITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) A on A.DUOC_ID = dtk.DUOC_ID and A.SOLUONG > 0 and A.PHAMVI_ID = pvsd.PHAMVI_ID and A.NGUONHANG_ID = dtk.NGUONDUOC_ID        where dtk.SOLUONG > 0 and dtk.BENHVIEN_ID = 'HLU01'        group by LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')), pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        ) tk on tk.DUOC_ID = d.DUOC_ID        left join TM_DUOC_PHAMVISUDUNG kd on kd.PHAMVI_ID = tk.PHAMVI_ID and kd.BENHVIEN_ID = 'HLU01'        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = tk.NGUONDUOC_ID and nh.BENHVIEN_ID = 'HLU01'        where d.BENHVIEN_ID = 'HLU01'  and tk.SOLUONG >= 0        end        else        begin                  select  distinct tk.DUOC_KEY, LTRIM(tk.PHAMVI_ID) as PHAMVI_ID, tk.NGUONDUOC_ID, nh.TENNGUONDUOC, nh.TINHTIEN, d.DUOC_ID, ld.MALOAIDUOC,        d.SOVISA,d.TYLE_VAT,d.COTOA, d.MADUOC, d.TENHANG, d.TENDUOCDAYDU, d.DONVITINH as DONVITINH, d.BHYT,        d.TENHOATCHAT, d.HAMLUONG, d.HANGSANXUAT, d.QUOCGIA, d.LOAIDUOC_ID, d.DUONGDUNG_ID, d.TINHTIEN_PTTT,        ten.TENDUOC, ten.TENDUOC_EN, ten.MAQUOCTE, ten.MAQUOCTEBT,d.CONGDUNG,        CASE WHEN d.BHYT = '1' THEN 'BHYT' ELSE '' END as BHYT_TEXT        , ld.LOAIVATTU_ID        , d.BENHVIEN_ID,        tk.SOLUONG, d.VTYT_PHANLOAI, d.PHAMVI, d.SUASOLUONGTONGHOP, d.MADUOCBV, d.DANGTRINHBAY        , TAMNGUNG = CASE WHEN d.TAMNGUNG = '1' OR nh.TAMNGUNG = '1' OR kd.TAMNGUNG = '1' THEN '1' ELSE '0' END        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        inner join        (        select  LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')) DUOC_KEY, (SUM(dtk.SOLUONG) - isnull(sum(A.SOLUONG),0) - isnull(sum(B.SOLUONG),0)) SOLUONG, pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        from (select sum(soluong) soluong,duoc_id,nguonduoc_id,khoduoc_id,benhvien_id from TT_DUOC_TONKHO  group by duoc_id,nguonduoc_id,khoduoc_id,benhvien_id) dtk        inner join TM_DUOC_PHAMVISD_MAPPING pvsd on dtk.KHODUOC_ID = pvsd.KHODUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NOITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) B on B.DUOC_ID = dtk.DUOC_ID and B.SOLUONG > 0 and B.PHAMVI_ID = pvsd.PHAMVI_ID and B.NGUONHANG_ID = dtk.NGUONDUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NGOAITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) A on A.DUOC_ID = dtk.DUOC_ID and A.SOLUONG > 0 and A.PHAMVI_ID = pvsd.PHAMVI_ID and A.NGUONHANG_ID = dtk.NGUONDUOC_ID        where dtk.SOLUONG > 0 and dtk.BENHVIEN_ID = 'HLU01'        group by LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')), pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        ) tk on tk.DUOC_ID = d.DUOC_ID        left join TM_DUOC_PHAMVISUDUNG kd on kd.PHAMVI_ID = tk.PHAMVI_ID and kd.BENHVIEN_ID = 'HLU01'        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = tk.NGUONDUOC_ID and nh.BENHVIEN_ID = 'HLU01'        where d.BENHVIEN_ID = 'HLU01'  and tk.SOLUONG >= 0        end]
2019-12-23 15:52:26,904 [16] DEBUG - Statement Id: [DAO00320_GetList] PreparedStatement : [select M.*            from TM_MAU M            LEFT JOIN TM_MAU_DONVITINH DVT on M.DONVITINH_ID=DVT.DONVITINH_ID            where            M.TAMNGUNG = '0'            and M.BENHVIEN_ID = 'HLU01'            order by M.TENMAU]
2019-12-23 15:52:26,978 [16] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM071']
2019-12-23 15:52:27,010 [16] DEBUG - Statement Id: [DAO00322_GetListMauTonKhoForCreateCached] PreparedStatement : [SELECT DISTINCT        TK.MAU_KEY, TK.KHOMAU_ID, M.MAU_ID, M.MAMAU, M.TENMAU, M.NHOM_ABO, M.NHOM_RH, M.LOAIMAU_ID,        TK.SOLONHAP_ID, SLN.SOLONHAP, SLN.SOKIEMSOAT, TK.NGUONHANG_ID, NG.TENNGUONMAU, M.BENHVIEN_ID, M.DONVITINH_ID,        SUM(tk.SOLUONG) AS SOLUONG,K.TENKHO,DVT.TENDONVITINH        FROM TT_MAU_TONKHO TK        JOIN TM_KHO K ON TK.KHOMAU_ID = K.KHO_ID        JOIN TT_MAU_CHUNGTU_SOLONHAP SLN ON TK.SOLONHAP_ID = SLN.SOLONHAP_ID        JOIN TM_MAU M on TK.MAU_ID = M.MAU_ID and M.TAMNGUNG = '0'        LEFT JOIN TM_MAU_DONVITINH DVT on M.DONVITINH_ID=DVT.DONVITINH_ID        LEFT JOIN TM_NGUONMAU NG ON NG.NGUONMAU_ID = TK.NGUONHANG_ID        WHERE TK.SOLUONG > 0        GROUP BY TK.MAU_KEY, TK.KHOMAU_ID, M.MAU_ID, M.MAMAU, M.TENMAU, M.NHOM_ABO, M.NHOM_RH, M.LOAIMAU_ID,        TK.SOLONHAP_ID, SLN.SOLONHAP, SLN.SOKIEMSOAT,TK.NGUONHANG_ID, NG.TENNGUONMAU, M.BENHVIEN_ID, M.DONVITINH_ID,K.TENKHO,DVT.TENDONVITINH]
2019-12-23 15:52:27,134 [16] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM073']
2019-12-23 15:52:27,164 [16] DEBUG - Statement Id: [DAO00322_GetListMauTonKhoTruBooking] PreparedStatement : [select distinct        TK.MAU_KEY, TK.KHOMAU_ID, M.MAU_ID, M.MAMAU, M.TENMAU, M.NHOM_ABO, M.NHOM_RH, M.LOAIMAU_ID, M.DONVITINH_ID,        TK.SOLONHAP_ID, TK.SOLONHAP, TK.SOKIEMSOAT,M.PHAMVI, TK.NGUONHANG_ID, NG.TENNGUONMAU, M.BENHVIEN_ID,        TK.SOLUONG,TK.TENKHO,DVT.TENDONVITINH        from TM_MAU M        JOIN        (        select        A.MAU_KEY, A.KHOMAU_ID, A.MAU_ID ,a.NGUONHANG_ID, A.SOLONHAP_ID, A.SOLONHAP, A.SOKIEMSOAT, A.SOLUONG,A.TENKHO        from        (        select KHOMAU_ID, TK.MAU_ID, TK.NGUONHANG_ID, TK.MAU_KEY, SLN.SOLONHAP_ID, SLN.SOLONHAP, SLN.SOKIEMSOAT, ISNULL(TK.SOLUONG,0) - ISNULL(book.SOLUONG,0) as SOLUONG,K.TENKHO        from TT_MAU_TONKHO TK        JOIN TM_KHO K ON TK.KHOMAU_ID = K.KHO_ID        inner join TT_MAU_CHUNGTU_SOLONHAP SLN ON TK.SOLONHAP_ID = SLN.SOLONHAP_ID        left join dbo.TT_MAU_TONKHO_BOOK book ON book.MAU_KEY = TK.MAU_KEY AND book.TRANGTHAI = 'HIEULUC'        where ISNULL(TK.SOLUONG,0) - ISNULL(book.SOLUONG,0) > 0        ) A        )TK on TK.MAU_ID = M.MAU_ID and M.TAMNGUNG = '0'        LEFT JOIN TM_MAU_DONVITINH DVT on M.DONVITINH_ID=DVT.DONVITINH_ID        LEFT JOIN TM_NGUONMAU NG ON NG.NGUONMAU_ID = TK.NGUONHANG_ID]
2019-12-23 15:52:27,236 [16] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM072']
2019-12-23 15:52:28,171 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'MAIN'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2019-12-23 15:52:28,244 [1] DEBUG - Statement Id: [DAO00002_FormList] PreparedStatement : [select              TM_SYS_FORM.HOSPITAL_ID,              TM_SYS_FORM.NAME,              TM_SYS_FORM.CLASS,              TM_SYS_FORM.ASSEMBLY,              TM_SYS_FORM.TITLE_VI as TITLE              from TM_SYS_FORM              where HOSPITAL_ID = 'HLU01']
2019-12-23 15:52:28,289 [1] DEBUG - Statement Id: [DAO00300_GetShortcutListByUserID] PreparedStatement : [SELECT S.SHORTCUT_CODE, S.SHORTCUT_VALUE              FROM TM_SHORTCUT AS S              WHERE S.BENHVIEN_ID = 'HLU01' AND S.USER_ID = '1' AND TAMNGUNG = '0']
2019-12-23 15:52:28,315 [1] DEBUG - Statement Id: [DAO00087_GetList] PreparedStatement : [select CODE, VALUE, BENHVIEN_ID              from TM_SYS_APPSETTINGS              where LOCKED = '0' and BENHVIEN_ID = 'HLU01'              order by SETTING_ID]
2019-12-23 15:52:28,402 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'MSG01'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2019-12-23 15:52:28,501 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'MSG02'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2019-12-23 15:52:28,567 [1] DEBUG - Statement Id: [DAO00008_GetUserSettings] PreparedStatement : [select A.*, B.TENKHO , C.TENPHONGBAN, B.MAKHO, C.MAPHONGBAN          from TM_SYS_USERS A          left join TM_KHODUOC B on B.KHODUOC_ID = A.INVENTORY_ID          left join TM_PHONGBAN C on (C.PHONGBAN_ID = A.WORKING_DEPT_ID and C.BENHVIEN_ID =  @param0 )          left join TM_SYS_USERKHO D on (D.ACCOUNT_ID = A.ACCOUNT_ID and D.HOSPITAL_ID =  @param0 )          where          A.HOSPITAL_ID =  @param0            and                 A.ACCOUNT_ID =  @param1]
2019-12-23 15:52:28,567 [1] DEBUG - Statement Id: [DAO00008_GetUserSettings] Parameters: [@param0=[HOSPITAL_ID,HLU01], @param1=[ACCOUNT_ID,113]]
2019-12-23 15:52:28,568 [1] DEBUG - Statement Id: [DAO00008_GetUserSettings] Types: [@param0=[String, System.String], @param1=[String, System.String]]
2019-12-23 15:52:28,634 [1] DEBUG - Statement Id: [DAO00008_GetUserInvSettings] PreparedStatement : [select A.*, B.TENKHO, B.MAKHO, B.LOAIKHO_ID, B.KHOQUANLY_ID          from TM_SYS_USERKHO A          left join TM_KHO B on B.MODULE_ID = A.MODULE_ID and B.KHO_ID = A.KHO_ID          where A.HOSPITAL_ID =  @param0  and A.ACCOUNT_ID =  @param1           order by B.TENKHO]
2019-12-23 15:52:28,634 [1] DEBUG - Statement Id: [DAO00008_GetUserInvSettings] Parameters: [@param0=[HOSPITAL_ID,HLU01], @param1=[ACCOUNT_ID,113]]
2019-12-23 15:52:28,634 [1] DEBUG - Statement Id: [DAO00008_GetUserInvSettings] Types: [@param0=[String, System.String], @param1=[String, System.String]]
2019-12-23 15:52:28,767 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'COM30'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2019-12-23 15:52:30,111 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'RIS04'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2019-12-23 15:52:39,358 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'MENU1'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2019-12-23 15:52:39,705 [1] DEBUG - Statement Id: [DAO00011_GetList] PreparedStatement : [select              TM_SYS_MENU.ID,              TM_SYS_MENU.PARENTID,              TM_SYS_MENU.SCREEN,              TM_SYS_MENU.SMALLIMAGE,              TM_SYS_MENU.LARGEIMAGE,              TM_SYS_MENU.DESCRIPTION,              TM_SYS_MENU.TYPE,              TM_SYS_MENU.TITLE_VI as TITLE              from TM_SYS_MENU              where TM_SYS_MENU.HOSPITAL_ID = 'HLU01' and TM_SYS_MENU.ACTIVE = '1'               AND                   (TM_SYS_MENU.TYPE & '8' = '8')                             order by TM_SYS_MENU.ORDERNUM]
2019-12-23 15:52:39,988 [1] DEBUG - Statement Id: [DAO00011_usermenu_list] PreparedStatement : [select              TM_SYS_HOMEMENU.MENUID as ID,              TM_SYS_MENU.TITLE_VI as TITLE,              TM_SYS_MENU.SCREEN,              TM_SYS_MENU.SMALLIMAGE,              TM_SYS_MENU.LARGEIMAGE,              TM_SYS_MENU.TYPE              from TM_SYS_HOMEMENU              left join TM_SYS_MENU on TM_SYS_MENU.ID = TM_SYS_HOMEMENU.MENUID and TM_SYS_MENU.HOSPITAL_ID = TM_SYS_HOMEMENU.HOSPITAL_ID              where TM_SYS_HOMEMENU.HOSPITAL_ID = 'HLU01' and TM_SYS_HOMEMENU.USERID = '113' and TM_SYS_MENU.ACTIVE = '1'               AND                   (TM_SYS_MENU.TYPE & '8' = '8')                             ORDER BY TM_SYS_HOMEMENU.ORDERNUM]
2019-12-23 15:52:46,886 [1] DEBUG - Statement Id: [DAO00030_GetMucDichChungTuID] PreparedStatement : [SELECT DICTIONARY_ID              FROM              LST_DICTIONARY              WHERE              DICTIONARY_TYPE_CODE = 'MucDichChungTu'              and DICTIONARY_CODE = 'X08']
2019-12-23 15:52:47,054 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'PHA18'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2019-12-23 15:52:47,606 [1] DEBUG - Statement Id: [DAO00030_GET_SOLONHAP_BANGGIA] PreparedStatement : [SELECT DISTINCT            SLN.SOLONHAP_ID, SLN.SOLONHAP, SLN.SOLOSANPHAM, SLN.SOKIEMSOAT, SLN.SOVISA, CONVERT(varchar(20), SLN.SOLOSANPHAM) + '/' + CONVERT(varchar(20), TK.SOLUONG) AS SOLOSOTON,            SLN.NGAYNHAP AS NGAYNHAPLO, SLN.HANDUNG AS HANSUDUNG,  SLN.HANDUNG, SLN.NGUONDUOC_ID, SLN.NGUONDUOC_ID as NGUONHANG_ID,            SLNGB.DONGIAMUA, SLNGB.DONGIAVON, SLNGB.TYLEVAT_DAUVAO as TYLEVAT, d.TYLE_VAT, SLNGB.DONGIAVONVAT,            dg.DONGIA AS DONGIABAN, dg.DONGIA AS DONGIABAN_VAT,            TK.KHODUOC_ID, TK.DUOC_ID, TK.SOLUONG, TK.SOLUONG AS SOLUONGTON,            D.TENDUOCDAYDU,D.DONVITINH_ID, D.DONVITINH, D.BHYT, NH.TENNGUONDUOC AS NGUONHANG            FROM            TT_DUOC_CHUNGTU_SOLONHAP SLN            INNER JOIN TT_DUOC_TONKHO TK on SLN.SOLONHAP_ID = TK.SOLONHAP_ID            INNER JOIN TT_DUOC_SOLONHAP_GIABAN SLNGB on SLN.SOLONHAP_ID = SLNGB.SOLONHAP_ID            INNER JOIN TM_NGUONHANG NH on SLN.NGUONDUOC_ID = NH.NGUONDUOC_ID            INNER JOIN TM_DUOC D on SLN.DUOC_ID = D.DUOC_ID            INNER JOIN TM_DUOC_DONGIA dg on dg.DUOC_ID = SLN.DUOC_ID            INNER JOIN TM_LOAIGIA lg on (lg.LOAIGIA_ID = dg.LOAIGIA_ID AND lg.MALOAIGIA = 'Gianhathuoc')            WHERE            SLN.DUOC_ID = ''            AND TK.KHODUOC_ID = ''            AND SLN.BENHVIEN_ID = 'HLU01'            AND TK.SOLUONG > 0                 and                     SLN.NGUONDUOC_ID = '1'                                      ORDER BY NGAYNHAP]
2019-12-23 15:52:47,829 [1] DEBUG - Statement Id: [DAO00030_GetMucDichChungTuID] PreparedStatement : [SELECT DICTIONARY_ID              FROM              LST_DICTIONARY              WHERE              DICTIONARY_TYPE_CODE = 'MucDichChungTu'              and DICTIONARY_CODE = 'X08']
2019-12-23 15:52:48,238 [1] DEBUG - Statement Id: [DAO00030_GetKhoDuocDoiTuong] PreparedStatement : [select kd.* from TM_DOITUONG_KHODUOC kd              inner join TM_DOITUONG dt on dt.DOITUONG_ID = kd.DOITUONG_ID              WHERE              kd.NGAYTRONGTUAN = '2'                          and dt.MADOITUONG = 'VP'              and kd.KHODUOC_ID = '9'              and kd.BENHVIEN_ID = 'HLU01']
2019-12-23 15:52:48,314 [1] DEBUG - Statement Id: [DAO00030_GetPhamViByKhoDuoc] PreparedStatement : [SELECT DISTINCT pv.PHAMVI_ID          FROM TM_DUOC_PHAMVISD_MAPPING mp          INNER JOIN TM_DUOC_PHAMVISUDUNG pv ON mp.PHAMVI_ID = pv.PHAMVI_ID          WHERE          mp.KHODUOC_ID IN (9)          AND mp.BENHVIEN_ID ='HLU01'          AND mp.TAMNGUNG = '0'          AND pv.TAMNGUNG = '0']
2019-12-23 15:52:48,447 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'PHA85'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2019-12-23 15:53:15,090 [1] DEBUG - Statement Id: [DAO00030_GET_SOLONHAP_BANGGIA] PreparedStatement : [SELECT DISTINCT            SLN.SOLONHAP_ID, SLN.SOLONHAP, SLN.SOLOSANPHAM, SLN.SOKIEMSOAT, SLN.SOVISA, CONVERT(varchar(20), SLN.SOLOSANPHAM) + '/' + CONVERT(varchar(20), TK.SOLUONG) AS SOLOSOTON,            SLN.NGAYNHAP AS NGAYNHAPLO, SLN.HANDUNG AS HANSUDUNG,  SLN.HANDUNG, SLN.NGUONDUOC_ID, SLN.NGUONDUOC_ID as NGUONHANG_ID,            SLNGB.DONGIAMUA, SLNGB.DONGIAVON, SLNGB.TYLEVAT_DAUVAO as TYLEVAT, d.TYLE_VAT, SLNGB.DONGIAVONVAT,            dg.DONGIA AS DONGIABAN, dg.DONGIA AS DONGIABAN_VAT,            TK.KHODUOC_ID, TK.DUOC_ID, TK.SOLUONG, TK.SOLUONG AS SOLUONGTON,            D.TENDUOCDAYDU,D.DONVITINH_ID, D.DONVITINH, D.BHYT, NH.TENNGUONDUOC AS NGUONHANG            FROM            TT_DUOC_CHUNGTU_SOLONHAP SLN            INNER JOIN TT_DUOC_TONKHO TK on SLN.SOLONHAP_ID = TK.SOLONHAP_ID            INNER JOIN TT_DUOC_SOLONHAP_GIABAN SLNGB on SLN.SOLONHAP_ID = SLNGB.SOLONHAP_ID            INNER JOIN TM_NGUONHANG NH on SLN.NGUONDUOC_ID = NH.NGUONDUOC_ID            INNER JOIN TM_DUOC D on SLN.DUOC_ID = D.DUOC_ID            INNER JOIN TM_DUOC_DONGIA dg on dg.DUOC_ID = SLN.DUOC_ID            INNER JOIN TM_LOAIGIA lg on (lg.LOAIGIA_ID = dg.LOAIGIA_ID AND lg.MALOAIGIA = 'Gianhathuoc')            WHERE            SLN.DUOC_ID = '1410'            AND TK.KHODUOC_ID = '9'            AND SLN.BENHVIEN_ID = 'HLU01'            AND TK.SOLUONG > 0                 and                     SLN.NGUONDUOC_ID = '1'                                      ORDER BY NGAYNHAP]
2019-12-23 15:53:18,954 [1] DEBUG - Statement Id: [DAO00030_GET_SOLONHAP_BANGGIA] PreparedStatement : [SELECT DISTINCT            SLN.SOLONHAP_ID, SLN.SOLONHAP, SLN.SOLOSANPHAM, SLN.SOKIEMSOAT, SLN.SOVISA, CONVERT(varchar(20), SLN.SOLOSANPHAM) + '/' + CONVERT(varchar(20), TK.SOLUONG) AS SOLOSOTON,            SLN.NGAYNHAP AS NGAYNHAPLO, SLN.HANDUNG AS HANSUDUNG,  SLN.HANDUNG, SLN.NGUONDUOC_ID, SLN.NGUONDUOC_ID as NGUONHANG_ID,            SLNGB.DONGIAMUA, SLNGB.DONGIAVON, SLNGB.TYLEVAT_DAUVAO as TYLEVAT, d.TYLE_VAT, SLNGB.DONGIAVONVAT,            dg.DONGIA AS DONGIABAN, dg.DONGIA AS DONGIABAN_VAT,            TK.KHODUOC_ID, TK.DUOC_ID, TK.SOLUONG, TK.SOLUONG AS SOLUONGTON,            D.TENDUOCDAYDU,D.DONVITINH_ID, D.DONVITINH, D.BHYT, NH.TENNGUONDUOC AS NGUONHANG            FROM            TT_DUOC_CHUNGTU_SOLONHAP SLN            INNER JOIN TT_DUOC_TONKHO TK on SLN.SOLONHAP_ID = TK.SOLONHAP_ID            INNER JOIN TT_DUOC_SOLONHAP_GIABAN SLNGB on SLN.SOLONHAP_ID = SLNGB.SOLONHAP_ID            INNER JOIN TM_NGUONHANG NH on SLN.NGUONDUOC_ID = NH.NGUONDUOC_ID            INNER JOIN TM_DUOC D on SLN.DUOC_ID = D.DUOC_ID            INNER JOIN TM_DUOC_DONGIA dg on dg.DUOC_ID = SLN.DUOC_ID            INNER JOIN TM_LOAIGIA lg on (lg.LOAIGIA_ID = dg.LOAIGIA_ID AND lg.MALOAIGIA = 'Gianhathuoc')            WHERE            SLN.DUOC_ID = '1410'            AND TK.KHODUOC_ID = '9'            AND SLN.BENHVIEN_ID = 'HLU01'            AND TK.SOLUONG > 0                 and                     SLN.NGUONDUOC_ID = '1'                                      ORDER BY NGAYNHAP]
--------------------------------------------------------------------------------
2019-12-23 15:54:47,821 [1] DEBUG - Statement Id: [DAO00001_DBList] PreparedStatement : [select *              from TM_SYS_SERVER              where HOSPITAL_ID = '_SYSTEM_' and TYPE = 'D']
2019-12-23 15:54:48,112 [1] DEBUG - Statement Id: [DAO00001_DaoList] PreparedStatement : [select              TM_SYS_SERVICEMAP.ID,              TM_SYS_SERVICEMAP.HOSPITAL_ID,              TM_SYS_SERVICEMAP.DB_NAME,              TM_SYS_SERVICEMAP.TYPE,              TM_SYS_SERVICEMAP.NAME,              TM_SYS_SERVICEMAP.CLASS,              (TM_SYS_DIC.VALUE + '.' + TM_SYS_SERVICEMAP.CLASS) as CLASSFULL,              TM_SYS_SERVICEMAP.ASSEMBLY              from TM_SYS_SERVICEMAP              inner join TM_SYS_DIC              on TM_SYS_SERVICEMAP.NAMESPACE = TM_SYS_DIC.ID              where HOSPITAL_ID = '_SYSTEM_' AND TYPE = 'D' AND ACTIVE = '1'              order by DB_NAME]
2019-12-23 15:54:48,153 [1] DEBUG - Statement Id: [DAO00001_ServiceList] PreparedStatement : [select              TM_SYS_SERVICEMAP.ID,              TM_SYS_SERVICEMAP.HOSPITAL_ID,              TM_SYS_SERVICEMAP.DB_NAME,              TM_SYS_SERVICEMAP.TYPE,              TM_SYS_SERVICEMAP.NAME,              TM_SYS_SERVICEMAP.CLASS,              (TM_SYS_DIC.VALUE + '.' + TM_SYS_SERVICEMAP.CLASS) as CLASSFULL,              TM_SYS_SERVICEMAP.ASSEMBLY,              TM_SYS_SERVER.URL              from TM_SYS_SERVICEMAP              inner join TM_SYS_DIC on TM_SYS_SERVICEMAP.NAMESPACE = TM_SYS_DIC.ID              inner join TM_SYS_SERVER on (TM_SYS_SERVICEMAP.DB_NAME = TM_SYS_SERVER.NAME) and (TM_SYS_SERVER.HOSPITAL_ID = '_SYSTEM_')              where TM_SYS_SERVICEMAP.HOSPITAL_ID = '_SYSTEM_' AND TM_SYS_SERVICEMAP.TYPE = 'S'  AND ACTIVE = '1'              order by URL]
2019-12-23 15:54:48,539 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = '_SYSTEM_'               AND                   TM_SYS_SCREEN.PAGE = 'LOGIN'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2019-12-23 15:54:48,877 [1] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = '_SYSTEM_'               AND                   TM_SYS_CACHE.ACTIVE = '1']
2019-12-23 15:56:05,034 [1] DEBUG - Statement Id: [DAO00001_DBList] PreparedStatement : [select *              from TM_SYS_SERVER              where HOSPITAL_ID = 'HLU01' and TYPE = 'D']
2019-12-23 15:56:05,129 [1] DEBUG - Statement Id: [DAO00001_DaoList] PreparedStatement : [select              TM_SYS_SERVICEMAP.ID,              TM_SYS_SERVICEMAP.HOSPITAL_ID,              TM_SYS_SERVICEMAP.DB_NAME,              TM_SYS_SERVICEMAP.TYPE,              TM_SYS_SERVICEMAP.NAME,              TM_SYS_SERVICEMAP.CLASS,              (TM_SYS_DIC.VALUE + '.' + TM_SYS_SERVICEMAP.CLASS) as CLASSFULL,              TM_SYS_SERVICEMAP.ASSEMBLY              from TM_SYS_SERVICEMAP              inner join TM_SYS_DIC              on TM_SYS_SERVICEMAP.NAMESPACE = TM_SYS_DIC.ID              where HOSPITAL_ID = 'HLU01' AND TYPE = 'D' AND ACTIVE = '1'              order by DB_NAME]
2019-12-23 15:56:06,756 [1] DEBUG - Statement Id: [DAO00001_ServiceList] PreparedStatement : [select              TM_SYS_SERVICEMAP.ID,              TM_SYS_SERVICEMAP.HOSPITAL_ID,              TM_SYS_SERVICEMAP.DB_NAME,              TM_SYS_SERVICEMAP.TYPE,              TM_SYS_SERVICEMAP.NAME,              TM_SYS_SERVICEMAP.CLASS,              (TM_SYS_DIC.VALUE + '.' + TM_SYS_SERVICEMAP.CLASS) as CLASSFULL,              TM_SYS_SERVICEMAP.ASSEMBLY,              TM_SYS_SERVER.URL              from TM_SYS_SERVICEMAP              inner join TM_SYS_DIC on TM_SYS_SERVICEMAP.NAMESPACE = TM_SYS_DIC.ID              inner join TM_SYS_SERVER on (TM_SYS_SERVICEMAP.DB_NAME = TM_SYS_SERVER.NAME) and (TM_SYS_SERVER.HOSPITAL_ID = 'HLU01')              where TM_SYS_SERVICEMAP.HOSPITAL_ID = 'HLU01' AND TM_SYS_SERVICEMAP.TYPE = 'S'  AND ACTIVE = '1'              order by URL]
2019-12-23 15:56:06,894 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1']
2019-12-23 15:56:07,892 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM005']
2019-12-23 15:56:08,092 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM015']
2019-12-23 15:56:08,160 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM067']
2019-12-23 15:56:08,227 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM008']
2019-12-23 15:56:08,304 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM068']
2019-12-23 15:56:08,410 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM006']
2019-12-23 15:56:08,478 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM030']
2019-12-23 15:56:08,551 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM025']
2019-12-23 15:56:08,712 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM024']
2019-12-23 15:56:09,358 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM033']
2019-12-23 15:56:09,395 [5] DEBUG - Statement Id: [DAO00027_GetListDuocKyGuiTonKho] PreparedStatement : [select  distinct TT_TONKHO.DUOC_KEY, LTRIM(TT_TONKHO.KHODUOC_ID) as KHODUOC_ID, TM_DUOC.DUOC_ID, TM_LOAIDUOC.MALOAIDUOC,TM_DUOC.SOVISA,TM_DUOC.TYLE_VAT,TM_DUOC.COTOA,        TM_DUOC.MADUOC, TM_DUOC.TENHANG, TM_DUOC.TENDUOCDAYDU, dvt.TENDONVITINH as DONVITINH,  TM_DUOC.DONVITINH_ID,TM_DUOC.BHYT,TM_DUOC.PHAMVI,        TM_DUOC.TENHOATCHAT, TM_DUOC.HAMLUONG, TM_DUOC.HANGSANXUAT, TM_DUOC.QUOCGIA, TM_DUOC.LOAIDUOC_ID, TM_DUOC.DUONGDUNG_ID,        TM_TENDUOC.TENDUOC, TM_TENDUOC.TENDUOC_EN, TM_TENDUOC.MAQUOCTE, TM_TENDUOC.MAQUOCTEBT,        TM_LOAIDUOC.LOAIVATTU_ID, TM_DUOC.BENHVIEN_ID,TT_TONKHO.SOLUONG, TT_TONKHO.NGUONDUOC_ID, NH.TENNGUONDUOC        , TAMNGUNG = CASE WHEN TM_DUOC.TAMNGUNG = '1' OR nh.TAMNGUNG = '1' OR KD.TAMNGUNG = '1' THEN '1' ELSE '0' END        , TM_DUOC.DANGTRINHBAY        from TM_DUOC        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = TM_DUOC.DONVITINH_ID        left join TM_TENDUOC on TM_DUOC.TENDUOC_ID = TM_TENDUOC.TENDUOC_ID and TM_DUOC.BENHVIEN_ID = 'HLU01' and TM_DUOC.TAMNGUNG = '0'        left join TM_LOAIDUOC on TM_LOAIDUOC.LOAIDUOC_ID = TM_DUOC.LOAIDUOC_ID and TM_LOAIDUOC.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG on (TM_LOAIDUOC.LOAIVATTU_ID = TM_DUOC_HANDUNG.LOAIDUOC and TM_DUOC_HANDUNG.BENHVIEN_ID = 'HLU01')        inner join        (select LTRIM(A.KHODUOC_ID) + '_' + LTRIM(A.DUOC_ID) + '_' + LTRIM(ISNULL(A.NGUONDUOC_ID,'')) as DUOC_KEY, A.KHODUOC_ID, A.DUOC_ID,A.NGUONDUOC_ID,        SUM(isnull(A.SOLUONG,0)) as SOLUONG        from        (select SUM(SOLUONG) as SOLUONG, KHODUOC_ID, DUOC_ID, NGUONDUOC_ID from TT_DUOC_KYGUI_TONKHO        where BENHVIEN_ID = 'HLU01' group by KHODUOC_ID, DUOC_ID, NGUONDUOC_ID) A        group by LTRIM(A.KHODUOC_ID) + '_' + LTRIM(A.DUOC_ID) + '_' + LTRIM(A.NGUONDUOC_ID), A.KHODUOC_ID, A.DUOC_ID, A.NGUONDUOC_ID)        TT_TONKHO on TT_TONKHO.DUOC_ID = TM_DUOC.DUOC_ID        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = TT_TONKHO.NGUONDUOC_ID and nh.BENHVIEN_ID = 'HLU01'        LEFT JOIN TM_KHODUOC KD ON KD.KHODUOC_ID = TT_TONKHO.KHODUOC_ID        where TM_DUOC.BENHVIEN_ID = 'HLU01' AND TT_TONKHO.SOLUONG >= 0]
2019-12-23 15:56:09,467 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM018']
2019-12-23 15:56:09,497 [5] DEBUG - Statement Id: [DAO00027_GetListDuocTonKho] PreparedStatement : [select distinct TT_TONKHO.DUOC_KEY, LTRIM(TT_TONKHO.KHODUOC_ID) as KHODUOC_ID, TM_DUOC.DUOC_ID, TM_LOAIDUOC.MALOAIDUOC,TM_DUOC.SOVISA,TM_DUOC.TYLE_VAT,TM_DUOC.COTOA,        TM_DUOC.MADUOC, TM_DUOC.TENHANG, TM_DUOC.TENDUOCDAYDU, dvt.TENDONVITINH as DONVITINH,  TM_DUOC.DONVITINH_ID,TM_DUOC.BHYT,                TM_DUOC.TENHOATCHAT,          TM_DUOC.HAMLUONG, TM_DUOC.HANGSANXUAT, TM_DUOC.QUOCGIA, TM_DUOC.LOAIDUOC_ID, TM_DUOC.DUONGDUNG_ID,        TM_TENDUOC.TENDUOC, TM_TENDUOC.TENDUOC_EN, TM_TENDUOC.MAQUOCTE, TM_TENDUOC.MAQUOCTEBT,        TM_LOAIDUOC.LOAIVATTU_ID, TM_DUOC.BENHVIEN_ID,        TT_TONKHO.SOLUONG, TM_DUOC.VTYT_PHANLOAI, TM_DUOC.PHAMVI, TT_TONKHO.NGUONDUOC_ID, NG.TENNGUONDUOC AS TENNGUONDUOC        , TAMNGUNG = CASE WHEN TM_DUOC.TAMNGUNG = '1' OR NG.TAMNGUNG = '1' OR KD.TAMNGUNG = '1' THEN '1' ELSE '0' END        , TM_DUOC.DANGTRINHBAY        from TM_DUOC        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = TM_DUOC.DONVITINH_ID        left join TM_TENDUOC on TM_DUOC.TENDUOC_ID = TM_TENDUOC.TENDUOC_ID and TM_DUOC.BENHVIEN_ID = 'HLU01' and TM_DUOC.TAMNGUNG = '0'        left join TM_LOAIDUOC on TM_LOAIDUOC.LOAIDUOC_ID = TM_DUOC.LOAIDUOC_ID and TM_LOAIDUOC.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG on (TM_LOAIDUOC.LOAIVATTU_ID = TM_DUOC_HANDUNG.LOAIDUOC and TM_DUOC_HANDUNG.BENHVIEN_ID = 'HLU01')        inner join        (select LTRIM(A.KHODUOC_ID) + '_' + LTRIM(A.DUOC_ID) + '_' + LTRIM(ISNULL(A.NGUONDUOC_ID,'')) as DUOC_KEY, A.KHODUOC_ID, A.DUOC_ID, A.NGUONDUOC_ID,        SUM(isnull(A.SOLUONG,0)) as SOLUONG        from        (select SUM(SOLUONG) as SOLUONG, KHODUOC_ID, DUOC_ID, NGUONDUOC_ID from TT_DUOC_TONKHO        where BENHVIEN_ID = 'HLU01' group by KHODUOC_ID, DUOC_ID, NGUONDUOC_ID) A        group by LTRIM(A.KHODUOC_ID) + '_' + LTRIM(A.DUOC_ID) + '_' + LTRIM(ISNULL(A.NGUONDUOC_ID,'')), A.KHODUOC_ID, A.DUOC_ID, NGUONDUOC_ID        ) TT_TONKHO on TT_TONKHO.DUOC_ID = TM_DUOC.DUOC_ID        LEFT JOIN TM_NGUONHANG NG ON NG.NGUONDUOC_ID = TT_TONKHO.NGUONDUOC_ID        LEFT JOIN TM_KHODUOC KD ON KD.KHODUOC_ID = TT_TONKHO.KHODUOC_ID        where TM_DUOC.BENHVIEN_ID = 'HLU01' and TT_TONKHO.SOLUONG >= 0]
2019-12-23 15:56:11,259 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM023']
2019-12-23 15:56:11,290 [5] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoVaBooking] PreparedStatement : [declare @NGUONDUOC_MACDINH varchar(5) = '0';        declare @TOAMUANGOAI int = 0;        select @NGUONDUOC_MACDINH = isnull(VALUE,0) from TM_SYS_APPSETTINGS where CODE = 'PHA_NGUONDUOC'        select @TOAMUANGOAI = isnull(VALUE,0) from TM_SYS_APPSETTINGS where CODE = 'OPD_TOAMUANGOAI_DUNGDANHMUC_DUOC'                if @TOAMUANGOAI = 1        begin        select  distinct '0' + '_' + LTRIM(d.DUOC_ID) + '_' + @NGUONDUOC_MACDINH as DUOC_KEY, 0 as PHAMVI_ID, @NGUONDUOC_MACDINH as NGUONDUOC_ID, null as TENNGUONDUOC, null as TINHTIEN, d.DUOC_ID, ld.MALOAIDUOC,        d.SOVISA,d.TYLE_VAT,d.COTOA, d.MADUOC, d.TENHANG, d.TENDUOCDAYDU, d.DONVITINH as DONVITINH, d.BHYT,        d.TENHOATCHAT, d.HAMLUONG, d.HANGSANXUAT, d.QUOCGIA, d.LOAIDUOC_ID, d.DUONGDUNG_ID, d.TINHTIEN_PTTT,        ten.TENDUOC, ten.TENDUOC_EN, ten.MAQUOCTE, ten.MAQUOCTEBT,d.CONGDUNG,        '' as BHYT_TEXT        , ld.LOAIVATTU_ID        , d.BENHVIEN_ID,        999999999 as SOLUONG, d.VTYT_PHANLOAI, d.PHAMVI, d.SUASOLUONGTONGHOP, d.MADUOCBV, d.DANGTRINHBAY        , TAMNGUNG = CASE WHEN d.TAMNGUNG = '1' THEN '1' ELSE '0' END        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        union all        select  distinct tk.DUOC_KEY, LTRIM(tk.PHAMVI_ID) as PHAMVI_ID, tk.NGUONDUOC_ID, nh.TENNGUONDUOC, nh.TINHTIEN, d.DUOC_ID, ld.MALOAIDUOC,        d.SOVISA,d.TYLE_VAT,d.COTOA, d.MADUOC, d.TENHANG, d.TENDUOCDAYDU, d.DONVITINH as DONVITINH, d.BHYT,        d.TENHOATCHAT, d.HAMLUONG, d.HANGSANXUAT, d.QUOCGIA, d.LOAIDUOC_ID, d.DUONGDUNG_ID, d.TINHTIEN_PTTT,        ten.TENDUOC, ten.TENDUOC_EN, ten.MAQUOCTE, ten.MAQUOCTEBT,d.CONGDUNG,        CASE WHEN d.BHYT = '1' THEN 'BHYT' ELSE '' END as BHYT_TEXT        , ld.LOAIVATTU_ID        , d.BENHVIEN_ID,        tk.SOLUONG, d.VTYT_PHANLOAI, d.PHAMVI, d.SUASOLUONGTONGHOP, d.MADUOCBV, d.DANGTRINHBAY        , TAMNGUNG = CASE WHEN d.TAMNGUNG = '1' OR nh.TAMNGUNG = '1' OR kd.TAMNGUNG = '1' THEN '1' ELSE '0' END        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        inner join        (        select  LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')) DUOC_KEY, (SUM(dtk.SOLUONG) - isnull(sum(A.SOLUONG),0) - isnull(sum(B.SOLUONG),0)) SOLUONG, pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        from (select sum(soluong) soluong,duoc_id,nguonduoc_id,khoduoc_id,benhvien_id from TT_DUOC_TONKHO  group by duoc_id,nguonduoc_id,khoduoc_id,benhvien_id) dtk        inner join TM_DUOC_PHAMVISD_MAPPING pvsd on dtk.KHODUOC_ID = pvsd.KHODUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NOITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) B on B.DUOC_ID = dtk.DUOC_ID and B.SOLUONG > 0 and B.PHAMVI_ID = pvsd.PHAMVI_ID and B.NGUONHANG_ID = dtk.NGUONDUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NGOAITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) A on A.DUOC_ID = dtk.DUOC_ID and A.SOLUONG > 0 and A.PHAMVI_ID = pvsd.PHAMVI_ID and A.NGUONHANG_ID = dtk.NGUONDUOC_ID        where dtk.SOLUONG > 0 and dtk.BENHVIEN_ID = 'HLU01'        group by LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')), pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        ) tk on tk.DUOC_ID = d.DUOC_ID        left join TM_DUOC_PHAMVISUDUNG kd on kd.PHAMVI_ID = tk.PHAMVI_ID and kd.BENHVIEN_ID = 'HLU01'        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = tk.NGUONDUOC_ID and nh.BENHVIEN_ID = 'HLU01'        where d.BENHVIEN_ID = 'HLU01'  and tk.SOLUONG >= 0        end        else        begin                  select  distinct tk.DUOC_KEY, LTRIM(tk.PHAMVI_ID) as PHAMVI_ID, tk.NGUONDUOC_ID, nh.TENNGUONDUOC, nh.TINHTIEN, d.DUOC_ID, ld.MALOAIDUOC,        d.SOVISA,d.TYLE_VAT,d.COTOA, d.MADUOC, d.TENHANG, d.TENDUOCDAYDU, d.DONVITINH as DONVITINH, d.BHYT,        d.TENHOATCHAT, d.HAMLUONG, d.HANGSANXUAT, d.QUOCGIA, d.LOAIDUOC_ID, d.DUONGDUNG_ID, d.TINHTIEN_PTTT,        ten.TENDUOC, ten.TENDUOC_EN, ten.MAQUOCTE, ten.MAQUOCTEBT,d.CONGDUNG,        CASE WHEN d.BHYT = '1' THEN 'BHYT' ELSE '' END as BHYT_TEXT        , ld.LOAIVATTU_ID        , d.BENHVIEN_ID,        tk.SOLUONG, d.VTYT_PHANLOAI, d.PHAMVI, d.SUASOLUONGTONGHOP, d.MADUOCBV, d.DANGTRINHBAY        , TAMNGUNG = CASE WHEN d.TAMNGUNG = '1' OR nh.TAMNGUNG = '1' OR kd.TAMNGUNG = '1' THEN '1' ELSE '0' END        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        inner join        (        select  LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')) DUOC_KEY, (SUM(dtk.SOLUONG) - isnull(sum(A.SOLUONG),0) - isnull(sum(B.SOLUONG),0)) SOLUONG, pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        from (select sum(soluong) soluong,duoc_id,nguonduoc_id,khoduoc_id,benhvien_id from TT_DUOC_TONKHO  group by duoc_id,nguonduoc_id,khoduoc_id,benhvien_id) dtk        inner join TM_DUOC_PHAMVISD_MAPPING pvsd on dtk.KHODUOC_ID = pvsd.KHODUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NOITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) B on B.DUOC_ID = dtk.DUOC_ID and B.SOLUONG > 0 and B.PHAMVI_ID = pvsd.PHAMVI_ID and B.NGUONHANG_ID = dtk.NGUONDUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NGOAITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) A on A.DUOC_ID = dtk.DUOC_ID and A.SOLUONG > 0 and A.PHAMVI_ID = pvsd.PHAMVI_ID and A.NGUONHANG_ID = dtk.NGUONDUOC_ID        where dtk.SOLUONG > 0 and dtk.BENHVIEN_ID = 'HLU01'        group by LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')), pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        ) tk on tk.DUOC_ID = d.DUOC_ID        left join TM_DUOC_PHAMVISUDUNG kd on kd.PHAMVI_ID = tk.PHAMVI_ID and kd.BENHVIEN_ID = 'HLU01'        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = tk.NGUONDUOC_ID and nh.BENHVIEN_ID = 'HLU01'        where d.BENHVIEN_ID = 'HLU01'  and tk.SOLUONG >= 0        end]
2019-12-23 15:56:12,982 [5] DEBUG - Statement Id: [DAO00320_GetList] PreparedStatement : [select M.*            from TM_MAU M            LEFT JOIN TM_MAU_DONVITINH DVT on M.DONVITINH_ID=DVT.DONVITINH_ID            where            M.TAMNGUNG = '0'            and M.BENHVIEN_ID = 'HLU01'            order by M.TENMAU]
2019-12-23 15:56:13,144 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM071']
2019-12-23 15:56:13,207 [5] DEBUG - Statement Id: [DAO00322_GetListMauTonKhoForCreateCached] PreparedStatement : [SELECT DISTINCT        TK.MAU_KEY, TK.KHOMAU_ID, M.MAU_ID, M.MAMAU, M.TENMAU, M.NHOM_ABO, M.NHOM_RH, M.LOAIMAU_ID,        TK.SOLONHAP_ID, SLN.SOLONHAP, SLN.SOKIEMSOAT, TK.NGUONHANG_ID, NG.TENNGUONMAU, M.BENHVIEN_ID, M.DONVITINH_ID,        SUM(tk.SOLUONG) AS SOLUONG,K.TENKHO,DVT.TENDONVITINH        FROM TT_MAU_TONKHO TK        JOIN TM_KHO K ON TK.KHOMAU_ID = K.KHO_ID        JOIN TT_MAU_CHUNGTU_SOLONHAP SLN ON TK.SOLONHAP_ID = SLN.SOLONHAP_ID        JOIN TM_MAU M on TK.MAU_ID = M.MAU_ID and M.TAMNGUNG = '0'        LEFT JOIN TM_MAU_DONVITINH DVT on M.DONVITINH_ID=DVT.DONVITINH_ID        LEFT JOIN TM_NGUONMAU NG ON NG.NGUONMAU_ID = TK.NGUONHANG_ID        WHERE TK.SOLUONG > 0        GROUP BY TK.MAU_KEY, TK.KHOMAU_ID, M.MAU_ID, M.MAMAU, M.TENMAU, M.NHOM_ABO, M.NHOM_RH, M.LOAIMAU_ID,        TK.SOLONHAP_ID, SLN.SOLONHAP, SLN.SOKIEMSOAT,TK.NGUONHANG_ID, NG.TENNGUONMAU, M.BENHVIEN_ID, M.DONVITINH_ID,K.TENKHO,DVT.TENDONVITINH]
2019-12-23 15:56:13,411 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM073']
2019-12-23 15:56:13,574 [5] DEBUG - Statement Id: [DAO00322_GetListMauTonKhoTruBooking] PreparedStatement : [select distinct        TK.MAU_KEY, TK.KHOMAU_ID, M.MAU_ID, M.MAMAU, M.TENMAU, M.NHOM_ABO, M.NHOM_RH, M.LOAIMAU_ID, M.DONVITINH_ID,        TK.SOLONHAP_ID, TK.SOLONHAP, TK.SOKIEMSOAT,M.PHAMVI, TK.NGUONHANG_ID, NG.TENNGUONMAU, M.BENHVIEN_ID,        TK.SOLUONG,TK.TENKHO,DVT.TENDONVITINH        from TM_MAU M        JOIN        (        select        A.MAU_KEY, A.KHOMAU_ID, A.MAU_ID ,a.NGUONHANG_ID, A.SOLONHAP_ID, A.SOLONHAP, A.SOKIEMSOAT, A.SOLUONG,A.TENKHO        from        (        select KHOMAU_ID, TK.MAU_ID, TK.NGUONHANG_ID, TK.MAU_KEY, SLN.SOLONHAP_ID, SLN.SOLONHAP, SLN.SOKIEMSOAT, ISNULL(TK.SOLUONG,0) - ISNULL(book.SOLUONG,0) as SOLUONG,K.TENKHO        from TT_MAU_TONKHO TK        JOIN TM_KHO K ON TK.KHOMAU_ID = K.KHO_ID        inner join TT_MAU_CHUNGTU_SOLONHAP SLN ON TK.SOLONHAP_ID = SLN.SOLONHAP_ID        left join dbo.TT_MAU_TONKHO_BOOK book ON book.MAU_KEY = TK.MAU_KEY AND book.TRANGTHAI = 'HIEULUC'        where ISNULL(TK.SOLUONG,0) - ISNULL(book.SOLUONG,0) > 0        ) A        )TK on TK.MAU_ID = M.MAU_ID and M.TAMNGUNG = '0'        LEFT JOIN TM_MAU_DONVITINH DVT on M.DONVITINH_ID=DVT.DONVITINH_ID        LEFT JOIN TM_NGUONMAU NG ON NG.NGUONMAU_ID = TK.NGUONHANG_ID]
2019-12-23 15:56:13,655 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM072']
2019-12-23 15:56:14,671 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'MAIN'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2019-12-23 15:56:16,526 [1] DEBUG - Statement Id: [DAO00002_FormList] PreparedStatement : [select              TM_SYS_FORM.HOSPITAL_ID,              TM_SYS_FORM.NAME,              TM_SYS_FORM.CLASS,              TM_SYS_FORM.ASSEMBLY,              TM_SYS_FORM.TITLE_VI as TITLE              from TM_SYS_FORM              where HOSPITAL_ID = 'HLU01']
2019-12-23 15:56:21,438 [1] DEBUG - Statement Id: [DAO00300_GetShortcutListByUserID] PreparedStatement : [SELECT S.SHORTCUT_CODE, S.SHORTCUT_VALUE              FROM TM_SHORTCUT AS S              WHERE S.BENHVIEN_ID = 'HLU01' AND S.USER_ID = '1' AND TAMNGUNG = '0']
2019-12-23 15:56:21,472 [1] DEBUG - Statement Id: [DAO00087_GetList] PreparedStatement : [select CODE, VALUE, BENHVIEN_ID              from TM_SYS_APPSETTINGS              where LOCKED = '0' and BENHVIEN_ID = 'HLU01'              order by SETTING_ID]
2019-12-23 15:56:21,547 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'MSG01'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2019-12-23 15:56:21,676 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'MSG02'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2019-12-23 15:56:21,825 [1] DEBUG - Statement Id: [DAO00008_GetUserSettings] PreparedStatement : [select A.*, B.TENKHO , C.TENPHONGBAN, B.MAKHO, C.MAPHONGBAN          from TM_SYS_USERS A          left join TM_KHODUOC B on B.KHODUOC_ID = A.INVENTORY_ID          left join TM_PHONGBAN C on (C.PHONGBAN_ID = A.WORKING_DEPT_ID and C.BENHVIEN_ID =  @param0 )          left join TM_SYS_USERKHO D on (D.ACCOUNT_ID = A.ACCOUNT_ID and D.HOSPITAL_ID =  @param0 )          where          A.HOSPITAL_ID =  @param0            and                 A.ACCOUNT_ID =  @param1]
2019-12-23 15:56:21,826 [1] DEBUG - Statement Id: [DAO00008_GetUserSettings] Parameters: [@param0=[HOSPITAL_ID,HLU01], @param1=[ACCOUNT_ID,113]]
2019-12-23 15:56:21,826 [1] DEBUG - Statement Id: [DAO00008_GetUserSettings] Types: [@param0=[String, System.String], @param1=[String, System.String]]
2019-12-23 15:56:21,854 [1] DEBUG - Statement Id: [DAO00008_GetUserInvSettings] PreparedStatement : [select A.*, B.TENKHO, B.MAKHO, B.LOAIKHO_ID, B.KHOQUANLY_ID          from TM_SYS_USERKHO A          left join TM_KHO B on B.MODULE_ID = A.MODULE_ID and B.KHO_ID = A.KHO_ID          where A.HOSPITAL_ID =  @param0  and A.ACCOUNT_ID =  @param1           order by B.TENKHO]
2019-12-23 15:56:21,854 [1] DEBUG - Statement Id: [DAO00008_GetUserInvSettings] Parameters: [@param0=[HOSPITAL_ID,HLU01], @param1=[ACCOUNT_ID,113]]
2019-12-23 15:56:21,854 [1] DEBUG - Statement Id: [DAO00008_GetUserInvSettings] Types: [@param0=[String, System.String], @param1=[String, System.String]]
2019-12-23 15:56:21,990 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'COM30'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2019-12-23 15:56:22,178 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'RIS04'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2019-12-23 15:56:41,473 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'MENU1'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2019-12-23 15:56:41,564 [1] DEBUG - Statement Id: [DAO00011_GetList] PreparedStatement : [select              TM_SYS_MENU.ID,              TM_SYS_MENU.PARENTID,              TM_SYS_MENU.SCREEN,              TM_SYS_MENU.SMALLIMAGE,              TM_SYS_MENU.LARGEIMAGE,              TM_SYS_MENU.DESCRIPTION,              TM_SYS_MENU.TYPE,              TM_SYS_MENU.TITLE_VI as TITLE              from TM_SYS_MENU              where TM_SYS_MENU.HOSPITAL_ID = 'HLU01' and TM_SYS_MENU.ACTIVE = '1'               AND                   (TM_SYS_MENU.TYPE & '8' = '8')                             order by TM_SYS_MENU.ORDERNUM]
2019-12-23 15:56:41,857 [1] DEBUG - Statement Id: [DAO00011_usermenu_list] PreparedStatement : [select              TM_SYS_HOMEMENU.MENUID as ID,              TM_SYS_MENU.TITLE_VI as TITLE,              TM_SYS_MENU.SCREEN,              TM_SYS_MENU.SMALLIMAGE,              TM_SYS_MENU.LARGEIMAGE,              TM_SYS_MENU.TYPE              from TM_SYS_HOMEMENU              left join TM_SYS_MENU on TM_SYS_MENU.ID = TM_SYS_HOMEMENU.MENUID and TM_SYS_MENU.HOSPITAL_ID = TM_SYS_HOMEMENU.HOSPITAL_ID              where TM_SYS_HOMEMENU.HOSPITAL_ID = 'HLU01' and TM_SYS_HOMEMENU.USERID = '113' and TM_SYS_MENU.ACTIVE = '1'               AND                   (TM_SYS_MENU.TYPE & '8' = '8')                             ORDER BY TM_SYS_HOMEMENU.ORDERNUM]
2019-12-23 15:56:49,000 [1] DEBUG - Statement Id: [DAO00087_GetServiceParams] PreparedStatement : [select CODE, VALUE              from TM_SYS_APPSETTINGS              where LOCKED = '0' and BENHVIEN_ID = 'HLU01']
2019-12-23 15:56:49,506 [1] DEBUG - Statement Id: [DAO00030_GetMucDichChungTuID] PreparedStatement : [SELECT DICTIONARY_ID              FROM              LST_DICTIONARY              WHERE              DICTIONARY_TYPE_CODE = 'MucDichChungTu'              and DICTIONARY_CODE = 'X08']
2019-12-23 15:56:50,313 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'PHA18'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2019-12-23 15:56:51,278 [1] DEBUG - Statement Id: [DAO00030_GET_SOLONHAP_BANGGIA] PreparedStatement : [SELECT DISTINCT            SLN.SOLONHAP_ID, SLN.SOLONHAP, SLN.SOLOSANPHAM, SLN.SOKIEMSOAT, SLN.SOVISA, CONVERT(varchar(20), SLN.SOLOSANPHAM) + '/' + CONVERT(varchar(20), TK.SOLUONG) AS SOLOSOTON,            SLN.NGAYNHAP AS NGAYNHAPLO, SLN.HANDUNG AS HANSUDUNG,  SLN.HANDUNG, SLN.NGUONDUOC_ID, SLN.NGUONDUOC_ID as NGUONHANG_ID,            SLNGB.DONGIAMUA, SLNGB.DONGIAVON, SLNGB.TYLEVAT_DAUVAO as TYLEVAT, d.TYLE_VAT, SLNGB.DONGIAVONVAT,            dg.DONGIA AS DONGIABAN, dg.DONGIA AS DONGIABAN_VAT,            TK.KHODUOC_ID, TK.DUOC_ID, TK.SOLUONG, TK.SOLUONG AS SOLUONGTON,            D.TENDUOCDAYDU,D.DONVITINH_ID, D.DONVITINH, D.BHYT, NH.TENNGUONDUOC AS NGUONHANG            FROM            TT_DUOC_CHUNGTU_SOLONHAP SLN            INNER JOIN TT_DUOC_TONKHO TK on SLN.SOLONHAP_ID = TK.SOLONHAP_ID            INNER JOIN TT_DUOC_SOLONHAP_GIABAN SLNGB on SLN.SOLONHAP_ID = SLNGB.SOLONHAP_ID            INNER JOIN TM_NGUONHANG NH on SLN.NGUONDUOC_ID = NH.NGUONDUOC_ID            INNER JOIN TM_DUOC D on SLN.DUOC_ID = D.DUOC_ID            INNER JOIN TM_DUOC_DONGIA dg on dg.DUOC_ID = SLN.DUOC_ID            INNER JOIN TM_LOAIGIA lg on (lg.LOAIGIA_ID = dg.LOAIGIA_ID AND lg.MALOAIGIA = 'Gianhathuoc')            WHERE            SLN.DUOC_ID = ''            AND TK.KHODUOC_ID = ''            AND SLN.BENHVIEN_ID = 'HLU01'            AND TK.SOLUONG > 0                 and                     SLN.NGUONDUOC_ID = '1'                                      ORDER BY NGAYNHAP]
2019-12-23 15:56:51,570 [1] DEBUG - Statement Id: [DAO00030_GetMucDichChungTuID] PreparedStatement : [SELECT DICTIONARY_ID              FROM              LST_DICTIONARY              WHERE              DICTIONARY_TYPE_CODE = 'MucDichChungTu'              and DICTIONARY_CODE = 'X08']
2019-12-23 15:56:52,752 [1] DEBUG - Statement Id: [DAO00030_GetKhoDuocDoiTuong] PreparedStatement : [select kd.* from TM_DOITUONG_KHODUOC kd              inner join TM_DOITUONG dt on dt.DOITUONG_ID = kd.DOITUONG_ID              WHERE              kd.NGAYTRONGTUAN = '2'                          and dt.MADOITUONG = 'VP'              and kd.KHODUOC_ID = '9'              and kd.BENHVIEN_ID = 'HLU01']
2019-12-23 15:56:52,828 [1] DEBUG - Statement Id: [DAO00030_GetPhamViByKhoDuoc] PreparedStatement : [SELECT DISTINCT pv.PHAMVI_ID          FROM TM_DUOC_PHAMVISD_MAPPING mp          INNER JOIN TM_DUOC_PHAMVISUDUNG pv ON mp.PHAMVI_ID = pv.PHAMVI_ID          WHERE          mp.KHODUOC_ID IN (9)          AND mp.BENHVIEN_ID ='HLU01'          AND mp.TAMNGUNG = '0'          AND pv.TAMNGUNG = '0']
2019-12-23 15:56:53,043 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'PHA85'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2019-12-23 15:57:13,589 [1] DEBUG - Statement Id: [DAO00030_GET_SOLONHAP_BANGGIA] PreparedStatement : [SELECT DISTINCT            SLN.SOLONHAP_ID, SLN.SOLONHAP, SLN.SOLOSANPHAM, SLN.SOKIEMSOAT, SLN.SOVISA, CONVERT(varchar(20), SLN.SOLOSANPHAM) + '/' + CONVERT(varchar(20), TK.SOLUONG) AS SOLOSOTON,            SLN.NGAYNHAP AS NGAYNHAPLO, SLN.HANDUNG AS HANSUDUNG,  SLN.HANDUNG, SLN.NGUONDUOC_ID, SLN.NGUONDUOC_ID as NGUONHANG_ID,            SLNGB.DONGIAMUA, SLNGB.DONGIAVON, SLNGB.TYLEVAT_DAUVAO as TYLEVAT, d.TYLE_VAT, SLNGB.DONGIAVONVAT,            dg.DONGIA AS DONGIABAN, dg.DONGIA AS DONGIABAN_VAT,            TK.KHODUOC_ID, TK.DUOC_ID, TK.SOLUONG, TK.SOLUONG AS SOLUONGTON,            D.TENDUOCDAYDU,D.DONVITINH_ID, D.DONVITINH, D.BHYT, NH.TENNGUONDUOC AS NGUONHANG            FROM            TT_DUOC_CHUNGTU_SOLONHAP SLN            INNER JOIN TT_DUOC_TONKHO TK on SLN.SOLONHAP_ID = TK.SOLONHAP_ID            INNER JOIN TT_DUOC_SOLONHAP_GIABAN SLNGB on SLN.SOLONHAP_ID = SLNGB.SOLONHAP_ID            INNER JOIN TM_NGUONHANG NH on SLN.NGUONDUOC_ID = NH.NGUONDUOC_ID            INNER JOIN TM_DUOC D on SLN.DUOC_ID = D.DUOC_ID            INNER JOIN TM_DUOC_DONGIA dg on dg.DUOC_ID = SLN.DUOC_ID            INNER JOIN TM_LOAIGIA lg on (lg.LOAIGIA_ID = dg.LOAIGIA_ID AND lg.MALOAIGIA = 'Gianhathuoc')            WHERE            SLN.DUOC_ID = '1346'            AND TK.KHODUOC_ID = '9'            AND SLN.BENHVIEN_ID = 'HLU01'            AND TK.SOLUONG > 0                 and                     SLN.NGUONDUOC_ID = '1'                                      ORDER BY NGAYNHAP]
2019-12-23 15:57:15,324 [1] DEBUG - Statement Id: [DAO00030_GET_SOLONHAP_BANGGIA] PreparedStatement : [SELECT DISTINCT            SLN.SOLONHAP_ID, SLN.SOLONHAP, SLN.SOLOSANPHAM, SLN.SOKIEMSOAT, SLN.SOVISA, CONVERT(varchar(20), SLN.SOLOSANPHAM) + '/' + CONVERT(varchar(20), TK.SOLUONG) AS SOLOSOTON,            SLN.NGAYNHAP AS NGAYNHAPLO, SLN.HANDUNG AS HANSUDUNG,  SLN.HANDUNG, SLN.NGUONDUOC_ID, SLN.NGUONDUOC_ID as NGUONHANG_ID,            SLNGB.DONGIAMUA, SLNGB.DONGIAVON, SLNGB.TYLEVAT_DAUVAO as TYLEVAT, d.TYLE_VAT, SLNGB.DONGIAVONVAT,            dg.DONGIA AS DONGIABAN, dg.DONGIA AS DONGIABAN_VAT,            TK.KHODUOC_ID, TK.DUOC_ID, TK.SOLUONG, TK.SOLUONG AS SOLUONGTON,            D.TENDUOCDAYDU,D.DONVITINH_ID, D.DONVITINH, D.BHYT, NH.TENNGUONDUOC AS NGUONHANG            FROM            TT_DUOC_CHUNGTU_SOLONHAP SLN            INNER JOIN TT_DUOC_TONKHO TK on SLN.SOLONHAP_ID = TK.SOLONHAP_ID            INNER JOIN TT_DUOC_SOLONHAP_GIABAN SLNGB on SLN.SOLONHAP_ID = SLNGB.SOLONHAP_ID            INNER JOIN TM_NGUONHANG NH on SLN.NGUONDUOC_ID = NH.NGUONDUOC_ID            INNER JOIN TM_DUOC D on SLN.DUOC_ID = D.DUOC_ID            INNER JOIN TM_DUOC_DONGIA dg on dg.DUOC_ID = SLN.DUOC_ID            INNER JOIN TM_LOAIGIA lg on (lg.LOAIGIA_ID = dg.LOAIGIA_ID AND lg.MALOAIGIA = 'Gianhathuoc')            WHERE            SLN.DUOC_ID = '1346'            AND TK.KHODUOC_ID = '9'            AND SLN.BENHVIEN_ID = 'HLU01'            AND TK.SOLUONG > 0                 and                     SLN.NGUONDUOC_ID = '1'                                      ORDER BY NGAYNHAP]
2019-12-23 15:57:17,280 [1] DEBUG - Statement Id: [DAO00030_GET_SOLONHAP_BANGGIA] PreparedStatement : [SELECT DISTINCT            SLN.SOLONHAP_ID, SLN.SOLONHAP, SLN.SOLOSANPHAM, SLN.SOKIEMSOAT, SLN.SOVISA, CONVERT(varchar(20), SLN.SOLOSANPHAM) + '/' + CONVERT(varchar(20), TK.SOLUONG) AS SOLOSOTON,            SLN.NGAYNHAP AS NGAYNHAPLO, SLN.HANDUNG AS HANSUDUNG,  SLN.HANDUNG, SLN.NGUONDUOC_ID, SLN.NGUONDUOC_ID as NGUONHANG_ID,            SLNGB.DONGIAMUA, SLNGB.DONGIAVON, SLNGB.TYLEVAT_DAUVAO as TYLEVAT, d.TYLE_VAT, SLNGB.DONGIAVONVAT,            dg.DONGIA AS DONGIABAN, dg.DONGIA AS DONGIABAN_VAT,            TK.KHODUOC_ID, TK.DUOC_ID, TK.SOLUONG, TK.SOLUONG AS SOLUONGTON,            D.TENDUOCDAYDU,D.DONVITINH_ID, D.DONVITINH, D.BHYT, NH.TENNGUONDUOC AS NGUONHANG            FROM            TT_DUOC_CHUNGTU_SOLONHAP SLN            INNER JOIN TT_DUOC_TONKHO TK on SLN.SOLONHAP_ID = TK.SOLONHAP_ID            INNER JOIN TT_DUOC_SOLONHAP_GIABAN SLNGB on SLN.SOLONHAP_ID = SLNGB.SOLONHAP_ID            INNER JOIN TM_NGUONHANG NH on SLN.NGUONDUOC_ID = NH.NGUONDUOC_ID            INNER JOIN TM_DUOC D on SLN.DUOC_ID = D.DUOC_ID            INNER JOIN TM_DUOC_DONGIA dg on dg.DUOC_ID = SLN.DUOC_ID            INNER JOIN TM_LOAIGIA lg on (lg.LOAIGIA_ID = dg.LOAIGIA_ID AND lg.MALOAIGIA = 'Gianhathuoc')            WHERE            SLN.DUOC_ID = '1346'            AND TK.KHODUOC_ID = '9'            AND SLN.BENHVIEN_ID = 'HLU01'            AND TK.SOLUONG > 0                 and                     SLN.NGUONDUOC_ID = '1'                                      ORDER BY NGAYNHAP]
2019-12-23 15:57:50,338 [1] DEBUG - Statement Id: [DAO00030_DUOCTONKHO_GetSoTonTheoDuoc] PreparedStatement : [SELECT              DUOC_ID,              SUM(SOLUONG) AS TONGTON              FROM              TT_DUOC_TONKHO              WHERE              KHODUOC_ID = '9'              and BENHVIEN_ID = 'HLU01'              and DUOC_ID IN (1346)              GROUP BY DUOC_ID]
2019-12-23 15:57:52,164 [1] DEBUG - Statement Id: [DAO00030_DUOCTONKHO_GetSoTonTheoDuocTheoLo] PreparedStatement : [SELECT              DUOC_ID,SOLONHAP_ID,              SUM(SOLUONG) AS SOLUONGTONLO              FROM              TT_DUOC_TONKHO              WHERE              KHODUOC_ID = '9'              and BENHVIEN_ID = 'HLU01'              and DUOC_ID IN (1346)              and SOLONHAP_ID IN (4902)              GROUP BY DUOC_ID, SOLONHAP_ID]
2019-12-23 15:57:52,226 [1] DEBUG - Statement Id: [DAO00030_LayNgayKhoaSoCuoi] PreparedStatement : [SELECT TOP 1 KHOADENNGAY              FROM TT_DUOC_KHOASOCHUNGTU              WHERE              KHODUOC_ID = '9'              and BENHVIEN_ID = 'HLU01'              and KHOASO = '1'              ORDER BY KHOADENNGAY DESC]
2019-12-23 15:57:52,655 [1] DEBUG - Statement Id: [DAO00036_GetDetail] PreparedStatement : [select KEYTYPE, KEYYEAR, KEYMONTH, KEYDAY, SEGMENT_1, SEGMENT_2, SEGMENT_3, KEYVALUE              from LST_KEYDATA_DUOCPHAM as kd               WHERE                        kd.KEYTYPE = 'SOCHUNGTUNHAPXUATBENNGOAI'                   AND                       kd.KEYYEAR = '2019'                   AND                       kd.KEYMONTH = '12'                   AND                       kd.KEYDAY = '0'                   AND                       kd.SEGMENT_1 = 'KHO_NT'                   AND                       kd.SEGMENT_2 = 'X08'                   AND                       kd.SEGMENT_3 = ' ']
2019-12-23 15:57:52,685 [1] DEBUG - Statement Id: [DAO00036_Update] PreparedStatement : [update LST_KEYDATA_DUOCPHAM set              KEYVALUE =  @param0               where              KEYTYPE = 'SOCHUNGTUNHAPXUATBENNGOAI'              AND KEYYEAR = '2019'              AND KEYMONTH = '12'              AND KEYDAY = '0'              AND SEGMENT_1 = 'KHO_NT'              AND SEGMENT_2 = 'X08'              AND SEGMENT_3 = ' ']
2019-12-23 15:57:52,685 [1] DEBUG - Statement Id: [DAO00036_Update] Parameters: [@param0=[KEYVALUE,000002]]
2019-12-23 15:57:52,685 [1] DEBUG - Statement Id: [DAO00036_Update] Types: [@param0=[String, System.String]]
2019-12-23 15:57:52,779 [1] DEBUG - Statement Id: [DAO00030_TT_NGOAITRU_TOATHUOC_NGUOIMUA_Add] PreparedStatement : [INSERT INTO TT_NGOAITRU_TOATHUOC_NGUOIMUA            (            TENNGUOIMUA            ,HO            ,TEN            ,GIOITINH            ,NGAYSINH            ,NAMSINH            ,SODIENTHOAI            ,SONHA            ,DIACHI            ,DIACHICOQUAN            ,TINHTHANH_ID            ,QUANHUYEN_ID            ,XAPHUONG_ID            ,NGHENGHIEP_ID            ,QUOCTICH_ID            ,DANTOC_ID            ,BENHVIEN_ID            ,NGAYTAO            ,NGUOITAO_ID            ,NGAYCAPNHAT            ,NGUOICAPNHAT_ID            ,BACSIKEDON            ,CHANDOAN            )            VALUES            (             @param0             , @param1             , @param2             , @param3             , @param4             , @param5             , @param6             , @param7             , @param8             , @param9             , @param10             , @param11             , @param12             , @param13             , @param14             , @param15             , @param16             , @param17             , @param18             , @param19             , @param20             , @param21             , @param22             )            select SCOPE_identity() as value]
2019-12-23 15:57:52,780 [1] DEBUG - Statement Id: [DAO00030_TT_NGOAITRU_TOATHUOC_NGUOIMUA_Add] Parameters: [@param0=[TENNGUOIMUA,test bán thuốc 2], @param1=[HO,null], @param2=[TEN,null], @param3=[GIOITINH,1], @param4=[NGAYSINH,12/3/1994 12:00:00 AM], @param5=[NAMSINH,1994], @param6=[SODIENTHOAI,null], @param7=[SONHA,null], @param8=[DIACHI,], @param9=[DIACHICOQUAN,null], @param10=[TINHTHANH_ID,null], @param11=[QUANHUYEN_ID,null], @param12=[XAPHUONG_ID,14791], @param13=[NGHENGHIEP_ID,null], @param14=[QUOCTICH_ID,null], @param15=[DANTOC_ID,null], @param16=[BENHVIEN_ID,HLU01], @param17=[NGAYTAO,12/23/2019 3:57:52 PM], @param18=[NGUOITAO_ID,null], @param19=[NGAYCAPNHAT,12/23/2019 3:57:52 PM], @param20=[NGUOICAPNHAT_ID,null], @param21=[BACSIKEDON,test mua ngoài], @param22=[CHANDOAN,null]]
2019-12-23 15:57:52,780 [1] DEBUG - Statement Id: [DAO00030_TT_NGOAITRU_TOATHUOC_NGUOIMUA_Add] Types: [@param0=[String, System.String], @param1=[System.DBNull, null], @param2=[System.DBNull, null], @param3=[String, System.String], @param4=[DateTime, System.DateTime], @param5=[Int64, System.Int64], @param6=[System.DBNull, null], @param7=[System.DBNull, null], @param8=[String, System.String], @param9=[System.DBNull, null], @param10=[System.DBNull, null], @param11=[System.DBNull, null], @param12=[String, System.String], @param13=[System.DBNull, null], @param14=[System.DBNull, null], @param15=[System.DBNull, null], @param16=[String, System.String], @param17=[DateTime, System.DateTime], @param18=[System.DBNull, null], @param19=[DateTime, System.DateTime], @param20=[System.DBNull, null], @param21=[String, System.String], @param22=[System.DBNull, null]]
2019-12-23 15:57:52,870 [1] DEBUG - Statement Id: [DAO00030_Add] PreparedStatement : [insert into TT_DUOC_CHUNGTU (              MACHUNGTU              , SOCHUNGTU              , NGAYCHUNGTU              , LOAICHUNGTU              , MUCDICHCHUNGTU_ID              , MUCDICHCHUNGTU_CODE              , KHOXUAT_ID              , NGUOIGIAO_ID              , NGUOIGIAO              , KHONHAP_ID              , NGUOINHAN_ID              , NGUOINHAN              , NGUOIKIEMTRA_ID              , NGUOIKIEMTRA              , NGUOIDUYET_ID              , NGUOIDUYET              , PHUONGPHAPXUAT              , KETOANTRUONG_ID              , KETOANTRUONG              , THUKHO_ID              , THUKHO              , MAUHOADON              , SOHOADON              , SOSERI              , NGAYHOADON              , DIENGIAI              , GIATRI              , GIATRITHANHTOAN              , TYLEVAT              , GIATRIVAT              , THUESUAT              , GIATRITHUE              , TYLECHIETKHAU              , GIATRICHIETKHAU              , TIENTE_ID              , TYGIA              , SOCHUNGTUGOC              , NGAYCHUNGTUGOC              , NHACUNGCAP_ID              , HINHTHUCTHANHTOAN_ID              , NGUONDUOC_ID              , CHUNGTULIENQUAN_ID              , KHAMBENH_ID              , TOATHUOCNOITRU_ID              , TIEPNHAN_ID              , BENHAN_ID              , DANHANTHUOC              , NGUOINHAP_ID              , NGAYNHAP              , TRANGTHAI              , LOAITOATHUOC              , PHIEULINH_ID              , DIENGIAINGHIEPVUPHATSINH              , DONVIGIAO_ID              , KHOSUDUNG_ID              , LOAIVATTU_ID              , BENHNHAN_ID              , NGOAITRU_TOATHUOC_NGUOIMUA_ID              , TENBENHNHAN              , BACSIGIOITHIEU_ID              , DOITUONG_ID              , IDCHUYEN              , CHUNGTUKETOAN              , STATUS              , TRANSFER_VIENPHI_ID              , PHONGBAN_ID              , BACSI_ID              , TKNO              , TKCO              , MACHUNGTUREF              , LOAICHUNGTUREF              , PHIEULINHCANTRU_ID              , KHOTHUCHIEN_ID              , KHODOIUNG_ID              , MENU_LOAIDUOC_ID              , NGUOISUDUNGMAY_ID              , GOITHAU_ID              , XUATTHUOCBANGOAITRU              , NGAYGIOCHUNGTU              , NOIDAKHAM              , HOIDONGKIEMNHAP_ID              , HOIDONGTHANHLY_ID              , CHUYENCHUNGTUID              , CHUYENDOANHTHUID              , LYDOXUATSUDUNG_ID              , BENHVIEN_ID              , NGAYTAO              , NGUOITAO_ID              , NGAYCAPNHAT              , NGUOICAPNHAT_ID              ) values (               @param0               ,  @param1               ,  @param2               ,  @param3               ,  @param4               ,  @param5               ,  @param6               ,  @param7               ,  @param8               ,  @param9               ,  @param10               ,  @param11               ,  @param12               ,  @param13               ,  @param14               ,  @param15               ,  @param16               ,  @param17               ,  @param18               ,  @param19               ,  @param20               ,  @param21               ,  @param22               ,  @param23               ,  @param24               ,  @param25               ,  @param26               ,  @param27               ,  @param28               ,  @param29               ,  @param30               ,  @param31               ,  @param32               ,  @param33               ,  @param34               ,  @param35               ,  @param36               ,  @param37               ,  @param38               ,  @param39               ,  @param40               ,  @param41               ,  @param42               ,  @param43               ,  @param44               ,  @param45               ,  @param46               ,  @param47               ,  @param48               ,  @param49               ,  @param50               ,  @param51               ,  @param52               ,  @param53               ,  @param54               ,  @param55               ,  @param56               ,  @param57               ,  @param58               ,  @param59               ,  @param60               ,  @param61               ,  @param62               ,  @param63               ,  @param64               ,  @param65               ,  @param66               ,  @param67               ,  @param68               ,  @param69               ,  @param70               ,  @param71               ,  @param72               ,  @param73               ,  @param74               ,  @param75               ,  @param76               ,  @param77               ,  @param78               ,  @param79               ,  @param80               ,  @param81               ,  @param82               ,  @param83               ,  @param84               ,  @param85               ,  @param2               ,  @param86               ,  @param87               ,  @param88               )              select SCOPE_identity() as value]
2019-12-23 15:57:52,875 [1] DEBUG - Statement Id: [DAO00030_Add] Parameters: [@param0=[MACHUNGTU,KHO_NTX081912000002], @param1=[SOCHUNGTU,000002], @param2=[NGAYCHUNGTU,12/23/2019 3:57:52 PM], @param3=[LOAICHUNGTU,X], @param4=[MUCDICHCHUNGTU_ID,827], @param5=[MUCDICHCHUNGTU_CODE,X08], @param6=[KHOXUAT_ID,9], @param7=[NGUOIGIAO_ID,1], @param8=[NGUOIGIAO,null], @param9=[KHONHAP_ID,null], @param10=[NGUOINHAN_ID,null], @param11=[NGUOINHAN,null], @param12=[NGUOIKIEMTRA_ID,null], @param13=[NGUOIKIEMTRA,null], @param14=[NGUOIDUYET_ID,null], @param15=[NGUOIDUYET,null], @param16=[PHUONGPHAPXUAT,0], @param17=[KETOANTRUONG_ID,null], @param18=[KETOANTRUONG,null], @param19=[THUKHO_ID,null], @param20=[THUKHO,null], @param21=[MAUHOADON,null], @param22=[SOHOADON,null], @param23=[SOSERI,null], @param24=[NGAYHOADON,null], @param25=[DIENGIAI,null], @param26=[GIATRI,1000], @param27=[GIATRITHANHTOAN,null], @param28=[TYLEVAT,0], @param29=[GIATRIVAT,0], @param30=[THUESUAT,null], @param31=[GIATRITHUE,null], @param32=[TYLECHIETKHAU,null], @param33=[GIATRICHIETKHAU,null], @param34=[TIENTE_ID,null], @param35=[TYGIA,null], @param36=[SOCHUNGTUGOC,null], @param37=[NGAYCHUNGTUGOC,null], @param38=[NHACUNGCAP_ID,null], @param39=[HINHTHUCTHANHTOAN_ID,null], @param40=[NGUONDUOC_ID,1], @param41=[CHUNGTULIENQUAN_ID,null], @param42=[KHAMBENH_ID,null], @param43=[TOATHUOCNOITRU_ID,null], @param44=[TIEPNHAN_ID,null], @param45=[BENHAN_ID,null], @param46=[DANHANTHUOC,0], @param47=[NGUOINHAP_ID,null], @param48=[NGAYNHAP,null], @param49=[TRANGTHAI,CHUATHANHTOAN], @param50=[LOAITOATHUOC,TBN], @param51=[PHIEULINH_ID,null], @param52=[DIENGIAINGHIEPVUPHATSINH,null], @param53=[DONVIGIAO_ID,null], @param54=[KHOSUDUNG_ID,null], @param55=[LOAIVATTU_ID,null], @param56=[BENHNHAN_ID,null], @param57=[NGOAITRU_TOATHUOC_NGUOIMUA_ID,3790], @param58=[TENBENHNHAN,test bán thuốc 2], @param59=[BACSIGIOITHIEU_ID,null], @param60=[DOITUONG_ID,null], @param61=[IDCHUYEN,null], @param62=[CHUNGTUKETOAN,null], @param63=[STATUS,null], @param64=[TRANSFER_VIENPHI_ID,null], @param65=[PHONGBAN_ID,38], @param66=[BACSI_ID,null], @param67=[TKNO,null], @param68=[TKCO,null], @param69=[MACHUNGTUREF,null], @param70=[LOAICHUNGTUREF,null], @param71=[PHIEULINHCANTRU_ID,null], @param72=[KHOTHUCHIEN_ID,null], @param73=[KHODOIUNG_ID,null], @param74=[MENU_LOAIDUOC_ID,null], @param75=[NGUOISUDUNGMAY_ID,null], @param76=[GOITHAU_ID,null], @param77=[XUATTHUOCBANGOAITRU,null], @param78=[NGAYGIOCHUNGTU,null], @param79=[NOIDAKHAM,null], @param80=[HOIDONGKIEMNHAP_ID,null], @param81=[HOIDONGTHANHLY_ID,null], @param82=[CHUYENCHUNGTUID,null], @param83=[CHUYENDOANHTHUID,null], @param84=[LYDOXUATSUDUNG_ID,null], @param85=[BENHVIEN_ID,HLU01], @param86=[NGUOITAO_ID,1], @param87=[NGAYCAPNHAT,12/23/2019 3:57:52 PM], @param88=[NGUOICAPNHAT_ID,1]]
2019-12-23 15:57:52,876 [1] DEBUG - Statement Id: [DAO00030_Add] Types: [@param0=[String, System.String], @param1=[String, System.String], @param2=[DateTime, System.DateTime], @param3=[String, System.String], @param4=[Int64, System.Int64], @param5=[String, System.String], @param6=[Int64, System.Int64], @param7=[Int64, System.Int64], @param8=[System.DBNull, null], @param9=[System.DBNull, null], @param10=[System.DBNull, null], @param11=[System.DBNull, null], @param12=[System.DBNull, null], @param13=[System.DBNull, null], @param14=[System.DBNull, null], @param15=[System.DBNull, null], @param16=[Int64, System.Int64], @param17=[System.DBNull, null], @param18=[System.DBNull, null], @param19=[System.DBNull, null], @param20=[System.DBNull, null], @param21=[System.DBNull, null], @param22=[System.DBNull, null], @param23=[System.DBNull, null], @param24=[System.DBNull, null], @param25=[System.DBNull, null], @param26=[Double, System.Double], @param27=[System.DBNull, null], @param28=[Double, System.Double], @param29=[Double, System.Double], @param30=[System.DBNull, null], @param31=[System.DBNull, null], @param32=[System.DBNull, null], @param33=[System.DBNull, null], @param34=[System.DBNull, null], @param35=[System.DBNull, null], @param36=[System.DBNull, null], @param37=[System.DBNull, null], @param38=[System.DBNull, null], @param39=[System.DBNull, null], @param40=[Int64, System.Int64], @param41=[System.DBNull, null], @param42=[System.DBNull, null], @param43=[System.DBNull, null], @param44=[System.DBNull, null], @param45=[System.DBNull, null], @param46=[String, System.String], @param47=[System.DBNull, null], @param48=[System.DBNull, null], @param49=[String, System.String], @param50=[String, System.String], @param51=[System.DBNull, null], @param52=[System.DBNull, null], @param53=[System.DBNull, null], @param54=[System.DBNull, null], @param55=[System.DBNull, null], @param56=[System.DBNull, null], @param57=[Int64, System.Int64], @param58=[String, System.String], @param59=[System.DBNull, null], @param60=[System.DBNull, null], @param61=[System.DBNull, null], @param62=[System.DBNull, null], @param63=[System.DBNull, null], @param64=[System.DBNull, null], @param65=[Int64, System.Int64], @param66=[System.DBNull, null], @param67=[System.DBNull, null], @param68=[System.DBNull, null], @param69=[System.DBNull, null], @param70=[System.DBNull, null], @param71=[System.DBNull, null], @param72=[System.DBNull, null], @param73=[System.DBNull, null], @param74=[System.DBNull, null], @param75=[System.DBNull, null], @param76=[System.DBNull, null], @param77=[System.DBNull, null], @param78=[System.DBNull, null], @param79=[System.DBNull, null], @param80=[System.DBNull, null], @param81=[System.DBNull, null], @param82=[System.DBNull, null], @param83=[System.DBNull, null], @param84=[System.DBNull, null], @param85=[String, System.String], @param86=[Int64, System.Int64], @param87=[DateTime, System.DateTime], @param88=[Int64, System.Int64]]
2019-12-23 15:57:52,972 [1] DEBUG - Statement Id: [DAOLOG01_LockBegin] PreparedStatement : [INSERT into TT_LOG_UPDATE ( REF_TABLE , REF_ID , BENHVIEN_ID )         values ( @param0 ,  @param1 ,  @param2 );]
2019-12-23 15:57:52,972 [1] DEBUG - Statement Id: [DAOLOG01_LockBegin] Parameters: [@param0=[REF_TABLE,TT_DUOC_CHUNGTU], @param1=[REF_ID,138711], @param2=[BENHVIEN_ID,HLU01]]
2019-12-23 15:57:52,973 [1] DEBUG - Statement Id: [DAOLOG01_LockBegin] Types: [@param0=[String, System.String], @param1=[Int64, System.Int64], @param2=[String, System.String]]
2019-12-23 15:57:53,003 [1] DEBUG - Statement Id: [DAO00030_CHUNGTUCT_Add] PreparedStatement : [insert into TT_DUOC_CHUNGTU_CHITIET (            CHUNGTU_ID            , DUOC_ID            , SOLONHAP_ID            , SOKIEMSOAT            , SOVISA            , HANDUNG            , DONVITINH_ID            , SOLUONGYEUCAU            , SOLUONGTHUCTE            , SOLUONGDAXUAT            , TIENTE_ID            , TYGIA            , DONGIAMUA            , DONGIA_BHYT            , DONGIABAN            , DONGIABAN_VAT            , DONGIAVON            , DONGIATHANHTOAN            , SOQUYEN            , SOHOADONVAT            , TYLEVAT            , GIATRIVAT            , TYLECHIETKHAU            , GIATRICHIETKHAU            , MIENPHI            , LYDOMIENPHI_ID            , SOCHUNGTUKETOAN            , SOCHUNGTUTIENMAT            , TRANGTHAI            , DAPHATSINHPHIEUXUAT            , DAPHATSINHPHIEUHOANTRA            , KHUYENMAI            , PHUONGPHAPXUAT            , DONDATHANG_ID            , GHICHUCHITIET            , NGUONHANG_ID            , DONGIAVONVAT            , THANHTIENMUA            , THANHTIENVON            , THANHTIENHOPDONG            , ISTACHLO            , DONVITINHBANDAU_ID            , SOLUONGBANDAU            , GOITHAU_ID            , DONGIATHAU            , DONGIAPO            , TYLEQUIDOI            , TOATHUOCNOITRU_ID            , KHAMBENH_VTYT_ID            , PHAUTHUAT_VTYT_ID            , CLSKETQUA_VTYT_ID            , TOATHUOCNGOAITRU_ID            , MASTER_ID            , BENHNHAN            , YLENH                                   , BENHVIEN_ID            , NGAYTAO            , NGUOITAO_ID            , NGAYCAPNHAT            , NGUOICAPNHAT_ID            , THANHTIENMUABANDAU            , SOLUONGQUIDOI            ) values (             @param0             ,  @param1             ,  @param2             ,  @param3             ,  @param4             ,  @param5             ,  @param6             ,  @param7             ,  @param8             ,  @param9             ,  @param10             ,  @param11             ,  @param12             ,  @param13             ,  @param14             ,  @param15             ,  @param16             ,  @param17             ,  @param18             ,  @param19             ,  @param20             ,  @param21             ,  @param22             ,  @param23             ,  @param24             ,  @param25             ,  @param26             ,  @param27             ,  @param28             ,  @param29             ,  @param30             ,  @param31             ,  @param32             ,  @param33             ,  @param34             ,  @param35             ,  @param36             ,  @param37             ,  @param38             ,  @param39             ,  @param40             ,  @param41             ,  @param42             ,  @param43             ,  @param44             ,  @param45             ,  @param46             ,  @param47             ,  @param48             ,  @param49             ,  @param50             ,  @param51             ,  @param52             ,  @param53             ,  @param54                          ,  @param55             ,  @param56             ,  @param57             ,  @param58             ,  @param59             ,  @param60             ,  @param61             )            select SCOPE_identity() as value]
2019-12-23 15:57:53,003 [1] DEBUG - Statement Id: [DAO00030_CHUNGTUCT_Add] Parameters: [@param0=[CHUNGTU_ID,138711], @param1=[DUOC_ID,1346], @param2=[SOLONHAP_ID,4902], @param3=[SOKIEMSOAT,null], @param4=[SOVISA,VD-10918-10], @param5=[HANDUNG,12/12/2026 12:00:00 AM], @param6=[DONVITINH_ID,5], @param7=[SOLUONGYEUCAU,5], @param8=[SOLUONGTHUCTE,null], @param9=[SOLUONGDAXUAT,5], @param10=[TIENTE_ID,VND], @param11=[TYGIA,1], @param12=[DONGIAMUA,135], @param13=[DONGIA_BHYT,135], @param14=[DONGIABAN,200], @param15=[DONGIABAN_VAT,200], @param16=[DONGIAVON,135], @param17=[DONGIATHANHTOAN,0], @param18=[SOQUYEN,null], @param19=[SOHOADONVAT,null], @param20=[TYLEVAT,0], @param21=[GIATRIVAT,675], @param22=[TYLECHIETKHAU,0], @param23=[GIATRICHIETKHAU,0], @param24=[MIENPHI,0], @param25=[LYDOMIENPHI_ID,null], @param26=[SOCHUNGTUKETOAN,null], @param27=[SOCHUNGTUTIENMAT,null], @param28=[TRANGTHAI,], @param29=[DAPHATSINHPHIEUXUAT,null], @param30=[DAPHATSINHPHIEUHOANTRA,null], @param31=[KHUYENMAI,0], @param32=[PHUONGPHAPXUAT,0], @param33=[DONDATHANG_ID,null], @param34=[GHICHUCHITIET,null], @param35=[NGUONHANG_ID,1], @param36=[DONGIAVONVAT,135], @param37=[THANHTIENMUA,675], @param38=[THANHTIENVON,675], @param39=[THANHTIENHOPDONG,675], @param40=[ISTACHLO,null], @param41=[DONVITINHBANDAU_ID,null], @param42=[SOLUONGBANDAU,null], @param43=[GOITHAU_ID,null], @param44=[DONGIATHAU,0], @param45=[DONGIAPO,null], @param46=[TYLEQUIDOI,null], @param47=[TOATHUOCNOITRU_ID,null], @param48=[KHAMBENH_VTYT_ID,null], @param49=[PHAUTHUAT_VTYT_ID,null], @param50=[CLSKETQUA_VTYT_ID,null], @param51=[TOATHUOCNGOAITRU_ID,null], @param52=[MASTER_ID,0], @param53=[BENHNHAN,], @param54=[YLENH,], @param55=[BENHVIEN_ID,HLU01], @param56=[NGAYTAO,12/23/2019 3:57:53 PM], @param57=[NGUOITAO_ID,null], @param58=[NGAYCAPNHAT,12/23/2019 3:57:53 PM], @param59=[NGUOICAPNHAT_ID,null], @param60=[THANHTIENMUABANDAU,null], @param61=[SOLUONGQUIDOI,null]]
2019-12-23 15:57:53,003 [1] DEBUG - Statement Id: [DAO00030_CHUNGTUCT_Add] Types: [@param0=[Int32, System.Int32], @param1=[Int64, System.Int64], @param2=[Int64, System.Int64], @param3=[System.DBNull, null], @param4=[String, System.String], @param5=[DateTime, System.DateTime], @param6=[Int64, System.Int64], @param7=[Double, System.Double], @param8=[System.DBNull, null], @param9=[Double, System.Double], @param10=[String, System.String], @param11=[Double, System.Double], @param12=[Double, System.Double], @param13=[Double, System.Double], @param14=[Double, System.Double], @param15=[Double, System.Double], @param16=[Double, System.Double], @param17=[Double, System.Double], @param18=[System.DBNull, null], @param19=[System.DBNull, null], @param20=[Double, System.Double], @param21=[Double, System.Double], @param22=[Double, System.Double], @param23=[Double, System.Double], @param24=[String, System.String], @param25=[System.DBNull, null], @param26=[System.DBNull, null], @param27=[System.DBNull, null], @param28=[String, System.String], @param29=[System.DBNull, null], @param30=[System.DBNull, null], @param31=[String, System.String], @param32=[Int64, System.Int64], @param33=[System.DBNull, null], @param34=[System.DBNull, null], @param35=[Int64, System.Int64], @param36=[Double, System.Double], @param37=[Double, System.Double], @param38=[Double, System.Double], @param39=[Double, System.Double], @param40=[System.DBNull, null], @param41=[System.DBNull, null], @param42=[System.DBNull, null], @param43=[System.DBNull, null], @param44=[Double, System.Double], @param45=[System.DBNull, null], @param46=[System.DBNull, null], @param47=[System.DBNull, null], @param48=[System.DBNull, null], @param49=[System.DBNull, null], @param50=[System.DBNull, null], @param51=[System.DBNull, null], @param52=[Int64, System.Int64], @param53=[String, System.String], @param54=[String, System.String], @param55=[String, System.String], @param56=[DateTime, System.DateTime], @param57=[System.DBNull, null], @param58=[DateTime, System.DateTime], @param59=[System.DBNull, null], @param60=[System.DBNull, null], @param61=[System.DBNull, null]]
2019-12-23 15:57:53,241 [1] DEBUG - Statement Id: [DAO00030_TT_VIENPHI_Add] PreparedStatement : [INSERT INTO TT_VIENPHI (              TIEPNHAN_ID              , BENHNHAN_ID              , KHAMBENH_ID              , REF_ID              , REF_TABLE              , DUOC_ID              , SOLONHAP_ID              , LOAI_CHIPHI              , LOAIGIA_ID              , SOLUONG              , DONGIA_DOANHTHU              , THANHTIEN_DOANHTHU              , BHYT_TL              , BENHNHAN_PHAITHANHTOAN              , GIATRI_HOADON              , GIATRI_HOADON_DATHANHTOAN              , GIATRI_BIENLAI              , GIATRI_BIENLAI_DATHANHTOAN              , GIATRI_BENHNHAN_DATHANHTOAN              , TYLE_VAT              , GIAVON              , BANGGIA_ID              , DUOCPHEPTHUCHIEN              , HUY              , KHONGTHUTIEN              , DATHANHTOAN              , DATHUCHIEN              , HOADON_ID              , ACTIVE              , DUYET              , BENHVIEN_ID              , NGUOITAO_ID              , NGAYTAO              , NGUOICAPNHAT_ID              , NGAYCAPNHAT              ) values (               @param0               ,  @param1               ,  @param2               ,  @param3               ,  @param4               ,  @param5               ,  @param6               ,  @param7               ,  @param8               ,  @param9               ,  @param10               ,  @param11               ,  @param12               ,  @param13               ,  @param14               ,  @param15               ,  @param16               ,  @param17               ,  @param18               ,  @param19               ,  @param20               ,  @param21               ,  @param22               ,  @param23               ,  @param24               ,  @param25               ,  @param26               ,  @param27               ,  @param28               ,  @param29               ,  @param30               ,  @param31               ,  @param32               ,  @param33               ,  @param34               )              select SCOPE_identity() as value]
2019-12-23 15:57:53,241 [1] DEBUG - Statement Id: [DAO00030_TT_VIENPHI_Add] Parameters: [@param0=[TIEPNHAN_ID,null], @param1=[BENHNHAN_ID,null], @param2=[KHAMBENH_ID,null], @param3=[REF_ID,1300063], @param4=[REF_TABLE,TT_DUOC_CHUNGTU_CHITIET], @param5=[DUOC_ID,1346], @param6=[SOLONHAP_ID,4902], @param7=[LOAI_CHIPHI,TT], @param8=[LOAIGIA_ID,36], @param9=[SOLUONG,5], @param10=[DONGIA_DOANHTHU,200], @param11=[THANHTIEN_DOANHTHU,1000], @param12=[BHYT_TL,0], @param13=[BENHNHAN_PHAITHANHTOAN,1000], @param14=[GIATRI_HOADON,0], @param15=[GIATRI_HOADON_DATHANHTOAN,0], @param16=[GIATRI_BIENLAI,1000], @param17=[GIATRI_BIENLAI_DATHANHTOAN,0], @param18=[GIATRI_BENHNHAN_DATHANHTOAN,0], @param19=[TYLE_VAT,0], @param20=[GIAVON,135], @param21=[BANGGIA_ID,null], @param22=[DUOCPHEPTHUCHIEN,0], @param23=[HUY,0], @param24=[KHONGTHUTIEN,0], @param25=[DATHANHTOAN,0], @param26=[DATHUCHIEN,0], @param27=[HOADON_ID,null], @param28=[ACTIVE,1], @param29=[DUYET,0], @param30=[BENHVIEN_ID,HLU01], @param31=[NGUOITAO_ID,1], @param32=[NGAYTAO,12/23/2019 3:57:53 PM], @param33=[NGUOICAPNHAT_ID,1], @param34=[NGAYCAPNHAT,12/23/2019 3:57:53 PM]]
2019-12-23 15:57:53,241 [1] DEBUG - Statement Id: [DAO00030_TT_VIENPHI_Add] Types: [@param0=[System.DBNull, null], @param1=[System.DBNull, null], @param2=[System.DBNull, null], @param3=[Int64, System.Int64], @param4=[String, System.String], @param5=[Int64, System.Int64], @param6=[Int64, System.Int64], @param7=[String, System.String], @param8=[String, System.String], @param9=[Double, System.Double], @param10=[Double, System.Double], @param11=[Double, System.Double], @param12=[Int32, System.Int32], @param13=[Double, System.Double], @param14=[Int32, System.Int32], @param15=[Int32, System.Int32], @param16=[Double, System.Double], @param17=[Int32, System.Int32], @param18=[Int32, System.Int32], @param19=[Double, System.Double], @param20=[Double, System.Double], @param21=[System.DBNull, null], @param22=[String, System.String], @param23=[String, System.String], @param24=[String, System.String], @param25=[String, System.String], @param26=[String, System.String], @param27=[System.DBNull, null], @param28=[String, System.String], @param29=[String, System.String], @param30=[String, System.String], @param31=[Int64, System.Int64], @param32=[DateTime, System.DateTime], @param33=[Int64, System.Int64], @param34=[DateTime, System.DateTime]]
2019-12-23 15:57:53,270 [1] DEBUG - Statement Id: [DAO00030_TT_DUOC_TONKHO_LOG_Add] PreparedStatement : [DECLARE @KHODUOC_ID int               DECLARE @TONTRUOC numeric(18, 4)               DECLARE @TONSAU numeric(18, 4)               DECLARE @SOLUONGNHAP numeric(18, 4)               DECLARE @SOLUONGXUAT numeric(18, 4)                              IF( @param0  = 'N')               BEGIN                SET @KHODUOC_ID =  @param1                END               ELSE               BEGIN                 SET @KHODUOC_ID =  @param2                END                              SELECT @TONTRUOC = SOLUONG FROM TT_DUOC_TONKHO WHERE KHODUOC_ID = @KHODUOC_ID  AND DUOC_ID =  @param3  AND SOLONHAP_ID =  @param4  AND NGUONDUOC_ID =  @param5                               IF( @param0  = 'N' AND  @param6  = 'ADD')               BEGIN                SET @TONSAU = ISNULL(@TONTRUOC,0) +  @param7                 SET @SOLUONGNHAP =  @param7                 SET @SOLUONGXUAT = 0               END               IF( @param0  = 'N' AND  @param6  = 'DEL')               BEGIN                SET @TONSAU = ISNULL(@TONTRUOC,0) -  @param7                 SET @SOLUONGXUAT =  @param7                 SET @SOLUONGNHAP = 0               END                                         IF( @param0  = 'X' AND  @param6  = 'ADD')               BEGIN                SET @TONSAU = ISNULL(@TONTRUOC,0) -  @param8                 SET @SOLUONGXUAT =  @param8                 SET @SOLUONGNHAP = 0               END               IF( @param0  = 'X' AND  @param6  = 'DEL')               BEGIN                SET @TONSAU = ISNULL(@TONTRUOC,0) +  @param8                 SET @SOLUONGNHAP =  @param8                 SET @SOLUONGXUAT = 0                             END                        insert into TT_DUOC_TONKHO_LOG (                           CHUNGTUCHITIET_ID              ,CHUNGTU_ID              ,MACHUNGTU              ,LOAICHUNGTU              ,MUCDICHCHUNGTU_CODE              ,KHONHAP_ID              ,KHOXUAT_ID              ,DUOC_ID              ,SOLONHAP_ID              ,NGUONDUOC_ID              ,SOLUONGNHAP              ,SOLUONGXUAT              ,DONGIAMUA              ,DONGIAVON              ,TYLE_VAT              ,DONGIAVONVAT              ,TONTRUOC              ,TONSAU              ,ACTION              ,BENHVIEN_ID              ,NGAYTAO              ,NGUOITAO_ID                          ) values (              @param9               , @param10               , @param11               , @param0               , @param12               , @param1               , @param2               , @param3               , @param4               , @param5               ,@SOLUONGNHAP              ,@SOLUONGXUAT              , @param13               , @param14               , @param15               , @param16               ,@TONTRUOC              ,@TONSAU              , @param6               , @param17               , @param18               , @param19               )]
2019-12-23 15:57:53,270 [1] DEBUG - Statement Id: [DAO00030_TT_DUOC_TONKHO_LOG_Add] Parameters: [@param0=[LOAICHUNGTU,X], @param1=[KHONHAP_ID,null], @param2=[KHOXUAT_ID,9], @param3=[DUOC_ID,1346], @param4=[SOLONHAP_ID,4902], @param5=[NGUONDUOC_ID,1], @param6=[ACTION,ADD], @param7=[SOLUONGNHAP,null], @param8=[SOLUONGXUAT,5], @param9=[CHUNGTUCHITIET_ID,1300063], @param10=[CHUNGTU_ID,138711], @param11=[MACHUNGTU,KHO_NTX081912000002], @param12=[MUCDICHCHUNGTU_CODE,X08], @param13=[DONGIAMUA,135], @param14=[DONGIAVON,135], @param15=[TYLE_VAT,0], @param16=[DONGIAVONVAT,135], @param17=[BENHVIEN_ID,HLU01], @param18=[NGAYTAO,12/23/2019 3:57:53 PM], @param19=[NGUOITAO_ID,1]]
2019-12-23 15:57:53,270 [1] DEBUG - Statement Id: [DAO00030_TT_DUOC_TONKHO_LOG_Add] Types: [@param0=[String, System.String], @param1=[System.DBNull, null], @param2=[Int64, System.Int64], @param3=[Int64, System.Int64], @param4=[Int64, System.Int64], @param5=[Int64, System.Int64], @param6=[String, System.String], @param7=[System.DBNull, null], @param8=[Decimal, System.Decimal], @param9=[Int64, System.Int64], @param10=[Int32, System.Int32], @param11=[String, System.String], @param12=[String, System.String], @param13=[Decimal, System.Decimal], @param14=[Decimal, System.Decimal], @param15=[Double, System.Double], @param16=[Double, System.Double], @param17=[String, System.String], @param18=[DateTime, System.DateTime], @param19=[Int64, System.Int64]]
2019-12-23 15:57:53,311 [1] DEBUG - Statement Id: [DAO00114_CHUNGTUTHUOC_MUANGOAI_ChiTiet_BIL12] PreparedStatement : [select distinct ct.*, isnull(bn.MAYTE, 'VANGLAI') as MAYTE, isnull(bn.NAMSINH, ntnm.NAMSINH) as NAMSINH        from TT_DUOC_CHUNGTU ct        left join TT_BENHNHAN bn on bn.benhnhan_id = ct.benhnhan_id        inner join TT_DUOC_CHUNGTU_CHITIET ctct on ct.CHUNGTU_ID = ctct.CHUNGTU_ID        left join TT_NGOAITRU_TOATHUOC_NGUOIMUA ntnm on ntnm.NGOAITRU_TOATHUOC_NGUOIMUA_ID = ct.NGOAITRU_TOATHUOC_NGUOIMUA_ID        inner join TT_VIENPHI vp on vp.REF_ID = ctct.CHUNGTUCHITIET_ID and REF_TABLE = 'TT_DUOC_CHUNGTU_CHITIET' and vp.DATHANHTOAN = '0' and vp.REF_ID = '1300063'        where              ct.MUCDICHCHUNGTU_CODE = 'X08'        and ct.BENHVIEN_ID = 'HLU01'        order by ct.MACHUNGTU desc]
2019-12-23 15:57:53,474 [1] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM034']
2019-12-23 15:57:53,872 [1] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoVaBookingCOM23UpdateRedis] PreparedStatement : [declare @NGUONDUOC_MACDINH varchar(5) = '0';        declare @TOAMUANGOAI int = 0;        select @NGUONDUOC_MACDINH = isnull(VALUE,0) from TM_SYS_APPSETTINGS where CODE = 'PHA_NGUONDUOC'        select @TOAMUANGOAI = isnull(VALUE,0) from TM_SYS_APPSETTINGS where CODE = 'OPD_TOAMUANGOAI_DUNGDANHMUC_DUOC'                if @TOAMUANGOAI = 1        begin        select  distinct '0' + '_' + LTRIM(d.DUOC_ID) + '_' + @NGUONDUOC_MACDINH as DUOC_KEY, 0 as PHAMVI_ID, @NGUONDUOC_MACDINH as NGUONDUOC_ID, null as TENNGUONDUOC, null as TINHTIEN, d.DUOC_ID, ld.MALOAIDUOC,        d.SOVISA,d.TYLE_VAT,d.COTOA, d.MADUOC, d.TENHANG, d.TENDUOCDAYDU, dvt.TENDONVITINH as DONVITINH, d.BHYT,        d.TENHOATCHAT, d.HAMLUONG, d.HANGSANXUAT, d.QUOCGIA, d.LOAIDUOC_ID, d.DUONGDUNG_ID, d.TINHTIEN_PTTT,        ten.TENDUOC, ten.TENDUOC_EN, ten.MAQUOCTE, ten.MAQUOCTEBT,d.CONGDUNG,        '' as BHYT_TEXT        , ld.LOAIVATTU_ID        , d.BENHVIEN_ID,        999999999 as SOLUONG, d.VTYT_PHANLOAI, d.PHAMVI, d.SUASOLUONGTONGHOP, d.MADUOCBV, d.DANGTRINHBAY        , TAMNGUNG = CASE WHEN d.TAMNGUNG = '1' THEN '1' ELSE '0' END        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        where d.DUOC_ID in (1346)        union all        select  distinct tk.DUOC_KEY, LTRIM(tk.PHAMVI_ID) as PHAMVI_ID, tk.NGUONDUOC_ID, nh.TENNGUONDUOC, nh.TINHTIEN, d.DUOC_ID, ld.MALOAIDUOC,        d.SOVISA,d.TYLE_VAT,d.COTOA, d.MADUOC, d.TENHANG, d.TENDUOCDAYDU, dvt.TENDONVITINH as DONVITINH, d.BHYT,        d.TENHOATCHAT, d.HAMLUONG, d.HANGSANXUAT, d.QUOCGIA, d.LOAIDUOC_ID, d.DUONGDUNG_ID, d.TINHTIEN_PTTT,        ten.TENDUOC, ten.TENDUOC_EN, ten.MAQUOCTE, ten.MAQUOCTEBT,d.CONGDUNG,        CASE WHEN d.BHYT = '1' THEN 'BHYT' ELSE '' END as BHYT_TEXT        , ld.LOAIVATTU_ID        , d.BENHVIEN_ID,        tk.SOLUONG, d.VTYT_PHANLOAI, d.PHAMVI, d.SUASOLUONGTONGHOP, d.MADUOCBV, d.DANGTRINHBAY        , TAMNGUNG = CASE WHEN d.TAMNGUNG = '1' OR nh.TAMNGUNG = '1' OR kd.TAMNGUNG = '1' THEN '1' ELSE '0' END        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        inner join        (        select  LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')) DUOC_KEY, (SUM(dtk.SOLUONG) - isnull(sum(A.SOLUONG),0) - isnull(sum(B.SOLUONG),0)) SOLUONG, pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        from (select sum(soluong) soluong,duoc_id,nguonduoc_id,khoduoc_id,benhvien_id from TT_DUOC_TONKHO  group by duoc_id,nguonduoc_id,khoduoc_id,benhvien_id) dtk        inner join TM_DUOC_PHAMVISD_MAPPING pvsd on dtk.KHODUOC_ID = pvsd.KHODUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NOITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) B on B.DUOC_ID = dtk.DUOC_ID and B.SOLUONG > 0 and B.PHAMVI_ID = pvsd.PHAMVI_ID and B.NGUONHANG_ID = dtk.NGUONDUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NGOAITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) A on A.DUOC_ID = dtk.DUOC_ID and A.SOLUONG > 0 and A.PHAMVI_ID = pvsd.PHAMVI_ID and A.NGUONHANG_ID = dtk.NGUONDUOC_ID        where dtk.SOLUONG > 0 and dtk.BENHVIEN_ID = 'HLU01'        group by LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')), pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        ) tk on tk.DUOC_ID = d.DUOC_ID        left join TM_DUOC_PHAMVISUDUNG kd on kd.PHAMVI_ID = tk.PHAMVI_ID and kd.BENHVIEN_ID = 'HLU01'        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = tk.NGUONDUOC_ID and nh.BENHVIEN_ID = 'HLU01'        where  d.BENHVIEN_ID = 'HLU01' and d.DUOC_ID in (1346)        end        else        begin        select  distinct tk.DUOC_KEY, LTRIM(tk.PHAMVI_ID) as PHAMVI_ID, tk.NGUONDUOC_ID, nh.TENNGUONDUOC, nh.TINHTIEN, d.DUOC_ID, ld.MALOAIDUOC,        d.SOVISA,d.TYLE_VAT,d.COTOA, d.MADUOC, d.TENHANG, d.TENDUOCDAYDU, dvt.TENDONVITINH as DONVITINH, d.BHYT,        d.TENHOATCHAT, d.HAMLUONG, d.HANGSANXUAT, d.QUOCGIA, d.LOAIDUOC_ID, d.DUONGDUNG_ID, d.TINHTIEN_PTTT,        ten.TENDUOC, ten.TENDUOC_EN, ten.MAQUOCTE, ten.MAQUOCTEBT,d.CONGDUNG,        CASE WHEN d.BHYT = '1' THEN 'BHYT' ELSE '' END as BHYT_TEXT        , ld.LOAIVATTU_ID        , d.BENHVIEN_ID,        tk.SOLUONG, d.VTYT_PHANLOAI, d.PHAMVI, d.SUASOLUONGTONGHOP, d.MADUOCBV, d.DANGTRINHBAY        , TAMNGUNG = CASE WHEN d.TAMNGUNG = '1' OR nh.TAMNGUNG = '1' OR kd.TAMNGUNG = '1' THEN '1' ELSE '0' END        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        inner join        (        select  LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')) DUOC_KEY, (SUM(dtk.SOLUONG) - isnull(sum(A.SOLUONG),0) - isnull(sum(B.SOLUONG),0)) SOLUONG, pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        from (select sum(soluong) soluong,duoc_id,nguonduoc_id,khoduoc_id,benhvien_id from TT_DUOC_TONKHO  group by duoc_id,nguonduoc_id,khoduoc_id,benhvien_id) dtk        inner join TM_DUOC_PHAMVISD_MAPPING pvsd on dtk.KHODUOC_ID = pvsd.KHODUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NOITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) B on B.DUOC_ID = dtk.DUOC_ID and B.SOLUONG > 0 and B.PHAMVI_ID = pvsd.PHAMVI_ID and B.NGUONHANG_ID = dtk.NGUONDUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NGOAITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) A on A.DUOC_ID = dtk.DUOC_ID and A.SOLUONG > 0 and A.PHAMVI_ID = pvsd.PHAMVI_ID and A.NGUONHANG_ID = dtk.NGUONDUOC_ID        where dtk.SOLUONG > 0 and dtk.BENHVIEN_ID = 'HLU01'        group by LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')), pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        ) tk on tk.DUOC_ID = d.DUOC_ID        left join TM_DUOC_PHAMVISUDUNG kd on kd.PHAMVI_ID = tk.PHAMVI_ID and kd.BENHVIEN_ID = 'HLU01'        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = tk.NGUONDUOC_ID and nh.BENHVIEN_ID = 'HLU01'        where  d.BENHVIEN_ID = 'HLU01' and d.DUOC_ID in (1346)        end]
2019-12-23 15:57:56,473 [1] DEBUG - Statement Id: [DAO00030_MergSoLuongTonKho] PreparedStatement : [BEGIN          BEGIN TRY          BEGIN TRANSACTION            UPDATE TT_DUOC_TONKHO SET SOLUONG=0,DONGIAMUA=null WHERE KHODUOC_ID IN(9);          MERGE TT_DUOC_TONKHO AS X USING          (          select aa.SoLoNhap_ID,aa.KHODUOC_ID,aa.DUOC_ID,  aa.NGUONDUOC_ID,aa.BENHVIEN_ID, (case when sum(aa.soluong) < 0 then 0 else sum(aa.soluong) end) as SOLUONG from (          Select (case when CTU.LoaiChungTu = 'N' then CTU.KhoNhap_ID else ctu.KhoXuat_ID end) as KHODUOC_ID, CT.SOLONHAP_ID,          (case when CTU.LoaiChungTu = 'N' then SoLuongThucTe*ISNULL(CT.TYLEQUIDOI,1) else - SOLUONGDAXUAT end) as SOLUONG,CT.DUOC_ID,          Lo.NGUONDUOC_ID,CTU.BENHVIEN_ID          from TT_DUOC_CHUNGTU_CHITIET CT          join TT_DUOC_CHUNGTU CTU on CT.ChungTu_ID = CTU.ChungTu_ID AND CT.BENHVIEN_ID=CTU.BENHVIEN_ID          join TT_DUOC_CHUNGTU_SOLONHAP Lo on Lo.SoLoNhap_ID = CT.SoLoNhap_ID          join TM_DUOC duoc on CT.DUOC_ID = duoc.DUOC_ID          where ((CTU.TRANGTHAI not in ('PNCXN','CXN','HUY','PNCNK')) or CTU.TRANGTHAI is null) AND CTU.BENHVIEN_ID='HLU01'          ) aa where aa.KHODUOC_ID IN(9)          Group by AA.SoLoNhap_ID,AA.KHODUOC_ID,AA.DUOC_ID,  AA.NGUONDUOC_ID,AA.BENHVIEN_ID          ) AS Y          ON (X.KHODUOC_ID =Y.KHODUOC_ID AND X.SOLONHAP_ID=Y.SOLONHAP_ID AND X.DUOC_ID=Y.DUOC_ID AND X.NGUONDUOC_ID=Y.NGUONDUOC_ID AND X.BENHVIEN_ID=Y.BENHVIEN_ID)          WHEN MATCHED THEN UPDATE SET X.SOLUONG=Y.SOLUONG          WHEN NOT MATCHED THEN          INSERT (KHODUOC_ID,DUOC_ID,SOLONHAP_ID,SOLUONG,NGUONDUOC_ID,BENHVIEN_ID,NGAYTAO,NGUOITAO_ID,NGAYCAPNHAT,NGUOICAPNHAT_ID) VALUES          (Y.KHODUOC_ID,Y.DUOC_ID,Y.SOLONHAP_ID,Y.SOLUONG,Y.NGUONDUOC_ID,Y.BENHVIEN_ID,GETDATE(),NULL,GETDATE(),NULL);            COMMIT TRANSACTION          END TRY          BEGIN CATCH          IF @@TRANCOUNT > 0          ROLLBACK TRANSACTION          END CATCH          END]
2019-12-23 15:57:57,065 [1] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoCOM18] PreparedStatement : [select  distinct TT_TONKHO.DUOC_KEY, LTRIM(TT_TONKHO.KHODUOC_ID) as KHODUOC_ID, TM_DUOC.DUOC_ID, TM_LOAIDUOC.MALOAIDUOC,TM_DUOC.SOVISA,TM_DUOC.TYLE_VAT,TM_DUOC.COTOA,        TM_DUOC.MADUOC, TM_DUOC.TENHANG, TM_DUOC.TENDUOCDAYDU, dvt.TENDONVITINH as DONVITINH, TM_DUOC.DONVITINH_ID, TM_DUOC.BHYT,        TM_DUOC.TENHOATCHAT, TM_DUOC.HAMLUONG, TM_DUOC.HANGSANXUAT, TM_DUOC.QUOCGIA, TM_DUOC.LOAIDUOC_ID, TM_DUOC.DUONGDUNG_ID,        TM_TENDUOC.TENDUOC, TM_TENDUOC.TENDUOC_EN, TM_TENDUOC.MAQUOCTE, TM_TENDUOC.MAQUOCTEBT,        TM_LOAIDUOC.LOAIVATTU_ID, TM_DUOC.BENHVIEN_ID,        TT_TONKHO.SOLUONG, TM_DUOC.VTYT_PHANLOAI, TM_DUOC.PHAMVI, TT_TONKHO.NGUONDUOC_ID, NG.TENNGUONDUOC        , TAMNGUNG = CASE WHEN TM_DUOC.TAMNGUNG = '1' OR NG.TAMNGUNG = '1' OR KD.TAMNGUNG = '1' THEN '1' ELSE '0' END        , TM_DUOC.DANGTRINHBAY        from TM_DUOC        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = TM_DUOC.DONVITINH_ID        left join TM_TENDUOC on TM_DUOC.TENDUOC_ID = TM_TENDUOC.TENDUOC_ID and TM_DUOC.BENHVIEN_ID = 'HLU01'  and TM_DUOC.TAMNGUNG = '0'        left join TM_LOAIDUOC on TM_LOAIDUOC.LOAIDUOC_ID = TM_DUOC.LOAIDUOC_ID and TM_LOAIDUOC.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG on (TM_LOAIDUOC.LOAIVATTU_ID = TM_DUOC_HANDUNG.LOAIDUOC and TM_DUOC_HANDUNG.BENHVIEN_ID = 'HLU01')        inner join        (select LTRIM(A.KHODUOC_ID) + '_' + LTRIM(A.DUOC_ID) + '_' + LTRIM(ISNULL(A.NGUONDUOC_ID,'')) as DUOC_KEY, A.KHODUOC_ID, A.DUOC_ID ,a.NGUONDUOC_ID,        SUM(isnull(A.SOLUONG,0)) as SOLUONG        from        (select SUM(SOLUONG) as SOLUONG, KHODUOC_ID, DUOC_ID, NGUONDUOC_ID from TT_DUOC_TONKHO        where KHODUOC_ID in (9) and DUOC_ID in (1346) group by KHODUOC_ID, DUOC_ID, NGUONDUOC_ID        ) A        where A.KHODUOC_ID in (9) and A.DUOC_ID in (1346)        group by LTRIM(A.KHODUOC_ID) + '_' + LTRIM(A.DUOC_ID) + '_' + LTRIM(A.NGUONDUOC_ID), A.KHODUOC_ID, A.DUOC_ID, A.NGUONDUOC_ID)        TT_TONKHO on TT_TONKHO.DUOC_ID = TM_DUOC.DUOC_ID        LEFT JOIN TM_NGUONHANG NG ON NG.NGUONDUOC_ID = TT_TONKHO.NGUONDUOC_ID        LEFT JOIN TM_KHODUOC KD ON KD.KHODUOC_ID = TT_TONKHO.KHODUOC_ID        where TM_DUOC.BENHVIEN_ID = 'HLU01' and TM_DUOC.DUOC_ID in (1346)]
2019-12-23 15:57:57,125 [1] DEBUG - Statement Id: [DAO00030_GetListPhamViByKhoDuoc] PreparedStatement : [SELECT DISTINCT PHAMVI_ID          FROM TM_DUOC_PHAMVISD_MAPPING          WHERE          KHODUOC_ID IN (9)          AND BENHVIEN_ID ='HLU01'          AND TAMNGUNG = '0']
2019-12-23 15:57:57,154 [1] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoVaBookingCOM23] PreparedStatement : [declare @NGUONDUOC_MACDINH varchar(5) = '0';        declare @TOAMUANGOAI int = 0;        select @NGUONDUOC_MACDINH = isnull(VALUE,0) from TM_SYS_APPSETTINGS where CODE = 'PHA_NGUONDUOC'        select @TOAMUANGOAI = isnull(VALUE,0) from TM_SYS_APPSETTINGS where CODE = 'OPD_TOAMUANGOAI_DUNGDANHMUC_DUOC'                if @TOAMUANGOAI = 1        begin        select  distinct '0' + '_' + LTRIM(d.DUOC_ID) + '_' + @NGUONDUOC_MACDINH as DUOC_KEY, 0 as PHAMVI_ID, @NGUONDUOC_MACDINH as NGUONDUOC_ID, null as TENNGUONDUOC, null as TINHTIEN, d.DUOC_ID, ld.MALOAIDUOC,        d.SOVISA,d.TYLE_VAT,d.COTOA, d.MADUOC, d.TENHANG, d.TENDUOCDAYDU, dvt.TENDONVITINH as DONVITINH, d.BHYT,        d.TENHOATCHAT, d.HAMLUONG, d.HANGSANXUAT, d.QUOCGIA, d.LOAIDUOC_ID, d.DUONGDUNG_ID, d.TINHTIEN_PTTT,        ten.TENDUOC, ten.TENDUOC_EN, ten.MAQUOCTE, ten.MAQUOCTEBT, d.CONGDUNG,        '' as BHYT_TEXT        , ld.LOAIVATTU_ID        , d.BENHVIEN_ID,        999999999 as SOLUONG, d.VTYT_PHANLOAI, d.PHAMVI, d.SUASOLUONGTONGHOP, d.MADUOCBV, d.DANGTRINHBAY        , TAMNGUNG = CASE WHEN d.TAMNGUNG = '1' THEN '1' ELSE '0' END        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        where d.DUOC_ID in (1346)        union all        select  distinct tk.DUOC_KEY, LTRIM(tk.PHAMVI_ID) as PHAMVI_ID, tk.NGUONDUOC_ID, nh.TENNGUONDUOC, nh.TINHTIEN, d.DUOC_ID, ld.MALOAIDUOC,        d.SOVISA,d.TYLE_VAT,d.COTOA, d.MADUOC, d.TENHANG, d.TENDUOCDAYDU, dvt.TENDONVITINH as DONVITINH, d.BHYT,        d.TENHOATCHAT, d.HAMLUONG, d.HANGSANXUAT, d.QUOCGIA, d.LOAIDUOC_ID, d.DUONGDUNG_ID, d.TINHTIEN_PTTT,        ten.TENDUOC, ten.TENDUOC_EN, ten.MAQUOCTE, ten.MAQUOCTEBT,d.CONGDUNG,        CASE WHEN d.BHYT = '1' THEN 'BHYT' ELSE '' END as BHYT_TEXT        , ld.LOAIVATTU_ID        , d.BENHVIEN_ID,        tk.SOLUONG, d.VTYT_PHANLOAI, d.PHAMVI, d.SUASOLUONGTONGHOP, d.MADUOCBV, d.DANGTRINHBAY        , TAMNGUNG = CASE WHEN d.TAMNGUNG = '1' OR nh.TAMNGUNG = '1' OR kd.TAMNGUNG = '1' THEN '1' ELSE '0' END        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        inner join        (        select  LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')) DUOC_KEY, (SUM(dtk.SOLUONG) - isnull(sum(A.SOLUONG),0) - isnull(sum(B.SOLUONG),0)) SOLUONG, pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        from (select sum(soluong) soluong,duoc_id,nguonduoc_id,khoduoc_id,benhvien_id from TT_DUOC_TONKHO  group by duoc_id,nguonduoc_id,khoduoc_id,benhvien_id) dtk        inner join TM_DUOC_PHAMVISD_MAPPING pvsd on dtk.KHODUOC_ID = pvsd.KHODUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NOITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) B on B.DUOC_ID = dtk.DUOC_ID and B.SOLUONG > 0 and B.PHAMVI_ID = pvsd.PHAMVI_ID and B.NGUONHANG_ID = dtk.NGUONDUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NGOAITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) A on A.DUOC_ID = dtk.DUOC_ID and A.SOLUONG > 0 and A.PHAMVI_ID = pvsd.PHAMVI_ID and A.NGUONHANG_ID = dtk.NGUONDUOC_ID        where dtk.SOLUONG > 0 and dtk.BENHVIEN_ID = 'HLU01'        group by LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')), pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        ) tk on tk.DUOC_ID = d.DUOC_ID        left join TM_DUOC_PHAMVISUDUNG kd on kd.PHAMVI_ID = tk.PHAMVI_ID and kd.BENHVIEN_ID = 'HLU01'        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = tk.NGUONDUOC_ID and nh.BENHVIEN_ID = 'HLU01'        where  d.BENHVIEN_ID = 'HLU01' and d.DUOC_ID in (1346) and TK.PHAMVI_ID in (1033)        and tk.NGUONDUOC_ID in (1)         end        else        begin                select  distinct tk.DUOC_KEY, LTRIM(tk.PHAMVI_ID) as PHAMVI_ID, tk.NGUONDUOC_ID, nh.TENNGUONDUOC, nh.TINHTIEN, d.DUOC_ID, ld.MALOAIDUOC,        d.SOVISA,d.TYLE_VAT,d.COTOA, d.MADUOC, d.TENHANG, d.TENDUOCDAYDU, dvt.TENDONVITINH as DONVITINH, d.BHYT,        d.TENHOATCHAT, d.HAMLUONG, d.HANGSANXUAT, d.QUOCGIA, d.LOAIDUOC_ID, d.DUONGDUNG_ID, d.TINHTIEN_PTTT,        ten.TENDUOC, ten.TENDUOC_EN, ten.MAQUOCTE, ten.MAQUOCTEBT,d.CONGDUNG,        CASE WHEN d.BHYT = '1' THEN 'BHYT' ELSE '' END as BHYT_TEXT        , ld.LOAIVATTU_ID        , d.BENHVIEN_ID,        tk.SOLUONG, d.VTYT_PHANLOAI, d.PHAMVI, d.SUASOLUONGTONGHOP, d.MADUOCBV, d.DANGTRINHBAY        , TAMNGUNG = CASE WHEN d.TAMNGUNG = '1' OR nh.TAMNGUNG = '1' OR kd.TAMNGUNG = '1' THEN '1' ELSE '0' END        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        inner join        (        select  LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')) DUOC_KEY, (SUM(dtk.SOLUONG) - isnull(sum(A.SOLUONG),0) - isnull(sum(B.SOLUONG),0)) SOLUONG, pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        from (select sum(soluong) soluong,duoc_id,nguonduoc_id,khoduoc_id,benhvien_id from TT_DUOC_TONKHO  group by duoc_id,nguonduoc_id,khoduoc_id,benhvien_id) dtk        inner join TM_DUOC_PHAMVISD_MAPPING pvsd on dtk.KHODUOC_ID = pvsd.KHODUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NOITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) B on B.DUOC_ID = dtk.DUOC_ID and B.SOLUONG > 0 and B.PHAMVI_ID = pvsd.PHAMVI_ID and B.NGUONHANG_ID = dtk.NGUONDUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NGOAITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) A on A.DUOC_ID = dtk.DUOC_ID and A.SOLUONG > 0 and A.PHAMVI_ID = pvsd.PHAMVI_ID and A.NGUONHANG_ID = dtk.NGUONDUOC_ID        where dtk.SOLUONG > 0 and dtk.BENHVIEN_ID = 'HLU01'        group by LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')), pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        ) tk on tk.DUOC_ID = d.DUOC_ID        left join TM_DUOC_PHAMVISUDUNG kd on kd.PHAMVI_ID = tk.PHAMVI_ID and kd.BENHVIEN_ID = 'HLU01'        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = tk.NGUONDUOC_ID and nh.BENHVIEN_ID = 'HLU01'        where  d.BENHVIEN_ID = 'HLU01' and d.DUOC_ID in (1346) and TK.PHAMVI_ID in (1033)        and tk.NGUONDUOC_ID in (1)         end]
2019-12-23 15:57:57,582 [1] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoCOM18UpdateRedis] PreparedStatement : [select distinct TT_TONKHO.DUOC_KEY, LTRIM(TT_TONKHO.KHODUOC_ID) as KHODUOC_ID, TM_DUOC.DUOC_ID, TM_LOAIDUOC.MALOAIDUOC,TM_DUOC.SOVISA,TM_DUOC.TYLE_VAT,TM_DUOC.COTOA,        TM_DUOC.MADUOC, TM_DUOC.TENHANG, TM_DUOC.TENDUOCDAYDU, dvt.TENDONVITINH as DONVITINH,  TM_DUOC.DONVITINH_ID,TM_DUOC.BHYT,        TM_DUOC.TENHOATCHAT,        TM_DUOC.HAMLUONG, TM_DUOC.HANGSANXUAT, TM_DUOC.QUOCGIA, TM_DUOC.LOAIDUOC_ID, TM_DUOC.DUONGDUNG_ID,        TM_TENDUOC.TENDUOC, TM_TENDUOC.TENDUOC_EN, TM_TENDUOC.MAQUOCTE, TM_TENDUOC.MAQUOCTEBT,        TM_LOAIDUOC.LOAIVATTU_ID, TM_DUOC.BENHVIEN_ID,        TT_TONKHO.SOLUONG, TM_DUOC.VTYT_PHANLOAI, TM_DUOC.PHAMVI, TT_TONKHO.NGUONDUOC_ID, NG.TENNGUONDUOC AS TENNGUONDUOC        , TAMNGUNG = CASE WHEN TM_DUOC.TAMNGUNG = '1' OR NG.TAMNGUNG = '1' OR KD.TAMNGUNG = '1' THEN '1' ELSE '0' END        , TM_DUOC.DANGTRINHBAY        from TM_DUOC        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = TM_DUOC.DONVITINH_ID        left join TM_TENDUOC on TM_DUOC.TENDUOC_ID = TM_TENDUOC.TENDUOC_ID and TM_DUOC.BENHVIEN_ID = 'HLU01' and TM_DUOC.TAMNGUNG = '0'        left join TM_LOAIDUOC on TM_LOAIDUOC.LOAIDUOC_ID = TM_DUOC.LOAIDUOC_ID and TM_LOAIDUOC.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG on (TM_LOAIDUOC.LOAIVATTU_ID = TM_DUOC_HANDUNG.LOAIDUOC and TM_DUOC_HANDUNG.BENHVIEN_ID = 'HLU01')        inner join        (select LTRIM(A.KHODUOC_ID) + '_' + LTRIM(A.DUOC_ID) + '_' + LTRIM(ISNULL(A.NGUONDUOC_ID,'')) as DUOC_KEY, A.KHODUOC_ID, A.DUOC_ID, A.NGUONDUOC_ID,        SUM(isnull(A.SOLUONG,0)) as SOLUONG        from        (select SUM(SOLUONG) as SOLUONG, KHODUOC_ID, DUOC_ID, NGUONDUOC_ID from TT_DUOC_TONKHO        where BENHVIEN_ID = 'HLU01' group by KHODUOC_ID, DUOC_ID, NGUONDUOC_ID) A        group by LTRIM(A.KHODUOC_ID) + '_' + LTRIM(A.DUOC_ID) + '_' + LTRIM(ISNULL(A.NGUONDUOC_ID,'')), A.KHODUOC_ID, A.DUOC_ID, NGUONDUOC_ID        ) TT_TONKHO on TT_TONKHO.DUOC_ID = TM_DUOC.DUOC_ID        LEFT JOIN TM_NGUONHANG NG ON NG.NGUONDUOC_ID = TT_TONKHO.NGUONDUOC_ID        LEFT JOIN TM_KHODUOC KD ON KD.KHODUOC_ID = TT_TONKHO.KHODUOC_ID        where TM_DUOC.BENHVIEN_ID = 'HLU01' and TT_TONKHO.SOLUONG >= 0        and TM_DUOC.DUOC_ID in (1346)]
2019-12-23 15:57:57,658 [1] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoVaBookingCOM23UpdateRedis] PreparedStatement : [declare @NGUONDUOC_MACDINH varchar(5) = '0';        declare @TOAMUANGOAI int = 0;        select @NGUONDUOC_MACDINH = isnull(VALUE,0) from TM_SYS_APPSETTINGS where CODE = 'PHA_NGUONDUOC'        select @TOAMUANGOAI = isnull(VALUE,0) from TM_SYS_APPSETTINGS where CODE = 'OPD_TOAMUANGOAI_DUNGDANHMUC_DUOC'                if @TOAMUANGOAI = 1        begin        select  distinct '0' + '_' + LTRIM(d.DUOC_ID) + '_' + @NGUONDUOC_MACDINH as DUOC_KEY, 0 as PHAMVI_ID, @NGUONDUOC_MACDINH as NGUONDUOC_ID, null as TENNGUONDUOC, null as TINHTIEN, d.DUOC_ID, ld.MALOAIDUOC,        d.SOVISA,d.TYLE_VAT,d.COTOA, d.MADUOC, d.TENHANG, d.TENDUOCDAYDU, dvt.TENDONVITINH as DONVITINH, d.BHYT,        d.TENHOATCHAT, d.HAMLUONG, d.HANGSANXUAT, d.QUOCGIA, d.LOAIDUOC_ID, d.DUONGDUNG_ID, d.TINHTIEN_PTTT,        ten.TENDUOC, ten.TENDUOC_EN, ten.MAQUOCTE, ten.MAQUOCTEBT,d.CONGDUNG,        '' as BHYT_TEXT        , ld.LOAIVATTU_ID        , d.BENHVIEN_ID,        999999999 as SOLUONG, d.VTYT_PHANLOAI, d.PHAMVI, d.SUASOLUONGTONGHOP, d.MADUOCBV, d.DANGTRINHBAY        , TAMNGUNG = CASE WHEN d.TAMNGUNG = '1' THEN '1' ELSE '0' END        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        where d.DUOC_ID in (1346)        union all        select  distinct tk.DUOC_KEY, LTRIM(tk.PHAMVI_ID) as PHAMVI_ID, tk.NGUONDUOC_ID, nh.TENNGUONDUOC, nh.TINHTIEN, d.DUOC_ID, ld.MALOAIDUOC,        d.SOVISA,d.TYLE_VAT,d.COTOA, d.MADUOC, d.TENHANG, d.TENDUOCDAYDU, dvt.TENDONVITINH as DONVITINH, d.BHYT,        d.TENHOATCHAT, d.HAMLUONG, d.HANGSANXUAT, d.QUOCGIA, d.LOAIDUOC_ID, d.DUONGDUNG_ID, d.TINHTIEN_PTTT,        ten.TENDUOC, ten.TENDUOC_EN, ten.MAQUOCTE, ten.MAQUOCTEBT,d.CONGDUNG,        CASE WHEN d.BHYT = '1' THEN 'BHYT' ELSE '' END as BHYT_TEXT        , ld.LOAIVATTU_ID        , d.BENHVIEN_ID,        tk.SOLUONG, d.VTYT_PHANLOAI, d.PHAMVI, d.SUASOLUONGTONGHOP, d.MADUOCBV, d.DANGTRINHBAY        , TAMNGUNG = CASE WHEN d.TAMNGUNG = '1' OR nh.TAMNGUNG = '1' OR kd.TAMNGUNG = '1' THEN '1' ELSE '0' END        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        inner join        (        select  LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')) DUOC_KEY, (SUM(dtk.SOLUONG) - isnull(sum(A.SOLUONG),0) - isnull(sum(B.SOLUONG),0)) SOLUONG, pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        from (select sum(soluong) soluong,duoc_id,nguonduoc_id,khoduoc_id,benhvien_id from TT_DUOC_TONKHO  group by duoc_id,nguonduoc_id,khoduoc_id,benhvien_id) dtk        inner join TM_DUOC_PHAMVISD_MAPPING pvsd on dtk.KHODUOC_ID = pvsd.KHODUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NOITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) B on B.DUOC_ID = dtk.DUOC_ID and B.SOLUONG > 0 and B.PHAMVI_ID = pvsd.PHAMVI_ID and B.NGUONHANG_ID = dtk.NGUONDUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NGOAITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) A on A.DUOC_ID = dtk.DUOC_ID and A.SOLUONG > 0 and A.PHAMVI_ID = pvsd.PHAMVI_ID and A.NGUONHANG_ID = dtk.NGUONDUOC_ID        where dtk.SOLUONG > 0 and dtk.BENHVIEN_ID = 'HLU01'        group by LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')), pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        ) tk on tk.DUOC_ID = d.DUOC_ID        left join TM_DUOC_PHAMVISUDUNG kd on kd.PHAMVI_ID = tk.PHAMVI_ID and kd.BENHVIEN_ID = 'HLU01'        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = tk.NGUONDUOC_ID and nh.BENHVIEN_ID = 'HLU01'        where  d.BENHVIEN_ID = 'HLU01' and d.DUOC_ID in (1346)        end        else        begin        select  distinct tk.DUOC_KEY, LTRIM(tk.PHAMVI_ID) as PHAMVI_ID, tk.NGUONDUOC_ID, nh.TENNGUONDUOC, nh.TINHTIEN, d.DUOC_ID, ld.MALOAIDUOC,        d.SOVISA,d.TYLE_VAT,d.COTOA, d.MADUOC, d.TENHANG, d.TENDUOCDAYDU, dvt.TENDONVITINH as DONVITINH, d.BHYT,        d.TENHOATCHAT, d.HAMLUONG, d.HANGSANXUAT, d.QUOCGIA, d.LOAIDUOC_ID, d.DUONGDUNG_ID, d.TINHTIEN_PTTT,        ten.TENDUOC, ten.TENDUOC_EN, ten.MAQUOCTE, ten.MAQUOCTEBT,d.CONGDUNG,        CASE WHEN d.BHYT = '1' THEN 'BHYT' ELSE '' END as BHYT_TEXT        , ld.LOAIVATTU_ID        , d.BENHVIEN_ID,        tk.SOLUONG, d.VTYT_PHANLOAI, d.PHAMVI, d.SUASOLUONGTONGHOP, d.MADUOCBV, d.DANGTRINHBAY        , TAMNGUNG = CASE WHEN d.TAMNGUNG = '1' OR nh.TAMNGUNG = '1' OR kd.TAMNGUNG = '1' THEN '1' ELSE '0' END        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        inner join        (        select  LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')) DUOC_KEY, (SUM(dtk.SOLUONG) - isnull(sum(A.SOLUONG),0) - isnull(sum(B.SOLUONG),0)) SOLUONG, pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        from (select sum(soluong) soluong,duoc_id,nguonduoc_id,khoduoc_id,benhvien_id from TT_DUOC_TONKHO  group by duoc_id,nguonduoc_id,khoduoc_id,benhvien_id) dtk        inner join TM_DUOC_PHAMVISD_MAPPING pvsd on dtk.KHODUOC_ID = pvsd.KHODUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NOITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) B on B.DUOC_ID = dtk.DUOC_ID and B.SOLUONG > 0 and B.PHAMVI_ID = pvsd.PHAMVI_ID and B.NGUONHANG_ID = dtk.NGUONDUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NGOAITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) A on A.DUOC_ID = dtk.DUOC_ID and A.SOLUONG > 0 and A.PHAMVI_ID = pvsd.PHAMVI_ID and A.NGUONHANG_ID = dtk.NGUONDUOC_ID        where dtk.SOLUONG > 0 and dtk.BENHVIEN_ID = 'HLU01'        group by LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')), pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        ) tk on tk.DUOC_ID = d.DUOC_ID        left join TM_DUOC_PHAMVISUDUNG kd on kd.PHAMVI_ID = tk.PHAMVI_ID and kd.BENHVIEN_ID = 'HLU01'        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = tk.NGUONDUOC_ID and nh.BENHVIEN_ID = 'HLU01'        where  d.BENHVIEN_ID = 'HLU01' and d.DUOC_ID in (1346)        end]
2019-12-23 15:57:57,770 [1] DEBUG - Statement Id: [DAOLOG01_LockEnd] PreparedStatement : [DELETE TT_LOG_UPDATE        where REF_TABLE = 'TT_DUOC_CHUNGTU' and REF_ID = '138711' and BENHVIEN_ID = 'HLU01']
2019-12-23 15:57:57,868 [1] DEBUG - Statement Id: [DAO00030_GetList] PreparedStatement : [select *              from TT_DUOC_CHUNGTU              where BENHVIEN_ID = 'HLU01'                and                   TT_DUOC_CHUNGTU.CHUNGTU_ID = '138711'                               order by CHUNGTU_ID]
2019-12-23 15:57:57,978 [1] DEBUG - Statement Id: [DAO00030_CHUNGTUXUAT_CHITIET_GetList] PreparedStatement : [SELECT            ctct.*,            d.MADUOC, d.TENHANG, d.TENDUOCDAYDU, dvt.TENDONVITINH as DONVITINH,n.TENNGUONDUOC as NGUONHANG,            sln.SOLONHAP, sln.SOLOSANPHAM, sln.NGAYNHAP as NGAYNHAPLO, sln.HANDUNG as HANSUDUNG,            isnull(tk.SOLUONG,0) as SOLUONGTON,            LTRIM(ct.KHOXUAT_ID) + '_' + LTRIM(sln.DUOC_ID) + '_' + LTRIM(sln.NGUONDUOC_ID) as DUOC_KEY            , NLD.MANHOMLOAIDUOC, ld.MALOAIDUOC, D.SO_QDTT            FROM            TT_DUOC_CHUNGTU_CHITIET ctct            INNER JOIN TT_DUOC_CHUNGTU ct ON (ct.CHUNGTU_ID = ctct.CHUNGTU_ID)            INNER JOIN TT_DUOC_CHUNGTU_SOLONHAP sln ON (sln.SOLONHAP_ID = ctct.SOLONHAP_ID)            LEFT JOIN (            select xx.DUOCTONKHO_ID, xx.KHODUOC_ID, xx.DUOC_ID, xx.SOLONHAP_ID, xx.SOLUONG, xx.NGUONDUOC_ID, xx.BENHVIEN_ID from TT_DUOC_TONKHO xx            join ( select max(DUOCTONKHO_ID) as DUOCTONKHO_ID, KHODUOC_ID, DUOC_ID, SOLONHAP_ID, NGUONDUOC_ID            from TT_DUOC_TONKHO group by KHODUOC_ID, DUOC_ID, SOLONHAP_ID, NGUONDUOC_ID) yy on xx.DUOCTONKHO_ID=yy.DUOCTONKHO_ID            ) tk ON (tk.SOLONHAP_ID = sln.SOLONHAP_ID AND tk.DUOC_ID = sln.DUOC_ID and tk.KHODUOC_ID = ct.KHOXUAT_ID)            INNER JOIN TM_DUOC d ON (d.DUOC_ID = ctct.DUOC_ID)            INNER JOIN TM_NGUONHANG n ON (n.NGUONDUOC_ID = ctct.NGUONHANG_ID)            LEFT JOIN TM_DONVITINH dvt ON (dvt.DONVITINH_ID = ctct.DONVITINH_ID)            left join TM_LOAIDUOC LD on LD.LOAIDUOC_ID = D.LOAIDUOC_ID            LEFT JOIN TM_NHOMLOAIDUOC NLD on NLD.NHOMLOAIDUOC_ID = LD.NHOMLOAIDUOC_ID             where                             ct.CHUNGTU_ID = '138711'                       and                           ct.BENHVIEN_ID = 'HLU01'                                     order by CHUNGTUCHITIET_ID]
2019-12-23 15:57:58,216 [1] DEBUG - Statement Id: [DAO00030_KiemTraChungTuKhoaSo] PreparedStatement : [SELECT CHUNGTU_ID              FROM TT_DUOC_CHUNGTU              WHERE              MACHUNGTU = 'KHO_NTX081912000002'              and BENHVIEN_ID = 'HLU01'              and              convert(date, NGAYCHUNGTU) <=              (              SELECT TOP 1 convert(date, KHOADENNGAY)              FROM TT_DUOC_KHOASOCHUNGTU              WHERE              KHODUOC_ID = '9'              and BENHVIEN_ID = 'HLU01'              AND KHOASO = '1'              ORDER BY KHOADENNGAY DESC              )]
2019-12-23 15:57:58,265 [1] DEBUG - Statement Id: [DAO00030_KiemTraChungTuDaChuyenKeToan] PreparedStatement : [SELECT CHUNGTU_ID            FROM TT_DUOC_CHUNGTU            WHERE            CHUNGTU_ID = '138711'            and IDCHUYEN IS NOT NULL            and BENHVIEN_ID = 'HLU01']
2019-12-23 15:57:58,298 [1] DEBUG - Statement Id: [DAO00030_KiemTraBenhNhanXuatVien] PreparedStatement : [select              TT.TOATHUOC_ID              from              TT_NOITRU_TOATHUOC TT              inner join TT_NOITRU_KHAMBENH KB on TT.KHAMBENH_ID = KB.KHAMBENH_ID              inner join TT_NOITRU_BENHAN BA on BA.BENHAN_ID = KB.BENHAN_ID              WHERE              BA.TRANGTHAI = 'DAXUATVIEN'              AND TT.CHUNGTU_ID =138711                             union all              select                          VTYT.PHAUTHUAT_VTYT_ID as TOATHUOC_ID                          from                          TT_PHAUTHUAT_VTYT VTYT                          inner join TT_PHAUTHUAT PT on VTYT.PHAUTHUAT_ID = PT.PHAUTHUAT_ID                          inner join TT_NOITRU_BENHAN BA on BA.BENHAN_ID =PT.BENHAN_ID                          WHERE                          BA.TRANGTHAI = 'DAXUATVIEN'                          AND vtyt.CHUNGTU_ID =138711               union all                            select                          VTYT.CLSKETQUA_VTYT_ID as TOATHUOC_ID                          from                          TT_CLSKETQUA_VTYT VTYT                          inner join TT_VIENPHI VP on vtyt.CLSKETQUA_VTYT_ID=VP.REF_ID and vp.REF_TABLE='TT_CLSKETQUA_VTYT'                          inner join TT_NOITRU_BENHAN BA on BA.BENHAN_ID =vp.BENHAN_ID                          WHERE                          BA.TRANGTHAI = 'DAXUATVIEN'                          AND vtyt.CHUNGTU_ID =138711              union all                            select                          VTYT.KHAMBENH_VTYT_ID as TOATHUOC_ID                          from                          TT_NGOAITRU_KHAMBENH_VTYT VTYT                          inner join TT_VIENPHI VP on vtyt.KHAMBENH_VTYT_ID=VP.REF_ID and vp.REF_TABLE='TT_NGOAITRU_KHAMBENH_VTYT'                          inner join TT_NOITRU_BENHAN BA on BA.BENHAN_ID =vp.BENHAN_ID                          WHERE                          BA.TRANGTHAI = 'DAXUATVIEN'                          AND vtyt.CHUNGTU_ID =  138711]
2019-12-23 15:57:58,623 [1] DEBUG - Statement Id: [DAO00030_GetPhamViByKhoDuoc] PreparedStatement : [SELECT DISTINCT pv.PHAMVI_ID          FROM TM_DUOC_PHAMVISD_MAPPING mp          INNER JOIN TM_DUOC_PHAMVISUDUNG pv ON mp.PHAMVI_ID = pv.PHAMVI_ID          WHERE          mp.KHODUOC_ID IN (9)          AND mp.BENHVIEN_ID ='HLU01'          AND mp.TAMNGUNG = '0'          AND pv.TAMNGUNG = '0']
2019-12-23 15:57:58,649 [1] DEBUG - Statement Id: [DAO00030_DUOCTONKHO_GetSoTonTheoDuoc] PreparedStatement : [SELECT              DUOC_ID,              SUM(SOLUONG) AS TONGTON              FROM              TT_DUOC_TONKHO              WHERE              KHODUOC_ID = '9'              and BENHVIEN_ID = 'HLU01'              and DUOC_ID IN (1346)              GROUP BY DUOC_ID]
2019-12-23 15:57:58,676 [1] DEBUG - Statement Id: [DAO00030_DUOCTONKHO_GetSoTonTheoDuocTheoLo] PreparedStatement : [SELECT              DUOC_ID,SOLONHAP_ID,              SUM(SOLUONG) AS SOLUONGTONLO              FROM              TT_DUOC_TONKHO              WHERE              KHODUOC_ID = '9'              and BENHVIEN_ID = 'HLU01'              and DUOC_ID IN (1346)              and SOLONHAP_ID IN (4902)              GROUP BY DUOC_ID, SOLONHAP_ID]
2019-12-23 15:57:58,703 [1] DEBUG - Statement Id: [DAO00030_GetPhamViByKhoDuoc] PreparedStatement : [SELECT DISTINCT pv.PHAMVI_ID          FROM TM_DUOC_PHAMVISD_MAPPING mp          INNER JOIN TM_DUOC_PHAMVISUDUNG pv ON mp.PHAMVI_ID = pv.PHAMVI_ID          WHERE          mp.KHODUOC_ID IN (9)          AND mp.BENHVIEN_ID ='HLU01'          AND mp.TAMNGUNG = '0'          AND pv.TAMNGUNG = '0']
2019-12-23 15:57:58,730 [1] DEBUG - Statement Id: [DAO00030_DUOCTONKHO_GetSoTonTheoDuoc] PreparedStatement : [SELECT              DUOC_ID,              SUM(SOLUONG) AS TONGTON              FROM              TT_DUOC_TONKHO              WHERE              KHODUOC_ID = '9'              and BENHVIEN_ID = 'HLU01'              and DUOC_ID IN (1346)              GROUP BY DUOC_ID]
2019-12-23 15:57:58,759 [1] DEBUG - Statement Id: [DAO00030_KTDaPhatSinhBienLai] PreparedStatement : [SELECT CHUNGTU_ID            FROM TT_NOITRU_TOATHUOC tt            INNER JOIN TT_VIENPHI vp on (tt.TOATHUOC_ID = vp.REF_ID and REF_TABLE = 'TT_NOITRU_TOATHUOC')            WHERE            CHUNGTU_ID = '138711'            AND tt.BENHVIEN_ID = 'HLU01'            AND HOADON_ID is not NULL            AND vp.HUY = '0'              union all            SELECT  kbtt.CHUNGTUPHATTHUOC_ID as CHUNGTU_ID            FROM TT_NGOAITRU_TOATHUOC tt            INNER JOIN TT_NGOAITRU_KHAMBENH_TOATHUOC kbtt on (kbtt.KHAMBENH_TOATHUOC_ID = tt.KHAMBENH_TOATHUOC_ID)            INNER JOIN TT_VIENPHI vp on (tt.TOATHUOC_ID = vp.REF_ID and REF_TABLE = 'TT_NGOAITRU_TOATHUOC')            WHERE            kbtt.CHUNGTUPHATTHUOC_ID = '138711'            AND tt.BENHVIEN_ID = 'HLU01'            AND HOADON_ID is not NULL            AND vp.HUY = '0'              union all            SELECT ctct.CHUNGTU_ID from            TT_DUOC_CHUNGTU_CHITIET ctct            INNER JOIN TT_HOADON_CHITIET_NGOAITRU hdct on (hdct.REF_ID = ctct.CHUNGTUCHITIET_ID and hdct.REF_TABLE = 'TT_DUOC_CHUNGTU_CHITIET')            INNER JOIN TT_HOADON hd on hd.HOADON_ID = hdct.HOADON_ID            WHERE            ctct.CHUNGTU_ID = '138711'                            AND hd.HUYHOADON = '0'              AND hd.HOANTRA = '0'                                  AND ctct.BENHVIEN_ID = 'HLU01'                        union all            SELECT CHUNGTU_ID            FROM TT_NGOAITRU_KHAMBENH_VTYT tt            INNER JOIN TT_VIENPHI vp on (tt.KHAMBENH_VTYT_ID = vp.REF_ID and REF_TABLE = 'TT_NGOAITRU_KHAMBENH_VTYT')            WHERE            CHUNGTU_ID = '138711'            AND tt.BENHVIEN_ID = 'HLU01'            AND HOADON_ID is not NULL            AND vp.HUY = '0'                        union all            SELECT CHUNGTU_ID            FROM TT_PHAUTHUAT_VTYT tt            INNER JOIN TT_VIENPHI vp on (tt.PHAUTHUAT_VTYT_ID = vp.REF_ID and REF_TABLE = 'TT_PHAUTHUAT_VTYT')            WHERE            CHUNGTU_ID = '138711'            AND tt.BENHVIEN_ID = 'HLU01'            AND HOADON_ID is not NULL            AND vp.HUY = '0'                        union all            SELECT CHUNGTU_ID            FROM TT_CLSKETQUA_VTYT tt            INNER JOIN TT_VIENPHI vp on (tt.CLSKETQUA_VTYT_ID = vp.REF_ID and REF_TABLE = 'TT_CLSKETQUA_VTYT')            WHERE            CHUNGTU_ID = '138711'            AND tt.BENHVIEN_ID = 'HLU01'            AND HOADON_ID is not NULL            AND vp.HUY = '0']
2019-12-23 15:57:59,697 [1] DEBUG - Statement Id: [DAO00030_KTDaPhatSinhPhieuBHTN] PreparedStatement : [SELECT vp.VIENPHI_ID              FROM TT_VIENPHI vp              INNER JOIN TT_MIENGIAM_CHITIET  mgct on mgct.VIENPHI_ID = vp.VIENPHI_ID              INNER JOIN TT_DUOC_CHUNGTU ct on ct.TIEPNHAN_ID = vp.TIEPNHAN_ID              WHERE              ct.CHUNGTU_ID = '138711'              AND vp.DUOC_ID is not null              AND vp.BENHVIEN_ID = 'HLU01']
2019-12-23 15:57:59,804 [1] DEBUG - Statement Id: [DAO00116_File_GetList] PreparedStatement : [select *              from TT_FILE_DINHKEM               where                             TT_FILE_DINHKEM.REF_TABLE = 'TT_DUOC_CHUNGTU'                       and                           TT_FILE_DINHKEM.REF_ID = '138711'                       and                           TT_FILE_DINHKEM.BENHVIEN_ID = 'HLU01'                                     order by FILE_ID]
2019-12-23 15:57:59,907 [1] DEBUG - Statement Id: [DAO00030_KTDaPhatSinhBienLai] PreparedStatement : [SELECT CHUNGTU_ID            FROM TT_NOITRU_TOATHUOC tt            INNER JOIN TT_VIENPHI vp on (tt.TOATHUOC_ID = vp.REF_ID and REF_TABLE = 'TT_NOITRU_TOATHUOC')            WHERE            CHUNGTU_ID = '138711'            AND tt.BENHVIEN_ID = 'HLU01'            AND HOADON_ID is not NULL            AND vp.HUY = '0'              union all            SELECT  kbtt.CHUNGTUPHATTHUOC_ID as CHUNGTU_ID            FROM TT_NGOAITRU_TOATHUOC tt            INNER JOIN TT_NGOAITRU_KHAMBENH_TOATHUOC kbtt on (kbtt.KHAMBENH_TOATHUOC_ID = tt.KHAMBENH_TOATHUOC_ID)            INNER JOIN TT_VIENPHI vp on (tt.TOATHUOC_ID = vp.REF_ID and REF_TABLE = 'TT_NGOAITRU_TOATHUOC')            WHERE            kbtt.CHUNGTUPHATTHUOC_ID = '138711'            AND tt.BENHVIEN_ID = 'HLU01'            AND HOADON_ID is not NULL            AND vp.HUY = '0'              union all            SELECT ctct.CHUNGTU_ID from            TT_DUOC_CHUNGTU_CHITIET ctct            INNER JOIN TT_HOADON_CHITIET_NGOAITRU hdct on (hdct.REF_ID = ctct.CHUNGTUCHITIET_ID and hdct.REF_TABLE = 'TT_DUOC_CHUNGTU_CHITIET')            INNER JOIN TT_HOADON hd on hd.HOADON_ID = hdct.HOADON_ID            WHERE            ctct.CHUNGTU_ID = '138711'                            AND hd.HUYHOADON = '0'              AND hd.HOANTRA = '0'                                  AND ctct.BENHVIEN_ID = 'HLU01'                        union all            SELECT CHUNGTU_ID            FROM TT_NGOAITRU_KHAMBENH_VTYT tt            INNER JOIN TT_VIENPHI vp on (tt.KHAMBENH_VTYT_ID = vp.REF_ID and REF_TABLE = 'TT_NGOAITRU_KHAMBENH_VTYT')            WHERE            CHUNGTU_ID = '138711'            AND tt.BENHVIEN_ID = 'HLU01'            AND HOADON_ID is not NULL            AND vp.HUY = '0'                        union all            SELECT CHUNGTU_ID            FROM TT_PHAUTHUAT_VTYT tt            INNER JOIN TT_VIENPHI vp on (tt.PHAUTHUAT_VTYT_ID = vp.REF_ID and REF_TABLE = 'TT_PHAUTHUAT_VTYT')            WHERE            CHUNGTU_ID = '138711'            AND tt.BENHVIEN_ID = 'HLU01'            AND HOADON_ID is not NULL            AND vp.HUY = '0'                        union all            SELECT CHUNGTU_ID            FROM TT_CLSKETQUA_VTYT tt            INNER JOIN TT_VIENPHI vp on (tt.CLSKETQUA_VTYT_ID = vp.REF_ID and REF_TABLE = 'TT_CLSKETQUA_VTYT')            WHERE            CHUNGTU_ID = '138711'            AND tt.BENHVIEN_ID = 'HLU01'            AND HOADON_ID is not NULL            AND vp.HUY = '0']
2019-12-23 15:58:09,270 [1] DEBUG - Statement Id: [DAO00116_File_Delete] PreparedStatement : [delete from TT_FILE_DINHKEM               where                             REF_TABLE = 'TT_NGOAITRU_KHAMBENH_TOATHUOC'                       and                           REF_ID = '0']
2019-12-23 15:58:09,542 [1] DEBUG - Statement Id: [DAO00030_GetMucDichChungTuID] PreparedStatement : [SELECT DICTIONARY_ID              FROM              LST_DICTIONARY              WHERE              DICTIONARY_TYPE_CODE = 'MucDichChungTu'              and DICTIONARY_CODE = 'X08']
2019-12-23 15:58:12,314 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'COM98'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2019-12-23 15:58:12,853 [1] DEBUG - Statement Id: [DAO00030_SearchToaMuaNgoai] PreparedStatement : [select DISTINCT CT.CHUNGTU_ID, MACHUNGTU, CT.NGAYCHUNGTU, CT.NGUOIGIAO_ID, CT.KHOXUAT_ID, CT.BENHNHAN_ID, CT.LOAITOATHUOC,            '' AS MAYTE2, NM.TENNGUOIMUA TENBENHNHAN2, NM.SODIENTHOAI SODIENTHOAI2,            BN.MAYTE, BN.TENBENHNHAN, BN.SODIENTHOAI,CT.GIATRI AS TONGTIEN            FROM TT_DUOC_CHUNGTU CT            inner join TT_DUOC_CHUNGTU_CHITIET CTCT on CTCT.CHUNGTU_ID = CT.CHUNGTU_ID            left join TT_NGOAITRU_TOATHUOC_NGUOIMUA NM on NM.NGOAITRU_TOATHUOC_NGUOIMUA_ID = CT.NGOAITRU_TOATHUOC_NGUOIMUA_ID            left join TT_BENHNHAN BN on BN.BENHNHAN_ID = CT.BENHNHAN_ID            WHERE            CT.MUCDICHCHUNGTU_ID= '827'            and CT.BENHVIEN_ID = 'HLU01'            AND CT.KHOXUAT_ID = '9'            AND CONVERT(date, CT.NGAYCHUNGTU) BETWEEN CONVERT(date, '12/23/2019 12:00:00 AM') and CONVERT(date, '12/23/2019 12:00:00 AM')                           order by CHUNGTU_ID DESC]
