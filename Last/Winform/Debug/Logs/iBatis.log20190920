--------------------------------------------------------------------------------
2019-09-20 10:04:19,415 [1] DEBUG - Statement Id: [DAO00001_DBList] PreparedStatement : [select *              from TM_SYS_SERVER              where HOSPITAL_ID = '_SYSTEM_' and TYPE = 'D']
2019-09-20 10:04:19,803 [1] DEBUG - Statement Id: [DAO00001_DaoList] PreparedStatement : [select              TM_SYS_SERVICEMAP.ID,              TM_SYS_SERVICEMAP.HOSPITAL_ID,              TM_SYS_SERVICEMAP.DB_NAME,              TM_SYS_SERVICEMAP.TYPE,              TM_SYS_SERVICEMAP.NAME,              TM_SYS_SERVICEMAP.CLASS,              (TM_SYS_DIC.VALUE + '.' + TM_SYS_SERVICEMAP.CLASS) as CLASSFULL,              TM_SYS_SERVICEMAP.ASSEMBLY              from TM_SYS_SERVICEMAP              inner join TM_SYS_DIC              on TM_SYS_SERVICEMAP.NAMESPACE = TM_SYS_DIC.ID              where HOSPITAL_ID = '_SYSTEM_' AND TYPE = 'D' AND ACTIVE = '1'              order by DB_NAME]
2019-09-20 10:04:19,871 [1] DEBUG - Statement Id: [DAO00001_ServiceList] PreparedStatement : [select              TM_SYS_SERVICEMAP.ID,              TM_SYS_SERVICEMAP.HOSPITAL_ID,              TM_SYS_SERVICEMAP.DB_NAME,              TM_SYS_SERVICEMAP.TYPE,              TM_SYS_SERVICEMAP.NAME,              TM_SYS_SERVICEMAP.CLASS,              (TM_SYS_DIC.VALUE + '.' + TM_SYS_SERVICEMAP.CLASS) as CLASSFULL,              TM_SYS_SERVICEMAP.ASSEMBLY,              TM_SYS_SERVER.URL              from TM_SYS_SERVICEMAP              inner join TM_SYS_DIC on TM_SYS_SERVICEMAP.NAMESPACE = TM_SYS_DIC.ID              inner join TM_SYS_SERVER on (TM_SYS_SERVICEMAP.DB_NAME = TM_SYS_SERVER.NAME) and (TM_SYS_SERVER.HOSPITAL_ID = '_SYSTEM_')              where TM_SYS_SERVICEMAP.HOSPITAL_ID = '_SYSTEM_' AND TM_SYS_SERVICEMAP.TYPE = 'S'  AND ACTIVE = '1'              order by URL]
2019-09-20 10:04:20,721 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = '_SYSTEM_'               AND                   TM_SYS_SCREEN.PAGE = 'LOGIN'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2019-09-20 10:04:21,106 [1] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = '_SYSTEM_'               AND                   TM_SYS_CACHE.ACTIVE = '1']
2019-09-20 10:04:30,104 [1] DEBUG - Statement Id: [DAO00001_DBList] PreparedStatement : [select *              from TM_SYS_SERVER              where HOSPITAL_ID = 'HLU01' and TYPE = 'D']
2019-09-20 10:04:30,817 [1] DEBUG - Statement Id: [DAO00001_DaoList] PreparedStatement : [select              TM_SYS_SERVICEMAP.ID,              TM_SYS_SERVICEMAP.HOSPITAL_ID,              TM_SYS_SERVICEMAP.DB_NAME,              TM_SYS_SERVICEMAP.TYPE,              TM_SYS_SERVICEMAP.NAME,              TM_SYS_SERVICEMAP.CLASS,              (TM_SYS_DIC.VALUE + '.' + TM_SYS_SERVICEMAP.CLASS) as CLASSFULL,              TM_SYS_SERVICEMAP.ASSEMBLY              from TM_SYS_SERVICEMAP              inner join TM_SYS_DIC              on TM_SYS_SERVICEMAP.NAMESPACE = TM_SYS_DIC.ID              where HOSPITAL_ID = 'HLU01' AND TYPE = 'D' AND ACTIVE = '1'              order by DB_NAME]
2019-09-20 10:04:34,285 [1] DEBUG - Statement Id: [DAO00001_ServiceList] PreparedStatement : [select              TM_SYS_SERVICEMAP.ID,              TM_SYS_SERVICEMAP.HOSPITAL_ID,              TM_SYS_SERVICEMAP.DB_NAME,              TM_SYS_SERVICEMAP.TYPE,              TM_SYS_SERVICEMAP.NAME,              TM_SYS_SERVICEMAP.CLASS,              (TM_SYS_DIC.VALUE + '.' + TM_SYS_SERVICEMAP.CLASS) as CLASSFULL,              TM_SYS_SERVICEMAP.ASSEMBLY,              TM_SYS_SERVER.URL              from TM_SYS_SERVICEMAP              inner join TM_SYS_DIC on TM_SYS_SERVICEMAP.NAMESPACE = TM_SYS_DIC.ID              inner join TM_SYS_SERVER on (TM_SYS_SERVICEMAP.DB_NAME = TM_SYS_SERVER.NAME) and (TM_SYS_SERVER.HOSPITAL_ID = 'HLU01')              where TM_SYS_SERVICEMAP.HOSPITAL_ID = 'HLU01' AND TM_SYS_SERVICEMAP.TYPE = 'S'  AND ACTIVE = '1'              order by URL]
2019-09-20 10:04:35,018 [6] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1']
2019-09-20 10:04:37,630 [6] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM005']
2019-09-20 10:04:37,957 [6] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM015']
2019-09-20 10:04:38,046 [6] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM067']
2019-09-20 10:04:38,129 [6] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM008']
2019-09-20 10:04:38,226 [6] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM068']
2019-09-20 10:04:38,330 [6] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM006']
2019-09-20 10:04:38,407 [6] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM030']
2019-09-20 10:04:38,514 [6] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM025']
2019-09-20 10:04:38,606 [6] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM024']
2019-09-20 10:04:39,468 [6] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM033']
2019-09-20 10:04:39,521 [6] DEBUG - Statement Id: [DAO00027_GetListDuocKyGuiTonKho] PreparedStatement : [select  distinct TT_TONKHO.DUOC_KEY, LTRIM(TT_TONKHO.KHODUOC_ID) as KHODUOC_ID, TM_DUOC.DUOC_ID, TM_LOAIDUOC.MALOAIDUOC,TM_DUOC.SOVISA,TM_DUOC.TYLE_VAT,TM_DUOC.COTOA,        TM_DUOC.MADUOC, TM_DUOC.TENHANG, TM_DUOC.TENDUOCDAYDU, dvt.TENDONVITINH as DONVITINH,  TM_DUOC.DONVITINH_ID,TM_DUOC.BHYT,TM_DUOC.PHAMVI,        TM_DUOC.TENHOATCHAT, TM_DUOC.HAMLUONG, TM_DUOC.HANGSANXUAT, TM_DUOC.QUOCGIA, TM_DUOC.LOAIDUOC_ID, TM_DUOC.DUONGDUNG_ID,        TM_TENDUOC.TENDUOC, TM_TENDUOC.TENDUOC_EN, TM_TENDUOC.MAQUOCTE, TM_TENDUOC.MAQUOCTEBT,        TM_LOAIDUOC.LOAIVATTU_ID, TM_DUOC.BENHVIEN_ID,TT_TONKHO.SOLUONG, TT_TONKHO.NGUONDUOC_ID, NH.TENNGUONDUOC        , TAMNGUNG = CASE WHEN TM_DUOC.TAMNGUNG = '1' OR nh.TAMNGUNG = '1' OR KD.TAMNGUNG = '1' THEN '1' ELSE '0' END        , TM_DUOC.DANGTRINHBAY        from TM_DUOC        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = TM_DUOC.DONVITINH_ID        left join TM_TENDUOC on TM_DUOC.TENDUOC_ID = TM_TENDUOC.TENDUOC_ID and TM_DUOC.BENHVIEN_ID = 'HLU01' and TM_DUOC.TAMNGUNG = '0'        left join TM_LOAIDUOC on TM_LOAIDUOC.LOAIDUOC_ID = TM_DUOC.LOAIDUOC_ID and TM_LOAIDUOC.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG on (TM_LOAIDUOC.LOAIVATTU_ID = TM_DUOC_HANDUNG.LOAIDUOC and TM_DUOC_HANDUNG.BENHVIEN_ID = 'HLU01')        inner join        (select LTRIM(A.KHODUOC_ID) + '_' + LTRIM(A.DUOC_ID) + '_' + LTRIM(ISNULL(A.NGUONDUOC_ID,'')) as DUOC_KEY, A.KHODUOC_ID, A.DUOC_ID,A.NGUONDUOC_ID,        SUM(isnull(A.SOLUONG,0)) as SOLUONG        from        (select SUM(SOLUONG) as SOLUONG, KHODUOC_ID, DUOC_ID, NGUONDUOC_ID from TT_DUOC_KYGUI_TONKHO        where BENHVIEN_ID = 'HLU01' group by KHODUOC_ID, DUOC_ID, NGUONDUOC_ID) A        group by LTRIM(A.KHODUOC_ID) + '_' + LTRIM(A.DUOC_ID) + '_' + LTRIM(A.NGUONDUOC_ID), A.KHODUOC_ID, A.DUOC_ID, A.NGUONDUOC_ID)        TT_TONKHO on TT_TONKHO.DUOC_ID = TM_DUOC.DUOC_ID        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = TT_TONKHO.NGUONDUOC_ID and nh.BENHVIEN_ID = 'HLU01'        LEFT JOIN TM_KHODUOC KD ON KD.KHODUOC_ID = TT_TONKHO.KHODUOC_ID        where TM_DUOC.BENHVIEN_ID = 'HLU01' AND TT_TONKHO.SOLUONG >= 0]
2019-09-20 10:04:39,645 [6] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM018']
2019-09-20 10:04:39,731 [6] DEBUG - Statement Id: [DAO00027_GetListDuocTonKho] PreparedStatement : [select distinct TT_TONKHO.DUOC_KEY, LTRIM(TT_TONKHO.KHODUOC_ID) as KHODUOC_ID, TM_DUOC.DUOC_ID, TM_LOAIDUOC.MALOAIDUOC,TM_DUOC.SOVISA,TM_DUOC.TYLE_VAT,TM_DUOC.COTOA,        TM_DUOC.MADUOC, TM_DUOC.TENHANG, TM_DUOC.TENDUOCDAYDU, dvt.TENDONVITINH as DONVITINH,  TM_DUOC.DONVITINH_ID,TM_DUOC.BHYT,                TM_DUOC.TENHOATCHAT,          TM_DUOC.HAMLUONG, TM_DUOC.HANGSANXUAT, TM_DUOC.QUOCGIA, TM_DUOC.LOAIDUOC_ID, TM_DUOC.DUONGDUNG_ID,        TM_TENDUOC.TENDUOC, TM_TENDUOC.TENDUOC_EN, TM_TENDUOC.MAQUOCTE, TM_TENDUOC.MAQUOCTEBT,        TM_LOAIDUOC.LOAIVATTU_ID, TM_DUOC.BENHVIEN_ID,        TT_TONKHO.SOLUONG, TM_DUOC.VTYT_PHANLOAI, TM_DUOC.PHAMVI, TT_TONKHO.NGUONDUOC_ID, NG.TENNGUONDUOC AS TENNGUONDUOC        , TAMNGUNG = CASE WHEN TM_DUOC.TAMNGUNG = '1' OR NG.TAMNGUNG = '1' OR KD.TAMNGUNG = '1' THEN '1' ELSE '0' END        , TM_DUOC.DANGTRINHBAY        from TM_DUOC        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = TM_DUOC.DONVITINH_ID        left join TM_TENDUOC on TM_DUOC.TENDUOC_ID = TM_TENDUOC.TENDUOC_ID and TM_DUOC.BENHVIEN_ID = 'HLU01' and TM_DUOC.TAMNGUNG = '0'        left join TM_LOAIDUOC on TM_LOAIDUOC.LOAIDUOC_ID = TM_DUOC.LOAIDUOC_ID and TM_LOAIDUOC.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG on (TM_LOAIDUOC.LOAIVATTU_ID = TM_DUOC_HANDUNG.LOAIDUOC and TM_DUOC_HANDUNG.BENHVIEN_ID = 'HLU01')        inner join        (select LTRIM(A.KHODUOC_ID) + '_' + LTRIM(A.DUOC_ID) + '_' + LTRIM(ISNULL(A.NGUONDUOC_ID,'')) as DUOC_KEY, A.KHODUOC_ID, A.DUOC_ID, A.NGUONDUOC_ID,        SUM(isnull(A.SOLUONG,0)) as SOLUONG        from        (select SUM(SOLUONG) as SOLUONG, KHODUOC_ID, DUOC_ID, NGUONDUOC_ID from TT_DUOC_TONKHO        where BENHVIEN_ID = 'HLU01' group by KHODUOC_ID, DUOC_ID, NGUONDUOC_ID) A        group by LTRIM(A.KHODUOC_ID) + '_' + LTRIM(A.DUOC_ID) + '_' + LTRIM(ISNULL(A.NGUONDUOC_ID,'')), A.KHODUOC_ID, A.DUOC_ID, NGUONDUOC_ID        ) TT_TONKHO on TT_TONKHO.DUOC_ID = TM_DUOC.DUOC_ID        LEFT JOIN TM_NGUONHANG NG ON NG.NGUONDUOC_ID = TT_TONKHO.NGUONDUOC_ID        LEFT JOIN TM_KHODUOC KD ON KD.KHODUOC_ID = TT_TONKHO.KHODUOC_ID        where TM_DUOC.BENHVIEN_ID = 'HLU01' and TT_TONKHO.SOLUONG >= 0]
2019-09-20 10:04:46,018 [6] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM023']
2019-09-20 10:04:46,072 [6] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoVaBooking] PreparedStatement : [declare @NGUONDUOC_MACDINH varchar(5) = '0';        declare @TOAMUANGOAI int = 0;        select @NGUONDUOC_MACDINH = isnull(VALUE,0) from TM_SYS_APPSETTINGS where CODE = 'PHA_NGUONDUOC'        select @TOAMUANGOAI = isnull(VALUE,0) from TM_SYS_APPSETTINGS where CODE = 'OPD_TOAMUANGOAI_DUNGDANHMUC_DUOC'                if @TOAMUANGOAI = 1        begin        select  distinct '0' + '_' + LTRIM(d.DUOC_ID) + '_' + @NGUONDUOC_MACDINH as DUOC_KEY, 0 as PHAMVI_ID, @NGUONDUOC_MACDINH as NGUONDUOC_ID, null as TENNGUONDUOC, null as TINHTIEN, d.DUOC_ID, ld.MALOAIDUOC,        d.SOVISA,d.TYLE_VAT,d.COTOA, d.MADUOC, d.TENHANG, d.TENDUOCDAYDU, d.DONVITINH as DONVITINH, d.BHYT,        d.TENHOATCHAT, d.HAMLUONG, d.HANGSANXUAT, d.QUOCGIA, d.LOAIDUOC_ID, d.DUONGDUNG_ID, d.TINHTIEN_PTTT,        ten.TENDUOC, ten.TENDUOC_EN, ten.MAQUOCTE, ten.MAQUOCTEBT,        '' as BHYT_TEXT        , ld.LOAIVATTU_ID        , d.BENHVIEN_ID,        999999999 as SOLUONG, d.VTYT_PHANLOAI, d.PHAMVI, d.SUASOLUONGTONGHOP, d.MADUOCBV, d.DANGTRINHBAY        , TAMNGUNG = CASE WHEN d.TAMNGUNG = '1' THEN '1' ELSE '0' END        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        union all        select  distinct tk.DUOC_KEY, LTRIM(tk.PHAMVI_ID) as PHAMVI_ID, tk.NGUONDUOC_ID, nh.TENNGUONDUOC, nh.TINHTIEN, d.DUOC_ID, ld.MALOAIDUOC,        d.SOVISA,d.TYLE_VAT,d.COTOA, d.MADUOC, d.TENHANG, d.TENDUOCDAYDU, d.DONVITINH as DONVITINH, d.BHYT,        d.TENHOATCHAT, d.HAMLUONG, d.HANGSANXUAT, d.QUOCGIA, d.LOAIDUOC_ID, d.DUONGDUNG_ID, d.TINHTIEN_PTTT,        ten.TENDUOC, ten.TENDUOC_EN, ten.MAQUOCTE, ten.MAQUOCTEBT,        CASE WHEN d.BHYT = '1' THEN 'BHYT' ELSE '' END as BHYT_TEXT        , ld.LOAIVATTU_ID        , d.BENHVIEN_ID,        tk.SOLUONG, d.VTYT_PHANLOAI, d.PHAMVI, d.SUASOLUONGTONGHOP, d.MADUOCBV, d.DANGTRINHBAY        , TAMNGUNG = CASE WHEN d.TAMNGUNG = '1' OR nh.TAMNGUNG = '1' OR kd.TAMNGUNG = '1' THEN '1' ELSE '0' END        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        inner join        (        select  LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')) DUOC_KEY, (SUM(dtk.SOLUONG) - isnull(sum(A.SOLUONG),0) - isnull(sum(B.SOLUONG),0)) SOLUONG, pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        from (select sum(soluong) soluong,duoc_id,nguonduoc_id,khoduoc_id,benhvien_id from TT_DUOC_TONKHO  group by duoc_id,nguonduoc_id,khoduoc_id,benhvien_id) dtk        inner join TM_DUOC_PHAMVISD_MAPPING pvsd on dtk.KHODUOC_ID = pvsd.KHODUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NOITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) B on B.DUOC_ID = dtk.DUOC_ID and B.SOLUONG > 0 and B.PHAMVI_ID = pvsd.PHAMVI_ID and B.NGUONHANG_ID = dtk.NGUONDUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NGOAITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) A on A.DUOC_ID = dtk.DUOC_ID and A.SOLUONG > 0 and A.PHAMVI_ID = pvsd.PHAMVI_ID and A.NGUONHANG_ID = dtk.NGUONDUOC_ID        where dtk.SOLUONG > 0 and dtk.BENHVIEN_ID = 'HLU01'        group by LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')), pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        ) tk on tk.DUOC_ID = d.DUOC_ID        left join TM_DUOC_PHAMVISUDUNG kd on kd.PHAMVI_ID = tk.PHAMVI_ID and kd.BENHVIEN_ID = 'HLU01'        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = tk.NGUONDUOC_ID and nh.BENHVIEN_ID = 'HLU01'        where d.BENHVIEN_ID = 'HLU01'  and tk.SOLUONG >= 0        end        else        begin                  select  distinct tk.DUOC_KEY, LTRIM(tk.PHAMVI_ID) as PHAMVI_ID, tk.NGUONDUOC_ID, nh.TENNGUONDUOC, nh.TINHTIEN, d.DUOC_ID, ld.MALOAIDUOC,        d.SOVISA,d.TYLE_VAT,d.COTOA, d.MADUOC, d.TENHANG, d.TENDUOCDAYDU, d.DONVITINH as DONVITINH, d.BHYT,        d.TENHOATCHAT, d.HAMLUONG, d.HANGSANXUAT, d.QUOCGIA, d.LOAIDUOC_ID, d.DUONGDUNG_ID, d.TINHTIEN_PTTT,        ten.TENDUOC, ten.TENDUOC_EN, ten.MAQUOCTE, ten.MAQUOCTEBT,        CASE WHEN d.BHYT = '1' THEN 'BHYT' ELSE '' END as BHYT_TEXT        , ld.LOAIVATTU_ID        , d.BENHVIEN_ID,        tk.SOLUONG, d.VTYT_PHANLOAI, d.PHAMVI, d.SUASOLUONGTONGHOP, d.MADUOCBV, d.DANGTRINHBAY        , TAMNGUNG = CASE WHEN d.TAMNGUNG = '1' OR nh.TAMNGUNG = '1' OR kd.TAMNGUNG = '1' THEN '1' ELSE '0' END        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        inner join        (        select  LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')) DUOC_KEY, (SUM(dtk.SOLUONG) - isnull(sum(A.SOLUONG),0) - isnull(sum(B.SOLUONG),0)) SOLUONG, pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        from (select sum(soluong) soluong,duoc_id,nguonduoc_id,khoduoc_id,benhvien_id from TT_DUOC_TONKHO  group by duoc_id,nguonduoc_id,khoduoc_id,benhvien_id) dtk        inner join TM_DUOC_PHAMVISD_MAPPING pvsd on dtk.KHODUOC_ID = pvsd.KHODUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NOITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) B on B.DUOC_ID = dtk.DUOC_ID and B.SOLUONG > 0 and B.PHAMVI_ID = pvsd.PHAMVI_ID and B.NGUONHANG_ID = dtk.NGUONDUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NGOAITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) A on A.DUOC_ID = dtk.DUOC_ID and A.SOLUONG > 0 and A.PHAMVI_ID = pvsd.PHAMVI_ID and A.NGUONHANG_ID = dtk.NGUONDUOC_ID        where dtk.SOLUONG > 0 and dtk.BENHVIEN_ID = 'HLU01'        group by LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')), pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        ) tk on tk.DUOC_ID = d.DUOC_ID        left join TM_DUOC_PHAMVISUDUNG kd on kd.PHAMVI_ID = tk.PHAMVI_ID and kd.BENHVIEN_ID = 'HLU01'        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = tk.NGUONDUOC_ID and nh.BENHVIEN_ID = 'HLU01'        where d.BENHVIEN_ID = 'HLU01'  and tk.SOLUONG >= 0        end]
2019-09-20 10:04:53,756 [6] DEBUG - Statement Id: [DAO00320_GetList] PreparedStatement : [select M.*            from TM_MAU M            LEFT JOIN TM_MAU_DONVITINH DVT on M.DONVITINH_ID=DVT.DONVITINH_ID            where            M.TAMNGUNG = '0'            and M.BENHVIEN_ID = 'HLU01'            order by M.TENMAU]
2019-09-20 10:04:53,834 [6] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM071']
2019-09-20 10:04:53,888 [6] DEBUG - Statement Id: [DAO00322_GetListMauTonKhoForCreateCached] PreparedStatement : [SELECT DISTINCT          TK.MAU_KEY, TK.KHOMAU_ID, M.MAU_ID, M.MAMAU, M.TENMAU, M.NHOM_ABO, M.NHOM_RH, M.LOAIMAU_ID,          TK.SOLONHAP_ID, SLN.SOLONHAP, SLN.SOKIEMSOAT, TK.NGUONHANG_ID, NG.TENNGUONMAU, M.BENHVIEN_ID, M.DONVITINH_ID,          SUM(tk.SOLUONG) AS SOLUONG,K.TENKHO,DVT.TENDONVITINH          FROM TT_MAU_TONKHO TK          JOIN TM_KHO K ON TK.KHOMAU_ID = K.KHO_ID          JOIN TT_MAU_CHUNGTU_SOLONHAP SLN ON TK.SOLONHAP_ID = SLN.SOLONHAP_ID          JOIN TM_MAU M on TK.MAU_ID = M.MAU_ID and M.TAMNGUNG = '0'          LEFT JOIN TM_MAU_DONVITINH DVT on M.DONVITINH_ID=DVT.DONVITINH_ID          LEFT JOIN TM_NGUONMAU NG ON NG.NGUONMAU_ID = TK.NGUONHANG_ID          WHERE TK.SOLUONG > 0          GROUP BY TK.MAU_KEY, TK.KHOMAU_ID, M.MAU_ID, M.MAMAU, M.TENMAU, M.NHOM_ABO, M.NHOM_RH, M.LOAIMAU_ID,          TK.SOLONHAP_ID, SLN.SOLONHAP, SLN.SOKIEMSOAT,TK.NGUONHANG_ID, NG.TENNGUONMAU, M.BENHVIEN_ID, M.DONVITINH_ID,K.TENKHO,DVT.TENDONVITINH]
2019-09-20 10:04:54,582 [6] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM073']
2019-09-20 10:04:54,630 [6] DEBUG - Statement Id: [DAO00322_GetListMauTonKhoTruBooking] PreparedStatement : [select distinct          TK.MAU_KEY, TK.KHOMAU_ID, M.MAU_ID, M.MAMAU, M.TENMAU, M.NHOM_ABO, M.NHOM_RH, M.LOAIMAU_ID, M.DONVITINH_ID,          TK.SOLONHAP_ID, TK.SOLONHAP, TK.SOKIEMSOAT,M.PHAMVI, TK.NGUONHANG_ID, NG.TENNGUONMAU, M.BENHVIEN_ID,          TK.SOLUONG,TK.TENKHO,DVT.TENDONVITINH          from TM_MAU M          JOIN          (          select          A.MAU_KEY, A.KHOMAU_ID, A.MAU_ID ,a.NGUONHANG_ID, A.SOLONHAP_ID, A.SOLONHAP, A.SOKIEMSOAT, A.SOLUONG,A.TENKHO          from          (          select KHOMAU_ID, TK.MAU_ID, TK.NGUONHANG_ID, TK.MAU_KEY, SLN.SOLONHAP_ID, SLN.SOLONHAP, SLN.SOKIEMSOAT, ISNULL(TK.SOLUONG,0) - ISNULL(book.SOLUONG,0) as SOLUONG,K.TENKHO          from TT_MAU_TONKHO TK          JOIN TM_KHO K ON TK.KHOMAU_ID = K.KHO_ID          inner join TT_MAU_CHUNGTU_SOLONHAP SLN ON TK.SOLONHAP_ID = SLN.SOLONHAP_ID          left join dbo.TT_MAU_TONKHO_BOOK book ON book.MAU_KEY = TK.MAU_KEY AND book.TRANGTHAI = 'HIEULUC'          where ISNULL(TK.SOLUONG,0) - ISNULL(book.SOLUONG,0) > 0          ) A          )TK on TK.MAU_ID = M.MAU_ID and M.TAMNGUNG = '0'          LEFT JOIN TM_MAU_DONVITINH DVT on M.DONVITINH_ID=DVT.DONVITINH_ID          LEFT JOIN TM_NGUONMAU NG ON NG.NGUONMAU_ID = TK.NGUONHANG_ID]
2019-09-20 10:04:54,703 [6] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM072']
2019-09-20 10:04:55,635 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'MAIN'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2019-09-20 10:04:57,020 [1] DEBUG - Statement Id: [DAO00002_FormList] PreparedStatement : [select              TM_SYS_FORM.HOSPITAL_ID,              TM_SYS_FORM.NAME,              TM_SYS_FORM.CLASS,              TM_SYS_FORM.ASSEMBLY,              TM_SYS_FORM.TITLE_VI as TITLE              from TM_SYS_FORM              where HOSPITAL_ID = 'HLU01']
2019-09-20 10:05:02,596 [1] DEBUG - Statement Id: [DAO00300_GetShortcutListByUserID] PreparedStatement : [SELECT S.SHORTCUT_CODE, S.SHORTCUT_VALUE              FROM TM_SHORTCUT AS S              WHERE S.BENHVIEN_ID = 'HLU01' AND S.USER_ID = '1' AND TAMNGUNG = '0']
2019-09-20 10:05:02,632 [1] DEBUG - Statement Id: [DAO00087_GetList] PreparedStatement : [select CODE, VALUE, BENHVIEN_ID              from TM_SYS_APPSETTINGS              where LOCKED = '0' and BENHVIEN_ID = 'HLU01'              order by SETTING_ID]
2019-09-20 10:05:02,727 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'MSG01'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2019-09-20 10:05:02,954 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'MSG02'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2019-09-20 10:05:03,200 [1] DEBUG - Statement Id: [DAO00008_GetUserSettings] PreparedStatement : [select A.*, B.TENKHO , C.TENPHONGBAN, B.MAKHO, C.MAPHONGBAN          from TM_SYS_USERS A          left join TM_KHODUOC B on B.KHODUOC_ID = A.INVENTORY_ID          left join TM_PHONGBAN C on (C.PHONGBAN_ID = A.WORKING_DEPT_ID and C.BENHVIEN_ID =  @param0 )          left join TM_SYS_USERKHO D on (D.ACCOUNT_ID = A.ACCOUNT_ID and D.HOSPITAL_ID =  @param0 )          where          A.HOSPITAL_ID =  @param0            and                 A.ACCOUNT_ID =  @param1]
2019-09-20 10:05:03,202 [1] DEBUG - Statement Id: [DAO00008_GetUserSettings] Parameters: [@param0=[HOSPITAL_ID,HLU01], @param1=[ACCOUNT_ID,113]]
2019-09-20 10:05:03,202 [1] DEBUG - Statement Id: [DAO00008_GetUserSettings] Types: [@param0=[String, System.String], @param1=[String, System.String]]
2019-09-20 10:05:03,255 [1] DEBUG - Statement Id: [DAO00008_GetUserInvSettings] PreparedStatement : [select A.*, B.TENKHO, B.MAKHO, B.LOAIKHO_ID, B.KHOQUANLY_ID          from TM_SYS_USERKHO A          left join TM_KHO B on B.MODULE_ID = A.MODULE_ID and B.KHO_ID = A.KHO_ID          where A.HOSPITAL_ID =  @param0  and A.ACCOUNT_ID =  @param1           order by B.TENKHO]
2019-09-20 10:05:03,255 [1] DEBUG - Statement Id: [DAO00008_GetUserInvSettings] Parameters: [@param0=[HOSPITAL_ID,HLU01], @param1=[ACCOUNT_ID,113]]
2019-09-20 10:05:03,255 [1] DEBUG - Statement Id: [DAO00008_GetUserInvSettings] Types: [@param0=[String, System.String], @param1=[String, System.String]]
2019-09-20 10:05:03,421 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'COM30'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2019-09-20 10:05:03,673 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'RIS04'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2019-09-20 10:05:12,997 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'MENU1'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2019-09-20 10:05:13,104 [1] DEBUG - Statement Id: [DAO00011_GetList] PreparedStatement : [select              TM_SYS_MENU.ID,              TM_SYS_MENU.PARENTID,              TM_SYS_MENU.SCREEN,              TM_SYS_MENU.SMALLIMAGE,              TM_SYS_MENU.LARGEIMAGE,              TM_SYS_MENU.DESCRIPTION,              TM_SYS_MENU.TYPE,              TM_SYS_MENU.TITLE_VI as TITLE              from TM_SYS_MENU              where TM_SYS_MENU.HOSPITAL_ID = 'HLU01' and TM_SYS_MENU.ACTIVE = '1'               AND                   (TM_SYS_MENU.TYPE & '8' = '8')                             order by TM_SYS_MENU.ORDERNUM]
2019-09-20 10:05:13,509 [1] DEBUG - Statement Id: [DAO00011_usermenu_list] PreparedStatement : [select              TM_SYS_HOMEMENU.MENUID as ID,              TM_SYS_MENU.TITLE_VI as TITLE,              TM_SYS_MENU.SCREEN,              TM_SYS_MENU.SMALLIMAGE,              TM_SYS_MENU.LARGEIMAGE,              TM_SYS_MENU.TYPE              from TM_SYS_HOMEMENU              left join TM_SYS_MENU on TM_SYS_MENU.ID = TM_SYS_HOMEMENU.MENUID and TM_SYS_MENU.HOSPITAL_ID = TM_SYS_HOMEMENU.HOSPITAL_ID              where TM_SYS_HOMEMENU.HOSPITAL_ID = 'HLU01' and TM_SYS_HOMEMENU.USERID = '113' and TM_SYS_MENU.ACTIVE = '1'               AND                   (TM_SYS_MENU.TYPE & '8' = '8')                             ORDER BY TM_SYS_HOMEMENU.ORDERNUM]
2019-09-20 10:05:18,798 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'COM31'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2019-09-20 10:05:19,022 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'ORM28'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2019-09-20 10:05:27,345 [1] DEBUG - Statement Id: [DAO00066_GetBENHAN_TIEPNHAN] PreparedStatement : [select top 1 *        from TT_NOITRU_BENHAN        where TIEPNHAN_ID = '27022'  and BENHVIEN_ID = 'HLU01'        order by NGAYTAO desc]
2019-09-20 10:05:27,452 [1] DEBUG - Statement Id: [DAO00014_GetInPatientStatus] PreparedStatement : [select TRANGTHAI, isnull(KHOACHUYENDEN_ID, KHOAVAO_ID) as KHOAHIENTAI from TT_NOITRU_BENHAN        where        TIEPNHAN_ID = '27022'        and BENHVIEN_ID = 'HLU01'         and           BENHAN_ID = '5800']
2019-09-20 10:05:27,565 [1] DEBUG - Statement Id: [DAO00048_TT_PHAUTHUAT_GetList] PreparedStatement : [select *              from TT_PHAUTHUAT               where                             TT_PHAUTHUAT.LOAI = 'P'                       and                           TT_PHAUTHUAT.TIEPNHAN_ID = 27022                       and                           TT_PHAUTHUAT.BENHVIEN_ID = 'HLU01'                                     order by PHAUTHUAT_ID DESC]
2019-09-20 10:05:27,629 [1] DEBUG - Statement Id: [DAO00048_GetListLoaiGacTrongPTTT] PreparedStatement : [select DICTIONARY_ID, DICTIONARY_CODE, DICTIONARY_NAME          from LST_DICTIONARY          where DICTIONARY_TYPE_CODE = 'LoaiGacPTTT'          and ENABLED = '1']
2019-09-20 10:05:29,367 [1] DEBUG - Statement Id: [DAO00048_GetDSLoaiGacDaGhiNhan] PreparedStatement : [select A.KIEMSOATGAC_ID, A.BENHNHAN_ID, A.TIEPNHAN_ID, A.BENHAN_ID, A.PHAUTHUAT_ID, A.LOAIPT_TT, A.LOAIGAC_ID          , A.NGAYGHINHAN, A.THOIGIANGHINHAN, A.SOLUONG, A.SOLUONGDASUDUNG, A.SOLUONGCONLAI, A.GHICHU, A.NGUOINHANDUNGCU_ID          , B.DICTIONARY_CODE AS MALOAIGAC, B.DICTIONARY_NAME AS TENLOAIGAC          from TT_PHAUTHUAT_GHINHANGAC A          inner join LST_DICTIONARY B on B.DICTIONARY_ID = A.LOAIGAC_ID          where A.PHAUTHUAT_ID = 3742 and A.BENHVIEN_ID = 'HLU01']
2019-09-20 10:05:29,430 [1] DEBUG - Statement Id: [DAO00048_GetDSLoaiGacDaGhiNhan] PreparedStatement : [select A.KIEMSOATGAC_ID, A.BENHNHAN_ID, A.TIEPNHAN_ID, A.BENHAN_ID, A.PHAUTHUAT_ID, A.LOAIPT_TT, A.LOAIGAC_ID          , A.NGAYGHINHAN, A.THOIGIANGHINHAN, A.SOLUONG, A.SOLUONGDASUDUNG, A.SOLUONGCONLAI, A.GHICHU, A.NGUOINHANDUNGCU_ID          , B.DICTIONARY_CODE AS MALOAIGAC, B.DICTIONARY_NAME AS TENLOAIGAC          from TT_PHAUTHUAT_GHINHANGAC A          inner join LST_DICTIONARY B on B.DICTIONARY_ID = A.LOAIGAC_ID          where A.PHAUTHUAT_ID = 3742 and A.BENHVIEN_ID = 'HLU01']
2019-09-20 10:05:44,238 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'COM98'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
--------------------------------------------------------------------------------
2019-09-20 10:34:13,091 [1] DEBUG - Statement Id: [DAO00001_DBList] PreparedStatement : [select *              from TM_SYS_SERVER              where HOSPITAL_ID = '_SYSTEM_' and TYPE = 'D']
2019-09-20 10:34:13,433 [1] DEBUG - Statement Id: [DAO00001_DaoList] PreparedStatement : [select              TM_SYS_SERVICEMAP.ID,              TM_SYS_SERVICEMAP.HOSPITAL_ID,              TM_SYS_SERVICEMAP.DB_NAME,              TM_SYS_SERVICEMAP.TYPE,              TM_SYS_SERVICEMAP.NAME,              TM_SYS_SERVICEMAP.CLASS,              (TM_SYS_DIC.VALUE + '.' + TM_SYS_SERVICEMAP.CLASS) as CLASSFULL,              TM_SYS_SERVICEMAP.ASSEMBLY              from TM_SYS_SERVICEMAP              inner join TM_SYS_DIC              on TM_SYS_SERVICEMAP.NAMESPACE = TM_SYS_DIC.ID              where HOSPITAL_ID = '_SYSTEM_' AND TYPE = 'D' AND ACTIVE = '1'              order by DB_NAME]
2019-09-20 10:34:13,480 [1] DEBUG - Statement Id: [DAO00001_ServiceList] PreparedStatement : [select              TM_SYS_SERVICEMAP.ID,              TM_SYS_SERVICEMAP.HOSPITAL_ID,              TM_SYS_SERVICEMAP.DB_NAME,              TM_SYS_SERVICEMAP.TYPE,              TM_SYS_SERVICEMAP.NAME,              TM_SYS_SERVICEMAP.CLASS,              (TM_SYS_DIC.VALUE + '.' + TM_SYS_SERVICEMAP.CLASS) as CLASSFULL,              TM_SYS_SERVICEMAP.ASSEMBLY,              TM_SYS_SERVER.URL              from TM_SYS_SERVICEMAP              inner join TM_SYS_DIC on TM_SYS_SERVICEMAP.NAMESPACE = TM_SYS_DIC.ID              inner join TM_SYS_SERVER on (TM_SYS_SERVICEMAP.DB_NAME = TM_SYS_SERVER.NAME) and (TM_SYS_SERVER.HOSPITAL_ID = '_SYSTEM_')              where TM_SYS_SERVICEMAP.HOSPITAL_ID = '_SYSTEM_' AND TM_SYS_SERVICEMAP.TYPE = 'S'  AND ACTIVE = '1'              order by URL]
2019-09-20 10:34:13,880 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = '_SYSTEM_'               AND                   TM_SYS_SCREEN.PAGE = 'LOGIN'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2019-09-20 10:34:14,096 [1] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = '_SYSTEM_'               AND                   TM_SYS_CACHE.ACTIVE = '1']
2019-09-20 10:34:26,442 [1] DEBUG - Statement Id: [DAO00001_DBList] PreparedStatement : [select *              from TM_SYS_SERVER              where HOSPITAL_ID = 'HLU01' and TYPE = 'D']
2019-09-20 10:34:26,477 [1] DEBUG - Statement Id: [DAO00001_DaoList] PreparedStatement : [select              TM_SYS_SERVICEMAP.ID,              TM_SYS_SERVICEMAP.HOSPITAL_ID,              TM_SYS_SERVICEMAP.DB_NAME,              TM_SYS_SERVICEMAP.TYPE,              TM_SYS_SERVICEMAP.NAME,              TM_SYS_SERVICEMAP.CLASS,              (TM_SYS_DIC.VALUE + '.' + TM_SYS_SERVICEMAP.CLASS) as CLASSFULL,              TM_SYS_SERVICEMAP.ASSEMBLY              from TM_SYS_SERVICEMAP              inner join TM_SYS_DIC              on TM_SYS_SERVICEMAP.NAMESPACE = TM_SYS_DIC.ID              where HOSPITAL_ID = 'HLU01' AND TYPE = 'D' AND ACTIVE = '1'              order by DB_NAME]
2019-09-20 10:34:27,907 [1] DEBUG - Statement Id: [DAO00001_ServiceList] PreparedStatement : [select              TM_SYS_SERVICEMAP.ID,              TM_SYS_SERVICEMAP.HOSPITAL_ID,              TM_SYS_SERVICEMAP.DB_NAME,              TM_SYS_SERVICEMAP.TYPE,              TM_SYS_SERVICEMAP.NAME,              TM_SYS_SERVICEMAP.CLASS,              (TM_SYS_DIC.VALUE + '.' + TM_SYS_SERVICEMAP.CLASS) as CLASSFULL,              TM_SYS_SERVICEMAP.ASSEMBLY,              TM_SYS_SERVER.URL              from TM_SYS_SERVICEMAP              inner join TM_SYS_DIC on TM_SYS_SERVICEMAP.NAMESPACE = TM_SYS_DIC.ID              inner join TM_SYS_SERVER on (TM_SYS_SERVICEMAP.DB_NAME = TM_SYS_SERVER.NAME) and (TM_SYS_SERVER.HOSPITAL_ID = 'HLU01')              where TM_SYS_SERVICEMAP.HOSPITAL_ID = 'HLU01' AND TM_SYS_SERVICEMAP.TYPE = 'S'  AND ACTIVE = '1'              order by URL]
2019-09-20 10:34:27,999 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1']
2019-09-20 10:34:28,803 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM005']
2019-09-20 10:34:28,966 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM015']
2019-09-20 10:34:29,044 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM067']
2019-09-20 10:34:29,131 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM008']
2019-09-20 10:34:29,227 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM068']
2019-09-20 10:34:29,318 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM006']
2019-09-20 10:34:29,404 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM030']
2019-09-20 10:34:29,478 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM025']
2019-09-20 10:34:29,564 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM024']
2019-09-20 10:34:30,129 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM033']
2019-09-20 10:34:30,203 [5] DEBUG - Statement Id: [DAO00027_GetListDuocKyGuiTonKho] PreparedStatement : [select  distinct TT_TONKHO.DUOC_KEY, LTRIM(TT_TONKHO.KHODUOC_ID) as KHODUOC_ID, TM_DUOC.DUOC_ID, TM_LOAIDUOC.MALOAIDUOC,TM_DUOC.SOVISA,TM_DUOC.TYLE_VAT,TM_DUOC.COTOA,        TM_DUOC.MADUOC, TM_DUOC.TENHANG, TM_DUOC.TENDUOCDAYDU, dvt.TENDONVITINH as DONVITINH,  TM_DUOC.DONVITINH_ID,TM_DUOC.BHYT,TM_DUOC.PHAMVI,        TM_DUOC.TENHOATCHAT, TM_DUOC.HAMLUONG, TM_DUOC.HANGSANXUAT, TM_DUOC.QUOCGIA, TM_DUOC.LOAIDUOC_ID, TM_DUOC.DUONGDUNG_ID,        TM_TENDUOC.TENDUOC, TM_TENDUOC.TENDUOC_EN, TM_TENDUOC.MAQUOCTE, TM_TENDUOC.MAQUOCTEBT,        TM_LOAIDUOC.LOAIVATTU_ID, TM_DUOC.BENHVIEN_ID,TT_TONKHO.SOLUONG, TT_TONKHO.NGUONDUOC_ID, NH.TENNGUONDUOC        , TAMNGUNG = CASE WHEN TM_DUOC.TAMNGUNG = '1' OR nh.TAMNGUNG = '1' OR KD.TAMNGUNG = '1' THEN '1' ELSE '0' END        , TM_DUOC.DANGTRINHBAY        from TM_DUOC        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = TM_DUOC.DONVITINH_ID        left join TM_TENDUOC on TM_DUOC.TENDUOC_ID = TM_TENDUOC.TENDUOC_ID and TM_DUOC.BENHVIEN_ID = 'HLU01' and TM_DUOC.TAMNGUNG = '0'        left join TM_LOAIDUOC on TM_LOAIDUOC.LOAIDUOC_ID = TM_DUOC.LOAIDUOC_ID and TM_LOAIDUOC.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG on (TM_LOAIDUOC.LOAIVATTU_ID = TM_DUOC_HANDUNG.LOAIDUOC and TM_DUOC_HANDUNG.BENHVIEN_ID = 'HLU01')        inner join        (select LTRIM(A.KHODUOC_ID) + '_' + LTRIM(A.DUOC_ID) + '_' + LTRIM(ISNULL(A.NGUONDUOC_ID,'')) as DUOC_KEY, A.KHODUOC_ID, A.DUOC_ID,A.NGUONDUOC_ID,        SUM(isnull(A.SOLUONG,0)) as SOLUONG        from        (select SUM(SOLUONG) as SOLUONG, KHODUOC_ID, DUOC_ID, NGUONDUOC_ID from TT_DUOC_KYGUI_TONKHO        where BENHVIEN_ID = 'HLU01' group by KHODUOC_ID, DUOC_ID, NGUONDUOC_ID) A        group by LTRIM(A.KHODUOC_ID) + '_' + LTRIM(A.DUOC_ID) + '_' + LTRIM(A.NGUONDUOC_ID), A.KHODUOC_ID, A.DUOC_ID, A.NGUONDUOC_ID)        TT_TONKHO on TT_TONKHO.DUOC_ID = TM_DUOC.DUOC_ID        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = TT_TONKHO.NGUONDUOC_ID and nh.BENHVIEN_ID = 'HLU01'        LEFT JOIN TM_KHODUOC KD ON KD.KHODUOC_ID = TT_TONKHO.KHODUOC_ID        where TM_DUOC.BENHVIEN_ID = 'HLU01' AND TT_TONKHO.SOLUONG >= 0]
2019-09-20 10:34:31,023 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM018']
2019-09-20 10:34:31,074 [5] DEBUG - Statement Id: [DAO00027_GetListDuocTonKho] PreparedStatement : [select distinct TT_TONKHO.DUOC_KEY, LTRIM(TT_TONKHO.KHODUOC_ID) as KHODUOC_ID, TM_DUOC.DUOC_ID, TM_LOAIDUOC.MALOAIDUOC,TM_DUOC.SOVISA,TM_DUOC.TYLE_VAT,TM_DUOC.COTOA,        TM_DUOC.MADUOC, TM_DUOC.TENHANG, TM_DUOC.TENDUOCDAYDU, dvt.TENDONVITINH as DONVITINH,  TM_DUOC.DONVITINH_ID,TM_DUOC.BHYT,                TM_DUOC.TENHOATCHAT,          TM_DUOC.HAMLUONG, TM_DUOC.HANGSANXUAT, TM_DUOC.QUOCGIA, TM_DUOC.LOAIDUOC_ID, TM_DUOC.DUONGDUNG_ID,        TM_TENDUOC.TENDUOC, TM_TENDUOC.TENDUOC_EN, TM_TENDUOC.MAQUOCTE, TM_TENDUOC.MAQUOCTEBT,        TM_LOAIDUOC.LOAIVATTU_ID, TM_DUOC.BENHVIEN_ID,        TT_TONKHO.SOLUONG, TM_DUOC.VTYT_PHANLOAI, TM_DUOC.PHAMVI, TT_TONKHO.NGUONDUOC_ID, NG.TENNGUONDUOC AS TENNGUONDUOC        , TAMNGUNG = CASE WHEN TM_DUOC.TAMNGUNG = '1' OR NG.TAMNGUNG = '1' OR KD.TAMNGUNG = '1' THEN '1' ELSE '0' END        , TM_DUOC.DANGTRINHBAY        from TM_DUOC        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = TM_DUOC.DONVITINH_ID        left join TM_TENDUOC on TM_DUOC.TENDUOC_ID = TM_TENDUOC.TENDUOC_ID and TM_DUOC.BENHVIEN_ID = 'HLU01' and TM_DUOC.TAMNGUNG = '0'        left join TM_LOAIDUOC on TM_LOAIDUOC.LOAIDUOC_ID = TM_DUOC.LOAIDUOC_ID and TM_LOAIDUOC.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG on (TM_LOAIDUOC.LOAIVATTU_ID = TM_DUOC_HANDUNG.LOAIDUOC and TM_DUOC_HANDUNG.BENHVIEN_ID = 'HLU01')        inner join        (select LTRIM(A.KHODUOC_ID) + '_' + LTRIM(A.DUOC_ID) + '_' + LTRIM(ISNULL(A.NGUONDUOC_ID,'')) as DUOC_KEY, A.KHODUOC_ID, A.DUOC_ID, A.NGUONDUOC_ID,        SUM(isnull(A.SOLUONG,0)) as SOLUONG        from        (select SUM(SOLUONG) as SOLUONG, KHODUOC_ID, DUOC_ID, NGUONDUOC_ID from TT_DUOC_TONKHO        where BENHVIEN_ID = 'HLU01' group by KHODUOC_ID, DUOC_ID, NGUONDUOC_ID) A        group by LTRIM(A.KHODUOC_ID) + '_' + LTRIM(A.DUOC_ID) + '_' + LTRIM(ISNULL(A.NGUONDUOC_ID,'')), A.KHODUOC_ID, A.DUOC_ID, NGUONDUOC_ID        ) TT_TONKHO on TT_TONKHO.DUOC_ID = TM_DUOC.DUOC_ID        LEFT JOIN TM_NGUONHANG NG ON NG.NGUONDUOC_ID = TT_TONKHO.NGUONDUOC_ID        LEFT JOIN TM_KHODUOC KD ON KD.KHODUOC_ID = TT_TONKHO.KHODUOC_ID        where TM_DUOC.BENHVIEN_ID = 'HLU01' and TT_TONKHO.SOLUONG >= 0]
2019-09-20 10:34:34,043 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM023']
2019-09-20 10:34:34,084 [5] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoVaBooking] PreparedStatement : [declare @NGUONDUOC_MACDINH varchar(5) = '0';        declare @TOAMUANGOAI int = 0;        select @NGUONDUOC_MACDINH = isnull(VALUE,0) from TM_SYS_APPSETTINGS where CODE = 'PHA_NGUONDUOC'        select @TOAMUANGOAI = isnull(VALUE,0) from TM_SYS_APPSETTINGS where CODE = 'OPD_TOAMUANGOAI_DUNGDANHMUC_DUOC'                if @TOAMUANGOAI = 1        begin        select  distinct '0' + '_' + LTRIM(d.DUOC_ID) + '_' + @NGUONDUOC_MACDINH as DUOC_KEY, 0 as PHAMVI_ID, @NGUONDUOC_MACDINH as NGUONDUOC_ID, null as TENNGUONDUOC, null as TINHTIEN, d.DUOC_ID, ld.MALOAIDUOC,        d.SOVISA,d.TYLE_VAT,d.COTOA, d.MADUOC, d.TENHANG, d.TENDUOCDAYDU, d.DONVITINH as DONVITINH, d.BHYT,        d.TENHOATCHAT, d.HAMLUONG, d.HANGSANXUAT, d.QUOCGIA, d.LOAIDUOC_ID, d.DUONGDUNG_ID, d.TINHTIEN_PTTT,        ten.TENDUOC, ten.TENDUOC_EN, ten.MAQUOCTE, ten.MAQUOCTEBT,        '' as BHYT_TEXT        , ld.LOAIVATTU_ID        , d.BENHVIEN_ID,        999999999 as SOLUONG, d.VTYT_PHANLOAI, d.PHAMVI, d.SUASOLUONGTONGHOP, d.MADUOCBV, d.DANGTRINHBAY        , TAMNGUNG = CASE WHEN d.TAMNGUNG = '1' THEN '1' ELSE '0' END        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        union all        select  distinct tk.DUOC_KEY, LTRIM(tk.PHAMVI_ID) as PHAMVI_ID, tk.NGUONDUOC_ID, nh.TENNGUONDUOC, nh.TINHTIEN, d.DUOC_ID, ld.MALOAIDUOC,        d.SOVISA,d.TYLE_VAT,d.COTOA, d.MADUOC, d.TENHANG, d.TENDUOCDAYDU, d.DONVITINH as DONVITINH, d.BHYT,        d.TENHOATCHAT, d.HAMLUONG, d.HANGSANXUAT, d.QUOCGIA, d.LOAIDUOC_ID, d.DUONGDUNG_ID, d.TINHTIEN_PTTT,        ten.TENDUOC, ten.TENDUOC_EN, ten.MAQUOCTE, ten.MAQUOCTEBT,        CASE WHEN d.BHYT = '1' THEN 'BHYT' ELSE '' END as BHYT_TEXT        , ld.LOAIVATTU_ID        , d.BENHVIEN_ID,        tk.SOLUONG, d.VTYT_PHANLOAI, d.PHAMVI, d.SUASOLUONGTONGHOP, d.MADUOCBV, d.DANGTRINHBAY        , TAMNGUNG = CASE WHEN d.TAMNGUNG = '1' OR nh.TAMNGUNG = '1' OR kd.TAMNGUNG = '1' THEN '1' ELSE '0' END        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        inner join        (        select  LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')) DUOC_KEY, (SUM(dtk.SOLUONG) - isnull(sum(A.SOLUONG),0) - isnull(sum(B.SOLUONG),0)) SOLUONG, pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        from (select sum(soluong) soluong,duoc_id,nguonduoc_id,khoduoc_id,benhvien_id from TT_DUOC_TONKHO  group by duoc_id,nguonduoc_id,khoduoc_id,benhvien_id) dtk        inner join TM_DUOC_PHAMVISD_MAPPING pvsd on dtk.KHODUOC_ID = pvsd.KHODUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NOITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) B on B.DUOC_ID = dtk.DUOC_ID and B.SOLUONG > 0 and B.PHAMVI_ID = pvsd.PHAMVI_ID and B.NGUONHANG_ID = dtk.NGUONDUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NGOAITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) A on A.DUOC_ID = dtk.DUOC_ID and A.SOLUONG > 0 and A.PHAMVI_ID = pvsd.PHAMVI_ID and A.NGUONHANG_ID = dtk.NGUONDUOC_ID        where dtk.SOLUONG > 0 and dtk.BENHVIEN_ID = 'HLU01'        group by LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')), pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        ) tk on tk.DUOC_ID = d.DUOC_ID        left join TM_DUOC_PHAMVISUDUNG kd on kd.PHAMVI_ID = tk.PHAMVI_ID and kd.BENHVIEN_ID = 'HLU01'        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = tk.NGUONDUOC_ID and nh.BENHVIEN_ID = 'HLU01'        where d.BENHVIEN_ID = 'HLU01'  and tk.SOLUONG >= 0        end        else        begin                  select  distinct tk.DUOC_KEY, LTRIM(tk.PHAMVI_ID) as PHAMVI_ID, tk.NGUONDUOC_ID, nh.TENNGUONDUOC, nh.TINHTIEN, d.DUOC_ID, ld.MALOAIDUOC,        d.SOVISA,d.TYLE_VAT,d.COTOA, d.MADUOC, d.TENHANG, d.TENDUOCDAYDU, d.DONVITINH as DONVITINH, d.BHYT,        d.TENHOATCHAT, d.HAMLUONG, d.HANGSANXUAT, d.QUOCGIA, d.LOAIDUOC_ID, d.DUONGDUNG_ID, d.TINHTIEN_PTTT,        ten.TENDUOC, ten.TENDUOC_EN, ten.MAQUOCTE, ten.MAQUOCTEBT,        CASE WHEN d.BHYT = '1' THEN 'BHYT' ELSE '' END as BHYT_TEXT        , ld.LOAIVATTU_ID        , d.BENHVIEN_ID,        tk.SOLUONG, d.VTYT_PHANLOAI, d.PHAMVI, d.SUASOLUONGTONGHOP, d.MADUOCBV, d.DANGTRINHBAY        , TAMNGUNG = CASE WHEN d.TAMNGUNG = '1' OR nh.TAMNGUNG = '1' OR kd.TAMNGUNG = '1' THEN '1' ELSE '0' END        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        inner join        (        select  LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')) DUOC_KEY, (SUM(dtk.SOLUONG) - isnull(sum(A.SOLUONG),0) - isnull(sum(B.SOLUONG),0)) SOLUONG, pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        from (select sum(soluong) soluong,duoc_id,nguonduoc_id,khoduoc_id,benhvien_id from TT_DUOC_TONKHO  group by duoc_id,nguonduoc_id,khoduoc_id,benhvien_id) dtk        inner join TM_DUOC_PHAMVISD_MAPPING pvsd on dtk.KHODUOC_ID = pvsd.KHODUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NOITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) B on B.DUOC_ID = dtk.DUOC_ID and B.SOLUONG > 0 and B.PHAMVI_ID = pvsd.PHAMVI_ID and B.NGUONHANG_ID = dtk.NGUONDUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NGOAITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) A on A.DUOC_ID = dtk.DUOC_ID and A.SOLUONG > 0 and A.PHAMVI_ID = pvsd.PHAMVI_ID and A.NGUONHANG_ID = dtk.NGUONDUOC_ID        where dtk.SOLUONG > 0 and dtk.BENHVIEN_ID = 'HLU01'        group by LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')), pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        ) tk on tk.DUOC_ID = d.DUOC_ID        left join TM_DUOC_PHAMVISUDUNG kd on kd.PHAMVI_ID = tk.PHAMVI_ID and kd.BENHVIEN_ID = 'HLU01'        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = tk.NGUONDUOC_ID and nh.BENHVIEN_ID = 'HLU01'        where d.BENHVIEN_ID = 'HLU01'  and tk.SOLUONG >= 0        end]
2019-09-20 10:34:37,265 [5] DEBUG - Statement Id: [DAO00320_GetList] PreparedStatement : [select M.*            from TM_MAU M            LEFT JOIN TM_MAU_DONVITINH DVT on M.DONVITINH_ID=DVT.DONVITINH_ID            where            M.TAMNGUNG = '0'            and M.BENHVIEN_ID = 'HLU01'            order by M.TENMAU]
2019-09-20 10:34:37,681 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM071']
2019-09-20 10:34:37,764 [5] DEBUG - Statement Id: [DAO00322_GetListMauTonKhoForCreateCached] PreparedStatement : [SELECT DISTINCT          TK.MAU_KEY, TK.KHOMAU_ID, M.MAU_ID, M.MAMAU, M.TENMAU, M.NHOM_ABO, M.NHOM_RH, M.LOAIMAU_ID,          TK.SOLONHAP_ID, SLN.SOLONHAP, SLN.SOKIEMSOAT, TK.NGUONHANG_ID, NG.TENNGUONMAU, M.BENHVIEN_ID, M.DONVITINH_ID,          SUM(tk.SOLUONG) AS SOLUONG,K.TENKHO,DVT.TENDONVITINH          FROM TT_MAU_TONKHO TK          JOIN TM_KHO K ON TK.KHOMAU_ID = K.KHO_ID          JOIN TT_MAU_CHUNGTU_SOLONHAP SLN ON TK.SOLONHAP_ID = SLN.SOLONHAP_ID          JOIN TM_MAU M on TK.MAU_ID = M.MAU_ID and M.TAMNGUNG = '0'          LEFT JOIN TM_MAU_DONVITINH DVT on M.DONVITINH_ID=DVT.DONVITINH_ID          LEFT JOIN TM_NGUONMAU NG ON NG.NGUONMAU_ID = TK.NGUONHANG_ID          WHERE TK.SOLUONG > 0          GROUP BY TK.MAU_KEY, TK.KHOMAU_ID, M.MAU_ID, M.MAMAU, M.TENMAU, M.NHOM_ABO, M.NHOM_RH, M.LOAIMAU_ID,          TK.SOLONHAP_ID, SLN.SOLONHAP, SLN.SOKIEMSOAT,TK.NGUONHANG_ID, NG.TENNGUONMAU, M.BENHVIEN_ID, M.DONVITINH_ID,K.TENKHO,DVT.TENDONVITINH]
2019-09-20 10:34:37,873 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM073']
2019-09-20 10:34:37,927 [5] DEBUG - Statement Id: [DAO00322_GetListMauTonKhoTruBooking] PreparedStatement : [select distinct          TK.MAU_KEY, TK.KHOMAU_ID, M.MAU_ID, M.MAMAU, M.TENMAU, M.NHOM_ABO, M.NHOM_RH, M.LOAIMAU_ID, M.DONVITINH_ID,          TK.SOLONHAP_ID, TK.SOLONHAP, TK.SOKIEMSOAT,M.PHAMVI, TK.NGUONHANG_ID, NG.TENNGUONMAU, M.BENHVIEN_ID,          TK.SOLUONG,TK.TENKHO,DVT.TENDONVITINH          from TM_MAU M          JOIN          (          select          A.MAU_KEY, A.KHOMAU_ID, A.MAU_ID ,a.NGUONHANG_ID, A.SOLONHAP_ID, A.SOLONHAP, A.SOKIEMSOAT, A.SOLUONG,A.TENKHO          from          (          select KHOMAU_ID, TK.MAU_ID, TK.NGUONHANG_ID, TK.MAU_KEY, SLN.SOLONHAP_ID, SLN.SOLONHAP, SLN.SOKIEMSOAT, ISNULL(TK.SOLUONG,0) - ISNULL(book.SOLUONG,0) as SOLUONG,K.TENKHO          from TT_MAU_TONKHO TK          JOIN TM_KHO K ON TK.KHOMAU_ID = K.KHO_ID          inner join TT_MAU_CHUNGTU_SOLONHAP SLN ON TK.SOLONHAP_ID = SLN.SOLONHAP_ID          left join dbo.TT_MAU_TONKHO_BOOK book ON book.MAU_KEY = TK.MAU_KEY AND book.TRANGTHAI = 'HIEULUC'          where ISNULL(TK.SOLUONG,0) - ISNULL(book.SOLUONG,0) > 0          ) A          )TK on TK.MAU_ID = M.MAU_ID and M.TAMNGUNG = '0'          LEFT JOIN TM_MAU_DONVITINH DVT on M.DONVITINH_ID=DVT.DONVITINH_ID          LEFT JOIN TM_NGUONMAU NG ON NG.NGUONMAU_ID = TK.NGUONHANG_ID]
2019-09-20 10:34:38,010 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM072']
2019-09-20 10:34:39,025 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'MAIN'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2019-09-20 10:34:40,084 [1] DEBUG - Statement Id: [DAO00002_FormList] PreparedStatement : [select              TM_SYS_FORM.HOSPITAL_ID,              TM_SYS_FORM.NAME,              TM_SYS_FORM.CLASS,              TM_SYS_FORM.ASSEMBLY,              TM_SYS_FORM.TITLE_VI as TITLE              from TM_SYS_FORM              where HOSPITAL_ID = 'HLU01']
2019-09-20 10:34:45,255 [1] DEBUG - Statement Id: [DAO00300_GetShortcutListByUserID] PreparedStatement : [SELECT S.SHORTCUT_CODE, S.SHORTCUT_VALUE              FROM TM_SHORTCUT AS S              WHERE S.BENHVIEN_ID = 'HLU01' AND S.USER_ID = '1' AND TAMNGUNG = '0']
2019-09-20 10:34:45,304 [1] DEBUG - Statement Id: [DAO00087_GetList] PreparedStatement : [select CODE, VALUE, BENHVIEN_ID              from TM_SYS_APPSETTINGS              where LOCKED = '0' and BENHVIEN_ID = 'HLU01'              order by SETTING_ID]
2019-09-20 10:34:45,399 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'MSG01'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2019-09-20 10:34:45,520 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'MSG02'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2019-09-20 10:34:45,679 [1] DEBUG - Statement Id: [DAO00008_GetUserSettings] PreparedStatement : [select A.*, B.TENKHO , C.TENPHONGBAN, B.MAKHO, C.MAPHONGBAN          from TM_SYS_USERS A          left join TM_KHODUOC B on B.KHODUOC_ID = A.INVENTORY_ID          left join TM_PHONGBAN C on (C.PHONGBAN_ID = A.WORKING_DEPT_ID and C.BENHVIEN_ID =  @param0 )          left join TM_SYS_USERKHO D on (D.ACCOUNT_ID = A.ACCOUNT_ID and D.HOSPITAL_ID =  @param0 )          where          A.HOSPITAL_ID =  @param0            and                 A.ACCOUNT_ID =  @param1]
2019-09-20 10:34:45,681 [1] DEBUG - Statement Id: [DAO00008_GetUserSettings] Parameters: [@param0=[HOSPITAL_ID,HLU01], @param1=[ACCOUNT_ID,113]]
2019-09-20 10:34:45,682 [1] DEBUG - Statement Id: [DAO00008_GetUserSettings] Types: [@param0=[String, System.String], @param1=[String, System.String]]
2019-09-20 10:34:45,716 [1] DEBUG - Statement Id: [DAO00008_GetUserInvSettings] PreparedStatement : [select A.*, B.TENKHO, B.MAKHO, B.LOAIKHO_ID, B.KHOQUANLY_ID          from TM_SYS_USERKHO A          left join TM_KHO B on B.MODULE_ID = A.MODULE_ID and B.KHO_ID = A.KHO_ID          where A.HOSPITAL_ID =  @param0  and A.ACCOUNT_ID =  @param1           order by B.TENKHO]
2019-09-20 10:34:45,716 [1] DEBUG - Statement Id: [DAO00008_GetUserInvSettings] Parameters: [@param0=[HOSPITAL_ID,HLU01], @param1=[ACCOUNT_ID,113]]
2019-09-20 10:34:45,716 [1] DEBUG - Statement Id: [DAO00008_GetUserInvSettings] Types: [@param0=[String, System.String], @param1=[String, System.String]]
2019-09-20 10:34:45,838 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'COM30'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2019-09-20 10:34:45,999 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'RIS04'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2019-09-20 10:34:54,170 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'MENU1'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2019-09-20 10:34:54,267 [1] DEBUG - Statement Id: [DAO00011_GetList] PreparedStatement : [select              TM_SYS_MENU.ID,              TM_SYS_MENU.PARENTID,              TM_SYS_MENU.SCREEN,              TM_SYS_MENU.SMALLIMAGE,              TM_SYS_MENU.LARGEIMAGE,              TM_SYS_MENU.DESCRIPTION,              TM_SYS_MENU.TYPE,              TM_SYS_MENU.TITLE_VI as TITLE              from TM_SYS_MENU              where TM_SYS_MENU.HOSPITAL_ID = 'HLU01' and TM_SYS_MENU.ACTIVE = '1'               AND                   (TM_SYS_MENU.TYPE & '8' = '8')                             order by TM_SYS_MENU.ORDERNUM]
2019-09-20 10:34:54,563 [1] DEBUG - Statement Id: [DAO00011_usermenu_list] PreparedStatement : [select              TM_SYS_HOMEMENU.MENUID as ID,              TM_SYS_MENU.TITLE_VI as TITLE,              TM_SYS_MENU.SCREEN,              TM_SYS_MENU.SMALLIMAGE,              TM_SYS_MENU.LARGEIMAGE,              TM_SYS_MENU.TYPE              from TM_SYS_HOMEMENU              left join TM_SYS_MENU on TM_SYS_MENU.ID = TM_SYS_HOMEMENU.MENUID and TM_SYS_MENU.HOSPITAL_ID = TM_SYS_HOMEMENU.HOSPITAL_ID              where TM_SYS_HOMEMENU.HOSPITAL_ID = 'HLU01' and TM_SYS_HOMEMENU.USERID = '113' and TM_SYS_MENU.ACTIVE = '1'               AND                   (TM_SYS_MENU.TYPE & '8' = '8')                             ORDER BY TM_SYS_HOMEMENU.ORDERNUM]
2019-09-20 10:36:17,302 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'COM31'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2019-09-20 10:36:17,606 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'ORM28'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2019-09-20 10:36:22,998 [1] DEBUG - Statement Id: [DAO00066_GetBENHAN_TIEPNHAN] PreparedStatement : [select top 1 *        from TT_NOITRU_BENHAN        where TIEPNHAN_ID = '27022'  and BENHVIEN_ID = 'HLU01'        order by NGAYTAO desc]
2019-09-20 10:36:23,370 [1] DEBUG - Statement Id: [DAO00014_GetInPatientStatus] PreparedStatement : [select TRANGTHAI, isnull(KHOACHUYENDEN_ID, KHOAVAO_ID) as KHOAHIENTAI from TT_NOITRU_BENHAN        where        TIEPNHAN_ID = '27022'        and BENHVIEN_ID = 'HLU01'         and           BENHAN_ID = '5800']
2019-09-20 10:36:23,464 [1] DEBUG - Statement Id: [DAO00048_TT_PHAUTHUAT_GetList] PreparedStatement : [select *              from TT_PHAUTHUAT               where                             TT_PHAUTHUAT.LOAI = 'P'                       and                           TT_PHAUTHUAT.TIEPNHAN_ID = 27022                       and                           TT_PHAUTHUAT.BENHVIEN_ID = 'HLU01'                                     order by PHAUTHUAT_ID DESC]
2019-09-20 10:36:23,549 [1] DEBUG - Statement Id: [DAO00048_GetListLoaiGacTrongPTTT] PreparedStatement : [select DICTIONARY_ID, DICTIONARY_CODE, DICTIONARY_NAME          from LST_DICTIONARY          where DICTIONARY_TYPE_CODE = 'LoaiGacPTTT'          and ENABLED = '1']
2019-09-20 10:36:24,960 [1] DEBUG - Statement Id: [DAO00048_GetDSLoaiGacDaGhiNhan] PreparedStatement : [select A.KIEMSOATGAC_ID, A.BENHNHAN_ID, A.TIEPNHAN_ID, A.BENHAN_ID, A.PHAUTHUAT_ID, A.LOAIPT_TT, A.LOAIGAC_ID          , A.NGAYGHINHAN, A.THOIGIANGHINHAN, A.SOLUONG, A.SOLUONGDASUDUNG, A.SOLUONGCONLAI, A.GHICHU, A.NGUOINHANDUNGCU_ID          , B.DICTIONARY_CODE AS MALOAIGAC, B.DICTIONARY_NAME AS TENLOAIGAC          from TT_PHAUTHUAT_GHINHANGAC A          inner join LST_DICTIONARY B on B.DICTIONARY_ID = A.LOAIGAC_ID          where A.PHAUTHUAT_ID = 3742 and A.BENHVIEN_ID = 'HLU01']
2019-09-20 10:36:25,012 [1] DEBUG - Statement Id: [DAO00048_GetDSLoaiGacDaGhiNhan] PreparedStatement : [select A.KIEMSOATGAC_ID, A.BENHNHAN_ID, A.TIEPNHAN_ID, A.BENHAN_ID, A.PHAUTHUAT_ID, A.LOAIPT_TT, A.LOAIGAC_ID          , A.NGAYGHINHAN, A.THOIGIANGHINHAN, A.SOLUONG, A.SOLUONGDASUDUNG, A.SOLUONGCONLAI, A.GHICHU, A.NGUOINHANDUNGCU_ID          , B.DICTIONARY_CODE AS MALOAIGAC, B.DICTIONARY_NAME AS TENLOAIGAC          from TT_PHAUTHUAT_GHINHANGAC A          inner join LST_DICTIONARY B on B.DICTIONARY_ID = A.LOAIGAC_ID          where A.PHAUTHUAT_ID = 3742 and A.BENHVIEN_ID = 'HLU01']
2019-09-20 10:36:37,158 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'COM98'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
--------------------------------------------------------------------------------
2019-09-20 10:37:42,217 [1] DEBUG - Statement Id: [DAO00001_DBList] PreparedStatement : [select *              from TM_SYS_SERVER              where HOSPITAL_ID = '_SYSTEM_' and TYPE = 'D']
2019-09-20 10:37:42,528 [1] DEBUG - Statement Id: [DAO00001_DaoList] PreparedStatement : [select              TM_SYS_SERVICEMAP.ID,              TM_SYS_SERVICEMAP.HOSPITAL_ID,              TM_SYS_SERVICEMAP.DB_NAME,              TM_SYS_SERVICEMAP.TYPE,              TM_SYS_SERVICEMAP.NAME,              TM_SYS_SERVICEMAP.CLASS,              (TM_SYS_DIC.VALUE + '.' + TM_SYS_SERVICEMAP.CLASS) as CLASSFULL,              TM_SYS_SERVICEMAP.ASSEMBLY              from TM_SYS_SERVICEMAP              inner join TM_SYS_DIC              on TM_SYS_SERVICEMAP.NAMESPACE = TM_SYS_DIC.ID              where HOSPITAL_ID = '_SYSTEM_' AND TYPE = 'D' AND ACTIVE = '1'              order by DB_NAME]
2019-09-20 10:37:42,567 [1] DEBUG - Statement Id: [DAO00001_ServiceList] PreparedStatement : [select              TM_SYS_SERVICEMAP.ID,              TM_SYS_SERVICEMAP.HOSPITAL_ID,              TM_SYS_SERVICEMAP.DB_NAME,              TM_SYS_SERVICEMAP.TYPE,              TM_SYS_SERVICEMAP.NAME,              TM_SYS_SERVICEMAP.CLASS,              (TM_SYS_DIC.VALUE + '.' + TM_SYS_SERVICEMAP.CLASS) as CLASSFULL,              TM_SYS_SERVICEMAP.ASSEMBLY,              TM_SYS_SERVER.URL              from TM_SYS_SERVICEMAP              inner join TM_SYS_DIC on TM_SYS_SERVICEMAP.NAMESPACE = TM_SYS_DIC.ID              inner join TM_SYS_SERVER on (TM_SYS_SERVICEMAP.DB_NAME = TM_SYS_SERVER.NAME) and (TM_SYS_SERVER.HOSPITAL_ID = '_SYSTEM_')              where TM_SYS_SERVICEMAP.HOSPITAL_ID = '_SYSTEM_' AND TM_SYS_SERVICEMAP.TYPE = 'S'  AND ACTIVE = '1'              order by URL]
2019-09-20 10:37:43,006 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = '_SYSTEM_'               AND                   TM_SYS_SCREEN.PAGE = 'LOGIN'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2019-09-20 10:37:43,263 [1] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = '_SYSTEM_'               AND                   TM_SYS_CACHE.ACTIVE = '1']
2019-09-20 10:37:48,540 [1] DEBUG - Statement Id: [DAO00001_DBList] PreparedStatement : [select *              from TM_SYS_SERVER              where HOSPITAL_ID = 'HLU01' and TYPE = 'D']
2019-09-20 10:37:48,583 [1] DEBUG - Statement Id: [DAO00001_DaoList] PreparedStatement : [select              TM_SYS_SERVICEMAP.ID,              TM_SYS_SERVICEMAP.HOSPITAL_ID,              TM_SYS_SERVICEMAP.DB_NAME,              TM_SYS_SERVICEMAP.TYPE,              TM_SYS_SERVICEMAP.NAME,              TM_SYS_SERVICEMAP.CLASS,              (TM_SYS_DIC.VALUE + '.' + TM_SYS_SERVICEMAP.CLASS) as CLASSFULL,              TM_SYS_SERVICEMAP.ASSEMBLY              from TM_SYS_SERVICEMAP              inner join TM_SYS_DIC              on TM_SYS_SERVICEMAP.NAMESPACE = TM_SYS_DIC.ID              where HOSPITAL_ID = 'HLU01' AND TYPE = 'D' AND ACTIVE = '1'              order by DB_NAME]
2019-09-20 10:37:50,415 [1] DEBUG - Statement Id: [DAO00001_ServiceList] PreparedStatement : [select              TM_SYS_SERVICEMAP.ID,              TM_SYS_SERVICEMAP.HOSPITAL_ID,              TM_SYS_SERVICEMAP.DB_NAME,              TM_SYS_SERVICEMAP.TYPE,              TM_SYS_SERVICEMAP.NAME,              TM_SYS_SERVICEMAP.CLASS,              (TM_SYS_DIC.VALUE + '.' + TM_SYS_SERVICEMAP.CLASS) as CLASSFULL,              TM_SYS_SERVICEMAP.ASSEMBLY,              TM_SYS_SERVER.URL              from TM_SYS_SERVICEMAP              inner join TM_SYS_DIC on TM_SYS_SERVICEMAP.NAMESPACE = TM_SYS_DIC.ID              inner join TM_SYS_SERVER on (TM_SYS_SERVICEMAP.DB_NAME = TM_SYS_SERVER.NAME) and (TM_SYS_SERVER.HOSPITAL_ID = 'HLU01')              where TM_SYS_SERVICEMAP.HOSPITAL_ID = 'HLU01' AND TM_SYS_SERVICEMAP.TYPE = 'S'  AND ACTIVE = '1'              order by URL]
2019-09-20 10:37:50,498 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1']
2019-09-20 10:37:51,352 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM005']
2019-09-20 10:37:51,493 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM015']
2019-09-20 10:37:51,566 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM067']
2019-09-20 10:37:51,644 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM008']
2019-09-20 10:37:51,729 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM068']
2019-09-20 10:37:51,814 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM006']
2019-09-20 10:37:51,889 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM030']
2019-09-20 10:37:51,975 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM025']
2019-09-20 10:37:52,048 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM024']
2019-09-20 10:37:52,557 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM033']
2019-09-20 10:37:52,597 [5] DEBUG - Statement Id: [DAO00027_GetListDuocKyGuiTonKho] PreparedStatement : [select  distinct TT_TONKHO.DUOC_KEY, LTRIM(TT_TONKHO.KHODUOC_ID) as KHODUOC_ID, TM_DUOC.DUOC_ID, TM_LOAIDUOC.MALOAIDUOC,TM_DUOC.SOVISA,TM_DUOC.TYLE_VAT,TM_DUOC.COTOA,        TM_DUOC.MADUOC, TM_DUOC.TENHANG, TM_DUOC.TENDUOCDAYDU, dvt.TENDONVITINH as DONVITINH,  TM_DUOC.DONVITINH_ID,TM_DUOC.BHYT,TM_DUOC.PHAMVI,        TM_DUOC.TENHOATCHAT, TM_DUOC.HAMLUONG, TM_DUOC.HANGSANXUAT, TM_DUOC.QUOCGIA, TM_DUOC.LOAIDUOC_ID, TM_DUOC.DUONGDUNG_ID,        TM_TENDUOC.TENDUOC, TM_TENDUOC.TENDUOC_EN, TM_TENDUOC.MAQUOCTE, TM_TENDUOC.MAQUOCTEBT,        TM_LOAIDUOC.LOAIVATTU_ID, TM_DUOC.BENHVIEN_ID,TT_TONKHO.SOLUONG, TT_TONKHO.NGUONDUOC_ID, NH.TENNGUONDUOC        , TAMNGUNG = CASE WHEN TM_DUOC.TAMNGUNG = '1' OR nh.TAMNGUNG = '1' OR KD.TAMNGUNG = '1' THEN '1' ELSE '0' END        , TM_DUOC.DANGTRINHBAY        from TM_DUOC        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = TM_DUOC.DONVITINH_ID        left join TM_TENDUOC on TM_DUOC.TENDUOC_ID = TM_TENDUOC.TENDUOC_ID and TM_DUOC.BENHVIEN_ID = 'HLU01' and TM_DUOC.TAMNGUNG = '0'        left join TM_LOAIDUOC on TM_LOAIDUOC.LOAIDUOC_ID = TM_DUOC.LOAIDUOC_ID and TM_LOAIDUOC.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG on (TM_LOAIDUOC.LOAIVATTU_ID = TM_DUOC_HANDUNG.LOAIDUOC and TM_DUOC_HANDUNG.BENHVIEN_ID = 'HLU01')        inner join        (select LTRIM(A.KHODUOC_ID) + '_' + LTRIM(A.DUOC_ID) + '_' + LTRIM(ISNULL(A.NGUONDUOC_ID,'')) as DUOC_KEY, A.KHODUOC_ID, A.DUOC_ID,A.NGUONDUOC_ID,        SUM(isnull(A.SOLUONG,0)) as SOLUONG        from        (select SUM(SOLUONG) as SOLUONG, KHODUOC_ID, DUOC_ID, NGUONDUOC_ID from TT_DUOC_KYGUI_TONKHO        where BENHVIEN_ID = 'HLU01' group by KHODUOC_ID, DUOC_ID, NGUONDUOC_ID) A        group by LTRIM(A.KHODUOC_ID) + '_' + LTRIM(A.DUOC_ID) + '_' + LTRIM(A.NGUONDUOC_ID), A.KHODUOC_ID, A.DUOC_ID, A.NGUONDUOC_ID)        TT_TONKHO on TT_TONKHO.DUOC_ID = TM_DUOC.DUOC_ID        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = TT_TONKHO.NGUONDUOC_ID and nh.BENHVIEN_ID = 'HLU01'        LEFT JOIN TM_KHODUOC KD ON KD.KHODUOC_ID = TT_TONKHO.KHODUOC_ID        where TM_DUOC.BENHVIEN_ID = 'HLU01' AND TT_TONKHO.SOLUONG >= 0]
2019-09-20 10:37:52,673 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM018']
2019-09-20 10:37:52,709 [5] DEBUG - Statement Id: [DAO00027_GetListDuocTonKho] PreparedStatement : [select distinct TT_TONKHO.DUOC_KEY, LTRIM(TT_TONKHO.KHODUOC_ID) as KHODUOC_ID, TM_DUOC.DUOC_ID, TM_LOAIDUOC.MALOAIDUOC,TM_DUOC.SOVISA,TM_DUOC.TYLE_VAT,TM_DUOC.COTOA,        TM_DUOC.MADUOC, TM_DUOC.TENHANG, TM_DUOC.TENDUOCDAYDU, dvt.TENDONVITINH as DONVITINH,  TM_DUOC.DONVITINH_ID,TM_DUOC.BHYT,                TM_DUOC.TENHOATCHAT,          TM_DUOC.HAMLUONG, TM_DUOC.HANGSANXUAT, TM_DUOC.QUOCGIA, TM_DUOC.LOAIDUOC_ID, TM_DUOC.DUONGDUNG_ID,        TM_TENDUOC.TENDUOC, TM_TENDUOC.TENDUOC_EN, TM_TENDUOC.MAQUOCTE, TM_TENDUOC.MAQUOCTEBT,        TM_LOAIDUOC.LOAIVATTU_ID, TM_DUOC.BENHVIEN_ID,        TT_TONKHO.SOLUONG, TM_DUOC.VTYT_PHANLOAI, TM_DUOC.PHAMVI, TT_TONKHO.NGUONDUOC_ID, NG.TENNGUONDUOC AS TENNGUONDUOC        , TAMNGUNG = CASE WHEN TM_DUOC.TAMNGUNG = '1' OR NG.TAMNGUNG = '1' OR KD.TAMNGUNG = '1' THEN '1' ELSE '0' END        , TM_DUOC.DANGTRINHBAY        from TM_DUOC        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = TM_DUOC.DONVITINH_ID        left join TM_TENDUOC on TM_DUOC.TENDUOC_ID = TM_TENDUOC.TENDUOC_ID and TM_DUOC.BENHVIEN_ID = 'HLU01' and TM_DUOC.TAMNGUNG = '0'        left join TM_LOAIDUOC on TM_LOAIDUOC.LOAIDUOC_ID = TM_DUOC.LOAIDUOC_ID and TM_LOAIDUOC.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG on (TM_LOAIDUOC.LOAIVATTU_ID = TM_DUOC_HANDUNG.LOAIDUOC and TM_DUOC_HANDUNG.BENHVIEN_ID = 'HLU01')        inner join        (select LTRIM(A.KHODUOC_ID) + '_' + LTRIM(A.DUOC_ID) + '_' + LTRIM(ISNULL(A.NGUONDUOC_ID,'')) as DUOC_KEY, A.KHODUOC_ID, A.DUOC_ID, A.NGUONDUOC_ID,        SUM(isnull(A.SOLUONG,0)) as SOLUONG        from        (select SUM(SOLUONG) as SOLUONG, KHODUOC_ID, DUOC_ID, NGUONDUOC_ID from TT_DUOC_TONKHO        where BENHVIEN_ID = 'HLU01' group by KHODUOC_ID, DUOC_ID, NGUONDUOC_ID) A        group by LTRIM(A.KHODUOC_ID) + '_' + LTRIM(A.DUOC_ID) + '_' + LTRIM(ISNULL(A.NGUONDUOC_ID,'')), A.KHODUOC_ID, A.DUOC_ID, NGUONDUOC_ID        ) TT_TONKHO on TT_TONKHO.DUOC_ID = TM_DUOC.DUOC_ID        LEFT JOIN TM_NGUONHANG NG ON NG.NGUONDUOC_ID = TT_TONKHO.NGUONDUOC_ID        LEFT JOIN TM_KHODUOC KD ON KD.KHODUOC_ID = TT_TONKHO.KHODUOC_ID        where TM_DUOC.BENHVIEN_ID = 'HLU01' and TT_TONKHO.SOLUONG >= 0]
2019-09-20 10:37:53,476 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM023']
2019-09-20 10:37:53,588 [5] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoVaBooking] PreparedStatement : [declare @NGUONDUOC_MACDINH varchar(5) = '0';        declare @TOAMUANGOAI int = 0;        select @NGUONDUOC_MACDINH = isnull(VALUE,0) from TM_SYS_APPSETTINGS where CODE = 'PHA_NGUONDUOC'        select @TOAMUANGOAI = isnull(VALUE,0) from TM_SYS_APPSETTINGS where CODE = 'OPD_TOAMUANGOAI_DUNGDANHMUC_DUOC'                if @TOAMUANGOAI = 1        begin        select  distinct '0' + '_' + LTRIM(d.DUOC_ID) + '_' + @NGUONDUOC_MACDINH as DUOC_KEY, 0 as PHAMVI_ID, @NGUONDUOC_MACDINH as NGUONDUOC_ID, null as TENNGUONDUOC, null as TINHTIEN, d.DUOC_ID, ld.MALOAIDUOC,        d.SOVISA,d.TYLE_VAT,d.COTOA, d.MADUOC, d.TENHANG, d.TENDUOCDAYDU, d.DONVITINH as DONVITINH, d.BHYT,        d.TENHOATCHAT, d.HAMLUONG, d.HANGSANXUAT, d.QUOCGIA, d.LOAIDUOC_ID, d.DUONGDUNG_ID, d.TINHTIEN_PTTT,        ten.TENDUOC, ten.TENDUOC_EN, ten.MAQUOCTE, ten.MAQUOCTEBT,        '' as BHYT_TEXT        , ld.LOAIVATTU_ID        , d.BENHVIEN_ID,        999999999 as SOLUONG, d.VTYT_PHANLOAI, d.PHAMVI, d.SUASOLUONGTONGHOP, d.MADUOCBV, d.DANGTRINHBAY        , TAMNGUNG = CASE WHEN d.TAMNGUNG = '1' THEN '1' ELSE '0' END        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        union all        select  distinct tk.DUOC_KEY, LTRIM(tk.PHAMVI_ID) as PHAMVI_ID, tk.NGUONDUOC_ID, nh.TENNGUONDUOC, nh.TINHTIEN, d.DUOC_ID, ld.MALOAIDUOC,        d.SOVISA,d.TYLE_VAT,d.COTOA, d.MADUOC, d.TENHANG, d.TENDUOCDAYDU, d.DONVITINH as DONVITINH, d.BHYT,        d.TENHOATCHAT, d.HAMLUONG, d.HANGSANXUAT, d.QUOCGIA, d.LOAIDUOC_ID, d.DUONGDUNG_ID, d.TINHTIEN_PTTT,        ten.TENDUOC, ten.TENDUOC_EN, ten.MAQUOCTE, ten.MAQUOCTEBT,        CASE WHEN d.BHYT = '1' THEN 'BHYT' ELSE '' END as BHYT_TEXT        , ld.LOAIVATTU_ID        , d.BENHVIEN_ID,        tk.SOLUONG, d.VTYT_PHANLOAI, d.PHAMVI, d.SUASOLUONGTONGHOP, d.MADUOCBV, d.DANGTRINHBAY        , TAMNGUNG = CASE WHEN d.TAMNGUNG = '1' OR nh.TAMNGUNG = '1' OR kd.TAMNGUNG = '1' THEN '1' ELSE '0' END        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        inner join        (        select  LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')) DUOC_KEY, (SUM(dtk.SOLUONG) - isnull(sum(A.SOLUONG),0) - isnull(sum(B.SOLUONG),0)) SOLUONG, pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        from (select sum(soluong) soluong,duoc_id,nguonduoc_id,khoduoc_id,benhvien_id from TT_DUOC_TONKHO  group by duoc_id,nguonduoc_id,khoduoc_id,benhvien_id) dtk        inner join TM_DUOC_PHAMVISD_MAPPING pvsd on dtk.KHODUOC_ID = pvsd.KHODUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NOITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) B on B.DUOC_ID = dtk.DUOC_ID and B.SOLUONG > 0 and B.PHAMVI_ID = pvsd.PHAMVI_ID and B.NGUONHANG_ID = dtk.NGUONDUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NGOAITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) A on A.DUOC_ID = dtk.DUOC_ID and A.SOLUONG > 0 and A.PHAMVI_ID = pvsd.PHAMVI_ID and A.NGUONHANG_ID = dtk.NGUONDUOC_ID        where dtk.SOLUONG > 0 and dtk.BENHVIEN_ID = 'HLU01'        group by LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')), pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        ) tk on tk.DUOC_ID = d.DUOC_ID        left join TM_DUOC_PHAMVISUDUNG kd on kd.PHAMVI_ID = tk.PHAMVI_ID and kd.BENHVIEN_ID = 'HLU01'        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = tk.NGUONDUOC_ID and nh.BENHVIEN_ID = 'HLU01'        where d.BENHVIEN_ID = 'HLU01'  and tk.SOLUONG >= 0        end        else        begin                  select  distinct tk.DUOC_KEY, LTRIM(tk.PHAMVI_ID) as PHAMVI_ID, tk.NGUONDUOC_ID, nh.TENNGUONDUOC, nh.TINHTIEN, d.DUOC_ID, ld.MALOAIDUOC,        d.SOVISA,d.TYLE_VAT,d.COTOA, d.MADUOC, d.TENHANG, d.TENDUOCDAYDU, d.DONVITINH as DONVITINH, d.BHYT,        d.TENHOATCHAT, d.HAMLUONG, d.HANGSANXUAT, d.QUOCGIA, d.LOAIDUOC_ID, d.DUONGDUNG_ID, d.TINHTIEN_PTTT,        ten.TENDUOC, ten.TENDUOC_EN, ten.MAQUOCTE, ten.MAQUOCTEBT,        CASE WHEN d.BHYT = '1' THEN 'BHYT' ELSE '' END as BHYT_TEXT        , ld.LOAIVATTU_ID        , d.BENHVIEN_ID,        tk.SOLUONG, d.VTYT_PHANLOAI, d.PHAMVI, d.SUASOLUONGTONGHOP, d.MADUOCBV, d.DANGTRINHBAY        , TAMNGUNG = CASE WHEN d.TAMNGUNG = '1' OR nh.TAMNGUNG = '1' OR kd.TAMNGUNG = '1' THEN '1' ELSE '0' END        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        inner join        (        select  LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')) DUOC_KEY, (SUM(dtk.SOLUONG) - isnull(sum(A.SOLUONG),0) - isnull(sum(B.SOLUONG),0)) SOLUONG, pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        from (select sum(soluong) soluong,duoc_id,nguonduoc_id,khoduoc_id,benhvien_id from TT_DUOC_TONKHO  group by duoc_id,nguonduoc_id,khoduoc_id,benhvien_id) dtk        inner join TM_DUOC_PHAMVISD_MAPPING pvsd on dtk.KHODUOC_ID = pvsd.KHODUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NOITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) B on B.DUOC_ID = dtk.DUOC_ID and B.SOLUONG > 0 and B.PHAMVI_ID = pvsd.PHAMVI_ID and B.NGUONHANG_ID = dtk.NGUONDUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NGOAITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) A on A.DUOC_ID = dtk.DUOC_ID and A.SOLUONG > 0 and A.PHAMVI_ID = pvsd.PHAMVI_ID and A.NGUONHANG_ID = dtk.NGUONDUOC_ID        where dtk.SOLUONG > 0 and dtk.BENHVIEN_ID = 'HLU01'        group by LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')), pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        ) tk on tk.DUOC_ID = d.DUOC_ID        left join TM_DUOC_PHAMVISUDUNG kd on kd.PHAMVI_ID = tk.PHAMVI_ID and kd.BENHVIEN_ID = 'HLU01'        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = tk.NGUONDUOC_ID and nh.BENHVIEN_ID = 'HLU01'        where d.BENHVIEN_ID = 'HLU01'  and tk.SOLUONG >= 0        end]
2019-09-20 10:37:57,581 [5] DEBUG - Statement Id: [DAO00320_GetList] PreparedStatement : [select M.*            from TM_MAU M            LEFT JOIN TM_MAU_DONVITINH DVT on M.DONVITINH_ID=DVT.DONVITINH_ID            where            M.TAMNGUNG = '0'            and M.BENHVIEN_ID = 'HLU01'            order by M.TENMAU]
2019-09-20 10:37:57,659 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM071']
2019-09-20 10:37:57,697 [5] DEBUG - Statement Id: [DAO00322_GetListMauTonKhoForCreateCached] PreparedStatement : [SELECT DISTINCT          TK.MAU_KEY, TK.KHOMAU_ID, M.MAU_ID, M.MAMAU, M.TENMAU, M.NHOM_ABO, M.NHOM_RH, M.LOAIMAU_ID,          TK.SOLONHAP_ID, SLN.SOLONHAP, SLN.SOKIEMSOAT, TK.NGUONHANG_ID, NG.TENNGUONMAU, M.BENHVIEN_ID, M.DONVITINH_ID,          SUM(tk.SOLUONG) AS SOLUONG,K.TENKHO,DVT.TENDONVITINH          FROM TT_MAU_TONKHO TK          JOIN TM_KHO K ON TK.KHOMAU_ID = K.KHO_ID          JOIN TT_MAU_CHUNGTU_SOLONHAP SLN ON TK.SOLONHAP_ID = SLN.SOLONHAP_ID          JOIN TM_MAU M on TK.MAU_ID = M.MAU_ID and M.TAMNGUNG = '0'          LEFT JOIN TM_MAU_DONVITINH DVT on M.DONVITINH_ID=DVT.DONVITINH_ID          LEFT JOIN TM_NGUONMAU NG ON NG.NGUONMAU_ID = TK.NGUONHANG_ID          WHERE TK.SOLUONG > 0          GROUP BY TK.MAU_KEY, TK.KHOMAU_ID, M.MAU_ID, M.MAMAU, M.TENMAU, M.NHOM_ABO, M.NHOM_RH, M.LOAIMAU_ID,          TK.SOLONHAP_ID, SLN.SOLONHAP, SLN.SOKIEMSOAT,TK.NGUONHANG_ID, NG.TENNGUONMAU, M.BENHVIEN_ID, M.DONVITINH_ID,K.TENKHO,DVT.TENDONVITINH]
2019-09-20 10:37:57,810 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM073']
2019-09-20 10:37:57,853 [5] DEBUG - Statement Id: [DAO00322_GetListMauTonKhoTruBooking] PreparedStatement : [select distinct          TK.MAU_KEY, TK.KHOMAU_ID, M.MAU_ID, M.MAMAU, M.TENMAU, M.NHOM_ABO, M.NHOM_RH, M.LOAIMAU_ID, M.DONVITINH_ID,          TK.SOLONHAP_ID, TK.SOLONHAP, TK.SOKIEMSOAT,M.PHAMVI, TK.NGUONHANG_ID, NG.TENNGUONMAU, M.BENHVIEN_ID,          TK.SOLUONG,TK.TENKHO,DVT.TENDONVITINH          from TM_MAU M          JOIN          (          select          A.MAU_KEY, A.KHOMAU_ID, A.MAU_ID ,a.NGUONHANG_ID, A.SOLONHAP_ID, A.SOLONHAP, A.SOKIEMSOAT, A.SOLUONG,A.TENKHO          from          (          select KHOMAU_ID, TK.MAU_ID, TK.NGUONHANG_ID, TK.MAU_KEY, SLN.SOLONHAP_ID, SLN.SOLONHAP, SLN.SOKIEMSOAT, ISNULL(TK.SOLUONG,0) - ISNULL(book.SOLUONG,0) as SOLUONG,K.TENKHO          from TT_MAU_TONKHO TK          JOIN TM_KHO K ON TK.KHOMAU_ID = K.KHO_ID          inner join TT_MAU_CHUNGTU_SOLONHAP SLN ON TK.SOLONHAP_ID = SLN.SOLONHAP_ID          left join dbo.TT_MAU_TONKHO_BOOK book ON book.MAU_KEY = TK.MAU_KEY AND book.TRANGTHAI = 'HIEULUC'          where ISNULL(TK.SOLUONG,0) - ISNULL(book.SOLUONG,0) > 0          ) A          )TK on TK.MAU_ID = M.MAU_ID and M.TAMNGUNG = '0'          LEFT JOIN TM_MAU_DONVITINH DVT on M.DONVITINH_ID=DVT.DONVITINH_ID          LEFT JOIN TM_NGUONMAU NG ON NG.NGUONMAU_ID = TK.NGUONHANG_ID]
2019-09-20 10:37:57,977 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM072']
2019-09-20 10:37:58,910 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'MAIN'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2019-09-20 10:37:59,814 [1] DEBUG - Statement Id: [DAO00002_FormList] PreparedStatement : [select              TM_SYS_FORM.HOSPITAL_ID,              TM_SYS_FORM.NAME,              TM_SYS_FORM.CLASS,              TM_SYS_FORM.ASSEMBLY,              TM_SYS_FORM.TITLE_VI as TITLE              from TM_SYS_FORM              where HOSPITAL_ID = 'HLU01']
2019-09-20 10:38:05,301 [1] DEBUG - Statement Id: [DAO00300_GetShortcutListByUserID] PreparedStatement : [SELECT S.SHORTCUT_CODE, S.SHORTCUT_VALUE              FROM TM_SHORTCUT AS S              WHERE S.BENHVIEN_ID = 'HLU01' AND S.USER_ID = '1' AND TAMNGUNG = '0']
2019-09-20 10:38:05,333 [1] DEBUG - Statement Id: [DAO00087_GetList] PreparedStatement : [select CODE, VALUE, BENHVIEN_ID              from TM_SYS_APPSETTINGS              where LOCKED = '0' and BENHVIEN_ID = 'HLU01'              order by SETTING_ID]
2019-09-20 10:38:05,415 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'MSG01'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2019-09-20 10:38:05,530 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'MSG02'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2019-09-20 10:38:05,690 [1] DEBUG - Statement Id: [DAO00008_GetUserSettings] PreparedStatement : [select A.*, B.TENKHO , C.TENPHONGBAN, B.MAKHO, C.MAPHONGBAN          from TM_SYS_USERS A          left join TM_KHODUOC B on B.KHODUOC_ID = A.INVENTORY_ID          left join TM_PHONGBAN C on (C.PHONGBAN_ID = A.WORKING_DEPT_ID and C.BENHVIEN_ID =  @param0 )          left join TM_SYS_USERKHO D on (D.ACCOUNT_ID = A.ACCOUNT_ID and D.HOSPITAL_ID =  @param0 )          where          A.HOSPITAL_ID =  @param0            and                 A.ACCOUNT_ID =  @param1]
2019-09-20 10:38:05,692 [1] DEBUG - Statement Id: [DAO00008_GetUserSettings] Parameters: [@param0=[HOSPITAL_ID,HLU01], @param1=[ACCOUNT_ID,113]]
2019-09-20 10:38:05,692 [1] DEBUG - Statement Id: [DAO00008_GetUserSettings] Types: [@param0=[String, System.String], @param1=[String, System.String]]
2019-09-20 10:38:05,723 [1] DEBUG - Statement Id: [DAO00008_GetUserInvSettings] PreparedStatement : [select A.*, B.TENKHO, B.MAKHO, B.LOAIKHO_ID, B.KHOQUANLY_ID          from TM_SYS_USERKHO A          left join TM_KHO B on B.MODULE_ID = A.MODULE_ID and B.KHO_ID = A.KHO_ID          where A.HOSPITAL_ID =  @param0  and A.ACCOUNT_ID =  @param1           order by B.TENKHO]
2019-09-20 10:38:05,723 [1] DEBUG - Statement Id: [DAO00008_GetUserInvSettings] Parameters: [@param0=[HOSPITAL_ID,HLU01], @param1=[ACCOUNT_ID,113]]
2019-09-20 10:38:05,723 [1] DEBUG - Statement Id: [DAO00008_GetUserInvSettings] Types: [@param0=[String, System.String], @param1=[String, System.String]]
2019-09-20 10:38:05,850 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'COM30'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2019-09-20 10:38:05,991 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'RIS04'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2019-09-20 10:38:13,911 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'MENU1'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2019-09-20 10:38:14,007 [1] DEBUG - Statement Id: [DAO00011_GetList] PreparedStatement : [select              TM_SYS_MENU.ID,              TM_SYS_MENU.PARENTID,              TM_SYS_MENU.SCREEN,              TM_SYS_MENU.SMALLIMAGE,              TM_SYS_MENU.LARGEIMAGE,              TM_SYS_MENU.DESCRIPTION,              TM_SYS_MENU.TYPE,              TM_SYS_MENU.TITLE_VI as TITLE              from TM_SYS_MENU              where TM_SYS_MENU.HOSPITAL_ID = 'HLU01' and TM_SYS_MENU.ACTIVE = '1'               AND                   (TM_SYS_MENU.TYPE & '8' = '8')                             order by TM_SYS_MENU.ORDERNUM]
2019-09-20 10:38:14,316 [1] DEBUG - Statement Id: [DAO00011_usermenu_list] PreparedStatement : [select              TM_SYS_HOMEMENU.MENUID as ID,              TM_SYS_MENU.TITLE_VI as TITLE,              TM_SYS_MENU.SCREEN,              TM_SYS_MENU.SMALLIMAGE,              TM_SYS_MENU.LARGEIMAGE,              TM_SYS_MENU.TYPE              from TM_SYS_HOMEMENU              left join TM_SYS_MENU on TM_SYS_MENU.ID = TM_SYS_HOMEMENU.MENUID and TM_SYS_MENU.HOSPITAL_ID = TM_SYS_HOMEMENU.HOSPITAL_ID              where TM_SYS_HOMEMENU.HOSPITAL_ID = 'HLU01' and TM_SYS_HOMEMENU.USERID = '113' and TM_SYS_MENU.ACTIVE = '1'               AND                   (TM_SYS_MENU.TYPE & '8' = '8')                             ORDER BY TM_SYS_HOMEMENU.ORDERNUM]
2019-09-20 10:39:22,546 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'COM31'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2019-09-20 10:39:22,886 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'ORM28'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2019-09-20 10:39:27,388 [1] DEBUG - Statement Id: [DAO00066_GetBENHAN_TIEPNHAN] PreparedStatement : [select top 1 *        from TT_NOITRU_BENHAN        where TIEPNHAN_ID = '27022'  and BENHVIEN_ID = 'HLU01'        order by NGAYTAO desc]
2019-09-20 10:39:27,510 [1] DEBUG - Statement Id: [DAO00014_GetInPatientStatus] PreparedStatement : [select TRANGTHAI, isnull(KHOACHUYENDEN_ID, KHOAVAO_ID) as KHOAHIENTAI from TT_NOITRU_BENHAN        where        TIEPNHAN_ID = '27022'        and BENHVIEN_ID = 'HLU01'         and           BENHAN_ID = '5800']
2019-09-20 10:39:27,668 [1] DEBUG - Statement Id: [DAO00048_TT_PHAUTHUAT_GetList] PreparedStatement : [select *              from TT_PHAUTHUAT               where                             TT_PHAUTHUAT.LOAI = 'P'                       and                           TT_PHAUTHUAT.TIEPNHAN_ID = 27022                       and                           TT_PHAUTHUAT.BENHVIEN_ID = 'HLU01'                                     order by PHAUTHUAT_ID DESC]
2019-09-20 10:39:27,741 [1] DEBUG - Statement Id: [DAO00048_GetListLoaiGacTrongPTTT] PreparedStatement : [select DICTIONARY_ID, DICTIONARY_CODE, DICTIONARY_NAME          from LST_DICTIONARY          where DICTIONARY_TYPE_CODE = 'LoaiGacPTTT'          and ENABLED = '1']
2019-09-20 10:39:29,186 [1] DEBUG - Statement Id: [DAO00048_GetDSLoaiGacDaGhiNhan] PreparedStatement : [select A.KIEMSOATGAC_ID, A.BENHNHAN_ID, A.TIEPNHAN_ID, A.BENHAN_ID, A.PHAUTHUAT_ID, A.LOAIPT_TT, A.LOAIGAC_ID          , A.NGAYGHINHAN, A.THOIGIANGHINHAN, A.SOLUONG, A.SOLUONGDASUDUNG, A.SOLUONGCONLAI, A.GHICHU, A.NGUOINHANDUNGCU_ID          , B.DICTIONARY_CODE AS MALOAIGAC, B.DICTIONARY_NAME AS TENLOAIGAC          from TT_PHAUTHUAT_GHINHANGAC A          inner join LST_DICTIONARY B on B.DICTIONARY_ID = A.LOAIGAC_ID          where A.PHAUTHUAT_ID = 3742 and A.BENHVIEN_ID = 'HLU01']
2019-09-20 10:39:29,364 [1] DEBUG - Statement Id: [DAO00048_GetDSLoaiGacDaGhiNhan] PreparedStatement : [select A.KIEMSOATGAC_ID, A.BENHNHAN_ID, A.TIEPNHAN_ID, A.BENHAN_ID, A.PHAUTHUAT_ID, A.LOAIPT_TT, A.LOAIGAC_ID          , A.NGAYGHINHAN, A.THOIGIANGHINHAN, A.SOLUONG, A.SOLUONGDASUDUNG, A.SOLUONGCONLAI, A.GHICHU, A.NGUOINHANDUNGCU_ID          , B.DICTIONARY_CODE AS MALOAIGAC, B.DICTIONARY_NAME AS TENLOAIGAC          from TT_PHAUTHUAT_GHINHANGAC A          inner join LST_DICTIONARY B on B.DICTIONARY_ID = A.LOAIGAC_ID          where A.PHAUTHUAT_ID = 3742 and A.BENHVIEN_ID = 'HLU01']
2019-09-20 10:41:07,811 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'COM98'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
--------------------------------------------------------------------------------
2019-09-20 10:43:50,582 [1] DEBUG - Statement Id: [DAO00001_DBList] PreparedStatement : [select *              from TM_SYS_SERVER              where HOSPITAL_ID = '_SYSTEM_' and TYPE = 'D']
2019-09-20 10:43:50,853 [1] DEBUG - Statement Id: [DAO00001_DaoList] PreparedStatement : [select              TM_SYS_SERVICEMAP.ID,              TM_SYS_SERVICEMAP.HOSPITAL_ID,              TM_SYS_SERVICEMAP.DB_NAME,              TM_SYS_SERVICEMAP.TYPE,              TM_SYS_SERVICEMAP.NAME,              TM_SYS_SERVICEMAP.CLASS,              (TM_SYS_DIC.VALUE + '.' + TM_SYS_SERVICEMAP.CLASS) as CLASSFULL,              TM_SYS_SERVICEMAP.ASSEMBLY              from TM_SYS_SERVICEMAP              inner join TM_SYS_DIC              on TM_SYS_SERVICEMAP.NAMESPACE = TM_SYS_DIC.ID              where HOSPITAL_ID = '_SYSTEM_' AND TYPE = 'D' AND ACTIVE = '1'              order by DB_NAME]
2019-09-20 10:43:50,892 [1] DEBUG - Statement Id: [DAO00001_ServiceList] PreparedStatement : [select              TM_SYS_SERVICEMAP.ID,              TM_SYS_SERVICEMAP.HOSPITAL_ID,              TM_SYS_SERVICEMAP.DB_NAME,              TM_SYS_SERVICEMAP.TYPE,              TM_SYS_SERVICEMAP.NAME,              TM_SYS_SERVICEMAP.CLASS,              (TM_SYS_DIC.VALUE + '.' + TM_SYS_SERVICEMAP.CLASS) as CLASSFULL,              TM_SYS_SERVICEMAP.ASSEMBLY,              TM_SYS_SERVER.URL              from TM_SYS_SERVICEMAP              inner join TM_SYS_DIC on TM_SYS_SERVICEMAP.NAMESPACE = TM_SYS_DIC.ID              inner join TM_SYS_SERVER on (TM_SYS_SERVICEMAP.DB_NAME = TM_SYS_SERVER.NAME) and (TM_SYS_SERVER.HOSPITAL_ID = '_SYSTEM_')              where TM_SYS_SERVICEMAP.HOSPITAL_ID = '_SYSTEM_' AND TM_SYS_SERVICEMAP.TYPE = 'S'  AND ACTIVE = '1'              order by URL]
2019-09-20 10:43:51,310 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = '_SYSTEM_'               AND                   TM_SYS_SCREEN.PAGE = 'LOGIN'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2019-09-20 10:43:51,523 [1] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = '_SYSTEM_'               AND                   TM_SYS_CACHE.ACTIVE = '1']
2019-09-20 10:43:56,633 [1] DEBUG - Statement Id: [DAO00001_DBList] PreparedStatement : [select *              from TM_SYS_SERVER              where HOSPITAL_ID = 'HLU01' and TYPE = 'D']
2019-09-20 10:43:56,747 [1] DEBUG - Statement Id: [DAO00001_DaoList] PreparedStatement : [select              TM_SYS_SERVICEMAP.ID,              TM_SYS_SERVICEMAP.HOSPITAL_ID,              TM_SYS_SERVICEMAP.DB_NAME,              TM_SYS_SERVICEMAP.TYPE,              TM_SYS_SERVICEMAP.NAME,              TM_SYS_SERVICEMAP.CLASS,              (TM_SYS_DIC.VALUE + '.' + TM_SYS_SERVICEMAP.CLASS) as CLASSFULL,              TM_SYS_SERVICEMAP.ASSEMBLY              from TM_SYS_SERVICEMAP              inner join TM_SYS_DIC              on TM_SYS_SERVICEMAP.NAMESPACE = TM_SYS_DIC.ID              where HOSPITAL_ID = 'HLU01' AND TYPE = 'D' AND ACTIVE = '1'              order by DB_NAME]
2019-09-20 10:43:58,443 [1] DEBUG - Statement Id: [DAO00001_ServiceList] PreparedStatement : [select              TM_SYS_SERVICEMAP.ID,              TM_SYS_SERVICEMAP.HOSPITAL_ID,              TM_SYS_SERVICEMAP.DB_NAME,              TM_SYS_SERVICEMAP.TYPE,              TM_SYS_SERVICEMAP.NAME,              TM_SYS_SERVICEMAP.CLASS,              (TM_SYS_DIC.VALUE + '.' + TM_SYS_SERVICEMAP.CLASS) as CLASSFULL,              TM_SYS_SERVICEMAP.ASSEMBLY,              TM_SYS_SERVER.URL              from TM_SYS_SERVICEMAP              inner join TM_SYS_DIC on TM_SYS_SERVICEMAP.NAMESPACE = TM_SYS_DIC.ID              inner join TM_SYS_SERVER on (TM_SYS_SERVICEMAP.DB_NAME = TM_SYS_SERVER.NAME) and (TM_SYS_SERVER.HOSPITAL_ID = 'HLU01')              where TM_SYS_SERVICEMAP.HOSPITAL_ID = 'HLU01' AND TM_SYS_SERVICEMAP.TYPE = 'S'  AND ACTIVE = '1'              order by URL]
2019-09-20 10:43:58,535 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1']
2019-09-20 10:44:00,718 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM005']
2019-09-20 10:44:00,872 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM015']
2019-09-20 10:44:00,951 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM067']
2019-09-20 10:44:01,062 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM008']
2019-09-20 10:44:01,151 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM068']
2019-09-20 10:44:01,271 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM006']
2019-09-20 10:44:01,362 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM030']
2019-09-20 10:44:01,454 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM025']
2019-09-20 10:44:01,533 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM024']
2019-09-20 10:44:02,041 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM033']
2019-09-20 10:44:02,083 [5] DEBUG - Statement Id: [DAO00027_GetListDuocKyGuiTonKho] PreparedStatement : [select  distinct TT_TONKHO.DUOC_KEY, LTRIM(TT_TONKHO.KHODUOC_ID) as KHODUOC_ID, TM_DUOC.DUOC_ID, TM_LOAIDUOC.MALOAIDUOC,TM_DUOC.SOVISA,TM_DUOC.TYLE_VAT,TM_DUOC.COTOA,        TM_DUOC.MADUOC, TM_DUOC.TENHANG, TM_DUOC.TENDUOCDAYDU, dvt.TENDONVITINH as DONVITINH,  TM_DUOC.DONVITINH_ID,TM_DUOC.BHYT,TM_DUOC.PHAMVI,        TM_DUOC.TENHOATCHAT, TM_DUOC.HAMLUONG, TM_DUOC.HANGSANXUAT, TM_DUOC.QUOCGIA, TM_DUOC.LOAIDUOC_ID, TM_DUOC.DUONGDUNG_ID,        TM_TENDUOC.TENDUOC, TM_TENDUOC.TENDUOC_EN, TM_TENDUOC.MAQUOCTE, TM_TENDUOC.MAQUOCTEBT,        TM_LOAIDUOC.LOAIVATTU_ID, TM_DUOC.BENHVIEN_ID,TT_TONKHO.SOLUONG, TT_TONKHO.NGUONDUOC_ID, NH.TENNGUONDUOC        , TAMNGUNG = CASE WHEN TM_DUOC.TAMNGUNG = '1' OR nh.TAMNGUNG = '1' OR KD.TAMNGUNG = '1' THEN '1' ELSE '0' END        , TM_DUOC.DANGTRINHBAY        from TM_DUOC        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = TM_DUOC.DONVITINH_ID        left join TM_TENDUOC on TM_DUOC.TENDUOC_ID = TM_TENDUOC.TENDUOC_ID and TM_DUOC.BENHVIEN_ID = 'HLU01' and TM_DUOC.TAMNGUNG = '0'        left join TM_LOAIDUOC on TM_LOAIDUOC.LOAIDUOC_ID = TM_DUOC.LOAIDUOC_ID and TM_LOAIDUOC.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG on (TM_LOAIDUOC.LOAIVATTU_ID = TM_DUOC_HANDUNG.LOAIDUOC and TM_DUOC_HANDUNG.BENHVIEN_ID = 'HLU01')        inner join        (select LTRIM(A.KHODUOC_ID) + '_' + LTRIM(A.DUOC_ID) + '_' + LTRIM(ISNULL(A.NGUONDUOC_ID,'')) as DUOC_KEY, A.KHODUOC_ID, A.DUOC_ID,A.NGUONDUOC_ID,        SUM(isnull(A.SOLUONG,0)) as SOLUONG        from        (select SUM(SOLUONG) as SOLUONG, KHODUOC_ID, DUOC_ID, NGUONDUOC_ID from TT_DUOC_KYGUI_TONKHO        where BENHVIEN_ID = 'HLU01' group by KHODUOC_ID, DUOC_ID, NGUONDUOC_ID) A        group by LTRIM(A.KHODUOC_ID) + '_' + LTRIM(A.DUOC_ID) + '_' + LTRIM(A.NGUONDUOC_ID), A.KHODUOC_ID, A.DUOC_ID, A.NGUONDUOC_ID)        TT_TONKHO on TT_TONKHO.DUOC_ID = TM_DUOC.DUOC_ID        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = TT_TONKHO.NGUONDUOC_ID and nh.BENHVIEN_ID = 'HLU01'        LEFT JOIN TM_KHODUOC KD ON KD.KHODUOC_ID = TT_TONKHO.KHODUOC_ID        where TM_DUOC.BENHVIEN_ID = 'HLU01' AND TT_TONKHO.SOLUONG >= 0]
2019-09-20 10:44:02,169 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM018']
2019-09-20 10:44:02,219 [5] DEBUG - Statement Id: [DAO00027_GetListDuocTonKho] PreparedStatement : [select distinct TT_TONKHO.DUOC_KEY, LTRIM(TT_TONKHO.KHODUOC_ID) as KHODUOC_ID, TM_DUOC.DUOC_ID, TM_LOAIDUOC.MALOAIDUOC,TM_DUOC.SOVISA,TM_DUOC.TYLE_VAT,TM_DUOC.COTOA,        TM_DUOC.MADUOC, TM_DUOC.TENHANG, TM_DUOC.TENDUOCDAYDU, dvt.TENDONVITINH as DONVITINH,  TM_DUOC.DONVITINH_ID,TM_DUOC.BHYT,                TM_DUOC.TENHOATCHAT,          TM_DUOC.HAMLUONG, TM_DUOC.HANGSANXUAT, TM_DUOC.QUOCGIA, TM_DUOC.LOAIDUOC_ID, TM_DUOC.DUONGDUNG_ID,        TM_TENDUOC.TENDUOC, TM_TENDUOC.TENDUOC_EN, TM_TENDUOC.MAQUOCTE, TM_TENDUOC.MAQUOCTEBT,        TM_LOAIDUOC.LOAIVATTU_ID, TM_DUOC.BENHVIEN_ID,        TT_TONKHO.SOLUONG, TM_DUOC.VTYT_PHANLOAI, TM_DUOC.PHAMVI, TT_TONKHO.NGUONDUOC_ID, NG.TENNGUONDUOC AS TENNGUONDUOC        , TAMNGUNG = CASE WHEN TM_DUOC.TAMNGUNG = '1' OR NG.TAMNGUNG = '1' OR KD.TAMNGUNG = '1' THEN '1' ELSE '0' END        , TM_DUOC.DANGTRINHBAY        from TM_DUOC        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = TM_DUOC.DONVITINH_ID        left join TM_TENDUOC on TM_DUOC.TENDUOC_ID = TM_TENDUOC.TENDUOC_ID and TM_DUOC.BENHVIEN_ID = 'HLU01' and TM_DUOC.TAMNGUNG = '0'        left join TM_LOAIDUOC on TM_LOAIDUOC.LOAIDUOC_ID = TM_DUOC.LOAIDUOC_ID and TM_LOAIDUOC.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG on (TM_LOAIDUOC.LOAIVATTU_ID = TM_DUOC_HANDUNG.LOAIDUOC and TM_DUOC_HANDUNG.BENHVIEN_ID = 'HLU01')        inner join        (select LTRIM(A.KHODUOC_ID) + '_' + LTRIM(A.DUOC_ID) + '_' + LTRIM(ISNULL(A.NGUONDUOC_ID,'')) as DUOC_KEY, A.KHODUOC_ID, A.DUOC_ID, A.NGUONDUOC_ID,        SUM(isnull(A.SOLUONG,0)) as SOLUONG        from        (select SUM(SOLUONG) as SOLUONG, KHODUOC_ID, DUOC_ID, NGUONDUOC_ID from TT_DUOC_TONKHO        where BENHVIEN_ID = 'HLU01' group by KHODUOC_ID, DUOC_ID, NGUONDUOC_ID) A        group by LTRIM(A.KHODUOC_ID) + '_' + LTRIM(A.DUOC_ID) + '_' + LTRIM(ISNULL(A.NGUONDUOC_ID,'')), A.KHODUOC_ID, A.DUOC_ID, NGUONDUOC_ID        ) TT_TONKHO on TT_TONKHO.DUOC_ID = TM_DUOC.DUOC_ID        LEFT JOIN TM_NGUONHANG NG ON NG.NGUONDUOC_ID = TT_TONKHO.NGUONDUOC_ID        LEFT JOIN TM_KHODUOC KD ON KD.KHODUOC_ID = TT_TONKHO.KHODUOC_ID        where TM_DUOC.BENHVIEN_ID = 'HLU01' and TT_TONKHO.SOLUONG >= 0]
2019-09-20 10:44:06,872 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM023']
2019-09-20 10:44:06,913 [5] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoVaBooking] PreparedStatement : [declare @NGUONDUOC_MACDINH varchar(5) = '0';        declare @TOAMUANGOAI int = 0;        select @NGUONDUOC_MACDINH = isnull(VALUE,0) from TM_SYS_APPSETTINGS where CODE = 'PHA_NGUONDUOC'        select @TOAMUANGOAI = isnull(VALUE,0) from TM_SYS_APPSETTINGS where CODE = 'OPD_TOAMUANGOAI_DUNGDANHMUC_DUOC'                if @TOAMUANGOAI = 1        begin        select  distinct '0' + '_' + LTRIM(d.DUOC_ID) + '_' + @NGUONDUOC_MACDINH as DUOC_KEY, 0 as PHAMVI_ID, @NGUONDUOC_MACDINH as NGUONDUOC_ID, null as TENNGUONDUOC, null as TINHTIEN, d.DUOC_ID, ld.MALOAIDUOC,        d.SOVISA,d.TYLE_VAT,d.COTOA, d.MADUOC, d.TENHANG, d.TENDUOCDAYDU, d.DONVITINH as DONVITINH, d.BHYT,        d.TENHOATCHAT, d.HAMLUONG, d.HANGSANXUAT, d.QUOCGIA, d.LOAIDUOC_ID, d.DUONGDUNG_ID, d.TINHTIEN_PTTT,        ten.TENDUOC, ten.TENDUOC_EN, ten.MAQUOCTE, ten.MAQUOCTEBT,        '' as BHYT_TEXT        , ld.LOAIVATTU_ID        , d.BENHVIEN_ID,        999999999 as SOLUONG, d.VTYT_PHANLOAI, d.PHAMVI, d.SUASOLUONGTONGHOP, d.MADUOCBV, d.DANGTRINHBAY        , TAMNGUNG = CASE WHEN d.TAMNGUNG = '1' THEN '1' ELSE '0' END        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        union all        select  distinct tk.DUOC_KEY, LTRIM(tk.PHAMVI_ID) as PHAMVI_ID, tk.NGUONDUOC_ID, nh.TENNGUONDUOC, nh.TINHTIEN, d.DUOC_ID, ld.MALOAIDUOC,        d.SOVISA,d.TYLE_VAT,d.COTOA, d.MADUOC, d.TENHANG, d.TENDUOCDAYDU, d.DONVITINH as DONVITINH, d.BHYT,        d.TENHOATCHAT, d.HAMLUONG, d.HANGSANXUAT, d.QUOCGIA, d.LOAIDUOC_ID, d.DUONGDUNG_ID, d.TINHTIEN_PTTT,        ten.TENDUOC, ten.TENDUOC_EN, ten.MAQUOCTE, ten.MAQUOCTEBT,        CASE WHEN d.BHYT = '1' THEN 'BHYT' ELSE '' END as BHYT_TEXT        , ld.LOAIVATTU_ID        , d.BENHVIEN_ID,        tk.SOLUONG, d.VTYT_PHANLOAI, d.PHAMVI, d.SUASOLUONGTONGHOP, d.MADUOCBV, d.DANGTRINHBAY        , TAMNGUNG = CASE WHEN d.TAMNGUNG = '1' OR nh.TAMNGUNG = '1' OR kd.TAMNGUNG = '1' THEN '1' ELSE '0' END        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        inner join        (        select  LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')) DUOC_KEY, (SUM(dtk.SOLUONG) - isnull(sum(A.SOLUONG),0) - isnull(sum(B.SOLUONG),0)) SOLUONG, pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        from (select sum(soluong) soluong,duoc_id,nguonduoc_id,khoduoc_id,benhvien_id from TT_DUOC_TONKHO  group by duoc_id,nguonduoc_id,khoduoc_id,benhvien_id) dtk        inner join TM_DUOC_PHAMVISD_MAPPING pvsd on dtk.KHODUOC_ID = pvsd.KHODUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NOITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) B on B.DUOC_ID = dtk.DUOC_ID and B.SOLUONG > 0 and B.PHAMVI_ID = pvsd.PHAMVI_ID and B.NGUONHANG_ID = dtk.NGUONDUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NGOAITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) A on A.DUOC_ID = dtk.DUOC_ID and A.SOLUONG > 0 and A.PHAMVI_ID = pvsd.PHAMVI_ID and A.NGUONHANG_ID = dtk.NGUONDUOC_ID        where dtk.SOLUONG > 0 and dtk.BENHVIEN_ID = 'HLU01'        group by LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')), pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        ) tk on tk.DUOC_ID = d.DUOC_ID        left join TM_DUOC_PHAMVISUDUNG kd on kd.PHAMVI_ID = tk.PHAMVI_ID and kd.BENHVIEN_ID = 'HLU01'        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = tk.NGUONDUOC_ID and nh.BENHVIEN_ID = 'HLU01'        where d.BENHVIEN_ID = 'HLU01'  and tk.SOLUONG >= 0        end        else        begin                  select  distinct tk.DUOC_KEY, LTRIM(tk.PHAMVI_ID) as PHAMVI_ID, tk.NGUONDUOC_ID, nh.TENNGUONDUOC, nh.TINHTIEN, d.DUOC_ID, ld.MALOAIDUOC,        d.SOVISA,d.TYLE_VAT,d.COTOA, d.MADUOC, d.TENHANG, d.TENDUOCDAYDU, d.DONVITINH as DONVITINH, d.BHYT,        d.TENHOATCHAT, d.HAMLUONG, d.HANGSANXUAT, d.QUOCGIA, d.LOAIDUOC_ID, d.DUONGDUNG_ID, d.TINHTIEN_PTTT,        ten.TENDUOC, ten.TENDUOC_EN, ten.MAQUOCTE, ten.MAQUOCTEBT,        CASE WHEN d.BHYT = '1' THEN 'BHYT' ELSE '' END as BHYT_TEXT        , ld.LOAIVATTU_ID        , d.BENHVIEN_ID,        tk.SOLUONG, d.VTYT_PHANLOAI, d.PHAMVI, d.SUASOLUONGTONGHOP, d.MADUOCBV, d.DANGTRINHBAY        , TAMNGUNG = CASE WHEN d.TAMNGUNG = '1' OR nh.TAMNGUNG = '1' OR kd.TAMNGUNG = '1' THEN '1' ELSE '0' END        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        inner join        (        select  LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')) DUOC_KEY, (SUM(dtk.SOLUONG) - isnull(sum(A.SOLUONG),0) - isnull(sum(B.SOLUONG),0)) SOLUONG, pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        from (select sum(soluong) soluong,duoc_id,nguonduoc_id,khoduoc_id,benhvien_id from TT_DUOC_TONKHO  group by duoc_id,nguonduoc_id,khoduoc_id,benhvien_id) dtk        inner join TM_DUOC_PHAMVISD_MAPPING pvsd on dtk.KHODUOC_ID = pvsd.KHODUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NOITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) B on B.DUOC_ID = dtk.DUOC_ID and B.SOLUONG > 0 and B.PHAMVI_ID = pvsd.PHAMVI_ID and B.NGUONHANG_ID = dtk.NGUONDUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NGOAITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) A on A.DUOC_ID = dtk.DUOC_ID and A.SOLUONG > 0 and A.PHAMVI_ID = pvsd.PHAMVI_ID and A.NGUONHANG_ID = dtk.NGUONDUOC_ID        where dtk.SOLUONG > 0 and dtk.BENHVIEN_ID = 'HLU01'        group by LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')), pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        ) tk on tk.DUOC_ID = d.DUOC_ID        left join TM_DUOC_PHAMVISUDUNG kd on kd.PHAMVI_ID = tk.PHAMVI_ID and kd.BENHVIEN_ID = 'HLU01'        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = tk.NGUONDUOC_ID and nh.BENHVIEN_ID = 'HLU01'        where d.BENHVIEN_ID = 'HLU01'  and tk.SOLUONG >= 0        end]
2019-09-20 10:44:13,445 [5] DEBUG - Statement Id: [DAO00320_GetList] PreparedStatement : [select M.*            from TM_MAU M            LEFT JOIN TM_MAU_DONVITINH DVT on M.DONVITINH_ID=DVT.DONVITINH_ID            where            M.TAMNGUNG = '0'            and M.BENHVIEN_ID = 'HLU01'            order by M.TENMAU]
2019-09-20 10:44:13,514 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM071']
2019-09-20 10:44:13,553 [5] DEBUG - Statement Id: [DAO00322_GetListMauTonKhoForCreateCached] PreparedStatement : [SELECT DISTINCT          TK.MAU_KEY, TK.KHOMAU_ID, M.MAU_ID, M.MAMAU, M.TENMAU, M.NHOM_ABO, M.NHOM_RH, M.LOAIMAU_ID,          TK.SOLONHAP_ID, SLN.SOLONHAP, SLN.SOKIEMSOAT, TK.NGUONHANG_ID, NG.TENNGUONMAU, M.BENHVIEN_ID, M.DONVITINH_ID,          SUM(tk.SOLUONG) AS SOLUONG,K.TENKHO,DVT.TENDONVITINH          FROM TT_MAU_TONKHO TK          JOIN TM_KHO K ON TK.KHOMAU_ID = K.KHO_ID          JOIN TT_MAU_CHUNGTU_SOLONHAP SLN ON TK.SOLONHAP_ID = SLN.SOLONHAP_ID          JOIN TM_MAU M on TK.MAU_ID = M.MAU_ID and M.TAMNGUNG = '0'          LEFT JOIN TM_MAU_DONVITINH DVT on M.DONVITINH_ID=DVT.DONVITINH_ID          LEFT JOIN TM_NGUONMAU NG ON NG.NGUONMAU_ID = TK.NGUONHANG_ID          WHERE TK.SOLUONG > 0          GROUP BY TK.MAU_KEY, TK.KHOMAU_ID, M.MAU_ID, M.MAMAU, M.TENMAU, M.NHOM_ABO, M.NHOM_RH, M.LOAIMAU_ID,          TK.SOLONHAP_ID, SLN.SOLONHAP, SLN.SOKIEMSOAT,TK.NGUONHANG_ID, NG.TENNGUONMAU, M.BENHVIEN_ID, M.DONVITINH_ID,K.TENKHO,DVT.TENDONVITINH]
2019-09-20 10:44:13,632 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM073']
2019-09-20 10:44:13,687 [5] DEBUG - Statement Id: [DAO00322_GetListMauTonKhoTruBooking] PreparedStatement : [select distinct          TK.MAU_KEY, TK.KHOMAU_ID, M.MAU_ID, M.MAMAU, M.TENMAU, M.NHOM_ABO, M.NHOM_RH, M.LOAIMAU_ID, M.DONVITINH_ID,          TK.SOLONHAP_ID, TK.SOLONHAP, TK.SOKIEMSOAT,M.PHAMVI, TK.NGUONHANG_ID, NG.TENNGUONMAU, M.BENHVIEN_ID,          TK.SOLUONG,TK.TENKHO,DVT.TENDONVITINH          from TM_MAU M          JOIN          (          select          A.MAU_KEY, A.KHOMAU_ID, A.MAU_ID ,a.NGUONHANG_ID, A.SOLONHAP_ID, A.SOLONHAP, A.SOKIEMSOAT, A.SOLUONG,A.TENKHO          from          (          select KHOMAU_ID, TK.MAU_ID, TK.NGUONHANG_ID, TK.MAU_KEY, SLN.SOLONHAP_ID, SLN.SOLONHAP, SLN.SOKIEMSOAT, ISNULL(TK.SOLUONG,0) - ISNULL(book.SOLUONG,0) as SOLUONG,K.TENKHO          from TT_MAU_TONKHO TK          JOIN TM_KHO K ON TK.KHOMAU_ID = K.KHO_ID          inner join TT_MAU_CHUNGTU_SOLONHAP SLN ON TK.SOLONHAP_ID = SLN.SOLONHAP_ID          left join dbo.TT_MAU_TONKHO_BOOK book ON book.MAU_KEY = TK.MAU_KEY AND book.TRANGTHAI = 'HIEULUC'          where ISNULL(TK.SOLUONG,0) - ISNULL(book.SOLUONG,0) > 0          ) A          )TK on TK.MAU_ID = M.MAU_ID and M.TAMNGUNG = '0'          LEFT JOIN TM_MAU_DONVITINH DVT on M.DONVITINH_ID=DVT.DONVITINH_ID          LEFT JOIN TM_NGUONMAU NG ON NG.NGUONMAU_ID = TK.NGUONHANG_ID]
2019-09-20 10:44:13,772 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM072']
2019-09-20 10:44:14,731 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'MAIN'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2019-09-20 10:44:16,115 [1] DEBUG - Statement Id: [DAO00002_FormList] PreparedStatement : [select              TM_SYS_FORM.HOSPITAL_ID,              TM_SYS_FORM.NAME,              TM_SYS_FORM.CLASS,              TM_SYS_FORM.ASSEMBLY,              TM_SYS_FORM.TITLE_VI as TITLE              from TM_SYS_FORM              where HOSPITAL_ID = 'HLU01']
2019-09-20 10:44:20,569 [1] DEBUG - Statement Id: [DAO00300_GetShortcutListByUserID] PreparedStatement : [SELECT S.SHORTCUT_CODE, S.SHORTCUT_VALUE              FROM TM_SHORTCUT AS S              WHERE S.BENHVIEN_ID = 'HLU01' AND S.USER_ID = '1' AND TAMNGUNG = '0']
2019-09-20 10:44:20,609 [1] DEBUG - Statement Id: [DAO00087_GetList] PreparedStatement : [select CODE, VALUE, BENHVIEN_ID              from TM_SYS_APPSETTINGS              where LOCKED = '0' and BENHVIEN_ID = 'HLU01'              order by SETTING_ID]
2019-09-20 10:44:22,906 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'MSG01'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2019-09-20 10:44:23,507 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'MSG02'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2019-09-20 10:44:23,788 [1] DEBUG - Statement Id: [DAO00008_GetUserSettings] PreparedStatement : [select A.*, B.TENKHO , C.TENPHONGBAN, B.MAKHO, C.MAPHONGBAN          from TM_SYS_USERS A          left join TM_KHODUOC B on B.KHODUOC_ID = A.INVENTORY_ID          left join TM_PHONGBAN C on (C.PHONGBAN_ID = A.WORKING_DEPT_ID and C.BENHVIEN_ID =  @param0 )          left join TM_SYS_USERKHO D on (D.ACCOUNT_ID = A.ACCOUNT_ID and D.HOSPITAL_ID =  @param0 )          where          A.HOSPITAL_ID =  @param0            and                 A.ACCOUNT_ID =  @param1]
2019-09-20 10:44:23,791 [1] DEBUG - Statement Id: [DAO00008_GetUserSettings] Parameters: [@param0=[HOSPITAL_ID,HLU01], @param1=[ACCOUNT_ID,113]]
2019-09-20 10:44:23,791 [1] DEBUG - Statement Id: [DAO00008_GetUserSettings] Types: [@param0=[String, System.String], @param1=[String, System.String]]
2019-09-20 10:44:24,142 [1] DEBUG - Statement Id: [DAO00008_GetUserInvSettings] PreparedStatement : [select A.*, B.TENKHO, B.MAKHO, B.LOAIKHO_ID, B.KHOQUANLY_ID          from TM_SYS_USERKHO A          left join TM_KHO B on B.MODULE_ID = A.MODULE_ID and B.KHO_ID = A.KHO_ID          where A.HOSPITAL_ID =  @param0  and A.ACCOUNT_ID =  @param1           order by B.TENKHO]
2019-09-20 10:44:24,142 [1] DEBUG - Statement Id: [DAO00008_GetUserInvSettings] Parameters: [@param0=[HOSPITAL_ID,HLU01], @param1=[ACCOUNT_ID,113]]
2019-09-20 10:44:24,142 [1] DEBUG - Statement Id: [DAO00008_GetUserInvSettings] Types: [@param0=[String, System.String], @param1=[String, System.String]]
2019-09-20 10:44:24,282 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'COM30'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2019-09-20 10:44:26,764 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'RIS04'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2019-09-20 10:44:34,210 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'MENU1'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2019-09-20 10:44:35,310 [1] DEBUG - Statement Id: [DAO00011_GetList] PreparedStatement : [select              TM_SYS_MENU.ID,              TM_SYS_MENU.PARENTID,              TM_SYS_MENU.SCREEN,              TM_SYS_MENU.SMALLIMAGE,              TM_SYS_MENU.LARGEIMAGE,              TM_SYS_MENU.DESCRIPTION,              TM_SYS_MENU.TYPE,              TM_SYS_MENU.TITLE_VI as TITLE              from TM_SYS_MENU              where TM_SYS_MENU.HOSPITAL_ID = 'HLU01' and TM_SYS_MENU.ACTIVE = '1'               AND                   (TM_SYS_MENU.TYPE & '8' = '8')                             order by TM_SYS_MENU.ORDERNUM]
2019-09-20 10:44:35,814 [1] DEBUG - Statement Id: [DAO00011_usermenu_list] PreparedStatement : [select              TM_SYS_HOMEMENU.MENUID as ID,              TM_SYS_MENU.TITLE_VI as TITLE,              TM_SYS_MENU.SCREEN,              TM_SYS_MENU.SMALLIMAGE,              TM_SYS_MENU.LARGEIMAGE,              TM_SYS_MENU.TYPE              from TM_SYS_HOMEMENU              left join TM_SYS_MENU on TM_SYS_MENU.ID = TM_SYS_HOMEMENU.MENUID and TM_SYS_MENU.HOSPITAL_ID = TM_SYS_HOMEMENU.HOSPITAL_ID              where TM_SYS_HOMEMENU.HOSPITAL_ID = 'HLU01' and TM_SYS_HOMEMENU.USERID = '113' and TM_SYS_MENU.ACTIVE = '1'               AND                   (TM_SYS_MENU.TYPE & '8' = '8')                             ORDER BY TM_SYS_HOMEMENU.ORDERNUM]
2019-09-20 10:45:01,675 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'COM31'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2019-09-20 10:45:01,836 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'ORM28'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2019-09-20 10:45:08,343 [1] DEBUG - Statement Id: [DAO00066_GetBENHAN_TIEPNHAN] PreparedStatement : [select top 1 *        from TT_NOITRU_BENHAN        where TIEPNHAN_ID = '27022'  and BENHVIEN_ID = 'HLU01'        order by NGAYTAO desc]
2019-09-20 10:45:08,508 [1] DEBUG - Statement Id: [DAO00014_GetInPatientStatus] PreparedStatement : [select TRANGTHAI, isnull(KHOACHUYENDEN_ID, KHOAVAO_ID) as KHOAHIENTAI from TT_NOITRU_BENHAN        where        TIEPNHAN_ID = '27022'        and BENHVIEN_ID = 'HLU01'         and           BENHAN_ID = '5800']
2019-09-20 10:45:08,630 [1] DEBUG - Statement Id: [DAO00048_TT_PHAUTHUAT_GetList] PreparedStatement : [select *              from TT_PHAUTHUAT               where                             TT_PHAUTHUAT.LOAI = 'P'                       and                           TT_PHAUTHUAT.TIEPNHAN_ID = 27022                       and                           TT_PHAUTHUAT.BENHVIEN_ID = 'HLU01'                                     order by PHAUTHUAT_ID DESC]
2019-09-20 10:45:08,678 [1] DEBUG - Statement Id: [DAO00048_GetListLoaiGacTrongPTTT] PreparedStatement : [select DICTIONARY_ID, DICTIONARY_CODE, DICTIONARY_NAME          from LST_DICTIONARY          where DICTIONARY_TYPE_CODE = 'LoaiGacPTTT'          and ENABLED = '1']
2019-09-20 10:45:10,100 [1] DEBUG - Statement Id: [DAO00048_GetDSLoaiGacDaGhiNhan] PreparedStatement : [select A.KIEMSOATGAC_ID, A.BENHNHAN_ID, A.TIEPNHAN_ID, A.BENHAN_ID, A.PHAUTHUAT_ID, A.LOAIPT_TT, A.LOAIGAC_ID          , A.NGAYGHINHAN, A.THOIGIANGHINHAN, A.SOLUONG, A.SOLUONGDASUDUNG, A.SOLUONGCONLAI, A.GHICHU, A.NGUOINHANDUNGCU_ID          , B.DICTIONARY_CODE AS MALOAIGAC, B.DICTIONARY_NAME AS TENLOAIGAC          from TT_PHAUTHUAT_GHINHANGAC A          inner join LST_DICTIONARY B on B.DICTIONARY_ID = A.LOAIGAC_ID          where A.PHAUTHUAT_ID = 3742 and A.BENHVIEN_ID = 'HLU01']
2019-09-20 10:45:10,539 [1] DEBUG - Statement Id: [DAO00048_GetDSLoaiGacDaGhiNhan] PreparedStatement : [select A.KIEMSOATGAC_ID, A.BENHNHAN_ID, A.TIEPNHAN_ID, A.BENHAN_ID, A.PHAUTHUAT_ID, A.LOAIPT_TT, A.LOAIGAC_ID          , A.NGAYGHINHAN, A.THOIGIANGHINHAN, A.SOLUONG, A.SOLUONGDASUDUNG, A.SOLUONGCONLAI, A.GHICHU, A.NGUOINHANDUNGCU_ID          , B.DICTIONARY_CODE AS MALOAIGAC, B.DICTIONARY_NAME AS TENLOAIGAC          from TT_PHAUTHUAT_GHINHANGAC A          inner join LST_DICTIONARY B on B.DICTIONARY_ID = A.LOAIGAC_ID          where A.PHAUTHUAT_ID = 3742 and A.BENHVIEN_ID = 'HLU01']
--------------------------------------------------------------------------------
2019-09-20 10:58:19,588 [1] DEBUG - Statement Id: [DAO00001_DBList] PreparedStatement : [select *              from TM_SYS_SERVER              where HOSPITAL_ID = '_SYSTEM_' and TYPE = 'D']
2019-09-20 10:58:19,893 [1] DEBUG - Statement Id: [DAO00001_DaoList] PreparedStatement : [select              TM_SYS_SERVICEMAP.ID,              TM_SYS_SERVICEMAP.HOSPITAL_ID,              TM_SYS_SERVICEMAP.DB_NAME,              TM_SYS_SERVICEMAP.TYPE,              TM_SYS_SERVICEMAP.NAME,              TM_SYS_SERVICEMAP.CLASS,              (TM_SYS_DIC.VALUE + '.' + TM_SYS_SERVICEMAP.CLASS) as CLASSFULL,              TM_SYS_SERVICEMAP.ASSEMBLY              from TM_SYS_SERVICEMAP              inner join TM_SYS_DIC              on TM_SYS_SERVICEMAP.NAMESPACE = TM_SYS_DIC.ID              where HOSPITAL_ID = '_SYSTEM_' AND TYPE = 'D' AND ACTIVE = '1'              order by DB_NAME]
2019-09-20 10:58:19,941 [1] DEBUG - Statement Id: [DAO00001_ServiceList] PreparedStatement : [select              TM_SYS_SERVICEMAP.ID,              TM_SYS_SERVICEMAP.HOSPITAL_ID,              TM_SYS_SERVICEMAP.DB_NAME,              TM_SYS_SERVICEMAP.TYPE,              TM_SYS_SERVICEMAP.NAME,              TM_SYS_SERVICEMAP.CLASS,              (TM_SYS_DIC.VALUE + '.' + TM_SYS_SERVICEMAP.CLASS) as CLASSFULL,              TM_SYS_SERVICEMAP.ASSEMBLY,              TM_SYS_SERVER.URL              from TM_SYS_SERVICEMAP              inner join TM_SYS_DIC on TM_SYS_SERVICEMAP.NAMESPACE = TM_SYS_DIC.ID              inner join TM_SYS_SERVER on (TM_SYS_SERVICEMAP.DB_NAME = TM_SYS_SERVER.NAME) and (TM_SYS_SERVER.HOSPITAL_ID = '_SYSTEM_')              where TM_SYS_SERVICEMAP.HOSPITAL_ID = '_SYSTEM_' AND TM_SYS_SERVICEMAP.TYPE = 'S'  AND ACTIVE = '1'              order by URL]
2019-09-20 10:58:20,307 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = '_SYSTEM_'               AND                   TM_SYS_SCREEN.PAGE = 'LOGIN'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2019-09-20 10:58:20,525 [1] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = '_SYSTEM_'               AND                   TM_SYS_CACHE.ACTIVE = '1']
2019-09-20 10:58:28,775 [1] DEBUG - Statement Id: [DAO00001_DBList] PreparedStatement : [select *              from TM_SYS_SERVER              where HOSPITAL_ID = 'HLU01' and TYPE = 'D']
2019-09-20 10:58:28,849 [1] DEBUG - Statement Id: [DAO00001_DaoList] PreparedStatement : [select              TM_SYS_SERVICEMAP.ID,              TM_SYS_SERVICEMAP.HOSPITAL_ID,              TM_SYS_SERVICEMAP.DB_NAME,              TM_SYS_SERVICEMAP.TYPE,              TM_SYS_SERVICEMAP.NAME,              TM_SYS_SERVICEMAP.CLASS,              (TM_SYS_DIC.VALUE + '.' + TM_SYS_SERVICEMAP.CLASS) as CLASSFULL,              TM_SYS_SERVICEMAP.ASSEMBLY              from TM_SYS_SERVICEMAP              inner join TM_SYS_DIC              on TM_SYS_SERVICEMAP.NAMESPACE = TM_SYS_DIC.ID              where HOSPITAL_ID = 'HLU01' AND TYPE = 'D' AND ACTIVE = '1'              order by DB_NAME]
2019-09-20 10:58:30,323 [1] DEBUG - Statement Id: [DAO00001_ServiceList] PreparedStatement : [select              TM_SYS_SERVICEMAP.ID,              TM_SYS_SERVICEMAP.HOSPITAL_ID,              TM_SYS_SERVICEMAP.DB_NAME,              TM_SYS_SERVICEMAP.TYPE,              TM_SYS_SERVICEMAP.NAME,              TM_SYS_SERVICEMAP.CLASS,              (TM_SYS_DIC.VALUE + '.' + TM_SYS_SERVICEMAP.CLASS) as CLASSFULL,              TM_SYS_SERVICEMAP.ASSEMBLY,              TM_SYS_SERVER.URL              from TM_SYS_SERVICEMAP              inner join TM_SYS_DIC on TM_SYS_SERVICEMAP.NAMESPACE = TM_SYS_DIC.ID              inner join TM_SYS_SERVER on (TM_SYS_SERVICEMAP.DB_NAME = TM_SYS_SERVER.NAME) and (TM_SYS_SERVER.HOSPITAL_ID = 'HLU01')              where TM_SYS_SERVICEMAP.HOSPITAL_ID = 'HLU01' AND TM_SYS_SERVICEMAP.TYPE = 'S'  AND ACTIVE = '1'              order by URL]
2019-09-20 10:58:30,494 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1']
2019-09-20 10:58:31,632 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM005']
2019-09-20 10:58:32,264 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM015']
2019-09-20 10:58:32,344 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM067']
2019-09-20 10:58:32,425 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM008']
2019-09-20 10:58:32,515 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM068']
2019-09-20 10:58:32,619 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM006']
2019-09-20 10:58:32,717 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM030']
2019-09-20 10:58:32,827 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM025']
2019-09-20 10:58:32,926 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM024']
2019-09-20 10:58:33,475 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM033']
2019-09-20 10:58:33,532 [5] DEBUG - Statement Id: [DAO00027_GetListDuocKyGuiTonKho] PreparedStatement : [select  distinct TT_TONKHO.DUOC_KEY, LTRIM(TT_TONKHO.KHODUOC_ID) as KHODUOC_ID, TM_DUOC.DUOC_ID, TM_LOAIDUOC.MALOAIDUOC,TM_DUOC.SOVISA,TM_DUOC.TYLE_VAT,TM_DUOC.COTOA,        TM_DUOC.MADUOC, TM_DUOC.TENHANG, TM_DUOC.TENDUOCDAYDU, dvt.TENDONVITINH as DONVITINH,  TM_DUOC.DONVITINH_ID,TM_DUOC.BHYT,TM_DUOC.PHAMVI,        TM_DUOC.TENHOATCHAT, TM_DUOC.HAMLUONG, TM_DUOC.HANGSANXUAT, TM_DUOC.QUOCGIA, TM_DUOC.LOAIDUOC_ID, TM_DUOC.DUONGDUNG_ID,        TM_TENDUOC.TENDUOC, TM_TENDUOC.TENDUOC_EN, TM_TENDUOC.MAQUOCTE, TM_TENDUOC.MAQUOCTEBT,        TM_LOAIDUOC.LOAIVATTU_ID, TM_DUOC.BENHVIEN_ID,TT_TONKHO.SOLUONG, TT_TONKHO.NGUONDUOC_ID, NH.TENNGUONDUOC        , TAMNGUNG = CASE WHEN TM_DUOC.TAMNGUNG = '1' OR nh.TAMNGUNG = '1' OR KD.TAMNGUNG = '1' THEN '1' ELSE '0' END        , TM_DUOC.DANGTRINHBAY        from TM_DUOC        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = TM_DUOC.DONVITINH_ID        left join TM_TENDUOC on TM_DUOC.TENDUOC_ID = TM_TENDUOC.TENDUOC_ID and TM_DUOC.BENHVIEN_ID = 'HLU01' and TM_DUOC.TAMNGUNG = '0'        left join TM_LOAIDUOC on TM_LOAIDUOC.LOAIDUOC_ID = TM_DUOC.LOAIDUOC_ID and TM_LOAIDUOC.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG on (TM_LOAIDUOC.LOAIVATTU_ID = TM_DUOC_HANDUNG.LOAIDUOC and TM_DUOC_HANDUNG.BENHVIEN_ID = 'HLU01')        inner join        (select LTRIM(A.KHODUOC_ID) + '_' + LTRIM(A.DUOC_ID) + '_' + LTRIM(ISNULL(A.NGUONDUOC_ID,'')) as DUOC_KEY, A.KHODUOC_ID, A.DUOC_ID,A.NGUONDUOC_ID,        SUM(isnull(A.SOLUONG,0)) as SOLUONG        from        (select SUM(SOLUONG) as SOLUONG, KHODUOC_ID, DUOC_ID, NGUONDUOC_ID from TT_DUOC_KYGUI_TONKHO        where BENHVIEN_ID = 'HLU01' group by KHODUOC_ID, DUOC_ID, NGUONDUOC_ID) A        group by LTRIM(A.KHODUOC_ID) + '_' + LTRIM(A.DUOC_ID) + '_' + LTRIM(A.NGUONDUOC_ID), A.KHODUOC_ID, A.DUOC_ID, A.NGUONDUOC_ID)        TT_TONKHO on TT_TONKHO.DUOC_ID = TM_DUOC.DUOC_ID        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = TT_TONKHO.NGUONDUOC_ID and nh.BENHVIEN_ID = 'HLU01'        LEFT JOIN TM_KHODUOC KD ON KD.KHODUOC_ID = TT_TONKHO.KHODUOC_ID        where TM_DUOC.BENHVIEN_ID = 'HLU01' AND TT_TONKHO.SOLUONG >= 0]
2019-09-20 10:58:33,673 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM018']
2019-09-20 10:58:33,734 [5] DEBUG - Statement Id: [DAO00027_GetListDuocTonKho] PreparedStatement : [select distinct TT_TONKHO.DUOC_KEY, LTRIM(TT_TONKHO.KHODUOC_ID) as KHODUOC_ID, TM_DUOC.DUOC_ID, TM_LOAIDUOC.MALOAIDUOC,TM_DUOC.SOVISA,TM_DUOC.TYLE_VAT,TM_DUOC.COTOA,        TM_DUOC.MADUOC, TM_DUOC.TENHANG, TM_DUOC.TENDUOCDAYDU, dvt.TENDONVITINH as DONVITINH,  TM_DUOC.DONVITINH_ID,TM_DUOC.BHYT,                TM_DUOC.TENHOATCHAT,          TM_DUOC.HAMLUONG, TM_DUOC.HANGSANXUAT, TM_DUOC.QUOCGIA, TM_DUOC.LOAIDUOC_ID, TM_DUOC.DUONGDUNG_ID,        TM_TENDUOC.TENDUOC, TM_TENDUOC.TENDUOC_EN, TM_TENDUOC.MAQUOCTE, TM_TENDUOC.MAQUOCTEBT,        TM_LOAIDUOC.LOAIVATTU_ID, TM_DUOC.BENHVIEN_ID,        TT_TONKHO.SOLUONG, TM_DUOC.VTYT_PHANLOAI, TM_DUOC.PHAMVI, TT_TONKHO.NGUONDUOC_ID, NG.TENNGUONDUOC AS TENNGUONDUOC        , TAMNGUNG = CASE WHEN TM_DUOC.TAMNGUNG = '1' OR NG.TAMNGUNG = '1' OR KD.TAMNGUNG = '1' THEN '1' ELSE '0' END        , TM_DUOC.DANGTRINHBAY        from TM_DUOC        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = TM_DUOC.DONVITINH_ID        left join TM_TENDUOC on TM_DUOC.TENDUOC_ID = TM_TENDUOC.TENDUOC_ID and TM_DUOC.BENHVIEN_ID = 'HLU01' and TM_DUOC.TAMNGUNG = '0'        left join TM_LOAIDUOC on TM_LOAIDUOC.LOAIDUOC_ID = TM_DUOC.LOAIDUOC_ID and TM_LOAIDUOC.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG on (TM_LOAIDUOC.LOAIVATTU_ID = TM_DUOC_HANDUNG.LOAIDUOC and TM_DUOC_HANDUNG.BENHVIEN_ID = 'HLU01')        inner join        (select LTRIM(A.KHODUOC_ID) + '_' + LTRIM(A.DUOC_ID) + '_' + LTRIM(ISNULL(A.NGUONDUOC_ID,'')) as DUOC_KEY, A.KHODUOC_ID, A.DUOC_ID, A.NGUONDUOC_ID,        SUM(isnull(A.SOLUONG,0)) as SOLUONG        from        (select SUM(SOLUONG) as SOLUONG, KHODUOC_ID, DUOC_ID, NGUONDUOC_ID from TT_DUOC_TONKHO        where BENHVIEN_ID = 'HLU01' group by KHODUOC_ID, DUOC_ID, NGUONDUOC_ID) A        group by LTRIM(A.KHODUOC_ID) + '_' + LTRIM(A.DUOC_ID) + '_' + LTRIM(ISNULL(A.NGUONDUOC_ID,'')), A.KHODUOC_ID, A.DUOC_ID, NGUONDUOC_ID        ) TT_TONKHO on TT_TONKHO.DUOC_ID = TM_DUOC.DUOC_ID        LEFT JOIN TM_NGUONHANG NG ON NG.NGUONDUOC_ID = TT_TONKHO.NGUONDUOC_ID        LEFT JOIN TM_KHODUOC KD ON KD.KHODUOC_ID = TT_TONKHO.KHODUOC_ID        where TM_DUOC.BENHVIEN_ID = 'HLU01' and TT_TONKHO.SOLUONG >= 0]
2019-09-20 10:58:35,486 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM023']
2019-09-20 10:58:35,520 [5] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoVaBooking] PreparedStatement : [declare @NGUONDUOC_MACDINH varchar(5) = '0';        declare @TOAMUANGOAI int = 0;        select @NGUONDUOC_MACDINH = isnull(VALUE,0) from TM_SYS_APPSETTINGS where CODE = 'PHA_NGUONDUOC'        select @TOAMUANGOAI = isnull(VALUE,0) from TM_SYS_APPSETTINGS where CODE = 'OPD_TOAMUANGOAI_DUNGDANHMUC_DUOC'                if @TOAMUANGOAI = 1        begin        select  distinct '0' + '_' + LTRIM(d.DUOC_ID) + '_' + @NGUONDUOC_MACDINH as DUOC_KEY, 0 as PHAMVI_ID, @NGUONDUOC_MACDINH as NGUONDUOC_ID, null as TENNGUONDUOC, null as TINHTIEN, d.DUOC_ID, ld.MALOAIDUOC,        d.SOVISA,d.TYLE_VAT,d.COTOA, d.MADUOC, d.TENHANG, d.TENDUOCDAYDU, d.DONVITINH as DONVITINH, d.BHYT,        d.TENHOATCHAT, d.HAMLUONG, d.HANGSANXUAT, d.QUOCGIA, d.LOAIDUOC_ID, d.DUONGDUNG_ID, d.TINHTIEN_PTTT,        ten.TENDUOC, ten.TENDUOC_EN, ten.MAQUOCTE, ten.MAQUOCTEBT,        '' as BHYT_TEXT        , ld.LOAIVATTU_ID        , d.BENHVIEN_ID,        999999999 as SOLUONG, d.VTYT_PHANLOAI, d.PHAMVI, d.SUASOLUONGTONGHOP, d.MADUOCBV, d.DANGTRINHBAY        , TAMNGUNG = CASE WHEN d.TAMNGUNG = '1' THEN '1' ELSE '0' END        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        union all        select  distinct tk.DUOC_KEY, LTRIM(tk.PHAMVI_ID) as PHAMVI_ID, tk.NGUONDUOC_ID, nh.TENNGUONDUOC, nh.TINHTIEN, d.DUOC_ID, ld.MALOAIDUOC,        d.SOVISA,d.TYLE_VAT,d.COTOA, d.MADUOC, d.TENHANG, d.TENDUOCDAYDU, d.DONVITINH as DONVITINH, d.BHYT,        d.TENHOATCHAT, d.HAMLUONG, d.HANGSANXUAT, d.QUOCGIA, d.LOAIDUOC_ID, d.DUONGDUNG_ID, d.TINHTIEN_PTTT,        ten.TENDUOC, ten.TENDUOC_EN, ten.MAQUOCTE, ten.MAQUOCTEBT,        CASE WHEN d.BHYT = '1' THEN 'BHYT' ELSE '' END as BHYT_TEXT        , ld.LOAIVATTU_ID        , d.BENHVIEN_ID,        tk.SOLUONG, d.VTYT_PHANLOAI, d.PHAMVI, d.SUASOLUONGTONGHOP, d.MADUOCBV, d.DANGTRINHBAY        , TAMNGUNG = CASE WHEN d.TAMNGUNG = '1' OR nh.TAMNGUNG = '1' OR kd.TAMNGUNG = '1' THEN '1' ELSE '0' END        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        inner join        (        select  LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')) DUOC_KEY, (SUM(dtk.SOLUONG) - isnull(sum(A.SOLUONG),0) - isnull(sum(B.SOLUONG),0)) SOLUONG, pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        from (select sum(soluong) soluong,duoc_id,nguonduoc_id,khoduoc_id,benhvien_id from TT_DUOC_TONKHO  group by duoc_id,nguonduoc_id,khoduoc_id,benhvien_id) dtk        inner join TM_DUOC_PHAMVISD_MAPPING pvsd on dtk.KHODUOC_ID = pvsd.KHODUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NOITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) B on B.DUOC_ID = dtk.DUOC_ID and B.SOLUONG > 0 and B.PHAMVI_ID = pvsd.PHAMVI_ID and B.NGUONHANG_ID = dtk.NGUONDUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NGOAITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) A on A.DUOC_ID = dtk.DUOC_ID and A.SOLUONG > 0 and A.PHAMVI_ID = pvsd.PHAMVI_ID and A.NGUONHANG_ID = dtk.NGUONDUOC_ID        where dtk.SOLUONG > 0 and dtk.BENHVIEN_ID = 'HLU01'        group by LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')), pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        ) tk on tk.DUOC_ID = d.DUOC_ID        left join TM_DUOC_PHAMVISUDUNG kd on kd.PHAMVI_ID = tk.PHAMVI_ID and kd.BENHVIEN_ID = 'HLU01'        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = tk.NGUONDUOC_ID and nh.BENHVIEN_ID = 'HLU01'        where d.BENHVIEN_ID = 'HLU01'  and tk.SOLUONG >= 0        end        else        begin                  select  distinct tk.DUOC_KEY, LTRIM(tk.PHAMVI_ID) as PHAMVI_ID, tk.NGUONDUOC_ID, nh.TENNGUONDUOC, nh.TINHTIEN, d.DUOC_ID, ld.MALOAIDUOC,        d.SOVISA,d.TYLE_VAT,d.COTOA, d.MADUOC, d.TENHANG, d.TENDUOCDAYDU, d.DONVITINH as DONVITINH, d.BHYT,        d.TENHOATCHAT, d.HAMLUONG, d.HANGSANXUAT, d.QUOCGIA, d.LOAIDUOC_ID, d.DUONGDUNG_ID, d.TINHTIEN_PTTT,        ten.TENDUOC, ten.TENDUOC_EN, ten.MAQUOCTE, ten.MAQUOCTEBT,        CASE WHEN d.BHYT = '1' THEN 'BHYT' ELSE '' END as BHYT_TEXT        , ld.LOAIVATTU_ID        , d.BENHVIEN_ID,        tk.SOLUONG, d.VTYT_PHANLOAI, d.PHAMVI, d.SUASOLUONGTONGHOP, d.MADUOCBV, d.DANGTRINHBAY        , TAMNGUNG = CASE WHEN d.TAMNGUNG = '1' OR nh.TAMNGUNG = '1' OR kd.TAMNGUNG = '1' THEN '1' ELSE '0' END        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        inner join        (        select  LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')) DUOC_KEY, (SUM(dtk.SOLUONG) - isnull(sum(A.SOLUONG),0) - isnull(sum(B.SOLUONG),0)) SOLUONG, pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        from (select sum(soluong) soluong,duoc_id,nguonduoc_id,khoduoc_id,benhvien_id from TT_DUOC_TONKHO  group by duoc_id,nguonduoc_id,khoduoc_id,benhvien_id) dtk        inner join TM_DUOC_PHAMVISD_MAPPING pvsd on dtk.KHODUOC_ID = pvsd.KHODUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NOITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) B on B.DUOC_ID = dtk.DUOC_ID and B.SOLUONG > 0 and B.PHAMVI_ID = pvsd.PHAMVI_ID and B.NGUONHANG_ID = dtk.NGUONDUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NGOAITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) A on A.DUOC_ID = dtk.DUOC_ID and A.SOLUONG > 0 and A.PHAMVI_ID = pvsd.PHAMVI_ID and A.NGUONHANG_ID = dtk.NGUONDUOC_ID        where dtk.SOLUONG > 0 and dtk.BENHVIEN_ID = 'HLU01'        group by LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')), pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        ) tk on tk.DUOC_ID = d.DUOC_ID        left join TM_DUOC_PHAMVISUDUNG kd on kd.PHAMVI_ID = tk.PHAMVI_ID and kd.BENHVIEN_ID = 'HLU01'        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = tk.NGUONDUOC_ID and nh.BENHVIEN_ID = 'HLU01'        where d.BENHVIEN_ID = 'HLU01'  and tk.SOLUONG >= 0        end]
2019-09-20 10:58:45,445 [5] DEBUG - Statement Id: [DAO00320_GetList] PreparedStatement : [select M.*            from TM_MAU M            LEFT JOIN TM_MAU_DONVITINH DVT on M.DONVITINH_ID=DVT.DONVITINH_ID            where            M.TAMNGUNG = '0'            and M.BENHVIEN_ID = 'HLU01'            order by M.TENMAU]
2019-09-20 10:58:45,529 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM071']
2019-09-20 10:58:45,586 [5] DEBUG - Statement Id: [DAO00322_GetListMauTonKhoForCreateCached] PreparedStatement : [SELECT DISTINCT          TK.MAU_KEY, TK.KHOMAU_ID, M.MAU_ID, M.MAMAU, M.TENMAU, M.NHOM_ABO, M.NHOM_RH, M.LOAIMAU_ID,          TK.SOLONHAP_ID, SLN.SOLONHAP, SLN.SOKIEMSOAT, TK.NGUONHANG_ID, NG.TENNGUONMAU, M.BENHVIEN_ID, M.DONVITINH_ID,          SUM(tk.SOLUONG) AS SOLUONG,K.TENKHO,DVT.TENDONVITINH          FROM TT_MAU_TONKHO TK          JOIN TM_KHO K ON TK.KHOMAU_ID = K.KHO_ID          JOIN TT_MAU_CHUNGTU_SOLONHAP SLN ON TK.SOLONHAP_ID = SLN.SOLONHAP_ID          JOIN TM_MAU M on TK.MAU_ID = M.MAU_ID and M.TAMNGUNG = '0'          LEFT JOIN TM_MAU_DONVITINH DVT on M.DONVITINH_ID=DVT.DONVITINH_ID          LEFT JOIN TM_NGUONMAU NG ON NG.NGUONMAU_ID = TK.NGUONHANG_ID          WHERE TK.SOLUONG > 0          GROUP BY TK.MAU_KEY, TK.KHOMAU_ID, M.MAU_ID, M.MAMAU, M.TENMAU, M.NHOM_ABO, M.NHOM_RH, M.LOAIMAU_ID,          TK.SOLONHAP_ID, SLN.SOLONHAP, SLN.SOKIEMSOAT,TK.NGUONHANG_ID, NG.TENNGUONMAU, M.BENHVIEN_ID, M.DONVITINH_ID,K.TENKHO,DVT.TENDONVITINH]
2019-09-20 10:58:45,680 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM073']
2019-09-20 10:58:45,743 [5] DEBUG - Statement Id: [DAO00322_GetListMauTonKhoTruBooking] PreparedStatement : [select distinct          TK.MAU_KEY, TK.KHOMAU_ID, M.MAU_ID, M.MAMAU, M.TENMAU, M.NHOM_ABO, M.NHOM_RH, M.LOAIMAU_ID, M.DONVITINH_ID,          TK.SOLONHAP_ID, TK.SOLONHAP, TK.SOKIEMSOAT,M.PHAMVI, TK.NGUONHANG_ID, NG.TENNGUONMAU, M.BENHVIEN_ID,          TK.SOLUONG,TK.TENKHO,DVT.TENDONVITINH          from TM_MAU M          JOIN          (          select          A.MAU_KEY, A.KHOMAU_ID, A.MAU_ID ,a.NGUONHANG_ID, A.SOLONHAP_ID, A.SOLONHAP, A.SOKIEMSOAT, A.SOLUONG,A.TENKHO          from          (          select KHOMAU_ID, TK.MAU_ID, TK.NGUONHANG_ID, TK.MAU_KEY, SLN.SOLONHAP_ID, SLN.SOLONHAP, SLN.SOKIEMSOAT, ISNULL(TK.SOLUONG,0) - ISNULL(book.SOLUONG,0) as SOLUONG,K.TENKHO          from TT_MAU_TONKHO TK          JOIN TM_KHO K ON TK.KHOMAU_ID = K.KHO_ID          inner join TT_MAU_CHUNGTU_SOLONHAP SLN ON TK.SOLONHAP_ID = SLN.SOLONHAP_ID          left join dbo.TT_MAU_TONKHO_BOOK book ON book.MAU_KEY = TK.MAU_KEY AND book.TRANGTHAI = 'HIEULUC'          where ISNULL(TK.SOLUONG,0) - ISNULL(book.SOLUONG,0) > 0          ) A          )TK on TK.MAU_ID = M.MAU_ID and M.TAMNGUNG = '0'          LEFT JOIN TM_MAU_DONVITINH DVT on M.DONVITINH_ID=DVT.DONVITINH_ID          LEFT JOIN TM_NGUONMAU NG ON NG.NGUONMAU_ID = TK.NGUONHANG_ID]
2019-09-20 10:58:45,819 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM072']
2019-09-20 10:58:46,782 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'MAIN'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2019-09-20 10:58:47,638 [1] DEBUG - Statement Id: [DAO00002_FormList] PreparedStatement : [select              TM_SYS_FORM.HOSPITAL_ID,              TM_SYS_FORM.NAME,              TM_SYS_FORM.CLASS,              TM_SYS_FORM.ASSEMBLY,              TM_SYS_FORM.TITLE_VI as TITLE              from TM_SYS_FORM              where HOSPITAL_ID = 'HLU01']
2019-09-20 10:58:52,779 [1] DEBUG - Statement Id: [DAO00300_GetShortcutListByUserID] PreparedStatement : [SELECT S.SHORTCUT_CODE, S.SHORTCUT_VALUE              FROM TM_SHORTCUT AS S              WHERE S.BENHVIEN_ID = 'HLU01' AND S.USER_ID = '1' AND TAMNGUNG = '0']
2019-09-20 10:58:52,817 [1] DEBUG - Statement Id: [DAO00087_GetList] PreparedStatement : [select CODE, VALUE, BENHVIEN_ID              from TM_SYS_APPSETTINGS              where LOCKED = '0' and BENHVIEN_ID = 'HLU01'              order by SETTING_ID]
2019-09-20 10:58:52,897 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'MSG01'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2019-09-20 10:58:53,036 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'MSG02'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2019-09-20 10:58:53,195 [1] DEBUG - Statement Id: [DAO00008_GetUserSettings] PreparedStatement : [select A.*, B.TENKHO , C.TENPHONGBAN, B.MAKHO, C.MAPHONGBAN          from TM_SYS_USERS A          left join TM_KHODUOC B on B.KHODUOC_ID = A.INVENTORY_ID          left join TM_PHONGBAN C on (C.PHONGBAN_ID = A.WORKING_DEPT_ID and C.BENHVIEN_ID =  @param0 )          left join TM_SYS_USERKHO D on (D.ACCOUNT_ID = A.ACCOUNT_ID and D.HOSPITAL_ID =  @param0 )          where          A.HOSPITAL_ID =  @param0            and                 A.ACCOUNT_ID =  @param1]
2019-09-20 10:58:53,197 [1] DEBUG - Statement Id: [DAO00008_GetUserSettings] Parameters: [@param0=[HOSPITAL_ID,HLU01], @param1=[ACCOUNT_ID,113]]
2019-09-20 10:58:53,197 [1] DEBUG - Statement Id: [DAO00008_GetUserSettings] Types: [@param0=[String, System.String], @param1=[String, System.String]]
2019-09-20 10:58:53,233 [1] DEBUG - Statement Id: [DAO00008_GetUserInvSettings] PreparedStatement : [select A.*, B.TENKHO, B.MAKHO, B.LOAIKHO_ID, B.KHOQUANLY_ID          from TM_SYS_USERKHO A          left join TM_KHO B on B.MODULE_ID = A.MODULE_ID and B.KHO_ID = A.KHO_ID          where A.HOSPITAL_ID =  @param0  and A.ACCOUNT_ID =  @param1           order by B.TENKHO]
2019-09-20 10:58:53,233 [1] DEBUG - Statement Id: [DAO00008_GetUserInvSettings] Parameters: [@param0=[HOSPITAL_ID,HLU01], @param1=[ACCOUNT_ID,113]]
2019-09-20 10:58:53,233 [1] DEBUG - Statement Id: [DAO00008_GetUserInvSettings] Types: [@param0=[String, System.String], @param1=[String, System.String]]
2019-09-20 10:58:53,381 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'COM30'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2019-09-20 10:58:53,532 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'RIS04'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2019-09-20 10:59:01,632 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'MENU1'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2019-09-20 10:59:01,733 [1] DEBUG - Statement Id: [DAO00011_GetList] PreparedStatement : [select              TM_SYS_MENU.ID,              TM_SYS_MENU.PARENTID,              TM_SYS_MENU.SCREEN,              TM_SYS_MENU.SMALLIMAGE,              TM_SYS_MENU.LARGEIMAGE,              TM_SYS_MENU.DESCRIPTION,              TM_SYS_MENU.TYPE,              TM_SYS_MENU.TITLE_VI as TITLE              from TM_SYS_MENU              where TM_SYS_MENU.HOSPITAL_ID = 'HLU01' and TM_SYS_MENU.ACTIVE = '1'               AND                   (TM_SYS_MENU.TYPE & '8' = '8')                             order by TM_SYS_MENU.ORDERNUM]
2019-09-20 10:59:02,016 [1] DEBUG - Statement Id: [DAO00011_usermenu_list] PreparedStatement : [select              TM_SYS_HOMEMENU.MENUID as ID,              TM_SYS_MENU.TITLE_VI as TITLE,              TM_SYS_MENU.SCREEN,              TM_SYS_MENU.SMALLIMAGE,              TM_SYS_MENU.LARGEIMAGE,              TM_SYS_MENU.TYPE              from TM_SYS_HOMEMENU              left join TM_SYS_MENU on TM_SYS_MENU.ID = TM_SYS_HOMEMENU.MENUID and TM_SYS_MENU.HOSPITAL_ID = TM_SYS_HOMEMENU.HOSPITAL_ID              where TM_SYS_HOMEMENU.HOSPITAL_ID = 'HLU01' and TM_SYS_HOMEMENU.USERID = '113' and TM_SYS_MENU.ACTIVE = '1'               AND                   (TM_SYS_MENU.TYPE & '8' = '8')                             ORDER BY TM_SYS_HOMEMENU.ORDERNUM]
2019-09-20 11:01:42,889 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'COM31'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2019-09-20 11:01:43,037 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'ORM28'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2019-09-20 11:01:47,857 [1] DEBUG - Statement Id: [DAO00066_GetBENHAN_TIEPNHAN] PreparedStatement : [select top 1 *        from TT_NOITRU_BENHAN        where TIEPNHAN_ID = '27022'  and BENHVIEN_ID = 'HLU01'        order by NGAYTAO desc]
2019-09-20 11:01:48,302 [1] DEBUG - Statement Id: [DAO00014_GetInPatientStatus] PreparedStatement : [select TRANGTHAI, isnull(KHOACHUYENDEN_ID, KHOAVAO_ID) as KHOAHIENTAI from TT_NOITRU_BENHAN        where        TIEPNHAN_ID = '27022'        and BENHVIEN_ID = 'HLU01'         and           BENHAN_ID = '5800']
2019-09-20 11:01:48,408 [1] DEBUG - Statement Id: [DAO00048_TT_PHAUTHUAT_GetList] PreparedStatement : [select *              from TT_PHAUTHUAT               where                             TT_PHAUTHUAT.LOAI = 'P'                       and                           TT_PHAUTHUAT.TIEPNHAN_ID = 27022                       and                           TT_PHAUTHUAT.BENHVIEN_ID = 'HLU01'                                     order by PHAUTHUAT_ID DESC]
2019-09-20 11:01:48,534 [1] DEBUG - Statement Id: [DAO00048_GetListLoaiGacTrongPTTT] PreparedStatement : [select DICTIONARY_ID, DICTIONARY_CODE, DICTIONARY_NAME          from LST_DICTIONARY          where DICTIONARY_TYPE_CODE = 'LoaiGacPTTT'          and ENABLED = '1']
2019-09-20 11:01:49,668 [1] DEBUG - Statement Id: [DAO00048_GetDSLoaiGacDaGhiNhan] PreparedStatement : [select A.KIEMSOATGAC_ID, A.BENHNHAN_ID, A.TIEPNHAN_ID, A.BENHAN_ID, A.PHAUTHUAT_ID, A.LOAIPT_TT, A.LOAIGAC_ID          , A.NGAYGHINHAN, A.THOIGIANGHINHAN, A.SOLUONG, A.SOLUONGDASUDUNG, A.SOLUONGCONLAI, A.GHICHU, A.NGUOINHANDUNGCU_ID          , B.DICTIONARY_CODE AS MALOAIGAC, B.DICTIONARY_NAME AS TENLOAIGAC          from TT_PHAUTHUAT_GHINHANGAC A          inner join LST_DICTIONARY B on B.DICTIONARY_ID = A.LOAIGAC_ID          where A.PHAUTHUAT_ID = 3742 and A.BENHVIEN_ID = 'HLU01']
2019-09-20 11:01:49,720 [1] DEBUG - Statement Id: [DAO00048_GetDSLoaiGacDaGhiNhan] PreparedStatement : [select A.KIEMSOATGAC_ID, A.BENHNHAN_ID, A.TIEPNHAN_ID, A.BENHAN_ID, A.PHAUTHUAT_ID, A.LOAIPT_TT, A.LOAIGAC_ID          , A.NGAYGHINHAN, A.THOIGIANGHINHAN, A.SOLUONG, A.SOLUONGDASUDUNG, A.SOLUONGCONLAI, A.GHICHU, A.NGUOINHANDUNGCU_ID          , B.DICTIONARY_CODE AS MALOAIGAC, B.DICTIONARY_NAME AS TENLOAIGAC          from TT_PHAUTHUAT_GHINHANGAC A          inner join LST_DICTIONARY B on B.DICTIONARY_ID = A.LOAIGAC_ID          where A.PHAUTHUAT_ID = 3742 and A.BENHVIEN_ID = 'HLU01']
2019-09-20 11:02:12,987 [1] DEBUG - Statement Id: [DAO00048_TT_PHAUTHUAT_GHINHANGAC_Add] PreparedStatement : [insert into TT_PHAUTHUAT_GHINHANGAC (          BENHNHAN_ID          , TIEPNHAN_ID          , BENHAN_ID          , PHAUTHUAT_ID          , LOAIPT_TT          , LOAIGAC_ID          , NGAYGHINHAN          , THOIGIANGHINHAN          , SOLUONG          , SOLUONGDASUDUNG          , SOLUONGCONLAI          , GHICHU          , NGUOINHANDUNGCU_ID          , BENHVIEN_ID          , NGUOITAO          , NGAYTAO            ) values (           @param0           ,  @param1           ,  @param2           ,  @param3           ,  @param4           ,  @param5           ,  @param6           ,  @param7           ,  @param8           ,  @param9           ,  @param10           ,  @param11           ,  @param12           ,  @param13           ,  @param14           ,  @param15           )          SELECT SCOPE_IDENTITY()]
2019-09-20 11:02:12,987 [1] DEBUG - Statement Id: [DAO00048_TT_PHAUTHUAT_GHINHANGAC_Add] Parameters: [@param0=[BENHNHAN_ID,23075], @param1=[TIEPNHAN_ID,27022], @param2=[BENHAN_ID,5800], @param3=[PHAUTHUAT_ID,3742], @param4=[LOAIPT_TT,P], @param5=[LOAIGAC_ID,11713], @param6=[NGAYGHINHAN,9/20/2019 12:00:00 AM], @param7=[THOIGIANGHINHAN,9/20/2019 11:02:12 AM], @param8=[SOLUONG,10], @param9=[SOLUONGDASUDUNG,8], @param10=[SOLUONGCONLAI,2], @param11=[GHICHU,test], @param12=[NGUOINHANDUNGCU_ID,35], @param13=[BENHVIEN_ID,HLU01], @param14=[NGUOITAO,null], @param15=[NGAYTAO,9/20/2019 11:02:12 AM]]
2019-09-20 11:02:12,987 [1] DEBUG - Statement Id: [DAO00048_TT_PHAUTHUAT_GHINHANGAC_Add] Types: [@param0=[Int64, System.Int64], @param1=[Int64, System.Int64], @param2=[Int64, System.Int64], @param3=[Int64, System.Int64], @param4=[String, System.String], @param5=[Int64, System.Int64], @param6=[DateTime, System.DateTime], @param7=[DateTime, System.DateTime], @param8=[Double, System.Double], @param9=[Double, System.Double], @param10=[Double, System.Double], @param11=[String, System.String], @param12=[Int64, System.Int64], @param13=[String, System.String], @param14=[System.DBNull, null], @param15=[DateTime, System.DateTime]]
2019-09-20 11:02:13,093 [1] DEBUG - Statement Id: [DAO00048_TT_PHAUTHUAT_GHINHANGAC_Add] PreparedStatement : [insert into TT_PHAUTHUAT_GHINHANGAC (          BENHNHAN_ID          , TIEPNHAN_ID          , BENHAN_ID          , PHAUTHUAT_ID          , LOAIPT_TT          , LOAIGAC_ID          , NGAYGHINHAN          , THOIGIANGHINHAN          , SOLUONG          , SOLUONGDASUDUNG          , SOLUONGCONLAI          , GHICHU          , NGUOINHANDUNGCU_ID          , BENHVIEN_ID          , NGUOITAO          , NGAYTAO            ) values (           @param0           ,  @param1           ,  @param2           ,  @param3           ,  @param4           ,  @param5           ,  @param6           ,  @param7           ,  @param8           ,  @param9           ,  @param10           ,  @param11           ,  @param12           ,  @param13           ,  @param14           ,  @param15           )          SELECT SCOPE_IDENTITY()]
2019-09-20 11:02:13,094 [1] DEBUG - Statement Id: [DAO00048_TT_PHAUTHUAT_GHINHANGAC_Add] Parameters: [@param0=[BENHNHAN_ID,23075], @param1=[TIEPNHAN_ID,27022], @param2=[BENHAN_ID,5800], @param3=[PHAUTHUAT_ID,3742], @param4=[LOAIPT_TT,P], @param5=[LOAIGAC_ID,11714], @param6=[NGAYGHINHAN,9/20/2019 12:00:00 AM], @param7=[THOIGIANGHINHAN,9/20/2019 11:02:13 AM], @param8=[SOLUONG,10], @param9=[SOLUONGDASUDUNG,5], @param10=[SOLUONGCONLAI,5], @param11=[GHICHU,sdfsdf], @param12=[NGUOINHANDUNGCU_ID,35], @param13=[BENHVIEN_ID,HLU01], @param14=[NGUOITAO,null], @param15=[NGAYTAO,9/20/2019 11:02:13 AM]]
2019-09-20 11:02:13,094 [1] DEBUG - Statement Id: [DAO00048_TT_PHAUTHUAT_GHINHANGAC_Add] Types: [@param0=[Int64, System.Int64], @param1=[Int64, System.Int64], @param2=[Int64, System.Int64], @param3=[Int64, System.Int64], @param4=[String, System.String], @param5=[Int64, System.Int64], @param6=[DateTime, System.DateTime], @param7=[DateTime, System.DateTime], @param8=[Double, System.Double], @param9=[Double, System.Double], @param10=[Double, System.Double], @param11=[String, System.String], @param12=[Int64, System.Int64], @param13=[String, System.String], @param14=[System.DBNull, null], @param15=[DateTime, System.DateTime]]
2019-09-20 11:02:13,174 [1] DEBUG - Statement Id: [DAO00048_GetDSLoaiGacDaGhiNhan] PreparedStatement : [select A.KIEMSOATGAC_ID, A.BENHNHAN_ID, A.TIEPNHAN_ID, A.BENHAN_ID, A.PHAUTHUAT_ID, A.LOAIPT_TT, A.LOAIGAC_ID          , A.NGAYGHINHAN, A.THOIGIANGHINHAN, A.SOLUONG, A.SOLUONGDASUDUNG, A.SOLUONGCONLAI, A.GHICHU, A.NGUOINHANDUNGCU_ID          , B.DICTIONARY_CODE AS MALOAIGAC, B.DICTIONARY_NAME AS TENLOAIGAC          from TT_PHAUTHUAT_GHINHANGAC A          inner join LST_DICTIONARY B on B.DICTIONARY_ID = A.LOAIGAC_ID          where A.PHAUTHUAT_ID = 3742 and A.BENHVIEN_ID = 'HLU01']
2019-09-20 11:02:13,525 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'COM98'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
--------------------------------------------------------------------------------
2019-09-20 11:02:43,789 [1] DEBUG - Statement Id: [DAO00001_DBList] PreparedStatement : [select *              from TM_SYS_SERVER              where HOSPITAL_ID = '_SYSTEM_' and TYPE = 'D']
2019-09-20 11:02:44,622 [1] DEBUG - Statement Id: [DAO00001_DaoList] PreparedStatement : [select              TM_SYS_SERVICEMAP.ID,              TM_SYS_SERVICEMAP.HOSPITAL_ID,              TM_SYS_SERVICEMAP.DB_NAME,              TM_SYS_SERVICEMAP.TYPE,              TM_SYS_SERVICEMAP.NAME,              TM_SYS_SERVICEMAP.CLASS,              (TM_SYS_DIC.VALUE + '.' + TM_SYS_SERVICEMAP.CLASS) as CLASSFULL,              TM_SYS_SERVICEMAP.ASSEMBLY              from TM_SYS_SERVICEMAP              inner join TM_SYS_DIC              on TM_SYS_SERVICEMAP.NAMESPACE = TM_SYS_DIC.ID              where HOSPITAL_ID = '_SYSTEM_' AND TYPE = 'D' AND ACTIVE = '1'              order by DB_NAME]
2019-09-20 11:02:44,677 [1] DEBUG - Statement Id: [DAO00001_ServiceList] PreparedStatement : [select              TM_SYS_SERVICEMAP.ID,              TM_SYS_SERVICEMAP.HOSPITAL_ID,              TM_SYS_SERVICEMAP.DB_NAME,              TM_SYS_SERVICEMAP.TYPE,              TM_SYS_SERVICEMAP.NAME,              TM_SYS_SERVICEMAP.CLASS,              (TM_SYS_DIC.VALUE + '.' + TM_SYS_SERVICEMAP.CLASS) as CLASSFULL,              TM_SYS_SERVICEMAP.ASSEMBLY,              TM_SYS_SERVER.URL              from TM_SYS_SERVICEMAP              inner join TM_SYS_DIC on TM_SYS_SERVICEMAP.NAMESPACE = TM_SYS_DIC.ID              inner join TM_SYS_SERVER on (TM_SYS_SERVICEMAP.DB_NAME = TM_SYS_SERVER.NAME) and (TM_SYS_SERVER.HOSPITAL_ID = '_SYSTEM_')              where TM_SYS_SERVICEMAP.HOSPITAL_ID = '_SYSTEM_' AND TM_SYS_SERVICEMAP.TYPE = 'S'  AND ACTIVE = '1'              order by URL]
2019-09-20 11:02:45,141 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = '_SYSTEM_'               AND                   TM_SYS_SCREEN.PAGE = 'LOGIN'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2019-09-20 11:02:46,085 [1] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = '_SYSTEM_'               AND                   TM_SYS_CACHE.ACTIVE = '1']
2019-09-20 11:04:59,848 [1] DEBUG - Statement Id: [DAO00001_DBList] PreparedStatement : [select *              from TM_SYS_SERVER              where HOSPITAL_ID = 'HLU01' and TYPE = 'D']
2019-09-20 11:04:59,880 [1] DEBUG - Statement Id: [DAO00001_DaoList] PreparedStatement : [select              TM_SYS_SERVICEMAP.ID,              TM_SYS_SERVICEMAP.HOSPITAL_ID,              TM_SYS_SERVICEMAP.DB_NAME,              TM_SYS_SERVICEMAP.TYPE,              TM_SYS_SERVICEMAP.NAME,              TM_SYS_SERVICEMAP.CLASS,              (TM_SYS_DIC.VALUE + '.' + TM_SYS_SERVICEMAP.CLASS) as CLASSFULL,              TM_SYS_SERVICEMAP.ASSEMBLY              from TM_SYS_SERVICEMAP              inner join TM_SYS_DIC              on TM_SYS_SERVICEMAP.NAMESPACE = TM_SYS_DIC.ID              where HOSPITAL_ID = 'HLU01' AND TYPE = 'D' AND ACTIVE = '1'              order by DB_NAME]
2019-09-20 11:05:01,111 [1] DEBUG - Statement Id: [DAO00001_ServiceList] PreparedStatement : [select              TM_SYS_SERVICEMAP.ID,              TM_SYS_SERVICEMAP.HOSPITAL_ID,              TM_SYS_SERVICEMAP.DB_NAME,              TM_SYS_SERVICEMAP.TYPE,              TM_SYS_SERVICEMAP.NAME,              TM_SYS_SERVICEMAP.CLASS,              (TM_SYS_DIC.VALUE + '.' + TM_SYS_SERVICEMAP.CLASS) as CLASSFULL,              TM_SYS_SERVICEMAP.ASSEMBLY,              TM_SYS_SERVER.URL              from TM_SYS_SERVICEMAP              inner join TM_SYS_DIC on TM_SYS_SERVICEMAP.NAMESPACE = TM_SYS_DIC.ID              inner join TM_SYS_SERVER on (TM_SYS_SERVICEMAP.DB_NAME = TM_SYS_SERVER.NAME) and (TM_SYS_SERVER.HOSPITAL_ID = 'HLU01')              where TM_SYS_SERVICEMAP.HOSPITAL_ID = 'HLU01' AND TM_SYS_SERVICEMAP.TYPE = 'S'  AND ACTIVE = '1'              order by URL]
2019-09-20 11:05:01,196 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1']
2019-09-20 11:05:01,987 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM005']
2019-09-20 11:05:02,111 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM015']
2019-09-20 11:05:02,184 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM067']
2019-09-20 11:05:02,256 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM008']
2019-09-20 11:05:02,337 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM068']
2019-09-20 11:05:02,410 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM006']
2019-09-20 11:05:02,480 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM030']
2019-09-20 11:05:02,590 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM025']
2019-09-20 11:05:02,661 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM024']
2019-09-20 11:05:03,150 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM033']
2019-09-20 11:05:03,187 [5] DEBUG - Statement Id: [DAO00027_GetListDuocKyGuiTonKho] PreparedStatement : [select  distinct TT_TONKHO.DUOC_KEY, LTRIM(TT_TONKHO.KHODUOC_ID) as KHODUOC_ID, TM_DUOC.DUOC_ID, TM_LOAIDUOC.MALOAIDUOC,TM_DUOC.SOVISA,TM_DUOC.TYLE_VAT,TM_DUOC.COTOA,        TM_DUOC.MADUOC, TM_DUOC.TENHANG, TM_DUOC.TENDUOCDAYDU, dvt.TENDONVITINH as DONVITINH,  TM_DUOC.DONVITINH_ID,TM_DUOC.BHYT,TM_DUOC.PHAMVI,        TM_DUOC.TENHOATCHAT, TM_DUOC.HAMLUONG, TM_DUOC.HANGSANXUAT, TM_DUOC.QUOCGIA, TM_DUOC.LOAIDUOC_ID, TM_DUOC.DUONGDUNG_ID,        TM_TENDUOC.TENDUOC, TM_TENDUOC.TENDUOC_EN, TM_TENDUOC.MAQUOCTE, TM_TENDUOC.MAQUOCTEBT,        TM_LOAIDUOC.LOAIVATTU_ID, TM_DUOC.BENHVIEN_ID,TT_TONKHO.SOLUONG, TT_TONKHO.NGUONDUOC_ID, NH.TENNGUONDUOC        , TAMNGUNG = CASE WHEN TM_DUOC.TAMNGUNG = '1' OR nh.TAMNGUNG = '1' OR KD.TAMNGUNG = '1' THEN '1' ELSE '0' END        , TM_DUOC.DANGTRINHBAY        from TM_DUOC        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = TM_DUOC.DONVITINH_ID        left join TM_TENDUOC on TM_DUOC.TENDUOC_ID = TM_TENDUOC.TENDUOC_ID and TM_DUOC.BENHVIEN_ID = 'HLU01' and TM_DUOC.TAMNGUNG = '0'        left join TM_LOAIDUOC on TM_LOAIDUOC.LOAIDUOC_ID = TM_DUOC.LOAIDUOC_ID and TM_LOAIDUOC.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG on (TM_LOAIDUOC.LOAIVATTU_ID = TM_DUOC_HANDUNG.LOAIDUOC and TM_DUOC_HANDUNG.BENHVIEN_ID = 'HLU01')        inner join        (select LTRIM(A.KHODUOC_ID) + '_' + LTRIM(A.DUOC_ID) + '_' + LTRIM(ISNULL(A.NGUONDUOC_ID,'')) as DUOC_KEY, A.KHODUOC_ID, A.DUOC_ID,A.NGUONDUOC_ID,        SUM(isnull(A.SOLUONG,0)) as SOLUONG        from        (select SUM(SOLUONG) as SOLUONG, KHODUOC_ID, DUOC_ID, NGUONDUOC_ID from TT_DUOC_KYGUI_TONKHO        where BENHVIEN_ID = 'HLU01' group by KHODUOC_ID, DUOC_ID, NGUONDUOC_ID) A        group by LTRIM(A.KHODUOC_ID) + '_' + LTRIM(A.DUOC_ID) + '_' + LTRIM(A.NGUONDUOC_ID), A.KHODUOC_ID, A.DUOC_ID, A.NGUONDUOC_ID)        TT_TONKHO on TT_TONKHO.DUOC_ID = TM_DUOC.DUOC_ID        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = TT_TONKHO.NGUONDUOC_ID and nh.BENHVIEN_ID = 'HLU01'        LEFT JOIN TM_KHODUOC KD ON KD.KHODUOC_ID = TT_TONKHO.KHODUOC_ID        where TM_DUOC.BENHVIEN_ID = 'HLU01' AND TT_TONKHO.SOLUONG >= 0]
2019-09-20 11:05:03,263 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM018']
2019-09-20 11:05:03,300 [5] DEBUG - Statement Id: [DAO00027_GetListDuocTonKho] PreparedStatement : [select distinct TT_TONKHO.DUOC_KEY, LTRIM(TT_TONKHO.KHODUOC_ID) as KHODUOC_ID, TM_DUOC.DUOC_ID, TM_LOAIDUOC.MALOAIDUOC,TM_DUOC.SOVISA,TM_DUOC.TYLE_VAT,TM_DUOC.COTOA,        TM_DUOC.MADUOC, TM_DUOC.TENHANG, TM_DUOC.TENDUOCDAYDU, dvt.TENDONVITINH as DONVITINH,  TM_DUOC.DONVITINH_ID,TM_DUOC.BHYT,                TM_DUOC.TENHOATCHAT,          TM_DUOC.HAMLUONG, TM_DUOC.HANGSANXUAT, TM_DUOC.QUOCGIA, TM_DUOC.LOAIDUOC_ID, TM_DUOC.DUONGDUNG_ID,        TM_TENDUOC.TENDUOC, TM_TENDUOC.TENDUOC_EN, TM_TENDUOC.MAQUOCTE, TM_TENDUOC.MAQUOCTEBT,        TM_LOAIDUOC.LOAIVATTU_ID, TM_DUOC.BENHVIEN_ID,        TT_TONKHO.SOLUONG, TM_DUOC.VTYT_PHANLOAI, TM_DUOC.PHAMVI, TT_TONKHO.NGUONDUOC_ID, NG.TENNGUONDUOC AS TENNGUONDUOC        , TAMNGUNG = CASE WHEN TM_DUOC.TAMNGUNG = '1' OR NG.TAMNGUNG = '1' OR KD.TAMNGUNG = '1' THEN '1' ELSE '0' END        , TM_DUOC.DANGTRINHBAY        from TM_DUOC        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = TM_DUOC.DONVITINH_ID        left join TM_TENDUOC on TM_DUOC.TENDUOC_ID = TM_TENDUOC.TENDUOC_ID and TM_DUOC.BENHVIEN_ID = 'HLU01' and TM_DUOC.TAMNGUNG = '0'        left join TM_LOAIDUOC on TM_LOAIDUOC.LOAIDUOC_ID = TM_DUOC.LOAIDUOC_ID and TM_LOAIDUOC.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG on (TM_LOAIDUOC.LOAIVATTU_ID = TM_DUOC_HANDUNG.LOAIDUOC and TM_DUOC_HANDUNG.BENHVIEN_ID = 'HLU01')        inner join        (select LTRIM(A.KHODUOC_ID) + '_' + LTRIM(A.DUOC_ID) + '_' + LTRIM(ISNULL(A.NGUONDUOC_ID,'')) as DUOC_KEY, A.KHODUOC_ID, A.DUOC_ID, A.NGUONDUOC_ID,        SUM(isnull(A.SOLUONG,0)) as SOLUONG        from        (select SUM(SOLUONG) as SOLUONG, KHODUOC_ID, DUOC_ID, NGUONDUOC_ID from TT_DUOC_TONKHO        where BENHVIEN_ID = 'HLU01' group by KHODUOC_ID, DUOC_ID, NGUONDUOC_ID) A        group by LTRIM(A.KHODUOC_ID) + '_' + LTRIM(A.DUOC_ID) + '_' + LTRIM(ISNULL(A.NGUONDUOC_ID,'')), A.KHODUOC_ID, A.DUOC_ID, NGUONDUOC_ID        ) TT_TONKHO on TT_TONKHO.DUOC_ID = TM_DUOC.DUOC_ID        LEFT JOIN TM_NGUONHANG NG ON NG.NGUONDUOC_ID = TT_TONKHO.NGUONDUOC_ID        LEFT JOIN TM_KHODUOC KD ON KD.KHODUOC_ID = TT_TONKHO.KHODUOC_ID        where TM_DUOC.BENHVIEN_ID = 'HLU01' and TT_TONKHO.SOLUONG >= 0]
2019-09-20 11:05:04,678 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM023']
2019-09-20 11:05:04,791 [5] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoVaBooking] PreparedStatement : [declare @NGUONDUOC_MACDINH varchar(5) = '0';        declare @TOAMUANGOAI int = 0;        select @NGUONDUOC_MACDINH = isnull(VALUE,0) from TM_SYS_APPSETTINGS where CODE = 'PHA_NGUONDUOC'        select @TOAMUANGOAI = isnull(VALUE,0) from TM_SYS_APPSETTINGS where CODE = 'OPD_TOAMUANGOAI_DUNGDANHMUC_DUOC'                if @TOAMUANGOAI = 1        begin        select  distinct '0' + '_' + LTRIM(d.DUOC_ID) + '_' + @NGUONDUOC_MACDINH as DUOC_KEY, 0 as PHAMVI_ID, @NGUONDUOC_MACDINH as NGUONDUOC_ID, null as TENNGUONDUOC, null as TINHTIEN, d.DUOC_ID, ld.MALOAIDUOC,        d.SOVISA,d.TYLE_VAT,d.COTOA, d.MADUOC, d.TENHANG, d.TENDUOCDAYDU, d.DONVITINH as DONVITINH, d.BHYT,        d.TENHOATCHAT, d.HAMLUONG, d.HANGSANXUAT, d.QUOCGIA, d.LOAIDUOC_ID, d.DUONGDUNG_ID, d.TINHTIEN_PTTT,        ten.TENDUOC, ten.TENDUOC_EN, ten.MAQUOCTE, ten.MAQUOCTEBT,        '' as BHYT_TEXT        , ld.LOAIVATTU_ID        , d.BENHVIEN_ID,        999999999 as SOLUONG, d.VTYT_PHANLOAI, d.PHAMVI, d.SUASOLUONGTONGHOP, d.MADUOCBV, d.DANGTRINHBAY        , TAMNGUNG = CASE WHEN d.TAMNGUNG = '1' THEN '1' ELSE '0' END        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        union all        select  distinct tk.DUOC_KEY, LTRIM(tk.PHAMVI_ID) as PHAMVI_ID, tk.NGUONDUOC_ID, nh.TENNGUONDUOC, nh.TINHTIEN, d.DUOC_ID, ld.MALOAIDUOC,        d.SOVISA,d.TYLE_VAT,d.COTOA, d.MADUOC, d.TENHANG, d.TENDUOCDAYDU, d.DONVITINH as DONVITINH, d.BHYT,        d.TENHOATCHAT, d.HAMLUONG, d.HANGSANXUAT, d.QUOCGIA, d.LOAIDUOC_ID, d.DUONGDUNG_ID, d.TINHTIEN_PTTT,        ten.TENDUOC, ten.TENDUOC_EN, ten.MAQUOCTE, ten.MAQUOCTEBT,        CASE WHEN d.BHYT = '1' THEN 'BHYT' ELSE '' END as BHYT_TEXT        , ld.LOAIVATTU_ID        , d.BENHVIEN_ID,        tk.SOLUONG, d.VTYT_PHANLOAI, d.PHAMVI, d.SUASOLUONGTONGHOP, d.MADUOCBV, d.DANGTRINHBAY        , TAMNGUNG = CASE WHEN d.TAMNGUNG = '1' OR nh.TAMNGUNG = '1' OR kd.TAMNGUNG = '1' THEN '1' ELSE '0' END        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        inner join        (        select  LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')) DUOC_KEY, (SUM(dtk.SOLUONG) - isnull(sum(A.SOLUONG),0) - isnull(sum(B.SOLUONG),0)) SOLUONG, pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        from (select sum(soluong) soluong,duoc_id,nguonduoc_id,khoduoc_id,benhvien_id from TT_DUOC_TONKHO  group by duoc_id,nguonduoc_id,khoduoc_id,benhvien_id) dtk        inner join TM_DUOC_PHAMVISD_MAPPING pvsd on dtk.KHODUOC_ID = pvsd.KHODUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NOITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) B on B.DUOC_ID = dtk.DUOC_ID and B.SOLUONG > 0 and B.PHAMVI_ID = pvsd.PHAMVI_ID and B.NGUONHANG_ID = dtk.NGUONDUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NGOAITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) A on A.DUOC_ID = dtk.DUOC_ID and A.SOLUONG > 0 and A.PHAMVI_ID = pvsd.PHAMVI_ID and A.NGUONHANG_ID = dtk.NGUONDUOC_ID        where dtk.SOLUONG > 0 and dtk.BENHVIEN_ID = 'HLU01'        group by LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')), pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        ) tk on tk.DUOC_ID = d.DUOC_ID        left join TM_DUOC_PHAMVISUDUNG kd on kd.PHAMVI_ID = tk.PHAMVI_ID and kd.BENHVIEN_ID = 'HLU01'        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = tk.NGUONDUOC_ID and nh.BENHVIEN_ID = 'HLU01'        where d.BENHVIEN_ID = 'HLU01'  and tk.SOLUONG >= 0        end        else        begin                  select  distinct tk.DUOC_KEY, LTRIM(tk.PHAMVI_ID) as PHAMVI_ID, tk.NGUONDUOC_ID, nh.TENNGUONDUOC, nh.TINHTIEN, d.DUOC_ID, ld.MALOAIDUOC,        d.SOVISA,d.TYLE_VAT,d.COTOA, d.MADUOC, d.TENHANG, d.TENDUOCDAYDU, d.DONVITINH as DONVITINH, d.BHYT,        d.TENHOATCHAT, d.HAMLUONG, d.HANGSANXUAT, d.QUOCGIA, d.LOAIDUOC_ID, d.DUONGDUNG_ID, d.TINHTIEN_PTTT,        ten.TENDUOC, ten.TENDUOC_EN, ten.MAQUOCTE, ten.MAQUOCTEBT,        CASE WHEN d.BHYT = '1' THEN 'BHYT' ELSE '' END as BHYT_TEXT        , ld.LOAIVATTU_ID        , d.BENHVIEN_ID,        tk.SOLUONG, d.VTYT_PHANLOAI, d.PHAMVI, d.SUASOLUONGTONGHOP, d.MADUOCBV, d.DANGTRINHBAY        , TAMNGUNG = CASE WHEN d.TAMNGUNG = '1' OR nh.TAMNGUNG = '1' OR kd.TAMNGUNG = '1' THEN '1' ELSE '0' END        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        inner join        (        select  LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')) DUOC_KEY, (SUM(dtk.SOLUONG) - isnull(sum(A.SOLUONG),0) - isnull(sum(B.SOLUONG),0)) SOLUONG, pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        from (select sum(soluong) soluong,duoc_id,nguonduoc_id,khoduoc_id,benhvien_id from TT_DUOC_TONKHO  group by duoc_id,nguonduoc_id,khoduoc_id,benhvien_id) dtk        inner join TM_DUOC_PHAMVISD_MAPPING pvsd on dtk.KHODUOC_ID = pvsd.KHODUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NOITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) B on B.DUOC_ID = dtk.DUOC_ID and B.SOLUONG > 0 and B.PHAMVI_ID = pvsd.PHAMVI_ID and B.NGUONHANG_ID = dtk.NGUONDUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NGOAITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) A on A.DUOC_ID = dtk.DUOC_ID and A.SOLUONG > 0 and A.PHAMVI_ID = pvsd.PHAMVI_ID and A.NGUONHANG_ID = dtk.NGUONDUOC_ID        where dtk.SOLUONG > 0 and dtk.BENHVIEN_ID = 'HLU01'        group by LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')), pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        ) tk on tk.DUOC_ID = d.DUOC_ID        left join TM_DUOC_PHAMVISUDUNG kd on kd.PHAMVI_ID = tk.PHAMVI_ID and kd.BENHVIEN_ID = 'HLU01'        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = tk.NGUONDUOC_ID and nh.BENHVIEN_ID = 'HLU01'        where d.BENHVIEN_ID = 'HLU01'  and tk.SOLUONG >= 0        end]
2019-09-20 11:05:07,002 [5] DEBUG - Statement Id: [DAO00320_GetList] PreparedStatement : [select M.*            from TM_MAU M            LEFT JOIN TM_MAU_DONVITINH DVT on M.DONVITINH_ID=DVT.DONVITINH_ID            where            M.TAMNGUNG = '0'            and M.BENHVIEN_ID = 'HLU01'            order by M.TENMAU]
2019-09-20 11:05:07,076 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM071']
2019-09-20 11:05:07,119 [5] DEBUG - Statement Id: [DAO00322_GetListMauTonKhoForCreateCached] PreparedStatement : [SELECT DISTINCT          TK.MAU_KEY, TK.KHOMAU_ID, M.MAU_ID, M.MAMAU, M.TENMAU, M.NHOM_ABO, M.NHOM_RH, M.LOAIMAU_ID,          TK.SOLONHAP_ID, SLN.SOLONHAP, SLN.SOKIEMSOAT, TK.NGUONHANG_ID, NG.TENNGUONMAU, M.BENHVIEN_ID, M.DONVITINH_ID,          SUM(tk.SOLUONG) AS SOLUONG,K.TENKHO,DVT.TENDONVITINH          FROM TT_MAU_TONKHO TK          JOIN TM_KHO K ON TK.KHOMAU_ID = K.KHO_ID          JOIN TT_MAU_CHUNGTU_SOLONHAP SLN ON TK.SOLONHAP_ID = SLN.SOLONHAP_ID          JOIN TM_MAU M on TK.MAU_ID = M.MAU_ID and M.TAMNGUNG = '0'          LEFT JOIN TM_MAU_DONVITINH DVT on M.DONVITINH_ID=DVT.DONVITINH_ID          LEFT JOIN TM_NGUONMAU NG ON NG.NGUONMAU_ID = TK.NGUONHANG_ID          WHERE TK.SOLUONG > 0          GROUP BY TK.MAU_KEY, TK.KHOMAU_ID, M.MAU_ID, M.MAMAU, M.TENMAU, M.NHOM_ABO, M.NHOM_RH, M.LOAIMAU_ID,          TK.SOLONHAP_ID, SLN.SOLONHAP, SLN.SOKIEMSOAT,TK.NGUONHANG_ID, NG.TENNGUONMAU, M.BENHVIEN_ID, M.DONVITINH_ID,K.TENKHO,DVT.TENDONVITINH]
2019-09-20 11:05:07,217 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM073']
2019-09-20 11:05:07,257 [5] DEBUG - Statement Id: [DAO00322_GetListMauTonKhoTruBooking] PreparedStatement : [select distinct          TK.MAU_KEY, TK.KHOMAU_ID, M.MAU_ID, M.MAMAU, M.TENMAU, M.NHOM_ABO, M.NHOM_RH, M.LOAIMAU_ID, M.DONVITINH_ID,          TK.SOLONHAP_ID, TK.SOLONHAP, TK.SOKIEMSOAT,M.PHAMVI, TK.NGUONHANG_ID, NG.TENNGUONMAU, M.BENHVIEN_ID,          TK.SOLUONG,TK.TENKHO,DVT.TENDONVITINH          from TM_MAU M          JOIN          (          select          A.MAU_KEY, A.KHOMAU_ID, A.MAU_ID ,a.NGUONHANG_ID, A.SOLONHAP_ID, A.SOLONHAP, A.SOKIEMSOAT, A.SOLUONG,A.TENKHO          from          (          select KHOMAU_ID, TK.MAU_ID, TK.NGUONHANG_ID, TK.MAU_KEY, SLN.SOLONHAP_ID, SLN.SOLONHAP, SLN.SOKIEMSOAT, ISNULL(TK.SOLUONG,0) - ISNULL(book.SOLUONG,0) as SOLUONG,K.TENKHO          from TT_MAU_TONKHO TK          JOIN TM_KHO K ON TK.KHOMAU_ID = K.KHO_ID          inner join TT_MAU_CHUNGTU_SOLONHAP SLN ON TK.SOLONHAP_ID = SLN.SOLONHAP_ID          left join dbo.TT_MAU_TONKHO_BOOK book ON book.MAU_KEY = TK.MAU_KEY AND book.TRANGTHAI = 'HIEULUC'          where ISNULL(TK.SOLUONG,0) - ISNULL(book.SOLUONG,0) > 0          ) A          )TK on TK.MAU_ID = M.MAU_ID and M.TAMNGUNG = '0'          LEFT JOIN TM_MAU_DONVITINH DVT on M.DONVITINH_ID=DVT.DONVITINH_ID          LEFT JOIN TM_NGUONMAU NG ON NG.NGUONMAU_ID = TK.NGUONHANG_ID]
2019-09-20 11:05:07,344 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM072']
2019-09-20 11:05:08,278 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'MAIN'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2019-09-20 11:05:08,924 [1] DEBUG - Statement Id: [DAO00002_FormList] PreparedStatement : [select              TM_SYS_FORM.HOSPITAL_ID,              TM_SYS_FORM.NAME,              TM_SYS_FORM.CLASS,              TM_SYS_FORM.ASSEMBLY,              TM_SYS_FORM.TITLE_VI as TITLE              from TM_SYS_FORM              where HOSPITAL_ID = 'HLU01']
2019-09-20 11:05:12,496 [1] DEBUG - Statement Id: [DAO00300_GetShortcutListByUserID] PreparedStatement : [SELECT S.SHORTCUT_CODE, S.SHORTCUT_VALUE              FROM TM_SHORTCUT AS S              WHERE S.BENHVIEN_ID = 'HLU01' AND S.USER_ID = '1' AND TAMNGUNG = '0']
2019-09-20 11:05:12,700 [1] DEBUG - Statement Id: [DAO00087_GetList] PreparedStatement : [select CODE, VALUE, BENHVIEN_ID              from TM_SYS_APPSETTINGS              where LOCKED = '0' and BENHVIEN_ID = 'HLU01'              order by SETTING_ID]
2019-09-20 11:05:12,773 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'MSG01'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2019-09-20 11:05:12,885 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'MSG02'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2019-09-20 11:05:13,028 [1] DEBUG - Statement Id: [DAO00008_GetUserSettings] PreparedStatement : [select A.*, B.TENKHO , C.TENPHONGBAN, B.MAKHO, C.MAPHONGBAN          from TM_SYS_USERS A          left join TM_KHODUOC B on B.KHODUOC_ID = A.INVENTORY_ID          left join TM_PHONGBAN C on (C.PHONGBAN_ID = A.WORKING_DEPT_ID and C.BENHVIEN_ID =  @param0 )          left join TM_SYS_USERKHO D on (D.ACCOUNT_ID = A.ACCOUNT_ID and D.HOSPITAL_ID =  @param0 )          where          A.HOSPITAL_ID =  @param0            and                 A.ACCOUNT_ID =  @param1]
2019-09-20 11:05:13,029 [1] DEBUG - Statement Id: [DAO00008_GetUserSettings] Parameters: [@param0=[HOSPITAL_ID,HLU01], @param1=[ACCOUNT_ID,113]]
2019-09-20 11:05:13,029 [1] DEBUG - Statement Id: [DAO00008_GetUserSettings] Types: [@param0=[String, System.String], @param1=[String, System.String]]
2019-09-20 11:05:13,061 [1] DEBUG - Statement Id: [DAO00008_GetUserInvSettings] PreparedStatement : [select A.*, B.TENKHO, B.MAKHO, B.LOAIKHO_ID, B.KHOQUANLY_ID          from TM_SYS_USERKHO A          left join TM_KHO B on B.MODULE_ID = A.MODULE_ID and B.KHO_ID = A.KHO_ID          where A.HOSPITAL_ID =  @param0  and A.ACCOUNT_ID =  @param1           order by B.TENKHO]
2019-09-20 11:05:13,061 [1] DEBUG - Statement Id: [DAO00008_GetUserInvSettings] Parameters: [@param0=[HOSPITAL_ID,HLU01], @param1=[ACCOUNT_ID,113]]
2019-09-20 11:05:13,061 [1] DEBUG - Statement Id: [DAO00008_GetUserInvSettings] Types: [@param0=[String, System.String], @param1=[String, System.String]]
2019-09-20 11:05:13,182 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'COM30'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2019-09-20 11:05:13,327 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'RIS04'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2019-09-20 11:05:19,023 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'MENU1'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2019-09-20 11:05:19,120 [1] DEBUG - Statement Id: [DAO00011_GetList] PreparedStatement : [select              TM_SYS_MENU.ID,              TM_SYS_MENU.PARENTID,              TM_SYS_MENU.SCREEN,              TM_SYS_MENU.SMALLIMAGE,              TM_SYS_MENU.LARGEIMAGE,              TM_SYS_MENU.DESCRIPTION,              TM_SYS_MENU.TYPE,              TM_SYS_MENU.TITLE_VI as TITLE              from TM_SYS_MENU              where TM_SYS_MENU.HOSPITAL_ID = 'HLU01' and TM_SYS_MENU.ACTIVE = '1'               AND                   (TM_SYS_MENU.TYPE & '8' = '8')                             order by TM_SYS_MENU.ORDERNUM]
2019-09-20 11:05:19,333 [1] DEBUG - Statement Id: [DAO00011_usermenu_list] PreparedStatement : [select              TM_SYS_HOMEMENU.MENUID as ID,              TM_SYS_MENU.TITLE_VI as TITLE,              TM_SYS_MENU.SCREEN,              TM_SYS_MENU.SMALLIMAGE,              TM_SYS_MENU.LARGEIMAGE,              TM_SYS_MENU.TYPE              from TM_SYS_HOMEMENU              left join TM_SYS_MENU on TM_SYS_MENU.ID = TM_SYS_HOMEMENU.MENUID and TM_SYS_MENU.HOSPITAL_ID = TM_SYS_HOMEMENU.HOSPITAL_ID              where TM_SYS_HOMEMENU.HOSPITAL_ID = 'HLU01' and TM_SYS_HOMEMENU.USERID = '113' and TM_SYS_MENU.ACTIVE = '1'               AND                   (TM_SYS_MENU.TYPE & '8' = '8')                             ORDER BY TM_SYS_HOMEMENU.ORDERNUM]
2019-09-20 11:05:26,620 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'COM31'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2019-09-20 11:05:26,761 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'ORM28'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2019-09-20 11:05:30,992 [1] DEBUG - Statement Id: [DAO00066_GetBENHAN_TIEPNHAN] PreparedStatement : [select top 1 *        from TT_NOITRU_BENHAN        where TIEPNHAN_ID = '27022'  and BENHVIEN_ID = 'HLU01'        order by NGAYTAO desc]
2019-09-20 11:05:31,430 [1] DEBUG - Statement Id: [DAO00014_GetInPatientStatus] PreparedStatement : [select TRANGTHAI, isnull(KHOACHUYENDEN_ID, KHOAVAO_ID) as KHOAHIENTAI from TT_NOITRU_BENHAN        where        TIEPNHAN_ID = '27022'        and BENHVIEN_ID = 'HLU01'         and           BENHAN_ID = '5800']
2019-09-20 11:05:31,565 [1] DEBUG - Statement Id: [DAO00048_TT_PHAUTHUAT_GetList] PreparedStatement : [select *              from TT_PHAUTHUAT               where                             TT_PHAUTHUAT.LOAI = 'P'                       and                           TT_PHAUTHUAT.TIEPNHAN_ID = 27022                       and                           TT_PHAUTHUAT.BENHVIEN_ID = 'HLU01'                                     order by PHAUTHUAT_ID DESC]
2019-09-20 11:05:31,642 [1] DEBUG - Statement Id: [DAO00048_GetListLoaiGacTrongPTTT] PreparedStatement : [select DICTIONARY_ID, DICTIONARY_CODE, DICTIONARY_NAME          from LST_DICTIONARY          where DICTIONARY_TYPE_CODE = 'LoaiGacPTTT'          and ENABLED = '1']
2019-09-20 11:05:32,524 [1] DEBUG - Statement Id: [DAO00048_GetDSLoaiGacDaGhiNhan] PreparedStatement : [select A.KIEMSOATGAC_ID, A.BENHNHAN_ID, A.TIEPNHAN_ID, A.BENHAN_ID, A.PHAUTHUAT_ID, A.LOAIPT_TT, A.LOAIGAC_ID          , A.NGAYGHINHAN, A.THOIGIANGHINHAN, A.SOLUONG, A.SOLUONGDASUDUNG, A.SOLUONGCONLAI, A.GHICHU, A.NGUOINHANDUNGCU_ID          , B.DICTIONARY_CODE AS MALOAIGAC, B.DICTIONARY_NAME AS TENLOAIGAC          from TT_PHAUTHUAT_GHINHANGAC A          inner join LST_DICTIONARY B on B.DICTIONARY_ID = A.LOAIGAC_ID          where A.PHAUTHUAT_ID = 3742 and A.BENHVIEN_ID = 'HLU01']
2019-09-20 11:05:32,800 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'COM98'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2019-09-20 11:05:37,575 [1] DEBUG - Statement Id: [DAO00048_GetDSLoaiGacDaGhiNhan] PreparedStatement : [select A.KIEMSOATGAC_ID, A.BENHNHAN_ID, A.TIEPNHAN_ID, A.BENHAN_ID, A.PHAUTHUAT_ID, A.LOAIPT_TT, A.LOAIGAC_ID          , A.NGAYGHINHAN, A.THOIGIANGHINHAN, A.SOLUONG, A.SOLUONGDASUDUNG, A.SOLUONGCONLAI, A.GHICHU, A.NGUOINHANDUNGCU_ID          , B.DICTIONARY_CODE AS MALOAIGAC, B.DICTIONARY_NAME AS TENLOAIGAC          from TT_PHAUTHUAT_GHINHANGAC A          inner join LST_DICTIONARY B on B.DICTIONARY_ID = A.LOAIGAC_ID          where A.PHAUTHUAT_ID = 3742 and A.BENHVIEN_ID = 'HLU01']
2019-09-20 11:06:09,036 [1] DEBUG - Statement Id: [DAO00048_TT_PHAUTHUAT_GHINHANGAC_Add] PreparedStatement : [insert into TT_PHAUTHUAT_GHINHANGAC (          BENHNHAN_ID          , TIEPNHAN_ID          , BENHAN_ID          , PHAUTHUAT_ID          , LOAIPT_TT          , LOAIGAC_ID          , NGAYGHINHAN          , THOIGIANGHINHAN          , SOLUONG          , SOLUONGDASUDUNG          , SOLUONGCONLAI          , GHICHU          , NGUOINHANDUNGCU_ID          , BENHVIEN_ID          , NGUOITAO          , NGAYTAO            ) values (           @param0           ,  @param1           ,  @param2           ,  @param3           ,  @param4           ,  @param5           ,  @param6           ,  @param7           ,  @param8           ,  @param9           ,  @param10           ,  @param11           ,  @param12           ,  @param13           ,  @param14           ,  @param15           )          SELECT SCOPE_IDENTITY()]
2019-09-20 11:06:09,037 [1] DEBUG - Statement Id: [DAO00048_TT_PHAUTHUAT_GHINHANGAC_Add] Parameters: [@param0=[BENHNHAN_ID,23075], @param1=[TIEPNHAN_ID,27022], @param2=[BENHAN_ID,5800], @param3=[PHAUTHUAT_ID,3742], @param4=[LOAIPT_TT,P], @param5=[LOAIGAC_ID,11713], @param6=[NGAYGHINHAN,9/20/2019 12:00:00 AM], @param7=[THOIGIANGHINHAN,9/20/2019 11:06:09 AM], @param8=[SOLUONG,10], @param9=[SOLUONGDASUDUNG,8], @param10=[SOLUONGCONLAI,2], @param11=[GHICHU,test], @param12=[NGUOINHANDUNGCU_ID,35], @param13=[BENHVIEN_ID,HLU01], @param14=[NGUOITAO,null], @param15=[NGAYTAO,9/20/2019 11:06:09 AM]]
2019-09-20 11:06:09,037 [1] DEBUG - Statement Id: [DAO00048_TT_PHAUTHUAT_GHINHANGAC_Add] Types: [@param0=[Int64, System.Int64], @param1=[Int64, System.Int64], @param2=[Int64, System.Int64], @param3=[Int64, System.Int64], @param4=[String, System.String], @param5=[Int64, System.Int64], @param6=[DateTime, System.DateTime], @param7=[DateTime, System.DateTime], @param8=[Double, System.Double], @param9=[Double, System.Double], @param10=[Double, System.Double], @param11=[String, System.String], @param12=[Int64, System.Int64], @param13=[String, System.String], @param14=[System.DBNull, null], @param15=[DateTime, System.DateTime]]
2019-09-20 11:06:09,161 [1] DEBUG - Statement Id: [DAO00048_GetDSLoaiGacDaGhiNhan] PreparedStatement : [select A.KIEMSOATGAC_ID, A.BENHNHAN_ID, A.TIEPNHAN_ID, A.BENHAN_ID, A.PHAUTHUAT_ID, A.LOAIPT_TT, A.LOAIGAC_ID          , A.NGAYGHINHAN, A.THOIGIANGHINHAN, A.SOLUONG, A.SOLUONGDASUDUNG, A.SOLUONGCONLAI, A.GHICHU, A.NGUOINHANDUNGCU_ID          , B.DICTIONARY_CODE AS MALOAIGAC, B.DICTIONARY_NAME AS TENLOAIGAC          from TT_PHAUTHUAT_GHINHANGAC A          inner join LST_DICTIONARY B on B.DICTIONARY_ID = A.LOAIGAC_ID          where A.PHAUTHUAT_ID = 3742 and A.BENHVIEN_ID = 'HLU01']
--------------------------------------------------------------------------------
2019-09-20 11:07:56,506 [1] DEBUG - Statement Id: [DAO00001_DBList] PreparedStatement : [select *              from TM_SYS_SERVER              where HOSPITAL_ID = '_SYSTEM_' and TYPE = 'D']
2019-09-20 11:07:56,786 [1] DEBUG - Statement Id: [DAO00001_DaoList] PreparedStatement : [select              TM_SYS_SERVICEMAP.ID,              TM_SYS_SERVICEMAP.HOSPITAL_ID,              TM_SYS_SERVICEMAP.DB_NAME,              TM_SYS_SERVICEMAP.TYPE,              TM_SYS_SERVICEMAP.NAME,              TM_SYS_SERVICEMAP.CLASS,              (TM_SYS_DIC.VALUE + '.' + TM_SYS_SERVICEMAP.CLASS) as CLASSFULL,              TM_SYS_SERVICEMAP.ASSEMBLY              from TM_SYS_SERVICEMAP              inner join TM_SYS_DIC              on TM_SYS_SERVICEMAP.NAMESPACE = TM_SYS_DIC.ID              where HOSPITAL_ID = '_SYSTEM_' AND TYPE = 'D' AND ACTIVE = '1'              order by DB_NAME]
2019-09-20 11:07:56,826 [1] DEBUG - Statement Id: [DAO00001_ServiceList] PreparedStatement : [select              TM_SYS_SERVICEMAP.ID,              TM_SYS_SERVICEMAP.HOSPITAL_ID,              TM_SYS_SERVICEMAP.DB_NAME,              TM_SYS_SERVICEMAP.TYPE,              TM_SYS_SERVICEMAP.NAME,              TM_SYS_SERVICEMAP.CLASS,              (TM_SYS_DIC.VALUE + '.' + TM_SYS_SERVICEMAP.CLASS) as CLASSFULL,              TM_SYS_SERVICEMAP.ASSEMBLY,              TM_SYS_SERVER.URL              from TM_SYS_SERVICEMAP              inner join TM_SYS_DIC on TM_SYS_SERVICEMAP.NAMESPACE = TM_SYS_DIC.ID              inner join TM_SYS_SERVER on (TM_SYS_SERVICEMAP.DB_NAME = TM_SYS_SERVER.NAME) and (TM_SYS_SERVER.HOSPITAL_ID = '_SYSTEM_')              where TM_SYS_SERVICEMAP.HOSPITAL_ID = '_SYSTEM_' AND TM_SYS_SERVICEMAP.TYPE = 'S'  AND ACTIVE = '1'              order by URL]
2019-09-20 11:07:57,184 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = '_SYSTEM_'               AND                   TM_SYS_SCREEN.PAGE = 'LOGIN'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2019-09-20 11:07:57,379 [1] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = '_SYSTEM_'               AND                   TM_SYS_CACHE.ACTIVE = '1']
2019-09-20 11:08:02,157 [1] DEBUG - Statement Id: [DAO00001_DBList] PreparedStatement : [select *              from TM_SYS_SERVER              where HOSPITAL_ID = 'HLU01' and TYPE = 'D']
2019-09-20 11:08:02,192 [1] DEBUG - Statement Id: [DAO00001_DaoList] PreparedStatement : [select              TM_SYS_SERVICEMAP.ID,              TM_SYS_SERVICEMAP.HOSPITAL_ID,              TM_SYS_SERVICEMAP.DB_NAME,              TM_SYS_SERVICEMAP.TYPE,              TM_SYS_SERVICEMAP.NAME,              TM_SYS_SERVICEMAP.CLASS,              (TM_SYS_DIC.VALUE + '.' + TM_SYS_SERVICEMAP.CLASS) as CLASSFULL,              TM_SYS_SERVICEMAP.ASSEMBLY              from TM_SYS_SERVICEMAP              inner join TM_SYS_DIC              on TM_SYS_SERVICEMAP.NAMESPACE = TM_SYS_DIC.ID              where HOSPITAL_ID = 'HLU01' AND TYPE = 'D' AND ACTIVE = '1'              order by DB_NAME]
2019-09-20 11:08:03,714 [1] DEBUG - Statement Id: [DAO00001_ServiceList] PreparedStatement : [select              TM_SYS_SERVICEMAP.ID,              TM_SYS_SERVICEMAP.HOSPITAL_ID,              TM_SYS_SERVICEMAP.DB_NAME,              TM_SYS_SERVICEMAP.TYPE,              TM_SYS_SERVICEMAP.NAME,              TM_SYS_SERVICEMAP.CLASS,              (TM_SYS_DIC.VALUE + '.' + TM_SYS_SERVICEMAP.CLASS) as CLASSFULL,              TM_SYS_SERVICEMAP.ASSEMBLY,              TM_SYS_SERVER.URL              from TM_SYS_SERVICEMAP              inner join TM_SYS_DIC on TM_SYS_SERVICEMAP.NAMESPACE = TM_SYS_DIC.ID              inner join TM_SYS_SERVER on (TM_SYS_SERVICEMAP.DB_NAME = TM_SYS_SERVER.NAME) and (TM_SYS_SERVER.HOSPITAL_ID = 'HLU01')              where TM_SYS_SERVICEMAP.HOSPITAL_ID = 'HLU01' AND TM_SYS_SERVICEMAP.TYPE = 'S'  AND ACTIVE = '1'              order by URL]
2019-09-20 11:08:03,812 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1']
2019-09-20 11:08:04,595 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM005']
2019-09-20 11:08:04,730 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM015']
2019-09-20 11:08:04,806 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM067']
2019-09-20 11:08:04,884 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM008']
2019-09-20 11:08:04,958 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM068']
2019-09-20 11:08:05,034 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM006']
2019-09-20 11:08:05,310 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM030']
2019-09-20 11:08:05,878 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM025']
2019-09-20 11:08:05,953 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM024']
2019-09-20 11:08:06,466 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM033']
2019-09-20 11:08:06,504 [5] DEBUG - Statement Id: [DAO00027_GetListDuocKyGuiTonKho] PreparedStatement : [select  distinct TT_TONKHO.DUOC_KEY, LTRIM(TT_TONKHO.KHODUOC_ID) as KHODUOC_ID, TM_DUOC.DUOC_ID, TM_LOAIDUOC.MALOAIDUOC,TM_DUOC.SOVISA,TM_DUOC.TYLE_VAT,TM_DUOC.COTOA,        TM_DUOC.MADUOC, TM_DUOC.TENHANG, TM_DUOC.TENDUOCDAYDU, dvt.TENDONVITINH as DONVITINH,  TM_DUOC.DONVITINH_ID,TM_DUOC.BHYT,TM_DUOC.PHAMVI,        TM_DUOC.TENHOATCHAT, TM_DUOC.HAMLUONG, TM_DUOC.HANGSANXUAT, TM_DUOC.QUOCGIA, TM_DUOC.LOAIDUOC_ID, TM_DUOC.DUONGDUNG_ID,        TM_TENDUOC.TENDUOC, TM_TENDUOC.TENDUOC_EN, TM_TENDUOC.MAQUOCTE, TM_TENDUOC.MAQUOCTEBT,        TM_LOAIDUOC.LOAIVATTU_ID, TM_DUOC.BENHVIEN_ID,TT_TONKHO.SOLUONG, TT_TONKHO.NGUONDUOC_ID, NH.TENNGUONDUOC        , TAMNGUNG = CASE WHEN TM_DUOC.TAMNGUNG = '1' OR nh.TAMNGUNG = '1' OR KD.TAMNGUNG = '1' THEN '1' ELSE '0' END        , TM_DUOC.DANGTRINHBAY        from TM_DUOC        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = TM_DUOC.DONVITINH_ID        left join TM_TENDUOC on TM_DUOC.TENDUOC_ID = TM_TENDUOC.TENDUOC_ID and TM_DUOC.BENHVIEN_ID = 'HLU01' and TM_DUOC.TAMNGUNG = '0'        left join TM_LOAIDUOC on TM_LOAIDUOC.LOAIDUOC_ID = TM_DUOC.LOAIDUOC_ID and TM_LOAIDUOC.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG on (TM_LOAIDUOC.LOAIVATTU_ID = TM_DUOC_HANDUNG.LOAIDUOC and TM_DUOC_HANDUNG.BENHVIEN_ID = 'HLU01')        inner join        (select LTRIM(A.KHODUOC_ID) + '_' + LTRIM(A.DUOC_ID) + '_' + LTRIM(ISNULL(A.NGUONDUOC_ID,'')) as DUOC_KEY, A.KHODUOC_ID, A.DUOC_ID,A.NGUONDUOC_ID,        SUM(isnull(A.SOLUONG,0)) as SOLUONG        from        (select SUM(SOLUONG) as SOLUONG, KHODUOC_ID, DUOC_ID, NGUONDUOC_ID from TT_DUOC_KYGUI_TONKHO        where BENHVIEN_ID = 'HLU01' group by KHODUOC_ID, DUOC_ID, NGUONDUOC_ID) A        group by LTRIM(A.KHODUOC_ID) + '_' + LTRIM(A.DUOC_ID) + '_' + LTRIM(A.NGUONDUOC_ID), A.KHODUOC_ID, A.DUOC_ID, A.NGUONDUOC_ID)        TT_TONKHO on TT_TONKHO.DUOC_ID = TM_DUOC.DUOC_ID        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = TT_TONKHO.NGUONDUOC_ID and nh.BENHVIEN_ID = 'HLU01'        LEFT JOIN TM_KHODUOC KD ON KD.KHODUOC_ID = TT_TONKHO.KHODUOC_ID        where TM_DUOC.BENHVIEN_ID = 'HLU01' AND TT_TONKHO.SOLUONG >= 0]
2019-09-20 11:08:06,580 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM018']
2019-09-20 11:08:06,616 [5] DEBUG - Statement Id: [DAO00027_GetListDuocTonKho] PreparedStatement : [select distinct TT_TONKHO.DUOC_KEY, LTRIM(TT_TONKHO.KHODUOC_ID) as KHODUOC_ID, TM_DUOC.DUOC_ID, TM_LOAIDUOC.MALOAIDUOC,TM_DUOC.SOVISA,TM_DUOC.TYLE_VAT,TM_DUOC.COTOA,        TM_DUOC.MADUOC, TM_DUOC.TENHANG, TM_DUOC.TENDUOCDAYDU, dvt.TENDONVITINH as DONVITINH,  TM_DUOC.DONVITINH_ID,TM_DUOC.BHYT,                TM_DUOC.TENHOATCHAT,          TM_DUOC.HAMLUONG, TM_DUOC.HANGSANXUAT, TM_DUOC.QUOCGIA, TM_DUOC.LOAIDUOC_ID, TM_DUOC.DUONGDUNG_ID,        TM_TENDUOC.TENDUOC, TM_TENDUOC.TENDUOC_EN, TM_TENDUOC.MAQUOCTE, TM_TENDUOC.MAQUOCTEBT,        TM_LOAIDUOC.LOAIVATTU_ID, TM_DUOC.BENHVIEN_ID,        TT_TONKHO.SOLUONG, TM_DUOC.VTYT_PHANLOAI, TM_DUOC.PHAMVI, TT_TONKHO.NGUONDUOC_ID, NG.TENNGUONDUOC AS TENNGUONDUOC        , TAMNGUNG = CASE WHEN TM_DUOC.TAMNGUNG = '1' OR NG.TAMNGUNG = '1' OR KD.TAMNGUNG = '1' THEN '1' ELSE '0' END        , TM_DUOC.DANGTRINHBAY        from TM_DUOC        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = TM_DUOC.DONVITINH_ID        left join TM_TENDUOC on TM_DUOC.TENDUOC_ID = TM_TENDUOC.TENDUOC_ID and TM_DUOC.BENHVIEN_ID = 'HLU01' and TM_DUOC.TAMNGUNG = '0'        left join TM_LOAIDUOC on TM_LOAIDUOC.LOAIDUOC_ID = TM_DUOC.LOAIDUOC_ID and TM_LOAIDUOC.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG on (TM_LOAIDUOC.LOAIVATTU_ID = TM_DUOC_HANDUNG.LOAIDUOC and TM_DUOC_HANDUNG.BENHVIEN_ID = 'HLU01')        inner join        (select LTRIM(A.KHODUOC_ID) + '_' + LTRIM(A.DUOC_ID) + '_' + LTRIM(ISNULL(A.NGUONDUOC_ID,'')) as DUOC_KEY, A.KHODUOC_ID, A.DUOC_ID, A.NGUONDUOC_ID,        SUM(isnull(A.SOLUONG,0)) as SOLUONG        from        (select SUM(SOLUONG) as SOLUONG, KHODUOC_ID, DUOC_ID, NGUONDUOC_ID from TT_DUOC_TONKHO        where BENHVIEN_ID = 'HLU01' group by KHODUOC_ID, DUOC_ID, NGUONDUOC_ID) A        group by LTRIM(A.KHODUOC_ID) + '_' + LTRIM(A.DUOC_ID) + '_' + LTRIM(ISNULL(A.NGUONDUOC_ID,'')), A.KHODUOC_ID, A.DUOC_ID, NGUONDUOC_ID        ) TT_TONKHO on TT_TONKHO.DUOC_ID = TM_DUOC.DUOC_ID        LEFT JOIN TM_NGUONHANG NG ON NG.NGUONDUOC_ID = TT_TONKHO.NGUONDUOC_ID        LEFT JOIN TM_KHODUOC KD ON KD.KHODUOC_ID = TT_TONKHO.KHODUOC_ID        where TM_DUOC.BENHVIEN_ID = 'HLU01' and TT_TONKHO.SOLUONG >= 0]
2019-09-20 11:08:08,238 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM023']
2019-09-20 11:08:08,276 [5] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoVaBooking] PreparedStatement : [declare @NGUONDUOC_MACDINH varchar(5) = '0';        declare @TOAMUANGOAI int = 0;        select @NGUONDUOC_MACDINH = isnull(VALUE,0) from TM_SYS_APPSETTINGS where CODE = 'PHA_NGUONDUOC'        select @TOAMUANGOAI = isnull(VALUE,0) from TM_SYS_APPSETTINGS where CODE = 'OPD_TOAMUANGOAI_DUNGDANHMUC_DUOC'                if @TOAMUANGOAI = 1        begin        select  distinct '0' + '_' + LTRIM(d.DUOC_ID) + '_' + @NGUONDUOC_MACDINH as DUOC_KEY, 0 as PHAMVI_ID, @NGUONDUOC_MACDINH as NGUONDUOC_ID, null as TENNGUONDUOC, null as TINHTIEN, d.DUOC_ID, ld.MALOAIDUOC,        d.SOVISA,d.TYLE_VAT,d.COTOA, d.MADUOC, d.TENHANG, d.TENDUOCDAYDU, d.DONVITINH as DONVITINH, d.BHYT,        d.TENHOATCHAT, d.HAMLUONG, d.HANGSANXUAT, d.QUOCGIA, d.LOAIDUOC_ID, d.DUONGDUNG_ID, d.TINHTIEN_PTTT,        ten.TENDUOC, ten.TENDUOC_EN, ten.MAQUOCTE, ten.MAQUOCTEBT,        '' as BHYT_TEXT        , ld.LOAIVATTU_ID        , d.BENHVIEN_ID,        999999999 as SOLUONG, d.VTYT_PHANLOAI, d.PHAMVI, d.SUASOLUONGTONGHOP, d.MADUOCBV, d.DANGTRINHBAY        , TAMNGUNG = CASE WHEN d.TAMNGUNG = '1' THEN '1' ELSE '0' END        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        union all        select  distinct tk.DUOC_KEY, LTRIM(tk.PHAMVI_ID) as PHAMVI_ID, tk.NGUONDUOC_ID, nh.TENNGUONDUOC, nh.TINHTIEN, d.DUOC_ID, ld.MALOAIDUOC,        d.SOVISA,d.TYLE_VAT,d.COTOA, d.MADUOC, d.TENHANG, d.TENDUOCDAYDU, d.DONVITINH as DONVITINH, d.BHYT,        d.TENHOATCHAT, d.HAMLUONG, d.HANGSANXUAT, d.QUOCGIA, d.LOAIDUOC_ID, d.DUONGDUNG_ID, d.TINHTIEN_PTTT,        ten.TENDUOC, ten.TENDUOC_EN, ten.MAQUOCTE, ten.MAQUOCTEBT,        CASE WHEN d.BHYT = '1' THEN 'BHYT' ELSE '' END as BHYT_TEXT        , ld.LOAIVATTU_ID        , d.BENHVIEN_ID,        tk.SOLUONG, d.VTYT_PHANLOAI, d.PHAMVI, d.SUASOLUONGTONGHOP, d.MADUOCBV, d.DANGTRINHBAY        , TAMNGUNG = CASE WHEN d.TAMNGUNG = '1' OR nh.TAMNGUNG = '1' OR kd.TAMNGUNG = '1' THEN '1' ELSE '0' END        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        inner join        (        select  LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')) DUOC_KEY, (SUM(dtk.SOLUONG) - isnull(sum(A.SOLUONG),0) - isnull(sum(B.SOLUONG),0)) SOLUONG, pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        from (select sum(soluong) soluong,duoc_id,nguonduoc_id,khoduoc_id,benhvien_id from TT_DUOC_TONKHO  group by duoc_id,nguonduoc_id,khoduoc_id,benhvien_id) dtk        inner join TM_DUOC_PHAMVISD_MAPPING pvsd on dtk.KHODUOC_ID = pvsd.KHODUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NOITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) B on B.DUOC_ID = dtk.DUOC_ID and B.SOLUONG > 0 and B.PHAMVI_ID = pvsd.PHAMVI_ID and B.NGUONHANG_ID = dtk.NGUONDUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NGOAITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) A on A.DUOC_ID = dtk.DUOC_ID and A.SOLUONG > 0 and A.PHAMVI_ID = pvsd.PHAMVI_ID and A.NGUONHANG_ID = dtk.NGUONDUOC_ID        where dtk.SOLUONG > 0 and dtk.BENHVIEN_ID = 'HLU01'        group by LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')), pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        ) tk on tk.DUOC_ID = d.DUOC_ID        left join TM_DUOC_PHAMVISUDUNG kd on kd.PHAMVI_ID = tk.PHAMVI_ID and kd.BENHVIEN_ID = 'HLU01'        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = tk.NGUONDUOC_ID and nh.BENHVIEN_ID = 'HLU01'        where d.BENHVIEN_ID = 'HLU01'  and tk.SOLUONG >= 0        end        else        begin                  select  distinct tk.DUOC_KEY, LTRIM(tk.PHAMVI_ID) as PHAMVI_ID, tk.NGUONDUOC_ID, nh.TENNGUONDUOC, nh.TINHTIEN, d.DUOC_ID, ld.MALOAIDUOC,        d.SOVISA,d.TYLE_VAT,d.COTOA, d.MADUOC, d.TENHANG, d.TENDUOCDAYDU, d.DONVITINH as DONVITINH, d.BHYT,        d.TENHOATCHAT, d.HAMLUONG, d.HANGSANXUAT, d.QUOCGIA, d.LOAIDUOC_ID, d.DUONGDUNG_ID, d.TINHTIEN_PTTT,        ten.TENDUOC, ten.TENDUOC_EN, ten.MAQUOCTE, ten.MAQUOCTEBT,        CASE WHEN d.BHYT = '1' THEN 'BHYT' ELSE '' END as BHYT_TEXT        , ld.LOAIVATTU_ID        , d.BENHVIEN_ID,        tk.SOLUONG, d.VTYT_PHANLOAI, d.PHAMVI, d.SUASOLUONGTONGHOP, d.MADUOCBV, d.DANGTRINHBAY        , TAMNGUNG = CASE WHEN d.TAMNGUNG = '1' OR nh.TAMNGUNG = '1' OR kd.TAMNGUNG = '1' THEN '1' ELSE '0' END        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        inner join        (        select  LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')) DUOC_KEY, (SUM(dtk.SOLUONG) - isnull(sum(A.SOLUONG),0) - isnull(sum(B.SOLUONG),0)) SOLUONG, pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        from (select sum(soluong) soluong,duoc_id,nguonduoc_id,khoduoc_id,benhvien_id from TT_DUOC_TONKHO  group by duoc_id,nguonduoc_id,khoduoc_id,benhvien_id) dtk        inner join TM_DUOC_PHAMVISD_MAPPING pvsd on dtk.KHODUOC_ID = pvsd.KHODUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NOITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) B on B.DUOC_ID = dtk.DUOC_ID and B.SOLUONG > 0 and B.PHAMVI_ID = pvsd.PHAMVI_ID and B.NGUONHANG_ID = dtk.NGUONDUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NGOAITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) A on A.DUOC_ID = dtk.DUOC_ID and A.SOLUONG > 0 and A.PHAMVI_ID = pvsd.PHAMVI_ID and A.NGUONHANG_ID = dtk.NGUONDUOC_ID        where dtk.SOLUONG > 0 and dtk.BENHVIEN_ID = 'HLU01'        group by LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')), pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        ) tk on tk.DUOC_ID = d.DUOC_ID        left join TM_DUOC_PHAMVISUDUNG kd on kd.PHAMVI_ID = tk.PHAMVI_ID and kd.BENHVIEN_ID = 'HLU01'        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = tk.NGUONDUOC_ID and nh.BENHVIEN_ID = 'HLU01'        where d.BENHVIEN_ID = 'HLU01'  and tk.SOLUONG >= 0        end]
2019-09-20 11:08:10,485 [5] DEBUG - Statement Id: [DAO00320_GetList] PreparedStatement : [select M.*            from TM_MAU M            LEFT JOIN TM_MAU_DONVITINH DVT on M.DONVITINH_ID=DVT.DONVITINH_ID            where            M.TAMNGUNG = '0'            and M.BENHVIEN_ID = 'HLU01'            order by M.TENMAU]
2019-09-20 11:08:10,949 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM071']
2019-09-20 11:08:10,989 [5] DEBUG - Statement Id: [DAO00322_GetListMauTonKhoForCreateCached] PreparedStatement : [SELECT DISTINCT          TK.MAU_KEY, TK.KHOMAU_ID, M.MAU_ID, M.MAMAU, M.TENMAU, M.NHOM_ABO, M.NHOM_RH, M.LOAIMAU_ID,          TK.SOLONHAP_ID, SLN.SOLONHAP, SLN.SOKIEMSOAT, TK.NGUONHANG_ID, NG.TENNGUONMAU, M.BENHVIEN_ID, M.DONVITINH_ID,          SUM(tk.SOLUONG) AS SOLUONG,K.TENKHO,DVT.TENDONVITINH          FROM TT_MAU_TONKHO TK          JOIN TM_KHO K ON TK.KHOMAU_ID = K.KHO_ID          JOIN TT_MAU_CHUNGTU_SOLONHAP SLN ON TK.SOLONHAP_ID = SLN.SOLONHAP_ID          JOIN TM_MAU M on TK.MAU_ID = M.MAU_ID and M.TAMNGUNG = '0'          LEFT JOIN TM_MAU_DONVITINH DVT on M.DONVITINH_ID=DVT.DONVITINH_ID          LEFT JOIN TM_NGUONMAU NG ON NG.NGUONMAU_ID = TK.NGUONHANG_ID          WHERE TK.SOLUONG > 0          GROUP BY TK.MAU_KEY, TK.KHOMAU_ID, M.MAU_ID, M.MAMAU, M.TENMAU, M.NHOM_ABO, M.NHOM_RH, M.LOAIMAU_ID,          TK.SOLONHAP_ID, SLN.SOLONHAP, SLN.SOKIEMSOAT,TK.NGUONHANG_ID, NG.TENNGUONMAU, M.BENHVIEN_ID, M.DONVITINH_ID,K.TENKHO,DVT.TENDONVITINH]
2019-09-20 11:08:11,114 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM073']
2019-09-20 11:08:11,150 [5] DEBUG - Statement Id: [DAO00322_GetListMauTonKhoTruBooking] PreparedStatement : [select distinct          TK.MAU_KEY, TK.KHOMAU_ID, M.MAU_ID, M.MAMAU, M.TENMAU, M.NHOM_ABO, M.NHOM_RH, M.LOAIMAU_ID, M.DONVITINH_ID,          TK.SOLONHAP_ID, TK.SOLONHAP, TK.SOKIEMSOAT,M.PHAMVI, TK.NGUONHANG_ID, NG.TENNGUONMAU, M.BENHVIEN_ID,          TK.SOLUONG,TK.TENKHO,DVT.TENDONVITINH          from TM_MAU M          JOIN          (          select          A.MAU_KEY, A.KHOMAU_ID, A.MAU_ID ,a.NGUONHANG_ID, A.SOLONHAP_ID, A.SOLONHAP, A.SOKIEMSOAT, A.SOLUONG,A.TENKHO          from          (          select KHOMAU_ID, TK.MAU_ID, TK.NGUONHANG_ID, TK.MAU_KEY, SLN.SOLONHAP_ID, SLN.SOLONHAP, SLN.SOKIEMSOAT, ISNULL(TK.SOLUONG,0) - ISNULL(book.SOLUONG,0) as SOLUONG,K.TENKHO          from TT_MAU_TONKHO TK          JOIN TM_KHO K ON TK.KHOMAU_ID = K.KHO_ID          inner join TT_MAU_CHUNGTU_SOLONHAP SLN ON TK.SOLONHAP_ID = SLN.SOLONHAP_ID          left join dbo.TT_MAU_TONKHO_BOOK book ON book.MAU_KEY = TK.MAU_KEY AND book.TRANGTHAI = 'HIEULUC'          where ISNULL(TK.SOLUONG,0) - ISNULL(book.SOLUONG,0) > 0          ) A          )TK on TK.MAU_ID = M.MAU_ID and M.TAMNGUNG = '0'          LEFT JOIN TM_MAU_DONVITINH DVT on M.DONVITINH_ID=DVT.DONVITINH_ID          LEFT JOIN TM_NGUONMAU NG ON NG.NGUONMAU_ID = TK.NGUONHANG_ID]
2019-09-20 11:08:11,218 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM072']
2019-09-20 11:08:12,167 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'MAIN'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2019-09-20 11:08:13,051 [1] DEBUG - Statement Id: [DAO00002_FormList] PreparedStatement : [select              TM_SYS_FORM.HOSPITAL_ID,              TM_SYS_FORM.NAME,              TM_SYS_FORM.CLASS,              TM_SYS_FORM.ASSEMBLY,              TM_SYS_FORM.TITLE_VI as TITLE              from TM_SYS_FORM              where HOSPITAL_ID = 'HLU01']
2019-09-20 11:08:17,424 [1] DEBUG - Statement Id: [DAO00300_GetShortcutListByUserID] PreparedStatement : [SELECT S.SHORTCUT_CODE, S.SHORTCUT_VALUE              FROM TM_SHORTCUT AS S              WHERE S.BENHVIEN_ID = 'HLU01' AND S.USER_ID = '1' AND TAMNGUNG = '0']
2019-09-20 11:08:17,459 [1] DEBUG - Statement Id: [DAO00087_GetList] PreparedStatement : [select CODE, VALUE, BENHVIEN_ID              from TM_SYS_APPSETTINGS              where LOCKED = '0' and BENHVIEN_ID = 'HLU01'              order by SETTING_ID]
2019-09-20 11:08:17,541 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'MSG01'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2019-09-20 11:08:17,662 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'MSG02'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2019-09-20 11:08:17,789 [1] DEBUG - Statement Id: [DAO00008_GetUserSettings] PreparedStatement : [select A.*, B.TENKHO , C.TENPHONGBAN, B.MAKHO, C.MAPHONGBAN          from TM_SYS_USERS A          left join TM_KHODUOC B on B.KHODUOC_ID = A.INVENTORY_ID          left join TM_PHONGBAN C on (C.PHONGBAN_ID = A.WORKING_DEPT_ID and C.BENHVIEN_ID =  @param0 )          left join TM_SYS_USERKHO D on (D.ACCOUNT_ID = A.ACCOUNT_ID and D.HOSPITAL_ID =  @param0 )          where          A.HOSPITAL_ID =  @param0            and                 A.ACCOUNT_ID =  @param1]
2019-09-20 11:08:17,791 [1] DEBUG - Statement Id: [DAO00008_GetUserSettings] Parameters: [@param0=[HOSPITAL_ID,HLU01], @param1=[ACCOUNT_ID,113]]
2019-09-20 11:08:17,791 [1] DEBUG - Statement Id: [DAO00008_GetUserSettings] Types: [@param0=[String, System.String], @param1=[String, System.String]]
2019-09-20 11:08:17,823 [1] DEBUG - Statement Id: [DAO00008_GetUserInvSettings] PreparedStatement : [select A.*, B.TENKHO, B.MAKHO, B.LOAIKHO_ID, B.KHOQUANLY_ID          from TM_SYS_USERKHO A          left join TM_KHO B on B.MODULE_ID = A.MODULE_ID and B.KHO_ID = A.KHO_ID          where A.HOSPITAL_ID =  @param0  and A.ACCOUNT_ID =  @param1           order by B.TENKHO]
2019-09-20 11:08:17,823 [1] DEBUG - Statement Id: [DAO00008_GetUserInvSettings] Parameters: [@param0=[HOSPITAL_ID,HLU01], @param1=[ACCOUNT_ID,113]]
2019-09-20 11:08:17,823 [1] DEBUG - Statement Id: [DAO00008_GetUserInvSettings] Types: [@param0=[String, System.String], @param1=[String, System.String]]
2019-09-20 11:08:17,956 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'COM30'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2019-09-20 11:08:18,117 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'RIS04'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2019-09-20 11:08:24,788 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'MENU1'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2019-09-20 11:08:24,877 [1] DEBUG - Statement Id: [DAO00011_GetList] PreparedStatement : [select              TM_SYS_MENU.ID,              TM_SYS_MENU.PARENTID,              TM_SYS_MENU.SCREEN,              TM_SYS_MENU.SMALLIMAGE,              TM_SYS_MENU.LARGEIMAGE,              TM_SYS_MENU.DESCRIPTION,              TM_SYS_MENU.TYPE,              TM_SYS_MENU.TITLE_VI as TITLE              from TM_SYS_MENU              where TM_SYS_MENU.HOSPITAL_ID = 'HLU01' and TM_SYS_MENU.ACTIVE = '1'               AND                   (TM_SYS_MENU.TYPE & '8' = '8')                             order by TM_SYS_MENU.ORDERNUM]
2019-09-20 11:08:25,113 [1] DEBUG - Statement Id: [DAO00011_usermenu_list] PreparedStatement : [select              TM_SYS_HOMEMENU.MENUID as ID,              TM_SYS_MENU.TITLE_VI as TITLE,              TM_SYS_MENU.SCREEN,              TM_SYS_MENU.SMALLIMAGE,              TM_SYS_MENU.LARGEIMAGE,              TM_SYS_MENU.TYPE              from TM_SYS_HOMEMENU              left join TM_SYS_MENU on TM_SYS_MENU.ID = TM_SYS_HOMEMENU.MENUID and TM_SYS_MENU.HOSPITAL_ID = TM_SYS_HOMEMENU.HOSPITAL_ID              where TM_SYS_HOMEMENU.HOSPITAL_ID = 'HLU01' and TM_SYS_HOMEMENU.USERID = '113' and TM_SYS_MENU.ACTIVE = '1'               AND                   (TM_SYS_MENU.TYPE & '8' = '8')                             ORDER BY TM_SYS_HOMEMENU.ORDERNUM]
2019-09-20 11:08:28,972 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'COM31'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2019-09-20 11:08:29,129 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'ORM28'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2019-09-20 11:08:34,986 [1] DEBUG - Statement Id: [DAO00066_GetBENHAN_TIEPNHAN] PreparedStatement : [select top 1 *        from TT_NOITRU_BENHAN        where TIEPNHAN_ID = '27022'  and BENHVIEN_ID = 'HLU01'        order by NGAYTAO desc]
2019-09-20 11:08:35,079 [1] DEBUG - Statement Id: [DAO00014_GetInPatientStatus] PreparedStatement : [select TRANGTHAI, isnull(KHOACHUYENDEN_ID, KHOAVAO_ID) as KHOAHIENTAI from TT_NOITRU_BENHAN        where        TIEPNHAN_ID = '27022'        and BENHVIEN_ID = 'HLU01'         and           BENHAN_ID = '5800']
2019-09-20 11:08:35,176 [1] DEBUG - Statement Id: [DAO00048_TT_PHAUTHUAT_GetList] PreparedStatement : [select *              from TT_PHAUTHUAT               where                             TT_PHAUTHUAT.LOAI = 'P'                       and                           TT_PHAUTHUAT.TIEPNHAN_ID = 27022                       and                           TT_PHAUTHUAT.BENHVIEN_ID = 'HLU01'                                     order by PHAUTHUAT_ID DESC]
2019-09-20 11:08:35,222 [1] DEBUG - Statement Id: [DAO00048_GetListLoaiGacTrongPTTT] PreparedStatement : [select DICTIONARY_ID, DICTIONARY_CODE, DICTIONARY_NAME          from LST_DICTIONARY          where DICTIONARY_TYPE_CODE = 'LoaiGacPTTT'          and ENABLED = '1']
2019-09-20 11:08:45,314 [1] DEBUG - Statement Id: [DAO00048_GetDSLoaiGacDaGhiNhan] PreparedStatement : [select A.KIEMSOATGAC_ID, A.BENHNHAN_ID, A.TIEPNHAN_ID, A.BENHAN_ID, A.PHAUTHUAT_ID, A.LOAIPT_TT, A.LOAIGAC_ID          , A.NGAYGHINHAN, A.THOIGIANGHINHAN, A.SOLUONG, A.SOLUONGDASUDUNG, A.SOLUONGCONLAI, A.GHICHU, A.NGUOINHANDUNGCU_ID          , B.DICTIONARY_CODE AS MALOAIGAC, B.DICTIONARY_NAME AS TENLOAIGAC          from TT_PHAUTHUAT_GHINHANGAC A          inner join LST_DICTIONARY B on B.DICTIONARY_ID = A.LOAIGAC_ID          where A.PHAUTHUAT_ID = 3742 and A.BENHVIEN_ID = 'HLU01']
2019-09-20 11:08:45,578 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'COM98'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2019-09-20 11:09:25,723 [1] DEBUG - Statement Id: [DAO00048_GetDSLoaiGacDaGhiNhan] PreparedStatement : [select A.KIEMSOATGAC_ID, A.BENHNHAN_ID, A.TIEPNHAN_ID, A.BENHAN_ID, A.PHAUTHUAT_ID, A.LOAIPT_TT, A.LOAIGAC_ID          , A.NGAYGHINHAN, A.THOIGIANGHINHAN, A.SOLUONG, A.SOLUONGDASUDUNG, A.SOLUONGCONLAI, A.GHICHU, A.NGUOINHANDUNGCU_ID          , B.DICTIONARY_CODE AS MALOAIGAC, B.DICTIONARY_NAME AS TENLOAIGAC          from TT_PHAUTHUAT_GHINHANGAC A          inner join LST_DICTIONARY B on B.DICTIONARY_ID = A.LOAIGAC_ID          where A.PHAUTHUAT_ID = 3742 and A.BENHVIEN_ID = 'HLU01']
--------------------------------------------------------------------------------
2019-09-20 11:11:02,159 [1] DEBUG - Statement Id: [DAO00001_DBList] PreparedStatement : [select *              from TM_SYS_SERVER              where HOSPITAL_ID = '_SYSTEM_' and TYPE = 'D']
2019-09-20 11:11:02,489 [1] DEBUG - Statement Id: [DAO00001_DaoList] PreparedStatement : [select              TM_SYS_SERVICEMAP.ID,              TM_SYS_SERVICEMAP.HOSPITAL_ID,              TM_SYS_SERVICEMAP.DB_NAME,              TM_SYS_SERVICEMAP.TYPE,              TM_SYS_SERVICEMAP.NAME,              TM_SYS_SERVICEMAP.CLASS,              (TM_SYS_DIC.VALUE + '.' + TM_SYS_SERVICEMAP.CLASS) as CLASSFULL,              TM_SYS_SERVICEMAP.ASSEMBLY              from TM_SYS_SERVICEMAP              inner join TM_SYS_DIC              on TM_SYS_SERVICEMAP.NAMESPACE = TM_SYS_DIC.ID              where HOSPITAL_ID = '_SYSTEM_' AND TYPE = 'D' AND ACTIVE = '1'              order by DB_NAME]
2019-09-20 11:11:02,531 [1] DEBUG - Statement Id: [DAO00001_ServiceList] PreparedStatement : [select              TM_SYS_SERVICEMAP.ID,              TM_SYS_SERVICEMAP.HOSPITAL_ID,              TM_SYS_SERVICEMAP.DB_NAME,              TM_SYS_SERVICEMAP.TYPE,              TM_SYS_SERVICEMAP.NAME,              TM_SYS_SERVICEMAP.CLASS,              (TM_SYS_DIC.VALUE + '.' + TM_SYS_SERVICEMAP.CLASS) as CLASSFULL,              TM_SYS_SERVICEMAP.ASSEMBLY,              TM_SYS_SERVER.URL              from TM_SYS_SERVICEMAP              inner join TM_SYS_DIC on TM_SYS_SERVICEMAP.NAMESPACE = TM_SYS_DIC.ID              inner join TM_SYS_SERVER on (TM_SYS_SERVICEMAP.DB_NAME = TM_SYS_SERVER.NAME) and (TM_SYS_SERVER.HOSPITAL_ID = '_SYSTEM_')              where TM_SYS_SERVICEMAP.HOSPITAL_ID = '_SYSTEM_' AND TM_SYS_SERVICEMAP.TYPE = 'S'  AND ACTIVE = '1'              order by URL]
2019-09-20 11:11:02,964 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = '_SYSTEM_'               AND                   TM_SYS_SCREEN.PAGE = 'LOGIN'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2019-09-20 11:11:03,215 [1] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = '_SYSTEM_'               AND                   TM_SYS_CACHE.ACTIVE = '1']
2019-09-20 11:11:08,715 [1] DEBUG - Statement Id: [DAO00001_DBList] PreparedStatement : [select *              from TM_SYS_SERVER              where HOSPITAL_ID = 'HLU01' and TYPE = 'D']
2019-09-20 11:11:08,783 [1] DEBUG - Statement Id: [DAO00001_DaoList] PreparedStatement : [select              TM_SYS_SERVICEMAP.ID,              TM_SYS_SERVICEMAP.HOSPITAL_ID,              TM_SYS_SERVICEMAP.DB_NAME,              TM_SYS_SERVICEMAP.TYPE,              TM_SYS_SERVICEMAP.NAME,              TM_SYS_SERVICEMAP.CLASS,              (TM_SYS_DIC.VALUE + '.' + TM_SYS_SERVICEMAP.CLASS) as CLASSFULL,              TM_SYS_SERVICEMAP.ASSEMBLY              from TM_SYS_SERVICEMAP              inner join TM_SYS_DIC              on TM_SYS_SERVICEMAP.NAMESPACE = TM_SYS_DIC.ID              where HOSPITAL_ID = 'HLU01' AND TYPE = 'D' AND ACTIVE = '1'              order by DB_NAME]
2019-09-20 11:11:10,185 [1] DEBUG - Statement Id: [DAO00001_ServiceList] PreparedStatement : [select              TM_SYS_SERVICEMAP.ID,              TM_SYS_SERVICEMAP.HOSPITAL_ID,              TM_SYS_SERVICEMAP.DB_NAME,              TM_SYS_SERVICEMAP.TYPE,              TM_SYS_SERVICEMAP.NAME,              TM_SYS_SERVICEMAP.CLASS,              (TM_SYS_DIC.VALUE + '.' + TM_SYS_SERVICEMAP.CLASS) as CLASSFULL,              TM_SYS_SERVICEMAP.ASSEMBLY,              TM_SYS_SERVER.URL              from TM_SYS_SERVICEMAP              inner join TM_SYS_DIC on TM_SYS_SERVICEMAP.NAMESPACE = TM_SYS_DIC.ID              inner join TM_SYS_SERVER on (TM_SYS_SERVICEMAP.DB_NAME = TM_SYS_SERVER.NAME) and (TM_SYS_SERVER.HOSPITAL_ID = 'HLU01')              where TM_SYS_SERVICEMAP.HOSPITAL_ID = 'HLU01' AND TM_SYS_SERVICEMAP.TYPE = 'S'  AND ACTIVE = '1'              order by URL]
2019-09-20 11:11:10,268 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1']
2019-09-20 11:11:14,604 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM005']
2019-09-20 11:11:14,775 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM015']
2019-09-20 11:11:14,852 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM067']
2019-09-20 11:11:14,927 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM008']
2019-09-20 11:11:15,009 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM068']
2019-09-20 11:11:15,086 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM006']
2019-09-20 11:11:15,164 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM030']
2019-09-20 11:11:15,243 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM025']
2019-09-20 11:11:15,325 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM024']
2019-09-20 11:11:15,850 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM033']
2019-09-20 11:11:15,892 [5] DEBUG - Statement Id: [DAO00027_GetListDuocKyGuiTonKho] PreparedStatement : [select  distinct TT_TONKHO.DUOC_KEY, LTRIM(TT_TONKHO.KHODUOC_ID) as KHODUOC_ID, TM_DUOC.DUOC_ID, TM_LOAIDUOC.MALOAIDUOC,TM_DUOC.SOVISA,TM_DUOC.TYLE_VAT,TM_DUOC.COTOA,        TM_DUOC.MADUOC, TM_DUOC.TENHANG, TM_DUOC.TENDUOCDAYDU, dvt.TENDONVITINH as DONVITINH,  TM_DUOC.DONVITINH_ID,TM_DUOC.BHYT,TM_DUOC.PHAMVI,        TM_DUOC.TENHOATCHAT, TM_DUOC.HAMLUONG, TM_DUOC.HANGSANXUAT, TM_DUOC.QUOCGIA, TM_DUOC.LOAIDUOC_ID, TM_DUOC.DUONGDUNG_ID,        TM_TENDUOC.TENDUOC, TM_TENDUOC.TENDUOC_EN, TM_TENDUOC.MAQUOCTE, TM_TENDUOC.MAQUOCTEBT,        TM_LOAIDUOC.LOAIVATTU_ID, TM_DUOC.BENHVIEN_ID,TT_TONKHO.SOLUONG, TT_TONKHO.NGUONDUOC_ID, NH.TENNGUONDUOC        , TAMNGUNG = CASE WHEN TM_DUOC.TAMNGUNG = '1' OR nh.TAMNGUNG = '1' OR KD.TAMNGUNG = '1' THEN '1' ELSE '0' END        , TM_DUOC.DANGTRINHBAY        from TM_DUOC        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = TM_DUOC.DONVITINH_ID        left join TM_TENDUOC on TM_DUOC.TENDUOC_ID = TM_TENDUOC.TENDUOC_ID and TM_DUOC.BENHVIEN_ID = 'HLU01' and TM_DUOC.TAMNGUNG = '0'        left join TM_LOAIDUOC on TM_LOAIDUOC.LOAIDUOC_ID = TM_DUOC.LOAIDUOC_ID and TM_LOAIDUOC.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG on (TM_LOAIDUOC.LOAIVATTU_ID = TM_DUOC_HANDUNG.LOAIDUOC and TM_DUOC_HANDUNG.BENHVIEN_ID = 'HLU01')        inner join        (select LTRIM(A.KHODUOC_ID) + '_' + LTRIM(A.DUOC_ID) + '_' + LTRIM(ISNULL(A.NGUONDUOC_ID,'')) as DUOC_KEY, A.KHODUOC_ID, A.DUOC_ID,A.NGUONDUOC_ID,        SUM(isnull(A.SOLUONG,0)) as SOLUONG        from        (select SUM(SOLUONG) as SOLUONG, KHODUOC_ID, DUOC_ID, NGUONDUOC_ID from TT_DUOC_KYGUI_TONKHO        where BENHVIEN_ID = 'HLU01' group by KHODUOC_ID, DUOC_ID, NGUONDUOC_ID) A        group by LTRIM(A.KHODUOC_ID) + '_' + LTRIM(A.DUOC_ID) + '_' + LTRIM(A.NGUONDUOC_ID), A.KHODUOC_ID, A.DUOC_ID, A.NGUONDUOC_ID)        TT_TONKHO on TT_TONKHO.DUOC_ID = TM_DUOC.DUOC_ID        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = TT_TONKHO.NGUONDUOC_ID and nh.BENHVIEN_ID = 'HLU01'        LEFT JOIN TM_KHODUOC KD ON KD.KHODUOC_ID = TT_TONKHO.KHODUOC_ID        where TM_DUOC.BENHVIEN_ID = 'HLU01' AND TT_TONKHO.SOLUONG >= 0]
2019-09-20 11:11:15,966 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM018']
2019-09-20 11:11:16,011 [5] DEBUG - Statement Id: [DAO00027_GetListDuocTonKho] PreparedStatement : [select distinct TT_TONKHO.DUOC_KEY, LTRIM(TT_TONKHO.KHODUOC_ID) as KHODUOC_ID, TM_DUOC.DUOC_ID, TM_LOAIDUOC.MALOAIDUOC,TM_DUOC.SOVISA,TM_DUOC.TYLE_VAT,TM_DUOC.COTOA,        TM_DUOC.MADUOC, TM_DUOC.TENHANG, TM_DUOC.TENDUOCDAYDU, dvt.TENDONVITINH as DONVITINH,  TM_DUOC.DONVITINH_ID,TM_DUOC.BHYT,                TM_DUOC.TENHOATCHAT,          TM_DUOC.HAMLUONG, TM_DUOC.HANGSANXUAT, TM_DUOC.QUOCGIA, TM_DUOC.LOAIDUOC_ID, TM_DUOC.DUONGDUNG_ID,        TM_TENDUOC.TENDUOC, TM_TENDUOC.TENDUOC_EN, TM_TENDUOC.MAQUOCTE, TM_TENDUOC.MAQUOCTEBT,        TM_LOAIDUOC.LOAIVATTU_ID, TM_DUOC.BENHVIEN_ID,        TT_TONKHO.SOLUONG, TM_DUOC.VTYT_PHANLOAI, TM_DUOC.PHAMVI, TT_TONKHO.NGUONDUOC_ID, NG.TENNGUONDUOC AS TENNGUONDUOC        , TAMNGUNG = CASE WHEN TM_DUOC.TAMNGUNG = '1' OR NG.TAMNGUNG = '1' OR KD.TAMNGUNG = '1' THEN '1' ELSE '0' END        , TM_DUOC.DANGTRINHBAY        from TM_DUOC        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = TM_DUOC.DONVITINH_ID        left join TM_TENDUOC on TM_DUOC.TENDUOC_ID = TM_TENDUOC.TENDUOC_ID and TM_DUOC.BENHVIEN_ID = 'HLU01' and TM_DUOC.TAMNGUNG = '0'        left join TM_LOAIDUOC on TM_LOAIDUOC.LOAIDUOC_ID = TM_DUOC.LOAIDUOC_ID and TM_LOAIDUOC.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG on (TM_LOAIDUOC.LOAIVATTU_ID = TM_DUOC_HANDUNG.LOAIDUOC and TM_DUOC_HANDUNG.BENHVIEN_ID = 'HLU01')        inner join        (select LTRIM(A.KHODUOC_ID) + '_' + LTRIM(A.DUOC_ID) + '_' + LTRIM(ISNULL(A.NGUONDUOC_ID,'')) as DUOC_KEY, A.KHODUOC_ID, A.DUOC_ID, A.NGUONDUOC_ID,        SUM(isnull(A.SOLUONG,0)) as SOLUONG        from        (select SUM(SOLUONG) as SOLUONG, KHODUOC_ID, DUOC_ID, NGUONDUOC_ID from TT_DUOC_TONKHO        where BENHVIEN_ID = 'HLU01' group by KHODUOC_ID, DUOC_ID, NGUONDUOC_ID) A        group by LTRIM(A.KHODUOC_ID) + '_' + LTRIM(A.DUOC_ID) + '_' + LTRIM(ISNULL(A.NGUONDUOC_ID,'')), A.KHODUOC_ID, A.DUOC_ID, NGUONDUOC_ID        ) TT_TONKHO on TT_TONKHO.DUOC_ID = TM_DUOC.DUOC_ID        LEFT JOIN TM_NGUONHANG NG ON NG.NGUONDUOC_ID = TT_TONKHO.NGUONDUOC_ID        LEFT JOIN TM_KHODUOC KD ON KD.KHODUOC_ID = TT_TONKHO.KHODUOC_ID        where TM_DUOC.BENHVIEN_ID = 'HLU01' and TT_TONKHO.SOLUONG >= 0]
2019-09-20 11:11:18,778 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM023']
2019-09-20 11:11:18,827 [5] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoVaBooking] PreparedStatement : [declare @NGUONDUOC_MACDINH varchar(5) = '0';        declare @TOAMUANGOAI int = 0;        select @NGUONDUOC_MACDINH = isnull(VALUE,0) from TM_SYS_APPSETTINGS where CODE = 'PHA_NGUONDUOC'        select @TOAMUANGOAI = isnull(VALUE,0) from TM_SYS_APPSETTINGS where CODE = 'OPD_TOAMUANGOAI_DUNGDANHMUC_DUOC'                if @TOAMUANGOAI = 1        begin        select  distinct '0' + '_' + LTRIM(d.DUOC_ID) + '_' + @NGUONDUOC_MACDINH as DUOC_KEY, 0 as PHAMVI_ID, @NGUONDUOC_MACDINH as NGUONDUOC_ID, null as TENNGUONDUOC, null as TINHTIEN, d.DUOC_ID, ld.MALOAIDUOC,        d.SOVISA,d.TYLE_VAT,d.COTOA, d.MADUOC, d.TENHANG, d.TENDUOCDAYDU, d.DONVITINH as DONVITINH, d.BHYT,        d.TENHOATCHAT, d.HAMLUONG, d.HANGSANXUAT, d.QUOCGIA, d.LOAIDUOC_ID, d.DUONGDUNG_ID, d.TINHTIEN_PTTT,        ten.TENDUOC, ten.TENDUOC_EN, ten.MAQUOCTE, ten.MAQUOCTEBT,        '' as BHYT_TEXT        , ld.LOAIVATTU_ID        , d.BENHVIEN_ID,        999999999 as SOLUONG, d.VTYT_PHANLOAI, d.PHAMVI, d.SUASOLUONGTONGHOP, d.MADUOCBV, d.DANGTRINHBAY        , TAMNGUNG = CASE WHEN d.TAMNGUNG = '1' THEN '1' ELSE '0' END        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        union all        select  distinct tk.DUOC_KEY, LTRIM(tk.PHAMVI_ID) as PHAMVI_ID, tk.NGUONDUOC_ID, nh.TENNGUONDUOC, nh.TINHTIEN, d.DUOC_ID, ld.MALOAIDUOC,        d.SOVISA,d.TYLE_VAT,d.COTOA, d.MADUOC, d.TENHANG, d.TENDUOCDAYDU, d.DONVITINH as DONVITINH, d.BHYT,        d.TENHOATCHAT, d.HAMLUONG, d.HANGSANXUAT, d.QUOCGIA, d.LOAIDUOC_ID, d.DUONGDUNG_ID, d.TINHTIEN_PTTT,        ten.TENDUOC, ten.TENDUOC_EN, ten.MAQUOCTE, ten.MAQUOCTEBT,        CASE WHEN d.BHYT = '1' THEN 'BHYT' ELSE '' END as BHYT_TEXT        , ld.LOAIVATTU_ID        , d.BENHVIEN_ID,        tk.SOLUONG, d.VTYT_PHANLOAI, d.PHAMVI, d.SUASOLUONGTONGHOP, d.MADUOCBV, d.DANGTRINHBAY        , TAMNGUNG = CASE WHEN d.TAMNGUNG = '1' OR nh.TAMNGUNG = '1' OR kd.TAMNGUNG = '1' THEN '1' ELSE '0' END        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        inner join        (        select  LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')) DUOC_KEY, (SUM(dtk.SOLUONG) - isnull(sum(A.SOLUONG),0) - isnull(sum(B.SOLUONG),0)) SOLUONG, pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        from (select sum(soluong) soluong,duoc_id,nguonduoc_id,khoduoc_id,benhvien_id from TT_DUOC_TONKHO  group by duoc_id,nguonduoc_id,khoduoc_id,benhvien_id) dtk        inner join TM_DUOC_PHAMVISD_MAPPING pvsd on dtk.KHODUOC_ID = pvsd.KHODUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NOITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) B on B.DUOC_ID = dtk.DUOC_ID and B.SOLUONG > 0 and B.PHAMVI_ID = pvsd.PHAMVI_ID and B.NGUONHANG_ID = dtk.NGUONDUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NGOAITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) A on A.DUOC_ID = dtk.DUOC_ID and A.SOLUONG > 0 and A.PHAMVI_ID = pvsd.PHAMVI_ID and A.NGUONHANG_ID = dtk.NGUONDUOC_ID        where dtk.SOLUONG > 0 and dtk.BENHVIEN_ID = 'HLU01'        group by LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')), pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        ) tk on tk.DUOC_ID = d.DUOC_ID        left join TM_DUOC_PHAMVISUDUNG kd on kd.PHAMVI_ID = tk.PHAMVI_ID and kd.BENHVIEN_ID = 'HLU01'        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = tk.NGUONDUOC_ID and nh.BENHVIEN_ID = 'HLU01'        where d.BENHVIEN_ID = 'HLU01'  and tk.SOLUONG >= 0        end        else        begin                  select  distinct tk.DUOC_KEY, LTRIM(tk.PHAMVI_ID) as PHAMVI_ID, tk.NGUONDUOC_ID, nh.TENNGUONDUOC, nh.TINHTIEN, d.DUOC_ID, ld.MALOAIDUOC,        d.SOVISA,d.TYLE_VAT,d.COTOA, d.MADUOC, d.TENHANG, d.TENDUOCDAYDU, d.DONVITINH as DONVITINH, d.BHYT,        d.TENHOATCHAT, d.HAMLUONG, d.HANGSANXUAT, d.QUOCGIA, d.LOAIDUOC_ID, d.DUONGDUNG_ID, d.TINHTIEN_PTTT,        ten.TENDUOC, ten.TENDUOC_EN, ten.MAQUOCTE, ten.MAQUOCTEBT,        CASE WHEN d.BHYT = '1' THEN 'BHYT' ELSE '' END as BHYT_TEXT        , ld.LOAIVATTU_ID        , d.BENHVIEN_ID,        tk.SOLUONG, d.VTYT_PHANLOAI, d.PHAMVI, d.SUASOLUONGTONGHOP, d.MADUOCBV, d.DANGTRINHBAY        , TAMNGUNG = CASE WHEN d.TAMNGUNG = '1' OR nh.TAMNGUNG = '1' OR kd.TAMNGUNG = '1' THEN '1' ELSE '0' END        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        inner join        (        select  LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')) DUOC_KEY, (SUM(dtk.SOLUONG) - isnull(sum(A.SOLUONG),0) - isnull(sum(B.SOLUONG),0)) SOLUONG, pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        from (select sum(soluong) soluong,duoc_id,nguonduoc_id,khoduoc_id,benhvien_id from TT_DUOC_TONKHO  group by duoc_id,nguonduoc_id,khoduoc_id,benhvien_id) dtk        inner join TM_DUOC_PHAMVISD_MAPPING pvsd on dtk.KHODUOC_ID = pvsd.KHODUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NOITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) B on B.DUOC_ID = dtk.DUOC_ID and B.SOLUONG > 0 and B.PHAMVI_ID = pvsd.PHAMVI_ID and B.NGUONHANG_ID = dtk.NGUONDUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NGOAITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) A on A.DUOC_ID = dtk.DUOC_ID and A.SOLUONG > 0 and A.PHAMVI_ID = pvsd.PHAMVI_ID and A.NGUONHANG_ID = dtk.NGUONDUOC_ID        where dtk.SOLUONG > 0 and dtk.BENHVIEN_ID = 'HLU01'        group by LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')), pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        ) tk on tk.DUOC_ID = d.DUOC_ID        left join TM_DUOC_PHAMVISUDUNG kd on kd.PHAMVI_ID = tk.PHAMVI_ID and kd.BENHVIEN_ID = 'HLU01'        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = tk.NGUONDUOC_ID and nh.BENHVIEN_ID = 'HLU01'        where d.BENHVIEN_ID = 'HLU01'  and tk.SOLUONG >= 0        end]
2019-09-20 11:11:21,145 [5] DEBUG - Statement Id: [DAO00320_GetList] PreparedStatement : [select M.*            from TM_MAU M            LEFT JOIN TM_MAU_DONVITINH DVT on M.DONVITINH_ID=DVT.DONVITINH_ID            where            M.TAMNGUNG = '0'            and M.BENHVIEN_ID = 'HLU01'            order by M.TENMAU]
2019-09-20 11:11:21,211 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM071']
2019-09-20 11:11:21,248 [5] DEBUG - Statement Id: [DAO00322_GetListMauTonKhoForCreateCached] PreparedStatement : [SELECT DISTINCT          TK.MAU_KEY, TK.KHOMAU_ID, M.MAU_ID, M.MAMAU, M.TENMAU, M.NHOM_ABO, M.NHOM_RH, M.LOAIMAU_ID,          TK.SOLONHAP_ID, SLN.SOLONHAP, SLN.SOKIEMSOAT, TK.NGUONHANG_ID, NG.TENNGUONMAU, M.BENHVIEN_ID, M.DONVITINH_ID,          SUM(tk.SOLUONG) AS SOLUONG,K.TENKHO,DVT.TENDONVITINH          FROM TT_MAU_TONKHO TK          JOIN TM_KHO K ON TK.KHOMAU_ID = K.KHO_ID          JOIN TT_MAU_CHUNGTU_SOLONHAP SLN ON TK.SOLONHAP_ID = SLN.SOLONHAP_ID          JOIN TM_MAU M on TK.MAU_ID = M.MAU_ID and M.TAMNGUNG = '0'          LEFT JOIN TM_MAU_DONVITINH DVT on M.DONVITINH_ID=DVT.DONVITINH_ID          LEFT JOIN TM_NGUONMAU NG ON NG.NGUONMAU_ID = TK.NGUONHANG_ID          WHERE TK.SOLUONG > 0          GROUP BY TK.MAU_KEY, TK.KHOMAU_ID, M.MAU_ID, M.MAMAU, M.TENMAU, M.NHOM_ABO, M.NHOM_RH, M.LOAIMAU_ID,          TK.SOLONHAP_ID, SLN.SOLONHAP, SLN.SOKIEMSOAT,TK.NGUONHANG_ID, NG.TENNGUONMAU, M.BENHVIEN_ID, M.DONVITINH_ID,K.TENKHO,DVT.TENDONVITINH]
2019-09-20 11:11:21,336 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM073']
2019-09-20 11:11:21,371 [5] DEBUG - Statement Id: [DAO00322_GetListMauTonKhoTruBooking] PreparedStatement : [select distinct          TK.MAU_KEY, TK.KHOMAU_ID, M.MAU_ID, M.MAMAU, M.TENMAU, M.NHOM_ABO, M.NHOM_RH, M.LOAIMAU_ID, M.DONVITINH_ID,          TK.SOLONHAP_ID, TK.SOLONHAP, TK.SOKIEMSOAT,M.PHAMVI, TK.NGUONHANG_ID, NG.TENNGUONMAU, M.BENHVIEN_ID,          TK.SOLUONG,TK.TENKHO,DVT.TENDONVITINH          from TM_MAU M          JOIN          (          select          A.MAU_KEY, A.KHOMAU_ID, A.MAU_ID ,a.NGUONHANG_ID, A.SOLONHAP_ID, A.SOLONHAP, A.SOKIEMSOAT, A.SOLUONG,A.TENKHO          from          (          select KHOMAU_ID, TK.MAU_ID, TK.NGUONHANG_ID, TK.MAU_KEY, SLN.SOLONHAP_ID, SLN.SOLONHAP, SLN.SOKIEMSOAT, ISNULL(TK.SOLUONG,0) - ISNULL(book.SOLUONG,0) as SOLUONG,K.TENKHO          from TT_MAU_TONKHO TK          JOIN TM_KHO K ON TK.KHOMAU_ID = K.KHO_ID          inner join TT_MAU_CHUNGTU_SOLONHAP SLN ON TK.SOLONHAP_ID = SLN.SOLONHAP_ID          left join dbo.TT_MAU_TONKHO_BOOK book ON book.MAU_KEY = TK.MAU_KEY AND book.TRANGTHAI = 'HIEULUC'          where ISNULL(TK.SOLUONG,0) - ISNULL(book.SOLUONG,0) > 0          ) A          )TK on TK.MAU_ID = M.MAU_ID and M.TAMNGUNG = '0'          LEFT JOIN TM_MAU_DONVITINH DVT on M.DONVITINH_ID=DVT.DONVITINH_ID          LEFT JOIN TM_NGUONMAU NG ON NG.NGUONMAU_ID = TK.NGUONHANG_ID]
2019-09-20 11:11:21,442 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM072']
2019-09-20 11:11:22,362 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'MAIN'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2019-09-20 11:11:23,372 [1] DEBUG - Statement Id: [DAO00002_FormList] PreparedStatement : [select              TM_SYS_FORM.HOSPITAL_ID,              TM_SYS_FORM.NAME,              TM_SYS_FORM.CLASS,              TM_SYS_FORM.ASSEMBLY,              TM_SYS_FORM.TITLE_VI as TITLE              from TM_SYS_FORM              where HOSPITAL_ID = 'HLU01']
2019-09-20 11:11:27,956 [1] DEBUG - Statement Id: [DAO00300_GetShortcutListByUserID] PreparedStatement : [SELECT S.SHORTCUT_CODE, S.SHORTCUT_VALUE              FROM TM_SHORTCUT AS S              WHERE S.BENHVIEN_ID = 'HLU01' AND S.USER_ID = '1' AND TAMNGUNG = '0']
2019-09-20 11:11:27,991 [1] DEBUG - Statement Id: [DAO00087_GetList] PreparedStatement : [select CODE, VALUE, BENHVIEN_ID              from TM_SYS_APPSETTINGS              where LOCKED = '0' and BENHVIEN_ID = 'HLU01'              order by SETTING_ID]
2019-09-20 11:11:28,063 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'MSG01'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2019-09-20 11:11:28,193 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'MSG02'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2019-09-20 11:11:28,330 [1] DEBUG - Statement Id: [DAO00008_GetUserSettings] PreparedStatement : [select A.*, B.TENKHO , C.TENPHONGBAN, B.MAKHO, C.MAPHONGBAN          from TM_SYS_USERS A          left join TM_KHODUOC B on B.KHODUOC_ID = A.INVENTORY_ID          left join TM_PHONGBAN C on (C.PHONGBAN_ID = A.WORKING_DEPT_ID and C.BENHVIEN_ID =  @param0 )          left join TM_SYS_USERKHO D on (D.ACCOUNT_ID = A.ACCOUNT_ID and D.HOSPITAL_ID =  @param0 )          where          A.HOSPITAL_ID =  @param0            and                 A.ACCOUNT_ID =  @param1]
2019-09-20 11:11:28,332 [1] DEBUG - Statement Id: [DAO00008_GetUserSettings] Parameters: [@param0=[HOSPITAL_ID,HLU01], @param1=[ACCOUNT_ID,113]]
2019-09-20 11:11:28,332 [1] DEBUG - Statement Id: [DAO00008_GetUserSettings] Types: [@param0=[String, System.String], @param1=[String, System.String]]
2019-09-20 11:11:28,368 [1] DEBUG - Statement Id: [DAO00008_GetUserInvSettings] PreparedStatement : [select A.*, B.TENKHO, B.MAKHO, B.LOAIKHO_ID, B.KHOQUANLY_ID          from TM_SYS_USERKHO A          left join TM_KHO B on B.MODULE_ID = A.MODULE_ID and B.KHO_ID = A.KHO_ID          where A.HOSPITAL_ID =  @param0  and A.ACCOUNT_ID =  @param1           order by B.TENKHO]
2019-09-20 11:11:28,368 [1] DEBUG - Statement Id: [DAO00008_GetUserInvSettings] Parameters: [@param0=[HOSPITAL_ID,HLU01], @param1=[ACCOUNT_ID,113]]
2019-09-20 11:11:28,368 [1] DEBUG - Statement Id: [DAO00008_GetUserInvSettings] Types: [@param0=[String, System.String], @param1=[String, System.String]]
2019-09-20 11:11:28,507 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'COM30'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2019-09-20 11:11:28,654 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'RIS04'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2019-09-20 11:11:37,164 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'MENU1'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2019-09-20 11:11:37,402 [1] DEBUG - Statement Id: [DAO00011_GetList] PreparedStatement : [select              TM_SYS_MENU.ID,              TM_SYS_MENU.PARENTID,              TM_SYS_MENU.SCREEN,              TM_SYS_MENU.SMALLIMAGE,              TM_SYS_MENU.LARGEIMAGE,              TM_SYS_MENU.DESCRIPTION,              TM_SYS_MENU.TYPE,              TM_SYS_MENU.TITLE_VI as TITLE              from TM_SYS_MENU              where TM_SYS_MENU.HOSPITAL_ID = 'HLU01' and TM_SYS_MENU.ACTIVE = '1'               AND                   (TM_SYS_MENU.TYPE & '8' = '8')                             order by TM_SYS_MENU.ORDERNUM]
2019-09-20 11:11:37,737 [1] DEBUG - Statement Id: [DAO00011_usermenu_list] PreparedStatement : [select              TM_SYS_HOMEMENU.MENUID as ID,              TM_SYS_MENU.TITLE_VI as TITLE,              TM_SYS_MENU.SCREEN,              TM_SYS_MENU.SMALLIMAGE,              TM_SYS_MENU.LARGEIMAGE,              TM_SYS_MENU.TYPE              from TM_SYS_HOMEMENU              left join TM_SYS_MENU on TM_SYS_MENU.ID = TM_SYS_HOMEMENU.MENUID and TM_SYS_MENU.HOSPITAL_ID = TM_SYS_HOMEMENU.HOSPITAL_ID              where TM_SYS_HOMEMENU.HOSPITAL_ID = 'HLU01' and TM_SYS_HOMEMENU.USERID = '113' and TM_SYS_MENU.ACTIVE = '1'               AND                   (TM_SYS_MENU.TYPE & '8' = '8')                             ORDER BY TM_SYS_HOMEMENU.ORDERNUM]
2019-09-20 11:12:26,906 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'COM31'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2019-09-20 11:12:27,115 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'ORM28'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2019-09-20 11:12:35,583 [1] DEBUG - Statement Id: [DAO00066_GetBENHAN_TIEPNHAN] PreparedStatement : [select top 1 *        from TT_NOITRU_BENHAN        where TIEPNHAN_ID = '27022'  and BENHVIEN_ID = 'HLU01'        order by NGAYTAO desc]
2019-09-20 11:12:35,676 [1] DEBUG - Statement Id: [DAO00014_GetInPatientStatus] PreparedStatement : [select TRANGTHAI, isnull(KHOACHUYENDEN_ID, KHOAVAO_ID) as KHOAHIENTAI from TT_NOITRU_BENHAN        where        TIEPNHAN_ID = '27022'        and BENHVIEN_ID = 'HLU01'         and           BENHAN_ID = '5800']
2019-09-20 11:12:35,773 [1] DEBUG - Statement Id: [DAO00048_TT_PHAUTHUAT_GetList] PreparedStatement : [select *              from TT_PHAUTHUAT               where                             TT_PHAUTHUAT.LOAI = 'P'                       and                           TT_PHAUTHUAT.TIEPNHAN_ID = 27022                       and                           TT_PHAUTHUAT.BENHVIEN_ID = 'HLU01'                                     order by PHAUTHUAT_ID DESC]
2019-09-20 11:12:35,820 [1] DEBUG - Statement Id: [DAO00048_GetListLoaiGacTrongPTTT] PreparedStatement : [select DICTIONARY_ID, DICTIONARY_CODE, DICTIONARY_NAME          from LST_DICTIONARY          where DICTIONARY_TYPE_CODE = 'LoaiGacPTTT'          and ENABLED = '1']
2019-09-20 11:12:37,513 [1] DEBUG - Statement Id: [DAO00048_GetDSLoaiGacDaGhiNhan] PreparedStatement : [select A.KIEMSOATGAC_ID, A.BENHNHAN_ID, A.TIEPNHAN_ID, A.BENHAN_ID, A.PHAUTHUAT_ID, A.LOAIPT_TT, A.LOAIGAC_ID          , A.NGAYGHINHAN, A.THOIGIANGHINHAN, A.SOLUONG, A.SOLUONGDASUDUNG, A.SOLUONGCONLAI, A.GHICHU, A.NGUOINHANDUNGCU_ID          , B.DICTIONARY_CODE AS MALOAIGAC, B.DICTIONARY_NAME AS TENLOAIGAC          from TT_PHAUTHUAT_GHINHANGAC A          inner join LST_DICTIONARY B on B.DICTIONARY_ID = A.LOAIGAC_ID          where A.PHAUTHUAT_ID = 3742 and A.BENHVIEN_ID = 'HLU01']
2019-09-20 11:12:38,040 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'COM98'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2019-09-20 11:12:51,645 [1] DEBUG - Statement Id: [DAO00048_GetDSLoaiGacDaGhiNhan] PreparedStatement : [select A.KIEMSOATGAC_ID, A.BENHNHAN_ID, A.TIEPNHAN_ID, A.BENHAN_ID, A.PHAUTHUAT_ID, A.LOAIPT_TT, A.LOAIGAC_ID          , A.NGAYGHINHAN, A.THOIGIANGHINHAN, A.SOLUONG, A.SOLUONGDASUDUNG, A.SOLUONGCONLAI, A.GHICHU, A.NGUOINHANDUNGCU_ID          , B.DICTIONARY_CODE AS MALOAIGAC, B.DICTIONARY_NAME AS TENLOAIGAC          from TT_PHAUTHUAT_GHINHANGAC A          inner join LST_DICTIONARY B on B.DICTIONARY_ID = A.LOAIGAC_ID          where A.PHAUTHUAT_ID = 3742 and A.BENHVIEN_ID = 'HLU01']
2019-09-20 11:13:05,320 [1] DEBUG - Statement Id: [DAO00001_DBList] PreparedStatement : [select *              from TM_SYS_SERVER              where HOSPITAL_ID = '_SYSTEM_' and TYPE = 'D']
2019-09-20 11:13:05,356 [1] DEBUG - Statement Id: [DAO00001_DaoList] PreparedStatement : [select              TM_SYS_SERVICEMAP.ID,              TM_SYS_SERVICEMAP.HOSPITAL_ID,              TM_SYS_SERVICEMAP.DB_NAME,              TM_SYS_SERVICEMAP.TYPE,              TM_SYS_SERVICEMAP.NAME,              TM_SYS_SERVICEMAP.CLASS,              (TM_SYS_DIC.VALUE + '.' + TM_SYS_SERVICEMAP.CLASS) as CLASSFULL,              TM_SYS_SERVICEMAP.ASSEMBLY              from TM_SYS_SERVICEMAP              inner join TM_SYS_DIC              on TM_SYS_SERVICEMAP.NAMESPACE = TM_SYS_DIC.ID              where HOSPITAL_ID = '_SYSTEM_' AND TYPE = 'D' AND ACTIVE = '1'              order by DB_NAME]
2019-09-20 11:13:05,386 [1] DEBUG - Statement Id: [DAO00001_ServiceList] PreparedStatement : [select              TM_SYS_SERVICEMAP.ID,              TM_SYS_SERVICEMAP.HOSPITAL_ID,              TM_SYS_SERVICEMAP.DB_NAME,              TM_SYS_SERVICEMAP.TYPE,              TM_SYS_SERVICEMAP.NAME,              TM_SYS_SERVICEMAP.CLASS,              (TM_SYS_DIC.VALUE + '.' + TM_SYS_SERVICEMAP.CLASS) as CLASSFULL,              TM_SYS_SERVICEMAP.ASSEMBLY,              TM_SYS_SERVER.URL              from TM_SYS_SERVICEMAP              inner join TM_SYS_DIC on TM_SYS_SERVICEMAP.NAMESPACE = TM_SYS_DIC.ID              inner join TM_SYS_SERVER on (TM_SYS_SERVICEMAP.DB_NAME = TM_SYS_SERVER.NAME) and (TM_SYS_SERVER.HOSPITAL_ID = '_SYSTEM_')              where TM_SYS_SERVICEMAP.HOSPITAL_ID = '_SYSTEM_' AND TM_SYS_SERVICEMAP.TYPE = 'S'  AND ACTIVE = '1'              order by URL]
2019-09-20 11:13:05,599 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = '_SYSTEM_'               AND                   TM_SYS_SCREEN.PAGE = 'LOGIN'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2019-09-20 11:13:06,218 [1] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = '_SYSTEM_'               AND                   TM_SYS_CACHE.ACTIVE = '1']
2019-09-20 11:14:02,737 [1] DEBUG - Statement Id: [DAO00001_DBList] PreparedStatement : [select *              from TM_SYS_SERVER              where HOSPITAL_ID = 'HLU01' and TYPE = 'D']
2019-09-20 11:14:02,839 [1] DEBUG - Statement Id: [DAO00001_DaoList] PreparedStatement : [select              TM_SYS_SERVICEMAP.ID,              TM_SYS_SERVICEMAP.HOSPITAL_ID,              TM_SYS_SERVICEMAP.DB_NAME,              TM_SYS_SERVICEMAP.TYPE,              TM_SYS_SERVICEMAP.NAME,              TM_SYS_SERVICEMAP.CLASS,              (TM_SYS_DIC.VALUE + '.' + TM_SYS_SERVICEMAP.CLASS) as CLASSFULL,              TM_SYS_SERVICEMAP.ASSEMBLY              from TM_SYS_SERVICEMAP              inner join TM_SYS_DIC              on TM_SYS_SERVICEMAP.NAMESPACE = TM_SYS_DIC.ID              where HOSPITAL_ID = 'HLU01' AND TYPE = 'D' AND ACTIVE = '1'              order by DB_NAME]
2019-09-20 11:14:04,061 [1] DEBUG - Statement Id: [DAO00001_ServiceList] PreparedStatement : [select              TM_SYS_SERVICEMAP.ID,              TM_SYS_SERVICEMAP.HOSPITAL_ID,              TM_SYS_SERVICEMAP.DB_NAME,              TM_SYS_SERVICEMAP.TYPE,              TM_SYS_SERVICEMAP.NAME,              TM_SYS_SERVICEMAP.CLASS,              (TM_SYS_DIC.VALUE + '.' + TM_SYS_SERVICEMAP.CLASS) as CLASSFULL,              TM_SYS_SERVICEMAP.ASSEMBLY,              TM_SYS_SERVER.URL              from TM_SYS_SERVICEMAP              inner join TM_SYS_DIC on TM_SYS_SERVICEMAP.NAMESPACE = TM_SYS_DIC.ID              inner join TM_SYS_SERVER on (TM_SYS_SERVICEMAP.DB_NAME = TM_SYS_SERVER.NAME) and (TM_SYS_SERVER.HOSPITAL_ID = 'HLU01')              where TM_SYS_SERVICEMAP.HOSPITAL_ID = 'HLU01' AND TM_SYS_SERVICEMAP.TYPE = 'S'  AND ACTIVE = '1'              order by URL]
2019-09-20 11:14:04,206 [16] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1']
2019-09-20 11:14:04,712 [16] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM005']
2019-09-20 11:14:04,831 [16] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM015']
2019-09-20 11:14:04,930 [16] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM067']
2019-09-20 11:14:05,046 [16] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM008']
2019-09-20 11:14:05,125 [16] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM068']
2019-09-20 11:14:05,204 [16] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM006']
2019-09-20 11:14:05,288 [16] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM030']
2019-09-20 11:14:05,395 [16] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM025']
2019-09-20 11:14:05,478 [16] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM024']
2019-09-20 11:14:06,305 [16] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM033']
2019-09-20 11:14:06,343 [16] DEBUG - Statement Id: [DAO00027_GetListDuocKyGuiTonKho] PreparedStatement : [select  distinct TT_TONKHO.DUOC_KEY, LTRIM(TT_TONKHO.KHODUOC_ID) as KHODUOC_ID, TM_DUOC.DUOC_ID, TM_LOAIDUOC.MALOAIDUOC,TM_DUOC.SOVISA,TM_DUOC.TYLE_VAT,TM_DUOC.COTOA,        TM_DUOC.MADUOC, TM_DUOC.TENHANG, TM_DUOC.TENDUOCDAYDU, dvt.TENDONVITINH as DONVITINH,  TM_DUOC.DONVITINH_ID,TM_DUOC.BHYT,TM_DUOC.PHAMVI,        TM_DUOC.TENHOATCHAT, TM_DUOC.HAMLUONG, TM_DUOC.HANGSANXUAT, TM_DUOC.QUOCGIA, TM_DUOC.LOAIDUOC_ID, TM_DUOC.DUONGDUNG_ID,        TM_TENDUOC.TENDUOC, TM_TENDUOC.TENDUOC_EN, TM_TENDUOC.MAQUOCTE, TM_TENDUOC.MAQUOCTEBT,        TM_LOAIDUOC.LOAIVATTU_ID, TM_DUOC.BENHVIEN_ID,TT_TONKHO.SOLUONG, TT_TONKHO.NGUONDUOC_ID, NH.TENNGUONDUOC        , TAMNGUNG = CASE WHEN TM_DUOC.TAMNGUNG = '1' OR nh.TAMNGUNG = '1' OR KD.TAMNGUNG = '1' THEN '1' ELSE '0' END        , TM_DUOC.DANGTRINHBAY        from TM_DUOC        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = TM_DUOC.DONVITINH_ID        left join TM_TENDUOC on TM_DUOC.TENDUOC_ID = TM_TENDUOC.TENDUOC_ID and TM_DUOC.BENHVIEN_ID = 'HLU01' and TM_DUOC.TAMNGUNG = '0'        left join TM_LOAIDUOC on TM_LOAIDUOC.LOAIDUOC_ID = TM_DUOC.LOAIDUOC_ID and TM_LOAIDUOC.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG on (TM_LOAIDUOC.LOAIVATTU_ID = TM_DUOC_HANDUNG.LOAIDUOC and TM_DUOC_HANDUNG.BENHVIEN_ID = 'HLU01')        inner join        (select LTRIM(A.KHODUOC_ID) + '_' + LTRIM(A.DUOC_ID) + '_' + LTRIM(ISNULL(A.NGUONDUOC_ID,'')) as DUOC_KEY, A.KHODUOC_ID, A.DUOC_ID,A.NGUONDUOC_ID,        SUM(isnull(A.SOLUONG,0)) as SOLUONG        from        (select SUM(SOLUONG) as SOLUONG, KHODUOC_ID, DUOC_ID, NGUONDUOC_ID from TT_DUOC_KYGUI_TONKHO        where BENHVIEN_ID = 'HLU01' group by KHODUOC_ID, DUOC_ID, NGUONDUOC_ID) A        group by LTRIM(A.KHODUOC_ID) + '_' + LTRIM(A.DUOC_ID) + '_' + LTRIM(A.NGUONDUOC_ID), A.KHODUOC_ID, A.DUOC_ID, A.NGUONDUOC_ID)        TT_TONKHO on TT_TONKHO.DUOC_ID = TM_DUOC.DUOC_ID        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = TT_TONKHO.NGUONDUOC_ID and nh.BENHVIEN_ID = 'HLU01'        LEFT JOIN TM_KHODUOC KD ON KD.KHODUOC_ID = TT_TONKHO.KHODUOC_ID        where TM_DUOC.BENHVIEN_ID = 'HLU01' AND TT_TONKHO.SOLUONG >= 0]
2019-09-20 11:14:06,432 [16] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM018']
2019-09-20 11:14:06,470 [16] DEBUG - Statement Id: [DAO00027_GetListDuocTonKho] PreparedStatement : [select distinct TT_TONKHO.DUOC_KEY, LTRIM(TT_TONKHO.KHODUOC_ID) as KHODUOC_ID, TM_DUOC.DUOC_ID, TM_LOAIDUOC.MALOAIDUOC,TM_DUOC.SOVISA,TM_DUOC.TYLE_VAT,TM_DUOC.COTOA,        TM_DUOC.MADUOC, TM_DUOC.TENHANG, TM_DUOC.TENDUOCDAYDU, dvt.TENDONVITINH as DONVITINH,  TM_DUOC.DONVITINH_ID,TM_DUOC.BHYT,                TM_DUOC.TENHOATCHAT,          TM_DUOC.HAMLUONG, TM_DUOC.HANGSANXUAT, TM_DUOC.QUOCGIA, TM_DUOC.LOAIDUOC_ID, TM_DUOC.DUONGDUNG_ID,        TM_TENDUOC.TENDUOC, TM_TENDUOC.TENDUOC_EN, TM_TENDUOC.MAQUOCTE, TM_TENDUOC.MAQUOCTEBT,        TM_LOAIDUOC.LOAIVATTU_ID, TM_DUOC.BENHVIEN_ID,        TT_TONKHO.SOLUONG, TM_DUOC.VTYT_PHANLOAI, TM_DUOC.PHAMVI, TT_TONKHO.NGUONDUOC_ID, NG.TENNGUONDUOC AS TENNGUONDUOC        , TAMNGUNG = CASE WHEN TM_DUOC.TAMNGUNG = '1' OR NG.TAMNGUNG = '1' OR KD.TAMNGUNG = '1' THEN '1' ELSE '0' END        , TM_DUOC.DANGTRINHBAY        from TM_DUOC        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = TM_DUOC.DONVITINH_ID        left join TM_TENDUOC on TM_DUOC.TENDUOC_ID = TM_TENDUOC.TENDUOC_ID and TM_DUOC.BENHVIEN_ID = 'HLU01' and TM_DUOC.TAMNGUNG = '0'        left join TM_LOAIDUOC on TM_LOAIDUOC.LOAIDUOC_ID = TM_DUOC.LOAIDUOC_ID and TM_LOAIDUOC.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG on (TM_LOAIDUOC.LOAIVATTU_ID = TM_DUOC_HANDUNG.LOAIDUOC and TM_DUOC_HANDUNG.BENHVIEN_ID = 'HLU01')        inner join        (select LTRIM(A.KHODUOC_ID) + '_' + LTRIM(A.DUOC_ID) + '_' + LTRIM(ISNULL(A.NGUONDUOC_ID,'')) as DUOC_KEY, A.KHODUOC_ID, A.DUOC_ID, A.NGUONDUOC_ID,        SUM(isnull(A.SOLUONG,0)) as SOLUONG        from        (select SUM(SOLUONG) as SOLUONG, KHODUOC_ID, DUOC_ID, NGUONDUOC_ID from TT_DUOC_TONKHO        where BENHVIEN_ID = 'HLU01' group by KHODUOC_ID, DUOC_ID, NGUONDUOC_ID) A        group by LTRIM(A.KHODUOC_ID) + '_' + LTRIM(A.DUOC_ID) + '_' + LTRIM(ISNULL(A.NGUONDUOC_ID,'')), A.KHODUOC_ID, A.DUOC_ID, NGUONDUOC_ID        ) TT_TONKHO on TT_TONKHO.DUOC_ID = TM_DUOC.DUOC_ID        LEFT JOIN TM_NGUONHANG NG ON NG.NGUONDUOC_ID = TT_TONKHO.NGUONDUOC_ID        LEFT JOIN TM_KHODUOC KD ON KD.KHODUOC_ID = TT_TONKHO.KHODUOC_ID        where TM_DUOC.BENHVIEN_ID = 'HLU01' and TT_TONKHO.SOLUONG >= 0]
2019-09-20 11:14:07,871 [16] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM023']
2019-09-20 11:14:07,911 [16] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoVaBooking] PreparedStatement : [declare @NGUONDUOC_MACDINH varchar(5) = '0';        declare @TOAMUANGOAI int = 0;        select @NGUONDUOC_MACDINH = isnull(VALUE,0) from TM_SYS_APPSETTINGS where CODE = 'PHA_NGUONDUOC'        select @TOAMUANGOAI = isnull(VALUE,0) from TM_SYS_APPSETTINGS where CODE = 'OPD_TOAMUANGOAI_DUNGDANHMUC_DUOC'                if @TOAMUANGOAI = 1        begin        select  distinct '0' + '_' + LTRIM(d.DUOC_ID) + '_' + @NGUONDUOC_MACDINH as DUOC_KEY, 0 as PHAMVI_ID, @NGUONDUOC_MACDINH as NGUONDUOC_ID, null as TENNGUONDUOC, null as TINHTIEN, d.DUOC_ID, ld.MALOAIDUOC,        d.SOVISA,d.TYLE_VAT,d.COTOA, d.MADUOC, d.TENHANG, d.TENDUOCDAYDU, d.DONVITINH as DONVITINH, d.BHYT,        d.TENHOATCHAT, d.HAMLUONG, d.HANGSANXUAT, d.QUOCGIA, d.LOAIDUOC_ID, d.DUONGDUNG_ID, d.TINHTIEN_PTTT,        ten.TENDUOC, ten.TENDUOC_EN, ten.MAQUOCTE, ten.MAQUOCTEBT,        '' as BHYT_TEXT        , ld.LOAIVATTU_ID        , d.BENHVIEN_ID,        999999999 as SOLUONG, d.VTYT_PHANLOAI, d.PHAMVI, d.SUASOLUONGTONGHOP, d.MADUOCBV, d.DANGTRINHBAY        , TAMNGUNG = CASE WHEN d.TAMNGUNG = '1' THEN '1' ELSE '0' END        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        union all        select  distinct tk.DUOC_KEY, LTRIM(tk.PHAMVI_ID) as PHAMVI_ID, tk.NGUONDUOC_ID, nh.TENNGUONDUOC, nh.TINHTIEN, d.DUOC_ID, ld.MALOAIDUOC,        d.SOVISA,d.TYLE_VAT,d.COTOA, d.MADUOC, d.TENHANG, d.TENDUOCDAYDU, d.DONVITINH as DONVITINH, d.BHYT,        d.TENHOATCHAT, d.HAMLUONG, d.HANGSANXUAT, d.QUOCGIA, d.LOAIDUOC_ID, d.DUONGDUNG_ID, d.TINHTIEN_PTTT,        ten.TENDUOC, ten.TENDUOC_EN, ten.MAQUOCTE, ten.MAQUOCTEBT,        CASE WHEN d.BHYT = '1' THEN 'BHYT' ELSE '' END as BHYT_TEXT        , ld.LOAIVATTU_ID        , d.BENHVIEN_ID,        tk.SOLUONG, d.VTYT_PHANLOAI, d.PHAMVI, d.SUASOLUONGTONGHOP, d.MADUOCBV, d.DANGTRINHBAY        , TAMNGUNG = CASE WHEN d.TAMNGUNG = '1' OR nh.TAMNGUNG = '1' OR kd.TAMNGUNG = '1' THEN '1' ELSE '0' END        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        inner join        (        select  LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')) DUOC_KEY, (SUM(dtk.SOLUONG) - isnull(sum(A.SOLUONG),0) - isnull(sum(B.SOLUONG),0)) SOLUONG, pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        from (select sum(soluong) soluong,duoc_id,nguonduoc_id,khoduoc_id,benhvien_id from TT_DUOC_TONKHO  group by duoc_id,nguonduoc_id,khoduoc_id,benhvien_id) dtk        inner join TM_DUOC_PHAMVISD_MAPPING pvsd on dtk.KHODUOC_ID = pvsd.KHODUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NOITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) B on B.DUOC_ID = dtk.DUOC_ID and B.SOLUONG > 0 and B.PHAMVI_ID = pvsd.PHAMVI_ID and B.NGUONHANG_ID = dtk.NGUONDUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NGOAITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) A on A.DUOC_ID = dtk.DUOC_ID and A.SOLUONG > 0 and A.PHAMVI_ID = pvsd.PHAMVI_ID and A.NGUONHANG_ID = dtk.NGUONDUOC_ID        where dtk.SOLUONG > 0 and dtk.BENHVIEN_ID = 'HLU01'        group by LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')), pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        ) tk on tk.DUOC_ID = d.DUOC_ID        left join TM_DUOC_PHAMVISUDUNG kd on kd.PHAMVI_ID = tk.PHAMVI_ID and kd.BENHVIEN_ID = 'HLU01'        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = tk.NGUONDUOC_ID and nh.BENHVIEN_ID = 'HLU01'        where d.BENHVIEN_ID = 'HLU01'  and tk.SOLUONG >= 0        end        else        begin                  select  distinct tk.DUOC_KEY, LTRIM(tk.PHAMVI_ID) as PHAMVI_ID, tk.NGUONDUOC_ID, nh.TENNGUONDUOC, nh.TINHTIEN, d.DUOC_ID, ld.MALOAIDUOC,        d.SOVISA,d.TYLE_VAT,d.COTOA, d.MADUOC, d.TENHANG, d.TENDUOCDAYDU, d.DONVITINH as DONVITINH, d.BHYT,        d.TENHOATCHAT, d.HAMLUONG, d.HANGSANXUAT, d.QUOCGIA, d.LOAIDUOC_ID, d.DUONGDUNG_ID, d.TINHTIEN_PTTT,        ten.TENDUOC, ten.TENDUOC_EN, ten.MAQUOCTE, ten.MAQUOCTEBT,        CASE WHEN d.BHYT = '1' THEN 'BHYT' ELSE '' END as BHYT_TEXT        , ld.LOAIVATTU_ID        , d.BENHVIEN_ID,        tk.SOLUONG, d.VTYT_PHANLOAI, d.PHAMVI, d.SUASOLUONGTONGHOP, d.MADUOCBV, d.DANGTRINHBAY        , TAMNGUNG = CASE WHEN d.TAMNGUNG = '1' OR nh.TAMNGUNG = '1' OR kd.TAMNGUNG = '1' THEN '1' ELSE '0' END        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        inner join        (        select  LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')) DUOC_KEY, (SUM(dtk.SOLUONG) - isnull(sum(A.SOLUONG),0) - isnull(sum(B.SOLUONG),0)) SOLUONG, pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        from (select sum(soluong) soluong,duoc_id,nguonduoc_id,khoduoc_id,benhvien_id from TT_DUOC_TONKHO  group by duoc_id,nguonduoc_id,khoduoc_id,benhvien_id) dtk        inner join TM_DUOC_PHAMVISD_MAPPING pvsd on dtk.KHODUOC_ID = pvsd.KHODUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NOITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) B on B.DUOC_ID = dtk.DUOC_ID and B.SOLUONG > 0 and B.PHAMVI_ID = pvsd.PHAMVI_ID and B.NGUONHANG_ID = dtk.NGUONDUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NGOAITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) A on A.DUOC_ID = dtk.DUOC_ID and A.SOLUONG > 0 and A.PHAMVI_ID = pvsd.PHAMVI_ID and A.NGUONHANG_ID = dtk.NGUONDUOC_ID        where dtk.SOLUONG > 0 and dtk.BENHVIEN_ID = 'HLU01'        group by LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')), pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        ) tk on tk.DUOC_ID = d.DUOC_ID        left join TM_DUOC_PHAMVISUDUNG kd on kd.PHAMVI_ID = tk.PHAMVI_ID and kd.BENHVIEN_ID = 'HLU01'        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = tk.NGUONDUOC_ID and nh.BENHVIEN_ID = 'HLU01'        where d.BENHVIEN_ID = 'HLU01'  and tk.SOLUONG >= 0        end]
2019-09-20 11:14:10,172 [16] DEBUG - Statement Id: [DAO00320_GetList] PreparedStatement : [select M.*            from TM_MAU M            LEFT JOIN TM_MAU_DONVITINH DVT on M.DONVITINH_ID=DVT.DONVITINH_ID            where            M.TAMNGUNG = '0'            and M.BENHVIEN_ID = 'HLU01'            order by M.TENMAU]
2019-09-20 11:14:10,258 [16] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM071']
2019-09-20 11:14:10,293 [16] DEBUG - Statement Id: [DAO00322_GetListMauTonKhoForCreateCached] PreparedStatement : [SELECT DISTINCT          TK.MAU_KEY, TK.KHOMAU_ID, M.MAU_ID, M.MAMAU, M.TENMAU, M.NHOM_ABO, M.NHOM_RH, M.LOAIMAU_ID,          TK.SOLONHAP_ID, SLN.SOLONHAP, SLN.SOKIEMSOAT, TK.NGUONHANG_ID, NG.TENNGUONMAU, M.BENHVIEN_ID, M.DONVITINH_ID,          SUM(tk.SOLUONG) AS SOLUONG,K.TENKHO,DVT.TENDONVITINH          FROM TT_MAU_TONKHO TK          JOIN TM_KHO K ON TK.KHOMAU_ID = K.KHO_ID          JOIN TT_MAU_CHUNGTU_SOLONHAP SLN ON TK.SOLONHAP_ID = SLN.SOLONHAP_ID          JOIN TM_MAU M on TK.MAU_ID = M.MAU_ID and M.TAMNGUNG = '0'          LEFT JOIN TM_MAU_DONVITINH DVT on M.DONVITINH_ID=DVT.DONVITINH_ID          LEFT JOIN TM_NGUONMAU NG ON NG.NGUONMAU_ID = TK.NGUONHANG_ID          WHERE TK.SOLUONG > 0          GROUP BY TK.MAU_KEY, TK.KHOMAU_ID, M.MAU_ID, M.MAMAU, M.TENMAU, M.NHOM_ABO, M.NHOM_RH, M.LOAIMAU_ID,          TK.SOLONHAP_ID, SLN.SOLONHAP, SLN.SOKIEMSOAT,TK.NGUONHANG_ID, NG.TENNGUONMAU, M.BENHVIEN_ID, M.DONVITINH_ID,K.TENKHO,DVT.TENDONVITINH]
2019-09-20 11:14:10,364 [16] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM073']
2019-09-20 11:14:10,399 [16] DEBUG - Statement Id: [DAO00322_GetListMauTonKhoTruBooking] PreparedStatement : [select distinct          TK.MAU_KEY, TK.KHOMAU_ID, M.MAU_ID, M.MAMAU, M.TENMAU, M.NHOM_ABO, M.NHOM_RH, M.LOAIMAU_ID, M.DONVITINH_ID,          TK.SOLONHAP_ID, TK.SOLONHAP, TK.SOKIEMSOAT,M.PHAMVI, TK.NGUONHANG_ID, NG.TENNGUONMAU, M.BENHVIEN_ID,          TK.SOLUONG,TK.TENKHO,DVT.TENDONVITINH          from TM_MAU M          JOIN          (          select          A.MAU_KEY, A.KHOMAU_ID, A.MAU_ID ,a.NGUONHANG_ID, A.SOLONHAP_ID, A.SOLONHAP, A.SOKIEMSOAT, A.SOLUONG,A.TENKHO          from          (          select KHOMAU_ID, TK.MAU_ID, TK.NGUONHANG_ID, TK.MAU_KEY, SLN.SOLONHAP_ID, SLN.SOLONHAP, SLN.SOKIEMSOAT, ISNULL(TK.SOLUONG,0) - ISNULL(book.SOLUONG,0) as SOLUONG,K.TENKHO          from TT_MAU_TONKHO TK          JOIN TM_KHO K ON TK.KHOMAU_ID = K.KHO_ID          inner join TT_MAU_CHUNGTU_SOLONHAP SLN ON TK.SOLONHAP_ID = SLN.SOLONHAP_ID          left join dbo.TT_MAU_TONKHO_BOOK book ON book.MAU_KEY = TK.MAU_KEY AND book.TRANGTHAI = 'HIEULUC'          where ISNULL(TK.SOLUONG,0) - ISNULL(book.SOLUONG,0) > 0          ) A          )TK on TK.MAU_ID = M.MAU_ID and M.TAMNGUNG = '0'          LEFT JOIN TM_MAU_DONVITINH DVT on M.DONVITINH_ID=DVT.DONVITINH_ID          LEFT JOIN TM_NGUONMAU NG ON NG.NGUONMAU_ID = TK.NGUONHANG_ID]
2019-09-20 11:14:10,474 [16] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM072']
2019-09-20 11:14:11,743 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'MAIN'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2019-09-20 11:14:11,829 [1] DEBUG - Statement Id: [DAO00002_FormList] PreparedStatement : [select              TM_SYS_FORM.HOSPITAL_ID,              TM_SYS_FORM.NAME,              TM_SYS_FORM.CLASS,              TM_SYS_FORM.ASSEMBLY,              TM_SYS_FORM.TITLE_VI as TITLE              from TM_SYS_FORM              where HOSPITAL_ID = 'HLU01']
2019-09-20 11:14:11,937 [1] DEBUG - Statement Id: [DAO00300_GetShortcutListByUserID] PreparedStatement : [SELECT S.SHORTCUT_CODE, S.SHORTCUT_VALUE              FROM TM_SHORTCUT AS S              WHERE S.BENHVIEN_ID = 'HLU01' AND S.USER_ID = '1' AND TAMNGUNG = '0']
2019-09-20 11:14:11,966 [1] DEBUG - Statement Id: [DAO00087_GetList] PreparedStatement : [select CODE, VALUE, BENHVIEN_ID              from TM_SYS_APPSETTINGS              where LOCKED = '0' and BENHVIEN_ID = 'HLU01'              order by SETTING_ID]
2019-09-20 11:14:12,044 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'MSG01'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2019-09-20 11:14:12,171 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'MSG02'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2019-09-20 11:14:12,249 [1] DEBUG - Statement Id: [DAO00008_GetUserSettings] PreparedStatement : [select A.*, B.TENKHO , C.TENPHONGBAN, B.MAKHO, C.MAPHONGBAN          from TM_SYS_USERS A          left join TM_KHODUOC B on B.KHODUOC_ID = A.INVENTORY_ID          left join TM_PHONGBAN C on (C.PHONGBAN_ID = A.WORKING_DEPT_ID and C.BENHVIEN_ID =  @param0 )          left join TM_SYS_USERKHO D on (D.ACCOUNT_ID = A.ACCOUNT_ID and D.HOSPITAL_ID =  @param0 )          where          A.HOSPITAL_ID =  @param0            and                 A.ACCOUNT_ID =  @param1]
2019-09-20 11:14:12,249 [1] DEBUG - Statement Id: [DAO00008_GetUserSettings] Parameters: [@param0=[HOSPITAL_ID,HLU01], @param1=[ACCOUNT_ID,113]]
2019-09-20 11:14:12,249 [1] DEBUG - Statement Id: [DAO00008_GetUserSettings] Types: [@param0=[String, System.String], @param1=[String, System.String]]
2019-09-20 11:14:12,279 [1] DEBUG - Statement Id: [DAO00008_GetUserInvSettings] PreparedStatement : [select A.*, B.TENKHO, B.MAKHO, B.LOAIKHO_ID, B.KHOQUANLY_ID          from TM_SYS_USERKHO A          left join TM_KHO B on B.MODULE_ID = A.MODULE_ID and B.KHO_ID = A.KHO_ID          where A.HOSPITAL_ID =  @param0  and A.ACCOUNT_ID =  @param1           order by B.TENKHO]
2019-09-20 11:14:12,279 [1] DEBUG - Statement Id: [DAO00008_GetUserInvSettings] Parameters: [@param0=[HOSPITAL_ID,HLU01], @param1=[ACCOUNT_ID,113]]
2019-09-20 11:14:12,279 [1] DEBUG - Statement Id: [DAO00008_GetUserInvSettings] Types: [@param0=[String, System.String], @param1=[String, System.String]]
2019-09-20 11:14:12,360 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'COM30'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2019-09-20 11:14:12,494 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'RIS04'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2019-09-20 11:14:13,215 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'MENU1'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2019-09-20 11:14:13,330 [1] DEBUG - Statement Id: [DAO00011_GetList] PreparedStatement : [select              TM_SYS_MENU.ID,              TM_SYS_MENU.PARENTID,              TM_SYS_MENU.SCREEN,              TM_SYS_MENU.SMALLIMAGE,              TM_SYS_MENU.LARGEIMAGE,              TM_SYS_MENU.DESCRIPTION,              TM_SYS_MENU.TYPE,              TM_SYS_MENU.TITLE_VI as TITLE              from TM_SYS_MENU              where TM_SYS_MENU.HOSPITAL_ID = 'HLU01' and TM_SYS_MENU.ACTIVE = '1'               AND                   (TM_SYS_MENU.TYPE & '8' = '8')                             order by TM_SYS_MENU.ORDERNUM]
2019-09-20 11:14:13,500 [1] DEBUG - Statement Id: [DAO00011_usermenu_list] PreparedStatement : [select              TM_SYS_HOMEMENU.MENUID as ID,              TM_SYS_MENU.TITLE_VI as TITLE,              TM_SYS_MENU.SCREEN,              TM_SYS_MENU.SMALLIMAGE,              TM_SYS_MENU.LARGEIMAGE,              TM_SYS_MENU.TYPE              from TM_SYS_HOMEMENU              left join TM_SYS_MENU on TM_SYS_MENU.ID = TM_SYS_HOMEMENU.MENUID and TM_SYS_MENU.HOSPITAL_ID = TM_SYS_HOMEMENU.HOSPITAL_ID              where TM_SYS_HOMEMENU.HOSPITAL_ID = 'HLU01' and TM_SYS_HOMEMENU.USERID = '113' and TM_SYS_MENU.ACTIVE = '1'               AND                   (TM_SYS_MENU.TYPE & '8' = '8')                             ORDER BY TM_SYS_HOMEMENU.ORDERNUM]
2019-09-20 11:14:18,061 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'COM31'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2019-09-20 11:14:18,255 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'ORM28'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2019-09-20 11:14:22,187 [1] DEBUG - Statement Id: [DAO00066_GetBENHAN_TIEPNHAN] PreparedStatement : [select top 1 *        from TT_NOITRU_BENHAN        where TIEPNHAN_ID = '27022'  and BENHVIEN_ID = 'HLU01'        order by NGAYTAO desc]
2019-09-20 11:14:22,277 [1] DEBUG - Statement Id: [DAO00014_GetInPatientStatus] PreparedStatement : [select TRANGTHAI, isnull(KHOACHUYENDEN_ID, KHOAVAO_ID) as KHOAHIENTAI from TT_NOITRU_BENHAN        where        TIEPNHAN_ID = '27022'        and BENHVIEN_ID = 'HLU01'         and           BENHAN_ID = '5800']
2019-09-20 11:14:22,367 [1] DEBUG - Statement Id: [DAO00048_TT_PHAUTHUAT_GetList] PreparedStatement : [select *              from TT_PHAUTHUAT               where                             TT_PHAUTHUAT.LOAI = 'P'                       and                           TT_PHAUTHUAT.TIEPNHAN_ID = 27022                       and                           TT_PHAUTHUAT.BENHVIEN_ID = 'HLU01'                                     order by PHAUTHUAT_ID DESC]
2019-09-20 11:14:22,410 [1] DEBUG - Statement Id: [DAO00048_GetListLoaiGacTrongPTTT] PreparedStatement : [select DICTIONARY_ID, DICTIONARY_CODE, DICTIONARY_NAME          from LST_DICTIONARY          where DICTIONARY_TYPE_CODE = 'LoaiGacPTTT'          and ENABLED = '1']
2019-09-20 11:14:26,319 [1] DEBUG - Statement Id: [DAO00048_GetDSLoaiGacDaGhiNhan] PreparedStatement : [select A.KIEMSOATGAC_ID, A.BENHNHAN_ID, A.TIEPNHAN_ID, A.BENHAN_ID, A.PHAUTHUAT_ID, A.LOAIPT_TT, A.LOAIGAC_ID          , A.NGAYGHINHAN, A.THOIGIANGHINHAN, A.SOLUONG, A.SOLUONGDASUDUNG, A.SOLUONGCONLAI, A.GHICHU, A.NGUOINHANDUNGCU_ID          , B.DICTIONARY_CODE AS MALOAIGAC, B.DICTIONARY_NAME AS TENLOAIGAC          from TT_PHAUTHUAT_GHINHANGAC A          inner join LST_DICTIONARY B on B.DICTIONARY_ID = A.LOAIGAC_ID          where A.PHAUTHUAT_ID = 3742 and A.BENHVIEN_ID = 'HLU01']
2019-09-20 11:14:26,529 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'COM98'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2019-09-20 11:14:30,005 [1] DEBUG - Statement Id: [DAO00048_GetDSLoaiGacDaGhiNhan] PreparedStatement : [select A.KIEMSOATGAC_ID, A.BENHNHAN_ID, A.TIEPNHAN_ID, A.BENHAN_ID, A.PHAUTHUAT_ID, A.LOAIPT_TT, A.LOAIGAC_ID          , A.NGAYGHINHAN, A.THOIGIANGHINHAN, A.SOLUONG, A.SOLUONGDASUDUNG, A.SOLUONGCONLAI, A.GHICHU, A.NGUOINHANDUNGCU_ID          , B.DICTIONARY_CODE AS MALOAIGAC, B.DICTIONARY_NAME AS TENLOAIGAC          from TT_PHAUTHUAT_GHINHANGAC A          inner join LST_DICTIONARY B on B.DICTIONARY_ID = A.LOAIGAC_ID          where A.PHAUTHUAT_ID = 3742 and A.BENHVIEN_ID = 'HLU01']
2019-09-20 11:14:45,358 [1] DEBUG - Statement Id: [DAO00066_GetBENHAN_TIEPNHAN] PreparedStatement : [select top 1 *        from TT_NOITRU_BENHAN        where TIEPNHAN_ID = '27022'  and BENHVIEN_ID = 'HLU01'        order by NGAYTAO desc]
2019-09-20 11:14:45,790 [1] DEBUG - Statement Id: [DAO00014_GetInPatientStatus] PreparedStatement : [select TRANGTHAI, isnull(KHOACHUYENDEN_ID, KHOAVAO_ID) as KHOAHIENTAI from TT_NOITRU_BENHAN        where        TIEPNHAN_ID = '27022'        and BENHVIEN_ID = 'HLU01'         and           BENHAN_ID = '5800']
2019-09-20 11:14:45,877 [1] DEBUG - Statement Id: [DAO00048_TT_PHAUTHUAT_GetList] PreparedStatement : [select *              from TT_PHAUTHUAT               where                             TT_PHAUTHUAT.LOAI = 'P'                       and                           TT_PHAUTHUAT.TIEPNHAN_ID = 27022                       and                           TT_PHAUTHUAT.BENHVIEN_ID = 'HLU01'                                     order by PHAUTHUAT_ID DESC]
2019-09-20 11:14:45,921 [1] DEBUG - Statement Id: [DAO00048_GetListLoaiGacTrongPTTT] PreparedStatement : [select DICTIONARY_ID, DICTIONARY_CODE, DICTIONARY_NAME          from LST_DICTIONARY          where DICTIONARY_TYPE_CODE = 'LoaiGacPTTT'          and ENABLED = '1']
2019-09-20 11:14:58,904 [1] DEBUG - Statement Id: [DAO00048_GetDSLoaiGacDaGhiNhan] PreparedStatement : [select A.KIEMSOATGAC_ID, A.BENHNHAN_ID, A.TIEPNHAN_ID, A.BENHAN_ID, A.PHAUTHUAT_ID, A.LOAIPT_TT, A.LOAIGAC_ID          , A.NGAYGHINHAN, A.THOIGIANGHINHAN, A.SOLUONG, A.SOLUONGDASUDUNG, A.SOLUONGCONLAI, A.GHICHU, A.NGUOINHANDUNGCU_ID          , B.DICTIONARY_CODE AS MALOAIGAC, B.DICTIONARY_NAME AS TENLOAIGAC          from TT_PHAUTHUAT_GHINHANGAC A          inner join LST_DICTIONARY B on B.DICTIONARY_ID = A.LOAIGAC_ID          where A.PHAUTHUAT_ID = 3742 and A.BENHVIEN_ID = 'HLU01']
--------------------------------------------------------------------------------
2019-09-20 11:18:26,233 [1] DEBUG - Statement Id: [DAO00001_DBList] PreparedStatement : [select *              from TM_SYS_SERVER              where HOSPITAL_ID = '_SYSTEM_' and TYPE = 'D']
2019-09-20 11:18:26,717 [1] DEBUG - Statement Id: [DAO00001_DaoList] PreparedStatement : [select              TM_SYS_SERVICEMAP.ID,              TM_SYS_SERVICEMAP.HOSPITAL_ID,              TM_SYS_SERVICEMAP.DB_NAME,              TM_SYS_SERVICEMAP.TYPE,              TM_SYS_SERVICEMAP.NAME,              TM_SYS_SERVICEMAP.CLASS,              (TM_SYS_DIC.VALUE + '.' + TM_SYS_SERVICEMAP.CLASS) as CLASSFULL,              TM_SYS_SERVICEMAP.ASSEMBLY              from TM_SYS_SERVICEMAP              inner join TM_SYS_DIC              on TM_SYS_SERVICEMAP.NAMESPACE = TM_SYS_DIC.ID              where HOSPITAL_ID = '_SYSTEM_' AND TYPE = 'D' AND ACTIVE = '1'              order by DB_NAME]
2019-09-20 11:18:26,759 [1] DEBUG - Statement Id: [DAO00001_ServiceList] PreparedStatement : [select              TM_SYS_SERVICEMAP.ID,              TM_SYS_SERVICEMAP.HOSPITAL_ID,              TM_SYS_SERVICEMAP.DB_NAME,              TM_SYS_SERVICEMAP.TYPE,              TM_SYS_SERVICEMAP.NAME,              TM_SYS_SERVICEMAP.CLASS,              (TM_SYS_DIC.VALUE + '.' + TM_SYS_SERVICEMAP.CLASS) as CLASSFULL,              TM_SYS_SERVICEMAP.ASSEMBLY,              TM_SYS_SERVER.URL              from TM_SYS_SERVICEMAP              inner join TM_SYS_DIC on TM_SYS_SERVICEMAP.NAMESPACE = TM_SYS_DIC.ID              inner join TM_SYS_SERVER on (TM_SYS_SERVICEMAP.DB_NAME = TM_SYS_SERVER.NAME) and (TM_SYS_SERVER.HOSPITAL_ID = '_SYSTEM_')              where TM_SYS_SERVICEMAP.HOSPITAL_ID = '_SYSTEM_' AND TM_SYS_SERVICEMAP.TYPE = 'S'  AND ACTIVE = '1'              order by URL]
2019-09-20 11:18:27,149 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = '_SYSTEM_'               AND                   TM_SYS_SCREEN.PAGE = 'LOGIN'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2019-09-20 11:18:27,392 [1] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = '_SYSTEM_'               AND                   TM_SYS_CACHE.ACTIVE = '1']
2019-09-20 11:18:31,718 [1] DEBUG - Statement Id: [DAO00001_DBList] PreparedStatement : [select *              from TM_SYS_SERVER              where HOSPITAL_ID = 'HLU01' and TYPE = 'D']
2019-09-20 11:18:31,749 [1] DEBUG - Statement Id: [DAO00001_DaoList] PreparedStatement : [select              TM_SYS_SERVICEMAP.ID,              TM_SYS_SERVICEMAP.HOSPITAL_ID,              TM_SYS_SERVICEMAP.DB_NAME,              TM_SYS_SERVICEMAP.TYPE,              TM_SYS_SERVICEMAP.NAME,              TM_SYS_SERVICEMAP.CLASS,              (TM_SYS_DIC.VALUE + '.' + TM_SYS_SERVICEMAP.CLASS) as CLASSFULL,              TM_SYS_SERVICEMAP.ASSEMBLY              from TM_SYS_SERVICEMAP              inner join TM_SYS_DIC              on TM_SYS_SERVICEMAP.NAMESPACE = TM_SYS_DIC.ID              where HOSPITAL_ID = 'HLU01' AND TYPE = 'D' AND ACTIVE = '1'              order by DB_NAME]
2019-09-20 11:18:33,211 [1] DEBUG - Statement Id: [DAO00001_ServiceList] PreparedStatement : [select              TM_SYS_SERVICEMAP.ID,              TM_SYS_SERVICEMAP.HOSPITAL_ID,              TM_SYS_SERVICEMAP.DB_NAME,              TM_SYS_SERVICEMAP.TYPE,              TM_SYS_SERVICEMAP.NAME,              TM_SYS_SERVICEMAP.CLASS,              (TM_SYS_DIC.VALUE + '.' + TM_SYS_SERVICEMAP.CLASS) as CLASSFULL,              TM_SYS_SERVICEMAP.ASSEMBLY,              TM_SYS_SERVER.URL              from TM_SYS_SERVICEMAP              inner join TM_SYS_DIC on TM_SYS_SERVICEMAP.NAMESPACE = TM_SYS_DIC.ID              inner join TM_SYS_SERVER on (TM_SYS_SERVICEMAP.DB_NAME = TM_SYS_SERVER.NAME) and (TM_SYS_SERVER.HOSPITAL_ID = 'HLU01')              where TM_SYS_SERVICEMAP.HOSPITAL_ID = 'HLU01' AND TM_SYS_SERVICEMAP.TYPE = 'S'  AND ACTIVE = '1'              order by URL]
2019-09-20 11:18:33,314 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1']
2019-09-20 11:18:34,082 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM005']
2019-09-20 11:18:34,245 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM015']
2019-09-20 11:18:34,334 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM067']
2019-09-20 11:18:34,425 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM008']
2019-09-20 11:18:34,500 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM068']
2019-09-20 11:18:34,577 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM006']
2019-09-20 11:18:34,652 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM030']
2019-09-20 11:18:34,729 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM025']
2019-09-20 11:18:34,825 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM024']
2019-09-20 11:18:35,347 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM033']
2019-09-20 11:18:35,436 [5] DEBUG - Statement Id: [DAO00027_GetListDuocKyGuiTonKho] PreparedStatement : [select  distinct TT_TONKHO.DUOC_KEY, LTRIM(TT_TONKHO.KHODUOC_ID) as KHODUOC_ID, TM_DUOC.DUOC_ID, TM_LOAIDUOC.MALOAIDUOC,TM_DUOC.SOVISA,TM_DUOC.TYLE_VAT,TM_DUOC.COTOA,        TM_DUOC.MADUOC, TM_DUOC.TENHANG, TM_DUOC.TENDUOCDAYDU, dvt.TENDONVITINH as DONVITINH,  TM_DUOC.DONVITINH_ID,TM_DUOC.BHYT,TM_DUOC.PHAMVI,        TM_DUOC.TENHOATCHAT, TM_DUOC.HAMLUONG, TM_DUOC.HANGSANXUAT, TM_DUOC.QUOCGIA, TM_DUOC.LOAIDUOC_ID, TM_DUOC.DUONGDUNG_ID,        TM_TENDUOC.TENDUOC, TM_TENDUOC.TENDUOC_EN, TM_TENDUOC.MAQUOCTE, TM_TENDUOC.MAQUOCTEBT,        TM_LOAIDUOC.LOAIVATTU_ID, TM_DUOC.BENHVIEN_ID,TT_TONKHO.SOLUONG, TT_TONKHO.NGUONDUOC_ID, NH.TENNGUONDUOC        , TAMNGUNG = CASE WHEN TM_DUOC.TAMNGUNG = '1' OR nh.TAMNGUNG = '1' OR KD.TAMNGUNG = '1' THEN '1' ELSE '0' END        , TM_DUOC.DANGTRINHBAY        from TM_DUOC        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = TM_DUOC.DONVITINH_ID        left join TM_TENDUOC on TM_DUOC.TENDUOC_ID = TM_TENDUOC.TENDUOC_ID and TM_DUOC.BENHVIEN_ID = 'HLU01' and TM_DUOC.TAMNGUNG = '0'        left join TM_LOAIDUOC on TM_LOAIDUOC.LOAIDUOC_ID = TM_DUOC.LOAIDUOC_ID and TM_LOAIDUOC.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG on (TM_LOAIDUOC.LOAIVATTU_ID = TM_DUOC_HANDUNG.LOAIDUOC and TM_DUOC_HANDUNG.BENHVIEN_ID = 'HLU01')        inner join        (select LTRIM(A.KHODUOC_ID) + '_' + LTRIM(A.DUOC_ID) + '_' + LTRIM(ISNULL(A.NGUONDUOC_ID,'')) as DUOC_KEY, A.KHODUOC_ID, A.DUOC_ID,A.NGUONDUOC_ID,        SUM(isnull(A.SOLUONG,0)) as SOLUONG        from        (select SUM(SOLUONG) as SOLUONG, KHODUOC_ID, DUOC_ID, NGUONDUOC_ID from TT_DUOC_KYGUI_TONKHO        where BENHVIEN_ID = 'HLU01' group by KHODUOC_ID, DUOC_ID, NGUONDUOC_ID) A        group by LTRIM(A.KHODUOC_ID) + '_' + LTRIM(A.DUOC_ID) + '_' + LTRIM(A.NGUONDUOC_ID), A.KHODUOC_ID, A.DUOC_ID, A.NGUONDUOC_ID)        TT_TONKHO on TT_TONKHO.DUOC_ID = TM_DUOC.DUOC_ID        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = TT_TONKHO.NGUONDUOC_ID and nh.BENHVIEN_ID = 'HLU01'        LEFT JOIN TM_KHODUOC KD ON KD.KHODUOC_ID = TT_TONKHO.KHODUOC_ID        where TM_DUOC.BENHVIEN_ID = 'HLU01' AND TT_TONKHO.SOLUONG >= 0]
2019-09-20 11:18:35,515 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM018']
2019-09-20 11:18:35,551 [5] DEBUG - Statement Id: [DAO00027_GetListDuocTonKho] PreparedStatement : [select distinct TT_TONKHO.DUOC_KEY, LTRIM(TT_TONKHO.KHODUOC_ID) as KHODUOC_ID, TM_DUOC.DUOC_ID, TM_LOAIDUOC.MALOAIDUOC,TM_DUOC.SOVISA,TM_DUOC.TYLE_VAT,TM_DUOC.COTOA,        TM_DUOC.MADUOC, TM_DUOC.TENHANG, TM_DUOC.TENDUOCDAYDU, dvt.TENDONVITINH as DONVITINH,  TM_DUOC.DONVITINH_ID,TM_DUOC.BHYT,                TM_DUOC.TENHOATCHAT,          TM_DUOC.HAMLUONG, TM_DUOC.HANGSANXUAT, TM_DUOC.QUOCGIA, TM_DUOC.LOAIDUOC_ID, TM_DUOC.DUONGDUNG_ID,        TM_TENDUOC.TENDUOC, TM_TENDUOC.TENDUOC_EN, TM_TENDUOC.MAQUOCTE, TM_TENDUOC.MAQUOCTEBT,        TM_LOAIDUOC.LOAIVATTU_ID, TM_DUOC.BENHVIEN_ID,        TT_TONKHO.SOLUONG, TM_DUOC.VTYT_PHANLOAI, TM_DUOC.PHAMVI, TT_TONKHO.NGUONDUOC_ID, NG.TENNGUONDUOC AS TENNGUONDUOC        , TAMNGUNG = CASE WHEN TM_DUOC.TAMNGUNG = '1' OR NG.TAMNGUNG = '1' OR KD.TAMNGUNG = '1' THEN '1' ELSE '0' END        , TM_DUOC.DANGTRINHBAY        from TM_DUOC        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = TM_DUOC.DONVITINH_ID        left join TM_TENDUOC on TM_DUOC.TENDUOC_ID = TM_TENDUOC.TENDUOC_ID and TM_DUOC.BENHVIEN_ID = 'HLU01' and TM_DUOC.TAMNGUNG = '0'        left join TM_LOAIDUOC on TM_LOAIDUOC.LOAIDUOC_ID = TM_DUOC.LOAIDUOC_ID and TM_LOAIDUOC.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG on (TM_LOAIDUOC.LOAIVATTU_ID = TM_DUOC_HANDUNG.LOAIDUOC and TM_DUOC_HANDUNG.BENHVIEN_ID = 'HLU01')        inner join        (select LTRIM(A.KHODUOC_ID) + '_' + LTRIM(A.DUOC_ID) + '_' + LTRIM(ISNULL(A.NGUONDUOC_ID,'')) as DUOC_KEY, A.KHODUOC_ID, A.DUOC_ID, A.NGUONDUOC_ID,        SUM(isnull(A.SOLUONG,0)) as SOLUONG        from        (select SUM(SOLUONG) as SOLUONG, KHODUOC_ID, DUOC_ID, NGUONDUOC_ID from TT_DUOC_TONKHO        where BENHVIEN_ID = 'HLU01' group by KHODUOC_ID, DUOC_ID, NGUONDUOC_ID) A        group by LTRIM(A.KHODUOC_ID) + '_' + LTRIM(A.DUOC_ID) + '_' + LTRIM(ISNULL(A.NGUONDUOC_ID,'')), A.KHODUOC_ID, A.DUOC_ID, NGUONDUOC_ID        ) TT_TONKHO on TT_TONKHO.DUOC_ID = TM_DUOC.DUOC_ID        LEFT JOIN TM_NGUONHANG NG ON NG.NGUONDUOC_ID = TT_TONKHO.NGUONDUOC_ID        LEFT JOIN TM_KHODUOC KD ON KD.KHODUOC_ID = TT_TONKHO.KHODUOC_ID        where TM_DUOC.BENHVIEN_ID = 'HLU01' and TT_TONKHO.SOLUONG >= 0]
2019-09-20 11:18:38,731 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM023']
2019-09-20 11:18:38,825 [5] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoVaBooking] PreparedStatement : [declare @NGUONDUOC_MACDINH varchar(5) = '0';        declare @TOAMUANGOAI int = 0;        select @NGUONDUOC_MACDINH = isnull(VALUE,0) from TM_SYS_APPSETTINGS where CODE = 'PHA_NGUONDUOC'        select @TOAMUANGOAI = isnull(VALUE,0) from TM_SYS_APPSETTINGS where CODE = 'OPD_TOAMUANGOAI_DUNGDANHMUC_DUOC'                if @TOAMUANGOAI = 1        begin        select  distinct '0' + '_' + LTRIM(d.DUOC_ID) + '_' + @NGUONDUOC_MACDINH as DUOC_KEY, 0 as PHAMVI_ID, @NGUONDUOC_MACDINH as NGUONDUOC_ID, null as TENNGUONDUOC, null as TINHTIEN, d.DUOC_ID, ld.MALOAIDUOC,        d.SOVISA,d.TYLE_VAT,d.COTOA, d.MADUOC, d.TENHANG, d.TENDUOCDAYDU, d.DONVITINH as DONVITINH, d.BHYT,        d.TENHOATCHAT, d.HAMLUONG, d.HANGSANXUAT, d.QUOCGIA, d.LOAIDUOC_ID, d.DUONGDUNG_ID, d.TINHTIEN_PTTT,        ten.TENDUOC, ten.TENDUOC_EN, ten.MAQUOCTE, ten.MAQUOCTEBT,        '' as BHYT_TEXT        , ld.LOAIVATTU_ID        , d.BENHVIEN_ID,        999999999 as SOLUONG, d.VTYT_PHANLOAI, d.PHAMVI, d.SUASOLUONGTONGHOP, d.MADUOCBV, d.DANGTRINHBAY        , TAMNGUNG = CASE WHEN d.TAMNGUNG = '1' THEN '1' ELSE '0' END        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        union all        select  distinct tk.DUOC_KEY, LTRIM(tk.PHAMVI_ID) as PHAMVI_ID, tk.NGUONDUOC_ID, nh.TENNGUONDUOC, nh.TINHTIEN, d.DUOC_ID, ld.MALOAIDUOC,        d.SOVISA,d.TYLE_VAT,d.COTOA, d.MADUOC, d.TENHANG, d.TENDUOCDAYDU, d.DONVITINH as DONVITINH, d.BHYT,        d.TENHOATCHAT, d.HAMLUONG, d.HANGSANXUAT, d.QUOCGIA, d.LOAIDUOC_ID, d.DUONGDUNG_ID, d.TINHTIEN_PTTT,        ten.TENDUOC, ten.TENDUOC_EN, ten.MAQUOCTE, ten.MAQUOCTEBT,        CASE WHEN d.BHYT = '1' THEN 'BHYT' ELSE '' END as BHYT_TEXT        , ld.LOAIVATTU_ID        , d.BENHVIEN_ID,        tk.SOLUONG, d.VTYT_PHANLOAI, d.PHAMVI, d.SUASOLUONGTONGHOP, d.MADUOCBV, d.DANGTRINHBAY        , TAMNGUNG = CASE WHEN d.TAMNGUNG = '1' OR nh.TAMNGUNG = '1' OR kd.TAMNGUNG = '1' THEN '1' ELSE '0' END        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        inner join        (        select  LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')) DUOC_KEY, (SUM(dtk.SOLUONG) - isnull(sum(A.SOLUONG),0) - isnull(sum(B.SOLUONG),0)) SOLUONG, pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        from (select sum(soluong) soluong,duoc_id,nguonduoc_id,khoduoc_id,benhvien_id from TT_DUOC_TONKHO  group by duoc_id,nguonduoc_id,khoduoc_id,benhvien_id) dtk        inner join TM_DUOC_PHAMVISD_MAPPING pvsd on dtk.KHODUOC_ID = pvsd.KHODUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NOITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) B on B.DUOC_ID = dtk.DUOC_ID and B.SOLUONG > 0 and B.PHAMVI_ID = pvsd.PHAMVI_ID and B.NGUONHANG_ID = dtk.NGUONDUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NGOAITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) A on A.DUOC_ID = dtk.DUOC_ID and A.SOLUONG > 0 and A.PHAMVI_ID = pvsd.PHAMVI_ID and A.NGUONHANG_ID = dtk.NGUONDUOC_ID        where dtk.SOLUONG > 0 and dtk.BENHVIEN_ID = 'HLU01'        group by LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')), pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        ) tk on tk.DUOC_ID = d.DUOC_ID        left join TM_DUOC_PHAMVISUDUNG kd on kd.PHAMVI_ID = tk.PHAMVI_ID and kd.BENHVIEN_ID = 'HLU01'        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = tk.NGUONDUOC_ID and nh.BENHVIEN_ID = 'HLU01'        where d.BENHVIEN_ID = 'HLU01'  and tk.SOLUONG >= 0        end        else        begin                  select  distinct tk.DUOC_KEY, LTRIM(tk.PHAMVI_ID) as PHAMVI_ID, tk.NGUONDUOC_ID, nh.TENNGUONDUOC, nh.TINHTIEN, d.DUOC_ID, ld.MALOAIDUOC,        d.SOVISA,d.TYLE_VAT,d.COTOA, d.MADUOC, d.TENHANG, d.TENDUOCDAYDU, d.DONVITINH as DONVITINH, d.BHYT,        d.TENHOATCHAT, d.HAMLUONG, d.HANGSANXUAT, d.QUOCGIA, d.LOAIDUOC_ID, d.DUONGDUNG_ID, d.TINHTIEN_PTTT,        ten.TENDUOC, ten.TENDUOC_EN, ten.MAQUOCTE, ten.MAQUOCTEBT,        CASE WHEN d.BHYT = '1' THEN 'BHYT' ELSE '' END as BHYT_TEXT        , ld.LOAIVATTU_ID        , d.BENHVIEN_ID,        tk.SOLUONG, d.VTYT_PHANLOAI, d.PHAMVI, d.SUASOLUONGTONGHOP, d.MADUOCBV, d.DANGTRINHBAY        , TAMNGUNG = CASE WHEN d.TAMNGUNG = '1' OR nh.TAMNGUNG = '1' OR kd.TAMNGUNG = '1' THEN '1' ELSE '0' END        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        inner join        (        select  LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')) DUOC_KEY, (SUM(dtk.SOLUONG) - isnull(sum(A.SOLUONG),0) - isnull(sum(B.SOLUONG),0)) SOLUONG, pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        from (select sum(soluong) soluong,duoc_id,nguonduoc_id,khoduoc_id,benhvien_id from TT_DUOC_TONKHO  group by duoc_id,nguonduoc_id,khoduoc_id,benhvien_id) dtk        inner join TM_DUOC_PHAMVISD_MAPPING pvsd on dtk.KHODUOC_ID = pvsd.KHODUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NOITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) B on B.DUOC_ID = dtk.DUOC_ID and B.SOLUONG > 0 and B.PHAMVI_ID = pvsd.PHAMVI_ID and B.NGUONHANG_ID = dtk.NGUONDUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NGOAITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) A on A.DUOC_ID = dtk.DUOC_ID and A.SOLUONG > 0 and A.PHAMVI_ID = pvsd.PHAMVI_ID and A.NGUONHANG_ID = dtk.NGUONDUOC_ID        where dtk.SOLUONG > 0 and dtk.BENHVIEN_ID = 'HLU01'        group by LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')), pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        ) tk on tk.DUOC_ID = d.DUOC_ID        left join TM_DUOC_PHAMVISUDUNG kd on kd.PHAMVI_ID = tk.PHAMVI_ID and kd.BENHVIEN_ID = 'HLU01'        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = tk.NGUONDUOC_ID and nh.BENHVIEN_ID = 'HLU01'        where d.BENHVIEN_ID = 'HLU01'  and tk.SOLUONG >= 0        end]
2019-09-20 11:18:42,095 [5] DEBUG - Statement Id: [DAO00320_GetList] PreparedStatement : [select M.*            from TM_MAU M            LEFT JOIN TM_MAU_DONVITINH DVT on M.DONVITINH_ID=DVT.DONVITINH_ID            where            M.TAMNGUNG = '0'            and M.BENHVIEN_ID = 'HLU01'            order by M.TENMAU]
2019-09-20 11:18:42,238 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM071']
2019-09-20 11:18:42,287 [5] DEBUG - Statement Id: [DAO00322_GetListMauTonKhoForCreateCached] PreparedStatement : [SELECT DISTINCT          TK.MAU_KEY, TK.KHOMAU_ID, M.MAU_ID, M.MAMAU, M.TENMAU, M.NHOM_ABO, M.NHOM_RH, M.LOAIMAU_ID,          TK.SOLONHAP_ID, SLN.SOLONHAP, SLN.SOKIEMSOAT, TK.NGUONHANG_ID, NG.TENNGUONMAU, M.BENHVIEN_ID, M.DONVITINH_ID,          SUM(tk.SOLUONG) AS SOLUONG,K.TENKHO,DVT.TENDONVITINH          FROM TT_MAU_TONKHO TK          JOIN TM_KHO K ON TK.KHOMAU_ID = K.KHO_ID          JOIN TT_MAU_CHUNGTU_SOLONHAP SLN ON TK.SOLONHAP_ID = SLN.SOLONHAP_ID          JOIN TM_MAU M on TK.MAU_ID = M.MAU_ID and M.TAMNGUNG = '0'          LEFT JOIN TM_MAU_DONVITINH DVT on M.DONVITINH_ID=DVT.DONVITINH_ID          LEFT JOIN TM_NGUONMAU NG ON NG.NGUONMAU_ID = TK.NGUONHANG_ID          WHERE TK.SOLUONG > 0          GROUP BY TK.MAU_KEY, TK.KHOMAU_ID, M.MAU_ID, M.MAMAU, M.TENMAU, M.NHOM_ABO, M.NHOM_RH, M.LOAIMAU_ID,          TK.SOLONHAP_ID, SLN.SOLONHAP, SLN.SOKIEMSOAT,TK.NGUONHANG_ID, NG.TENNGUONMAU, M.BENHVIEN_ID, M.DONVITINH_ID,K.TENKHO,DVT.TENDONVITINH]
2019-09-20 11:18:42,425 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM073']
2019-09-20 11:18:42,476 [5] DEBUG - Statement Id: [DAO00322_GetListMauTonKhoTruBooking] PreparedStatement : [select distinct          TK.MAU_KEY, TK.KHOMAU_ID, M.MAU_ID, M.MAMAU, M.TENMAU, M.NHOM_ABO, M.NHOM_RH, M.LOAIMAU_ID, M.DONVITINH_ID,          TK.SOLONHAP_ID, TK.SOLONHAP, TK.SOKIEMSOAT,M.PHAMVI, TK.NGUONHANG_ID, NG.TENNGUONMAU, M.BENHVIEN_ID,          TK.SOLUONG,TK.TENKHO,DVT.TENDONVITINH          from TM_MAU M          JOIN          (          select          A.MAU_KEY, A.KHOMAU_ID, A.MAU_ID ,a.NGUONHANG_ID, A.SOLONHAP_ID, A.SOLONHAP, A.SOKIEMSOAT, A.SOLUONG,A.TENKHO          from          (          select KHOMAU_ID, TK.MAU_ID, TK.NGUONHANG_ID, TK.MAU_KEY, SLN.SOLONHAP_ID, SLN.SOLONHAP, SLN.SOKIEMSOAT, ISNULL(TK.SOLUONG,0) - ISNULL(book.SOLUONG,0) as SOLUONG,K.TENKHO          from TT_MAU_TONKHO TK          JOIN TM_KHO K ON TK.KHOMAU_ID = K.KHO_ID          inner join TT_MAU_CHUNGTU_SOLONHAP SLN ON TK.SOLONHAP_ID = SLN.SOLONHAP_ID          left join dbo.TT_MAU_TONKHO_BOOK book ON book.MAU_KEY = TK.MAU_KEY AND book.TRANGTHAI = 'HIEULUC'          where ISNULL(TK.SOLUONG,0) - ISNULL(book.SOLUONG,0) > 0          ) A          )TK on TK.MAU_ID = M.MAU_ID and M.TAMNGUNG = '0'          LEFT JOIN TM_MAU_DONVITINH DVT on M.DONVITINH_ID=DVT.DONVITINH_ID          LEFT JOIN TM_NGUONMAU NG ON NG.NGUONMAU_ID = TK.NGUONHANG_ID]
2019-09-20 11:18:42,562 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM072']
2019-09-20 11:18:43,502 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'MAIN'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2019-09-20 11:18:44,296 [1] DEBUG - Statement Id: [DAO00002_FormList] PreparedStatement : [select              TM_SYS_FORM.HOSPITAL_ID,              TM_SYS_FORM.NAME,              TM_SYS_FORM.CLASS,              TM_SYS_FORM.ASSEMBLY,              TM_SYS_FORM.TITLE_VI as TITLE              from TM_SYS_FORM              where HOSPITAL_ID = 'HLU01']
2019-09-20 11:18:49,736 [1] DEBUG - Statement Id: [DAO00300_GetShortcutListByUserID] PreparedStatement : [SELECT S.SHORTCUT_CODE, S.SHORTCUT_VALUE              FROM TM_SHORTCUT AS S              WHERE S.BENHVIEN_ID = 'HLU01' AND S.USER_ID = '1' AND TAMNGUNG = '0']
2019-09-20 11:18:49,774 [1] DEBUG - Statement Id: [DAO00087_GetList] PreparedStatement : [select CODE, VALUE, BENHVIEN_ID              from TM_SYS_APPSETTINGS              where LOCKED = '0' and BENHVIEN_ID = 'HLU01'              order by SETTING_ID]
2019-09-20 11:18:49,853 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'MSG01'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2019-09-20 11:18:50,010 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'MSG02'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2019-09-20 11:18:50,635 [1] DEBUG - Statement Id: [DAO00008_GetUserSettings] PreparedStatement : [select A.*, B.TENKHO , C.TENPHONGBAN, B.MAKHO, C.MAPHONGBAN          from TM_SYS_USERS A          left join TM_KHODUOC B on B.KHODUOC_ID = A.INVENTORY_ID          left join TM_PHONGBAN C on (C.PHONGBAN_ID = A.WORKING_DEPT_ID and C.BENHVIEN_ID =  @param0 )          left join TM_SYS_USERKHO D on (D.ACCOUNT_ID = A.ACCOUNT_ID and D.HOSPITAL_ID =  @param0 )          where          A.HOSPITAL_ID =  @param0            and                 A.ACCOUNT_ID =  @param1]
2019-09-20 11:18:50,637 [1] DEBUG - Statement Id: [DAO00008_GetUserSettings] Parameters: [@param0=[HOSPITAL_ID,HLU01], @param1=[ACCOUNT_ID,113]]
2019-09-20 11:18:50,637 [1] DEBUG - Statement Id: [DAO00008_GetUserSettings] Types: [@param0=[String, System.String], @param1=[String, System.String]]
2019-09-20 11:18:50,670 [1] DEBUG - Statement Id: [DAO00008_GetUserInvSettings] PreparedStatement : [select A.*, B.TENKHO, B.MAKHO, B.LOAIKHO_ID, B.KHOQUANLY_ID          from TM_SYS_USERKHO A          left join TM_KHO B on B.MODULE_ID = A.MODULE_ID and B.KHO_ID = A.KHO_ID          where A.HOSPITAL_ID =  @param0  and A.ACCOUNT_ID =  @param1           order by B.TENKHO]
2019-09-20 11:18:50,670 [1] DEBUG - Statement Id: [DAO00008_GetUserInvSettings] Parameters: [@param0=[HOSPITAL_ID,HLU01], @param1=[ACCOUNT_ID,113]]
2019-09-20 11:18:50,670 [1] DEBUG - Statement Id: [DAO00008_GetUserInvSettings] Types: [@param0=[String, System.String], @param1=[String, System.String]]
2019-09-20 11:18:50,804 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'COM30'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2019-09-20 11:18:50,992 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'RIS04'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2019-09-20 11:19:00,703 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'MENU1'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2019-09-20 11:19:00,800 [1] DEBUG - Statement Id: [DAO00011_GetList] PreparedStatement : [select              TM_SYS_MENU.ID,              TM_SYS_MENU.PARENTID,              TM_SYS_MENU.SCREEN,              TM_SYS_MENU.SMALLIMAGE,              TM_SYS_MENU.LARGEIMAGE,              TM_SYS_MENU.DESCRIPTION,              TM_SYS_MENU.TYPE,              TM_SYS_MENU.TITLE_VI as TITLE              from TM_SYS_MENU              where TM_SYS_MENU.HOSPITAL_ID = 'HLU01' and TM_SYS_MENU.ACTIVE = '1'               AND                   (TM_SYS_MENU.TYPE & '8' = '8')                             order by TM_SYS_MENU.ORDERNUM]
2019-09-20 11:19:01,095 [1] DEBUG - Statement Id: [DAO00011_usermenu_list] PreparedStatement : [select              TM_SYS_HOMEMENU.MENUID as ID,              TM_SYS_MENU.TITLE_VI as TITLE,              TM_SYS_MENU.SCREEN,              TM_SYS_MENU.SMALLIMAGE,              TM_SYS_MENU.LARGEIMAGE,              TM_SYS_MENU.TYPE              from TM_SYS_HOMEMENU              left join TM_SYS_MENU on TM_SYS_MENU.ID = TM_SYS_HOMEMENU.MENUID and TM_SYS_MENU.HOSPITAL_ID = TM_SYS_HOMEMENU.HOSPITAL_ID              where TM_SYS_HOMEMENU.HOSPITAL_ID = 'HLU01' and TM_SYS_HOMEMENU.USERID = '113' and TM_SYS_MENU.ACTIVE = '1'               AND                   (TM_SYS_MENU.TYPE & '8' = '8')                             ORDER BY TM_SYS_HOMEMENU.ORDERNUM]
2019-09-20 11:19:05,485 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'COM31'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2019-09-20 11:19:05,909 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'ORM28'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2019-09-20 11:19:10,298 [1] DEBUG - Statement Id: [DAO00066_GetBENHAN_TIEPNHAN] PreparedStatement : [select top 1 *        from TT_NOITRU_BENHAN        where TIEPNHAN_ID = '27022'  and BENHVIEN_ID = 'HLU01'        order by NGAYTAO desc]
2019-09-20 11:19:10,718 [1] DEBUG - Statement Id: [DAO00014_GetInPatientStatus] PreparedStatement : [select TRANGTHAI, isnull(KHOACHUYENDEN_ID, KHOAVAO_ID) as KHOAHIENTAI from TT_NOITRU_BENHAN        where        TIEPNHAN_ID = '27022'        and BENHVIEN_ID = 'HLU01'         and           BENHAN_ID = '5800']
2019-09-20 11:19:10,857 [1] DEBUG - Statement Id: [DAO00048_TT_PHAUTHUAT_GetList] PreparedStatement : [select *              from TT_PHAUTHUAT               where                             TT_PHAUTHUAT.LOAI = 'P'                       and                           TT_PHAUTHUAT.TIEPNHAN_ID = 27022                       and                           TT_PHAUTHUAT.BENHVIEN_ID = 'HLU01'                                     order by PHAUTHUAT_ID DESC]
2019-09-20 11:19:10,911 [1] DEBUG - Statement Id: [DAO00048_GetListLoaiGacTrongPTTT] PreparedStatement : [select DICTIONARY_ID, DICTIONARY_CODE, DICTIONARY_NAME          from LST_DICTIONARY          where DICTIONARY_TYPE_CODE = 'LoaiGacPTTT'          and ENABLED = '1']
2019-09-20 11:19:21,487 [1] DEBUG - Statement Id: [DAO00048_GetDSLoaiGacDaGhiNhan] PreparedStatement : [select A.KIEMSOATGAC_ID, A.BENHNHAN_ID, A.TIEPNHAN_ID, A.BENHAN_ID, A.PHAUTHUAT_ID, A.LOAIPT_TT, A.LOAIGAC_ID          , A.NGAYGHINHAN, A.THOIGIANGHINHAN, A.SOLUONG, A.SOLUONGDASUDUNG, A.SOLUONGCONLAI, A.GHICHU, A.NGUOINHANDUNGCU_ID          , B.DICTIONARY_CODE AS MALOAIGAC, B.DICTIONARY_NAME AS TENLOAIGAC          from TT_PHAUTHUAT_GHINHANGAC A          inner join LST_DICTIONARY B on B.DICTIONARY_ID = A.LOAIGAC_ID          where A.PHAUTHUAT_ID = 3742 and A.BENHVIEN_ID = 'HLU01']
2019-09-20 11:19:26,487 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'COM98'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
--------------------------------------------------------------------------------
2019-09-20 11:21:17,517 [1] DEBUG - Statement Id: [DAO00001_DBList] PreparedStatement : [select *              from TM_SYS_SERVER              where HOSPITAL_ID = '_SYSTEM_' and TYPE = 'D']
2019-09-20 11:21:17,823 [1] DEBUG - Statement Id: [DAO00001_DaoList] PreparedStatement : [select              TM_SYS_SERVICEMAP.ID,              TM_SYS_SERVICEMAP.HOSPITAL_ID,              TM_SYS_SERVICEMAP.DB_NAME,              TM_SYS_SERVICEMAP.TYPE,              TM_SYS_SERVICEMAP.NAME,              TM_SYS_SERVICEMAP.CLASS,              (TM_SYS_DIC.VALUE + '.' + TM_SYS_SERVICEMAP.CLASS) as CLASSFULL,              TM_SYS_SERVICEMAP.ASSEMBLY              from TM_SYS_SERVICEMAP              inner join TM_SYS_DIC              on TM_SYS_SERVICEMAP.NAMESPACE = TM_SYS_DIC.ID              where HOSPITAL_ID = '_SYSTEM_' AND TYPE = 'D' AND ACTIVE = '1'              order by DB_NAME]
2019-09-20 11:21:17,865 [1] DEBUG - Statement Id: [DAO00001_ServiceList] PreparedStatement : [select              TM_SYS_SERVICEMAP.ID,              TM_SYS_SERVICEMAP.HOSPITAL_ID,              TM_SYS_SERVICEMAP.DB_NAME,              TM_SYS_SERVICEMAP.TYPE,              TM_SYS_SERVICEMAP.NAME,              TM_SYS_SERVICEMAP.CLASS,              (TM_SYS_DIC.VALUE + '.' + TM_SYS_SERVICEMAP.CLASS) as CLASSFULL,              TM_SYS_SERVICEMAP.ASSEMBLY,              TM_SYS_SERVER.URL              from TM_SYS_SERVICEMAP              inner join TM_SYS_DIC on TM_SYS_SERVICEMAP.NAMESPACE = TM_SYS_DIC.ID              inner join TM_SYS_SERVER on (TM_SYS_SERVICEMAP.DB_NAME = TM_SYS_SERVER.NAME) and (TM_SYS_SERVER.HOSPITAL_ID = '_SYSTEM_')              where TM_SYS_SERVICEMAP.HOSPITAL_ID = '_SYSTEM_' AND TM_SYS_SERVICEMAP.TYPE = 'S'  AND ACTIVE = '1'              order by URL]
2019-09-20 11:21:18,269 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = '_SYSTEM_'               AND                   TM_SYS_SCREEN.PAGE = 'LOGIN'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2019-09-20 11:21:18,477 [1] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = '_SYSTEM_'               AND                   TM_SYS_CACHE.ACTIVE = '1']
2019-09-20 11:21:28,459 [1] DEBUG - Statement Id: [DAO00001_DBList] PreparedStatement : [select *              from TM_SYS_SERVER              where HOSPITAL_ID = 'HLU01' and TYPE = 'D']
2019-09-20 11:21:28,491 [1] DEBUG - Statement Id: [DAO00001_DaoList] PreparedStatement : [select              TM_SYS_SERVICEMAP.ID,              TM_SYS_SERVICEMAP.HOSPITAL_ID,              TM_SYS_SERVICEMAP.DB_NAME,              TM_SYS_SERVICEMAP.TYPE,              TM_SYS_SERVICEMAP.NAME,              TM_SYS_SERVICEMAP.CLASS,              (TM_SYS_DIC.VALUE + '.' + TM_SYS_SERVICEMAP.CLASS) as CLASSFULL,              TM_SYS_SERVICEMAP.ASSEMBLY              from TM_SYS_SERVICEMAP              inner join TM_SYS_DIC              on TM_SYS_SERVICEMAP.NAMESPACE = TM_SYS_DIC.ID              where HOSPITAL_ID = 'HLU01' AND TYPE = 'D' AND ACTIVE = '1'              order by DB_NAME]
2019-09-20 11:21:30,104 [1] DEBUG - Statement Id: [DAO00001_ServiceList] PreparedStatement : [select              TM_SYS_SERVICEMAP.ID,              TM_SYS_SERVICEMAP.HOSPITAL_ID,              TM_SYS_SERVICEMAP.DB_NAME,              TM_SYS_SERVICEMAP.TYPE,              TM_SYS_SERVICEMAP.NAME,              TM_SYS_SERVICEMAP.CLASS,              (TM_SYS_DIC.VALUE + '.' + TM_SYS_SERVICEMAP.CLASS) as CLASSFULL,              TM_SYS_SERVICEMAP.ASSEMBLY,              TM_SYS_SERVER.URL              from TM_SYS_SERVICEMAP              inner join TM_SYS_DIC on TM_SYS_SERVICEMAP.NAMESPACE = TM_SYS_DIC.ID              inner join TM_SYS_SERVER on (TM_SYS_SERVICEMAP.DB_NAME = TM_SYS_SERVER.NAME) and (TM_SYS_SERVER.HOSPITAL_ID = 'HLU01')              where TM_SYS_SERVICEMAP.HOSPITAL_ID = 'HLU01' AND TM_SYS_SERVICEMAP.TYPE = 'S'  AND ACTIVE = '1'              order by URL]
2019-09-20 11:21:30,679 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1']
2019-09-20 11:21:31,924 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM005']
2019-09-20 11:21:32,091 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM015']
2019-09-20 11:21:32,169 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM067']
2019-09-20 11:21:32,312 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM008']
2019-09-20 11:21:32,393 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM068']
2019-09-20 11:21:32,476 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM006']
2019-09-20 11:21:32,559 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM030']
2019-09-20 11:21:32,655 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM025']
2019-09-20 11:21:32,751 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM024']
2019-09-20 11:21:33,258 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM033']
2019-09-20 11:21:33,297 [5] DEBUG - Statement Id: [DAO00027_GetListDuocKyGuiTonKho] PreparedStatement : [select  distinct TT_TONKHO.DUOC_KEY, LTRIM(TT_TONKHO.KHODUOC_ID) as KHODUOC_ID, TM_DUOC.DUOC_ID, TM_LOAIDUOC.MALOAIDUOC,TM_DUOC.SOVISA,TM_DUOC.TYLE_VAT,TM_DUOC.COTOA,        TM_DUOC.MADUOC, TM_DUOC.TENHANG, TM_DUOC.TENDUOCDAYDU, dvt.TENDONVITINH as DONVITINH,  TM_DUOC.DONVITINH_ID,TM_DUOC.BHYT,TM_DUOC.PHAMVI,        TM_DUOC.TENHOATCHAT, TM_DUOC.HAMLUONG, TM_DUOC.HANGSANXUAT, TM_DUOC.QUOCGIA, TM_DUOC.LOAIDUOC_ID, TM_DUOC.DUONGDUNG_ID,        TM_TENDUOC.TENDUOC, TM_TENDUOC.TENDUOC_EN, TM_TENDUOC.MAQUOCTE, TM_TENDUOC.MAQUOCTEBT,        TM_LOAIDUOC.LOAIVATTU_ID, TM_DUOC.BENHVIEN_ID,TT_TONKHO.SOLUONG, TT_TONKHO.NGUONDUOC_ID, NH.TENNGUONDUOC        , TAMNGUNG = CASE WHEN TM_DUOC.TAMNGUNG = '1' OR nh.TAMNGUNG = '1' OR KD.TAMNGUNG = '1' THEN '1' ELSE '0' END        , TM_DUOC.DANGTRINHBAY        from TM_DUOC        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = TM_DUOC.DONVITINH_ID        left join TM_TENDUOC on TM_DUOC.TENDUOC_ID = TM_TENDUOC.TENDUOC_ID and TM_DUOC.BENHVIEN_ID = 'HLU01' and TM_DUOC.TAMNGUNG = '0'        left join TM_LOAIDUOC on TM_LOAIDUOC.LOAIDUOC_ID = TM_DUOC.LOAIDUOC_ID and TM_LOAIDUOC.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG on (TM_LOAIDUOC.LOAIVATTU_ID = TM_DUOC_HANDUNG.LOAIDUOC and TM_DUOC_HANDUNG.BENHVIEN_ID = 'HLU01')        inner join        (select LTRIM(A.KHODUOC_ID) + '_' + LTRIM(A.DUOC_ID) + '_' + LTRIM(ISNULL(A.NGUONDUOC_ID,'')) as DUOC_KEY, A.KHODUOC_ID, A.DUOC_ID,A.NGUONDUOC_ID,        SUM(isnull(A.SOLUONG,0)) as SOLUONG        from        (select SUM(SOLUONG) as SOLUONG, KHODUOC_ID, DUOC_ID, NGUONDUOC_ID from TT_DUOC_KYGUI_TONKHO        where BENHVIEN_ID = 'HLU01' group by KHODUOC_ID, DUOC_ID, NGUONDUOC_ID) A        group by LTRIM(A.KHODUOC_ID) + '_' + LTRIM(A.DUOC_ID) + '_' + LTRIM(A.NGUONDUOC_ID), A.KHODUOC_ID, A.DUOC_ID, A.NGUONDUOC_ID)        TT_TONKHO on TT_TONKHO.DUOC_ID = TM_DUOC.DUOC_ID        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = TT_TONKHO.NGUONDUOC_ID and nh.BENHVIEN_ID = 'HLU01'        LEFT JOIN TM_KHODUOC KD ON KD.KHODUOC_ID = TT_TONKHO.KHODUOC_ID        where TM_DUOC.BENHVIEN_ID = 'HLU01' AND TT_TONKHO.SOLUONG >= 0]
2019-09-20 11:21:33,383 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM018']
2019-09-20 11:21:33,421 [5] DEBUG - Statement Id: [DAO00027_GetListDuocTonKho] PreparedStatement : [select distinct TT_TONKHO.DUOC_KEY, LTRIM(TT_TONKHO.KHODUOC_ID) as KHODUOC_ID, TM_DUOC.DUOC_ID, TM_LOAIDUOC.MALOAIDUOC,TM_DUOC.SOVISA,TM_DUOC.TYLE_VAT,TM_DUOC.COTOA,        TM_DUOC.MADUOC, TM_DUOC.TENHANG, TM_DUOC.TENDUOCDAYDU, dvt.TENDONVITINH as DONVITINH,  TM_DUOC.DONVITINH_ID,TM_DUOC.BHYT,                TM_DUOC.TENHOATCHAT,          TM_DUOC.HAMLUONG, TM_DUOC.HANGSANXUAT, TM_DUOC.QUOCGIA, TM_DUOC.LOAIDUOC_ID, TM_DUOC.DUONGDUNG_ID,        TM_TENDUOC.TENDUOC, TM_TENDUOC.TENDUOC_EN, TM_TENDUOC.MAQUOCTE, TM_TENDUOC.MAQUOCTEBT,        TM_LOAIDUOC.LOAIVATTU_ID, TM_DUOC.BENHVIEN_ID,        TT_TONKHO.SOLUONG, TM_DUOC.VTYT_PHANLOAI, TM_DUOC.PHAMVI, TT_TONKHO.NGUONDUOC_ID, NG.TENNGUONDUOC AS TENNGUONDUOC        , TAMNGUNG = CASE WHEN TM_DUOC.TAMNGUNG = '1' OR NG.TAMNGUNG = '1' OR KD.TAMNGUNG = '1' THEN '1' ELSE '0' END        , TM_DUOC.DANGTRINHBAY        from TM_DUOC        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = TM_DUOC.DONVITINH_ID        left join TM_TENDUOC on TM_DUOC.TENDUOC_ID = TM_TENDUOC.TENDUOC_ID and TM_DUOC.BENHVIEN_ID = 'HLU01' and TM_DUOC.TAMNGUNG = '0'        left join TM_LOAIDUOC on TM_LOAIDUOC.LOAIDUOC_ID = TM_DUOC.LOAIDUOC_ID and TM_LOAIDUOC.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG on (TM_LOAIDUOC.LOAIVATTU_ID = TM_DUOC_HANDUNG.LOAIDUOC and TM_DUOC_HANDUNG.BENHVIEN_ID = 'HLU01')        inner join        (select LTRIM(A.KHODUOC_ID) + '_' + LTRIM(A.DUOC_ID) + '_' + LTRIM(ISNULL(A.NGUONDUOC_ID,'')) as DUOC_KEY, A.KHODUOC_ID, A.DUOC_ID, A.NGUONDUOC_ID,        SUM(isnull(A.SOLUONG,0)) as SOLUONG        from        (select SUM(SOLUONG) as SOLUONG, KHODUOC_ID, DUOC_ID, NGUONDUOC_ID from TT_DUOC_TONKHO        where BENHVIEN_ID = 'HLU01' group by KHODUOC_ID, DUOC_ID, NGUONDUOC_ID) A        group by LTRIM(A.KHODUOC_ID) + '_' + LTRIM(A.DUOC_ID) + '_' + LTRIM(ISNULL(A.NGUONDUOC_ID,'')), A.KHODUOC_ID, A.DUOC_ID, NGUONDUOC_ID        ) TT_TONKHO on TT_TONKHO.DUOC_ID = TM_DUOC.DUOC_ID        LEFT JOIN TM_NGUONHANG NG ON NG.NGUONDUOC_ID = TT_TONKHO.NGUONDUOC_ID        LEFT JOIN TM_KHODUOC KD ON KD.KHODUOC_ID = TT_TONKHO.KHODUOC_ID        where TM_DUOC.BENHVIEN_ID = 'HLU01' and TT_TONKHO.SOLUONG >= 0]
2019-09-20 11:21:34,651 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM023']
2019-09-20 11:21:34,687 [5] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoVaBooking] PreparedStatement : [declare @NGUONDUOC_MACDINH varchar(5) = '0';        declare @TOAMUANGOAI int = 0;        select @NGUONDUOC_MACDINH = isnull(VALUE,0) from TM_SYS_APPSETTINGS where CODE = 'PHA_NGUONDUOC'        select @TOAMUANGOAI = isnull(VALUE,0) from TM_SYS_APPSETTINGS where CODE = 'OPD_TOAMUANGOAI_DUNGDANHMUC_DUOC'                if @TOAMUANGOAI = 1        begin        select  distinct '0' + '_' + LTRIM(d.DUOC_ID) + '_' + @NGUONDUOC_MACDINH as DUOC_KEY, 0 as PHAMVI_ID, @NGUONDUOC_MACDINH as NGUONDUOC_ID, null as TENNGUONDUOC, null as TINHTIEN, d.DUOC_ID, ld.MALOAIDUOC,        d.SOVISA,d.TYLE_VAT,d.COTOA, d.MADUOC, d.TENHANG, d.TENDUOCDAYDU, d.DONVITINH as DONVITINH, d.BHYT,        d.TENHOATCHAT, d.HAMLUONG, d.HANGSANXUAT, d.QUOCGIA, d.LOAIDUOC_ID, d.DUONGDUNG_ID, d.TINHTIEN_PTTT,        ten.TENDUOC, ten.TENDUOC_EN, ten.MAQUOCTE, ten.MAQUOCTEBT,        '' as BHYT_TEXT        , ld.LOAIVATTU_ID        , d.BENHVIEN_ID,        999999999 as SOLUONG, d.VTYT_PHANLOAI, d.PHAMVI, d.SUASOLUONGTONGHOP, d.MADUOCBV, d.DANGTRINHBAY        , TAMNGUNG = CASE WHEN d.TAMNGUNG = '1' THEN '1' ELSE '0' END        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        union all        select  distinct tk.DUOC_KEY, LTRIM(tk.PHAMVI_ID) as PHAMVI_ID, tk.NGUONDUOC_ID, nh.TENNGUONDUOC, nh.TINHTIEN, d.DUOC_ID, ld.MALOAIDUOC,        d.SOVISA,d.TYLE_VAT,d.COTOA, d.MADUOC, d.TENHANG, d.TENDUOCDAYDU, d.DONVITINH as DONVITINH, d.BHYT,        d.TENHOATCHAT, d.HAMLUONG, d.HANGSANXUAT, d.QUOCGIA, d.LOAIDUOC_ID, d.DUONGDUNG_ID, d.TINHTIEN_PTTT,        ten.TENDUOC, ten.TENDUOC_EN, ten.MAQUOCTE, ten.MAQUOCTEBT,        CASE WHEN d.BHYT = '1' THEN 'BHYT' ELSE '' END as BHYT_TEXT        , ld.LOAIVATTU_ID        , d.BENHVIEN_ID,        tk.SOLUONG, d.VTYT_PHANLOAI, d.PHAMVI, d.SUASOLUONGTONGHOP, d.MADUOCBV, d.DANGTRINHBAY        , TAMNGUNG = CASE WHEN d.TAMNGUNG = '1' OR nh.TAMNGUNG = '1' OR kd.TAMNGUNG = '1' THEN '1' ELSE '0' END        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        inner join        (        select  LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')) DUOC_KEY, (SUM(dtk.SOLUONG) - isnull(sum(A.SOLUONG),0) - isnull(sum(B.SOLUONG),0)) SOLUONG, pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        from (select sum(soluong) soluong,duoc_id,nguonduoc_id,khoduoc_id,benhvien_id from TT_DUOC_TONKHO  group by duoc_id,nguonduoc_id,khoduoc_id,benhvien_id) dtk        inner join TM_DUOC_PHAMVISD_MAPPING pvsd on dtk.KHODUOC_ID = pvsd.KHODUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NOITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) B on B.DUOC_ID = dtk.DUOC_ID and B.SOLUONG > 0 and B.PHAMVI_ID = pvsd.PHAMVI_ID and B.NGUONHANG_ID = dtk.NGUONDUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NGOAITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) A on A.DUOC_ID = dtk.DUOC_ID and A.SOLUONG > 0 and A.PHAMVI_ID = pvsd.PHAMVI_ID and A.NGUONHANG_ID = dtk.NGUONDUOC_ID        where dtk.SOLUONG > 0 and dtk.BENHVIEN_ID = 'HLU01'        group by LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')), pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        ) tk on tk.DUOC_ID = d.DUOC_ID        left join TM_DUOC_PHAMVISUDUNG kd on kd.PHAMVI_ID = tk.PHAMVI_ID and kd.BENHVIEN_ID = 'HLU01'        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = tk.NGUONDUOC_ID and nh.BENHVIEN_ID = 'HLU01'        where d.BENHVIEN_ID = 'HLU01'  and tk.SOLUONG >= 0        end        else        begin                  select  distinct tk.DUOC_KEY, LTRIM(tk.PHAMVI_ID) as PHAMVI_ID, tk.NGUONDUOC_ID, nh.TENNGUONDUOC, nh.TINHTIEN, d.DUOC_ID, ld.MALOAIDUOC,        d.SOVISA,d.TYLE_VAT,d.COTOA, d.MADUOC, d.TENHANG, d.TENDUOCDAYDU, d.DONVITINH as DONVITINH, d.BHYT,        d.TENHOATCHAT, d.HAMLUONG, d.HANGSANXUAT, d.QUOCGIA, d.LOAIDUOC_ID, d.DUONGDUNG_ID, d.TINHTIEN_PTTT,        ten.TENDUOC, ten.TENDUOC_EN, ten.MAQUOCTE, ten.MAQUOCTEBT,        CASE WHEN d.BHYT = '1' THEN 'BHYT' ELSE '' END as BHYT_TEXT        , ld.LOAIVATTU_ID        , d.BENHVIEN_ID,        tk.SOLUONG, d.VTYT_PHANLOAI, d.PHAMVI, d.SUASOLUONGTONGHOP, d.MADUOCBV, d.DANGTRINHBAY        , TAMNGUNG = CASE WHEN d.TAMNGUNG = '1' OR nh.TAMNGUNG = '1' OR kd.TAMNGUNG = '1' THEN '1' ELSE '0' END        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        inner join        (        select  LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')) DUOC_KEY, (SUM(dtk.SOLUONG) - isnull(sum(A.SOLUONG),0) - isnull(sum(B.SOLUONG),0)) SOLUONG, pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        from (select sum(soluong) soluong,duoc_id,nguonduoc_id,khoduoc_id,benhvien_id from TT_DUOC_TONKHO  group by duoc_id,nguonduoc_id,khoduoc_id,benhvien_id) dtk        inner join TM_DUOC_PHAMVISD_MAPPING pvsd on dtk.KHODUOC_ID = pvsd.KHODUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NOITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) B on B.DUOC_ID = dtk.DUOC_ID and B.SOLUONG > 0 and B.PHAMVI_ID = pvsd.PHAMVI_ID and B.NGUONHANG_ID = dtk.NGUONDUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NGOAITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) A on A.DUOC_ID = dtk.DUOC_ID and A.SOLUONG > 0 and A.PHAMVI_ID = pvsd.PHAMVI_ID and A.NGUONHANG_ID = dtk.NGUONDUOC_ID        where dtk.SOLUONG > 0 and dtk.BENHVIEN_ID = 'HLU01'        group by LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')), pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        ) tk on tk.DUOC_ID = d.DUOC_ID        left join TM_DUOC_PHAMVISUDUNG kd on kd.PHAMVI_ID = tk.PHAMVI_ID and kd.BENHVIEN_ID = 'HLU01'        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = tk.NGUONDUOC_ID and nh.BENHVIEN_ID = 'HLU01'        where d.BENHVIEN_ID = 'HLU01'  and tk.SOLUONG >= 0        end]
2019-09-20 11:21:36,834 [5] DEBUG - Statement Id: [DAO00320_GetList] PreparedStatement : [select M.*            from TM_MAU M            LEFT JOIN TM_MAU_DONVITINH DVT on M.DONVITINH_ID=DVT.DONVITINH_ID            where            M.TAMNGUNG = '0'            and M.BENHVIEN_ID = 'HLU01'            order by M.TENMAU]
2019-09-20 11:21:36,913 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM071']
2019-09-20 11:21:36,974 [5] DEBUG - Statement Id: [DAO00322_GetListMauTonKhoForCreateCached] PreparedStatement : [SELECT DISTINCT          TK.MAU_KEY, TK.KHOMAU_ID, M.MAU_ID, M.MAMAU, M.TENMAU, M.NHOM_ABO, M.NHOM_RH, M.LOAIMAU_ID,          TK.SOLONHAP_ID, SLN.SOLONHAP, SLN.SOKIEMSOAT, TK.NGUONHANG_ID, NG.TENNGUONMAU, M.BENHVIEN_ID, M.DONVITINH_ID,          SUM(tk.SOLUONG) AS SOLUONG,K.TENKHO,DVT.TENDONVITINH          FROM TT_MAU_TONKHO TK          JOIN TM_KHO K ON TK.KHOMAU_ID = K.KHO_ID          JOIN TT_MAU_CHUNGTU_SOLONHAP SLN ON TK.SOLONHAP_ID = SLN.SOLONHAP_ID          JOIN TM_MAU M on TK.MAU_ID = M.MAU_ID and M.TAMNGUNG = '0'          LEFT JOIN TM_MAU_DONVITINH DVT on M.DONVITINH_ID=DVT.DONVITINH_ID          LEFT JOIN TM_NGUONMAU NG ON NG.NGUONMAU_ID = TK.NGUONHANG_ID          WHERE TK.SOLUONG > 0          GROUP BY TK.MAU_KEY, TK.KHOMAU_ID, M.MAU_ID, M.MAMAU, M.TENMAU, M.NHOM_ABO, M.NHOM_RH, M.LOAIMAU_ID,          TK.SOLONHAP_ID, SLN.SOLONHAP, SLN.SOKIEMSOAT,TK.NGUONHANG_ID, NG.TENNGUONMAU, M.BENHVIEN_ID, M.DONVITINH_ID,K.TENKHO,DVT.TENDONVITINH]
2019-09-20 11:21:37,058 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM073']
2019-09-20 11:21:37,093 [5] DEBUG - Statement Id: [DAO00322_GetListMauTonKhoTruBooking] PreparedStatement : [select distinct          TK.MAU_KEY, TK.KHOMAU_ID, M.MAU_ID, M.MAMAU, M.TENMAU, M.NHOM_ABO, M.NHOM_RH, M.LOAIMAU_ID, M.DONVITINH_ID,          TK.SOLONHAP_ID, TK.SOLONHAP, TK.SOKIEMSOAT,M.PHAMVI, TK.NGUONHANG_ID, NG.TENNGUONMAU, M.BENHVIEN_ID,          TK.SOLUONG,TK.TENKHO,DVT.TENDONVITINH          from TM_MAU M          JOIN          (          select          A.MAU_KEY, A.KHOMAU_ID, A.MAU_ID ,a.NGUONHANG_ID, A.SOLONHAP_ID, A.SOLONHAP, A.SOKIEMSOAT, A.SOLUONG,A.TENKHO          from          (          select KHOMAU_ID, TK.MAU_ID, TK.NGUONHANG_ID, TK.MAU_KEY, SLN.SOLONHAP_ID, SLN.SOLONHAP, SLN.SOKIEMSOAT, ISNULL(TK.SOLUONG,0) - ISNULL(book.SOLUONG,0) as SOLUONG,K.TENKHO          from TT_MAU_TONKHO TK          JOIN TM_KHO K ON TK.KHOMAU_ID = K.KHO_ID          inner join TT_MAU_CHUNGTU_SOLONHAP SLN ON TK.SOLONHAP_ID = SLN.SOLONHAP_ID          left join dbo.TT_MAU_TONKHO_BOOK book ON book.MAU_KEY = TK.MAU_KEY AND book.TRANGTHAI = 'HIEULUC'          where ISNULL(TK.SOLUONG,0) - ISNULL(book.SOLUONG,0) > 0          ) A          )TK on TK.MAU_ID = M.MAU_ID and M.TAMNGUNG = '0'          LEFT JOIN TM_MAU_DONVITINH DVT on M.DONVITINH_ID=DVT.DONVITINH_ID          LEFT JOIN TM_NGUONMAU NG ON NG.NGUONMAU_ID = TK.NGUONHANG_ID]
2019-09-20 11:21:37,164 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM072']
2019-09-20 11:21:38,089 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'MAIN'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2019-09-20 11:21:38,887 [1] DEBUG - Statement Id: [DAO00002_FormList] PreparedStatement : [select              TM_SYS_FORM.HOSPITAL_ID,              TM_SYS_FORM.NAME,              TM_SYS_FORM.CLASS,              TM_SYS_FORM.ASSEMBLY,              TM_SYS_FORM.TITLE_VI as TITLE              from TM_SYS_FORM              where HOSPITAL_ID = 'HLU01']
2019-09-20 11:21:44,027 [1] DEBUG - Statement Id: [DAO00300_GetShortcutListByUserID] PreparedStatement : [SELECT S.SHORTCUT_CODE, S.SHORTCUT_VALUE              FROM TM_SHORTCUT AS S              WHERE S.BENHVIEN_ID = 'HLU01' AND S.USER_ID = '1' AND TAMNGUNG = '0']
2019-09-20 11:21:44,700 [1] DEBUG - Statement Id: [DAO00087_GetList] PreparedStatement : [select CODE, VALUE, BENHVIEN_ID              from TM_SYS_APPSETTINGS              where LOCKED = '0' and BENHVIEN_ID = 'HLU01'              order by SETTING_ID]
2019-09-20 11:21:45,325 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'MSG01'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2019-09-20 11:21:45,463 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'MSG02'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2019-09-20 11:21:45,621 [1] DEBUG - Statement Id: [DAO00008_GetUserSettings] PreparedStatement : [select A.*, B.TENKHO , C.TENPHONGBAN, B.MAKHO, C.MAPHONGBAN          from TM_SYS_USERS A          left join TM_KHODUOC B on B.KHODUOC_ID = A.INVENTORY_ID          left join TM_PHONGBAN C on (C.PHONGBAN_ID = A.WORKING_DEPT_ID and C.BENHVIEN_ID =  @param0 )          left join TM_SYS_USERKHO D on (D.ACCOUNT_ID = A.ACCOUNT_ID and D.HOSPITAL_ID =  @param0 )          where          A.HOSPITAL_ID =  @param0            and                 A.ACCOUNT_ID =  @param1]
2019-09-20 11:21:45,623 [1] DEBUG - Statement Id: [DAO00008_GetUserSettings] Parameters: [@param0=[HOSPITAL_ID,HLU01], @param1=[ACCOUNT_ID,113]]
2019-09-20 11:21:45,623 [1] DEBUG - Statement Id: [DAO00008_GetUserSettings] Types: [@param0=[String, System.String], @param1=[String, System.String]]
2019-09-20 11:21:45,673 [1] DEBUG - Statement Id: [DAO00008_GetUserInvSettings] PreparedStatement : [select A.*, B.TENKHO, B.MAKHO, B.LOAIKHO_ID, B.KHOQUANLY_ID          from TM_SYS_USERKHO A          left join TM_KHO B on B.MODULE_ID = A.MODULE_ID and B.KHO_ID = A.KHO_ID          where A.HOSPITAL_ID =  @param0  and A.ACCOUNT_ID =  @param1           order by B.TENKHO]
2019-09-20 11:21:45,673 [1] DEBUG - Statement Id: [DAO00008_GetUserInvSettings] Parameters: [@param0=[HOSPITAL_ID,HLU01], @param1=[ACCOUNT_ID,113]]
2019-09-20 11:21:45,673 [1] DEBUG - Statement Id: [DAO00008_GetUserInvSettings] Types: [@param0=[String, System.String], @param1=[String, System.String]]
2019-09-20 11:21:45,831 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'COM30'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2019-09-20 11:21:45,997 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'RIS04'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2019-09-20 11:21:53,176 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'MENU1'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2019-09-20 11:21:53,311 [1] DEBUG - Statement Id: [DAO00011_GetList] PreparedStatement : [select              TM_SYS_MENU.ID,              TM_SYS_MENU.PARENTID,              TM_SYS_MENU.SCREEN,              TM_SYS_MENU.SMALLIMAGE,              TM_SYS_MENU.LARGEIMAGE,              TM_SYS_MENU.DESCRIPTION,              TM_SYS_MENU.TYPE,              TM_SYS_MENU.TITLE_VI as TITLE              from TM_SYS_MENU              where TM_SYS_MENU.HOSPITAL_ID = 'HLU01' and TM_SYS_MENU.ACTIVE = '1'               AND                   (TM_SYS_MENU.TYPE & '8' = '8')                             order by TM_SYS_MENU.ORDERNUM]
2019-09-20 11:21:53,554 [1] DEBUG - Statement Id: [DAO00011_usermenu_list] PreparedStatement : [select              TM_SYS_HOMEMENU.MENUID as ID,              TM_SYS_MENU.TITLE_VI as TITLE,              TM_SYS_MENU.SCREEN,              TM_SYS_MENU.SMALLIMAGE,              TM_SYS_MENU.LARGEIMAGE,              TM_SYS_MENU.TYPE              from TM_SYS_HOMEMENU              left join TM_SYS_MENU on TM_SYS_MENU.ID = TM_SYS_HOMEMENU.MENUID and TM_SYS_MENU.HOSPITAL_ID = TM_SYS_HOMEMENU.HOSPITAL_ID              where TM_SYS_HOMEMENU.HOSPITAL_ID = 'HLU01' and TM_SYS_HOMEMENU.USERID = '113' and TM_SYS_MENU.ACTIVE = '1'               AND                   (TM_SYS_MENU.TYPE & '8' = '8')                             ORDER BY TM_SYS_HOMEMENU.ORDERNUM]
2019-09-20 11:22:07,691 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'COM31'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2019-09-20 11:22:07,841 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'ORM28'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2019-09-20 11:22:12,707 [1] DEBUG - Statement Id: [DAO00066_GetBENHAN_TIEPNHAN] PreparedStatement : [select top 1 *        from TT_NOITRU_BENHAN        where TIEPNHAN_ID = '27022'  and BENHVIEN_ID = 'HLU01'        order by NGAYTAO desc]
2019-09-20 11:22:12,810 [1] DEBUG - Statement Id: [DAO00014_GetInPatientStatus] PreparedStatement : [select TRANGTHAI, isnull(KHOACHUYENDEN_ID, KHOAVAO_ID) as KHOAHIENTAI from TT_NOITRU_BENHAN        where        TIEPNHAN_ID = '27022'        and BENHVIEN_ID = 'HLU01'         and           BENHAN_ID = '5800']
2019-09-20 11:22:12,910 [1] DEBUG - Statement Id: [DAO00048_TT_PHAUTHUAT_GetList] PreparedStatement : [select *              from TT_PHAUTHUAT               where                             TT_PHAUTHUAT.LOAI = 'P'                       and                           TT_PHAUTHUAT.TIEPNHAN_ID = 27022                       and                           TT_PHAUTHUAT.BENHVIEN_ID = 'HLU01'                                     order by PHAUTHUAT_ID DESC]
2019-09-20 11:22:12,974 [1] DEBUG - Statement Id: [DAO00048_GetListLoaiGacTrongPTTT] PreparedStatement : [select DICTIONARY_ID, DICTIONARY_CODE, DICTIONARY_NAME          from LST_DICTIONARY          where DICTIONARY_TYPE_CODE = 'LoaiGacPTTT'          and ENABLED = '1']
2019-09-20 11:22:20,403 [1] DEBUG - Statement Id: [DAO00048_GetDSLoaiGacDaGhiNhan] PreparedStatement : [select A.KIEMSOATGAC_ID, A.BENHNHAN_ID, A.TIEPNHAN_ID, A.BENHAN_ID, A.PHAUTHUAT_ID, A.LOAIPT_TT, A.LOAIGAC_ID          , A.NGAYGHINHAN, A.THOIGIANGHINHAN, A.SOLUONG, A.SOLUONGDASUDUNG, A.SOLUONGCONLAI, A.GHICHU, A.NGUOINHANDUNGCU_ID          , B.DICTIONARY_CODE AS MALOAIGAC, B.DICTIONARY_NAME AS TENLOAIGAC          from TT_PHAUTHUAT_GHINHANGAC A          inner join LST_DICTIONARY B on B.DICTIONARY_ID = A.LOAIGAC_ID          where A.PHAUTHUAT_ID = 3742 and A.BENHVIEN_ID = 'HLU01']
--------------------------------------------------------------------------------
2019-09-20 11:23:22,410 [1] DEBUG - Statement Id: [DAO00001_DBList] PreparedStatement : [select *              from TM_SYS_SERVER              where HOSPITAL_ID = '_SYSTEM_' and TYPE = 'D']
2019-09-20 11:23:23,085 [1] DEBUG - Statement Id: [DAO00001_DaoList] PreparedStatement : [select              TM_SYS_SERVICEMAP.ID,              TM_SYS_SERVICEMAP.HOSPITAL_ID,              TM_SYS_SERVICEMAP.DB_NAME,              TM_SYS_SERVICEMAP.TYPE,              TM_SYS_SERVICEMAP.NAME,              TM_SYS_SERVICEMAP.CLASS,              (TM_SYS_DIC.VALUE + '.' + TM_SYS_SERVICEMAP.CLASS) as CLASSFULL,              TM_SYS_SERVICEMAP.ASSEMBLY              from TM_SYS_SERVICEMAP              inner join TM_SYS_DIC              on TM_SYS_SERVICEMAP.NAMESPACE = TM_SYS_DIC.ID              where HOSPITAL_ID = '_SYSTEM_' AND TYPE = 'D' AND ACTIVE = '1'              order by DB_NAME]
2019-09-20 11:23:23,127 [1] DEBUG - Statement Id: [DAO00001_ServiceList] PreparedStatement : [select              TM_SYS_SERVICEMAP.ID,              TM_SYS_SERVICEMAP.HOSPITAL_ID,              TM_SYS_SERVICEMAP.DB_NAME,              TM_SYS_SERVICEMAP.TYPE,              TM_SYS_SERVICEMAP.NAME,              TM_SYS_SERVICEMAP.CLASS,              (TM_SYS_DIC.VALUE + '.' + TM_SYS_SERVICEMAP.CLASS) as CLASSFULL,              TM_SYS_SERVICEMAP.ASSEMBLY,              TM_SYS_SERVER.URL              from TM_SYS_SERVICEMAP              inner join TM_SYS_DIC on TM_SYS_SERVICEMAP.NAMESPACE = TM_SYS_DIC.ID              inner join TM_SYS_SERVER on (TM_SYS_SERVICEMAP.DB_NAME = TM_SYS_SERVER.NAME) and (TM_SYS_SERVER.HOSPITAL_ID = '_SYSTEM_')              where TM_SYS_SERVICEMAP.HOSPITAL_ID = '_SYSTEM_' AND TM_SYS_SERVICEMAP.TYPE = 'S'  AND ACTIVE = '1'              order by URL]
2019-09-20 11:23:23,502 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = '_SYSTEM_'               AND                   TM_SYS_SCREEN.PAGE = 'LOGIN'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2019-09-20 11:23:23,704 [1] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = '_SYSTEM_'               AND                   TM_SYS_CACHE.ACTIVE = '1']
2019-09-20 11:23:46,629 [1] DEBUG - Statement Id: [DAO00001_DBList] PreparedStatement : [select *              from TM_SYS_SERVER              where HOSPITAL_ID = 'HLU01' and TYPE = 'D']
2019-09-20 11:23:46,661 [1] DEBUG - Statement Id: [DAO00001_DaoList] PreparedStatement : [select              TM_SYS_SERVICEMAP.ID,              TM_SYS_SERVICEMAP.HOSPITAL_ID,              TM_SYS_SERVICEMAP.DB_NAME,              TM_SYS_SERVICEMAP.TYPE,              TM_SYS_SERVICEMAP.NAME,              TM_SYS_SERVICEMAP.CLASS,              (TM_SYS_DIC.VALUE + '.' + TM_SYS_SERVICEMAP.CLASS) as CLASSFULL,              TM_SYS_SERVICEMAP.ASSEMBLY              from TM_SYS_SERVICEMAP              inner join TM_SYS_DIC              on TM_SYS_SERVICEMAP.NAMESPACE = TM_SYS_DIC.ID              where HOSPITAL_ID = 'HLU01' AND TYPE = 'D' AND ACTIVE = '1'              order by DB_NAME]
2019-09-20 11:23:48,346 [1] DEBUG - Statement Id: [DAO00001_ServiceList] PreparedStatement : [select              TM_SYS_SERVICEMAP.ID,              TM_SYS_SERVICEMAP.HOSPITAL_ID,              TM_SYS_SERVICEMAP.DB_NAME,              TM_SYS_SERVICEMAP.TYPE,              TM_SYS_SERVICEMAP.NAME,              TM_SYS_SERVICEMAP.CLASS,              (TM_SYS_DIC.VALUE + '.' + TM_SYS_SERVICEMAP.CLASS) as CLASSFULL,              TM_SYS_SERVICEMAP.ASSEMBLY,              TM_SYS_SERVER.URL              from TM_SYS_SERVICEMAP              inner join TM_SYS_DIC on TM_SYS_SERVICEMAP.NAMESPACE = TM_SYS_DIC.ID              inner join TM_SYS_SERVER on (TM_SYS_SERVICEMAP.DB_NAME = TM_SYS_SERVER.NAME) and (TM_SYS_SERVER.HOSPITAL_ID = 'HLU01')              where TM_SYS_SERVICEMAP.HOSPITAL_ID = 'HLU01' AND TM_SYS_SERVICEMAP.TYPE = 'S'  AND ACTIVE = '1'              order by URL]
2019-09-20 11:23:48,429 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1']
2019-09-20 11:23:49,305 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM005']
2019-09-20 11:23:49,562 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM015']
2019-09-20 11:23:49,679 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM067']
2019-09-20 11:23:49,757 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM008']
2019-09-20 11:23:49,848 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM068']
2019-09-20 11:23:49,925 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM006']
2019-09-20 11:23:50,005 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM030']
2019-09-20 11:23:50,130 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM025']
2019-09-20 11:23:50,223 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM024']
2019-09-20 11:23:50,739 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM033']
2019-09-20 11:23:51,011 [5] DEBUG - Statement Id: [DAO00027_GetListDuocKyGuiTonKho] PreparedStatement : [select  distinct TT_TONKHO.DUOC_KEY, LTRIM(TT_TONKHO.KHODUOC_ID) as KHODUOC_ID, TM_DUOC.DUOC_ID, TM_LOAIDUOC.MALOAIDUOC,TM_DUOC.SOVISA,TM_DUOC.TYLE_VAT,TM_DUOC.COTOA,        TM_DUOC.MADUOC, TM_DUOC.TENHANG, TM_DUOC.TENDUOCDAYDU, dvt.TENDONVITINH as DONVITINH,  TM_DUOC.DONVITINH_ID,TM_DUOC.BHYT,TM_DUOC.PHAMVI,        TM_DUOC.TENHOATCHAT, TM_DUOC.HAMLUONG, TM_DUOC.HANGSANXUAT, TM_DUOC.QUOCGIA, TM_DUOC.LOAIDUOC_ID, TM_DUOC.DUONGDUNG_ID,        TM_TENDUOC.TENDUOC, TM_TENDUOC.TENDUOC_EN, TM_TENDUOC.MAQUOCTE, TM_TENDUOC.MAQUOCTEBT,        TM_LOAIDUOC.LOAIVATTU_ID, TM_DUOC.BENHVIEN_ID,TT_TONKHO.SOLUONG, TT_TONKHO.NGUONDUOC_ID, NH.TENNGUONDUOC        , TAMNGUNG = CASE WHEN TM_DUOC.TAMNGUNG = '1' OR nh.TAMNGUNG = '1' OR KD.TAMNGUNG = '1' THEN '1' ELSE '0' END        , TM_DUOC.DANGTRINHBAY        from TM_DUOC        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = TM_DUOC.DONVITINH_ID        left join TM_TENDUOC on TM_DUOC.TENDUOC_ID = TM_TENDUOC.TENDUOC_ID and TM_DUOC.BENHVIEN_ID = 'HLU01' and TM_DUOC.TAMNGUNG = '0'        left join TM_LOAIDUOC on TM_LOAIDUOC.LOAIDUOC_ID = TM_DUOC.LOAIDUOC_ID and TM_LOAIDUOC.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG on (TM_LOAIDUOC.LOAIVATTU_ID = TM_DUOC_HANDUNG.LOAIDUOC and TM_DUOC_HANDUNG.BENHVIEN_ID = 'HLU01')        inner join        (select LTRIM(A.KHODUOC_ID) + '_' + LTRIM(A.DUOC_ID) + '_' + LTRIM(ISNULL(A.NGUONDUOC_ID,'')) as DUOC_KEY, A.KHODUOC_ID, A.DUOC_ID,A.NGUONDUOC_ID,        SUM(isnull(A.SOLUONG,0)) as SOLUONG        from        (select SUM(SOLUONG) as SOLUONG, KHODUOC_ID, DUOC_ID, NGUONDUOC_ID from TT_DUOC_KYGUI_TONKHO        where BENHVIEN_ID = 'HLU01' group by KHODUOC_ID, DUOC_ID, NGUONDUOC_ID) A        group by LTRIM(A.KHODUOC_ID) + '_' + LTRIM(A.DUOC_ID) + '_' + LTRIM(A.NGUONDUOC_ID), A.KHODUOC_ID, A.DUOC_ID, A.NGUONDUOC_ID)        TT_TONKHO on TT_TONKHO.DUOC_ID = TM_DUOC.DUOC_ID        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = TT_TONKHO.NGUONDUOC_ID and nh.BENHVIEN_ID = 'HLU01'        LEFT JOIN TM_KHODUOC KD ON KD.KHODUOC_ID = TT_TONKHO.KHODUOC_ID        where TM_DUOC.BENHVIEN_ID = 'HLU01' AND TT_TONKHO.SOLUONG >= 0]
2019-09-20 11:23:51,094 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM018']
2019-09-20 11:23:51,130 [5] DEBUG - Statement Id: [DAO00027_GetListDuocTonKho] PreparedStatement : [select distinct TT_TONKHO.DUOC_KEY, LTRIM(TT_TONKHO.KHODUOC_ID) as KHODUOC_ID, TM_DUOC.DUOC_ID, TM_LOAIDUOC.MALOAIDUOC,TM_DUOC.SOVISA,TM_DUOC.TYLE_VAT,TM_DUOC.COTOA,        TM_DUOC.MADUOC, TM_DUOC.TENHANG, TM_DUOC.TENDUOCDAYDU, dvt.TENDONVITINH as DONVITINH,  TM_DUOC.DONVITINH_ID,TM_DUOC.BHYT,                TM_DUOC.TENHOATCHAT,          TM_DUOC.HAMLUONG, TM_DUOC.HANGSANXUAT, TM_DUOC.QUOCGIA, TM_DUOC.LOAIDUOC_ID, TM_DUOC.DUONGDUNG_ID,        TM_TENDUOC.TENDUOC, TM_TENDUOC.TENDUOC_EN, TM_TENDUOC.MAQUOCTE, TM_TENDUOC.MAQUOCTEBT,        TM_LOAIDUOC.LOAIVATTU_ID, TM_DUOC.BENHVIEN_ID,        TT_TONKHO.SOLUONG, TM_DUOC.VTYT_PHANLOAI, TM_DUOC.PHAMVI, TT_TONKHO.NGUONDUOC_ID, NG.TENNGUONDUOC AS TENNGUONDUOC        , TAMNGUNG = CASE WHEN TM_DUOC.TAMNGUNG = '1' OR NG.TAMNGUNG = '1' OR KD.TAMNGUNG = '1' THEN '1' ELSE '0' END        , TM_DUOC.DANGTRINHBAY        from TM_DUOC        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = TM_DUOC.DONVITINH_ID        left join TM_TENDUOC on TM_DUOC.TENDUOC_ID = TM_TENDUOC.TENDUOC_ID and TM_DUOC.BENHVIEN_ID = 'HLU01' and TM_DUOC.TAMNGUNG = '0'        left join TM_LOAIDUOC on TM_LOAIDUOC.LOAIDUOC_ID = TM_DUOC.LOAIDUOC_ID and TM_LOAIDUOC.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG on (TM_LOAIDUOC.LOAIVATTU_ID = TM_DUOC_HANDUNG.LOAIDUOC and TM_DUOC_HANDUNG.BENHVIEN_ID = 'HLU01')        inner join        (select LTRIM(A.KHODUOC_ID) + '_' + LTRIM(A.DUOC_ID) + '_' + LTRIM(ISNULL(A.NGUONDUOC_ID,'')) as DUOC_KEY, A.KHODUOC_ID, A.DUOC_ID, A.NGUONDUOC_ID,        SUM(isnull(A.SOLUONG,0)) as SOLUONG        from        (select SUM(SOLUONG) as SOLUONG, KHODUOC_ID, DUOC_ID, NGUONDUOC_ID from TT_DUOC_TONKHO        where BENHVIEN_ID = 'HLU01' group by KHODUOC_ID, DUOC_ID, NGUONDUOC_ID) A        group by LTRIM(A.KHODUOC_ID) + '_' + LTRIM(A.DUOC_ID) + '_' + LTRIM(ISNULL(A.NGUONDUOC_ID,'')), A.KHODUOC_ID, A.DUOC_ID, NGUONDUOC_ID        ) TT_TONKHO on TT_TONKHO.DUOC_ID = TM_DUOC.DUOC_ID        LEFT JOIN TM_NGUONHANG NG ON NG.NGUONDUOC_ID = TT_TONKHO.NGUONDUOC_ID        LEFT JOIN TM_KHODUOC KD ON KD.KHODUOC_ID = TT_TONKHO.KHODUOC_ID        where TM_DUOC.BENHVIEN_ID = 'HLU01' and TT_TONKHO.SOLUONG >= 0]
2019-09-20 11:23:52,170 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM023']
2019-09-20 11:23:52,208 [5] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoVaBooking] PreparedStatement : [declare @NGUONDUOC_MACDINH varchar(5) = '0';        declare @TOAMUANGOAI int = 0;        select @NGUONDUOC_MACDINH = isnull(VALUE,0) from TM_SYS_APPSETTINGS where CODE = 'PHA_NGUONDUOC'        select @TOAMUANGOAI = isnull(VALUE,0) from TM_SYS_APPSETTINGS where CODE = 'OPD_TOAMUANGOAI_DUNGDANHMUC_DUOC'                if @TOAMUANGOAI = 1        begin        select  distinct '0' + '_' + LTRIM(d.DUOC_ID) + '_' + @NGUONDUOC_MACDINH as DUOC_KEY, 0 as PHAMVI_ID, @NGUONDUOC_MACDINH as NGUONDUOC_ID, null as TENNGUONDUOC, null as TINHTIEN, d.DUOC_ID, ld.MALOAIDUOC,        d.SOVISA,d.TYLE_VAT,d.COTOA, d.MADUOC, d.TENHANG, d.TENDUOCDAYDU, d.DONVITINH as DONVITINH, d.BHYT,        d.TENHOATCHAT, d.HAMLUONG, d.HANGSANXUAT, d.QUOCGIA, d.LOAIDUOC_ID, d.DUONGDUNG_ID, d.TINHTIEN_PTTT,        ten.TENDUOC, ten.TENDUOC_EN, ten.MAQUOCTE, ten.MAQUOCTEBT,        '' as BHYT_TEXT        , ld.LOAIVATTU_ID        , d.BENHVIEN_ID,        999999999 as SOLUONG, d.VTYT_PHANLOAI, d.PHAMVI, d.SUASOLUONGTONGHOP, d.MADUOCBV, d.DANGTRINHBAY        , TAMNGUNG = CASE WHEN d.TAMNGUNG = '1' THEN '1' ELSE '0' END        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        union all        select  distinct tk.DUOC_KEY, LTRIM(tk.PHAMVI_ID) as PHAMVI_ID, tk.NGUONDUOC_ID, nh.TENNGUONDUOC, nh.TINHTIEN, d.DUOC_ID, ld.MALOAIDUOC,        d.SOVISA,d.TYLE_VAT,d.COTOA, d.MADUOC, d.TENHANG, d.TENDUOCDAYDU, d.DONVITINH as DONVITINH, d.BHYT,        d.TENHOATCHAT, d.HAMLUONG, d.HANGSANXUAT, d.QUOCGIA, d.LOAIDUOC_ID, d.DUONGDUNG_ID, d.TINHTIEN_PTTT,        ten.TENDUOC, ten.TENDUOC_EN, ten.MAQUOCTE, ten.MAQUOCTEBT,        CASE WHEN d.BHYT = '1' THEN 'BHYT' ELSE '' END as BHYT_TEXT        , ld.LOAIVATTU_ID        , d.BENHVIEN_ID,        tk.SOLUONG, d.VTYT_PHANLOAI, d.PHAMVI, d.SUASOLUONGTONGHOP, d.MADUOCBV, d.DANGTRINHBAY        , TAMNGUNG = CASE WHEN d.TAMNGUNG = '1' OR nh.TAMNGUNG = '1' OR kd.TAMNGUNG = '1' THEN '1' ELSE '0' END        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        inner join        (        select  LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')) DUOC_KEY, (SUM(dtk.SOLUONG) - isnull(sum(A.SOLUONG),0) - isnull(sum(B.SOLUONG),0)) SOLUONG, pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        from (select sum(soluong) soluong,duoc_id,nguonduoc_id,khoduoc_id,benhvien_id from TT_DUOC_TONKHO  group by duoc_id,nguonduoc_id,khoduoc_id,benhvien_id) dtk        inner join TM_DUOC_PHAMVISD_MAPPING pvsd on dtk.KHODUOC_ID = pvsd.KHODUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NOITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) B on B.DUOC_ID = dtk.DUOC_ID and B.SOLUONG > 0 and B.PHAMVI_ID = pvsd.PHAMVI_ID and B.NGUONHANG_ID = dtk.NGUONDUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NGOAITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) A on A.DUOC_ID = dtk.DUOC_ID and A.SOLUONG > 0 and A.PHAMVI_ID = pvsd.PHAMVI_ID and A.NGUONHANG_ID = dtk.NGUONDUOC_ID        where dtk.SOLUONG > 0 and dtk.BENHVIEN_ID = 'HLU01'        group by LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')), pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        ) tk on tk.DUOC_ID = d.DUOC_ID        left join TM_DUOC_PHAMVISUDUNG kd on kd.PHAMVI_ID = tk.PHAMVI_ID and kd.BENHVIEN_ID = 'HLU01'        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = tk.NGUONDUOC_ID and nh.BENHVIEN_ID = 'HLU01'        where d.BENHVIEN_ID = 'HLU01'  and tk.SOLUONG >= 0        end        else        begin                  select  distinct tk.DUOC_KEY, LTRIM(tk.PHAMVI_ID) as PHAMVI_ID, tk.NGUONDUOC_ID, nh.TENNGUONDUOC, nh.TINHTIEN, d.DUOC_ID, ld.MALOAIDUOC,        d.SOVISA,d.TYLE_VAT,d.COTOA, d.MADUOC, d.TENHANG, d.TENDUOCDAYDU, d.DONVITINH as DONVITINH, d.BHYT,        d.TENHOATCHAT, d.HAMLUONG, d.HANGSANXUAT, d.QUOCGIA, d.LOAIDUOC_ID, d.DUONGDUNG_ID, d.TINHTIEN_PTTT,        ten.TENDUOC, ten.TENDUOC_EN, ten.MAQUOCTE, ten.MAQUOCTEBT,        CASE WHEN d.BHYT = '1' THEN 'BHYT' ELSE '' END as BHYT_TEXT        , ld.LOAIVATTU_ID        , d.BENHVIEN_ID,        tk.SOLUONG, d.VTYT_PHANLOAI, d.PHAMVI, d.SUASOLUONGTONGHOP, d.MADUOCBV, d.DANGTRINHBAY        , TAMNGUNG = CASE WHEN d.TAMNGUNG = '1' OR nh.TAMNGUNG = '1' OR kd.TAMNGUNG = '1' THEN '1' ELSE '0' END        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        inner join        (        select  LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')) DUOC_KEY, (SUM(dtk.SOLUONG) - isnull(sum(A.SOLUONG),0) - isnull(sum(B.SOLUONG),0)) SOLUONG, pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        from (select sum(soluong) soluong,duoc_id,nguonduoc_id,khoduoc_id,benhvien_id from TT_DUOC_TONKHO  group by duoc_id,nguonduoc_id,khoduoc_id,benhvien_id) dtk        inner join TM_DUOC_PHAMVISD_MAPPING pvsd on dtk.KHODUOC_ID = pvsd.KHODUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NOITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) B on B.DUOC_ID = dtk.DUOC_ID and B.SOLUONG > 0 and B.PHAMVI_ID = pvsd.PHAMVI_ID and B.NGUONHANG_ID = dtk.NGUONDUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NGOAITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) A on A.DUOC_ID = dtk.DUOC_ID and A.SOLUONG > 0 and A.PHAMVI_ID = pvsd.PHAMVI_ID and A.NGUONHANG_ID = dtk.NGUONDUOC_ID        where dtk.SOLUONG > 0 and dtk.BENHVIEN_ID = 'HLU01'        group by LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')), pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        ) tk on tk.DUOC_ID = d.DUOC_ID        left join TM_DUOC_PHAMVISUDUNG kd on kd.PHAMVI_ID = tk.PHAMVI_ID and kd.BENHVIEN_ID = 'HLU01'        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = tk.NGUONDUOC_ID and nh.BENHVIEN_ID = 'HLU01'        where d.BENHVIEN_ID = 'HLU01'  and tk.SOLUONG >= 0        end]
2019-09-20 11:23:55,178 [5] DEBUG - Statement Id: [DAO00320_GetList] PreparedStatement : [select M.*            from TM_MAU M            LEFT JOIN TM_MAU_DONVITINH DVT on M.DONVITINH_ID=DVT.DONVITINH_ID            where            M.TAMNGUNG = '0'            and M.BENHVIEN_ID = 'HLU01'            order by M.TENMAU]
2019-09-20 11:23:55,252 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM071']
2019-09-20 11:23:55,290 [5] DEBUG - Statement Id: [DAO00322_GetListMauTonKhoForCreateCached] PreparedStatement : [SELECT DISTINCT          TK.MAU_KEY, TK.KHOMAU_ID, M.MAU_ID, M.MAMAU, M.TENMAU, M.NHOM_ABO, M.NHOM_RH, M.LOAIMAU_ID,          TK.SOLONHAP_ID, SLN.SOLONHAP, SLN.SOKIEMSOAT, TK.NGUONHANG_ID, NG.TENNGUONMAU, M.BENHVIEN_ID, M.DONVITINH_ID,          SUM(tk.SOLUONG) AS SOLUONG,K.TENKHO,DVT.TENDONVITINH          FROM TT_MAU_TONKHO TK          JOIN TM_KHO K ON TK.KHOMAU_ID = K.KHO_ID          JOIN TT_MAU_CHUNGTU_SOLONHAP SLN ON TK.SOLONHAP_ID = SLN.SOLONHAP_ID          JOIN TM_MAU M on TK.MAU_ID = M.MAU_ID and M.TAMNGUNG = '0'          LEFT JOIN TM_MAU_DONVITINH DVT on M.DONVITINH_ID=DVT.DONVITINH_ID          LEFT JOIN TM_NGUONMAU NG ON NG.NGUONMAU_ID = TK.NGUONHANG_ID          WHERE TK.SOLUONG > 0          GROUP BY TK.MAU_KEY, TK.KHOMAU_ID, M.MAU_ID, M.MAMAU, M.TENMAU, M.NHOM_ABO, M.NHOM_RH, M.LOAIMAU_ID,          TK.SOLONHAP_ID, SLN.SOLONHAP, SLN.SOKIEMSOAT,TK.NGUONHANG_ID, NG.TENNGUONMAU, M.BENHVIEN_ID, M.DONVITINH_ID,K.TENKHO,DVT.TENDONVITINH]
2019-09-20 11:23:55,367 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM073']
2019-09-20 11:23:55,407 [5] DEBUG - Statement Id: [DAO00322_GetListMauTonKhoTruBooking] PreparedStatement : [select distinct          TK.MAU_KEY, TK.KHOMAU_ID, M.MAU_ID, M.MAMAU, M.TENMAU, M.NHOM_ABO, M.NHOM_RH, M.LOAIMAU_ID, M.DONVITINH_ID,          TK.SOLONHAP_ID, TK.SOLONHAP, TK.SOKIEMSOAT,M.PHAMVI, TK.NGUONHANG_ID, NG.TENNGUONMAU, M.BENHVIEN_ID,          TK.SOLUONG,TK.TENKHO,DVT.TENDONVITINH          from TM_MAU M          JOIN          (          select          A.MAU_KEY, A.KHOMAU_ID, A.MAU_ID ,a.NGUONHANG_ID, A.SOLONHAP_ID, A.SOLONHAP, A.SOKIEMSOAT, A.SOLUONG,A.TENKHO          from          (          select KHOMAU_ID, TK.MAU_ID, TK.NGUONHANG_ID, TK.MAU_KEY, SLN.SOLONHAP_ID, SLN.SOLONHAP, SLN.SOKIEMSOAT, ISNULL(TK.SOLUONG,0) - ISNULL(book.SOLUONG,0) as SOLUONG,K.TENKHO          from TT_MAU_TONKHO TK          JOIN TM_KHO K ON TK.KHOMAU_ID = K.KHO_ID          inner join TT_MAU_CHUNGTU_SOLONHAP SLN ON TK.SOLONHAP_ID = SLN.SOLONHAP_ID          left join dbo.TT_MAU_TONKHO_BOOK book ON book.MAU_KEY = TK.MAU_KEY AND book.TRANGTHAI = 'HIEULUC'          where ISNULL(TK.SOLUONG,0) - ISNULL(book.SOLUONG,0) > 0          ) A          )TK on TK.MAU_ID = M.MAU_ID and M.TAMNGUNG = '0'          LEFT JOIN TM_MAU_DONVITINH DVT on M.DONVITINH_ID=DVT.DONVITINH_ID          LEFT JOIN TM_NGUONMAU NG ON NG.NGUONMAU_ID = TK.NGUONHANG_ID]
2019-09-20 11:23:55,968 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM072']
2019-09-20 11:23:56,930 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'MAIN'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2019-09-20 11:23:57,865 [1] DEBUG - Statement Id: [DAO00002_FormList] PreparedStatement : [select              TM_SYS_FORM.HOSPITAL_ID,              TM_SYS_FORM.NAME,              TM_SYS_FORM.CLASS,              TM_SYS_FORM.ASSEMBLY,              TM_SYS_FORM.TITLE_VI as TITLE              from TM_SYS_FORM              where HOSPITAL_ID = 'HLU01']
2019-09-20 11:24:03,011 [1] DEBUG - Statement Id: [DAO00300_GetShortcutListByUserID] PreparedStatement : [SELECT S.SHORTCUT_CODE, S.SHORTCUT_VALUE              FROM TM_SHORTCUT AS S              WHERE S.BENHVIEN_ID = 'HLU01' AND S.USER_ID = '1' AND TAMNGUNG = '0']
2019-09-20 11:24:03,044 [1] DEBUG - Statement Id: [DAO00087_GetList] PreparedStatement : [select CODE, VALUE, BENHVIEN_ID              from TM_SYS_APPSETTINGS              where LOCKED = '0' and BENHVIEN_ID = 'HLU01'              order by SETTING_ID]
2019-09-20 11:24:03,123 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'MSG01'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2019-09-20 11:24:03,265 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'MSG02'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2019-09-20 11:24:03,408 [1] DEBUG - Statement Id: [DAO00008_GetUserSettings] PreparedStatement : [select A.*, B.TENKHO , C.TENPHONGBAN, B.MAKHO, C.MAPHONGBAN          from TM_SYS_USERS A          left join TM_KHODUOC B on B.KHODUOC_ID = A.INVENTORY_ID          left join TM_PHONGBAN C on (C.PHONGBAN_ID = A.WORKING_DEPT_ID and C.BENHVIEN_ID =  @param0 )          left join TM_SYS_USERKHO D on (D.ACCOUNT_ID = A.ACCOUNT_ID and D.HOSPITAL_ID =  @param0 )          where          A.HOSPITAL_ID =  @param0            and                 A.ACCOUNT_ID =  @param1]
2019-09-20 11:24:03,410 [1] DEBUG - Statement Id: [DAO00008_GetUserSettings] Parameters: [@param0=[HOSPITAL_ID,HLU01], @param1=[ACCOUNT_ID,113]]
2019-09-20 11:24:03,410 [1] DEBUG - Statement Id: [DAO00008_GetUserSettings] Types: [@param0=[String, System.String], @param1=[String, System.String]]
2019-09-20 11:24:03,455 [1] DEBUG - Statement Id: [DAO00008_GetUserInvSettings] PreparedStatement : [select A.*, B.TENKHO, B.MAKHO, B.LOAIKHO_ID, B.KHOQUANLY_ID          from TM_SYS_USERKHO A          left join TM_KHO B on B.MODULE_ID = A.MODULE_ID and B.KHO_ID = A.KHO_ID          where A.HOSPITAL_ID =  @param0  and A.ACCOUNT_ID =  @param1           order by B.TENKHO]
2019-09-20 11:24:03,456 [1] DEBUG - Statement Id: [DAO00008_GetUserInvSettings] Parameters: [@param0=[HOSPITAL_ID,HLU01], @param1=[ACCOUNT_ID,113]]
2019-09-20 11:24:03,456 [1] DEBUG - Statement Id: [DAO00008_GetUserInvSettings] Types: [@param0=[String, System.String], @param1=[String, System.String]]
2019-09-20 11:24:03,599 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'COM30'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2019-09-20 11:24:03,765 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'RIS04'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2019-09-20 11:24:11,437 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'MENU1'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2019-09-20 11:24:11,550 [1] DEBUG - Statement Id: [DAO00011_GetList] PreparedStatement : [select              TM_SYS_MENU.ID,              TM_SYS_MENU.PARENTID,              TM_SYS_MENU.SCREEN,              TM_SYS_MENU.SMALLIMAGE,              TM_SYS_MENU.LARGEIMAGE,              TM_SYS_MENU.DESCRIPTION,              TM_SYS_MENU.TYPE,              TM_SYS_MENU.TITLE_VI as TITLE              from TM_SYS_MENU              where TM_SYS_MENU.HOSPITAL_ID = 'HLU01' and TM_SYS_MENU.ACTIVE = '1'               AND                   (TM_SYS_MENU.TYPE & '8' = '8')                             order by TM_SYS_MENU.ORDERNUM]
2019-09-20 11:24:11,876 [1] DEBUG - Statement Id: [DAO00011_usermenu_list] PreparedStatement : [select              TM_SYS_HOMEMENU.MENUID as ID,              TM_SYS_MENU.TITLE_VI as TITLE,              TM_SYS_MENU.SCREEN,              TM_SYS_MENU.SMALLIMAGE,              TM_SYS_MENU.LARGEIMAGE,              TM_SYS_MENU.TYPE              from TM_SYS_HOMEMENU              left join TM_SYS_MENU on TM_SYS_MENU.ID = TM_SYS_HOMEMENU.MENUID and TM_SYS_MENU.HOSPITAL_ID = TM_SYS_HOMEMENU.HOSPITAL_ID              where TM_SYS_HOMEMENU.HOSPITAL_ID = 'HLU01' and TM_SYS_HOMEMENU.USERID = '113' and TM_SYS_MENU.ACTIVE = '1'               AND                   (TM_SYS_MENU.TYPE & '8' = '8')                             ORDER BY TM_SYS_HOMEMENU.ORDERNUM]
2019-09-20 11:24:25,671 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'COM31'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2019-09-20 11:24:25,838 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'ORM28'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2019-09-20 11:24:30,816 [1] DEBUG - Statement Id: [DAO00066_GetBENHAN_TIEPNHAN] PreparedStatement : [select top 1 *        from TT_NOITRU_BENHAN        where TIEPNHAN_ID = '27022'  and BENHVIEN_ID = 'HLU01'        order by NGAYTAO desc]
2019-09-20 11:24:30,908 [1] DEBUG - Statement Id: [DAO00014_GetInPatientStatus] PreparedStatement : [select TRANGTHAI, isnull(KHOACHUYENDEN_ID, KHOAVAO_ID) as KHOAHIENTAI from TT_NOITRU_BENHAN        where        TIEPNHAN_ID = '27022'        and BENHVIEN_ID = 'HLU01'         and           BENHAN_ID = '5800']
2019-09-20 11:24:31,596 [1] DEBUG - Statement Id: [DAO00048_TT_PHAUTHUAT_GetList] PreparedStatement : [select *              from TT_PHAUTHUAT               where                             TT_PHAUTHUAT.LOAI = 'P'                       and                           TT_PHAUTHUAT.TIEPNHAN_ID = 27022                       and                           TT_PHAUTHUAT.BENHVIEN_ID = 'HLU01'                                     order by PHAUTHUAT_ID DESC]
2019-09-20 11:24:32,010 [1] DEBUG - Statement Id: [DAO00048_GetListLoaiGacTrongPTTT] PreparedStatement : [select DICTIONARY_ID, DICTIONARY_CODE, DICTIONARY_NAME          from LST_DICTIONARY          where DICTIONARY_TYPE_CODE = 'LoaiGacPTTT'          and ENABLED = '1']
2019-09-20 11:24:41,641 [1] DEBUG - Statement Id: [DAO00048_GetDSLoaiGacDaGhiNhan] PreparedStatement : [select A.KIEMSOATGAC_ID, A.BENHNHAN_ID, A.TIEPNHAN_ID, A.BENHAN_ID, A.PHAUTHUAT_ID, A.LOAIPT_TT, A.LOAIGAC_ID          , A.NGAYGHINHAN, A.THOIGIANGHINHAN, A.SOLUONG, A.SOLUONGDASUDUNG, A.SOLUONGCONLAI, A.GHICHU, A.NGUOINHANDUNGCU_ID          , B.DICTIONARY_CODE AS MALOAIGAC, B.DICTIONARY_NAME AS TENLOAIGAC          from TT_PHAUTHUAT_GHINHANGAC A          inner join LST_DICTIONARY B on B.DICTIONARY_ID = A.LOAIGAC_ID          where A.PHAUTHUAT_ID = 3742 and A.BENHVIEN_ID = 'HLU01']
2019-09-20 11:24:47,547 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'COM98'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2019-09-20 11:25:02,135 [1] DEBUG - Statement Id: [DAO00048_GetDSLoaiGacDaGhiNhan] PreparedStatement : [select A.KIEMSOATGAC_ID, A.BENHNHAN_ID, A.TIEPNHAN_ID, A.BENHAN_ID, A.PHAUTHUAT_ID, A.LOAIPT_TT, A.LOAIGAC_ID          , A.NGAYGHINHAN, A.THOIGIANGHINHAN, A.SOLUONG, A.SOLUONGDASUDUNG, A.SOLUONGCONLAI, A.GHICHU, A.NGUOINHANDUNGCU_ID          , B.DICTIONARY_CODE AS MALOAIGAC, B.DICTIONARY_NAME AS TENLOAIGAC          from TT_PHAUTHUAT_GHINHANGAC A          inner join LST_DICTIONARY B on B.DICTIONARY_ID = A.LOAIGAC_ID          where A.PHAUTHUAT_ID = 3742 and A.BENHVIEN_ID = 'HLU01']
2019-09-20 11:25:39,318 [1] DEBUG - Statement Id: [DAO00066_GetBENHAN_TIEPNHAN] PreparedStatement : [select top 1 *        from TT_NOITRU_BENHAN        where TIEPNHAN_ID = '27022'  and BENHVIEN_ID = 'HLU01'        order by NGAYTAO desc]
2019-09-20 11:25:39,492 [1] DEBUG - Statement Id: [DAO00014_GetInPatientStatus] PreparedStatement : [select TRANGTHAI, isnull(KHOACHUYENDEN_ID, KHOAVAO_ID) as KHOAHIENTAI from TT_NOITRU_BENHAN        where        TIEPNHAN_ID = '27022'        and BENHVIEN_ID = 'HLU01'         and           BENHAN_ID = '5800']
2019-09-20 11:25:39,600 [1] DEBUG - Statement Id: [DAO00048_TT_PHAUTHUAT_GetList] PreparedStatement : [select *              from TT_PHAUTHUAT               where                             TT_PHAUTHUAT.LOAI = 'P'                       and                           TT_PHAUTHUAT.TIEPNHAN_ID = 27022                       and                           TT_PHAUTHUAT.BENHVIEN_ID = 'HLU01'                                     order by PHAUTHUAT_ID DESC]
2019-09-20 11:25:39,655 [1] DEBUG - Statement Id: [DAO00048_GetListLoaiGacTrongPTTT] PreparedStatement : [select DICTIONARY_ID, DICTIONARY_CODE, DICTIONARY_NAME          from LST_DICTIONARY          where DICTIONARY_TYPE_CODE = 'LoaiGacPTTT'          and ENABLED = '1']
2019-09-20 11:25:47,106 [1] DEBUG - Statement Id: [DAO00048_GetDSLoaiGacDaGhiNhan] PreparedStatement : [select A.KIEMSOATGAC_ID, A.BENHNHAN_ID, A.TIEPNHAN_ID, A.BENHAN_ID, A.PHAUTHUAT_ID, A.LOAIPT_TT, A.LOAIGAC_ID          , A.NGAYGHINHAN, A.THOIGIANGHINHAN, A.SOLUONG, A.SOLUONGDASUDUNG, A.SOLUONGCONLAI, A.GHICHU, A.NGUOINHANDUNGCU_ID          , B.DICTIONARY_CODE AS MALOAIGAC, B.DICTIONARY_NAME AS TENLOAIGAC          from TT_PHAUTHUAT_GHINHANGAC A          inner join LST_DICTIONARY B on B.DICTIONARY_ID = A.LOAIGAC_ID          where A.PHAUTHUAT_ID = 3742 and A.BENHVIEN_ID = 'HLU01']
--------------------------------------------------------------------------------
2019-09-20 11:27:37,939 [1] DEBUG - Statement Id: [DAO00001_DBList] PreparedStatement : [select *              from TM_SYS_SERVER              where HOSPITAL_ID = '_SYSTEM_' and TYPE = 'D']
2019-09-20 11:27:38,216 [1] DEBUG - Statement Id: [DAO00001_DaoList] PreparedStatement : [select              TM_SYS_SERVICEMAP.ID,              TM_SYS_SERVICEMAP.HOSPITAL_ID,              TM_SYS_SERVICEMAP.DB_NAME,              TM_SYS_SERVICEMAP.TYPE,              TM_SYS_SERVICEMAP.NAME,              TM_SYS_SERVICEMAP.CLASS,              (TM_SYS_DIC.VALUE + '.' + TM_SYS_SERVICEMAP.CLASS) as CLASSFULL,              TM_SYS_SERVICEMAP.ASSEMBLY              from TM_SYS_SERVICEMAP              inner join TM_SYS_DIC              on TM_SYS_SERVICEMAP.NAMESPACE = TM_SYS_DIC.ID              where HOSPITAL_ID = '_SYSTEM_' AND TYPE = 'D' AND ACTIVE = '1'              order by DB_NAME]
2019-09-20 11:27:38,257 [1] DEBUG - Statement Id: [DAO00001_ServiceList] PreparedStatement : [select              TM_SYS_SERVICEMAP.ID,              TM_SYS_SERVICEMAP.HOSPITAL_ID,              TM_SYS_SERVICEMAP.DB_NAME,              TM_SYS_SERVICEMAP.TYPE,              TM_SYS_SERVICEMAP.NAME,              TM_SYS_SERVICEMAP.CLASS,              (TM_SYS_DIC.VALUE + '.' + TM_SYS_SERVICEMAP.CLASS) as CLASSFULL,              TM_SYS_SERVICEMAP.ASSEMBLY,              TM_SYS_SERVER.URL              from TM_SYS_SERVICEMAP              inner join TM_SYS_DIC on TM_SYS_SERVICEMAP.NAMESPACE = TM_SYS_DIC.ID              inner join TM_SYS_SERVER on (TM_SYS_SERVICEMAP.DB_NAME = TM_SYS_SERVER.NAME) and (TM_SYS_SERVER.HOSPITAL_ID = '_SYSTEM_')              where TM_SYS_SERVICEMAP.HOSPITAL_ID = '_SYSTEM_' AND TM_SYS_SERVICEMAP.TYPE = 'S'  AND ACTIVE = '1'              order by URL]
2019-09-20 11:27:38,810 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = '_SYSTEM_'               AND                   TM_SYS_SCREEN.PAGE = 'LOGIN'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2019-09-20 11:27:39,092 [1] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = '_SYSTEM_'               AND                   TM_SYS_CACHE.ACTIVE = '1']
2019-09-20 11:27:46,737 [1] DEBUG - Statement Id: [DAO00001_DBList] PreparedStatement : [select *              from TM_SYS_SERVER              where HOSPITAL_ID = 'HLU01' and TYPE = 'D']
2019-09-20 11:27:46,767 [1] DEBUG - Statement Id: [DAO00001_DaoList] PreparedStatement : [select              TM_SYS_SERVICEMAP.ID,              TM_SYS_SERVICEMAP.HOSPITAL_ID,              TM_SYS_SERVICEMAP.DB_NAME,              TM_SYS_SERVICEMAP.TYPE,              TM_SYS_SERVICEMAP.NAME,              TM_SYS_SERVICEMAP.CLASS,              (TM_SYS_DIC.VALUE + '.' + TM_SYS_SERVICEMAP.CLASS) as CLASSFULL,              TM_SYS_SERVICEMAP.ASSEMBLY              from TM_SYS_SERVICEMAP              inner join TM_SYS_DIC              on TM_SYS_SERVICEMAP.NAMESPACE = TM_SYS_DIC.ID              where HOSPITAL_ID = 'HLU01' AND TYPE = 'D' AND ACTIVE = '1'              order by DB_NAME]
2019-09-20 11:27:48,305 [1] DEBUG - Statement Id: [DAO00001_ServiceList] PreparedStatement : [select              TM_SYS_SERVICEMAP.ID,              TM_SYS_SERVICEMAP.HOSPITAL_ID,              TM_SYS_SERVICEMAP.DB_NAME,              TM_SYS_SERVICEMAP.TYPE,              TM_SYS_SERVICEMAP.NAME,              TM_SYS_SERVICEMAP.CLASS,              (TM_SYS_DIC.VALUE + '.' + TM_SYS_SERVICEMAP.CLASS) as CLASSFULL,              TM_SYS_SERVICEMAP.ASSEMBLY,              TM_SYS_SERVER.URL              from TM_SYS_SERVICEMAP              inner join TM_SYS_DIC on TM_SYS_SERVICEMAP.NAMESPACE = TM_SYS_DIC.ID              inner join TM_SYS_SERVER on (TM_SYS_SERVICEMAP.DB_NAME = TM_SYS_SERVER.NAME) and (TM_SYS_SERVER.HOSPITAL_ID = 'HLU01')              where TM_SYS_SERVICEMAP.HOSPITAL_ID = 'HLU01' AND TM_SYS_SERVICEMAP.TYPE = 'S'  AND ACTIVE = '1'              order by URL]
2019-09-20 11:27:48,393 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1']
2019-09-20 11:27:49,190 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM005']
2019-09-20 11:27:49,335 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM015']
2019-09-20 11:27:49,411 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM067']
2019-09-20 11:27:49,483 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM008']
2019-09-20 11:27:49,560 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM068']
2019-09-20 11:27:49,638 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM006']
2019-09-20 11:27:49,712 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM030']
2019-09-20 11:27:49,791 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM025']
2019-09-20 11:27:49,871 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM024']
2019-09-20 11:27:50,389 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM033']
2019-09-20 11:27:50,674 [5] DEBUG - Statement Id: [DAO00027_GetListDuocKyGuiTonKho] PreparedStatement : [select  distinct TT_TONKHO.DUOC_KEY, LTRIM(TT_TONKHO.KHODUOC_ID) as KHODUOC_ID, TM_DUOC.DUOC_ID, TM_LOAIDUOC.MALOAIDUOC,TM_DUOC.SOVISA,TM_DUOC.TYLE_VAT,TM_DUOC.COTOA,        TM_DUOC.MADUOC, TM_DUOC.TENHANG, TM_DUOC.TENDUOCDAYDU, dvt.TENDONVITINH as DONVITINH,  TM_DUOC.DONVITINH_ID,TM_DUOC.BHYT,TM_DUOC.PHAMVI,        TM_DUOC.TENHOATCHAT, TM_DUOC.HAMLUONG, TM_DUOC.HANGSANXUAT, TM_DUOC.QUOCGIA, TM_DUOC.LOAIDUOC_ID, TM_DUOC.DUONGDUNG_ID,        TM_TENDUOC.TENDUOC, TM_TENDUOC.TENDUOC_EN, TM_TENDUOC.MAQUOCTE, TM_TENDUOC.MAQUOCTEBT,        TM_LOAIDUOC.LOAIVATTU_ID, TM_DUOC.BENHVIEN_ID,TT_TONKHO.SOLUONG, TT_TONKHO.NGUONDUOC_ID, NH.TENNGUONDUOC        , TAMNGUNG = CASE WHEN TM_DUOC.TAMNGUNG = '1' OR nh.TAMNGUNG = '1' OR KD.TAMNGUNG = '1' THEN '1' ELSE '0' END        , TM_DUOC.DANGTRINHBAY        from TM_DUOC        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = TM_DUOC.DONVITINH_ID        left join TM_TENDUOC on TM_DUOC.TENDUOC_ID = TM_TENDUOC.TENDUOC_ID and TM_DUOC.BENHVIEN_ID = 'HLU01' and TM_DUOC.TAMNGUNG = '0'        left join TM_LOAIDUOC on TM_LOAIDUOC.LOAIDUOC_ID = TM_DUOC.LOAIDUOC_ID and TM_LOAIDUOC.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG on (TM_LOAIDUOC.LOAIVATTU_ID = TM_DUOC_HANDUNG.LOAIDUOC and TM_DUOC_HANDUNG.BENHVIEN_ID = 'HLU01')        inner join        (select LTRIM(A.KHODUOC_ID) + '_' + LTRIM(A.DUOC_ID) + '_' + LTRIM(ISNULL(A.NGUONDUOC_ID,'')) as DUOC_KEY, A.KHODUOC_ID, A.DUOC_ID,A.NGUONDUOC_ID,        SUM(isnull(A.SOLUONG,0)) as SOLUONG        from        (select SUM(SOLUONG) as SOLUONG, KHODUOC_ID, DUOC_ID, NGUONDUOC_ID from TT_DUOC_KYGUI_TONKHO        where BENHVIEN_ID = 'HLU01' group by KHODUOC_ID, DUOC_ID, NGUONDUOC_ID) A        group by LTRIM(A.KHODUOC_ID) + '_' + LTRIM(A.DUOC_ID) + '_' + LTRIM(A.NGUONDUOC_ID), A.KHODUOC_ID, A.DUOC_ID, A.NGUONDUOC_ID)        TT_TONKHO on TT_TONKHO.DUOC_ID = TM_DUOC.DUOC_ID        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = TT_TONKHO.NGUONDUOC_ID and nh.BENHVIEN_ID = 'HLU01'        LEFT JOIN TM_KHODUOC KD ON KD.KHODUOC_ID = TT_TONKHO.KHODUOC_ID        where TM_DUOC.BENHVIEN_ID = 'HLU01' AND TT_TONKHO.SOLUONG >= 0]
2019-09-20 11:27:50,750 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM018']
2019-09-20 11:27:50,788 [5] DEBUG - Statement Id: [DAO00027_GetListDuocTonKho] PreparedStatement : [select distinct TT_TONKHO.DUOC_KEY, LTRIM(TT_TONKHO.KHODUOC_ID) as KHODUOC_ID, TM_DUOC.DUOC_ID, TM_LOAIDUOC.MALOAIDUOC,TM_DUOC.SOVISA,TM_DUOC.TYLE_VAT,TM_DUOC.COTOA,        TM_DUOC.MADUOC, TM_DUOC.TENHANG, TM_DUOC.TENDUOCDAYDU, dvt.TENDONVITINH as DONVITINH,  TM_DUOC.DONVITINH_ID,TM_DUOC.BHYT,                TM_DUOC.TENHOATCHAT,          TM_DUOC.HAMLUONG, TM_DUOC.HANGSANXUAT, TM_DUOC.QUOCGIA, TM_DUOC.LOAIDUOC_ID, TM_DUOC.DUONGDUNG_ID,        TM_TENDUOC.TENDUOC, TM_TENDUOC.TENDUOC_EN, TM_TENDUOC.MAQUOCTE, TM_TENDUOC.MAQUOCTEBT,        TM_LOAIDUOC.LOAIVATTU_ID, TM_DUOC.BENHVIEN_ID,        TT_TONKHO.SOLUONG, TM_DUOC.VTYT_PHANLOAI, TM_DUOC.PHAMVI, TT_TONKHO.NGUONDUOC_ID, NG.TENNGUONDUOC AS TENNGUONDUOC        , TAMNGUNG = CASE WHEN TM_DUOC.TAMNGUNG = '1' OR NG.TAMNGUNG = '1' OR KD.TAMNGUNG = '1' THEN '1' ELSE '0' END        , TM_DUOC.DANGTRINHBAY        from TM_DUOC        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = TM_DUOC.DONVITINH_ID        left join TM_TENDUOC on TM_DUOC.TENDUOC_ID = TM_TENDUOC.TENDUOC_ID and TM_DUOC.BENHVIEN_ID = 'HLU01' and TM_DUOC.TAMNGUNG = '0'        left join TM_LOAIDUOC on TM_LOAIDUOC.LOAIDUOC_ID = TM_DUOC.LOAIDUOC_ID and TM_LOAIDUOC.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG on (TM_LOAIDUOC.LOAIVATTU_ID = TM_DUOC_HANDUNG.LOAIDUOC and TM_DUOC_HANDUNG.BENHVIEN_ID = 'HLU01')        inner join        (select LTRIM(A.KHODUOC_ID) + '_' + LTRIM(A.DUOC_ID) + '_' + LTRIM(ISNULL(A.NGUONDUOC_ID,'')) as DUOC_KEY, A.KHODUOC_ID, A.DUOC_ID, A.NGUONDUOC_ID,        SUM(isnull(A.SOLUONG,0)) as SOLUONG        from        (select SUM(SOLUONG) as SOLUONG, KHODUOC_ID, DUOC_ID, NGUONDUOC_ID from TT_DUOC_TONKHO        where BENHVIEN_ID = 'HLU01' group by KHODUOC_ID, DUOC_ID, NGUONDUOC_ID) A        group by LTRIM(A.KHODUOC_ID) + '_' + LTRIM(A.DUOC_ID) + '_' + LTRIM(ISNULL(A.NGUONDUOC_ID,'')), A.KHODUOC_ID, A.DUOC_ID, NGUONDUOC_ID        ) TT_TONKHO on TT_TONKHO.DUOC_ID = TM_DUOC.DUOC_ID        LEFT JOIN TM_NGUONHANG NG ON NG.NGUONDUOC_ID = TT_TONKHO.NGUONDUOC_ID        LEFT JOIN TM_KHODUOC KD ON KD.KHODUOC_ID = TT_TONKHO.KHODUOC_ID        where TM_DUOC.BENHVIEN_ID = 'HLU01' and TT_TONKHO.SOLUONG >= 0]
2019-09-20 11:27:51,952 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM023']
2019-09-20 11:27:52,005 [5] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoVaBooking] PreparedStatement : [declare @NGUONDUOC_MACDINH varchar(5) = '0';        declare @TOAMUANGOAI int = 0;        select @NGUONDUOC_MACDINH = isnull(VALUE,0) from TM_SYS_APPSETTINGS where CODE = 'PHA_NGUONDUOC'        select @TOAMUANGOAI = isnull(VALUE,0) from TM_SYS_APPSETTINGS where CODE = 'OPD_TOAMUANGOAI_DUNGDANHMUC_DUOC'                if @TOAMUANGOAI = 1        begin        select  distinct '0' + '_' + LTRIM(d.DUOC_ID) + '_' + @NGUONDUOC_MACDINH as DUOC_KEY, 0 as PHAMVI_ID, @NGUONDUOC_MACDINH as NGUONDUOC_ID, null as TENNGUONDUOC, null as TINHTIEN, d.DUOC_ID, ld.MALOAIDUOC,        d.SOVISA,d.TYLE_VAT,d.COTOA, d.MADUOC, d.TENHANG, d.TENDUOCDAYDU, d.DONVITINH as DONVITINH, d.BHYT,        d.TENHOATCHAT, d.HAMLUONG, d.HANGSANXUAT, d.QUOCGIA, d.LOAIDUOC_ID, d.DUONGDUNG_ID, d.TINHTIEN_PTTT,        ten.TENDUOC, ten.TENDUOC_EN, ten.MAQUOCTE, ten.MAQUOCTEBT,        '' as BHYT_TEXT        , ld.LOAIVATTU_ID        , d.BENHVIEN_ID,        999999999 as SOLUONG, d.VTYT_PHANLOAI, d.PHAMVI, d.SUASOLUONGTONGHOP, d.MADUOCBV, d.DANGTRINHBAY        , TAMNGUNG = CASE WHEN d.TAMNGUNG = '1' THEN '1' ELSE '0' END        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        union all        select  distinct tk.DUOC_KEY, LTRIM(tk.PHAMVI_ID) as PHAMVI_ID, tk.NGUONDUOC_ID, nh.TENNGUONDUOC, nh.TINHTIEN, d.DUOC_ID, ld.MALOAIDUOC,        d.SOVISA,d.TYLE_VAT,d.COTOA, d.MADUOC, d.TENHANG, d.TENDUOCDAYDU, d.DONVITINH as DONVITINH, d.BHYT,        d.TENHOATCHAT, d.HAMLUONG, d.HANGSANXUAT, d.QUOCGIA, d.LOAIDUOC_ID, d.DUONGDUNG_ID, d.TINHTIEN_PTTT,        ten.TENDUOC, ten.TENDUOC_EN, ten.MAQUOCTE, ten.MAQUOCTEBT,        CASE WHEN d.BHYT = '1' THEN 'BHYT' ELSE '' END as BHYT_TEXT        , ld.LOAIVATTU_ID        , d.BENHVIEN_ID,        tk.SOLUONG, d.VTYT_PHANLOAI, d.PHAMVI, d.SUASOLUONGTONGHOP, d.MADUOCBV, d.DANGTRINHBAY        , TAMNGUNG = CASE WHEN d.TAMNGUNG = '1' OR nh.TAMNGUNG = '1' OR kd.TAMNGUNG = '1' THEN '1' ELSE '0' END        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        inner join        (        select  LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')) DUOC_KEY, (SUM(dtk.SOLUONG) - isnull(sum(A.SOLUONG),0) - isnull(sum(B.SOLUONG),0)) SOLUONG, pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        from (select sum(soluong) soluong,duoc_id,nguonduoc_id,khoduoc_id,benhvien_id from TT_DUOC_TONKHO  group by duoc_id,nguonduoc_id,khoduoc_id,benhvien_id) dtk        inner join TM_DUOC_PHAMVISD_MAPPING pvsd on dtk.KHODUOC_ID = pvsd.KHODUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NOITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) B on B.DUOC_ID = dtk.DUOC_ID and B.SOLUONG > 0 and B.PHAMVI_ID = pvsd.PHAMVI_ID and B.NGUONHANG_ID = dtk.NGUONDUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NGOAITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) A on A.DUOC_ID = dtk.DUOC_ID and A.SOLUONG > 0 and A.PHAMVI_ID = pvsd.PHAMVI_ID and A.NGUONHANG_ID = dtk.NGUONDUOC_ID        where dtk.SOLUONG > 0 and dtk.BENHVIEN_ID = 'HLU01'        group by LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')), pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        ) tk on tk.DUOC_ID = d.DUOC_ID        left join TM_DUOC_PHAMVISUDUNG kd on kd.PHAMVI_ID = tk.PHAMVI_ID and kd.BENHVIEN_ID = 'HLU01'        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = tk.NGUONDUOC_ID and nh.BENHVIEN_ID = 'HLU01'        where d.BENHVIEN_ID = 'HLU01'  and tk.SOLUONG >= 0        end        else        begin                  select  distinct tk.DUOC_KEY, LTRIM(tk.PHAMVI_ID) as PHAMVI_ID, tk.NGUONDUOC_ID, nh.TENNGUONDUOC, nh.TINHTIEN, d.DUOC_ID, ld.MALOAIDUOC,        d.SOVISA,d.TYLE_VAT,d.COTOA, d.MADUOC, d.TENHANG, d.TENDUOCDAYDU, d.DONVITINH as DONVITINH, d.BHYT,        d.TENHOATCHAT, d.HAMLUONG, d.HANGSANXUAT, d.QUOCGIA, d.LOAIDUOC_ID, d.DUONGDUNG_ID, d.TINHTIEN_PTTT,        ten.TENDUOC, ten.TENDUOC_EN, ten.MAQUOCTE, ten.MAQUOCTEBT,        CASE WHEN d.BHYT = '1' THEN 'BHYT' ELSE '' END as BHYT_TEXT        , ld.LOAIVATTU_ID        , d.BENHVIEN_ID,        tk.SOLUONG, d.VTYT_PHANLOAI, d.PHAMVI, d.SUASOLUONGTONGHOP, d.MADUOCBV, d.DANGTRINHBAY        , TAMNGUNG = CASE WHEN d.TAMNGUNG = '1' OR nh.TAMNGUNG = '1' OR kd.TAMNGUNG = '1' THEN '1' ELSE '0' END        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        inner join        (        select  LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')) DUOC_KEY, (SUM(dtk.SOLUONG) - isnull(sum(A.SOLUONG),0) - isnull(sum(B.SOLUONG),0)) SOLUONG, pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        from (select sum(soluong) soluong,duoc_id,nguonduoc_id,khoduoc_id,benhvien_id from TT_DUOC_TONKHO  group by duoc_id,nguonduoc_id,khoduoc_id,benhvien_id) dtk        inner join TM_DUOC_PHAMVISD_MAPPING pvsd on dtk.KHODUOC_ID = pvsd.KHODUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NOITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) B on B.DUOC_ID = dtk.DUOC_ID and B.SOLUONG > 0 and B.PHAMVI_ID = pvsd.PHAMVI_ID and B.NGUONHANG_ID = dtk.NGUONDUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NGOAITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) A on A.DUOC_ID = dtk.DUOC_ID and A.SOLUONG > 0 and A.PHAMVI_ID = pvsd.PHAMVI_ID and A.NGUONHANG_ID = dtk.NGUONDUOC_ID        where dtk.SOLUONG > 0 and dtk.BENHVIEN_ID = 'HLU01'        group by LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')), pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        ) tk on tk.DUOC_ID = d.DUOC_ID        left join TM_DUOC_PHAMVISUDUNG kd on kd.PHAMVI_ID = tk.PHAMVI_ID and kd.BENHVIEN_ID = 'HLU01'        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = tk.NGUONDUOC_ID and nh.BENHVIEN_ID = 'HLU01'        where d.BENHVIEN_ID = 'HLU01'  and tk.SOLUONG >= 0        end]
2019-09-20 11:27:58,945 [5] DEBUG - Statement Id: [DAO00320_GetList] PreparedStatement : [select M.*            from TM_MAU M            LEFT JOIN TM_MAU_DONVITINH DVT on M.DONVITINH_ID=DVT.DONVITINH_ID            where            M.TAMNGUNG = '0'            and M.BENHVIEN_ID = 'HLU01'            order by M.TENMAU]
2019-09-20 11:27:59,027 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM071']
2019-09-20 11:27:59,080 [5] DEBUG - Statement Id: [DAO00322_GetListMauTonKhoForCreateCached] PreparedStatement : [SELECT DISTINCT          TK.MAU_KEY, TK.KHOMAU_ID, M.MAU_ID, M.MAMAU, M.TENMAU, M.NHOM_ABO, M.NHOM_RH, M.LOAIMAU_ID,          TK.SOLONHAP_ID, SLN.SOLONHAP, SLN.SOKIEMSOAT, TK.NGUONHANG_ID, NG.TENNGUONMAU, M.BENHVIEN_ID, M.DONVITINH_ID,          SUM(tk.SOLUONG) AS SOLUONG,K.TENKHO,DVT.TENDONVITINH          FROM TT_MAU_TONKHO TK          JOIN TM_KHO K ON TK.KHOMAU_ID = K.KHO_ID          JOIN TT_MAU_CHUNGTU_SOLONHAP SLN ON TK.SOLONHAP_ID = SLN.SOLONHAP_ID          JOIN TM_MAU M on TK.MAU_ID = M.MAU_ID and M.TAMNGUNG = '0'          LEFT JOIN TM_MAU_DONVITINH DVT on M.DONVITINH_ID=DVT.DONVITINH_ID          LEFT JOIN TM_NGUONMAU NG ON NG.NGUONMAU_ID = TK.NGUONHANG_ID          WHERE TK.SOLUONG > 0          GROUP BY TK.MAU_KEY, TK.KHOMAU_ID, M.MAU_ID, M.MAMAU, M.TENMAU, M.NHOM_ABO, M.NHOM_RH, M.LOAIMAU_ID,          TK.SOLONHAP_ID, SLN.SOLONHAP, SLN.SOKIEMSOAT,TK.NGUONHANG_ID, NG.TENNGUONMAU, M.BENHVIEN_ID, M.DONVITINH_ID,K.TENKHO,DVT.TENDONVITINH]
2019-09-20 11:27:59,201 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM073']
2019-09-20 11:27:59,259 [5] DEBUG - Statement Id: [DAO00322_GetListMauTonKhoTruBooking] PreparedStatement : [select distinct          TK.MAU_KEY, TK.KHOMAU_ID, M.MAU_ID, M.MAMAU, M.TENMAU, M.NHOM_ABO, M.NHOM_RH, M.LOAIMAU_ID, M.DONVITINH_ID,          TK.SOLONHAP_ID, TK.SOLONHAP, TK.SOKIEMSOAT,M.PHAMVI, TK.NGUONHANG_ID, NG.TENNGUONMAU, M.BENHVIEN_ID,          TK.SOLUONG,TK.TENKHO,DVT.TENDONVITINH          from TM_MAU M          JOIN          (          select          A.MAU_KEY, A.KHOMAU_ID, A.MAU_ID ,a.NGUONHANG_ID, A.SOLONHAP_ID, A.SOLONHAP, A.SOKIEMSOAT, A.SOLUONG,A.TENKHO          from          (          select KHOMAU_ID, TK.MAU_ID, TK.NGUONHANG_ID, TK.MAU_KEY, SLN.SOLONHAP_ID, SLN.SOLONHAP, SLN.SOKIEMSOAT, ISNULL(TK.SOLUONG,0) - ISNULL(book.SOLUONG,0) as SOLUONG,K.TENKHO          from TT_MAU_TONKHO TK          JOIN TM_KHO K ON TK.KHOMAU_ID = K.KHO_ID          inner join TT_MAU_CHUNGTU_SOLONHAP SLN ON TK.SOLONHAP_ID = SLN.SOLONHAP_ID          left join dbo.TT_MAU_TONKHO_BOOK book ON book.MAU_KEY = TK.MAU_KEY AND book.TRANGTHAI = 'HIEULUC'          where ISNULL(TK.SOLUONG,0) - ISNULL(book.SOLUONG,0) > 0          ) A          )TK on TK.MAU_ID = M.MAU_ID and M.TAMNGUNG = '0'          LEFT JOIN TM_MAU_DONVITINH DVT on M.DONVITINH_ID=DVT.DONVITINH_ID          LEFT JOIN TM_NGUONMAU NG ON NG.NGUONMAU_ID = TK.NGUONHANG_ID]
2019-09-20 11:27:59,364 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM072']
2019-09-20 11:28:00,296 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'MAIN'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2019-09-20 11:28:01,227 [1] DEBUG - Statement Id: [DAO00002_FormList] PreparedStatement : [select              TM_SYS_FORM.HOSPITAL_ID,              TM_SYS_FORM.NAME,              TM_SYS_FORM.CLASS,              TM_SYS_FORM.ASSEMBLY,              TM_SYS_FORM.TITLE_VI as TITLE              from TM_SYS_FORM              where HOSPITAL_ID = 'HLU01']
2019-09-20 11:28:07,642 [1] DEBUG - Statement Id: [DAO00300_GetShortcutListByUserID] PreparedStatement : [SELECT S.SHORTCUT_CODE, S.SHORTCUT_VALUE              FROM TM_SHORTCUT AS S              WHERE S.BENHVIEN_ID = 'HLU01' AND S.USER_ID = '1' AND TAMNGUNG = '0']
2019-09-20 11:28:07,694 [1] DEBUG - Statement Id: [DAO00087_GetList] PreparedStatement : [select CODE, VALUE, BENHVIEN_ID              from TM_SYS_APPSETTINGS              where LOCKED = '0' and BENHVIEN_ID = 'HLU01'              order by SETTING_ID]
2019-09-20 11:28:07,888 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'MSG01'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2019-09-20 11:28:08,076 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'MSG02'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2019-09-20 11:28:08,241 [1] DEBUG - Statement Id: [DAO00008_GetUserSettings] PreparedStatement : [select A.*, B.TENKHO , C.TENPHONGBAN, B.MAKHO, C.MAPHONGBAN          from TM_SYS_USERS A          left join TM_KHODUOC B on B.KHODUOC_ID = A.INVENTORY_ID          left join TM_PHONGBAN C on (C.PHONGBAN_ID = A.WORKING_DEPT_ID and C.BENHVIEN_ID =  @param0 )          left join TM_SYS_USERKHO D on (D.ACCOUNT_ID = A.ACCOUNT_ID and D.HOSPITAL_ID =  @param0 )          where          A.HOSPITAL_ID =  @param0            and                 A.ACCOUNT_ID =  @param1]
2019-09-20 11:28:08,242 [1] DEBUG - Statement Id: [DAO00008_GetUserSettings] Parameters: [@param0=[HOSPITAL_ID,HLU01], @param1=[ACCOUNT_ID,113]]
2019-09-20 11:28:08,242 [1] DEBUG - Statement Id: [DAO00008_GetUserSettings] Types: [@param0=[String, System.String], @param1=[String, System.String]]
2019-09-20 11:28:08,295 [1] DEBUG - Statement Id: [DAO00008_GetUserInvSettings] PreparedStatement : [select A.*, B.TENKHO, B.MAKHO, B.LOAIKHO_ID, B.KHOQUANLY_ID          from TM_SYS_USERKHO A          left join TM_KHO B on B.MODULE_ID = A.MODULE_ID and B.KHO_ID = A.KHO_ID          where A.HOSPITAL_ID =  @param0  and A.ACCOUNT_ID =  @param1           order by B.TENKHO]
2019-09-20 11:28:08,295 [1] DEBUG - Statement Id: [DAO00008_GetUserInvSettings] Parameters: [@param0=[HOSPITAL_ID,HLU01], @param1=[ACCOUNT_ID,113]]
2019-09-20 11:28:08,295 [1] DEBUG - Statement Id: [DAO00008_GetUserInvSettings] Types: [@param0=[String, System.String], @param1=[String, System.String]]
2019-09-20 11:28:08,458 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'COM30'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2019-09-20 11:28:08,656 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'RIS04'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2019-09-20 11:28:16,510 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'MENU1'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2019-09-20 11:28:17,597 [1] DEBUG - Statement Id: [DAO00011_GetList] PreparedStatement : [select              TM_SYS_MENU.ID,              TM_SYS_MENU.PARENTID,              TM_SYS_MENU.SCREEN,              TM_SYS_MENU.SMALLIMAGE,              TM_SYS_MENU.LARGEIMAGE,              TM_SYS_MENU.DESCRIPTION,              TM_SYS_MENU.TYPE,              TM_SYS_MENU.TITLE_VI as TITLE              from TM_SYS_MENU              where TM_SYS_MENU.HOSPITAL_ID = 'HLU01' and TM_SYS_MENU.ACTIVE = '1'               AND                   (TM_SYS_MENU.TYPE & '8' = '8')                             order by TM_SYS_MENU.ORDERNUM]
2019-09-20 11:28:18,322 [1] DEBUG - Statement Id: [DAO00011_usermenu_list] PreparedStatement : [select              TM_SYS_HOMEMENU.MENUID as ID,              TM_SYS_MENU.TITLE_VI as TITLE,              TM_SYS_MENU.SCREEN,              TM_SYS_MENU.SMALLIMAGE,              TM_SYS_MENU.LARGEIMAGE,              TM_SYS_MENU.TYPE              from TM_SYS_HOMEMENU              left join TM_SYS_MENU on TM_SYS_MENU.ID = TM_SYS_HOMEMENU.MENUID and TM_SYS_MENU.HOSPITAL_ID = TM_SYS_HOMEMENU.HOSPITAL_ID              where TM_SYS_HOMEMENU.HOSPITAL_ID = 'HLU01' and TM_SYS_HOMEMENU.USERID = '113' and TM_SYS_MENU.ACTIVE = '1'               AND                   (TM_SYS_MENU.TYPE & '8' = '8')                             ORDER BY TM_SYS_HOMEMENU.ORDERNUM]
2019-09-20 11:28:21,776 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'COM31'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2019-09-20 11:28:24,351 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'ORM28'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2019-09-20 11:28:29,100 [1] DEBUG - Statement Id: [DAO00066_GetBENHAN_TIEPNHAN] PreparedStatement : [select top 1 *        from TT_NOITRU_BENHAN        where TIEPNHAN_ID = '27022'  and BENHVIEN_ID = 'HLU01'        order by NGAYTAO desc]
2019-09-20 11:28:29,282 [1] DEBUG - Statement Id: [DAO00014_GetInPatientStatus] PreparedStatement : [select TRANGTHAI, isnull(KHOACHUYENDEN_ID, KHOAVAO_ID) as KHOAHIENTAI from TT_NOITRU_BENHAN        where        TIEPNHAN_ID = '27022'        and BENHVIEN_ID = 'HLU01'         and           BENHAN_ID = '5800']
2019-09-20 11:28:29,383 [1] DEBUG - Statement Id: [DAO00048_TT_PHAUTHUAT_GetList] PreparedStatement : [select *              from TT_PHAUTHUAT               where                             TT_PHAUTHUAT.LOAI = 'P'                       and                           TT_PHAUTHUAT.TIEPNHAN_ID = 27022                       and                           TT_PHAUTHUAT.BENHVIEN_ID = 'HLU01'                                     order by PHAUTHUAT_ID DESC]
2019-09-20 11:28:29,431 [1] DEBUG - Statement Id: [DAO00048_GetListLoaiGacTrongPTTT] PreparedStatement : [select DICTIONARY_ID, DICTIONARY_CODE, DICTIONARY_NAME          from LST_DICTIONARY          where DICTIONARY_TYPE_CODE = 'LoaiGacPTTT'          and ENABLED = '1']
2019-09-20 11:28:34,879 [1] DEBUG - Statement Id: [DAO00048_GetDSLoaiGacDaGhiNhan] PreparedStatement : [select A.KIEMSOATGAC_ID, A.BENHNHAN_ID, A.TIEPNHAN_ID, A.BENHAN_ID, A.PHAUTHUAT_ID, A.LOAIPT_TT, A.LOAIGAC_ID          , A.NGAYGHINHAN, A.THOIGIANGHINHAN, A.SOLUONG, A.SOLUONGDASUDUNG, A.SOLUONGCONLAI, A.GHICHU, A.NGUOINHANDUNGCU_ID          , B.DICTIONARY_CODE AS MALOAIGAC, B.DICTIONARY_NAME AS TENLOAIGAC          from TT_PHAUTHUAT_GHINHANGAC A          inner join LST_DICTIONARY B on B.DICTIONARY_ID = A.LOAIGAC_ID          where A.PHAUTHUAT_ID = 3742 and A.BENHVIEN_ID = 'HLU01']
2019-09-20 11:28:40,722 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'COM98'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
--------------------------------------------------------------------------------
2019-09-20 11:29:26,985 [1] DEBUG - Statement Id: [DAO00001_DBList] PreparedStatement : [select *              from TM_SYS_SERVER              where HOSPITAL_ID = '_SYSTEM_' and TYPE = 'D']
2019-09-20 11:29:27,344 [1] DEBUG - Statement Id: [DAO00001_DaoList] PreparedStatement : [select              TM_SYS_SERVICEMAP.ID,              TM_SYS_SERVICEMAP.HOSPITAL_ID,              TM_SYS_SERVICEMAP.DB_NAME,              TM_SYS_SERVICEMAP.TYPE,              TM_SYS_SERVICEMAP.NAME,              TM_SYS_SERVICEMAP.CLASS,              (TM_SYS_DIC.VALUE + '.' + TM_SYS_SERVICEMAP.CLASS) as CLASSFULL,              TM_SYS_SERVICEMAP.ASSEMBLY              from TM_SYS_SERVICEMAP              inner join TM_SYS_DIC              on TM_SYS_SERVICEMAP.NAMESPACE = TM_SYS_DIC.ID              where HOSPITAL_ID = '_SYSTEM_' AND TYPE = 'D' AND ACTIVE = '1'              order by DB_NAME]
2019-09-20 11:29:27,383 [1] DEBUG - Statement Id: [DAO00001_ServiceList] PreparedStatement : [select              TM_SYS_SERVICEMAP.ID,              TM_SYS_SERVICEMAP.HOSPITAL_ID,              TM_SYS_SERVICEMAP.DB_NAME,              TM_SYS_SERVICEMAP.TYPE,              TM_SYS_SERVICEMAP.NAME,              TM_SYS_SERVICEMAP.CLASS,              (TM_SYS_DIC.VALUE + '.' + TM_SYS_SERVICEMAP.CLASS) as CLASSFULL,              TM_SYS_SERVICEMAP.ASSEMBLY,              TM_SYS_SERVER.URL              from TM_SYS_SERVICEMAP              inner join TM_SYS_DIC on TM_SYS_SERVICEMAP.NAMESPACE = TM_SYS_DIC.ID              inner join TM_SYS_SERVER on (TM_SYS_SERVICEMAP.DB_NAME = TM_SYS_SERVER.NAME) and (TM_SYS_SERVER.HOSPITAL_ID = '_SYSTEM_')              where TM_SYS_SERVICEMAP.HOSPITAL_ID = '_SYSTEM_' AND TM_SYS_SERVICEMAP.TYPE = 'S'  AND ACTIVE = '1'              order by URL]
2019-09-20 11:29:27,766 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = '_SYSTEM_'               AND                   TM_SYS_SCREEN.PAGE = 'LOGIN'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2019-09-20 11:29:27,991 [1] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = '_SYSTEM_'               AND                   TM_SYS_CACHE.ACTIVE = '1']
2019-09-20 11:29:38,462 [1] DEBUG - Statement Id: [DAO00001_DBList] PreparedStatement : [select *              from TM_SYS_SERVER              where HOSPITAL_ID = 'HLU01' and TYPE = 'D']
2019-09-20 11:29:38,528 [1] DEBUG - Statement Id: [DAO00001_DaoList] PreparedStatement : [select              TM_SYS_SERVICEMAP.ID,              TM_SYS_SERVICEMAP.HOSPITAL_ID,              TM_SYS_SERVICEMAP.DB_NAME,              TM_SYS_SERVICEMAP.TYPE,              TM_SYS_SERVICEMAP.NAME,              TM_SYS_SERVICEMAP.CLASS,              (TM_SYS_DIC.VALUE + '.' + TM_SYS_SERVICEMAP.CLASS) as CLASSFULL,              TM_SYS_SERVICEMAP.ASSEMBLY              from TM_SYS_SERVICEMAP              inner join TM_SYS_DIC              on TM_SYS_SERVICEMAP.NAMESPACE = TM_SYS_DIC.ID              where HOSPITAL_ID = 'HLU01' AND TYPE = 'D' AND ACTIVE = '1'              order by DB_NAME]
2019-09-20 11:29:40,126 [1] DEBUG - Statement Id: [DAO00001_ServiceList] PreparedStatement : [select              TM_SYS_SERVICEMAP.ID,              TM_SYS_SERVICEMAP.HOSPITAL_ID,              TM_SYS_SERVICEMAP.DB_NAME,              TM_SYS_SERVICEMAP.TYPE,              TM_SYS_SERVICEMAP.NAME,              TM_SYS_SERVICEMAP.CLASS,              (TM_SYS_DIC.VALUE + '.' + TM_SYS_SERVICEMAP.CLASS) as CLASSFULL,              TM_SYS_SERVICEMAP.ASSEMBLY,              TM_SYS_SERVER.URL              from TM_SYS_SERVICEMAP              inner join TM_SYS_DIC on TM_SYS_SERVICEMAP.NAMESPACE = TM_SYS_DIC.ID              inner join TM_SYS_SERVER on (TM_SYS_SERVICEMAP.DB_NAME = TM_SYS_SERVER.NAME) and (TM_SYS_SERVER.HOSPITAL_ID = 'HLU01')              where TM_SYS_SERVICEMAP.HOSPITAL_ID = 'HLU01' AND TM_SYS_SERVICEMAP.TYPE = 'S'  AND ACTIVE = '1'              order by URL]
2019-09-20 11:29:40,215 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1']
2019-09-20 11:29:41,003 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM005']
2019-09-20 11:29:41,559 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM015']
2019-09-20 11:29:41,644 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM067']
2019-09-20 11:29:41,725 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM008']
2019-09-20 11:29:41,803 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM068']
2019-09-20 11:29:41,879 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM006']
2019-09-20 11:29:41,987 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM030']
2019-09-20 11:29:42,061 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM025']
2019-09-20 11:29:42,147 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM024']
2019-09-20 11:29:42,654 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM033']
2019-09-20 11:29:42,695 [5] DEBUG - Statement Id: [DAO00027_GetListDuocKyGuiTonKho] PreparedStatement : [select  distinct TT_TONKHO.DUOC_KEY, LTRIM(TT_TONKHO.KHODUOC_ID) as KHODUOC_ID, TM_DUOC.DUOC_ID, TM_LOAIDUOC.MALOAIDUOC,TM_DUOC.SOVISA,TM_DUOC.TYLE_VAT,TM_DUOC.COTOA,        TM_DUOC.MADUOC, TM_DUOC.TENHANG, TM_DUOC.TENDUOCDAYDU, dvt.TENDONVITINH as DONVITINH,  TM_DUOC.DONVITINH_ID,TM_DUOC.BHYT,TM_DUOC.PHAMVI,        TM_DUOC.TENHOATCHAT, TM_DUOC.HAMLUONG, TM_DUOC.HANGSANXUAT, TM_DUOC.QUOCGIA, TM_DUOC.LOAIDUOC_ID, TM_DUOC.DUONGDUNG_ID,        TM_TENDUOC.TENDUOC, TM_TENDUOC.TENDUOC_EN, TM_TENDUOC.MAQUOCTE, TM_TENDUOC.MAQUOCTEBT,        TM_LOAIDUOC.LOAIVATTU_ID, TM_DUOC.BENHVIEN_ID,TT_TONKHO.SOLUONG, TT_TONKHO.NGUONDUOC_ID, NH.TENNGUONDUOC        , TAMNGUNG = CASE WHEN TM_DUOC.TAMNGUNG = '1' OR nh.TAMNGUNG = '1' OR KD.TAMNGUNG = '1' THEN '1' ELSE '0' END        , TM_DUOC.DANGTRINHBAY        from TM_DUOC        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = TM_DUOC.DONVITINH_ID        left join TM_TENDUOC on TM_DUOC.TENDUOC_ID = TM_TENDUOC.TENDUOC_ID and TM_DUOC.BENHVIEN_ID = 'HLU01' and TM_DUOC.TAMNGUNG = '0'        left join TM_LOAIDUOC on TM_LOAIDUOC.LOAIDUOC_ID = TM_DUOC.LOAIDUOC_ID and TM_LOAIDUOC.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG on (TM_LOAIDUOC.LOAIVATTU_ID = TM_DUOC_HANDUNG.LOAIDUOC and TM_DUOC_HANDUNG.BENHVIEN_ID = 'HLU01')        inner join        (select LTRIM(A.KHODUOC_ID) + '_' + LTRIM(A.DUOC_ID) + '_' + LTRIM(ISNULL(A.NGUONDUOC_ID,'')) as DUOC_KEY, A.KHODUOC_ID, A.DUOC_ID,A.NGUONDUOC_ID,        SUM(isnull(A.SOLUONG,0)) as SOLUONG        from        (select SUM(SOLUONG) as SOLUONG, KHODUOC_ID, DUOC_ID, NGUONDUOC_ID from TT_DUOC_KYGUI_TONKHO        where BENHVIEN_ID = 'HLU01' group by KHODUOC_ID, DUOC_ID, NGUONDUOC_ID) A        group by LTRIM(A.KHODUOC_ID) + '_' + LTRIM(A.DUOC_ID) + '_' + LTRIM(A.NGUONDUOC_ID), A.KHODUOC_ID, A.DUOC_ID, A.NGUONDUOC_ID)        TT_TONKHO on TT_TONKHO.DUOC_ID = TM_DUOC.DUOC_ID        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = TT_TONKHO.NGUONDUOC_ID and nh.BENHVIEN_ID = 'HLU01'        LEFT JOIN TM_KHODUOC KD ON KD.KHODUOC_ID = TT_TONKHO.KHODUOC_ID        where TM_DUOC.BENHVIEN_ID = 'HLU01' AND TT_TONKHO.SOLUONG >= 0]
2019-09-20 11:29:42,776 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM018']
2019-09-20 11:29:42,817 [5] DEBUG - Statement Id: [DAO00027_GetListDuocTonKho] PreparedStatement : [select distinct TT_TONKHO.DUOC_KEY, LTRIM(TT_TONKHO.KHODUOC_ID) as KHODUOC_ID, TM_DUOC.DUOC_ID, TM_LOAIDUOC.MALOAIDUOC,TM_DUOC.SOVISA,TM_DUOC.TYLE_VAT,TM_DUOC.COTOA,        TM_DUOC.MADUOC, TM_DUOC.TENHANG, TM_DUOC.TENDUOCDAYDU, dvt.TENDONVITINH as DONVITINH,  TM_DUOC.DONVITINH_ID,TM_DUOC.BHYT,                TM_DUOC.TENHOATCHAT,          TM_DUOC.HAMLUONG, TM_DUOC.HANGSANXUAT, TM_DUOC.QUOCGIA, TM_DUOC.LOAIDUOC_ID, TM_DUOC.DUONGDUNG_ID,        TM_TENDUOC.TENDUOC, TM_TENDUOC.TENDUOC_EN, TM_TENDUOC.MAQUOCTE, TM_TENDUOC.MAQUOCTEBT,        TM_LOAIDUOC.LOAIVATTU_ID, TM_DUOC.BENHVIEN_ID,        TT_TONKHO.SOLUONG, TM_DUOC.VTYT_PHANLOAI, TM_DUOC.PHAMVI, TT_TONKHO.NGUONDUOC_ID, NG.TENNGUONDUOC AS TENNGUONDUOC        , TAMNGUNG = CASE WHEN TM_DUOC.TAMNGUNG = '1' OR NG.TAMNGUNG = '1' OR KD.TAMNGUNG = '1' THEN '1' ELSE '0' END        , TM_DUOC.DANGTRINHBAY        from TM_DUOC        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = TM_DUOC.DONVITINH_ID        left join TM_TENDUOC on TM_DUOC.TENDUOC_ID = TM_TENDUOC.TENDUOC_ID and TM_DUOC.BENHVIEN_ID = 'HLU01' and TM_DUOC.TAMNGUNG = '0'        left join TM_LOAIDUOC on TM_LOAIDUOC.LOAIDUOC_ID = TM_DUOC.LOAIDUOC_ID and TM_LOAIDUOC.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG on (TM_LOAIDUOC.LOAIVATTU_ID = TM_DUOC_HANDUNG.LOAIDUOC and TM_DUOC_HANDUNG.BENHVIEN_ID = 'HLU01')        inner join        (select LTRIM(A.KHODUOC_ID) + '_' + LTRIM(A.DUOC_ID) + '_' + LTRIM(ISNULL(A.NGUONDUOC_ID,'')) as DUOC_KEY, A.KHODUOC_ID, A.DUOC_ID, A.NGUONDUOC_ID,        SUM(isnull(A.SOLUONG,0)) as SOLUONG        from        (select SUM(SOLUONG) as SOLUONG, KHODUOC_ID, DUOC_ID, NGUONDUOC_ID from TT_DUOC_TONKHO        where BENHVIEN_ID = 'HLU01' group by KHODUOC_ID, DUOC_ID, NGUONDUOC_ID) A        group by LTRIM(A.KHODUOC_ID) + '_' + LTRIM(A.DUOC_ID) + '_' + LTRIM(ISNULL(A.NGUONDUOC_ID,'')), A.KHODUOC_ID, A.DUOC_ID, NGUONDUOC_ID        ) TT_TONKHO on TT_TONKHO.DUOC_ID = TM_DUOC.DUOC_ID        LEFT JOIN TM_NGUONHANG NG ON NG.NGUONDUOC_ID = TT_TONKHO.NGUONDUOC_ID        LEFT JOIN TM_KHODUOC KD ON KD.KHODUOC_ID = TT_TONKHO.KHODUOC_ID        where TM_DUOC.BENHVIEN_ID = 'HLU01' and TT_TONKHO.SOLUONG >= 0]
2019-09-20 11:29:45,762 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM023']
2019-09-20 11:29:45,799 [5] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoVaBooking] PreparedStatement : [declare @NGUONDUOC_MACDINH varchar(5) = '0';        declare @TOAMUANGOAI int = 0;        select @NGUONDUOC_MACDINH = isnull(VALUE,0) from TM_SYS_APPSETTINGS where CODE = 'PHA_NGUONDUOC'        select @TOAMUANGOAI = isnull(VALUE,0) from TM_SYS_APPSETTINGS where CODE = 'OPD_TOAMUANGOAI_DUNGDANHMUC_DUOC'                if @TOAMUANGOAI = 1        begin        select  distinct '0' + '_' + LTRIM(d.DUOC_ID) + '_' + @NGUONDUOC_MACDINH as DUOC_KEY, 0 as PHAMVI_ID, @NGUONDUOC_MACDINH as NGUONDUOC_ID, null as TENNGUONDUOC, null as TINHTIEN, d.DUOC_ID, ld.MALOAIDUOC,        d.SOVISA,d.TYLE_VAT,d.COTOA, d.MADUOC, d.TENHANG, d.TENDUOCDAYDU, d.DONVITINH as DONVITINH, d.BHYT,        d.TENHOATCHAT, d.HAMLUONG, d.HANGSANXUAT, d.QUOCGIA, d.LOAIDUOC_ID, d.DUONGDUNG_ID, d.TINHTIEN_PTTT,        ten.TENDUOC, ten.TENDUOC_EN, ten.MAQUOCTE, ten.MAQUOCTEBT,        '' as BHYT_TEXT        , ld.LOAIVATTU_ID        , d.BENHVIEN_ID,        999999999 as SOLUONG, d.VTYT_PHANLOAI, d.PHAMVI, d.SUASOLUONGTONGHOP, d.MADUOCBV, d.DANGTRINHBAY        , TAMNGUNG = CASE WHEN d.TAMNGUNG = '1' THEN '1' ELSE '0' END        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        union all        select  distinct tk.DUOC_KEY, LTRIM(tk.PHAMVI_ID) as PHAMVI_ID, tk.NGUONDUOC_ID, nh.TENNGUONDUOC, nh.TINHTIEN, d.DUOC_ID, ld.MALOAIDUOC,        d.SOVISA,d.TYLE_VAT,d.COTOA, d.MADUOC, d.TENHANG, d.TENDUOCDAYDU, d.DONVITINH as DONVITINH, d.BHYT,        d.TENHOATCHAT, d.HAMLUONG, d.HANGSANXUAT, d.QUOCGIA, d.LOAIDUOC_ID, d.DUONGDUNG_ID, d.TINHTIEN_PTTT,        ten.TENDUOC, ten.TENDUOC_EN, ten.MAQUOCTE, ten.MAQUOCTEBT,        CASE WHEN d.BHYT = '1' THEN 'BHYT' ELSE '' END as BHYT_TEXT        , ld.LOAIVATTU_ID        , d.BENHVIEN_ID,        tk.SOLUONG, d.VTYT_PHANLOAI, d.PHAMVI, d.SUASOLUONGTONGHOP, d.MADUOCBV, d.DANGTRINHBAY        , TAMNGUNG = CASE WHEN d.TAMNGUNG = '1' OR nh.TAMNGUNG = '1' OR kd.TAMNGUNG = '1' THEN '1' ELSE '0' END        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        inner join        (        select  LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')) DUOC_KEY, (SUM(dtk.SOLUONG) - isnull(sum(A.SOLUONG),0) - isnull(sum(B.SOLUONG),0)) SOLUONG, pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        from (select sum(soluong) soluong,duoc_id,nguonduoc_id,khoduoc_id,benhvien_id from TT_DUOC_TONKHO  group by duoc_id,nguonduoc_id,khoduoc_id,benhvien_id) dtk        inner join TM_DUOC_PHAMVISD_MAPPING pvsd on dtk.KHODUOC_ID = pvsd.KHODUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NOITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) B on B.DUOC_ID = dtk.DUOC_ID and B.SOLUONG > 0 and B.PHAMVI_ID = pvsd.PHAMVI_ID and B.NGUONHANG_ID = dtk.NGUONDUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NGOAITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) A on A.DUOC_ID = dtk.DUOC_ID and A.SOLUONG > 0 and A.PHAMVI_ID = pvsd.PHAMVI_ID and A.NGUONHANG_ID = dtk.NGUONDUOC_ID        where dtk.SOLUONG > 0 and dtk.BENHVIEN_ID = 'HLU01'        group by LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')), pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        ) tk on tk.DUOC_ID = d.DUOC_ID        left join TM_DUOC_PHAMVISUDUNG kd on kd.PHAMVI_ID = tk.PHAMVI_ID and kd.BENHVIEN_ID = 'HLU01'        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = tk.NGUONDUOC_ID and nh.BENHVIEN_ID = 'HLU01'        where d.BENHVIEN_ID = 'HLU01'  and tk.SOLUONG >= 0        end        else        begin                  select  distinct tk.DUOC_KEY, LTRIM(tk.PHAMVI_ID) as PHAMVI_ID, tk.NGUONDUOC_ID, nh.TENNGUONDUOC, nh.TINHTIEN, d.DUOC_ID, ld.MALOAIDUOC,        d.SOVISA,d.TYLE_VAT,d.COTOA, d.MADUOC, d.TENHANG, d.TENDUOCDAYDU, d.DONVITINH as DONVITINH, d.BHYT,        d.TENHOATCHAT, d.HAMLUONG, d.HANGSANXUAT, d.QUOCGIA, d.LOAIDUOC_ID, d.DUONGDUNG_ID, d.TINHTIEN_PTTT,        ten.TENDUOC, ten.TENDUOC_EN, ten.MAQUOCTE, ten.MAQUOCTEBT,        CASE WHEN d.BHYT = '1' THEN 'BHYT' ELSE '' END as BHYT_TEXT        , ld.LOAIVATTU_ID        , d.BENHVIEN_ID,        tk.SOLUONG, d.VTYT_PHANLOAI, d.PHAMVI, d.SUASOLUONGTONGHOP, d.MADUOCBV, d.DANGTRINHBAY        , TAMNGUNG = CASE WHEN d.TAMNGUNG = '1' OR nh.TAMNGUNG = '1' OR kd.TAMNGUNG = '1' THEN '1' ELSE '0' END        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        inner join        (        select  LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')) DUOC_KEY, (SUM(dtk.SOLUONG) - isnull(sum(A.SOLUONG),0) - isnull(sum(B.SOLUONG),0)) SOLUONG, pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        from (select sum(soluong) soluong,duoc_id,nguonduoc_id,khoduoc_id,benhvien_id from TT_DUOC_TONKHO  group by duoc_id,nguonduoc_id,khoduoc_id,benhvien_id) dtk        inner join TM_DUOC_PHAMVISD_MAPPING pvsd on dtk.KHODUOC_ID = pvsd.KHODUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NOITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) B on B.DUOC_ID = dtk.DUOC_ID and B.SOLUONG > 0 and B.PHAMVI_ID = pvsd.PHAMVI_ID and B.NGUONHANG_ID = dtk.NGUONDUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NGOAITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) A on A.DUOC_ID = dtk.DUOC_ID and A.SOLUONG > 0 and A.PHAMVI_ID = pvsd.PHAMVI_ID and A.NGUONHANG_ID = dtk.NGUONDUOC_ID        where dtk.SOLUONG > 0 and dtk.BENHVIEN_ID = 'HLU01'        group by LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')), pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        ) tk on tk.DUOC_ID = d.DUOC_ID        left join TM_DUOC_PHAMVISUDUNG kd on kd.PHAMVI_ID = tk.PHAMVI_ID and kd.BENHVIEN_ID = 'HLU01'        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = tk.NGUONDUOC_ID and nh.BENHVIEN_ID = 'HLU01'        where d.BENHVIEN_ID = 'HLU01'  and tk.SOLUONG >= 0        end]
2019-09-20 11:29:48,284 [5] DEBUG - Statement Id: [DAO00320_GetList] PreparedStatement : [select M.*            from TM_MAU M            LEFT JOIN TM_MAU_DONVITINH DVT on M.DONVITINH_ID=DVT.DONVITINH_ID            where            M.TAMNGUNG = '0'            and M.BENHVIEN_ID = 'HLU01'            order by M.TENMAU]
2019-09-20 11:29:48,356 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM071']
2019-09-20 11:29:48,392 [5] DEBUG - Statement Id: [DAO00322_GetListMauTonKhoForCreateCached] PreparedStatement : [SELECT DISTINCT          TK.MAU_KEY, TK.KHOMAU_ID, M.MAU_ID, M.MAMAU, M.TENMAU, M.NHOM_ABO, M.NHOM_RH, M.LOAIMAU_ID,          TK.SOLONHAP_ID, SLN.SOLONHAP, SLN.SOKIEMSOAT, TK.NGUONHANG_ID, NG.TENNGUONMAU, M.BENHVIEN_ID, M.DONVITINH_ID,          SUM(tk.SOLUONG) AS SOLUONG,K.TENKHO,DVT.TENDONVITINH          FROM TT_MAU_TONKHO TK          JOIN TM_KHO K ON TK.KHOMAU_ID = K.KHO_ID          JOIN TT_MAU_CHUNGTU_SOLONHAP SLN ON TK.SOLONHAP_ID = SLN.SOLONHAP_ID          JOIN TM_MAU M on TK.MAU_ID = M.MAU_ID and M.TAMNGUNG = '0'          LEFT JOIN TM_MAU_DONVITINH DVT on M.DONVITINH_ID=DVT.DONVITINH_ID          LEFT JOIN TM_NGUONMAU NG ON NG.NGUONMAU_ID = TK.NGUONHANG_ID          WHERE TK.SOLUONG > 0          GROUP BY TK.MAU_KEY, TK.KHOMAU_ID, M.MAU_ID, M.MAMAU, M.TENMAU, M.NHOM_ABO, M.NHOM_RH, M.LOAIMAU_ID,          TK.SOLONHAP_ID, SLN.SOLONHAP, SLN.SOKIEMSOAT,TK.NGUONHANG_ID, NG.TENNGUONMAU, M.BENHVIEN_ID, M.DONVITINH_ID,K.TENKHO,DVT.TENDONVITINH]
2019-09-20 11:29:48,534 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM073']
2019-09-20 11:29:48,781 [5] DEBUG - Statement Id: [DAO00322_GetListMauTonKhoTruBooking] PreparedStatement : [select distinct          TK.MAU_KEY, TK.KHOMAU_ID, M.MAU_ID, M.MAMAU, M.TENMAU, M.NHOM_ABO, M.NHOM_RH, M.LOAIMAU_ID, M.DONVITINH_ID,          TK.SOLONHAP_ID, TK.SOLONHAP, TK.SOKIEMSOAT,M.PHAMVI, TK.NGUONHANG_ID, NG.TENNGUONMAU, M.BENHVIEN_ID,          TK.SOLUONG,TK.TENKHO,DVT.TENDONVITINH          from TM_MAU M          JOIN          (          select          A.MAU_KEY, A.KHOMAU_ID, A.MAU_ID ,a.NGUONHANG_ID, A.SOLONHAP_ID, A.SOLONHAP, A.SOKIEMSOAT, A.SOLUONG,A.TENKHO          from          (          select KHOMAU_ID, TK.MAU_ID, TK.NGUONHANG_ID, TK.MAU_KEY, SLN.SOLONHAP_ID, SLN.SOLONHAP, SLN.SOKIEMSOAT, ISNULL(TK.SOLUONG,0) - ISNULL(book.SOLUONG,0) as SOLUONG,K.TENKHO          from TT_MAU_TONKHO TK          JOIN TM_KHO K ON TK.KHOMAU_ID = K.KHO_ID          inner join TT_MAU_CHUNGTU_SOLONHAP SLN ON TK.SOLONHAP_ID = SLN.SOLONHAP_ID          left join dbo.TT_MAU_TONKHO_BOOK book ON book.MAU_KEY = TK.MAU_KEY AND book.TRANGTHAI = 'HIEULUC'          where ISNULL(TK.SOLUONG,0) - ISNULL(book.SOLUONG,0) > 0          ) A          )TK on TK.MAU_ID = M.MAU_ID and M.TAMNGUNG = '0'          LEFT JOIN TM_MAU_DONVITINH DVT on M.DONVITINH_ID=DVT.DONVITINH_ID          LEFT JOIN TM_NGUONMAU NG ON NG.NGUONMAU_ID = TK.NGUONHANG_ID]
2019-09-20 11:29:48,849 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM072']
2019-09-20 11:29:49,776 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'MAIN'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2019-09-20 11:29:50,730 [1] DEBUG - Statement Id: [DAO00002_FormList] PreparedStatement : [select              TM_SYS_FORM.HOSPITAL_ID,              TM_SYS_FORM.NAME,              TM_SYS_FORM.CLASS,              TM_SYS_FORM.ASSEMBLY,              TM_SYS_FORM.TITLE_VI as TITLE              from TM_SYS_FORM              where HOSPITAL_ID = 'HLU01']
2019-09-20 11:29:56,092 [1] DEBUG - Statement Id: [DAO00300_GetShortcutListByUserID] PreparedStatement : [SELECT S.SHORTCUT_CODE, S.SHORTCUT_VALUE              FROM TM_SHORTCUT AS S              WHERE S.BENHVIEN_ID = 'HLU01' AND S.USER_ID = '1' AND TAMNGUNG = '0']
2019-09-20 11:29:56,125 [1] DEBUG - Statement Id: [DAO00087_GetList] PreparedStatement : [select CODE, VALUE, BENHVIEN_ID              from TM_SYS_APPSETTINGS              where LOCKED = '0' and BENHVIEN_ID = 'HLU01'              order by SETTING_ID]
2019-09-20 11:29:56,206 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'MSG01'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2019-09-20 11:29:56,363 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'MSG02'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2019-09-20 11:29:56,484 [1] DEBUG - Statement Id: [DAO00008_GetUserSettings] PreparedStatement : [select A.*, B.TENKHO , C.TENPHONGBAN, B.MAKHO, C.MAPHONGBAN          from TM_SYS_USERS A          left join TM_KHODUOC B on B.KHODUOC_ID = A.INVENTORY_ID          left join TM_PHONGBAN C on (C.PHONGBAN_ID = A.WORKING_DEPT_ID and C.BENHVIEN_ID =  @param0 )          left join TM_SYS_USERKHO D on (D.ACCOUNT_ID = A.ACCOUNT_ID and D.HOSPITAL_ID =  @param0 )          where          A.HOSPITAL_ID =  @param0            and                 A.ACCOUNT_ID =  @param1]
2019-09-20 11:29:56,486 [1] DEBUG - Statement Id: [DAO00008_GetUserSettings] Parameters: [@param0=[HOSPITAL_ID,HLU01], @param1=[ACCOUNT_ID,113]]
2019-09-20 11:29:56,486 [1] DEBUG - Statement Id: [DAO00008_GetUserSettings] Types: [@param0=[String, System.String], @param1=[String, System.String]]
2019-09-20 11:29:56,518 [1] DEBUG - Statement Id: [DAO00008_GetUserInvSettings] PreparedStatement : [select A.*, B.TENKHO, B.MAKHO, B.LOAIKHO_ID, B.KHOQUANLY_ID          from TM_SYS_USERKHO A          left join TM_KHO B on B.MODULE_ID = A.MODULE_ID and B.KHO_ID = A.KHO_ID          where A.HOSPITAL_ID =  @param0  and A.ACCOUNT_ID =  @param1           order by B.TENKHO]
2019-09-20 11:29:56,518 [1] DEBUG - Statement Id: [DAO00008_GetUserInvSettings] Parameters: [@param0=[HOSPITAL_ID,HLU01], @param1=[ACCOUNT_ID,113]]
2019-09-20 11:29:56,518 [1] DEBUG - Statement Id: [DAO00008_GetUserInvSettings] Types: [@param0=[String, System.String], @param1=[String, System.String]]
2019-09-20 11:29:56,655 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'COM30'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2019-09-20 11:29:56,802 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'RIS04'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2019-09-20 11:30:04,741 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'MENU1'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2019-09-20 11:30:04,945 [1] DEBUG - Statement Id: [DAO00011_GetList] PreparedStatement : [select              TM_SYS_MENU.ID,              TM_SYS_MENU.PARENTID,              TM_SYS_MENU.SCREEN,              TM_SYS_MENU.SMALLIMAGE,              TM_SYS_MENU.LARGEIMAGE,              TM_SYS_MENU.DESCRIPTION,              TM_SYS_MENU.TYPE,              TM_SYS_MENU.TITLE_VI as TITLE              from TM_SYS_MENU              where TM_SYS_MENU.HOSPITAL_ID = 'HLU01' and TM_SYS_MENU.ACTIVE = '1'               AND                   (TM_SYS_MENU.TYPE & '8' = '8')                             order by TM_SYS_MENU.ORDERNUM]
2019-09-20 11:30:05,199 [1] DEBUG - Statement Id: [DAO00011_usermenu_list] PreparedStatement : [select              TM_SYS_HOMEMENU.MENUID as ID,              TM_SYS_MENU.TITLE_VI as TITLE,              TM_SYS_MENU.SCREEN,              TM_SYS_MENU.SMALLIMAGE,              TM_SYS_MENU.LARGEIMAGE,              TM_SYS_MENU.TYPE              from TM_SYS_HOMEMENU              left join TM_SYS_MENU on TM_SYS_MENU.ID = TM_SYS_HOMEMENU.MENUID and TM_SYS_MENU.HOSPITAL_ID = TM_SYS_HOMEMENU.HOSPITAL_ID              where TM_SYS_HOMEMENU.HOSPITAL_ID = 'HLU01' and TM_SYS_HOMEMENU.USERID = '113' and TM_SYS_MENU.ACTIVE = '1'               AND                   (TM_SYS_MENU.TYPE & '8' = '8')                             ORDER BY TM_SYS_HOMEMENU.ORDERNUM]
2019-09-20 11:30:13,789 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'COM31'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2019-09-20 11:30:13,950 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'ORM28'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2019-09-20 11:30:18,704 [1] DEBUG - Statement Id: [DAO00066_GetBENHAN_TIEPNHAN] PreparedStatement : [select top 1 *        from TT_NOITRU_BENHAN        where TIEPNHAN_ID = '27022'  and BENHVIEN_ID = 'HLU01'        order by NGAYTAO desc]
2019-09-20 11:30:20,590 [1] DEBUG - Statement Id: [DAO00014_GetInPatientStatus] PreparedStatement : [select TRANGTHAI, isnull(KHOACHUYENDEN_ID, KHOAVAO_ID) as KHOAHIENTAI from TT_NOITRU_BENHAN        where        TIEPNHAN_ID = '27022'        and BENHVIEN_ID = 'HLU01'         and           BENHAN_ID = '5800']
2019-09-20 11:30:20,689 [1] DEBUG - Statement Id: [DAO00048_TT_PHAUTHUAT_GetList] PreparedStatement : [select *              from TT_PHAUTHUAT               where                             TT_PHAUTHUAT.LOAI = 'P'                       and                           TT_PHAUTHUAT.TIEPNHAN_ID = 27022                       and                           TT_PHAUTHUAT.BENHVIEN_ID = 'HLU01'                                     order by PHAUTHUAT_ID DESC]
2019-09-20 11:30:20,742 [1] DEBUG - Statement Id: [DAO00048_GetListLoaiGacTrongPTTT] PreparedStatement : [select DICTIONARY_ID, DICTIONARY_CODE, DICTIONARY_NAME          from LST_DICTIONARY          where DICTIONARY_TYPE_CODE = 'LoaiGacPTTT'          and ENABLED = '1']
2019-09-20 11:30:27,802 [1] DEBUG - Statement Id: [DAO00048_GetDSLoaiGacDaGhiNhan] PreparedStatement : [select A.KIEMSOATGAC_ID, A.BENHNHAN_ID, A.TIEPNHAN_ID, A.BENHAN_ID, A.PHAUTHUAT_ID, A.LOAIPT_TT, A.LOAIGAC_ID          , A.NGAYGHINHAN, A.THOIGIANGHINHAN, A.SOLUONG, A.SOLUONGDASUDUNG, A.SOLUONGCONLAI, A.GHICHU, A.NGUOINHANDUNGCU_ID          , B.DICTIONARY_CODE AS MALOAIGAC, B.DICTIONARY_NAME AS TENLOAIGAC          from TT_PHAUTHUAT_GHINHANGAC A          inner join LST_DICTIONARY B on B.DICTIONARY_ID = A.LOAIGAC_ID          where A.PHAUTHUAT_ID = 3742 and A.BENHVIEN_ID = 'HLU01']
2019-09-20 11:30:35,727 [1] DEBUG - Statement Id: [DAO00048_GetDSLoaiGacDaGhiNhan] PreparedStatement : [select A.KIEMSOATGAC_ID, A.BENHNHAN_ID, A.TIEPNHAN_ID, A.BENHAN_ID, A.PHAUTHUAT_ID, A.LOAIPT_TT, A.LOAIGAC_ID          , A.NGAYGHINHAN, A.THOIGIANGHINHAN, A.SOLUONG, A.SOLUONGDASUDUNG, A.SOLUONGCONLAI, A.GHICHU, A.NGUOINHANDUNGCU_ID          , B.DICTIONARY_CODE AS MALOAIGAC, B.DICTIONARY_NAME AS TENLOAIGAC          from TT_PHAUTHUAT_GHINHANGAC A          inner join LST_DICTIONARY B on B.DICTIONARY_ID = A.LOAIGAC_ID          where A.PHAUTHUAT_ID = 3742 and A.BENHVIEN_ID = 'HLU01']
2019-09-20 11:31:21,132 [1] DEBUG - Statement Id: [DAO00048_TT_PHAUTHUAT_GHINHANGAC_Add] PreparedStatement : [insert into TT_PHAUTHUAT_GHINHANGAC (          BENHNHAN_ID          , TIEPNHAN_ID          , BENHAN_ID          , PHAUTHUAT_ID          , LOAIPT_TT          , LOAIGAC_ID          , NGAYGHINHAN          , THOIGIANGHINHAN          , SOLUONG          , SOLUONGDASUDUNG          , SOLUONGCONLAI          , GHICHU          , NGUOINHANDUNGCU_ID          , BENHVIEN_ID          , NGUOITAO          , NGAYTAO            ) values (           @param0           ,  @param1           ,  @param2           ,  @param3           ,  @param4           ,  @param5           ,  @param6           ,  @param7           ,  @param8           ,  @param9           ,  @param10           ,  @param11           ,  @param12           ,  @param13           ,  @param14           ,  @param15           )          SELECT SCOPE_IDENTITY()]
2019-09-20 11:31:21,132 [1] DEBUG - Statement Id: [DAO00048_TT_PHAUTHUAT_GHINHANGAC_Add] Parameters: [@param0=[BENHNHAN_ID,23075], @param1=[TIEPNHAN_ID,27022], @param2=[BENHAN_ID,5800], @param3=[PHAUTHUAT_ID,3742], @param4=[LOAIPT_TT,P], @param5=[LOAIGAC_ID,11713], @param6=[NGAYGHINHAN,9/20/2019 12:00:00 AM], @param7=[THOIGIANGHINHAN,9/20/2019 11:31:18 AM], @param8=[SOLUONG,10], @param9=[SOLUONGDASUDUNG,8], @param10=[SOLUONGCONLAI,2], @param11=[GHICHU,test 1], @param12=[NGUOINHANDUNGCU_ID,35], @param13=[BENHVIEN_ID,HLU01], @param14=[NGUOITAO,null], @param15=[NGAYTAO,9/20/2019 11:31:21 AM]]
2019-09-20 11:31:21,133 [1] DEBUG - Statement Id: [DAO00048_TT_PHAUTHUAT_GHINHANGAC_Add] Types: [@param0=[Int64, System.Int64], @param1=[Int64, System.Int64], @param2=[Int64, System.Int64], @param3=[Int64, System.Int64], @param4=[String, System.String], @param5=[Int64, System.Int64], @param6=[DateTime, System.DateTime], @param7=[DateTime, System.DateTime], @param8=[Double, System.Double], @param9=[Double, System.Double], @param10=[Double, System.Double], @param11=[String, System.String], @param12=[Int64, System.Int64], @param13=[String, System.String], @param14=[System.DBNull, null], @param15=[DateTime, System.DateTime]]
2019-09-20 11:31:29,721 [1] DEBUG - Statement Id: [DAO00048_TT_PHAUTHUAT_GHINHANGAC_Add] PreparedStatement : [insert into TT_PHAUTHUAT_GHINHANGAC (          BENHNHAN_ID          , TIEPNHAN_ID          , BENHAN_ID          , PHAUTHUAT_ID          , LOAIPT_TT          , LOAIGAC_ID          , NGAYGHINHAN          , THOIGIANGHINHAN          , SOLUONG          , SOLUONGDASUDUNG          , SOLUONGCONLAI          , GHICHU          , NGUOINHANDUNGCU_ID          , BENHVIEN_ID          , NGUOITAO          , NGAYTAO            ) values (           @param0           ,  @param1           ,  @param2           ,  @param3           ,  @param4           ,  @param5           ,  @param6           ,  @param7           ,  @param8           ,  @param9           ,  @param10           ,  @param11           ,  @param12           ,  @param13           ,  @param14           ,  @param15           )          SELECT SCOPE_IDENTITY()]
2019-09-20 11:31:29,721 [1] DEBUG - Statement Id: [DAO00048_TT_PHAUTHUAT_GHINHANGAC_Add] Parameters: [@param0=[BENHNHAN_ID,23075], @param1=[TIEPNHAN_ID,27022], @param2=[BENHAN_ID,5800], @param3=[PHAUTHUAT_ID,3742], @param4=[LOAIPT_TT,P], @param5=[LOAIGAC_ID,11714], @param6=[NGAYGHINHAN,9/20/2019 12:00:00 AM], @param7=[THOIGIANGHINHAN,9/20/2019 11:31:28 AM], @param8=[SOLUONG,10], @param9=[SOLUONGDASUDUNG,5], @param10=[SOLUONGCONLAI,5], @param11=[GHICHU,test], @param12=[NGUOINHANDUNGCU_ID,35], @param13=[BENHVIEN_ID,HLU01], @param14=[NGUOITAO,null], @param15=[NGAYTAO,9/20/2019 11:31:29 AM]]
2019-09-20 11:31:29,721 [1] DEBUG - Statement Id: [DAO00048_TT_PHAUTHUAT_GHINHANGAC_Add] Types: [@param0=[Int64, System.Int64], @param1=[Int64, System.Int64], @param2=[Int64, System.Int64], @param3=[Int64, System.Int64], @param4=[String, System.String], @param5=[Int64, System.Int64], @param6=[DateTime, System.DateTime], @param7=[DateTime, System.DateTime], @param8=[Double, System.Double], @param9=[Double, System.Double], @param10=[Double, System.Double], @param11=[String, System.String], @param12=[Int64, System.Int64], @param13=[String, System.String], @param14=[System.DBNull, null], @param15=[DateTime, System.DateTime]]
2019-09-20 11:31:37,441 [1] DEBUG - Statement Id: [DAO00048_GetDSLoaiGacDaGhiNhan] PreparedStatement : [select A.KIEMSOATGAC_ID, A.BENHNHAN_ID, A.TIEPNHAN_ID, A.BENHAN_ID, A.PHAUTHUAT_ID, A.LOAIPT_TT, A.LOAIGAC_ID          , A.NGAYGHINHAN, A.THOIGIANGHINHAN, A.SOLUONG, A.SOLUONGDASUDUNG, A.SOLUONGCONLAI, A.GHICHU, A.NGUOINHANDUNGCU_ID          , B.DICTIONARY_CODE AS MALOAIGAC, B.DICTIONARY_NAME AS TENLOAIGAC          from TT_PHAUTHUAT_GHINHANGAC A          inner join LST_DICTIONARY B on B.DICTIONARY_ID = A.LOAIGAC_ID          where A.PHAUTHUAT_ID = 3742 and A.BENHVIEN_ID = 'HLU01']
2019-09-20 11:31:53,067 [1] DEBUG - Statement Id: [DAO00066_GetBENHAN_TIEPNHAN] PreparedStatement : [select top 1 *        from TT_NOITRU_BENHAN        where TIEPNHAN_ID = '27022'  and BENHVIEN_ID = 'HLU01'        order by NGAYTAO desc]
2019-09-20 11:31:53,166 [1] DEBUG - Statement Id: [DAO00014_GetInPatientStatus] PreparedStatement : [select TRANGTHAI, isnull(KHOACHUYENDEN_ID, KHOAVAO_ID) as KHOAHIENTAI from TT_NOITRU_BENHAN        where        TIEPNHAN_ID = '27022'        and BENHVIEN_ID = 'HLU01'         and           BENHAN_ID = '5800']
2019-09-20 11:31:53,278 [1] DEBUG - Statement Id: [DAO00048_TT_PHAUTHUAT_GetList] PreparedStatement : [select *              from TT_PHAUTHUAT               where                             TT_PHAUTHUAT.LOAI = 'P'                       and                           TT_PHAUTHUAT.TIEPNHAN_ID = 27022                       and                           TT_PHAUTHUAT.BENHVIEN_ID = 'HLU01'                                     order by PHAUTHUAT_ID DESC]
2019-09-20 11:31:53,328 [1] DEBUG - Statement Id: [DAO00048_GetListLoaiGacTrongPTTT] PreparedStatement : [select DICTIONARY_ID, DICTIONARY_CODE, DICTIONARY_NAME          from LST_DICTIONARY          where DICTIONARY_TYPE_CODE = 'LoaiGacPTTT'          and ENABLED = '1']
2019-09-20 11:33:33,949 [1] DEBUG - Statement Id: [DAO00048_GetDSLoaiGacDaGhiNhan] PreparedStatement : [select A.KIEMSOATGAC_ID, A.BENHNHAN_ID, A.TIEPNHAN_ID, A.BENHAN_ID, A.PHAUTHUAT_ID, A.LOAIPT_TT, A.LOAIGAC_ID          , A.NGAYGHINHAN, A.THOIGIANGHINHAN, A.SOLUONG, A.SOLUONGDASUDUNG, A.SOLUONGCONLAI, A.GHICHU, A.NGUOINHANDUNGCU_ID          , B.DICTIONARY_CODE AS MALOAIGAC, B.DICTIONARY_NAME AS TENLOAIGAC          from TT_PHAUTHUAT_GHINHANGAC A          inner join LST_DICTIONARY B on B.DICTIONARY_ID = A.LOAIGAC_ID          where A.PHAUTHUAT_ID = 3742 and A.BENHVIEN_ID = 'HLU01']
2019-09-20 11:34:54,538 [1] DEBUG - Statement Id: [DAO00048_GetDSLoaiGacDaGhiNhan] PreparedStatement : [select A.KIEMSOATGAC_ID, A.BENHNHAN_ID, A.TIEPNHAN_ID, A.BENHAN_ID, A.PHAUTHUAT_ID, A.LOAIPT_TT, A.LOAIGAC_ID          , A.NGAYGHINHAN, A.THOIGIANGHINHAN, A.SOLUONG, A.SOLUONGDASUDUNG, A.SOLUONGCONLAI, A.GHICHU, A.NGUOINHANDUNGCU_ID          , B.DICTIONARY_CODE AS MALOAIGAC, B.DICTIONARY_NAME AS TENLOAIGAC          from TT_PHAUTHUAT_GHINHANGAC A          inner join LST_DICTIONARY B on B.DICTIONARY_ID = A.LOAIGAC_ID          where A.PHAUTHUAT_ID = 3742 and A.BENHVIEN_ID = 'HLU01']
2019-09-20 11:35:16,437 [1] DEBUG - Statement Id: [DAO00048_GetDSLoaiGacDaGhiNhan] PreparedStatement : [select A.KIEMSOATGAC_ID, A.BENHNHAN_ID, A.TIEPNHAN_ID, A.BENHAN_ID, A.PHAUTHUAT_ID, A.LOAIPT_TT, A.LOAIGAC_ID          , A.NGAYGHINHAN, A.THOIGIANGHINHAN, A.SOLUONG, A.SOLUONGDASUDUNG, A.SOLUONGCONLAI, A.GHICHU, A.NGUOINHANDUNGCU_ID          , B.DICTIONARY_CODE AS MALOAIGAC, B.DICTIONARY_NAME AS TENLOAIGAC          from TT_PHAUTHUAT_GHINHANGAC A          inner join LST_DICTIONARY B on B.DICTIONARY_ID = A.LOAIGAC_ID          where A.PHAUTHUAT_ID = 3742 and A.BENHVIEN_ID = 'HLU01']
--------------------------------------------------------------------------------
2019-09-20 11:38:17,764 [1] DEBUG - Statement Id: [DAO00001_DBList] PreparedStatement : [select *              from TM_SYS_SERVER              where HOSPITAL_ID = '_SYSTEM_' and TYPE = 'D']
2019-09-20 11:38:18,071 [1] DEBUG - Statement Id: [DAO00001_DaoList] PreparedStatement : [select              TM_SYS_SERVICEMAP.ID,              TM_SYS_SERVICEMAP.HOSPITAL_ID,              TM_SYS_SERVICEMAP.DB_NAME,              TM_SYS_SERVICEMAP.TYPE,              TM_SYS_SERVICEMAP.NAME,              TM_SYS_SERVICEMAP.CLASS,              (TM_SYS_DIC.VALUE + '.' + TM_SYS_SERVICEMAP.CLASS) as CLASSFULL,              TM_SYS_SERVICEMAP.ASSEMBLY              from TM_SYS_SERVICEMAP              inner join TM_SYS_DIC              on TM_SYS_SERVICEMAP.NAMESPACE = TM_SYS_DIC.ID              where HOSPITAL_ID = '_SYSTEM_' AND TYPE = 'D' AND ACTIVE = '1'              order by DB_NAME]
2019-09-20 11:38:18,115 [1] DEBUG - Statement Id: [DAO00001_ServiceList] PreparedStatement : [select              TM_SYS_SERVICEMAP.ID,              TM_SYS_SERVICEMAP.HOSPITAL_ID,              TM_SYS_SERVICEMAP.DB_NAME,              TM_SYS_SERVICEMAP.TYPE,              TM_SYS_SERVICEMAP.NAME,              TM_SYS_SERVICEMAP.CLASS,              (TM_SYS_DIC.VALUE + '.' + TM_SYS_SERVICEMAP.CLASS) as CLASSFULL,              TM_SYS_SERVICEMAP.ASSEMBLY,              TM_SYS_SERVER.URL              from TM_SYS_SERVICEMAP              inner join TM_SYS_DIC on TM_SYS_SERVICEMAP.NAMESPACE = TM_SYS_DIC.ID              inner join TM_SYS_SERVER on (TM_SYS_SERVICEMAP.DB_NAME = TM_SYS_SERVER.NAME) and (TM_SYS_SERVER.HOSPITAL_ID = '_SYSTEM_')              where TM_SYS_SERVICEMAP.HOSPITAL_ID = '_SYSTEM_' AND TM_SYS_SERVICEMAP.TYPE = 'S'  AND ACTIVE = '1'              order by URL]
2019-09-20 11:38:18,509 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = '_SYSTEM_'               AND                   TM_SYS_SCREEN.PAGE = 'LOGIN'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2019-09-20 11:38:18,734 [1] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = '_SYSTEM_'               AND                   TM_SYS_CACHE.ACTIVE = '1']
2019-09-20 11:38:23,317 [1] DEBUG - Statement Id: [DAO00001_DBList] PreparedStatement : [select *              from TM_SYS_SERVER              where HOSPITAL_ID = 'HLU01' and TYPE = 'D']
2019-09-20 11:38:23,363 [1] DEBUG - Statement Id: [DAO00001_DaoList] PreparedStatement : [select              TM_SYS_SERVICEMAP.ID,              TM_SYS_SERVICEMAP.HOSPITAL_ID,              TM_SYS_SERVICEMAP.DB_NAME,              TM_SYS_SERVICEMAP.TYPE,              TM_SYS_SERVICEMAP.NAME,              TM_SYS_SERVICEMAP.CLASS,              (TM_SYS_DIC.VALUE + '.' + TM_SYS_SERVICEMAP.CLASS) as CLASSFULL,              TM_SYS_SERVICEMAP.ASSEMBLY              from TM_SYS_SERVICEMAP              inner join TM_SYS_DIC              on TM_SYS_SERVICEMAP.NAMESPACE = TM_SYS_DIC.ID              where HOSPITAL_ID = 'HLU01' AND TYPE = 'D' AND ACTIVE = '1'              order by DB_NAME]
2019-09-20 11:38:25,148 [1] DEBUG - Statement Id: [DAO00001_ServiceList] PreparedStatement : [select              TM_SYS_SERVICEMAP.ID,              TM_SYS_SERVICEMAP.HOSPITAL_ID,              TM_SYS_SERVICEMAP.DB_NAME,              TM_SYS_SERVICEMAP.TYPE,              TM_SYS_SERVICEMAP.NAME,              TM_SYS_SERVICEMAP.CLASS,              (TM_SYS_DIC.VALUE + '.' + TM_SYS_SERVICEMAP.CLASS) as CLASSFULL,              TM_SYS_SERVICEMAP.ASSEMBLY,              TM_SYS_SERVER.URL              from TM_SYS_SERVICEMAP              inner join TM_SYS_DIC on TM_SYS_SERVICEMAP.NAMESPACE = TM_SYS_DIC.ID              inner join TM_SYS_SERVER on (TM_SYS_SERVICEMAP.DB_NAME = TM_SYS_SERVER.NAME) and (TM_SYS_SERVER.HOSPITAL_ID = 'HLU01')              where TM_SYS_SERVICEMAP.HOSPITAL_ID = 'HLU01' AND TM_SYS_SERVICEMAP.TYPE = 'S'  AND ACTIVE = '1'              order by URL]
2019-09-20 11:38:25,233 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1']
2019-09-20 11:38:27,018 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM005']
2019-09-20 11:38:27,156 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM015']
2019-09-20 11:38:27,263 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM067']
2019-09-20 11:38:27,345 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM008']
2019-09-20 11:38:27,427 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM068']
2019-09-20 11:38:27,515 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM006']
2019-09-20 11:38:27,592 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM030']
2019-09-20 11:38:27,676 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM025']
2019-09-20 11:38:27,758 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM024']
2019-09-20 11:38:28,342 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM033']
2019-09-20 11:38:28,383 [5] DEBUG - Statement Id: [DAO00027_GetListDuocKyGuiTonKho] PreparedStatement : [select  distinct TT_TONKHO.DUOC_KEY, LTRIM(TT_TONKHO.KHODUOC_ID) as KHODUOC_ID, TM_DUOC.DUOC_ID, TM_LOAIDUOC.MALOAIDUOC,TM_DUOC.SOVISA,TM_DUOC.TYLE_VAT,TM_DUOC.COTOA,        TM_DUOC.MADUOC, TM_DUOC.TENHANG, TM_DUOC.TENDUOCDAYDU, dvt.TENDONVITINH as DONVITINH,  TM_DUOC.DONVITINH_ID,TM_DUOC.BHYT,TM_DUOC.PHAMVI,        TM_DUOC.TENHOATCHAT, TM_DUOC.HAMLUONG, TM_DUOC.HANGSANXUAT, TM_DUOC.QUOCGIA, TM_DUOC.LOAIDUOC_ID, TM_DUOC.DUONGDUNG_ID,        TM_TENDUOC.TENDUOC, TM_TENDUOC.TENDUOC_EN, TM_TENDUOC.MAQUOCTE, TM_TENDUOC.MAQUOCTEBT,        TM_LOAIDUOC.LOAIVATTU_ID, TM_DUOC.BENHVIEN_ID,TT_TONKHO.SOLUONG, TT_TONKHO.NGUONDUOC_ID, NH.TENNGUONDUOC        , TAMNGUNG = CASE WHEN TM_DUOC.TAMNGUNG = '1' OR nh.TAMNGUNG = '1' OR KD.TAMNGUNG = '1' THEN '1' ELSE '0' END        , TM_DUOC.DANGTRINHBAY        from TM_DUOC        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = TM_DUOC.DONVITINH_ID        left join TM_TENDUOC on TM_DUOC.TENDUOC_ID = TM_TENDUOC.TENDUOC_ID and TM_DUOC.BENHVIEN_ID = 'HLU01' and TM_DUOC.TAMNGUNG = '0'        left join TM_LOAIDUOC on TM_LOAIDUOC.LOAIDUOC_ID = TM_DUOC.LOAIDUOC_ID and TM_LOAIDUOC.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG on (TM_LOAIDUOC.LOAIVATTU_ID = TM_DUOC_HANDUNG.LOAIDUOC and TM_DUOC_HANDUNG.BENHVIEN_ID = 'HLU01')        inner join        (select LTRIM(A.KHODUOC_ID) + '_' + LTRIM(A.DUOC_ID) + '_' + LTRIM(ISNULL(A.NGUONDUOC_ID,'')) as DUOC_KEY, A.KHODUOC_ID, A.DUOC_ID,A.NGUONDUOC_ID,        SUM(isnull(A.SOLUONG,0)) as SOLUONG        from        (select SUM(SOLUONG) as SOLUONG, KHODUOC_ID, DUOC_ID, NGUONDUOC_ID from TT_DUOC_KYGUI_TONKHO        where BENHVIEN_ID = 'HLU01' group by KHODUOC_ID, DUOC_ID, NGUONDUOC_ID) A        group by LTRIM(A.KHODUOC_ID) + '_' + LTRIM(A.DUOC_ID) + '_' + LTRIM(A.NGUONDUOC_ID), A.KHODUOC_ID, A.DUOC_ID, A.NGUONDUOC_ID)        TT_TONKHO on TT_TONKHO.DUOC_ID = TM_DUOC.DUOC_ID        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = TT_TONKHO.NGUONDUOC_ID and nh.BENHVIEN_ID = 'HLU01'        LEFT JOIN TM_KHODUOC KD ON KD.KHODUOC_ID = TT_TONKHO.KHODUOC_ID        where TM_DUOC.BENHVIEN_ID = 'HLU01' AND TT_TONKHO.SOLUONG >= 0]
2019-09-20 11:38:28,457 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM018']
2019-09-20 11:38:28,592 [5] DEBUG - Statement Id: [DAO00027_GetListDuocTonKho] PreparedStatement : [select distinct TT_TONKHO.DUOC_KEY, LTRIM(TT_TONKHO.KHODUOC_ID) as KHODUOC_ID, TM_DUOC.DUOC_ID, TM_LOAIDUOC.MALOAIDUOC,TM_DUOC.SOVISA,TM_DUOC.TYLE_VAT,TM_DUOC.COTOA,        TM_DUOC.MADUOC, TM_DUOC.TENHANG, TM_DUOC.TENDUOCDAYDU, dvt.TENDONVITINH as DONVITINH,  TM_DUOC.DONVITINH_ID,TM_DUOC.BHYT,                TM_DUOC.TENHOATCHAT,          TM_DUOC.HAMLUONG, TM_DUOC.HANGSANXUAT, TM_DUOC.QUOCGIA, TM_DUOC.LOAIDUOC_ID, TM_DUOC.DUONGDUNG_ID,        TM_TENDUOC.TENDUOC, TM_TENDUOC.TENDUOC_EN, TM_TENDUOC.MAQUOCTE, TM_TENDUOC.MAQUOCTEBT,        TM_LOAIDUOC.LOAIVATTU_ID, TM_DUOC.BENHVIEN_ID,        TT_TONKHO.SOLUONG, TM_DUOC.VTYT_PHANLOAI, TM_DUOC.PHAMVI, TT_TONKHO.NGUONDUOC_ID, NG.TENNGUONDUOC AS TENNGUONDUOC        , TAMNGUNG = CASE WHEN TM_DUOC.TAMNGUNG = '1' OR NG.TAMNGUNG = '1' OR KD.TAMNGUNG = '1' THEN '1' ELSE '0' END        , TM_DUOC.DANGTRINHBAY        from TM_DUOC        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = TM_DUOC.DONVITINH_ID        left join TM_TENDUOC on TM_DUOC.TENDUOC_ID = TM_TENDUOC.TENDUOC_ID and TM_DUOC.BENHVIEN_ID = 'HLU01' and TM_DUOC.TAMNGUNG = '0'        left join TM_LOAIDUOC on TM_LOAIDUOC.LOAIDUOC_ID = TM_DUOC.LOAIDUOC_ID and TM_LOAIDUOC.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG on (TM_LOAIDUOC.LOAIVATTU_ID = TM_DUOC_HANDUNG.LOAIDUOC and TM_DUOC_HANDUNG.BENHVIEN_ID = 'HLU01')        inner join        (select LTRIM(A.KHODUOC_ID) + '_' + LTRIM(A.DUOC_ID) + '_' + LTRIM(ISNULL(A.NGUONDUOC_ID,'')) as DUOC_KEY, A.KHODUOC_ID, A.DUOC_ID, A.NGUONDUOC_ID,        SUM(isnull(A.SOLUONG,0)) as SOLUONG        from        (select SUM(SOLUONG) as SOLUONG, KHODUOC_ID, DUOC_ID, NGUONDUOC_ID from TT_DUOC_TONKHO        where BENHVIEN_ID = 'HLU01' group by KHODUOC_ID, DUOC_ID, NGUONDUOC_ID) A        group by LTRIM(A.KHODUOC_ID) + '_' + LTRIM(A.DUOC_ID) + '_' + LTRIM(ISNULL(A.NGUONDUOC_ID,'')), A.KHODUOC_ID, A.DUOC_ID, NGUONDUOC_ID        ) TT_TONKHO on TT_TONKHO.DUOC_ID = TM_DUOC.DUOC_ID        LEFT JOIN TM_NGUONHANG NG ON NG.NGUONDUOC_ID = TT_TONKHO.NGUONDUOC_ID        LEFT JOIN TM_KHODUOC KD ON KD.KHODUOC_ID = TT_TONKHO.KHODUOC_ID        where TM_DUOC.BENHVIEN_ID = 'HLU01' and TT_TONKHO.SOLUONG >= 0]
2019-09-20 11:38:31,530 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM023']
2019-09-20 11:38:31,567 [5] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoVaBooking] PreparedStatement : [declare @NGUONDUOC_MACDINH varchar(5) = '0';        declare @TOAMUANGOAI int = 0;        select @NGUONDUOC_MACDINH = isnull(VALUE,0) from TM_SYS_APPSETTINGS where CODE = 'PHA_NGUONDUOC'        select @TOAMUANGOAI = isnull(VALUE,0) from TM_SYS_APPSETTINGS where CODE = 'OPD_TOAMUANGOAI_DUNGDANHMUC_DUOC'                if @TOAMUANGOAI = 1        begin        select  distinct '0' + '_' + LTRIM(d.DUOC_ID) + '_' + @NGUONDUOC_MACDINH as DUOC_KEY, 0 as PHAMVI_ID, @NGUONDUOC_MACDINH as NGUONDUOC_ID, null as TENNGUONDUOC, null as TINHTIEN, d.DUOC_ID, ld.MALOAIDUOC,        d.SOVISA,d.TYLE_VAT,d.COTOA, d.MADUOC, d.TENHANG, d.TENDUOCDAYDU, d.DONVITINH as DONVITINH, d.BHYT,        d.TENHOATCHAT, d.HAMLUONG, d.HANGSANXUAT, d.QUOCGIA, d.LOAIDUOC_ID, d.DUONGDUNG_ID, d.TINHTIEN_PTTT,        ten.TENDUOC, ten.TENDUOC_EN, ten.MAQUOCTE, ten.MAQUOCTEBT,        '' as BHYT_TEXT        , ld.LOAIVATTU_ID        , d.BENHVIEN_ID,        999999999 as SOLUONG, d.VTYT_PHANLOAI, d.PHAMVI, d.SUASOLUONGTONGHOP, d.MADUOCBV, d.DANGTRINHBAY        , TAMNGUNG = CASE WHEN d.TAMNGUNG = '1' THEN '1' ELSE '0' END        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        union all        select  distinct tk.DUOC_KEY, LTRIM(tk.PHAMVI_ID) as PHAMVI_ID, tk.NGUONDUOC_ID, nh.TENNGUONDUOC, nh.TINHTIEN, d.DUOC_ID, ld.MALOAIDUOC,        d.SOVISA,d.TYLE_VAT,d.COTOA, d.MADUOC, d.TENHANG, d.TENDUOCDAYDU, d.DONVITINH as DONVITINH, d.BHYT,        d.TENHOATCHAT, d.HAMLUONG, d.HANGSANXUAT, d.QUOCGIA, d.LOAIDUOC_ID, d.DUONGDUNG_ID, d.TINHTIEN_PTTT,        ten.TENDUOC, ten.TENDUOC_EN, ten.MAQUOCTE, ten.MAQUOCTEBT,        CASE WHEN d.BHYT = '1' THEN 'BHYT' ELSE '' END as BHYT_TEXT        , ld.LOAIVATTU_ID        , d.BENHVIEN_ID,        tk.SOLUONG, d.VTYT_PHANLOAI, d.PHAMVI, d.SUASOLUONGTONGHOP, d.MADUOCBV, d.DANGTRINHBAY        , TAMNGUNG = CASE WHEN d.TAMNGUNG = '1' OR nh.TAMNGUNG = '1' OR kd.TAMNGUNG = '1' THEN '1' ELSE '0' END        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        inner join        (        select  LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')) DUOC_KEY, (SUM(dtk.SOLUONG) - isnull(sum(A.SOLUONG),0) - isnull(sum(B.SOLUONG),0)) SOLUONG, pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        from (select sum(soluong) soluong,duoc_id,nguonduoc_id,khoduoc_id,benhvien_id from TT_DUOC_TONKHO  group by duoc_id,nguonduoc_id,khoduoc_id,benhvien_id) dtk        inner join TM_DUOC_PHAMVISD_MAPPING pvsd on dtk.KHODUOC_ID = pvsd.KHODUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NOITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) B on B.DUOC_ID = dtk.DUOC_ID and B.SOLUONG > 0 and B.PHAMVI_ID = pvsd.PHAMVI_ID and B.NGUONHANG_ID = dtk.NGUONDUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NGOAITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) A on A.DUOC_ID = dtk.DUOC_ID and A.SOLUONG > 0 and A.PHAMVI_ID = pvsd.PHAMVI_ID and A.NGUONHANG_ID = dtk.NGUONDUOC_ID        where dtk.SOLUONG > 0 and dtk.BENHVIEN_ID = 'HLU01'        group by LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')), pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        ) tk on tk.DUOC_ID = d.DUOC_ID        left join TM_DUOC_PHAMVISUDUNG kd on kd.PHAMVI_ID = tk.PHAMVI_ID and kd.BENHVIEN_ID = 'HLU01'        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = tk.NGUONDUOC_ID and nh.BENHVIEN_ID = 'HLU01'        where d.BENHVIEN_ID = 'HLU01'  and tk.SOLUONG >= 0        end        else        begin                  select  distinct tk.DUOC_KEY, LTRIM(tk.PHAMVI_ID) as PHAMVI_ID, tk.NGUONDUOC_ID, nh.TENNGUONDUOC, nh.TINHTIEN, d.DUOC_ID, ld.MALOAIDUOC,        d.SOVISA,d.TYLE_VAT,d.COTOA, d.MADUOC, d.TENHANG, d.TENDUOCDAYDU, d.DONVITINH as DONVITINH, d.BHYT,        d.TENHOATCHAT, d.HAMLUONG, d.HANGSANXUAT, d.QUOCGIA, d.LOAIDUOC_ID, d.DUONGDUNG_ID, d.TINHTIEN_PTTT,        ten.TENDUOC, ten.TENDUOC_EN, ten.MAQUOCTE, ten.MAQUOCTEBT,        CASE WHEN d.BHYT = '1' THEN 'BHYT' ELSE '' END as BHYT_TEXT        , ld.LOAIVATTU_ID        , d.BENHVIEN_ID,        tk.SOLUONG, d.VTYT_PHANLOAI, d.PHAMVI, d.SUASOLUONGTONGHOP, d.MADUOCBV, d.DANGTRINHBAY        , TAMNGUNG = CASE WHEN d.TAMNGUNG = '1' OR nh.TAMNGUNG = '1' OR kd.TAMNGUNG = '1' THEN '1' ELSE '0' END        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        inner join        (        select  LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')) DUOC_KEY, (SUM(dtk.SOLUONG) - isnull(sum(A.SOLUONG),0) - isnull(sum(B.SOLUONG),0)) SOLUONG, pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        from (select sum(soluong) soluong,duoc_id,nguonduoc_id,khoduoc_id,benhvien_id from TT_DUOC_TONKHO  group by duoc_id,nguonduoc_id,khoduoc_id,benhvien_id) dtk        inner join TM_DUOC_PHAMVISD_MAPPING pvsd on dtk.KHODUOC_ID = pvsd.KHODUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NOITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) B on B.DUOC_ID = dtk.DUOC_ID and B.SOLUONG > 0 and B.PHAMVI_ID = pvsd.PHAMVI_ID and B.NGUONHANG_ID = dtk.NGUONDUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NGOAITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) A on A.DUOC_ID = dtk.DUOC_ID and A.SOLUONG > 0 and A.PHAMVI_ID = pvsd.PHAMVI_ID and A.NGUONHANG_ID = dtk.NGUONDUOC_ID        where dtk.SOLUONG > 0 and dtk.BENHVIEN_ID = 'HLU01'        group by LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')), pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        ) tk on tk.DUOC_ID = d.DUOC_ID        left join TM_DUOC_PHAMVISUDUNG kd on kd.PHAMVI_ID = tk.PHAMVI_ID and kd.BENHVIEN_ID = 'HLU01'        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = tk.NGUONDUOC_ID and nh.BENHVIEN_ID = 'HLU01'        where d.BENHVIEN_ID = 'HLU01'  and tk.SOLUONG >= 0        end]
2019-09-20 11:38:34,350 [5] DEBUG - Statement Id: [DAO00320_GetList] PreparedStatement : [select M.*            from TM_MAU M            LEFT JOIN TM_MAU_DONVITINH DVT on M.DONVITINH_ID=DVT.DONVITINH_ID            where            M.TAMNGUNG = '0'            and M.BENHVIEN_ID = 'HLU01'            order by M.TENMAU]
2019-09-20 11:38:34,418 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM071']
2019-09-20 11:38:34,457 [5] DEBUG - Statement Id: [DAO00322_GetListMauTonKhoForCreateCached] PreparedStatement : [SELECT DISTINCT          TK.MAU_KEY, TK.KHOMAU_ID, M.MAU_ID, M.MAMAU, M.TENMAU, M.NHOM_ABO, M.NHOM_RH, M.LOAIMAU_ID,          TK.SOLONHAP_ID, SLN.SOLONHAP, SLN.SOKIEMSOAT, TK.NGUONHANG_ID, NG.TENNGUONMAU, M.BENHVIEN_ID, M.DONVITINH_ID,          SUM(tk.SOLUONG) AS SOLUONG,K.TENKHO,DVT.TENDONVITINH          FROM TT_MAU_TONKHO TK          JOIN TM_KHO K ON TK.KHOMAU_ID = K.KHO_ID          JOIN TT_MAU_CHUNGTU_SOLONHAP SLN ON TK.SOLONHAP_ID = SLN.SOLONHAP_ID          JOIN TM_MAU M on TK.MAU_ID = M.MAU_ID and M.TAMNGUNG = '0'          LEFT JOIN TM_MAU_DONVITINH DVT on M.DONVITINH_ID=DVT.DONVITINH_ID          LEFT JOIN TM_NGUONMAU NG ON NG.NGUONMAU_ID = TK.NGUONHANG_ID          WHERE TK.SOLUONG > 0          GROUP BY TK.MAU_KEY, TK.KHOMAU_ID, M.MAU_ID, M.MAMAU, M.TENMAU, M.NHOM_ABO, M.NHOM_RH, M.LOAIMAU_ID,          TK.SOLONHAP_ID, SLN.SOLONHAP, SLN.SOKIEMSOAT,TK.NGUONHANG_ID, NG.TENNGUONMAU, M.BENHVIEN_ID, M.DONVITINH_ID,K.TENKHO,DVT.TENDONVITINH]
2019-09-20 11:38:34,591 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM073']
2019-09-20 11:38:34,626 [5] DEBUG - Statement Id: [DAO00322_GetListMauTonKhoTruBooking] PreparedStatement : [select distinct          TK.MAU_KEY, TK.KHOMAU_ID, M.MAU_ID, M.MAMAU, M.TENMAU, M.NHOM_ABO, M.NHOM_RH, M.LOAIMAU_ID, M.DONVITINH_ID,          TK.SOLONHAP_ID, TK.SOLONHAP, TK.SOKIEMSOAT,M.PHAMVI, TK.NGUONHANG_ID, NG.TENNGUONMAU, M.BENHVIEN_ID,          TK.SOLUONG,TK.TENKHO,DVT.TENDONVITINH          from TM_MAU M          JOIN          (          select          A.MAU_KEY, A.KHOMAU_ID, A.MAU_ID ,a.NGUONHANG_ID, A.SOLONHAP_ID, A.SOLONHAP, A.SOKIEMSOAT, A.SOLUONG,A.TENKHO          from          (          select KHOMAU_ID, TK.MAU_ID, TK.NGUONHANG_ID, TK.MAU_KEY, SLN.SOLONHAP_ID, SLN.SOLONHAP, SLN.SOKIEMSOAT, ISNULL(TK.SOLUONG,0) - ISNULL(book.SOLUONG,0) as SOLUONG,K.TENKHO          from TT_MAU_TONKHO TK          JOIN TM_KHO K ON TK.KHOMAU_ID = K.KHO_ID          inner join TT_MAU_CHUNGTU_SOLONHAP SLN ON TK.SOLONHAP_ID = SLN.SOLONHAP_ID          left join dbo.TT_MAU_TONKHO_BOOK book ON book.MAU_KEY = TK.MAU_KEY AND book.TRANGTHAI = 'HIEULUC'          where ISNULL(TK.SOLUONG,0) - ISNULL(book.SOLUONG,0) > 0          ) A          )TK on TK.MAU_ID = M.MAU_ID and M.TAMNGUNG = '0'          LEFT JOIN TM_MAU_DONVITINH DVT on M.DONVITINH_ID=DVT.DONVITINH_ID          LEFT JOIN TM_NGUONMAU NG ON NG.NGUONMAU_ID = TK.NGUONHANG_ID]
2019-09-20 11:38:34,752 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM072']
2019-09-20 11:38:35,710 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'MAIN'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2019-09-20 11:38:36,967 [1] DEBUG - Statement Id: [DAO00002_FormList] PreparedStatement : [select              TM_SYS_FORM.HOSPITAL_ID,              TM_SYS_FORM.NAME,              TM_SYS_FORM.CLASS,              TM_SYS_FORM.ASSEMBLY,              TM_SYS_FORM.TITLE_VI as TITLE              from TM_SYS_FORM              where HOSPITAL_ID = 'HLU01']
2019-09-20 11:38:41,996 [1] DEBUG - Statement Id: [DAO00300_GetShortcutListByUserID] PreparedStatement : [SELECT S.SHORTCUT_CODE, S.SHORTCUT_VALUE              FROM TM_SHORTCUT AS S              WHERE S.BENHVIEN_ID = 'HLU01' AND S.USER_ID = '1' AND TAMNGUNG = '0']
2019-09-20 11:38:42,029 [1] DEBUG - Statement Id: [DAO00087_GetList] PreparedStatement : [select CODE, VALUE, BENHVIEN_ID              from TM_SYS_APPSETTINGS              where LOCKED = '0' and BENHVIEN_ID = 'HLU01'              order by SETTING_ID]
2019-09-20 11:38:42,111 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'MSG01'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2019-09-20 11:38:42,230 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'MSG02'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2019-09-20 11:38:42,369 [1] DEBUG - Statement Id: [DAO00008_GetUserSettings] PreparedStatement : [select A.*, B.TENKHO , C.TENPHONGBAN, B.MAKHO, C.MAPHONGBAN          from TM_SYS_USERS A          left join TM_KHODUOC B on B.KHODUOC_ID = A.INVENTORY_ID          left join TM_PHONGBAN C on (C.PHONGBAN_ID = A.WORKING_DEPT_ID and C.BENHVIEN_ID =  @param0 )          left join TM_SYS_USERKHO D on (D.ACCOUNT_ID = A.ACCOUNT_ID and D.HOSPITAL_ID =  @param0 )          where          A.HOSPITAL_ID =  @param0            and                 A.ACCOUNT_ID =  @param1]
2019-09-20 11:38:42,372 [1] DEBUG - Statement Id: [DAO00008_GetUserSettings] Parameters: [@param0=[HOSPITAL_ID,HLU01], @param1=[ACCOUNT_ID,113]]
2019-09-20 11:38:42,372 [1] DEBUG - Statement Id: [DAO00008_GetUserSettings] Types: [@param0=[String, System.String], @param1=[String, System.String]]
2019-09-20 11:38:42,407 [1] DEBUG - Statement Id: [DAO00008_GetUserInvSettings] PreparedStatement : [select A.*, B.TENKHO, B.MAKHO, B.LOAIKHO_ID, B.KHOQUANLY_ID          from TM_SYS_USERKHO A          left join TM_KHO B on B.MODULE_ID = A.MODULE_ID and B.KHO_ID = A.KHO_ID          where A.HOSPITAL_ID =  @param0  and A.ACCOUNT_ID =  @param1           order by B.TENKHO]
2019-09-20 11:38:42,407 [1] DEBUG - Statement Id: [DAO00008_GetUserInvSettings] Parameters: [@param0=[HOSPITAL_ID,HLU01], @param1=[ACCOUNT_ID,113]]
2019-09-20 11:38:42,407 [1] DEBUG - Statement Id: [DAO00008_GetUserInvSettings] Types: [@param0=[String, System.String], @param1=[String, System.String]]
2019-09-20 11:38:42,541 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'COM30'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2019-09-20 11:38:42,725 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'RIS04'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2019-09-20 11:38:50,027 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'MENU1'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2019-09-20 11:38:50,170 [1] DEBUG - Statement Id: [DAO00011_GetList] PreparedStatement : [select              TM_SYS_MENU.ID,              TM_SYS_MENU.PARENTID,              TM_SYS_MENU.SCREEN,              TM_SYS_MENU.SMALLIMAGE,              TM_SYS_MENU.LARGEIMAGE,              TM_SYS_MENU.DESCRIPTION,              TM_SYS_MENU.TYPE,              TM_SYS_MENU.TITLE_VI as TITLE              from TM_SYS_MENU              where TM_SYS_MENU.HOSPITAL_ID = 'HLU01' and TM_SYS_MENU.ACTIVE = '1'               AND                   (TM_SYS_MENU.TYPE & '8' = '8')                             order by TM_SYS_MENU.ORDERNUM]
2019-09-20 11:38:50,822 [1] DEBUG - Statement Id: [DAO00011_usermenu_list] PreparedStatement : [select              TM_SYS_HOMEMENU.MENUID as ID,              TM_SYS_MENU.TITLE_VI as TITLE,              TM_SYS_MENU.SCREEN,              TM_SYS_MENU.SMALLIMAGE,              TM_SYS_MENU.LARGEIMAGE,              TM_SYS_MENU.TYPE              from TM_SYS_HOMEMENU              left join TM_SYS_MENU on TM_SYS_MENU.ID = TM_SYS_HOMEMENU.MENUID and TM_SYS_MENU.HOSPITAL_ID = TM_SYS_HOMEMENU.HOSPITAL_ID              where TM_SYS_HOMEMENU.HOSPITAL_ID = 'HLU01' and TM_SYS_HOMEMENU.USERID = '113' and TM_SYS_MENU.ACTIVE = '1'               AND                   (TM_SYS_MENU.TYPE & '8' = '8')                             ORDER BY TM_SYS_HOMEMENU.ORDERNUM]
2019-09-20 11:38:56,351 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'COM31'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2019-09-20 11:38:56,515 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'ORM28'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2019-09-20 11:39:01,224 [1] DEBUG - Statement Id: [DAO00066_GetBENHAN_TIEPNHAN] PreparedStatement : [select top 1 *        from TT_NOITRU_BENHAN        where TIEPNHAN_ID = '27022'  and BENHVIEN_ID = 'HLU01'        order by NGAYTAO desc]
2019-09-20 11:39:01,329 [1] DEBUG - Statement Id: [DAO00014_GetInPatientStatus] PreparedStatement : [select TRANGTHAI, isnull(KHOACHUYENDEN_ID, KHOAVAO_ID) as KHOAHIENTAI from TT_NOITRU_BENHAN        where        TIEPNHAN_ID = '27022'        and BENHVIEN_ID = 'HLU01'         and           BENHAN_ID = '5800']
2019-09-20 11:39:03,443 [1] DEBUG - Statement Id: [DAO00048_TT_PHAUTHUAT_GetList] PreparedStatement : [select *              from TT_PHAUTHUAT               where                             TT_PHAUTHUAT.LOAI = 'P'                       and                           TT_PHAUTHUAT.TIEPNHAN_ID = 27022                       and                           TT_PHAUTHUAT.BENHVIEN_ID = 'HLU01'                                     order by PHAUTHUAT_ID DESC]
2019-09-20 11:39:05,051 [1] DEBUG - Statement Id: [DAO00048_GetListLoaiGacTrongPTTT] PreparedStatement : [select DICTIONARY_ID, DICTIONARY_CODE, DICTIONARY_NAME          from LST_DICTIONARY          where DICTIONARY_TYPE_CODE = 'LoaiGacPTTT'          and ENABLED = '1']
2019-09-20 11:39:17,351 [1] DEBUG - Statement Id: [DAO00048_GetDSLoaiGacDaGhiNhan] PreparedStatement : [select A.KIEMSOATGAC_ID, A.BENHNHAN_ID, A.TIEPNHAN_ID, A.BENHAN_ID, A.PHAUTHUAT_ID, A.LOAIPT_TT, A.LOAIGAC_ID          , A.NGAYGHINHAN, A.THOIGIANGHINHAN, A.SOLUONG, A.SOLUONGDASUDUNG, A.SOLUONGCONLAI, A.GHICHU, A.NGUOINHANDUNGCU_ID          , B.DICTIONARY_CODE AS MALOAIGAC, B.DICTIONARY_NAME AS TENLOAIGAC          from TT_PHAUTHUAT_GHINHANGAC A          inner join LST_DICTIONARY B on B.DICTIONARY_ID = A.LOAIGAC_ID          where A.PHAUTHUAT_ID = 3742 and A.BENHVIEN_ID = 'HLU01']
--------------------------------------------------------------------------------
2019-09-20 13:42:56,560 [1] DEBUG - Statement Id: [DAO00001_DBList] PreparedStatement : [select *              from TM_SYS_SERVER              where HOSPITAL_ID = '_SYSTEM_' and TYPE = 'D']
2019-09-20 13:42:56,833 [1] DEBUG - Statement Id: [DAO00001_DaoList] PreparedStatement : [select              TM_SYS_SERVICEMAP.ID,              TM_SYS_SERVICEMAP.HOSPITAL_ID,              TM_SYS_SERVICEMAP.DB_NAME,              TM_SYS_SERVICEMAP.TYPE,              TM_SYS_SERVICEMAP.NAME,              TM_SYS_SERVICEMAP.CLASS,              (TM_SYS_DIC.VALUE + '.' + TM_SYS_SERVICEMAP.CLASS) as CLASSFULL,              TM_SYS_SERVICEMAP.ASSEMBLY              from TM_SYS_SERVICEMAP              inner join TM_SYS_DIC              on TM_SYS_SERVICEMAP.NAMESPACE = TM_SYS_DIC.ID              where HOSPITAL_ID = '_SYSTEM_' AND TYPE = 'D' AND ACTIVE = '1'              order by DB_NAME]
2019-09-20 13:42:56,876 [1] DEBUG - Statement Id: [DAO00001_ServiceList] PreparedStatement : [select              TM_SYS_SERVICEMAP.ID,              TM_SYS_SERVICEMAP.HOSPITAL_ID,              TM_SYS_SERVICEMAP.DB_NAME,              TM_SYS_SERVICEMAP.TYPE,              TM_SYS_SERVICEMAP.NAME,              TM_SYS_SERVICEMAP.CLASS,              (TM_SYS_DIC.VALUE + '.' + TM_SYS_SERVICEMAP.CLASS) as CLASSFULL,              TM_SYS_SERVICEMAP.ASSEMBLY,              TM_SYS_SERVER.URL              from TM_SYS_SERVICEMAP              inner join TM_SYS_DIC on TM_SYS_SERVICEMAP.NAMESPACE = TM_SYS_DIC.ID              inner join TM_SYS_SERVER on (TM_SYS_SERVICEMAP.DB_NAME = TM_SYS_SERVER.NAME) and (TM_SYS_SERVER.HOSPITAL_ID = '_SYSTEM_')              where TM_SYS_SERVICEMAP.HOSPITAL_ID = '_SYSTEM_' AND TM_SYS_SERVICEMAP.TYPE = 'S'  AND ACTIVE = '1'              order by URL]
2019-09-20 13:42:57,304 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = '_SYSTEM_'               AND                   TM_SYS_SCREEN.PAGE = 'LOGIN'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2019-09-20 13:42:57,711 [1] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = '_SYSTEM_'               AND                   TM_SYS_CACHE.ACTIVE = '1']
2019-09-20 13:43:05,366 [1] DEBUG - Statement Id: [DAO00001_DBList] PreparedStatement : [select *              from TM_SYS_SERVER              where HOSPITAL_ID = 'HLU01' and TYPE = 'D']
2019-09-20 13:43:05,412 [1] DEBUG - Statement Id: [DAO00001_DaoList] PreparedStatement : [select              TM_SYS_SERVICEMAP.ID,              TM_SYS_SERVICEMAP.HOSPITAL_ID,              TM_SYS_SERVICEMAP.DB_NAME,              TM_SYS_SERVICEMAP.TYPE,              TM_SYS_SERVICEMAP.NAME,              TM_SYS_SERVICEMAP.CLASS,              (TM_SYS_DIC.VALUE + '.' + TM_SYS_SERVICEMAP.CLASS) as CLASSFULL,              TM_SYS_SERVICEMAP.ASSEMBLY              from TM_SYS_SERVICEMAP              inner join TM_SYS_DIC              on TM_SYS_SERVICEMAP.NAMESPACE = TM_SYS_DIC.ID              where HOSPITAL_ID = 'HLU01' AND TYPE = 'D' AND ACTIVE = '1'              order by DB_NAME]
2019-09-20 13:43:07,586 [1] DEBUG - Statement Id: [DAO00001_ServiceList] PreparedStatement : [select              TM_SYS_SERVICEMAP.ID,              TM_SYS_SERVICEMAP.HOSPITAL_ID,              TM_SYS_SERVICEMAP.DB_NAME,              TM_SYS_SERVICEMAP.TYPE,              TM_SYS_SERVICEMAP.NAME,              TM_SYS_SERVICEMAP.CLASS,              (TM_SYS_DIC.VALUE + '.' + TM_SYS_SERVICEMAP.CLASS) as CLASSFULL,              TM_SYS_SERVICEMAP.ASSEMBLY,              TM_SYS_SERVER.URL              from TM_SYS_SERVICEMAP              inner join TM_SYS_DIC on TM_SYS_SERVICEMAP.NAMESPACE = TM_SYS_DIC.ID              inner join TM_SYS_SERVER on (TM_SYS_SERVICEMAP.DB_NAME = TM_SYS_SERVER.NAME) and (TM_SYS_SERVER.HOSPITAL_ID = 'HLU01')              where TM_SYS_SERVICEMAP.HOSPITAL_ID = 'HLU01' AND TM_SYS_SERVICEMAP.TYPE = 'S'  AND ACTIVE = '1'              order by URL]
2019-09-20 13:43:07,681 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1']
2019-09-20 13:43:08,466 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM005']
2019-09-20 13:43:08,656 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM015']
2019-09-20 13:43:08,733 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM067']
2019-09-20 13:43:08,806 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM008']
2019-09-20 13:43:08,880 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM068']
2019-09-20 13:43:08,958 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM006']
2019-09-20 13:43:09,045 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM030']
2019-09-20 13:43:09,205 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM025']
2019-09-20 13:43:09,297 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM024']
2019-09-20 13:43:09,803 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM033']
2019-09-20 13:43:09,849 [5] DEBUG - Statement Id: [DAO00027_GetListDuocKyGuiTonKho] PreparedStatement : [select  distinct TT_TONKHO.DUOC_KEY, LTRIM(TT_TONKHO.KHODUOC_ID) as KHODUOC_ID, TM_DUOC.DUOC_ID, TM_LOAIDUOC.MALOAIDUOC,TM_DUOC.SOVISA,TM_DUOC.TYLE_VAT,TM_DUOC.COTOA,        TM_DUOC.MADUOC, TM_DUOC.TENHANG, TM_DUOC.TENDUOCDAYDU, dvt.TENDONVITINH as DONVITINH,  TM_DUOC.DONVITINH_ID,TM_DUOC.BHYT,TM_DUOC.PHAMVI,        TM_DUOC.TENHOATCHAT, TM_DUOC.HAMLUONG, TM_DUOC.HANGSANXUAT, TM_DUOC.QUOCGIA, TM_DUOC.LOAIDUOC_ID, TM_DUOC.DUONGDUNG_ID,        TM_TENDUOC.TENDUOC, TM_TENDUOC.TENDUOC_EN, TM_TENDUOC.MAQUOCTE, TM_TENDUOC.MAQUOCTEBT,        TM_LOAIDUOC.LOAIVATTU_ID, TM_DUOC.BENHVIEN_ID,TT_TONKHO.SOLUONG, TT_TONKHO.NGUONDUOC_ID, NH.TENNGUONDUOC        , TAMNGUNG = CASE WHEN TM_DUOC.TAMNGUNG = '1' OR nh.TAMNGUNG = '1' OR KD.TAMNGUNG = '1' THEN '1' ELSE '0' END        , TM_DUOC.DANGTRINHBAY        from TM_DUOC        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = TM_DUOC.DONVITINH_ID        left join TM_TENDUOC on TM_DUOC.TENDUOC_ID = TM_TENDUOC.TENDUOC_ID and TM_DUOC.BENHVIEN_ID = 'HLU01' and TM_DUOC.TAMNGUNG = '0'        left join TM_LOAIDUOC on TM_LOAIDUOC.LOAIDUOC_ID = TM_DUOC.LOAIDUOC_ID and TM_LOAIDUOC.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG on (TM_LOAIDUOC.LOAIVATTU_ID = TM_DUOC_HANDUNG.LOAIDUOC and TM_DUOC_HANDUNG.BENHVIEN_ID = 'HLU01')        inner join        (select LTRIM(A.KHODUOC_ID) + '_' + LTRIM(A.DUOC_ID) + '_' + LTRIM(ISNULL(A.NGUONDUOC_ID,'')) as DUOC_KEY, A.KHODUOC_ID, A.DUOC_ID,A.NGUONDUOC_ID,        SUM(isnull(A.SOLUONG,0)) as SOLUONG        from        (select SUM(SOLUONG) as SOLUONG, KHODUOC_ID, DUOC_ID, NGUONDUOC_ID from TT_DUOC_KYGUI_TONKHO        where BENHVIEN_ID = 'HLU01' group by KHODUOC_ID, DUOC_ID, NGUONDUOC_ID) A        group by LTRIM(A.KHODUOC_ID) + '_' + LTRIM(A.DUOC_ID) + '_' + LTRIM(A.NGUONDUOC_ID), A.KHODUOC_ID, A.DUOC_ID, A.NGUONDUOC_ID)        TT_TONKHO on TT_TONKHO.DUOC_ID = TM_DUOC.DUOC_ID        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = TT_TONKHO.NGUONDUOC_ID and nh.BENHVIEN_ID = 'HLU01'        LEFT JOIN TM_KHODUOC KD ON KD.KHODUOC_ID = TT_TONKHO.KHODUOC_ID        where TM_DUOC.BENHVIEN_ID = 'HLU01' AND TT_TONKHO.SOLUONG >= 0]
2019-09-20 13:43:09,931 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM018']
2019-09-20 13:43:09,969 [5] DEBUG - Statement Id: [DAO00027_GetListDuocTonKho] PreparedStatement : [select distinct TT_TONKHO.DUOC_KEY, LTRIM(TT_TONKHO.KHODUOC_ID) as KHODUOC_ID, TM_DUOC.DUOC_ID, TM_LOAIDUOC.MALOAIDUOC,TM_DUOC.SOVISA,TM_DUOC.TYLE_VAT,TM_DUOC.COTOA,        TM_DUOC.MADUOC, TM_DUOC.TENHANG, TM_DUOC.TENDUOCDAYDU, dvt.TENDONVITINH as DONVITINH,  TM_DUOC.DONVITINH_ID,TM_DUOC.BHYT,                TM_DUOC.TENHOATCHAT,          TM_DUOC.HAMLUONG, TM_DUOC.HANGSANXUAT, TM_DUOC.QUOCGIA, TM_DUOC.LOAIDUOC_ID, TM_DUOC.DUONGDUNG_ID,        TM_TENDUOC.TENDUOC, TM_TENDUOC.TENDUOC_EN, TM_TENDUOC.MAQUOCTE, TM_TENDUOC.MAQUOCTEBT,        TM_LOAIDUOC.LOAIVATTU_ID, TM_DUOC.BENHVIEN_ID,        TT_TONKHO.SOLUONG, TM_DUOC.VTYT_PHANLOAI, TM_DUOC.PHAMVI, TT_TONKHO.NGUONDUOC_ID, NG.TENNGUONDUOC AS TENNGUONDUOC        , TAMNGUNG = CASE WHEN TM_DUOC.TAMNGUNG = '1' OR NG.TAMNGUNG = '1' OR KD.TAMNGUNG = '1' THEN '1' ELSE '0' END        , TM_DUOC.DANGTRINHBAY        from TM_DUOC        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = TM_DUOC.DONVITINH_ID        left join TM_TENDUOC on TM_DUOC.TENDUOC_ID = TM_TENDUOC.TENDUOC_ID and TM_DUOC.BENHVIEN_ID = 'HLU01' and TM_DUOC.TAMNGUNG = '0'        left join TM_LOAIDUOC on TM_LOAIDUOC.LOAIDUOC_ID = TM_DUOC.LOAIDUOC_ID and TM_LOAIDUOC.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG on (TM_LOAIDUOC.LOAIVATTU_ID = TM_DUOC_HANDUNG.LOAIDUOC and TM_DUOC_HANDUNG.BENHVIEN_ID = 'HLU01')        inner join        (select LTRIM(A.KHODUOC_ID) + '_' + LTRIM(A.DUOC_ID) + '_' + LTRIM(ISNULL(A.NGUONDUOC_ID,'')) as DUOC_KEY, A.KHODUOC_ID, A.DUOC_ID, A.NGUONDUOC_ID,        SUM(isnull(A.SOLUONG,0)) as SOLUONG        from        (select SUM(SOLUONG) as SOLUONG, KHODUOC_ID, DUOC_ID, NGUONDUOC_ID from TT_DUOC_TONKHO        where BENHVIEN_ID = 'HLU01' group by KHODUOC_ID, DUOC_ID, NGUONDUOC_ID) A        group by LTRIM(A.KHODUOC_ID) + '_' + LTRIM(A.DUOC_ID) + '_' + LTRIM(ISNULL(A.NGUONDUOC_ID,'')), A.KHODUOC_ID, A.DUOC_ID, NGUONDUOC_ID        ) TT_TONKHO on TT_TONKHO.DUOC_ID = TM_DUOC.DUOC_ID        LEFT JOIN TM_NGUONHANG NG ON NG.NGUONDUOC_ID = TT_TONKHO.NGUONDUOC_ID        LEFT JOIN TM_KHODUOC KD ON KD.KHODUOC_ID = TT_TONKHO.KHODUOC_ID        where TM_DUOC.BENHVIEN_ID = 'HLU01' and TT_TONKHO.SOLUONG >= 0]
2019-09-20 13:43:12,019 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM023']
2019-09-20 13:43:12,056 [5] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoVaBooking] PreparedStatement : [declare @NGUONDUOC_MACDINH varchar(5) = '0';        declare @TOAMUANGOAI int = 0;        select @NGUONDUOC_MACDINH = isnull(VALUE,0) from TM_SYS_APPSETTINGS where CODE = 'PHA_NGUONDUOC'        select @TOAMUANGOAI = isnull(VALUE,0) from TM_SYS_APPSETTINGS where CODE = 'OPD_TOAMUANGOAI_DUNGDANHMUC_DUOC'                if @TOAMUANGOAI = 1        begin        select  distinct '0' + '_' + LTRIM(d.DUOC_ID) + '_' + @NGUONDUOC_MACDINH as DUOC_KEY, 0 as PHAMVI_ID, @NGUONDUOC_MACDINH as NGUONDUOC_ID, null as TENNGUONDUOC, null as TINHTIEN, d.DUOC_ID, ld.MALOAIDUOC,        d.SOVISA,d.TYLE_VAT,d.COTOA, d.MADUOC, d.TENHANG, d.TENDUOCDAYDU, d.DONVITINH as DONVITINH, d.BHYT,        d.TENHOATCHAT, d.HAMLUONG, d.HANGSANXUAT, d.QUOCGIA, d.LOAIDUOC_ID, d.DUONGDUNG_ID, d.TINHTIEN_PTTT,        ten.TENDUOC, ten.TENDUOC_EN, ten.MAQUOCTE, ten.MAQUOCTEBT,        '' as BHYT_TEXT        , ld.LOAIVATTU_ID        , d.BENHVIEN_ID,        999999999 as SOLUONG, d.VTYT_PHANLOAI, d.PHAMVI, d.SUASOLUONGTONGHOP, d.MADUOCBV, d.DANGTRINHBAY        , TAMNGUNG = CASE WHEN d.TAMNGUNG = '1' THEN '1' ELSE '0' END        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        union all        select  distinct tk.DUOC_KEY, LTRIM(tk.PHAMVI_ID) as PHAMVI_ID, tk.NGUONDUOC_ID, nh.TENNGUONDUOC, nh.TINHTIEN, d.DUOC_ID, ld.MALOAIDUOC,        d.SOVISA,d.TYLE_VAT,d.COTOA, d.MADUOC, d.TENHANG, d.TENDUOCDAYDU, d.DONVITINH as DONVITINH, d.BHYT,        d.TENHOATCHAT, d.HAMLUONG, d.HANGSANXUAT, d.QUOCGIA, d.LOAIDUOC_ID, d.DUONGDUNG_ID, d.TINHTIEN_PTTT,        ten.TENDUOC, ten.TENDUOC_EN, ten.MAQUOCTE, ten.MAQUOCTEBT,        CASE WHEN d.BHYT = '1' THEN 'BHYT' ELSE '' END as BHYT_TEXT        , ld.LOAIVATTU_ID        , d.BENHVIEN_ID,        tk.SOLUONG, d.VTYT_PHANLOAI, d.PHAMVI, d.SUASOLUONGTONGHOP, d.MADUOCBV, d.DANGTRINHBAY        , TAMNGUNG = CASE WHEN d.TAMNGUNG = '1' OR nh.TAMNGUNG = '1' OR kd.TAMNGUNG = '1' THEN '1' ELSE '0' END        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        inner join        (        select  LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')) DUOC_KEY, (SUM(dtk.SOLUONG) - isnull(sum(A.SOLUONG),0) - isnull(sum(B.SOLUONG),0)) SOLUONG, pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        from (select sum(soluong) soluong,duoc_id,nguonduoc_id,khoduoc_id,benhvien_id from TT_DUOC_TONKHO  group by duoc_id,nguonduoc_id,khoduoc_id,benhvien_id) dtk        inner join TM_DUOC_PHAMVISD_MAPPING pvsd on dtk.KHODUOC_ID = pvsd.KHODUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NOITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) B on B.DUOC_ID = dtk.DUOC_ID and B.SOLUONG > 0 and B.PHAMVI_ID = pvsd.PHAMVI_ID and B.NGUONHANG_ID = dtk.NGUONDUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NGOAITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) A on A.DUOC_ID = dtk.DUOC_ID and A.SOLUONG > 0 and A.PHAMVI_ID = pvsd.PHAMVI_ID and A.NGUONHANG_ID = dtk.NGUONDUOC_ID        where dtk.SOLUONG > 0 and dtk.BENHVIEN_ID = 'HLU01'        group by LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')), pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        ) tk on tk.DUOC_ID = d.DUOC_ID        left join TM_DUOC_PHAMVISUDUNG kd on kd.PHAMVI_ID = tk.PHAMVI_ID and kd.BENHVIEN_ID = 'HLU01'        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = tk.NGUONDUOC_ID and nh.BENHVIEN_ID = 'HLU01'        where d.BENHVIEN_ID = 'HLU01'  and tk.SOLUONG >= 0        end        else        begin                  select  distinct tk.DUOC_KEY, LTRIM(tk.PHAMVI_ID) as PHAMVI_ID, tk.NGUONDUOC_ID, nh.TENNGUONDUOC, nh.TINHTIEN, d.DUOC_ID, ld.MALOAIDUOC,        d.SOVISA,d.TYLE_VAT,d.COTOA, d.MADUOC, d.TENHANG, d.TENDUOCDAYDU, d.DONVITINH as DONVITINH, d.BHYT,        d.TENHOATCHAT, d.HAMLUONG, d.HANGSANXUAT, d.QUOCGIA, d.LOAIDUOC_ID, d.DUONGDUNG_ID, d.TINHTIEN_PTTT,        ten.TENDUOC, ten.TENDUOC_EN, ten.MAQUOCTE, ten.MAQUOCTEBT,        CASE WHEN d.BHYT = '1' THEN 'BHYT' ELSE '' END as BHYT_TEXT        , ld.LOAIVATTU_ID        , d.BENHVIEN_ID,        tk.SOLUONG, d.VTYT_PHANLOAI, d.PHAMVI, d.SUASOLUONGTONGHOP, d.MADUOCBV, d.DANGTRINHBAY        , TAMNGUNG = CASE WHEN d.TAMNGUNG = '1' OR nh.TAMNGUNG = '1' OR kd.TAMNGUNG = '1' THEN '1' ELSE '0' END        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        inner join        (        select  LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')) DUOC_KEY, (SUM(dtk.SOLUONG) - isnull(sum(A.SOLUONG),0) - isnull(sum(B.SOLUONG),0)) SOLUONG, pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        from (select sum(soluong) soluong,duoc_id,nguonduoc_id,khoduoc_id,benhvien_id from TT_DUOC_TONKHO  group by duoc_id,nguonduoc_id,khoduoc_id,benhvien_id) dtk        inner join TM_DUOC_PHAMVISD_MAPPING pvsd on dtk.KHODUOC_ID = pvsd.KHODUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NOITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) B on B.DUOC_ID = dtk.DUOC_ID and B.SOLUONG > 0 and B.PHAMVI_ID = pvsd.PHAMVI_ID and B.NGUONHANG_ID = dtk.NGUONDUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NGOAITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) A on A.DUOC_ID = dtk.DUOC_ID and A.SOLUONG > 0 and A.PHAMVI_ID = pvsd.PHAMVI_ID and A.NGUONHANG_ID = dtk.NGUONDUOC_ID        where dtk.SOLUONG > 0 and dtk.BENHVIEN_ID = 'HLU01'        group by LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')), pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        ) tk on tk.DUOC_ID = d.DUOC_ID        left join TM_DUOC_PHAMVISUDUNG kd on kd.PHAMVI_ID = tk.PHAMVI_ID and kd.BENHVIEN_ID = 'HLU01'        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = tk.NGUONDUOC_ID and nh.BENHVIEN_ID = 'HLU01'        where d.BENHVIEN_ID = 'HLU01'  and tk.SOLUONG >= 0        end]
2019-09-20 13:43:13,997 [5] DEBUG - Statement Id: [DAO00320_GetList] PreparedStatement : [select M.*            from TM_MAU M            LEFT JOIN TM_MAU_DONVITINH DVT on M.DONVITINH_ID=DVT.DONVITINH_ID            where            M.TAMNGUNG = '0'            and M.BENHVIEN_ID = 'HLU01'            order by M.TENMAU]
2019-09-20 13:43:14,070 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM071']
2019-09-20 13:43:14,108 [5] DEBUG - Statement Id: [DAO00322_GetListMauTonKhoForCreateCached] PreparedStatement : [SELECT DISTINCT          TK.MAU_KEY, TK.KHOMAU_ID, M.MAU_ID, M.MAMAU, M.TENMAU, M.NHOM_ABO, M.NHOM_RH, M.LOAIMAU_ID,          TK.SOLONHAP_ID, SLN.SOLONHAP, SLN.SOKIEMSOAT, TK.NGUONHANG_ID, NG.TENNGUONMAU, M.BENHVIEN_ID, M.DONVITINH_ID,          SUM(tk.SOLUONG) AS SOLUONG,K.TENKHO,DVT.TENDONVITINH          FROM TT_MAU_TONKHO TK          JOIN TM_KHO K ON TK.KHOMAU_ID = K.KHO_ID          JOIN TT_MAU_CHUNGTU_SOLONHAP SLN ON TK.SOLONHAP_ID = SLN.SOLONHAP_ID          JOIN TM_MAU M on TK.MAU_ID = M.MAU_ID and M.TAMNGUNG = '0'          LEFT JOIN TM_MAU_DONVITINH DVT on M.DONVITINH_ID=DVT.DONVITINH_ID          LEFT JOIN TM_NGUONMAU NG ON NG.NGUONMAU_ID = TK.NGUONHANG_ID          WHERE TK.SOLUONG > 0          GROUP BY TK.MAU_KEY, TK.KHOMAU_ID, M.MAU_ID, M.MAMAU, M.TENMAU, M.NHOM_ABO, M.NHOM_RH, M.LOAIMAU_ID,          TK.SOLONHAP_ID, SLN.SOLONHAP, SLN.SOKIEMSOAT,TK.NGUONHANG_ID, NG.TENNGUONMAU, M.BENHVIEN_ID, M.DONVITINH_ID,K.TENKHO,DVT.TENDONVITINH]
2019-09-20 13:43:14,188 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM073']
2019-09-20 13:43:14,225 [5] DEBUG - Statement Id: [DAO00322_GetListMauTonKhoTruBooking] PreparedStatement : [select distinct          TK.MAU_KEY, TK.KHOMAU_ID, M.MAU_ID, M.MAMAU, M.TENMAU, M.NHOM_ABO, M.NHOM_RH, M.LOAIMAU_ID, M.DONVITINH_ID,          TK.SOLONHAP_ID, TK.SOLONHAP, TK.SOKIEMSOAT,M.PHAMVI, TK.NGUONHANG_ID, NG.TENNGUONMAU, M.BENHVIEN_ID,          TK.SOLUONG,TK.TENKHO,DVT.TENDONVITINH          from TM_MAU M          JOIN          (          select          A.MAU_KEY, A.KHOMAU_ID, A.MAU_ID ,a.NGUONHANG_ID, A.SOLONHAP_ID, A.SOLONHAP, A.SOKIEMSOAT, A.SOLUONG,A.TENKHO          from          (          select KHOMAU_ID, TK.MAU_ID, TK.NGUONHANG_ID, TK.MAU_KEY, SLN.SOLONHAP_ID, SLN.SOLONHAP, SLN.SOKIEMSOAT, ISNULL(TK.SOLUONG,0) - ISNULL(book.SOLUONG,0) as SOLUONG,K.TENKHO          from TT_MAU_TONKHO TK          JOIN TM_KHO K ON TK.KHOMAU_ID = K.KHO_ID          inner join TT_MAU_CHUNGTU_SOLONHAP SLN ON TK.SOLONHAP_ID = SLN.SOLONHAP_ID          left join dbo.TT_MAU_TONKHO_BOOK book ON book.MAU_KEY = TK.MAU_KEY AND book.TRANGTHAI = 'HIEULUC'          where ISNULL(TK.SOLUONG,0) - ISNULL(book.SOLUONG,0) > 0          ) A          )TK on TK.MAU_ID = M.MAU_ID and M.TAMNGUNG = '0'          LEFT JOIN TM_MAU_DONVITINH DVT on M.DONVITINH_ID=DVT.DONVITINH_ID          LEFT JOIN TM_NGUONMAU NG ON NG.NGUONMAU_ID = TK.NGUONHANG_ID]
2019-09-20 13:43:14,313 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM072']
2019-09-20 13:43:15,241 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'MAIN'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2019-09-20 13:43:16,007 [1] DEBUG - Statement Id: [DAO00002_FormList] PreparedStatement : [select              TM_SYS_FORM.HOSPITAL_ID,              TM_SYS_FORM.NAME,              TM_SYS_FORM.CLASS,              TM_SYS_FORM.ASSEMBLY,              TM_SYS_FORM.TITLE_VI as TITLE              from TM_SYS_FORM              where HOSPITAL_ID = 'HLU01']
2019-09-20 13:43:22,922 [1] DEBUG - Statement Id: [DAO00300_GetShortcutListByUserID] PreparedStatement : [SELECT S.SHORTCUT_CODE, S.SHORTCUT_VALUE              FROM TM_SHORTCUT AS S              WHERE S.BENHVIEN_ID = 'HLU01' AND S.USER_ID = '1' AND TAMNGUNG = '0']
2019-09-20 13:43:22,955 [1] DEBUG - Statement Id: [DAO00087_GetList] PreparedStatement : [select CODE, VALUE, BENHVIEN_ID              from TM_SYS_APPSETTINGS              where LOCKED = '0' and BENHVIEN_ID = 'HLU01'              order by SETTING_ID]
2019-09-20 13:43:23,063 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'MSG01'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2019-09-20 13:43:23,230 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'MSG02'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2019-09-20 13:43:23,397 [1] DEBUG - Statement Id: [DAO00008_GetUserSettings] PreparedStatement : [select A.*, B.TENKHO , C.TENPHONGBAN, B.MAKHO, C.MAPHONGBAN          from TM_SYS_USERS A          left join TM_KHODUOC B on B.KHODUOC_ID = A.INVENTORY_ID          left join TM_PHONGBAN C on (C.PHONGBAN_ID = A.WORKING_DEPT_ID and C.BENHVIEN_ID =  @param0 )          left join TM_SYS_USERKHO D on (D.ACCOUNT_ID = A.ACCOUNT_ID and D.HOSPITAL_ID =  @param0 )          where          A.HOSPITAL_ID =  @param0            and                 A.ACCOUNT_ID =  @param1]
2019-09-20 13:43:23,399 [1] DEBUG - Statement Id: [DAO00008_GetUserSettings] Parameters: [@param0=[HOSPITAL_ID,HLU01], @param1=[ACCOUNT_ID,113]]
2019-09-20 13:43:23,400 [1] DEBUG - Statement Id: [DAO00008_GetUserSettings] Types: [@param0=[String, System.String], @param1=[String, System.String]]
2019-09-20 13:43:23,434 [1] DEBUG - Statement Id: [DAO00008_GetUserInvSettings] PreparedStatement : [select A.*, B.TENKHO, B.MAKHO, B.LOAIKHO_ID, B.KHOQUANLY_ID          from TM_SYS_USERKHO A          left join TM_KHO B on B.MODULE_ID = A.MODULE_ID and B.KHO_ID = A.KHO_ID          where A.HOSPITAL_ID =  @param0  and A.ACCOUNT_ID =  @param1           order by B.TENKHO]
2019-09-20 13:43:23,434 [1] DEBUG - Statement Id: [DAO00008_GetUserInvSettings] Parameters: [@param0=[HOSPITAL_ID,HLU01], @param1=[ACCOUNT_ID,113]]
2019-09-20 13:43:23,434 [1] DEBUG - Statement Id: [DAO00008_GetUserInvSettings] Types: [@param0=[String, System.String], @param1=[String, System.String]]
2019-09-20 13:43:23,598 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'COM30'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2019-09-20 13:43:23,805 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'RIS04'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2019-09-20 13:43:31,835 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'MENU1'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2019-09-20 13:43:31,948 [1] DEBUG - Statement Id: [DAO00011_GetList] PreparedStatement : [select              TM_SYS_MENU.ID,              TM_SYS_MENU.PARENTID,              TM_SYS_MENU.SCREEN,              TM_SYS_MENU.SMALLIMAGE,              TM_SYS_MENU.LARGEIMAGE,              TM_SYS_MENU.DESCRIPTION,              TM_SYS_MENU.TYPE,              TM_SYS_MENU.TITLE_VI as TITLE              from TM_SYS_MENU              where TM_SYS_MENU.HOSPITAL_ID = 'HLU01' and TM_SYS_MENU.ACTIVE = '1'               AND                   (TM_SYS_MENU.TYPE & '8' = '8')                             order by TM_SYS_MENU.ORDERNUM]
2019-09-20 13:43:32,755 [1] DEBUG - Statement Id: [DAO00011_usermenu_list] PreparedStatement : [select              TM_SYS_HOMEMENU.MENUID as ID,              TM_SYS_MENU.TITLE_VI as TITLE,              TM_SYS_MENU.SCREEN,              TM_SYS_MENU.SMALLIMAGE,              TM_SYS_MENU.LARGEIMAGE,              TM_SYS_MENU.TYPE              from TM_SYS_HOMEMENU              left join TM_SYS_MENU on TM_SYS_MENU.ID = TM_SYS_HOMEMENU.MENUID and TM_SYS_MENU.HOSPITAL_ID = TM_SYS_HOMEMENU.HOSPITAL_ID              where TM_SYS_HOMEMENU.HOSPITAL_ID = 'HLU01' and TM_SYS_HOMEMENU.USERID = '113' and TM_SYS_MENU.ACTIVE = '1'               AND                   (TM_SYS_MENU.TYPE & '8' = '8')                             ORDER BY TM_SYS_HOMEMENU.ORDERNUM]
2019-09-20 13:45:50,935 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'COM31'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2019-09-20 13:45:51,094 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'ORM28'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2019-09-20 13:45:56,514 [1] DEBUG - Statement Id: [DAO00066_GetBENHAN_TIEPNHAN] PreparedStatement : [select top 1 *        from TT_NOITRU_BENHAN        where TIEPNHAN_ID = '27022'  and BENHVIEN_ID = 'HLU01'        order by NGAYTAO desc]
2019-09-20 13:45:56,612 [1] DEBUG - Statement Id: [DAO00014_GetInPatientStatus] PreparedStatement : [select TRANGTHAI, isnull(KHOACHUYENDEN_ID, KHOAVAO_ID) as KHOAHIENTAI from TT_NOITRU_BENHAN        where        TIEPNHAN_ID = '27022'        and BENHVIEN_ID = 'HLU01'         and           BENHAN_ID = '5800']
2019-09-20 13:45:56,705 [1] DEBUG - Statement Id: [DAO00048_TT_PHAUTHUAT_GetList] PreparedStatement : [select *              from TT_PHAUTHUAT               where                             TT_PHAUTHUAT.LOAI = 'P'                       and                           TT_PHAUTHUAT.TIEPNHAN_ID = 27022                       and                           TT_PHAUTHUAT.BENHVIEN_ID = 'HLU01'                                     order by PHAUTHUAT_ID DESC]
2019-09-20 13:45:57,155 [1] DEBUG - Statement Id: [DAO00048_GetListLoaiGacTrongPTTT] PreparedStatement : [select DICTIONARY_ID, DICTIONARY_CODE, DICTIONARY_NAME          from LST_DICTIONARY          where DICTIONARY_TYPE_CODE = 'LoaiGacPTTT'          and ENABLED = '1']
2019-09-20 13:46:03,074 [1] DEBUG - Statement Id: [DAO00048_GetDSLoaiGacDaGhiNhan] PreparedStatement : [select A.KIEMSOATGAC_ID, A.BENHNHAN_ID, A.TIEPNHAN_ID, A.BENHAN_ID, A.PHAUTHUAT_ID, A.LOAIPT_TT, A.LOAIGAC_ID          , A.NGAYGHINHAN, A.THOIGIANGHINHAN, A.SOLUONG, A.SOLUONGDASUDUNG, A.SOLUONGCONLAI, A.GHICHU, A.NGUOINHANDUNGCU_ID          , B.DICTIONARY_CODE AS MALOAIGAC, B.DICTIONARY_NAME AS TENLOAIGAC          from TT_PHAUTHUAT_GHINHANGAC A          inner join LST_DICTIONARY B on B.DICTIONARY_ID = A.LOAIGAC_ID          where A.PHAUTHUAT_ID = 3742 and A.BENHVIEN_ID = 'HLU01']
2019-09-20 13:46:33,807 [1] DEBUG - Statement Id: [DAO00048_GetDSLoaiGacDaGhiNhan] PreparedStatement : [select A.KIEMSOATGAC_ID, A.BENHNHAN_ID, A.TIEPNHAN_ID, A.BENHAN_ID, A.PHAUTHUAT_ID, A.LOAIPT_TT, A.LOAIGAC_ID          , A.NGAYGHINHAN, A.THOIGIANGHINHAN, A.SOLUONG, A.SOLUONGDASUDUNG, A.SOLUONGCONLAI, A.GHICHU, A.NGUOINHANDUNGCU_ID          , B.DICTIONARY_CODE AS MALOAIGAC, B.DICTIONARY_NAME AS TENLOAIGAC          from TT_PHAUTHUAT_GHINHANGAC A          inner join LST_DICTIONARY B on B.DICTIONARY_ID = A.LOAIGAC_ID          where A.PHAUTHUAT_ID = 3742 and A.BENHVIEN_ID = 'HLU01']
2019-09-20 13:47:30,308 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'COM98'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
--------------------------------------------------------------------------------
2019-09-20 13:51:17,201 [1] DEBUG - Statement Id: [DAO00001_DBList] PreparedStatement : [select *              from TM_SYS_SERVER              where HOSPITAL_ID = '_SYSTEM_' and TYPE = 'D']
2019-09-20 13:51:21,348 [1] DEBUG - Statement Id: [DAO00001_DaoList] PreparedStatement : [select              TM_SYS_SERVICEMAP.ID,              TM_SYS_SERVICEMAP.HOSPITAL_ID,              TM_SYS_SERVICEMAP.DB_NAME,              TM_SYS_SERVICEMAP.TYPE,              TM_SYS_SERVICEMAP.NAME,              TM_SYS_SERVICEMAP.CLASS,              (TM_SYS_DIC.VALUE + '.' + TM_SYS_SERVICEMAP.CLASS) as CLASSFULL,              TM_SYS_SERVICEMAP.ASSEMBLY              from TM_SYS_SERVICEMAP              inner join TM_SYS_DIC              on TM_SYS_SERVICEMAP.NAMESPACE = TM_SYS_DIC.ID              where HOSPITAL_ID = '_SYSTEM_' AND TYPE = 'D' AND ACTIVE = '1'              order by DB_NAME]
2019-09-20 13:51:21,393 [1] DEBUG - Statement Id: [DAO00001_ServiceList] PreparedStatement : [select              TM_SYS_SERVICEMAP.ID,              TM_SYS_SERVICEMAP.HOSPITAL_ID,              TM_SYS_SERVICEMAP.DB_NAME,              TM_SYS_SERVICEMAP.TYPE,              TM_SYS_SERVICEMAP.NAME,              TM_SYS_SERVICEMAP.CLASS,              (TM_SYS_DIC.VALUE + '.' + TM_SYS_SERVICEMAP.CLASS) as CLASSFULL,              TM_SYS_SERVICEMAP.ASSEMBLY,              TM_SYS_SERVER.URL              from TM_SYS_SERVICEMAP              inner join TM_SYS_DIC on TM_SYS_SERVICEMAP.NAMESPACE = TM_SYS_DIC.ID              inner join TM_SYS_SERVER on (TM_SYS_SERVICEMAP.DB_NAME = TM_SYS_SERVER.NAME) and (TM_SYS_SERVER.HOSPITAL_ID = '_SYSTEM_')              where TM_SYS_SERVICEMAP.HOSPITAL_ID = '_SYSTEM_' AND TM_SYS_SERVICEMAP.TYPE = 'S'  AND ACTIVE = '1'              order by URL]
2019-09-20 13:51:22,017 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = '_SYSTEM_'               AND                   TM_SYS_SCREEN.PAGE = 'LOGIN'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2019-09-20 13:51:23,064 [1] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = '_SYSTEM_'               AND                   TM_SYS_CACHE.ACTIVE = '1']
2019-09-20 13:51:30,255 [1] DEBUG - Statement Id: [DAO00001_DBList] PreparedStatement : [select *              from TM_SYS_SERVER              where HOSPITAL_ID = 'HLU01' and TYPE = 'D']
2019-09-20 13:51:30,294 [1] DEBUG - Statement Id: [DAO00001_DaoList] PreparedStatement : [select              TM_SYS_SERVICEMAP.ID,              TM_SYS_SERVICEMAP.HOSPITAL_ID,              TM_SYS_SERVICEMAP.DB_NAME,              TM_SYS_SERVICEMAP.TYPE,              TM_SYS_SERVICEMAP.NAME,              TM_SYS_SERVICEMAP.CLASS,              (TM_SYS_DIC.VALUE + '.' + TM_SYS_SERVICEMAP.CLASS) as CLASSFULL,              TM_SYS_SERVICEMAP.ASSEMBLY              from TM_SYS_SERVICEMAP              inner join TM_SYS_DIC              on TM_SYS_SERVICEMAP.NAMESPACE = TM_SYS_DIC.ID              where HOSPITAL_ID = 'HLU01' AND TYPE = 'D' AND ACTIVE = '1'              order by DB_NAME]
2019-09-20 13:51:32,310 [1] DEBUG - Statement Id: [DAO00001_ServiceList] PreparedStatement : [select              TM_SYS_SERVICEMAP.ID,              TM_SYS_SERVICEMAP.HOSPITAL_ID,              TM_SYS_SERVICEMAP.DB_NAME,              TM_SYS_SERVICEMAP.TYPE,              TM_SYS_SERVICEMAP.NAME,              TM_SYS_SERVICEMAP.CLASS,              (TM_SYS_DIC.VALUE + '.' + TM_SYS_SERVICEMAP.CLASS) as CLASSFULL,              TM_SYS_SERVICEMAP.ASSEMBLY,              TM_SYS_SERVER.URL              from TM_SYS_SERVICEMAP              inner join TM_SYS_DIC on TM_SYS_SERVICEMAP.NAMESPACE = TM_SYS_DIC.ID              inner join TM_SYS_SERVER on (TM_SYS_SERVICEMAP.DB_NAME = TM_SYS_SERVER.NAME) and (TM_SYS_SERVER.HOSPITAL_ID = 'HLU01')              where TM_SYS_SERVICEMAP.HOSPITAL_ID = 'HLU01' AND TM_SYS_SERVICEMAP.TYPE = 'S'  AND ACTIVE = '1'              order by URL]
2019-09-20 13:51:32,828 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1']
2019-09-20 13:51:33,975 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM005']
2019-09-20 13:51:34,240 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM015']
2019-09-20 13:51:34,328 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM067']
2019-09-20 13:51:34,424 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM008']
2019-09-20 13:51:34,573 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM068']
2019-09-20 13:51:34,697 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM006']
2019-09-20 13:51:34,825 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM030']
2019-09-20 13:51:34,945 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM025']
2019-09-20 13:51:35,031 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM024']
2019-09-20 13:51:35,549 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM033']
2019-09-20 13:51:35,613 [5] DEBUG - Statement Id: [DAO00027_GetListDuocKyGuiTonKho] PreparedStatement : [select  distinct TT_TONKHO.DUOC_KEY, LTRIM(TT_TONKHO.KHODUOC_ID) as KHODUOC_ID, TM_DUOC.DUOC_ID, TM_LOAIDUOC.MALOAIDUOC,TM_DUOC.SOVISA,TM_DUOC.TYLE_VAT,TM_DUOC.COTOA,        TM_DUOC.MADUOC, TM_DUOC.TENHANG, TM_DUOC.TENDUOCDAYDU, dvt.TENDONVITINH as DONVITINH,  TM_DUOC.DONVITINH_ID,TM_DUOC.BHYT,TM_DUOC.PHAMVI,        TM_DUOC.TENHOATCHAT, TM_DUOC.HAMLUONG, TM_DUOC.HANGSANXUAT, TM_DUOC.QUOCGIA, TM_DUOC.LOAIDUOC_ID, TM_DUOC.DUONGDUNG_ID,        TM_TENDUOC.TENDUOC, TM_TENDUOC.TENDUOC_EN, TM_TENDUOC.MAQUOCTE, TM_TENDUOC.MAQUOCTEBT,        TM_LOAIDUOC.LOAIVATTU_ID, TM_DUOC.BENHVIEN_ID,TT_TONKHO.SOLUONG, TT_TONKHO.NGUONDUOC_ID, NH.TENNGUONDUOC        , TAMNGUNG = CASE WHEN TM_DUOC.TAMNGUNG = '1' OR nh.TAMNGUNG = '1' OR KD.TAMNGUNG = '1' THEN '1' ELSE '0' END        , TM_DUOC.DANGTRINHBAY        from TM_DUOC        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = TM_DUOC.DONVITINH_ID        left join TM_TENDUOC on TM_DUOC.TENDUOC_ID = TM_TENDUOC.TENDUOC_ID and TM_DUOC.BENHVIEN_ID = 'HLU01' and TM_DUOC.TAMNGUNG = '0'        left join TM_LOAIDUOC on TM_LOAIDUOC.LOAIDUOC_ID = TM_DUOC.LOAIDUOC_ID and TM_LOAIDUOC.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG on (TM_LOAIDUOC.LOAIVATTU_ID = TM_DUOC_HANDUNG.LOAIDUOC and TM_DUOC_HANDUNG.BENHVIEN_ID = 'HLU01')        inner join        (select LTRIM(A.KHODUOC_ID) + '_' + LTRIM(A.DUOC_ID) + '_' + LTRIM(ISNULL(A.NGUONDUOC_ID,'')) as DUOC_KEY, A.KHODUOC_ID, A.DUOC_ID,A.NGUONDUOC_ID,        SUM(isnull(A.SOLUONG,0)) as SOLUONG        from        (select SUM(SOLUONG) as SOLUONG, KHODUOC_ID, DUOC_ID, NGUONDUOC_ID from TT_DUOC_KYGUI_TONKHO        where BENHVIEN_ID = 'HLU01' group by KHODUOC_ID, DUOC_ID, NGUONDUOC_ID) A        group by LTRIM(A.KHODUOC_ID) + '_' + LTRIM(A.DUOC_ID) + '_' + LTRIM(A.NGUONDUOC_ID), A.KHODUOC_ID, A.DUOC_ID, A.NGUONDUOC_ID)        TT_TONKHO on TT_TONKHO.DUOC_ID = TM_DUOC.DUOC_ID        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = TT_TONKHO.NGUONDUOC_ID and nh.BENHVIEN_ID = 'HLU01'        LEFT JOIN TM_KHODUOC KD ON KD.KHODUOC_ID = TT_TONKHO.KHODUOC_ID        where TM_DUOC.BENHVIEN_ID = 'HLU01' AND TT_TONKHO.SOLUONG >= 0]
2019-09-20 13:51:35,699 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM018']
2019-09-20 13:51:35,742 [5] DEBUG - Statement Id: [DAO00027_GetListDuocTonKho] PreparedStatement : [select distinct TT_TONKHO.DUOC_KEY, LTRIM(TT_TONKHO.KHODUOC_ID) as KHODUOC_ID, TM_DUOC.DUOC_ID, TM_LOAIDUOC.MALOAIDUOC,TM_DUOC.SOVISA,TM_DUOC.TYLE_VAT,TM_DUOC.COTOA,        TM_DUOC.MADUOC, TM_DUOC.TENHANG, TM_DUOC.TENDUOCDAYDU, dvt.TENDONVITINH as DONVITINH,  TM_DUOC.DONVITINH_ID,TM_DUOC.BHYT,                TM_DUOC.TENHOATCHAT,          TM_DUOC.HAMLUONG, TM_DUOC.HANGSANXUAT, TM_DUOC.QUOCGIA, TM_DUOC.LOAIDUOC_ID, TM_DUOC.DUONGDUNG_ID,        TM_TENDUOC.TENDUOC, TM_TENDUOC.TENDUOC_EN, TM_TENDUOC.MAQUOCTE, TM_TENDUOC.MAQUOCTEBT,        TM_LOAIDUOC.LOAIVATTU_ID, TM_DUOC.BENHVIEN_ID,        TT_TONKHO.SOLUONG, TM_DUOC.VTYT_PHANLOAI, TM_DUOC.PHAMVI, TT_TONKHO.NGUONDUOC_ID, NG.TENNGUONDUOC AS TENNGUONDUOC        , TAMNGUNG = CASE WHEN TM_DUOC.TAMNGUNG = '1' OR NG.TAMNGUNG = '1' OR KD.TAMNGUNG = '1' THEN '1' ELSE '0' END        , TM_DUOC.DANGTRINHBAY        from TM_DUOC        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = TM_DUOC.DONVITINH_ID        left join TM_TENDUOC on TM_DUOC.TENDUOC_ID = TM_TENDUOC.TENDUOC_ID and TM_DUOC.BENHVIEN_ID = 'HLU01' and TM_DUOC.TAMNGUNG = '0'        left join TM_LOAIDUOC on TM_LOAIDUOC.LOAIDUOC_ID = TM_DUOC.LOAIDUOC_ID and TM_LOAIDUOC.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG on (TM_LOAIDUOC.LOAIVATTU_ID = TM_DUOC_HANDUNG.LOAIDUOC and TM_DUOC_HANDUNG.BENHVIEN_ID = 'HLU01')        inner join        (select LTRIM(A.KHODUOC_ID) + '_' + LTRIM(A.DUOC_ID) + '_' + LTRIM(ISNULL(A.NGUONDUOC_ID,'')) as DUOC_KEY, A.KHODUOC_ID, A.DUOC_ID, A.NGUONDUOC_ID,        SUM(isnull(A.SOLUONG,0)) as SOLUONG        from        (select SUM(SOLUONG) as SOLUONG, KHODUOC_ID, DUOC_ID, NGUONDUOC_ID from TT_DUOC_TONKHO        where BENHVIEN_ID = 'HLU01' group by KHODUOC_ID, DUOC_ID, NGUONDUOC_ID) A        group by LTRIM(A.KHODUOC_ID) + '_' + LTRIM(A.DUOC_ID) + '_' + LTRIM(ISNULL(A.NGUONDUOC_ID,'')), A.KHODUOC_ID, A.DUOC_ID, NGUONDUOC_ID        ) TT_TONKHO on TT_TONKHO.DUOC_ID = TM_DUOC.DUOC_ID        LEFT JOIN TM_NGUONHANG NG ON NG.NGUONDUOC_ID = TT_TONKHO.NGUONDUOC_ID        LEFT JOIN TM_KHODUOC KD ON KD.KHODUOC_ID = TT_TONKHO.KHODUOC_ID        where TM_DUOC.BENHVIEN_ID = 'HLU01' and TT_TONKHO.SOLUONG >= 0]
2019-09-20 13:51:41,738 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM023']
2019-09-20 13:51:41,890 [5] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoVaBooking] PreparedStatement : [declare @NGUONDUOC_MACDINH varchar(5) = '0';        declare @TOAMUANGOAI int = 0;        select @NGUONDUOC_MACDINH = isnull(VALUE,0) from TM_SYS_APPSETTINGS where CODE = 'PHA_NGUONDUOC'        select @TOAMUANGOAI = isnull(VALUE,0) from TM_SYS_APPSETTINGS where CODE = 'OPD_TOAMUANGOAI_DUNGDANHMUC_DUOC'                if @TOAMUANGOAI = 1        begin        select  distinct '0' + '_' + LTRIM(d.DUOC_ID) + '_' + @NGUONDUOC_MACDINH as DUOC_KEY, 0 as PHAMVI_ID, @NGUONDUOC_MACDINH as NGUONDUOC_ID, null as TENNGUONDUOC, null as TINHTIEN, d.DUOC_ID, ld.MALOAIDUOC,        d.SOVISA,d.TYLE_VAT,d.COTOA, d.MADUOC, d.TENHANG, d.TENDUOCDAYDU, d.DONVITINH as DONVITINH, d.BHYT,        d.TENHOATCHAT, d.HAMLUONG, d.HANGSANXUAT, d.QUOCGIA, d.LOAIDUOC_ID, d.DUONGDUNG_ID, d.TINHTIEN_PTTT,        ten.TENDUOC, ten.TENDUOC_EN, ten.MAQUOCTE, ten.MAQUOCTEBT,        '' as BHYT_TEXT        , ld.LOAIVATTU_ID        , d.BENHVIEN_ID,        999999999 as SOLUONG, d.VTYT_PHANLOAI, d.PHAMVI, d.SUASOLUONGTONGHOP, d.MADUOCBV, d.DANGTRINHBAY        , TAMNGUNG = CASE WHEN d.TAMNGUNG = '1' THEN '1' ELSE '0' END        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        union all        select  distinct tk.DUOC_KEY, LTRIM(tk.PHAMVI_ID) as PHAMVI_ID, tk.NGUONDUOC_ID, nh.TENNGUONDUOC, nh.TINHTIEN, d.DUOC_ID, ld.MALOAIDUOC,        d.SOVISA,d.TYLE_VAT,d.COTOA, d.MADUOC, d.TENHANG, d.TENDUOCDAYDU, d.DONVITINH as DONVITINH, d.BHYT,        d.TENHOATCHAT, d.HAMLUONG, d.HANGSANXUAT, d.QUOCGIA, d.LOAIDUOC_ID, d.DUONGDUNG_ID, d.TINHTIEN_PTTT,        ten.TENDUOC, ten.TENDUOC_EN, ten.MAQUOCTE, ten.MAQUOCTEBT,        CASE WHEN d.BHYT = '1' THEN 'BHYT' ELSE '' END as BHYT_TEXT        , ld.LOAIVATTU_ID        , d.BENHVIEN_ID,        tk.SOLUONG, d.VTYT_PHANLOAI, d.PHAMVI, d.SUASOLUONGTONGHOP, d.MADUOCBV, d.DANGTRINHBAY        , TAMNGUNG = CASE WHEN d.TAMNGUNG = '1' OR nh.TAMNGUNG = '1' OR kd.TAMNGUNG = '1' THEN '1' ELSE '0' END        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        inner join        (        select  LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')) DUOC_KEY, (SUM(dtk.SOLUONG) - isnull(sum(A.SOLUONG),0) - isnull(sum(B.SOLUONG),0)) SOLUONG, pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        from (select sum(soluong) soluong,duoc_id,nguonduoc_id,khoduoc_id,benhvien_id from TT_DUOC_TONKHO  group by duoc_id,nguonduoc_id,khoduoc_id,benhvien_id) dtk        inner join TM_DUOC_PHAMVISD_MAPPING pvsd on dtk.KHODUOC_ID = pvsd.KHODUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NOITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) B on B.DUOC_ID = dtk.DUOC_ID and B.SOLUONG > 0 and B.PHAMVI_ID = pvsd.PHAMVI_ID and B.NGUONHANG_ID = dtk.NGUONDUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NGOAITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) A on A.DUOC_ID = dtk.DUOC_ID and A.SOLUONG > 0 and A.PHAMVI_ID = pvsd.PHAMVI_ID and A.NGUONHANG_ID = dtk.NGUONDUOC_ID        where dtk.SOLUONG > 0 and dtk.BENHVIEN_ID = 'HLU01'        group by LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')), pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        ) tk on tk.DUOC_ID = d.DUOC_ID        left join TM_DUOC_PHAMVISUDUNG kd on kd.PHAMVI_ID = tk.PHAMVI_ID and kd.BENHVIEN_ID = 'HLU01'        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = tk.NGUONDUOC_ID and nh.BENHVIEN_ID = 'HLU01'        where d.BENHVIEN_ID = 'HLU01'  and tk.SOLUONG >= 0        end        else        begin                  select  distinct tk.DUOC_KEY, LTRIM(tk.PHAMVI_ID) as PHAMVI_ID, tk.NGUONDUOC_ID, nh.TENNGUONDUOC, nh.TINHTIEN, d.DUOC_ID, ld.MALOAIDUOC,        d.SOVISA,d.TYLE_VAT,d.COTOA, d.MADUOC, d.TENHANG, d.TENDUOCDAYDU, d.DONVITINH as DONVITINH, d.BHYT,        d.TENHOATCHAT, d.HAMLUONG, d.HANGSANXUAT, d.QUOCGIA, d.LOAIDUOC_ID, d.DUONGDUNG_ID, d.TINHTIEN_PTTT,        ten.TENDUOC, ten.TENDUOC_EN, ten.MAQUOCTE, ten.MAQUOCTEBT,        CASE WHEN d.BHYT = '1' THEN 'BHYT' ELSE '' END as BHYT_TEXT        , ld.LOAIVATTU_ID        , d.BENHVIEN_ID,        tk.SOLUONG, d.VTYT_PHANLOAI, d.PHAMVI, d.SUASOLUONGTONGHOP, d.MADUOCBV, d.DANGTRINHBAY        , TAMNGUNG = CASE WHEN d.TAMNGUNG = '1' OR nh.TAMNGUNG = '1' OR kd.TAMNGUNG = '1' THEN '1' ELSE '0' END        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        inner join        (        select  LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')) DUOC_KEY, (SUM(dtk.SOLUONG) - isnull(sum(A.SOLUONG),0) - isnull(sum(B.SOLUONG),0)) SOLUONG, pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        from (select sum(soluong) soluong,duoc_id,nguonduoc_id,khoduoc_id,benhvien_id from TT_DUOC_TONKHO  group by duoc_id,nguonduoc_id,khoduoc_id,benhvien_id) dtk        inner join TM_DUOC_PHAMVISD_MAPPING pvsd on dtk.KHODUOC_ID = pvsd.KHODUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NOITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) B on B.DUOC_ID = dtk.DUOC_ID and B.SOLUONG > 0 and B.PHAMVI_ID = pvsd.PHAMVI_ID and B.NGUONHANG_ID = dtk.NGUONDUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NGOAITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) A on A.DUOC_ID = dtk.DUOC_ID and A.SOLUONG > 0 and A.PHAMVI_ID = pvsd.PHAMVI_ID and A.NGUONHANG_ID = dtk.NGUONDUOC_ID        where dtk.SOLUONG > 0 and dtk.BENHVIEN_ID = 'HLU01'        group by LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')), pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        ) tk on tk.DUOC_ID = d.DUOC_ID        left join TM_DUOC_PHAMVISUDUNG kd on kd.PHAMVI_ID = tk.PHAMVI_ID and kd.BENHVIEN_ID = 'HLU01'        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = tk.NGUONDUOC_ID and nh.BENHVIEN_ID = 'HLU01'        where d.BENHVIEN_ID = 'HLU01'  and tk.SOLUONG >= 0        end]
2019-09-20 13:51:47,995 [5] DEBUG - Statement Id: [DAO00320_GetList] PreparedStatement : [select M.*            from TM_MAU M            LEFT JOIN TM_MAU_DONVITINH DVT on M.DONVITINH_ID=DVT.DONVITINH_ID            where            M.TAMNGUNG = '0'            and M.BENHVIEN_ID = 'HLU01'            order by M.TENMAU]
2019-09-20 13:51:48,066 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM071']
2019-09-20 13:51:48,115 [5] DEBUG - Statement Id: [DAO00322_GetListMauTonKhoForCreateCached] PreparedStatement : [SELECT DISTINCT          TK.MAU_KEY, TK.KHOMAU_ID, M.MAU_ID, M.MAMAU, M.TENMAU, M.NHOM_ABO, M.NHOM_RH, M.LOAIMAU_ID,          TK.SOLONHAP_ID, SLN.SOLONHAP, SLN.SOKIEMSOAT, TK.NGUONHANG_ID, NG.TENNGUONMAU, M.BENHVIEN_ID, M.DONVITINH_ID,          SUM(tk.SOLUONG) AS SOLUONG,K.TENKHO,DVT.TENDONVITINH          FROM TT_MAU_TONKHO TK          JOIN TM_KHO K ON TK.KHOMAU_ID = K.KHO_ID          JOIN TT_MAU_CHUNGTU_SOLONHAP SLN ON TK.SOLONHAP_ID = SLN.SOLONHAP_ID          JOIN TM_MAU M on TK.MAU_ID = M.MAU_ID and M.TAMNGUNG = '0'          LEFT JOIN TM_MAU_DONVITINH DVT on M.DONVITINH_ID=DVT.DONVITINH_ID          LEFT JOIN TM_NGUONMAU NG ON NG.NGUONMAU_ID = TK.NGUONHANG_ID          WHERE TK.SOLUONG > 0          GROUP BY TK.MAU_KEY, TK.KHOMAU_ID, M.MAU_ID, M.MAMAU, M.TENMAU, M.NHOM_ABO, M.NHOM_RH, M.LOAIMAU_ID,          TK.SOLONHAP_ID, SLN.SOLONHAP, SLN.SOKIEMSOAT,TK.NGUONHANG_ID, NG.TENNGUONMAU, M.BENHVIEN_ID, M.DONVITINH_ID,K.TENKHO,DVT.TENDONVITINH]
2019-09-20 13:51:48,241 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM073']
2019-09-20 13:51:48,287 [5] DEBUG - Statement Id: [DAO00322_GetListMauTonKhoTruBooking] PreparedStatement : [select distinct          TK.MAU_KEY, TK.KHOMAU_ID, M.MAU_ID, M.MAMAU, M.TENMAU, M.NHOM_ABO, M.NHOM_RH, M.LOAIMAU_ID, M.DONVITINH_ID,          TK.SOLONHAP_ID, TK.SOLONHAP, TK.SOKIEMSOAT,M.PHAMVI, TK.NGUONHANG_ID, NG.TENNGUONMAU, M.BENHVIEN_ID,          TK.SOLUONG,TK.TENKHO,DVT.TENDONVITINH          from TM_MAU M          JOIN          (          select          A.MAU_KEY, A.KHOMAU_ID, A.MAU_ID ,a.NGUONHANG_ID, A.SOLONHAP_ID, A.SOLONHAP, A.SOKIEMSOAT, A.SOLUONG,A.TENKHO          from          (          select KHOMAU_ID, TK.MAU_ID, TK.NGUONHANG_ID, TK.MAU_KEY, SLN.SOLONHAP_ID, SLN.SOLONHAP, SLN.SOKIEMSOAT, ISNULL(TK.SOLUONG,0) - ISNULL(book.SOLUONG,0) as SOLUONG,K.TENKHO          from TT_MAU_TONKHO TK          JOIN TM_KHO K ON TK.KHOMAU_ID = K.KHO_ID          inner join TT_MAU_CHUNGTU_SOLONHAP SLN ON TK.SOLONHAP_ID = SLN.SOLONHAP_ID          left join dbo.TT_MAU_TONKHO_BOOK book ON book.MAU_KEY = TK.MAU_KEY AND book.TRANGTHAI = 'HIEULUC'          where ISNULL(TK.SOLUONG,0) - ISNULL(book.SOLUONG,0) > 0          ) A          )TK on TK.MAU_ID = M.MAU_ID and M.TAMNGUNG = '0'          LEFT JOIN TM_MAU_DONVITINH DVT on M.DONVITINH_ID=DVT.DONVITINH_ID          LEFT JOIN TM_NGUONMAU NG ON NG.NGUONMAU_ID = TK.NGUONHANG_ID]
2019-09-20 13:51:48,362 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM072']
2019-09-20 13:51:49,306 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'MAIN'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2019-09-20 13:51:50,537 [1] DEBUG - Statement Id: [DAO00002_FormList] PreparedStatement : [select              TM_SYS_FORM.HOSPITAL_ID,              TM_SYS_FORM.NAME,              TM_SYS_FORM.CLASS,              TM_SYS_FORM.ASSEMBLY,              TM_SYS_FORM.TITLE_VI as TITLE              from TM_SYS_FORM              where HOSPITAL_ID = 'HLU01']
2019-09-20 13:51:56,919 [1] DEBUG - Statement Id: [DAO00300_GetShortcutListByUserID] PreparedStatement : [SELECT S.SHORTCUT_CODE, S.SHORTCUT_VALUE              FROM TM_SHORTCUT AS S              WHERE S.BENHVIEN_ID = 'HLU01' AND S.USER_ID = '1' AND TAMNGUNG = '0']
2019-09-20 13:51:56,968 [1] DEBUG - Statement Id: [DAO00087_GetList] PreparedStatement : [select CODE, VALUE, BENHVIEN_ID              from TM_SYS_APPSETTINGS              where LOCKED = '0' and BENHVIEN_ID = 'HLU01'              order by SETTING_ID]
2019-09-20 13:51:57,189 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'MSG01'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2019-09-20 13:51:57,476 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'MSG02'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2019-09-20 13:51:59,994 [1] DEBUG - Statement Id: [DAO00008_GetUserSettings] PreparedStatement : [select A.*, B.TENKHO , C.TENPHONGBAN, B.MAKHO, C.MAPHONGBAN          from TM_SYS_USERS A          left join TM_KHODUOC B on B.KHODUOC_ID = A.INVENTORY_ID          left join TM_PHONGBAN C on (C.PHONGBAN_ID = A.WORKING_DEPT_ID and C.BENHVIEN_ID =  @param0 )          left join TM_SYS_USERKHO D on (D.ACCOUNT_ID = A.ACCOUNT_ID and D.HOSPITAL_ID =  @param0 )          where          A.HOSPITAL_ID =  @param0            and                 A.ACCOUNT_ID =  @param1]
2019-09-20 13:51:59,998 [1] DEBUG - Statement Id: [DAO00008_GetUserSettings] Parameters: [@param0=[HOSPITAL_ID,HLU01], @param1=[ACCOUNT_ID,113]]
2019-09-20 13:51:59,998 [1] DEBUG - Statement Id: [DAO00008_GetUserSettings] Types: [@param0=[String, System.String], @param1=[String, System.String]]
2019-09-20 13:52:00,043 [1] DEBUG - Statement Id: [DAO00008_GetUserInvSettings] PreparedStatement : [select A.*, B.TENKHO, B.MAKHO, B.LOAIKHO_ID, B.KHOQUANLY_ID          from TM_SYS_USERKHO A          left join TM_KHO B on B.MODULE_ID = A.MODULE_ID and B.KHO_ID = A.KHO_ID          where A.HOSPITAL_ID =  @param0  and A.ACCOUNT_ID =  @param1           order by B.TENKHO]
2019-09-20 13:52:00,043 [1] DEBUG - Statement Id: [DAO00008_GetUserInvSettings] Parameters: [@param0=[HOSPITAL_ID,HLU01], @param1=[ACCOUNT_ID,113]]
2019-09-20 13:52:00,043 [1] DEBUG - Statement Id: [DAO00008_GetUserInvSettings] Types: [@param0=[String, System.String], @param1=[String, System.String]]
2019-09-20 13:52:00,190 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'COM30'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2019-09-20 13:52:00,420 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'RIS04'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2019-09-20 13:52:09,968 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'MENU1'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2019-09-20 13:52:10,078 [1] DEBUG - Statement Id: [DAO00011_GetList] PreparedStatement : [select              TM_SYS_MENU.ID,              TM_SYS_MENU.PARENTID,              TM_SYS_MENU.SCREEN,              TM_SYS_MENU.SMALLIMAGE,              TM_SYS_MENU.LARGEIMAGE,              TM_SYS_MENU.DESCRIPTION,              TM_SYS_MENU.TYPE,              TM_SYS_MENU.TITLE_VI as TITLE              from TM_SYS_MENU              where TM_SYS_MENU.HOSPITAL_ID = 'HLU01' and TM_SYS_MENU.ACTIVE = '1'               AND                   (TM_SYS_MENU.TYPE & '8' = '8')                             order by TM_SYS_MENU.ORDERNUM]
2019-09-20 13:52:10,509 [1] DEBUG - Statement Id: [DAO00011_usermenu_list] PreparedStatement : [select              TM_SYS_HOMEMENU.MENUID as ID,              TM_SYS_MENU.TITLE_VI as TITLE,              TM_SYS_MENU.SCREEN,              TM_SYS_MENU.SMALLIMAGE,              TM_SYS_MENU.LARGEIMAGE,              TM_SYS_MENU.TYPE              from TM_SYS_HOMEMENU              left join TM_SYS_MENU on TM_SYS_MENU.ID = TM_SYS_HOMEMENU.MENUID and TM_SYS_MENU.HOSPITAL_ID = TM_SYS_HOMEMENU.HOSPITAL_ID              where TM_SYS_HOMEMENU.HOSPITAL_ID = 'HLU01' and TM_SYS_HOMEMENU.USERID = '113' and TM_SYS_MENU.ACTIVE = '1'               AND                   (TM_SYS_MENU.TYPE & '8' = '8')                             ORDER BY TM_SYS_HOMEMENU.ORDERNUM]
2019-09-20 13:53:20,321 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'COM31'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2019-09-20 13:53:20,468 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'ORM28'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2019-09-20 13:53:25,248 [1] DEBUG - Statement Id: [DAO00066_GetBENHAN_TIEPNHAN] PreparedStatement : [select top 1 *        from TT_NOITRU_BENHAN        where TIEPNHAN_ID = '27022'  and BENHVIEN_ID = 'HLU01'        order by NGAYTAO desc]
2019-09-20 13:53:25,339 [1] DEBUG - Statement Id: [DAO00014_GetInPatientStatus] PreparedStatement : [select TRANGTHAI, isnull(KHOACHUYENDEN_ID, KHOAVAO_ID) as KHOAHIENTAI from TT_NOITRU_BENHAN        where        TIEPNHAN_ID = '27022'        and BENHVIEN_ID = 'HLU01'         and           BENHAN_ID = '5800']
2019-09-20 13:53:25,432 [1] DEBUG - Statement Id: [DAO00048_TT_PHAUTHUAT_GetList] PreparedStatement : [select *              from TT_PHAUTHUAT               where                             TT_PHAUTHUAT.LOAI = 'P'                       and                           TT_PHAUTHUAT.TIEPNHAN_ID = 27022                       and                           TT_PHAUTHUAT.BENHVIEN_ID = 'HLU01'                                     order by PHAUTHUAT_ID DESC]
2019-09-20 13:53:25,478 [1] DEBUG - Statement Id: [DAO00048_GetListLoaiGacTrongPTTT] PreparedStatement : [select DICTIONARY_ID, DICTIONARY_CODE, DICTIONARY_NAME          from LST_DICTIONARY          where DICTIONARY_TYPE_CODE = 'LoaiGacPTTT'          and ENABLED = '1']
2019-09-20 13:53:30,842 [1] DEBUG - Statement Id: [DAO00048_GetDSLoaiGacDaGhiNhan] PreparedStatement : [select A.KIEMSOATGAC_ID, A.BENHNHAN_ID, A.TIEPNHAN_ID, A.BENHAN_ID, A.PHAUTHUAT_ID, A.LOAIPT_TT, A.LOAIGAC_ID          , A.NGAYGHINHAN, A.THOIGIANGHINHAN, A.SOLUONG, A.SOLUONGDASUDUNG, A.SOLUONGCONLAI, A.GHICHU, A.NGUOINHANDUNGCU_ID          , B.DICTIONARY_CODE AS MALOAIGAC, B.DICTIONARY_NAME AS TENLOAIGAC          from TT_PHAUTHUAT_GHINHANGAC A          inner join LST_DICTIONARY B on B.DICTIONARY_ID = A.LOAIGAC_ID          where A.PHAUTHUAT_ID = 3742 and A.BENHVIEN_ID = 'HLU01']
2019-09-20 13:53:33,335 [1] DEBUG - Statement Id: [DAO00048_GetDSLoaiGacDaGhiNhan] PreparedStatement : [select A.KIEMSOATGAC_ID, A.BENHNHAN_ID, A.TIEPNHAN_ID, A.BENHAN_ID, A.PHAUTHUAT_ID, A.LOAIPT_TT, A.LOAIGAC_ID          , A.NGAYGHINHAN, A.THOIGIANGHINHAN, A.SOLUONG, A.SOLUONGDASUDUNG, A.SOLUONGCONLAI, A.GHICHU, A.NGUOINHANDUNGCU_ID          , B.DICTIONARY_CODE AS MALOAIGAC, B.DICTIONARY_NAME AS TENLOAIGAC          from TT_PHAUTHUAT_GHINHANGAC A          inner join LST_DICTIONARY B on B.DICTIONARY_ID = A.LOAIGAC_ID          where A.PHAUTHUAT_ID = 3742 and A.BENHVIEN_ID = 'HLU01']
2019-09-20 13:54:24,569 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'COM98'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2019-09-20 13:54:34,308 [1] DEBUG - Statement Id: [DAO00048_DeleteLoaiGacById] PreparedStatement : [DELETE FROM TT_PHAUTHUAT_GHINHANGAC WHERE KIEMSOATGAC_ID = 5 AND BENHVIEN_ID = 'HLU01']
2019-09-20 13:55:03,709 [1] DEBUG - Statement Id: [DAO00066_GetBENHAN_TIEPNHAN] PreparedStatement : [select top 1 *        from TT_NOITRU_BENHAN        where TIEPNHAN_ID = '27022'  and BENHVIEN_ID = 'HLU01'        order by NGAYTAO desc]
2019-09-20 13:55:03,812 [1] DEBUG - Statement Id: [DAO00014_GetInPatientStatus] PreparedStatement : [select TRANGTHAI, isnull(KHOACHUYENDEN_ID, KHOAVAO_ID) as KHOAHIENTAI from TT_NOITRU_BENHAN        where        TIEPNHAN_ID = '27022'        and BENHVIEN_ID = 'HLU01'         and           BENHAN_ID = '5800']
2019-09-20 13:55:03,954 [1] DEBUG - Statement Id: [DAO00048_TT_PHAUTHUAT_GetList] PreparedStatement : [select *              from TT_PHAUTHUAT               where                             TT_PHAUTHUAT.LOAI = 'P'                       and                           TT_PHAUTHUAT.TIEPNHAN_ID = 27022                       and                           TT_PHAUTHUAT.BENHVIEN_ID = 'HLU01'                                     order by PHAUTHUAT_ID DESC]
2019-09-20 13:55:04,025 [1] DEBUG - Statement Id: [DAO00048_GetListLoaiGacTrongPTTT] PreparedStatement : [select DICTIONARY_ID, DICTIONARY_CODE, DICTIONARY_NAME          from LST_DICTIONARY          where DICTIONARY_TYPE_CODE = 'LoaiGacPTTT'          and ENABLED = '1']
2019-09-20 13:55:06,967 [1] DEBUG - Statement Id: [DAO00048_GetDSLoaiGacDaGhiNhan] PreparedStatement : [select A.KIEMSOATGAC_ID, A.BENHNHAN_ID, A.TIEPNHAN_ID, A.BENHAN_ID, A.PHAUTHUAT_ID, A.LOAIPT_TT, A.LOAIGAC_ID          , A.NGAYGHINHAN, A.THOIGIANGHINHAN, A.SOLUONG, A.SOLUONGDASUDUNG, A.SOLUONGCONLAI, A.GHICHU, A.NGUOINHANDUNGCU_ID          , B.DICTIONARY_CODE AS MALOAIGAC, B.DICTIONARY_NAME AS TENLOAIGAC          from TT_PHAUTHUAT_GHINHANGAC A          inner join LST_DICTIONARY B on B.DICTIONARY_ID = A.LOAIGAC_ID          where A.PHAUTHUAT_ID = 3742 and A.BENHVIEN_ID = 'HLU01']
2019-09-20 13:55:08,414 [1] DEBUG - Statement Id: [DAO00048_GetDSLoaiGacDaGhiNhan] PreparedStatement : [select A.KIEMSOATGAC_ID, A.BENHNHAN_ID, A.TIEPNHAN_ID, A.BENHAN_ID, A.PHAUTHUAT_ID, A.LOAIPT_TT, A.LOAIGAC_ID          , A.NGAYGHINHAN, A.THOIGIANGHINHAN, A.SOLUONG, A.SOLUONGDASUDUNG, A.SOLUONGCONLAI, A.GHICHU, A.NGUOINHANDUNGCU_ID          , B.DICTIONARY_CODE AS MALOAIGAC, B.DICTIONARY_NAME AS TENLOAIGAC          from TT_PHAUTHUAT_GHINHANGAC A          inner join LST_DICTIONARY B on B.DICTIONARY_ID = A.LOAIGAC_ID          where A.PHAUTHUAT_ID = 3742 and A.BENHVIEN_ID = 'HLU01']
--------------------------------------------------------------------------------
2019-09-20 13:57:40,355 [1] DEBUG - Statement Id: [DAO00001_DBList] PreparedStatement : [select *              from TM_SYS_SERVER              where HOSPITAL_ID = '_SYSTEM_' and TYPE = 'D']
2019-09-20 13:57:40,645 [1] DEBUG - Statement Id: [DAO00001_DaoList] PreparedStatement : [select              TM_SYS_SERVICEMAP.ID,              TM_SYS_SERVICEMAP.HOSPITAL_ID,              TM_SYS_SERVICEMAP.DB_NAME,              TM_SYS_SERVICEMAP.TYPE,              TM_SYS_SERVICEMAP.NAME,              TM_SYS_SERVICEMAP.CLASS,              (TM_SYS_DIC.VALUE + '.' + TM_SYS_SERVICEMAP.CLASS) as CLASSFULL,              TM_SYS_SERVICEMAP.ASSEMBLY              from TM_SYS_SERVICEMAP              inner join TM_SYS_DIC              on TM_SYS_SERVICEMAP.NAMESPACE = TM_SYS_DIC.ID              where HOSPITAL_ID = '_SYSTEM_' AND TYPE = 'D' AND ACTIVE = '1'              order by DB_NAME]
2019-09-20 13:57:40,687 [1] DEBUG - Statement Id: [DAO00001_ServiceList] PreparedStatement : [select              TM_SYS_SERVICEMAP.ID,              TM_SYS_SERVICEMAP.HOSPITAL_ID,              TM_SYS_SERVICEMAP.DB_NAME,              TM_SYS_SERVICEMAP.TYPE,              TM_SYS_SERVICEMAP.NAME,              TM_SYS_SERVICEMAP.CLASS,              (TM_SYS_DIC.VALUE + '.' + TM_SYS_SERVICEMAP.CLASS) as CLASSFULL,              TM_SYS_SERVICEMAP.ASSEMBLY,              TM_SYS_SERVER.URL              from TM_SYS_SERVICEMAP              inner join TM_SYS_DIC on TM_SYS_SERVICEMAP.NAMESPACE = TM_SYS_DIC.ID              inner join TM_SYS_SERVER on (TM_SYS_SERVICEMAP.DB_NAME = TM_SYS_SERVER.NAME) and (TM_SYS_SERVER.HOSPITAL_ID = '_SYSTEM_')              where TM_SYS_SERVICEMAP.HOSPITAL_ID = '_SYSTEM_' AND TM_SYS_SERVICEMAP.TYPE = 'S'  AND ACTIVE = '1'              order by URL]
2019-09-20 13:57:41,067 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = '_SYSTEM_'               AND                   TM_SYS_SCREEN.PAGE = 'LOGIN'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2019-09-20 13:57:41,316 [1] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = '_SYSTEM_'               AND                   TM_SYS_CACHE.ACTIVE = '1']
2019-09-20 13:57:46,123 [1] DEBUG - Statement Id: [DAO00001_DBList] PreparedStatement : [select *              from TM_SYS_SERVER              where HOSPITAL_ID = 'HLU01' and TYPE = 'D']
2019-09-20 13:57:46,155 [1] DEBUG - Statement Id: [DAO00001_DaoList] PreparedStatement : [select              TM_SYS_SERVICEMAP.ID,              TM_SYS_SERVICEMAP.HOSPITAL_ID,              TM_SYS_SERVICEMAP.DB_NAME,              TM_SYS_SERVICEMAP.TYPE,              TM_SYS_SERVICEMAP.NAME,              TM_SYS_SERVICEMAP.CLASS,              (TM_SYS_DIC.VALUE + '.' + TM_SYS_SERVICEMAP.CLASS) as CLASSFULL,              TM_SYS_SERVICEMAP.ASSEMBLY              from TM_SYS_SERVICEMAP              inner join TM_SYS_DIC              on TM_SYS_SERVICEMAP.NAMESPACE = TM_SYS_DIC.ID              where HOSPITAL_ID = 'HLU01' AND TYPE = 'D' AND ACTIVE = '1'              order by DB_NAME]
2019-09-20 13:57:47,749 [1] DEBUG - Statement Id: [DAO00001_ServiceList] PreparedStatement : [select              TM_SYS_SERVICEMAP.ID,              TM_SYS_SERVICEMAP.HOSPITAL_ID,              TM_SYS_SERVICEMAP.DB_NAME,              TM_SYS_SERVICEMAP.TYPE,              TM_SYS_SERVICEMAP.NAME,              TM_SYS_SERVICEMAP.CLASS,              (TM_SYS_DIC.VALUE + '.' + TM_SYS_SERVICEMAP.CLASS) as CLASSFULL,              TM_SYS_SERVICEMAP.ASSEMBLY,              TM_SYS_SERVER.URL              from TM_SYS_SERVICEMAP              inner join TM_SYS_DIC on TM_SYS_SERVICEMAP.NAMESPACE = TM_SYS_DIC.ID              inner join TM_SYS_SERVER on (TM_SYS_SERVICEMAP.DB_NAME = TM_SYS_SERVER.NAME) and (TM_SYS_SERVER.HOSPITAL_ID = 'HLU01')              where TM_SYS_SERVICEMAP.HOSPITAL_ID = 'HLU01' AND TM_SYS_SERVICEMAP.TYPE = 'S'  AND ACTIVE = '1'              order by URL]
2019-09-20 13:57:47,829 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1']
2019-09-20 13:57:48,686 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM005']
2019-09-20 13:57:48,850 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM015']
2019-09-20 13:57:48,961 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM067']
2019-09-20 13:57:49,038 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM008']
2019-09-20 13:57:49,129 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM068']
2019-09-20 13:57:49,203 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM006']
2019-09-20 13:57:49,285 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM030']
2019-09-20 13:57:49,369 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM025']
2019-09-20 13:57:50,095 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM024']
2019-09-20 13:57:51,027 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM033']
2019-09-20 13:57:51,069 [5] DEBUG - Statement Id: [DAO00027_GetListDuocKyGuiTonKho] PreparedStatement : [select  distinct TT_TONKHO.DUOC_KEY, LTRIM(TT_TONKHO.KHODUOC_ID) as KHODUOC_ID, TM_DUOC.DUOC_ID, TM_LOAIDUOC.MALOAIDUOC,TM_DUOC.SOVISA,TM_DUOC.TYLE_VAT,TM_DUOC.COTOA,        TM_DUOC.MADUOC, TM_DUOC.TENHANG, TM_DUOC.TENDUOCDAYDU, dvt.TENDONVITINH as DONVITINH,  TM_DUOC.DONVITINH_ID,TM_DUOC.BHYT,TM_DUOC.PHAMVI,        TM_DUOC.TENHOATCHAT, TM_DUOC.HAMLUONG, TM_DUOC.HANGSANXUAT, TM_DUOC.QUOCGIA, TM_DUOC.LOAIDUOC_ID, TM_DUOC.DUONGDUNG_ID,        TM_TENDUOC.TENDUOC, TM_TENDUOC.TENDUOC_EN, TM_TENDUOC.MAQUOCTE, TM_TENDUOC.MAQUOCTEBT,        TM_LOAIDUOC.LOAIVATTU_ID, TM_DUOC.BENHVIEN_ID,TT_TONKHO.SOLUONG, TT_TONKHO.NGUONDUOC_ID, NH.TENNGUONDUOC        , TAMNGUNG = CASE WHEN TM_DUOC.TAMNGUNG = '1' OR nh.TAMNGUNG = '1' OR KD.TAMNGUNG = '1' THEN '1' ELSE '0' END        , TM_DUOC.DANGTRINHBAY        from TM_DUOC        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = TM_DUOC.DONVITINH_ID        left join TM_TENDUOC on TM_DUOC.TENDUOC_ID = TM_TENDUOC.TENDUOC_ID and TM_DUOC.BENHVIEN_ID = 'HLU01' and TM_DUOC.TAMNGUNG = '0'        left join TM_LOAIDUOC on TM_LOAIDUOC.LOAIDUOC_ID = TM_DUOC.LOAIDUOC_ID and TM_LOAIDUOC.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG on (TM_LOAIDUOC.LOAIVATTU_ID = TM_DUOC_HANDUNG.LOAIDUOC and TM_DUOC_HANDUNG.BENHVIEN_ID = 'HLU01')        inner join        (select LTRIM(A.KHODUOC_ID) + '_' + LTRIM(A.DUOC_ID) + '_' + LTRIM(ISNULL(A.NGUONDUOC_ID,'')) as DUOC_KEY, A.KHODUOC_ID, A.DUOC_ID,A.NGUONDUOC_ID,        SUM(isnull(A.SOLUONG,0)) as SOLUONG        from        (select SUM(SOLUONG) as SOLUONG, KHODUOC_ID, DUOC_ID, NGUONDUOC_ID from TT_DUOC_KYGUI_TONKHO        where BENHVIEN_ID = 'HLU01' group by KHODUOC_ID, DUOC_ID, NGUONDUOC_ID) A        group by LTRIM(A.KHODUOC_ID) + '_' + LTRIM(A.DUOC_ID) + '_' + LTRIM(A.NGUONDUOC_ID), A.KHODUOC_ID, A.DUOC_ID, A.NGUONDUOC_ID)        TT_TONKHO on TT_TONKHO.DUOC_ID = TM_DUOC.DUOC_ID        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = TT_TONKHO.NGUONDUOC_ID and nh.BENHVIEN_ID = 'HLU01'        LEFT JOIN TM_KHODUOC KD ON KD.KHODUOC_ID = TT_TONKHO.KHODUOC_ID        where TM_DUOC.BENHVIEN_ID = 'HLU01' AND TT_TONKHO.SOLUONG >= 0]
2019-09-20 13:57:51,235 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM018']
2019-09-20 13:57:52,071 [5] DEBUG - Statement Id: [DAO00027_GetListDuocTonKho] PreparedStatement : [select distinct TT_TONKHO.DUOC_KEY, LTRIM(TT_TONKHO.KHODUOC_ID) as KHODUOC_ID, TM_DUOC.DUOC_ID, TM_LOAIDUOC.MALOAIDUOC,TM_DUOC.SOVISA,TM_DUOC.TYLE_VAT,TM_DUOC.COTOA,        TM_DUOC.MADUOC, TM_DUOC.TENHANG, TM_DUOC.TENDUOCDAYDU, dvt.TENDONVITINH as DONVITINH,  TM_DUOC.DONVITINH_ID,TM_DUOC.BHYT,                TM_DUOC.TENHOATCHAT,          TM_DUOC.HAMLUONG, TM_DUOC.HANGSANXUAT, TM_DUOC.QUOCGIA, TM_DUOC.LOAIDUOC_ID, TM_DUOC.DUONGDUNG_ID,        TM_TENDUOC.TENDUOC, TM_TENDUOC.TENDUOC_EN, TM_TENDUOC.MAQUOCTE, TM_TENDUOC.MAQUOCTEBT,        TM_LOAIDUOC.LOAIVATTU_ID, TM_DUOC.BENHVIEN_ID,        TT_TONKHO.SOLUONG, TM_DUOC.VTYT_PHANLOAI, TM_DUOC.PHAMVI, TT_TONKHO.NGUONDUOC_ID, NG.TENNGUONDUOC AS TENNGUONDUOC        , TAMNGUNG = CASE WHEN TM_DUOC.TAMNGUNG = '1' OR NG.TAMNGUNG = '1' OR KD.TAMNGUNG = '1' THEN '1' ELSE '0' END        , TM_DUOC.DANGTRINHBAY        from TM_DUOC        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = TM_DUOC.DONVITINH_ID        left join TM_TENDUOC on TM_DUOC.TENDUOC_ID = TM_TENDUOC.TENDUOC_ID and TM_DUOC.BENHVIEN_ID = 'HLU01' and TM_DUOC.TAMNGUNG = '0'        left join TM_LOAIDUOC on TM_LOAIDUOC.LOAIDUOC_ID = TM_DUOC.LOAIDUOC_ID and TM_LOAIDUOC.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG on (TM_LOAIDUOC.LOAIVATTU_ID = TM_DUOC_HANDUNG.LOAIDUOC and TM_DUOC_HANDUNG.BENHVIEN_ID = 'HLU01')        inner join        (select LTRIM(A.KHODUOC_ID) + '_' + LTRIM(A.DUOC_ID) + '_' + LTRIM(ISNULL(A.NGUONDUOC_ID,'')) as DUOC_KEY, A.KHODUOC_ID, A.DUOC_ID, A.NGUONDUOC_ID,        SUM(isnull(A.SOLUONG,0)) as SOLUONG        from        (select SUM(SOLUONG) as SOLUONG, KHODUOC_ID, DUOC_ID, NGUONDUOC_ID from TT_DUOC_TONKHO        where BENHVIEN_ID = 'HLU01' group by KHODUOC_ID, DUOC_ID, NGUONDUOC_ID) A        group by LTRIM(A.KHODUOC_ID) + '_' + LTRIM(A.DUOC_ID) + '_' + LTRIM(ISNULL(A.NGUONDUOC_ID,'')), A.KHODUOC_ID, A.DUOC_ID, NGUONDUOC_ID        ) TT_TONKHO on TT_TONKHO.DUOC_ID = TM_DUOC.DUOC_ID        LEFT JOIN TM_NGUONHANG NG ON NG.NGUONDUOC_ID = TT_TONKHO.NGUONDUOC_ID        LEFT JOIN TM_KHODUOC KD ON KD.KHODUOC_ID = TT_TONKHO.KHODUOC_ID        where TM_DUOC.BENHVIEN_ID = 'HLU01' and TT_TONKHO.SOLUONG >= 0]
2019-09-20 13:57:56,839 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM023']
2019-09-20 13:57:56,875 [5] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoVaBooking] PreparedStatement : [declare @NGUONDUOC_MACDINH varchar(5) = '0';        declare @TOAMUANGOAI int = 0;        select @NGUONDUOC_MACDINH = isnull(VALUE,0) from TM_SYS_APPSETTINGS where CODE = 'PHA_NGUONDUOC'        select @TOAMUANGOAI = isnull(VALUE,0) from TM_SYS_APPSETTINGS where CODE = 'OPD_TOAMUANGOAI_DUNGDANHMUC_DUOC'                if @TOAMUANGOAI = 1        begin        select  distinct '0' + '_' + LTRIM(d.DUOC_ID) + '_' + @NGUONDUOC_MACDINH as DUOC_KEY, 0 as PHAMVI_ID, @NGUONDUOC_MACDINH as NGUONDUOC_ID, null as TENNGUONDUOC, null as TINHTIEN, d.DUOC_ID, ld.MALOAIDUOC,        d.SOVISA,d.TYLE_VAT,d.COTOA, d.MADUOC, d.TENHANG, d.TENDUOCDAYDU, d.DONVITINH as DONVITINH, d.BHYT,        d.TENHOATCHAT, d.HAMLUONG, d.HANGSANXUAT, d.QUOCGIA, d.LOAIDUOC_ID, d.DUONGDUNG_ID, d.TINHTIEN_PTTT,        ten.TENDUOC, ten.TENDUOC_EN, ten.MAQUOCTE, ten.MAQUOCTEBT,        '' as BHYT_TEXT        , ld.LOAIVATTU_ID        , d.BENHVIEN_ID,        999999999 as SOLUONG, d.VTYT_PHANLOAI, d.PHAMVI, d.SUASOLUONGTONGHOP, d.MADUOCBV, d.DANGTRINHBAY        , TAMNGUNG = CASE WHEN d.TAMNGUNG = '1' THEN '1' ELSE '0' END        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        union all        select  distinct tk.DUOC_KEY, LTRIM(tk.PHAMVI_ID) as PHAMVI_ID, tk.NGUONDUOC_ID, nh.TENNGUONDUOC, nh.TINHTIEN, d.DUOC_ID, ld.MALOAIDUOC,        d.SOVISA,d.TYLE_VAT,d.COTOA, d.MADUOC, d.TENHANG, d.TENDUOCDAYDU, d.DONVITINH as DONVITINH, d.BHYT,        d.TENHOATCHAT, d.HAMLUONG, d.HANGSANXUAT, d.QUOCGIA, d.LOAIDUOC_ID, d.DUONGDUNG_ID, d.TINHTIEN_PTTT,        ten.TENDUOC, ten.TENDUOC_EN, ten.MAQUOCTE, ten.MAQUOCTEBT,        CASE WHEN d.BHYT = '1' THEN 'BHYT' ELSE '' END as BHYT_TEXT        , ld.LOAIVATTU_ID        , d.BENHVIEN_ID,        tk.SOLUONG, d.VTYT_PHANLOAI, d.PHAMVI, d.SUASOLUONGTONGHOP, d.MADUOCBV, d.DANGTRINHBAY        , TAMNGUNG = CASE WHEN d.TAMNGUNG = '1' OR nh.TAMNGUNG = '1' OR kd.TAMNGUNG = '1' THEN '1' ELSE '0' END        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        inner join        (        select  LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')) DUOC_KEY, (SUM(dtk.SOLUONG) - isnull(sum(A.SOLUONG),0) - isnull(sum(B.SOLUONG),0)) SOLUONG, pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        from (select sum(soluong) soluong,duoc_id,nguonduoc_id,khoduoc_id,benhvien_id from TT_DUOC_TONKHO  group by duoc_id,nguonduoc_id,khoduoc_id,benhvien_id) dtk        inner join TM_DUOC_PHAMVISD_MAPPING pvsd on dtk.KHODUOC_ID = pvsd.KHODUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NOITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) B on B.DUOC_ID = dtk.DUOC_ID and B.SOLUONG > 0 and B.PHAMVI_ID = pvsd.PHAMVI_ID and B.NGUONHANG_ID = dtk.NGUONDUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NGOAITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) A on A.DUOC_ID = dtk.DUOC_ID and A.SOLUONG > 0 and A.PHAMVI_ID = pvsd.PHAMVI_ID and A.NGUONHANG_ID = dtk.NGUONDUOC_ID        where dtk.SOLUONG > 0 and dtk.BENHVIEN_ID = 'HLU01'        group by LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')), pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        ) tk on tk.DUOC_ID = d.DUOC_ID        left join TM_DUOC_PHAMVISUDUNG kd on kd.PHAMVI_ID = tk.PHAMVI_ID and kd.BENHVIEN_ID = 'HLU01'        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = tk.NGUONDUOC_ID and nh.BENHVIEN_ID = 'HLU01'        where d.BENHVIEN_ID = 'HLU01'  and tk.SOLUONG >= 0        end        else        begin                  select  distinct tk.DUOC_KEY, LTRIM(tk.PHAMVI_ID) as PHAMVI_ID, tk.NGUONDUOC_ID, nh.TENNGUONDUOC, nh.TINHTIEN, d.DUOC_ID, ld.MALOAIDUOC,        d.SOVISA,d.TYLE_VAT,d.COTOA, d.MADUOC, d.TENHANG, d.TENDUOCDAYDU, d.DONVITINH as DONVITINH, d.BHYT,        d.TENHOATCHAT, d.HAMLUONG, d.HANGSANXUAT, d.QUOCGIA, d.LOAIDUOC_ID, d.DUONGDUNG_ID, d.TINHTIEN_PTTT,        ten.TENDUOC, ten.TENDUOC_EN, ten.MAQUOCTE, ten.MAQUOCTEBT,        CASE WHEN d.BHYT = '1' THEN 'BHYT' ELSE '' END as BHYT_TEXT        , ld.LOAIVATTU_ID        , d.BENHVIEN_ID,        tk.SOLUONG, d.VTYT_PHANLOAI, d.PHAMVI, d.SUASOLUONGTONGHOP, d.MADUOCBV, d.DANGTRINHBAY        , TAMNGUNG = CASE WHEN d.TAMNGUNG = '1' OR nh.TAMNGUNG = '1' OR kd.TAMNGUNG = '1' THEN '1' ELSE '0' END        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        inner join        (        select  LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')) DUOC_KEY, (SUM(dtk.SOLUONG) - isnull(sum(A.SOLUONG),0) - isnull(sum(B.SOLUONG),0)) SOLUONG, pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        from (select sum(soluong) soluong,duoc_id,nguonduoc_id,khoduoc_id,benhvien_id from TT_DUOC_TONKHO  group by duoc_id,nguonduoc_id,khoduoc_id,benhvien_id) dtk        inner join TM_DUOC_PHAMVISD_MAPPING pvsd on dtk.KHODUOC_ID = pvsd.KHODUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NOITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) B on B.DUOC_ID = dtk.DUOC_ID and B.SOLUONG > 0 and B.PHAMVI_ID = pvsd.PHAMVI_ID and B.NGUONHANG_ID = dtk.NGUONDUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NGOAITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) A on A.DUOC_ID = dtk.DUOC_ID and A.SOLUONG > 0 and A.PHAMVI_ID = pvsd.PHAMVI_ID and A.NGUONHANG_ID = dtk.NGUONDUOC_ID        where dtk.SOLUONG > 0 and dtk.BENHVIEN_ID = 'HLU01'        group by LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')), pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        ) tk on tk.DUOC_ID = d.DUOC_ID        left join TM_DUOC_PHAMVISUDUNG kd on kd.PHAMVI_ID = tk.PHAMVI_ID and kd.BENHVIEN_ID = 'HLU01'        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = tk.NGUONDUOC_ID and nh.BENHVIEN_ID = 'HLU01'        where d.BENHVIEN_ID = 'HLU01'  and tk.SOLUONG >= 0        end]
2019-09-20 13:57:59,680 [5] DEBUG - Statement Id: [DAO00320_GetList] PreparedStatement : [select M.*            from TM_MAU M            LEFT JOIN TM_MAU_DONVITINH DVT on M.DONVITINH_ID=DVT.DONVITINH_ID            where            M.TAMNGUNG = '0'            and M.BENHVIEN_ID = 'HLU01'            order by M.TENMAU]
2019-09-20 13:58:00,521 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM071']
2019-09-20 13:58:00,557 [5] DEBUG - Statement Id: [DAO00322_GetListMauTonKhoForCreateCached] PreparedStatement : [SELECT DISTINCT          TK.MAU_KEY, TK.KHOMAU_ID, M.MAU_ID, M.MAMAU, M.TENMAU, M.NHOM_ABO, M.NHOM_RH, M.LOAIMAU_ID,          TK.SOLONHAP_ID, SLN.SOLONHAP, SLN.SOKIEMSOAT, TK.NGUONHANG_ID, NG.TENNGUONMAU, M.BENHVIEN_ID, M.DONVITINH_ID,          SUM(tk.SOLUONG) AS SOLUONG,K.TENKHO,DVT.TENDONVITINH          FROM TT_MAU_TONKHO TK          JOIN TM_KHO K ON TK.KHOMAU_ID = K.KHO_ID          JOIN TT_MAU_CHUNGTU_SOLONHAP SLN ON TK.SOLONHAP_ID = SLN.SOLONHAP_ID          JOIN TM_MAU M on TK.MAU_ID = M.MAU_ID and M.TAMNGUNG = '0'          LEFT JOIN TM_MAU_DONVITINH DVT on M.DONVITINH_ID=DVT.DONVITINH_ID          LEFT JOIN TM_NGUONMAU NG ON NG.NGUONMAU_ID = TK.NGUONHANG_ID          WHERE TK.SOLUONG > 0          GROUP BY TK.MAU_KEY, TK.KHOMAU_ID, M.MAU_ID, M.MAMAU, M.TENMAU, M.NHOM_ABO, M.NHOM_RH, M.LOAIMAU_ID,          TK.SOLONHAP_ID, SLN.SOLONHAP, SLN.SOKIEMSOAT,TK.NGUONHANG_ID, NG.TENNGUONMAU, M.BENHVIEN_ID, M.DONVITINH_ID,K.TENKHO,DVT.TENDONVITINH]
2019-09-20 13:58:00,654 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM073']
2019-09-20 13:58:00,695 [5] DEBUG - Statement Id: [DAO00322_GetListMauTonKhoTruBooking] PreparedStatement : [select distinct          TK.MAU_KEY, TK.KHOMAU_ID, M.MAU_ID, M.MAMAU, M.TENMAU, M.NHOM_ABO, M.NHOM_RH, M.LOAIMAU_ID, M.DONVITINH_ID,          TK.SOLONHAP_ID, TK.SOLONHAP, TK.SOKIEMSOAT,M.PHAMVI, TK.NGUONHANG_ID, NG.TENNGUONMAU, M.BENHVIEN_ID,          TK.SOLUONG,TK.TENKHO,DVT.TENDONVITINH          from TM_MAU M          JOIN          (          select          A.MAU_KEY, A.KHOMAU_ID, A.MAU_ID ,a.NGUONHANG_ID, A.SOLONHAP_ID, A.SOLONHAP, A.SOKIEMSOAT, A.SOLUONG,A.TENKHO          from          (          select KHOMAU_ID, TK.MAU_ID, TK.NGUONHANG_ID, TK.MAU_KEY, SLN.SOLONHAP_ID, SLN.SOLONHAP, SLN.SOKIEMSOAT, ISNULL(TK.SOLUONG,0) - ISNULL(book.SOLUONG,0) as SOLUONG,K.TENKHO          from TT_MAU_TONKHO TK          JOIN TM_KHO K ON TK.KHOMAU_ID = K.KHO_ID          inner join TT_MAU_CHUNGTU_SOLONHAP SLN ON TK.SOLONHAP_ID = SLN.SOLONHAP_ID          left join dbo.TT_MAU_TONKHO_BOOK book ON book.MAU_KEY = TK.MAU_KEY AND book.TRANGTHAI = 'HIEULUC'          where ISNULL(TK.SOLUONG,0) - ISNULL(book.SOLUONG,0) > 0          ) A          )TK on TK.MAU_ID = M.MAU_ID and M.TAMNGUNG = '0'          LEFT JOIN TM_MAU_DONVITINH DVT on M.DONVITINH_ID=DVT.DONVITINH_ID          LEFT JOIN TM_NGUONMAU NG ON NG.NGUONMAU_ID = TK.NGUONHANG_ID]
2019-09-20 13:58:00,771 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM072']
2019-09-20 13:58:01,691 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'MAIN'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2019-09-20 13:58:02,541 [1] DEBUG - Statement Id: [DAO00002_FormList] PreparedStatement : [select              TM_SYS_FORM.HOSPITAL_ID,              TM_SYS_FORM.NAME,              TM_SYS_FORM.CLASS,              TM_SYS_FORM.ASSEMBLY,              TM_SYS_FORM.TITLE_VI as TITLE              from TM_SYS_FORM              where HOSPITAL_ID = 'HLU01']
2019-09-20 13:58:07,338 [1] DEBUG - Statement Id: [DAO00300_GetShortcutListByUserID] PreparedStatement : [SELECT S.SHORTCUT_CODE, S.SHORTCUT_VALUE              FROM TM_SHORTCUT AS S              WHERE S.BENHVIEN_ID = 'HLU01' AND S.USER_ID = '1' AND TAMNGUNG = '0']
2019-09-20 13:58:07,369 [1] DEBUG - Statement Id: [DAO00087_GetList] PreparedStatement : [select CODE, VALUE, BENHVIEN_ID              from TM_SYS_APPSETTINGS              where LOCKED = '0' and BENHVIEN_ID = 'HLU01'              order by SETTING_ID]
2019-09-20 13:58:07,457 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'MSG01'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2019-09-20 13:58:07,582 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'MSG02'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2019-09-20 13:58:07,716 [1] DEBUG - Statement Id: [DAO00008_GetUserSettings] PreparedStatement : [select A.*, B.TENKHO , C.TENPHONGBAN, B.MAKHO, C.MAPHONGBAN          from TM_SYS_USERS A          left join TM_KHODUOC B on B.KHODUOC_ID = A.INVENTORY_ID          left join TM_PHONGBAN C on (C.PHONGBAN_ID = A.WORKING_DEPT_ID and C.BENHVIEN_ID =  @param0 )          left join TM_SYS_USERKHO D on (D.ACCOUNT_ID = A.ACCOUNT_ID and D.HOSPITAL_ID =  @param0 )          where          A.HOSPITAL_ID =  @param0            and                 A.ACCOUNT_ID =  @param1]
2019-09-20 13:58:07,718 [1] DEBUG - Statement Id: [DAO00008_GetUserSettings] Parameters: [@param0=[HOSPITAL_ID,HLU01], @param1=[ACCOUNT_ID,113]]
2019-09-20 13:58:07,718 [1] DEBUG - Statement Id: [DAO00008_GetUserSettings] Types: [@param0=[String, System.String], @param1=[String, System.String]]
2019-09-20 13:58:07,750 [1] DEBUG - Statement Id: [DAO00008_GetUserInvSettings] PreparedStatement : [select A.*, B.TENKHO, B.MAKHO, B.LOAIKHO_ID, B.KHOQUANLY_ID          from TM_SYS_USERKHO A          left join TM_KHO B on B.MODULE_ID = A.MODULE_ID and B.KHO_ID = A.KHO_ID          where A.HOSPITAL_ID =  @param0  and A.ACCOUNT_ID =  @param1           order by B.TENKHO]
2019-09-20 13:58:07,750 [1] DEBUG - Statement Id: [DAO00008_GetUserInvSettings] Parameters: [@param0=[HOSPITAL_ID,HLU01], @param1=[ACCOUNT_ID,113]]
2019-09-20 13:58:07,750 [1] DEBUG - Statement Id: [DAO00008_GetUserInvSettings] Types: [@param0=[String, System.String], @param1=[String, System.String]]
2019-09-20 13:58:07,879 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'COM30'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2019-09-20 13:58:08,060 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'RIS04'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2019-09-20 13:58:15,068 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'MENU1'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2019-09-20 13:58:15,427 [1] DEBUG - Statement Id: [DAO00011_GetList] PreparedStatement : [select              TM_SYS_MENU.ID,              TM_SYS_MENU.PARENTID,              TM_SYS_MENU.SCREEN,              TM_SYS_MENU.SMALLIMAGE,              TM_SYS_MENU.LARGEIMAGE,              TM_SYS_MENU.DESCRIPTION,              TM_SYS_MENU.TYPE,              TM_SYS_MENU.TITLE_VI as TITLE              from TM_SYS_MENU              where TM_SYS_MENU.HOSPITAL_ID = 'HLU01' and TM_SYS_MENU.ACTIVE = '1'               AND                   (TM_SYS_MENU.TYPE & '8' = '8')                             order by TM_SYS_MENU.ORDERNUM]
2019-09-20 13:58:15,704 [1] DEBUG - Statement Id: [DAO00011_usermenu_list] PreparedStatement : [select              TM_SYS_HOMEMENU.MENUID as ID,              TM_SYS_MENU.TITLE_VI as TITLE,              TM_SYS_MENU.SCREEN,              TM_SYS_MENU.SMALLIMAGE,              TM_SYS_MENU.LARGEIMAGE,              TM_SYS_MENU.TYPE              from TM_SYS_HOMEMENU              left join TM_SYS_MENU on TM_SYS_MENU.ID = TM_SYS_HOMEMENU.MENUID and TM_SYS_MENU.HOSPITAL_ID = TM_SYS_HOMEMENU.HOSPITAL_ID              where TM_SYS_HOMEMENU.HOSPITAL_ID = 'HLU01' and TM_SYS_HOMEMENU.USERID = '113' and TM_SYS_MENU.ACTIVE = '1'               AND                   (TM_SYS_MENU.TYPE & '8' = '8')                             ORDER BY TM_SYS_HOMEMENU.ORDERNUM]
2019-09-20 13:58:19,460 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'COM31'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2019-09-20 13:58:20,978 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'ORM28'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2019-09-20 13:58:26,221 [1] DEBUG - Statement Id: [DAO00066_GetBENHAN_TIEPNHAN] PreparedStatement : [select top 1 *        from TT_NOITRU_BENHAN        where TIEPNHAN_ID = '27022'  and BENHVIEN_ID = 'HLU01'        order by NGAYTAO desc]
2019-09-20 13:58:26,313 [1] DEBUG - Statement Id: [DAO00014_GetInPatientStatus] PreparedStatement : [select TRANGTHAI, isnull(KHOACHUYENDEN_ID, KHOAVAO_ID) as KHOAHIENTAI from TT_NOITRU_BENHAN        where        TIEPNHAN_ID = '27022'        and BENHVIEN_ID = 'HLU01'         and           BENHAN_ID = '5800']
2019-09-20 13:58:26,406 [1] DEBUG - Statement Id: [DAO00048_TT_PHAUTHUAT_GetList] PreparedStatement : [select *              from TT_PHAUTHUAT               where                             TT_PHAUTHUAT.LOAI = 'P'                       and                           TT_PHAUTHUAT.TIEPNHAN_ID = 27022                       and                           TT_PHAUTHUAT.BENHVIEN_ID = 'HLU01'                                     order by PHAUTHUAT_ID DESC]
2019-09-20 13:58:26,460 [1] DEBUG - Statement Id: [DAO00048_GetListLoaiGacTrongPTTT] PreparedStatement : [select DICTIONARY_ID, DICTIONARY_CODE, DICTIONARY_NAME          from LST_DICTIONARY          where DICTIONARY_TYPE_CODE = 'LoaiGacPTTT'          and ENABLED = '1']
2019-09-20 13:58:29,825 [1] DEBUG - Statement Id: [DAO00048_GetDSLoaiGacDaGhiNhan] PreparedStatement : [select A.KIEMSOATGAC_ID, A.BENHNHAN_ID, A.TIEPNHAN_ID, A.BENHAN_ID, A.PHAUTHUAT_ID, A.LOAIPT_TT, A.LOAIGAC_ID          , A.NGAYGHINHAN, A.THOIGIANGHINHAN, A.SOLUONG, A.SOLUONGDASUDUNG, A.SOLUONGCONLAI, A.GHICHU, A.NGUOINHANDUNGCU_ID          , B.DICTIONARY_CODE AS MALOAIGAC, B.DICTIONARY_NAME AS TENLOAIGAC          from TT_PHAUTHUAT_GHINHANGAC A          inner join LST_DICTIONARY B on B.DICTIONARY_ID = A.LOAIGAC_ID          where A.PHAUTHUAT_ID = 3742 and A.BENHVIEN_ID = 'HLU01']
2019-09-20 13:58:31,442 [1] DEBUG - Statement Id: [DAO00048_GetDSLoaiGacDaGhiNhan] PreparedStatement : [select A.KIEMSOATGAC_ID, A.BENHNHAN_ID, A.TIEPNHAN_ID, A.BENHAN_ID, A.PHAUTHUAT_ID, A.LOAIPT_TT, A.LOAIGAC_ID          , A.NGAYGHINHAN, A.THOIGIANGHINHAN, A.SOLUONG, A.SOLUONGDASUDUNG, A.SOLUONGCONLAI, A.GHICHU, A.NGUOINHANDUNGCU_ID          , B.DICTIONARY_CODE AS MALOAIGAC, B.DICTIONARY_NAME AS TENLOAIGAC          from TT_PHAUTHUAT_GHINHANGAC A          inner join LST_DICTIONARY B on B.DICTIONARY_ID = A.LOAIGAC_ID          where A.PHAUTHUAT_ID = 3742 and A.BENHVIEN_ID = 'HLU01']
2019-09-20 13:58:38,164 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'COM98'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2019-09-20 13:58:54,773 [1] DEBUG - Statement Id: [DAO00048_DeleteLoaiGacById] PreparedStatement : [DELETE FROM TT_PHAUTHUAT_GHINHANGAC WHERE KIEMSOATGAC_ID = 4 AND BENHVIEN_ID = 'HLU01'            SELECT 4]
--------------------------------------------------------------------------------
2019-09-20 14:00:17,357 [1] DEBUG - Statement Id: [DAO00001_DBList] PreparedStatement : [select *              from TM_SYS_SERVER              where HOSPITAL_ID = '_SYSTEM_' and TYPE = 'D']
2019-09-20 14:00:17,774 [1] DEBUG - Statement Id: [DAO00001_DaoList] PreparedStatement : [select              TM_SYS_SERVICEMAP.ID,              TM_SYS_SERVICEMAP.HOSPITAL_ID,              TM_SYS_SERVICEMAP.DB_NAME,              TM_SYS_SERVICEMAP.TYPE,              TM_SYS_SERVICEMAP.NAME,              TM_SYS_SERVICEMAP.CLASS,              (TM_SYS_DIC.VALUE + '.' + TM_SYS_SERVICEMAP.CLASS) as CLASSFULL,              TM_SYS_SERVICEMAP.ASSEMBLY              from TM_SYS_SERVICEMAP              inner join TM_SYS_DIC              on TM_SYS_SERVICEMAP.NAMESPACE = TM_SYS_DIC.ID              where HOSPITAL_ID = '_SYSTEM_' AND TYPE = 'D' AND ACTIVE = '1'              order by DB_NAME]
2019-09-20 14:00:17,825 [1] DEBUG - Statement Id: [DAO00001_ServiceList] PreparedStatement : [select              TM_SYS_SERVICEMAP.ID,              TM_SYS_SERVICEMAP.HOSPITAL_ID,              TM_SYS_SERVICEMAP.DB_NAME,              TM_SYS_SERVICEMAP.TYPE,              TM_SYS_SERVICEMAP.NAME,              TM_SYS_SERVICEMAP.CLASS,              (TM_SYS_DIC.VALUE + '.' + TM_SYS_SERVICEMAP.CLASS) as CLASSFULL,              TM_SYS_SERVICEMAP.ASSEMBLY,              TM_SYS_SERVER.URL              from TM_SYS_SERVICEMAP              inner join TM_SYS_DIC on TM_SYS_SERVICEMAP.NAMESPACE = TM_SYS_DIC.ID              inner join TM_SYS_SERVER on (TM_SYS_SERVICEMAP.DB_NAME = TM_SYS_SERVER.NAME) and (TM_SYS_SERVER.HOSPITAL_ID = '_SYSTEM_')              where TM_SYS_SERVICEMAP.HOSPITAL_ID = '_SYSTEM_' AND TM_SYS_SERVICEMAP.TYPE = 'S'  AND ACTIVE = '1'              order by URL]
2019-09-20 14:00:18,245 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = '_SYSTEM_'               AND                   TM_SYS_SCREEN.PAGE = 'LOGIN'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2019-09-20 14:00:18,497 [1] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = '_SYSTEM_'               AND                   TM_SYS_CACHE.ACTIVE = '1']
2019-09-20 14:00:24,481 [1] DEBUG - Statement Id: [DAO00001_DBList] PreparedStatement : [select *              from TM_SYS_SERVER              where HOSPITAL_ID = 'HLU01' and TYPE = 'D']
2019-09-20 14:00:24,530 [1] DEBUG - Statement Id: [DAO00001_DaoList] PreparedStatement : [select              TM_SYS_SERVICEMAP.ID,              TM_SYS_SERVICEMAP.HOSPITAL_ID,              TM_SYS_SERVICEMAP.DB_NAME,              TM_SYS_SERVICEMAP.TYPE,              TM_SYS_SERVICEMAP.NAME,              TM_SYS_SERVICEMAP.CLASS,              (TM_SYS_DIC.VALUE + '.' + TM_SYS_SERVICEMAP.CLASS) as CLASSFULL,              TM_SYS_SERVICEMAP.ASSEMBLY              from TM_SYS_SERVICEMAP              inner join TM_SYS_DIC              on TM_SYS_SERVICEMAP.NAMESPACE = TM_SYS_DIC.ID              where HOSPITAL_ID = 'HLU01' AND TYPE = 'D' AND ACTIVE = '1'              order by DB_NAME]
2019-09-20 14:00:26,102 [1] DEBUG - Statement Id: [DAO00001_ServiceList] PreparedStatement : [select              TM_SYS_SERVICEMAP.ID,              TM_SYS_SERVICEMAP.HOSPITAL_ID,              TM_SYS_SERVICEMAP.DB_NAME,              TM_SYS_SERVICEMAP.TYPE,              TM_SYS_SERVICEMAP.NAME,              TM_SYS_SERVICEMAP.CLASS,              (TM_SYS_DIC.VALUE + '.' + TM_SYS_SERVICEMAP.CLASS) as CLASSFULL,              TM_SYS_SERVICEMAP.ASSEMBLY,              TM_SYS_SERVER.URL              from TM_SYS_SERVICEMAP              inner join TM_SYS_DIC on TM_SYS_SERVICEMAP.NAMESPACE = TM_SYS_DIC.ID              inner join TM_SYS_SERVER on (TM_SYS_SERVICEMAP.DB_NAME = TM_SYS_SERVER.NAME) and (TM_SYS_SERVER.HOSPITAL_ID = 'HLU01')              where TM_SYS_SERVICEMAP.HOSPITAL_ID = 'HLU01' AND TM_SYS_SERVICEMAP.TYPE = 'S'  AND ACTIVE = '1'              order by URL]
2019-09-20 14:00:26,578 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1']
2019-09-20 14:00:27,462 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM005']
2019-09-20 14:00:27,620 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM015']
2019-09-20 14:00:28,022 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM067']
2019-09-20 14:00:28,101 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM008']
2019-09-20 14:00:28,182 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM068']
2019-09-20 14:00:28,267 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM006']
2019-09-20 14:00:28,348 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM030']
2019-09-20 14:00:28,434 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM025']
2019-09-20 14:00:28,538 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM024']
2019-09-20 14:00:29,078 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM033']
2019-09-20 14:00:29,136 [5] DEBUG - Statement Id: [DAO00027_GetListDuocKyGuiTonKho] PreparedStatement : [select  distinct TT_TONKHO.DUOC_KEY, LTRIM(TT_TONKHO.KHODUOC_ID) as KHODUOC_ID, TM_DUOC.DUOC_ID, TM_LOAIDUOC.MALOAIDUOC,TM_DUOC.SOVISA,TM_DUOC.TYLE_VAT,TM_DUOC.COTOA,        TM_DUOC.MADUOC, TM_DUOC.TENHANG, TM_DUOC.TENDUOCDAYDU, dvt.TENDONVITINH as DONVITINH,  TM_DUOC.DONVITINH_ID,TM_DUOC.BHYT,TM_DUOC.PHAMVI,        TM_DUOC.TENHOATCHAT, TM_DUOC.HAMLUONG, TM_DUOC.HANGSANXUAT, TM_DUOC.QUOCGIA, TM_DUOC.LOAIDUOC_ID, TM_DUOC.DUONGDUNG_ID,        TM_TENDUOC.TENDUOC, TM_TENDUOC.TENDUOC_EN, TM_TENDUOC.MAQUOCTE, TM_TENDUOC.MAQUOCTEBT,        TM_LOAIDUOC.LOAIVATTU_ID, TM_DUOC.BENHVIEN_ID,TT_TONKHO.SOLUONG, TT_TONKHO.NGUONDUOC_ID, NH.TENNGUONDUOC        , TAMNGUNG = CASE WHEN TM_DUOC.TAMNGUNG = '1' OR nh.TAMNGUNG = '1' OR KD.TAMNGUNG = '1' THEN '1' ELSE '0' END        , TM_DUOC.DANGTRINHBAY        from TM_DUOC        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = TM_DUOC.DONVITINH_ID        left join TM_TENDUOC on TM_DUOC.TENDUOC_ID = TM_TENDUOC.TENDUOC_ID and TM_DUOC.BENHVIEN_ID = 'HLU01' and TM_DUOC.TAMNGUNG = '0'        left join TM_LOAIDUOC on TM_LOAIDUOC.LOAIDUOC_ID = TM_DUOC.LOAIDUOC_ID and TM_LOAIDUOC.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG on (TM_LOAIDUOC.LOAIVATTU_ID = TM_DUOC_HANDUNG.LOAIDUOC and TM_DUOC_HANDUNG.BENHVIEN_ID = 'HLU01')        inner join        (select LTRIM(A.KHODUOC_ID) + '_' + LTRIM(A.DUOC_ID) + '_' + LTRIM(ISNULL(A.NGUONDUOC_ID,'')) as DUOC_KEY, A.KHODUOC_ID, A.DUOC_ID,A.NGUONDUOC_ID,        SUM(isnull(A.SOLUONG,0)) as SOLUONG        from        (select SUM(SOLUONG) as SOLUONG, KHODUOC_ID, DUOC_ID, NGUONDUOC_ID from TT_DUOC_KYGUI_TONKHO        where BENHVIEN_ID = 'HLU01' group by KHODUOC_ID, DUOC_ID, NGUONDUOC_ID) A        group by LTRIM(A.KHODUOC_ID) + '_' + LTRIM(A.DUOC_ID) + '_' + LTRIM(A.NGUONDUOC_ID), A.KHODUOC_ID, A.DUOC_ID, A.NGUONDUOC_ID)        TT_TONKHO on TT_TONKHO.DUOC_ID = TM_DUOC.DUOC_ID        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = TT_TONKHO.NGUONDUOC_ID and nh.BENHVIEN_ID = 'HLU01'        LEFT JOIN TM_KHODUOC KD ON KD.KHODUOC_ID = TT_TONKHO.KHODUOC_ID        where TM_DUOC.BENHVIEN_ID = 'HLU01' AND TT_TONKHO.SOLUONG >= 0]
2019-09-20 14:00:29,231 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM018']
2019-09-20 14:00:29,276 [5] DEBUG - Statement Id: [DAO00027_GetListDuocTonKho] PreparedStatement : [select distinct TT_TONKHO.DUOC_KEY, LTRIM(TT_TONKHO.KHODUOC_ID) as KHODUOC_ID, TM_DUOC.DUOC_ID, TM_LOAIDUOC.MALOAIDUOC,TM_DUOC.SOVISA,TM_DUOC.TYLE_VAT,TM_DUOC.COTOA,        TM_DUOC.MADUOC, TM_DUOC.TENHANG, TM_DUOC.TENDUOCDAYDU, dvt.TENDONVITINH as DONVITINH,  TM_DUOC.DONVITINH_ID,TM_DUOC.BHYT,                TM_DUOC.TENHOATCHAT,          TM_DUOC.HAMLUONG, TM_DUOC.HANGSANXUAT, TM_DUOC.QUOCGIA, TM_DUOC.LOAIDUOC_ID, TM_DUOC.DUONGDUNG_ID,        TM_TENDUOC.TENDUOC, TM_TENDUOC.TENDUOC_EN, TM_TENDUOC.MAQUOCTE, TM_TENDUOC.MAQUOCTEBT,        TM_LOAIDUOC.LOAIVATTU_ID, TM_DUOC.BENHVIEN_ID,        TT_TONKHO.SOLUONG, TM_DUOC.VTYT_PHANLOAI, TM_DUOC.PHAMVI, TT_TONKHO.NGUONDUOC_ID, NG.TENNGUONDUOC AS TENNGUONDUOC        , TAMNGUNG = CASE WHEN TM_DUOC.TAMNGUNG = '1' OR NG.TAMNGUNG = '1' OR KD.TAMNGUNG = '1' THEN '1' ELSE '0' END        , TM_DUOC.DANGTRINHBAY        from TM_DUOC        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = TM_DUOC.DONVITINH_ID        left join TM_TENDUOC on TM_DUOC.TENDUOC_ID = TM_TENDUOC.TENDUOC_ID and TM_DUOC.BENHVIEN_ID = 'HLU01' and TM_DUOC.TAMNGUNG = '0'        left join TM_LOAIDUOC on TM_LOAIDUOC.LOAIDUOC_ID = TM_DUOC.LOAIDUOC_ID and TM_LOAIDUOC.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG on (TM_LOAIDUOC.LOAIVATTU_ID = TM_DUOC_HANDUNG.LOAIDUOC and TM_DUOC_HANDUNG.BENHVIEN_ID = 'HLU01')        inner join        (select LTRIM(A.KHODUOC_ID) + '_' + LTRIM(A.DUOC_ID) + '_' + LTRIM(ISNULL(A.NGUONDUOC_ID,'')) as DUOC_KEY, A.KHODUOC_ID, A.DUOC_ID, A.NGUONDUOC_ID,        SUM(isnull(A.SOLUONG,0)) as SOLUONG        from        (select SUM(SOLUONG) as SOLUONG, KHODUOC_ID, DUOC_ID, NGUONDUOC_ID from TT_DUOC_TONKHO        where BENHVIEN_ID = 'HLU01' group by KHODUOC_ID, DUOC_ID, NGUONDUOC_ID) A        group by LTRIM(A.KHODUOC_ID) + '_' + LTRIM(A.DUOC_ID) + '_' + LTRIM(ISNULL(A.NGUONDUOC_ID,'')), A.KHODUOC_ID, A.DUOC_ID, NGUONDUOC_ID        ) TT_TONKHO on TT_TONKHO.DUOC_ID = TM_DUOC.DUOC_ID        LEFT JOIN TM_NGUONHANG NG ON NG.NGUONDUOC_ID = TT_TONKHO.NGUONDUOC_ID        LEFT JOIN TM_KHODUOC KD ON KD.KHODUOC_ID = TT_TONKHO.KHODUOC_ID        where TM_DUOC.BENHVIEN_ID = 'HLU01' and TT_TONKHO.SOLUONG >= 0]
2019-09-20 14:00:34,672 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM023']
2019-09-20 14:00:34,719 [5] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoVaBooking] PreparedStatement : [declare @NGUONDUOC_MACDINH varchar(5) = '0';        declare @TOAMUANGOAI int = 0;        select @NGUONDUOC_MACDINH = isnull(VALUE,0) from TM_SYS_APPSETTINGS where CODE = 'PHA_NGUONDUOC'        select @TOAMUANGOAI = isnull(VALUE,0) from TM_SYS_APPSETTINGS where CODE = 'OPD_TOAMUANGOAI_DUNGDANHMUC_DUOC'                if @TOAMUANGOAI = 1        begin        select  distinct '0' + '_' + LTRIM(d.DUOC_ID) + '_' + @NGUONDUOC_MACDINH as DUOC_KEY, 0 as PHAMVI_ID, @NGUONDUOC_MACDINH as NGUONDUOC_ID, null as TENNGUONDUOC, null as TINHTIEN, d.DUOC_ID, ld.MALOAIDUOC,        d.SOVISA,d.TYLE_VAT,d.COTOA, d.MADUOC, d.TENHANG, d.TENDUOCDAYDU, d.DONVITINH as DONVITINH, d.BHYT,        d.TENHOATCHAT, d.HAMLUONG, d.HANGSANXUAT, d.QUOCGIA, d.LOAIDUOC_ID, d.DUONGDUNG_ID, d.TINHTIEN_PTTT,        ten.TENDUOC, ten.TENDUOC_EN, ten.MAQUOCTE, ten.MAQUOCTEBT,        '' as BHYT_TEXT        , ld.LOAIVATTU_ID        , d.BENHVIEN_ID,        999999999 as SOLUONG, d.VTYT_PHANLOAI, d.PHAMVI, d.SUASOLUONGTONGHOP, d.MADUOCBV, d.DANGTRINHBAY        , TAMNGUNG = CASE WHEN d.TAMNGUNG = '1' THEN '1' ELSE '0' END        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        union all        select  distinct tk.DUOC_KEY, LTRIM(tk.PHAMVI_ID) as PHAMVI_ID, tk.NGUONDUOC_ID, nh.TENNGUONDUOC, nh.TINHTIEN, d.DUOC_ID, ld.MALOAIDUOC,        d.SOVISA,d.TYLE_VAT,d.COTOA, d.MADUOC, d.TENHANG, d.TENDUOCDAYDU, d.DONVITINH as DONVITINH, d.BHYT,        d.TENHOATCHAT, d.HAMLUONG, d.HANGSANXUAT, d.QUOCGIA, d.LOAIDUOC_ID, d.DUONGDUNG_ID, d.TINHTIEN_PTTT,        ten.TENDUOC, ten.TENDUOC_EN, ten.MAQUOCTE, ten.MAQUOCTEBT,        CASE WHEN d.BHYT = '1' THEN 'BHYT' ELSE '' END as BHYT_TEXT        , ld.LOAIVATTU_ID        , d.BENHVIEN_ID,        tk.SOLUONG, d.VTYT_PHANLOAI, d.PHAMVI, d.SUASOLUONGTONGHOP, d.MADUOCBV, d.DANGTRINHBAY        , TAMNGUNG = CASE WHEN d.TAMNGUNG = '1' OR nh.TAMNGUNG = '1' OR kd.TAMNGUNG = '1' THEN '1' ELSE '0' END        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        inner join        (        select  LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')) DUOC_KEY, (SUM(dtk.SOLUONG) - isnull(sum(A.SOLUONG),0) - isnull(sum(B.SOLUONG),0)) SOLUONG, pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        from (select sum(soluong) soluong,duoc_id,nguonduoc_id,khoduoc_id,benhvien_id from TT_DUOC_TONKHO  group by duoc_id,nguonduoc_id,khoduoc_id,benhvien_id) dtk        inner join TM_DUOC_PHAMVISD_MAPPING pvsd on dtk.KHODUOC_ID = pvsd.KHODUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NOITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) B on B.DUOC_ID = dtk.DUOC_ID and B.SOLUONG > 0 and B.PHAMVI_ID = pvsd.PHAMVI_ID and B.NGUONHANG_ID = dtk.NGUONDUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NGOAITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) A on A.DUOC_ID = dtk.DUOC_ID and A.SOLUONG > 0 and A.PHAMVI_ID = pvsd.PHAMVI_ID and A.NGUONHANG_ID = dtk.NGUONDUOC_ID        where dtk.SOLUONG > 0 and dtk.BENHVIEN_ID = 'HLU01'        group by LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')), pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        ) tk on tk.DUOC_ID = d.DUOC_ID        left join TM_DUOC_PHAMVISUDUNG kd on kd.PHAMVI_ID = tk.PHAMVI_ID and kd.BENHVIEN_ID = 'HLU01'        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = tk.NGUONDUOC_ID and nh.BENHVIEN_ID = 'HLU01'        where d.BENHVIEN_ID = 'HLU01'  and tk.SOLUONG >= 0        end        else        begin                  select  distinct tk.DUOC_KEY, LTRIM(tk.PHAMVI_ID) as PHAMVI_ID, tk.NGUONDUOC_ID, nh.TENNGUONDUOC, nh.TINHTIEN, d.DUOC_ID, ld.MALOAIDUOC,        d.SOVISA,d.TYLE_VAT,d.COTOA, d.MADUOC, d.TENHANG, d.TENDUOCDAYDU, d.DONVITINH as DONVITINH, d.BHYT,        d.TENHOATCHAT, d.HAMLUONG, d.HANGSANXUAT, d.QUOCGIA, d.LOAIDUOC_ID, d.DUONGDUNG_ID, d.TINHTIEN_PTTT,        ten.TENDUOC, ten.TENDUOC_EN, ten.MAQUOCTE, ten.MAQUOCTEBT,        CASE WHEN d.BHYT = '1' THEN 'BHYT' ELSE '' END as BHYT_TEXT        , ld.LOAIVATTU_ID        , d.BENHVIEN_ID,        tk.SOLUONG, d.VTYT_PHANLOAI, d.PHAMVI, d.SUASOLUONGTONGHOP, d.MADUOCBV, d.DANGTRINHBAY        , TAMNGUNG = CASE WHEN d.TAMNGUNG = '1' OR nh.TAMNGUNG = '1' OR kd.TAMNGUNG = '1' THEN '1' ELSE '0' END        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        inner join        (        select  LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')) DUOC_KEY, (SUM(dtk.SOLUONG) - isnull(sum(A.SOLUONG),0) - isnull(sum(B.SOLUONG),0)) SOLUONG, pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        from (select sum(soluong) soluong,duoc_id,nguonduoc_id,khoduoc_id,benhvien_id from TT_DUOC_TONKHO  group by duoc_id,nguonduoc_id,khoduoc_id,benhvien_id) dtk        inner join TM_DUOC_PHAMVISD_MAPPING pvsd on dtk.KHODUOC_ID = pvsd.KHODUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NOITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) B on B.DUOC_ID = dtk.DUOC_ID and B.SOLUONG > 0 and B.PHAMVI_ID = pvsd.PHAMVI_ID and B.NGUONHANG_ID = dtk.NGUONDUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NGOAITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) A on A.DUOC_ID = dtk.DUOC_ID and A.SOLUONG > 0 and A.PHAMVI_ID = pvsd.PHAMVI_ID and A.NGUONHANG_ID = dtk.NGUONDUOC_ID        where dtk.SOLUONG > 0 and dtk.BENHVIEN_ID = 'HLU01'        group by LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')), pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        ) tk on tk.DUOC_ID = d.DUOC_ID        left join TM_DUOC_PHAMVISUDUNG kd on kd.PHAMVI_ID = tk.PHAMVI_ID and kd.BENHVIEN_ID = 'HLU01'        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = tk.NGUONDUOC_ID and nh.BENHVIEN_ID = 'HLU01'        where d.BENHVIEN_ID = 'HLU01'  and tk.SOLUONG >= 0        end]
2019-09-20 14:00:40,429 [5] DEBUG - Statement Id: [DAO00320_GetList] PreparedStatement : [select M.*            from TM_MAU M            LEFT JOIN TM_MAU_DONVITINH DVT on M.DONVITINH_ID=DVT.DONVITINH_ID            where            M.TAMNGUNG = '0'            and M.BENHVIEN_ID = 'HLU01'            order by M.TENMAU]
2019-09-20 14:00:40,502 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM071']
2019-09-20 14:00:40,541 [5] DEBUG - Statement Id: [DAO00322_GetListMauTonKhoForCreateCached] PreparedStatement : [SELECT DISTINCT          TK.MAU_KEY, TK.KHOMAU_ID, M.MAU_ID, M.MAMAU, M.TENMAU, M.NHOM_ABO, M.NHOM_RH, M.LOAIMAU_ID,          TK.SOLONHAP_ID, SLN.SOLONHAP, SLN.SOKIEMSOAT, TK.NGUONHANG_ID, NG.TENNGUONMAU, M.BENHVIEN_ID, M.DONVITINH_ID,          SUM(tk.SOLUONG) AS SOLUONG,K.TENKHO,DVT.TENDONVITINH          FROM TT_MAU_TONKHO TK          JOIN TM_KHO K ON TK.KHOMAU_ID = K.KHO_ID          JOIN TT_MAU_CHUNGTU_SOLONHAP SLN ON TK.SOLONHAP_ID = SLN.SOLONHAP_ID          JOIN TM_MAU M on TK.MAU_ID = M.MAU_ID and M.TAMNGUNG = '0'          LEFT JOIN TM_MAU_DONVITINH DVT on M.DONVITINH_ID=DVT.DONVITINH_ID          LEFT JOIN TM_NGUONMAU NG ON NG.NGUONMAU_ID = TK.NGUONHANG_ID          WHERE TK.SOLUONG > 0          GROUP BY TK.MAU_KEY, TK.KHOMAU_ID, M.MAU_ID, M.MAMAU, M.TENMAU, M.NHOM_ABO, M.NHOM_RH, M.LOAIMAU_ID,          TK.SOLONHAP_ID, SLN.SOLONHAP, SLN.SOKIEMSOAT,TK.NGUONHANG_ID, NG.TENNGUONMAU, M.BENHVIEN_ID, M.DONVITINH_ID,K.TENKHO,DVT.TENDONVITINH]
2019-09-20 14:00:40,615 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM073']
2019-09-20 14:00:40,667 [5] DEBUG - Statement Id: [DAO00322_GetListMauTonKhoTruBooking] PreparedStatement : [select distinct          TK.MAU_KEY, TK.KHOMAU_ID, M.MAU_ID, M.MAMAU, M.TENMAU, M.NHOM_ABO, M.NHOM_RH, M.LOAIMAU_ID, M.DONVITINH_ID,          TK.SOLONHAP_ID, TK.SOLONHAP, TK.SOKIEMSOAT,M.PHAMVI, TK.NGUONHANG_ID, NG.TENNGUONMAU, M.BENHVIEN_ID,          TK.SOLUONG,TK.TENKHO,DVT.TENDONVITINH          from TM_MAU M          JOIN          (          select          A.MAU_KEY, A.KHOMAU_ID, A.MAU_ID ,a.NGUONHANG_ID, A.SOLONHAP_ID, A.SOLONHAP, A.SOKIEMSOAT, A.SOLUONG,A.TENKHO          from          (          select KHOMAU_ID, TK.MAU_ID, TK.NGUONHANG_ID, TK.MAU_KEY, SLN.SOLONHAP_ID, SLN.SOLONHAP, SLN.SOKIEMSOAT, ISNULL(TK.SOLUONG,0) - ISNULL(book.SOLUONG,0) as SOLUONG,K.TENKHO          from TT_MAU_TONKHO TK          JOIN TM_KHO K ON TK.KHOMAU_ID = K.KHO_ID          inner join TT_MAU_CHUNGTU_SOLONHAP SLN ON TK.SOLONHAP_ID = SLN.SOLONHAP_ID          left join dbo.TT_MAU_TONKHO_BOOK book ON book.MAU_KEY = TK.MAU_KEY AND book.TRANGTHAI = 'HIEULUC'          where ISNULL(TK.SOLUONG,0) - ISNULL(book.SOLUONG,0) > 0          ) A          )TK on TK.MAU_ID = M.MAU_ID and M.TAMNGUNG = '0'          LEFT JOIN TM_MAU_DONVITINH DVT on M.DONVITINH_ID=DVT.DONVITINH_ID          LEFT JOIN TM_NGUONMAU NG ON NG.NGUONMAU_ID = TK.NGUONHANG_ID]
2019-09-20 14:00:40,746 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM072']
2019-09-20 14:00:41,707 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'MAIN'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2019-09-20 14:00:43,288 [1] DEBUG - Statement Id: [DAO00002_FormList] PreparedStatement : [select              TM_SYS_FORM.HOSPITAL_ID,              TM_SYS_FORM.NAME,              TM_SYS_FORM.CLASS,              TM_SYS_FORM.ASSEMBLY,              TM_SYS_FORM.TITLE_VI as TITLE              from TM_SYS_FORM              where HOSPITAL_ID = 'HLU01']
2019-09-20 14:00:48,591 [1] DEBUG - Statement Id: [DAO00300_GetShortcutListByUserID] PreparedStatement : [SELECT S.SHORTCUT_CODE, S.SHORTCUT_VALUE              FROM TM_SHORTCUT AS S              WHERE S.BENHVIEN_ID = 'HLU01' AND S.USER_ID = '1' AND TAMNGUNG = '0']
2019-09-20 14:00:48,638 [1] DEBUG - Statement Id: [DAO00087_GetList] PreparedStatement : [select CODE, VALUE, BENHVIEN_ID              from TM_SYS_APPSETTINGS              where LOCKED = '0' and BENHVIEN_ID = 'HLU01'              order by SETTING_ID]
2019-09-20 14:00:48,781 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'MSG01'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2019-09-20 14:00:48,922 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'MSG02'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2019-09-20 14:00:49,066 [1] DEBUG - Statement Id: [DAO00008_GetUserSettings] PreparedStatement : [select A.*, B.TENKHO , C.TENPHONGBAN, B.MAKHO, C.MAPHONGBAN          from TM_SYS_USERS A          left join TM_KHODUOC B on B.KHODUOC_ID = A.INVENTORY_ID          left join TM_PHONGBAN C on (C.PHONGBAN_ID = A.WORKING_DEPT_ID and C.BENHVIEN_ID =  @param0 )          left join TM_SYS_USERKHO D on (D.ACCOUNT_ID = A.ACCOUNT_ID and D.HOSPITAL_ID =  @param0 )          where          A.HOSPITAL_ID =  @param0            and                 A.ACCOUNT_ID =  @param1]
2019-09-20 14:00:49,067 [1] DEBUG - Statement Id: [DAO00008_GetUserSettings] Parameters: [@param0=[HOSPITAL_ID,HLU01], @param1=[ACCOUNT_ID,113]]
2019-09-20 14:00:49,068 [1] DEBUG - Statement Id: [DAO00008_GetUserSettings] Types: [@param0=[String, System.String], @param1=[String, System.String]]
2019-09-20 14:00:49,111 [1] DEBUG - Statement Id: [DAO00008_GetUserInvSettings] PreparedStatement : [select A.*, B.TENKHO, B.MAKHO, B.LOAIKHO_ID, B.KHOQUANLY_ID          from TM_SYS_USERKHO A          left join TM_KHO B on B.MODULE_ID = A.MODULE_ID and B.KHO_ID = A.KHO_ID          where A.HOSPITAL_ID =  @param0  and A.ACCOUNT_ID =  @param1           order by B.TENKHO]
2019-09-20 14:00:49,111 [1] DEBUG - Statement Id: [DAO00008_GetUserInvSettings] Parameters: [@param0=[HOSPITAL_ID,HLU01], @param1=[ACCOUNT_ID,113]]
2019-09-20 14:00:49,111 [1] DEBUG - Statement Id: [DAO00008_GetUserInvSettings] Types: [@param0=[String, System.String], @param1=[String, System.String]]
2019-09-20 14:00:49,247 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'COM30'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2019-09-20 14:00:49,427 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'RIS04'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2019-09-20 14:00:57,595 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'MENU1'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2019-09-20 14:00:57,692 [1] DEBUG - Statement Id: [DAO00011_GetList] PreparedStatement : [select              TM_SYS_MENU.ID,              TM_SYS_MENU.PARENTID,              TM_SYS_MENU.SCREEN,              TM_SYS_MENU.SMALLIMAGE,              TM_SYS_MENU.LARGEIMAGE,              TM_SYS_MENU.DESCRIPTION,              TM_SYS_MENU.TYPE,              TM_SYS_MENU.TITLE_VI as TITLE              from TM_SYS_MENU              where TM_SYS_MENU.HOSPITAL_ID = 'HLU01' and TM_SYS_MENU.ACTIVE = '1'               AND                   (TM_SYS_MENU.TYPE & '8' = '8')                             order by TM_SYS_MENU.ORDERNUM]
2019-09-20 14:00:57,979 [1] DEBUG - Statement Id: [DAO00011_usermenu_list] PreparedStatement : [select              TM_SYS_HOMEMENU.MENUID as ID,              TM_SYS_MENU.TITLE_VI as TITLE,              TM_SYS_MENU.SCREEN,              TM_SYS_MENU.SMALLIMAGE,              TM_SYS_MENU.LARGEIMAGE,              TM_SYS_MENU.TYPE              from TM_SYS_HOMEMENU              left join TM_SYS_MENU on TM_SYS_MENU.ID = TM_SYS_HOMEMENU.MENUID and TM_SYS_MENU.HOSPITAL_ID = TM_SYS_HOMEMENU.HOSPITAL_ID              where TM_SYS_HOMEMENU.HOSPITAL_ID = 'HLU01' and TM_SYS_HOMEMENU.USERID = '113' and TM_SYS_MENU.ACTIVE = '1'               AND                   (TM_SYS_MENU.TYPE & '8' = '8')                             ORDER BY TM_SYS_HOMEMENU.ORDERNUM]
2019-09-20 14:01:20,077 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'COM31'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2019-09-20 14:01:20,253 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'ORM28'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2019-09-20 14:01:25,159 [1] DEBUG - Statement Id: [DAO00066_GetBENHAN_TIEPNHAN] PreparedStatement : [select top 1 *        from TT_NOITRU_BENHAN        where TIEPNHAN_ID = '27022'  and BENHVIEN_ID = 'HLU01'        order by NGAYTAO desc]
2019-09-20 14:01:25,253 [1] DEBUG - Statement Id: [DAO00014_GetInPatientStatus] PreparedStatement : [select TRANGTHAI, isnull(KHOACHUYENDEN_ID, KHOAVAO_ID) as KHOAHIENTAI from TT_NOITRU_BENHAN        where        TIEPNHAN_ID = '27022'        and BENHVIEN_ID = 'HLU01'         and           BENHAN_ID = '5800']
2019-09-20 14:01:25,345 [1] DEBUG - Statement Id: [DAO00048_TT_PHAUTHUAT_GetList] PreparedStatement : [select *              from TT_PHAUTHUAT               where                             TT_PHAUTHUAT.LOAI = 'P'                       and                           TT_PHAUTHUAT.TIEPNHAN_ID = 27022                       and                           TT_PHAUTHUAT.BENHVIEN_ID = 'HLU01'                                     order by PHAUTHUAT_ID DESC]
2019-09-20 14:01:25,400 [1] DEBUG - Statement Id: [DAO00048_GetListLoaiGacTrongPTTT] PreparedStatement : [select DICTIONARY_ID, DICTIONARY_CODE, DICTIONARY_NAME          from LST_DICTIONARY          where DICTIONARY_TYPE_CODE = 'LoaiGacPTTT'          and ENABLED = '1']
2019-09-20 14:01:29,146 [1] DEBUG - Statement Id: [DAO00048_GetDSLoaiGacDaGhiNhan] PreparedStatement : [select A.KIEMSOATGAC_ID, A.BENHNHAN_ID, A.TIEPNHAN_ID, A.BENHAN_ID, A.PHAUTHUAT_ID, A.LOAIPT_TT, A.LOAIGAC_ID          , A.NGAYGHINHAN, A.THOIGIANGHINHAN, A.SOLUONG, A.SOLUONGDASUDUNG, A.SOLUONGCONLAI, A.GHICHU, A.NGUOINHANDUNGCU_ID          , B.DICTIONARY_CODE AS MALOAIGAC, B.DICTIONARY_NAME AS TENLOAIGAC          from TT_PHAUTHUAT_GHINHANGAC A          inner join LST_DICTIONARY B on B.DICTIONARY_ID = A.LOAIGAC_ID          where A.PHAUTHUAT_ID = 3742 and A.BENHVIEN_ID = 'HLU01']
2019-09-20 14:01:31,386 [1] DEBUG - Statement Id: [DAO00048_GetDSLoaiGacDaGhiNhan] PreparedStatement : [select A.KIEMSOATGAC_ID, A.BENHNHAN_ID, A.TIEPNHAN_ID, A.BENHAN_ID, A.PHAUTHUAT_ID, A.LOAIPT_TT, A.LOAIGAC_ID          , A.NGAYGHINHAN, A.THOIGIANGHINHAN, A.SOLUONG, A.SOLUONGDASUDUNG, A.SOLUONGCONLAI, A.GHICHU, A.NGUOINHANDUNGCU_ID          , B.DICTIONARY_CODE AS MALOAIGAC, B.DICTIONARY_NAME AS TENLOAIGAC          from TT_PHAUTHUAT_GHINHANGAC A          inner join LST_DICTIONARY B on B.DICTIONARY_ID = A.LOAIGAC_ID          where A.PHAUTHUAT_ID = 3742 and A.BENHVIEN_ID = 'HLU01']
2019-09-20 14:01:39,925 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'COM98'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2019-09-20 14:01:45,985 [1] DEBUG - Statement Id: [DAO00048_DeleteLoaiGacById] PreparedStatement : [DELETE FROM TT_PHAUTHUAT_GHINHANGAC WHERE KIEMSOATGAC_ID = 3 AND BENHVIEN_ID = 'HLU01'            SELECT 3]
2019-09-20 14:01:57,238 [1] DEBUG - Statement Id: [DAO00066_GetBENHAN_TIEPNHAN] PreparedStatement : [select top 1 *        from TT_NOITRU_BENHAN        where TIEPNHAN_ID = '27022'  and BENHVIEN_ID = 'HLU01'        order by NGAYTAO desc]
2019-09-20 14:01:57,324 [1] DEBUG - Statement Id: [DAO00014_GetInPatientStatus] PreparedStatement : [select TRANGTHAI, isnull(KHOACHUYENDEN_ID, KHOAVAO_ID) as KHOAHIENTAI from TT_NOITRU_BENHAN        where        TIEPNHAN_ID = '27022'        and BENHVIEN_ID = 'HLU01'         and           BENHAN_ID = '5800']
2019-09-20 14:01:57,408 [1] DEBUG - Statement Id: [DAO00048_TT_PHAUTHUAT_GetList] PreparedStatement : [select *              from TT_PHAUTHUAT               where                             TT_PHAUTHUAT.LOAI = 'P'                       and                           TT_PHAUTHUAT.TIEPNHAN_ID = 27022                       and                           TT_PHAUTHUAT.BENHVIEN_ID = 'HLU01'                                     order by PHAUTHUAT_ID DESC]
2019-09-20 14:01:57,450 [1] DEBUG - Statement Id: [DAO00048_GetListLoaiGacTrongPTTT] PreparedStatement : [select DICTIONARY_ID, DICTIONARY_CODE, DICTIONARY_NAME          from LST_DICTIONARY          where DICTIONARY_TYPE_CODE = 'LoaiGacPTTT'          and ENABLED = '1']
2019-09-20 14:01:58,906 [1] DEBUG - Statement Id: [DAO00048_GetDSLoaiGacDaGhiNhan] PreparedStatement : [select A.KIEMSOATGAC_ID, A.BENHNHAN_ID, A.TIEPNHAN_ID, A.BENHAN_ID, A.PHAUTHUAT_ID, A.LOAIPT_TT, A.LOAIGAC_ID          , A.NGAYGHINHAN, A.THOIGIANGHINHAN, A.SOLUONG, A.SOLUONGDASUDUNG, A.SOLUONGCONLAI, A.GHICHU, A.NGUOINHANDUNGCU_ID          , B.DICTIONARY_CODE AS MALOAIGAC, B.DICTIONARY_NAME AS TENLOAIGAC          from TT_PHAUTHUAT_GHINHANGAC A          inner join LST_DICTIONARY B on B.DICTIONARY_ID = A.LOAIGAC_ID          where A.PHAUTHUAT_ID = 3742 and A.BENHVIEN_ID = 'HLU01']
2019-09-20 14:01:59,006 [1] DEBUG - Statement Id: [DAO00048_GetDSLoaiGacDaGhiNhan] PreparedStatement : [select A.KIEMSOATGAC_ID, A.BENHNHAN_ID, A.TIEPNHAN_ID, A.BENHAN_ID, A.PHAUTHUAT_ID, A.LOAIPT_TT, A.LOAIGAC_ID          , A.NGAYGHINHAN, A.THOIGIANGHINHAN, A.SOLUONG, A.SOLUONGDASUDUNG, A.SOLUONGCONLAI, A.GHICHU, A.NGUOINHANDUNGCU_ID          , B.DICTIONARY_CODE AS MALOAIGAC, B.DICTIONARY_NAME AS TENLOAIGAC          from TT_PHAUTHUAT_GHINHANGAC A          inner join LST_DICTIONARY B on B.DICTIONARY_ID = A.LOAIGAC_ID          where A.PHAUTHUAT_ID = 3742 and A.BENHVIEN_ID = 'HLU01']
2019-09-20 14:02:02,751 [1] DEBUG - Statement Id: [DAO00048_DeleteLoaiGacByPhauThuatId] PreparedStatement : [DELETE FROM TT_PHAUTHUAT_GHINHANGAC WHERE KIEMSOATGAC_ID = 3742 AND BENHVIEN_ID = 'HLU01'            SELECT ]
--------------------------------------------------------------------------------
2019-09-20 14:02:46,612 [1] DEBUG - Statement Id: [DAO00001_DBList] PreparedStatement : [select *              from TM_SYS_SERVER              where HOSPITAL_ID = '_SYSTEM_' and TYPE = 'D']
2019-09-20 14:02:46,895 [1] DEBUG - Statement Id: [DAO00001_DaoList] PreparedStatement : [select              TM_SYS_SERVICEMAP.ID,              TM_SYS_SERVICEMAP.HOSPITAL_ID,              TM_SYS_SERVICEMAP.DB_NAME,              TM_SYS_SERVICEMAP.TYPE,              TM_SYS_SERVICEMAP.NAME,              TM_SYS_SERVICEMAP.CLASS,              (TM_SYS_DIC.VALUE + '.' + TM_SYS_SERVICEMAP.CLASS) as CLASSFULL,              TM_SYS_SERVICEMAP.ASSEMBLY              from TM_SYS_SERVICEMAP              inner join TM_SYS_DIC              on TM_SYS_SERVICEMAP.NAMESPACE = TM_SYS_DIC.ID              where HOSPITAL_ID = '_SYSTEM_' AND TYPE = 'D' AND ACTIVE = '1'              order by DB_NAME]
2019-09-20 14:02:46,933 [1] DEBUG - Statement Id: [DAO00001_ServiceList] PreparedStatement : [select              TM_SYS_SERVICEMAP.ID,              TM_SYS_SERVICEMAP.HOSPITAL_ID,              TM_SYS_SERVICEMAP.DB_NAME,              TM_SYS_SERVICEMAP.TYPE,              TM_SYS_SERVICEMAP.NAME,              TM_SYS_SERVICEMAP.CLASS,              (TM_SYS_DIC.VALUE + '.' + TM_SYS_SERVICEMAP.CLASS) as CLASSFULL,              TM_SYS_SERVICEMAP.ASSEMBLY,              TM_SYS_SERVER.URL              from TM_SYS_SERVICEMAP              inner join TM_SYS_DIC on TM_SYS_SERVICEMAP.NAMESPACE = TM_SYS_DIC.ID              inner join TM_SYS_SERVER on (TM_SYS_SERVICEMAP.DB_NAME = TM_SYS_SERVER.NAME) and (TM_SYS_SERVER.HOSPITAL_ID = '_SYSTEM_')              where TM_SYS_SERVICEMAP.HOSPITAL_ID = '_SYSTEM_' AND TM_SYS_SERVICEMAP.TYPE = 'S'  AND ACTIVE = '1'              order by URL]
2019-09-20 14:02:47,282 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = '_SYSTEM_'               AND                   TM_SYS_SCREEN.PAGE = 'LOGIN'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2019-09-20 14:02:47,507 [1] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = '_SYSTEM_'               AND                   TM_SYS_CACHE.ACTIVE = '1']
2019-09-20 14:02:52,575 [1] DEBUG - Statement Id: [DAO00001_DBList] PreparedStatement : [select *              from TM_SYS_SERVER              where HOSPITAL_ID = 'HLU01' and TYPE = 'D']
2019-09-20 14:02:52,605 [1] DEBUG - Statement Id: [DAO00001_DaoList] PreparedStatement : [select              TM_SYS_SERVICEMAP.ID,              TM_SYS_SERVICEMAP.HOSPITAL_ID,              TM_SYS_SERVICEMAP.DB_NAME,              TM_SYS_SERVICEMAP.TYPE,              TM_SYS_SERVICEMAP.NAME,              TM_SYS_SERVICEMAP.CLASS,              (TM_SYS_DIC.VALUE + '.' + TM_SYS_SERVICEMAP.CLASS) as CLASSFULL,              TM_SYS_SERVICEMAP.ASSEMBLY              from TM_SYS_SERVICEMAP              inner join TM_SYS_DIC              on TM_SYS_SERVICEMAP.NAMESPACE = TM_SYS_DIC.ID              where HOSPITAL_ID = 'HLU01' AND TYPE = 'D' AND ACTIVE = '1'              order by DB_NAME]
2019-09-20 14:02:54,300 [1] DEBUG - Statement Id: [DAO00001_ServiceList] PreparedStatement : [select              TM_SYS_SERVICEMAP.ID,              TM_SYS_SERVICEMAP.HOSPITAL_ID,              TM_SYS_SERVICEMAP.DB_NAME,              TM_SYS_SERVICEMAP.TYPE,              TM_SYS_SERVICEMAP.NAME,              TM_SYS_SERVICEMAP.CLASS,              (TM_SYS_DIC.VALUE + '.' + TM_SYS_SERVICEMAP.CLASS) as CLASSFULL,              TM_SYS_SERVICEMAP.ASSEMBLY,              TM_SYS_SERVER.URL              from TM_SYS_SERVICEMAP              inner join TM_SYS_DIC on TM_SYS_SERVICEMAP.NAMESPACE = TM_SYS_DIC.ID              inner join TM_SYS_SERVER on (TM_SYS_SERVICEMAP.DB_NAME = TM_SYS_SERVER.NAME) and (TM_SYS_SERVER.HOSPITAL_ID = 'HLU01')              where TM_SYS_SERVICEMAP.HOSPITAL_ID = 'HLU01' AND TM_SYS_SERVICEMAP.TYPE = 'S'  AND ACTIVE = '1'              order by URL]
2019-09-20 14:02:54,386 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1']
2019-09-20 14:02:56,298 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM005']
2019-09-20 14:02:56,432 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM015']
2019-09-20 14:02:56,507 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM067']
2019-09-20 14:02:56,600 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM008']
2019-09-20 14:02:56,674 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM068']
2019-09-20 14:02:56,757 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM006']
2019-09-20 14:02:56,830 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM030']
2019-09-20 14:02:56,903 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM025']
2019-09-20 14:02:56,989 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM024']
2019-09-20 14:02:57,496 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM033']
2019-09-20 14:02:57,537 [5] DEBUG - Statement Id: [DAO00027_GetListDuocKyGuiTonKho] PreparedStatement : [select  distinct TT_TONKHO.DUOC_KEY, LTRIM(TT_TONKHO.KHODUOC_ID) as KHODUOC_ID, TM_DUOC.DUOC_ID, TM_LOAIDUOC.MALOAIDUOC,TM_DUOC.SOVISA,TM_DUOC.TYLE_VAT,TM_DUOC.COTOA,        TM_DUOC.MADUOC, TM_DUOC.TENHANG, TM_DUOC.TENDUOCDAYDU, dvt.TENDONVITINH as DONVITINH,  TM_DUOC.DONVITINH_ID,TM_DUOC.BHYT,TM_DUOC.PHAMVI,        TM_DUOC.TENHOATCHAT, TM_DUOC.HAMLUONG, TM_DUOC.HANGSANXUAT, TM_DUOC.QUOCGIA, TM_DUOC.LOAIDUOC_ID, TM_DUOC.DUONGDUNG_ID,        TM_TENDUOC.TENDUOC, TM_TENDUOC.TENDUOC_EN, TM_TENDUOC.MAQUOCTE, TM_TENDUOC.MAQUOCTEBT,        TM_LOAIDUOC.LOAIVATTU_ID, TM_DUOC.BENHVIEN_ID,TT_TONKHO.SOLUONG, TT_TONKHO.NGUONDUOC_ID, NH.TENNGUONDUOC        , TAMNGUNG = CASE WHEN TM_DUOC.TAMNGUNG = '1' OR nh.TAMNGUNG = '1' OR KD.TAMNGUNG = '1' THEN '1' ELSE '0' END        , TM_DUOC.DANGTRINHBAY        from TM_DUOC        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = TM_DUOC.DONVITINH_ID        left join TM_TENDUOC on TM_DUOC.TENDUOC_ID = TM_TENDUOC.TENDUOC_ID and TM_DUOC.BENHVIEN_ID = 'HLU01' and TM_DUOC.TAMNGUNG = '0'        left join TM_LOAIDUOC on TM_LOAIDUOC.LOAIDUOC_ID = TM_DUOC.LOAIDUOC_ID and TM_LOAIDUOC.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG on (TM_LOAIDUOC.LOAIVATTU_ID = TM_DUOC_HANDUNG.LOAIDUOC and TM_DUOC_HANDUNG.BENHVIEN_ID = 'HLU01')        inner join        (select LTRIM(A.KHODUOC_ID) + '_' + LTRIM(A.DUOC_ID) + '_' + LTRIM(ISNULL(A.NGUONDUOC_ID,'')) as DUOC_KEY, A.KHODUOC_ID, A.DUOC_ID,A.NGUONDUOC_ID,        SUM(isnull(A.SOLUONG,0)) as SOLUONG        from        (select SUM(SOLUONG) as SOLUONG, KHODUOC_ID, DUOC_ID, NGUONDUOC_ID from TT_DUOC_KYGUI_TONKHO        where BENHVIEN_ID = 'HLU01' group by KHODUOC_ID, DUOC_ID, NGUONDUOC_ID) A        group by LTRIM(A.KHODUOC_ID) + '_' + LTRIM(A.DUOC_ID) + '_' + LTRIM(A.NGUONDUOC_ID), A.KHODUOC_ID, A.DUOC_ID, A.NGUONDUOC_ID)        TT_TONKHO on TT_TONKHO.DUOC_ID = TM_DUOC.DUOC_ID        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = TT_TONKHO.NGUONDUOC_ID and nh.BENHVIEN_ID = 'HLU01'        LEFT JOIN TM_KHODUOC KD ON KD.KHODUOC_ID = TT_TONKHO.KHODUOC_ID        where TM_DUOC.BENHVIEN_ID = 'HLU01' AND TT_TONKHO.SOLUONG >= 0]
2019-09-20 14:02:57,629 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM018']
2019-09-20 14:02:57,666 [5] DEBUG - Statement Id: [DAO00027_GetListDuocTonKho] PreparedStatement : [select distinct TT_TONKHO.DUOC_KEY, LTRIM(TT_TONKHO.KHODUOC_ID) as KHODUOC_ID, TM_DUOC.DUOC_ID, TM_LOAIDUOC.MALOAIDUOC,TM_DUOC.SOVISA,TM_DUOC.TYLE_VAT,TM_DUOC.COTOA,        TM_DUOC.MADUOC, TM_DUOC.TENHANG, TM_DUOC.TENDUOCDAYDU, dvt.TENDONVITINH as DONVITINH,  TM_DUOC.DONVITINH_ID,TM_DUOC.BHYT,                TM_DUOC.TENHOATCHAT,          TM_DUOC.HAMLUONG, TM_DUOC.HANGSANXUAT, TM_DUOC.QUOCGIA, TM_DUOC.LOAIDUOC_ID, TM_DUOC.DUONGDUNG_ID,        TM_TENDUOC.TENDUOC, TM_TENDUOC.TENDUOC_EN, TM_TENDUOC.MAQUOCTE, TM_TENDUOC.MAQUOCTEBT,        TM_LOAIDUOC.LOAIVATTU_ID, TM_DUOC.BENHVIEN_ID,        TT_TONKHO.SOLUONG, TM_DUOC.VTYT_PHANLOAI, TM_DUOC.PHAMVI, TT_TONKHO.NGUONDUOC_ID, NG.TENNGUONDUOC AS TENNGUONDUOC        , TAMNGUNG = CASE WHEN TM_DUOC.TAMNGUNG = '1' OR NG.TAMNGUNG = '1' OR KD.TAMNGUNG = '1' THEN '1' ELSE '0' END        , TM_DUOC.DANGTRINHBAY        from TM_DUOC        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = TM_DUOC.DONVITINH_ID        left join TM_TENDUOC on TM_DUOC.TENDUOC_ID = TM_TENDUOC.TENDUOC_ID and TM_DUOC.BENHVIEN_ID = 'HLU01' and TM_DUOC.TAMNGUNG = '0'        left join TM_LOAIDUOC on TM_LOAIDUOC.LOAIDUOC_ID = TM_DUOC.LOAIDUOC_ID and TM_LOAIDUOC.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG on (TM_LOAIDUOC.LOAIVATTU_ID = TM_DUOC_HANDUNG.LOAIDUOC and TM_DUOC_HANDUNG.BENHVIEN_ID = 'HLU01')        inner join        (select LTRIM(A.KHODUOC_ID) + '_' + LTRIM(A.DUOC_ID) + '_' + LTRIM(ISNULL(A.NGUONDUOC_ID,'')) as DUOC_KEY, A.KHODUOC_ID, A.DUOC_ID, A.NGUONDUOC_ID,        SUM(isnull(A.SOLUONG,0)) as SOLUONG        from        (select SUM(SOLUONG) as SOLUONG, KHODUOC_ID, DUOC_ID, NGUONDUOC_ID from TT_DUOC_TONKHO        where BENHVIEN_ID = 'HLU01' group by KHODUOC_ID, DUOC_ID, NGUONDUOC_ID) A        group by LTRIM(A.KHODUOC_ID) + '_' + LTRIM(A.DUOC_ID) + '_' + LTRIM(ISNULL(A.NGUONDUOC_ID,'')), A.KHODUOC_ID, A.DUOC_ID, NGUONDUOC_ID        ) TT_TONKHO on TT_TONKHO.DUOC_ID = TM_DUOC.DUOC_ID        LEFT JOIN TM_NGUONHANG NG ON NG.NGUONDUOC_ID = TT_TONKHO.NGUONDUOC_ID        LEFT JOIN TM_KHODUOC KD ON KD.KHODUOC_ID = TT_TONKHO.KHODUOC_ID        where TM_DUOC.BENHVIEN_ID = 'HLU01' and TT_TONKHO.SOLUONG >= 0]
2019-09-20 14:03:01,087 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM023']
2019-09-20 14:03:01,134 [5] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoVaBooking] PreparedStatement : [declare @NGUONDUOC_MACDINH varchar(5) = '0';        declare @TOAMUANGOAI int = 0;        select @NGUONDUOC_MACDINH = isnull(VALUE,0) from TM_SYS_APPSETTINGS where CODE = 'PHA_NGUONDUOC'        select @TOAMUANGOAI = isnull(VALUE,0) from TM_SYS_APPSETTINGS where CODE = 'OPD_TOAMUANGOAI_DUNGDANHMUC_DUOC'                if @TOAMUANGOAI = 1        begin        select  distinct '0' + '_' + LTRIM(d.DUOC_ID) + '_' + @NGUONDUOC_MACDINH as DUOC_KEY, 0 as PHAMVI_ID, @NGUONDUOC_MACDINH as NGUONDUOC_ID, null as TENNGUONDUOC, null as TINHTIEN, d.DUOC_ID, ld.MALOAIDUOC,        d.SOVISA,d.TYLE_VAT,d.COTOA, d.MADUOC, d.TENHANG, d.TENDUOCDAYDU, d.DONVITINH as DONVITINH, d.BHYT,        d.TENHOATCHAT, d.HAMLUONG, d.HANGSANXUAT, d.QUOCGIA, d.LOAIDUOC_ID, d.DUONGDUNG_ID, d.TINHTIEN_PTTT,        ten.TENDUOC, ten.TENDUOC_EN, ten.MAQUOCTE, ten.MAQUOCTEBT,        '' as BHYT_TEXT        , ld.LOAIVATTU_ID        , d.BENHVIEN_ID,        999999999 as SOLUONG, d.VTYT_PHANLOAI, d.PHAMVI, d.SUASOLUONGTONGHOP, d.MADUOCBV, d.DANGTRINHBAY        , TAMNGUNG = CASE WHEN d.TAMNGUNG = '1' THEN '1' ELSE '0' END        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        union all        select  distinct tk.DUOC_KEY, LTRIM(tk.PHAMVI_ID) as PHAMVI_ID, tk.NGUONDUOC_ID, nh.TENNGUONDUOC, nh.TINHTIEN, d.DUOC_ID, ld.MALOAIDUOC,        d.SOVISA,d.TYLE_VAT,d.COTOA, d.MADUOC, d.TENHANG, d.TENDUOCDAYDU, d.DONVITINH as DONVITINH, d.BHYT,        d.TENHOATCHAT, d.HAMLUONG, d.HANGSANXUAT, d.QUOCGIA, d.LOAIDUOC_ID, d.DUONGDUNG_ID, d.TINHTIEN_PTTT,        ten.TENDUOC, ten.TENDUOC_EN, ten.MAQUOCTE, ten.MAQUOCTEBT,        CASE WHEN d.BHYT = '1' THEN 'BHYT' ELSE '' END as BHYT_TEXT        , ld.LOAIVATTU_ID        , d.BENHVIEN_ID,        tk.SOLUONG, d.VTYT_PHANLOAI, d.PHAMVI, d.SUASOLUONGTONGHOP, d.MADUOCBV, d.DANGTRINHBAY        , TAMNGUNG = CASE WHEN d.TAMNGUNG = '1' OR nh.TAMNGUNG = '1' OR kd.TAMNGUNG = '1' THEN '1' ELSE '0' END        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        inner join        (        select  LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')) DUOC_KEY, (SUM(dtk.SOLUONG) - isnull(sum(A.SOLUONG),0) - isnull(sum(B.SOLUONG),0)) SOLUONG, pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        from (select sum(soluong) soluong,duoc_id,nguonduoc_id,khoduoc_id,benhvien_id from TT_DUOC_TONKHO  group by duoc_id,nguonduoc_id,khoduoc_id,benhvien_id) dtk        inner join TM_DUOC_PHAMVISD_MAPPING pvsd on dtk.KHODUOC_ID = pvsd.KHODUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NOITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) B on B.DUOC_ID = dtk.DUOC_ID and B.SOLUONG > 0 and B.PHAMVI_ID = pvsd.PHAMVI_ID and B.NGUONHANG_ID = dtk.NGUONDUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NGOAITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) A on A.DUOC_ID = dtk.DUOC_ID and A.SOLUONG > 0 and A.PHAMVI_ID = pvsd.PHAMVI_ID and A.NGUONHANG_ID = dtk.NGUONDUOC_ID        where dtk.SOLUONG > 0 and dtk.BENHVIEN_ID = 'HLU01'        group by LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')), pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        ) tk on tk.DUOC_ID = d.DUOC_ID        left join TM_DUOC_PHAMVISUDUNG kd on kd.PHAMVI_ID = tk.PHAMVI_ID and kd.BENHVIEN_ID = 'HLU01'        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = tk.NGUONDUOC_ID and nh.BENHVIEN_ID = 'HLU01'        where d.BENHVIEN_ID = 'HLU01'  and tk.SOLUONG >= 0        end        else        begin                  select  distinct tk.DUOC_KEY, LTRIM(tk.PHAMVI_ID) as PHAMVI_ID, tk.NGUONDUOC_ID, nh.TENNGUONDUOC, nh.TINHTIEN, d.DUOC_ID, ld.MALOAIDUOC,        d.SOVISA,d.TYLE_VAT,d.COTOA, d.MADUOC, d.TENHANG, d.TENDUOCDAYDU, d.DONVITINH as DONVITINH, d.BHYT,        d.TENHOATCHAT, d.HAMLUONG, d.HANGSANXUAT, d.QUOCGIA, d.LOAIDUOC_ID, d.DUONGDUNG_ID, d.TINHTIEN_PTTT,        ten.TENDUOC, ten.TENDUOC_EN, ten.MAQUOCTE, ten.MAQUOCTEBT,        CASE WHEN d.BHYT = '1' THEN 'BHYT' ELSE '' END as BHYT_TEXT        , ld.LOAIVATTU_ID        , d.BENHVIEN_ID,        tk.SOLUONG, d.VTYT_PHANLOAI, d.PHAMVI, d.SUASOLUONGTONGHOP, d.MADUOCBV, d.DANGTRINHBAY        , TAMNGUNG = CASE WHEN d.TAMNGUNG = '1' OR nh.TAMNGUNG = '1' OR kd.TAMNGUNG = '1' THEN '1' ELSE '0' END        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        inner join        (        select  LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')) DUOC_KEY, (SUM(dtk.SOLUONG) - isnull(sum(A.SOLUONG),0) - isnull(sum(B.SOLUONG),0)) SOLUONG, pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        from (select sum(soluong) soluong,duoc_id,nguonduoc_id,khoduoc_id,benhvien_id from TT_DUOC_TONKHO  group by duoc_id,nguonduoc_id,khoduoc_id,benhvien_id) dtk        inner join TM_DUOC_PHAMVISD_MAPPING pvsd on dtk.KHODUOC_ID = pvsd.KHODUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NOITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) B on B.DUOC_ID = dtk.DUOC_ID and B.SOLUONG > 0 and B.PHAMVI_ID = pvsd.PHAMVI_ID and B.NGUONHANG_ID = dtk.NGUONDUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NGOAITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) A on A.DUOC_ID = dtk.DUOC_ID and A.SOLUONG > 0 and A.PHAMVI_ID = pvsd.PHAMVI_ID and A.NGUONHANG_ID = dtk.NGUONDUOC_ID        where dtk.SOLUONG > 0 and dtk.BENHVIEN_ID = 'HLU01'        group by LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')), pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        ) tk on tk.DUOC_ID = d.DUOC_ID        left join TM_DUOC_PHAMVISUDUNG kd on kd.PHAMVI_ID = tk.PHAMVI_ID and kd.BENHVIEN_ID = 'HLU01'        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = tk.NGUONDUOC_ID and nh.BENHVIEN_ID = 'HLU01'        where d.BENHVIEN_ID = 'HLU01'  and tk.SOLUONG >= 0        end]
2019-09-20 14:03:04,127 [5] DEBUG - Statement Id: [DAO00320_GetList] PreparedStatement : [select M.*            from TM_MAU M            LEFT JOIN TM_MAU_DONVITINH DVT on M.DONVITINH_ID=DVT.DONVITINH_ID            where            M.TAMNGUNG = '0'            and M.BENHVIEN_ID = 'HLU01'            order by M.TENMAU]
2019-09-20 14:03:04,219 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM071']
2019-09-20 14:03:04,254 [5] DEBUG - Statement Id: [DAO00322_GetListMauTonKhoForCreateCached] PreparedStatement : [SELECT DISTINCT          TK.MAU_KEY, TK.KHOMAU_ID, M.MAU_ID, M.MAMAU, M.TENMAU, M.NHOM_ABO, M.NHOM_RH, M.LOAIMAU_ID,          TK.SOLONHAP_ID, SLN.SOLONHAP, SLN.SOKIEMSOAT, TK.NGUONHANG_ID, NG.TENNGUONMAU, M.BENHVIEN_ID, M.DONVITINH_ID,          SUM(tk.SOLUONG) AS SOLUONG,K.TENKHO,DVT.TENDONVITINH          FROM TT_MAU_TONKHO TK          JOIN TM_KHO K ON TK.KHOMAU_ID = K.KHO_ID          JOIN TT_MAU_CHUNGTU_SOLONHAP SLN ON TK.SOLONHAP_ID = SLN.SOLONHAP_ID          JOIN TM_MAU M on TK.MAU_ID = M.MAU_ID and M.TAMNGUNG = '0'          LEFT JOIN TM_MAU_DONVITINH DVT on M.DONVITINH_ID=DVT.DONVITINH_ID          LEFT JOIN TM_NGUONMAU NG ON NG.NGUONMAU_ID = TK.NGUONHANG_ID          WHERE TK.SOLUONG > 0          GROUP BY TK.MAU_KEY, TK.KHOMAU_ID, M.MAU_ID, M.MAMAU, M.TENMAU, M.NHOM_ABO, M.NHOM_RH, M.LOAIMAU_ID,          TK.SOLONHAP_ID, SLN.SOLONHAP, SLN.SOKIEMSOAT,TK.NGUONHANG_ID, NG.TENNGUONMAU, M.BENHVIEN_ID, M.DONVITINH_ID,K.TENKHO,DVT.TENDONVITINH]
2019-09-20 14:03:04,347 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM073']
2019-09-20 14:03:04,613 [5] DEBUG - Statement Id: [DAO00322_GetListMauTonKhoTruBooking] PreparedStatement : [select distinct          TK.MAU_KEY, TK.KHOMAU_ID, M.MAU_ID, M.MAMAU, M.TENMAU, M.NHOM_ABO, M.NHOM_RH, M.LOAIMAU_ID, M.DONVITINH_ID,          TK.SOLONHAP_ID, TK.SOLONHAP, TK.SOKIEMSOAT,M.PHAMVI, TK.NGUONHANG_ID, NG.TENNGUONMAU, M.BENHVIEN_ID,          TK.SOLUONG,TK.TENKHO,DVT.TENDONVITINH          from TM_MAU M          JOIN          (          select          A.MAU_KEY, A.KHOMAU_ID, A.MAU_ID ,a.NGUONHANG_ID, A.SOLONHAP_ID, A.SOLONHAP, A.SOKIEMSOAT, A.SOLUONG,A.TENKHO          from          (          select KHOMAU_ID, TK.MAU_ID, TK.NGUONHANG_ID, TK.MAU_KEY, SLN.SOLONHAP_ID, SLN.SOLONHAP, SLN.SOKIEMSOAT, ISNULL(TK.SOLUONG,0) - ISNULL(book.SOLUONG,0) as SOLUONG,K.TENKHO          from TT_MAU_TONKHO TK          JOIN TM_KHO K ON TK.KHOMAU_ID = K.KHO_ID          inner join TT_MAU_CHUNGTU_SOLONHAP SLN ON TK.SOLONHAP_ID = SLN.SOLONHAP_ID          left join dbo.TT_MAU_TONKHO_BOOK book ON book.MAU_KEY = TK.MAU_KEY AND book.TRANGTHAI = 'HIEULUC'          where ISNULL(TK.SOLUONG,0) - ISNULL(book.SOLUONG,0) > 0          ) A          )TK on TK.MAU_ID = M.MAU_ID and M.TAMNGUNG = '0'          LEFT JOIN TM_MAU_DONVITINH DVT on M.DONVITINH_ID=DVT.DONVITINH_ID          LEFT JOIN TM_NGUONMAU NG ON NG.NGUONMAU_ID = TK.NGUONHANG_ID]
2019-09-20 14:03:05,313 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM072']
2019-09-20 14:03:06,244 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'MAIN'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2019-09-20 14:03:07,093 [1] DEBUG - Statement Id: [DAO00002_FormList] PreparedStatement : [select              TM_SYS_FORM.HOSPITAL_ID,              TM_SYS_FORM.NAME,              TM_SYS_FORM.CLASS,              TM_SYS_FORM.ASSEMBLY,              TM_SYS_FORM.TITLE_VI as TITLE              from TM_SYS_FORM              where HOSPITAL_ID = 'HLU01']
2019-09-20 14:03:12,100 [1] DEBUG - Statement Id: [DAO00300_GetShortcutListByUserID] PreparedStatement : [SELECT S.SHORTCUT_CODE, S.SHORTCUT_VALUE              FROM TM_SHORTCUT AS S              WHERE S.BENHVIEN_ID = 'HLU01' AND S.USER_ID = '1' AND TAMNGUNG = '0']
2019-09-20 14:03:12,147 [1] DEBUG - Statement Id: [DAO00087_GetList] PreparedStatement : [select CODE, VALUE, BENHVIEN_ID              from TM_SYS_APPSETTINGS              where LOCKED = '0' and BENHVIEN_ID = 'HLU01'              order by SETTING_ID]
2019-09-20 14:03:12,272 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'MSG01'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2019-09-20 14:03:12,443 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'MSG02'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2019-09-20 14:03:12,910 [1] DEBUG - Statement Id: [DAO00008_GetUserSettings] PreparedStatement : [select A.*, B.TENKHO , C.TENPHONGBAN, B.MAKHO, C.MAPHONGBAN          from TM_SYS_USERS A          left join TM_KHODUOC B on B.KHODUOC_ID = A.INVENTORY_ID          left join TM_PHONGBAN C on (C.PHONGBAN_ID = A.WORKING_DEPT_ID and C.BENHVIEN_ID =  @param0 )          left join TM_SYS_USERKHO D on (D.ACCOUNT_ID = A.ACCOUNT_ID and D.HOSPITAL_ID =  @param0 )          where          A.HOSPITAL_ID =  @param0            and                 A.ACCOUNT_ID =  @param1]
2019-09-20 14:03:12,912 [1] DEBUG - Statement Id: [DAO00008_GetUserSettings] Parameters: [@param0=[HOSPITAL_ID,HLU01], @param1=[ACCOUNT_ID,113]]
2019-09-20 14:03:12,912 [1] DEBUG - Statement Id: [DAO00008_GetUserSettings] Types: [@param0=[String, System.String], @param1=[String, System.String]]
2019-09-20 14:03:12,949 [1] DEBUG - Statement Id: [DAO00008_GetUserInvSettings] PreparedStatement : [select A.*, B.TENKHO, B.MAKHO, B.LOAIKHO_ID, B.KHOQUANLY_ID          from TM_SYS_USERKHO A          left join TM_KHO B on B.MODULE_ID = A.MODULE_ID and B.KHO_ID = A.KHO_ID          where A.HOSPITAL_ID =  @param0  and A.ACCOUNT_ID =  @param1           order by B.TENKHO]
2019-09-20 14:03:12,949 [1] DEBUG - Statement Id: [DAO00008_GetUserInvSettings] Parameters: [@param0=[HOSPITAL_ID,HLU01], @param1=[ACCOUNT_ID,113]]
2019-09-20 14:03:12,949 [1] DEBUG - Statement Id: [DAO00008_GetUserInvSettings] Types: [@param0=[String, System.String], @param1=[String, System.String]]
2019-09-20 14:03:13,136 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'COM30'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2019-09-20 14:03:13,316 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'RIS04'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2019-09-20 14:03:20,465 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'MENU1'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2019-09-20 14:03:20,564 [1] DEBUG - Statement Id: [DAO00011_GetList] PreparedStatement : [select              TM_SYS_MENU.ID,              TM_SYS_MENU.PARENTID,              TM_SYS_MENU.SCREEN,              TM_SYS_MENU.SMALLIMAGE,              TM_SYS_MENU.LARGEIMAGE,              TM_SYS_MENU.DESCRIPTION,              TM_SYS_MENU.TYPE,              TM_SYS_MENU.TITLE_VI as TITLE              from TM_SYS_MENU              where TM_SYS_MENU.HOSPITAL_ID = 'HLU01' and TM_SYS_MENU.ACTIVE = '1'               AND                   (TM_SYS_MENU.TYPE & '8' = '8')                             order by TM_SYS_MENU.ORDERNUM]
2019-09-20 14:03:20,831 [1] DEBUG - Statement Id: [DAO00011_usermenu_list] PreparedStatement : [select              TM_SYS_HOMEMENU.MENUID as ID,              TM_SYS_MENU.TITLE_VI as TITLE,              TM_SYS_MENU.SCREEN,              TM_SYS_MENU.SMALLIMAGE,              TM_SYS_MENU.LARGEIMAGE,              TM_SYS_MENU.TYPE              from TM_SYS_HOMEMENU              left join TM_SYS_MENU on TM_SYS_MENU.ID = TM_SYS_HOMEMENU.MENUID and TM_SYS_MENU.HOSPITAL_ID = TM_SYS_HOMEMENU.HOSPITAL_ID              where TM_SYS_HOMEMENU.HOSPITAL_ID = 'HLU01' and TM_SYS_HOMEMENU.USERID = '113' and TM_SYS_MENU.ACTIVE = '1'               AND                   (TM_SYS_MENU.TYPE & '8' = '8')                             ORDER BY TM_SYS_HOMEMENU.ORDERNUM]
2019-09-20 14:03:23,670 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'COM31'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2019-09-20 14:03:23,847 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'ORM28'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2019-09-20 14:03:28,676 [1] DEBUG - Statement Id: [DAO00066_GetBENHAN_TIEPNHAN] PreparedStatement : [select top 1 *        from TT_NOITRU_BENHAN        where TIEPNHAN_ID = '27022'  and BENHVIEN_ID = 'HLU01'        order by NGAYTAO desc]
2019-09-20 14:03:28,769 [1] DEBUG - Statement Id: [DAO00014_GetInPatientStatus] PreparedStatement : [select TRANGTHAI, isnull(KHOACHUYENDEN_ID, KHOAVAO_ID) as KHOAHIENTAI from TT_NOITRU_BENHAN        where        TIEPNHAN_ID = '27022'        and BENHVIEN_ID = 'HLU01'         and           BENHAN_ID = '5800']
2019-09-20 14:03:28,860 [1] DEBUG - Statement Id: [DAO00048_TT_PHAUTHUAT_GetList] PreparedStatement : [select *              from TT_PHAUTHUAT               where                             TT_PHAUTHUAT.LOAI = 'P'                       and                           TT_PHAUTHUAT.TIEPNHAN_ID = 27022                       and                           TT_PHAUTHUAT.BENHVIEN_ID = 'HLU01'                                     order by PHAUTHUAT_ID DESC]
2019-09-20 14:03:28,905 [1] DEBUG - Statement Id: [DAO00048_GetListLoaiGacTrongPTTT] PreparedStatement : [select DICTIONARY_ID, DICTIONARY_CODE, DICTIONARY_NAME          from LST_DICTIONARY          where DICTIONARY_TYPE_CODE = 'LoaiGacPTTT'          and ENABLED = '1']
2019-09-20 14:03:30,230 [1] DEBUG - Statement Id: [DAO00048_GetDSLoaiGacDaGhiNhan] PreparedStatement : [select A.KIEMSOATGAC_ID, A.BENHNHAN_ID, A.TIEPNHAN_ID, A.BENHAN_ID, A.PHAUTHUAT_ID, A.LOAIPT_TT, A.LOAIGAC_ID          , A.NGAYGHINHAN, A.THOIGIANGHINHAN, A.SOLUONG, A.SOLUONGDASUDUNG, A.SOLUONGCONLAI, A.GHICHU, A.NGUOINHANDUNGCU_ID          , B.DICTIONARY_CODE AS MALOAIGAC, B.DICTIONARY_NAME AS TENLOAIGAC          from TT_PHAUTHUAT_GHINHANGAC A          inner join LST_DICTIONARY B on B.DICTIONARY_ID = A.LOAIGAC_ID          where A.PHAUTHUAT_ID = 3742 and A.BENHVIEN_ID = 'HLU01']
2019-09-20 14:03:30,632 [1] DEBUG - Statement Id: [DAO00048_GetDSLoaiGacDaGhiNhan] PreparedStatement : [select A.KIEMSOATGAC_ID, A.BENHNHAN_ID, A.TIEPNHAN_ID, A.BENHAN_ID, A.PHAUTHUAT_ID, A.LOAIPT_TT, A.LOAIGAC_ID          , A.NGAYGHINHAN, A.THOIGIANGHINHAN, A.SOLUONG, A.SOLUONGDASUDUNG, A.SOLUONGCONLAI, A.GHICHU, A.NGUOINHANDUNGCU_ID          , B.DICTIONARY_CODE AS MALOAIGAC, B.DICTIONARY_NAME AS TENLOAIGAC          from TT_PHAUTHUAT_GHINHANGAC A          inner join LST_DICTIONARY B on B.DICTIONARY_ID = A.LOAIGAC_ID          where A.PHAUTHUAT_ID = 3742 and A.BENHVIEN_ID = 'HLU01']
2019-09-20 14:03:33,934 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'COM98'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2019-09-20 14:03:35,370 [1] DEBUG - Statement Id: [DAO00048_DeleteLoaiGacByPhauThuatId] PreparedStatement : [DELETE FROM TT_PHAUTHUAT_GHINHANGAC WHERE KIEMSOATGAC_ID = 3742 AND BENHVIEN_ID = 'HLU01'            SELECT 3742]
2019-09-20 14:03:40,217 [1] DEBUG - Statement Id: [DAO00066_GetBENHAN_TIEPNHAN] PreparedStatement : [select top 1 *        from TT_NOITRU_BENHAN        where TIEPNHAN_ID = '27022'  and BENHVIEN_ID = 'HLU01'        order by NGAYTAO desc]
2019-09-20 14:03:40,861 [1] DEBUG - Statement Id: [DAO00014_GetInPatientStatus] PreparedStatement : [select TRANGTHAI, isnull(KHOACHUYENDEN_ID, KHOAVAO_ID) as KHOAHIENTAI from TT_NOITRU_BENHAN        where        TIEPNHAN_ID = '27022'        and BENHVIEN_ID = 'HLU01'         and           BENHAN_ID = '5800']
2019-09-20 14:03:40,948 [1] DEBUG - Statement Id: [DAO00048_TT_PHAUTHUAT_GetList] PreparedStatement : [select *              from TT_PHAUTHUAT               where                             TT_PHAUTHUAT.LOAI = 'P'                       and                           TT_PHAUTHUAT.TIEPNHAN_ID = 27022                       and                           TT_PHAUTHUAT.BENHVIEN_ID = 'HLU01'                                     order by PHAUTHUAT_ID DESC]
2019-09-20 14:03:40,995 [1] DEBUG - Statement Id: [DAO00048_GetListLoaiGacTrongPTTT] PreparedStatement : [select DICTIONARY_ID, DICTIONARY_CODE, DICTIONARY_NAME          from LST_DICTIONARY          where DICTIONARY_TYPE_CODE = 'LoaiGacPTTT'          and ENABLED = '1']
2019-09-20 14:04:00,938 [1] DEBUG - Statement Id: [DAO00048_GetDSLoaiGacDaGhiNhan] PreparedStatement : [select A.KIEMSOATGAC_ID, A.BENHNHAN_ID, A.TIEPNHAN_ID, A.BENHAN_ID, A.PHAUTHUAT_ID, A.LOAIPT_TT, A.LOAIGAC_ID          , A.NGAYGHINHAN, A.THOIGIANGHINHAN, A.SOLUONG, A.SOLUONGDASUDUNG, A.SOLUONGCONLAI, A.GHICHU, A.NGUOINHANDUNGCU_ID          , B.DICTIONARY_CODE AS MALOAIGAC, B.DICTIONARY_NAME AS TENLOAIGAC          from TT_PHAUTHUAT_GHINHANGAC A          inner join LST_DICTIONARY B on B.DICTIONARY_ID = A.LOAIGAC_ID          where A.PHAUTHUAT_ID = 3742 and A.BENHVIEN_ID = 'HLU01']
2019-09-20 14:04:01,264 [1] DEBUG - Statement Id: [DAO00048_GetDSLoaiGacDaGhiNhan] PreparedStatement : [select A.KIEMSOATGAC_ID, A.BENHNHAN_ID, A.TIEPNHAN_ID, A.BENHAN_ID, A.PHAUTHUAT_ID, A.LOAIPT_TT, A.LOAIGAC_ID          , A.NGAYGHINHAN, A.THOIGIANGHINHAN, A.SOLUONG, A.SOLUONGDASUDUNG, A.SOLUONGCONLAI, A.GHICHU, A.NGUOINHANDUNGCU_ID          , B.DICTIONARY_CODE AS MALOAIGAC, B.DICTIONARY_NAME AS TENLOAIGAC          from TT_PHAUTHUAT_GHINHANGAC A          inner join LST_DICTIONARY B on B.DICTIONARY_ID = A.LOAIGAC_ID          where A.PHAUTHUAT_ID = 3742 and A.BENHVIEN_ID = 'HLU01']
--------------------------------------------------------------------------------
2019-09-20 14:05:20,481 [1] DEBUG - Statement Id: [DAO00001_DBList] PreparedStatement : [select *              from TM_SYS_SERVER              where HOSPITAL_ID = '_SYSTEM_' and TYPE = 'D']
2019-09-20 14:05:22,037 [1] DEBUG - Statement Id: [DAO00001_DaoList] PreparedStatement : [select              TM_SYS_SERVICEMAP.ID,              TM_SYS_SERVICEMAP.HOSPITAL_ID,              TM_SYS_SERVICEMAP.DB_NAME,              TM_SYS_SERVICEMAP.TYPE,              TM_SYS_SERVICEMAP.NAME,              TM_SYS_SERVICEMAP.CLASS,              (TM_SYS_DIC.VALUE + '.' + TM_SYS_SERVICEMAP.CLASS) as CLASSFULL,              TM_SYS_SERVICEMAP.ASSEMBLY              from TM_SYS_SERVICEMAP              inner join TM_SYS_DIC              on TM_SYS_SERVICEMAP.NAMESPACE = TM_SYS_DIC.ID              where HOSPITAL_ID = '_SYSTEM_' AND TYPE = 'D' AND ACTIVE = '1'              order by DB_NAME]
2019-09-20 14:05:22,079 [1] DEBUG - Statement Id: [DAO00001_ServiceList] PreparedStatement : [select              TM_SYS_SERVICEMAP.ID,              TM_SYS_SERVICEMAP.HOSPITAL_ID,              TM_SYS_SERVICEMAP.DB_NAME,              TM_SYS_SERVICEMAP.TYPE,              TM_SYS_SERVICEMAP.NAME,              TM_SYS_SERVICEMAP.CLASS,              (TM_SYS_DIC.VALUE + '.' + TM_SYS_SERVICEMAP.CLASS) as CLASSFULL,              TM_SYS_SERVICEMAP.ASSEMBLY,              TM_SYS_SERVER.URL              from TM_SYS_SERVICEMAP              inner join TM_SYS_DIC on TM_SYS_SERVICEMAP.NAMESPACE = TM_SYS_DIC.ID              inner join TM_SYS_SERVER on (TM_SYS_SERVICEMAP.DB_NAME = TM_SYS_SERVER.NAME) and (TM_SYS_SERVER.HOSPITAL_ID = '_SYSTEM_')              where TM_SYS_SERVICEMAP.HOSPITAL_ID = '_SYSTEM_' AND TM_SYS_SERVICEMAP.TYPE = 'S'  AND ACTIVE = '1'              order by URL]
2019-09-20 14:05:22,473 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = '_SYSTEM_'               AND                   TM_SYS_SCREEN.PAGE = 'LOGIN'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2019-09-20 14:05:22,771 [1] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = '_SYSTEM_'               AND                   TM_SYS_CACHE.ACTIVE = '1']
2019-09-20 14:05:27,472 [1] DEBUG - Statement Id: [DAO00001_DBList] PreparedStatement : [select *              from TM_SYS_SERVER              where HOSPITAL_ID = 'HLU01' and TYPE = 'D']
2019-09-20 14:05:27,504 [1] DEBUG - Statement Id: [DAO00001_DaoList] PreparedStatement : [select              TM_SYS_SERVICEMAP.ID,              TM_SYS_SERVICEMAP.HOSPITAL_ID,              TM_SYS_SERVICEMAP.DB_NAME,              TM_SYS_SERVICEMAP.TYPE,              TM_SYS_SERVICEMAP.NAME,              TM_SYS_SERVICEMAP.CLASS,              (TM_SYS_DIC.VALUE + '.' + TM_SYS_SERVICEMAP.CLASS) as CLASSFULL,              TM_SYS_SERVICEMAP.ASSEMBLY              from TM_SYS_SERVICEMAP              inner join TM_SYS_DIC              on TM_SYS_SERVICEMAP.NAMESPACE = TM_SYS_DIC.ID              where HOSPITAL_ID = 'HLU01' AND TYPE = 'D' AND ACTIVE = '1'              order by DB_NAME]
2019-09-20 14:05:29,908 [1] DEBUG - Statement Id: [DAO00001_ServiceList] PreparedStatement : [select              TM_SYS_SERVICEMAP.ID,              TM_SYS_SERVICEMAP.HOSPITAL_ID,              TM_SYS_SERVICEMAP.DB_NAME,              TM_SYS_SERVICEMAP.TYPE,              TM_SYS_SERVICEMAP.NAME,              TM_SYS_SERVICEMAP.CLASS,              (TM_SYS_DIC.VALUE + '.' + TM_SYS_SERVICEMAP.CLASS) as CLASSFULL,              TM_SYS_SERVICEMAP.ASSEMBLY,              TM_SYS_SERVER.URL              from TM_SYS_SERVICEMAP              inner join TM_SYS_DIC on TM_SYS_SERVICEMAP.NAMESPACE = TM_SYS_DIC.ID              inner join TM_SYS_SERVER on (TM_SYS_SERVICEMAP.DB_NAME = TM_SYS_SERVER.NAME) and (TM_SYS_SERVER.HOSPITAL_ID = 'HLU01')              where TM_SYS_SERVICEMAP.HOSPITAL_ID = 'HLU01' AND TM_SYS_SERVICEMAP.TYPE = 'S'  AND ACTIVE = '1'              order by URL]
2019-09-20 14:05:30,124 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1']
2019-09-20 14:05:31,031 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM005']
2019-09-20 14:05:31,706 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM015']
2019-09-20 14:05:31,809 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM067']
2019-09-20 14:05:31,893 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM008']
2019-09-20 14:05:31,978 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM068']
2019-09-20 14:05:32,055 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM006']
2019-09-20 14:05:32,129 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM030']
2019-09-20 14:05:32,213 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM025']
2019-09-20 14:05:32,309 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM024']
2019-09-20 14:05:32,824 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM033']
2019-09-20 14:05:32,866 [5] DEBUG - Statement Id: [DAO00027_GetListDuocKyGuiTonKho] PreparedStatement : [select  distinct TT_TONKHO.DUOC_KEY, LTRIM(TT_TONKHO.KHODUOC_ID) as KHODUOC_ID, TM_DUOC.DUOC_ID, TM_LOAIDUOC.MALOAIDUOC,TM_DUOC.SOVISA,TM_DUOC.TYLE_VAT,TM_DUOC.COTOA,        TM_DUOC.MADUOC, TM_DUOC.TENHANG, TM_DUOC.TENDUOCDAYDU, dvt.TENDONVITINH as DONVITINH,  TM_DUOC.DONVITINH_ID,TM_DUOC.BHYT,TM_DUOC.PHAMVI,        TM_DUOC.TENHOATCHAT, TM_DUOC.HAMLUONG, TM_DUOC.HANGSANXUAT, TM_DUOC.QUOCGIA, TM_DUOC.LOAIDUOC_ID, TM_DUOC.DUONGDUNG_ID,        TM_TENDUOC.TENDUOC, TM_TENDUOC.TENDUOC_EN, TM_TENDUOC.MAQUOCTE, TM_TENDUOC.MAQUOCTEBT,        TM_LOAIDUOC.LOAIVATTU_ID, TM_DUOC.BENHVIEN_ID,TT_TONKHO.SOLUONG, TT_TONKHO.NGUONDUOC_ID, NH.TENNGUONDUOC        , TAMNGUNG = CASE WHEN TM_DUOC.TAMNGUNG = '1' OR nh.TAMNGUNG = '1' OR KD.TAMNGUNG = '1' THEN '1' ELSE '0' END        , TM_DUOC.DANGTRINHBAY        from TM_DUOC        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = TM_DUOC.DONVITINH_ID        left join TM_TENDUOC on TM_DUOC.TENDUOC_ID = TM_TENDUOC.TENDUOC_ID and TM_DUOC.BENHVIEN_ID = 'HLU01' and TM_DUOC.TAMNGUNG = '0'        left join TM_LOAIDUOC on TM_LOAIDUOC.LOAIDUOC_ID = TM_DUOC.LOAIDUOC_ID and TM_LOAIDUOC.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG on (TM_LOAIDUOC.LOAIVATTU_ID = TM_DUOC_HANDUNG.LOAIDUOC and TM_DUOC_HANDUNG.BENHVIEN_ID = 'HLU01')        inner join        (select LTRIM(A.KHODUOC_ID) + '_' + LTRIM(A.DUOC_ID) + '_' + LTRIM(ISNULL(A.NGUONDUOC_ID,'')) as DUOC_KEY, A.KHODUOC_ID, A.DUOC_ID,A.NGUONDUOC_ID,        SUM(isnull(A.SOLUONG,0)) as SOLUONG        from        (select SUM(SOLUONG) as SOLUONG, KHODUOC_ID, DUOC_ID, NGUONDUOC_ID from TT_DUOC_KYGUI_TONKHO        where BENHVIEN_ID = 'HLU01' group by KHODUOC_ID, DUOC_ID, NGUONDUOC_ID) A        group by LTRIM(A.KHODUOC_ID) + '_' + LTRIM(A.DUOC_ID) + '_' + LTRIM(A.NGUONDUOC_ID), A.KHODUOC_ID, A.DUOC_ID, A.NGUONDUOC_ID)        TT_TONKHO on TT_TONKHO.DUOC_ID = TM_DUOC.DUOC_ID        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = TT_TONKHO.NGUONDUOC_ID and nh.BENHVIEN_ID = 'HLU01'        LEFT JOIN TM_KHODUOC KD ON KD.KHODUOC_ID = TT_TONKHO.KHODUOC_ID        where TM_DUOC.BENHVIEN_ID = 'HLU01' AND TT_TONKHO.SOLUONG >= 0]
2019-09-20 14:05:32,948 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM018']
2019-09-20 14:05:32,994 [5] DEBUG - Statement Id: [DAO00027_GetListDuocTonKho] PreparedStatement : [select distinct TT_TONKHO.DUOC_KEY, LTRIM(TT_TONKHO.KHODUOC_ID) as KHODUOC_ID, TM_DUOC.DUOC_ID, TM_LOAIDUOC.MALOAIDUOC,TM_DUOC.SOVISA,TM_DUOC.TYLE_VAT,TM_DUOC.COTOA,        TM_DUOC.MADUOC, TM_DUOC.TENHANG, TM_DUOC.TENDUOCDAYDU, dvt.TENDONVITINH as DONVITINH,  TM_DUOC.DONVITINH_ID,TM_DUOC.BHYT,                TM_DUOC.TENHOATCHAT,          TM_DUOC.HAMLUONG, TM_DUOC.HANGSANXUAT, TM_DUOC.QUOCGIA, TM_DUOC.LOAIDUOC_ID, TM_DUOC.DUONGDUNG_ID,        TM_TENDUOC.TENDUOC, TM_TENDUOC.TENDUOC_EN, TM_TENDUOC.MAQUOCTE, TM_TENDUOC.MAQUOCTEBT,        TM_LOAIDUOC.LOAIVATTU_ID, TM_DUOC.BENHVIEN_ID,        TT_TONKHO.SOLUONG, TM_DUOC.VTYT_PHANLOAI, TM_DUOC.PHAMVI, TT_TONKHO.NGUONDUOC_ID, NG.TENNGUONDUOC AS TENNGUONDUOC        , TAMNGUNG = CASE WHEN TM_DUOC.TAMNGUNG = '1' OR NG.TAMNGUNG = '1' OR KD.TAMNGUNG = '1' THEN '1' ELSE '0' END        , TM_DUOC.DANGTRINHBAY        from TM_DUOC        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = TM_DUOC.DONVITINH_ID        left join TM_TENDUOC on TM_DUOC.TENDUOC_ID = TM_TENDUOC.TENDUOC_ID and TM_DUOC.BENHVIEN_ID = 'HLU01' and TM_DUOC.TAMNGUNG = '0'        left join TM_LOAIDUOC on TM_LOAIDUOC.LOAIDUOC_ID = TM_DUOC.LOAIDUOC_ID and TM_LOAIDUOC.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG on (TM_LOAIDUOC.LOAIVATTU_ID = TM_DUOC_HANDUNG.LOAIDUOC and TM_DUOC_HANDUNG.BENHVIEN_ID = 'HLU01')        inner join        (select LTRIM(A.KHODUOC_ID) + '_' + LTRIM(A.DUOC_ID) + '_' + LTRIM(ISNULL(A.NGUONDUOC_ID,'')) as DUOC_KEY, A.KHODUOC_ID, A.DUOC_ID, A.NGUONDUOC_ID,        SUM(isnull(A.SOLUONG,0)) as SOLUONG        from        (select SUM(SOLUONG) as SOLUONG, KHODUOC_ID, DUOC_ID, NGUONDUOC_ID from TT_DUOC_TONKHO        where BENHVIEN_ID = 'HLU01' group by KHODUOC_ID, DUOC_ID, NGUONDUOC_ID) A        group by LTRIM(A.KHODUOC_ID) + '_' + LTRIM(A.DUOC_ID) + '_' + LTRIM(ISNULL(A.NGUONDUOC_ID,'')), A.KHODUOC_ID, A.DUOC_ID, NGUONDUOC_ID        ) TT_TONKHO on TT_TONKHO.DUOC_ID = TM_DUOC.DUOC_ID        LEFT JOIN TM_NGUONHANG NG ON NG.NGUONDUOC_ID = TT_TONKHO.NGUONDUOC_ID        LEFT JOIN TM_KHODUOC KD ON KD.KHODUOC_ID = TT_TONKHO.KHODUOC_ID        where TM_DUOC.BENHVIEN_ID = 'HLU01' and TT_TONKHO.SOLUONG >= 0]
2019-09-20 14:05:34,237 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM023']
2019-09-20 14:05:34,275 [5] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoVaBooking] PreparedStatement : [declare @NGUONDUOC_MACDINH varchar(5) = '0';        declare @TOAMUANGOAI int = 0;        select @NGUONDUOC_MACDINH = isnull(VALUE,0) from TM_SYS_APPSETTINGS where CODE = 'PHA_NGUONDUOC'        select @TOAMUANGOAI = isnull(VALUE,0) from TM_SYS_APPSETTINGS where CODE = 'OPD_TOAMUANGOAI_DUNGDANHMUC_DUOC'                if @TOAMUANGOAI = 1        begin        select  distinct '0' + '_' + LTRIM(d.DUOC_ID) + '_' + @NGUONDUOC_MACDINH as DUOC_KEY, 0 as PHAMVI_ID, @NGUONDUOC_MACDINH as NGUONDUOC_ID, null as TENNGUONDUOC, null as TINHTIEN, d.DUOC_ID, ld.MALOAIDUOC,        d.SOVISA,d.TYLE_VAT,d.COTOA, d.MADUOC, d.TENHANG, d.TENDUOCDAYDU, d.DONVITINH as DONVITINH, d.BHYT,        d.TENHOATCHAT, d.HAMLUONG, d.HANGSANXUAT, d.QUOCGIA, d.LOAIDUOC_ID, d.DUONGDUNG_ID, d.TINHTIEN_PTTT,        ten.TENDUOC, ten.TENDUOC_EN, ten.MAQUOCTE, ten.MAQUOCTEBT,        '' as BHYT_TEXT        , ld.LOAIVATTU_ID        , d.BENHVIEN_ID,        999999999 as SOLUONG, d.VTYT_PHANLOAI, d.PHAMVI, d.SUASOLUONGTONGHOP, d.MADUOCBV, d.DANGTRINHBAY        , TAMNGUNG = CASE WHEN d.TAMNGUNG = '1' THEN '1' ELSE '0' END        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        union all        select  distinct tk.DUOC_KEY, LTRIM(tk.PHAMVI_ID) as PHAMVI_ID, tk.NGUONDUOC_ID, nh.TENNGUONDUOC, nh.TINHTIEN, d.DUOC_ID, ld.MALOAIDUOC,        d.SOVISA,d.TYLE_VAT,d.COTOA, d.MADUOC, d.TENHANG, d.TENDUOCDAYDU, d.DONVITINH as DONVITINH, d.BHYT,        d.TENHOATCHAT, d.HAMLUONG, d.HANGSANXUAT, d.QUOCGIA, d.LOAIDUOC_ID, d.DUONGDUNG_ID, d.TINHTIEN_PTTT,        ten.TENDUOC, ten.TENDUOC_EN, ten.MAQUOCTE, ten.MAQUOCTEBT,        CASE WHEN d.BHYT = '1' THEN 'BHYT' ELSE '' END as BHYT_TEXT        , ld.LOAIVATTU_ID        , d.BENHVIEN_ID,        tk.SOLUONG, d.VTYT_PHANLOAI, d.PHAMVI, d.SUASOLUONGTONGHOP, d.MADUOCBV, d.DANGTRINHBAY        , TAMNGUNG = CASE WHEN d.TAMNGUNG = '1' OR nh.TAMNGUNG = '1' OR kd.TAMNGUNG = '1' THEN '1' ELSE '0' END        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        inner join        (        select  LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')) DUOC_KEY, (SUM(dtk.SOLUONG) - isnull(sum(A.SOLUONG),0) - isnull(sum(B.SOLUONG),0)) SOLUONG, pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        from (select sum(soluong) soluong,duoc_id,nguonduoc_id,khoduoc_id,benhvien_id from TT_DUOC_TONKHO  group by duoc_id,nguonduoc_id,khoduoc_id,benhvien_id) dtk        inner join TM_DUOC_PHAMVISD_MAPPING pvsd on dtk.KHODUOC_ID = pvsd.KHODUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NOITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) B on B.DUOC_ID = dtk.DUOC_ID and B.SOLUONG > 0 and B.PHAMVI_ID = pvsd.PHAMVI_ID and B.NGUONHANG_ID = dtk.NGUONDUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NGOAITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) A on A.DUOC_ID = dtk.DUOC_ID and A.SOLUONG > 0 and A.PHAMVI_ID = pvsd.PHAMVI_ID and A.NGUONHANG_ID = dtk.NGUONDUOC_ID        where dtk.SOLUONG > 0 and dtk.BENHVIEN_ID = 'HLU01'        group by LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')), pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        ) tk on tk.DUOC_ID = d.DUOC_ID        left join TM_DUOC_PHAMVISUDUNG kd on kd.PHAMVI_ID = tk.PHAMVI_ID and kd.BENHVIEN_ID = 'HLU01'        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = tk.NGUONDUOC_ID and nh.BENHVIEN_ID = 'HLU01'        where d.BENHVIEN_ID = 'HLU01'  and tk.SOLUONG >= 0        end        else        begin                  select  distinct tk.DUOC_KEY, LTRIM(tk.PHAMVI_ID) as PHAMVI_ID, tk.NGUONDUOC_ID, nh.TENNGUONDUOC, nh.TINHTIEN, d.DUOC_ID, ld.MALOAIDUOC,        d.SOVISA,d.TYLE_VAT,d.COTOA, d.MADUOC, d.TENHANG, d.TENDUOCDAYDU, d.DONVITINH as DONVITINH, d.BHYT,        d.TENHOATCHAT, d.HAMLUONG, d.HANGSANXUAT, d.QUOCGIA, d.LOAIDUOC_ID, d.DUONGDUNG_ID, d.TINHTIEN_PTTT,        ten.TENDUOC, ten.TENDUOC_EN, ten.MAQUOCTE, ten.MAQUOCTEBT,        CASE WHEN d.BHYT = '1' THEN 'BHYT' ELSE '' END as BHYT_TEXT        , ld.LOAIVATTU_ID        , d.BENHVIEN_ID,        tk.SOLUONG, d.VTYT_PHANLOAI, d.PHAMVI, d.SUASOLUONGTONGHOP, d.MADUOCBV, d.DANGTRINHBAY        , TAMNGUNG = CASE WHEN d.TAMNGUNG = '1' OR nh.TAMNGUNG = '1' OR kd.TAMNGUNG = '1' THEN '1' ELSE '0' END        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        inner join        (        select  LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')) DUOC_KEY, (SUM(dtk.SOLUONG) - isnull(sum(A.SOLUONG),0) - isnull(sum(B.SOLUONG),0)) SOLUONG, pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        from (select sum(soluong) soluong,duoc_id,nguonduoc_id,khoduoc_id,benhvien_id from TT_DUOC_TONKHO  group by duoc_id,nguonduoc_id,khoduoc_id,benhvien_id) dtk        inner join TM_DUOC_PHAMVISD_MAPPING pvsd on dtk.KHODUOC_ID = pvsd.KHODUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NOITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) B on B.DUOC_ID = dtk.DUOC_ID and B.SOLUONG > 0 and B.PHAMVI_ID = pvsd.PHAMVI_ID and B.NGUONHANG_ID = dtk.NGUONDUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NGOAITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) A on A.DUOC_ID = dtk.DUOC_ID and A.SOLUONG > 0 and A.PHAMVI_ID = pvsd.PHAMVI_ID and A.NGUONHANG_ID = dtk.NGUONDUOC_ID        where dtk.SOLUONG > 0 and dtk.BENHVIEN_ID = 'HLU01'        group by LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')), pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        ) tk on tk.DUOC_ID = d.DUOC_ID        left join TM_DUOC_PHAMVISUDUNG kd on kd.PHAMVI_ID = tk.PHAMVI_ID and kd.BENHVIEN_ID = 'HLU01'        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = tk.NGUONDUOC_ID and nh.BENHVIEN_ID = 'HLU01'        where d.BENHVIEN_ID = 'HLU01'  and tk.SOLUONG >= 0        end]
2019-09-20 14:05:39,459 [5] DEBUG - Statement Id: [DAO00320_GetList] PreparedStatement : [select M.*            from TM_MAU M            LEFT JOIN TM_MAU_DONVITINH DVT on M.DONVITINH_ID=DVT.DONVITINH_ID            where            M.TAMNGUNG = '0'            and M.BENHVIEN_ID = 'HLU01'            order by M.TENMAU]
2019-09-20 14:05:39,533 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM071']
2019-09-20 14:05:39,594 [5] DEBUG - Statement Id: [DAO00322_GetListMauTonKhoForCreateCached] PreparedStatement : [SELECT DISTINCT          TK.MAU_KEY, TK.KHOMAU_ID, M.MAU_ID, M.MAMAU, M.TENMAU, M.NHOM_ABO, M.NHOM_RH, M.LOAIMAU_ID,          TK.SOLONHAP_ID, SLN.SOLONHAP, SLN.SOKIEMSOAT, TK.NGUONHANG_ID, NG.TENNGUONMAU, M.BENHVIEN_ID, M.DONVITINH_ID,          SUM(tk.SOLUONG) AS SOLUONG,K.TENKHO,DVT.TENDONVITINH          FROM TT_MAU_TONKHO TK          JOIN TM_KHO K ON TK.KHOMAU_ID = K.KHO_ID          JOIN TT_MAU_CHUNGTU_SOLONHAP SLN ON TK.SOLONHAP_ID = SLN.SOLONHAP_ID          JOIN TM_MAU M on TK.MAU_ID = M.MAU_ID and M.TAMNGUNG = '0'          LEFT JOIN TM_MAU_DONVITINH DVT on M.DONVITINH_ID=DVT.DONVITINH_ID          LEFT JOIN TM_NGUONMAU NG ON NG.NGUONMAU_ID = TK.NGUONHANG_ID          WHERE TK.SOLUONG > 0          GROUP BY TK.MAU_KEY, TK.KHOMAU_ID, M.MAU_ID, M.MAMAU, M.TENMAU, M.NHOM_ABO, M.NHOM_RH, M.LOAIMAU_ID,          TK.SOLONHAP_ID, SLN.SOLONHAP, SLN.SOKIEMSOAT,TK.NGUONHANG_ID, NG.TENNGUONMAU, M.BENHVIEN_ID, M.DONVITINH_ID,K.TENKHO,DVT.TENDONVITINH]
2019-09-20 14:05:39,665 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM073']
2019-09-20 14:05:39,700 [5] DEBUG - Statement Id: [DAO00322_GetListMauTonKhoTruBooking] PreparedStatement : [select distinct          TK.MAU_KEY, TK.KHOMAU_ID, M.MAU_ID, M.MAMAU, M.TENMAU, M.NHOM_ABO, M.NHOM_RH, M.LOAIMAU_ID, M.DONVITINH_ID,          TK.SOLONHAP_ID, TK.SOLONHAP, TK.SOKIEMSOAT,M.PHAMVI, TK.NGUONHANG_ID, NG.TENNGUONMAU, M.BENHVIEN_ID,          TK.SOLUONG,TK.TENKHO,DVT.TENDONVITINH          from TM_MAU M          JOIN          (          select          A.MAU_KEY, A.KHOMAU_ID, A.MAU_ID ,a.NGUONHANG_ID, A.SOLONHAP_ID, A.SOLONHAP, A.SOKIEMSOAT, A.SOLUONG,A.TENKHO          from          (          select KHOMAU_ID, TK.MAU_ID, TK.NGUONHANG_ID, TK.MAU_KEY, SLN.SOLONHAP_ID, SLN.SOLONHAP, SLN.SOKIEMSOAT, ISNULL(TK.SOLUONG,0) - ISNULL(book.SOLUONG,0) as SOLUONG,K.TENKHO          from TT_MAU_TONKHO TK          JOIN TM_KHO K ON TK.KHOMAU_ID = K.KHO_ID          inner join TT_MAU_CHUNGTU_SOLONHAP SLN ON TK.SOLONHAP_ID = SLN.SOLONHAP_ID          left join dbo.TT_MAU_TONKHO_BOOK book ON book.MAU_KEY = TK.MAU_KEY AND book.TRANGTHAI = 'HIEULUC'          where ISNULL(TK.SOLUONG,0) - ISNULL(book.SOLUONG,0) > 0          ) A          )TK on TK.MAU_ID = M.MAU_ID and M.TAMNGUNG = '0'          LEFT JOIN TM_MAU_DONVITINH DVT on M.DONVITINH_ID=DVT.DONVITINH_ID          LEFT JOIN TM_NGUONMAU NG ON NG.NGUONMAU_ID = TK.NGUONHANG_ID]
2019-09-20 14:05:39,777 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM072']
2019-09-20 14:05:40,738 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'MAIN'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2019-09-20 14:05:42,466 [1] DEBUG - Statement Id: [DAO00002_FormList] PreparedStatement : [select              TM_SYS_FORM.HOSPITAL_ID,              TM_SYS_FORM.NAME,              TM_SYS_FORM.CLASS,              TM_SYS_FORM.ASSEMBLY,              TM_SYS_FORM.TITLE_VI as TITLE              from TM_SYS_FORM              where HOSPITAL_ID = 'HLU01']
2019-09-20 14:05:47,387 [1] DEBUG - Statement Id: [DAO00300_GetShortcutListByUserID] PreparedStatement : [SELECT S.SHORTCUT_CODE, S.SHORTCUT_VALUE              FROM TM_SHORTCUT AS S              WHERE S.BENHVIEN_ID = 'HLU01' AND S.USER_ID = '1' AND TAMNGUNG = '0']
2019-09-20 14:05:47,982 [1] DEBUG - Statement Id: [DAO00087_GetList] PreparedStatement : [select CODE, VALUE, BENHVIEN_ID              from TM_SYS_APPSETTINGS              where LOCKED = '0' and BENHVIEN_ID = 'HLU01'              order by SETTING_ID]
2019-09-20 14:05:53,400 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'MSG01'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2019-09-20 14:05:53,518 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'MSG02'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2019-09-20 14:05:53,650 [1] DEBUG - Statement Id: [DAO00008_GetUserSettings] PreparedStatement : [select A.*, B.TENKHO , C.TENPHONGBAN, B.MAKHO, C.MAPHONGBAN          from TM_SYS_USERS A          left join TM_KHODUOC B on B.KHODUOC_ID = A.INVENTORY_ID          left join TM_PHONGBAN C on (C.PHONGBAN_ID = A.WORKING_DEPT_ID and C.BENHVIEN_ID =  @param0 )          left join TM_SYS_USERKHO D on (D.ACCOUNT_ID = A.ACCOUNT_ID and D.HOSPITAL_ID =  @param0 )          where          A.HOSPITAL_ID =  @param0            and                 A.ACCOUNT_ID =  @param1]
2019-09-20 14:05:53,652 [1] DEBUG - Statement Id: [DAO00008_GetUserSettings] Parameters: [@param0=[HOSPITAL_ID,HLU01], @param1=[ACCOUNT_ID,113]]
2019-09-20 14:05:53,652 [1] DEBUG - Statement Id: [DAO00008_GetUserSettings] Types: [@param0=[String, System.String], @param1=[String, System.String]]
2019-09-20 14:05:53,685 [1] DEBUG - Statement Id: [DAO00008_GetUserInvSettings] PreparedStatement : [select A.*, B.TENKHO, B.MAKHO, B.LOAIKHO_ID, B.KHOQUANLY_ID          from TM_SYS_USERKHO A          left join TM_KHO B on B.MODULE_ID = A.MODULE_ID and B.KHO_ID = A.KHO_ID          where A.HOSPITAL_ID =  @param0  and A.ACCOUNT_ID =  @param1           order by B.TENKHO]
2019-09-20 14:05:53,685 [1] DEBUG - Statement Id: [DAO00008_GetUserInvSettings] Parameters: [@param0=[HOSPITAL_ID,HLU01], @param1=[ACCOUNT_ID,113]]
2019-09-20 14:05:53,685 [1] DEBUG - Statement Id: [DAO00008_GetUserInvSettings] Types: [@param0=[String, System.String], @param1=[String, System.String]]
2019-09-20 14:05:53,833 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'COM30'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2019-09-20 14:05:54,035 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'RIS04'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2019-09-20 14:06:01,358 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'MENU1'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2019-09-20 14:06:01,446 [1] DEBUG - Statement Id: [DAO00011_GetList] PreparedStatement : [select              TM_SYS_MENU.ID,              TM_SYS_MENU.PARENTID,              TM_SYS_MENU.SCREEN,              TM_SYS_MENU.SMALLIMAGE,              TM_SYS_MENU.LARGEIMAGE,              TM_SYS_MENU.DESCRIPTION,              TM_SYS_MENU.TYPE,              TM_SYS_MENU.TITLE_VI as TITLE              from TM_SYS_MENU              where TM_SYS_MENU.HOSPITAL_ID = 'HLU01' and TM_SYS_MENU.ACTIVE = '1'               AND                   (TM_SYS_MENU.TYPE & '8' = '8')                             order by TM_SYS_MENU.ORDERNUM]
2019-09-20 14:06:01,785 [1] DEBUG - Statement Id: [DAO00011_usermenu_list] PreparedStatement : [select              TM_SYS_HOMEMENU.MENUID as ID,              TM_SYS_MENU.TITLE_VI as TITLE,              TM_SYS_MENU.SCREEN,              TM_SYS_MENU.SMALLIMAGE,              TM_SYS_MENU.LARGEIMAGE,              TM_SYS_MENU.TYPE              from TM_SYS_HOMEMENU              left join TM_SYS_MENU on TM_SYS_MENU.ID = TM_SYS_HOMEMENU.MENUID and TM_SYS_MENU.HOSPITAL_ID = TM_SYS_HOMEMENU.HOSPITAL_ID              where TM_SYS_HOMEMENU.HOSPITAL_ID = 'HLU01' and TM_SYS_HOMEMENU.USERID = '113' and TM_SYS_MENU.ACTIVE = '1'               AND                   (TM_SYS_MENU.TYPE & '8' = '8')                             ORDER BY TM_SYS_HOMEMENU.ORDERNUM]
2019-09-20 14:06:05,469 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'COM31'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2019-09-20 14:06:06,321 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'ORM28'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2019-09-20 14:06:11,443 [1] DEBUG - Statement Id: [DAO00066_GetBENHAN_TIEPNHAN] PreparedStatement : [select top 1 *        from TT_NOITRU_BENHAN        where TIEPNHAN_ID = '27022'  and BENHVIEN_ID = 'HLU01'        order by NGAYTAO desc]
2019-09-20 14:06:11,555 [1] DEBUG - Statement Id: [DAO00014_GetInPatientStatus] PreparedStatement : [select TRANGTHAI, isnull(KHOACHUYENDEN_ID, KHOAVAO_ID) as KHOAHIENTAI from TT_NOITRU_BENHAN        where        TIEPNHAN_ID = '27022'        and BENHVIEN_ID = 'HLU01'         and           BENHAN_ID = '5800']
2019-09-20 14:06:11,679 [1] DEBUG - Statement Id: [DAO00048_TT_PHAUTHUAT_GetList] PreparedStatement : [select *              from TT_PHAUTHUAT               where                             TT_PHAUTHUAT.LOAI = 'P'                       and                           TT_PHAUTHUAT.TIEPNHAN_ID = 27022                       and                           TT_PHAUTHUAT.BENHVIEN_ID = 'HLU01'                                     order by PHAUTHUAT_ID DESC]
2019-09-20 14:06:11,740 [1] DEBUG - Statement Id: [DAO00048_GetListLoaiGacTrongPTTT] PreparedStatement : [select DICTIONARY_ID, DICTIONARY_CODE, DICTIONARY_NAME          from LST_DICTIONARY          where DICTIONARY_TYPE_CODE = 'LoaiGacPTTT'          and ENABLED = '1']
2019-09-20 14:06:12,799 [1] DEBUG - Statement Id: [DAO00048_GetDSLoaiGacDaGhiNhan] PreparedStatement : [select A.KIEMSOATGAC_ID, A.BENHNHAN_ID, A.TIEPNHAN_ID, A.BENHAN_ID, A.PHAUTHUAT_ID, A.LOAIPT_TT, A.LOAIGAC_ID          , A.NGAYGHINHAN, A.THOIGIANGHINHAN, A.SOLUONG, A.SOLUONGDASUDUNG, A.SOLUONGCONLAI, A.GHICHU, A.NGUOINHANDUNGCU_ID          , B.DICTIONARY_CODE AS MALOAIGAC, B.DICTIONARY_NAME AS TENLOAIGAC          from TT_PHAUTHUAT_GHINHANGAC A          inner join LST_DICTIONARY B on B.DICTIONARY_ID = A.LOAIGAC_ID          where A.PHAUTHUAT_ID = 3742 and A.BENHVIEN_ID = 'HLU01']
2019-09-20 14:06:12,928 [1] DEBUG - Statement Id: [DAO00048_GetDSLoaiGacDaGhiNhan] PreparedStatement : [select A.KIEMSOATGAC_ID, A.BENHNHAN_ID, A.TIEPNHAN_ID, A.BENHAN_ID, A.PHAUTHUAT_ID, A.LOAIPT_TT, A.LOAIGAC_ID          , A.NGAYGHINHAN, A.THOIGIANGHINHAN, A.SOLUONG, A.SOLUONGDASUDUNG, A.SOLUONGCONLAI, A.GHICHU, A.NGUOINHANDUNGCU_ID          , B.DICTIONARY_CODE AS MALOAIGAC, B.DICTIONARY_NAME AS TENLOAIGAC          from TT_PHAUTHUAT_GHINHANGAC A          inner join LST_DICTIONARY B on B.DICTIONARY_ID = A.LOAIGAC_ID          where A.PHAUTHUAT_ID = 3742 and A.BENHVIEN_ID = 'HLU01']
2019-09-20 14:06:14,291 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'COM98'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2019-09-20 14:06:18,328 [1] DEBUG - Statement Id: [DAO00048_DeleteLoaiGacByPhauThuatId] PreparedStatement : [DELETE FROM TT_PHAUTHUAT_GHINHANGAC WHERE PHAUTHUAT_ID = 3742 AND BENHVIEN_ID = 'HLU01'            SELECT 3742]
2019-09-20 14:06:23,430 [1] DEBUG - Statement Id: [DAO00066_GetBENHAN_TIEPNHAN] PreparedStatement : [select top 1 *        from TT_NOITRU_BENHAN        where TIEPNHAN_ID = '27022'  and BENHVIEN_ID = 'HLU01'        order by NGAYTAO desc]
2019-09-20 14:06:23,532 [1] DEBUG - Statement Id: [DAO00014_GetInPatientStatus] PreparedStatement : [select TRANGTHAI, isnull(KHOACHUYENDEN_ID, KHOAVAO_ID) as KHOAHIENTAI from TT_NOITRU_BENHAN        where        TIEPNHAN_ID = '27022'        and BENHVIEN_ID = 'HLU01'         and           BENHAN_ID = '5800']
2019-09-20 14:06:23,644 [1] DEBUG - Statement Id: [DAO00048_TT_PHAUTHUAT_GetList] PreparedStatement : [select *              from TT_PHAUTHUAT               where                             TT_PHAUTHUAT.LOAI = 'P'                       and                           TT_PHAUTHUAT.TIEPNHAN_ID = 27022                       and                           TT_PHAUTHUAT.BENHVIEN_ID = 'HLU01'                                     order by PHAUTHUAT_ID DESC]
2019-09-20 14:06:23,726 [1] DEBUG - Statement Id: [DAO00048_GetListLoaiGacTrongPTTT] PreparedStatement : [select DICTIONARY_ID, DICTIONARY_CODE, DICTIONARY_NAME          from LST_DICTIONARY          where DICTIONARY_TYPE_CODE = 'LoaiGacPTTT'          and ENABLED = '1']
2019-09-20 14:06:24,887 [1] DEBUG - Statement Id: [DAO00048_GetDSLoaiGacDaGhiNhan] PreparedStatement : [select A.KIEMSOATGAC_ID, A.BENHNHAN_ID, A.TIEPNHAN_ID, A.BENHAN_ID, A.PHAUTHUAT_ID, A.LOAIPT_TT, A.LOAIGAC_ID          , A.NGAYGHINHAN, A.THOIGIANGHINHAN, A.SOLUONG, A.SOLUONGDASUDUNG, A.SOLUONGCONLAI, A.GHICHU, A.NGUOINHANDUNGCU_ID          , B.DICTIONARY_CODE AS MALOAIGAC, B.DICTIONARY_NAME AS TENLOAIGAC          from TT_PHAUTHUAT_GHINHANGAC A          inner join LST_DICTIONARY B on B.DICTIONARY_ID = A.LOAIGAC_ID          where A.PHAUTHUAT_ID = 3742 and A.BENHVIEN_ID = 'HLU01']
2019-09-20 14:06:24,938 [1] DEBUG - Statement Id: [DAO00048_GetDSLoaiGacDaGhiNhan] PreparedStatement : [select A.KIEMSOATGAC_ID, A.BENHNHAN_ID, A.TIEPNHAN_ID, A.BENHAN_ID, A.PHAUTHUAT_ID, A.LOAIPT_TT, A.LOAIGAC_ID          , A.NGAYGHINHAN, A.THOIGIANGHINHAN, A.SOLUONG, A.SOLUONGDASUDUNG, A.SOLUONGCONLAI, A.GHICHU, A.NGUOINHANDUNGCU_ID          , B.DICTIONARY_CODE AS MALOAIGAC, B.DICTIONARY_NAME AS TENLOAIGAC          from TT_PHAUTHUAT_GHINHANGAC A          inner join LST_DICTIONARY B on B.DICTIONARY_ID = A.LOAIGAC_ID          where A.PHAUTHUAT_ID = 3742 and A.BENHVIEN_ID = 'HLU01']
2019-09-20 14:06:55,716 [1] DEBUG - Statement Id: [DAO00048_TT_PHAUTHUAT_GHINHANGAC_Add] PreparedStatement : [insert into TT_PHAUTHUAT_GHINHANGAC (          BENHNHAN_ID          , TIEPNHAN_ID          , BENHAN_ID          , PHAUTHUAT_ID          , LOAIPT_TT          , LOAIGAC_ID          , NGAYGHINHAN          , THOIGIANGHINHAN          , SOLUONG          , SOLUONGDASUDUNG          , SOLUONGCONLAI          , GHICHU          , NGUOINHANDUNGCU_ID          , BENHVIEN_ID          , NGUOITAO          , NGAYTAO            ) values (           @param0           ,  @param1           ,  @param2           ,  @param3           ,  @param4           ,  @param5           ,  @param6           ,  @param7           ,  @param8           ,  @param9           ,  @param10           ,  @param11           ,  @param12           ,  @param13           ,  @param14           ,  @param15           )          SELECT SCOPE_IDENTITY()]
2019-09-20 14:06:55,716 [1] DEBUG - Statement Id: [DAO00048_TT_PHAUTHUAT_GHINHANGAC_Add] Parameters: [@param0=[BENHNHAN_ID,23075], @param1=[TIEPNHAN_ID,27022], @param2=[BENHAN_ID,5800], @param3=[PHAUTHUAT_ID,3742], @param4=[LOAIPT_TT,P], @param5=[LOAIGAC_ID,11713], @param6=[NGAYGHINHAN,9/20/2019 12:00:00 AM], @param7=[THOIGIANGHINHAN,9/20/2019 2:06:55 PM], @param8=[SOLUONG,10], @param9=[SOLUONGDASUDUNG,8], @param10=[SOLUONGCONLAI,2], @param11=[GHICHU,test], @param12=[NGUOINHANDUNGCU_ID,38], @param13=[BENHVIEN_ID,HLU01], @param14=[NGUOITAO,null], @param15=[NGAYTAO,9/20/2019 2:06:55 PM]]
2019-09-20 14:06:55,717 [1] DEBUG - Statement Id: [DAO00048_TT_PHAUTHUAT_GHINHANGAC_Add] Types: [@param0=[Int64, System.Int64], @param1=[Int64, System.Int64], @param2=[Int64, System.Int64], @param3=[Int64, System.Int64], @param4=[String, System.String], @param5=[Int64, System.Int64], @param6=[DateTime, System.DateTime], @param7=[DateTime, System.DateTime], @param8=[Double, System.Double], @param9=[Double, System.Double], @param10=[Double, System.Double], @param11=[String, System.String], @param12=[Int64, System.Int64], @param13=[String, System.String], @param14=[System.DBNull, null], @param15=[DateTime, System.DateTime]]
2019-09-20 14:06:55,815 [1] DEBUG - Statement Id: [DAO00048_TT_PHAUTHUAT_GHINHANGAC_Add] PreparedStatement : [insert into TT_PHAUTHUAT_GHINHANGAC (          BENHNHAN_ID          , TIEPNHAN_ID          , BENHAN_ID          , PHAUTHUAT_ID          , LOAIPT_TT          , LOAIGAC_ID          , NGAYGHINHAN          , THOIGIANGHINHAN          , SOLUONG          , SOLUONGDASUDUNG          , SOLUONGCONLAI          , GHICHU          , NGUOINHANDUNGCU_ID          , BENHVIEN_ID          , NGUOITAO          , NGAYTAO            ) values (           @param0           ,  @param1           ,  @param2           ,  @param3           ,  @param4           ,  @param5           ,  @param6           ,  @param7           ,  @param8           ,  @param9           ,  @param10           ,  @param11           ,  @param12           ,  @param13           ,  @param14           ,  @param15           )          SELECT SCOPE_IDENTITY()]
2019-09-20 14:06:55,815 [1] DEBUG - Statement Id: [DAO00048_TT_PHAUTHUAT_GHINHANGAC_Add] Parameters: [@param0=[BENHNHAN_ID,23075], @param1=[TIEPNHAN_ID,27022], @param2=[BENHAN_ID,5800], @param3=[PHAUTHUAT_ID,3742], @param4=[LOAIPT_TT,P], @param5=[LOAIGAC_ID,11715], @param6=[NGAYGHINHAN,9/20/2019 12:00:00 AM], @param7=[THOIGIANGHINHAN,9/20/2019 2:06:55 PM], @param8=[SOLUONG,10], @param9=[SOLUONGDASUDUNG,10], @param10=[SOLUONGCONLAI,0], @param11=[GHICHU,test 2], @param12=[NGUOINHANDUNGCU_ID,38], @param13=[BENHVIEN_ID,HLU01], @param14=[NGUOITAO,null], @param15=[NGAYTAO,9/20/2019 2:06:55 PM]]
2019-09-20 14:06:55,815 [1] DEBUG - Statement Id: [DAO00048_TT_PHAUTHUAT_GHINHANGAC_Add] Types: [@param0=[Int64, System.Int64], @param1=[Int64, System.Int64], @param2=[Int64, System.Int64], @param3=[Int64, System.Int64], @param4=[String, System.String], @param5=[Int64, System.Int64], @param6=[DateTime, System.DateTime], @param7=[DateTime, System.DateTime], @param8=[Double, System.Double], @param9=[Double, System.Double], @param10=[Double, System.Double], @param11=[String, System.String], @param12=[Int64, System.Int64], @param13=[String, System.String], @param14=[System.DBNull, null], @param15=[DateTime, System.DateTime]]
2019-09-20 14:06:55,870 [1] DEBUG - Statement Id: [DAO00048_GetDSLoaiGacDaGhiNhan] PreparedStatement : [select A.KIEMSOATGAC_ID, A.BENHNHAN_ID, A.TIEPNHAN_ID, A.BENHAN_ID, A.PHAUTHUAT_ID, A.LOAIPT_TT, A.LOAIGAC_ID          , A.NGAYGHINHAN, A.THOIGIANGHINHAN, A.SOLUONG, A.SOLUONGDASUDUNG, A.SOLUONGCONLAI, A.GHICHU, A.NGUOINHANDUNGCU_ID          , B.DICTIONARY_CODE AS MALOAIGAC, B.DICTIONARY_NAME AS TENLOAIGAC          from TT_PHAUTHUAT_GHINHANGAC A          inner join LST_DICTIONARY B on B.DICTIONARY_ID = A.LOAIGAC_ID          where A.PHAUTHUAT_ID = 3742 and A.BENHVIEN_ID = 'HLU01']
--------------------------------------------------------------------------------
2019-09-20 14:09:33,137 [1] DEBUG - Statement Id: [DAO00001_DBList] PreparedStatement : [select *              from TM_SYS_SERVER              where HOSPITAL_ID = '_SYSTEM_' and TYPE = 'D']
2019-09-20 14:09:33,416 [1] DEBUG - Statement Id: [DAO00001_DaoList] PreparedStatement : [select              TM_SYS_SERVICEMAP.ID,              TM_SYS_SERVICEMAP.HOSPITAL_ID,              TM_SYS_SERVICEMAP.DB_NAME,              TM_SYS_SERVICEMAP.TYPE,              TM_SYS_SERVICEMAP.NAME,              TM_SYS_SERVICEMAP.CLASS,              (TM_SYS_DIC.VALUE + '.' + TM_SYS_SERVICEMAP.CLASS) as CLASSFULL,              TM_SYS_SERVICEMAP.ASSEMBLY              from TM_SYS_SERVICEMAP              inner join TM_SYS_DIC              on TM_SYS_SERVICEMAP.NAMESPACE = TM_SYS_DIC.ID              where HOSPITAL_ID = '_SYSTEM_' AND TYPE = 'D' AND ACTIVE = '1'              order by DB_NAME]
2019-09-20 14:09:33,517 [1] DEBUG - Statement Id: [DAO00001_ServiceList] PreparedStatement : [select              TM_SYS_SERVICEMAP.ID,              TM_SYS_SERVICEMAP.HOSPITAL_ID,              TM_SYS_SERVICEMAP.DB_NAME,              TM_SYS_SERVICEMAP.TYPE,              TM_SYS_SERVICEMAP.NAME,              TM_SYS_SERVICEMAP.CLASS,              (TM_SYS_DIC.VALUE + '.' + TM_SYS_SERVICEMAP.CLASS) as CLASSFULL,              TM_SYS_SERVICEMAP.ASSEMBLY,              TM_SYS_SERVER.URL              from TM_SYS_SERVICEMAP              inner join TM_SYS_DIC on TM_SYS_SERVICEMAP.NAMESPACE = TM_SYS_DIC.ID              inner join TM_SYS_SERVER on (TM_SYS_SERVICEMAP.DB_NAME = TM_SYS_SERVER.NAME) and (TM_SYS_SERVER.HOSPITAL_ID = '_SYSTEM_')              where TM_SYS_SERVICEMAP.HOSPITAL_ID = '_SYSTEM_' AND TM_SYS_SERVICEMAP.TYPE = 'S'  AND ACTIVE = '1'              order by URL]
2019-09-20 14:09:34,169 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = '_SYSTEM_'               AND                   TM_SYS_SCREEN.PAGE = 'LOGIN'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2019-09-20 14:09:34,464 [1] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = '_SYSTEM_'               AND                   TM_SYS_CACHE.ACTIVE = '1']
2019-09-20 14:09:39,087 [1] DEBUG - Statement Id: [DAO00001_DBList] PreparedStatement : [select *              from TM_SYS_SERVER              where HOSPITAL_ID = 'HLU01' and TYPE = 'D']
2019-09-20 14:09:39,118 [1] DEBUG - Statement Id: [DAO00001_DaoList] PreparedStatement : [select              TM_SYS_SERVICEMAP.ID,              TM_SYS_SERVICEMAP.HOSPITAL_ID,              TM_SYS_SERVICEMAP.DB_NAME,              TM_SYS_SERVICEMAP.TYPE,              TM_SYS_SERVICEMAP.NAME,              TM_SYS_SERVICEMAP.CLASS,              (TM_SYS_DIC.VALUE + '.' + TM_SYS_SERVICEMAP.CLASS) as CLASSFULL,              TM_SYS_SERVICEMAP.ASSEMBLY              from TM_SYS_SERVICEMAP              inner join TM_SYS_DIC              on TM_SYS_SERVICEMAP.NAMESPACE = TM_SYS_DIC.ID              where HOSPITAL_ID = 'HLU01' AND TYPE = 'D' AND ACTIVE = '1'              order by DB_NAME]
2019-09-20 14:09:40,649 [1] DEBUG - Statement Id: [DAO00001_ServiceList] PreparedStatement : [select              TM_SYS_SERVICEMAP.ID,              TM_SYS_SERVICEMAP.HOSPITAL_ID,              TM_SYS_SERVICEMAP.DB_NAME,              TM_SYS_SERVICEMAP.TYPE,              TM_SYS_SERVICEMAP.NAME,              TM_SYS_SERVICEMAP.CLASS,              (TM_SYS_DIC.VALUE + '.' + TM_SYS_SERVICEMAP.CLASS) as CLASSFULL,              TM_SYS_SERVICEMAP.ASSEMBLY,              TM_SYS_SERVER.URL              from TM_SYS_SERVICEMAP              inner join TM_SYS_DIC on TM_SYS_SERVICEMAP.NAMESPACE = TM_SYS_DIC.ID              inner join TM_SYS_SERVER on (TM_SYS_SERVICEMAP.DB_NAME = TM_SYS_SERVER.NAME) and (TM_SYS_SERVER.HOSPITAL_ID = 'HLU01')              where TM_SYS_SERVICEMAP.HOSPITAL_ID = 'HLU01' AND TM_SYS_SERVICEMAP.TYPE = 'S'  AND ACTIVE = '1'              order by URL]
2019-09-20 14:09:41,045 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1']
2019-09-20 14:09:41,910 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM005']
2019-09-20 14:09:42,049 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM015']
2019-09-20 14:09:42,131 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM067']
2019-09-20 14:09:42,238 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM008']
2019-09-20 14:09:42,318 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM068']
2019-09-20 14:09:42,393 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM006']
2019-09-20 14:09:42,473 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM030']
2019-09-20 14:09:42,551 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM025']
2019-09-20 14:09:42,627 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM024']
2019-09-20 14:09:43,141 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM033']
2019-09-20 14:09:43,235 [5] DEBUG - Statement Id: [DAO00027_GetListDuocKyGuiTonKho] PreparedStatement : [select  distinct TT_TONKHO.DUOC_KEY, LTRIM(TT_TONKHO.KHODUOC_ID) as KHODUOC_ID, TM_DUOC.DUOC_ID, TM_LOAIDUOC.MALOAIDUOC,TM_DUOC.SOVISA,TM_DUOC.TYLE_VAT,TM_DUOC.COTOA,        TM_DUOC.MADUOC, TM_DUOC.TENHANG, TM_DUOC.TENDUOCDAYDU, dvt.TENDONVITINH as DONVITINH,  TM_DUOC.DONVITINH_ID,TM_DUOC.BHYT,TM_DUOC.PHAMVI,        TM_DUOC.TENHOATCHAT, TM_DUOC.HAMLUONG, TM_DUOC.HANGSANXUAT, TM_DUOC.QUOCGIA, TM_DUOC.LOAIDUOC_ID, TM_DUOC.DUONGDUNG_ID,        TM_TENDUOC.TENDUOC, TM_TENDUOC.TENDUOC_EN, TM_TENDUOC.MAQUOCTE, TM_TENDUOC.MAQUOCTEBT,        TM_LOAIDUOC.LOAIVATTU_ID, TM_DUOC.BENHVIEN_ID,TT_TONKHO.SOLUONG, TT_TONKHO.NGUONDUOC_ID, NH.TENNGUONDUOC        , TAMNGUNG = CASE WHEN TM_DUOC.TAMNGUNG = '1' OR nh.TAMNGUNG = '1' OR KD.TAMNGUNG = '1' THEN '1' ELSE '0' END        , TM_DUOC.DANGTRINHBAY        from TM_DUOC        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = TM_DUOC.DONVITINH_ID        left join TM_TENDUOC on TM_DUOC.TENDUOC_ID = TM_TENDUOC.TENDUOC_ID and TM_DUOC.BENHVIEN_ID = 'HLU01' and TM_DUOC.TAMNGUNG = '0'        left join TM_LOAIDUOC on TM_LOAIDUOC.LOAIDUOC_ID = TM_DUOC.LOAIDUOC_ID and TM_LOAIDUOC.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG on (TM_LOAIDUOC.LOAIVATTU_ID = TM_DUOC_HANDUNG.LOAIDUOC and TM_DUOC_HANDUNG.BENHVIEN_ID = 'HLU01')        inner join        (select LTRIM(A.KHODUOC_ID) + '_' + LTRIM(A.DUOC_ID) + '_' + LTRIM(ISNULL(A.NGUONDUOC_ID,'')) as DUOC_KEY, A.KHODUOC_ID, A.DUOC_ID,A.NGUONDUOC_ID,        SUM(isnull(A.SOLUONG,0)) as SOLUONG        from        (select SUM(SOLUONG) as SOLUONG, KHODUOC_ID, DUOC_ID, NGUONDUOC_ID from TT_DUOC_KYGUI_TONKHO        where BENHVIEN_ID = 'HLU01' group by KHODUOC_ID, DUOC_ID, NGUONDUOC_ID) A        group by LTRIM(A.KHODUOC_ID) + '_' + LTRIM(A.DUOC_ID) + '_' + LTRIM(A.NGUONDUOC_ID), A.KHODUOC_ID, A.DUOC_ID, A.NGUONDUOC_ID)        TT_TONKHO on TT_TONKHO.DUOC_ID = TM_DUOC.DUOC_ID        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = TT_TONKHO.NGUONDUOC_ID and nh.BENHVIEN_ID = 'HLU01'        LEFT JOIN TM_KHODUOC KD ON KD.KHODUOC_ID = TT_TONKHO.KHODUOC_ID        where TM_DUOC.BENHVIEN_ID = 'HLU01' AND TT_TONKHO.SOLUONG >= 0]
2019-09-20 14:09:43,317 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM018']
2019-09-20 14:09:43,353 [5] DEBUG - Statement Id: [DAO00027_GetListDuocTonKho] PreparedStatement : [select distinct TT_TONKHO.DUOC_KEY, LTRIM(TT_TONKHO.KHODUOC_ID) as KHODUOC_ID, TM_DUOC.DUOC_ID, TM_LOAIDUOC.MALOAIDUOC,TM_DUOC.SOVISA,TM_DUOC.TYLE_VAT,TM_DUOC.COTOA,        TM_DUOC.MADUOC, TM_DUOC.TENHANG, TM_DUOC.TENDUOCDAYDU, dvt.TENDONVITINH as DONVITINH,  TM_DUOC.DONVITINH_ID,TM_DUOC.BHYT,                TM_DUOC.TENHOATCHAT,          TM_DUOC.HAMLUONG, TM_DUOC.HANGSANXUAT, TM_DUOC.QUOCGIA, TM_DUOC.LOAIDUOC_ID, TM_DUOC.DUONGDUNG_ID,        TM_TENDUOC.TENDUOC, TM_TENDUOC.TENDUOC_EN, TM_TENDUOC.MAQUOCTE, TM_TENDUOC.MAQUOCTEBT,        TM_LOAIDUOC.LOAIVATTU_ID, TM_DUOC.BENHVIEN_ID,        TT_TONKHO.SOLUONG, TM_DUOC.VTYT_PHANLOAI, TM_DUOC.PHAMVI, TT_TONKHO.NGUONDUOC_ID, NG.TENNGUONDUOC AS TENNGUONDUOC        , TAMNGUNG = CASE WHEN TM_DUOC.TAMNGUNG = '1' OR NG.TAMNGUNG = '1' OR KD.TAMNGUNG = '1' THEN '1' ELSE '0' END        , TM_DUOC.DANGTRINHBAY        from TM_DUOC        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = TM_DUOC.DONVITINH_ID        left join TM_TENDUOC on TM_DUOC.TENDUOC_ID = TM_TENDUOC.TENDUOC_ID and TM_DUOC.BENHVIEN_ID = 'HLU01' and TM_DUOC.TAMNGUNG = '0'        left join TM_LOAIDUOC on TM_LOAIDUOC.LOAIDUOC_ID = TM_DUOC.LOAIDUOC_ID and TM_LOAIDUOC.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG on (TM_LOAIDUOC.LOAIVATTU_ID = TM_DUOC_HANDUNG.LOAIDUOC and TM_DUOC_HANDUNG.BENHVIEN_ID = 'HLU01')        inner join        (select LTRIM(A.KHODUOC_ID) + '_' + LTRIM(A.DUOC_ID) + '_' + LTRIM(ISNULL(A.NGUONDUOC_ID,'')) as DUOC_KEY, A.KHODUOC_ID, A.DUOC_ID, A.NGUONDUOC_ID,        SUM(isnull(A.SOLUONG,0)) as SOLUONG        from        (select SUM(SOLUONG) as SOLUONG, KHODUOC_ID, DUOC_ID, NGUONDUOC_ID from TT_DUOC_TONKHO        where BENHVIEN_ID = 'HLU01' group by KHODUOC_ID, DUOC_ID, NGUONDUOC_ID) A        group by LTRIM(A.KHODUOC_ID) + '_' + LTRIM(A.DUOC_ID) + '_' + LTRIM(ISNULL(A.NGUONDUOC_ID,'')), A.KHODUOC_ID, A.DUOC_ID, NGUONDUOC_ID        ) TT_TONKHO on TT_TONKHO.DUOC_ID = TM_DUOC.DUOC_ID        LEFT JOIN TM_NGUONHANG NG ON NG.NGUONDUOC_ID = TT_TONKHO.NGUONDUOC_ID        LEFT JOIN TM_KHODUOC KD ON KD.KHODUOC_ID = TT_TONKHO.KHODUOC_ID        where TM_DUOC.BENHVIEN_ID = 'HLU01' and TT_TONKHO.SOLUONG >= 0]
2019-09-20 14:09:47,113 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM023']
2019-09-20 14:09:47,258 [5] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoVaBooking] PreparedStatement : [declare @NGUONDUOC_MACDINH varchar(5) = '0';        declare @TOAMUANGOAI int = 0;        select @NGUONDUOC_MACDINH = isnull(VALUE,0) from TM_SYS_APPSETTINGS where CODE = 'PHA_NGUONDUOC'        select @TOAMUANGOAI = isnull(VALUE,0) from TM_SYS_APPSETTINGS where CODE = 'OPD_TOAMUANGOAI_DUNGDANHMUC_DUOC'                if @TOAMUANGOAI = 1        begin        select  distinct '0' + '_' + LTRIM(d.DUOC_ID) + '_' + @NGUONDUOC_MACDINH as DUOC_KEY, 0 as PHAMVI_ID, @NGUONDUOC_MACDINH as NGUONDUOC_ID, null as TENNGUONDUOC, null as TINHTIEN, d.DUOC_ID, ld.MALOAIDUOC,        d.SOVISA,d.TYLE_VAT,d.COTOA, d.MADUOC, d.TENHANG, d.TENDUOCDAYDU, d.DONVITINH as DONVITINH, d.BHYT,        d.TENHOATCHAT, d.HAMLUONG, d.HANGSANXUAT, d.QUOCGIA, d.LOAIDUOC_ID, d.DUONGDUNG_ID, d.TINHTIEN_PTTT,        ten.TENDUOC, ten.TENDUOC_EN, ten.MAQUOCTE, ten.MAQUOCTEBT,        '' as BHYT_TEXT        , ld.LOAIVATTU_ID        , d.BENHVIEN_ID,        999999999 as SOLUONG, d.VTYT_PHANLOAI, d.PHAMVI, d.SUASOLUONGTONGHOP, d.MADUOCBV, d.DANGTRINHBAY        , TAMNGUNG = CASE WHEN d.TAMNGUNG = '1' THEN '1' ELSE '0' END        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        union all        select  distinct tk.DUOC_KEY, LTRIM(tk.PHAMVI_ID) as PHAMVI_ID, tk.NGUONDUOC_ID, nh.TENNGUONDUOC, nh.TINHTIEN, d.DUOC_ID, ld.MALOAIDUOC,        d.SOVISA,d.TYLE_VAT,d.COTOA, d.MADUOC, d.TENHANG, d.TENDUOCDAYDU, d.DONVITINH as DONVITINH, d.BHYT,        d.TENHOATCHAT, d.HAMLUONG, d.HANGSANXUAT, d.QUOCGIA, d.LOAIDUOC_ID, d.DUONGDUNG_ID, d.TINHTIEN_PTTT,        ten.TENDUOC, ten.TENDUOC_EN, ten.MAQUOCTE, ten.MAQUOCTEBT,        CASE WHEN d.BHYT = '1' THEN 'BHYT' ELSE '' END as BHYT_TEXT        , ld.LOAIVATTU_ID        , d.BENHVIEN_ID,        tk.SOLUONG, d.VTYT_PHANLOAI, d.PHAMVI, d.SUASOLUONGTONGHOP, d.MADUOCBV, d.DANGTRINHBAY        , TAMNGUNG = CASE WHEN d.TAMNGUNG = '1' OR nh.TAMNGUNG = '1' OR kd.TAMNGUNG = '1' THEN '1' ELSE '0' END        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        inner join        (        select  LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')) DUOC_KEY, (SUM(dtk.SOLUONG) - isnull(sum(A.SOLUONG),0) - isnull(sum(B.SOLUONG),0)) SOLUONG, pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        from (select sum(soluong) soluong,duoc_id,nguonduoc_id,khoduoc_id,benhvien_id from TT_DUOC_TONKHO  group by duoc_id,nguonduoc_id,khoduoc_id,benhvien_id) dtk        inner join TM_DUOC_PHAMVISD_MAPPING pvsd on dtk.KHODUOC_ID = pvsd.KHODUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NOITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) B on B.DUOC_ID = dtk.DUOC_ID and B.SOLUONG > 0 and B.PHAMVI_ID = pvsd.PHAMVI_ID and B.NGUONHANG_ID = dtk.NGUONDUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NGOAITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) A on A.DUOC_ID = dtk.DUOC_ID and A.SOLUONG > 0 and A.PHAMVI_ID = pvsd.PHAMVI_ID and A.NGUONHANG_ID = dtk.NGUONDUOC_ID        where dtk.SOLUONG > 0 and dtk.BENHVIEN_ID = 'HLU01'        group by LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')), pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        ) tk on tk.DUOC_ID = d.DUOC_ID        left join TM_DUOC_PHAMVISUDUNG kd on kd.PHAMVI_ID = tk.PHAMVI_ID and kd.BENHVIEN_ID = 'HLU01'        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = tk.NGUONDUOC_ID and nh.BENHVIEN_ID = 'HLU01'        where d.BENHVIEN_ID = 'HLU01'  and tk.SOLUONG >= 0        end        else        begin                  select  distinct tk.DUOC_KEY, LTRIM(tk.PHAMVI_ID) as PHAMVI_ID, tk.NGUONDUOC_ID, nh.TENNGUONDUOC, nh.TINHTIEN, d.DUOC_ID, ld.MALOAIDUOC,        d.SOVISA,d.TYLE_VAT,d.COTOA, d.MADUOC, d.TENHANG, d.TENDUOCDAYDU, d.DONVITINH as DONVITINH, d.BHYT,        d.TENHOATCHAT, d.HAMLUONG, d.HANGSANXUAT, d.QUOCGIA, d.LOAIDUOC_ID, d.DUONGDUNG_ID, d.TINHTIEN_PTTT,        ten.TENDUOC, ten.TENDUOC_EN, ten.MAQUOCTE, ten.MAQUOCTEBT,        CASE WHEN d.BHYT = '1' THEN 'BHYT' ELSE '' END as BHYT_TEXT        , ld.LOAIVATTU_ID        , d.BENHVIEN_ID,        tk.SOLUONG, d.VTYT_PHANLOAI, d.PHAMVI, d.SUASOLUONGTONGHOP, d.MADUOCBV, d.DANGTRINHBAY        , TAMNGUNG = CASE WHEN d.TAMNGUNG = '1' OR nh.TAMNGUNG = '1' OR kd.TAMNGUNG = '1' THEN '1' ELSE '0' END        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        inner join        (        select  LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')) DUOC_KEY, (SUM(dtk.SOLUONG) - isnull(sum(A.SOLUONG),0) - isnull(sum(B.SOLUONG),0)) SOLUONG, pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        from (select sum(soluong) soluong,duoc_id,nguonduoc_id,khoduoc_id,benhvien_id from TT_DUOC_TONKHO  group by duoc_id,nguonduoc_id,khoduoc_id,benhvien_id) dtk        inner join TM_DUOC_PHAMVISD_MAPPING pvsd on dtk.KHODUOC_ID = pvsd.KHODUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NOITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) B on B.DUOC_ID = dtk.DUOC_ID and B.SOLUONG > 0 and B.PHAMVI_ID = pvsd.PHAMVI_ID and B.NGUONHANG_ID = dtk.NGUONDUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NGOAITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) A on A.DUOC_ID = dtk.DUOC_ID and A.SOLUONG > 0 and A.PHAMVI_ID = pvsd.PHAMVI_ID and A.NGUONHANG_ID = dtk.NGUONDUOC_ID        where dtk.SOLUONG > 0 and dtk.BENHVIEN_ID = 'HLU01'        group by LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')), pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        ) tk on tk.DUOC_ID = d.DUOC_ID        left join TM_DUOC_PHAMVISUDUNG kd on kd.PHAMVI_ID = tk.PHAMVI_ID and kd.BENHVIEN_ID = 'HLU01'        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = tk.NGUONDUOC_ID and nh.BENHVIEN_ID = 'HLU01'        where d.BENHVIEN_ID = 'HLU01'  and tk.SOLUONG >= 0        end]
2019-09-20 14:09:50,389 [5] DEBUG - Statement Id: [DAO00320_GetList] PreparedStatement : [select M.*            from TM_MAU M            LEFT JOIN TM_MAU_DONVITINH DVT on M.DONVITINH_ID=DVT.DONVITINH_ID            where            M.TAMNGUNG = '0'            and M.BENHVIEN_ID = 'HLU01'            order by M.TENMAU]
2019-09-20 14:09:50,483 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM071']
2019-09-20 14:09:50,519 [5] DEBUG - Statement Id: [DAO00322_GetListMauTonKhoForCreateCached] PreparedStatement : [SELECT DISTINCT          TK.MAU_KEY, TK.KHOMAU_ID, M.MAU_ID, M.MAMAU, M.TENMAU, M.NHOM_ABO, M.NHOM_RH, M.LOAIMAU_ID,          TK.SOLONHAP_ID, SLN.SOLONHAP, SLN.SOKIEMSOAT, TK.NGUONHANG_ID, NG.TENNGUONMAU, M.BENHVIEN_ID, M.DONVITINH_ID,          SUM(tk.SOLUONG) AS SOLUONG,K.TENKHO,DVT.TENDONVITINH          FROM TT_MAU_TONKHO TK          JOIN TM_KHO K ON TK.KHOMAU_ID = K.KHO_ID          JOIN TT_MAU_CHUNGTU_SOLONHAP SLN ON TK.SOLONHAP_ID = SLN.SOLONHAP_ID          JOIN TM_MAU M on TK.MAU_ID = M.MAU_ID and M.TAMNGUNG = '0'          LEFT JOIN TM_MAU_DONVITINH DVT on M.DONVITINH_ID=DVT.DONVITINH_ID          LEFT JOIN TM_NGUONMAU NG ON NG.NGUONMAU_ID = TK.NGUONHANG_ID          WHERE TK.SOLUONG > 0          GROUP BY TK.MAU_KEY, TK.KHOMAU_ID, M.MAU_ID, M.MAMAU, M.TENMAU, M.NHOM_ABO, M.NHOM_RH, M.LOAIMAU_ID,          TK.SOLONHAP_ID, SLN.SOLONHAP, SLN.SOKIEMSOAT,TK.NGUONHANG_ID, NG.TENNGUONMAU, M.BENHVIEN_ID, M.DONVITINH_ID,K.TENKHO,DVT.TENDONVITINH]
2019-09-20 14:09:50,611 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM073']
2019-09-20 14:09:50,646 [5] DEBUG - Statement Id: [DAO00322_GetListMauTonKhoTruBooking] PreparedStatement : [select distinct          TK.MAU_KEY, TK.KHOMAU_ID, M.MAU_ID, M.MAMAU, M.TENMAU, M.NHOM_ABO, M.NHOM_RH, M.LOAIMAU_ID, M.DONVITINH_ID,          TK.SOLONHAP_ID, TK.SOLONHAP, TK.SOKIEMSOAT,M.PHAMVI, TK.NGUONHANG_ID, NG.TENNGUONMAU, M.BENHVIEN_ID,          TK.SOLUONG,TK.TENKHO,DVT.TENDONVITINH          from TM_MAU M          JOIN          (          select          A.MAU_KEY, A.KHOMAU_ID, A.MAU_ID ,a.NGUONHANG_ID, A.SOLONHAP_ID, A.SOLONHAP, A.SOKIEMSOAT, A.SOLUONG,A.TENKHO          from          (          select KHOMAU_ID, TK.MAU_ID, TK.NGUONHANG_ID, TK.MAU_KEY, SLN.SOLONHAP_ID, SLN.SOLONHAP, SLN.SOKIEMSOAT, ISNULL(TK.SOLUONG,0) - ISNULL(book.SOLUONG,0) as SOLUONG,K.TENKHO          from TT_MAU_TONKHO TK          JOIN TM_KHO K ON TK.KHOMAU_ID = K.KHO_ID          inner join TT_MAU_CHUNGTU_SOLONHAP SLN ON TK.SOLONHAP_ID = SLN.SOLONHAP_ID          left join dbo.TT_MAU_TONKHO_BOOK book ON book.MAU_KEY = TK.MAU_KEY AND book.TRANGTHAI = 'HIEULUC'          where ISNULL(TK.SOLUONG,0) - ISNULL(book.SOLUONG,0) > 0          ) A          )TK on TK.MAU_ID = M.MAU_ID and M.TAMNGUNG = '0'          LEFT JOIN TM_MAU_DONVITINH DVT on M.DONVITINH_ID=DVT.DONVITINH_ID          LEFT JOIN TM_NGUONMAU NG ON NG.NGUONMAU_ID = TK.NGUONHANG_ID]
2019-09-20 14:09:50,752 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM072']
2019-09-20 14:09:51,679 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'MAIN'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2019-09-20 14:09:52,476 [1] DEBUG - Statement Id: [DAO00002_FormList] PreparedStatement : [select              TM_SYS_FORM.HOSPITAL_ID,              TM_SYS_FORM.NAME,              TM_SYS_FORM.CLASS,              TM_SYS_FORM.ASSEMBLY,              TM_SYS_FORM.TITLE_VI as TITLE              from TM_SYS_FORM              where HOSPITAL_ID = 'HLU01']
2019-09-20 14:09:57,319 [1] DEBUG - Statement Id: [DAO00300_GetShortcutListByUserID] PreparedStatement : [SELECT S.SHORTCUT_CODE, S.SHORTCUT_VALUE              FROM TM_SHORTCUT AS S              WHERE S.BENHVIEN_ID = 'HLU01' AND S.USER_ID = '1' AND TAMNGUNG = '0']
2019-09-20 14:09:57,357 [1] DEBUG - Statement Id: [DAO00087_GetList] PreparedStatement : [select CODE, VALUE, BENHVIEN_ID              from TM_SYS_APPSETTINGS              where LOCKED = '0' and BENHVIEN_ID = 'HLU01'              order by SETTING_ID]
2019-09-20 14:09:57,470 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'MSG01'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2019-09-20 14:09:57,592 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'MSG02'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2019-09-20 14:09:57,721 [1] DEBUG - Statement Id: [DAO00008_GetUserSettings] PreparedStatement : [select A.*, B.TENKHO , C.TENPHONGBAN, B.MAKHO, C.MAPHONGBAN          from TM_SYS_USERS A          left join TM_KHODUOC B on B.KHODUOC_ID = A.INVENTORY_ID          left join TM_PHONGBAN C on (C.PHONGBAN_ID = A.WORKING_DEPT_ID and C.BENHVIEN_ID =  @param0 )          left join TM_SYS_USERKHO D on (D.ACCOUNT_ID = A.ACCOUNT_ID and D.HOSPITAL_ID =  @param0 )          where          A.HOSPITAL_ID =  @param0            and                 A.ACCOUNT_ID =  @param1]
2019-09-20 14:09:57,725 [1] DEBUG - Statement Id: [DAO00008_GetUserSettings] Parameters: [@param0=[HOSPITAL_ID,HLU01], @param1=[ACCOUNT_ID,113]]
2019-09-20 14:09:57,725 [1] DEBUG - Statement Id: [DAO00008_GetUserSettings] Types: [@param0=[String, System.String], @param1=[String, System.String]]
2019-09-20 14:09:57,977 [1] DEBUG - Statement Id: [DAO00008_GetUserInvSettings] PreparedStatement : [select A.*, B.TENKHO, B.MAKHO, B.LOAIKHO_ID, B.KHOQUANLY_ID          from TM_SYS_USERKHO A          left join TM_KHO B on B.MODULE_ID = A.MODULE_ID and B.KHO_ID = A.KHO_ID          where A.HOSPITAL_ID =  @param0  and A.ACCOUNT_ID =  @param1           order by B.TENKHO]
2019-09-20 14:09:57,977 [1] DEBUG - Statement Id: [DAO00008_GetUserInvSettings] Parameters: [@param0=[HOSPITAL_ID,HLU01], @param1=[ACCOUNT_ID,113]]
2019-09-20 14:09:57,977 [1] DEBUG - Statement Id: [DAO00008_GetUserInvSettings] Types: [@param0=[String, System.String], @param1=[String, System.String]]
2019-09-20 14:09:58,488 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'COM30'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2019-09-20 14:09:58,768 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'RIS04'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2019-09-20 14:10:06,320 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'MENU1'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2019-09-20 14:10:06,409 [1] DEBUG - Statement Id: [DAO00011_GetList] PreparedStatement : [select              TM_SYS_MENU.ID,              TM_SYS_MENU.PARENTID,              TM_SYS_MENU.SCREEN,              TM_SYS_MENU.SMALLIMAGE,              TM_SYS_MENU.LARGEIMAGE,              TM_SYS_MENU.DESCRIPTION,              TM_SYS_MENU.TYPE,              TM_SYS_MENU.TITLE_VI as TITLE              from TM_SYS_MENU              where TM_SYS_MENU.HOSPITAL_ID = 'HLU01' and TM_SYS_MENU.ACTIVE = '1'               AND                   (TM_SYS_MENU.TYPE & '8' = '8')                             order by TM_SYS_MENU.ORDERNUM]
2019-09-20 14:10:06,669 [1] DEBUG - Statement Id: [DAO00011_usermenu_list] PreparedStatement : [select              TM_SYS_HOMEMENU.MENUID as ID,              TM_SYS_MENU.TITLE_VI as TITLE,              TM_SYS_MENU.SCREEN,              TM_SYS_MENU.SMALLIMAGE,              TM_SYS_MENU.LARGEIMAGE,              TM_SYS_MENU.TYPE              from TM_SYS_HOMEMENU              left join TM_SYS_MENU on TM_SYS_MENU.ID = TM_SYS_HOMEMENU.MENUID and TM_SYS_MENU.HOSPITAL_ID = TM_SYS_HOMEMENU.HOSPITAL_ID              where TM_SYS_HOMEMENU.HOSPITAL_ID = 'HLU01' and TM_SYS_HOMEMENU.USERID = '113' and TM_SYS_MENU.ACTIVE = '1'               AND                   (TM_SYS_MENU.TYPE & '8' = '8')                             ORDER BY TM_SYS_HOMEMENU.ORDERNUM]
2019-09-20 14:10:11,364 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'COM31'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2019-09-20 14:10:11,535 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'ORM28'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2019-09-20 14:10:15,694 [1] DEBUG - Statement Id: [DAO00066_GetBENHAN_TIEPNHAN] PreparedStatement : [select top 1 *        from TT_NOITRU_BENHAN        where TIEPNHAN_ID = '27022'  and BENHVIEN_ID = 'HLU01'        order by NGAYTAO desc]
2019-09-20 14:10:15,799 [1] DEBUG - Statement Id: [DAO00014_GetInPatientStatus] PreparedStatement : [select TRANGTHAI, isnull(KHOACHUYENDEN_ID, KHOAVAO_ID) as KHOAHIENTAI from TT_NOITRU_BENHAN        where        TIEPNHAN_ID = '27022'        and BENHVIEN_ID = 'HLU01'         and           BENHAN_ID = '5800']
2019-09-20 14:10:15,892 [1] DEBUG - Statement Id: [DAO00048_TT_PHAUTHUAT_GetList] PreparedStatement : [select *              from TT_PHAUTHUAT               where                             TT_PHAUTHUAT.LOAI = 'P'                       and                           TT_PHAUTHUAT.TIEPNHAN_ID = 27022                       and                           TT_PHAUTHUAT.BENHVIEN_ID = 'HLU01'                                     order by PHAUTHUAT_ID DESC]
2019-09-20 14:10:15,944 [1] DEBUG - Statement Id: [DAO00048_GetListLoaiGacTrongPTTT] PreparedStatement : [select DICTIONARY_ID, DICTIONARY_CODE, DICTIONARY_NAME          from LST_DICTIONARY          where DICTIONARY_TYPE_CODE = 'LoaiGacPTTT'          and ENABLED = '1']
2019-09-20 14:10:17,342 [1] DEBUG - Statement Id: [DAO00048_GetDSLoaiGacDaGhiNhan] PreparedStatement : [select A.KIEMSOATGAC_ID, A.BENHNHAN_ID, A.TIEPNHAN_ID, A.BENHAN_ID, A.PHAUTHUAT_ID, A.LOAIPT_TT, A.LOAIGAC_ID          , A.NGAYGHINHAN, A.THOIGIANGHINHAN, A.SOLUONG, A.SOLUONGDASUDUNG, A.SOLUONGCONLAI, A.GHICHU, A.NGUOINHANDUNGCU_ID          , B.DICTIONARY_CODE AS MALOAIGAC, B.DICTIONARY_NAME AS TENLOAIGAC          from TT_PHAUTHUAT_GHINHANGAC A          inner join LST_DICTIONARY B on B.DICTIONARY_ID = A.LOAIGAC_ID          where A.PHAUTHUAT_ID = 3742 and A.BENHVIEN_ID = 'HLU01']
2019-09-20 14:10:17,477 [1] DEBUG - Statement Id: [DAO00048_GetDSLoaiGacDaGhiNhan] PreparedStatement : [select A.KIEMSOATGAC_ID, A.BENHNHAN_ID, A.TIEPNHAN_ID, A.BENHAN_ID, A.PHAUTHUAT_ID, A.LOAIPT_TT, A.LOAIGAC_ID          , A.NGAYGHINHAN, A.THOIGIANGHINHAN, A.SOLUONG, A.SOLUONGDASUDUNG, A.SOLUONGCONLAI, A.GHICHU, A.NGUOINHANDUNGCU_ID          , B.DICTIONARY_CODE AS MALOAIGAC, B.DICTIONARY_NAME AS TENLOAIGAC          from TT_PHAUTHUAT_GHINHANGAC A          inner join LST_DICTIONARY B on B.DICTIONARY_ID = A.LOAIGAC_ID          where A.PHAUTHUAT_ID = 3742 and A.BENHVIEN_ID = 'HLU01']
2019-09-20 14:10:25,571 [1] DEBUG - Statement Id: [DAO00048_GetDSLoaiGacDaGhiNhan] PreparedStatement : [select A.KIEMSOATGAC_ID, A.BENHNHAN_ID, A.TIEPNHAN_ID, A.BENHAN_ID, A.PHAUTHUAT_ID, A.LOAIPT_TT, A.LOAIGAC_ID          , A.NGAYGHINHAN, A.THOIGIANGHINHAN, A.SOLUONG, A.SOLUONGDASUDUNG, A.SOLUONGCONLAI, A.GHICHU, A.NGUOINHANDUNGCU_ID          , B.DICTIONARY_CODE AS MALOAIGAC, B.DICTIONARY_NAME AS TENLOAIGAC          from TT_PHAUTHUAT_GHINHANGAC A          inner join LST_DICTIONARY B on B.DICTIONARY_ID = A.LOAIGAC_ID          where A.PHAUTHUAT_ID = 3742 and A.BENHVIEN_ID = 'HLU01']
2019-09-20 14:10:25,638 [1] DEBUG - Statement Id: [DAO00048_GetDSLoaiGacDaGhiNhan] PreparedStatement : [select A.KIEMSOATGAC_ID, A.BENHNHAN_ID, A.TIEPNHAN_ID, A.BENHAN_ID, A.PHAUTHUAT_ID, A.LOAIPT_TT, A.LOAIGAC_ID          , A.NGAYGHINHAN, A.THOIGIANGHINHAN, A.SOLUONG, A.SOLUONGDASUDUNG, A.SOLUONGCONLAI, A.GHICHU, A.NGUOINHANDUNGCU_ID          , B.DICTIONARY_CODE AS MALOAIGAC, B.DICTIONARY_NAME AS TENLOAIGAC          from TT_PHAUTHUAT_GHINHANGAC A          inner join LST_DICTIONARY B on B.DICTIONARY_ID = A.LOAIGAC_ID          where A.PHAUTHUAT_ID = 3742 and A.BENHVIEN_ID = 'HLU01']
2019-09-20 14:10:57,260 [1] DEBUG - Statement Id: [DAO00048_TT_PHAUTHUAT_GHINHANGAC_Update] PreparedStatement : [UPDATE [dbo].[TT_PHAUTHUAT_GHINHANGAC]          SET [LOAIGAC_ID] =  @param0           ,[SOLUONG] =  @param1           ,[SOLUONGDASUDUNG] =  @param2           ,[SOLUONGCONLAI] =  @param3           ,[GHICHU] =  @param4           ,[NGUOINHANDUNGCU_ID] =  @param5           ,[NGUOICAPNHAT] =  @param6           ,[NGAYCAPNHAT] =  @param7           WHERE [KIEMSOATGAC_ID] = 6]
2019-09-20 14:10:57,260 [1] DEBUG - Statement Id: [DAO00048_TT_PHAUTHUAT_GHINHANGAC_Update] Parameters: [@param0=[LOAIGAC_ID,11713], @param1=[SOLUONG,10], @param2=[SOLUONGDASUDUNG,8], @param3=[SOLUONGCONLAI,2], @param4=[GHICHU,test], @param5=[NGUOINHANDUNGCU_ID,38], @param6=[NGUOICAPNHAT,null], @param7=[NGAYCAPNHAT,9/20/2019 2:10:57 PM]]
2019-09-20 14:10:57,260 [1] DEBUG - Statement Id: [DAO00048_TT_PHAUTHUAT_GHINHANGAC_Update] Types: [@param0=[Int64, System.Int64], @param1=[Double, System.Double], @param2=[Double, System.Double], @param3=[Double, System.Double], @param4=[String, System.String], @param5=[Int64, System.Int64], @param6=[System.DBNull, null], @param7=[DateTime, System.DateTime]]
2019-09-20 14:11:02,377 [1] DEBUG - Statement Id: [DAO00048_TT_PHAUTHUAT_GHINHANGAC_Update] PreparedStatement : [UPDATE [dbo].[TT_PHAUTHUAT_GHINHANGAC]          SET [LOAIGAC_ID] =  @param0           ,[SOLUONG] =  @param1           ,[SOLUONGDASUDUNG] =  @param2           ,[SOLUONGCONLAI] =  @param3           ,[GHICHU] =  @param4           ,[NGUOINHANDUNGCU_ID] =  @param5           ,[NGUOICAPNHAT] =  @param6           ,[NGAYCAPNHAT] =  @param7           WHERE [KIEMSOATGAC_ID] = 7]
2019-09-20 14:11:02,378 [1] DEBUG - Statement Id: [DAO00048_TT_PHAUTHUAT_GHINHANGAC_Update] Parameters: [@param0=[LOAIGAC_ID,11715], @param1=[SOLUONG,10], @param2=[SOLUONGDASUDUNG,10], @param3=[SOLUONGCONLAI,0], @param4=[GHICHU,test 2], @param5=[NGUOINHANDUNGCU_ID,38], @param6=[NGUOICAPNHAT,null], @param7=[NGAYCAPNHAT,9/20/2019 2:11:02 PM]]
2019-09-20 14:11:02,378 [1] DEBUG - Statement Id: [DAO00048_TT_PHAUTHUAT_GHINHANGAC_Update] Types: [@param0=[Int64, System.Int64], @param1=[Double, System.Double], @param2=[Double, System.Double], @param3=[Double, System.Double], @param4=[String, System.String], @param5=[Int64, System.Int64], @param6=[System.DBNull, null], @param7=[DateTime, System.DateTime]]
2019-09-20 14:11:14,458 [1] DEBUG - Statement Id: [DAO00048_TT_PHAUTHUAT_GHINHANGAC_Add] PreparedStatement : [insert into TT_PHAUTHUAT_GHINHANGAC (          BENHNHAN_ID          , TIEPNHAN_ID          , BENHAN_ID          , PHAUTHUAT_ID          , LOAIPT_TT          , LOAIGAC_ID          , NGAYGHINHAN          , THOIGIANGHINHAN          , SOLUONG          , SOLUONGDASUDUNG          , SOLUONGCONLAI          , GHICHU          , NGUOINHANDUNGCU_ID          , BENHVIEN_ID          , NGUOITAO          , NGAYTAO            ) values (           @param0           ,  @param1           ,  @param2           ,  @param3           ,  @param4           ,  @param5           ,  @param6           ,  @param7           ,  @param8           ,  @param9           ,  @param10           ,  @param11           ,  @param12           ,  @param13           ,  @param14           ,  @param15           )          SELECT SCOPE_IDENTITY()]
2019-09-20 14:11:14,458 [1] DEBUG - Statement Id: [DAO00048_TT_PHAUTHUAT_GHINHANGAC_Add] Parameters: [@param0=[BENHNHAN_ID,23075], @param1=[TIEPNHAN_ID,27022], @param2=[BENHAN_ID,5800], @param3=[PHAUTHUAT_ID,3742], @param4=[LOAIPT_TT,P], @param5=[LOAIGAC_ID,11714], @param6=[NGAYGHINHAN,9/20/2019 12:00:00 AM], @param7=[THOIGIANGHINHAN,9/20/2019 2:11:12 PM], @param8=[SOLUONG,15], @param9=[SOLUONGDASUDUNG,10], @param10=[SOLUONGCONLAI,5], @param11=[GHICHU,null], @param12=[NGUOINHANDUNGCU_ID,38], @param13=[BENHVIEN_ID,HLU01], @param14=[NGUOITAO,null], @param15=[NGAYTAO,9/20/2019 2:11:14 PM]]
2019-09-20 14:11:14,458 [1] DEBUG - Statement Id: [DAO00048_TT_PHAUTHUAT_GHINHANGAC_Add] Types: [@param0=[Int64, System.Int64], @param1=[Int64, System.Int64], @param2=[Int64, System.Int64], @param3=[Int64, System.Int64], @param4=[String, System.String], @param5=[Int64, System.Int64], @param6=[DateTime, System.DateTime], @param7=[DateTime, System.DateTime], @param8=[Double, System.Double], @param9=[Double, System.Double], @param10=[Double, System.Double], @param11=[System.DBNull, null], @param12=[Int64, System.Int64], @param13=[String, System.String], @param14=[System.DBNull, null], @param15=[DateTime, System.DateTime]]
2019-09-20 14:11:17,830 [1] DEBUG - Statement Id: [DAO00048_GetDSLoaiGacDaGhiNhan] PreparedStatement : [select A.KIEMSOATGAC_ID, A.BENHNHAN_ID, A.TIEPNHAN_ID, A.BENHAN_ID, A.PHAUTHUAT_ID, A.LOAIPT_TT, A.LOAIGAC_ID          , A.NGAYGHINHAN, A.THOIGIANGHINHAN, A.SOLUONG, A.SOLUONGDASUDUNG, A.SOLUONGCONLAI, A.GHICHU, A.NGUOINHANDUNGCU_ID          , B.DICTIONARY_CODE AS MALOAIGAC, B.DICTIONARY_NAME AS TENLOAIGAC          from TT_PHAUTHUAT_GHINHANGAC A          inner join LST_DICTIONARY B on B.DICTIONARY_ID = A.LOAIGAC_ID          where A.PHAUTHUAT_ID = 3742 and A.BENHVIEN_ID = 'HLU01']
2019-09-20 14:12:00,650 [1] DEBUG - Statement Id: [DAO00066_GetBENHAN_TIEPNHAN] PreparedStatement : [select top 1 *        from TT_NOITRU_BENHAN        where TIEPNHAN_ID = '27022'  and BENHVIEN_ID = 'HLU01'        order by NGAYTAO desc]
2019-09-20 14:12:00,739 [1] DEBUG - Statement Id: [DAO00014_GetInPatientStatus] PreparedStatement : [select TRANGTHAI, isnull(KHOACHUYENDEN_ID, KHOAVAO_ID) as KHOAHIENTAI from TT_NOITRU_BENHAN        where        TIEPNHAN_ID = '27022'        and BENHVIEN_ID = 'HLU01'         and           BENHAN_ID = '5800']
2019-09-20 14:12:00,834 [1] DEBUG - Statement Id: [DAO00048_TT_PHAUTHUAT_GetList] PreparedStatement : [select *              from TT_PHAUTHUAT               where                             TT_PHAUTHUAT.LOAI = 'P'                       and                           TT_PHAUTHUAT.TIEPNHAN_ID = 27022                       and                           TT_PHAUTHUAT.BENHVIEN_ID = 'HLU01'                                     order by PHAUTHUAT_ID DESC]
2019-09-20 14:12:00,885 [1] DEBUG - Statement Id: [DAO00048_GetListLoaiGacTrongPTTT] PreparedStatement : [select DICTIONARY_ID, DICTIONARY_CODE, DICTIONARY_NAME          from LST_DICTIONARY          where DICTIONARY_TYPE_CODE = 'LoaiGacPTTT'          and ENABLED = '1']
2019-09-20 14:12:01,873 [1] DEBUG - Statement Id: [DAO00048_GetDSLoaiGacDaGhiNhan] PreparedStatement : [select A.KIEMSOATGAC_ID, A.BENHNHAN_ID, A.TIEPNHAN_ID, A.BENHAN_ID, A.PHAUTHUAT_ID, A.LOAIPT_TT, A.LOAIGAC_ID          , A.NGAYGHINHAN, A.THOIGIANGHINHAN, A.SOLUONG, A.SOLUONGDASUDUNG, A.SOLUONGCONLAI, A.GHICHU, A.NGUOINHANDUNGCU_ID          , B.DICTIONARY_CODE AS MALOAIGAC, B.DICTIONARY_NAME AS TENLOAIGAC          from TT_PHAUTHUAT_GHINHANGAC A          inner join LST_DICTIONARY B on B.DICTIONARY_ID = A.LOAIGAC_ID          where A.PHAUTHUAT_ID = 3742 and A.BENHVIEN_ID = 'HLU01']
2019-09-20 14:12:02,074 [1] DEBUG - Statement Id: [DAO00048_GetDSLoaiGacDaGhiNhan] PreparedStatement : [select A.KIEMSOATGAC_ID, A.BENHNHAN_ID, A.TIEPNHAN_ID, A.BENHAN_ID, A.PHAUTHUAT_ID, A.LOAIPT_TT, A.LOAIGAC_ID          , A.NGAYGHINHAN, A.THOIGIANGHINHAN, A.SOLUONG, A.SOLUONGDASUDUNG, A.SOLUONGCONLAI, A.GHICHU, A.NGUOINHANDUNGCU_ID          , B.DICTIONARY_CODE AS MALOAIGAC, B.DICTIONARY_NAME AS TENLOAIGAC          from TT_PHAUTHUAT_GHINHANGAC A          inner join LST_DICTIONARY B on B.DICTIONARY_ID = A.LOAIGAC_ID          where A.PHAUTHUAT_ID = 3742 and A.BENHVIEN_ID = 'HLU01']
2019-09-20 14:12:27,833 [1] DEBUG - Statement Id: [DAO00048_TT_PHAUTHUAT_GHINHANGAC_Update] PreparedStatement : [UPDATE [dbo].[TT_PHAUTHUAT_GHINHANGAC]          SET [LOAIGAC_ID] =  @param0           ,[SOLUONG] =  @param1           ,[SOLUONGDASUDUNG] =  @param2           ,[SOLUONGCONLAI] =  @param3           ,[GHICHU] =  @param4           ,[NGUOINHANDUNGCU_ID] =  @param5           ,[NGUOICAPNHAT] =  @param6           ,[NGAYCAPNHAT] =  @param7           WHERE [KIEMSOATGAC_ID] = 6]
2019-09-20 14:12:27,833 [1] DEBUG - Statement Id: [DAO00048_TT_PHAUTHUAT_GHINHANGAC_Update] Parameters: [@param0=[LOAIGAC_ID,11713], @param1=[SOLUONG,10], @param2=[SOLUONGDASUDUNG,8], @param3=[SOLUONGCONLAI,2], @param4=[GHICHU,test], @param5=[NGUOINHANDUNGCU_ID,38], @param6=[NGUOICAPNHAT,null], @param7=[NGAYCAPNHAT,9/20/2019 2:12:27 PM]]
2019-09-20 14:12:27,833 [1] DEBUG - Statement Id: [DAO00048_TT_PHAUTHUAT_GHINHANGAC_Update] Types: [@param0=[Int64, System.Int64], @param1=[Double, System.Double], @param2=[Double, System.Double], @param3=[Double, System.Double], @param4=[String, System.String], @param5=[Int64, System.Int64], @param6=[System.DBNull, null], @param7=[DateTime, System.DateTime]]
2019-09-20 14:12:31,343 [1] DEBUG - Statement Id: [DAO00048_TT_PHAUTHUAT_GHINHANGAC_Update] PreparedStatement : [UPDATE [dbo].[TT_PHAUTHUAT_GHINHANGAC]          SET [LOAIGAC_ID] =  @param0           ,[SOLUONG] =  @param1           ,[SOLUONGDASUDUNG] =  @param2           ,[SOLUONGCONLAI] =  @param3           ,[GHICHU] =  @param4           ,[NGUOINHANDUNGCU_ID] =  @param5           ,[NGUOICAPNHAT] =  @param6           ,[NGAYCAPNHAT] =  @param7           WHERE [KIEMSOATGAC_ID] = 7]
2019-09-20 14:12:31,343 [1] DEBUG - Statement Id: [DAO00048_TT_PHAUTHUAT_GHINHANGAC_Update] Parameters: [@param0=[LOAIGAC_ID,11715], @param1=[SOLUONG,10], @param2=[SOLUONGDASUDUNG,10], @param3=[SOLUONGCONLAI,0], @param4=[GHICHU,test 2], @param5=[NGUOINHANDUNGCU_ID,38], @param6=[NGUOICAPNHAT,null], @param7=[NGAYCAPNHAT,9/20/2019 2:12:31 PM]]
2019-09-20 14:12:31,344 [1] DEBUG - Statement Id: [DAO00048_TT_PHAUTHUAT_GHINHANGAC_Update] Types: [@param0=[Int64, System.Int64], @param1=[Double, System.Double], @param2=[Double, System.Double], @param3=[Double, System.Double], @param4=[String, System.String], @param5=[Int64, System.Int64], @param6=[System.DBNull, null], @param7=[DateTime, System.DateTime]]
2019-09-20 14:12:35,697 [1] DEBUG - Statement Id: [DAO00048_TT_PHAUTHUAT_GHINHANGAC_Update] PreparedStatement : [UPDATE [dbo].[TT_PHAUTHUAT_GHINHANGAC]          SET [LOAIGAC_ID] =  @param0           ,[SOLUONG] =  @param1           ,[SOLUONGDASUDUNG] =  @param2           ,[SOLUONGCONLAI] =  @param3           ,[GHICHU] =  @param4           ,[NGUOINHANDUNGCU_ID] =  @param5           ,[NGUOICAPNHAT] =  @param6           ,[NGAYCAPNHAT] =  @param7           WHERE [KIEMSOATGAC_ID] = 8]
2019-09-20 14:12:35,697 [1] DEBUG - Statement Id: [DAO00048_TT_PHAUTHUAT_GHINHANGAC_Update] Parameters: [@param0=[LOAIGAC_ID,11714], @param1=[SOLUONG,15], @param2=[SOLUONGDASUDUNG,5], @param3=[SOLUONGCONLAI,10], @param4=[GHICHU,null], @param5=[NGUOINHANDUNGCU_ID,38], @param6=[NGUOICAPNHAT,null], @param7=[NGAYCAPNHAT,9/20/2019 2:12:35 PM]]
2019-09-20 14:12:35,697 [1] DEBUG - Statement Id: [DAO00048_TT_PHAUTHUAT_GHINHANGAC_Update] Types: [@param0=[Int64, System.Int64], @param1=[Double, System.Double], @param2=[Double, System.Double], @param3=[Double, System.Double], @param4=[System.DBNull, null], @param5=[Int64, System.Int64], @param6=[System.DBNull, null], @param7=[DateTime, System.DateTime]]
2019-09-20 14:12:39,363 [1] DEBUG - Statement Id: [DAO00048_GetDSLoaiGacDaGhiNhan] PreparedStatement : [select A.KIEMSOATGAC_ID, A.BENHNHAN_ID, A.TIEPNHAN_ID, A.BENHAN_ID, A.PHAUTHUAT_ID, A.LOAIPT_TT, A.LOAIGAC_ID          , A.NGAYGHINHAN, A.THOIGIANGHINHAN, A.SOLUONG, A.SOLUONGDASUDUNG, A.SOLUONGCONLAI, A.GHICHU, A.NGUOINHANDUNGCU_ID          , B.DICTIONARY_CODE AS MALOAIGAC, B.DICTIONARY_NAME AS TENLOAIGAC          from TT_PHAUTHUAT_GHINHANGAC A          inner join LST_DICTIONARY B on B.DICTIONARY_ID = A.LOAIGAC_ID          where A.PHAUTHUAT_ID = 3742 and A.BENHVIEN_ID = 'HLU01']
2019-09-20 14:12:39,610 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'COM98'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2019-09-20 14:13:13,013 [1] DEBUG - Statement Id: [DAO00048_TT_PHAUTHUAT_GHINHANGAC_Update] PreparedStatement : [UPDATE [dbo].[TT_PHAUTHUAT_GHINHANGAC]          SET [LOAIGAC_ID] =  @param0           ,[SOLUONG] =  @param1           ,[SOLUONGDASUDUNG] =  @param2           ,[SOLUONGCONLAI] =  @param3           ,[GHICHU] =  @param4           ,[NGUOINHANDUNGCU_ID] =  @param5           ,[NGUOICAPNHAT] =  @param6           ,[NGAYCAPNHAT] =  @param7           WHERE [KIEMSOATGAC_ID] = 6]
2019-09-20 14:13:13,013 [1] DEBUG - Statement Id: [DAO00048_TT_PHAUTHUAT_GHINHANGAC_Update] Parameters: [@param0=[LOAIGAC_ID,11713], @param1=[SOLUONG,10], @param2=[SOLUONGDASUDUNG,8], @param3=[SOLUONGCONLAI,2], @param4=[GHICHU,test], @param5=[NGUOINHANDUNGCU_ID,38], @param6=[NGUOICAPNHAT,null], @param7=[NGAYCAPNHAT,9/20/2019 2:13:13 PM]]
2019-09-20 14:13:13,015 [1] DEBUG - Statement Id: [DAO00048_TT_PHAUTHUAT_GHINHANGAC_Update] Types: [@param0=[Int64, System.Int64], @param1=[Double, System.Double], @param2=[Double, System.Double], @param3=[Double, System.Double], @param4=[String, System.String], @param5=[Int64, System.Int64], @param6=[System.DBNull, null], @param7=[DateTime, System.DateTime]]
2019-09-20 14:13:13,050 [1] DEBUG - Statement Id: [DAO00048_TT_PHAUTHUAT_GHINHANGAC_Update] PreparedStatement : [UPDATE [dbo].[TT_PHAUTHUAT_GHINHANGAC]          SET [LOAIGAC_ID] =  @param0           ,[SOLUONG] =  @param1           ,[SOLUONGDASUDUNG] =  @param2           ,[SOLUONGCONLAI] =  @param3           ,[GHICHU] =  @param4           ,[NGUOINHANDUNGCU_ID] =  @param5           ,[NGUOICAPNHAT] =  @param6           ,[NGAYCAPNHAT] =  @param7           WHERE [KIEMSOATGAC_ID] = 7]
2019-09-20 14:13:13,050 [1] DEBUG - Statement Id: [DAO00048_TT_PHAUTHUAT_GHINHANGAC_Update] Parameters: [@param0=[LOAIGAC_ID,11715], @param1=[SOLUONG,10], @param2=[SOLUONGDASUDUNG,10], @param3=[SOLUONGCONLAI,0], @param4=[GHICHU,test 2], @param5=[NGUOINHANDUNGCU_ID,38], @param6=[NGUOICAPNHAT,null], @param7=[NGAYCAPNHAT,9/20/2019 2:13:13 PM]]
2019-09-20 14:13:13,050 [1] DEBUG - Statement Id: [DAO00048_TT_PHAUTHUAT_GHINHANGAC_Update] Types: [@param0=[Int64, System.Int64], @param1=[Double, System.Double], @param2=[Double, System.Double], @param3=[Double, System.Double], @param4=[String, System.String], @param5=[Int64, System.Int64], @param6=[System.DBNull, null], @param7=[DateTime, System.DateTime]]
2019-09-20 14:13:13,088 [1] DEBUG - Statement Id: [DAO00048_TT_PHAUTHUAT_GHINHANGAC_Update] PreparedStatement : [UPDATE [dbo].[TT_PHAUTHUAT_GHINHANGAC]          SET [LOAIGAC_ID] =  @param0           ,[SOLUONG] =  @param1           ,[SOLUONGDASUDUNG] =  @param2           ,[SOLUONGCONLAI] =  @param3           ,[GHICHU] =  @param4           ,[NGUOINHANDUNGCU_ID] =  @param5           ,[NGUOICAPNHAT] =  @param6           ,[NGAYCAPNHAT] =  @param7           WHERE [KIEMSOATGAC_ID] = 8]
2019-09-20 14:13:13,088 [1] DEBUG - Statement Id: [DAO00048_TT_PHAUTHUAT_GHINHANGAC_Update] Parameters: [@param0=[LOAIGAC_ID,11714], @param1=[SOLUONG,15], @param2=[SOLUONGDASUDUNG,5], @param3=[SOLUONGCONLAI,10], @param4=[GHICHU,test 3], @param5=[NGUOINHANDUNGCU_ID,38], @param6=[NGUOICAPNHAT,null], @param7=[NGAYCAPNHAT,9/20/2019 2:13:13 PM]]
2019-09-20 14:13:13,088 [1] DEBUG - Statement Id: [DAO00048_TT_PHAUTHUAT_GHINHANGAC_Update] Types: [@param0=[Int64, System.Int64], @param1=[Double, System.Double], @param2=[Double, System.Double], @param3=[Double, System.Double], @param4=[String, System.String], @param5=[Int64, System.Int64], @param6=[System.DBNull, null], @param7=[DateTime, System.DateTime]]
2019-09-20 14:13:21,705 [1] DEBUG - Statement Id: [DAO00048_GetDSLoaiGacDaGhiNhan] PreparedStatement : [select A.KIEMSOATGAC_ID, A.BENHNHAN_ID, A.TIEPNHAN_ID, A.BENHAN_ID, A.PHAUTHUAT_ID, A.LOAIPT_TT, A.LOAIGAC_ID          , A.NGAYGHINHAN, A.THOIGIANGHINHAN, A.SOLUONG, A.SOLUONGDASUDUNG, A.SOLUONGCONLAI, A.GHICHU, A.NGUOINHANDUNGCU_ID          , B.DICTIONARY_CODE AS MALOAIGAC, B.DICTIONARY_NAME AS TENLOAIGAC          from TT_PHAUTHUAT_GHINHANGAC A          inner join LST_DICTIONARY B on B.DICTIONARY_ID = A.LOAIGAC_ID          where A.PHAUTHUAT_ID = 3742 and A.BENHVIEN_ID = 'HLU01']
2019-09-20 14:14:04,539 [1] DEBUG - Statement Id: [DAO00048_TT_PHAUTHUAT_GHINHANGAC_Update] PreparedStatement : [UPDATE [dbo].[TT_PHAUTHUAT_GHINHANGAC]          SET [LOAIGAC_ID] =  @param0           ,[SOLUONG] =  @param1           ,[SOLUONGDASUDUNG] =  @param2           ,[SOLUONGCONLAI] =  @param3           ,[GHICHU] =  @param4           ,[NGUOINHANDUNGCU_ID] =  @param5           ,[NGUOICAPNHAT] =  @param6           ,[NGAYCAPNHAT] =  @param7           WHERE [KIEMSOATGAC_ID] = 6]
2019-09-20 14:14:04,542 [1] DEBUG - Statement Id: [DAO00048_TT_PHAUTHUAT_GHINHANGAC_Update] Parameters: [@param0=[LOAIGAC_ID,11713], @param1=[SOLUONG,10], @param2=[SOLUONGDASUDUNG,8], @param3=[SOLUONGCONLAI,2], @param4=[GHICHU,test], @param5=[NGUOINHANDUNGCU_ID,38], @param6=[NGUOICAPNHAT,null], @param7=[NGAYCAPNHAT,9/20/2019 2:14:04 PM]]
2019-09-20 14:14:04,542 [1] DEBUG - Statement Id: [DAO00048_TT_PHAUTHUAT_GHINHANGAC_Update] Types: [@param0=[Int64, System.Int64], @param1=[Double, System.Double], @param2=[Double, System.Double], @param3=[Double, System.Double], @param4=[String, System.String], @param5=[Int64, System.Int64], @param6=[System.DBNull, null], @param7=[DateTime, System.DateTime]]
2019-09-20 14:14:04,584 [1] DEBUG - Statement Id: [DAO00048_TT_PHAUTHUAT_GHINHANGAC_Update] PreparedStatement : [UPDATE [dbo].[TT_PHAUTHUAT_GHINHANGAC]          SET [LOAIGAC_ID] =  @param0           ,[SOLUONG] =  @param1           ,[SOLUONGDASUDUNG] =  @param2           ,[SOLUONGCONLAI] =  @param3           ,[GHICHU] =  @param4           ,[NGUOINHANDUNGCU_ID] =  @param5           ,[NGUOICAPNHAT] =  @param6           ,[NGAYCAPNHAT] =  @param7           WHERE [KIEMSOATGAC_ID] = 7]
2019-09-20 14:14:04,584 [1] DEBUG - Statement Id: [DAO00048_TT_PHAUTHUAT_GHINHANGAC_Update] Parameters: [@param0=[LOAIGAC_ID,11715], @param1=[SOLUONG,10], @param2=[SOLUONGDASUDUNG,10], @param3=[SOLUONGCONLAI,0], @param4=[GHICHU,test 2], @param5=[NGUOINHANDUNGCU_ID,38], @param6=[NGUOICAPNHAT,null], @param7=[NGAYCAPNHAT,9/20/2019 2:14:04 PM]]
2019-09-20 14:14:04,584 [1] DEBUG - Statement Id: [DAO00048_TT_PHAUTHUAT_GHINHANGAC_Update] Types: [@param0=[Int64, System.Int64], @param1=[Double, System.Double], @param2=[Double, System.Double], @param3=[Double, System.Double], @param4=[String, System.String], @param5=[Int64, System.Int64], @param6=[System.DBNull, null], @param7=[DateTime, System.DateTime]]
2019-09-20 14:14:04,644 [1] DEBUG - Statement Id: [DAO00048_TT_PHAUTHUAT_GHINHANGAC_Update] PreparedStatement : [UPDATE [dbo].[TT_PHAUTHUAT_GHINHANGAC]          SET [LOAIGAC_ID] =  @param0           ,[SOLUONG] =  @param1           ,[SOLUONGDASUDUNG] =  @param2           ,[SOLUONGCONLAI] =  @param3           ,[GHICHU] =  @param4           ,[NGUOINHANDUNGCU_ID] =  @param5           ,[NGUOICAPNHAT] =  @param6           ,[NGAYCAPNHAT] =  @param7           WHERE [KIEMSOATGAC_ID] = 8]
2019-09-20 14:14:04,644 [1] DEBUG - Statement Id: [DAO00048_TT_PHAUTHUAT_GHINHANGAC_Update] Parameters: [@param0=[LOAIGAC_ID,11714], @param1=[SOLUONG,15], @param2=[SOLUONGDASUDUNG,5], @param3=[SOLUONGCONLAI,10], @param4=[GHICHU,test 3], @param5=[NGUOINHANDUNGCU_ID,38], @param6=[NGUOICAPNHAT,null], @param7=[NGAYCAPNHAT,9/20/2019 2:14:04 PM]]
2019-09-20 14:14:04,644 [1] DEBUG - Statement Id: [DAO00048_TT_PHAUTHUAT_GHINHANGAC_Update] Types: [@param0=[Int64, System.Int64], @param1=[Double, System.Double], @param2=[Double, System.Double], @param3=[Double, System.Double], @param4=[String, System.String], @param5=[Int64, System.Int64], @param6=[System.DBNull, null], @param7=[DateTime, System.DateTime]]
2019-09-20 14:14:05,645 [1] DEBUG - Statement Id: [DAO00048_GetDSLoaiGacDaGhiNhan] PreparedStatement : [select A.KIEMSOATGAC_ID, A.BENHNHAN_ID, A.TIEPNHAN_ID, A.BENHAN_ID, A.PHAUTHUAT_ID, A.LOAIPT_TT, A.LOAIGAC_ID          , A.NGAYGHINHAN, A.THOIGIANGHINHAN, A.SOLUONG, A.SOLUONGDASUDUNG, A.SOLUONGCONLAI, A.GHICHU, A.NGUOINHANDUNGCU_ID          , B.DICTIONARY_CODE AS MALOAIGAC, B.DICTIONARY_NAME AS TENLOAIGAC          from TT_PHAUTHUAT_GHINHANGAC A          inner join LST_DICTIONARY B on B.DICTIONARY_ID = A.LOAIGAC_ID          where A.PHAUTHUAT_ID = 3742 and A.BENHVIEN_ID = 'HLU01']
--------------------------------------------------------------------------------
2019-09-20 15:44:12,614 [1] DEBUG - Statement Id: [DAO00001_DBList] PreparedStatement : [select *              from TM_SYS_SERVER              where HOSPITAL_ID = '_SYSTEM_' and TYPE = 'D']
2019-09-20 15:44:15,300 [1] DEBUG - Statement Id: [DAO00001_DaoList] PreparedStatement : [select              TM_SYS_SERVICEMAP.ID,              TM_SYS_SERVICEMAP.HOSPITAL_ID,              TM_SYS_SERVICEMAP.DB_NAME,              TM_SYS_SERVICEMAP.TYPE,              TM_SYS_SERVICEMAP.NAME,              TM_SYS_SERVICEMAP.CLASS,              (TM_SYS_DIC.VALUE + '.' + TM_SYS_SERVICEMAP.CLASS) as CLASSFULL,              TM_SYS_SERVICEMAP.ASSEMBLY              from TM_SYS_SERVICEMAP              inner join TM_SYS_DIC              on TM_SYS_SERVICEMAP.NAMESPACE = TM_SYS_DIC.ID              where HOSPITAL_ID = '_SYSTEM_' AND TYPE = 'D' AND ACTIVE = '1'              order by DB_NAME]
2019-09-20 15:44:15,343 [1] DEBUG - Statement Id: [DAO00001_ServiceList] PreparedStatement : [select              TM_SYS_SERVICEMAP.ID,              TM_SYS_SERVICEMAP.HOSPITAL_ID,              TM_SYS_SERVICEMAP.DB_NAME,              TM_SYS_SERVICEMAP.TYPE,              TM_SYS_SERVICEMAP.NAME,              TM_SYS_SERVICEMAP.CLASS,              (TM_SYS_DIC.VALUE + '.' + TM_SYS_SERVICEMAP.CLASS) as CLASSFULL,              TM_SYS_SERVICEMAP.ASSEMBLY,              TM_SYS_SERVER.URL              from TM_SYS_SERVICEMAP              inner join TM_SYS_DIC on TM_SYS_SERVICEMAP.NAMESPACE = TM_SYS_DIC.ID              inner join TM_SYS_SERVER on (TM_SYS_SERVICEMAP.DB_NAME = TM_SYS_SERVER.NAME) and (TM_SYS_SERVER.HOSPITAL_ID = '_SYSTEM_')              where TM_SYS_SERVICEMAP.HOSPITAL_ID = '_SYSTEM_' AND TM_SYS_SERVICEMAP.TYPE = 'S'  AND ACTIVE = '1'              order by URL]
2019-09-20 15:44:15,720 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = '_SYSTEM_'               AND                   TM_SYS_SCREEN.PAGE = 'LOGIN'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2019-09-20 15:44:15,974 [1] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = '_SYSTEM_'               AND                   TM_SYS_CACHE.ACTIVE = '1']
2019-09-20 15:44:24,994 [1] DEBUG - Statement Id: [DAO00001_DBList] PreparedStatement : [select *              from TM_SYS_SERVER              where HOSPITAL_ID = 'HLU01' and TYPE = 'D']
2019-09-20 15:44:25,026 [1] DEBUG - Statement Id: [DAO00001_DaoList] PreparedStatement : [select              TM_SYS_SERVICEMAP.ID,              TM_SYS_SERVICEMAP.HOSPITAL_ID,              TM_SYS_SERVICEMAP.DB_NAME,              TM_SYS_SERVICEMAP.TYPE,              TM_SYS_SERVICEMAP.NAME,              TM_SYS_SERVICEMAP.CLASS,              (TM_SYS_DIC.VALUE + '.' + TM_SYS_SERVICEMAP.CLASS) as CLASSFULL,              TM_SYS_SERVICEMAP.ASSEMBLY              from TM_SYS_SERVICEMAP              inner join TM_SYS_DIC              on TM_SYS_SERVICEMAP.NAMESPACE = TM_SYS_DIC.ID              where HOSPITAL_ID = 'HLU01' AND TYPE = 'D' AND ACTIVE = '1'              order by DB_NAME]
2019-09-20 15:44:26,686 [1] DEBUG - Statement Id: [DAO00001_ServiceList] PreparedStatement : [select              TM_SYS_SERVICEMAP.ID,              TM_SYS_SERVICEMAP.HOSPITAL_ID,              TM_SYS_SERVICEMAP.DB_NAME,              TM_SYS_SERVICEMAP.TYPE,              TM_SYS_SERVICEMAP.NAME,              TM_SYS_SERVICEMAP.CLASS,              (TM_SYS_DIC.VALUE + '.' + TM_SYS_SERVICEMAP.CLASS) as CLASSFULL,              TM_SYS_SERVICEMAP.ASSEMBLY,              TM_SYS_SERVER.URL              from TM_SYS_SERVICEMAP              inner join TM_SYS_DIC on TM_SYS_SERVICEMAP.NAMESPACE = TM_SYS_DIC.ID              inner join TM_SYS_SERVER on (TM_SYS_SERVICEMAP.DB_NAME = TM_SYS_SERVER.NAME) and (TM_SYS_SERVER.HOSPITAL_ID = 'HLU01')              where TM_SYS_SERVICEMAP.HOSPITAL_ID = 'HLU01' AND TM_SYS_SERVICEMAP.TYPE = 'S'  AND ACTIVE = '1'              order by URL]
2019-09-20 15:44:26,783 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1']
2019-09-20 15:44:28,015 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM005']
2019-09-20 15:44:28,153 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM015']
2019-09-20 15:44:28,229 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM067']
2019-09-20 15:44:28,307 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM008']
2019-09-20 15:44:28,388 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM068']
2019-09-20 15:44:28,487 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM006']
2019-09-20 15:44:28,566 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM030']
2019-09-20 15:44:28,642 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM025']
2019-09-20 15:44:28,735 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM024']
2019-09-20 15:44:29,251 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM033']
2019-09-20 15:44:29,290 [5] DEBUG - Statement Id: [DAO00027_GetListDuocKyGuiTonKho] PreparedStatement : [select  distinct TT_TONKHO.DUOC_KEY, LTRIM(TT_TONKHO.KHODUOC_ID) as KHODUOC_ID, TM_DUOC.DUOC_ID, TM_LOAIDUOC.MALOAIDUOC,TM_DUOC.SOVISA,TM_DUOC.TYLE_VAT,TM_DUOC.COTOA,        TM_DUOC.MADUOC, TM_DUOC.TENHANG, TM_DUOC.TENDUOCDAYDU, dvt.TENDONVITINH as DONVITINH,  TM_DUOC.DONVITINH_ID,TM_DUOC.BHYT,TM_DUOC.PHAMVI,        TM_DUOC.TENHOATCHAT, TM_DUOC.HAMLUONG, TM_DUOC.HANGSANXUAT, TM_DUOC.QUOCGIA, TM_DUOC.LOAIDUOC_ID, TM_DUOC.DUONGDUNG_ID,        TM_TENDUOC.TENDUOC, TM_TENDUOC.TENDUOC_EN, TM_TENDUOC.MAQUOCTE, TM_TENDUOC.MAQUOCTEBT,        TM_LOAIDUOC.LOAIVATTU_ID, TM_DUOC.BENHVIEN_ID,TT_TONKHO.SOLUONG, TT_TONKHO.NGUONDUOC_ID, NH.TENNGUONDUOC        , TAMNGUNG = CASE WHEN TM_DUOC.TAMNGUNG = '1' OR nh.TAMNGUNG = '1' OR KD.TAMNGUNG = '1' THEN '1' ELSE '0' END        , TM_DUOC.DANGTRINHBAY        from TM_DUOC        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = TM_DUOC.DONVITINH_ID        left join TM_TENDUOC on TM_DUOC.TENDUOC_ID = TM_TENDUOC.TENDUOC_ID and TM_DUOC.BENHVIEN_ID = 'HLU01' and TM_DUOC.TAMNGUNG = '0'        left join TM_LOAIDUOC on TM_LOAIDUOC.LOAIDUOC_ID = TM_DUOC.LOAIDUOC_ID and TM_LOAIDUOC.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG on (TM_LOAIDUOC.LOAIVATTU_ID = TM_DUOC_HANDUNG.LOAIDUOC and TM_DUOC_HANDUNG.BENHVIEN_ID = 'HLU01')        inner join        (select LTRIM(A.KHODUOC_ID) + '_' + LTRIM(A.DUOC_ID) + '_' + LTRIM(ISNULL(A.NGUONDUOC_ID,'')) as DUOC_KEY, A.KHODUOC_ID, A.DUOC_ID,A.NGUONDUOC_ID,        SUM(isnull(A.SOLUONG,0)) as SOLUONG        from        (select SUM(SOLUONG) as SOLUONG, KHODUOC_ID, DUOC_ID, NGUONDUOC_ID from TT_DUOC_KYGUI_TONKHO        where BENHVIEN_ID = 'HLU01' group by KHODUOC_ID, DUOC_ID, NGUONDUOC_ID) A        group by LTRIM(A.KHODUOC_ID) + '_' + LTRIM(A.DUOC_ID) + '_' + LTRIM(A.NGUONDUOC_ID), A.KHODUOC_ID, A.DUOC_ID, A.NGUONDUOC_ID)        TT_TONKHO on TT_TONKHO.DUOC_ID = TM_DUOC.DUOC_ID        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = TT_TONKHO.NGUONDUOC_ID and nh.BENHVIEN_ID = 'HLU01'        LEFT JOIN TM_KHODUOC KD ON KD.KHODUOC_ID = TT_TONKHO.KHODUOC_ID        where TM_DUOC.BENHVIEN_ID = 'HLU01' AND TT_TONKHO.SOLUONG >= 0]
2019-09-20 15:44:29,375 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM018']
2019-09-20 15:44:29,411 [5] DEBUG - Statement Id: [DAO00027_GetListDuocTonKho] PreparedStatement : [select distinct TT_TONKHO.DUOC_KEY, LTRIM(TT_TONKHO.KHODUOC_ID) as KHODUOC_ID, TM_DUOC.DUOC_ID, TM_LOAIDUOC.MALOAIDUOC,TM_DUOC.SOVISA,TM_DUOC.TYLE_VAT,TM_DUOC.COTOA,        TM_DUOC.MADUOC, TM_DUOC.TENHANG, TM_DUOC.TENDUOCDAYDU, dvt.TENDONVITINH as DONVITINH,  TM_DUOC.DONVITINH_ID,TM_DUOC.BHYT,                TM_DUOC.TENHOATCHAT,          TM_DUOC.HAMLUONG, TM_DUOC.HANGSANXUAT, TM_DUOC.QUOCGIA, TM_DUOC.LOAIDUOC_ID, TM_DUOC.DUONGDUNG_ID,        TM_TENDUOC.TENDUOC, TM_TENDUOC.TENDUOC_EN, TM_TENDUOC.MAQUOCTE, TM_TENDUOC.MAQUOCTEBT,        TM_LOAIDUOC.LOAIVATTU_ID, TM_DUOC.BENHVIEN_ID,        TT_TONKHO.SOLUONG, TM_DUOC.VTYT_PHANLOAI, TM_DUOC.PHAMVI, TT_TONKHO.NGUONDUOC_ID, NG.TENNGUONDUOC AS TENNGUONDUOC        , TAMNGUNG = CASE WHEN TM_DUOC.TAMNGUNG = '1' OR NG.TAMNGUNG = '1' OR KD.TAMNGUNG = '1' THEN '1' ELSE '0' END        , TM_DUOC.DANGTRINHBAY        from TM_DUOC        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = TM_DUOC.DONVITINH_ID        left join TM_TENDUOC on TM_DUOC.TENDUOC_ID = TM_TENDUOC.TENDUOC_ID and TM_DUOC.BENHVIEN_ID = 'HLU01' and TM_DUOC.TAMNGUNG = '0'        left join TM_LOAIDUOC on TM_LOAIDUOC.LOAIDUOC_ID = TM_DUOC.LOAIDUOC_ID and TM_LOAIDUOC.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG on (TM_LOAIDUOC.LOAIVATTU_ID = TM_DUOC_HANDUNG.LOAIDUOC and TM_DUOC_HANDUNG.BENHVIEN_ID = 'HLU01')        inner join        (select LTRIM(A.KHODUOC_ID) + '_' + LTRIM(A.DUOC_ID) + '_' + LTRIM(ISNULL(A.NGUONDUOC_ID,'')) as DUOC_KEY, A.KHODUOC_ID, A.DUOC_ID, A.NGUONDUOC_ID,        SUM(isnull(A.SOLUONG,0)) as SOLUONG        from        (select SUM(SOLUONG) as SOLUONG, KHODUOC_ID, DUOC_ID, NGUONDUOC_ID from TT_DUOC_TONKHO        where BENHVIEN_ID = 'HLU01' group by KHODUOC_ID, DUOC_ID, NGUONDUOC_ID) A        group by LTRIM(A.KHODUOC_ID) + '_' + LTRIM(A.DUOC_ID) + '_' + LTRIM(ISNULL(A.NGUONDUOC_ID,'')), A.KHODUOC_ID, A.DUOC_ID, NGUONDUOC_ID        ) TT_TONKHO on TT_TONKHO.DUOC_ID = TM_DUOC.DUOC_ID        LEFT JOIN TM_NGUONHANG NG ON NG.NGUONDUOC_ID = TT_TONKHO.NGUONDUOC_ID        LEFT JOIN TM_KHODUOC KD ON KD.KHODUOC_ID = TT_TONKHO.KHODUOC_ID        where TM_DUOC.BENHVIEN_ID = 'HLU01' and TT_TONKHO.SOLUONG >= 0]
2019-09-20 15:44:34,281 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM023']
2019-09-20 15:44:34,321 [5] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoVaBooking] PreparedStatement : [declare @NGUONDUOC_MACDINH varchar(5) = '0';        declare @TOAMUANGOAI int = 0;        select @NGUONDUOC_MACDINH = isnull(VALUE,0) from TM_SYS_APPSETTINGS where CODE = 'PHA_NGUONDUOC'        select @TOAMUANGOAI = isnull(VALUE,0) from TM_SYS_APPSETTINGS where CODE = 'OPD_TOAMUANGOAI_DUNGDANHMUC_DUOC'                if @TOAMUANGOAI = 1        begin        select  distinct '0' + '_' + LTRIM(d.DUOC_ID) + '_' + @NGUONDUOC_MACDINH as DUOC_KEY, 0 as PHAMVI_ID, @NGUONDUOC_MACDINH as NGUONDUOC_ID, null as TENNGUONDUOC, null as TINHTIEN, d.DUOC_ID, ld.MALOAIDUOC,        d.SOVISA,d.TYLE_VAT,d.COTOA, d.MADUOC, d.TENHANG, d.TENDUOCDAYDU, d.DONVITINH as DONVITINH, d.BHYT,        d.TENHOATCHAT, d.HAMLUONG, d.HANGSANXUAT, d.QUOCGIA, d.LOAIDUOC_ID, d.DUONGDUNG_ID, d.TINHTIEN_PTTT,        ten.TENDUOC, ten.TENDUOC_EN, ten.MAQUOCTE, ten.MAQUOCTEBT,        '' as BHYT_TEXT        , ld.LOAIVATTU_ID        , d.BENHVIEN_ID,        999999999 as SOLUONG, d.VTYT_PHANLOAI, d.PHAMVI, d.SUASOLUONGTONGHOP, d.MADUOCBV, d.DANGTRINHBAY        , TAMNGUNG = CASE WHEN d.TAMNGUNG = '1' THEN '1' ELSE '0' END        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        union all        select  distinct tk.DUOC_KEY, LTRIM(tk.PHAMVI_ID) as PHAMVI_ID, tk.NGUONDUOC_ID, nh.TENNGUONDUOC, nh.TINHTIEN, d.DUOC_ID, ld.MALOAIDUOC,        d.SOVISA,d.TYLE_VAT,d.COTOA, d.MADUOC, d.TENHANG, d.TENDUOCDAYDU, d.DONVITINH as DONVITINH, d.BHYT,        d.TENHOATCHAT, d.HAMLUONG, d.HANGSANXUAT, d.QUOCGIA, d.LOAIDUOC_ID, d.DUONGDUNG_ID, d.TINHTIEN_PTTT,        ten.TENDUOC, ten.TENDUOC_EN, ten.MAQUOCTE, ten.MAQUOCTEBT,        CASE WHEN d.BHYT = '1' THEN 'BHYT' ELSE '' END as BHYT_TEXT        , ld.LOAIVATTU_ID        , d.BENHVIEN_ID,        tk.SOLUONG, d.VTYT_PHANLOAI, d.PHAMVI, d.SUASOLUONGTONGHOP, d.MADUOCBV, d.DANGTRINHBAY        , TAMNGUNG = CASE WHEN d.TAMNGUNG = '1' OR nh.TAMNGUNG = '1' OR kd.TAMNGUNG = '1' THEN '1' ELSE '0' END        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        inner join        (        select  LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')) DUOC_KEY, (SUM(dtk.SOLUONG) - isnull(sum(A.SOLUONG),0) - isnull(sum(B.SOLUONG),0)) SOLUONG, pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        from (select sum(soluong) soluong,duoc_id,nguonduoc_id,khoduoc_id,benhvien_id from TT_DUOC_TONKHO  group by duoc_id,nguonduoc_id,khoduoc_id,benhvien_id) dtk        inner join TM_DUOC_PHAMVISD_MAPPING pvsd on dtk.KHODUOC_ID = pvsd.KHODUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NOITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) B on B.DUOC_ID = dtk.DUOC_ID and B.SOLUONG > 0 and B.PHAMVI_ID = pvsd.PHAMVI_ID and B.NGUONHANG_ID = dtk.NGUONDUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NGOAITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) A on A.DUOC_ID = dtk.DUOC_ID and A.SOLUONG > 0 and A.PHAMVI_ID = pvsd.PHAMVI_ID and A.NGUONHANG_ID = dtk.NGUONDUOC_ID        where dtk.SOLUONG > 0 and dtk.BENHVIEN_ID = 'HLU01'        group by LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')), pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        ) tk on tk.DUOC_ID = d.DUOC_ID        left join TM_DUOC_PHAMVISUDUNG kd on kd.PHAMVI_ID = tk.PHAMVI_ID and kd.BENHVIEN_ID = 'HLU01'        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = tk.NGUONDUOC_ID and nh.BENHVIEN_ID = 'HLU01'        where d.BENHVIEN_ID = 'HLU01'  and tk.SOLUONG >= 0        end        else        begin                  select  distinct tk.DUOC_KEY, LTRIM(tk.PHAMVI_ID) as PHAMVI_ID, tk.NGUONDUOC_ID, nh.TENNGUONDUOC, nh.TINHTIEN, d.DUOC_ID, ld.MALOAIDUOC,        d.SOVISA,d.TYLE_VAT,d.COTOA, d.MADUOC, d.TENHANG, d.TENDUOCDAYDU, d.DONVITINH as DONVITINH, d.BHYT,        d.TENHOATCHAT, d.HAMLUONG, d.HANGSANXUAT, d.QUOCGIA, d.LOAIDUOC_ID, d.DUONGDUNG_ID, d.TINHTIEN_PTTT,        ten.TENDUOC, ten.TENDUOC_EN, ten.MAQUOCTE, ten.MAQUOCTEBT,        CASE WHEN d.BHYT = '1' THEN 'BHYT' ELSE '' END as BHYT_TEXT        , ld.LOAIVATTU_ID        , d.BENHVIEN_ID,        tk.SOLUONG, d.VTYT_PHANLOAI, d.PHAMVI, d.SUASOLUONGTONGHOP, d.MADUOCBV, d.DANGTRINHBAY        , TAMNGUNG = CASE WHEN d.TAMNGUNG = '1' OR nh.TAMNGUNG = '1' OR kd.TAMNGUNG = '1' THEN '1' ELSE '0' END        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        inner join        (        select  LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')) DUOC_KEY, (SUM(dtk.SOLUONG) - isnull(sum(A.SOLUONG),0) - isnull(sum(B.SOLUONG),0)) SOLUONG, pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        from (select sum(soluong) soluong,duoc_id,nguonduoc_id,khoduoc_id,benhvien_id from TT_DUOC_TONKHO  group by duoc_id,nguonduoc_id,khoduoc_id,benhvien_id) dtk        inner join TM_DUOC_PHAMVISD_MAPPING pvsd on dtk.KHODUOC_ID = pvsd.KHODUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NOITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) B on B.DUOC_ID = dtk.DUOC_ID and B.SOLUONG > 0 and B.PHAMVI_ID = pvsd.PHAMVI_ID and B.NGUONHANG_ID = dtk.NGUONDUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NGOAITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) A on A.DUOC_ID = dtk.DUOC_ID and A.SOLUONG > 0 and A.PHAMVI_ID = pvsd.PHAMVI_ID and A.NGUONHANG_ID = dtk.NGUONDUOC_ID        where dtk.SOLUONG > 0 and dtk.BENHVIEN_ID = 'HLU01'        group by LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')), pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        ) tk on tk.DUOC_ID = d.DUOC_ID        left join TM_DUOC_PHAMVISUDUNG kd on kd.PHAMVI_ID = tk.PHAMVI_ID and kd.BENHVIEN_ID = 'HLU01'        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = tk.NGUONDUOC_ID and nh.BENHVIEN_ID = 'HLU01'        where d.BENHVIEN_ID = 'HLU01'  and tk.SOLUONG >= 0        end]
2019-09-20 15:44:37,211 [5] DEBUG - Statement Id: [DAO00320_GetList] PreparedStatement : [select M.*            from TM_MAU M            LEFT JOIN TM_MAU_DONVITINH DVT on M.DONVITINH_ID=DVT.DONVITINH_ID            where            M.TAMNGUNG = '0'            and M.BENHVIEN_ID = 'HLU01'            order by M.TENMAU]
2019-09-20 15:44:37,407 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM071']
2019-09-20 15:44:37,667 [5] DEBUG - Statement Id: [DAO00322_GetListMauTonKhoForCreateCached] PreparedStatement : [SELECT DISTINCT          TK.MAU_KEY, TK.KHOMAU_ID, M.MAU_ID, M.MAMAU, M.TENMAU, M.NHOM_ABO, M.NHOM_RH, M.LOAIMAU_ID,          TK.SOLONHAP_ID, SLN.SOLONHAP, SLN.SOKIEMSOAT, TK.NGUONHANG_ID, NG.TENNGUONMAU, M.BENHVIEN_ID, M.DONVITINH_ID,          SUM(tk.SOLUONG) AS SOLUONG,K.TENKHO,DVT.TENDONVITINH          FROM TT_MAU_TONKHO TK          JOIN TM_KHO K ON TK.KHOMAU_ID = K.KHO_ID          JOIN TT_MAU_CHUNGTU_SOLONHAP SLN ON TK.SOLONHAP_ID = SLN.SOLONHAP_ID          JOIN TM_MAU M on TK.MAU_ID = M.MAU_ID and M.TAMNGUNG = '0'          LEFT JOIN TM_MAU_DONVITINH DVT on M.DONVITINH_ID=DVT.DONVITINH_ID          LEFT JOIN TM_NGUONMAU NG ON NG.NGUONMAU_ID = TK.NGUONHANG_ID          WHERE TK.SOLUONG > 0          GROUP BY TK.MAU_KEY, TK.KHOMAU_ID, M.MAU_ID, M.MAMAU, M.TENMAU, M.NHOM_ABO, M.NHOM_RH, M.LOAIMAU_ID,          TK.SOLONHAP_ID, SLN.SOLONHAP, SLN.SOKIEMSOAT,TK.NGUONHANG_ID, NG.TENNGUONMAU, M.BENHVIEN_ID, M.DONVITINH_ID,K.TENKHO,DVT.TENDONVITINH]
2019-09-20 15:44:37,769 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM073']
2019-09-20 15:44:37,811 [5] DEBUG - Statement Id: [DAO00322_GetListMauTonKhoTruBooking] PreparedStatement : [select distinct          TK.MAU_KEY, TK.KHOMAU_ID, M.MAU_ID, M.MAMAU, M.TENMAU, M.NHOM_ABO, M.NHOM_RH, M.LOAIMAU_ID, M.DONVITINH_ID,          TK.SOLONHAP_ID, TK.SOLONHAP, TK.SOKIEMSOAT,M.PHAMVI, TK.NGUONHANG_ID, NG.TENNGUONMAU, M.BENHVIEN_ID,          TK.SOLUONG,TK.TENKHO,DVT.TENDONVITINH          from TM_MAU M          JOIN          (          select          A.MAU_KEY, A.KHOMAU_ID, A.MAU_ID ,a.NGUONHANG_ID, A.SOLONHAP_ID, A.SOLONHAP, A.SOKIEMSOAT, A.SOLUONG,A.TENKHO          from          (          select KHOMAU_ID, TK.MAU_ID, TK.NGUONHANG_ID, TK.MAU_KEY, SLN.SOLONHAP_ID, SLN.SOLONHAP, SLN.SOKIEMSOAT, ISNULL(TK.SOLUONG,0) - ISNULL(book.SOLUONG,0) as SOLUONG,K.TENKHO          from TT_MAU_TONKHO TK          JOIN TM_KHO K ON TK.KHOMAU_ID = K.KHO_ID          inner join TT_MAU_CHUNGTU_SOLONHAP SLN ON TK.SOLONHAP_ID = SLN.SOLONHAP_ID          left join dbo.TT_MAU_TONKHO_BOOK book ON book.MAU_KEY = TK.MAU_KEY AND book.TRANGTHAI = 'HIEULUC'          where ISNULL(TK.SOLUONG,0) - ISNULL(book.SOLUONG,0) > 0          ) A          )TK on TK.MAU_ID = M.MAU_ID and M.TAMNGUNG = '0'          LEFT JOIN TM_MAU_DONVITINH DVT on M.DONVITINH_ID=DVT.DONVITINH_ID          LEFT JOIN TM_NGUONMAU NG ON NG.NGUONMAU_ID = TK.NGUONHANG_ID]
2019-09-20 15:44:37,898 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM072']
2019-09-20 15:44:38,841 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'MAIN'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2019-09-20 15:44:40,143 [1] DEBUG - Statement Id: [DAO00002_FormList] PreparedStatement : [select              TM_SYS_FORM.HOSPITAL_ID,              TM_SYS_FORM.NAME,              TM_SYS_FORM.CLASS,              TM_SYS_FORM.ASSEMBLY,              TM_SYS_FORM.TITLE_VI as TITLE              from TM_SYS_FORM              where HOSPITAL_ID = 'HLU01']
2019-09-20 15:44:45,304 [1] DEBUG - Statement Id: [DAO00300_GetShortcutListByUserID] PreparedStatement : [SELECT S.SHORTCUT_CODE, S.SHORTCUT_VALUE              FROM TM_SHORTCUT AS S              WHERE S.BENHVIEN_ID = 'HLU01' AND S.USER_ID = '1' AND TAMNGUNG = '0']
2019-09-20 15:44:45,377 [1] DEBUG - Statement Id: [DAO00087_GetList] PreparedStatement : [select CODE, VALUE, BENHVIEN_ID              from TM_SYS_APPSETTINGS              where LOCKED = '0' and BENHVIEN_ID = 'HLU01'              order by SETTING_ID]
2019-09-20 15:44:45,484 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'MSG01'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2019-09-20 15:44:45,635 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'MSG02'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2019-09-20 15:44:47,218 [1] DEBUG - Statement Id: [DAO00008_GetUserSettings] PreparedStatement : [select A.*, B.TENKHO , C.TENPHONGBAN, B.MAKHO, C.MAPHONGBAN          from TM_SYS_USERS A          left join TM_KHODUOC B on B.KHODUOC_ID = A.INVENTORY_ID          left join TM_PHONGBAN C on (C.PHONGBAN_ID = A.WORKING_DEPT_ID and C.BENHVIEN_ID =  @param0 )          left join TM_SYS_USERKHO D on (D.ACCOUNT_ID = A.ACCOUNT_ID and D.HOSPITAL_ID =  @param0 )          where          A.HOSPITAL_ID =  @param0            and                 A.ACCOUNT_ID =  @param1]
2019-09-20 15:44:47,221 [1] DEBUG - Statement Id: [DAO00008_GetUserSettings] Parameters: [@param0=[HOSPITAL_ID,HLU01], @param1=[ACCOUNT_ID,113]]
2019-09-20 15:44:47,222 [1] DEBUG - Statement Id: [DAO00008_GetUserSettings] Types: [@param0=[String, System.String], @param1=[String, System.String]]
2019-09-20 15:44:47,270 [1] DEBUG - Statement Id: [DAO00008_GetUserInvSettings] PreparedStatement : [select A.*, B.TENKHO, B.MAKHO, B.LOAIKHO_ID, B.KHOQUANLY_ID          from TM_SYS_USERKHO A          left join TM_KHO B on B.MODULE_ID = A.MODULE_ID and B.KHO_ID = A.KHO_ID          where A.HOSPITAL_ID =  @param0  and A.ACCOUNT_ID =  @param1           order by B.TENKHO]
2019-09-20 15:44:47,270 [1] DEBUG - Statement Id: [DAO00008_GetUserInvSettings] Parameters: [@param0=[HOSPITAL_ID,HLU01], @param1=[ACCOUNT_ID,113]]
2019-09-20 15:44:47,270 [1] DEBUG - Statement Id: [DAO00008_GetUserInvSettings] Types: [@param0=[String, System.String], @param1=[String, System.String]]
2019-09-20 15:44:47,433 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'COM30'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2019-09-20 15:44:48,116 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'RIS04'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2019-09-20 15:44:56,331 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'MENU1'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2019-09-20 15:44:56,560 [1] DEBUG - Statement Id: [DAO00011_GetList] PreparedStatement : [select              TM_SYS_MENU.ID,              TM_SYS_MENU.PARENTID,              TM_SYS_MENU.SCREEN,              TM_SYS_MENU.SMALLIMAGE,              TM_SYS_MENU.LARGEIMAGE,              TM_SYS_MENU.DESCRIPTION,              TM_SYS_MENU.TYPE,              TM_SYS_MENU.TITLE_VI as TITLE              from TM_SYS_MENU              where TM_SYS_MENU.HOSPITAL_ID = 'HLU01' and TM_SYS_MENU.ACTIVE = '1'               AND                   (TM_SYS_MENU.TYPE & '8' = '8')                             order by TM_SYS_MENU.ORDERNUM]
2019-09-20 15:44:57,082 [1] DEBUG - Statement Id: [DAO00011_usermenu_list] PreparedStatement : [select              TM_SYS_HOMEMENU.MENUID as ID,              TM_SYS_MENU.TITLE_VI as TITLE,              TM_SYS_MENU.SCREEN,              TM_SYS_MENU.SMALLIMAGE,              TM_SYS_MENU.LARGEIMAGE,              TM_SYS_MENU.TYPE              from TM_SYS_HOMEMENU              left join TM_SYS_MENU on TM_SYS_MENU.ID = TM_SYS_HOMEMENU.MENUID and TM_SYS_MENU.HOSPITAL_ID = TM_SYS_HOMEMENU.HOSPITAL_ID              where TM_SYS_HOMEMENU.HOSPITAL_ID = 'HLU01' and TM_SYS_HOMEMENU.USERID = '113' and TM_SYS_MENU.ACTIVE = '1'               AND                   (TM_SYS_MENU.TYPE & '8' = '8')                             ORDER BY TM_SYS_HOMEMENU.ORDERNUM]
2019-09-20 15:45:02,154 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'COM98'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2019-09-20 15:45:02,874 [1] DEBUG - Statement Id: [DAO00020_ListKhoDuocOfPhongBan] PreparedStatement : [select B.* from TM_PHONGBAN_KHODUOC A        inner join TM_KHODUOC B on B.KHODUOC_ID = A.KHODUOC_ID        where        A.PHONGBAN_ID = '25'        and A.BENHVIEN_ID = 'HLU01']
2019-09-20 15:45:09,935 [1] DEBUG - Statement Id: [DAO00020_ListKhoDuocOfPhongBan] PreparedStatement : [select B.* from TM_PHONGBAN_KHODUOC A        inner join TM_KHODUOC B on B.KHODUOC_ID = A.KHODUOC_ID        where        A.PHONGBAN_ID = '58'        and A.BENHVIEN_ID = 'HLU01']
2019-09-20 15:45:10,086 [1] DEBUG - Statement Id: [DAO00008_UpdateUserIdPhongBanKhoDuoc] PreparedStatement : [IF EXISTS            (SELECT ACCOUNT_ID FROM TM_SYS_USERS WHERE ACCOUNT_ID =  @param0  and HOSPITAL_ID =  @param1 )            BEGIN            update TM_SYS_USERS set INVENTORY_ID =  @param2 , WORKING_DEPT_ID =  @param3             WHERE ACCOUNT_ID =  @param0  and HOSPITAL_ID =  @param1             END            ELSE            BEGIN            insert into TM_SYS_USERS ([ACCOUNT_ID], [ACCOUNT_NAME], [INVENTORY_ID], [WORKING_DEPT_ID], [HOSPITAL_ID])            values ( @param0 ,  @param4 ,  @param2 ,  @param3 ,  @param1 )            END]
2019-09-20 15:45:10,087 [1] DEBUG - Statement Id: [DAO00008_UpdateUserIdPhongBanKhoDuoc] Parameters: [@param0=[ACCOUNT_ID,113], @param1=[HOSPITAL_ID,HLU01], @param2=[INVENTORY_ID,null], @param3=[WORKING_DEPT_ID,58], @param4=[ACCOUNT_NAME,admin]]
2019-09-20 15:45:10,087 [1] DEBUG - Statement Id: [DAO00008_UpdateUserIdPhongBanKhoDuoc] Types: [@param0=[String, System.String], @param1=[String, System.String], @param2=[System.DBNull, null], @param3=[String, System.String], @param4=[String, System.String]]
2019-09-20 15:45:12,023 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'REG14'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2019-09-20 15:45:13,571 [1] DEBUG - Statement Id: [DAO00012_GetList] PreparedStatement : [select        DICTIONARY_ID,        DICTIONARY_CODE,        DICTIONARY_NAME,        ATTRIBUTE1,        ATTRIBUTE2,        DICTIONARY_NAME_EN        from LST_DICTIONARY        where LST_DICTIONARY.Enabled = '1'         AND           LST_DICTIONARY.DICTIONARY_TYPE_CODE = 'PhanLoaiTiepNhan'                 order by LST_DICTIONARY.IDX]
2019-09-20 15:45:13,640 [1] DEBUG - Statement Id: [DAO00012_GetList] PreparedStatement : [select        DICTIONARY_ID,        DICTIONARY_CODE,        DICTIONARY_NAME,        ATTRIBUTE1,        ATTRIBUTE2,        DICTIONARY_NAME_EN        from LST_DICTIONARY        where LST_DICTIONARY.Enabled = '1'         AND           LST_DICTIONARY.DICTIONARY_TYPE_CODE = 'NguonBN'                 order by LST_DICTIONARY.IDX]
2019-09-20 15:45:13,673 [1] DEBUG - Statement Id: [DAO00019_GetListCongTyChiTra] PreparedStatement : [select *        from TM_CONGTYCHITRA        where        BENHVIEN_ID = 'HLU01' AND TAMNGUNG = '0']
2019-09-20 15:45:13,907 [1] DEBUG - Statement Id: [DAO00017_GetListPhongKham] PreparedStatement : [select pb.PHONGBAN_ID, pb.TENPHONGBAN, case when dv.ATTRIBUTE5 is null then 'TT' else 'KTC' end as LOAI_CHIPHI              from [TM_PHONGBAN_DICHVU] as pb_dv              inner join [TM_PHONGBAN] as pb on pb.PHONGBAN_ID = pb_dv.PHONGBAN_ID and pb.BENHVIEN_ID = 'HLU01'              inner join [TM_DICHVU] dv on dv.DICHVU_ID = pb_dv.DICHVU_ID and dv.MADICHVU = '' and dv.BENHVIEN_ID = 'HLU01'              where pb_dv.BENHVIEN_ID = 'HLU01']
2019-09-20 15:45:13,988 [1] DEBUG - Statement Id: [DAO00019_GetListPhongKham_REG13] PreparedStatement : [select pb.PHONGBAN_ID, pb.TENPHONGBAN, case when dv.ATTRIBUTE5 is null then 'TT' else 'KTC' end as LOAI_CHIPHI        from TM_PHONGBAN pb        left join TM_PHONGBAN_DICHVU pb_dv on pb_dv.PHONGBAN_ID = pb.PHONGBAN_ID and pb_dv.BENHVIEN_ID = pb.BENHVIEN_ID        left join TM_DICHVU dv on dv.DICHVU_ID = pb_dv.DICHVU_ID and dv.BENHVIEN_ID = pb_dv.BENHVIEN_ID        left join TM_NHOMDICHVU ndv on ndv.NHOMDICHVU_ID = dv.NHOMDICHVU_ID and ndv.BENHVIEN_ID = dv.BENHVIEN_ID        where pb.BENHVIEN_ID = 'HLU01' and ndv.MANHOMDICHVU = '04' and dv.DICHVU_ID IS NOT NULL]
2019-09-20 15:45:14,095 [1] DEBUG - Statement Id: [DAO00019_LayThongTinSoluongDichVuPhongKham_REG13] PreparedStatement : [select PHONGBAN_ID, TENPHONGBAN, NOITHUCHIEN_ID, SUM(CHUAKETQUA) AS CHUAKETQUA, SUM(HOANTAT) AS HOANTAT, SUM(DANGTHUCHIEN) AS DANGTHUCHIEN        from (        select B.PHONGBAN_ID, B.TENPHONGBAN, A.NOITHUCHIEN_ID,        case when A.TRANGTHAI = 'CHUAKETQUA' then 1 else 0 end AS CHUAKETQUA,        case when A.TRANGTHAI = 'HOANTAT' then 1 else 0 end AS HOANTAT,        case when A.TRANGTHAI = 'DANGTHUCHIEN' then 1 else 0 end AS DANGTHUCHIEN        from TM_PHONGBAN B        left join TT_DVYEUCAU A on A.NOITHUCHIEN_ID = B.PHONGBAN_ID and A.BENHVIEN_ID = B.BENHVIEN_ID and A.NGAYYEUCAU = CONVERT(date, getdate())        left join TM_DICHVU dv on A.DICHVU_ID = dv.DICHVU_ID        left join TM_NHOMDICHVU ndv on ndv.NHOMDICHVU_ID = dv.NHOMDICHVU_ID        where B.BENHVIEN_ID ='HLU01' and Left(ndv.MANHOMDICHVU,2) = '04'        and B.PHONGBAN_ID in (65,71,72,41,68,62,177,67,55,81,57,57,58,59,60,63,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,61,69,69,70,70)        ) tmp        group by tmp.NOITHUCHIEN_ID, tmp.TENPHONGBAN, tmp.PHONGBAN_ID]
2019-09-20 15:45:32,143 [1] DEBUG - Statement Id: [DAO00087_GetServiceParams] PreparedStatement : [select CODE, VALUE              from TM_SYS_APPSETTINGS              where LOCKED = '0' and BENHVIEN_ID = 'HLU01']
2019-09-20 15:45:32,242 [1] DEBUG - Statement Id: [DAO00095_GetDetailTrungBN] PreparedStatement : [select  TT_TIEPNHAN.NGAYTIEPNHAN AS NGAYTIEPNHAN ,TT_TIEPNHAN.SOBHYT AS SOTHE, TT_BENHNHAN.*, ISNULL(TT_BENHNHAN.NGAYSINH,TT_BENHNHAN.NAMSINH) AS NGAYNAMSINH          from TT_BENHNHAN          left join TT_TIEPNHAN  ON          TT_TIEPNHAN.TIEPNHAN_ID = (SELECT TOP 1 TIEPNHAN_ID FROM TT_TIEPNHAN WHERE BENHNHAN_ID = TT_BENHNHAN.BENHNHAN_ID ORDER BY THOIGIANTIEPNHAN DESC)           WHERE                TT_BENHNHAN.TENBENHNHAN = N'Test Xn1'             AND               convert(varchar(10),TT_BENHNHAN.NGAYSINH, 103) = convert(varchar(10),'10/05/1996', 103)               AND               TT_BENHNHAN.GIOITINH = '1']
2019-09-20 15:45:48,114 [1] DEBUG - Statement Id: [DAO00000_GetKyHieuBHYT] PreparedStatement : [select * from TM_DOITUONG where NHOMTHE LIKE '%' +  @param0  + '%']
2019-09-20 15:45:48,115 [1] DEBUG - Statement Id: [DAO00000_GetKyHieuBHYT] Parameters: [@param0=[MATHEBHYT,DN4]]
2019-09-20 15:45:48,115 [1] DEBUG - Statement Id: [DAO00000_GetKyHieuBHYT] Types: [@param0=[String, System.String]]
2019-09-20 15:45:48,290 [1] DEBUG - Statement Id: [DAO00013_GetDetail] PreparedStatement : [select distinct TT_BENHNHAN.*, ISNULL(TT_BENHNHAN.NGAYSINH,TT_BENHNHAN.NAMSINH) AS NGAYNAMSINH            from TT_BENHNHAN            left join TT_BENHNHAN_BHYT on TT_BENHNHAN_BHYT.BENHNHAN_BHYT_ID = (SELECT TOP 1 BENHNHAN_BHYT_ID FROM TT_BENHNHAN_BHYT WHERE BENHNHAN_ID = TT_BENHNHAN.BENHNHAN_ID ORDER BY BENHNHAN_BHYT_ID DESC)                       WHERE                      TT_BENHNHAN_BHYT.SOTHE = 'DN453534653452338289']
2019-09-20 15:45:58,607 [1] DEBUG - Statement Id: [DAO00019_GetLoaiGiaLoaiKhachHang] PreparedStatement : [select A.*, B.DICTIONARY_CODE MAKHACHHANG, C.TENLOAIGIA        from TM_NGUONKHACHHANG_LOAIGIA A        left join LST_DICTIONARY B on A.NGUONKHACHHANG_BENHNHAN_ID = B.DICTIONARY_ID        inner join TM_LOAIGIA C on C.LOAIGIA_ID = A.LOAIGIA_ID and CAPTREN_ID  = (select LOAIGIA_ID from TM_LOAIGIA where MALOAIGIA = 'GiaDichVu')        left join TM_DICHVU_DONGIA dvdg on dvdg.LOAIGIA_ID = A.LOAIGIA_ID        where B.DICTIONARY_TYPE_CODE = 'NguonKhachHang' and dvdg.DICHVU_ID  =  @param0]
2019-09-20 15:45:58,608 [1] DEBUG - Statement Id: [DAO00019_GetLoaiGiaLoaiKhachHang] Parameters: [@param0=[DICHVU_ID,5685]]
2019-09-20 15:45:58,608 [1] DEBUG - Statement Id: [DAO00019_GetLoaiGiaLoaiKhachHang] Types: [@param0=[Int64, System.Int64]]
2019-09-20 15:45:58,653 [1] DEBUG - Statement Id: [DAO00017_GetLoaiGiaDoiTuongDichVu] PreparedStatement : [select a.LOAIGIA_ID, a.TENLOAIGIA, a.MALOAIGIA, a.CAPTREN_ID, MIN(a.UUTIEN_NGUON) AS UUTIEN_NGUON          , MAX(a.DOUUTIEN) AS DOUUTIEN, MIN(ISNULL(a.GIAHOTRO,0)) AS GIAHOTRO          from(                        select distinct A.LOAIGIA_ID, C.TENLOAIGIA, C.MALOAIGIA, 0 as UUTIEN_NGUON, isnull(B.DOUUTIEN,0) as DOUUTIEN, B.GIAHOTRO, C.CAPTREN_ID            from TM_DOITUONG_GIADICHVU A            left join TM_DOITUONG_LOAIGIA B on A.LOAIGIA_ID = B.LOAIGIA_ID and A.DOITUONG_ID = B.DOITUONG_ID and B.BENHVIEN_ID = 'HLU01'            inner join TM_LOAIGIA C on A.LOAIGIA_ID = C.LOAIGIA_ID and C.BENHVIEN_ID = 'HLU01'            where A.DOITUONG_ID = '4'                            and A.DICHVU_ID = '5685'                         and A.BENHVIEN_ID = 'HLU01'                     ) a          where a.DOUUTIEN != 0 and a.DOUUTIEN is not null          group by a.LOAIGIA_ID, a.TENLOAIGIA, a.MALOAIGIA, a.CAPTREN_ID          order by MAX(a.UUTIEN_NGUON) desc ,MAX(a.DOUUTIEN) asc]
2019-09-20 15:45:58,787 [1] DEBUG - Statement Id: [DAO00017_GetListPhongKham] PreparedStatement : [select pb.PHONGBAN_ID, pb.TENPHONGBAN, case when dv.ATTRIBUTE5 is null then 'TT' else 'KTC' end as LOAI_CHIPHI              from [TM_PHONGBAN_DICHVU] as pb_dv              inner join [TM_PHONGBAN] as pb on pb.PHONGBAN_ID = pb_dv.PHONGBAN_ID and pb.BENHVIEN_ID = 'HLU01'              inner join [TM_DICHVU] dv on dv.DICHVU_ID = pb_dv.DICHVU_ID and dv.MADICHVU = '5600' and dv.BENHVIEN_ID = 'HLU01'              where pb_dv.BENHVIEN_ID = 'HLU01']
2019-09-20 15:45:58,848 [1] DEBUG - Statement Id: [DAO00019_GetListPhongKham_REG13] PreparedStatement : [select pb.PHONGBAN_ID, pb.TENPHONGBAN, case when dv.ATTRIBUTE5 is null then 'TT' else 'KTC' end as LOAI_CHIPHI        from TM_PHONGBAN pb        left join TM_PHONGBAN_DICHVU pb_dv on pb_dv.PHONGBAN_ID = pb.PHONGBAN_ID and pb_dv.BENHVIEN_ID = pb.BENHVIEN_ID        left join TM_DICHVU dv on dv.DICHVU_ID = pb_dv.DICHVU_ID and dv.BENHVIEN_ID = pb_dv.BENHVIEN_ID        left join TM_NHOMDICHVU ndv on ndv.NHOMDICHVU_ID = dv.NHOMDICHVU_ID and ndv.BENHVIEN_ID = dv.BENHVIEN_ID        where pb.BENHVIEN_ID = 'HLU01' and ndv.MANHOMDICHVU = '04' and dv.DICHVU_ID IS NOT NULL]
2019-09-20 15:45:58,924 [1] DEBUG - Statement Id: [DAO00019_LayThongTinSoluongDichVuPhongKham_REG13] PreparedStatement : [select PHONGBAN_ID, TENPHONGBAN, NOITHUCHIEN_ID, SUM(CHUAKETQUA) AS CHUAKETQUA, SUM(HOANTAT) AS HOANTAT, SUM(DANGTHUCHIEN) AS DANGTHUCHIEN        from (        select B.PHONGBAN_ID, B.TENPHONGBAN, A.NOITHUCHIEN_ID,        case when A.TRANGTHAI = 'CHUAKETQUA' then 1 else 0 end AS CHUAKETQUA,        case when A.TRANGTHAI = 'HOANTAT' then 1 else 0 end AS HOANTAT,        case when A.TRANGTHAI = 'DANGTHUCHIEN' then 1 else 0 end AS DANGTHUCHIEN        from TM_PHONGBAN B        left join TT_DVYEUCAU A on A.NOITHUCHIEN_ID = B.PHONGBAN_ID and A.BENHVIEN_ID = B.BENHVIEN_ID and A.NGAYYEUCAU = CONVERT(date, getdate())        left join TM_DICHVU dv on A.DICHVU_ID = dv.DICHVU_ID        left join TM_NHOMDICHVU ndv on ndv.NHOMDICHVU_ID = dv.NHOMDICHVU_ID        where B.BENHVIEN_ID ='HLU01' and Left(ndv.MANHOMDICHVU,2) = '04'        and B.PHONGBAN_ID in (65,71,72,41,68,62,177,67,55,81,57,57,58,59,60,63,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,61,69,69,70,70)        ) tmp        group by tmp.NOITHUCHIEN_ID, tmp.TENPHONGBAN, tmp.PHONGBAN_ID]
2019-09-20 15:45:59,070 [1] DEBUG - Statement Id: [DAO00000_GetDICHVU_DONGIA_LOAIGIA] PreparedStatement : [select A.LOAIGIA_ID, A.BANGGIA_ID, A.GIAVON, A.TYLEVAT  as TYLE_VAT, A.TYLE_LOINHUAN,            A.DONGIA as DONGIA_DOANHTHU, NULL as DONGIA_KHAC, isnull(D.MAPHANNHOMDICHVU, 'TT') as LOAI_CHIPHI            from TM_DICHVU_DONGIA A            inner join TM_BANGGIA B on B.LOAIGIA_ID = A.LOAIGIA_ID AND B.BENHVIEN_ID = 'HLU01'            left join (select B.MAPHANNHOMDICHVU, A.* from TM_DICHVU_PHANNHOMDICHVU A            inner join TM_PHANNHOMDICHVU B on  B.PHANNHOMDICHVU_ID = A.PHANNHOMDICHVU_ID            where A.DICHVU_ID = '5685' AND A.BENHVIEN_ID = 'HLU01') D on A.DICHVU_ID = D.DICHVU_ID            where A.LOAIGIA_ID = '2' and A.DICHVU_ID = '5685'            union            select A.LOAIGIA_ID, null as BANGGIA_ID, null as GIAVON, null as TYLE_VAT, null as TYLE_LOINHUAN,            null as DONGIA_DOANHTHU, C.DONGIA as DONGIA_KHAC, isnull(D.MAPHANNHOMDICHVU, 'TT') as LOAI_CHIPHI            from TM_DOITUONG_GIADICHVU A            inner join TM_BANGGIA B on B.LOAIGIA_ID = A.LOAIGIA_ID AND B.BENHVIEN_ID = 'HLU01'            left join TM_DICHVU_DONGIA C on C.LOAIGIA_ID = A.LOAIGIA_ID AND C.BENHVIEN_ID = 'HLU01'            and C.BANGGIA_ID = B.BANGGIA_ID and C.DICHVU_ID = A.DICHVU_ID            left join (select B.MAPHANNHOMDICHVU, A.* from TM_DICHVU_PHANNHOMDICHVU A            inner join TM_PHANNHOMDICHVU B on  B.PHANNHOMDICHVU_ID = A.PHANNHOMDICHVU_ID            where A.DICHVU_ID = '5685' AND A.BENHVIEN_ID = 'HLU01') D on A.DICHVU_ID = D.DICHVU_ID            where A.DOITUONG_ID = '4'  and A.DICHVU_ID = '5685' and A.LOAIGIA_ID            in (select top 1 LOAIGIA_ID from TM_DOITUONG_LOAIGIA            where DOITUONG_ID = '4' and GIAHOTRO = '1'  AND BENHVIEN_ID = 'HLU01'            and LOAIGIA_ID            in (select LOAIGIA_ID from TM_BANGGIA            where LOAIBANGGIA in            (select LOAIBANGGIA from TM_BANGGIA where LOAIGIA_ID = '2'  AND BENHVIEN_ID = 'HLU01')            and TAMNGUNG = '0')  AND BENHVIEN_ID = 'HLU01'            )]
2019-09-20 15:45:59,193 [1] DEBUG - Statement Id: [DAO00024_TM_TIEPNHAN_BANGGIA_DICHVU_getlist] PreparedStatement : [select * from TM_TIEPNHAN_BANGGIA_DICHVU where TAMNGUNG != '1' and BENHVIEN_ID = 'HLU01']
2019-09-20 15:46:01,245 [1] DEBUG - Statement Id: [DAO00000_GetKyHieuBHYT] PreparedStatement : [select * from TM_DOITUONG where NHOMTHE LIKE '%' +  @param0  + '%']
2019-09-20 15:46:01,246 [1] DEBUG - Statement Id: [DAO00000_GetKyHieuBHYT] Parameters: [@param0=[MATHEBHYT,DN4]]
2019-09-20 15:46:01,246 [1] DEBUG - Statement Id: [DAO00000_GetKyHieuBHYT] Types: [@param0=[String, System.String]]
2019-09-20 15:46:03,264 [1] DEBUG - Statement Id: [DAO00013_Add_BenhNhan] PreparedStatement : [declare @keyValue int, @BenhVienId varchar(10), @yearNow int, @Mayte varchar(20), @SoVaoVien varchar(20), @fid varchar(20),            @Bnid int, @Manoisinh varchar(10), @Namsinh int, @Ngaysinh smalldatetime, @Gioitinh int, @Thangsinh int, @Daysinh int, @beginpatient int            declare @InsertedRows TABLE (BENHNHAN_ID INT, MAYTE varchar(20), MANOISINH varchar(10), NAMSINH int, NGAYSINH smalldatetime, GIOITINH int )            set @keyValue = 0;            set @Thangsinh = 0;            set @Daysinh = 0;            set @beginpatient = 0;            set @fid = 'F';            set @BenhVienId = 'HLU01'            set @yearNow = YEAR(getdate())                        select @beginpatient = isnull(VALUE, 0) from TM_SYS_APPSETTINGS where CODE = 'COM_FIRST_NUMBER_PATIENTCODE_INTHEYEAR'              select @keyValue = KEYVALUE from LST_KEYDATA            where KEYTYPE = 'MAYTE' and KEYYEAR = @yearNow                        if @keyValue = 0            Insert into LST_KEYDATA values ('MAYTE', @yearNow, '0', '0', '0', '0', '0', @beginpatient, @BenhVienId);            Update LST_KEYDATA set KEYVALUE = KEYVALUE + 1, @keyValue = (KEYVALUE + 1) where KEYTYPE = 'MAYTE' and KEYYEAR = @yearNow                          set @SoVaoVien = right('0000000'+convert(varchar(7), @keyValue), 7)              set @Mayte = RIGHT(@yearNow, 2) + @SoVaoVien                            insert into TT_BENHNHAN (              MAYTE              , SOVAOVIEN              , TENBENHNHAN              , HO              , TEN              , GIOITINH              , NGAYSINH              , NAMSINH              , MANOISINH              , SONHA              , DIACHI              , SODIENTHOAI              , XAPHUONG_ID              , QUANHUYEN_ID              , TINHTHANH_ID              , DANTOC_ID              , QUOCTICH_ID              , SOLUUTRUNOITRU              , SOLUUTRUNGOAITRU              , NGHENGHIEP_ID              , CMND              , HOCHIEU              , VIETKIEU              , NGUOINUOCNGOAI              , DIACHITHUONGTRU              , DIACHILIENLAC              , DIACHICOQUAN              , EMAIL              , NHOMMAU_ID              , YEUTORH_ID              , TIENSUDIUNG              , TIENSUBENH              , TIENSUHUTTHUOCLA              , TUVONG              , NGAYTUVONG              , THOIGIANTUVONG              , NGUYENNHANTUVONG_ID              , NGUOIGHINHANTUVONG_ID              , THOIGIANGHINHANTUVONG              , NHANVIEN_ID              , DONVICONGTAC_ID              , DIENTHOAIBAN              , TINHTRANGHONNHAN_ID              , NGUOILIENHE_ID              , MOIQUANHE_ID              , NGUOILIENHE              , THONGTIN_NLH              , GHICHU              , HINHANH_DAIDIEN              , SITE_ID              , PID              , ACTIVE              , BENHVIEN_ID              , NGAYTAO              , NGUOITAO_ID              , NGAYGIOSINH              )                            values (              @Mayte              , @SoVaoVien              ,  @param0               ,  @param1               ,  @param2               ,  @param3               ,  @param4               ,  @param5               ,  @param6               ,  @param7               ,  @param8               ,  @param9               ,  @param10               ,  @param11               ,  @param12               ,  @param13               ,  @param14               ,  @param15               ,  @param16               ,  @param17               ,  @param18               ,  @param19               ,  @param20               ,  @param21               ,  @param22               ,  @param23               ,  @param24               ,  @param25               ,  @param26               ,  @param27               ,  @param28               ,  @param29               ,  @param30               ,  @param31               ,  @param32               ,  @param33               ,  @param34               ,  @param35               ,  @param36               ,  @param37               ,  @param38               ,  @param39               ,  @param40               ,  @param41               ,  @param42               ,  @param43               ,  @param44               ,  @param45               ,  @param46               ,  @param47               ,  @param48               , '1'              ,  @param49               ,  @param50               ,  @param51               ,  @param52               );              set @Bnid = SCOPE_IDENTITY()                            select @Manoisinh = MANOISINH, @Namsinh = NAMSINH, @Ngaysinh = NGAYSINH, @Gioitinh = GIOITINH from @InsertedRows;              IF (@Ngaysinh is not Null)              BEGIN              set @Thangsinh = MONTH(@Ngaysinh);              set @Daysinh = DAY(@Ngaysinh);              END              IF (@Manoisinh is Null) set @Manoisinh = '0'              set @fid = right('000'+convert(varchar(3), @Manoisinh), 3) + convert(varchar(1), @Gioitinh) + RIGHT(@Namsinh, 2) + right('00'+convert(varchar(2), @Thangsinh), 2) + right('00'+convert(varchar(2), @Daysinh), 2) + right('000000000'+convert(varchar(9), @Bnid), 9) + convert(varchar(1), 'F');                            update TT_BENHNHAN set FID = @fid where BENHNHAN_ID = @Bnid;                          select @Bnid]
2019-09-20 15:46:03,265 [1] DEBUG - Statement Id: [DAO00013_Add_BenhNhan] Parameters: [@param0=[TENBENHNHAN,Test Xn1], @param1=[HO,Test], @param2=[TEN,Xn1], @param3=[GIOITINH,1], @param4=[NGAYSINH,5/10/1996 12:00:00 AM], @param5=[NAMSINH,1996], @param6=[MANOISINH,null], @param7=[SONHA,null], @param8=[DIACHI,null], @param9=[SODIENTHOAI,null], @param10=[XAPHUONG_ID,16432], @param11=[QUANHUYEN_ID,null], @param12=[TINHTHANH_ID,null], @param13=[DANTOC_ID,332], @param14=[QUOCTICH_ID,291], @param15=[SOLUUTRUNOITRU,null], @param16=[SOLUUTRUNGOAITRU,null], @param17=[NGHENGHIEP_ID,null], @param18=[CMND,null], @param19=[HOCHIEU,null], @param20=[VIETKIEU,null], @param21=[NGUOINUOCNGOAI,null], @param22=[DIACHITHUONGTRU,Xã Đông Tân, Thành phố Thanh Hóa, Tỉnh Thanh Hóa], @param23=[DIACHILIENLAC,Xã Đông Tân, Thành phố Thanh Hóa, Tỉnh Thanh Hóa], @param24=[DIACHICOQUAN,null], @param25=[EMAIL,null], @param26=[NHOMMAU_ID,null], @param27=[YEUTORH_ID,null], @param28=[TIENSUDIUNG,null], @param29=[TIENSUBENH,null], @param30=[TIENSUHUTTHUOCLA,null], @param31=[TUVONG,null], @param32=[NGAYTUVONG,null], @param33=[THOIGIANTUVONG,null], @param34=[NGUYENNHANTUVONG_ID,null], @param35=[NGUOIGHINHANTUVONG_ID,null], @param36=[THOIGIANGHINHANTUVONG,null], @param37=[NHANVIEN_ID,null], @param38=[DONVICONGTAC_ID,null], @param39=[DIENTHOAIBAN,null], @param40=[TINHTRANGHONNHAN_ID,null], @param41=[NGUOILIENHE_ID,null], @param42=[MOIQUANHE_ID,null], @param43=[NGUOILIENHE,null], @param44=[THONGTIN_NLH,null], @param45=[GHICHU,null], @param46=[HINHANH_DAIDIEN,imgMale.png], @param47=[SITE_ID,HLU01], @param48=[PID,null], @param49=[BENHVIEN_ID,HLU01], @param50=[NGAYTAO,9/20/2019 3:46:03 PM], @param51=[NGUOITAO_ID,1], @param52=[NGAYGIOSINH,null]]
2019-09-20 15:46:03,265 [1] DEBUG - Statement Id: [DAO00013_Add_BenhNhan] Types: [@param0=[String, System.String], @param1=[String, System.String], @param2=[String, System.String], @param3=[Int64, System.Int64], @param4=[DateTime, System.DateTime], @param5=[Int64, System.Int64], @param6=[System.DBNull, null], @param7=[System.DBNull, null], @param8=[System.DBNull, null], @param9=[System.DBNull, null], @param10=[String, System.String], @param11=[System.DBNull, null], @param12=[System.DBNull, null], @param13=[Int64, System.Int64], @param14=[Int64, System.Int64], @param15=[System.DBNull, null], @param16=[System.DBNull, null], @param17=[System.DBNull, null], @param18=[System.DBNull, null], @param19=[System.DBNull, null], @param20=[System.DBNull, null], @param21=[System.DBNull, null], @param22=[String, System.String], @param23=[String, System.String], @param24=[System.DBNull, null], @param25=[System.DBNull, null], @param26=[System.DBNull, null], @param27=[System.DBNull, null], @param28=[System.DBNull, null], @param29=[System.DBNull, null], @param30=[System.DBNull, null], @param31=[System.DBNull, null], @param32=[System.DBNull, null], @param33=[System.DBNull, null], @param34=[System.DBNull, null], @param35=[System.DBNull, null], @param36=[System.DBNull, null], @param37=[System.DBNull, null], @param38=[System.DBNull, null], @param39=[System.DBNull, null], @param40=[System.DBNull, null], @param41=[System.DBNull, null], @param42=[System.DBNull, null], @param43=[System.DBNull, null], @param44=[System.DBNull, null], @param45=[System.DBNull, null], @param46=[String, System.String], @param47=[String, System.String], @param48=[System.DBNull, null], @param49=[String, System.String], @param50=[DateTime, System.DateTime], @param51=[String, System.String], @param52=[System.DBNull, null]]
2019-09-20 15:46:03,393 [1] DEBUG - Statement Id: [DAO00013_GetTTBenhNhan_byBenhNhanId] PreparedStatement : [select *              from TT_BENHNHAN              where BENHNHAN_ID = '23423'              order by BENHNHAN_ID]
2019-09-20 15:46:03,442 [1] DEBUG - Statement Id: [DAO00013_GetBenhNhanToDB] PreparedStatement : [select ROW_NUMBER() OVER(order by a.MAYTE) as ROWNUMBER, *,          CASE          WHEN A.GIOITINH = 1 THEN 'Nam'          WHEN A.GIOITINH = 2 THEN N'Nữ'          END as TENGIOITINH          from TT_BENHNHAN A          where  ACTIVE = '1' and MAYTE = '190043304']
2019-09-20 15:46:04,316 [1] DEBUG - Statement Id: [DAO00013_Add_Update_BHYT] PreparedStatement : [if not exists (select 1              from TT_BENHNHAN_BHYT              where SOTHE = 'DN453534653452338289' and BENHNHAN_ID = '23423')              insert into TT_BENHNHAN_BHYT (              BENHNHAN_ID              , LOAIBHYT              , SOTHE              , NGAYCAP              , NGAYHIEULUC              , NGAYHETHIEULUC              , TINHTHANH_CAPTHE_ID              , BENHVIEN_ID              , BENHVIEN_KCB_ID              , TREN3NAM              , TREN5NAM              , TREN6THANG              , NGAYMIENDONGCHITRA              , TAMNGUNG              , NGAYTAO              , NGUOITAO_ID              , KHUVUCSONG_ID              ) values (               @param0               ,  @param1               ,  @param2               ,  @param3               ,  @param4               ,  @param5               ,  @param6               ,  @param7               ,  @param8               ,  @param9               ,  @param10               ,  @param11               ,  @param12               ,  @param13               ,  @param14               ,  @param15               ,  @param16               )              else              update TT_BENHNHAN_BHYT set              LOAIBHYT =  @param1               , SOTHE =  @param2               , NGAYCAP =  @param3               , NGAYHIEULUC =  @param4               , NGAYHETHIEULUC =  @param5               , TINHTHANH_CAPTHE_ID =  @param6               , BENHVIEN_ID =  @param7               , BENHVIEN_KCB_ID =  @param8               , TREN3NAM =  @param9               , TREN5NAM =  @param10               , TREN6THANG =  @param11               , NGAYMIENDONGCHITRA =  @param12               , TAMNGUNG =  @param13               , NGAYCAPNHAT =  @param17               , NGUOICAPNHAT_ID =  @param18               , KHUVUCSONG_ID =  @param16               where              SOTHE = 'DN453534653452338289' and BENHNHAN_ID = '23423']
2019-09-20 15:46:04,317 [1] DEBUG - Statement Id: [DAO00013_Add_Update_BHYT] Parameters: [@param0=[BENHNHAN_ID,23423], @param1=[LOAIBHYT,null], @param2=[SOTHE,DN453534653452338289], @param3=[NGAYCAP,null], @param4=[NGAYHIEULUC,1/1/2019 12:00:00 AM], @param5=[NGAYHETHIEULUC,12/31/2019 12:00:00 AM], @param6=[TINHTHANH_CAPTHE_ID,null], @param7=[BENHVIEN_ID,HLU01], @param8=[BENHVIEN_KCB_ID,38289], @param9=[TREN3NAM,0], @param10=[TREN5NAM,0], @param11=[TREN6THANG,null], @param12=[NGAYMIENDONGCHITRA,null], @param13=[TAMNGUNG,null], @param14=[NGAYTAO,9/20/2019 3:46:04 PM], @param15=[NGUOITAO_ID,1], @param16=[KHUVUCSONG_ID,null], @param17=[NGAYCAPNHAT,9/20/2019 3:46:04 PM], @param18=[NGUOICAPNHAT_ID,1]]
2019-09-20 15:46:04,317 [1] DEBUG - Statement Id: [DAO00013_Add_Update_BHYT] Types: [@param0=[Int32, System.Int32], @param1=[System.DBNull, null], @param2=[String, System.String], @param3=[System.DBNull, null], @param4=[DateTime, System.DateTime], @param5=[DateTime, System.DateTime], @param6=[System.DBNull, null], @param7=[String, System.String], @param8=[String, System.String], @param9=[String, System.String], @param10=[String, System.String], @param11=[System.DBNull, null], @param12=[System.DBNull, null], @param13=[System.DBNull, null], @param14=[DateTime, System.DateTime], @param15=[String, System.String], @param16=[System.DBNull, null], @param17=[DateTime, System.DateTime], @param18=[String, System.String]]
2019-09-20 15:46:04,378 [1] DEBUG - Statement Id: [DAO00118_Add_BenhNhan] PreparedStatement : [if not exists (select 1 from TT_BENHNHAN where BENHNHAN_ID = '23423')              insert into TT_BENHNHAN (              BENHNHAN_ID              , MAYTE              , SOVAOVIEN              , TENBENHNHAN              , HO              , TEN              , GIOITINH              , NGAYSINH              , NAMSINH              , SONHA              , DIACHI              , SODIENTHOAI              , XAPHUONG_ID              , QUANHUYEN_ID              , TINHTHANH_ID              , DANTOC_ID              , QUOCTICH_ID              , SOLUUTRUNOITRU              , SOLUUTRUNGOAITRU              , NGHENGHIEP_ID              , CMND              , HOCHIEU              , VIETKIEU              , NGUOINUOCNGOAI              , DIACHITHUONGTRU              , DIACHILIENLAC              , DIACHICOQUAN              , EMAIL              , NHOMMAU_ID              , YEUTORH_ID              , TIENSUDIUNG              , TIENSUBENH              , TIENSUHUTTHUOCLA              , TUVONG              , NGAYTUVONG              , THOIGIANTUVONG              , NGUYENNHANTUVONG_ID              , NGUOIGHINHANTUVONG_ID              , THOIGIANGHINHANTUVONG              , NHANVIEN_ID              , DONVICONGTAC_ID              , DIENTHOAIBAN              , TINHTRANGHONNHAN_ID              , NGUOILIENHE_ID              , MOIQUANHE_ID              , NGUOILIENHE              , THONGTIN_NLH              , GHICHU              , HINHANH_DAIDIEN              , BENHVIEN_ID              , NGAYTAO              , NGUOITAO_ID              , NGAYGIOSINH              ) values (               @param0               ,  @param1               ,  @param2               ,  @param3               ,  @param4               ,  @param5               ,  @param6               ,  @param7               ,  @param8               ,  @param9               ,  @param10               ,  @param11               ,  @param12               ,  @param13               ,  @param14               ,  @param15               ,  @param16               ,  @param17               ,  @param18               ,  @param19               ,  @param20               ,  @param21               ,  @param22               ,  @param23               ,  @param24               ,  @param25               ,  @param26               ,  @param27               ,  @param28               ,  @param29               ,  @param30               ,  @param31               ,  @param32               ,  @param33               ,  @param34               ,  @param35               ,  @param36               ,  @param37               ,  @param38               ,  @param39               ,  @param40               ,  @param41               ,  @param42               ,  @param43               ,  @param44               ,  @param45               ,  @param46               ,  @param47               ,  @param48               ,  @param49               ,  @param50               ,  @param51               ,  @param52               )              else              update TT_BENHNHAN set              MAYTE =  @param1                ,                   SOVAOVIEN =  @param2                ,                   TENBENHNHAN =  @param3                ,                   HO =  @param4                ,                   TEN =  @param5                ,                   GIOITINH =  @param6                ,                   NGAYSINH =  @param7                ,                   NAMSINH =  @param8                ,                   SONHA =  @param9                ,                   SODIENTHOAI =  @param11                ,                   XAPHUONG_ID =  @param12                ,                   DANTOC_ID =  @param15                ,                   QUOCTICH_ID =  @param16                ,                   NGHENGHIEP_ID =  @param19                ,                   NGUOINUOCNGOAI =  @param23                ,                   DIACHITHUONGTRU =  @param24                ,                   DIACHILIENLAC =  @param25                ,                   NGUOILIENHE_ID =  @param43                ,                   MOIQUANHE_ID =  @param44                ,                   NGUOILIENHE =  @param45                ,                   THONGTIN_NLH =  @param46                ,                   GHICHU =  @param47                ,                   BENHVIEN_ID =  @param49                ,                   NGUOICAPNHAT_ID =  @param53                              where              BENHNHAN_ID = '23423']
2019-09-20 15:46:04,378 [1] DEBUG - Statement Id: [DAO00118_Add_BenhNhan] Parameters: [@param0=[BENHNHAN_ID,23423], @param1=[MAYTE,190043304], @param2=[SOVAOVIEN,0043304], @param3=[TENBENHNHAN,Test Xn1], @param4=[HO,Test], @param5=[TEN,Xn1], @param6=[GIOITINH,1], @param7=[NGAYSINH,5/10/1996 12:00:00 AM], @param8=[NAMSINH,1996], @param9=[SONHA,null], @param10=[DIACHI,null], @param11=[SODIENTHOAI,null], @param12=[XAPHUONG_ID,16432], @param13=[QUANHUYEN_ID,null], @param14=[TINHTHANH_ID,null], @param15=[DANTOC_ID,332], @param16=[QUOCTICH_ID,291], @param17=[SOLUUTRUNOITRU,null], @param18=[SOLUUTRUNGOAITRU,null], @param19=[NGHENGHIEP_ID,null], @param20=[CMND,null], @param21=[HOCHIEU,null], @param22=[VIETKIEU,null], @param23=[NGUOINUOCNGOAI,null], @param24=[DIACHITHUONGTRU,Xã Đông Tân, Thành phố Thanh Hóa, Tỉnh Thanh Hóa], @param25=[DIACHILIENLAC,Xã Đông Tân, Thành phố Thanh Hóa, Tỉnh Thanh Hóa], @param26=[DIACHICOQUAN,null], @param27=[EMAIL,null], @param28=[NHOMMAU_ID,null], @param29=[YEUTORH_ID,null], @param30=[TIENSUDIUNG,null], @param31=[TIENSUBENH,null], @param32=[TIENSUHUTTHUOCLA,null], @param33=[TUVONG,null], @param34=[NGAYTUVONG,null], @param35=[THOIGIANTUVONG,null], @param36=[NGUYENNHANTUVONG_ID,null], @param37=[NGUOIGHINHANTUVONG_ID,null], @param38=[THOIGIANGHINHANTUVONG,null], @param39=[NHANVIEN_ID,null], @param40=[DONVICONGTAC_ID,null], @param41=[DIENTHOAIBAN,null], @param42=[TINHTRANGHONNHAN_ID,null], @param43=[NGUOILIENHE_ID,null], @param44=[MOIQUANHE_ID,null], @param45=[NGUOILIENHE,null], @param46=[THONGTIN_NLH,null], @param47=[GHICHU,null], @param48=[HINHANH_DAIDIEN,imgMale.png], @param49=[BENHVIEN_ID,HLU01], @param50=[NGAYTAO,null], @param51=[NGUOITAO_ID,1], @param52=[NGAYGIOSINH,null], @param53=[NGUOICAPNHAT_ID,1]]
2019-09-20 15:46:04,378 [1] DEBUG - Statement Id: [DAO00118_Add_BenhNhan] Types: [@param0=[Int32, System.Int32], @param1=[String, System.String], @param2=[String, System.String], @param3=[String, System.String], @param4=[String, System.String], @param5=[String, System.String], @param6=[Int64, System.Int64], @param7=[DateTime, System.DateTime], @param8=[Int64, System.Int64], @param9=[System.DBNull, null], @param10=[System.DBNull, null], @param11=[System.DBNull, null], @param12=[String, System.String], @param13=[System.DBNull, null], @param14=[System.DBNull, null], @param15=[Int64, System.Int64], @param16=[Int64, System.Int64], @param17=[System.DBNull, null], @param18=[System.DBNull, null], @param19=[System.DBNull, null], @param20=[System.DBNull, null], @param21=[System.DBNull, null], @param22=[System.DBNull, null], @param23=[System.DBNull, null], @param24=[String, System.String], @param25=[String, System.String], @param26=[System.DBNull, null], @param27=[System.DBNull, null], @param28=[System.DBNull, null], @param29=[System.DBNull, null], @param30=[System.DBNull, null], @param31=[System.DBNull, null], @param32=[System.DBNull, null], @param33=[System.DBNull, null], @param34=[System.DBNull, null], @param35=[System.DBNull, null], @param36=[System.DBNull, null], @param37=[System.DBNull, null], @param38=[System.DBNull, null], @param39=[System.DBNull, null], @param40=[System.DBNull, null], @param41=[System.DBNull, null], @param42=[System.DBNull, null], @param43=[System.DBNull, null], @param44=[System.DBNull, null], @param45=[System.DBNull, null], @param46=[System.DBNull, null], @param47=[System.DBNull, null], @param48=[String, System.String], @param49=[String, System.String], @param50=[System.DBNull, null], @param51=[String, System.String], @param52=[System.DBNull, null], @param53=[String, System.String]]
2019-09-20 15:46:04,434 [1] DEBUG - Statement Id: [DAO00118_Add_Update_BHYT] PreparedStatement : [if not exists (select 1              from TT_BENHNHAN_BHYT              where SOTHE = 'DN453534653452338289' and BENHNHAN_ID = '23423')              insert into TT_BENHNHAN_BHYT (              BENHNHAN_ID              , LOAIBHYT              , SOTHE              , NGAYCAP              , NGAYHIEULUC              , NGAYHETHIEULUC              , TINHTHANH_CAPTHE_ID              , BENHVIEN_ID              , BENHVIEN_KCB_ID              , TREN3NAM              , TREN5NAM              , TREN6THANG              , NGAYMIENDONGCHITRA              , TAMNGUNG              , NGAYTAO              , NGUOITAO_ID              , KHUVUCSONG_ID              ) values (               @param0               ,  @param1               ,  @param2               ,  @param3               ,  @param4               ,  @param5               ,  @param6               ,  @param7               ,  @param8               ,  @param9               ,  @param10               ,  @param11               ,  @param12               ,  @param13               ,  @param14               ,  @param15               ,  @param16               )              else              update TT_BENHNHAN_BHYT set              LOAIBHYT =  @param1               , SOTHE =  @param2               , NGAYCAP =  @param3               , NGAYHIEULUC =  @param4               , NGAYHETHIEULUC =  @param5               , TINHTHANH_CAPTHE_ID =  @param6               , BENHVIEN_ID =  @param7               , BENHVIEN_KCB_ID =  @param8               , TREN3NAM =  @param9               , TREN5NAM =  @param10               , TREN6THANG =  @param11               , NGAYMIENDONGCHITRA =  @param12               , TAMNGUNG =  @param13               , NGAYCAPNHAT =  @param17               , NGUOICAPNHAT_ID =  @param18               , KHUVUCSONG_ID =  @param16               where              SOTHE = 'DN453534653452338289' and BENHNHAN_ID = '23423']
2019-09-20 15:46:04,434 [1] DEBUG - Statement Id: [DAO00118_Add_Update_BHYT] Parameters: [@param0=[BENHNHAN_ID,23423], @param1=[LOAIBHYT,null], @param2=[SOTHE,DN453534653452338289], @param3=[NGAYCAP,null], @param4=[NGAYHIEULUC,1/1/2019 12:00:00 AM], @param5=[NGAYHETHIEULUC,12/31/2019 12:00:00 AM], @param6=[TINHTHANH_CAPTHE_ID,null], @param7=[BENHVIEN_ID,HLU01], @param8=[BENHVIEN_KCB_ID,38289], @param9=[TREN3NAM,False], @param10=[TREN5NAM,False], @param11=[TREN6THANG,null], @param12=[NGAYMIENDONGCHITRA,null], @param13=[TAMNGUNG,null], @param14=[NGAYTAO,9/20/2019 3:46:04 PM], @param15=[NGUOITAO_ID,1], @param16=[KHUVUCSONG_ID,null], @param17=[NGAYCAPNHAT,9/20/2019 3:46:04 PM], @param18=[NGUOICAPNHAT_ID,1]]
2019-09-20 15:46:04,434 [1] DEBUG - Statement Id: [DAO00118_Add_Update_BHYT] Types: [@param0=[Int32, System.Int32], @param1=[System.DBNull, null], @param2=[String, System.String], @param3=[System.DBNull, null], @param4=[DateTime, System.DateTime], @param5=[DateTime, System.DateTime], @param6=[System.DBNull, null], @param7=[String, System.String], @param8=[String, System.String], @param9=[Boolean, System.Boolean], @param10=[Boolean, System.Boolean], @param11=[System.DBNull, null], @param12=[System.DBNull, null], @param13=[System.DBNull, null], @param14=[DateTime, System.DateTime], @param15=[String, System.String], @param16=[System.DBNull, null], @param17=[DateTime, System.DateTime], @param18=[String, System.String]]
2019-09-20 15:46:04,504 [1] DEBUG - Statement Id: [DAO00013_Add_Update_BHYT] PreparedStatement : [if not exists (select 1              from TT_BENHNHAN_BHYT              where SOTHE = 'DN453534653452338289' and BENHNHAN_ID = '23423')              insert into TT_BENHNHAN_BHYT (              BENHNHAN_ID              , LOAIBHYT              , SOTHE              , NGAYCAP              , NGAYHIEULUC              , NGAYHETHIEULUC              , TINHTHANH_CAPTHE_ID              , BENHVIEN_ID              , BENHVIEN_KCB_ID              , TREN3NAM              , TREN5NAM              , TREN6THANG              , NGAYMIENDONGCHITRA              , TAMNGUNG              , NGAYTAO              , NGUOITAO_ID              , KHUVUCSONG_ID              ) values (               @param0               ,  @param1               ,  @param2               ,  @param3               ,  @param4               ,  @param5               ,  @param6               ,  @param7               ,  @param8               ,  @param9               ,  @param10               ,  @param11               ,  @param12               ,  @param13               ,  @param14               ,  @param15               ,  @param16               )              else              update TT_BENHNHAN_BHYT set              LOAIBHYT =  @param1               , SOTHE =  @param2               , NGAYCAP =  @param3               , NGAYHIEULUC =  @param4               , NGAYHETHIEULUC =  @param5               , TINHTHANH_CAPTHE_ID =  @param6               , BENHVIEN_ID =  @param7               , BENHVIEN_KCB_ID =  @param8               , TREN3NAM =  @param9               , TREN5NAM =  @param10               , TREN6THANG =  @param11               , NGAYMIENDONGCHITRA =  @param12               , TAMNGUNG =  @param13               , NGAYCAPNHAT =  @param17               , NGUOICAPNHAT_ID =  @param18               , KHUVUCSONG_ID =  @param16               where              SOTHE = 'DN453534653452338289' and BENHNHAN_ID = '23423']
2019-09-20 15:46:04,504 [1] DEBUG - Statement Id: [DAO00013_Add_Update_BHYT] Parameters: [@param0=[BENHNHAN_ID,23423], @param1=[LOAIBHYT,4], @param2=[SOTHE,DN453534653452338289], @param3=[NGAYCAP,null], @param4=[NGAYHIEULUC,1/1/2019 12:00:00 AM], @param5=[NGAYHETHIEULUC,12/31/2019 12:00:00 AM], @param6=[TINHTHANH_CAPTHE_ID,null], @param7=[BENHVIEN_ID,HLU01], @param8=[BENHVIEN_KCB_ID,38289], @param9=[TREN3NAM,0], @param10=[TREN5NAM,0], @param11=[TREN6THANG,null], @param12=[NGAYMIENDONGCHITRA,null], @param13=[TAMNGUNG,null], @param14=[NGAYTAO,9/20/2019 3:46:04 PM], @param15=[NGUOITAO_ID,1], @param16=[KHUVUCSONG_ID,null], @param17=[NGAYCAPNHAT,9/20/2019 3:46:04 PM], @param18=[NGUOICAPNHAT_ID,1]]
2019-09-20 15:46:04,504 [1] DEBUG - Statement Id: [DAO00013_Add_Update_BHYT] Types: [@param0=[Int32, System.Int32], @param1=[String, System.String], @param2=[String, System.String], @param3=[System.DBNull, null], @param4=[DateTime, System.DateTime], @param5=[DateTime, System.DateTime], @param6=[System.DBNull, null], @param7=[String, System.String], @param8=[String, System.String], @param9=[String, System.String], @param10=[String, System.String], @param11=[System.DBNull, null], @param12=[System.DBNull, null], @param13=[System.DBNull, null], @param14=[DateTime, System.DateTime], @param15=[String, System.String], @param16=[System.DBNull, null], @param17=[DateTime, System.DateTime], @param18=[String, System.String]]
2019-09-20 15:46:04,721 [1] DEBUG - Statement Id: [DAOWF001_Laythongtingateways] PreparedStatement : [select * from TM_PROCESS_GATEWAYS]
2019-09-20 15:46:13,983 [1] DEBUG - Statement Id: [DAO00019_Add] PreparedStatement : [declare        @keyValue int, @BenhVienId varchar(10),        @yearNow int, @monthNow varchar(2), @dayNow varchar(2),        @Sotiepnhan varchar(20), @SoThuTu varchar(20)        set @keyValue = 0;        set @BenhVienId = 'HLU01'        set @yearNow = YEAR(getdate())        set @monthNow = RIGHT('00' + convert(varchar(2), MONTH(getdate())),2)        set @dayNow = RIGHT('00' + convert(varchar(2), DAY(getdate())),2)        BEGIN        select @keyValue = KEYVALUE from LST_KEYDATA        where KEYTYPE = 'SOTIEPNHAN' and KEYYEAR = @yearNow and KEYMONTH = @monthNow and KEYDAY = @dayNow        and BENHVIEN_ID = @BenhVienId        if @keyValue = 0        Insert into LST_KEYDATA values ('SOTIEPNHAN', @yearNow, @monthNow, @dayNow, '0', '0', '0', 0, @BenhVienId);        Update LST_KEYDATA set KEYVALUE = (KEYVALUE + 1), @keyValue = (KEYVALUE + 1) where KEYTYPE = 'SOTIEPNHAN' and KEYYEAR = @yearNow and KEYMONTH = @monthNow and KEYDAY = @dayNow and BENHVIEN_ID = @BenhVienId        set @SoThuTu = right('0000000'+convert(varchar(7), @keyValue), 7)        set @Sotiepnhan = 'TN' + RIGHT(@yearNow, 2) + @monthNow  + @dayNow + '.' + @SoThuTu                         insert into TT_TIEPNHAN (        SOTIEPNHAN        , UUTIEN        , BENHNHAN_ID        , BENHVIEN_ID        , TUYENKHAMBENH_ID        , NOITIEPNHAN_ID        , NGAYTIEPNHAN        , THOIGIANTIEPNHAN        , NAMTIEPNHAN        , THANGTIEPNHAN        , DOITUONG_ID        , LYDOTIEPNHAN_ID        , HINHTHUCDENKHAM_ID        , TINHTRANGHEN        , XACNHANCHIPHI_ID        , THUTIENTRUOC        , TAIKHAM        , SOBHYT        , BHYTTUNGAY        , BHYTDENNGAY        , BHYTNGAYCAP        , BHYTTREN3NAM        , BHYTTREN5NAM        , NGAYMIENDONGCHITRA        , LOAIBHYT        , NGAYBHYT2        , SOCHUYENVIEN        , HINHTHUCCHUYENVIEN_ID        , NOIGIOITHIEU_ID        , NGUOIGIOITHIEU_ID        , THOIGIANCHUYENTUYEN        , LYDOCHUYENVIEN_ID        , ICDNOIGIOITHIEU_ID        , CHANDOANNGT        , TRAITUYEN        , DIACHILIENHE        , XAPHUONG_ID        , QUANHUYEN_ID        , TINHTHANH_ID        , PROCESS_ID        , TRANGTHAI        , KHUVUCSONG_ID        , THANHVIEN_ID        , THE_ID        , LOAITHANHVIEN_ID        , SUDUNG_BHTN        , VIP        , GHICHU_TIEPNHAN        , BAOLANH_VIENPHI        , CONGTY_CHITRA_ID        , NGUON_BENHNHAN_ID        , LOAITIEPNHAN_ID        , THONGTIN_KCB_BHYT        , NGAYTAO        , NGUOITAO_ID        , LYDODENKHAM         ,           NGUOINUOCNGOAI         ,           ISTHONGTUYEN                 )        OUTPUT INSERTED.TIEPNHAN_ID, INSERTED.SOTIEPNHAN        values (        @Sotiepnhan        ,  @param0         ,  @param1         ,  @param2         ,  @param3         ,  @param4         ,  @param5         ,  @param6         ,  @param7         ,  @param8         ,  @param9         ,  @param10         ,  @param11         ,  @param12         ,  @param13         ,  @param14         ,  @param15         ,  @param16         ,  @param17         ,  @param18         ,  @param19         ,  @param20         ,  @param21         ,  @param22         ,  @param23         ,  @param24         ,  @param25         ,  @param26         ,  @param27         ,  @param28         ,  @param29         ,  @param30         ,  @param31         ,  @param32         ,  @param33         ,  @param34         ,  @param35         ,  @param36         ,  @param37         ,  @param38         ,  @param39         ,  @param40         ,  @param41         ,  @param42         ,  @param43         ,  @param44         ,  @param45         ,  @param46         ,  @param47         ,  @param48         ,  @param49         ,  @param50         ,  @param51         ,  @param52         ,  @param53         ,  @param54          ,            @param55          ,            @param56                  )        end]
2019-09-20 15:46:13,983 [1] DEBUG - Statement Id: [DAO00019_Add] Parameters: [@param0=[UUTIEN,0], @param1=[BENHNHAN_ID,23423], @param2=[BENHVIEN_ID,HLU01], @param3=[TUYENKHAMBENH_ID,null], @param4=[NOITIEPNHAN_ID,58], @param5=[NGAYTIEPNHAN,9/20/2019 12:00:00 AM], @param6=[THOIGIANTIEPNHAN,9/20/2019 3:45:13 PM], @param7=[NAMTIEPNHAN,2019], @param8=[THANGTIEPNHAN,9], @param9=[DOITUONG_ID,4], @param10=[LYDOTIEPNHAN_ID,null], @param11=[HINHTHUCDENKHAM_ID,461], @param12=[TINHTRANGHEN,null], @param13=[XACNHANCHIPHI_ID,null], @param14=[THUTIENTRUOC,null], @param15=[TAIKHAM,0], @param16=[SOBHYT,DN453534653452338289], @param17=[BHYTTUNGAY,1/1/2019 12:00:00 AM], @param18=[BHYTDENNGAY,12/31/2019 12:00:00 AM], @param19=[BHYTNGAYCAP,null], @param20=[BHYTTREN3NAM,0], @param21=[BHYTTREN5NAM,0], @param22=[NGAYMIENDONGCHITRA,null], @param23=[LOAIBHYT,null], @param24=[NGAYBHYT2,null], @param25=[SOCHUYENVIEN,], @param26=[HINHTHUCCHUYENVIEN_ID,null], @param27=[NOIGIOITHIEU_ID,null], @param28=[NGUOIGIOITHIEU_ID,null], @param29=[THOIGIANCHUYENTUYEN,null], @param30=[LYDOCHUYENVIEN_ID,null], @param31=[ICDNOIGIOITHIEU_ID,null], @param32=[CHANDOANNGT,], @param33=[TRAITUYEN,0], @param34=[DIACHILIENHE,null], @param35=[XAPHUONG_ID,16432], @param36=[QUANHUYEN_ID,null], @param37=[TINHTHANH_ID,null], @param38=[PROCESS_ID,P02], @param39=[TRANGTHAI,DATIEPNHAN], @param40=[KHUVUCSONG_ID,null], @param41=[THANHVIEN_ID,null], @param42=[THE_ID,null], @param43=[LOAITHANHVIEN_ID,null], @param44=[SUDUNG_BHTN,0], @param45=[VIP,0], @param46=[GHICHU_TIEPNHAN,null], @param47=[BAOLANH_VIENPHI,0], @param48=[CONGTY_CHITRA_ID,null], @param49=[NGUON_BENHNHAN_ID,null], @param50=[LOAITIEPNHAN_ID,8351], @param51=[THONGTIN_KCB_BHYT,null], @param52=[NGAYTAO,9/20/2019 3:46:13 PM], @param53=[NGUOITAO_ID,1], @param54=[LYDODENKHAM,null], @param55=[NGUOINUOCNGOAI,null], @param56=[ISTHONGTUYEN,0]]
2019-09-20 15:46:13,983 [1] DEBUG - Statement Id: [DAO00019_Add] Types: [@param0=[Int32, System.Int32], @param1=[Int32, System.Int32], @param2=[String, System.String], @param3=[System.DBNull, null], @param4=[String, System.String], @param5=[DateTime, System.DateTime], @param6=[DateTime, System.DateTime], @param7=[Int32, System.Int32], @param8=[Int32, System.Int32], @param9=[Int64, System.Int64], @param10=[System.DBNull, null], @param11=[Int64, System.Int64], @param12=[System.DBNull, null], @param13=[System.DBNull, null], @param14=[System.DBNull, null], @param15=[Int32, System.Int32], @param16=[String, System.String], @param17=[DateTime, System.DateTime], @param18=[DateTime, System.DateTime], @param19=[System.DBNull, null], @param20=[String, System.String], @param21=[String, System.String], @param22=[System.DBNull, null], @param23=[System.DBNull, null], @param24=[System.DBNull, null], @param25=[String, System.String], @param26=[System.DBNull, null], @param27=[System.DBNull, null], @param28=[System.DBNull, null], @param29=[System.DBNull, null], @param30=[System.DBNull, null], @param31=[System.DBNull, null], @param32=[String, System.String], @param33=[String, System.String], @param34=[System.DBNull, null], @param35=[String, System.String], @param36=[System.DBNull, null], @param37=[System.DBNull, null], @param38=[String, System.String], @param39=[String, System.String], @param40=[System.DBNull, null], @param41=[System.DBNull, null], @param42=[System.DBNull, null], @param43=[System.DBNull, null], @param44=[String, System.String], @param45=[String, System.String], @param46=[System.DBNull, null], @param47=[String, System.String], @param48=[System.DBNull, null], @param49=[System.DBNull, null], @param50=[Int64, System.Int64], @param51=[System.DBNull, null], @param52=[DateTime, System.DateTime], @param53=[String, System.String], @param54=[System.DBNull, null], @param55=[System.DBNull, null], @param56=[String, System.String]]
2019-09-20 15:46:14,017 [1] DEBUG - Statement Id: [DAO00019_GetTTTiepNhan_byTiepNhanId] PreparedStatement : [select *        from TT_TIEPNHAN        where TIEPNHAN_ID = '27478'        order by TIEPNHAN_ID]
2019-09-20 15:46:14,056 [1] DEBUG - Statement Id: [DAO00080_Add_KhamBenh_CapCuu] PreparedStatement : [insert into TT_KHAMBENH_VAOVIEN (        SOPHIEU        , TIEPNHAN_ID        , KHAMBENH_ID        , BENHNHAN_ID        , NGUOILIENHE        , DIENTHOAILIENHE        , NOILAMVIEC        , CHANDOANNOIGIOITHIEU        , NGAYKHAM        , THOIGIANKHAM        , LYDOVAOVIEN        , QUATRINHBENHLY        , TIENSUBANTHAN        , TIENSUGIADINH        , KHAMXETTOANTHAN        , KHAMXETCACBOPHAN        , KHAMXETKQLS        , CHANDOANVAO        , ICDKHAMXET_ID        , DAXULY        , NGAYRA        , THOIGIANRA        , NHAPKHOA_ID        , CHUYENVIEN_ID        , CHUY        , MACH        , NHIETDO        , HUYETAPCAO        , HUYETAPTHAP        , NHIPTHO        , CANNANG        , CHIEUCAO        , BACSI_ID        , XUTRUKHAMBENH_ID        , CAPCUU        , NGAYTAINAN        , THOIGIANTAINAN        , NOITAINAN_TINHTHANH_ID        , NOITAINAN_QUANHUYEN_ID        , NOITAINAN_PHUONGXA_ID        , NOITAINAN_DIACHI        , DIADIEMTAINAN_ID        , BOPHANBITHUONG_ID        , MUCDO_ID        , DIENBIENSAUTN_ID        , XUTRISAUTN_ID        , NGUYENNHAN_ID        , NGUYENNHANCHITIET_ID        , ICD_NGUYENNHAN        , NGAYTAO        , NGUOITAO_ID        , NGAYCAPNHAT        , NGUOICAPNHAT_ID        , BENHANCHUYENKHOA        , CHANDOANVAOVIEN        , CHANDOANRAVIEN        , DIEUTRITUNGAY        , DIEUTRIDENNGAY        , DIENBIENLS        , KQXETNGHIEM        , PHAUTHUAT        , THUTHUAT        , TINHTRANGNGUOIBENH        , HUONGDIEUTRI        , NGUOIGIAO_ID        , NGUOINHAN_ID        , XQUANG        , CTSCANNER        , SIEUAM        , XETNGHIEM        , KHAC        , TOANBOHS        , LOAICHUYENKHOA        , CONGANCANTHIEP        , CDRR_BENHCHINH        , CDRR_BENHKEM        , ICD_BENHCHINH        , ICD_BENHKEMTHEO        , PHUONGPHAPDIEUTRI        , FIELD_1        , FIELD_2        , FIELD_3        , FIELD_4        , FIELD_5        , FIELD_6        , FIELD_7        , FIELD_8        , FIELD_9        , FIELD_10        , FIELD_11        , FIELD_12        , FIELD_13        , FIELD_14        , FIELD_15        , FIELD_27        , FIELD_28        , FIELD_29        , FIELD_30        , FIELD_31        , FIELD_32        , FIELD_33        , FIELD_34        , FIELD_35        , FIELD_36        , FIELD_37        , FIELD_38        , FIELD_39        , FIELD_40        , FIELD_41        , FIELD_42        , FIELD_43        , FIELD_44        , FIELD_45        , FIELD_46        , FIELD_47        , FIELD_48        , FIELD_49        , FIELD_50        , FIELD_51        , FIELD_52        , FIELD_53        , FIELD_54        , FIELD_55        , FIELD_56        , BENHVIEN_ID        ) values (         @param0         ,  @param1         ,  @param2         ,  @param3         ,  @param4         ,  @param5         ,  @param6         ,  @param7         ,  @param8         ,  @param9         ,  @param10         ,  @param11         ,  @param12         ,  @param13         ,  @param14         ,  @param15         ,  @param16         ,  @param17         ,  @param18         ,  @param19         ,  @param20         ,  @param21         ,  @param22         ,  @param23         ,  @param24         ,  @param25         ,  @param26         ,  @param27         ,  @param28         ,  @param29         ,  @param30         ,  @param31         ,  @param32         ,  @param33         ,  @param34         ,  @param35         ,  @param36         ,  @param37         ,  @param38         ,  @param39         ,  @param40         ,  @param41         ,  @param42         ,  @param43         ,  @param44         ,  @param45         ,  @param46         ,  @param47         ,  @param48         ,  @param49         ,  @param50         ,  @param51         ,  @param52         ,  @param53         ,  @param54         ,  @param55         ,  @param56         ,  @param57         ,  @param58         ,  @param59         ,  @param60         ,  @param61         ,  @param62         ,  @param63         ,  @param64         ,  @param65         ,  @param66         ,  @param67         ,  @param68         ,  @param69         ,  @param70         ,  @param71         ,  @param72         ,  @param73         ,  @param74         ,  @param75         ,  @param76         ,  @param77         ,  @param78         ,  @param79         ,  @param80         ,  @param81         ,  @param82         ,  @param83         ,  @param84         ,  @param85         ,  @param86         ,  @param87         ,  @param88         ,  @param89         ,  @param90         ,  @param91         ,  @param92         ,  @param93         ,  @param94         ,  @param95         ,  @param96         ,  @param97         ,  @param98         ,  @param99         ,  @param100         ,  @param101         ,  @param102         ,  @param103         ,  @param104         ,  @param105         ,  @param106         ,  @param107         ,  @param108         ,  @param109         ,  @param110         ,  @param111         ,  @param112         ,  @param113         ,  @param114         ,  @param115         ,  @param116         ,  @param117         ,  @param118         ,  @param119         ,  @param120         ,  @param121         ,  @param122         ,  @param123         ,  @param124         )]
2019-09-20 15:46:14,057 [1] DEBUG - Statement Id: [DAO00080_Add_KhamBenh_CapCuu] Parameters: [@param0=[SOPHIEU,null], @param1=[TIEPNHAN_ID,27478], @param2=[KHAMBENH_ID,null], @param3=[BENHNHAN_ID,23423], @param4=[NGUOILIENHE,null], @param5=[DIENTHOAILIENHE,null], @param6=[NOILAMVIEC,null], @param7=[CHANDOANNOIGIOITHIEU,null], @param8=[NGAYKHAM,9/20/2019 12:00:00 AM], @param9=[THOIGIANKHAM,9/20/2019 3:45:13 PM], @param10=[LYDOVAOVIEN,null], @param11=[QUATRINHBENHLY,null], @param12=[TIENSUBANTHAN,null], @param13=[TIENSUGIADINH,null], @param14=[KHAMXETTOANTHAN,null], @param15=[KHAMXETCACBOPHAN,null], @param16=[KHAMXETKQLS,null], @param17=[CHANDOANVAO,null], @param18=[ICDKHAMXET_ID,null], @param19=[DAXULY,null], @param20=[NGAYRA,null], @param21=[THOIGIANRA,null], @param22=[NHAPKHOA_ID,58], @param23=[CHUYENVIEN_ID,null], @param24=[CHUY,null], @param25=[MACH,null], @param26=[NHIETDO,null], @param27=[HUYETAPCAO,null], @param28=[HUYETAPTHAP,null], @param29=[NHIPTHO,null], @param30=[CANNANG,null], @param31=[CHIEUCAO,null], @param32=[BACSI_ID,null], @param33=[XUTRUKHAMBENH_ID,null], @param34=[CAPCUU,null], @param35=[NGAYTAINAN,null], @param36=[THOIGIANTAINAN,null], @param37=[NOITAINAN_TINHTHANH_ID,null], @param38=[NOITAINAN_QUANHUYEN_ID,null], @param39=[NOITAINAN_PHUONGXA_ID,null], @param40=[NOITAINAN_DIACHI,null], @param41=[DIADIEMTAINAN_ID,null], @param42=[BOPHANBITHUONG_ID,null], @param43=[MUCDO_ID,null], @param44=[DIENBIENSAUTN_ID,null], @param45=[XUTRISAUTN_ID,null], @param46=[NGUYENNHAN_ID,null], @param47=[NGUYENNHANCHITIET_ID,null], @param48=[ICD_NGUYENNHAN,null], @param49=[NGAYTAO,9/20/2019 3:46:14 PM], @param50=[NGUOITAO_ID,1], @param51=[NGAYCAPNHAT,9/20/2019 3:46:14 PM], @param52=[NGUOICAPNHAT_ID,1], @param53=[BENHANCHUYENKHOA,null], @param54=[CHANDOANVAOVIEN,null], @param55=[CHANDOANRAVIEN,null], @param56=[DIEUTRITUNGAY,null], @param57=[DIEUTRIDENNGAY,null], @param58=[DIENBIENLS,null], @param59=[KQXETNGHIEM,null], @param60=[PHAUTHUAT,null], @param61=[THUTHUAT,null], @param62=[TINHTRANGNGUOIBENH,null], @param63=[HUONGDIEUTRI,null], @param64=[NGUOIGIAO_ID,null], @param65=[NGUOINHAN_ID,null], @param66=[XQUANG,null], @param67=[CTSCANNER,null], @param68=[SIEUAM,null], @param69=[XETNGHIEM,null], @param70=[KHAC,null], @param71=[TOANBOHS,null], @param72=[LOAICHUYENKHOA,null], @param73=[CONGANCANTHIEP,null], @param74=[CDRR_BENHCHINH,null], @param75=[CDRR_BENHKEM,null], @param76=[ICD_BENHCHINH,null], @param77=[ICD_BENHKEMTHEO,null], @param78=[PHUONGPHAPDIEUTRI,null], @param79=[FIELD_1,null], @param80=[FIELD_2,null], @param81=[FIELD_3,null], @param82=[FIELD_4,null], @param83=[FIELD_5,null], @param84=[FIELD_6,null], @param85=[FIELD_7,null], @param86=[FIELD_8,null], @param87=[FIELD_9,null], @param88=[FIELD_10,null], @param89=[FIELD_11,null], @param90=[FIELD_12,null], @param91=[FIELD_13,null], @param92=[FIELD_14,null], @param93=[FIELD_15,null], @param94=[FIELD_27,null], @param95=[FIELD_28,null], @param96=[FIELD_29,null], @param97=[FIELD_30,null], @param98=[FIELD_31,null], @param99=[FIELD_32,null], @param100=[FIELD_33,null], @param101=[FIELD_34,null], @param102=[FIELD_35,null], @param103=[FIELD_36,null], @param104=[FIELD_37,null], @param105=[FIELD_38,null], @param106=[FIELD_39,null], @param107=[FIELD_40,null], @param108=[FIELD_41,null], @param109=[FIELD_42,null], @param110=[FIELD_43,null], @param111=[FIELD_44,null], @param112=[FIELD_45,null], @param113=[FIELD_46,null], @param114=[FIELD_47,null], @param115=[FIELD_48,null], @param116=[FIELD_49,null], @param117=[FIELD_50,null], @param118=[FIELD_51,null], @param119=[FIELD_52,null], @param120=[FIELD_53,null], @param121=[FIELD_54,null], @param122=[FIELD_55,null], @param123=[FIELD_56,null], @param124=[BENHVIEN_ID,HLU01]]
2019-09-20 15:46:14,057 [1] DEBUG - Statement Id: [DAO00080_Add_KhamBenh_CapCuu] Types: [@param0=[System.DBNull, null], @param1=[Int32, System.Int32], @param2=[System.DBNull, null], @param3=[Int32, System.Int32], @param4=[System.DBNull, null], @param5=[System.DBNull, null], @param6=[System.DBNull, null], @param7=[System.DBNull, null], @param8=[DateTime, System.DateTime], @param9=[DateTime, System.DateTime], @param10=[System.DBNull, null], @param11=[System.DBNull, null], @param12=[System.DBNull, null], @param13=[System.DBNull, null], @param14=[System.DBNull, null], @param15=[System.DBNull, null], @param16=[System.DBNull, null], @param17=[System.DBNull, null], @param18=[System.DBNull, null], @param19=[System.DBNull, null], @param20=[System.DBNull, null], @param21=[System.DBNull, null], @param22=[String, System.String], @param23=[System.DBNull, null], @param24=[System.DBNull, null], @param25=[System.DBNull, null], @param26=[System.DBNull, null], @param27=[System.DBNull, null], @param28=[System.DBNull, null], @param29=[System.DBNull, null], @param30=[System.DBNull, null], @param31=[System.DBNull, null], @param32=[System.DBNull, null], @param33=[System.DBNull, null], @param34=[System.DBNull, null], @param35=[System.DBNull, null], @param36=[System.DBNull, null], @param37=[System.DBNull, null], @param38=[System.DBNull, null], @param39=[System.DBNull, null], @param40=[System.DBNull, null], @param41=[System.DBNull, null], @param42=[System.DBNull, null], @param43=[System.DBNull, null], @param44=[System.DBNull, null], @param45=[System.DBNull, null], @param46=[System.DBNull, null], @param47=[System.DBNull, null], @param48=[System.DBNull, null], @param49=[DateTime, System.DateTime], @param50=[String, System.String], @param51=[DateTime, System.DateTime], @param52=[String, System.String], @param53=[System.DBNull, null], @param54=[System.DBNull, null], @param55=[System.DBNull, null], @param56=[System.DBNull, null], @param57=[System.DBNull, null], @param58=[System.DBNull, null], @param59=[System.DBNull, null], @param60=[System.DBNull, null], @param61=[System.DBNull, null], @param62=[System.DBNull, null], @param63=[System.DBNull, null], @param64=[System.DBNull, null], @param65=[System.DBNull, null], @param66=[System.DBNull, null], @param67=[System.DBNull, null], @param68=[System.DBNull, null], @param69=[System.DBNull, null], @param70=[System.DBNull, null], @param71=[System.DBNull, null], @param72=[System.DBNull, null], @param73=[System.DBNull, null], @param74=[System.DBNull, null], @param75=[System.DBNull, null], @param76=[System.DBNull, null], @param77=[System.DBNull, null], @param78=[System.DBNull, null], @param79=[System.DBNull, null], @param80=[System.DBNull, null], @param81=[System.DBNull, null], @param82=[System.DBNull, null], @param83=[System.DBNull, null], @param84=[System.DBNull, null], @param85=[System.DBNull, null], @param86=[System.DBNull, null], @param87=[System.DBNull, null], @param88=[System.DBNull, null], @param89=[System.DBNull, null], @param90=[System.DBNull, null], @param91=[System.DBNull, null], @param92=[System.DBNull, null], @param93=[System.DBNull, null], @param94=[System.DBNull, null], @param95=[System.DBNull, null], @param96=[System.DBNull, null], @param97=[System.DBNull, null], @param98=[System.DBNull, null], @param99=[System.DBNull, null], @param100=[System.DBNull, null], @param101=[System.DBNull, null], @param102=[System.DBNull, null], @param103=[System.DBNull, null], @param104=[System.DBNull, null], @param105=[System.DBNull, null], @param106=[System.DBNull, null], @param107=[System.DBNull, null], @param108=[System.DBNull, null], @param109=[System.DBNull, null], @param110=[System.DBNull, null], @param111=[System.DBNull, null], @param112=[System.DBNull, null], @param113=[System.DBNull, null], @param114=[System.DBNull, null], @param115=[System.DBNull, null], @param116=[System.DBNull, null], @param117=[System.DBNull, null], @param118=[System.DBNull, null], @param119=[System.DBNull, null], @param120=[System.DBNull, null], @param121=[System.DBNull, null], @param122=[System.DBNull, null], @param123=[System.DBNull, null], @param124=[String, System.String]]
2019-09-20 15:46:14,100 [1] DEBUG - Statement Id: [DAO00000_GetMucHuongDOITUONGBHYT] PreparedStatement : [select * from TM_DOITUONG          where BENHVIEN_ID = 'HLU01'           and             NHOMTHE like '%' +  @param0  +'%']
2019-09-20 15:46:14,100 [1] DEBUG - Statement Id: [DAO00000_GetMucHuongDOITUONGBHYT] Parameters: [@param0=[NHOMTHE,DN4]]
2019-09-20 15:46:14,100 [1] DEBUG - Statement Id: [DAO00000_GetMucHuongDOITUONGBHYT] Types: [@param0=[String, System.String]]
2019-09-20 15:46:14,130 [1] DEBUG - Statement Id: [DAO00019_Add_TT_TIEPNHAN_SOTHEBHYT] PreparedStatement : [INSERT INTO TT_TIEPNHAN_SOTHEBHYT        (TIEPNHAN_ID        ,BENHNHAN_ID        ,BENHAN_ID        ,DOITUONG_ID        ,SOBHYT        ,BHYTTUNGAY        ,BHYTDENNGAY        ,BHYTNGAYCAP        ,BHYTTREN3NAM        ,BHYTTREN5NAM        ,NGAYMIENDONGCHITRA        ,TRAITUYEN        ,BENHVIEN_ID        ,NOITAO_ID        ,NGAYTAO        ,NGUOITAO_ID        ,NGAYCAPNHAT        ,NGUOICAPNHAT_ID        ,TYLE_VUOT_LCB        ,TYLE_TRAITUYEN        ,GIOIHAN_VUOT_LCB        ,LUONG_COSO        ,TYLE_THUOC_UT        ,MADOITUONG)        VALUES        ( @param0         , @param1         , @param2         , @param3         , @param4         , @param5         , @param6         , @param7         , @param8         , @param9         , @param10         , @param11         , @param12         , @param13         , @param14         , @param15         , @param16         , @param17         , @param18         , @param19         , @param20         , @param21         , @param22         , @param23 )]
2019-09-20 15:46:14,130 [1] DEBUG - Statement Id: [DAO00019_Add_TT_TIEPNHAN_SOTHEBHYT] Parameters: [@param0=[TIEPNHAN_ID,27478], @param1=[BENHNHAN_ID,23423], @param2=[BENHAN_ID,null], @param3=[DOITUONG_ID,4], @param4=[SOBHYT,DN453534653452338289], @param5=[BHYTTUNGAY,1/1/2019 12:00:00 AM], @param6=[BHYTDENNGAY,12/31/2019 12:00:00 AM], @param7=[BHYTNGAYCAP,null], @param8=[BHYTTREN3NAM,0], @param9=[BHYTTREN5NAM,0], @param10=[NGAYMIENDONGCHITRA,null], @param11=[TRAITUYEN,0], @param12=[BENHVIEN_ID,HLU01], @param13=[NOITAO_ID,58], @param14=[NGAYTAO,9/20/2019 3:46:14 PM], @param15=[NGUOITAO_ID,1], @param16=[NGAYCAPNHAT,9/20/2019 3:46:14 PM], @param17=[NGUOICAPNHAT_ID,1], @param18=[TYLE_VUOT_LCB,0.80], @param19=[TYLE_TRAITUYEN,0.60], @param20=[GIOIHAN_VUOT_LCB,208500.00], @param21=[LUONG_COSO,1300000.00], @param22=[TYLE_THUOC_UT,0.50], @param23=[MADOITUONG,BHYT4]]
2019-09-20 15:46:14,131 [1] DEBUG - Statement Id: [DAO00019_Add_TT_TIEPNHAN_SOTHEBHYT] Types: [@param0=[Int32, System.Int32], @param1=[Int32, System.Int32], @param2=[System.DBNull, null], @param3=[Int32, System.Int32], @param4=[String, System.String], @param5=[DateTime, System.DateTime], @param6=[DateTime, System.DateTime], @param7=[System.DBNull, null], @param8=[String, System.String], @param9=[String, System.String], @param10=[System.DBNull, null], @param11=[String, System.String], @param12=[String, System.String], @param13=[String, System.String], @param14=[DateTime, System.DateTime], @param15=[String, System.String], @param16=[DateTime, System.DateTime], @param17=[String, System.String], @param18=[Decimal, System.Decimal], @param19=[Decimal, System.Decimal], @param20=[Decimal, System.Decimal], @param21=[Decimal, System.Decimal], @param22=[Decimal, System.Decimal], @param23=[String, System.String]]
2019-09-20 15:46:14,407 [1] DEBUG - Statement Id: [DAO00027_GetListTiepNhanAllCOM30] PreparedStatement : [select distinct A.SOTIEPNHAN, A.TRAITUYEN, A.NGAYMIENDONGCHITRA, A.TIEPNHAN_ID, A.DOITUONG_ID, isnull(C.SOBENHAN,NULL) as SOBENHAN,        A.LOAITHANHVIEN_ID, A.SUDUNG_BHTN, A.THE_ID, A.THANHVIEN_ID, A.VIP, A.NGUON_BENHNHAN_ID, A.BAOLANH_VIENPHI, A.SOBHYT, CONVERT(VARCHAR(11),A.NGAYTIEPNHAN,103) as NGAYTIEPNHAN,        B.*        , A.UUTIEN        from TT_TIEPNHAN A        inner join (select * from TT_BENHNHAN where MAYTE = '190043304' and ACTIVE = '1') B on B.BENHNHAN_ID = A.BENHNHAN_ID  and B.ACTIVE = '1'        left join TT_NOITRU_BENHAN C on C.TIEPNHAN_ID = A.TIEPNHAN_ID        where A.TIEPNHAN_ID = '27478' and A.BENHVIEN_ID = 'HLU01' and (A.TRANGTHAI not in ('HUY','CAPCUU', 'NOITRU', 'NGOAITRU'))]
2019-09-20 15:46:15,272 [1] DEBUG - Statement Id: [DAOWF001_LaythongtinProcess] PreparedStatement : [select * from TM_PROCESS        where        PROCESS_CODE = 'P02']
2019-09-20 15:46:15,306 [1] DEBUG - Statement Id: [DAOWF001_Kiemtrathongtindayeucau] PreparedStatement : [select * from TT_REQUEST        where        PROCESS_CODE = 'P02'        AND PARA = '{"HOSPITAL_ID":"HLU01","SOTIEPNHAN":"TN190920.0000001"}'        AND CURR_STATE_CODE = '7'        AND ISACTIVE = '1']
2019-09-20 15:46:15,353 [1] DEBUG - Statement Id: [DAOWF002_Add] PreparedStatement : [DECLARE @IDRequestOld int        DECLARE @IDRequestNew int        select top 1 @IDRequestOld = ID from TT_REQUEST where PARA =  @param0  order by ID desc          insert into TT_REQUEST (        PROCESS_CODE        , PARA        , CURR_STATE_CODE        ) values (         @param1         ,  @param0         ,  @param2         )        SELECT @IDRequestNew = SCOPE_IDENTITY()        if (@IDRequestOld is not null)        begin        update TT_REQUEST_SERVICE set REQUEST_ID = @IDRequestNew, PROCESS_CODE =  @param1  where REQUEST_ID = @IDRequestOld        update TT_REQUEST set ISACTIVE = '0' where ID = @IDRequestOld        update TT_REQUEST_SERVICE_DETAIL set REQUEST_ID = @IDRequestNew where REQUEST_ID = @IDRequestOld        end          select @IDRequestNew]
2019-09-20 15:46:15,353 [1] DEBUG - Statement Id: [DAOWF002_Add] Parameters: [@param0=[PARA,{"HOSPITAL_ID":"HLU01","SOTIEPNHAN":"TN190920.0000001"}], @param1=[PROCESS_CODE,P02], @param2=[CURR_STATE_CODE,7]]
2019-09-20 15:46:15,353 [1] DEBUG - Statement Id: [DAOWF002_Add] Types: [@param0=[String, System.String], @param1=[String, System.String], @param2=[String, System.String]]
2019-09-20 15:46:15,450 [1] DEBUG - Statement Id: [DAO00020_GetNhomdichvuIDByManhom] PreparedStatement : [select NHOMDICHVU_ID from TM_NHOMDICHVU where MANHOMDICHVU = '04']
2019-09-20 15:46:15,487 [1] DEBUG - Statement Id: [DAO00020_Add] PreparedStatement : [declare        @keyValue int, @BenhVienId varchar(10), @yearNow int, @SoPhieuYeu varchar(20), @SoRender varchar(20), @MaNhomDichVu varchar(20)        set @keyValue = 0;        set @BenhVienId = 'HLU01'        set @yearNow = YEAR(getdate())        set @MaNhomDichVu = '5'                 select @keyValue = KEYVALUE from LST_KEYDATA        where KEYTYPE = 'SOPHIEUYEUCAU' and KEYYEAR = @yearNow and SEGMENT_1 = @MaNhomDichVu and BENHVIEN_ID = @BenhVienId        if @keyValue = 0        Insert into LST_KEYDATA values ('SOPHIEUYEUCAU', @yearNow, '0', '0', @MaNhomDichVu, '0', '0', 0, @BenhVienId);          Update LST_KEYDATA set KEYVALUE = KEYVALUE + 1, @keyValue = (KEYVALUE + 1) where KEYTYPE = 'SOPHIEUYEUCAU' and KEYYEAR = @yearNow and SEGMENT_1 = @MaNhomDichVu and BENHVIEN_ID = @BenhVienId        set @SoRender = right('000000'+convert(varchar(6), @keyValue), 6)        set @SoPhieuYeu = RIGHT(@yearNow, 2) + '.' + @MaNhomDichVu + '.' + @SoRender                 insert into TT_DVYEUCAU (        TIEPNHAN_ID        , BENHAN_ID        , KHAMBENH_ID        , SODICHVUYEUCAU        , KHAMBENH_NGOAITRU_ID        , SOPHIEUYEUCAU        , BENHNHAN_ID        , DOITUONG_ID        , DICHVU_ID         ,           NGUOICHIDINH_ID                 , BACSICHIDINH_ID        , GIOYEUCAU        , NGAYYEUCAU        , THANGYEUCAU        , NAMYEUCAU        , NGAYGIOYEUCAU        , THUTUYEUCAU        , NOIYEUCAU_ID        , NOITHUCHIEN_ID        , TRANGTHAI_HANGDOI        , NOIDUNGCHITIET        , CHANDOAN        , LUUTRU_ID        , SODICHVUDONGTIEN        , DICHVU_KHAMBENH_ID        , DALAYMAU        , SINHTHIET        , CLOTEST        , TIEMCANQUANG        , TRIEUCHUNG        , DAITHE        , VITHE        , BENHPHAM        , DANHANBENHPHAM        , NGAYNHANBENHPHAM        , THOIGIANNHANBENHPHAM        , NGUOINHANBENHPHAM_ID        , MANGUOINHAPBENHPHAM        , TENNGUOINHAPBENHPHAM        , KETQUAXNKHAC        , YEUCAUBENNGOAI        , THUCHIENBENNGOAI        , DONVIBENNGOAI_ID        , BACSIBENNGOAI_ID        , TENBACSIBENNGOAI        , KHOABENNGOAI_ID        , KHOABENNGOAI                 , NOITHUCHIENTHAYDOI_ID        , LOAIKHACHHANG_ID        , THE_ID        , BARCODEID        , HOPDONG_ID        , HOPDONG_BENHNHAN_ID        , HINHTHUCTHANHTOAN_ID        , DANGKY_ID        , DANGKY_CHITIET_ID        , LICHHEN_ID        , THOIGIANLICHHEN        , BNKHONGDENBV        , GHICHU        , THANHTOANTRUOC        , KHAN        , DUOCPHEPTHUCHIEN        , HUYYEUCAU        , LYDOHUY        , TRANGTHAI        , KHOADULIEU        , NGAYKHOADULIEU        , THOIGIANKHOADULIEU        , NGUOIKHOA_ID        , MANGUOIKHOA        , TENNGUOIKHOA        , BENHVIEN_ID        , NGAYTAO        , NGUOITAO_ID        , NGAYHENCLS        , CREATININEMAU        , VUNGCANKHAOSAT        , BHYTDONGTIEN        , THUTIENSAU                 , DVKEMTHEO        , DVKEMTHEO_KHACEKIP        , LIENCHUYENKHOA                 )        OUTPUT INSERTED.DVYEUCAU_ID, INSERTED.SOPHIEUYEUCAU        values (         @param0         ,  @param1         ,  @param2         ,  @param3         ,  @param4         , @SoPhieuYeu        ,  @param5         ,  @param6         ,  @param7          ,            @param8                  ,  @param9         ,  @param10         ,  @param11         ,  @param12         ,  @param13         ,  @param14         ,  @param15         ,  @param16         ,  @param17         ,  @param18         ,  @param19         ,  @param20         ,  @param21         ,  @param22         ,  @param23         ,  @param24         ,  @param25         ,  @param26         ,  @param27         ,  @param28         ,  @param29         ,  @param30         ,  @param31         ,  @param32         ,  @param33         ,  @param34         ,  @param35         ,  @param36         ,  @param37         ,  @param38         ,  @param39         ,  @param40         ,  @param41         ,  @param42         ,  @param43         ,  @param44         ,  @param45                  ,  @param46         ,  @param47         ,  @param48         ,  @param49         ,  @param50         ,  @param51         ,  @param52         ,  @param53         ,  @param54         ,  @param55         ,  @param56         ,  @param57         ,  @param58         ,  @param59         ,  @param60         ,  @param61         ,  @param62         ,  @param63         ,  @param64         ,  @param65         ,  @param66         ,  @param67         ,  @param68         ,  @param69         ,  @param70         ,  @param71         ,  @param72         ,  @param73         ,  @param74         ,  @param75         ,  @param76         ,  @param77         ,  @param78                  ,  @param79         ,  @param80         ,  @param81                  );]
2019-09-20 15:46:15,487 [1] DEBUG - Statement Id: [DAO00020_Add] Parameters: [@param0=[TIEPNHAN_ID,27478], @param1=[BENHAN_ID,null], @param2=[KHAMBENH_ID,null], @param3=[SODICHVUYEUCAU,1], @param4=[KHAMBENH_NGOAITRU_ID,null], @param5=[BENHNHAN_ID,23423], @param6=[DOITUONG_ID,4], @param7=[DICHVU_ID,5685], @param8=[NGUOICHIDINH_ID,1], @param9=[BACSICHIDINH_ID,1], @param10=[GIOYEUCAU,15], @param11=[NGAYYEUCAU,9/20/2019 12:00:00 AM], @param12=[THANGYEUCAU,9], @param13=[NAMYEUCAU,2019], @param14=[NGAYGIOYEUCAU,9/20/2019 3:45:13 PM], @param15=[THUTUYEUCAU,1], @param16=[NOIYEUCAU_ID,58], @param17=[NOITHUCHIEN_ID,58], @param18=[TRANGTHAI_HANGDOI,null], @param19=[NOIDUNGCHITIET,null], @param20=[CHANDOAN,null], @param21=[LUUTRU_ID,null], @param22=[SODICHVUDONGTIEN,0], @param23=[DICHVU_KHAMBENH_ID,null], @param24=[DALAYMAU,null], @param25=[SINHTHIET,0], @param26=[CLOTEST,0], @param27=[TIEMCANQUANG,0], @param28=[TRIEUCHUNG,null], @param29=[DAITHE,null], @param30=[VITHE,null], @param31=[BENHPHAM,null], @param32=[DANHANBENHPHAM,0], @param33=[NGAYNHANBENHPHAM,null], @param34=[THOIGIANNHANBENHPHAM,null], @param35=[NGUOINHANBENHPHAM_ID,null], @param36=[MANGUOINHAPBENHPHAM,null], @param37=[TENNGUOINHAPBENHPHAM,null], @param38=[KETQUAXNKHAC,null], @param39=[YEUCAUBENNGOAI,0], @param40=[THUCHIENBENNGOAI,0], @param41=[DONVIBENNGOAI_ID,null], @param42=[BACSIBENNGOAI_ID,null], @param43=[TENBACSIBENNGOAI,null], @param44=[KHOABENNGOAI_ID,null], @param45=[KHOABENNGOAI,null], @param46=[NOITHUCHIENTHAYDOI_ID,null], @param47=[LOAIKHACHHANG_ID,null], @param48=[THE_ID,null], @param49=[BARCODEID,null], @param50=[HOPDONG_ID,null], @param51=[HOPDONG_BENHNHAN_ID,null], @param52=[HINHTHUCTHANHTOAN_ID,null], @param53=[DANGKY_ID,null], @param54=[DANGKY_CHITIET_ID,null], @param55=[LICHHEN_ID,null], @param56=[THOIGIANLICHHEN,null], @param57=[BNKHONGDENBV,null], @param58=[GHICHU,null], @param59=[THANHTOANTRUOC,1], @param60=[KHAN,0], @param61=[DUOCPHEPTHUCHIEN,0], @param62=[HUYYEUCAU,0], @param63=[LYDOHUY,null], @param64=[TRANGTHAI,CHUAKETQUA], @param65=[KHOADULIEU,null], @param66=[NGAYKHOADULIEU,null], @param67=[THOIGIANKHOADULIEU,null], @param68=[NGUOIKHOA_ID,null], @param69=[MANGUOIKHOA,null], @param70=[TENNGUOIKHOA,null], @param71=[BENHVIEN_ID,HLU01], @param72=[NGAYTAO,9/20/2019 3:46:15 PM], @param73=[NGUOITAO_ID,1], @param74=[NGAYHENCLS,null], @param75=[CREATININEMAU,null], @param76=[VUNGCANKHAOSAT,null], @param77=[BHYTDONGTIEN,null], @param78=[THUTIENSAU,0], @param79=[DVKEMTHEO,0], @param80=[DVKEMTHEO_KHACEKIP,null], @param81=[LIENCHUYENKHOA,null]]
2019-09-20 15:46:15,488 [1] DEBUG - Statement Id: [DAO00020_Add] Types: [@param0=[String, System.String], @param1=[System.DBNull, null], @param2=[System.DBNull, null], @param3=[Int32, System.Int32], @param4=[System.DBNull, null], @param5=[Int32, System.Int32], @param6=[Int64, System.Int64], @param7=[Int64, System.Int64], @param8=[Int64, System.Int64], @param9=[Int64, System.Int64], @param10=[Int32, System.Int32], @param11=[DateTime, System.DateTime], @param12=[Int32, System.Int32], @param13=[Int32, System.Int32], @param14=[DateTime, System.DateTime], @param15=[Int32, System.Int32], @param16=[String, System.String], @param17=[Int64, System.Int64], @param18=[System.DBNull, null], @param19=[System.DBNull, null], @param20=[System.DBNull, null], @param21=[System.DBNull, null], @param22=[Int32, System.Int32], @param23=[System.DBNull, null], @param24=[System.DBNull, null], @param25=[Int32, System.Int32], @param26=[Int32, System.Int32], @param27=[Int32, System.Int32], @param28=[System.DBNull, null], @param29=[System.DBNull, null], @param30=[System.DBNull, null], @param31=[System.DBNull, null], @param32=[Int32, System.Int32], @param33=[System.DBNull, null], @param34=[System.DBNull, null], @param35=[System.DBNull, null], @param36=[System.DBNull, null], @param37=[System.DBNull, null], @param38=[System.DBNull, null], @param39=[Int32, System.Int32], @param40=[Int32, System.Int32], @param41=[System.DBNull, null], @param42=[System.DBNull, null], @param43=[System.DBNull, null], @param44=[System.DBNull, null], @param45=[System.DBNull, null], @param46=[System.DBNull, null], @param47=[System.DBNull, null], @param48=[System.DBNull, null], @param49=[System.DBNull, null], @param50=[System.DBNull, null], @param51=[System.DBNull, null], @param52=[System.DBNull, null], @param53=[System.DBNull, null], @param54=[System.DBNull, null], @param55=[System.DBNull, null], @param56=[System.DBNull, null], @param57=[System.DBNull, null], @param58=[System.DBNull, null], @param59=[Int32, System.Int32], @param60=[Int32, System.Int32], @param61=[Int32, System.Int32], @param62=[Int32, System.Int32], @param63=[System.DBNull, null], @param64=[String, System.String], @param65=[System.DBNull, null], @param66=[System.DBNull, null], @param67=[System.DBNull, null], @param68=[System.DBNull, null], @param69=[System.DBNull, null], @param70=[System.DBNull, null], @param71=[String, System.String], @param72=[DateTime, System.DateTime], @param73=[String, System.String], @param74=[System.DBNull, null], @param75=[System.DBNull, null], @param76=[System.DBNull, null], @param77=[System.DBNull, null], @param78=[String, System.String], @param79=[Int32, System.Int32], @param80=[System.DBNull, null], @param81=[System.DBNull, null]]
2019-09-20 15:46:15,960 [1] DEBUG - Statement Id: [DAO00027_ThongTinTiepNhanCOM006] PreparedStatement : [select distinct CONVERT(VARCHAR(11),A.NGAYTIEPNHAN,103) as NGAYYEUCAU, C.DICHVU_ID, C.DVYEUCAU_ID, D.TENDICHVU, C.NOITHUCHIEN_ID,        A.SOTIEPNHAN, A.TRAITUYEN, A.NGAYMIENDONGCHITRA, A.TIEPNHAN_ID, A.DOITUONG_ID, A.TRANGTHAI,        A.LOAITHANHVIEN_ID, A.SUDUNG_BHTN, A.THE_ID, A.THANHVIEN_ID, A.VIP, A.NGUON_BENHNHAN_ID, A.BAOLANH_VIENPHI,        CASE WHEN (A.TRANGTHAI = 'NOITRU' OR A.TRANGTHAI = 'CAPCUU'   or A.TRANGTHAI = 'NGOAITRU') THEN 'IN' ELSE 'OUT' END AS LOAIBENHAN,        CASE WHEN (C.TRANGTHAI = 'CHUAKETQUA') THEN 'CHUAKETQUA' ELSE 'HOANTAT' END AS TRANGTHAIDICHVU, A.SOBHYT,        B.*,        CASE WHEN Left(E.MANHOMDICHVU,2) = '03' THEN '02' ELSE Left(E.MANHOMDICHVU,2) END AS MANHOMDICHVU        , A.UUTIEN        from TT_TIEPNHAN A        inner join TT_BENHNHAN B on B.BENHNHAN_ID = A.BENHNHAN_ID and (A.TRANGTHAI = 'DATIEPNHAN' or A.TRANGTHAI = 'NOITRU' or A.TRANGTHAI = 'CAPCUU'  or A.TRANGTHAI = 'NGOAITRU') and B.ACTIVE = '1'        inner join TT_DVYEUCAU C on C.TIEPNHAN_ID = A.TIEPNHAN_ID        left join TM_DICHVU D on D.DICHVU_ID = C.DICHVU_ID        left join TM_NHOMDICHVU E on E.NHOMDICHVU_ID = D.NHOMDICHVU_ID        where C.NGAYHENCLS is NULL and A.TIEPNHAN_ID = '27478' and C.DICHVU_ID = '5685' and A.BENHVIEN_ID = 'HLU01'         and           C.DVYEUCAU_ID = '205440']
2019-09-20 15:46:16,429 [1] DEBUG - Statement Id: [DAO00027_ThongTinTiepNhanCOM015] PreparedStatement : [declare @ManhomDSA varchar(10);        select top 1  @ManhomDSA = VALUE from TM_SYS_APPSETTINGS where CODE = 'MANHOM_DICHVU_DSA'        SELECT * FROM        (        SELECT        (A.SOTIEPNHAN + (CASE WHEN Left(E.MANHOMDICHVU,2) = '03' THEN '02' ELSE Left(E.MANHOMDICHVU,2) END) + LTRIM(C.NOITHUCHIEN_ID)) AS acss_lookupID,        ROW_NUMBER() OVER        (PARTITION BY (A.SOTIEPNHAN + (CASE WHEN Left(E.MANHOMDICHVU,2) = '03' THEN '02' ELSE Left(E.MANHOMDICHVU,2) END) + LTRIM(C.NOITHUCHIEN_ID))        ORDER BY (A.SOTIEPNHAN + (CASE WHEN Left(E.MANHOMDICHVU,2) = '03' THEN '02' ELSE Left(E.MANHOMDICHVU,2) END) + LTRIM(C.NOITHUCHIEN_ID)))        as num,        A.SOTIEPNHAN + (CASE WHEN Left(E.MANHOMDICHVU,2) = '03' THEN '02' ELSE Left(E.MANHOMDICHVU,2) END) + LTRIM(C.NOITHUCHIEN_ID) as KEYCOM15,        C.NOITHUCHIEN_ID, A.SOTIEPNHAN, A.TRAITUYEN, A.NGAYMIENDONGCHITRA, A.TIEPNHAN_ID, A.DOITUONG_ID, A.TRANGTHAI,        CASE WHEN (A.TRANGTHAI = 'NOITRU' OR A.TRANGTHAI = 'CAPCUU' or A.TRANGTHAI = 'NGOAITRU') THEN 'IN' ELSE 'OUT' END AS LOAIBENHAN,        CASE WHEN (C.TRANGTHAI = 'CHUAKETQUA') THEN 'CHUAKETQUA' ELSE 'HOANTAT' END AS TRANGTHAIDICHVU, A.SOBHYT,        B.*, F.TRANGTHAI as TRANGTHAI_BENHAN_NOITRU,        A.LOAITHANHVIEN_ID, A.SUDUNG_BHTN, A.THE_ID, A.THANHVIEN_ID, A.VIP, A.NGUON_BENHNHAN_ID, A.BAOLANH_VIENPHI,        CASE        WHEN @ManhomDSA is not null and E.MANHOMDICHVU in (@ManhomDSA) THEN E.MANHOMDICHVU        WHEN Left(E.MANHOMDICHVU,2) = '03' THEN '02' ELSE Left(E.MANHOMDICHVU,2) END AS MANHOMDICHVU        , A.UUTIEN        from TT_TIEPNHAN A        inner join TT_BENHNHAN B on B.BENHNHAN_ID = A.BENHNHAN_ID and (A.TRANGTHAI = 'DATIEPNHAN' or A.TRANGTHAI = 'NOITRU' or A.TRANGTHAI = 'CAPCUU' or A.TRANGTHAI = 'NGOAITRU') and B.ACTIVE = '1'        inner join TT_DVYEUCAU C on C.TIEPNHAN_ID = A.TIEPNHAN_ID        left join TM_DICHVU D on D.DICHVU_ID = C.DICHVU_ID        left join TM_NHOMDICHVU E on E.NHOMDICHVU_ID = D.NHOMDICHVU_ID        left join TT_NOITRU_BENHAN F on F.TIEPNHAN_ID = A.TIEPNHAN_ID        where C.NGAYHENCLS is NULL and A.TIEPNHAN_ID = '27478' and A.BENHVIEN_ID = 'HLU01'        ) a where a.num = 1]
2019-09-20 15:46:17,292 [1] DEBUG - Statement Id: [DAO00009_TT_TIEPNHAN_GetProcess] PreparedStatement : [select PROCESS_ID from TT_TIEPNHAN where SOTIEPNHAN = 'TN190920.0000001']
2019-09-20 15:46:17,369 [1] DEBUG - Statement Id: [DAOWF001_Kiemtrathongtindayeucaudacochua] PreparedStatement : [select * from TT_REQUEST        where        PARA = '{"HOSPITAL_ID":"HLU01","SOTIEPNHAN":"TN190920.0000001"}'        AND ISACTIVE = '1']
2019-09-20 15:46:17,423 [1] DEBUG - Statement Id: [DAOWF001_Kiemtrathongtindichvudayeucau] PreparedStatement : [select top 1 * from TT_REQUEST_SERVICE        where        PARA = '{"DICHVU_ID":"5685","DVYEUCAU_ID":"205440"}'                AND ISACTIVE = '1' order by ID desc]
2019-09-20 15:46:17,517 [1] DEBUG - Statement Id: [DAOWF001_KiemtrathongtinchitietDichvuYeucau] PreparedStatement : [select * from TT_REQUEST_SERVICE_DETAIL        where        REQUEST_SERVICE_ID = '']
2019-09-20 15:46:17,581 [1] DEBUG - Statement Id: [DAOWF001_GetStartStateOfProcess] PreparedStatement : [select STATE_CODE from TM_STATE where TYPE_CODE = 'S' and PROCESS_CODE = 'P02']
2019-09-20 15:46:17,611 [1] DEBUG - Statement Id: [DAOWF001_Laythongtinwithstatecode] PreparedStatement : [select A.*, B.STATUS_CODE from        TM_STATE_ACTION A        left join TM_STATE B on B.STATE_CODE = A.NEXT_STATE_CODE and A.PROCESS_CODE = B.PROCESS_CODE        where        A.CURR_STATE_CODE = '7'        AND A.PROCESS_CODE = 'P02'        Order By ORDER_ID ASC]
2019-09-20 15:46:17,643 [1] DEBUG - Statement Id: [DAOWF003_Add] PreparedStatement : [insert into TT_REQUEST_SERVICE (        REQUEST_ID        , PARA        , CURR_STATE_CODE        , PROCESS_CODE        ) values (         @param0         ,  @param1         ,  @param2         ,  @param3         )        SELECT SCOPE_IDENTITY()]
2019-09-20 15:46:17,644 [1] DEBUG - Statement Id: [DAOWF003_Add] Parameters: [@param0=[REQUEST_ID,31779], @param1=[SERVICEPARA,{"DICHVU_ID":"5685","DVYEUCAU_ID":"205440"}], @param2=[CURR_STATE_CODE,0], @param3=[PROCESS_CODE,P02]]
2019-09-20 15:46:17,644 [1] DEBUG - Statement Id: [DAOWF003_Add] Types: [@param0=[Int32, System.Int32], @param1=[String, System.String], @param2=[String, System.String], @param3=[String, System.String]]
2019-09-20 15:46:17,675 [1] DEBUG - Statement Id: [DAOWF005_Add] PreparedStatement : [insert into TT_REQUEST_SERVICE_DETAIL (        REQUEST_ID        ,REQUEST_SERVICE_ID        , OLD_STATE_CODE        , CURR_STATE_CODE        ) values (         @param0         , @param1         ,  @param2         ,  @param3         )        SELECT SCOPE_IDENTITY()]
2019-09-20 15:46:17,675 [1] DEBUG - Statement Id: [DAOWF005_Add] Parameters: [@param0=[REQUEST_ID,31779], @param1=[REQUEST_SERVICE_ID,147387], @param2=[OLD_STATE_CODE,null], @param3=[CURR_STATE_CODE,0]]
2019-09-20 15:46:17,675 [1] DEBUG - Statement Id: [DAOWF005_Add] Types: [@param0=[String, System.String], @param1=[Int64, System.Int64], @param2=[System.DBNull, null], @param3=[String, System.String]]
2019-09-20 15:46:17,707 [1] DEBUG - Statement Id: [DAOWF005_Add_History] PreparedStatement : [insert into TT_REQUEST_SERVICE_HISTORY (        REQUEST_ID        ,REQUEST_SERVICE_ID        , OLD_STATE_CODE        , CURR_STATE_CODE        ) values (         @param0         , @param1         ,  @param2         ,  @param3         )]
2019-09-20 15:46:17,707 [1] DEBUG - Statement Id: [DAOWF005_Add_History] Parameters: [@param0=[REQUEST_ID,31779], @param1=[REQUEST_SERVICE_ID,147387], @param2=[OLD_STATE_CODE,null], @param3=[CURR_STATE_CODE,0]]
2019-09-20 15:46:17,707 [1] DEBUG - Statement Id: [DAOWF005_Add_History] Types: [@param0=[String, System.String], @param1=[Int64, System.Int64], @param2=[System.DBNull, null], @param3=[String, System.String]]
2019-09-20 15:46:17,739 [1] DEBUG - Statement Id: [DAO00009_TT_DVYEUCAU_Update] PreparedStatement : [Update TT_DVYEUCAU set TRANGTHAI_WFL = 'CHUAKETQUA' where DVYEUCAU_ID = '205440']
2019-09-20 15:46:17,769 [1] DEBUG - Statement Id: [DAO00026_GetListDanhSachDichVuGhiNhanVTYT_COM25_WithTN] PreparedStatement : [select distinct CONVERT(VARCHAR(11),C.NGAYYEUCAU,103) as NGAYYEUCAU, C.DICHVU_ID, C.DVYEUCAU_ID, D.TENDICHVU, C.NOITHUCHIEN_ID, A.SOTIEPNHAN, A.TRAITUYEN, A.NGAYMIENDONGCHITRA, A.TIEPNHAN_ID, A.DOITUONG_ID, A.TRANGTHAI,            A.LOAITHANHVIEN_ID, A.SUDUNG_BHTN, A.THE_ID, A.THANHVIEN_ID, A.VIP, A.NGUON_BENHNHAN_ID, A.BAOLANH_VIENPHI,            CASE WHEN (A.TRANGTHAI = 'NOITRU' OR A.TRANGTHAI = 'CAPCUU') THEN 'IN' ELSE 'OUT' END AS LOAIBENHAN,            CASE WHEN (C.TRANGTHAI = 'CHUAKETQUA') THEN 'CHUAKETQUA' ELSE 'HOANTAT' END AS TRANGTHAIDICHVU,            B.*, isnull(ntba.SOBENHAN, '') SOBENHAN, isnull(ntba.BENHAN_ID, 0) BENHAN_ID,            CASE WHEN Left(E.MANHOMDICHVU,2) = '03' THEN '02' ELSE Left(E.MANHOMDICHVU,2) END AS MANHOMDICHVU            from TT_TIEPNHAN A            inner join TT_BENHNHAN B on B.BENHNHAN_ID = A.BENHNHAN_ID and B.ACTIVE = '1'            inner join TT_DVYEUCAU C on C.TIEPNHAN_ID = A.TIEPNHAN_ID                        left join TM_DICHVU D on D.DICHVU_ID = C.DICHVU_ID            left join TM_NHOMDICHVU E on E.NHOMDICHVU_ID = D.NHOMDICHVU_ID            left join TT_NOITRU_BENHAN ntba on ntba.BENHAN_ID = C.BENHAN_ID              where            C.NGAYHENCLS is NULL and A.BENHVIEN_ID = 'HLU01'            and (A.TRANGTHAI = 'DATIEPNHAN' or A.TRANGTHAI = 'NOITRU' or A.TRANGTHAI = 'CAPCUU' or A.TRANGTHAI = 'NGOAITRU')            and (CASE WHEN Left(E.MANHOMDICHVU,2) = '03' THEN '02' ELSE Left(E.MANHOMDICHVU,2) END in ('02', '04'))            and A.TIEPNHAN_ID = '27478']
2019-09-20 15:46:18,481 [1] DEBUG - Statement Id: [DAO00023_GetSOBHYT_HUONG_ID] PreparedStatement : [select isnull(MAX(SOBHYT_HUONG_ID),0) SOBHYT_HUONG_ID        from TT_TIEPNHAN_SOTHEBHYT        where TIEPNHAN_ID = '27478']
2019-09-20 15:46:18,518 [1] DEBUG - Statement Id: [DAO00064_GetTopTT_TIEPNHAN_SOTHEBHYT] PreparedStatement : [select top 1 stbhyt.*, ba.SOBENHAN,         tn.SOTIEPNHAN, tn.LOAITHANHVIEN_ID, tn.THE_ID, tn.THANHVIEN_ID,        tn.SUDUNG_BHTN, tn.BAOLANH_VIENPHI, tn.VIP, tn.NGUOINUOCNGOAI        from TT_TIEPNHAN_SOTHEBHYT stbhyt        left join TT_TIEPNHAN tn on tn.TIEPNHAN_ID = stbhyt.TIEPNHAN_ID        left join TT_NOITRU_BENHAN ba on ba.TIEPNHAN_ID = stbhyt.TIEPNHAN_ID        where         stbhyt.TIEPNHAN_ID = '27478' and isnull(stbhyt.KHONGSUDUNG, '0') = '0'              order by SOBHYT_HUONG_ID desc]
2019-09-20 15:46:18,583 [1] DEBUG - Statement Id: [DAO00006_GetListDuocTyle] PreparedStatement : [select DUOC_ID, DOITUONG_ID, (TYLE/100) as TYLE, DONGIA MUCTRAN_THANHTOAN from TM_DOITUONG_GIADUOC_TYLE            where            BENHVIEN_ID = 'HLU01'            and DOITUONG_ID = '4']
2019-09-20 15:46:18,613 [1] DEBUG - Statement Id: [DAO00027_GetListTuongTrinhDichVuPhauThuatCuaTiepNhan] PreparedStatement : [declare @ManhomDSA varchar(10);        declare @PhanLoaiNhomDV varchar(20) = '05';        select top 1  @ManhomDSA = VALUE from TM_SYS_APPSETTINGS where CODE = 'MANHOM_DICHVU_DSA'        if (@ManhomDSA is not null) set @PhanLoaiNhomDV += ',' + @ManhomDSA        select distinct ptyc.*        from TT_PHAUTHUAT_YEUCAU ptyc        inner join TM_DICHVU dv on dv.DICHVU_ID = ptyc.DICHVU_ID        inner join TM_NHOMDICHVU ndv on ndv.NHOMDICHVU_ID = dv.NHOMDICHVU_ID        inner join TT_PHAUTHUAT pt on pt.PHAUTHUAT_ID = ptyc.PHAUTHUAT_ID        where        pt.TIEPNHAN_ID = 27478        and (left(ndv.MANHOMDICHVU, 2) in (select * from STRING_SPLIT(@PhanLoaiNhomDV,',')) or ndv.MANHOMDICHVU in (select * from STRING_SPLIT(@PhanLoaiNhomDV,',')))]
2019-09-20 15:46:18,699 [1] DEBUG - Statement Id: [DAO00006_GetList] PreparedStatement : [select dv.*, loaiDV.MALOAIDICHVU, captren.NHOMDICHVU_ID as NHOMDICHVU_CAPTREN_ID, captren.TENNHOMDICHVU as NHOMDICHVU_CAPTREN,              nhom_dv.TENNHOMDICHVU as TENNHOMDICHVU, nhom_dv.MANHOMDICHVU,              case when dv.ATTRIBUTE5 is null then 'TT' else 'KTC' end as LOAI_CHIPHI              from TM_DICHVU as dv              left join TM_NHOMDICHVU as nhom_dv on nhom_dv.NHOMDICHVU_ID = dv.NHOMDICHVU_ID and nhom_dv.BENHVIEN_ID = 'HLU01'              left join TM_NHOMDICHVU as captren on nhom_dv.CAPTREN_ID = captren.NHOMDICHVU_ID and captren.BENHVIEN_ID = 'HLU01'              left join TM_LOAIDICHVU loaiDV on nhom_dv.LOAIDICHVU_ID = loaiDV.LOAIDICHVU_ID and loaiDV.BENHVIEN_ID = 'HLU01'              where nhom_dv.TAMNGUNG = '0' and dv.BENHVIEN_ID = 'HLU01'              and dv.TAMNGUNG = '0'               AND                   loaiDV.MALOAIDICHVU = 'KhamBenh']
2019-09-20 15:46:18,793 [1] DEBUG - Statement Id: [DAO00023_Add] PreparedStatement : [insert into TT_VIENPHI (        TIEPNHAN_ID        , BENHAN_ID         ,           BENHNHAN_ID         ,           DOTDIEUTRI_ID                 , KHAMBENH_ID        , REF_ID        , REF_TABLE        , DICHVU_ID        , DUOC_ID        , LOAI_CHIPHI        , LOAIGIA_ID        , SOLUONG        , DONGIA_DOANHTHU        , THANHTIEN_DOANHTHU        , BHYT_TL        , BHYT_DONGIA        , BHYT_THANHTIEN        , BHYT_DONGIA_CHITRA        , BHYT_THANHTIEN_CHITRA        , BENHNHAN_PHAITHANHTOAN        , GIATRI_HOADON        , GIATRI_HOADON_DATHANHTOAN        , GIATRI_BIENLAI        , GIATRI_BIENLAI_DATHANHTOAN        , GIATRI_BENHNHAN_DATHANHTOAN        , GIATRI_THATTHU        , MIENGIAM_TL        , MIENGIAM_GIATRI        , NGANSACH_TL        , NGANSACH_GIATRI        , TAITRO_TL        , TAITRO_GIATRI        , BHTN_TL        , BHTN_DONGIA        , BHTN_THANHTIEN        , BHTN_DONGIA_CHITRA        , BHTN_THANHTIEN_CHITRA         ,           DUOCPHEPTHUCHIEN         ,           HUY         ,           DATHANHTOAN         ,           DATHUCHIEN         ,           KHONGTHUTIEN         ,           BHYTDONGTIEN                 , DUYET        , HOADON_ID         ,           ACTIVE         ,           TYLE_VAT         ,           GIAVON         ,           BANGGIA_ID                 , BENHVIEN_ID        , NGUOITAO_ID        , NGAYTAO        , NGUOICAPNHAT_ID        , NGAYCAPNHAT        , DONGIA_BHYT_BANDAU        , DONGIADOANHTHU_BANDAU         ,           YEUCAUVP         ,           DOITUONG_HUONG_ID         ,           SOBHYT_HUONG_ID         ,           DICHVU_TL                 ) values (         @param0         ,  @param1          ,            @param2          ,            @param3                  ,  @param4         ,  @param5         ,  @param6         ,  @param7         ,  @param8         ,  @param9         ,  @param10         ,  @param11         ,  @param12         ,  @param13         ,  @param14         ,  @param15         ,  @param16         ,  @param17         ,  @param18         ,  @param19         ,  @param20         ,  @param21         ,  @param22         ,  @param23         ,  @param24         ,  @param25         ,  @param26         ,  @param27         ,  @param28         ,  @param29         ,  @param30         ,  @param31         ,  @param32         ,  @param33         ,  @param34         ,  @param35         ,  @param36          ,            @param37          ,            @param38          ,            @param39          ,            @param40          ,            @param41          ,            @param42                  ,  @param43         ,  @param44          ,            @param45          ,            @param46          ,            @param47          ,            @param48                  ,  @param49         ,  @param50         ,  @param51         ,  @param52         ,  @param53         ,  @param54         ,  @param55          ,            @param56          ,            @param57          ,            @param58          ,            @param59                  )        SELECT SCOPE_IDENTITY()]
2019-09-20 15:46:18,793 [1] DEBUG - Statement Id: [DAO00023_Add] Parameters: [@param0=[TIEPNHAN_ID,27478], @param1=[BENHAN_ID,null], @param2=[BENHNHAN_ID,23423], @param3=[DOTDIEUTRI_ID,0], @param4=[KHAMBENH_ID,null], @param5=[REF_ID,205440], @param6=[REF_TABLE,TT_DVYEUCAU], @param7=[DICHVU_ID,5685], @param8=[DUOC_ID,null], @param9=[LOAI_CHIPHI,TT], @param10=[LOAIGIA_ID,2], @param11=[SOLUONG,1], @param12=[DONGIA_DOANHTHU,33000], @param13=[THANHTIEN_DOANHTHU,33000], @param14=[BHYT_TL,1], @param15=[BHYT_DONGIA,33000], @param16=[BHYT_THANHTIEN,33000], @param17=[BHYT_DONGIA_CHITRA,33000], @param18=[BHYT_THANHTIEN_CHITRA,33000], @param19=[BENHNHAN_PHAITHANHTOAN,0], @param20=[GIATRI_HOADON,0], @param21=[GIATRI_HOADON_DATHANHTOAN,0], @param22=[GIATRI_BIENLAI,0], @param23=[GIATRI_BIENLAI_DATHANHTOAN,0], @param24=[GIATRI_BENHNHAN_DATHANHTOAN,0], @param25=[GIATRI_THATTHU,0], @param26=[MIENGIAM_TL,0], @param27=[MIENGIAM_GIATRI,0], @param28=[NGANSACH_TL,0], @param29=[NGANSACH_GIATRI,0], @param30=[TAITRO_TL,0], @param31=[TAITRO_GIATRI,0], @param32=[BHTN_TL,0], @param33=[BHTN_DONGIA,0], @param34=[BHTN_THANHTIEN,0], @param35=[BHTN_DONGIA_CHITRA,0], @param36=[BHTN_THANHTIEN_CHITRA,0], @param37=[DUOCPHEPTHUCHIEN,0], @param38=[HUY,0], @param39=[DATHANHTOAN,0], @param40=[DATHUCHIEN,0], @param41=[KHONGTHUTIEN,0], @param42=[BHYTDONGTIEN,0], @param43=[DUYET,null], @param44=[HOADON_ID,null], @param45=[ACTIVE,1], @param46=[TYLE_VAT,0], @param47=[GIAVON,0], @param48=[BANGGIA_ID,996], @param49=[BENHVIEN_ID,HLU01], @param50=[NGUOITAO_ID,1], @param51=[NGAYTAO,9/20/2019 3:46:18 PM], @param52=[NGUOICAPNHAT_ID,1], @param53=[NGAYCAPNHAT,9/20/2019 3:46:18 PM], @param54=[DONGIA_BHYT_BANDAU,33000], @param55=[DONGIADOANHTHU_BANDAU,33000], @param56=[YEUCAUVP,0], @param57=[DOITUONG_HUONG_ID,4], @param58=[SOBHYT_HUONG_ID,28501], @param59=[DICHVU_TL,1]]
2019-09-20 15:46:18,793 [1] DEBUG - Statement Id: [DAO00023_Add] Types: [@param0=[Int32, System.Int32], @param1=[System.DBNull, null], @param2=[Int32, System.Int32], @param3=[Int32, System.Int32], @param4=[System.DBNull, null], @param5=[Int32, System.Int32], @param6=[String, System.String], @param7=[Int32, System.Int32], @param8=[System.DBNull, null], @param9=[String, System.String], @param10=[Int32, System.Int32], @param11=[Decimal, System.Decimal], @param12=[Decimal, System.Decimal], @param13=[Decimal, System.Decimal], @param14=[Decimal, System.Decimal], @param15=[Decimal, System.Decimal], @param16=[Decimal, System.Decimal], @param17=[Decimal, System.Decimal], @param18=[Decimal, System.Decimal], @param19=[Decimal, System.Decimal], @param20=[Decimal, System.Decimal], @param21=[Decimal, System.Decimal], @param22=[Decimal, System.Decimal], @param23=[Decimal, System.Decimal], @param24=[Decimal, System.Decimal], @param25=[Decimal, System.Decimal], @param26=[Decimal, System.Decimal], @param27=[Decimal, System.Decimal], @param28=[Decimal, System.Decimal], @param29=[Decimal, System.Decimal], @param30=[Decimal, System.Decimal], @param31=[Decimal, System.Decimal], @param32=[Decimal, System.Decimal], @param33=[Decimal, System.Decimal], @param34=[Decimal, System.Decimal], @param35=[Decimal, System.Decimal], @param36=[Decimal, System.Decimal], @param37=[Int32, System.Int32], @param38=[Int32, System.Int32], @param39=[Int32, System.Int32], @param40=[Int32, System.Int32], @param41=[String, System.String], @param42=[String, System.String], @param43=[System.DBNull, null], @param44=[System.DBNull, null], @param45=[Int32, System.Int32], @param46=[Int32, System.Int32], @param47=[Decimal, System.Decimal], @param48=[Int32, System.Int32], @param49=[String, System.String], @param50=[String, System.String], @param51=[DateTime, System.DateTime], @param52=[String, System.String], @param53=[DateTime, System.DateTime], @param54=[Decimal, System.Decimal], @param55=[Decimal, System.Decimal], @param56=[String, System.String], @param57=[Int32, System.Int32], @param58=[Int32, System.Int32], @param59=[Decimal, System.Decimal]]
2019-09-20 15:46:18,996 [1] DEBUG - Statement Id: [DAO00064_GetREGListVienphiTiepNhan] PreparedStatement : [select A.*, B.THUTIENSAU        from TT_VIENPHI A        left join TT_DVYEUCAU B on A.REF_ID =  B.DVYEUCAU_ID and A.REF_TABLE = 'TT_DVYEUCAU' and B.HUYYEUCAU = '0'        where        A.TIEPNHAN_ID = '27478' and A.BENHVIEN_ID = 'HLU01' and (A.BENHAN_ID is NULL or A.BENHAN_ID = '')        and A.HUY = '0'        ORDER BY A.VIENPHI_ID]
2019-09-20 15:46:19,063 [1] DEBUG - Statement Id: [DAO00064_GetTopTT_TIEPNHAN_SOTHEBHYT] PreparedStatement : [select top 1 stbhyt.*, ba.SOBENHAN,         tn.SOTIEPNHAN, tn.LOAITHANHVIEN_ID, tn.THE_ID, tn.THANHVIEN_ID,        tn.SUDUNG_BHTN, tn.BAOLANH_VIENPHI, tn.VIP, tn.NGUOINUOCNGOAI        from TT_TIEPNHAN_SOTHEBHYT stbhyt        left join TT_TIEPNHAN tn on tn.TIEPNHAN_ID = stbhyt.TIEPNHAN_ID        left join TT_NOITRU_BENHAN ba on ba.TIEPNHAN_ID = stbhyt.TIEPNHAN_ID        where         stbhyt.TIEPNHAN_ID = '27478' and isnull(stbhyt.KHONGSUDUNG, '0') = '0'              order by SOBHYT_HUONG_ID desc]
2019-09-20 15:46:19,097 [1] DEBUG - Statement Id: [DAO00006_GetListDuocTyle] PreparedStatement : [select DUOC_ID, DOITUONG_ID, (TYLE/100) as TYLE, DONGIA MUCTRAN_THANHTOAN from TM_DOITUONG_GIADUOC_TYLE            where            BENHVIEN_ID = 'HLU01'            and DOITUONG_ID = '4']
2019-09-20 15:46:19,213 [1] DEBUG - Statement Id: [DAO00027_GetListTuongTrinhDichVuPhauThuatCuaTiepNhan] PreparedStatement : [declare @ManhomDSA varchar(10);        declare @PhanLoaiNhomDV varchar(20) = '05';        select top 1  @ManhomDSA = VALUE from TM_SYS_APPSETTINGS where CODE = 'MANHOM_DICHVU_DSA'        if (@ManhomDSA is not null) set @PhanLoaiNhomDV += ',' + @ManhomDSA        select distinct ptyc.*        from TT_PHAUTHUAT_YEUCAU ptyc        inner join TM_DICHVU dv on dv.DICHVU_ID = ptyc.DICHVU_ID        inner join TM_NHOMDICHVU ndv on ndv.NHOMDICHVU_ID = dv.NHOMDICHVU_ID        inner join TT_PHAUTHUAT pt on pt.PHAUTHUAT_ID = ptyc.PHAUTHUAT_ID        where        pt.TIEPNHAN_ID = 27478        and (left(ndv.MANHOMDICHVU, 2) in (select * from STRING_SPLIT(@PhanLoaiNhomDV,',')) or ndv.MANHOMDICHVU in (select * from STRING_SPLIT(@PhanLoaiNhomDV,',')))]
2019-09-20 15:46:19,252 [1] DEBUG - Statement Id: [DAO00006_GetList] PreparedStatement : [select dv.*, loaiDV.MALOAIDICHVU, captren.NHOMDICHVU_ID as NHOMDICHVU_CAPTREN_ID, captren.TENNHOMDICHVU as NHOMDICHVU_CAPTREN,              nhom_dv.TENNHOMDICHVU as TENNHOMDICHVU, nhom_dv.MANHOMDICHVU,              case when dv.ATTRIBUTE5 is null then 'TT' else 'KTC' end as LOAI_CHIPHI              from TM_DICHVU as dv              left join TM_NHOMDICHVU as nhom_dv on nhom_dv.NHOMDICHVU_ID = dv.NHOMDICHVU_ID and nhom_dv.BENHVIEN_ID = 'HLU01'              left join TM_NHOMDICHVU as captren on nhom_dv.CAPTREN_ID = captren.NHOMDICHVU_ID and captren.BENHVIEN_ID = 'HLU01'              left join TM_LOAIDICHVU loaiDV on nhom_dv.LOAIDICHVU_ID = loaiDV.LOAIDICHVU_ID and loaiDV.BENHVIEN_ID = 'HLU01'              where nhom_dv.TAMNGUNG = '0' and dv.BENHVIEN_ID = 'HLU01'              and dv.TAMNGUNG = '0'               AND                   loaiDV.MALOAIDICHVU = 'KhamBenh']
2019-09-20 15:46:19,305 [1] DEBUG - Statement Id: [DAO00023_Update_VPTiepnhan] PreparedStatement : [update TT_VIENPHI set        TIEPNHAN_ID =  @param0                ,           BENHNHAN_ID =  @param1          ,           REF_ID =  @param2                  , REF_TABLE =  @param3         , DICHVU_ID =  @param4         , DUOC_ID =  @param5         , LOAI_CHIPHI =  @param6         , LOAIGIA_ID =  @param7         , SOLUONG =  @param8         , DONGIA_DOANHTHU =  @param9         , THANHTIEN_DOANHTHU =  @param10         , BHYT_TL =  @param11         , BHYT_DONGIA =  @param12         , BHYT_THANHTIEN =  @param13         , BHYT_DONGIA_CHITRA =  @param14         , BHYT_THANHTIEN_CHITRA =  @param15         , BENHNHAN_PHAITHANHTOAN =  @param16         , GIATRI_HOADON =  @param17         , GIATRI_HOADON_DATHANHTOAN =  @param18         , GIATRI_BIENLAI =  @param19         , GIATRI_BIENLAI_DATHANHTOAN =  @param20         , GIATRI_BENHNHAN_DATHANHTOAN =  @param21         , GIATRI_THATTHU =  @param22         , MIENGIAM_TL =  @param23         , NGANSACH_TL =  @param24         , NGANSACH_GIATRI =  @param25         , TAITRO_TL =  @param26         , TAITRO_GIATRI =  @param27         , BHTN_TL =  @param28         , BHTN_DONGIA =  @param29         , BHTN_THANHTIEN =  @param30         , BHTN_DONGIA_CHITRA =  @param31         , BHTN_THANHTIEN_CHITRA =  @param32          ,           TYLE_VAT =  @param33          ,           GIAVON =  @param34          ,           BANGGIA_ID =  @param35          ,           BHYTDONGTIEN =  @param36          ,           BHYT_DONGIA_CONGKHAM_DAU =  @param37          ,           BHYT_CONGKHAM_DAU_TYLE =  @param38                  , BENHVIEN_ID =  @param39         , NGUOICAPNHAT_ID =  @param40         , NGAYCAPNHAT =  @param41          ,           YEUCAUVP =  @param42                        where                    VIENPHI_ID = '674724' and DATHANHTOAN = '0']
2019-09-20 15:46:19,306 [1] DEBUG - Statement Id: [DAO00023_Update_VPTiepnhan] Parameters: [@param0=[TIEPNHAN_ID,27478], @param1=[BENHNHAN_ID,23423], @param2=[REF_ID,205440], @param3=[REF_TABLE,TT_DVYEUCAU], @param4=[DICHVU_ID,5685], @param5=[DUOC_ID,null], @param6=[LOAI_CHIPHI,TT], @param7=[LOAIGIA_ID,2], @param8=[SOLUONG,1.0000], @param9=[DONGIA_DOANHTHU,33000.0000], @param10=[THANHTIEN_DOANHTHU,33000.00], @param11=[BHYT_TL,1], @param12=[BHYT_DONGIA,33000.0000], @param13=[BHYT_THANHTIEN,33000.00], @param14=[BHYT_DONGIA_CHITRA,33000], @param15=[BHYT_THANHTIEN_CHITRA,33000.00], @param16=[BENHNHAN_PHAITHANHTOAN,0], @param17=[GIATRI_HOADON,0], @param18=[GIATRI_HOADON_DATHANHTOAN,0], @param19=[GIATRI_BIENLAI,0], @param20=[GIATRI_BIENLAI_DATHANHTOAN,0], @param21=[GIATRI_BENHNHAN_DATHANHTOAN,0], @param22=[GIATRI_THATTHU,0], @param23=[MIENGIAM_TL,0], @param24=[NGANSACH_TL,0], @param25=[NGANSACH_GIATRI,0], @param26=[TAITRO_TL,0], @param27=[TAITRO_GIATRI,0], @param28=[BHTN_TL,0], @param29=[BHTN_DONGIA,0], @param30=[BHTN_THANHTIEN,0], @param31=[BHTN_DONGIA_CHITRA,0], @param32=[BHTN_THANHTIEN_CHITRA,0], @param33=[TYLE_VAT,0], @param34=[GIAVON,0.0000], @param35=[BANGGIA_ID,996], @param36=[BHYTDONGTIEN,0], @param37=[BHYT_DONGIA_CONGKHAM_DAU,33000.0000], @param38=[BHYT_CONGKHAM_DAU_TYLE,1], @param39=[BENHVIEN_ID,HLU01], @param40=[NGUOICAPNHAT_ID,1], @param41=[NGAYCAPNHAT,9/20/2019 3:46:19 PM], @param42=[YEUCAUVP,0]]
2019-09-20 15:46:19,306 [1] DEBUG - Statement Id: [DAO00023_Update_VPTiepnhan] Types: [@param0=[Int32, System.Int32], @param1=[Int32, System.Int32], @param2=[Int32, System.Int32], @param3=[String, System.String], @param4=[Int32, System.Int32], @param5=[System.DBNull, null], @param6=[String, System.String], @param7=[Int32, System.Int32], @param8=[Decimal, System.Decimal], @param9=[Decimal, System.Decimal], @param10=[Decimal, System.Decimal], @param11=[Decimal, System.Decimal], @param12=[Decimal, System.Decimal], @param13=[Decimal, System.Decimal], @param14=[Decimal, System.Decimal], @param15=[Decimal, System.Decimal], @param16=[Decimal, System.Decimal], @param17=[Decimal, System.Decimal], @param18=[Decimal, System.Decimal], @param19=[Decimal, System.Decimal], @param20=[Decimal, System.Decimal], @param21=[Decimal, System.Decimal], @param22=[Decimal, System.Decimal], @param23=[Decimal, System.Decimal], @param24=[Decimal, System.Decimal], @param25=[Decimal, System.Decimal], @param26=[Decimal, System.Decimal], @param27=[Decimal, System.Decimal], @param28=[Decimal, System.Decimal], @param29=[Decimal, System.Decimal], @param30=[Decimal, System.Decimal], @param31=[Decimal, System.Decimal], @param32=[Decimal, System.Decimal], @param33=[Int32, System.Int32], @param34=[Decimal, System.Decimal], @param35=[Int32, System.Int32], @param36=[String, System.String], @param37=[Decimal, System.Decimal], @param38=[Decimal, System.Decimal], @param39=[String, System.String], @param40=[Int32, System.Int32], @param41=[DateTime, System.DateTime], @param42=[String, System.String]]
2019-09-20 15:46:19,424 [1] DEBUG - Statement Id: [DAO00019_GetDetails_TiepNhan] PreparedStatement : [select tn.TIEPNHAN_ID, tn.SOTIEPNHAN, tn.SOBHYT as SOTHE, tn.BHYTTUNGAY as NGAYHIEULUC,        tn.BHYTDENNGAY as NGAYHETHIEULUC, tn.BHYTNGAYCAP as NGAYCAP, tn.BHYTTREN3NAM as TREN3NAM, tn.KHUVUCSONG_ID,        tn.BHYTTREN5NAM as TREN5NAM,tn.NGAYMIENDONGCHITRA,tn.NOIGIOITHIEU_ID, tn.NGUOIGIOITHIEU_ID, tn.CHANDOANNGT,        tn.NOITIEPNHAN_ID, tn.DOITUONG_ID, tn.TRAITUYEN, tn.HINHTHUCDENKHAM_ID, tn.THOIGIANTIEPNHAN,        dv.DVYEUCAU_ID, dv.DICHVU_ID, dv.NOITHUCHIEN_ID as PHONGBAN_ID,        dv.NGUOITAO_ID as DV_NGUOITAO_ID, dv.NGAYTAO as DV_NGAYTAO, dv.THUTIENSAU, dv.BACSICHIDINH_ID, dv.NGUOICHIDINH_ID,        dv.NGUOICAPNHAT_ID as DV_NGUOICAPNHAT_ID, dv.NGAYCAPNHAT as DV_NGAYCAPNHAT,        vp.VIENPHI_ID, vp.KHONGTHUTIEN, vp.LOAI_CHIPHI, vp.LOAIGIA_ID as LOAIGIA,        vp.DATHUCHIEN, vp.DATHANHTOAN, vp.DONGIA_DOANHTHU,        dv.NOITHUCHIEN_ID, dv.TRANGTHAI,        vp.NGUOITAO_ID as VP_NGUOITAO_ID, vp.BHYT_DONGIA, vp.TYLE_VAT, vp.BANGGIA_ID, vp.GIAVON,        tn.NGAYTAO as TN_NGAYTAO,        vp.NGAYTAO as VP_NGAYTAO, vp.NGUOICAPNHAT_ID as VP_NGUOICAPNHAT_ID, vp.NGAYCAPNHAT as VP_NGAYCAPNHAT,        tn.SOCHUYENVIEN, tn.THOIGIANCHUYENTUYEN, tn.HINHTHUCCHUYENVIEN_ID, tn.LYDOCHUYENVIEN_ID, tn.ICDNOIGIOITHIEU_ID,        tn.SUDUNG_BHTN, tn.THE_ID, tn.LOAITHANHVIEN_ID, tn.THANHVIEN_ID, tn.VIP, tn.GHICHU_TIEPNHAN, tn.BAOLANH_VIENPHI        , tn.CONGTY_CHITRA_ID, tn.TRANGTHAI as TRANGTHAI_TIEPNHAN, tn.NGUOITAO_ID as TN_NGUOITAO_ID, tn.TINHTRANGHEN        , tn.NGUON_BENHNHAN_ID, tn.THONGTIN_KCB_BHYT, tn.LOAITIEPNHAN_ID, tn.LYDODENKHAM, vp.YEUCAUVP        from (        select top 1 *        from TT_TIEPNHAN        where BENHVIEN_ID = 'HLU01'                 order by                 SOTIEPNHAN desc        ) as tn        left join TT_DVYEUCAU dv on dv.TIEPNHAN_ID = tn.TIEPNHAN_ID and dv.HUYYEUCAU = '0'        left join TT_VIENPHI vp on vp.TIEPNHAN_ID = tn.TIEPNHAN_ID and vp.DICHVU_ID = dv.DICHVU_ID  and dv.DVYEUCAU_ID = vp.REF_ID]
2019-09-20 15:46:35,657 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'OPD22'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2019-09-20 15:46:36,506 [1] DEBUG - Statement Id: [DAO00019_GetDanhsachKhambenh] PreparedStatement : [select *        from        (SELECT COUNT(*) OVER() as TOTALROWS, ROW_NUMBER() OVER(order by isnull(dv.SOTHUTU,'999999999'), dv.NGAYGIOYEUCAU) as ROWNUMBER,        bn.MAYTE, bn.TENBENHNHAN, bn.NAMSINH, bn.NGAYSINH as TUOI, ISNULL(CONVERT(VARCHAR(10), bn.NGAYSINH, 103),CAST(bn.NAMSINH AS varchar)) as NGAYSINH, bn.DIACHILIENLAC as DIACHI, bn.GIOITINH, GD.DESCRIPTION as TENGIOITINH,        tn.DOITUONG_ID, tn.THOIGIANTIEPNHAN, tn.BENHNHAN_ID, tn.TIEPNHAN_ID, tn.TRAITUYEN, tn.SOTIEPNHAN,        dv.DICHVU_ID, dv.NOITHUCHIEN_ID, isnull(dv.NGAYTAO, dv.NGAYCAPNHAT) as THOIGIANDKDICHVU,        dv.KHAN, dv.NOIYEUCAU_ID, dv.NGAYGIOYEUCAU, dv.BACSICHIDINH_ID, dv.DONVIGIOITHIEU_ID, dv.NGUOIGIOITHIEU_ID,        tn.NOIGIOITHIEU_ID, kbnt.HUONGGIAIQUYET_ID,        dv.DVYEUCAU_ID, dv.MARIS, dv.TRANGTHAI as TRANGTHAICODE, B.TENNHOMDICHVU, dv.SOPHIEUYEUCAU, dv.KHAMBENH_NGOAITRU_ID, dv.NGUOICAPNHAT_ID, dv.NGAYCAPNHAT,        CASE WHEN Left(B.MANHOMDICHVU,2) = '03' THEN '02' ELSE Left(B.MANHOMDICHVU,2) END AS MANHOMDICHVU, B.MANHOMDICHVU as MANHOMDICHVUCHITIET, tn.TRANGTHAI as TRANGTHAI_TIEPNHAN,        'False' as DAKHAM, isnull(dv.SOTHUTU,'999999999') as SOHANGDOI,        vp.DATHANHTOAN, dv.TRANGTHAI_WFL,        BA.SOBENHAN, dv.CHANDOAN, dt.TENDOITUONG, isnull(kbnt.THOIGIANKHAM, dv.NGAYCAPNHAT) as THOIGIANKHAM,        tn.SOBHYT        FROM TT_DVYEUCAU (NOLOCK) dv        inner join TT_TIEPNHAN (NOLOCK) tn on dv.TIEPNHAN_ID = tn.TIEPNHAN_ID        inner join TT_BENHNHAN (NOLOCK) bn on tn.BENHNHAN_ID = bn.BENHNHAN_ID        inner join TM_DICHVU A on A.DICHVU_ID = dv.DICHVU_ID        inner join TM_NHOMDICHVU B on B.NHOMDICHVU_ID = A.NHOMDICHVU_ID        inner join TT_VIENPHI(NOLOCK) VP on VP.TIEPNHAN_ID = tn.TIEPNHAN_ID and VP.DICHVU_ID = dv.DICHVU_ID and VP.REF_ID = dv.DVYEUCAU_ID        left join TT_NOITRU_BENHAN (NOLOCK) BA on BA.TIEPNHAN_ID = tn.TIEPNHAN_ID AND dv.BENHAN_ID = BA.BENHAN_ID        inner join TM_GENDER GD on GD.ID = bn.GIOITINH        left join TT_NGOAITRU_KHAMBENH (NOLOCK) kbnt on kbnt.KHAMBENH_ID = dv.KHAMBENH_NGOAITRU_ID        inner join TM_DOITUONG dt on dt.DOITUONG_ID = tn.DOITUONG_ID        where        dv.DICHVU_ID IS NOT NULL        and tn.BENHVIEN_ID = 'HLU01'        and HUYYEUCAU = 0        and dv.NGAYHENCLS is NULL         and           dv.NGAYYEUCAU >= '9/20/2019 12:00:00 AM'         and           dv.NGAYYEUCAU <= '9/20/2019 12:00:00 AM'         and           dv.NOITHUCHIEN_ID = 58          AND             (                         ((dv.TRANGTHAI_WFL = 'CHUAKETQUA' or (dv.TRANGTHAI = 'CHUAKETQUA' and dv.TRANGTHAI_WFL = 'HOANTHANH')) and (isnull(kbnt.HUONGGIAIQUYET_ID, 0) = 0)))            and (tn.TRANGTHAI != 'HOANTHANH')           and           (CASE WHEN Left(B.MANHOMDICHVU,2) = '03' THEN '02' ELSE Left(B.MANHOMDICHVU,2) END) = '04'                 ) lst                    where          lst.ROWNUMBER between 1 and 20                 order by SOHANGDOI, NGAYGIOYEUCAU asc]
2019-09-20 15:46:40,441 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'OPD02'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2019-09-20 15:46:42,347 [1] DEBUG - Statement Id: [DAO00017_GetLoaiGiaByDoiTuongId] PreparedStatement : [select dtlg.DOUUTIEN, dtlg.DOITUONG_ID, lg.LOAIGIA_ID, lg.TENLOAIGIA, lg.MALOAIGIA              from TM_LOAIGIA lg              left join TM_DOITUONG_LOAIGIA dtlg              on lg.LOAIGIA_ID = dtlg.LOAIGIA_ID and dtlg.BENHVIEN_ID = 'HLU01'              where lg.TAMNGUNG = 0 and lg.BENHVIEN_ID = 'HLU01'                             order by dtlg.DOUUTIEN]
2019-09-20 15:46:42,744 [1] DEBUG - Statement Id: [DAO00092_GetList_ToathuocNgoaitru] PreparedStatement : [select A.*, B.PHAMVI_ID, C.KHODUOC_ID from TM_TOATHUOC_NGOAITRU A        left join TM_DUOC_PHAMVISUDUNG B on B.MAPHAMVI = A.MAPHAMVI        left join (select distinct PHAMVI_ID, KHODUOC_ID from TM_DUOC_PHAMVISD_MAPPING) C on C.PHAMVI_ID = B.PHAMVI_ID        where A.TAMNGUNG != '1' and A.BENHVIEN_ID = 'HLU01'        ORDER BY A.SAPXEP ASC]
2019-09-20 15:46:42,811 [1] DEBUG - Statement Id: [DAO00019_ThongTinBenhNhanDvYeuCau] PreparedStatement : [select distinct A.SOTIEPNHAN, A.TIEPNHAN_ID, A.DOITUONG_ID, A.TRANGTHAI,        A.LOAITHANHVIEN_ID, A.SUDUNG_BHTN, A.THE_ID, A.THANHVIEN_ID, A.VIP, A.NGUON_BENHNHAN_ID, A.BAOLANH_VIENPHI, A.NGAYMIENDONGCHITRA,        B.*,  C.DICHVU_ID, C.DVYEUCAU_ID, C.NOITHUCHIEN_ID, A.SOBHYT        from TT_TIEPNHAN A        inner join TT_DVYEUCAU C on C.TIEPNHAN_ID = A.TIEPNHAN_ID        inner join TT_BENHNHAN B on B.BENHNHAN_ID = A.BENHNHAN_ID and B.ACTIVE = '1'        where                    C.DVYEUCAU_ID = '205440'                 and A.BENHVIEN_ID = 'HLU01']
2019-09-20 15:46:42,982 [1] DEBUG - Statement Id: [DAO00017_GetLoaiGiaByDoiTuongId] PreparedStatement : [select dtlg.DOUUTIEN, dtlg.DOITUONG_ID, lg.LOAIGIA_ID, lg.TENLOAIGIA, lg.MALOAIGIA              from TM_LOAIGIA lg              left join TM_DOITUONG_LOAIGIA dtlg              on lg.LOAIGIA_ID = dtlg.LOAIGIA_ID and dtlg.BENHVIEN_ID = 'HLU01'              where lg.TAMNGUNG = 0 and lg.BENHVIEN_ID = 'HLU01'                             order by dtlg.DOUUTIEN]
2019-09-20 15:46:43,093 [1] DEBUG - Statement Id: [DAO00014_KiemTraDVYCCoBHYT] PreparedStatement : [select *        from TT_VIENPHI        where REF_ID  = '205440' and REF_TABLE = 'TT_DVYEUCAU' and BHYT_DONGIA > 0]
2019-09-20 15:46:43,156 [1] DEBUG - Statement Id: [DAO00040_LayListToaMau] PreparedStatement : [select A.*, dc.TENDUOCDAYDU, dc.BHYT DUOC_BHYT, ld.LOAIVATTU_ID, ld.MALOAIDUOC, dd.DICTIONARY_NAME DUONGDUNG, dc.TAMNGUNG            from TT_TOATHUOCMAU A            left join TM_DUOC dc on A.DUOC_ID = dc.DUOC_ID            left join TM_LOAIDUOC ld on dc.LOAIDUOC_ID = ld.LOAIDUOC_ID            left join (select * from LST_DICTIONARY where DICTIONARY_TYPE_CODE like 'DuongDung') dd on dd.DICTIONARY_ID = dc.DUONGDUNG_ID            where (1=1)             and               A.BACSI_ID  = 1              and A.LOAITOATHUOC in  (                        @param0                   ,                           @param1                   ,                           @param2                   ,                           @param3                   )]
2019-09-20 15:46:43,157 [1] DEBUG - Statement Id: [DAO00040_LayListToaMau] Parameters: [@param0=[LSTLOAITOATHUOC[0],BV], @param1=[LSTLOAITOATHUOC[1],MN], @param2=[LSTLOAITOATHUOC[2],MP], @param3=[LSTLOAITOATHUOC[3],TV]]
2019-09-20 15:46:43,158 [1] DEBUG - Statement Id: [DAO00040_LayListToaMau] Types: [@param0=[String, System.String], @param1=[String, System.String], @param2=[String, System.String], @param3=[String, System.String]]
2019-09-20 15:46:43,241 [1] DEBUG - Statement Id: [DAO00040_LayListToaMau] PreparedStatement : [select A.*, dc.TENDUOCDAYDU, dc.BHYT DUOC_BHYT, ld.LOAIVATTU_ID, ld.MALOAIDUOC, dd.DICTIONARY_NAME DUONGDUNG, dc.TAMNGUNG            from TT_TOATHUOCMAU A            left join TM_DUOC dc on A.DUOC_ID = dc.DUOC_ID            left join TM_LOAIDUOC ld on dc.LOAIDUOC_ID = ld.LOAIDUOC_ID            left join (select * from LST_DICTIONARY where DICTIONARY_TYPE_CODE like 'DuongDung') dd on dd.DICTIONARY_ID = dc.DUONGDUNG_ID            where (1=1)             and               A.BACSI_ID  = 1              and A.LOAITOATHUOC in  (                        @param0                   ,                           @param1                   ,                           @param2                   ,                           @param3                   )]
2019-09-20 15:46:43,242 [1] DEBUG - Statement Id: [DAO00040_LayListToaMau] Parameters: [@param0=[LSTLOAITOATHUOC[0],BV], @param1=[LSTLOAITOATHUOC[1],MN], @param2=[LSTLOAITOATHUOC[2],MP], @param3=[LSTLOAITOATHUOC[3],TV]]
2019-09-20 15:46:43,242 [1] DEBUG - Statement Id: [DAO00040_LayListToaMau] Types: [@param0=[String, System.String], @param1=[String, System.String], @param2=[String, System.String], @param3=[String, System.String]]
2019-09-20 15:46:43,293 [1] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoVaBookingCOM23UpdateRedis_TheoPhamvi] PreparedStatement : [declare @TOAMUANGOAI int = 0;        select @TOAMUANGOAI = isnull(VALUE,0) from TM_SYS_APPSETTINGS where CODE = 'OPD_TOAMUANGOAI_DUNGDANHMUC_DUOC'                if @TOAMUANGOAI = 1        begin        select  distinct '0' + '_' + LTRIM(d.DUOC_ID) + '_' + '0' as DUOC_KEY, 999999999 as SOLUONG        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        where  @param0  = 0        union all        select distinct tk.DUOC_KEY, tk.SOLUONG        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        inner join        (        select  LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')) DUOC_KEY, (SUM(dtk.SOLUONG) - isnull(sum(A.SOLUONG),0) - isnull(sum(B.SOLUONG),0)) SOLUONG, pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        from (select sum(soluong) soluong,duoc_id,nguonduoc_id,khoduoc_id,benhvien_id from TT_DUOC_TONKHO  group by duoc_id,nguonduoc_id,khoduoc_id,benhvien_id) dtk        inner join TM_DUOC_PHAMVISD_MAPPING pvsd on dtk.KHODUOC_ID = pvsd.KHODUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NOITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) B on B.DUOC_ID = dtk.DUOC_ID and B.PHAMVI_ID = pvsd.PHAMVI_ID and B.NGUONHANG_ID = dtk.NGUONDUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NGOAITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) A on A.DUOC_ID = dtk.DUOC_ID and A.PHAMVI_ID = pvsd.PHAMVI_ID and A.NGUONHANG_ID = dtk.NGUONDUOC_ID        where dtk.BENHVIEN_ID = 'HLU01'        group by LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')), pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        ) tk on tk.DUOC_ID = d.DUOC_ID        left join TM_DUOC_PHAMVISUDUNG kd on kd.PHAMVI_ID = tk.PHAMVI_ID and kd.BENHVIEN_ID = 'HLU01'        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = tk.NGUONDUOC_ID and nh.BENHVIEN_ID = 'HLU01'        where d.BENHVIEN_ID = 'HLU01' and tk.PHAMVI_ID =  @param0         end        else        begin        select distinct tk.DUOC_KEY, tk.SOLUONG        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        inner join        (        select  LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')) DUOC_KEY, (SUM(dtk.SOLUONG) - isnull(sum(A.SOLUONG),0) - isnull(sum(B.SOLUONG),0)) SOLUONG, pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        from (select sum(soluong) soluong,duoc_id,nguonduoc_id,khoduoc_id,benhvien_id from TT_DUOC_TONKHO  group by duoc_id,nguonduoc_id,khoduoc_id,benhvien_id) dtk        inner join TM_DUOC_PHAMVISD_MAPPING pvsd on dtk.KHODUOC_ID = pvsd.KHODUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NOITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) B on B.DUOC_ID = dtk.DUOC_ID and B.PHAMVI_ID = pvsd.PHAMVI_ID and B.NGUONHANG_ID = dtk.NGUONDUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NGOAITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) A on A.DUOC_ID = dtk.DUOC_ID and A.PHAMVI_ID = pvsd.PHAMVI_ID and A.NGUONHANG_ID = dtk.NGUONDUOC_ID        where dtk.BENHVIEN_ID = 'HLU01'        group by LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')), pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        ) tk on tk.DUOC_ID = d.DUOC_ID        left join TM_DUOC_PHAMVISUDUNG kd on kd.PHAMVI_ID = tk.PHAMVI_ID and kd.BENHVIEN_ID = 'HLU01'        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = tk.NGUONDUOC_ID and nh.BENHVIEN_ID = 'HLU01'        where d.BENHVIEN_ID = 'HLU01' and tk.PHAMVI_ID =  @param0         end]
2019-09-20 15:46:43,293 [1] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoVaBookingCOM23UpdateRedis_TheoPhamvi] Parameters: [@param0=[PHAMVI_ID,1028]]
2019-09-20 15:46:43,293 [1] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoVaBookingCOM23UpdateRedis_TheoPhamvi] Types: [@param0=[Int64, System.Int64]]
2019-09-20 15:46:43,504 [1] DEBUG - Statement Id: [DAO00013_GetTienSuBenh] PreparedStatement : [select TIENSUBENH, TIENSUDIUNG              from TT_BENHNHAN              where TT_BENHNHAN.BENHNHAN_ID  = '23423']
2019-09-20 15:46:43,766 [1] DEBUG - Statement Id: [DAO00095_GetTTDiUngThuoc] PreparedStatement : [select *              from TT_BENHNHAN_DIUNG_THUOC              where BENHNHAN_ID = '23423'              and BENHVIEN_ID = 'HLU01']
2019-09-20 15:46:43,810 [1] DEBUG - Statement Id: [DAO00014_GetTotalChiPhiDVByTiepNhan] PreparedStatement : [select sum(THANHTIEN_DOANHTHU) as THANHTIEN_DOANHTHU from TT_VIENPHI        where ACTIVE = '1'        and TIEPNHAN_ID = '27478'        and REF_TABLE = 'TT_DVYEUCAU'        and exists (select DVYEUCAU_ID from TT_DVYEUCAU where HUYYEUCAU = '0' and TIEPNHAN_ID = '27478' and TT_VIENPHI.REF_ID = DVYEUCAU_ID)]
2019-09-20 15:46:43,889 [1] DEBUG - Statement Id: [DAO00014_GetKhamBenhInfo] PreparedStatement : [select * from TT_NGOAITRU_KHAMBENH where KHAMBENH_ID =        (select KHAMBENH_NGOAITRU_ID from TT_DVYEUCAU where DVYEUCAU_ID = '205440')]
2019-09-20 15:46:43,928 [1] DEBUG - Statement Id: [DAO00014_GetSoCaKhamTrongNgay] PreparedStatement : [select Count(KB.KHAMBENH_ID) as SOCAKHAMTRONGNGAY        from TT_NGOAITRU_KHAMBENH KB        inner join TT_TIEPNHAN TN on TN.TIEPNHAN_ID = KB.TIEPNHAN_ID        where KB.NGAYKHAM = convert(date, GETDATE())        and KB.BACSIKHAM_ID = '1'        and KB.BENHVIEN_ID = 'HLU01'        and TN.SOBHYT IS NOT NULL and TN.SOBHYT != '']
2019-09-20 15:46:44,066 [1] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoVaBookingCOM23UpdateRedis_TheoPhamvi] PreparedStatement : [declare @TOAMUANGOAI int = 0;        select @TOAMUANGOAI = isnull(VALUE,0) from TM_SYS_APPSETTINGS where CODE = 'OPD_TOAMUANGOAI_DUNGDANHMUC_DUOC'                if @TOAMUANGOAI = 1        begin        select  distinct '0' + '_' + LTRIM(d.DUOC_ID) + '_' + '0' as DUOC_KEY, 999999999 as SOLUONG        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        where  @param0  = 0        union all        select distinct tk.DUOC_KEY, tk.SOLUONG        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        inner join        (        select  LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')) DUOC_KEY, (SUM(dtk.SOLUONG) - isnull(sum(A.SOLUONG),0) - isnull(sum(B.SOLUONG),0)) SOLUONG, pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        from (select sum(soluong) soluong,duoc_id,nguonduoc_id,khoduoc_id,benhvien_id from TT_DUOC_TONKHO  group by duoc_id,nguonduoc_id,khoduoc_id,benhvien_id) dtk        inner join TM_DUOC_PHAMVISD_MAPPING pvsd on dtk.KHODUOC_ID = pvsd.KHODUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NOITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) B on B.DUOC_ID = dtk.DUOC_ID and B.PHAMVI_ID = pvsd.PHAMVI_ID and B.NGUONHANG_ID = dtk.NGUONDUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NGOAITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) A on A.DUOC_ID = dtk.DUOC_ID and A.PHAMVI_ID = pvsd.PHAMVI_ID and A.NGUONHANG_ID = dtk.NGUONDUOC_ID        where dtk.BENHVIEN_ID = 'HLU01'        group by LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')), pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        ) tk on tk.DUOC_ID = d.DUOC_ID        left join TM_DUOC_PHAMVISUDUNG kd on kd.PHAMVI_ID = tk.PHAMVI_ID and kd.BENHVIEN_ID = 'HLU01'        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = tk.NGUONDUOC_ID and nh.BENHVIEN_ID = 'HLU01'        where d.BENHVIEN_ID = 'HLU01' and tk.PHAMVI_ID =  @param0         end        else        begin        select distinct tk.DUOC_KEY, tk.SOLUONG        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        inner join        (        select  LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')) DUOC_KEY, (SUM(dtk.SOLUONG) - isnull(sum(A.SOLUONG),0) - isnull(sum(B.SOLUONG),0)) SOLUONG, pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        from (select sum(soluong) soluong,duoc_id,nguonduoc_id,khoduoc_id,benhvien_id from TT_DUOC_TONKHO  group by duoc_id,nguonduoc_id,khoduoc_id,benhvien_id) dtk        inner join TM_DUOC_PHAMVISD_MAPPING pvsd on dtk.KHODUOC_ID = pvsd.KHODUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NOITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) B on B.DUOC_ID = dtk.DUOC_ID and B.PHAMVI_ID = pvsd.PHAMVI_ID and B.NGUONHANG_ID = dtk.NGUONDUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NGOAITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) A on A.DUOC_ID = dtk.DUOC_ID and A.PHAMVI_ID = pvsd.PHAMVI_ID and A.NGUONHANG_ID = dtk.NGUONDUOC_ID        where dtk.BENHVIEN_ID = 'HLU01'        group by LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')), pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        ) tk on tk.DUOC_ID = d.DUOC_ID        left join TM_DUOC_PHAMVISUDUNG kd on kd.PHAMVI_ID = tk.PHAMVI_ID and kd.BENHVIEN_ID = 'HLU01'        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = tk.NGUONDUOC_ID and nh.BENHVIEN_ID = 'HLU01'        where d.BENHVIEN_ID = 'HLU01' and tk.PHAMVI_ID =  @param0         end]
2019-09-20 15:46:44,066 [1] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoVaBookingCOM23UpdateRedis_TheoPhamvi] Parameters: [@param0=[PHAMVI_ID,1028]]
2019-09-20 15:46:44,066 [1] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoVaBookingCOM23UpdateRedis_TheoPhamvi] Types: [@param0=[Int64, System.Int64]]
2019-09-20 15:46:44,725 [1] DEBUG - Statement Id: [DAO00068_GetLastedSinhHieuInfo] PreparedStatement : [select top (1) *, CHISOBMI as BMI              from TT_NGOAITRU_KHAMBENH_SINHHIEU              where BENHNHAN_ID = '23423'              order by KHAMBENH_SINHHIEU_ID desc]
2019-09-20 15:47:02,104 [1] DEBUG - Statement Id: [DAO00014_GetPatientStatus] PreparedStatement : [select        CASE        when tn.TRANGTHAI = 'HOANTHANH' Then tn.TRANGTHAI        WHEN xncp.XACNHANCHIPHI_ID is not null THEN 'XACNHANCHIPHI'        WHEN (tn.KHOADULIEU = '1') THEN 'KHOADULIEU'        ELSE tn.TRANGTHAI        END        as TRANGTHAI        from TT_TIEPNHAN tn        left join TT_XACNHANCHIPHI xncp on tn.TIEPNHAN_ID = xncp.TIEPNHAN_ID        where tn.TIEPNHAN_ID = '27478'        and tn.BENHVIEN_ID = 'HLU01']
2019-09-20 15:47:02,202 [1] DEBUG - Statement Id: [DAO00014_GetTTDVYeucauOPD] PreparedStatement : [select A.KHAMBENH_NGOAITRU_ID, B.KHAMBENH_ID        from TT_DVYEUCAU A        left join TT_NGOAITRU_KHAMBENH B on A.KHAMBENH_NGOAITRU_ID = B.KHAMBENH_ID        where A.DVYEUCAU_ID = '205440' and A.TIEPNHAN_ID =  @param0]
2019-09-20 15:47:02,202 [1] DEBUG - Statement Id: [DAO00014_GetTTDVYeucauOPD] Parameters: [@param0=[TIEPNHAN_ID,27478]]
2019-09-20 15:47:02,202 [1] DEBUG - Statement Id: [DAO00014_GetTTDVYeucauOPD] Types: [@param0=[Int64, System.Int64]]
2019-09-20 15:47:02,304 [1] DEBUG - Statement Id: [DAO00014_GetThongtinKhamsuckhoeTheoDVyc] PreparedStatement : [select HOPDONG_ID, HOPDONG_BENHNHAN_ID from TT_DVYEUCAU where DVYEUCAU_ID =  @param0]
2019-09-20 15:47:02,304 [1] DEBUG - Statement Id: [DAO00014_GetThongtinKhamsuckhoeTheoDVyc] Parameters: [@param0=[DVYEUCAU_ID,205440]]
2019-09-20 15:47:02,304 [1] DEBUG - Statement Id: [DAO00014_GetThongtinKhamsuckhoeTheoDVyc] Types: [@param0=[Int64, System.Int64]]
2019-09-20 15:47:02,344 [1] DEBUG - Statement Id: [DAO00009_TT_TIEPNHAN_GetProcess] PreparedStatement : [select PROCESS_ID from TT_TIEPNHAN where SOTIEPNHAN = 'TN190920.0000001']
2019-09-20 15:47:02,452 [1] DEBUG - Statement Id: [DAOWF004_laytrangthaiDV] PreparedStatement : [select top 1 A.CURR_STATE_CODE as STATE_CODE, isNull(C.SHORT_NAME,C.NAME) as TRANGTHAI, C.NAME as TRANGTHAI_CHITIET, C.STATUS_CODE, D.ISACTIVE as ACTIVE, E.STATUS_CODE  as OLD_STATUSCODE        from TT_REQUEST_SERVICE_DETAIL A                left join (select * from TT_REQUEST_SERVICE where PARA = '{"DICHVU_ID":"5685","DVYEUCAU_ID":"205440"}') D on D.ID = A.REQUEST_SERVICE_ID        left join TM_STATE C on A.CURR_STATE_CODE = C.STATE_CODE and C.PROCESS_CODE = D.PROCESS_CODE        left join TM_STATE E on A.OLD_STATE_CODE = E.STATE_CODE and E.PROCESS_CODE = D.PROCESS_CODE        where        A.REQUEST_SERVICE_ID = (select top 1 ID from TT_REQUEST_SERVICE where PARA = '{"DICHVU_ID":"5685","DVYEUCAU_ID":"205440"}' order by ID desc)        order by A.ID desc]
2019-09-20 15:47:02,593 [1] DEBUG - Statement Id: [DAO00014_CheckExistNhapVien] PreparedStatement : [select NHAPVIEN_ID        from TT_NOITRU_NHAPVIEN        where TIEPNHAN_ID  = '27478'        and TRANGTHAI != 'CHOXACNHAN']
2019-09-20 15:47:02,649 [1] DEBUG - Statement Id: [DAO00014_CheckExistCapCuu] PreparedStatement : [select THONGTINCAPCUU_ID        from TT_TIEPNHAN_THONGTINCAPCUU        where TIEPNHAN_ID  = '27478' and BENHVIEN_ID = 'HLU01']
2019-09-20 15:47:02,683 [1] DEBUG - Statement Id: [DAO00014_CheckExistChuyenVien] PreparedStatement : [select CHUYENVIEN_ID        from TT_CHUYENVIEN        where TIEPNHAN_ID  = '27478']
2019-09-20 15:47:02,722 [1] DEBUG - Statement Id: [DAO00014_GetTrangThaiTiepNhan] PreparedStatement : [select tn.TIEPNHAN_ID, tn.KHOADULIEU, xncp.XACNHANCHIPHI_ID from TT_TIEPNHAN tn        left join TT_XACNHANCHIPHI xncp        on tn.TIEPNHAN_ID = xncp.TIEPNHAN_ID        where tn.TIEPNHAN_ID = '27478'        and tn.BENHVIEN_ID = 'HLU01']
2019-09-20 15:47:02,817 [1] DEBUG - Statement Id: [DAOLOG01_LockBegin] PreparedStatement : [INSERT into TT_LOG_UPDATE ( REF_TABLE , REF_ID , BENHVIEN_ID )         values ( @param0 ,  @param1 ,  @param2 );]
2019-09-20 15:47:02,817 [1] DEBUG - Statement Id: [DAOLOG01_LockBegin] Parameters: [@param0=[REF_TABLE,TT_NGOAITRU_KHAMBENH], @param1=[REF_ID,27478], @param2=[BENHVIEN_ID,HLU01]]
2019-09-20 15:47:02,817 [1] DEBUG - Statement Id: [DAOLOG01_LockBegin] Types: [@param0=[String, System.String], @param1=[Int64, System.Int64], @param2=[String, System.String]]
2019-09-20 15:47:02,900 [1] DEBUG - Statement Id: [DAO00014_GetTTNhapVien] PreparedStatement : [select *        from TT_NOITRU_NHAPVIEN        where TIEPNHAN_ID  = '27478']
2019-09-20 15:47:02,993 [1] DEBUG - Statement Id: [DAO00014_GetTTDVYeucauOPD] PreparedStatement : [select A.KHAMBENH_NGOAITRU_ID, B.KHAMBENH_ID        from TT_DVYEUCAU A        left join TT_NGOAITRU_KHAMBENH B on A.KHAMBENH_NGOAITRU_ID = B.KHAMBENH_ID        where A.DVYEUCAU_ID = '205440' and A.TIEPNHAN_ID =  @param0]
2019-09-20 15:47:02,993 [1] DEBUG - Statement Id: [DAO00014_GetTTDVYeucauOPD] Parameters: [@param0=[TIEPNHAN_ID,27478]]
2019-09-20 15:47:02,993 [1] DEBUG - Statement Id: [DAO00014_GetTTDVYeucauOPD] Types: [@param0=[String, System.String]]
2019-09-20 15:47:03,036 [1] DEBUG - Statement Id: [DAO00014_Add] PreparedStatement : [insert into TT_NGOAITRU_KHAMBENH (        BENHNHAN_ID        , TIEPNHAN_ID        , BENHAN_ID        , DICHVU_ID        , PHONGBAN_ID        , NGAYKHAM        , THOIGIANKHAM        , BACSIKHAM_ID        , DIEUDUONG_ID        , DOITUONG_ID        , CHANDOANICD_ID        , CHANDOANPHUICD_ID        , CHANDOANICD        , BENHMANTINH_ID        , HUONGGIAIQUYET_ID        , YEUCAUCHITIET_ID        , CHANDOANKHOAKHAM        , TLDG_MT        , TLDG_MP        , TKLT_MP        , TKLT_MT        , TLDG_MT_TEXT        , TLDG_MP_TEXT        , TKLT_MP_TEXT        , TKLT_MT_TEXT        , NHANAP_MT        , NHANAP_MP        , MACH        , CANNANG        , CHIEUCAO        , HUYETAPTHAP        , HUYETAPCAO        , NHIPTHO        , NHIETDO        , BMI        , TYLEMO        , VONGBUNG        , SIEUHIENVI        , SOIDAYMAT        , TRIEUCHUNGLAMSANG        , CHANDOANSOBOICD_ID        , CHANDOANSOBO        , CHUYENDENBENHVIEN_ID        , LYDONHAPVIEN_ID        , THOIGIANNHAPVIENDUKIEN        , KHAMBENHLANDAU_ID        , KHAMBENH_CHUYENKHOA_ID        , NHAPKHOA_ID        , CHUYENKHOA_ID        , NGHIOM_TUNGAY        , NGHIOM_DENNGAY        , HUONGDIEUTRI_ID        , CHEDOANUONG_ID        , CHEDOCHAMSOC_ID        , DIEUTRIDUPHONG        , SONGAYDIEUTRI        , GIAIDOANBENH        , TOATHUOCMUANGOAI        , TACDUNGPHU        , TUANTHUCUABN        , SONGAYHENTAIKHAM        , SOBENHANNGOAITRU_ID        , KHAMCAPCUU        , GHICHU        , KHOADULIEU        , NGUOIKHOA_ID        , NGAYKHOA        , THOIGIANKHOA        , BENHVIEN_ID        , NGAYTAO        , NGUOITAO_ID        , NGAYCAPNHAT        , NGUOICAPNHAT_ID        , KHAMBENH_SINHHIEU_ID        ) values (         @param0         ,  @param1         ,  @param2         ,  @param3         ,  @param4         ,  @param5         ,  @param6         ,  @param7         ,  @param8         ,  @param9         ,  @param10         ,  @param11         ,  @param12         ,  @param13         ,  @param14         ,  @param15         ,  @param16         ,  @param17         ,  @param18         ,  @param19         ,  @param20         ,  @param21         ,  @param22         ,  @param23         ,  @param24         ,  @param25         ,  @param26         ,  @param27         ,  @param28         ,  @param29         ,  @param30         ,  @param31         ,  @param32         ,  @param33         ,  @param34         ,  @param35         ,  @param36         ,  @param37         ,  @param38         ,  @param39         ,  @param40         ,  @param41         ,  @param42         ,  @param43         ,  @param44         ,  @param45         ,  @param46         ,  @param47         ,  @param48         ,  @param49         ,  @param50         ,  @param51         ,  @param52         ,  @param53         ,  @param54         ,  @param55         ,  @param56         ,  @param57         ,  @param58         ,  @param59         ,  @param60         ,  @param61         ,  @param62         ,  @param63         ,  @param64         ,  @param65         ,  @param66         ,  @param67         ,  @param68         ,  @param69         ,  @param70         ,  @param71         ,  @param72         ,  @param73         )        SELECT SCOPE_IDENTITY()]
2019-09-20 15:47:03,037 [1] DEBUG - Statement Id: [DAO00014_Add] Parameters: [@param0=[BENHNHAN_ID,23423], @param1=[TIEPNHAN_ID,27478], @param2=[BENHAN_ID,null], @param3=[DICHVU_ID,5685], @param4=[PHONGBAN_ID,58], @param5=[NGAYKHAM,9/20/2019 12:00:00 AM], @param6=[THOIGIANKHAM,9/20/2019 3:46:42 PM], @param7=[BACSIKHAM_ID,1], @param8=[DIEUDUONG_ID,null], @param9=[DOITUONG_ID,4], @param10=[CHANDOANICD_ID,3990], @param11=[CHANDOANPHUICD_ID,null], @param12=[CHANDOANICD,null], @param13=[BENHMANTINH_ID,null], @param14=[HUONGGIAIQUYET_ID,8343], @param15=[YEUCAUCHITIET_ID,null], @param16=[CHANDOANKHOAKHAM,Viêm phế quản cấp(J20)], @param17=[TLDG_MT,null], @param18=[TLDG_MP,null], @param19=[TKLT_MP,null], @param20=[TKLT_MT,null], @param21=[TLDG_MT_TEXT,], @param22=[TLDG_MP_TEXT,], @param23=[TKLT_MP_TEXT,], @param24=[TKLT_MT_TEXT,], @param25=[NHANAP_MT,null], @param26=[NHANAP_MP,null], @param27=[MACH,null], @param28=[CANNANG,null], @param29=[CHIEUCAO,null], @param30=[HUYETAPTHAP,null], @param31=[HUYETAPCAO,null], @param32=[NHIPTHO,null], @param33=[NHIETDO,null], @param34=[BMI,null], @param35=[TYLEMO,null], @param36=[VONGBUNG,null], @param37=[SIEUHIENVI,], @param38=[SOIDAYMAT,], @param39=[TRIEUCHUNGLAMSANG,test], @param40=[CHANDOANSOBOICD_ID,null], @param41=[CHANDOANSOBO,], @param42=[CHUYENDENBENHVIEN_ID,null], @param43=[LYDONHAPVIEN_ID,null], @param44=[THOIGIANNHAPVIENDUKIEN,null], @param45=[KHAMBENHLANDAU_ID,null], @param46=[KHAMBENH_CHUYENKHOA_ID,null], @param47=[NHAPKHOA_ID,null], @param48=[CHUYENKHOA_ID,null], @param49=[NGHIOM_TUNGAY,null], @param50=[NGHIOM_DENNGAY,null], @param51=[HUONGDIEUTRI_ID,null], @param52=[CHEDOANUONG_ID,null], @param53=[CHEDOCHAMSOC_ID,null], @param54=[DIEUTRIDUPHONG,null], @param55=[SONGAYDIEUTRI,null], @param56=[GIAIDOANBENH,null], @param57=[TOATHUOCMUANGOAI,null], @param58=[TACDUNGPHU,null], @param59=[TUANTHUCUABN,null], @param60=[SONGAYHENTAIKHAM,null], @param61=[SOBENHANNGOAITRU_ID,null], @param62=[KHAMCAPCUU,null], @param63=[GHICHU,], @param64=[KHOADULIEU,0], @param65=[NGUOIKHOA_ID,null], @param66=[NGAYKHOA,null], @param67=[THOIGIANKHOA,null], @param68=[BENHVIEN_ID,HLU01], @param69=[NGAYTAO,9/20/2019 3:47:03 PM], @param70=[NGUOITAO_ID,1], @param71=[NGAYCAPNHAT,9/20/2019 3:47:03 PM], @param72=[NGUOICAPNHAT_ID,1], @param73=[KHAMBENH_SINHHIEU_ID,0]]
2019-09-20 15:47:03,037 [1] DEBUG - Statement Id: [DAO00014_Add] Types: [@param0=[Int64, System.Int64], @param1=[String, System.String], @param2=[System.DBNull, null], @param3=[Int64, System.Int64], @param4=[String, System.String], @param5=[DateTime, System.DateTime], @param6=[DateTime, System.DateTime], @param7=[Int64, System.Int64], @param8=[System.DBNull, null], @param9=[Int64, System.Int64], @param10=[String, System.String], @param11=[System.DBNull, null], @param12=[System.DBNull, null], @param13=[System.DBNull, null], @param14=[String, System.String], @param15=[System.DBNull, null], @param16=[String, System.String], @param17=[System.DBNull, null], @param18=[System.DBNull, null], @param19=[System.DBNull, null], @param20=[System.DBNull, null], @param21=[String, System.String], @param22=[String, System.String], @param23=[String, System.String], @param24=[String, System.String], @param25=[System.DBNull, null], @param26=[System.DBNull, null], @param27=[System.DBNull, null], @param28=[System.DBNull, null], @param29=[System.DBNull, null], @param30=[System.DBNull, null], @param31=[System.DBNull, null], @param32=[System.DBNull, null], @param33=[System.DBNull, null], @param34=[System.DBNull, null], @param35=[System.DBNull, null], @param36=[System.DBNull, null], @param37=[String, System.String], @param38=[String, System.String], @param39=[String, System.String], @param40=[System.DBNull, null], @param41=[String, System.String], @param42=[System.DBNull, null], @param43=[System.DBNull, null], @param44=[System.DBNull, null], @param45=[System.DBNull, null], @param46=[System.DBNull, null], @param47=[System.DBNull, null], @param48=[System.DBNull, null], @param49=[System.DBNull, null], @param50=[System.DBNull, null], @param51=[System.DBNull, null], @param52=[System.DBNull, null], @param53=[System.DBNull, null], @param54=[System.DBNull, null], @param55=[System.DBNull, null], @param56=[System.DBNull, null], @param57=[System.DBNull, null], @param58=[System.DBNull, null], @param59=[System.DBNull, null], @param60=[System.DBNull, null], @param61=[System.DBNull, null], @param62=[System.DBNull, null], @param63=[String, System.String], @param64=[String, System.String], @param65=[System.DBNull, null], @param66=[System.DBNull, null], @param67=[System.DBNull, null], @param68=[String, System.String], @param69=[DateTime, System.DateTime], @param70=[String, System.String], @param71=[DateTime, System.DateTime], @param72=[String, System.String], @param73=[Int64, System.Int64]]
2019-09-20 15:47:03,083 [1] DEBUG - Statement Id: [DAO00014_CheckExistHenTaiKHam] PreparedStatement : [select KHAMBENH_HENTAIKHAM        from TT_NGOAITRU_KHAMBENH_HENTK        where KHAMBENH_ID  = '26172']
2019-09-20 15:47:03,121 [1] DEBUG - Statement Id: [DAO00020_UpdateKhamBenhIDInDVYC] PreparedStatement : [update TT_DVYEUCAU        set KHAMBENH_NGOAITRU_ID =  @param0                 , TRANGTHAI =  @param1         , NGUOICAPNHAT_ID =  @param2         , NGAYCAPNHAT =  @param3         where TIEPNHAN_ID = 27478        and DVYEUCAU_ID = 205440                update TT_VIENPHI        set DATHUCHIEN =  @param4         , NGUOICAPNHAT_ID =  @param2         , NGAYCAPNHAT =  @param3         where REF_ID = 205440        and REF_TABLE = 'TT_DVYEUCAU']
2019-09-20 15:47:03,121 [1] DEBUG - Statement Id: [DAO00020_UpdateKhamBenhIDInDVYC] Parameters: [@param0=[KHAMBENH_ID,26172], @param1=[TRANGTHAI,DANGTHUCHIEN], @param2=[NGUOICAPNHAT_ID,1], @param3=[NGAYCAPNHAT,9/20/2019 3:47:03 PM], @param4=[DATHUCHIEN,1]]
2019-09-20 15:47:03,121 [1] DEBUG - Statement Id: [DAO00020_UpdateKhamBenhIDInDVYC] Types: [@param0=[Int64, System.Int64], @param1=[String, System.String], @param2=[Int64, System.Int64], @param3=[DateTime, System.DateTime], @param4=[Int32, System.Int32]]
2019-09-20 15:47:03,177 [1] DEBUG - Statement Id: [DAO00023_GetSOBHYT_HUONG_ID] PreparedStatement : [select isnull(MAX(SOBHYT_HUONG_ID),0) SOBHYT_HUONG_ID        from TT_TIEPNHAN_SOTHEBHYT        where TIEPNHAN_ID = '27478']
2019-09-20 15:47:03,208 [1] DEBUG - Statement Id: [DAO00062_GetAllPhamviKhoDuoc] PreparedStatement : [select distinct dmap.*        from TM_DUOC_PHAMVISD_MAPPING dmap        left join TM_DUOC_PHAMVISUDUNG dpv on dpv.PHAMVI_ID = dmap.PHAMVI_ID]
2019-09-20 15:47:03,245 [1] DEBUG - Statement Id: [DAO00049_KiemtraloaiDV] PreparedStatement : [select DICHVU_ID AS HA, '' AS XN, '' as TDCN, '' as TT, '' as KB from TM_DICHVU            left join TM_NHOMDICHVU ndv on ndv.NHOMDICHVU_ID = TM_DICHVU.NHOMDICHVU_ID            where DICHVU_ID = '5685' and left(ndv.MANHOMDICHVU, 2) = '02'            union            select  '' as HA, DICHVU_ID AS XN, '' as TDCN, '' as TT, '' as KB from TM_DICHVU            left join TM_NHOMDICHVU ndv on ndv.NHOMDICHVU_ID = TM_DICHVU.NHOMDICHVU_ID            where DICHVU_ID = '5685' and left(ndv.MANHOMDICHVU, 2) = '01'            union            select  '' as HA, '' AS XN, DICHVU_ID as TDCN, '' as TT, '' as KB from TM_DICHVU            left join TM_NHOMDICHVU ndv on ndv.NHOMDICHVU_ID = TM_DICHVU.NHOMDICHVU_ID            where DICHVU_ID = '5685' and left(ndv.MANHOMDICHVU, 2) = '03'            union            select  '' as HA, '' AS XN, '' as TDCN, DICHVU_ID as TT, '' as KB from TM_DICHVU            left join TM_NHOMDICHVU ndv on ndv.NHOMDICHVU_ID = TM_DICHVU.NHOMDICHVU_ID            where DICHVU_ID = '5685' and left(ndv.MANHOMDICHVU, 2) = '05'            union            select  '' as HA, '' AS XN, '' as TDCN, DICHVU_ID as TT, '' as KB from TM_DICHVU            left join TM_NHOMDICHVU ndv on ndv.NHOMDICHVU_ID = TM_DICHVU.NHOMDICHVU_ID            where DICHVU_ID = '5685' and left(ndv.MANHOMDICHVU, 2) = '06'            union            select  '' as HA, '' AS XN, '' as TDCN, '' as TT, DICHVU_ID as KB from TM_DICHVU            left join TM_NHOMDICHVU ndv on ndv.NHOMDICHVU_ID = TM_DICHVU.NHOMDICHVU_ID            where DICHVU_ID = '5685' and left(ndv.MANHOMDICHVU, 2) = '04']
2019-09-20 15:47:03,290 [1] DEBUG - Statement Id: [DAO00009_GetThutiensauDVThuthuat] PreparedStatement : [select A.THUTIENSAU, B.SOTIEPNHAN, A.DICHVU_ID, A.DVYEUCAU_ID        from TT_DVYEUCAU A        inner join TT_TIEPNHAN B on B.TIEPNHAN_ID = A.TIEPNHAN_ID        where        A.DVYEUCAU_ID = '205440']
2019-09-20 15:47:03,335 [1] DEBUG - Statement Id: [DAO00009_TT_TIEPNHAN_GetProcess] PreparedStatement : [select PROCESS_ID from TT_TIEPNHAN where SOTIEPNHAN = 'TN190920.0000001']
2019-09-20 15:47:03,410 [1] DEBUG - Statement Id: [DAOWF001_Kiemtrathongtindayeucaudacochua] PreparedStatement : [select * from TT_REQUEST        where        PARA = '{"HOSPITAL_ID":"HLU01","SOTIEPNHAN":"TN190920.0000001"}'        AND ISACTIVE = '1']
2019-09-20 15:47:03,469 [1] DEBUG - Statement Id: [DAOWF001_Kiemtrathongtindichvudayeucau] PreparedStatement : [select top 1 * from TT_REQUEST_SERVICE        where        PARA = '{"DICHVU_ID":"5685","DVYEUCAU_ID":"205440"}'                AND ISACTIVE = '1' order by ID desc]
2019-09-20 15:47:03,505 [1] DEBUG - Statement Id: [DAOWF001_KiemtrathongtinchitietDichvuYeucau] PreparedStatement : [select * from TT_REQUEST_SERVICE_DETAIL        where        REQUEST_SERVICE_ID = '147387']
2019-09-20 15:47:03,571 [1] DEBUG - Statement Id: [DAOWF001_Laythongtinwithstatecode] PreparedStatement : [select A.*, B.STATUS_CODE from        TM_STATE_ACTION A        left join TM_STATE B on B.STATE_CODE = A.NEXT_STATE_CODE and A.PROCESS_CODE = B.PROCESS_CODE        where        A.CURR_STATE_CODE = '0     '        AND A.PROCESS_CODE = 'P02'        Order By ORDER_ID ASC]
2019-09-20 15:47:03,602 [1] DEBUG - Statement Id: [DAOWF003_Update] PreparedStatement : [update TT_REQUEST_SERVICE set        CURR_STATE_CODE =  @param0                   , ISACTIVE =  @param1                     , ISCOMPLETE =  @param2                        where        ID = '147387']
2019-09-20 15:47:03,602 [1] DEBUG - Statement Id: [DAOWF003_Update] Parameters: [@param0=[CURR_STATE_CODE,3], @param1=[ISACTIVE,1], @param2=[ISCOMPLETE,0]]
2019-09-20 15:47:03,602 [1] DEBUG - Statement Id: [DAOWF003_Update] Types: [@param0=[String, System.String], @param1=[String, System.String], @param2=[String, System.String]]
2019-09-20 15:47:03,664 [1] DEBUG - Statement Id: [DAOWF005_Add] PreparedStatement : [insert into TT_REQUEST_SERVICE_DETAIL (        REQUEST_ID        ,REQUEST_SERVICE_ID        , OLD_STATE_CODE        , CURR_STATE_CODE        ) values (         @param0         , @param1         ,  @param2         ,  @param3         )        SELECT SCOPE_IDENTITY()]
2019-09-20 15:47:03,664 [1] DEBUG - Statement Id: [DAOWF005_Add] Parameters: [@param0=[REQUEST_ID,31779], @param1=[REQUEST_SERVICE_ID,147387], @param2=[OLD_STATE_CODE,0     ], @param3=[CURR_STATE_CODE,3]]
2019-09-20 15:47:03,664 [1] DEBUG - Statement Id: [DAOWF005_Add] Types: [@param0=[String, System.String], @param1=[Int32, System.Int32], @param2=[String, System.String], @param3=[String, System.String]]
2019-09-20 15:47:03,705 [1] DEBUG - Statement Id: [DAOWF005_Add_History] PreparedStatement : [insert into TT_REQUEST_SERVICE_HISTORY (        REQUEST_ID        ,REQUEST_SERVICE_ID        , OLD_STATE_CODE        , CURR_STATE_CODE        ) values (         @param0         , @param1         ,  @param2         ,  @param3         )]
2019-09-20 15:47:03,705 [1] DEBUG - Statement Id: [DAOWF005_Add_History] Parameters: [@param0=[REQUEST_ID,31779], @param1=[REQUEST_SERVICE_ID,147387], @param2=[OLD_STATE_CODE,0     ], @param3=[CURR_STATE_CODE,3]]
2019-09-20 15:47:03,705 [1] DEBUG - Statement Id: [DAOWF005_Add_History] Types: [@param0=[String, System.String], @param1=[Int32, System.Int32], @param2=[String, System.String], @param3=[String, System.String]]
2019-09-20 15:47:03,743 [1] DEBUG - Statement Id: [DAO00009_TT_DVYEUCAU_Update] PreparedStatement : [Update TT_DVYEUCAU set TRANGTHAI_WFL = 'DANGTHUCHIEN' where DVYEUCAU_ID = '205440']
2019-09-20 15:47:03,774 [1] DEBUG - Statement Id: [DAO00026_GetListDanhSachDichVuGhiNhanVTYT_COM25_WithTN] PreparedStatement : [select distinct CONVERT(VARCHAR(11),C.NGAYYEUCAU,103) as NGAYYEUCAU, C.DICHVU_ID, C.DVYEUCAU_ID, D.TENDICHVU, C.NOITHUCHIEN_ID, A.SOTIEPNHAN, A.TRAITUYEN, A.NGAYMIENDONGCHITRA, A.TIEPNHAN_ID, A.DOITUONG_ID, A.TRANGTHAI,            A.LOAITHANHVIEN_ID, A.SUDUNG_BHTN, A.THE_ID, A.THANHVIEN_ID, A.VIP, A.NGUON_BENHNHAN_ID, A.BAOLANH_VIENPHI,            CASE WHEN (A.TRANGTHAI = 'NOITRU' OR A.TRANGTHAI = 'CAPCUU') THEN 'IN' ELSE 'OUT' END AS LOAIBENHAN,            CASE WHEN (C.TRANGTHAI = 'CHUAKETQUA') THEN 'CHUAKETQUA' ELSE 'HOANTAT' END AS TRANGTHAIDICHVU,            B.*, isnull(ntba.SOBENHAN, '') SOBENHAN, isnull(ntba.BENHAN_ID, 0) BENHAN_ID,            CASE WHEN Left(E.MANHOMDICHVU,2) = '03' THEN '02' ELSE Left(E.MANHOMDICHVU,2) END AS MANHOMDICHVU            from TT_TIEPNHAN A            inner join TT_BENHNHAN B on B.BENHNHAN_ID = A.BENHNHAN_ID and B.ACTIVE = '1'            inner join TT_DVYEUCAU C on C.TIEPNHAN_ID = A.TIEPNHAN_ID                        left join TM_DICHVU D on D.DICHVU_ID = C.DICHVU_ID            left join TM_NHOMDICHVU E on E.NHOMDICHVU_ID = D.NHOMDICHVU_ID            left join TT_NOITRU_BENHAN ntba on ntba.BENHAN_ID = C.BENHAN_ID              where            C.NGAYHENCLS is NULL and A.BENHVIEN_ID = 'HLU01'            and (A.TRANGTHAI = 'DATIEPNHAN' or A.TRANGTHAI = 'NOITRU' or A.TRANGTHAI = 'CAPCUU' or A.TRANGTHAI = 'NGOAITRU')            and (CASE WHEN Left(E.MANHOMDICHVU,2) = '03' THEN '02' ELSE Left(E.MANHOMDICHVU,2) END in ('02', '04'))            and A.TIEPNHAN_ID = '27478']
2019-09-20 15:47:04,452 [1] DEBUG - Statement Id: [DAOLOG01_LockEnd] PreparedStatement : [DELETE TT_LOG_UPDATE        where REF_TABLE = 'TT_NGOAITRU_KHAMBENH' and REF_ID = '27478' and BENHVIEN_ID = 'HLU01']
2019-09-20 15:47:04,487 [1] DEBUG - Statement Id: [DAO00014_Clear_1ToaThuocKhambenh] PreparedStatement : [DELETE FROM TT_DUOC_TONKHO_BOOK_NGOAITRU where REF_TABLE = 'TT_NGOAITRU_TOATHUOC'        and REF_ID in (        select TOATHUOC_ID from TT_NGOAITRU_TOATHUOC        where             KHAMBENH_TOATHUOC_ID in (select KHAMBENH_TOATHUOC_ID from TT_NGOAITRU_KHAMBENH_TOATHUOC        where TIEPNHAN_ID = '27478' and                   KHAMBENH_ID not in (select KHAMBENH_ID from TT_NGOAITRU_KHAMBENH where  TIEPNHAN_ID = '27478'))        and TIEPNHAN_ID = '27478')          DELETE FROM TT_VIENPHI where REF_TABLE = 'TT_NGOAITRU_TOATHUOC'        and REF_ID in (        select TOATHUOC_ID from TT_NGOAITRU_TOATHUOC        where KHAMBENH_TOATHUOC_ID in (select KHAMBENH_TOATHUOC_ID from TT_NGOAITRU_KHAMBENH_TOATHUOC        where TIEPNHAN_ID = '27478' and KHAMBENH_ID not in (select KHAMBENH_ID from TT_NGOAITRU_KHAMBENH where TIEPNHAN_ID = '27478'))        and TIEPNHAN_ID = '27478')          delete from TT_NGOAITRU_TOATHUOC        where KHAMBENH_TOATHUOC_ID in (select KHAMBENH_TOATHUOC_ID from TT_NGOAITRU_KHAMBENH_TOATHUOC        where TIEPNHAN_ID = '27478' and KHAMBENH_ID not in (select KHAMBENH_ID from TT_NGOAITRU_KHAMBENH where TIEPNHAN_ID = '27478')        and TIEPNHAN_ID = '27478')          delete from TT_NGOAITRU_KHAMBENH_TOATHUOC where TIEPNHAN_ID = '27478'        and KHAMBENH_ID not in (select KHAMBENH_ID from TT_NGOAITRU_KHAMBENH where TIEPNHAN_ID = '27478') and TIEPNHAN_ID = '27478']
2019-09-20 15:47:04,763 [1] DEBUG - Statement Id: [DAO00014_GetKhamBenhInfo] PreparedStatement : [select * from TT_NGOAITRU_KHAMBENH where KHAMBENH_ID =        (select KHAMBENH_NGOAITRU_ID from TT_DVYEUCAU where DVYEUCAU_ID = '205440')]
2019-09-20 15:47:04,903 [1] DEBUG - Statement Id: [DAO00068_GetSinhHieuBySinhHieuID] PreparedStatement : [select top (1) *            from TT_NGOAITRU_KHAMBENH_SINHHIEU            where KHAMBENH_SINHHIEU_ID = '0'            and BENHVIEN_ID = 'HLU01'             and               BENHNHAN_ID = '23423'                           order by KHAMBENH_SINHHIEU_ID]
2019-09-20 15:47:04,960 [1] DEBUG - Statement Id: [DAO00014_GetKhamBenhICDInfo] PreparedStatement : [select *        from TT_NGOAITRU_KHAMBENH_ICD        where KHAMBENH_ID  = '26172']
2019-09-20 15:47:05,009 [1] DEBUG - Statement Id: [DAO00014_GetListToaThuoc] PreparedStatement : [select A.*        from TT_NGOAITRU_KHAMBENH_TOATHUOC A        where A.KHAMBENH_ID = '26172']
2019-09-20 15:47:05,059 [1] DEBUG - Statement Id: [DAO00014_KiemTraDVYCCoBHYT] PreparedStatement : [select *        from TT_VIENPHI        where REF_ID  = '205440' and REF_TABLE = 'TT_DVYEUCAU' and BHYT_DONGIA > 0]
2019-09-20 15:47:05,122 [1] DEBUG - Statement Id: [DAO00040_LayListToaMau] PreparedStatement : [select A.*, dc.TENDUOCDAYDU, dc.BHYT DUOC_BHYT, ld.LOAIVATTU_ID, ld.MALOAIDUOC, dd.DICTIONARY_NAME DUONGDUNG, dc.TAMNGUNG            from TT_TOATHUOCMAU A            left join TM_DUOC dc on A.DUOC_ID = dc.DUOC_ID            left join TM_LOAIDUOC ld on dc.LOAIDUOC_ID = ld.LOAIDUOC_ID            left join (select * from LST_DICTIONARY where DICTIONARY_TYPE_CODE like 'DuongDung') dd on dd.DICTIONARY_ID = dc.DUONGDUNG_ID            where (1=1)             and               A.BACSI_ID  = 1              and A.LOAITOATHUOC in  (                        @param0                   ,                           @param1                   ,                           @param2                   ,                           @param3                   )]
2019-09-20 15:47:05,122 [1] DEBUG - Statement Id: [DAO00040_LayListToaMau] Parameters: [@param0=[LSTLOAITOATHUOC[0],BV], @param1=[LSTLOAITOATHUOC[1],MN], @param2=[LSTLOAITOATHUOC[2],MP], @param3=[LSTLOAITOATHUOC[3],TV]]
2019-09-20 15:47:05,122 [1] DEBUG - Statement Id: [DAO00040_LayListToaMau] Types: [@param0=[String, System.String], @param1=[String, System.String], @param2=[String, System.String], @param3=[String, System.String]]
2019-09-20 15:47:05,218 [1] DEBUG - Statement Id: [DAO00040_LayListToaMau] PreparedStatement : [select A.*, dc.TENDUOCDAYDU, dc.BHYT DUOC_BHYT, ld.LOAIVATTU_ID, ld.MALOAIDUOC, dd.DICTIONARY_NAME DUONGDUNG, dc.TAMNGUNG            from TT_TOATHUOCMAU A            left join TM_DUOC dc on A.DUOC_ID = dc.DUOC_ID            left join TM_LOAIDUOC ld on dc.LOAIDUOC_ID = ld.LOAIDUOC_ID            left join (select * from LST_DICTIONARY where DICTIONARY_TYPE_CODE like 'DuongDung') dd on dd.DICTIONARY_ID = dc.DUONGDUNG_ID            where (1=1)             and               A.BACSI_ID  = 1              and A.LOAITOATHUOC in  (                        @param0                   ,                           @param1                   ,                           @param2                   ,                           @param3                   )]
2019-09-20 15:47:05,219 [1] DEBUG - Statement Id: [DAO00040_LayListToaMau] Parameters: [@param0=[LSTLOAITOATHUOC[0],BV], @param1=[LSTLOAITOATHUOC[1],MN], @param2=[LSTLOAITOATHUOC[2],MP], @param3=[LSTLOAITOATHUOC[3],TV]]
2019-09-20 15:47:05,219 [1] DEBUG - Statement Id: [DAO00040_LayListToaMau] Types: [@param0=[String, System.String], @param1=[String, System.String], @param2=[String, System.String], @param3=[String, System.String]]
2019-09-20 15:47:05,265 [1] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoVaBookingCOM23UpdateRedis_TheoPhamvi] PreparedStatement : [declare @TOAMUANGOAI int = 0;        select @TOAMUANGOAI = isnull(VALUE,0) from TM_SYS_APPSETTINGS where CODE = 'OPD_TOAMUANGOAI_DUNGDANHMUC_DUOC'                if @TOAMUANGOAI = 1        begin        select  distinct '0' + '_' + LTRIM(d.DUOC_ID) + '_' + '0' as DUOC_KEY, 999999999 as SOLUONG        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        where  @param0  = 0        union all        select distinct tk.DUOC_KEY, tk.SOLUONG        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        inner join        (        select  LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')) DUOC_KEY, (SUM(dtk.SOLUONG) - isnull(sum(A.SOLUONG),0) - isnull(sum(B.SOLUONG),0)) SOLUONG, pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        from (select sum(soluong) soluong,duoc_id,nguonduoc_id,khoduoc_id,benhvien_id from TT_DUOC_TONKHO  group by duoc_id,nguonduoc_id,khoduoc_id,benhvien_id) dtk        inner join TM_DUOC_PHAMVISD_MAPPING pvsd on dtk.KHODUOC_ID = pvsd.KHODUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NOITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) B on B.DUOC_ID = dtk.DUOC_ID and B.PHAMVI_ID = pvsd.PHAMVI_ID and B.NGUONHANG_ID = dtk.NGUONDUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NGOAITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) A on A.DUOC_ID = dtk.DUOC_ID and A.PHAMVI_ID = pvsd.PHAMVI_ID and A.NGUONHANG_ID = dtk.NGUONDUOC_ID        where dtk.BENHVIEN_ID = 'HLU01'        group by LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')), pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        ) tk on tk.DUOC_ID = d.DUOC_ID        left join TM_DUOC_PHAMVISUDUNG kd on kd.PHAMVI_ID = tk.PHAMVI_ID and kd.BENHVIEN_ID = 'HLU01'        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = tk.NGUONDUOC_ID and nh.BENHVIEN_ID = 'HLU01'        where d.BENHVIEN_ID = 'HLU01' and tk.PHAMVI_ID =  @param0         end        else        begin        select distinct tk.DUOC_KEY, tk.SOLUONG        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        inner join        (        select  LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')) DUOC_KEY, (SUM(dtk.SOLUONG) - isnull(sum(A.SOLUONG),0) - isnull(sum(B.SOLUONG),0)) SOLUONG, pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        from (select sum(soluong) soluong,duoc_id,nguonduoc_id,khoduoc_id,benhvien_id from TT_DUOC_TONKHO  group by duoc_id,nguonduoc_id,khoduoc_id,benhvien_id) dtk        inner join TM_DUOC_PHAMVISD_MAPPING pvsd on dtk.KHODUOC_ID = pvsd.KHODUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NOITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) B on B.DUOC_ID = dtk.DUOC_ID and B.PHAMVI_ID = pvsd.PHAMVI_ID and B.NGUONHANG_ID = dtk.NGUONDUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NGOAITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) A on A.DUOC_ID = dtk.DUOC_ID and A.PHAMVI_ID = pvsd.PHAMVI_ID and A.NGUONHANG_ID = dtk.NGUONDUOC_ID        where dtk.BENHVIEN_ID = 'HLU01'        group by LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')), pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        ) tk on tk.DUOC_ID = d.DUOC_ID        left join TM_DUOC_PHAMVISUDUNG kd on kd.PHAMVI_ID = tk.PHAMVI_ID and kd.BENHVIEN_ID = 'HLU01'        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = tk.NGUONDUOC_ID and nh.BENHVIEN_ID = 'HLU01'        where d.BENHVIEN_ID = 'HLU01' and tk.PHAMVI_ID =  @param0         end]
2019-09-20 15:47:05,265 [1] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoVaBookingCOM23UpdateRedis_TheoPhamvi] Parameters: [@param0=[PHAMVI_ID,1028]]
2019-09-20 15:47:05,265 [1] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoVaBookingCOM23UpdateRedis_TheoPhamvi] Types: [@param0=[Int64, System.Int64]]
2019-09-20 15:47:05,631 [1] DEBUG - Statement Id: [DAO00064_GetlistTT_TIEPNHAN_SOTHEBHYT] PreparedStatement : [select stbhyt.*, ba.SOBENHAN,         tn.SOTIEPNHAN, tn.LOAITHANHVIEN_ID, tn.THE_ID, tn.THANHVIEN_ID,        tn.SUDUNG_BHTN, tn.BAOLANH_VIENPHI, tn.VIP, tn.NGUOINUOCNGOAI        from TT_TIEPNHAN_SOTHEBHYT stbhyt        left join TT_TIEPNHAN tn on tn.TIEPNHAN_ID = stbhyt.TIEPNHAN_ID        left join TT_NOITRU_BENHAN ba on ba.TIEPNHAN_ID = stbhyt.TIEPNHAN_ID        where         stbhyt.TIEPNHAN_ID = '27478' and isnull(stbhyt.KHONGSUDUNG, '0') = '0']
2019-09-20 15:47:05,715 [1] DEBUG - Statement Id: [DAO00064_GetListVienPhiByTiepNnan] PreparedStatement : [select distinct        B.DOITUONG_ID, B.NGAYMIENDONGCHITRA, B.BENHNHAN_ID as TIEPNHAN_BENHNHAN_ID, B.TRAITUYEN,        B.BHYTTREN3NAM as TREN3NAM, B.BHYTTREN5NAM as TREN5NAM, B.SOTIEPNHAN, B.SOBENHAN,        B.LOAITHANHVIEN_ID, B.SUDUNG_BHTN, B.THE_ID, B.THANHVIEN_ID, B.BAOLANH_VIENPHI, B.VIP, B.NGUOINUOCNGOAI,        C.GIATRIMIENGIAM as GIATRIMIENGIAM, D.GIATRIMIENGIAM as GIATRIMIENGIAM_BHTN, E.GIATRIMIENGIAM as GIATRIMIENGIAM_THANHVIEN,        F.GIATRIMIENGIAM as GIATRIMIENGIAM_CONGTY, DVYC.THE_ID as DVDUNGTHE, DVYC.TRANGTHAI as TRANGTHAIDICHVU, ndv.MANHOMDICHVU,        A.* from TT_VIENPHI A        left join        (select B.*, C.SOBENHAN, C.BENHAN_ID        from TT_TIEPNHAN B        left join TT_NOITRU_BENHAN C on B.TIEPNHAN_ID = C.TIEPNHAN_ID                 where B.TIEPNHAN_ID = '27478') B on B.TIEPNHAN_ID = A.TIEPNHAN_ID        left join (select sum(GIATRIMIENGIAM) as GIATRIMIENGIAM, VIENPHI_ID, REF_TABLE        from TT_MIENGIAM_CHITIET        where REF_TABLE = 'TT_MIENGIAM'        and exists (select MIENGIAM_ID from TT_MIENGIAM where TT_MIENGIAM_CHITIET.MIENGIAM_ID = MIENGIAM_ID and TINHTRANG = 1 and TIEPNHAN_ID = '27478')        group by VIENPHI_ID, REF_TABLE) C on C.REF_TABLE = 'TT_MIENGIAM' and C.VIENPHI_ID = A.VIENPHI_ID        left join (select sum(GIATRIMIENGIAM) as GIATRIMIENGIAM, VIENPHI_ID, REF_TABLE        from TT_MIENGIAM_CHITIET        where REF_TABLE = 'TT_MIENGIAM_BHTN'        and exists (select MIENGIAM_BHTN_ID from TT_MIENGIAM_BHTN where TT_MIENGIAM_CHITIET.MIENGIAM_ID = MIENGIAM_BHTN_ID and  TINHTRANG = 1 and TIEPNHAN_ID = '27478')        group by VIENPHI_ID, REF_TABLE) D on D.REF_TABLE = 'TT_MIENGIAM_BHTN' and D.VIENPHI_ID = A.VIENPHI_ID        left join (select sum(GIATRIMIENGIAM) as GIATRIMIENGIAM, VIENPHI_ID, REF_TABLE        from TT_MIENGIAM_CHITIET        where REF_TABLE = 'TT_MIENGIAM_THANHVIEN'        and exists (select MIENGIAM_THANHVIEN_ID from TT_MIENGIAM_THANHVIEN where TT_MIENGIAM_CHITIET.MIENGIAM_ID = MIENGIAM_THANHVIEN_ID and TINHTRANG = 1 and TIEPNHAN_ID = '27478')        group by VIENPHI_ID, REF_TABLE) E on E.REF_TABLE = 'TT_MIENGIAM_THANHVIEN' and E.VIENPHI_ID = A.VIENPHI_ID        left join (select sum(GIATRIMIENGIAM) as GIATRIMIENGIAM, VIENPHI_ID, REF_TABLE        from TT_MIENGIAM_CHITIET        where REF_TABLE = 'TT_MIENGIAM_CONGTY'        and exists (select MIENGIAM_CONGTY_ID from TT_MIENGIAM_CONGTY where TT_MIENGIAM_CHITIET.MIENGIAM_ID = MIENGIAM_CONGTY_ID and TINHTRANG = 1 and TIEPNHAN_ID = '27478')        group by VIENPHI_ID, REF_TABLE) F on F.REF_TABLE = 'TT_MIENGIAM_CONGTY' and F.VIENPHI_ID = A.VIENPHI_ID        left join TT_DVYEUCAU DVYC on DVYC.DVYEUCAU_ID = A.REF_ID and A.REF_TABLE = 'TT_DVYEUCAU'        left join TM_DICHVU DV on DVYC.DICHVU_ID = DV.DICHVU_ID and A.REF_TABLE = 'TT_DVYEUCAU'        left join TM_NHOMDICHVU ndv on ndv.NHOMDICHVU_ID = DV.NHOMDICHVU_ID and A.REF_TABLE = 'TT_DVYEUCAU'        where        A.TIEPNHAN_ID = '27478' and ((DVYC.HUYYEUCAU = '0' and A.DICHVU_ID is not null)        or A.DUOC_ID is not null or A.REF_TABLE = 'TT_NUT_XACNHANSUATAN_CHITIET')        and A.ACTIVE = '1'                 and A.BENHVIEN_ID = 'HLU01'        order by A.VIENPHI_ID]
2019-09-20 15:47:05,930 [1] DEBUG - Statement Id: [DAO00006_GetListDuocTyle] PreparedStatement : [select DUOC_ID, DOITUONG_ID, (TYLE/100) as TYLE, DONGIA MUCTRAN_THANHTOAN from TM_DOITUONG_GIADUOC_TYLE            where            BENHVIEN_ID = 'HLU01'            and DOITUONG_ID = '4']
2019-09-20 15:47:05,976 [1] DEBUG - Statement Id: [DAO00027_GetListTuongTrinhDichVuPhauThuatCuaTiepNhan] PreparedStatement : [declare @ManhomDSA varchar(10);        declare @PhanLoaiNhomDV varchar(20) = '05';        select top 1  @ManhomDSA = VALUE from TM_SYS_APPSETTINGS where CODE = 'MANHOM_DICHVU_DSA'        if (@ManhomDSA is not null) set @PhanLoaiNhomDV += ',' + @ManhomDSA        select distinct ptyc.*        from TT_PHAUTHUAT_YEUCAU ptyc        inner join TM_DICHVU dv on dv.DICHVU_ID = ptyc.DICHVU_ID        inner join TM_NHOMDICHVU ndv on ndv.NHOMDICHVU_ID = dv.NHOMDICHVU_ID        inner join TT_PHAUTHUAT pt on pt.PHAUTHUAT_ID = ptyc.PHAUTHUAT_ID        where        pt.TIEPNHAN_ID = 27478        and (left(ndv.MANHOMDICHVU, 2) in (select * from STRING_SPLIT(@PhanLoaiNhomDV,',')) or ndv.MANHOMDICHVU in (select * from STRING_SPLIT(@PhanLoaiNhomDV,',')))]
2019-09-20 15:47:06,055 [1] DEBUG - Statement Id: [DAO00006_GetList] PreparedStatement : [select dv.*, loaiDV.MALOAIDICHVU, captren.NHOMDICHVU_ID as NHOMDICHVU_CAPTREN_ID, captren.TENNHOMDICHVU as NHOMDICHVU_CAPTREN,              nhom_dv.TENNHOMDICHVU as TENNHOMDICHVU, nhom_dv.MANHOMDICHVU,              case when dv.ATTRIBUTE5 is null then 'TT' else 'KTC' end as LOAI_CHIPHI              from TM_DICHVU as dv              left join TM_NHOMDICHVU as nhom_dv on nhom_dv.NHOMDICHVU_ID = dv.NHOMDICHVU_ID and nhom_dv.BENHVIEN_ID = 'HLU01'              left join TM_NHOMDICHVU as captren on nhom_dv.CAPTREN_ID = captren.NHOMDICHVU_ID and captren.BENHVIEN_ID = 'HLU01'              left join TM_LOAIDICHVU loaiDV on nhom_dv.LOAIDICHVU_ID = loaiDV.LOAIDICHVU_ID and loaiDV.BENHVIEN_ID = 'HLU01'              where nhom_dv.TAMNGUNG = '0' and dv.BENHVIEN_ID = 'HLU01'              and dv.TAMNGUNG = '0'               AND                   loaiDV.MALOAIDICHVU = 'KhamBenh']
2019-09-20 15:47:06,393 [1] DEBUG - Statement Id: [DAO00023_UpdateNhieuVP] PreparedStatement : [declare @jsonVienPhi nvarchar(max) = N'[{"VIENPHI_ID":674724,"TIEPNHAN_ID":27478,"BENHAN_ID":0,"SOLUONG":1.0000,"DONGIA_DOANHTHU":33000.0000,"THANHTIEN_DOANHTHU":33000.00,"BHYT_TL":1.0,"BHYT_DONGIA":33000.0000,"BHYT_THANHTIEN":33000.00,"BHYT_DONGIA_CONGKHAM_DAU":33000.0000,"BHYT_CONGKHAM_DAU_TYLE":1.0,"BHYT_DONGIA_CHITRA":33000.0,"BHYT_THANHTIEN_CHITRA":33000.00,"BENHNHAN_PHAITHANHTOAN":0.00,"GIATRI_HOADON":0.0,"GIATRI_HOADON_DATHANHTOAN":0.0,"GIATRI_BIENLAI":0.0,"GIATRI_BIENLAI_DATHANHTOAN":0.0,"GIATRI_BENHNHAN_DATHANHTOAN":0.0,"DATHUCHIEN":"1","KHONGTHUTIEN":"0","BHYTDONGTIEN":"0","DICHVU_TL":1.0,"BHYT_DONGIA_DONGCT_DAU":0.0,"SOBHYT":"DN453534653452338289","SOBHYT_HUONG_ID":28501,"GIATRIMIENGIAM":0.0,"GIATRIMIENGIAM_BHTN":0.0,"GIATRIMIENGIAM_THANHVIEN":0.0,"GIATRIMIENGIAM_CONGTY":0.0}]';        begin        UPDATE TT_VIENPHI        SET        SOLUONG = json.SOLUONG,        DONGIA_DOANHTHU = json.DONGIA_DOANHTHU,        THANHTIEN_DOANHTHU = json.THANHTIEN_DOANHTHU,        BHYT_TL = json.BHYT_TL,        BHYT_DONGIA = json.BHYT_DONGIA,        BHYT_THANHTIEN = json.BHYT_THANHTIEN,        BHYT_DONGIA_CONGKHAM_DAU = json.BHYT_DONGIA_CONGKHAM_DAU,        BHYT_CONGKHAM_DAU_TYLE = json.BHYT_CONGKHAM_DAU_TYLE,        BHYT_DONGIA_CHITRA = json.BHYT_DONGIA_CHITRA,        BHYT_THANHTIEN_CHITRA = json.BHYT_THANHTIEN_CHITRA,        BENHNHAN_PHAITHANHTOAN = json.BENHNHAN_PHAITHANHTOAN,        GIATRI_HOADON = json.GIATRI_HOADON,                GIATRI_BIENLAI = json.GIATRI_BIENLAI,                DATHUCHIEN = json.DATHUCHIEN,                DICHVU_TL = json.DICHVU_TL,        BHYT_DONGIA_DONGCT_DAU = json.BHYT_DONGIA_DONGCT_DAU,        NGAYCAPNHAT = GETDATE()        FROM OPENJSON (@jsonVienPhi)        WITH (        VIENPHI_ID int,        SOLUONG numeric(25, 4),        DONGIA_DOANHTHU numeric(25, 4),        THANHTIEN_DOANHTHU numeric(25, 4),        BHYT_TL numeric(25, 4),        BHYT_DONGIA numeric(25, 4),        BHYT_THANHTIEN numeric(25, 4),        BHYT_DONGIA_CONGKHAM_DAU numeric(25, 4),        BHYT_CONGKHAM_DAU_TYLE numeric(25, 4),        BHYT_DONGIA_CHITRA numeric(25, 4),        BHYT_THANHTIEN_CHITRA numeric(25, 4),        BENHNHAN_PHAITHANHTOAN numeric(25, 4),        GIATRI_HOADON numeric(25, 4),                GIATRI_BIENLAI numeric(25, 4),                DATHUCHIEN char(1),        KHONGTHUTIEN char(1),        BHYTDONGTIEN char(1),        DICHVU_TL numeric(25, 4),        BHYT_DONGIA_DONGCT_DAU numeric(25, 4))  json        WHERE TT_VIENPHI.VIENPHI_ID = json.VIENPHI_ID                        insert into TT_TINH_VIENPHI_LOG        SELECT json.VIENPHI_ID, json.TIEPNHAN_ID, json.BENHAN_ID, json.SOLUONG, json.BHYT_TL, json.DONGIA_DOANHTHU,        json.THANHTIEN_DOANHTHU, json.BHYT_DONGIA, json.BHYT_THANHTIEN, json.BHYT_DONGIA_CHITRA, json.BHYT_THANHTIEN_CHITRA, json.BENHNHAN_PHAITHANHTOAN,        json.SOBHYT_HUONG_ID, json.SOBHYT, GETDATE(), -1, 'HLU01'        FROM OPENJSON(@jsonVienPhi)        WITH (        VIENPHI_ID int,        TIEPNHAN_ID int,        BENHAN_ID int,        SOLUONG numeric(25, 4),        DONGIA_DOANHTHU numeric(25, 4),        THANHTIEN_DOANHTHU numeric(25, 4),        BHYT_TL numeric(25, 4),        BHYT_DONGIA numeric(25, 4),        BHYT_THANHTIEN numeric(25, 4),        BHYT_DONGIA_CHITRA numeric(25, 4),        BHYT_THANHTIEN_CHITRA numeric(25, 4),        BENHNHAN_PHAITHANHTOAN numeric(25, 4),        SOBHYT_HUONG_ID int,        SOBHYT nvarchar(30)) json        end]
2019-09-20 15:47:06,455 [1] DEBUG - Statement Id: [DAO00067_UpdateDataVienPhiDongiaBHYT] PreparedStatement : [update TT_VIENPHI          set BHYT_DONGIA_CHITRA = 0, BHYT_THANHTIEN = 0, BHYT_THANHTIEN_CHITRA = 0          where          TIEPNHAN_ID = 27478 and BHYT_DONGIA = 0          and (BHYT_DONGIA_CHITRA > 0 or BHYT_THANHTIEN > 0 or BHYT_THANHTIEN_CHITRA > 0)]
2019-09-20 15:47:06,502 [1] DEBUG - Statement Id: [DAO00067_CapnhatDataVienphiKhiHuyThanhtoanHoadon] PreparedStatement : [update TT_VIENPHI        set TT_VIENPHI.HOADON_ID = hdct.HOADON_ID, TT_VIENPHI.GIATRI_BENHNHAN_DATHANHTOAN = TT_VIENPHI.GIATRI_BENHNHAN_DATHANHTOAN + hdct.GIATRI_BENHNHAN_DATHANHTOAN        from (select CT.HOADON_ID, CT.VIENPHI_ID, CT.GIATRI_BENHNHAN_DATHANHTOAN        from TT_HOADON_CHITIET_NGOAITRU CT        join TT_HOADON HD on HD.HOADON_ID = CT.HOADON_ID        join TT_VIENPHI vp on vp.VIENPHI_ID = ct.VIENPHI_ID        where HD.DATHANHTOAN = 1 and HD.HUYHOADON = 0 and HD.HOANTRA = 0 and vp.TIEPNHAN_ID =  @param0 ) hdct        where        TT_VIENPHI.VIENPHI_ID = hdct.VIENPHI_ID and TT_VIENPHI.HOADON_ID is null and isnull(TT_VIENPHI.GIATRI_BENHNHAN_DATHANHTOAN,0) = 0        and TT_VIENPHI.TIEPNHAN_ID =  @param0           update TT_VIENPHI        set TT_VIENPHI.HOADON_ID = null, TT_VIENPHI.GIATRI_BENHNHAN_DATHANHTOAN = TT_VIENPHI.GIATRI_BENHNHAN_DATHANHTOAN - hdct.GIATRI_BENHNHAN_DATHANHTOAN,        TT_VIENPHI.DATHANHTOAN = '0'        from (select CT.HOADON_ID, CT.VIENPHI_ID, CT.GIATRI_BENHNHAN_DATHANHTOAN        from TT_HOADON_CHITIET_NGOAITRU CT        join TT_HOADON HD on HD.HOADON_ID = CT.HOADON_ID        join TT_VIENPHI vp on vp.VIENPHI_ID = ct.VIENPHI_ID and vp.HOADON_ID = ct.HOADON_ID        where HD.DATHANHTOAN = 0 and (HD.HUYHOADON = 1 or HD.HOANTRA = 1) and vp.TIEPNHAN_ID =  @param0 ) hdct        where        TT_VIENPHI.VIENPHI_ID = hdct.VIENPHI_ID and TT_VIENPHI.HOADON_ID = hdct.HOADON_ID        and TT_VIENPHI.TIEPNHAN_ID =  @param0]
2019-09-20 15:47:06,502 [1] DEBUG - Statement Id: [DAO00067_CapnhatDataVienphiKhiHuyThanhtoanHoadon] Parameters: [@param0=[TIEPNHAN_ID,27478]]
2019-09-20 15:47:06,502 [1] DEBUG - Statement Id: [DAO00067_CapnhatDataVienphiKhiHuyThanhtoanHoadon] Types: [@param0=[Int64, System.Int64]]
2019-09-20 15:47:06,745 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'COM11'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2019-09-20 15:47:08,576 [1] DEBUG - Statement Id: [DAO00017_GetDanhSachNoiThucHien] PreparedStatement : [select pb.PHONGBAN_ID, pb.TENPHONGBAN              from [TM_PHONGBAN] as pb              left join LST_DICTIONARY dic on pb.LOAIPHONGBAN_ID = dic.DICTIONARY_ID              where pb.BENHVIEN_ID = 'HLU01'                          and dic.DICTIONARY_TYPE_CODE = 'LoaiPhongBan'            and dic.DICTIONARY_CODE in ('KhamBenh','PhongBenh','KhoaNoi','PhongMo','KhoaDuoc','KhoaCLS', 'KhoaNgoai')]
2019-09-20 15:47:08,693 [1] DEBUG - Statement Id: [DAO00012_GetList] PreparedStatement : [select        DICTIONARY_ID,        DICTIONARY_CODE,        DICTIONARY_NAME,        ATTRIBUTE1,        ATTRIBUTE2,        DICTIONARY_NAME_EN        from LST_DICTIONARY        where LST_DICTIONARY.Enabled = '1'         AND           LST_DICTIONARY.DICTIONARY_TYPE_CODE = 'NguonBN'                 order by LST_DICTIONARY.IDX]
2019-09-20 15:47:09,025 [1] DEBUG - Statement Id: [DAO00014_GetPatientStatus] PreparedStatement : [select        CASE        when tn.TRANGTHAI = 'HOANTHANH' Then tn.TRANGTHAI        WHEN xncp.XACNHANCHIPHI_ID is not null THEN 'XACNHANCHIPHI'        WHEN (tn.KHOADULIEU = '1') THEN 'KHOADULIEU'        ELSE tn.TRANGTHAI        END        as TRANGTHAI        from TT_TIEPNHAN tn        left join TT_XACNHANCHIPHI xncp on tn.TIEPNHAN_ID = xncp.TIEPNHAN_ID        where tn.TIEPNHAN_ID = '27478'        and tn.BENHVIEN_ID = 'HLU01']
2019-09-20 15:47:09,132 [1] DEBUG - Statement Id: [DAO00013_GetTienSuBenh] PreparedStatement : [select TIENSUBENH, TIENSUDIUNG              from TT_BENHNHAN              where TT_BENHNHAN.BENHNHAN_ID  = '23423']
2019-09-20 15:47:09,169 [1] DEBUG - Statement Id: [DAO00095_GetTTDiUngThuoc] PreparedStatement : [select *              from TT_BENHNHAN_DIUNG_THUOC              where BENHNHAN_ID = '23423'              and BENHVIEN_ID = 'HLU01']
2019-09-20 15:47:09,202 [1] DEBUG - Statement Id: [DAO00017_GetLoaiGiaByDoiTuongId] PreparedStatement : [select dtlg.DOUUTIEN, dtlg.DOITUONG_ID, lg.LOAIGIA_ID, lg.TENLOAIGIA, lg.MALOAIGIA              from TM_LOAIGIA lg              left join TM_DOITUONG_LOAIGIA dtlg              on lg.LOAIGIA_ID = dtlg.LOAIGIA_ID and dtlg.BENHVIEN_ID = 'HLU01'              where lg.TAMNGUNG = 0 and lg.BENHVIEN_ID = 'HLU01'               AND                   dtlg.DOITUONG_ID = '4'                             order by dtlg.DOUUTIEN]
2019-09-20 15:47:09,452 [1] DEBUG - Statement Id: [DAO00099_TT_CSKH_GOI_DANGKY_Service_GetList_01] PreparedStatement : [select GDV.*, GOI.TENGOI, GOI.LOAIGOI_ID from TT_CSKH_GOI_DANGKY GDV        left join TM_CSKH_GOI GOI on GOI.GOI_ID = GDV.GOI_ID        where LOAIGOI_ID in (select DICTIONARY_ID from LST_DICTIONARY where DICTIONARY_CODE = 'NgoaiTru'                              and DICTIONARY_TYPE_CODE = 'LoaiGoiDV')                 and             GDV.BENHNHAN_ID = '23423'           and             GDV.TRANGTHAI in ('DAKICHHOAT','FOLLOWUP')           and             GDV.BENHVIEN_ID = 'HLU01']
2019-09-20 15:47:09,513 [1] DEBUG - Statement Id: [DAO00085_GetDSDichVuThe] PreparedStatement : [select *        from TT_CSKH_THETHANHVIEN_SUDUNG        where THE_ID = '0'        and BENHVIEN_ID = 'HLU01']
2019-09-20 15:47:09,557 [1] DEBUG - Statement Id: [DAO00020_GetDSDichVuYC] PreparedStatement : [select dvyc.*,        dv.TENDICHVU, dv.MADICHVU, dv.NORESULT, ndv.MANHOMDICHVU, ndv.TENNHOMDICHVU, vp.KHONGTHUTIEN        from TT_DVYEUCAU dvyc        left join TM_DICHVU dv on dvyc.DICHVU_ID = dv.DICHVU_ID        left join TM_NHOMDICHVU ndv on ndv.NHOMDICHVU_ID = dv.NHOMDICHVU_ID        left join (select * from TT_VIENPHI where TIEPNHAN_ID = '27478') vp on dvyc.DVYEUCAU_ID = vp.REF_ID                 where        dvyc.TIEPNHAN_ID = 27478        and REF_TABLE = 'TT_DVYEUCAU'                 order by DVYEUCAU_ID desc]
2019-09-20 15:47:09,631 [1] DEBUG - Statement Id: [DAO00020_GetDanhsachVPCuaDichvuYeucau] PreparedStatement : [select V.*, CASE WHEN A.VIENPHI_ID IS NULL AND B.VIENPHI_ID IS NULL THEN '0' ELSE '1' END AS EXIST_HOADON_HUY,        dv.TENDICHVU, dv.MADICHVU, dv.NORESULT, ndv.MANHOMDICHVU, ndv.TENNHOMDICHVU        from TT_VIENPHI AS V        left join TM_DICHVU dv on V.DICHVU_ID = dv.DICHVU_ID and V.REF_TABLE = 'TT_DVYEUCAU'        left join TM_NHOMDICHVU ndv on ndv.NHOMDICHVU_ID = dv.NHOMDICHVU_ID        left join (select DISTINCT HD.VIENPHI_ID from TT_HOADON_CHITIET_NGOAITRU AS HD        inner join TT_HOADON AS H ON H.HOADON_ID = HD.HOADON_ID AND H.HUYHOADON = '1'        where H.TIEPNHAN_ID = '27478'        ) AS A ON A.VIENPHI_ID = V.VIENPHI_ID        left join (select DISTINCT HD.VIENPHI_ID from TT_HOADON_CHITIET_NOITRU AS HD        inner join TT_HOADON AS H ON H.HOADON_ID = HD.HOADON_ID AND H.HUYHOADON = '1'        where H.TIEPNHAN_ID = 27478                 ) AS B ON B.VIENPHI_ID = V.VIENPHI_ID                 where        V.TIEPNHAN_ID = 27478 and V.REF_TABLE = 'TT_DVYEUCAU']
2019-09-20 15:47:19,012 [1] DEBUG - Statement Id: [DAO00019_GetLoaiGiaLoaiKhachHang] PreparedStatement : [select A.*, B.DICTIONARY_CODE MAKHACHHANG, C.TENLOAIGIA        from TM_NGUONKHACHHANG_LOAIGIA A        left join LST_DICTIONARY B on A.NGUONKHACHHANG_BENHNHAN_ID = B.DICTIONARY_ID        inner join TM_LOAIGIA C on C.LOAIGIA_ID = A.LOAIGIA_ID and CAPTREN_ID  = (select LOAIGIA_ID from TM_LOAIGIA where MALOAIGIA = 'GiaDichVu')        left join TM_DICHVU_DONGIA dvdg on dvdg.LOAIGIA_ID = A.LOAIGIA_ID        where B.DICTIONARY_TYPE_CODE = 'NguonKhachHang' and dvdg.DICHVU_ID  =  @param0]
2019-09-20 15:47:19,012 [1] DEBUG - Statement Id: [DAO00019_GetLoaiGiaLoaiKhachHang] Parameters: [@param0=[DICHVU_ID,4145]]
2019-09-20 15:47:19,012 [1] DEBUG - Statement Id: [DAO00019_GetLoaiGiaLoaiKhachHang] Types: [@param0=[Int64, System.Int64]]
2019-09-20 15:47:19,067 [1] DEBUG - Statement Id: [DAO00017_GetLoaiGiaDoiTuongDichVu] PreparedStatement : [select a.LOAIGIA_ID, a.TENLOAIGIA, a.MALOAIGIA, a.CAPTREN_ID, MIN(a.UUTIEN_NGUON) AS UUTIEN_NGUON          , MAX(a.DOUUTIEN) AS DOUUTIEN, MIN(ISNULL(a.GIAHOTRO,0)) AS GIAHOTRO          from(                        select distinct A.LOAIGIA_ID, C.TENLOAIGIA, C.MALOAIGIA, 0 as UUTIEN_NGUON, isnull(B.DOUUTIEN,0) as DOUUTIEN, B.GIAHOTRO, C.CAPTREN_ID            from TM_DOITUONG_GIADICHVU A            left join TM_DOITUONG_LOAIGIA B on A.LOAIGIA_ID = B.LOAIGIA_ID and A.DOITUONG_ID = B.DOITUONG_ID and B.BENHVIEN_ID = 'HLU01'            inner join TM_LOAIGIA C on A.LOAIGIA_ID = C.LOAIGIA_ID and C.BENHVIEN_ID = 'HLU01'            where A.DOITUONG_ID = '4'                            and A.DICHVU_ID = '4145'                            and C.CAPTREN_ID = (select LOAIGIA_ID from TM_LOAIGIA              where MALOAIGIA = 'GiaDichVu'              and BENHVIEN_ID = 'HLU01')                         and A.BENHVIEN_ID = 'HLU01'                     ) a          where a.DOUUTIEN != 0 and a.DOUUTIEN is not null          group by a.LOAIGIA_ID, a.TENLOAIGIA, a.MALOAIGIA, a.CAPTREN_ID          order by MAX(a.UUTIEN_NGUON) desc ,MAX(a.DOUUTIEN) asc]
2019-09-20 15:47:19,213 [1] DEBUG - Statement Id: [DAO00000_GetDICHVU_DONGIA_LOAIGIA] PreparedStatement : [select A.LOAIGIA_ID, A.BANGGIA_ID, A.GIAVON, A.TYLEVAT  as TYLE_VAT, A.TYLE_LOINHUAN,            A.DONGIA as DONGIA_DOANHTHU, NULL as DONGIA_KHAC, isnull(D.MAPHANNHOMDICHVU, 'TT') as LOAI_CHIPHI            from TM_DICHVU_DONGIA A            inner join TM_BANGGIA B on B.LOAIGIA_ID = A.LOAIGIA_ID AND B.BENHVIEN_ID = 'HLU01'            left join (select B.MAPHANNHOMDICHVU, A.* from TM_DICHVU_PHANNHOMDICHVU A            inner join TM_PHANNHOMDICHVU B on  B.PHANNHOMDICHVU_ID = A.PHANNHOMDICHVU_ID            where A.DICHVU_ID = '4145' AND A.BENHVIEN_ID = 'HLU01') D on A.DICHVU_ID = D.DICHVU_ID            where A.LOAIGIA_ID = '2' and A.DICHVU_ID = '4145'            union            select A.LOAIGIA_ID, null as BANGGIA_ID, null as GIAVON, null as TYLE_VAT, null as TYLE_LOINHUAN,            null as DONGIA_DOANHTHU, C.DONGIA as DONGIA_KHAC, isnull(D.MAPHANNHOMDICHVU, 'TT') as LOAI_CHIPHI            from TM_DOITUONG_GIADICHVU A            inner join TM_BANGGIA B on B.LOAIGIA_ID = A.LOAIGIA_ID AND B.BENHVIEN_ID = 'HLU01'            left join TM_DICHVU_DONGIA C on C.LOAIGIA_ID = A.LOAIGIA_ID AND C.BENHVIEN_ID = 'HLU01'            and C.BANGGIA_ID = B.BANGGIA_ID and C.DICHVU_ID = A.DICHVU_ID            left join (select B.MAPHANNHOMDICHVU, A.* from TM_DICHVU_PHANNHOMDICHVU A            inner join TM_PHANNHOMDICHVU B on  B.PHANNHOMDICHVU_ID = A.PHANNHOMDICHVU_ID            where A.DICHVU_ID = '4145' AND A.BENHVIEN_ID = 'HLU01') D on A.DICHVU_ID = D.DICHVU_ID            where A.DOITUONG_ID = '4'  and A.DICHVU_ID = '4145' and A.LOAIGIA_ID            in (select top 1 LOAIGIA_ID from TM_DOITUONG_LOAIGIA            where DOITUONG_ID = '4' and GIAHOTRO = '1'  AND BENHVIEN_ID = 'HLU01'            and LOAIGIA_ID            in (select LOAIGIA_ID from TM_BANGGIA            where LOAIBANGGIA in            (select LOAIBANGGIA from TM_BANGGIA where LOAIGIA_ID = '2'  AND BENHVIEN_ID = 'HLU01')            and TAMNGUNG = '0')  AND BENHVIEN_ID = 'HLU01'            )]
2019-09-20 15:47:19,411 [1] DEBUG - Statement Id: [DAO00024_TM_TIEPNHAN_BANGGIA_DICHVU_getlist] PreparedStatement : [select * from TM_TIEPNHAN_BANGGIA_DICHVU where TAMNGUNG != '1' and BENHVIEN_ID = 'HLU01']
2019-09-20 15:47:19,445 [1] DEBUG - Statement Id: [DAO00000_GetDICHVU_DONGIA_LOAIGIA] PreparedStatement : [select A.LOAIGIA_ID, A.BANGGIA_ID, A.GIAVON, A.TYLEVAT  as TYLE_VAT, A.TYLE_LOINHUAN,            A.DONGIA as DONGIA_DOANHTHU, NULL as DONGIA_KHAC, isnull(D.MAPHANNHOMDICHVU, 'TT') as LOAI_CHIPHI            from TM_DICHVU_DONGIA A            inner join TM_BANGGIA B on B.LOAIGIA_ID = A.LOAIGIA_ID AND B.BENHVIEN_ID = 'HLU01'            left join (select B.MAPHANNHOMDICHVU, A.* from TM_DICHVU_PHANNHOMDICHVU A            inner join TM_PHANNHOMDICHVU B on  B.PHANNHOMDICHVU_ID = A.PHANNHOMDICHVU_ID            where A.DICHVU_ID = '4145' AND A.BENHVIEN_ID = 'HLU01') D on A.DICHVU_ID = D.DICHVU_ID            where A.LOAIGIA_ID = '2' and A.DICHVU_ID = '4145'            union            select A.LOAIGIA_ID, null as BANGGIA_ID, null as GIAVON, null as TYLE_VAT, null as TYLE_LOINHUAN,            null as DONGIA_DOANHTHU, C.DONGIA as DONGIA_KHAC, isnull(D.MAPHANNHOMDICHVU, 'TT') as LOAI_CHIPHI            from TM_DOITUONG_GIADICHVU A            inner join TM_BANGGIA B on B.LOAIGIA_ID = A.LOAIGIA_ID AND B.BENHVIEN_ID = 'HLU01'            left join TM_DICHVU_DONGIA C on C.LOAIGIA_ID = A.LOAIGIA_ID AND C.BENHVIEN_ID = 'HLU01'            and C.BANGGIA_ID = B.BANGGIA_ID and C.DICHVU_ID = A.DICHVU_ID            left join (select B.MAPHANNHOMDICHVU, A.* from TM_DICHVU_PHANNHOMDICHVU A            inner join TM_PHANNHOMDICHVU B on  B.PHANNHOMDICHVU_ID = A.PHANNHOMDICHVU_ID            where A.DICHVU_ID = '4145' AND A.BENHVIEN_ID = 'HLU01') D on A.DICHVU_ID = D.DICHVU_ID            where A.DOITUONG_ID = '4'  and A.DICHVU_ID = '4145' and A.LOAIGIA_ID            in (select top 1 LOAIGIA_ID from TM_DOITUONG_LOAIGIA            where DOITUONG_ID = '4' and GIAHOTRO = '1'  AND BENHVIEN_ID = 'HLU01'            and LOAIGIA_ID            in (select LOAIGIA_ID from TM_BANGGIA            where LOAIBANGGIA in            (select LOAIBANGGIA from TM_BANGGIA where LOAIGIA_ID = '2'  AND BENHVIEN_ID = 'HLU01')            and TAMNGUNG = '0')  AND BENHVIEN_ID = 'HLU01'            )]
2019-09-20 15:47:19,582 [1] DEBUG - Statement Id: [DAO00024_TM_TIEPNHAN_BANGGIA_DICHVU_getlist] PreparedStatement : [select * from TM_TIEPNHAN_BANGGIA_DICHVU where TAMNGUNG != '1' and BENHVIEN_ID = 'HLU01']
2019-09-20 15:47:23,697 [1] DEBUG - Statement Id: [DAO00020_KiemtrangaychidinhdvHople] PreparedStatement : [select * from TT_TIEPNHAN where  THOIGIANTIEPNHAN >  @param0  and TIEPNHAN_ID =  @param1]
2019-09-20 15:47:23,698 [1] DEBUG - Statement Id: [DAO00020_KiemtrangaychidinhdvHople] Parameters: [@param0=[NGAYGIOYEUCAU,9/20/2019 3:47:09 PM], @param1=[TIEPNHAN_ID,27478]]
2019-09-20 15:47:23,698 [1] DEBUG - Statement Id: [DAO00020_KiemtrangaychidinhdvHople] Types: [@param0=[DateTime, System.DateTime], @param1=[Int64, System.Int64]]
2019-09-20 15:47:23,740 [1] DEBUG - Statement Id: [DAO00020_GetDSDichVuYC_TN] PreparedStatement : [select top 1 dvyc.TIEPNHAN_ID, dvyc.BENHNHAN_ID, ntba.BENHAN_ID, dvyc.DICHVU_ID, dvyc.HUYYEUCAU,        case when ntba.SOBENHAN is null then N'ngoại trú'        when ntba.SOBENHAN like '%CC' then N'cấp cứu'        when ntba.SOBENHAN is not null then N'nội trú'        else N'' end as SUDUNGTAI        from TT_DVYEUCAU dvyc        left join TT_NOITRU_BENHAN ntba on dvyc.BENHAN_ID = ntba.BENHAN_ID        where        dvyc.TIEPNHAN_ID = 27478        and dvyc.HUYYEUCAU = 0        and dvyc.DICHVU_ID = 4145        order by dvyc.NGAYGIOYEUCAU desc]
2019-09-20 15:47:23,819 [1] DEBUG - Statement Id: [DAO00023_GetVienPhiDichVuBSKhac] PreparedStatement : [select *        from TT_VIENPHI        where                    TIEPNHAN_ID = '27478'                 and NGUOITAO_ID != '1'        and DICHVU_ID is not null]
2019-09-20 15:47:23,861 [1] DEBUG - Statement Id: [DAO00064_GetTopTT_TIEPNHAN_SOTHEBHYT] PreparedStatement : [select top 1 stbhyt.*, ba.SOBENHAN,         tn.SOTIEPNHAN, tn.LOAITHANHVIEN_ID, tn.THE_ID, tn.THANHVIEN_ID,        tn.SUDUNG_BHTN, tn.BAOLANH_VIENPHI, tn.VIP, tn.NGUOINUOCNGOAI        from TT_TIEPNHAN_SOTHEBHYT stbhyt        left join TT_TIEPNHAN tn on tn.TIEPNHAN_ID = stbhyt.TIEPNHAN_ID        left join TT_NOITRU_BENHAN ba on ba.TIEPNHAN_ID = stbhyt.TIEPNHAN_ID        where         stbhyt.TIEPNHAN_ID = '27478' and isnull(stbhyt.KHONGSUDUNG, '0') = '0'              order by SOBHYT_HUONG_ID desc]
2019-09-20 15:47:23,895 [1] DEBUG - Statement Id: [DAO00006_GetListDuocTyle] PreparedStatement : [select DUOC_ID, DOITUONG_ID, (TYLE/100) as TYLE, DONGIA MUCTRAN_THANHTOAN from TM_DOITUONG_GIADUOC_TYLE            where            BENHVIEN_ID = 'HLU01'            and DOITUONG_ID = '4']
2019-09-20 15:47:23,927 [1] DEBUG - Statement Id: [DAO00027_GetListTuongTrinhDichVuPhauThuatCuaTiepNhan] PreparedStatement : [declare @ManhomDSA varchar(10);        declare @PhanLoaiNhomDV varchar(20) = '05';        select top 1  @ManhomDSA = VALUE from TM_SYS_APPSETTINGS where CODE = 'MANHOM_DICHVU_DSA'        if (@ManhomDSA is not null) set @PhanLoaiNhomDV += ',' + @ManhomDSA        select distinct ptyc.*        from TT_PHAUTHUAT_YEUCAU ptyc        inner join TM_DICHVU dv on dv.DICHVU_ID = ptyc.DICHVU_ID        inner join TM_NHOMDICHVU ndv on ndv.NHOMDICHVU_ID = dv.NHOMDICHVU_ID        inner join TT_PHAUTHUAT pt on pt.PHAUTHUAT_ID = ptyc.PHAUTHUAT_ID        where        pt.TIEPNHAN_ID = 27478        and (left(ndv.MANHOMDICHVU, 2) in (select * from STRING_SPLIT(@PhanLoaiNhomDV,',')) or ndv.MANHOMDICHVU in (select * from STRING_SPLIT(@PhanLoaiNhomDV,',')))]
2019-09-20 15:47:23,967 [1] DEBUG - Statement Id: [DAO00006_GetList] PreparedStatement : [select dv.*, loaiDV.MALOAIDICHVU, captren.NHOMDICHVU_ID as NHOMDICHVU_CAPTREN_ID, captren.TENNHOMDICHVU as NHOMDICHVU_CAPTREN,              nhom_dv.TENNHOMDICHVU as TENNHOMDICHVU, nhom_dv.MANHOMDICHVU,              case when dv.ATTRIBUTE5 is null then 'TT' else 'KTC' end as LOAI_CHIPHI              from TM_DICHVU as dv              left join TM_NHOMDICHVU as nhom_dv on nhom_dv.NHOMDICHVU_ID = dv.NHOMDICHVU_ID and nhom_dv.BENHVIEN_ID = 'HLU01'              left join TM_NHOMDICHVU as captren on nhom_dv.CAPTREN_ID = captren.NHOMDICHVU_ID and captren.BENHVIEN_ID = 'HLU01'              left join TM_LOAIDICHVU loaiDV on nhom_dv.LOAIDICHVU_ID = loaiDV.LOAIDICHVU_ID and loaiDV.BENHVIEN_ID = 'HLU01'              where nhom_dv.TAMNGUNG = '0' and dv.BENHVIEN_ID = 'HLU01'              and dv.TAMNGUNG = '0'               AND                   loaiDV.MALOAIDICHVU = 'KhamBenh']
2019-09-20 15:47:38,015 [1] DEBUG - Statement Id: [DAO00406_GetListDichVuByNhomDichVu] PreparedStatement : [DECLARE @x int, @y int;          SET @x = 100000000;          SET @y = 200000000;          WITH DichvuRec AS          (          SELECT D.DICHVU_ID AS CATEGORY_ID, D.MADICHVU AS CATEGORY_CODE, D.TENDICHVU AS CATEGORY_NAME, (ND.CAP + 1) AS FOLDER_LEVEL, ISNULL(D.CAPTREN_ID,D.NHOMDICHVU_ID + @x) AS PARENT_ID, '0' AS IS_FOLDER, D.IDX          FROM TM_DICHVU AS D          INNER JOIN TM_NHOMDICHVU AS ND ON D.NHOMDICHVU_ID = ND.NHOMDICHVU_ID          WHERE D.CAP = 1 AND D.CAPTREN_ID IS NULL AND D.BENHVIEN_ID = 'HLU01'  AND D.TAMNGUNG = '0' AND ND.NHOMDICHVU_ID = 34          UNION ALL          SELECT D.DICHVU_ID AS CATEGORY_ID, D.MADICHVU AS CATEGORY_CODE, D.TENDICHVU AS CATEGORY_NAME, (DR.FOLDER_LEVEL + 1) AS FOLDER_LEVEL, D.CAPTREN_ID AS PARENT_ID, '0' AS IS_FOLDER, D.IDX          FROM DichvuRec AS DR          INNER JOIN dbo.TM_DICHVU AS D ON D.CAPTREN_ID = DR.CATEGORY_ID AND D.BENHVIEN_ID = 'HLU01'          )          , NhomdichvuRec AS          (          SELECT (ND.NHOMDICHVU_ID + @x) AS CATEGORY_ID, ND.MANHOMDICHVU AS CATEGORY_CODE, ND.TENNHOMDICHVU AS CATEGORY_NAME, ND.CAP AS FOLDER_LEVEL, ISNULL(ND.CAPTREN_ID,ND.LOAIDICHVU_ID + @y) AS PARENT_ID, '1' AS IS_FOLDER, NULL AS IDX          FROM TM_NHOMDICHVU AS ND          WHERE ND.CAP = 1 AND ND.CAPTREN_ID IS NULL AND ND.BENHVIEN_ID = 'HLU01' AND ND.NHOMDICHVU_ID = 34          UNION ALL          SELECT (ND.NHOMDICHVU_ID + @x) AS CATEGORY_ID, ND.MANHOMDICHVU AS CATEGORY_CODE, ND.TENNHOMDICHVU AS CATEGORY_NAME, (DR.FOLDER_LEVEL + 1) AS FOLDER_LEVEL, (ND.CAPTREN_ID + @x) AS PARENT_ID, '1' AS IS_FOLDER, NULL AS IDX          FROM NhomdichvuRec AS DR          INNER JOIN dbo.TM_NHOMDICHVU AS ND ON (ND.CAPTREN_ID + @x) = DR.CATEGORY_ID AND ND.BENHVIEN_ID = 'HLU01'          )          SELECT 0 AS CHON,* FROM DichvuRec          UNION ALL          SELECT 0 AS CHON,* FROM NhomdichvuRec          UNION ALL          SELECT 0 AS CHON,(LD.LOAIDICHVU_ID + @y) AS CATEGORY_ID, LD.MALOAIDICHVU AS CATEGORY_CODE, LD.TENLOAIDICHVU AS CATEGORY_NAME, 0 AS FOLDER_LEVEL, 0 AS PARENT_ID, '1' AS IS_FOLDER, NULL AS IDX          FROM TM_LOAIDICHVU AS LD          WHERE LD.BENHVIEN_ID = 'HLU01'          ORDER BY IDX, CATEGORY_ID]
2019-09-20 15:48:10,464 [1] DEBUG - Statement Id: [DAO00019_GetLoaiGiaLoaiKhachHang] PreparedStatement : [select A.*, B.DICTIONARY_CODE MAKHACHHANG, C.TENLOAIGIA        from TM_NGUONKHACHHANG_LOAIGIA A        left join LST_DICTIONARY B on A.NGUONKHACHHANG_BENHNHAN_ID = B.DICTIONARY_ID        inner join TM_LOAIGIA C on C.LOAIGIA_ID = A.LOAIGIA_ID and CAPTREN_ID  = (select LOAIGIA_ID from TM_LOAIGIA where MALOAIGIA = 'GiaDichVu')        left join TM_DICHVU_DONGIA dvdg on dvdg.LOAIGIA_ID = A.LOAIGIA_ID        where B.DICTIONARY_TYPE_CODE = 'NguonKhachHang' and dvdg.DICHVU_ID  =  @param0]
2019-09-20 15:48:10,464 [1] DEBUG - Statement Id: [DAO00019_GetLoaiGiaLoaiKhachHang] Parameters: [@param0=[DICHVU_ID,4145]]
2019-09-20 15:48:10,464 [1] DEBUG - Statement Id: [DAO00019_GetLoaiGiaLoaiKhachHang] Types: [@param0=[Int64, System.Int64]]
2019-09-20 15:48:10,517 [1] DEBUG - Statement Id: [DAO00017_GetLoaiGiaDoiTuongDichVu] PreparedStatement : [select a.LOAIGIA_ID, a.TENLOAIGIA, a.MALOAIGIA, a.CAPTREN_ID, MIN(a.UUTIEN_NGUON) AS UUTIEN_NGUON          , MAX(a.DOUUTIEN) AS DOUUTIEN, MIN(ISNULL(a.GIAHOTRO,0)) AS GIAHOTRO          from(                        select distinct A.LOAIGIA_ID, C.TENLOAIGIA, C.MALOAIGIA, 0 as UUTIEN_NGUON, isnull(B.DOUUTIEN,0) as DOUUTIEN, B.GIAHOTRO, C.CAPTREN_ID            from TM_DOITUONG_GIADICHVU A            left join TM_DOITUONG_LOAIGIA B on A.LOAIGIA_ID = B.LOAIGIA_ID and A.DOITUONG_ID = B.DOITUONG_ID and B.BENHVIEN_ID = 'HLU01'            inner join TM_LOAIGIA C on A.LOAIGIA_ID = C.LOAIGIA_ID and C.BENHVIEN_ID = 'HLU01'            where A.DOITUONG_ID = '4'                            and A.DICHVU_ID = '4145'                            and C.CAPTREN_ID = (select LOAIGIA_ID from TM_LOAIGIA              where MALOAIGIA = 'GiaDichVu'              and BENHVIEN_ID = 'HLU01')                         and A.BENHVIEN_ID = 'HLU01'                     ) a          where a.DOUUTIEN != 0 and a.DOUUTIEN is not null          group by a.LOAIGIA_ID, a.TENLOAIGIA, a.MALOAIGIA, a.CAPTREN_ID          order by MAX(a.UUTIEN_NGUON) desc ,MAX(a.DOUUTIEN) asc]
2019-09-20 15:48:10,633 [1] DEBUG - Statement Id: [DAO00000_GetDICHVU_DONGIA_LOAIGIA] PreparedStatement : [select A.LOAIGIA_ID, A.BANGGIA_ID, A.GIAVON, A.TYLEVAT  as TYLE_VAT, A.TYLE_LOINHUAN,            A.DONGIA as DONGIA_DOANHTHU, NULL as DONGIA_KHAC, isnull(D.MAPHANNHOMDICHVU, 'TT') as LOAI_CHIPHI            from TM_DICHVU_DONGIA A            inner join TM_BANGGIA B on B.LOAIGIA_ID = A.LOAIGIA_ID AND B.BENHVIEN_ID = 'HLU01'            left join (select B.MAPHANNHOMDICHVU, A.* from TM_DICHVU_PHANNHOMDICHVU A            inner join TM_PHANNHOMDICHVU B on  B.PHANNHOMDICHVU_ID = A.PHANNHOMDICHVU_ID            where A.DICHVU_ID = '4145' AND A.BENHVIEN_ID = 'HLU01') D on A.DICHVU_ID = D.DICHVU_ID            where A.LOAIGIA_ID = '2' and A.DICHVU_ID = '4145'            union            select A.LOAIGIA_ID, null as BANGGIA_ID, null as GIAVON, null as TYLE_VAT, null as TYLE_LOINHUAN,            null as DONGIA_DOANHTHU, C.DONGIA as DONGIA_KHAC, isnull(D.MAPHANNHOMDICHVU, 'TT') as LOAI_CHIPHI            from TM_DOITUONG_GIADICHVU A            inner join TM_BANGGIA B on B.LOAIGIA_ID = A.LOAIGIA_ID AND B.BENHVIEN_ID = 'HLU01'            left join TM_DICHVU_DONGIA C on C.LOAIGIA_ID = A.LOAIGIA_ID AND C.BENHVIEN_ID = 'HLU01'            and C.BANGGIA_ID = B.BANGGIA_ID and C.DICHVU_ID = A.DICHVU_ID            left join (select B.MAPHANNHOMDICHVU, A.* from TM_DICHVU_PHANNHOMDICHVU A            inner join TM_PHANNHOMDICHVU B on  B.PHANNHOMDICHVU_ID = A.PHANNHOMDICHVU_ID            where A.DICHVU_ID = '4145' AND A.BENHVIEN_ID = 'HLU01') D on A.DICHVU_ID = D.DICHVU_ID            where A.DOITUONG_ID = '4'  and A.DICHVU_ID = '4145' and A.LOAIGIA_ID            in (select top 1 LOAIGIA_ID from TM_DOITUONG_LOAIGIA            where DOITUONG_ID = '4' and GIAHOTRO = '1'  AND BENHVIEN_ID = 'HLU01'            and LOAIGIA_ID            in (select LOAIGIA_ID from TM_BANGGIA            where LOAIBANGGIA in            (select LOAIBANGGIA from TM_BANGGIA where LOAIGIA_ID = '2'  AND BENHVIEN_ID = 'HLU01')            and TAMNGUNG = '0')  AND BENHVIEN_ID = 'HLU01'            )]
2019-09-20 15:48:10,772 [1] DEBUG - Statement Id: [DAO00024_TM_TIEPNHAN_BANGGIA_DICHVU_getlist] PreparedStatement : [select * from TM_TIEPNHAN_BANGGIA_DICHVU where TAMNGUNG != '1' and BENHVIEN_ID = 'HLU01']
2019-09-20 15:48:10,807 [1] DEBUG - Statement Id: [DAO00000_GetDICHVU_DONGIA_LOAIGIA] PreparedStatement : [select A.LOAIGIA_ID, A.BANGGIA_ID, A.GIAVON, A.TYLEVAT  as TYLE_VAT, A.TYLE_LOINHUAN,            A.DONGIA as DONGIA_DOANHTHU, NULL as DONGIA_KHAC, isnull(D.MAPHANNHOMDICHVU, 'TT') as LOAI_CHIPHI            from TM_DICHVU_DONGIA A            inner join TM_BANGGIA B on B.LOAIGIA_ID = A.LOAIGIA_ID AND B.BENHVIEN_ID = 'HLU01'            left join (select B.MAPHANNHOMDICHVU, A.* from TM_DICHVU_PHANNHOMDICHVU A            inner join TM_PHANNHOMDICHVU B on  B.PHANNHOMDICHVU_ID = A.PHANNHOMDICHVU_ID            where A.DICHVU_ID = '4145' AND A.BENHVIEN_ID = 'HLU01') D on A.DICHVU_ID = D.DICHVU_ID            where A.LOAIGIA_ID = '2' and A.DICHVU_ID = '4145'            union            select A.LOAIGIA_ID, null as BANGGIA_ID, null as GIAVON, null as TYLE_VAT, null as TYLE_LOINHUAN,            null as DONGIA_DOANHTHU, C.DONGIA as DONGIA_KHAC, isnull(D.MAPHANNHOMDICHVU, 'TT') as LOAI_CHIPHI            from TM_DOITUONG_GIADICHVU A            inner join TM_BANGGIA B on B.LOAIGIA_ID = A.LOAIGIA_ID AND B.BENHVIEN_ID = 'HLU01'            left join TM_DICHVU_DONGIA C on C.LOAIGIA_ID = A.LOAIGIA_ID AND C.BENHVIEN_ID = 'HLU01'            and C.BANGGIA_ID = B.BANGGIA_ID and C.DICHVU_ID = A.DICHVU_ID            left join (select B.MAPHANNHOMDICHVU, A.* from TM_DICHVU_PHANNHOMDICHVU A            inner join TM_PHANNHOMDICHVU B on  B.PHANNHOMDICHVU_ID = A.PHANNHOMDICHVU_ID            where A.DICHVU_ID = '4145' AND A.BENHVIEN_ID = 'HLU01') D on A.DICHVU_ID = D.DICHVU_ID            where A.DOITUONG_ID = '4'  and A.DICHVU_ID = '4145' and A.LOAIGIA_ID            in (select top 1 LOAIGIA_ID from TM_DOITUONG_LOAIGIA            where DOITUONG_ID = '4' and GIAHOTRO = '1'  AND BENHVIEN_ID = 'HLU01'            and LOAIGIA_ID            in (select LOAIGIA_ID from TM_BANGGIA            where LOAIBANGGIA in            (select LOAIBANGGIA from TM_BANGGIA where LOAIGIA_ID = '2'  AND BENHVIEN_ID = 'HLU01')            and TAMNGUNG = '0')  AND BENHVIEN_ID = 'HLU01'            )]
2019-09-20 15:48:10,948 [1] DEBUG - Statement Id: [DAO00024_TM_TIEPNHAN_BANGGIA_DICHVU_getlist] PreparedStatement : [select * from TM_TIEPNHAN_BANGGIA_DICHVU where TAMNGUNG != '1' and BENHVIEN_ID = 'HLU01']
2019-09-20 15:48:22,199 [1] DEBUG - Statement Id: [DAO00020_KiemtrangaychidinhdvHople] PreparedStatement : [select * from TT_TIEPNHAN where  THOIGIANTIEPNHAN >  @param0  and TIEPNHAN_ID =  @param1]
2019-09-20 15:48:22,199 [1] DEBUG - Statement Id: [DAO00020_KiemtrangaychidinhdvHople] Parameters: [@param0=[NGAYGIOYEUCAU,9/20/2019 5:47:24 PM], @param1=[TIEPNHAN_ID,27478]]
2019-09-20 15:48:22,199 [1] DEBUG - Statement Id: [DAO00020_KiemtrangaychidinhdvHople] Types: [@param0=[DateTime, System.DateTime], @param1=[Int64, System.Int64]]
2019-09-20 15:48:22,234 [1] DEBUG - Statement Id: [DAO00020_GetDSDichVuYC_TN] PreparedStatement : [select top 1 dvyc.TIEPNHAN_ID, dvyc.BENHNHAN_ID, ntba.BENHAN_ID, dvyc.DICHVU_ID, dvyc.HUYYEUCAU,        case when ntba.SOBENHAN is null then N'ngoại trú'        when ntba.SOBENHAN like '%CC' then N'cấp cứu'        when ntba.SOBENHAN is not null then N'nội trú'        else N'' end as SUDUNGTAI        from TT_DVYEUCAU dvyc        left join TT_NOITRU_BENHAN ntba on dvyc.BENHAN_ID = ntba.BENHAN_ID        where        dvyc.TIEPNHAN_ID = 27478        and dvyc.HUYYEUCAU = 0        and dvyc.DICHVU_ID = 4145        order by dvyc.NGAYGIOYEUCAU desc]
2019-09-20 15:48:22,304 [1] DEBUG - Statement Id: [DAO00023_GetVienPhiDichVuBSKhac] PreparedStatement : [select *        from TT_VIENPHI        where                    TIEPNHAN_ID = '27478'                 and NGUOITAO_ID != '1'        and DICHVU_ID is not null]
2019-09-20 15:48:22,408 [1] DEBUG - Statement Id: [DAO00064_GetTopTT_TIEPNHAN_SOTHEBHYT] PreparedStatement : [select top 1 stbhyt.*, ba.SOBENHAN,         tn.SOTIEPNHAN, tn.LOAITHANHVIEN_ID, tn.THE_ID, tn.THANHVIEN_ID,        tn.SUDUNG_BHTN, tn.BAOLANH_VIENPHI, tn.VIP, tn.NGUOINUOCNGOAI        from TT_TIEPNHAN_SOTHEBHYT stbhyt        left join TT_TIEPNHAN tn on tn.TIEPNHAN_ID = stbhyt.TIEPNHAN_ID        left join TT_NOITRU_BENHAN ba on ba.TIEPNHAN_ID = stbhyt.TIEPNHAN_ID        where         stbhyt.TIEPNHAN_ID = '27478' and isnull(stbhyt.KHONGSUDUNG, '0') = '0'              order by SOBHYT_HUONG_ID desc]
2019-09-20 15:48:22,438 [1] DEBUG - Statement Id: [DAO00006_GetListDuocTyle] PreparedStatement : [select DUOC_ID, DOITUONG_ID, (TYLE/100) as TYLE, DONGIA MUCTRAN_THANHTOAN from TM_DOITUONG_GIADUOC_TYLE            where            BENHVIEN_ID = 'HLU01'            and DOITUONG_ID = '4']
2019-09-20 15:48:22,468 [1] DEBUG - Statement Id: [DAO00027_GetListTuongTrinhDichVuPhauThuatCuaTiepNhan] PreparedStatement : [declare @ManhomDSA varchar(10);        declare @PhanLoaiNhomDV varchar(20) = '05';        select top 1  @ManhomDSA = VALUE from TM_SYS_APPSETTINGS where CODE = 'MANHOM_DICHVU_DSA'        if (@ManhomDSA is not null) set @PhanLoaiNhomDV += ',' + @ManhomDSA        select distinct ptyc.*        from TT_PHAUTHUAT_YEUCAU ptyc        inner join TM_DICHVU dv on dv.DICHVU_ID = ptyc.DICHVU_ID        inner join TM_NHOMDICHVU ndv on ndv.NHOMDICHVU_ID = dv.NHOMDICHVU_ID        inner join TT_PHAUTHUAT pt on pt.PHAUTHUAT_ID = ptyc.PHAUTHUAT_ID        where        pt.TIEPNHAN_ID = 27478        and (left(ndv.MANHOMDICHVU, 2) in (select * from STRING_SPLIT(@PhanLoaiNhomDV,',')) or ndv.MANHOMDICHVU in (select * from STRING_SPLIT(@PhanLoaiNhomDV,',')))]
2019-09-20 15:48:22,506 [1] DEBUG - Statement Id: [DAO00006_GetList] PreparedStatement : [select dv.*, loaiDV.MALOAIDICHVU, captren.NHOMDICHVU_ID as NHOMDICHVU_CAPTREN_ID, captren.TENNHOMDICHVU as NHOMDICHVU_CAPTREN,              nhom_dv.TENNHOMDICHVU as TENNHOMDICHVU, nhom_dv.MANHOMDICHVU,              case when dv.ATTRIBUTE5 is null then 'TT' else 'KTC' end as LOAI_CHIPHI              from TM_DICHVU as dv              left join TM_NHOMDICHVU as nhom_dv on nhom_dv.NHOMDICHVU_ID = dv.NHOMDICHVU_ID and nhom_dv.BENHVIEN_ID = 'HLU01'              left join TM_NHOMDICHVU as captren on nhom_dv.CAPTREN_ID = captren.NHOMDICHVU_ID and captren.BENHVIEN_ID = 'HLU01'              left join TM_LOAIDICHVU loaiDV on nhom_dv.LOAIDICHVU_ID = loaiDV.LOAIDICHVU_ID and loaiDV.BENHVIEN_ID = 'HLU01'              where nhom_dv.TAMNGUNG = '0' and dv.BENHVIEN_ID = 'HLU01'              and dv.TAMNGUNG = '0'               AND                   loaiDV.MALOAIDICHVU = 'KhamBenh']
2019-09-20 15:48:47,179 [1] DEBUG - Statement Id: [DAO00019_GetLoaiGiaLoaiKhachHang] PreparedStatement : [select A.*, B.DICTIONARY_CODE MAKHACHHANG, C.TENLOAIGIA        from TM_NGUONKHACHHANG_LOAIGIA A        left join LST_DICTIONARY B on A.NGUONKHACHHANG_BENHNHAN_ID = B.DICTIONARY_ID        inner join TM_LOAIGIA C on C.LOAIGIA_ID = A.LOAIGIA_ID and CAPTREN_ID  = (select LOAIGIA_ID from TM_LOAIGIA where MALOAIGIA = 'GiaDichVu')        left join TM_DICHVU_DONGIA dvdg on dvdg.LOAIGIA_ID = A.LOAIGIA_ID        where B.DICTIONARY_TYPE_CODE = 'NguonKhachHang' and dvdg.DICHVU_ID  =  @param0]
2019-09-20 15:48:47,180 [1] DEBUG - Statement Id: [DAO00019_GetLoaiGiaLoaiKhachHang] Parameters: [@param0=[DICHVU_ID,1111]]
2019-09-20 15:48:47,180 [1] DEBUG - Statement Id: [DAO00019_GetLoaiGiaLoaiKhachHang] Types: [@param0=[Int64, System.Int64]]
2019-09-20 15:48:47,228 [1] DEBUG - Statement Id: [DAO00017_GetLoaiGiaDoiTuongDichVu] PreparedStatement : [select a.LOAIGIA_ID, a.TENLOAIGIA, a.MALOAIGIA, a.CAPTREN_ID, MIN(a.UUTIEN_NGUON) AS UUTIEN_NGUON          , MAX(a.DOUUTIEN) AS DOUUTIEN, MIN(ISNULL(a.GIAHOTRO,0)) AS GIAHOTRO          from(                        select distinct A.LOAIGIA_ID, C.TENLOAIGIA, C.MALOAIGIA, 0 as UUTIEN_NGUON, isnull(B.DOUUTIEN,0) as DOUUTIEN, B.GIAHOTRO, C.CAPTREN_ID            from TM_DOITUONG_GIADICHVU A            left join TM_DOITUONG_LOAIGIA B on A.LOAIGIA_ID = B.LOAIGIA_ID and A.DOITUONG_ID = B.DOITUONG_ID and B.BENHVIEN_ID = 'HLU01'            inner join TM_LOAIGIA C on A.LOAIGIA_ID = C.LOAIGIA_ID and C.BENHVIEN_ID = 'HLU01'            where A.DOITUONG_ID = '4'                            and A.DICHVU_ID = '1111'                            and C.CAPTREN_ID = (select LOAIGIA_ID from TM_LOAIGIA              where MALOAIGIA = 'GiaDichVu'              and BENHVIEN_ID = 'HLU01')                         and A.BENHVIEN_ID = 'HLU01'                     ) a          where a.DOUUTIEN != 0 and a.DOUUTIEN is not null          group by a.LOAIGIA_ID, a.TENLOAIGIA, a.MALOAIGIA, a.CAPTREN_ID          order by MAX(a.UUTIEN_NGUON) desc ,MAX(a.DOUUTIEN) asc]
2019-09-20 15:48:47,381 [1] DEBUG - Statement Id: [DAO00000_GetDICHVU_DONGIA_LOAIGIA] PreparedStatement : [select A.LOAIGIA_ID, A.BANGGIA_ID, A.GIAVON, A.TYLEVAT  as TYLE_VAT, A.TYLE_LOINHUAN,            A.DONGIA as DONGIA_DOANHTHU, NULL as DONGIA_KHAC, isnull(D.MAPHANNHOMDICHVU, 'TT') as LOAI_CHIPHI            from TM_DICHVU_DONGIA A            inner join TM_BANGGIA B on B.LOAIGIA_ID = A.LOAIGIA_ID AND B.BENHVIEN_ID = 'HLU01'            left join (select B.MAPHANNHOMDICHVU, A.* from TM_DICHVU_PHANNHOMDICHVU A            inner join TM_PHANNHOMDICHVU B on  B.PHANNHOMDICHVU_ID = A.PHANNHOMDICHVU_ID            where A.DICHVU_ID = '1111' AND A.BENHVIEN_ID = 'HLU01') D on A.DICHVU_ID = D.DICHVU_ID            where A.LOAIGIA_ID = '2' and A.DICHVU_ID = '1111'            union            select A.LOAIGIA_ID, null as BANGGIA_ID, null as GIAVON, null as TYLE_VAT, null as TYLE_LOINHUAN,            null as DONGIA_DOANHTHU, C.DONGIA as DONGIA_KHAC, isnull(D.MAPHANNHOMDICHVU, 'TT') as LOAI_CHIPHI            from TM_DOITUONG_GIADICHVU A            inner join TM_BANGGIA B on B.LOAIGIA_ID = A.LOAIGIA_ID AND B.BENHVIEN_ID = 'HLU01'            left join TM_DICHVU_DONGIA C on C.LOAIGIA_ID = A.LOAIGIA_ID AND C.BENHVIEN_ID = 'HLU01'            and C.BANGGIA_ID = B.BANGGIA_ID and C.DICHVU_ID = A.DICHVU_ID            left join (select B.MAPHANNHOMDICHVU, A.* from TM_DICHVU_PHANNHOMDICHVU A            inner join TM_PHANNHOMDICHVU B on  B.PHANNHOMDICHVU_ID = A.PHANNHOMDICHVU_ID            where A.DICHVU_ID = '1111' AND A.BENHVIEN_ID = 'HLU01') D on A.DICHVU_ID = D.DICHVU_ID            where A.DOITUONG_ID = '4'  and A.DICHVU_ID = '1111' and A.LOAIGIA_ID            in (select top 1 LOAIGIA_ID from TM_DOITUONG_LOAIGIA            where DOITUONG_ID = '4' and GIAHOTRO = '1'  AND BENHVIEN_ID = 'HLU01'            and LOAIGIA_ID            in (select LOAIGIA_ID from TM_BANGGIA            where LOAIBANGGIA in            (select LOAIBANGGIA from TM_BANGGIA where LOAIGIA_ID = '2'  AND BENHVIEN_ID = 'HLU01')            and TAMNGUNG = '0')  AND BENHVIEN_ID = 'HLU01'            )]
2019-09-20 15:48:47,571 [1] DEBUG - Statement Id: [DAO00024_TM_TIEPNHAN_BANGGIA_DICHVU_getlist] PreparedStatement : [select * from TM_TIEPNHAN_BANGGIA_DICHVU where TAMNGUNG != '1' and BENHVIEN_ID = 'HLU01']
2019-09-20 15:48:47,604 [1] DEBUG - Statement Id: [DAO00000_GetDICHVU_DONGIA_LOAIGIA] PreparedStatement : [select A.LOAIGIA_ID, A.BANGGIA_ID, A.GIAVON, A.TYLEVAT  as TYLE_VAT, A.TYLE_LOINHUAN,            A.DONGIA as DONGIA_DOANHTHU, NULL as DONGIA_KHAC, isnull(D.MAPHANNHOMDICHVU, 'TT') as LOAI_CHIPHI            from TM_DICHVU_DONGIA A            inner join TM_BANGGIA B on B.LOAIGIA_ID = A.LOAIGIA_ID AND B.BENHVIEN_ID = 'HLU01'            left join (select B.MAPHANNHOMDICHVU, A.* from TM_DICHVU_PHANNHOMDICHVU A            inner join TM_PHANNHOMDICHVU B on  B.PHANNHOMDICHVU_ID = A.PHANNHOMDICHVU_ID            where A.DICHVU_ID = '1111' AND A.BENHVIEN_ID = 'HLU01') D on A.DICHVU_ID = D.DICHVU_ID            where A.LOAIGIA_ID = '2' and A.DICHVU_ID = '1111'            union            select A.LOAIGIA_ID, null as BANGGIA_ID, null as GIAVON, null as TYLE_VAT, null as TYLE_LOINHUAN,            null as DONGIA_DOANHTHU, C.DONGIA as DONGIA_KHAC, isnull(D.MAPHANNHOMDICHVU, 'TT') as LOAI_CHIPHI            from TM_DOITUONG_GIADICHVU A            inner join TM_BANGGIA B on B.LOAIGIA_ID = A.LOAIGIA_ID AND B.BENHVIEN_ID = 'HLU01'            left join TM_DICHVU_DONGIA C on C.LOAIGIA_ID = A.LOAIGIA_ID AND C.BENHVIEN_ID = 'HLU01'            and C.BANGGIA_ID = B.BANGGIA_ID and C.DICHVU_ID = A.DICHVU_ID            left join (select B.MAPHANNHOMDICHVU, A.* from TM_DICHVU_PHANNHOMDICHVU A            inner join TM_PHANNHOMDICHVU B on  B.PHANNHOMDICHVU_ID = A.PHANNHOMDICHVU_ID            where A.DICHVU_ID = '1111' AND A.BENHVIEN_ID = 'HLU01') D on A.DICHVU_ID = D.DICHVU_ID            where A.DOITUONG_ID = '4'  and A.DICHVU_ID = '1111' and A.LOAIGIA_ID            in (select top 1 LOAIGIA_ID from TM_DOITUONG_LOAIGIA            where DOITUONG_ID = '4' and GIAHOTRO = '1'  AND BENHVIEN_ID = 'HLU01'            and LOAIGIA_ID            in (select LOAIGIA_ID from TM_BANGGIA            where LOAIBANGGIA in            (select LOAIBANGGIA from TM_BANGGIA where LOAIGIA_ID = '2'  AND BENHVIEN_ID = 'HLU01')            and TAMNGUNG = '0')  AND BENHVIEN_ID = 'HLU01'            )]
2019-09-20 15:48:47,736 [1] DEBUG - Statement Id: [DAO00024_TM_TIEPNHAN_BANGGIA_DICHVU_getlist] PreparedStatement : [select * from TM_TIEPNHAN_BANGGIA_DICHVU where TAMNGUNG != '1' and BENHVIEN_ID = 'HLU01']
2019-09-20 15:48:51,095 [1] DEBUG - Statement Id: [DAO00020_KiemtrangaychidinhdvHople] PreparedStatement : [select * from TT_TIEPNHAN where  THOIGIANTIEPNHAN >  @param0  and TIEPNHAN_ID =  @param1]
2019-09-20 15:48:51,095 [1] DEBUG - Statement Id: [DAO00020_KiemtrangaychidinhdvHople] Parameters: [@param0=[NGAYGIOYEUCAU,9/20/2019 3:48:22 PM], @param1=[TIEPNHAN_ID,27478]]
2019-09-20 15:48:51,095 [1] DEBUG - Statement Id: [DAO00020_KiemtrangaychidinhdvHople] Types: [@param0=[DateTime, System.DateTime], @param1=[Int64, System.Int64]]
2019-09-20 15:48:51,302 [1] DEBUG - Statement Id: [DAO00020_GetDSDichVuYC_TN] PreparedStatement : [select top 1 dvyc.TIEPNHAN_ID, dvyc.BENHNHAN_ID, ntba.BENHAN_ID, dvyc.DICHVU_ID, dvyc.HUYYEUCAU,        case when ntba.SOBENHAN is null then N'ngoại trú'        when ntba.SOBENHAN like '%CC' then N'cấp cứu'        when ntba.SOBENHAN is not null then N'nội trú'        else N'' end as SUDUNGTAI        from TT_DVYEUCAU dvyc        left join TT_NOITRU_BENHAN ntba on dvyc.BENHAN_ID = ntba.BENHAN_ID        where        dvyc.TIEPNHAN_ID = 27478        and dvyc.HUYYEUCAU = 0        and dvyc.DICHVU_ID = 1111        order by dvyc.NGAYGIOYEUCAU desc]
2019-09-20 15:48:51,477 [1] DEBUG - Statement Id: [DAO00023_GetVienPhiDichVuBSKhac] PreparedStatement : [select *        from TT_VIENPHI        where                    TIEPNHAN_ID = '27478'                 and NGUOITAO_ID != '1'        and DICHVU_ID is not null]
2019-09-20 15:48:51,567 [1] DEBUG - Statement Id: [DAO00064_GetTopTT_TIEPNHAN_SOTHEBHYT] PreparedStatement : [select top 1 stbhyt.*, ba.SOBENHAN,         tn.SOTIEPNHAN, tn.LOAITHANHVIEN_ID, tn.THE_ID, tn.THANHVIEN_ID,        tn.SUDUNG_BHTN, tn.BAOLANH_VIENPHI, tn.VIP, tn.NGUOINUOCNGOAI        from TT_TIEPNHAN_SOTHEBHYT stbhyt        left join TT_TIEPNHAN tn on tn.TIEPNHAN_ID = stbhyt.TIEPNHAN_ID        left join TT_NOITRU_BENHAN ba on ba.TIEPNHAN_ID = stbhyt.TIEPNHAN_ID        where         stbhyt.TIEPNHAN_ID = '27478' and isnull(stbhyt.KHONGSUDUNG, '0') = '0'              order by SOBHYT_HUONG_ID desc]
2019-09-20 15:48:51,709 [1] DEBUG - Statement Id: [DAO00006_GetListDuocTyle] PreparedStatement : [select DUOC_ID, DOITUONG_ID, (TYLE/100) as TYLE, DONGIA MUCTRAN_THANHTOAN from TM_DOITUONG_GIADUOC_TYLE            where            BENHVIEN_ID = 'HLU01'            and DOITUONG_ID = '4']
2019-09-20 15:48:51,787 [1] DEBUG - Statement Id: [DAO00027_GetListTuongTrinhDichVuPhauThuatCuaTiepNhan] PreparedStatement : [declare @ManhomDSA varchar(10);        declare @PhanLoaiNhomDV varchar(20) = '05';        select top 1  @ManhomDSA = VALUE from TM_SYS_APPSETTINGS where CODE = 'MANHOM_DICHVU_DSA'        if (@ManhomDSA is not null) set @PhanLoaiNhomDV += ',' + @ManhomDSA        select distinct ptyc.*        from TT_PHAUTHUAT_YEUCAU ptyc        inner join TM_DICHVU dv on dv.DICHVU_ID = ptyc.DICHVU_ID        inner join TM_NHOMDICHVU ndv on ndv.NHOMDICHVU_ID = dv.NHOMDICHVU_ID        inner join TT_PHAUTHUAT pt on pt.PHAUTHUAT_ID = ptyc.PHAUTHUAT_ID        where        pt.TIEPNHAN_ID = 27478        and (left(ndv.MANHOMDICHVU, 2) in (select * from STRING_SPLIT(@PhanLoaiNhomDV,',')) or ndv.MANHOMDICHVU in (select * from STRING_SPLIT(@PhanLoaiNhomDV,',')))]
2019-09-20 15:48:52,005 [1] DEBUG - Statement Id: [DAO00006_GetList] PreparedStatement : [select dv.*, loaiDV.MALOAIDICHVU, captren.NHOMDICHVU_ID as NHOMDICHVU_CAPTREN_ID, captren.TENNHOMDICHVU as NHOMDICHVU_CAPTREN,              nhom_dv.TENNHOMDICHVU as TENNHOMDICHVU, nhom_dv.MANHOMDICHVU,              case when dv.ATTRIBUTE5 is null then 'TT' else 'KTC' end as LOAI_CHIPHI              from TM_DICHVU as dv              left join TM_NHOMDICHVU as nhom_dv on nhom_dv.NHOMDICHVU_ID = dv.NHOMDICHVU_ID and nhom_dv.BENHVIEN_ID = 'HLU01'              left join TM_NHOMDICHVU as captren on nhom_dv.CAPTREN_ID = captren.NHOMDICHVU_ID and captren.BENHVIEN_ID = 'HLU01'              left join TM_LOAIDICHVU loaiDV on nhom_dv.LOAIDICHVU_ID = loaiDV.LOAIDICHVU_ID and loaiDV.BENHVIEN_ID = 'HLU01'              where nhom_dv.TAMNGUNG = '0' and dv.BENHVIEN_ID = 'HLU01'              and dv.TAMNGUNG = '0'               AND                   loaiDV.MALOAIDICHVU = 'KhamBenh']
2019-09-20 15:49:01,631 [1] DEBUG - Statement Id: [DAO00014_GetPatientStatus] PreparedStatement : [select        CASE        when tn.TRANGTHAI = 'HOANTHANH' Then tn.TRANGTHAI        WHEN xncp.XACNHANCHIPHI_ID is not null THEN 'XACNHANCHIPHI'        WHEN (tn.KHOADULIEU = '1') THEN 'KHOADULIEU'        ELSE tn.TRANGTHAI        END        as TRANGTHAI        from TT_TIEPNHAN tn        left join TT_XACNHANCHIPHI xncp on tn.TIEPNHAN_ID = xncp.TIEPNHAN_ID        where tn.TIEPNHAN_ID = '27478'        and tn.BENHVIEN_ID = 'HLU01']
2019-09-20 15:49:01,743 [1] DEBUG - Statement Id: [DAO00020_GetListTrangthaiDvKhamBenh] PreparedStatement : [select dvyc.KHAMBENH_NGOAITRU_ID, dvyc.TRANGTHAI, dvyc.DVYEUCAU_ID, dvyc.DICHVU_ID, dvyc.NOITHUCHIEN_ID, dvyc.DALAYMAU, dv.TENDICHVU        from TT_DVYEUCAU dvyc        left join TM_DICHVU dv on dv.DICHVU_ID = dvyc.DICHVU_ID        left join TM_NHOMDICHVU ndv on ndv.NHOMDICHVU_ID = dv.NHOMDICHVU_ID        where left(ndv.MANHOMDICHVU, 2) = '04'        and TIEPNHAN_ID = 27478]
2019-09-20 15:49:01,798 [1] DEBUG - Statement Id: [DAO00020_GetListTrangThaiDV] PreparedStatement : [select vp.*,                 mgct.MIENGIAMCHITIET_ID        from TT_VIENPHI vp        left join (select VIENPHI_ID, MIENGIAMCHITIET_ID from TT_MIENGIAM_CHITIET where REF_TABLE = 'TT_MIENGIAM'        or REF_TABLE = 'TT_MIENGIAM_CONGTY'        or REF_TABLE = 'TT_MIENGIAM_BHTN') mgct        on vp.VIENPHI_ID = mgct.VIENPHI_ID        where REF_TABLE = 'TT_DVYEUCAU'        and vp.TIEPNHAN_ID = 27478                 order by vp.VIENPHI_ID]
2019-09-20 15:49:01,921 [1] DEBUG - Statement Id: [DAOLOG01_LockBegin] PreparedStatement : [INSERT into TT_LOG_UPDATE ( REF_TABLE , REF_ID , BENHVIEN_ID )         values ( @param0 ,  @param1 ,  @param2 );]
2019-09-20 15:49:01,921 [1] DEBUG - Statement Id: [DAOLOG01_LockBegin] Parameters: [@param0=[REF_TABLE,TT_VIENPHI], @param1=[REF_ID,27478], @param2=[BENHVIEN_ID,HLU01]]
2019-09-20 15:49:01,921 [1] DEBUG - Statement Id: [DAOLOG01_LockBegin] Types: [@param0=[String, System.String], @param1=[Int64, System.Int64], @param2=[String, System.String]]
2019-09-20 15:49:01,975 [1] DEBUG - Statement Id: [DAO00023_GetSOBHYT_HUONG_ID] PreparedStatement : [select isnull(MAX(SOBHYT_HUONG_ID),0) SOBHYT_HUONG_ID        from TT_TIEPNHAN_SOTHEBHYT        where TIEPNHAN_ID = '27478']
2019-09-20 15:49:02,059 [1] DEBUG - Statement Id: [DAO00020_GetListAllDvYeucau] PreparedStatement : [select A.*, B.KHONGTHUTIEN, B.SOLUONG, B.YEUCAUVP, B.DICHVU_TL        from TT_DVYEUCAU A        left join        (select * from TT_VIENPHI where TIEPNHAN_ID =  @param0  and BENHVIEN_ID = 'HLU01') B on B.REF_ID = A.DVYEUCAU_ID and B.REF_TABLE = 'TT_DVYEUCAU'        where A.TIEPNHAN_ID =  @param0  and A.BENHVIEN_ID = 'HLU01']
2019-09-20 15:49:02,059 [1] DEBUG - Statement Id: [DAO00020_GetListAllDvYeucau] Parameters: [@param0=[TIEPNHAN_ID,27478]]
2019-09-20 15:49:02,059 [1] DEBUG - Statement Id: [DAO00020_GetListAllDvYeucau] Types: [@param0=[Int64, System.Int64]]
2019-09-20 15:49:02,113 [1] DEBUG - Statement Id: [DAO00020_Add] PreparedStatement : [declare        @keyValue int, @BenhVienId varchar(10), @yearNow int, @SoPhieuYeu varchar(20), @SoRender varchar(20), @MaNhomDichVu varchar(20)        set @keyValue = 0;        set @BenhVienId = 'HLU01'        set @yearNow = YEAR(getdate())        set @MaNhomDichVu = '18'                 select @keyValue = KEYVALUE from LST_KEYDATA        where KEYTYPE = 'SOPHIEUYEUCAU' and KEYYEAR = @yearNow and SEGMENT_1 = @MaNhomDichVu and BENHVIEN_ID = @BenhVienId        if @keyValue = 0        Insert into LST_KEYDATA values ('SOPHIEUYEUCAU', @yearNow, '0', '0', @MaNhomDichVu, '0', '0', 0, @BenhVienId);          Update LST_KEYDATA set KEYVALUE = KEYVALUE + 1, @keyValue = (KEYVALUE + 1) where KEYTYPE = 'SOPHIEUYEUCAU' and KEYYEAR = @yearNow and SEGMENT_1 = @MaNhomDichVu and BENHVIEN_ID = @BenhVienId        set @SoRender = right('000000'+convert(varchar(6), @keyValue), 6)        set @SoPhieuYeu = RIGHT(@yearNow, 2) + '.' + @MaNhomDichVu + '.' + @SoRender                 insert into TT_DVYEUCAU (        TIEPNHAN_ID        , BENHAN_ID        , KHAMBENH_ID        , SODICHVUYEUCAU        , KHAMBENH_NGOAITRU_ID        , SOPHIEUYEUCAU        , BENHNHAN_ID        , DOITUONG_ID        , DICHVU_ID         ,           NGUOICHIDINH_ID                 , BACSICHIDINH_ID        , GIOYEUCAU        , NGAYYEUCAU        , THANGYEUCAU        , NAMYEUCAU        , NGAYGIOYEUCAU        , THUTUYEUCAU        , NOIYEUCAU_ID        , NOITHUCHIEN_ID        , TRANGTHAI_HANGDOI        , NOIDUNGCHITIET        , CHANDOAN        , LUUTRU_ID        , SODICHVUDONGTIEN        , DICHVU_KHAMBENH_ID        , DALAYMAU        , SINHTHIET        , CLOTEST        , TIEMCANQUANG        , TRIEUCHUNG        , DAITHE        , VITHE        , BENHPHAM        , DANHANBENHPHAM        , NGAYNHANBENHPHAM        , THOIGIANNHANBENHPHAM        , NGUOINHANBENHPHAM_ID        , MANGUOINHAPBENHPHAM        , TENNGUOINHAPBENHPHAM        , KETQUAXNKHAC        , YEUCAUBENNGOAI        , THUCHIENBENNGOAI        , DONVIBENNGOAI_ID        , BACSIBENNGOAI_ID        , TENBACSIBENNGOAI        , KHOABENNGOAI_ID        , KHOABENNGOAI         ,           NGUOIGIOITHIEU_ID         ,           DONVIGIOITHIEU_ID         ,           NGUONDICHVU_ID                 , NOITHUCHIENTHAYDOI_ID        , LOAIKHACHHANG_ID        , THE_ID        , BARCODEID        , HOPDONG_ID        , HOPDONG_BENHNHAN_ID        , HINHTHUCTHANHTOAN_ID        , DANGKY_ID        , DANGKY_CHITIET_ID        , LICHHEN_ID        , THOIGIANLICHHEN        , BNKHONGDENBV        , GHICHU        , THANHTOANTRUOC        , KHAN        , DUOCPHEPTHUCHIEN        , HUYYEUCAU        , LYDOHUY        , TRANGTHAI        , KHOADULIEU        , NGAYKHOADULIEU        , THOIGIANKHOADULIEU        , NGUOIKHOA_ID        , MANGUOIKHOA        , TENNGUOIKHOA        , BENHVIEN_ID        , NGAYTAO        , NGUOITAO_ID        , NGAYHENCLS        , CREATININEMAU        , VUNGCANKHAOSAT        , BHYTDONGTIEN        , THUTIENSAU         ,           DV30                 , DVKEMTHEO        , DVKEMTHEO_KHACEKIP        , LIENCHUYENKHOA         ,           BHYT_TYLETHANHTOAN_ID         ,           CHUADUYET_BHYT         ,           SOPHIEUGOINGOAI                 )        OUTPUT INSERTED.DVYEUCAU_ID, INSERTED.SOPHIEUYEUCAU        values (         @param0         ,  @param1         ,  @param2         ,  @param3         ,  @param4         , @SoPhieuYeu        ,  @param5         ,  @param6         ,  @param7          ,            @param8                  ,  @param9         ,  @param10         ,  @param11         ,  @param12         ,  @param13         ,  @param14         ,  @param15         ,  @param16         ,  @param17         ,  @param18         ,  @param19         ,  @param20         ,  @param21         ,  @param22         ,  @param23         ,  @param24         ,  @param25         ,  @param26         ,  @param27         ,  @param28         ,  @param29         ,  @param30         ,  @param31         ,  @param32         ,  @param33         ,  @param34         ,  @param35         ,  @param36         ,  @param37         ,  @param38         ,  @param39         ,  @param40         ,  @param41         ,  @param42         ,  @param43         ,  @param44         ,  @param45          ,            @param46          ,            @param47          ,            @param48                  ,  @param49         ,  @param50         ,  @param51         ,  @param52         ,  @param53         ,  @param54         ,  @param55         ,  @param56         ,  @param57         ,  @param58         ,  @param59         ,  @param60         ,  @param61         ,  @param62         ,  @param63         ,  @param64         ,  @param65         ,  @param66         ,  @param67         ,  @param68         ,  @param69         ,  @param70         ,  @param71         ,  @param72         ,  @param73         ,  @param74         ,  @param75         ,  @param76         ,  @param77         ,  @param78         ,  @param79         ,  @param80         ,  @param81          ,            @param82                  ,  @param83         ,  @param84         ,  @param85          ,            @param86          ,            @param87          ,            @param88                  );]
2019-09-20 15:49:02,113 [1] DEBUG - Statement Id: [DAO00020_Add] Parameters: [@param0=[TIEPNHAN_ID,27478], @param1=[BENHAN_ID,null], @param2=[KHAMBENH_ID,26172], @param3=[SODICHVUYEUCAU,1], @param4=[KHAMBENH_NGOAITRU_ID,null], @param5=[BENHNHAN_ID,23423], @param6=[DOITUONG_ID,4], @param7=[DICHVU_ID,4145], @param8=[NGUOICHIDINH_ID,1], @param9=[BACSICHIDINH_ID,1], @param10=[GIOYEUCAU,17], @param11=[NGAYYEUCAU,9/20/2019 12:00:00 AM], @param12=[THANGYEUCAU,9], @param13=[NAMYEUCAU,2019], @param14=[NGAYGIOYEUCAU,9/20/2019 5:47:24 PM], @param15=[THUTUYEUCAU,2], @param16=[NOIYEUCAU_ID,58], @param17=[NOITHUCHIEN_ID,79], @param18=[TRANGTHAI_HANGDOI,null], @param19=[NOIDUNGCHITIET,null], @param20=[CHANDOAN,Viêm phế quản cấp(J20)], @param21=[LUUTRU_ID,null], @param22=[SODICHVUDONGTIEN,0], @param23=[DICHVU_KHAMBENH_ID,null], @param24=[DALAYMAU,null], @param25=[SINHTHIET,0], @param26=[CLOTEST,0], @param27=[TIEMCANQUANG,0], @param28=[TRIEUCHUNG,null], @param29=[DAITHE,null], @param30=[VITHE,null], @param31=[BENHPHAM,null], @param32=[DANHANBENHPHAM,0], @param33=[NGAYNHANBENHPHAM,null], @param34=[THOIGIANNHANBENHPHAM,null], @param35=[NGUOINHANBENHPHAM_ID,null], @param36=[MANGUOINHAPBENHPHAM,null], @param37=[TENNGUOINHAPBENHPHAM,null], @param38=[KETQUAXNKHAC,null], @param39=[YEUCAUBENNGOAI,0], @param40=[THUCHIENBENNGOAI,0], @param41=[DONVIBENNGOAI_ID,null], @param42=[BACSIBENNGOAI_ID,null], @param43=[TENBACSIBENNGOAI,null], @param44=[KHOABENNGOAI_ID,null], @param45=[KHOABENNGOAI,null], @param46=[NGUOIGIOITHIEU_ID,null], @param47=[DONVIGIOITHIEU_ID,null], @param48=[NGUONDICHVU_ID,null], @param49=[NOITHUCHIENTHAYDOI_ID,null], @param50=[LOAIKHACHHANG_ID,null], @param51=[THE_ID,null], @param52=[BARCODEID,null], @param53=[HOPDONG_ID,null], @param54=[HOPDONG_BENHNHAN_ID,null], @param55=[HINHTHUCTHANHTOAN_ID,null], @param56=[DANGKY_ID,null], @param57=[DANGKY_CHITIET_ID,null], @param58=[LICHHEN_ID,null], @param59=[THOIGIANLICHHEN,null], @param60=[BNKHONGDENBV,null], @param61=[GHICHU,null], @param62=[THANHTOANTRUOC,1], @param63=[KHAN,0], @param64=[DUOCPHEPTHUCHIEN,0], @param65=[HUYYEUCAU,0], @param66=[LYDOHUY,null], @param67=[TRANGTHAI,CHUAKETQUA], @param68=[KHOADULIEU,null], @param69=[NGAYKHOADULIEU,null], @param70=[THOIGIANKHOADULIEU,null], @param71=[NGUOIKHOA_ID,null], @param72=[MANGUOIKHOA,null], @param73=[TENNGUOIKHOA,null], @param74=[BENHVIEN_ID,HLU01], @param75=[NGAYTAO,9/20/2019 3:49:02 PM], @param76=[NGUOITAO_ID,1], @param77=[NGAYHENCLS,null], @param78=[CREATININEMAU,null], @param79=[VUNGCANKHAOSAT,null], @param80=[BHYTDONGTIEN,0], @param81=[THUTIENSAU,0], @param82=[DV30,False], @param83=[DVKEMTHEO,0], @param84=[DVKEMTHEO_KHACEKIP,0], @param85=[LIENCHUYENKHOA,0], @param86=[BHYT_TYLETHANHTOAN_ID,null], @param87=[CHUADUYET_BHYT,False], @param88=[SOPHIEUGOINGOAI,null]]
2019-09-20 15:49:02,113 [1] DEBUG - Statement Id: [DAO00020_Add] Types: [@param0=[Int64, System.Int64], @param1=[System.DBNull, null], @param2=[Int64, System.Int64], @param3=[Double, System.Double], @param4=[System.DBNull, null], @param5=[Int64, System.Int64], @param6=[Int64, System.Int64], @param7=[Int64, System.Int64], @param8=[Int64, System.Int64], @param9=[Int64, System.Int64], @param10=[Int64, System.Int64], @param11=[DateTime, System.DateTime], @param12=[Int64, System.Int64], @param13=[Int64, System.Int64], @param14=[DateTime, System.DateTime], @param15=[String, System.String], @param16=[Int64, System.Int64], @param17=[Int64, System.Int64], @param18=[System.DBNull, null], @param19=[System.DBNull, null], @param20=[String, System.String], @param21=[System.DBNull, null], @param22=[Int32, System.Int32], @param23=[System.DBNull, null], @param24=[System.DBNull, null], @param25=[Int64, System.Int64], @param26=[Int64, System.Int64], @param27=[Int64, System.Int64], @param28=[System.DBNull, null], @param29=[System.DBNull, null], @param30=[System.DBNull, null], @param31=[System.DBNull, null], @param32=[Int64, System.Int64], @param33=[System.DBNull, null], @param34=[System.DBNull, null], @param35=[System.DBNull, null], @param36=[System.DBNull, null], @param37=[System.DBNull, null], @param38=[System.DBNull, null], @param39=[String, System.String], @param40=[Int64, System.Int64], @param41=[System.DBNull, null], @param42=[System.DBNull, null], @param43=[System.DBNull, null], @param44=[System.DBNull, null], @param45=[System.DBNull, null], @param46=[System.DBNull, null], @param47=[System.DBNull, null], @param48=[System.DBNull, null], @param49=[System.DBNull, null], @param50=[System.DBNull, null], @param51=[System.DBNull, null], @param52=[System.DBNull, null], @param53=[System.DBNull, null], @param54=[System.DBNull, null], @param55=[System.DBNull, null], @param56=[System.DBNull, null], @param57=[System.DBNull, null], @param58=[System.DBNull, null], @param59=[System.DBNull, null], @param60=[System.DBNull, null], @param61=[System.DBNull, null], @param62=[Int64, System.Int64], @param63=[String, System.String], @param64=[Int64, System.Int64], @param65=[String, System.String], @param66=[System.DBNull, null], @param67=[String, System.String], @param68=[System.DBNull, null], @param69=[System.DBNull, null], @param70=[System.DBNull, null], @param71=[System.DBNull, null], @param72=[System.DBNull, null], @param73=[System.DBNull, null], @param74=[String, System.String], @param75=[DateTime, System.DateTime], @param76=[Int32, System.Int32], @param77=[System.DBNull, null], @param78=[System.DBNull, null], @param79=[System.DBNull, null], @param80=[String, System.String], @param81=[String, System.String], @param82=[Boolean, System.Boolean], @param83=[String, System.String], @param84=[String, System.String], @param85=[String, System.String], @param86=[System.DBNull, null], @param87=[Boolean, System.Boolean], @param88=[System.DBNull, null]]
2019-09-20 15:49:02,178 [1] DEBUG - Statement Id: [DAO00020_GetDVYeuCau_ByDvYeuCau_id] PreparedStatement : [select *        from TT_DVYEUCAU where DVYEUCAU_ID = 205441]
2019-09-20 15:49:02,211 [1] DEBUG - Statement Id: [DAO00049_KiemtraloaiDV] PreparedStatement : [select DICHVU_ID AS HA, '' AS XN, '' as TDCN, '' as TT, '' as KB from TM_DICHVU            left join TM_NHOMDICHVU ndv on ndv.NHOMDICHVU_ID = TM_DICHVU.NHOMDICHVU_ID            where DICHVU_ID = '4145' and left(ndv.MANHOMDICHVU, 2) = '02'            union            select  '' as HA, DICHVU_ID AS XN, '' as TDCN, '' as TT, '' as KB from TM_DICHVU            left join TM_NHOMDICHVU ndv on ndv.NHOMDICHVU_ID = TM_DICHVU.NHOMDICHVU_ID            where DICHVU_ID = '4145' and left(ndv.MANHOMDICHVU, 2) = '01'            union            select  '' as HA, '' AS XN, DICHVU_ID as TDCN, '' as TT, '' as KB from TM_DICHVU            left join TM_NHOMDICHVU ndv on ndv.NHOMDICHVU_ID = TM_DICHVU.NHOMDICHVU_ID            where DICHVU_ID = '4145' and left(ndv.MANHOMDICHVU, 2) = '03'            union            select  '' as HA, '' AS XN, '' as TDCN, DICHVU_ID as TT, '' as KB from TM_DICHVU            left join TM_NHOMDICHVU ndv on ndv.NHOMDICHVU_ID = TM_DICHVU.NHOMDICHVU_ID            where DICHVU_ID = '4145' and left(ndv.MANHOMDICHVU, 2) = '05'            union            select  '' as HA, '' AS XN, '' as TDCN, DICHVU_ID as TT, '' as KB from TM_DICHVU            left join TM_NHOMDICHVU ndv on ndv.NHOMDICHVU_ID = TM_DICHVU.NHOMDICHVU_ID            where DICHVU_ID = '4145' and left(ndv.MANHOMDICHVU, 2) = '06'            union            select  '' as HA, '' AS XN, '' as TDCN, '' as TT, DICHVU_ID as KB from TM_DICHVU            left join TM_NHOMDICHVU ndv on ndv.NHOMDICHVU_ID = TM_DICHVU.NHOMDICHVU_ID            where DICHVU_ID = '4145' and left(ndv.MANHOMDICHVU, 2) = '04']
2019-09-20 15:49:02,277 [1] DEBUG - Statement Id: [DAO00009_TT_TIEPNHAN_GetProcess] PreparedStatement : [select PROCESS_ID from TT_TIEPNHAN where SOTIEPNHAN = 'TN190920.0000001']
2019-09-20 15:49:02,344 [1] DEBUG - Statement Id: [DAOWF001_Kiemtrathongtindayeucaudacochua] PreparedStatement : [select * from TT_REQUEST        where        PARA = '{"HOSPITAL_ID":"HLU01","SOTIEPNHAN":"TN190920.0000001"}'        AND ISACTIVE = '1']
2019-09-20 15:49:02,404 [1] DEBUG - Statement Id: [DAOWF001_Kiemtrathongtindichvudayeucau] PreparedStatement : [select top 1 * from TT_REQUEST_SERVICE        where        PARA = '{"DICHVU_ID":"4145","DVYEUCAU_ID":"205441"}'                AND ISACTIVE = '1' order by ID desc]
2019-09-20 15:49:02,495 [1] DEBUG - Statement Id: [DAOWF001_KiemtrathongtinchitietDichvuYeucau] PreparedStatement : [select * from TT_REQUEST_SERVICE_DETAIL        where        REQUEST_SERVICE_ID = '']
2019-09-20 15:49:02,557 [1] DEBUG - Statement Id: [DAOWF001_GetStartStateOfProcess] PreparedStatement : [select STATE_CODE from TM_STATE where TYPE_CODE = 'S' and PROCESS_CODE = 'P02']
2019-09-20 15:49:02,586 [1] DEBUG - Statement Id: [DAOWF001_Laythongtinwithstatecode] PreparedStatement : [select A.*, B.STATUS_CODE from        TM_STATE_ACTION A        left join TM_STATE B on B.STATE_CODE = A.NEXT_STATE_CODE and A.PROCESS_CODE = B.PROCESS_CODE        where        A.CURR_STATE_CODE = '7'        AND A.PROCESS_CODE = 'P02'        Order By ORDER_ID ASC]
2019-09-20 15:49:02,616 [1] DEBUG - Statement Id: [DAOWF003_Add] PreparedStatement : [insert into TT_REQUEST_SERVICE (        REQUEST_ID        , PARA        , CURR_STATE_CODE        , PROCESS_CODE        ) values (         @param0         ,  @param1         ,  @param2         ,  @param3         )        SELECT SCOPE_IDENTITY()]
2019-09-20 15:49:02,616 [1] DEBUG - Statement Id: [DAOWF003_Add] Parameters: [@param0=[REQUEST_ID,31779], @param1=[SERVICEPARA,{"DICHVU_ID":"4145","DVYEUCAU_ID":"205441"}], @param2=[CURR_STATE_CODE,1], @param3=[PROCESS_CODE,P02]]
2019-09-20 15:49:02,616 [1] DEBUG - Statement Id: [DAOWF003_Add] Types: [@param0=[Int32, System.Int32], @param1=[String, System.String], @param2=[String, System.String], @param3=[String, System.String]]
2019-09-20 15:49:02,648 [1] DEBUG - Statement Id: [DAOWF005_Add] PreparedStatement : [insert into TT_REQUEST_SERVICE_DETAIL (        REQUEST_ID        ,REQUEST_SERVICE_ID        , OLD_STATE_CODE        , CURR_STATE_CODE        ) values (         @param0         , @param1         ,  @param2         ,  @param3         )        SELECT SCOPE_IDENTITY()]
2019-09-20 15:49:02,648 [1] DEBUG - Statement Id: [DAOWF005_Add] Parameters: [@param0=[REQUEST_ID,31779], @param1=[REQUEST_SERVICE_ID,147388], @param2=[OLD_STATE_CODE,null], @param3=[CURR_STATE_CODE,1]]
2019-09-20 15:49:02,648 [1] DEBUG - Statement Id: [DAOWF005_Add] Types: [@param0=[String, System.String], @param1=[Int64, System.Int64], @param2=[System.DBNull, null], @param3=[String, System.String]]
2019-09-20 15:49:02,678 [1] DEBUG - Statement Id: [DAOWF005_Add_History] PreparedStatement : [insert into TT_REQUEST_SERVICE_HISTORY (        REQUEST_ID        ,REQUEST_SERVICE_ID        , OLD_STATE_CODE        , CURR_STATE_CODE        ) values (         @param0         , @param1         ,  @param2         ,  @param3         )]
2019-09-20 15:49:02,678 [1] DEBUG - Statement Id: [DAOWF005_Add_History] Parameters: [@param0=[REQUEST_ID,31779], @param1=[REQUEST_SERVICE_ID,147388], @param2=[OLD_STATE_CODE,null], @param3=[CURR_STATE_CODE,1]]
2019-09-20 15:49:02,678 [1] DEBUG - Statement Id: [DAOWF005_Add_History] Types: [@param0=[String, System.String], @param1=[Int64, System.Int64], @param2=[System.DBNull, null], @param3=[String, System.String]]
2019-09-20 15:49:02,733 [1] DEBUG - Statement Id: [DAO00009_TT_DVYEUCAU_Update] PreparedStatement : [Update TT_DVYEUCAU set TRANGTHAI_WFL = 'CHUAKETQUA' where DVYEUCAU_ID = '205441']
2019-09-20 15:49:02,770 [1] DEBUG - Statement Id: [DAO00023_Add] PreparedStatement : [insert into TT_VIENPHI (        TIEPNHAN_ID        , BENHAN_ID         ,           BENHNHAN_ID         ,           DOTDIEUTRI_ID                 , KHAMBENH_ID        , REF_ID        , REF_TABLE        , DICHVU_ID        , DUOC_ID        , LOAI_CHIPHI        , LOAIGIA_ID        , SOLUONG        , DONGIA_DOANHTHU        , THANHTIEN_DOANHTHU        , BHYT_TL        , BHYT_DONGIA        , BHYT_THANHTIEN        , BHYT_DONGIA_CHITRA        , BHYT_THANHTIEN_CHITRA        , BENHNHAN_PHAITHANHTOAN        , GIATRI_HOADON        , GIATRI_HOADON_DATHANHTOAN        , GIATRI_BIENLAI        , GIATRI_BIENLAI_DATHANHTOAN        , GIATRI_BENHNHAN_DATHANHTOAN        , GIATRI_THATTHU        , MIENGIAM_TL        , MIENGIAM_GIATRI        , NGANSACH_TL        , NGANSACH_GIATRI        , TAITRO_TL        , TAITRO_GIATRI        , BHTN_TL        , BHTN_DONGIA        , BHTN_THANHTIEN        , BHTN_DONGIA_CHITRA        , BHTN_THANHTIEN_CHITRA         ,           DUOCPHEPTHUCHIEN         ,           HUY         ,           DATHANHTOAN         ,           DATHUCHIEN         ,           KHONGTHUTIEN         ,           BHYTDONGTIEN                 , DUYET        , HOADON_ID         ,           ACTIVE         ,           TYLE_VAT         ,           GIAVON         ,           BANGGIA_ID                 , BENHVIEN_ID        , NGUOITAO_ID        , NGAYTAO        , NGUOICAPNHAT_ID        , NGAYCAPNHAT        , DONGIA_BHYT_BANDAU        , DONGIADOANHTHU_BANDAU         ,           YEUCAUVP         ,           DOITUONG_HUONG_ID         ,           SOBHYT_HUONG_ID         ,           DICHVU_TL                 ) values (         @param0         ,  @param1          ,            @param2          ,            @param3                  ,  @param4         ,  @param5         ,  @param6         ,  @param7         ,  @param8         ,  @param9         ,  @param10         ,  @param11         ,  @param12         ,  @param13         ,  @param14         ,  @param15         ,  @param16         ,  @param17         ,  @param18         ,  @param19         ,  @param20         ,  @param21         ,  @param22         ,  @param23         ,  @param24         ,  @param25         ,  @param26         ,  @param27         ,  @param28         ,  @param29         ,  @param30         ,  @param31         ,  @param32         ,  @param33         ,  @param34         ,  @param35         ,  @param36          ,            @param37          ,            @param38          ,            @param39          ,            @param40          ,            @param41          ,            @param42                  ,  @param43         ,  @param44          ,            @param45          ,            @param46          ,            @param47          ,            @param48                  ,  @param49         ,  @param50         ,  @param51         ,  @param52         ,  @param53         ,  @param54         ,  @param55          ,            @param56          ,            @param57          ,            @param58          ,            @param59                  )        SELECT SCOPE_IDENTITY()]
2019-09-20 15:49:02,770 [1] DEBUG - Statement Id: [DAO00023_Add] Parameters: [@param0=[TIEPNHAN_ID,27478], @param1=[BENHAN_ID,null], @param2=[BENHNHAN_ID,23423], @param3=[DOTDIEUTRI_ID,null], @param4=[KHAMBENH_ID,null], @param5=[REF_ID,205441], @param6=[REF_TABLE,TT_DVYEUCAU], @param7=[DICHVU_ID,4145], @param8=[DUOC_ID,null], @param9=[LOAI_CHIPHI,TT], @param10=[LOAIGIA_ID,2], @param11=[SOLUONG,1], @param12=[DONGIA_DOANHTHU,260000], @param13=[THANHTIEN_DOANHTHU,260000], @param14=[BHYT_TL,0.8], @param15=[BHYT_DONGIA,260000], @param16=[BHYT_THANHTIEN,260000], @param17=[BHYT_DONGIA_CHITRA,208000], @param18=[BHYT_THANHTIEN_CHITRA,208000], @param19=[BENHNHAN_PHAITHANHTOAN,52000], @param20=[GIATRI_HOADON,52000], @param21=[GIATRI_HOADON_DATHANHTOAN,0], @param22=[GIATRI_BIENLAI,0], @param23=[GIATRI_BIENLAI_DATHANHTOAN,0], @param24=[GIATRI_BENHNHAN_DATHANHTOAN,0], @param25=[GIATRI_THATTHU,0], @param26=[MIENGIAM_TL,0], @param27=[MIENGIAM_GIATRI,0], @param28=[NGANSACH_TL,0], @param29=[NGANSACH_GIATRI,0], @param30=[TAITRO_TL,0], @param31=[TAITRO_GIATRI,0], @param32=[BHTN_TL,0], @param33=[BHTN_DONGIA,0], @param34=[BHTN_THANHTIEN,0], @param35=[BHTN_DONGIA_CHITRA,0], @param36=[BHTN_THANHTIEN_CHITRA,0], @param37=[DUOCPHEPTHUCHIEN,1], @param38=[HUY,0], @param39=[DATHANHTOAN,0], @param40=[DATHUCHIEN,0], @param41=[KHONGTHUTIEN,0], @param42=[BHYTDONGTIEN,0], @param43=[DUYET,null], @param44=[HOADON_ID,null], @param45=[ACTIVE,1], @param46=[TYLE_VAT,0], @param47=[GIAVON,0], @param48=[BANGGIA_ID,996], @param49=[BENHVIEN_ID,HLU01], @param50=[NGUOITAO_ID,1], @param51=[NGAYTAO,9/20/2019 3:49:02 PM], @param52=[NGUOICAPNHAT_ID,1], @param53=[NGAYCAPNHAT,9/20/2019 3:49:02 PM], @param54=[DONGIA_BHYT_BANDAU,260000], @param55=[DONGIADOANHTHU_BANDAU,260000], @param56=[YEUCAUVP,0], @param57=[DOITUONG_HUONG_ID,4], @param58=[SOBHYT_HUONG_ID,28501], @param59=[DICHVU_TL,1]]
2019-09-20 15:49:02,770 [1] DEBUG - Statement Id: [DAO00023_Add] Types: [@param0=[Int64, System.Int64], @param1=[System.DBNull, null], @param2=[Int64, System.Int64], @param3=[System.DBNull, null], @param4=[System.DBNull, null], @param5=[Int32, System.Int32], @param6=[String, System.String], @param7=[Int64, System.Int64], @param8=[System.DBNull, null], @param9=[String, System.String], @param10=[Int64, System.Int64], @param11=[Double, System.Double], @param12=[Double, System.Double], @param13=[Double, System.Double], @param14=[Double, System.Double], @param15=[Double, System.Double], @param16=[Double, System.Double], @param17=[Double, System.Double], @param18=[Double, System.Double], @param19=[Double, System.Double], @param20=[Double, System.Double], @param21=[Double, System.Double], @param22=[Double, System.Double], @param23=[Double, System.Double], @param24=[Double, System.Double], @param25=[Double, System.Double], @param26=[Double, System.Double], @param27=[Double, System.Double], @param28=[Double, System.Double], @param29=[Double, System.Double], @param30=[Double, System.Double], @param31=[Double, System.Double], @param32=[Double, System.Double], @param33=[Double, System.Double], @param34=[Double, System.Double], @param35=[Double, System.Double], @param36=[Double, System.Double], @param37=[String, System.String], @param38=[Int64, System.Int64], @param39=[Int64, System.Int64], @param40=[Int64, System.Int64], @param41=[String, System.String], @param42=[String, System.String], @param43=[System.DBNull, null], @param44=[System.DBNull, null], @param45=[Int64, System.Int64], @param46=[Int64, System.Int64], @param47=[Double, System.Double], @param48=[Int64, System.Int64], @param49=[String, System.String], @param50=[Int32, System.Int32], @param51=[DateTime, System.DateTime], @param52=[Int32, System.Int32], @param53=[DateTime, System.DateTime], @param54=[Double, System.Double], @param55=[Double, System.Double], @param56=[String, System.String], @param57=[Int64, System.Int64], @param58=[Int32, System.Int32], @param59=[Double, System.Double]]
2019-09-20 15:49:02,811 [1] DEBUG - Statement Id: [DAO00020_Add] PreparedStatement : [declare        @keyValue int, @BenhVienId varchar(10), @yearNow int, @SoPhieuYeu varchar(20), @SoRender varchar(20), @MaNhomDichVu varchar(20)        set @keyValue = 0;        set @BenhVienId = 'HLU01'        set @yearNow = YEAR(getdate())        set @MaNhomDichVu = '38'                 select @keyValue = KEYVALUE from LST_KEYDATA        where KEYTYPE = 'SOPHIEUYEUCAU' and KEYYEAR = @yearNow and SEGMENT_1 = @MaNhomDichVu and BENHVIEN_ID = @BenhVienId        if @keyValue = 0        Insert into LST_KEYDATA values ('SOPHIEUYEUCAU', @yearNow, '0', '0', @MaNhomDichVu, '0', '0', 0, @BenhVienId);          Update LST_KEYDATA set KEYVALUE = KEYVALUE + 1, @keyValue = (KEYVALUE + 1) where KEYTYPE = 'SOPHIEUYEUCAU' and KEYYEAR = @yearNow and SEGMENT_1 = @MaNhomDichVu and BENHVIEN_ID = @BenhVienId        set @SoRender = right('000000'+convert(varchar(6), @keyValue), 6)        set @SoPhieuYeu = RIGHT(@yearNow, 2) + '.' + @MaNhomDichVu + '.' + @SoRender                 insert into TT_DVYEUCAU (        TIEPNHAN_ID        , BENHAN_ID        , KHAMBENH_ID        , SODICHVUYEUCAU        , KHAMBENH_NGOAITRU_ID        , SOPHIEUYEUCAU        , BENHNHAN_ID        , DOITUONG_ID        , DICHVU_ID         ,           NGUOICHIDINH_ID                 , BACSICHIDINH_ID        , GIOYEUCAU        , NGAYYEUCAU        , THANGYEUCAU        , NAMYEUCAU        , NGAYGIOYEUCAU        , THUTUYEUCAU        , NOIYEUCAU_ID        , NOITHUCHIEN_ID        , TRANGTHAI_HANGDOI        , NOIDUNGCHITIET        , CHANDOAN        , LUUTRU_ID        , SODICHVUDONGTIEN        , DICHVU_KHAMBENH_ID        , DALAYMAU        , SINHTHIET        , CLOTEST        , TIEMCANQUANG        , TRIEUCHUNG        , DAITHE        , VITHE        , BENHPHAM        , DANHANBENHPHAM        , NGAYNHANBENHPHAM        , THOIGIANNHANBENHPHAM        , NGUOINHANBENHPHAM_ID        , MANGUOINHAPBENHPHAM        , TENNGUOINHAPBENHPHAM        , KETQUAXNKHAC        , YEUCAUBENNGOAI        , THUCHIENBENNGOAI        , DONVIBENNGOAI_ID        , BACSIBENNGOAI_ID        , TENBACSIBENNGOAI        , KHOABENNGOAI_ID        , KHOABENNGOAI         ,           NGUOIGIOITHIEU_ID         ,           DONVIGIOITHIEU_ID         ,           NGUONDICHVU_ID                 , NOITHUCHIENTHAYDOI_ID        , LOAIKHACHHANG_ID        , THE_ID        , BARCODEID        , HOPDONG_ID        , HOPDONG_BENHNHAN_ID        , HINHTHUCTHANHTOAN_ID        , DANGKY_ID        , DANGKY_CHITIET_ID        , LICHHEN_ID        , THOIGIANLICHHEN        , BNKHONGDENBV        , GHICHU        , THANHTOANTRUOC        , KHAN        , DUOCPHEPTHUCHIEN        , HUYYEUCAU        , LYDOHUY        , TRANGTHAI        , KHOADULIEU        , NGAYKHOADULIEU        , THOIGIANKHOADULIEU        , NGUOIKHOA_ID        , MANGUOIKHOA        , TENNGUOIKHOA        , BENHVIEN_ID        , NGAYTAO        , NGUOITAO_ID        , NGAYHENCLS        , CREATININEMAU        , VUNGCANKHAOSAT        , BHYTDONGTIEN        , THUTIENSAU         ,           DV30                 , DVKEMTHEO        , DVKEMTHEO_KHACEKIP        , LIENCHUYENKHOA         ,           BHYT_TYLETHANHTOAN_ID         ,           CHUADUYET_BHYT         ,           SOPHIEUGOINGOAI                 )        OUTPUT INSERTED.DVYEUCAU_ID, INSERTED.SOPHIEUYEUCAU        values (         @param0         ,  @param1         ,  @param2         ,  @param3         ,  @param4         , @SoPhieuYeu        ,  @param5         ,  @param6         ,  @param7          ,            @param8                  ,  @param9         ,  @param10         ,  @param11         ,  @param12         ,  @param13         ,  @param14         ,  @param15         ,  @param16         ,  @param17         ,  @param18         ,  @param19         ,  @param20         ,  @param21         ,  @param22         ,  @param23         ,  @param24         ,  @param25         ,  @param26         ,  @param27         ,  @param28         ,  @param29         ,  @param30         ,  @param31         ,  @param32         ,  @param33         ,  @param34         ,  @param35         ,  @param36         ,  @param37         ,  @param38         ,  @param39         ,  @param40         ,  @param41         ,  @param42         ,  @param43         ,  @param44         ,  @param45          ,            @param46          ,            @param47          ,            @param48                  ,  @param49         ,  @param50         ,  @param51         ,  @param52         ,  @param53         ,  @param54         ,  @param55         ,  @param56         ,  @param57         ,  @param58         ,  @param59         ,  @param60         ,  @param61         ,  @param62         ,  @param63         ,  @param64         ,  @param65         ,  @param66         ,  @param67         ,  @param68         ,  @param69         ,  @param70         ,  @param71         ,  @param72         ,  @param73         ,  @param74         ,  @param75         ,  @param76         ,  @param77         ,  @param78         ,  @param79         ,  @param80         ,  @param81          ,            @param82                  ,  @param83         ,  @param84         ,  @param85          ,            @param86          ,            @param87          ,            @param88                  );]
2019-09-20 15:49:02,812 [1] DEBUG - Statement Id: [DAO00020_Add] Parameters: [@param0=[TIEPNHAN_ID,27478], @param1=[BENHAN_ID,null], @param2=[KHAMBENH_ID,26172], @param3=[SODICHVUYEUCAU,1], @param4=[KHAMBENH_NGOAITRU_ID,null], @param5=[BENHNHAN_ID,23423], @param6=[DOITUONG_ID,4], @param7=[DICHVU_ID,1111], @param8=[NGUOICHIDINH_ID,1], @param9=[BACSICHIDINH_ID,1], @param10=[GIOYEUCAU,15], @param11=[NGAYYEUCAU,9/20/2019 12:00:00 AM], @param12=[THANGYEUCAU,9], @param13=[NAMYEUCAU,2019], @param14=[NGAYGIOYEUCAU,9/20/2019 3:48:22 PM], @param15=[THUTUYEUCAU,3], @param16=[NOIYEUCAU_ID,58], @param17=[NOITHUCHIEN_ID,27], @param18=[TRANGTHAI_HANGDOI,null], @param19=[NOIDUNGCHITIET,null], @param20=[CHANDOAN,Viêm phế quản cấp(J20)], @param21=[LUUTRU_ID,null], @param22=[SODICHVUDONGTIEN,0], @param23=[DICHVU_KHAMBENH_ID,null], @param24=[DALAYMAU,null], @param25=[SINHTHIET,0], @param26=[CLOTEST,0], @param27=[TIEMCANQUANG,0], @param28=[TRIEUCHUNG,null], @param29=[DAITHE,null], @param30=[VITHE,null], @param31=[BENHPHAM,null], @param32=[DANHANBENHPHAM,0], @param33=[NGAYNHANBENHPHAM,null], @param34=[THOIGIANNHANBENHPHAM,null], @param35=[NGUOINHANBENHPHAM_ID,null], @param36=[MANGUOINHAPBENHPHAM,null], @param37=[TENNGUOINHAPBENHPHAM,null], @param38=[KETQUAXNKHAC,null], @param39=[YEUCAUBENNGOAI,0], @param40=[THUCHIENBENNGOAI,0], @param41=[DONVIBENNGOAI_ID,null], @param42=[BACSIBENNGOAI_ID,null], @param43=[TENBACSIBENNGOAI,null], @param44=[KHOABENNGOAI_ID,null], @param45=[KHOABENNGOAI,null], @param46=[NGUOIGIOITHIEU_ID,null], @param47=[DONVIGIOITHIEU_ID,null], @param48=[NGUONDICHVU_ID,null], @param49=[NOITHUCHIENTHAYDOI_ID,null], @param50=[LOAIKHACHHANG_ID,null], @param51=[THE_ID,null], @param52=[BARCODEID,null], @param53=[HOPDONG_ID,null], @param54=[HOPDONG_BENHNHAN_ID,null], @param55=[HINHTHUCTHANHTOAN_ID,null], @param56=[DANGKY_ID,null], @param57=[DANGKY_CHITIET_ID,null], @param58=[LICHHEN_ID,null], @param59=[THOIGIANLICHHEN,null], @param60=[BNKHONGDENBV,null], @param61=[GHICHU,null], @param62=[THANHTOANTRUOC,1], @param63=[KHAN,0], @param64=[DUOCPHEPTHUCHIEN,0], @param65=[HUYYEUCAU,0], @param66=[LYDOHUY,null], @param67=[TRANGTHAI,CHUAKETQUA], @param68=[KHOADULIEU,null], @param69=[NGAYKHOADULIEU,null], @param70=[THOIGIANKHOADULIEU,null], @param71=[NGUOIKHOA_ID,null], @param72=[MANGUOIKHOA,null], @param73=[TENNGUOIKHOA,null], @param74=[BENHVIEN_ID,HLU01], @param75=[NGAYTAO,9/20/2019 3:49:02 PM], @param76=[NGUOITAO_ID,1], @param77=[NGAYHENCLS,null], @param78=[CREATININEMAU,null], @param79=[VUNGCANKHAOSAT,null], @param80=[BHYTDONGTIEN,0], @param81=[THUTIENSAU,0], @param82=[DV30,False], @param83=[DVKEMTHEO,0], @param84=[DVKEMTHEO_KHACEKIP,0], @param85=[LIENCHUYENKHOA,0], @param86=[BHYT_TYLETHANHTOAN_ID,null], @param87=[CHUADUYET_BHYT,False], @param88=[SOPHIEUGOINGOAI,null]]
2019-09-20 15:49:02,812 [1] DEBUG - Statement Id: [DAO00020_Add] Types: [@param0=[Int64, System.Int64], @param1=[System.DBNull, null], @param2=[Int64, System.Int64], @param3=[Double, System.Double], @param4=[System.DBNull, null], @param5=[Int64, System.Int64], @param6=[Int64, System.Int64], @param7=[Int64, System.Int64], @param8=[Int64, System.Int64], @param9=[Int64, System.Int64], @param10=[Int64, System.Int64], @param11=[DateTime, System.DateTime], @param12=[Int64, System.Int64], @param13=[Int64, System.Int64], @param14=[DateTime, System.DateTime], @param15=[String, System.String], @param16=[Int64, System.Int64], @param17=[Int64, System.Int64], @param18=[System.DBNull, null], @param19=[System.DBNull, null], @param20=[String, System.String], @param21=[System.DBNull, null], @param22=[Int32, System.Int32], @param23=[System.DBNull, null], @param24=[System.DBNull, null], @param25=[Int64, System.Int64], @param26=[Int64, System.Int64], @param27=[Int64, System.Int64], @param28=[System.DBNull, null], @param29=[System.DBNull, null], @param30=[System.DBNull, null], @param31=[System.DBNull, null], @param32=[Int64, System.Int64], @param33=[System.DBNull, null], @param34=[System.DBNull, null], @param35=[System.DBNull, null], @param36=[System.DBNull, null], @param37=[System.DBNull, null], @param38=[System.DBNull, null], @param39=[String, System.String], @param40=[Int64, System.Int64], @param41=[System.DBNull, null], @param42=[System.DBNull, null], @param43=[System.DBNull, null], @param44=[System.DBNull, null], @param45=[System.DBNull, null], @param46=[System.DBNull, null], @param47=[System.DBNull, null], @param48=[System.DBNull, null], @param49=[System.DBNull, null], @param50=[System.DBNull, null], @param51=[System.DBNull, null], @param52=[System.DBNull, null], @param53=[System.DBNull, null], @param54=[System.DBNull, null], @param55=[System.DBNull, null], @param56=[System.DBNull, null], @param57=[System.DBNull, null], @param58=[System.DBNull, null], @param59=[System.DBNull, null], @param60=[System.DBNull, null], @param61=[System.DBNull, null], @param62=[Int64, System.Int64], @param63=[String, System.String], @param64=[Int64, System.Int64], @param65=[String, System.String], @param66=[System.DBNull, null], @param67=[String, System.String], @param68=[System.DBNull, null], @param69=[System.DBNull, null], @param70=[System.DBNull, null], @param71=[System.DBNull, null], @param72=[System.DBNull, null], @param73=[System.DBNull, null], @param74=[String, System.String], @param75=[DateTime, System.DateTime], @param76=[Int32, System.Int32], @param77=[System.DBNull, null], @param78=[System.DBNull, null], @param79=[System.DBNull, null], @param80=[String, System.String], @param81=[String, System.String], @param82=[Boolean, System.Boolean], @param83=[String, System.String], @param84=[String, System.String], @param85=[String, System.String], @param86=[System.DBNull, null], @param87=[Boolean, System.Boolean], @param88=[System.DBNull, null]]
2019-09-20 15:49:02,963 [1] DEBUG - Statement Id: [DAO00020_GetDVYeuCau_ByDvYeuCau_id] PreparedStatement : [select *        from TT_DVYEUCAU where DVYEUCAU_ID = 205442]
2019-09-20 15:49:03,007 [1] DEBUG - Statement Id: [DAO00049_KiemtraloaiDV] PreparedStatement : [select DICHVU_ID AS HA, '' AS XN, '' as TDCN, '' as TT, '' as KB from TM_DICHVU            left join TM_NHOMDICHVU ndv on ndv.NHOMDICHVU_ID = TM_DICHVU.NHOMDICHVU_ID            where DICHVU_ID = '1111' and left(ndv.MANHOMDICHVU, 2) = '02'            union            select  '' as HA, DICHVU_ID AS XN, '' as TDCN, '' as TT, '' as KB from TM_DICHVU            left join TM_NHOMDICHVU ndv on ndv.NHOMDICHVU_ID = TM_DICHVU.NHOMDICHVU_ID            where DICHVU_ID = '1111' and left(ndv.MANHOMDICHVU, 2) = '01'            union            select  '' as HA, '' AS XN, DICHVU_ID as TDCN, '' as TT, '' as KB from TM_DICHVU            left join TM_NHOMDICHVU ndv on ndv.NHOMDICHVU_ID = TM_DICHVU.NHOMDICHVU_ID            where DICHVU_ID = '1111' and left(ndv.MANHOMDICHVU, 2) = '03'            union            select  '' as HA, '' AS XN, '' as TDCN, DICHVU_ID as TT, '' as KB from TM_DICHVU            left join TM_NHOMDICHVU ndv on ndv.NHOMDICHVU_ID = TM_DICHVU.NHOMDICHVU_ID            where DICHVU_ID = '1111' and left(ndv.MANHOMDICHVU, 2) = '05'            union            select  '' as HA, '' AS XN, '' as TDCN, DICHVU_ID as TT, '' as KB from TM_DICHVU            left join TM_NHOMDICHVU ndv on ndv.NHOMDICHVU_ID = TM_DICHVU.NHOMDICHVU_ID            where DICHVU_ID = '1111' and left(ndv.MANHOMDICHVU, 2) = '06'            union            select  '' as HA, '' AS XN, '' as TDCN, '' as TT, DICHVU_ID as KB from TM_DICHVU            left join TM_NHOMDICHVU ndv on ndv.NHOMDICHVU_ID = TM_DICHVU.NHOMDICHVU_ID            where DICHVU_ID = '1111' and left(ndv.MANHOMDICHVU, 2) = '04']
2019-09-20 15:49:03,104 [1] DEBUG - Statement Id: [DAO00009_TT_TIEPNHAN_GetProcess] PreparedStatement : [select PROCESS_ID from TT_TIEPNHAN where SOTIEPNHAN = 'TN190920.0000001']
2019-09-20 15:49:03,170 [1] DEBUG - Statement Id: [DAOWF001_Kiemtrathongtindayeucaudacochua] PreparedStatement : [select * from TT_REQUEST        where        PARA = '{"HOSPITAL_ID":"HLU01","SOTIEPNHAN":"TN190920.0000001"}'        AND ISACTIVE = '1']
2019-09-20 15:49:03,225 [1] DEBUG - Statement Id: [DAOWF001_Kiemtrathongtindichvudayeucau] PreparedStatement : [select top 1 * from TT_REQUEST_SERVICE        where        PARA = '{"DICHVU_ID":"1111","DVYEUCAU_ID":"205442"}'                AND ISACTIVE = '1' order by ID desc]
2019-09-20 15:49:03,321 [1] DEBUG - Statement Id: [DAOWF001_KiemtrathongtinchitietDichvuYeucau] PreparedStatement : [select * from TT_REQUEST_SERVICE_DETAIL        where        REQUEST_SERVICE_ID = '']
2019-09-20 15:49:03,386 [1] DEBUG - Statement Id: [DAOWF001_GetStartStateOfProcess] PreparedStatement : [select STATE_CODE from TM_STATE where TYPE_CODE = 'S' and PROCESS_CODE = 'P02']
2019-09-20 15:49:03,420 [1] DEBUG - Statement Id: [DAOWF001_Laythongtinwithstatecode] PreparedStatement : [select A.*, B.STATUS_CODE from        TM_STATE_ACTION A        left join TM_STATE B on B.STATE_CODE = A.NEXT_STATE_CODE and A.PROCESS_CODE = B.PROCESS_CODE        where        A.CURR_STATE_CODE = '7'        AND A.PROCESS_CODE = 'P02'        Order By ORDER_ID ASC]
2019-09-20 15:49:03,460 [1] DEBUG - Statement Id: [DAOWF003_Add] PreparedStatement : [insert into TT_REQUEST_SERVICE (        REQUEST_ID        , PARA        , CURR_STATE_CODE        , PROCESS_CODE        ) values (         @param0         ,  @param1         ,  @param2         ,  @param3         )        SELECT SCOPE_IDENTITY()]
2019-09-20 15:49:03,460 [1] DEBUG - Statement Id: [DAOWF003_Add] Parameters: [@param0=[REQUEST_ID,31779], @param1=[SERVICEPARA,{"DICHVU_ID":"1111","DVYEUCAU_ID":"205442"}], @param2=[CURR_STATE_CODE,1], @param3=[PROCESS_CODE,P02]]
2019-09-20 15:49:03,460 [1] DEBUG - Statement Id: [DAOWF003_Add] Types: [@param0=[Int32, System.Int32], @param1=[String, System.String], @param2=[String, System.String], @param3=[String, System.String]]
2019-09-20 15:49:03,509 [1] DEBUG - Statement Id: [DAOWF005_Add] PreparedStatement : [insert into TT_REQUEST_SERVICE_DETAIL (        REQUEST_ID        ,REQUEST_SERVICE_ID        , OLD_STATE_CODE        , CURR_STATE_CODE        ) values (         @param0         , @param1         ,  @param2         ,  @param3         )        SELECT SCOPE_IDENTITY()]
2019-09-20 15:49:03,509 [1] DEBUG - Statement Id: [DAOWF005_Add] Parameters: [@param0=[REQUEST_ID,31779], @param1=[REQUEST_SERVICE_ID,147389], @param2=[OLD_STATE_CODE,null], @param3=[CURR_STATE_CODE,1]]
2019-09-20 15:49:03,509 [1] DEBUG - Statement Id: [DAOWF005_Add] Types: [@param0=[String, System.String], @param1=[Int64, System.Int64], @param2=[System.DBNull, null], @param3=[String, System.String]]
2019-09-20 15:49:03,553 [1] DEBUG - Statement Id: [DAOWF005_Add_History] PreparedStatement : [insert into TT_REQUEST_SERVICE_HISTORY (        REQUEST_ID        ,REQUEST_SERVICE_ID        , OLD_STATE_CODE        , CURR_STATE_CODE        ) values (         @param0         , @param1         ,  @param2         ,  @param3         )]
2019-09-20 15:49:03,553 [1] DEBUG - Statement Id: [DAOWF005_Add_History] Parameters: [@param0=[REQUEST_ID,31779], @param1=[REQUEST_SERVICE_ID,147389], @param2=[OLD_STATE_CODE,null], @param3=[CURR_STATE_CODE,1]]
2019-09-20 15:49:03,553 [1] DEBUG - Statement Id: [DAOWF005_Add_History] Types: [@param0=[String, System.String], @param1=[Int64, System.Int64], @param2=[System.DBNull, null], @param3=[String, System.String]]
2019-09-20 15:49:03,604 [1] DEBUG - Statement Id: [DAO00009_TT_DVYEUCAU_Update] PreparedStatement : [Update TT_DVYEUCAU set TRANGTHAI_WFL = 'CHUAKETQUA' where DVYEUCAU_ID = '205442']
2019-09-20 15:49:03,646 [1] DEBUG - Statement Id: [DAO00023_Add] PreparedStatement : [insert into TT_VIENPHI (        TIEPNHAN_ID        , BENHAN_ID         ,           BENHNHAN_ID         ,           DOTDIEUTRI_ID                 , KHAMBENH_ID        , REF_ID        , REF_TABLE        , DICHVU_ID        , DUOC_ID        , LOAI_CHIPHI        , LOAIGIA_ID        , SOLUONG        , DONGIA_DOANHTHU        , THANHTIEN_DOANHTHU        , BHYT_TL        , BHYT_DONGIA        , BHYT_THANHTIEN        , BHYT_DONGIA_CHITRA        , BHYT_THANHTIEN_CHITRA        , BENHNHAN_PHAITHANHTOAN        , GIATRI_HOADON        , GIATRI_HOADON_DATHANHTOAN        , GIATRI_BIENLAI        , GIATRI_BIENLAI_DATHANHTOAN        , GIATRI_BENHNHAN_DATHANHTOAN        , GIATRI_THATTHU        , MIENGIAM_TL        , MIENGIAM_GIATRI        , NGANSACH_TL        , NGANSACH_GIATRI        , TAITRO_TL        , TAITRO_GIATRI        , BHTN_TL        , BHTN_DONGIA        , BHTN_THANHTIEN        , BHTN_DONGIA_CHITRA        , BHTN_THANHTIEN_CHITRA         ,           DUOCPHEPTHUCHIEN         ,           HUY         ,           DATHANHTOAN         ,           DATHUCHIEN         ,           KHONGTHUTIEN         ,           BHYTDONGTIEN                 , DUYET        , HOADON_ID         ,           ACTIVE         ,           TYLE_VAT         ,           GIAVON         ,           BANGGIA_ID                 , BENHVIEN_ID        , NGUOITAO_ID        , NGAYTAO        , NGUOICAPNHAT_ID        , NGAYCAPNHAT        , DONGIA_BHYT_BANDAU        , DONGIADOANHTHU_BANDAU         ,           YEUCAUVP         ,           DOITUONG_HUONG_ID         ,           SOBHYT_HUONG_ID         ,           DICHVU_TL                 ) values (         @param0         ,  @param1          ,            @param2          ,            @param3                  ,  @param4         ,  @param5         ,  @param6         ,  @param7         ,  @param8         ,  @param9         ,  @param10         ,  @param11         ,  @param12         ,  @param13         ,  @param14         ,  @param15         ,  @param16         ,  @param17         ,  @param18         ,  @param19         ,  @param20         ,  @param21         ,  @param22         ,  @param23         ,  @param24         ,  @param25         ,  @param26         ,  @param27         ,  @param28         ,  @param29         ,  @param30         ,  @param31         ,  @param32         ,  @param33         ,  @param34         ,  @param35         ,  @param36          ,            @param37          ,            @param38          ,            @param39          ,            @param40          ,            @param41          ,            @param42                  ,  @param43         ,  @param44          ,            @param45          ,            @param46          ,            @param47          ,            @param48                  ,  @param49         ,  @param50         ,  @param51         ,  @param52         ,  @param53         ,  @param54         ,  @param55          ,            @param56          ,            @param57          ,            @param58          ,            @param59                  )        SELECT SCOPE_IDENTITY()]
2019-09-20 15:49:03,646 [1] DEBUG - Statement Id: [DAO00023_Add] Parameters: [@param0=[TIEPNHAN_ID,27478], @param1=[BENHAN_ID,null], @param2=[BENHNHAN_ID,23423], @param3=[DOTDIEUTRI_ID,null], @param4=[KHAMBENH_ID,null], @param5=[REF_ID,205442], @param6=[REF_TABLE,TT_DVYEUCAU], @param7=[DICHVU_ID,1111], @param8=[DUOC_ID,null], @param9=[LOAI_CHIPHI,TT], @param10=[LOAIGIA_ID,2], @param11=[SOLUONG,1], @param12=[DONGIA_DOANHTHU,37000], @param13=[THANHTIEN_DOANHTHU,37000], @param14=[BHYT_TL,0.8], @param15=[BHYT_DONGIA,37000], @param16=[BHYT_THANHTIEN,37000], @param17=[BHYT_DONGIA_CHITRA,29600], @param18=[BHYT_THANHTIEN_CHITRA,29600], @param19=[BENHNHAN_PHAITHANHTOAN,7400], @param20=[GIATRI_HOADON,7400], @param21=[GIATRI_HOADON_DATHANHTOAN,0], @param22=[GIATRI_BIENLAI,0], @param23=[GIATRI_BIENLAI_DATHANHTOAN,0], @param24=[GIATRI_BENHNHAN_DATHANHTOAN,0], @param25=[GIATRI_THATTHU,0], @param26=[MIENGIAM_TL,0], @param27=[MIENGIAM_GIATRI,0], @param28=[NGANSACH_TL,0], @param29=[NGANSACH_GIATRI,0], @param30=[TAITRO_TL,0], @param31=[TAITRO_GIATRI,0], @param32=[BHTN_TL,0], @param33=[BHTN_DONGIA,0], @param34=[BHTN_THANHTIEN,0], @param35=[BHTN_DONGIA_CHITRA,0], @param36=[BHTN_THANHTIEN_CHITRA,0], @param37=[DUOCPHEPTHUCHIEN,1], @param38=[HUY,0], @param39=[DATHANHTOAN,0], @param40=[DATHUCHIEN,0], @param41=[KHONGTHUTIEN,0], @param42=[BHYTDONGTIEN,0], @param43=[DUYET,null], @param44=[HOADON_ID,null], @param45=[ACTIVE,1], @param46=[TYLE_VAT,0], @param47=[GIAVON,0], @param48=[BANGGIA_ID,996], @param49=[BENHVIEN_ID,HLU01], @param50=[NGUOITAO_ID,1], @param51=[NGAYTAO,9/20/2019 3:49:03 PM], @param52=[NGUOICAPNHAT_ID,1], @param53=[NGAYCAPNHAT,9/20/2019 3:49:03 PM], @param54=[DONGIA_BHYT_BANDAU,37000], @param55=[DONGIADOANHTHU_BANDAU,37000], @param56=[YEUCAUVP,0], @param57=[DOITUONG_HUONG_ID,4], @param58=[SOBHYT_HUONG_ID,28501], @param59=[DICHVU_TL,1]]
2019-09-20 15:49:03,646 [1] DEBUG - Statement Id: [DAO00023_Add] Types: [@param0=[Int64, System.Int64], @param1=[System.DBNull, null], @param2=[Int64, System.Int64], @param3=[System.DBNull, null], @param4=[System.DBNull, null], @param5=[Int32, System.Int32], @param6=[String, System.String], @param7=[Int64, System.Int64], @param8=[System.DBNull, null], @param9=[String, System.String], @param10=[Int64, System.Int64], @param11=[Double, System.Double], @param12=[Double, System.Double], @param13=[Double, System.Double], @param14=[Double, System.Double], @param15=[Double, System.Double], @param16=[Double, System.Double], @param17=[Double, System.Double], @param18=[Double, System.Double], @param19=[Double, System.Double], @param20=[Double, System.Double], @param21=[Double, System.Double], @param22=[Double, System.Double], @param23=[Double, System.Double], @param24=[Double, System.Double], @param25=[Double, System.Double], @param26=[Double, System.Double], @param27=[Double, System.Double], @param28=[Double, System.Double], @param29=[Double, System.Double], @param30=[Double, System.Double], @param31=[Double, System.Double], @param32=[Double, System.Double], @param33=[Double, System.Double], @param34=[Double, System.Double], @param35=[Double, System.Double], @param36=[Double, System.Double], @param37=[String, System.String], @param38=[Int64, System.Int64], @param39=[Int64, System.Int64], @param40=[Int64, System.Int64], @param41=[String, System.String], @param42=[String, System.String], @param43=[System.DBNull, null], @param44=[System.DBNull, null], @param45=[Int64, System.Int64], @param46=[Int64, System.Int64], @param47=[Double, System.Double], @param48=[Int64, System.Int64], @param49=[String, System.String], @param50=[Int32, System.Int32], @param51=[DateTime, System.DateTime], @param52=[Int32, System.Int32], @param53=[DateTime, System.DateTime], @param54=[Double, System.Double], @param55=[Double, System.Double], @param56=[String, System.String], @param57=[Int64, System.Int64], @param58=[Int32, System.Int32], @param59=[Double, System.Double]]
2019-09-20 15:49:03,683 [1] DEBUG - Statement Id: [DAO00027_ThongTinTiepNhanCOM006NhieuDVYeucau] PreparedStatement : [select distinct CONVERT(VARCHAR(11),A.NGAYTIEPNHAN,103) as NGAYYEUCAU, C.DICHVU_ID, C.DVYEUCAU_ID, D.TENDICHVU, C.NOITHUCHIEN_ID,        A.SOTIEPNHAN, A.TRAITUYEN, A.NGAYMIENDONGCHITRA, A.TIEPNHAN_ID, A.DOITUONG_ID, A.TRANGTHAI,        A.LOAITHANHVIEN_ID, A.SUDUNG_BHTN, A.THE_ID, A.THANHVIEN_ID, A.VIP, A.NGUON_BENHNHAN_ID, A.BAOLANH_VIENPHI,        CASE WHEN (A.TRANGTHAI = 'NOITRU' OR A.TRANGTHAI = 'CAPCUU'   or A.TRANGTHAI = 'NGOAITRU') THEN 'IN' ELSE 'OUT' END AS LOAIBENHAN,        CASE WHEN (C.TRANGTHAI = 'CHUAKETQUA') THEN 'CHUAKETQUA' ELSE 'HOANTAT' END AS TRANGTHAIDICHVU, A.SOBHYT,        B.*,        CASE WHEN Left(E.MANHOMDICHVU,2) = '03' THEN '02' ELSE Left(E.MANHOMDICHVU,2) END AS MANHOMDICHVU        , A.UUTIEN        from TT_TIEPNHAN A        inner join TT_BENHNHAN B on B.BENHNHAN_ID = A.BENHNHAN_ID and (A.TRANGTHAI = 'DATIEPNHAN' or A.TRANGTHAI = 'NOITRU' or A.TRANGTHAI = 'CAPCUU'  or A.TRANGTHAI = 'NGOAITRU') and B.ACTIVE = '1'        inner join TT_DVYEUCAU C on C.TIEPNHAN_ID = A.TIEPNHAN_ID        left join TM_DICHVU D on D.DICHVU_ID = C.DICHVU_ID        left join TM_NHOMDICHVU E on E.NHOMDICHVU_ID = D.NHOMDICHVU_ID        where C.NGAYHENCLS is NULL and A.TIEPNHAN_ID = '27478' and A.BENHVIEN_ID = 'HLU01'         and           C.DVYEUCAU_ID in (205441,205442)]
2019-09-20 15:49:03,978 [1] DEBUG - Statement Id: [DAO00027_ThongTinTiepNhanCOM015] PreparedStatement : [declare @ManhomDSA varchar(10);        select top 1  @ManhomDSA = VALUE from TM_SYS_APPSETTINGS where CODE = 'MANHOM_DICHVU_DSA'        SELECT * FROM        (        SELECT        (A.SOTIEPNHAN + (CASE WHEN Left(E.MANHOMDICHVU,2) = '03' THEN '02' ELSE Left(E.MANHOMDICHVU,2) END) + LTRIM(C.NOITHUCHIEN_ID)) AS acss_lookupID,        ROW_NUMBER() OVER        (PARTITION BY (A.SOTIEPNHAN + (CASE WHEN Left(E.MANHOMDICHVU,2) = '03' THEN '02' ELSE Left(E.MANHOMDICHVU,2) END) + LTRIM(C.NOITHUCHIEN_ID))        ORDER BY (A.SOTIEPNHAN + (CASE WHEN Left(E.MANHOMDICHVU,2) = '03' THEN '02' ELSE Left(E.MANHOMDICHVU,2) END) + LTRIM(C.NOITHUCHIEN_ID)))        as num,        A.SOTIEPNHAN + (CASE WHEN Left(E.MANHOMDICHVU,2) = '03' THEN '02' ELSE Left(E.MANHOMDICHVU,2) END) + LTRIM(C.NOITHUCHIEN_ID) as KEYCOM15,        C.NOITHUCHIEN_ID, A.SOTIEPNHAN, A.TRAITUYEN, A.NGAYMIENDONGCHITRA, A.TIEPNHAN_ID, A.DOITUONG_ID, A.TRANGTHAI,        CASE WHEN (A.TRANGTHAI = 'NOITRU' OR A.TRANGTHAI = 'CAPCUU' or A.TRANGTHAI = 'NGOAITRU') THEN 'IN' ELSE 'OUT' END AS LOAIBENHAN,        CASE WHEN (C.TRANGTHAI = 'CHUAKETQUA') THEN 'CHUAKETQUA' ELSE 'HOANTAT' END AS TRANGTHAIDICHVU, A.SOBHYT,        B.*, F.TRANGTHAI as TRANGTHAI_BENHAN_NOITRU,        A.LOAITHANHVIEN_ID, A.SUDUNG_BHTN, A.THE_ID, A.THANHVIEN_ID, A.VIP, A.NGUON_BENHNHAN_ID, A.BAOLANH_VIENPHI,        CASE        WHEN @ManhomDSA is not null and E.MANHOMDICHVU in (@ManhomDSA) THEN E.MANHOMDICHVU        WHEN Left(E.MANHOMDICHVU,2) = '03' THEN '02' ELSE Left(E.MANHOMDICHVU,2) END AS MANHOMDICHVU        , A.UUTIEN        from TT_TIEPNHAN A        inner join TT_BENHNHAN B on B.BENHNHAN_ID = A.BENHNHAN_ID and (A.TRANGTHAI = 'DATIEPNHAN' or A.TRANGTHAI = 'NOITRU' or A.TRANGTHAI = 'CAPCUU' or A.TRANGTHAI = 'NGOAITRU') and B.ACTIVE = '1'        inner join TT_DVYEUCAU C on C.TIEPNHAN_ID = A.TIEPNHAN_ID        left join TM_DICHVU D on D.DICHVU_ID = C.DICHVU_ID        left join TM_NHOMDICHVU E on E.NHOMDICHVU_ID = D.NHOMDICHVU_ID        left join TT_NOITRU_BENHAN F on F.TIEPNHAN_ID = A.TIEPNHAN_ID        where C.NGAYHENCLS is NULL and A.TIEPNHAN_ID = '27478' and A.BENHVIEN_ID = 'HLU01'        ) a where a.num = 1]
2019-09-20 15:49:05,322 [1] DEBUG - Statement Id: [DAO00026_GetListDanhSachDichVuGhiNhanVTYT_COM25_WithTN] PreparedStatement : [select distinct CONVERT(VARCHAR(11),C.NGAYYEUCAU,103) as NGAYYEUCAU, C.DICHVU_ID, C.DVYEUCAU_ID, D.TENDICHVU, C.NOITHUCHIEN_ID, A.SOTIEPNHAN, A.TRAITUYEN, A.NGAYMIENDONGCHITRA, A.TIEPNHAN_ID, A.DOITUONG_ID, A.TRANGTHAI,            A.LOAITHANHVIEN_ID, A.SUDUNG_BHTN, A.THE_ID, A.THANHVIEN_ID, A.VIP, A.NGUON_BENHNHAN_ID, A.BAOLANH_VIENPHI,            CASE WHEN (A.TRANGTHAI = 'NOITRU' OR A.TRANGTHAI = 'CAPCUU') THEN 'IN' ELSE 'OUT' END AS LOAIBENHAN,            CASE WHEN (C.TRANGTHAI = 'CHUAKETQUA') THEN 'CHUAKETQUA' ELSE 'HOANTAT' END AS TRANGTHAIDICHVU,            B.*, isnull(ntba.SOBENHAN, '') SOBENHAN, isnull(ntba.BENHAN_ID, 0) BENHAN_ID,            CASE WHEN Left(E.MANHOMDICHVU,2) = '03' THEN '02' ELSE Left(E.MANHOMDICHVU,2) END AS MANHOMDICHVU            from TT_TIEPNHAN A            inner join TT_BENHNHAN B on B.BENHNHAN_ID = A.BENHNHAN_ID and B.ACTIVE = '1'            inner join TT_DVYEUCAU C on C.TIEPNHAN_ID = A.TIEPNHAN_ID                        left join TM_DICHVU D on D.DICHVU_ID = C.DICHVU_ID            left join TM_NHOMDICHVU E on E.NHOMDICHVU_ID = D.NHOMDICHVU_ID            left join TT_NOITRU_BENHAN ntba on ntba.BENHAN_ID = C.BENHAN_ID              where            C.NGAYHENCLS is NULL and A.BENHVIEN_ID = 'HLU01'            and (A.TRANGTHAI = 'DATIEPNHAN' or A.TRANGTHAI = 'NOITRU' or A.TRANGTHAI = 'CAPCUU' or A.TRANGTHAI = 'NGOAITRU')            and (CASE WHEN Left(E.MANHOMDICHVU,2) = '03' THEN '02' ELSE Left(E.MANHOMDICHVU,2) END in ('02', '04'))            and A.TIEPNHAN_ID = '27478']
2019-09-20 15:49:06,039 [1] DEBUG - Statement Id: [DAO00020_UpdateTienSuBenhNhan] PreparedStatement : [update TT_BENHNHAN set        TIENSUDIUNG =  @param0         , TIENSUBENH =  @param1         , NGUOICAPNHAT_ID =  @param2         , NGAYCAPNHAT =  @param3         where        BENHNHAN_ID =  @param4]
2019-09-20 15:49:06,039 [1] DEBUG - Statement Id: [DAO00020_UpdateTienSuBenhNhan] Parameters: [@param0=[TIENSUDIUNG,], @param1=[TIENSUBENH,], @param2=[NGUOICAPNHAT_ID,1], @param3=[NGAYCAPNHAT,9/20/2019 3:49:06 PM], @param4=[BENHNHAN_ID,23423]]
2019-09-20 15:49:06,039 [1] DEBUG - Statement Id: [DAO00020_UpdateTienSuBenhNhan] Types: [@param0=[String, System.String], @param1=[String, System.String], @param2=[Int32, System.Int32], @param3=[DateTime, System.DateTime], @param4=[Int64, System.Int64]]
2019-09-20 15:49:06,127 [1] DEBUG - Statement Id: [DAOLOG01_LockEnd] PreparedStatement : [DELETE TT_LOG_UPDATE        where REF_TABLE = 'TT_VIENPHI' and REF_ID = '27478' and BENHVIEN_ID = 'HLU01']
2019-09-20 15:49:06,219 [1] DEBUG - Statement Id: [DAO00067_ClearDataVienPhi] PreparedStatement : [delete from TT_VIENPHI where TIEPNHAN_ID = 27478 and REF_ID = 0                     update TT_VIENPHI set SOLUONG = 0          where REF_TABLE = 'TT_DVYEUCAU' and TIEPNHAN_ID =  @param0           and not exists (select DVYEUCAU_ID from TT_DVYEUCAU where TT_VIENPHI.REF_ID = DVYEUCAU_ID and TIEPNHAN_ID =  @param0 )                       update TT_VIENPHI set SOLUONG = 0          where REF_TABLE = 'TT_NGOAITRU_TOATHUOC'          and TIEPNHAN_ID =  @param0           and HOADON_ID is null and TIEPNHAN_ID =  @param0           and not exists (select TOATHUOC_ID from TT_NGOAITRU_TOATHUOC where TT_VIENPHI.REF_ID = TOATHUOC_ID and TIEPNHAN_ID =  @param0 )                     delete TT_DUOC_TONKHO_BOOK_NOITRU where REF_TABLE = 'TT_NOITRU_TOATHUOC' and (REF_ID is null or REF_ID = 0)        delete TT_DUOC_TONKHO_BOOK_NGOAITRU where REF_ID is null or REF_ID = 0                      update TT_VIENPHI set          THANHTIEN_DOANHTHU = 0, BHYT_THANHTIEN = 0, BHYT_THANHTIEN_CHITRA = 0          , GIATRI_BENHNHAN_DATHANHTOAN = 0, BENHNHAN_PHAITHANHTOAN = 0          where TIEPNHAN_ID = 27478 and SOLUONG = 0                       update TT_VIENPHI set          GIATRI_BENHNHAN_DATHANHTOAN = 0          where TIEPNHAN_ID = '27478' and GIATRI_BENHNHAN_DATHANHTOAN is null            update TT_VIENPHI set          BENHNHAN_PHAITHANHTOAN = 0          where TIEPNHAN_ID = '27478' and BENHNHAN_PHAITHANHTOAN is null]
2019-09-20 15:49:06,219 [1] DEBUG - Statement Id: [DAO00067_ClearDataVienPhi] Parameters: [@param0=[TIEPNHAN_ID,27478]]
2019-09-20 15:49:06,219 [1] DEBUG - Statement Id: [DAO00067_ClearDataVienPhi] Types: [@param0=[Int64, System.Int64]]
2019-09-20 15:49:07,077 [1] DEBUG - Statement Id: [DAO00020_GetDSDichVuYC] PreparedStatement : [select dvyc.*,        dv.TENDICHVU, dv.MADICHVU, dv.NORESULT, ndv.MANHOMDICHVU, ndv.TENNHOMDICHVU, vp.KHONGTHUTIEN        from TT_DVYEUCAU dvyc        left join TM_DICHVU dv on dvyc.DICHVU_ID = dv.DICHVU_ID        left join TM_NHOMDICHVU ndv on ndv.NHOMDICHVU_ID = dv.NHOMDICHVU_ID        left join (select * from TT_VIENPHI where TIEPNHAN_ID = '27478') vp on dvyc.DVYEUCAU_ID = vp.REF_ID                 where        dvyc.TIEPNHAN_ID = 27478        and REF_TABLE = 'TT_DVYEUCAU'                 order by DVYEUCAU_ID desc]
2019-09-20 15:49:07,499 [1] DEBUG - Statement Id: [DAO00020_GetDanhsachVPCuaDichvuYeucau] PreparedStatement : [select V.*, CASE WHEN A.VIENPHI_ID IS NULL AND B.VIENPHI_ID IS NULL THEN '0' ELSE '1' END AS EXIST_HOADON_HUY,        dv.TENDICHVU, dv.MADICHVU, dv.NORESULT, ndv.MANHOMDICHVU, ndv.TENNHOMDICHVU        from TT_VIENPHI AS V        left join TM_DICHVU dv on V.DICHVU_ID = dv.DICHVU_ID and V.REF_TABLE = 'TT_DVYEUCAU'        left join TM_NHOMDICHVU ndv on ndv.NHOMDICHVU_ID = dv.NHOMDICHVU_ID        left join (select DISTINCT HD.VIENPHI_ID from TT_HOADON_CHITIET_NGOAITRU AS HD        inner join TT_HOADON AS H ON H.HOADON_ID = HD.HOADON_ID AND H.HUYHOADON = '1'        where H.TIEPNHAN_ID = '27478'        ) AS A ON A.VIENPHI_ID = V.VIENPHI_ID        left join (select DISTINCT HD.VIENPHI_ID from TT_HOADON_CHITIET_NOITRU AS HD        inner join TT_HOADON AS H ON H.HOADON_ID = HD.HOADON_ID AND H.HUYHOADON = '1'        where H.TIEPNHAN_ID = 27478                 ) AS B ON B.VIENPHI_ID = V.VIENPHI_ID                 where        V.TIEPNHAN_ID = 27478 and V.REF_TABLE = 'TT_DVYEUCAU']
2019-09-20 15:49:08,130 [1] DEBUG - Statement Id: [DAO00099_TT_CSKH_GOI_DANGKY_Service_GetList_01] PreparedStatement : [select GDV.*, GOI.TENGOI, GOI.LOAIGOI_ID from TT_CSKH_GOI_DANGKY GDV        left join TM_CSKH_GOI GOI on GOI.GOI_ID = GDV.GOI_ID        where LOAIGOI_ID in (select DICTIONARY_ID from LST_DICTIONARY where DICTIONARY_CODE = 'NgoaiTru'                              and DICTIONARY_TYPE_CODE = 'LoaiGoiDV')                 and             GDV.BENHNHAN_ID = '23423'           and             GDV.TRANGTHAI in ('DAKICHHOAT','FOLLOWUP')           and             GDV.BENHVIEN_ID = 'HLU01']
2019-09-20 15:49:08,629 [1] DEBUG - Statement Id: [DAO00085_GetDSDichVuThe] PreparedStatement : [select *        from TT_CSKH_THETHANHVIEN_SUDUNG        where THE_ID = '0'        and BENHVIEN_ID = 'HLU01']
2019-09-20 15:49:16,823 [1] DEBUG - Statement Id: [DAO00014_GetTotalChiPhiDVByTiepNhan] PreparedStatement : [select sum(THANHTIEN_DOANHTHU) as THANHTIEN_DOANHTHU from TT_VIENPHI        where ACTIVE = '1'        and TIEPNHAN_ID = '27478'        and REF_TABLE = 'TT_DVYEUCAU'        and exists (select DVYEUCAU_ID from TT_DVYEUCAU where HUYYEUCAU = '0' and TIEPNHAN_ID = '27478' and TT_VIENPHI.REF_ID = DVYEUCAU_ID)]
2019-09-20 15:49:22,046 [1] DEBUG - Statement Id: [DAO00020_ListKhoDuocOfPhongBan] PreparedStatement : [select B.* from TM_PHONGBAN_KHODUOC A        inner join TM_KHODUOC B on B.KHODUOC_ID = A.KHODUOC_ID        where        A.PHONGBAN_ID = ''        and A.BENHVIEN_ID = 'HLU01']
2019-09-20 15:49:22,100 [1] DEBUG - Statement Id: [DAO00020_ListKhoDuocOfPhongBan] PreparedStatement : [select B.* from TM_PHONGBAN_KHODUOC A        inner join TM_KHODUOC B on B.KHODUOC_ID = A.KHODUOC_ID        where        A.PHONGBAN_ID = '58'        and A.BENHVIEN_ID = 'HLU01']
2019-09-20 15:49:27,863 [1] DEBUG - Statement Id: [DAO00020_ListKhoDuocOfPhongBan] PreparedStatement : [select B.* from TM_PHONGBAN_KHODUOC A        inner join TM_KHODUOC B on B.KHODUOC_ID = A.KHODUOC_ID        where        A.PHONGBAN_ID = '79'        and A.BENHVIEN_ID = 'HLU01']
2019-09-20 15:49:28,028 [1] DEBUG - Statement Id: [DAO00008_UpdateUserIdPhongBanKhoDuoc] PreparedStatement : [IF EXISTS            (SELECT ACCOUNT_ID FROM TM_SYS_USERS WHERE ACCOUNT_ID =  @param0  and HOSPITAL_ID =  @param1 )            BEGIN            update TM_SYS_USERS set INVENTORY_ID =  @param2 , WORKING_DEPT_ID =  @param3             WHERE ACCOUNT_ID =  @param0  and HOSPITAL_ID =  @param1             END            ELSE            BEGIN            insert into TM_SYS_USERS ([ACCOUNT_ID], [ACCOUNT_NAME], [INVENTORY_ID], [WORKING_DEPT_ID], [HOSPITAL_ID])            values ( @param0 ,  @param4 ,  @param2 ,  @param3 ,  @param1 )            END]
2019-09-20 15:49:28,028 [1] DEBUG - Statement Id: [DAO00008_UpdateUserIdPhongBanKhoDuoc] Parameters: [@param0=[ACCOUNT_ID,113], @param1=[HOSPITAL_ID,HLU01], @param2=[INVENTORY_ID,11], @param3=[WORKING_DEPT_ID,79], @param4=[ACCOUNT_NAME,admin]]
2019-09-20 15:49:28,028 [1] DEBUG - Statement Id: [DAO00008_UpdateUserIdPhongBanKhoDuoc] Types: [@param0=[String, System.String], @param1=[String, System.String], @param2=[String, System.String], @param3=[String, System.String], @param4=[String, System.String]]
2019-09-20 15:49:32,051 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'RIS03'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2019-09-20 15:49:35,366 [1] DEBUG - Statement Id: [DAO00006_GetDSNhomDichVu] PreparedStatement : [select * from TM_NHOMDICHVU              where captren_id =              (select top (1) NHOMDICHVU_ID from TM_NHOMDICHVU where MANHOMDICHVU = '02')              and BENHVIEN_ID = 'HLU01']
2019-09-20 15:49:35,401 [1] DEBUG - Statement Id: [DAO00006_GetDSNhomDichVu] PreparedStatement : [select * from TM_NHOMDICHVU              where captren_id =              (select top (1) NHOMDICHVU_ID from TM_NHOMDICHVU where MANHOMDICHVU = '03')              and BENHVIEN_ID = 'HLU01']
2019-09-20 15:49:35,720 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'RIS30'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2019-09-20 15:49:35,901 [1] DEBUG - Statement Id: [DAO00019_DanhSachCDHA] PreparedStatement : [declare @TenBenhVien nvarchar(500)        declare @ManhomDSA varchar(10);        set @TenBenhVien = (select VALUE from TM_SYS_APPSETTINGS where CODE = 'APP_BENHVIEN_TEN')        select top 1  @ManhomDSA = VALUE from TM_SYS_APPSETTINGS where CODE = 'MANHOM_DICHVU_DSA'        select * from(        select ROW_NUMBER() OVER(order by NGAYGIOYEUCAU) as ROWNUMBER, *        from        (SELECT distinct        COUNT(*) OVER() as TOTALROWS,        N'Mã người bệnh: ' + bn.MAYTE + ' - ' + N'Tên người bệnh: ' + bn.TENBENHNHAN + ' - ' + N'Số bệnh án: ' + ISNULL(BA.SOBENHAN,'') + ' - ' + N'Sinh ngày: ' + isnull(Convert(varchar(10),bn.NGAYSINH,103),bn.NAMSINH) + ' - ' + N'Giới tính: ' + GD.DESCRIPTION as GROUPNAME,        bn.MAYTE, bn.TENBENHNHAN, bn.NAMSINH, bn.NGAYSINH as TUOI, ISNULL(CONVERT(VARCHAR(10), bn.NGAYSINH, 103),CAST(bn.NAMSINH AS varchar)) as NGAYSINH, bn.DIACHILIENLAC as DIACHI, bn.GIOITINH, GD.DESCRIPTION as TENGIOITINH,        tn.DOITUONG_ID, tn.THOIGIANTIEPNHAN, tn.BENHNHAN_ID, tn.TIEPNHAN_ID, tn.TRAITUYEN, tn.SOTIEPNHAN,        dv.DICHVU_ID, dv.NOITHUCHIEN_ID, isnull(dv.NGAYTAO, dv.NGAYCAPNHAT) as THOIGIANDKDICHVU,        dv.KHAN, dv.NOIYEUCAU_ID, dv.NGAYGIOYEUCAU, dv.BACSICHIDINH_ID, dv.DONVIGIOITHIEU_ID, dv.NGUOIGIOITHIEU_ID, dv.TRANGTHAI_WFL,        tn.NOIGIOITHIEU_ID, kbnt.HUONGGIAIQUYET_ID,        dv.DVYEUCAU_ID, dv.MARIS, dv.TRANGTHAI as TRANGTHAICODE, B.TENNHOMDICHVU, dv.SOPHIEUYEUCAU, dv.KHAMBENH_NGOAITRU_ID, dv.NGUOICAPNHAT_ID, dv.NGAYCAPNHAT,        CASE        WHEN @ManhomDSA is not null and B.MANHOMDICHVU in (@ManhomDSA) THEN B.MANHOMDICHVU        WHEN Left(B.MANHOMDICHVU,2) = '03' THEN '02' ELSE Left(B.MANHOMDICHVU,2) END AS MANHOMDICHVU, B.MANHOMDICHVU as MANHOMDICHVUCHITIET, tn.TRANGTHAI as TRANGTHAI_TIEPNHAN,        'False' as DAKHAM,        vp.DATHANHTOAN, vp.DONGIA_DOANHTHU, BA.SOBENHAN, dv.CHANDOAN        , a.TENDICHVU, nth.TENPHONGBAN as TENPHONGKHAM, nyc.TENPHONGBAN as TENKHOACHIDINH        , case when (dv.DONVIGIOITHIEU_ID is not null and dv.DONVIGIOITHIEU_ID != '') then ngt.TENBENHVIEN else @TenBenhVien end as TENBENHVIENCHIDINH        , case when (dv.BACSICHIDINH_ID is not null and dv.BACSICHIDINH_ID != '') then bscd.TENNHANVIEN else ngtt.TENNHANVIEN end as TENBACSICHIDINH          ,             0 as GUINGOAI, 0 as VTYT, 0 as CLSKETQUA_ID                   FROM TT_DVYEUCAU (NOLOCK) dv        inner join TT_TIEPNHAN (NOLOCK) tn on dv.TIEPNHAN_ID = tn.TIEPNHAN_ID        inner join TT_BENHNHAN (NOLOCK) bn on tn.BENHNHAN_ID = bn.BENHNHAN_ID        inner join TM_DICHVU A on A.DICHVU_ID = dv.DICHVU_ID        inner join TM_PHONGBAN nth on nth.PHONGBAN_ID = dv.NOITHUCHIEN_ID        left join TM_BENHVIEN ngt on ngt.BENHVIEN_STT_ID = dv.DONVIGIOITHIEU_ID        left join TM_NHANVIEN bscd on bscd.NHANVIEN_ID = dv.BACSICHIDINH_ID        left join TM_NHANVIEN ngtt on ngtt.NHANVIEN_ID = dv.NGUOIGIOITHIEU_ID        inner join TM_PHONGBAN nyc on nyc.PHONGBAN_ID = dv.NOIYEUCAU_ID        inner join TM_NHOMDICHVU B on B.NHOMDICHVU_ID = A.NHOMDICHVU_ID        inner join TT_VIENPHI (NOLOCK) VP on VP.TIEPNHAN_ID = tn.TIEPNHAN_ID and VP.DICHVU_ID = dv.DICHVU_ID and VP.REF_ID = dv.DVYEUCAU_ID        left join TT_NOITRU_BENHAN (NOLOCK) BA on BA.TIEPNHAN_ID = tn.TIEPNHAN_ID AND dv.BENHAN_ID = BA.BENHAN_ID        inner join TM_GENDER GD on GD.ID = bn.GIOITINH        left join TT_NGOAITRU_KHAMBENH (NOLOCK) kbnt on kbnt.KHAMBENH_ID = dv.KHAMBENH_NGOAITRU_ID                 where        dv.DICHVU_ID IS NOT NULL        and tn.BENHVIEN_ID = 'HLU01'        and HUYYEUCAU = 0        and dv.NGAYHENCLS is NULL                       and dv.TRANGTHAI = 'CHUAKETQUA'           and           dv.NGAYYEUCAU >= '9/20/2019 12:00:00 AM'         and           dv.NGAYYEUCAU <= '9/20/2019 12:00:00 AM'         and           dv.NOITHUCHIEN_ID = 79         and           (vp.DATHANHTOAN = '1'  or vp.DONGIA_DOANHTHU = '0' OR TN.SUDUNG_BHTN='1' OR TN.BAOLANH_VIENPHI='1'  OR tn.TRANGTHAI IN ('NOITRU','CAPCUU','NGOAITRU') or dv.HOPDONG_BENHNHAN_ID is not null or vp.BENHNHAN_PHAITHANHTOAN >= 0)         and           (CASE          WHEN @ManhomDSA is not null and B.MANHOMDICHVU in (@ManhomDSA) THEN B.MANHOMDICHVU          WHEN Left(B.MANHOMDICHVU,2) = '03' THEN '02' ELSE Left(B.MANHOMDICHVU,2) END) in (02)         and           tn.TRANGTHAI IN ('DATIEPNHAN','NOITRU','CAPCUU','NGOAITRU', 'HOANTHANH')                 ) data1) lst                    where          lst.ROWNUMBER between 1 and 20                 order by NGAYGIOYEUCAU asc]
2019-09-20 15:49:36,444 [1] DEBUG - Statement Id: [DAO00000_GetNhomDoiTuong] PreparedStatement : [SELECT DOITUONG_ID              ,[TENDOITUONG]              ,[NHOMDICHVU]              ,[TYLE_VUOT_LCB]              ,[GIOIHAN_VUOT_LCB]              ,[GIOIHAN_VUOT_DVKTC]              ,[TYLE_THUOC_UT]              ,[CPVC]              ,[CHIPHINGOAI_BHYT]              ,[NGANSACH_TL]              ,[MIENGIAM_TL]              ,[TAITRO_TL]              ,[BHTN_TL]              FROM [dbo].[TM_DOITUONG]]
2019-09-20 15:49:36,952 [1] DEBUG - Statement Id: [DAO00019_DanhSachCDHA] PreparedStatement : [declare @TenBenhVien nvarchar(500)        declare @ManhomDSA varchar(10);        set @TenBenhVien = (select VALUE from TM_SYS_APPSETTINGS where CODE = 'APP_BENHVIEN_TEN')        select top 1  @ManhomDSA = VALUE from TM_SYS_APPSETTINGS where CODE = 'MANHOM_DICHVU_DSA'        select * from(        select ROW_NUMBER() OVER(order by NGAYGIOYEUCAU) as ROWNUMBER, *        from        (SELECT distinct        COUNT(*) OVER() as TOTALROWS,        N'Mã người bệnh: ' + bn.MAYTE + ' - ' + N'Tên người bệnh: ' + bn.TENBENHNHAN + ' - ' + N'Số bệnh án: ' + ISNULL(BA.SOBENHAN,'') + ' - ' + N'Sinh ngày: ' + isnull(Convert(varchar(10),bn.NGAYSINH,103),bn.NAMSINH) + ' - ' + N'Giới tính: ' + GD.DESCRIPTION as GROUPNAME,        bn.MAYTE, bn.TENBENHNHAN, bn.NAMSINH, bn.NGAYSINH as TUOI, ISNULL(CONVERT(VARCHAR(10), bn.NGAYSINH, 103),CAST(bn.NAMSINH AS varchar)) as NGAYSINH, bn.DIACHILIENLAC as DIACHI, bn.GIOITINH, GD.DESCRIPTION as TENGIOITINH,        tn.DOITUONG_ID, tn.THOIGIANTIEPNHAN, tn.BENHNHAN_ID, tn.TIEPNHAN_ID, tn.TRAITUYEN, tn.SOTIEPNHAN,        dv.DICHVU_ID, dv.NOITHUCHIEN_ID, isnull(dv.NGAYTAO, dv.NGAYCAPNHAT) as THOIGIANDKDICHVU,        dv.KHAN, dv.NOIYEUCAU_ID, dv.NGAYGIOYEUCAU, dv.BACSICHIDINH_ID, dv.DONVIGIOITHIEU_ID, dv.NGUOIGIOITHIEU_ID, dv.TRANGTHAI_WFL,        tn.NOIGIOITHIEU_ID, kbnt.HUONGGIAIQUYET_ID,        dv.DVYEUCAU_ID, dv.MARIS, dv.TRANGTHAI as TRANGTHAICODE, B.TENNHOMDICHVU, dv.SOPHIEUYEUCAU, dv.KHAMBENH_NGOAITRU_ID, dv.NGUOICAPNHAT_ID, dv.NGAYCAPNHAT,        CASE        WHEN @ManhomDSA is not null and B.MANHOMDICHVU in (@ManhomDSA) THEN B.MANHOMDICHVU        WHEN Left(B.MANHOMDICHVU,2) = '03' THEN '02' ELSE Left(B.MANHOMDICHVU,2) END AS MANHOMDICHVU, B.MANHOMDICHVU as MANHOMDICHVUCHITIET, tn.TRANGTHAI as TRANGTHAI_TIEPNHAN,        'False' as DAKHAM,        vp.DATHANHTOAN, vp.DONGIA_DOANHTHU, BA.SOBENHAN, dv.CHANDOAN        , a.TENDICHVU, nth.TENPHONGBAN as TENPHONGKHAM, nyc.TENPHONGBAN as TENKHOACHIDINH        , case when (dv.DONVIGIOITHIEU_ID is not null and dv.DONVIGIOITHIEU_ID != '') then ngt.TENBENHVIEN else @TenBenhVien end as TENBENHVIENCHIDINH        , case when (dv.BACSICHIDINH_ID is not null and dv.BACSICHIDINH_ID != '') then bscd.TENNHANVIEN else ngtt.TENNHANVIEN end as TENBACSICHIDINH          ,             0 as GUINGOAI, 0 as VTYT, 0 as CLSKETQUA_ID                   FROM TT_DVYEUCAU (NOLOCK) dv        inner join TT_TIEPNHAN (NOLOCK) tn on dv.TIEPNHAN_ID = tn.TIEPNHAN_ID        inner join TT_BENHNHAN (NOLOCK) bn on tn.BENHNHAN_ID = bn.BENHNHAN_ID        inner join TM_DICHVU A on A.DICHVU_ID = dv.DICHVU_ID        inner join TM_PHONGBAN nth on nth.PHONGBAN_ID = dv.NOITHUCHIEN_ID        left join TM_BENHVIEN ngt on ngt.BENHVIEN_STT_ID = dv.DONVIGIOITHIEU_ID        left join TM_NHANVIEN bscd on bscd.NHANVIEN_ID = dv.BACSICHIDINH_ID        left join TM_NHANVIEN ngtt on ngtt.NHANVIEN_ID = dv.NGUOIGIOITHIEU_ID        inner join TM_PHONGBAN nyc on nyc.PHONGBAN_ID = dv.NOIYEUCAU_ID        inner join TM_NHOMDICHVU B on B.NHOMDICHVU_ID = A.NHOMDICHVU_ID        inner join TT_VIENPHI (NOLOCK) VP on VP.TIEPNHAN_ID = tn.TIEPNHAN_ID and VP.DICHVU_ID = dv.DICHVU_ID and VP.REF_ID = dv.DVYEUCAU_ID        left join TT_NOITRU_BENHAN (NOLOCK) BA on BA.TIEPNHAN_ID = tn.TIEPNHAN_ID AND dv.BENHAN_ID = BA.BENHAN_ID        inner join TM_GENDER GD on GD.ID = bn.GIOITINH        left join TT_NGOAITRU_KHAMBENH (NOLOCK) kbnt on kbnt.KHAMBENH_ID = dv.KHAMBENH_NGOAITRU_ID                 where        dv.DICHVU_ID IS NOT NULL        and tn.BENHVIEN_ID = 'HLU01'        and HUYYEUCAU = 0        and dv.NGAYHENCLS is NULL                       and dv.TRANGTHAI = 'CHUAKETQUA'           and           dv.NGAYYEUCAU >= '9/20/2019 12:00:00 AM'         and           dv.NGAYYEUCAU <= '9/20/2019 12:00:00 AM'         and           dv.NOITHUCHIEN_ID = 79         and           (vp.DATHANHTOAN = '1'  or vp.DONGIA_DOANHTHU = '0' OR TN.SUDUNG_BHTN='1' OR TN.BAOLANH_VIENPHI='1'  OR tn.TRANGTHAI IN ('NOITRU','CAPCUU','NGOAITRU') or dv.HOPDONG_BENHNHAN_ID is not null or vp.BENHNHAN_PHAITHANHTOAN >= 0)         and           (CASE          WHEN @ManhomDSA is not null and B.MANHOMDICHVU in (@ManhomDSA) THEN B.MANHOMDICHVU          WHEN Left(B.MANHOMDICHVU,2) = '03' THEN '02' ELSE Left(B.MANHOMDICHVU,2) END) in (02)         and           tn.TRANGTHAI IN ('DATIEPNHAN','NOITRU','CAPCUU','NGOAITRU', 'HOANTHANH')                 ) data1) lst                    where          lst.ROWNUMBER between 1 and 20                 order by NGAYGIOYEUCAU asc]
2019-09-20 15:49:38,786 [1] DEBUG - Statement Id: [DAO00019_ThongTinBenhNhanDvYeuCau] PreparedStatement : [select distinct A.SOTIEPNHAN, A.TIEPNHAN_ID, A.DOITUONG_ID, A.TRANGTHAI,        A.LOAITHANHVIEN_ID, A.SUDUNG_BHTN, A.THE_ID, A.THANHVIEN_ID, A.VIP, A.NGUON_BENHNHAN_ID, A.BAOLANH_VIENPHI, A.NGAYMIENDONGCHITRA,        B.*,  C.DICHVU_ID, C.DVYEUCAU_ID, C.NOITHUCHIEN_ID, A.SOBHYT        from TT_TIEPNHAN A        inner join TT_DVYEUCAU C on C.TIEPNHAN_ID = A.TIEPNHAN_ID        inner join TT_BENHNHAN B on B.BENHNHAN_ID = A.BENHNHAN_ID and B.ACTIVE = '1'        where                    C.DVYEUCAU_ID = '205441'                 and A.BENHVIEN_ID = 'HLU01']
2019-09-20 15:49:39,099 [1] DEBUG - Statement Id: [DAO00066_GetBENHAN_TIEPNHAN] PreparedStatement : [select top 1 *        from TT_NOITRU_BENHAN        where TIEPNHAN_ID = '27478'  and BENHVIEN_ID = 'HLU01'        order by NGAYTAO desc]
2019-09-20 15:49:39,244 [1] DEBUG - Statement Id: [DAO00046_GETLISTDVYEUCAUINLISTDVID] PreparedStatement : [SELECT dvyc.*, clskqct.CLSKETQUA_ID, clskqct.DICHVU_ID as KETQUA_DICHVU_ID,        clskqct.CLSKETQUACHITIET_ID, clskqct.DONVITINH, clskqct.KETQUA, clskqct.KETQUA2,        clskqct.MUCBINHTHUONG, clskqct.MUCBINHTHUONGMIN, clskqct.MUCBINHTHUONGMAX, clskqct.BATTHUONG        FROM dbo.TT_CLSKETQUACHITIET as clskqct RIGHT OUTER JOIN        dbo.TT_DVYEUCAU as dvyc ON                 clskqct.DVYEUCAU_ID = dvyc.DVYEUCAU_ID        where dvyc.BENHVIEN_ID = 'HLU01'          and             exists (select DICHVU_ID from TM_DICHVU a join TM_NHOMDICHVU b on a.NHOMDICHVU_ID = b.NHOMDICHVU_ID            where dvyc.DICHVU_ID = DICHVU_ID and (left(MANHOMDICHVU,2) in ('02', '03') OR MANHOMDICHVU in ('02', '03')))           and             dvyc.TIEPNHAN_ID =  @param0                    order by DVYEUCAU_ID]
2019-09-20 15:49:39,244 [1] DEBUG - Statement Id: [DAO00046_GETLISTDVYEUCAUINLISTDVID] Parameters: [@param0=[TIEPNHAN_ID,27478]]
2019-09-20 15:49:39,244 [1] DEBUG - Statement Id: [DAO00046_GETLISTDVYEUCAUINLISTDVID] Types: [@param0=[Int64, System.Int64]]
2019-09-20 15:49:39,302 [1] DEBUG - Statement Id: [DAO00045_GetListDVYeuCau] PreparedStatement : [select *              from VIEW_DICHVU_NHOMDV              where BENHVIEN_ID = 'HLU01']
2019-09-20 15:49:40,915 [1] DEBUG - Statement Id: [DAO00018_GetList] PreparedStatement : [select A.*, B.DICTIONARY_NAME, B.DICTIONARY_CODE, B.DICTIONARY_NAME_EN CHUCDANH, (B.DICTIONARY_NAME_EN + '. ' + A.TENNHANVIEN) TENHOCVIHOCHAM            from TM_NHANVIEN A            left join (select * from LST_DICTIONARY where DICTIONARY_TYPE_CODE = 'chucdanh' and DICTIONARY_NAME_EN is not null) B on A.CHUCDANH_ID = B.DICTIONARY_ID            where A.BENHVIEN_ID = '' and A.TAMNGUNG = '0']
2019-09-20 15:49:40,953 [1] DEBUG - Statement Id: [DAO00066_GetBENHAN_TIEPNHAN] PreparedStatement : [select top 1 *        from TT_NOITRU_BENHAN        where TIEPNHAN_ID = '27478'  and BENHVIEN_ID = 'HLU01'        order by NGAYTAO desc]
2019-09-20 15:49:41,068 [1] DEBUG - Statement Id: [DAO00009_TT_TIEPNHAN_GetProcess] PreparedStatement : [select PROCESS_ID from TT_TIEPNHAN where SOTIEPNHAN = 'TN190920.0000001']
2019-09-20 15:49:41,166 [1] DEBUG - Statement Id: [DAOWF004_laytrangthaiDV] PreparedStatement : [select top 1 A.CURR_STATE_CODE as STATE_CODE, isNull(C.SHORT_NAME,C.NAME) as TRANGTHAI, C.NAME as TRANGTHAI_CHITIET, C.STATUS_CODE, D.ISACTIVE as ACTIVE, E.STATUS_CODE  as OLD_STATUSCODE        from TT_REQUEST_SERVICE_DETAIL A                left join (select * from TT_REQUEST_SERVICE where PARA = '{"DICHVU_ID":"4145","DVYEUCAU_ID":"205441"}') D on D.ID = A.REQUEST_SERVICE_ID        left join TM_STATE C on A.CURR_STATE_CODE = C.STATE_CODE and C.PROCESS_CODE = D.PROCESS_CODE        left join TM_STATE E on A.OLD_STATE_CODE = E.STATE_CODE and E.PROCESS_CODE = D.PROCESS_CODE        where        A.REQUEST_SERVICE_ID = (select top 1 ID from TT_REQUEST_SERVICE where PARA = '{"DICHVU_ID":"4145","DVYEUCAU_ID":"205441"}' order by ID desc)        order by A.ID desc]
2019-09-20 15:49:41,263 [1] DEBUG - Statement Id: [DAO00116_GetListThietBiCLS] PreparedStatement : [SELECT THIETBI_ID, MATHIETBI, TENTHIETBI, NHOMTHIETBI_ID          FROM TM_THIETBI MP          where          TAMNGUNG = '0'          and BENHVIEN_ID = 'HLU01'           AND             PHONGBAN_ID = 79                     order by TENTHIETBI]
2019-09-20 15:49:41,308 [1] DEBUG - Statement Id: [DAO00037_GetCLSKetQua] PreparedStatement : [select *              from TT_CLSKETQUA               where                             TT_CLSKETQUA.DVYEUCAU_ID = '205441'                       and                           TT_CLSKETQUA.BENHVIEN_ID = 'HLU01'                                     order by CLSKETQUA_ID]
2019-09-20 15:49:41,417 [1] DEBUG - Statement Id: [DAO00020_GetDetailP] PreparedStatement : [select *        from TT_DVYEUCAU        where TT_DVYEUCAU.DVYEUCAU_ID  = 205441        order by DVYEUCAU_ID]
2019-09-20 15:49:41,559 [1] DEBUG - Statement Id: [DAO00017_GetNameByID] PreparedStatement : [select TENPHONGBAN              from [TM_PHONGBAN]              where PHONGBAN_ID = '58' and BENHVIEN_ID = 'HLU01']
2019-09-20 15:49:43,765 [1] DEBUG - Statement Id: [DAO00041_GetNameByID] PreparedStatement : [select TENDICHVU              from TM_DICHVU              where DICHVU_ID = '4145']
2019-09-20 15:49:43,927 [1] DEBUG - Statement Id: [DAO00042_GetList] PreparedStatement : [select *              from TM_TUDIENKETQUA              where BENHVIEN_ID = 'HLU01'                and                       TM_TUDIENKETQUA.DICHVU_ID = '4145'                    and                       (TM_TUDIENKETQUA.NGUOITAO_ID = '1' OR TM_TUDIENKETQUA.SUDUNGCHUNG = '1')                                 order by TM_TUDIENKETQUA.TENNOIDUNG]
2019-09-20 15:49:44,463 [1] DEBUG - Statement Id: [DAO00066_GetBENHAN_TIEPNHAN] PreparedStatement : [select top 1 *        from TT_NOITRU_BENHAN        where TIEPNHAN_ID = '27478'  and BENHVIEN_ID = 'HLU01'        order by NGAYTAO desc]
2019-09-20 15:49:44,644 [1] DEBUG - Statement Id: [DAO00037_GetCLSKetQua] PreparedStatement : [select *              from TT_CLSKETQUA               where                             TT_CLSKETQUA.DVYEUCAU_ID = '205441'                       and                           TT_CLSKETQUA.BENHVIEN_ID = 'HLU01'                                     order by CLSKETQUA_ID]
2019-09-20 15:49:44,742 [1] DEBUG - Statement Id: [DAO00020_GetDetailP] PreparedStatement : [select *        from TT_DVYEUCAU        where TT_DVYEUCAU.DVYEUCAU_ID  = 205441        order by DVYEUCAU_ID]
2019-09-20 15:49:44,861 [1] DEBUG - Statement Id: [DAO00017_GetNameByID] PreparedStatement : [select TENPHONGBAN              from [TM_PHONGBAN]              where PHONGBAN_ID = '58' and BENHVIEN_ID = 'HLU01']
2019-09-20 15:49:45,279 [1] DEBUG - Statement Id: [DAO00041_GetNameByID] PreparedStatement : [select TENDICHVU              from TM_DICHVU              where DICHVU_ID = '4145']
2019-09-20 15:49:45,389 [1] DEBUG - Statement Id: [DAO00042_GetList] PreparedStatement : [select *              from TM_TUDIENKETQUA              where BENHVIEN_ID = 'HLU01'                and                       TM_TUDIENKETQUA.DICHVU_ID = '4145'                    and                       (TM_TUDIENKETQUA.NGUOITAO_ID = '1' OR TM_TUDIENKETQUA.SUDUNGCHUNG = '1')                                 order by TM_TUDIENKETQUA.TENNOIDUNG]
2019-09-20 15:49:46,459 [1] DEBUG - Statement Id: [DAO00066_GetBENHAN_TIEPNHAN] PreparedStatement : [select top 1 *        from TT_NOITRU_BENHAN        where TIEPNHAN_ID = '27478'  and BENHVIEN_ID = 'HLU01'        order by NGAYTAO desc]
2019-09-20 15:50:11,458 [1] DEBUG - Statement Id: [DAO00066_GetBENHAN_TIEPNHAN] PreparedStatement : [select top 1 *        from TT_NOITRU_BENHAN        where TIEPNHAN_ID = '27478'  and BENHVIEN_ID = 'HLU01'        order by NGAYTAO desc]
2019-09-20 15:50:11,693 [1] DEBUG - Statement Id: [DAO00014_GetPatientStatus] PreparedStatement : [select        CASE        when tn.TRANGTHAI = 'HOANTHANH' Then tn.TRANGTHAI        WHEN xncp.XACNHANCHIPHI_ID is not null THEN 'XACNHANCHIPHI'        WHEN (tn.KHOADULIEU = '1') THEN 'KHOADULIEU'        ELSE tn.TRANGTHAI        END        as TRANGTHAI        from TT_TIEPNHAN tn        left join TT_XACNHANCHIPHI xncp on tn.TIEPNHAN_ID = xncp.TIEPNHAN_ID        where tn.TIEPNHAN_ID = '27478'        and tn.BENHVIEN_ID = 'HLU01']
2019-09-20 15:50:12,374 [1] DEBUG - Statement Id: [DAO00037_GetSoLuotBacSiCLSTraLoiKQ] PreparedStatement : [select count(1) AS SOLUONG          from TT_CLSKETQUA KQ          left join TT_DVYEUCAU YC on YC.DVYEUCAU_ID = KQ.DVYEUCAU_ID and YC.BENHVIEN_ID = KQ.BENHVIEN_ID          left join TM_DICHVU DV on DV.DICHVU_ID = YC.DICHVU_ID and DV.BENHVIEN_ID = YC.BENHVIEN_ID          left join TT_TIEPNHAN TN on TN.TIEPNHAN_ID = KQ.TIEPNHAN_ID          where DV.BHYT = '1' and YC.BHYTDONGTIEN = '0' and TN.SOBHYT IS NOT NULL and TN.SOBHYT != ''          and KQ.BACSIKETLUAN_ID = 373          and KQ.BENHVIEN_ID = 'HLU01'          and KQ.NGAYTHUCHIEN = '9/20/2019 12:00:00 AM']
2019-09-20 15:50:12,666 [1] DEBUG - Statement Id: [DAO00037_KiemTraTrangThaiYeuCau] PreparedStatement : [IF EXISTS (          select DVYEUCAU_ID          from TT_DVYEUCAU          where DVYEUCAU_ID = 205441          and BENHVIEN_ID = 'HLU01'          and HUYYEUCAU = 0          )          BEGIN          SELECT -1 AS RESULT          END          ELSE          BEGIN          SELECT 1 AS RESULT          END]
2019-09-20 15:50:12,796 [1] DEBUG - Statement Id: [DAO00020_KiemTraMaRIS] PreparedStatement : [select * from LST_KEYDATA        where KEYTYPE = 'RISID'        and KEYYEAR = '2019'        and KEYMONTH = '9'        and KEYDAY = '20'        and SEGMENT_1 = 'MR'        and KEYVALUE >= '']
2019-09-20 15:50:12,880 [1] DEBUG - Statement Id: [DAO00020_CapNhatMaRIS] PreparedStatement : [update LST_KEYDATA        set KEYVALUE = ''        where KEYTYPE = 'RISID'        and KEYYEAR = '2019'        and KEYMONTH = '9'        and KEYDAY = '20'        and SEGMENT_1 = 'MR']
2019-09-20 15:50:12,977 [1] DEBUG - Statement Id: [DAO00020_CapMaRIS] PreparedStatement : [update TT_DVYEUCAU set        MARIS =  @param0         , NGUOICAPNHAT_ID =  @param1         , NGAYCAPNHAT =  @param2         where        DVYEUCAU_ID = 205441]
2019-09-20 15:50:12,977 [1] DEBUG - Statement Id: [DAO00020_CapMaRIS] Parameters: [@param0=[MARIS,], @param1=[NGUOICAPNHAT_ID,1], @param2=[NGAYCAPNHAT,9/20/2019 3:50:12 PM]]
2019-09-20 15:50:12,977 [1] DEBUG - Statement Id: [DAO00020_CapMaRIS] Types: [@param0=[String, System.String], @param1=[Int64, System.Int64], @param2=[DateTime, System.DateTime]]
2019-09-20 15:50:13,026 [1] DEBUG - Statement Id: [DAO00037_Add] PreparedStatement : [insert into TT_CLSKETQUA (              SOPHIEUXETNGHIEM              , TIEPNHAN_ID              , BENHAN_ID              , LUUTRU_ID                             , DVYEUCAU_ID              , DICHVU_ID              , NHOMDICHVU_ID              , NGAYTHUCHIEN              , THOIGIANTHUCHIEN              , NGAYGIOTHUCHIEN              , GIOTHUCHIEN              , NAMTHUCHIEN              , THANGTHUCHIEN              , NOITHUCHIEN_ID              , BACSICHIDINH_ID              , BACSICHIDINH              , NGAYCHIDINH              , BACSITHUCHIEN_ID              , BACSIKETLUAN_ID              , BACSIGMHS_ID              , DIEUDUONG_ID              , KYTHUATVIEN01_ID              , KYTHUATVIEN02_ID              , CHANDOANLAMSANG              , DENGHI              , SINHTHIET              , CLOTEST              , PHOTO              , VIDEO              , TIEMCANQUANG              , PHANLOAIKETQUA_ID              , THUCHIENBENNGOAI              , BENHVIENTHUCHIEN_ID              , TENBACSIBENNGOAI              , KHOABENNGOAI_ID              , GUINGOAI              , NOIGUIDEN_ID              , ICD_ID1              , ICD_ID2              , ICD_ID3              , DIUNGTHUOC              , TIENME              , DACBIET              , KQCUOICUNG              , THONGTINNHAN              , KETLUANKSK              , VUNGKHAOSAT              , MOTA              , MOTA_TEXT              , KETLUAN              , GHICHU              , MAPHIM              , GPB_AMSO              , GPB_PHANLOAIKETQUA_ID              , GPB_PHUONGPHAPLAYBENHPHAM_ID              , GPB_SOMAU              , GPB_SOLUONGMAU              , GPB_TOPO_ID              , GPB_TOPOREGIONS_ID              , GPB_MORPHO_ID              , GPB_ETIO_ID              , GPB_DAITHE              , GPB_VITHE              , GPB_NHUOM_HE              , GPB_NHUOM_PAS              , GPB_NHUOM_TRI              , GPB_NHUOM_AFB              , GPB_NHUOM_GIEMSA              , GPB_NHUOM_PAPANICOLAOU              , GPB_NHUOM_RETICULINE              , GPB_NHUOM_OTHER              , GPB_HOAMIENDICH              , GPB_HOAMIENDICHHUYNHQUANG              , GPB_HOICHAN              , GPB_MAUTHU              , GPB_NOILAYMAUTHU              , HLVIKHUAN1              , HLVIKHUAN2              , LOAIFILM_ID              , SOPHIMSUDUNG              , THIETBI_ID              , SOTHUOCSUDUNG              , KHOADULIEU              , NGAYKHOADULIEU              , THOIGIANKHOADULIEU              , NGUOIKHOA_ID              , MANGUOIKHOA              , TENNGUOIKHOA              , TRANGTHAI              , MACH              , HUYETAP              , NHIPTHO              , NHIETDO              , CHIEUCAO              , CANNANG              , BSA              , TINHTRANGDIENNAO              , SOVAOVIEN              , MAYTE              , TENBENHNHAN              , NAMSINH              , GIOITINH              , DIACHI              , NOICHIDINH_ID              , MAUTHU_ID              , THOIGIANNHAN              , MAU              , LOAITHUOCCANQUANG_ID              , MA              , IDHINH              , SOPHIMHU              , LOAIPHIMHU_ID              , DOSOI              , DOSOI_ID              , BANKINHSOI              , SODT              , KYTHUAT              , KYTHUAT_TEXT              , SOPHIMSUDUNG2              , LOAIFILM_ID2              , SOPHIMSUDUNG3              , LOAIFILM_ID3              , RESISTANCEMARKERS              , BENHVIEN_ID              , NGAYTAO              , NGUOITAO_ID              , NGAYCAPNHAT              , NGUOICAPNHAT_ID              , SOLUONGONG              , SOMLMAU              , THOIGIANLAYMAU              , THOIGIANNHANMAU              , THOIGIANCDBENHPHAM              , DUNGDICHCD_ID              , SOONGTHUCNHAN              , THUOCDADUNG              , NGAYGANMAY              , NGAYTHAOMAY              , LOAIMAUBENHPHAM              ) values (               @param0               ,  @param1               ,  @param2               ,  @param3                            ,  @param4             ,  @param5             ,  @param6             ,  @param7             ,  @param8             ,  @param9             ,  @param10             ,  @param11             ,  @param12             ,  @param13             ,  @param14             ,  @param15             ,  @param16             ,  @param17             ,  @param18             ,  @param19             ,  @param20             ,  @param21             ,  @param22             ,  @param23             ,  @param24             ,  @param25             ,  @param26             ,  @param27             ,  @param28             ,  @param29             ,  @param30             ,  @param31             ,  @param32             ,  @param33             ,  @param34             ,  @param35             ,  @param36             ,  @param37             ,  @param38             ,  @param39             ,  @param40             ,  @param41             ,  @param42             ,  @param43             ,  @param44             ,  @param45             ,  @param46             ,  @param47             ,  @param48             ,  @param49             ,  @param50             ,  @param51             ,  @param52             ,  @param53             ,  @param54             ,  @param55             ,  @param56             ,  @param57             ,  @param58             ,  @param59             ,  @param60             ,  @param61             ,  @param62             ,  @param63             ,  @param64             ,  @param65             ,  @param66             ,  @param67             ,  @param68             ,  @param69             ,  @param70             ,  @param71             ,  @param72             ,  @param73             ,  @param74             ,  @param75             ,  @param76             ,  @param77             ,  @param78             ,  @param79             ,  @param80             ,  @param81             ,  @param82             ,  @param83             ,  @param84             ,  @param85             ,  @param86             ,  @param87             ,  @param88             ,  @param89             ,  @param90             ,  @param91             ,  @param92             ,  @param93             ,  @param94             ,  @param95             ,  @param96             ,  @param97             ,  @param98             ,  @param99             ,  @param100             ,  @param101             ,  @param102             ,  @param103             ,  @param104             ,  @param105             ,  @param106             ,  @param107             ,  @param108             ,  @param109             ,  @param110             ,  @param111             ,  @param112             ,  @param113             ,  @param114             ,  @param115             ,  @param116             ,  @param117             ,  @param118             ,  @param119             ,  @param120             ,  @param121             ,  @param122             ,  @param123             ,  @param124             ,  @param125             ,  @param126             ,  @param127             ,  @param128             ,  @param129             ,  @param130             ,  @param131             ,  @param132             ,  @param133             ,  @param134             ,  @param135             ,  @param136             ,  @param137             ,  @param138             )            SELECT SCOPE_IDENTITY()]
2019-09-20 15:50:13,026 [1] DEBUG - Statement Id: [DAO00037_Add] Parameters: [@param0=[SOPHIEUXETNGHIEM,null], @param1=[TIEPNHAN_ID,27478], @param2=[BENHAN_ID,null], @param3=[LUUTRU_ID,null], @param4=[DVYEUCAU_ID,205441], @param5=[DICHVU_ID,4145], @param6=[NHOMDICHVU_ID,18], @param7=[NGAYTHUCHIEN,9/20/2019 12:00:00 AM], @param8=[THOIGIANTHUCHIEN,9/20/2019 5:49:45 PM], @param9=[NGAYGIOTHUCHIEN,9/20/2019 5:49:45 PM], @param10=[GIOTHUCHIEN,0], @param11=[NAMTHUCHIEN,0], @param12=[THANGTHUCHIEN,0], @param13=[NOITHUCHIEN_ID,79], @param14=[BACSICHIDINH_ID,1], @param15=[BACSICHIDINH,], @param16=[NGAYCHIDINH,9/20/2019 5:47:24 PM], @param17=[BACSITHUCHIEN_ID,1], @param18=[BACSIKETLUAN_ID,373], @param19=[BACSIGMHS_ID,null], @param20=[DIEUDUONG_ID,null], @param21=[KYTHUATVIEN01_ID,null], @param22=[KYTHUATVIEN02_ID,null], @param23=[CHANDOANLAMSANG,Viêm phế quản cấp(J20)], @param24=[DENGHI,null], @param25=[SINHTHIET,0], @param26=[CLOTEST,0], @param27=[PHOTO,0], @param28=[VIDEO,0], @param29=[TIEMCANQUANG,0], @param30=[PHANLOAIKETQUA_ID,null], @param31=[THUCHIENBENNGOAI,0], @param32=[BENHVIENTHUCHIEN_ID,null], @param33=[TENBACSIBENNGOAI,], @param34=[KHOABENNGOAI_ID,null], @param35=[GUINGOAI,0], @param36=[NOIGUIDEN_ID,null], @param37=[ICD_ID1,null], @param38=[ICD_ID2,null], @param39=[ICD_ID3,null], @param40=[DIUNGTHUOC,0], @param41=[TIENME,0], @param42=[DACBIET,0], @param43=[KQCUOICUNG,0], @param44=[THONGTINNHAN,null], @param45=[KETLUANKSK,null], @param46=[VUNGKHAOSAT,null], @param47=[MOTA,<body>
	<div style="text-align:left;text-indent:0pt;margin:0pt 0pt 0pt 0pt;"><span style="color:#000000;background-color:transparent;font-family:Times New Roman;font-size:12pt;font-weight:normal;font-style:normal;">test</span></div></body>
], @param48=[MOTA_TEXT,null], @param49=[KETLUAN,test], @param50=[GHICHU,test 1], @param51=[MAPHIM,null], @param52=[GPB_AMSO,null], @param53=[GPB_PHANLOAIKETQUA_ID,null], @param54=[GPB_PHUONGPHAPLAYBENHPHAM_ID,null], @param55=[GPB_SOMAU,null], @param56=[GPB_SOLUONGMAU,null], @param57=[GPB_TOPO_ID,null], @param58=[GPB_TOPOREGIONS_ID,null], @param59=[GPB_MORPHO_ID,null], @param60=[GPB_ETIO_ID,null], @param61=[GPB_DAITHE,null], @param62=[GPB_VITHE,null], @param63=[GPB_NHUOM_HE,0], @param64=[GPB_NHUOM_PAS,0], @param65=[GPB_NHUOM_TRI,0], @param66=[GPB_NHUOM_AFB,0], @param67=[GPB_NHUOM_GIEMSA,0], @param68=[GPB_NHUOM_PAPANICOLAOU,null], @param69=[GPB_NHUOM_RETICULINE,null], @param70=[GPB_NHUOM_OTHER,0], @param71=[GPB_HOAMIENDICH,0], @param72=[GPB_HOAMIENDICHHUYNHQUANG,0], @param73=[GPB_HOICHAN,0], @param74=[GPB_MAUTHU,null], @param75=[GPB_NOILAYMAUTHU,null], @param76=[HLVIKHUAN1,null], @param77=[HLVIKHUAN2,null], @param78=[LOAIFILM_ID,null], @param79=[SOPHIMSUDUNG,null], @param80=[THIETBI_ID,null], @param81=[SOTHUOCSUDUNG,null], @param82=[KHOADULIEU,0], @param83=[NGAYKHOADULIEU,null], @param84=[THOIGIANKHOADULIEU,null], @param85=[NGUOIKHOA_ID,null], @param86=[MANGUOIKHOA,null], @param87=[TENNGUOIKHOA,null], @param88=[TRANGTHAI,CHOXACNHAN], @param89=[MACH,null], @param90=[HUYETAP,null], @param91=[NHIPTHO,null], @param92=[NHIETDO,null], @param93=[CHIEUCAO,null], @param94=[CANNANG,null], @param95=[BSA,null], @param96=[TINHTRANGDIENNAO,null], @param97=[SOVAOVIEN,null], @param98=[MAYTE,null], @param99=[TENBENHNHAN,null], @param100=[NAMSINH,null], @param101=[GIOITINH,0], @param102=[DIACHI,null], @param103=[NOICHIDINH_ID,58], @param104=[MAUTHU_ID,null], @param105=[THOIGIANNHAN,null], @param106=[MAU,null], @param107=[LOAITHUOCCANQUANG_ID,null], @param108=[MA,null], @param109=[IDHINH,null], @param110=[SOPHIMHU,null], @param111=[LOAIPHIMHU_ID,null], @param112=[DOSOI,null], @param113=[DOSOI_ID,null], @param114=[BANKINHSOI,null], @param115=[SODT,null], @param116=[KYTHUAT,null], @param117=[KYTHUAT_TEXT,null], @param118=[SOPHIMSUDUNG2,null], @param119=[LOAIFILM_ID2,null], @param120=[SOPHIMSUDUNG3,null], @param121=[LOAIFILM_ID3,null], @param122=[RESISTANCEMARKERS,null], @param123=[BENHVIEN_ID,HLU01], @param124=[NGAYTAO,9/20/2019 3:50:13 PM], @param125=[NGUOITAO_ID,1], @param126=[NGAYCAPNHAT,9/20/2019 3:50:13 PM], @param127=[NGUOICAPNHAT_ID,1], @param128=[SOLUONGONG,null], @param129=[SOMLMAU,null], @param130=[THOIGIANLAYMAU,null], @param131=[THOIGIANNHANMAU,null], @param132=[THOIGIANCDBENHPHAM,null], @param133=[DUNGDICHCD_ID,null], @param134=[SOONGTHUCNHAN,null], @param135=[THUOCDADUNG,null], @param136=[NGAYGANMAY,null], @param137=[NGAYTHAOMAY,null], @param138=[LOAIMAUBENHPHAM,null]]
2019-09-20 15:50:13,026 [1] DEBUG - Statement Id: [DAO00037_Add] Types: [@param0=[System.DBNull, null], @param1=[Int64, System.Int64], @param2=[System.DBNull, null], @param3=[System.DBNull, null], @param4=[Int64, System.Int64], @param5=[Int64, System.Int64], @param6=[Int64, System.Int64], @param7=[DateTime, System.DateTime], @param8=[DateTime, System.DateTime], @param9=[DateTime, System.DateTime], @param10=[Int64, System.Int64], @param11=[Int64, System.Int64], @param12=[Int64, System.Int64], @param13=[Int64, System.Int64], @param14=[Int64, System.Int64], @param15=[String, System.String], @param16=[DateTime, System.DateTime], @param17=[Int64, System.Int64], @param18=[Int64, System.Int64], @param19=[System.DBNull, null], @param20=[System.DBNull, null], @param21=[System.DBNull, null], @param22=[System.DBNull, null], @param23=[String, System.String], @param24=[System.DBNull, null], @param25=[String, System.String], @param26=[String, System.String], @param27=[String, System.String], @param28=[String, System.String], @param29=[String, System.String], @param30=[System.DBNull, null], @param31=[String, System.String], @param32=[System.DBNull, null], @param33=[String, System.String], @param34=[System.DBNull, null], @param35=[String, System.String], @param36=[System.DBNull, null], @param37=[System.DBNull, null], @param38=[System.DBNull, null], @param39=[System.DBNull, null], @param40=[String, System.String], @param41=[String, System.String], @param42=[String, System.String], @param43=[String, System.String], @param44=[System.DBNull, null], @param45=[System.DBNull, null], @param46=[System.DBNull, null], @param47=[String, System.String], @param48=[System.DBNull, null], @param49=[String, System.String], @param50=[String, System.String], @param51=[System.DBNull, null], @param52=[System.DBNull, null], @param53=[System.DBNull, null], @param54=[System.DBNull, null], @param55=[System.DBNull, null], @param56=[System.DBNull, null], @param57=[System.DBNull, null], @param58=[System.DBNull, null], @param59=[System.DBNull, null], @param60=[System.DBNull, null], @param61=[System.DBNull, null], @param62=[System.DBNull, null], @param63=[String, System.String], @param64=[String, System.String], @param65=[String, System.String], @param66=[String, System.String], @param67=[String, System.String], @param68=[System.DBNull, null], @param69=[System.DBNull, null], @param70=[String, System.String], @param71=[String, System.String], @param72=[String, System.String], @param73=[String, System.String], @param74=[System.DBNull, null], @param75=[System.DBNull, null], @param76=[System.DBNull, null], @param77=[System.DBNull, null], @param78=[System.DBNull, null], @param79=[System.DBNull, null], @param80=[System.DBNull, null], @param81=[System.DBNull, null], @param82=[String, System.String], @param83=[System.DBNull, null], @param84=[System.DBNull, null], @param85=[System.DBNull, null], @param86=[System.DBNull, null], @param87=[System.DBNull, null], @param88=[String, System.String], @param89=[System.DBNull, null], @param90=[System.DBNull, null], @param91=[System.DBNull, null], @param92=[System.DBNull, null], @param93=[System.DBNull, null], @param94=[System.DBNull, null], @param95=[System.DBNull, null], @param96=[System.DBNull, null], @param97=[System.DBNull, null], @param98=[System.DBNull, null], @param99=[System.DBNull, null], @param100=[System.DBNull, null], @param101=[String, System.String], @param102=[System.DBNull, null], @param103=[Int64, System.Int64], @param104=[System.DBNull, null], @param105=[System.DBNull, null], @param106=[System.DBNull, null], @param107=[System.DBNull, null], @param108=[System.DBNull, null], @param109=[System.DBNull, null], @param110=[System.DBNull, null], @param111=[System.DBNull, null], @param112=[System.DBNull, null], @param113=[System.DBNull, null], @param114=[System.DBNull, null], @param115=[System.DBNull, null], @param116=[System.DBNull, null], @param117=[System.DBNull, null], @param118=[System.DBNull, null], @param119=[System.DBNull, null], @param120=[System.DBNull, null], @param121=[System.DBNull, null], @param122=[System.DBNull, null], @param123=[String, System.String], @param124=[DateTime, System.DateTime], @param125=[Int64, System.Int64], @param126=[DateTime, System.DateTime], @param127=[Int64, System.Int64], @param128=[System.DBNull, null], @param129=[System.DBNull, null], @param130=[System.DBNull, null], @param131=[System.DBNull, null], @param132=[System.DBNull, null], @param133=[System.DBNull, null], @param134=[System.DBNull, null], @param135=[System.DBNull, null], @param136=[System.DBNull, null], @param137=[System.DBNull, null], @param138=[System.DBNull, null]]
2019-09-20 15:50:13,163 [1] DEBUG - Statement Id: [DAO00305_GetClsKetQua] PreparedStatement : [select a.*, b.SOPHIEUYEUCAU from TT_CLSKETQUA a        left join TT_DVYEUCAU b on a.DVYEUCAU_ID = b.DVYEUCAU_ID where a.CLSKETQUA_ID = 95454]
2019-09-20 15:50:13,336 [1] DEBUG - Statement Id: [DAO00049_KiemtraloaiDV] PreparedStatement : [select DICHVU_ID AS HA, '' AS XN, '' as TDCN, '' as TT, '' as KB from TM_DICHVU            left join TM_NHOMDICHVU ndv on ndv.NHOMDICHVU_ID = TM_DICHVU.NHOMDICHVU_ID            where DICHVU_ID = '4145' and left(ndv.MANHOMDICHVU, 2) = '02'            union            select  '' as HA, DICHVU_ID AS XN, '' as TDCN, '' as TT, '' as KB from TM_DICHVU            left join TM_NHOMDICHVU ndv on ndv.NHOMDICHVU_ID = TM_DICHVU.NHOMDICHVU_ID            where DICHVU_ID = '4145' and left(ndv.MANHOMDICHVU, 2) = '01'            union            select  '' as HA, '' AS XN, DICHVU_ID as TDCN, '' as TT, '' as KB from TM_DICHVU            left join TM_NHOMDICHVU ndv on ndv.NHOMDICHVU_ID = TM_DICHVU.NHOMDICHVU_ID            where DICHVU_ID = '4145' and left(ndv.MANHOMDICHVU, 2) = '03'            union            select  '' as HA, '' AS XN, '' as TDCN, DICHVU_ID as TT, '' as KB from TM_DICHVU            left join TM_NHOMDICHVU ndv on ndv.NHOMDICHVU_ID = TM_DICHVU.NHOMDICHVU_ID            where DICHVU_ID = '4145' and left(ndv.MANHOMDICHVU, 2) = '05'            union            select  '' as HA, '' AS XN, '' as TDCN, DICHVU_ID as TT, '' as KB from TM_DICHVU            left join TM_NHOMDICHVU ndv on ndv.NHOMDICHVU_ID = TM_DICHVU.NHOMDICHVU_ID            where DICHVU_ID = '4145' and left(ndv.MANHOMDICHVU, 2) = '06'            union            select  '' as HA, '' AS XN, '' as TDCN, '' as TT, DICHVU_ID as KB from TM_DICHVU            left join TM_NHOMDICHVU ndv on ndv.NHOMDICHVU_ID = TM_DICHVU.NHOMDICHVU_ID            where DICHVU_ID = '4145' and left(ndv.MANHOMDICHVU, 2) = '04']
2019-09-20 15:50:13,388 [1] DEBUG - Statement Id: [DAO00009_GetThutiensauDVThuthuat] PreparedStatement : [select A.THUTIENSAU, B.SOTIEPNHAN, A.DICHVU_ID, A.DVYEUCAU_ID        from TT_DVYEUCAU A        inner join TT_TIEPNHAN B on B.TIEPNHAN_ID = A.TIEPNHAN_ID        where        A.DVYEUCAU_ID = '205441']
2019-09-20 15:50:13,428 [1] DEBUG - Statement Id: [DAO00009_TT_TIEPNHAN_GetProcess] PreparedStatement : [select PROCESS_ID from TT_TIEPNHAN where SOTIEPNHAN = 'TN190920.0000001']
2019-09-20 15:50:13,494 [1] DEBUG - Statement Id: [DAOWF001_Kiemtrathongtindayeucaudacochua] PreparedStatement : [select * from TT_REQUEST        where        PARA = '{"HOSPITAL_ID":"HLU01","SOTIEPNHAN":"TN190920.0000001"}'        AND ISACTIVE = '1']
2019-09-20 15:50:13,550 [1] DEBUG - Statement Id: [DAOWF001_Kiemtrathongtindichvudayeucau] PreparedStatement : [select top 1 * from TT_REQUEST_SERVICE        where        PARA = '{"DICHVU_ID":"4145","DVYEUCAU_ID":"205441"}'                AND ISACTIVE = '1' order by ID desc]
2019-09-20 15:50:13,579 [1] DEBUG - Statement Id: [DAOWF001_KiemtrathongtinchitietDichvuYeucau] PreparedStatement : [select * from TT_REQUEST_SERVICE_DETAIL        where        REQUEST_SERVICE_ID = '147388']
2019-09-20 15:50:13,643 [1] DEBUG - Statement Id: [DAOWF001_Laythongtinwithstatecode] PreparedStatement : [select A.*, B.STATUS_CODE from        TM_STATE_ACTION A        left join TM_STATE B on B.STATE_CODE = A.NEXT_STATE_CODE and A.PROCESS_CODE = B.PROCESS_CODE        where        A.CURR_STATE_CODE = '1     '        AND A.PROCESS_CODE = 'P02'        Order By ORDER_ID ASC]
2019-09-20 15:50:13,683 [1] DEBUG - Statement Id: [DAOWF003_Update] PreparedStatement : [update TT_REQUEST_SERVICE set        CURR_STATE_CODE =  @param0                   , ISACTIVE =  @param1                     , ISCOMPLETE =  @param2                        where        ID = '147388']
2019-09-20 15:50:13,683 [1] DEBUG - Statement Id: [DAOWF003_Update] Parameters: [@param0=[CURR_STATE_CODE,2], @param1=[ISACTIVE,1], @param2=[ISCOMPLETE,0]]
2019-09-20 15:50:13,683 [1] DEBUG - Statement Id: [DAOWF003_Update] Types: [@param0=[String, System.String], @param1=[String, System.String], @param2=[String, System.String]]
2019-09-20 15:50:13,717 [1] DEBUG - Statement Id: [DAOWF005_Add] PreparedStatement : [insert into TT_REQUEST_SERVICE_DETAIL (        REQUEST_ID        ,REQUEST_SERVICE_ID        , OLD_STATE_CODE        , CURR_STATE_CODE        ) values (         @param0         , @param1         ,  @param2         ,  @param3         )        SELECT SCOPE_IDENTITY()]
2019-09-20 15:50:13,717 [1] DEBUG - Statement Id: [DAOWF005_Add] Parameters: [@param0=[REQUEST_ID,31779], @param1=[REQUEST_SERVICE_ID,147388], @param2=[OLD_STATE_CODE,1     ], @param3=[CURR_STATE_CODE,2]]
2019-09-20 15:50:13,717 [1] DEBUG - Statement Id: [DAOWF005_Add] Types: [@param0=[String, System.String], @param1=[Int32, System.Int32], @param2=[String, System.String], @param3=[String, System.String]]
2019-09-20 15:50:13,756 [1] DEBUG - Statement Id: [DAOWF005_Add_History] PreparedStatement : [insert into TT_REQUEST_SERVICE_HISTORY (        REQUEST_ID        ,REQUEST_SERVICE_ID        , OLD_STATE_CODE        , CURR_STATE_CODE        ) values (         @param0         , @param1         ,  @param2         ,  @param3         )]
2019-09-20 15:50:13,756 [1] DEBUG - Statement Id: [DAOWF005_Add_History] Parameters: [@param0=[REQUEST_ID,31779], @param1=[REQUEST_SERVICE_ID,147388], @param2=[OLD_STATE_CODE,1     ], @param3=[CURR_STATE_CODE,2]]
2019-09-20 15:50:13,756 [1] DEBUG - Statement Id: [DAOWF005_Add_History] Types: [@param0=[String, System.String], @param1=[Int32, System.Int32], @param2=[String, System.String], @param3=[String, System.String]]
2019-09-20 15:50:13,911 [1] DEBUG - Statement Id: [DAO00009_TT_DVYEUCAU_Update] PreparedStatement : [Update TT_DVYEUCAU set TRANGTHAI_WFL = 'HOANTAT' where DVYEUCAU_ID = '205441']
2019-09-20 15:50:14,052 [1] DEBUG - Statement Id: [DAO00027_ThongTinTiepNhanCOM006] PreparedStatement : [select distinct CONVERT(VARCHAR(11),A.NGAYTIEPNHAN,103) as NGAYYEUCAU, C.DICHVU_ID, C.DVYEUCAU_ID, D.TENDICHVU, C.NOITHUCHIEN_ID,        A.SOTIEPNHAN, A.TRAITUYEN, A.NGAYMIENDONGCHITRA, A.TIEPNHAN_ID, A.DOITUONG_ID, A.TRANGTHAI,        A.LOAITHANHVIEN_ID, A.SUDUNG_BHTN, A.THE_ID, A.THANHVIEN_ID, A.VIP, A.NGUON_BENHNHAN_ID, A.BAOLANH_VIENPHI,        CASE WHEN (A.TRANGTHAI = 'NOITRU' OR A.TRANGTHAI = 'CAPCUU'   or A.TRANGTHAI = 'NGOAITRU') THEN 'IN' ELSE 'OUT' END AS LOAIBENHAN,        CASE WHEN (C.TRANGTHAI = 'CHUAKETQUA') THEN 'CHUAKETQUA' ELSE 'HOANTAT' END AS TRANGTHAIDICHVU, A.SOBHYT,        B.*,        CASE WHEN Left(E.MANHOMDICHVU,2) = '03' THEN '02' ELSE Left(E.MANHOMDICHVU,2) END AS MANHOMDICHVU        , A.UUTIEN        from TT_TIEPNHAN A        inner join TT_BENHNHAN B on B.BENHNHAN_ID = A.BENHNHAN_ID and (A.TRANGTHAI = 'DATIEPNHAN' or A.TRANGTHAI = 'NOITRU' or A.TRANGTHAI = 'CAPCUU'  or A.TRANGTHAI = 'NGOAITRU') and B.ACTIVE = '1'        inner join TT_DVYEUCAU C on C.TIEPNHAN_ID = A.TIEPNHAN_ID        left join TM_DICHVU D on D.DICHVU_ID = C.DICHVU_ID        left join TM_NHOMDICHVU E on E.NHOMDICHVU_ID = D.NHOMDICHVU_ID        where C.NGAYHENCLS is NULL and A.TIEPNHAN_ID = '27478' and C.DICHVU_ID = '4145' and A.BENHVIEN_ID = 'HLU01'         and           C.DVYEUCAU_ID = '205441']
2019-09-20 15:50:14,374 [1] DEBUG - Statement Id: [DAO00026_GetListDanhSachDichVuGhiNhanVTYT_COM25_WithTN] PreparedStatement : [select distinct CONVERT(VARCHAR(11),C.NGAYYEUCAU,103) as NGAYYEUCAU, C.DICHVU_ID, C.DVYEUCAU_ID, D.TENDICHVU, C.NOITHUCHIEN_ID, A.SOTIEPNHAN, A.TRAITUYEN, A.NGAYMIENDONGCHITRA, A.TIEPNHAN_ID, A.DOITUONG_ID, A.TRANGTHAI,            A.LOAITHANHVIEN_ID, A.SUDUNG_BHTN, A.THE_ID, A.THANHVIEN_ID, A.VIP, A.NGUON_BENHNHAN_ID, A.BAOLANH_VIENPHI,            CASE WHEN (A.TRANGTHAI = 'NOITRU' OR A.TRANGTHAI = 'CAPCUU') THEN 'IN' ELSE 'OUT' END AS LOAIBENHAN,            CASE WHEN (C.TRANGTHAI = 'CHUAKETQUA') THEN 'CHUAKETQUA' ELSE 'HOANTAT' END AS TRANGTHAIDICHVU,            B.*, isnull(ntba.SOBENHAN, '') SOBENHAN, isnull(ntba.BENHAN_ID, 0) BENHAN_ID,            CASE WHEN Left(E.MANHOMDICHVU,2) = '03' THEN '02' ELSE Left(E.MANHOMDICHVU,2) END AS MANHOMDICHVU            from TT_TIEPNHAN A            inner join TT_BENHNHAN B on B.BENHNHAN_ID = A.BENHNHAN_ID and B.ACTIVE = '1'            inner join TT_DVYEUCAU C on C.TIEPNHAN_ID = A.TIEPNHAN_ID                        left join TM_DICHVU D on D.DICHVU_ID = C.DICHVU_ID            left join TM_NHOMDICHVU E on E.NHOMDICHVU_ID = D.NHOMDICHVU_ID            left join TT_NOITRU_BENHAN ntba on ntba.BENHAN_ID = C.BENHAN_ID              where            C.NGAYHENCLS is NULL and A.BENHVIEN_ID = 'HLU01'            and (A.TRANGTHAI = 'DATIEPNHAN' or A.TRANGTHAI = 'NOITRU' or A.TRANGTHAI = 'CAPCUU' or A.TRANGTHAI = 'NGOAITRU')            and (CASE WHEN Left(E.MANHOMDICHVU,2) = '03' THEN '02' ELSE Left(E.MANHOMDICHVU,2) END in ('02', '04'))            and A.TIEPNHAN_ID = '27478']
2019-09-20 15:50:15,097 [1] DEBUG - Statement Id: [DAO00037_GetCLSKetQua] PreparedStatement : [select *              from TT_CLSKETQUA               where                             TT_CLSKETQUA.DVYEUCAU_ID = '205441'                       and                           TT_CLSKETQUA.BENHVIEN_ID = 'HLU01'                                     order by CLSKETQUA_ID]
2019-09-20 15:50:15,272 [1] DEBUG - Statement Id: [DAO00020_UpdateTrangThaiDVYeuCau] PreparedStatement : [update TT_DVYEUCAU set        TRANGTHAI =  @param0         , NGAYCAPNHAT =  @param1         , NGUOICAPNHAT_ID =  @param2         , KHOADULIEU =  @param3         , NGAYKHOADULIEU =  @param4         , THOIGIANKHOADULIEU =  @param5         , NGUOIKHOA_ID =  @param6         , MANGUOIKHOA =  @param7         , TENNGUOIKHOA =  @param8         where        DVYEUCAU_ID =  @param9]
2019-09-20 15:50:15,272 [1] DEBUG - Statement Id: [DAO00020_UpdateTrangThaiDVYeuCau] Parameters: [@param0=[TRANGTHAI,CHOXACNHAN], @param1=[NGAYCAPNHAT,9/20/2019 3:50:15 PM], @param2=[NGUOICAPNHAT_ID,1], @param3=[KHOADULIEU,null], @param4=[NGAYKHOADULIEU,null], @param5=[THOIGIANKHOADULIEU,null], @param6=[NGUOIKHOA_ID,null], @param7=[MANGUOIKHOA,null], @param8=[TENNGUOIKHOA,null], @param9=[DVYEUCAU_ID,205441]]
2019-09-20 15:50:15,272 [1] DEBUG - Statement Id: [DAO00020_UpdateTrangThaiDVYeuCau] Types: [@param0=[String, System.String], @param1=[DateTime, System.DateTime], @param2=[Int64, System.Int64], @param3=[System.DBNull, null], @param4=[System.DBNull, null], @param5=[System.DBNull, null], @param6=[System.DBNull, null], @param7=[System.DBNull, null], @param8=[System.DBNull, null], @param9=[Int64, System.Int64]]
2019-09-20 15:50:15,354 [1] DEBUG - Statement Id: [DAO00023_UpdateTTDVYeuCauVienPhi] PreparedStatement : [update TT_VIENPHI        set                 DATHUCHIEN =  @param0 ,        NGUOICAPNHAT_ID = '1',        NGAYCAPNHAT = '9/20/2019 3:50:15 PM'        where REF_ID = '205441'        and REF_TABLE = 'TT_DVYEUCAU'        and TIEPNHAN_ID = '27478']
2019-09-20 15:50:15,354 [1] DEBUG - Statement Id: [DAO00023_UpdateTTDVYeuCauVienPhi] Parameters: [@param0=[DATHUCHIEN,1]]
2019-09-20 15:50:15,354 [1] DEBUG - Statement Id: [DAO00023_UpdateTTDVYeuCauVienPhi] Types: [@param0=[Int64, System.Int64]]
2019-09-20 15:50:17,800 [1] DEBUG - Statement Id: [DAO00066_GetBENHAN_TIEPNHAN] PreparedStatement : [select top 1 *        from TT_NOITRU_BENHAN        where TIEPNHAN_ID = '27478'  and BENHVIEN_ID = 'HLU01'        order by NGAYTAO desc]
2019-09-20 15:50:17,893 [1] DEBUG - Statement Id: [DAO00014_GetPatientStatus] PreparedStatement : [select        CASE        when tn.TRANGTHAI = 'HOANTHANH' Then tn.TRANGTHAI        WHEN xncp.XACNHANCHIPHI_ID is not null THEN 'XACNHANCHIPHI'        WHEN (tn.KHOADULIEU = '1') THEN 'KHOADULIEU'        ELSE tn.TRANGTHAI        END        as TRANGTHAI        from TT_TIEPNHAN tn        left join TT_XACNHANCHIPHI xncp on tn.TIEPNHAN_ID = xncp.TIEPNHAN_ID        where tn.TIEPNHAN_ID = '27478'        and tn.BENHVIEN_ID = 'HLU01']
2019-09-20 15:50:18,287 [1] DEBUG - Statement Id: [DAO00014_GetServiceStatus] PreparedStatement : [select TRANGTHAI, NGUOIKHOA_ID from TT_DVYEUCAU        where        DVYEUCAU_ID = '205441'        and BENHVIEN_ID = 'HLU01']
2019-09-20 15:50:18,393 [1] DEBUG - Statement Id: [DAO00020_UpdateTrangThaiDVYeuCau] PreparedStatement : [update TT_DVYEUCAU set        TRANGTHAI =  @param0         , NGAYCAPNHAT =  @param1         , NGUOICAPNHAT_ID =  @param2         , KHOADULIEU =  @param3         , NGAYKHOADULIEU =  @param4         , THOIGIANKHOADULIEU =  @param5         , NGUOIKHOA_ID =  @param6         , MANGUOIKHOA =  @param7         , TENNGUOIKHOA =  @param8         where        DVYEUCAU_ID =  @param9]
2019-09-20 15:50:18,393 [1] DEBUG - Statement Id: [DAO00020_UpdateTrangThaiDVYeuCau] Parameters: [@param0=[TRANGTHAI,HOANTAT], @param1=[NGAYCAPNHAT,9/20/2019 3:50:18 PM], @param2=[NGUOICAPNHAT_ID,1], @param3=[KHOADULIEU,True], @param4=[NGAYKHOADULIEU,9/20/2019 3:50:18 PM], @param5=[THOIGIANKHOADULIEU,9/20/2019 3:50:18 PM], @param6=[NGUOIKHOA_ID,1], @param7=[MANGUOIKHOA,1], @param8=[TENNGUOIKHOA,], @param9=[DVYEUCAU_ID,205441]]
2019-09-20 15:50:18,393 [1] DEBUG - Statement Id: [DAO00020_UpdateTrangThaiDVYeuCau] Types: [@param0=[String, System.String], @param1=[DateTime, System.DateTime], @param2=[Int64, System.Int64], @param3=[Boolean, System.Boolean], @param4=[DateTime, System.DateTime], @param5=[DateTime, System.DateTime], @param6=[Int64, System.Int64], @param7=[Int64, System.Int64], @param8=[String, System.String], @param9=[Int64, System.Int64]]
2019-09-20 15:50:18,456 [1] DEBUG - Statement Id: [DAO00023_UpdateTTDVYeuCauVienPhi] PreparedStatement : [update TT_VIENPHI        set                 DATHUCHIEN =  @param0 ,        NGUOICAPNHAT_ID = '1',        NGAYCAPNHAT = '9/20/2019 3:50:18 PM'        where REF_ID = '205441'        and REF_TABLE = 'TT_DVYEUCAU'        and TIEPNHAN_ID = '27478']
2019-09-20 15:50:18,456 [1] DEBUG - Statement Id: [DAO00023_UpdateTTDVYeuCauVienPhi] Parameters: [@param0=[DATHUCHIEN,1]]
2019-09-20 15:50:18,456 [1] DEBUG - Statement Id: [DAO00023_UpdateTTDVYeuCauVienPhi] Types: [@param0=[Int64, System.Int64]]
2019-09-20 15:50:18,530 [1] DEBUG - Statement Id: [DAO00037_Duyet] PreparedStatement : [update TT_CLSKETQUA set            KHOADULIEU =  @param0             , NGAYKHOADULIEU =  @param1             , THOIGIANKHOADULIEU =  @param2             , NGUOIKHOA_ID =  @param3             , TENNGUOIKHOA =  @param4             , TRANGTHAI =  @param5             where            CLSKETQUA_ID = '95454'              update TT_DVYEUCAU set            TRANGTHAI =  @param5             , NGAYCAPNHAT =  @param6             , NGUOICAPNHAT_ID =  @param7             , KHOADULIEU =  @param0             , NGAYKHOADULIEU =  @param1             , THOIGIANKHOADULIEU =  @param2             , NGUOIKHOA_ID =  @param3             , MANGUOIKHOA =  @param8             , TENNGUOIKHOA =  @param4             where DVYEUCAU_ID = '']
2019-09-20 15:50:18,530 [1] DEBUG - Statement Id: [DAO00037_Duyet] Parameters: [@param0=[KHOADULIEU,1], @param1=[NGAYKHOADULIEU,9/20/2019 3:50:18 PM], @param2=[THOIGIANKHOADULIEU,9/20/2019 3:50:18 PM], @param3=[NGUOIKHOA_ID,1], @param4=[TENNGUOIKHOA,], @param5=[TRANGTHAI,HOANTAT], @param6=[NGAYCAPNHAT,9/20/2019 3:50:18 PM], @param7=[NGUOICAPNHAT_ID,null], @param8=[MANGUOIKHOA,null]]
2019-09-20 15:50:18,530 [1] DEBUG - Statement Id: [DAO00037_Duyet] Types: [@param0=[String, System.String], @param1=[DateTime, System.DateTime], @param2=[DateTime, System.DateTime], @param3=[Int64, System.Int64], @param4=[String, System.String], @param5=[String, System.String], @param6=[DateTime, System.DateTime], @param7=[System.DBNull, null], @param8=[System.DBNull, null]]
2019-09-20 15:50:18,656 [1] DEBUG - Statement Id: [DAO00026_GetListDanhSachDichVuGhiNhanVTYT_COM25_WithTN] PreparedStatement : [select distinct CONVERT(VARCHAR(11),C.NGAYYEUCAU,103) as NGAYYEUCAU, C.DICHVU_ID, C.DVYEUCAU_ID, D.TENDICHVU, C.NOITHUCHIEN_ID, A.SOTIEPNHAN, A.TRAITUYEN, A.NGAYMIENDONGCHITRA, A.TIEPNHAN_ID, A.DOITUONG_ID, A.TRANGTHAI,            A.LOAITHANHVIEN_ID, A.SUDUNG_BHTN, A.THE_ID, A.THANHVIEN_ID, A.VIP, A.NGUON_BENHNHAN_ID, A.BAOLANH_VIENPHI,            CASE WHEN (A.TRANGTHAI = 'NOITRU' OR A.TRANGTHAI = 'CAPCUU') THEN 'IN' ELSE 'OUT' END AS LOAIBENHAN,            CASE WHEN (C.TRANGTHAI = 'CHUAKETQUA') THEN 'CHUAKETQUA' ELSE 'HOANTAT' END AS TRANGTHAIDICHVU,            B.*, isnull(ntba.SOBENHAN, '') SOBENHAN, isnull(ntba.BENHAN_ID, 0) BENHAN_ID,            CASE WHEN Left(E.MANHOMDICHVU,2) = '03' THEN '02' ELSE Left(E.MANHOMDICHVU,2) END AS MANHOMDICHVU            from TT_TIEPNHAN A            inner join TT_BENHNHAN B on B.BENHNHAN_ID = A.BENHNHAN_ID and B.ACTIVE = '1'            inner join TT_DVYEUCAU C on C.TIEPNHAN_ID = A.TIEPNHAN_ID                        left join TM_DICHVU D on D.DICHVU_ID = C.DICHVU_ID            left join TM_NHOMDICHVU E on E.NHOMDICHVU_ID = D.NHOMDICHVU_ID            left join TT_NOITRU_BENHAN ntba on ntba.BENHAN_ID = C.BENHAN_ID              where            C.NGAYHENCLS is NULL and A.BENHVIEN_ID = 'HLU01'            and (A.TRANGTHAI = 'DATIEPNHAN' or A.TRANGTHAI = 'NOITRU' or A.TRANGTHAI = 'CAPCUU' or A.TRANGTHAI = 'NGOAITRU')            and (CASE WHEN Left(E.MANHOMDICHVU,2) = '03' THEN '02' ELSE Left(E.MANHOMDICHVU,2) END in ('02', '04'))            and A.TIEPNHAN_ID = '']
2019-09-20 15:50:33,580 [1] DEBUG - Statement Id: [DAO00020_ListKhoDuocOfPhongBan] PreparedStatement : [select B.* from TM_PHONGBAN_KHODUOC A        inner join TM_KHODUOC B on B.KHODUOC_ID = A.KHODUOC_ID        where        A.PHONGBAN_ID = ''        and A.BENHVIEN_ID = 'HLU01']
2019-09-20 15:50:33,908 [1] DEBUG - Statement Id: [DAO00020_ListKhoDuocOfPhongBan] PreparedStatement : [select B.* from TM_PHONGBAN_KHODUOC A        inner join TM_KHODUOC B on B.KHODUOC_ID = A.KHODUOC_ID        where        A.PHONGBAN_ID = '79'        and A.BENHVIEN_ID = 'HLU01']
2019-09-20 15:50:35,612 [1] DEBUG - Statement Id: [DAO00020_ListKhoDuocOfPhongBan] PreparedStatement : [select B.* from TM_PHONGBAN_KHODUOC A        inner join TM_KHODUOC B on B.KHODUOC_ID = A.KHODUOC_ID        where        A.PHONGBAN_ID = '27'        and A.BENHVIEN_ID = 'HLU01']
2019-09-20 15:50:35,930 [1] DEBUG - Statement Id: [DAO00008_UpdateUserIdPhongBanKhoDuoc] PreparedStatement : [IF EXISTS            (SELECT ACCOUNT_ID FROM TM_SYS_USERS WHERE ACCOUNT_ID =  @param0  and HOSPITAL_ID =  @param1 )            BEGIN            update TM_SYS_USERS set INVENTORY_ID =  @param2 , WORKING_DEPT_ID =  @param3             WHERE ACCOUNT_ID =  @param0  and HOSPITAL_ID =  @param1             END            ELSE            BEGIN            insert into TM_SYS_USERS ([ACCOUNT_ID], [ACCOUNT_NAME], [INVENTORY_ID], [WORKING_DEPT_ID], [HOSPITAL_ID])            values ( @param0 ,  @param4 ,  @param2 ,  @param3 ,  @param1 )            END]
2019-09-20 15:50:35,930 [1] DEBUG - Statement Id: [DAO00008_UpdateUserIdPhongBanKhoDuoc] Parameters: [@param0=[ACCOUNT_ID,113], @param1=[HOSPITAL_ID,HLU01], @param2=[INVENTORY_ID,27], @param3=[WORKING_DEPT_ID,27], @param4=[ACCOUNT_NAME,admin]]
2019-09-20 15:50:35,930 [1] DEBUG - Statement Id: [DAO00008_UpdateUserIdPhongBanKhoDuoc] Types: [@param0=[String, System.String], @param1=[String, System.String], @param2=[String, System.String], @param3=[String, System.String], @param4=[String, System.String]]
2019-09-20 15:50:40,733 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'OPD23'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2019-09-20 15:50:41,272 [1] DEBUG - Statement Id: [DAO00019_DanhSachPhauThuatThuThuat] PreparedStatement : [declare @TenBenhVien nvarchar(500)        declare @ManhomDSA varchar(10);        set @TenBenhVien = (select VALUE from TM_SYS_APPSETTINGS where CODE = 'APP_BENHVIEN_TEN')        select top 1  @ManhomDSA = VALUE from TM_SYS_APPSETTINGS where CODE = 'MANHOM_DICHVU_DSA'        select * from(        select ROW_NUMBER() OVER(order by NGAYGIOYEUCAU) as ROWNUMBER, *        from        (SELECT distinct        COUNT(*) OVER() as TOTALROWS,        N'Mã người bệnh: ' + bn.MAYTE + ' - ' + N'Tên người bệnh: ' + bn.TENBENHNHAN + ' - ' + N'Số bệnh án: ' + ISNULL(BA.SOBENHAN,'') + ' - ' + N'Sinh ngày: ' + isnull(Convert(varchar(10),bn.NGAYSINH,103),bn.NAMSINH) + ' - ' + N'Giới tính: ' + GD.DESCRIPTION as GROUPNAME,        bn.MAYTE, bn.TENBENHNHAN, bn.NAMSINH, bn.NGAYSINH as TUOI, ISNULL(CONVERT(VARCHAR(10), bn.NGAYSINH, 103),CAST(bn.NAMSINH AS varchar)) as NGAYSINH, bn.DIACHILIENLAC as DIACHI, bn.GIOITINH, GD.DESCRIPTION as TENGIOITINH,        tn.DOITUONG_ID, tn.THOIGIANTIEPNHAN, tn.BENHNHAN_ID, tn.TIEPNHAN_ID, tn.TRAITUYEN, tn.SOTIEPNHAN        , dv.DICHVU_ID, dv.NOITHUCHIEN_ID, isnull(dv.NGAYTAO, dv.NGAYCAPNHAT) as THOIGIANDKDICHVU        , dv.KHAN, dv.NOIYEUCAU_ID, dv.NGAYGIOYEUCAU, dv.BACSICHIDINH_ID, dv.DONVIGIOITHIEU_ID        , dv.NGUOIGIOITHIEU_ID, dv.TRANGTHAI_WFL, tn.NOIGIOITHIEU_ID        , dv.DVYEUCAU_ID, dv.MARIS, dv.TRANGTHAI as TRANGTHAICODE, B.TENNHOMDICHVU, dv.SOPHIEUYEUCAU, dv.KHAMBENH_NGOAITRU_ID, dv.NGUOICAPNHAT_ID, dv.NGAYCAPNHAT,        CASE        WHEN @ManhomDSA is not null and B.MANHOMDICHVU in (@ManhomDSA) THEN B.MANHOMDICHVU        WHEN Left(B.MANHOMDICHVU,2) = '03' THEN '02'        ELSE Left(B.MANHOMDICHVU,2) END AS MANHOMDICHVU, B.MANHOMDICHVU as MANHOMDICHVUCHITIET, tn.TRANGTHAI as TRANGTHAI_TIEPNHAN,        'False' as DAKHAM,        vp.DATHANHTOAN, vp.DONGIA_DOANHTHU, BA.SOBENHAN, dv.CHANDOAN        , a.TENDICHVU, nth.TENPHONGBAN as TENPHONGKHAM, nyc.TENPHONGBAN as TENKHOACHIDINH        , bscd.TENNHANVIEN as TENBACSICHIDINH        , 0 as GUINGOAI        , 0 as VTYT        , 0 as CLSKETQUA_ID          ,             '' SOPHIEUPHAUTHUAT                   FROM TT_DVYEUCAU (NOLOCK) dv        inner join TT_TIEPNHAN (NOLOCK) tn on dv.TIEPNHAN_ID = tn.TIEPNHAN_ID        inner join TT_BENHNHAN (NOLOCK) bn on tn.BENHNHAN_ID = bn.BENHNHAN_ID        inner join TM_DICHVU A on A.DICHVU_ID = dv.DICHVU_ID        inner join TM_PHONGBAN nth on nth.PHONGBAN_ID = dv.NOITHUCHIEN_ID        left join TM_NHANVIEN bscd on bscd.NHANVIEN_ID = dv.BACSICHIDINH_ID        inner join TM_PHONGBAN nyc on nyc.PHONGBAN_ID = dv.NOIYEUCAU_ID        inner join TM_NHOMDICHVU B on B.NHOMDICHVU_ID = A.NHOMDICHVU_ID        inner join TT_VIENPHI (NOLOCK) VP on VP.TIEPNHAN_ID = tn.TIEPNHAN_ID and VP.DICHVU_ID = dv.DICHVU_ID and VP.REF_ID = dv.DVYEUCAU_ID        left join TT_NOITRU_BENHAN (NOLOCK) BA on BA.TIEPNHAN_ID = tn.TIEPNHAN_ID AND dv.BENHAN_ID = BA.BENHAN_ID        inner join TM_GENDER GD on GD.ID = bn.GIOITINH                 where        dv.DICHVU_ID IS NOT NULL        and tn.BENHVIEN_ID = 'HLU01'        and HUYYEUCAU = 0        and dv.NGAYHENCLS is NULL                       and dv.TRANGTHAI = 'CHUAKETQUA'           and           dv.NGAYYEUCAU >= '9/20/2019 12:00:00 AM'         and           dv.NGAYYEUCAU <= '9/20/2019 12:00:00 AM'         and           dv.NOITHUCHIEN_ID = 27         and           (CASE          WHEN @ManhomDSA is not null and B.MANHOMDICHVU in (@ManhomDSA) THEN B.MANHOMDICHVU          WHEN Left(B.MANHOMDICHVU,2) = '03' THEN '02' ELSE Left(B.MANHOMDICHVU,2)          END) in (06)         and           tn.TRANGTHAI IN ('DATIEPNHAN','NOITRU','CAPCUU','NGOAITRU')         and           (vp.DATHANHTOAN = '1'  or vp.DONGIA_DOANHTHU = '0' OR TN.SUDUNG_BHTN='1' OR TN.BAOLANH_VIENPHI='1'  OR tn.TRANGTHAI IN ('NOITRU','CAPCUU','NGOAITRU') or dv.HOPDONG_BENHNHAN_ID is not null or vp.BENHNHAN_PHAITHANHTOAN >= 0)                 ) data1) lst                    where          lst.ROWNUMBER between 1 and 20                 order by NGAYGIOYEUCAU asc]
2019-09-20 15:50:43,655 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'ORM04'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2019-09-20 15:50:44,179 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'ORM05'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2019-09-20 15:50:44,935 [1] DEBUG - Statement Id: [DAO00019_ThongTinBenhNhanTiepNhan] PreparedStatement : [select distinct A.SOTIEPNHAN, A.TIEPNHAN_ID, A.DOITUONG_ID, A.TRANGTHAI,        A.LOAITHANHVIEN_ID, A.SUDUNG_BHTN, A.THE_ID, A.THANHVIEN_ID, A.VIP, A.NGUON_BENHNHAN_ID, A.BAOLANH_VIENPHI,        B.*, A.SOBHYT        from TT_TIEPNHAN A        inner join TT_BENHNHAN B on B.BENHNHAN_ID = A.BENHNHAN_ID and B.ACTIVE = '1'        where                    A.TIEPNHAN_ID = '27478'                 and A.BENHVIEN_ID = 'HLU01']
2019-09-20 15:50:45,616 [1] DEBUG - Statement Id: [DAO00048_TT_PHAUTHUAT_GetList] PreparedStatement : [select *              from TT_PHAUTHUAT               where                             TT_PHAUTHUAT.LOAI = 'T'                       and                           TT_PHAUTHUAT.TIEPNHAN_ID = 27478                       and                           TT_PHAUTHUAT.BENHVIEN_ID = 'HLU01'                                     order by PHAUTHUAT_ID DESC]
2019-09-20 15:50:46,126 [1] DEBUG - Statement Id: [DAO00066_GetBENHAN_TIEPNHAN] PreparedStatement : [select top 1 *        from TT_NOITRU_BENHAN        where TIEPNHAN_ID = '27478'  and BENHVIEN_ID = 'HLU01'        order by NGAYTAO desc]
2019-09-20 15:50:46,253 [1] DEBUG - Statement Id: [DAO00048_GetBenhNhanByBenhNhanID] PreparedStatement : [SELECT *              FROM              TT_BENHNHAN               where                             BENHNHAN_ID = '23423']
2019-09-20 15:50:46,322 [1] DEBUG - Statement Id: [DAO00000_GetDoiTuongIsBHYT] PreparedStatement : [select * from TM_DOITUONG Where DOITUONG_ID = 4 and MADOITUONG like '%BHYT%']
2019-09-20 15:50:46,697 [1] DEBUG - Statement Id: [DAO00041_GetList] PreparedStatement : [declare @ManhomDSA varchar(10);            declare @PhanLoaiNhomDV varchar(20) = '06';            select top 1  @ManhomDSA = VALUE from TM_SYS_APPSETTINGS where CODE = 'MANHOM_DICHVU_DSA'            if (@ManhomDSA is not null and '05' in (select * from STRING_SPLIT('06', ',')))             set @PhanLoaiNhomDV += ',' + @ManhomDSA              select * from            (select dv.*, ndv.LOAIDICHVU_ID, ndv.MANHOMDICHVU, ndv.TENNHOMDICHVU as TENNHOMDICHVU,            ndv.TENKHONGDAU as TENNDVKHONGDAU, ndv.TENNHOMDICHVU_EN, ndv.TENNHOMDICHVU_RU,            CASE            WHEN @ManhomDSA is not null and ndv.MANHOMDICHVU in (@ManhomDSA) THEN ndv.MANHOMDICHVU            WHEN Left(ndv.MANHOMDICHVU,2) = '03' THEN '02' ELSE Left(ndv.MANHOMDICHVU,2)            END AS PHANLOAI_MANHOMDICHVU            from TM_DICHVU dv            left join TM_NHOMDICHVU ndv on dv.NHOMDICHVU_ID = ndv.NHOMDICHVU_ID                           where ndv.TAMNGUNG = '0' and dv.TAMNGUNG = '0' and dv.BENHVIEN_ID = 'HLU01') as tbl                 where                         PHANLOAI_MANHOMDICHVU in (select * from STRING_SPLIT(@PhanLoaiNhomDV,','))]
2019-09-20 15:50:48,777 [1] DEBUG - Statement Id: [DAO00048_GetDICHVUYCByTiepNhanID] PreparedStatement : [SELECT DISTINCT D.HOPDONG_ID, D.HOPDONG_BENHNHAN_ID, D.DVYEUCAU_ID, D.DICHVU_ID, D.SOPHIEUYEUCAU, D.NGAYGIOYEUCAU, D.NOITHUCHIEN_ID, P.LOAIPHAUTHUAT, L.STT AS STT_LOAIPHAUTHUAT            FROM            TT_DVYEUCAU AS D            left join TM_PHANLOAIPHAUTHUAT AS P ON D.DICHVU_ID = P.DICHVU_ID            left join TM_LOAIPHAUTHUAT AS L ON L.LOAIPHAUTHUAT = P.LOAIPHAUTHUAT            where            not exists (select DVYEUCAU_ID from TT_PHAUTHUAT_YEUCAU where D.DVYEUCAU_ID = DVYEUCAU_ID)               and                       exists                       (select DICHVU_ID from TM_DICHVU                        where D.DICHVU_ID = DICHVU_ID and                        exists                         (select NHOMDICHVU_ID from TM_NHOMDICHVU                         where TM_DICHVU.NHOMDICHVU_ID = NHOMDICHVU_ID and left(MANHOMDICHVU,2) in (06)                         )                      )                     and                           D.TIEPNHAN_ID = '27478']
2019-09-20 15:50:48,940 [1] DEBUG - Statement Id: [DAO00066_GetBENHAN_TIEPNHAN] PreparedStatement : [select top 1 *        from TT_NOITRU_BENHAN        where TIEPNHAN_ID = '27478'  and BENHVIEN_ID = 'HLU01'        order by NGAYTAO desc]
2019-09-20 15:50:49,058 [1] DEBUG - Statement Id: [DAO00009_TT_TIEPNHAN_GetProcess] PreparedStatement : [select PROCESS_ID from TT_TIEPNHAN where SOTIEPNHAN = 'TN190920.0000001']
2019-09-20 15:50:49,154 [1] DEBUG - Statement Id: [DAOWF004_laytrangthaiDV] PreparedStatement : [select top 1 A.CURR_STATE_CODE as STATE_CODE, isNull(C.SHORT_NAME,C.NAME) as TRANGTHAI, C.NAME as TRANGTHAI_CHITIET, C.STATUS_CODE, D.ISACTIVE as ACTIVE, E.STATUS_CODE  as OLD_STATUSCODE        from TT_REQUEST_SERVICE_DETAIL A                left join (select * from TT_REQUEST_SERVICE where PARA = '{"DICHVU_ID":"1111","DVYEUCAU_ID":"205442"}') D on D.ID = A.REQUEST_SERVICE_ID        left join TM_STATE C on A.CURR_STATE_CODE = C.STATE_CODE and C.PROCESS_CODE = D.PROCESS_CODE        left join TM_STATE E on A.OLD_STATE_CODE = E.STATE_CODE and E.PROCESS_CODE = D.PROCESS_CODE        where        A.REQUEST_SERVICE_ID = (select top 1 ID from TT_REQUEST_SERVICE where PARA = '{"DICHVU_ID":"1111","DVYEUCAU_ID":"205442"}' order by ID desc)        order by A.ID desc]
2019-09-20 15:50:49,328 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'COM60'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2019-09-20 15:50:51,583 [1] DEBUG - Statement Id: [DAO00048_GetDVYeuCauByDVYeuCauID] PreparedStatement : [SELECT A.*, B.NGAYGIOYEUCAU, C.TENDICHVU, D.TENNHOMDICHVU, D.NHOMDICHVU_ID            FROM TT_VIENPHI A            left join TT_DVYEUCAU B on A.REF_ID = B.DVYEUCAU_ID            inner join TM_DICHVU C on C.DICHVU_ID = B.DICHVU_ID            inner join TM_NHOMDICHVU D on D.NHOMDICHVU_ID = C.NHOMDICHVU_ID            WHERE            A.REF_ID IN (205442)            and A.REF_TABLE='TT_DVYEUCAU'            AND A.TIEPNHAN_ID = 27478]
2019-09-20 15:51:25,469 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'ORM07'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2019-09-20 15:51:39,648 [1] DEBUG - Statement Id: [DAO00066_GetBENHAN_TIEPNHAN] PreparedStatement : [select top 1 *        from TT_NOITRU_BENHAN        where TIEPNHAN_ID = '27478'  and BENHVIEN_ID = 'HLU01'        order by NGAYTAO desc]
2019-09-20 15:51:39,759 [1] DEBUG - Statement Id: [DAO00014_GetPatientStatus] PreparedStatement : [select        CASE        when tn.TRANGTHAI = 'HOANTHANH' Then tn.TRANGTHAI        WHEN xncp.XACNHANCHIPHI_ID is not null THEN 'XACNHANCHIPHI'        WHEN (tn.KHOADULIEU = '1') THEN 'KHOADULIEU'        ELSE tn.TRANGTHAI        END        as TRANGTHAI        from TT_TIEPNHAN tn        left join TT_XACNHANCHIPHI xncp on tn.TIEPNHAN_ID = xncp.TIEPNHAN_ID        where tn.TIEPNHAN_ID = '27478'        and tn.BENHVIEN_ID = 'HLU01']
2019-09-20 15:51:39,859 [1] DEBUG - Statement Id: [DAO00066_GetBENHAN_TIEPNHAN] PreparedStatement : [select top 1 *        from TT_NOITRU_BENHAN        where TIEPNHAN_ID = '27478'  and BENHVIEN_ID = 'HLU01'        order by NGAYTAO desc]
2019-09-20 15:51:40,018 [1] DEBUG - Statement Id: [DAO00014_GetPatientStatus] PreparedStatement : [select        CASE        when tn.TRANGTHAI = 'HOANTHANH' Then tn.TRANGTHAI        WHEN xncp.XACNHANCHIPHI_ID is not null THEN 'XACNHANCHIPHI'        WHEN (tn.KHOADULIEU = '1') THEN 'KHOADULIEU'        ELSE tn.TRANGTHAI        END        as TRANGTHAI        from TT_TIEPNHAN tn        left join TT_XACNHANCHIPHI xncp on tn.TIEPNHAN_ID = xncp.TIEPNHAN_ID        where tn.TIEPNHAN_ID = '27478'        and tn.BENHVIEN_ID = 'HLU01']
2019-09-20 15:51:40,265 [1] DEBUG - Statement Id: [DAO00048_GetTrangThaiTruocKhiLuu_TuongTrinh] PreparedStatement : [SELECT PHAUTHUAT_YEUCAU_ID FROM TT_PHAUTHUAT_YEUCAU PTYC              WHERE BENHVIEN_ID ='HLU01'                and DVYEUCAU_ID in  (                        @param0                   )]
2019-09-20 15:51:40,265 [1] DEBUG - Statement Id: [DAO00048_GetTrangThaiTruocKhiLuu_TuongTrinh] Parameters: [@param0=[LISTDVYEUCAU_ID[0],205442]]
2019-09-20 15:51:40,265 [1] DEBUG - Statement Id: [DAO00048_GetTrangThaiTruocKhiLuu_TuongTrinh] Types: [@param0=[Int64, System.Int64]]
2019-09-20 15:51:40,403 [1] DEBUG - Statement Id: [DAO00050_GetDetail] PreparedStatement : [select *              from LST_KEYDATA_DICHVU               where                             LST_KEYDATA_DICHVU.KEYTYPE = 'SOPHIEUYEUCAUCLS'                       and                           LST_KEYDATA_DICHVU.KEYYEAR = '2019'                       and                           LST_KEYDATA_DICHVU.KEYMONTH = '0'                       and                           LST_KEYDATA_DICHVU.KEYDAY = '0'                       and                           LST_KEYDATA_DICHVU.SEGMENT_1 = '0621'                       and                           LST_KEYDATA_DICHVU.SEGMENT_2 = '0'                       and                           LST_KEYDATA_DICHVU.SEGMENT_3 = '0'                                     order by KEYTYPE]
2019-09-20 15:51:40,466 [1] DEBUG - Statement Id: [DAO00050_Update] PreparedStatement : [update LST_KEYDATA_DICHVU set              KEYVALUE =  @param0               where              KEYTYPE = 'SOPHIEUYEUCAUCLS'              AND KEYYEAR = '2019'              AND KEYMONTH = '0'              AND KEYDAY = '0'              AND SEGMENT_1 = '0621'              AND SEGMENT_2 = '0'              AND SEGMENT_3 = '0']
2019-09-20 15:51:40,466 [1] DEBUG - Statement Id: [DAO00050_Update] Parameters: [@param0=[KEYVALUE,03907]]
2019-09-20 15:51:40,466 [1] DEBUG - Statement Id: [DAO00050_Update] Types: [@param0=[String, System.String]]
2019-09-20 15:51:40,499 [1] DEBUG - Statement Id: [DAO00048_TT_PHAUTHUAT_Add] PreparedStatement : [insert into TT_PHAUTHUAT (            SOPHIEUPHAUTHUAT            , LOAI            , BENHAN_ID            , LUUTRU_ID            , TIEPNHAN_ID            , PHONGBANTHUCHIEN_ID            , NGAYTHUCHIEN            , THOIGIANBATDAU            , THOIGIANKETTHUC            , ICD_VAOKHOA            , ICD_VAOKHOA_MOTA            , ICD_TRUOCPHAUTHUAT            , ICD_TRUOCPHAUTHUAT_MOTA            , ICD_SAUPHAUTHUAT            , ICD_SAUPHAUTHUAT_MOTA            , NHOMDICHVU_ID            , DICHVU_ID            , PHUONGPHAPVOCAM_ID            , TAIBIEN_ID            , CHEDO_ID            , TUVONG_ID            , TRINHTUTHUCHIEN            , MOTA            , KETQUA            , BENHNHANBENNGOAI            , NGUONBENH_ID            , LOAIPHAUTHUAT            , DANLUU            , NGAYRUT            , NGAYCATCHI            , KHAC            , SOLANMOLAI            , LYDOMOLAI            , CANTHIEPPHAUTHUAT            , TUDIENKETQUA_ID            , PHONGBANCHIDINH_ID            , PPMO_ID            , THOIGIANGAYME            , KHOADULIEU            , NGUOIKHOA_ID            , TENNGUOIKHOA            , NGAYKHOADULIEU            , THOIGIANKHOADULIEU            , NGAYTAO            , NGUOITAO_ID            , NGAYCAPNHAT            , NGUOICAPNHAT_ID            , BENHVIEN_ID                         ) values (             @param0             ,  @param1             ,  @param2             ,  @param3             ,  @param4             ,  @param5             ,  @param6             ,  @param7             ,  @param8             ,  @param9             ,  @param10             ,  @param11             ,  @param12             ,  @param13             ,  @param14             ,  @param15             ,  @param16             ,  @param17             ,  @param18             ,  @param19             ,  @param20             ,  @param21             ,  @param22             ,  @param23             ,  @param24             ,  @param25             ,  @param26             ,  @param27             ,  @param28             ,  @param29             ,  @param30             ,  @param31             ,  @param32             ,  @param33             ,  @param34             ,  @param35             ,  @param36             ,  @param37             ,  @param38             ,  @param39             ,  @param40             ,  @param41             ,  @param42             ,  @param43             ,  @param44             ,  @param45             ,  @param46             ,  @param47                            )              SELECT SCOPE_IDENTITY()]
2019-09-20 15:51:40,499 [1] DEBUG - Statement Id: [DAO00048_TT_PHAUTHUAT_Add] Parameters: [@param0=[SOPHIEUPHAUTHUAT,19.T.03907], @param1=[LOAI,T], @param2=[BENHAN_ID,null], @param3=[LUUTRU_ID,null], @param4=[TIEPNHAN_ID,27478], @param5=[PHONGBANTHUCHIEN_ID,27], @param6=[NGAYTHUCHIEN,9/20/2019 3:51:40 PM], @param7=[THOIGIANBATDAU,9/20/2019 4:50:00 PM], @param8=[THOIGIANKETTHUC,9/20/2019 5:50:00 PM], @param9=[ICD_VAOKHOA,null], @param10=[ICD_VAOKHOA_MOTA,null], @param11=[ICD_TRUOCPHAUTHUAT,null], @param12=[ICD_TRUOCPHAUTHUAT_MOTA,null], @param13=[ICD_SAUPHAUTHUAT,null], @param14=[ICD_SAUPHAUTHUAT_MOTA,null], @param15=[NHOMDICHVU_ID,null], @param16=[DICHVU_ID,null], @param17=[PHUONGPHAPVOCAM_ID,null], @param18=[TAIBIEN_ID,null], @param19=[CHEDO_ID,768], @param20=[TUVONG_ID,null], @param21=[TRINHTUTHUCHIEN,null], @param22=[MOTA,null], @param23=[KETQUA,null], @param24=[BENHNHANBENNGOAI,null], @param25=[NGUONBENH_ID,745], @param26=[LOAIPHAUTHUAT,PTM], @param27=[DANLUU,null], @param28=[NGAYRUT,null], @param29=[NGAYCATCHI,null], @param30=[KHAC,null], @param31=[SOLANMOLAI,null], @param32=[LYDOMOLAI,null], @param33=[CANTHIEPPHAUTHUAT,null], @param34=[TUDIENKETQUA_ID,null], @param35=[PHONGBANCHIDINH_ID,null], @param36=[PPMO_ID,null], @param37=[THOIGIANGAYME,null], @param38=[KHOADULIEU,0], @param39=[NGUOIKHOA_ID,null], @param40=[TENNGUOIKHOA,null], @param41=[NGAYKHOADULIEU,null], @param42=[THOIGIANKHOADULIEU,null], @param43=[NGAYTAO,9/20/2019 3:51:40 PM], @param44=[NGUOITAO_ID,1], @param45=[NGAYCAPNHAT,9/20/2019 3:51:40 PM], @param46=[NGUOICAPNHAT_ID,1], @param47=[BENHVIEN_ID,HLU01]]
2019-09-20 15:51:40,499 [1] DEBUG - Statement Id: [DAO00048_TT_PHAUTHUAT_Add] Types: [@param0=[String, System.String], @param1=[String, System.String], @param2=[System.DBNull, null], @param3=[System.DBNull, null], @param4=[Int64, System.Int64], @param5=[Int64, System.Int64], @param6=[DateTime, System.DateTime], @param7=[DateTime, System.DateTime], @param8=[DateTime, System.DateTime], @param9=[System.DBNull, null], @param10=[System.DBNull, null], @param11=[System.DBNull, null], @param12=[System.DBNull, null], @param13=[System.DBNull, null], @param14=[System.DBNull, null], @param15=[System.DBNull, null], @param16=[System.DBNull, null], @param17=[System.DBNull, null], @param18=[System.DBNull, null], @param19=[Int64, System.Int64], @param20=[System.DBNull, null], @param21=[System.DBNull, null], @param22=[System.DBNull, null], @param23=[System.DBNull, null], @param24=[System.DBNull, null], @param25=[Int64, System.Int64], @param26=[String, System.String], @param27=[System.DBNull, null], @param28=[System.DBNull, null], @param29=[System.DBNull, null], @param30=[System.DBNull, null], @param31=[System.DBNull, null], @param32=[System.DBNull, null], @param33=[System.DBNull, null], @param34=[System.DBNull, null], @param35=[System.DBNull, null], @param36=[System.DBNull, null], @param37=[System.DBNull, null], @param38=[String, System.String], @param39=[System.DBNull, null], @param40=[System.DBNull, null], @param41=[System.DBNull, null], @param42=[System.DBNull, null], @param43=[DateTime, System.DateTime], @param44=[Int64, System.Int64], @param45=[DateTime, System.DateTime], @param46=[Int64, System.Int64], @param47=[String, System.String]]
2019-09-20 15:51:40,543 [1] DEBUG - Statement Id: [DAO00049_KiemtraloaiDV] PreparedStatement : [select DICHVU_ID AS HA, '' AS XN, '' as TDCN, '' as TT, '' as KB from TM_DICHVU            left join TM_NHOMDICHVU ndv on ndv.NHOMDICHVU_ID = TM_DICHVU.NHOMDICHVU_ID            where DICHVU_ID = '1111' and left(ndv.MANHOMDICHVU, 2) = '02'            union            select  '' as HA, DICHVU_ID AS XN, '' as TDCN, '' as TT, '' as KB from TM_DICHVU            left join TM_NHOMDICHVU ndv on ndv.NHOMDICHVU_ID = TM_DICHVU.NHOMDICHVU_ID            where DICHVU_ID = '1111' and left(ndv.MANHOMDICHVU, 2) = '01'            union            select  '' as HA, '' AS XN, DICHVU_ID as TDCN, '' as TT, '' as KB from TM_DICHVU            left join TM_NHOMDICHVU ndv on ndv.NHOMDICHVU_ID = TM_DICHVU.NHOMDICHVU_ID            where DICHVU_ID = '1111' and left(ndv.MANHOMDICHVU, 2) = '03'            union            select  '' as HA, '' AS XN, '' as TDCN, DICHVU_ID as TT, '' as KB from TM_DICHVU            left join TM_NHOMDICHVU ndv on ndv.NHOMDICHVU_ID = TM_DICHVU.NHOMDICHVU_ID            where DICHVU_ID = '1111' and left(ndv.MANHOMDICHVU, 2) = '05'            union            select  '' as HA, '' AS XN, '' as TDCN, DICHVU_ID as TT, '' as KB from TM_DICHVU            left join TM_NHOMDICHVU ndv on ndv.NHOMDICHVU_ID = TM_DICHVU.NHOMDICHVU_ID            where DICHVU_ID = '1111' and left(ndv.MANHOMDICHVU, 2) = '06'            union            select  '' as HA, '' AS XN, '' as TDCN, '' as TT, DICHVU_ID as KB from TM_DICHVU            left join TM_NHOMDICHVU ndv on ndv.NHOMDICHVU_ID = TM_DICHVU.NHOMDICHVU_ID            where DICHVU_ID = '1111' and left(ndv.MANHOMDICHVU, 2) = '04']
2019-09-20 15:51:40,597 [1] DEBUG - Statement Id: [DAO00009_GetThutiensauDVThuthuat] PreparedStatement : [select A.THUTIENSAU, B.SOTIEPNHAN, A.DICHVU_ID, A.DVYEUCAU_ID        from TT_DVYEUCAU A        inner join TT_TIEPNHAN B on B.TIEPNHAN_ID = A.TIEPNHAN_ID        where        A.DVYEUCAU_ID = '205442']
2019-09-20 15:51:40,635 [1] DEBUG - Statement Id: [DAO00009_TT_TIEPNHAN_GetProcess] PreparedStatement : [select PROCESS_ID from TT_TIEPNHAN where SOTIEPNHAN = 'TN190920.0000001']
2019-09-20 15:51:40,705 [1] DEBUG - Statement Id: [DAOWF001_Kiemtrathongtindayeucaudacochua] PreparedStatement : [select * from TT_REQUEST        where        PARA = '{"HOSPITAL_ID":"HLU01","SOTIEPNHAN":"TN190920.0000001"}'        AND ISACTIVE = '1']
2019-09-20 15:51:40,759 [1] DEBUG - Statement Id: [DAOWF001_Kiemtrathongtindichvudayeucau] PreparedStatement : [select top 1 * from TT_REQUEST_SERVICE        where        PARA = '{"DICHVU_ID":"1111","DVYEUCAU_ID":"205442"}'                AND ISACTIVE = '1' order by ID desc]
2019-09-20 15:51:40,789 [1] DEBUG - Statement Id: [DAOWF001_KiemtrathongtinchitietDichvuYeucau] PreparedStatement : [select * from TT_REQUEST_SERVICE_DETAIL        where        REQUEST_SERVICE_ID = '147389']
2019-09-20 15:51:40,859 [1] DEBUG - Statement Id: [DAOWF001_Laythongtinwithstatecode] PreparedStatement : [select A.*, B.STATUS_CODE from        TM_STATE_ACTION A        left join TM_STATE B on B.STATE_CODE = A.NEXT_STATE_CODE and A.PROCESS_CODE = B.PROCESS_CODE        where        A.CURR_STATE_CODE = '1     '        AND A.PROCESS_CODE = 'P02'        Order By ORDER_ID ASC]
2019-09-20 15:51:40,895 [1] DEBUG - Statement Id: [DAOWF003_Update] PreparedStatement : [update TT_REQUEST_SERVICE set        CURR_STATE_CODE =  @param0                   , ISACTIVE =  @param1                     , ISCOMPLETE =  @param2                        where        ID = '147389']
2019-09-20 15:51:40,895 [1] DEBUG - Statement Id: [DAOWF003_Update] Parameters: [@param0=[CURR_STATE_CODE,2], @param1=[ISACTIVE,1], @param2=[ISCOMPLETE,0]]
2019-09-20 15:51:40,895 [1] DEBUG - Statement Id: [DAOWF003_Update] Types: [@param0=[String, System.String], @param1=[String, System.String], @param2=[String, System.String]]
2019-09-20 15:51:41,015 [1] DEBUG - Statement Id: [DAOWF005_Add] PreparedStatement : [insert into TT_REQUEST_SERVICE_DETAIL (        REQUEST_ID        ,REQUEST_SERVICE_ID        , OLD_STATE_CODE        , CURR_STATE_CODE        ) values (         @param0         , @param1         ,  @param2         ,  @param3         )        SELECT SCOPE_IDENTITY()]
2019-09-20 15:51:41,015 [1] DEBUG - Statement Id: [DAOWF005_Add] Parameters: [@param0=[REQUEST_ID,31779], @param1=[REQUEST_SERVICE_ID,147389], @param2=[OLD_STATE_CODE,1     ], @param3=[CURR_STATE_CODE,2]]
2019-09-20 15:51:41,015 [1] DEBUG - Statement Id: [DAOWF005_Add] Types: [@param0=[String, System.String], @param1=[Int32, System.Int32], @param2=[String, System.String], @param3=[String, System.String]]
2019-09-20 15:51:41,274 [1] DEBUG - Statement Id: [DAOWF005_Add_History] PreparedStatement : [insert into TT_REQUEST_SERVICE_HISTORY (        REQUEST_ID        ,REQUEST_SERVICE_ID        , OLD_STATE_CODE        , CURR_STATE_CODE        ) values (         @param0         , @param1         ,  @param2         ,  @param3         )]
2019-09-20 15:51:41,274 [1] DEBUG - Statement Id: [DAOWF005_Add_History] Parameters: [@param0=[REQUEST_ID,31779], @param1=[REQUEST_SERVICE_ID,147389], @param2=[OLD_STATE_CODE,1     ], @param3=[CURR_STATE_CODE,2]]
2019-09-20 15:51:41,274 [1] DEBUG - Statement Id: [DAOWF005_Add_History] Types: [@param0=[String, System.String], @param1=[Int32, System.Int32], @param2=[String, System.String], @param3=[String, System.String]]
2019-09-20 15:51:41,458 [1] DEBUG - Statement Id: [DAO00009_TT_DVYEUCAU_Update] PreparedStatement : [Update TT_DVYEUCAU set TRANGTHAI_WFL = 'HOANTAT' where DVYEUCAU_ID = '205442']
2019-09-20 15:51:41,488 [1] DEBUG - Statement Id: [DAO00048_TT_PHAUTHUAT_YEUCAU_Add] PreparedStatement : [insert into TT_PHAUTHUAT_YEUCAU (              PHAUTHUAT_ID              , DVYEUCAU_ID              , NHOMDICHVU_ID              , DICHVU_ID              , LOAIGIA_ID              , THANHTIEN_DOANHTHU              , BHYT_THANHTIEN_CHITRA              , BENHNHAN_PHAITHANHTOAN              , BENHVIEN_ID              ) values (               @param0               ,  @param1               ,  @param2               ,  @param3               ,  @param4               ,  @param5               ,  @param6               ,  @param7               ,  @param8               )]
2019-09-20 15:51:41,488 [1] DEBUG - Statement Id: [DAO00048_TT_PHAUTHUAT_YEUCAU_Add] Parameters: [@param0=[PHAUTHUAT_ID,3747], @param1=[DVYEUCAU_ID,205442], @param2=[NHOMDICHVU_ID,38], @param3=[DICHVU_ID,1111], @param4=[LOAIGIA_ID,2], @param5=[THANHTIEN_DOANHTHU,37000], @param6=[BHYT_THANHTIEN_CHITRA,29600], @param7=[BENHNHAN_PHAITHANHTOAN,7400], @param8=[BENHVIEN_ID,HLU01]]
2019-09-20 15:51:41,488 [1] DEBUG - Statement Id: [DAO00048_TT_PHAUTHUAT_YEUCAU_Add] Types: [@param0=[Int64, System.Int64], @param1=[Int64, System.Int64], @param2=[Int64, System.Int64], @param3=[Int64, System.Int64], @param4=[Int64, System.Int64], @param5=[Double, System.Double], @param6=[Double, System.Double], @param7=[Double, System.Double], @param8=[String, System.String]]
2019-09-20 15:51:41,520 [1] DEBUG - Statement Id: [DAO00048_UpdateDVYeuCauVienPhi] PreparedStatement : [update  TT_VIENPHI              set DATHUCHIEN = '1',              NGUOICAPNHAT_ID =  @param0 ,              NGAYCAPNHAT =  @param1               where              VIENPHI_ID =  @param2]
2019-09-20 15:51:41,520 [1] DEBUG - Statement Id: [DAO00048_UpdateDVYeuCauVienPhi] Parameters: [@param0=[NGUOICAPNHAT_ID,1], @param1=[NGAYCAPNHAT,9/20/2019 3:51:41 PM], @param2=[VIENPHI_ID,674726]]
2019-09-20 15:51:41,520 [1] DEBUG - Statement Id: [DAO00048_UpdateDVYeuCauVienPhi] Types: [@param0=[Int64, System.Int64], @param1=[DateTime, System.DateTime], @param2=[Int64, System.Int64]]
2019-09-20 15:51:41,550 [1] DEBUG - Statement Id: [DAO00048_UpdateDVYeuCau] PreparedStatement : [update  TT_DVYEUCAU              set TRANGTHAI =  @param0 ,              NGUOICAPNHAT_ID =  @param1 ,              NGAYCAPNHAT =  @param2               where              DVYEUCAU_ID =  @param3]
2019-09-20 15:51:41,550 [1] DEBUG - Statement Id: [DAO00048_UpdateDVYeuCau] Parameters: [@param0=[TRANGTHAI,CHOXACNHAN], @param1=[NGUOICAPNHAT_ID,1], @param2=[NGAYCAPNHAT,9/20/2019 3:51:41 PM], @param3=[DVYEUCAU_ID,205442]]
2019-09-20 15:51:41,550 [1] DEBUG - Statement Id: [DAO00048_UpdateDVYeuCau] Types: [@param0=[String, System.String], @param1=[Int64, System.Int64], @param2=[DateTime, System.DateTime], @param3=[Int64, System.Int64]]
2019-09-20 15:51:41,583 [1] DEBUG - Statement Id: [DAO00048_TT_PHAUTHUAT_EKIP_Add] PreparedStatement : [insert into TT_PHAUTHUAT_EKIP (              PHAUTHUAT_ID                ,                       NHANVIEN_ID                   ,                       VAITRO_ID                   ,                       GHICHU                                 , PTVC_ID              , PPT1_ID              , PPT2_ID              , GMC_ID              , GMP_ID              , DCVT_ID              , DCVN_ID              , BSHC_ID              , BSTC_ID              , BENHVIEN_ID              ) values (               @param0                 ,                        @param1                    ,                        @param2                    ,                        @param3                                  ,  @param4               ,  @param5               ,  @param6               ,  @param7               ,  @param8               ,  @param9               ,  @param10               ,  @param11               ,  @param12               ,  @param13               )]
2019-09-20 15:51:41,583 [1] DEBUG - Statement Id: [DAO00048_TT_PHAUTHUAT_EKIP_Add] Parameters: [@param0=[PHAUTHUAT_ID,3747], @param1=[NHANVIEN_ID,1], @param2=[VAITRO_ID,748], @param3=[GHICHU,cs], @param4=[PTVC_ID,null], @param5=[PPT1_ID,null], @param6=[PPT2_ID,null], @param7=[GMC_ID,null], @param8=[GMP_ID,null], @param9=[DCVT_ID,null], @param10=[DCVN_ID,null], @param11=[BSHC_ID,null], @param12=[BSTC_ID,null], @param13=[BENHVIEN_ID,HLU01]]
2019-09-20 15:51:41,583 [1] DEBUG - Statement Id: [DAO00048_TT_PHAUTHUAT_EKIP_Add] Types: [@param0=[Int64, System.Int64], @param1=[Int64, System.Int64], @param2=[Int64, System.Int64], @param3=[String, System.String], @param4=[System.DBNull, null], @param5=[System.DBNull, null], @param6=[System.DBNull, null], @param7=[System.DBNull, null], @param8=[System.DBNull, null], @param9=[System.DBNull, null], @param10=[System.DBNull, null], @param11=[System.DBNull, null], @param12=[System.DBNull, null], @param13=[String, System.String]]
2019-09-20 15:51:41,656 [1] DEBUG - Statement Id: [DAO00048_TT_PHAUTHUAT_GetList] PreparedStatement : [select *              from TT_PHAUTHUAT               where                             TT_PHAUTHUAT.LOAI = 'T'                       and                           TT_PHAUTHUAT.TIEPNHAN_ID = 27478                       and                           TT_PHAUTHUAT.BENHVIEN_ID = 'HLU01'                                     order by PHAUTHUAT_ID DESC]
2019-09-20 15:51:41,712 [1] DEBUG - Statement Id: [DAO00048_TT_PHAUTHUAT_GetDetail] PreparedStatement : [select PT.*, TN.BENHNHAN_ID              from              TT_PHAUTHUAT PT, TT_TIEPNHAN TN              where              PT.TIEPNHAN_ID = TN.TIEPNHAN_ID              AND PHAUTHUAT_ID  = 3747]
2019-09-20 15:51:41,757 [1] DEBUG - Statement Id: [DAO00048_CheckDVPhauThuatBHYT] PreparedStatement : [select count(0) from TT_VIENPHI          where REF_TABLE = 'TT_DVYEUCAU' and REF_ID = (select top 1 DVYEUCAU_ID from TT_PHAUTHUAT_YEUCAU where PHAUTHUAT_ID =  @param0 )          and TIEPNHAN_ID =  @param1  and BHYT_DONGIA > 0]
2019-09-20 15:51:41,757 [1] DEBUG - Statement Id: [DAO00048_CheckDVPhauThuatBHYT] Parameters: [@param0=[PHAUTHUAT_ID,3747], @param1=[TIEPNHAN_ID,27478]]
2019-09-20 15:51:41,757 [1] DEBUG - Statement Id: [DAO00048_CheckDVPhauThuatBHYT] Types: [@param0=[Int64, System.Int64], @param1=[Int64, System.Int64]]
2019-09-20 15:51:41,806 [1] DEBUG - Statement Id: [DAO00116_File_GetList] PreparedStatement : [select *              from TT_FILE_DINHKEM               where                             TT_FILE_DINHKEM.REF_TABLE = 'TT_PHAUTHUAT'                       and                           TT_FILE_DINHKEM.REF_ID = '3747'                       and                           TT_FILE_DINHKEM.BENHVIEN_ID = 'HLU01'                                     order by FILE_ID]
2019-09-20 15:51:41,878 [1] DEBUG - Statement Id: [DAO00048_TT_PHAUTHUAT_EKIP_GetDetail] PreparedStatement : [select *              from TT_PHAUTHUAT_EKIP              where PHAUTHUAT_ID  = 3747]
2019-09-20 15:51:45,983 [1] DEBUG - Statement Id: [DAO00066_GetBENHAN_TIEPNHAN] PreparedStatement : [select top 1 *        from TT_NOITRU_BENHAN        where TIEPNHAN_ID = '27478'  and BENHVIEN_ID = 'HLU01'        order by NGAYTAO desc]
2019-09-20 15:51:46,327 [1] DEBUG - Statement Id: [DAO00014_GetPatientStatus] PreparedStatement : [select        CASE        when tn.TRANGTHAI = 'HOANTHANH' Then tn.TRANGTHAI        WHEN xncp.XACNHANCHIPHI_ID is not null THEN 'XACNHANCHIPHI'        WHEN (tn.KHOADULIEU = '1') THEN 'KHOADULIEU'        ELSE tn.TRANGTHAI        END        as TRANGTHAI        from TT_TIEPNHAN tn        left join TT_XACNHANCHIPHI xncp on tn.TIEPNHAN_ID = xncp.TIEPNHAN_ID        where tn.TIEPNHAN_ID = '27478'        and tn.BENHVIEN_ID = 'HLU01']
2019-09-20 15:51:46,413 [1] DEBUG - Statement Id: [DAO00014_GetORMServiceStatus] PreparedStatement : [select dvyc.TRANGTHAI, pt.NGUOIKHOA_ID, pt.NGUOITAO_ID        from TT_PHAUTHUAT pt        left join TT_PHAUTHUAT_YEUCAU ptyc on ptyc.PHAUTHUAT_ID = pt.PHAUTHUAT_ID        left join (select * from TT_DVYEUCAU where exists (select DVYEUCAU_ID from TT_PHAUTHUAT where TT_DVYEUCAU.DVYEUCAU_ID = DVYEUCAU_ID and PHAUTHUAT_ID = '3747')) dvyc        on ptyc.DVYEUCAU_ID = dvyc.DVYEUCAU_ID        where pt.PHAUTHUAT_ID = '3747']
2019-09-20 15:51:46,519 [1] DEBUG - Statement Id: [DAO00066_GetBENHAN_TIEPNHAN] PreparedStatement : [select top 1 *        from TT_NOITRU_BENHAN        where TIEPNHAN_ID = '27478'  and BENHVIEN_ID = 'HLU01'        order by NGAYTAO desc]
2019-09-20 15:51:46,661 [1] DEBUG - Statement Id: [DAO00014_GetPatientStatus] PreparedStatement : [select        CASE        when tn.TRANGTHAI = 'HOANTHANH' Then tn.TRANGTHAI        WHEN xncp.XACNHANCHIPHI_ID is not null THEN 'XACNHANCHIPHI'        WHEN (tn.KHOADULIEU = '1') THEN 'KHOADULIEU'        ELSE tn.TRANGTHAI        END        as TRANGTHAI        from TT_TIEPNHAN tn        left join TT_XACNHANCHIPHI xncp on tn.TIEPNHAN_ID = xncp.TIEPNHAN_ID        where tn.TIEPNHAN_ID = '27478'        and tn.BENHVIEN_ID = 'HLU01']
2019-09-20 15:51:46,754 [1] DEBUG - Statement Id: [DAO00048_GetTrangThaiTruocKhiXoa_TuongTrinh] PreparedStatement : [IF 'LUU'='XOA'              BEGIN              IF EXISTS              (              SELECT PHAUTHUAT_VTYT_ID              FROM TT_PHAUTHUAT_VTYT WHERE PHAUTHUAT_ID='3747' AND BENHVIEN_ID='HLU01'              )              BEGIN              SELECT -1 AS RESULT              END              ELSE              BEGIN              IF EXISTS ( SELECT PHAUTHUAT_ID FROM TT_PHAUTHUAT WHERE PHAUTHUAT_ID='3747' AND BENHVIEN_ID='HLU01' AND KHOADULIEU='1' )              BEGIN              SELECT -2 AS RESULT, NGUOIKHOA_ID   FROM TT_PHAUTHUAT WHERE PHAUTHUAT_ID='3747' AND BENHVIEN_ID='HLU01' AND KHOADULIEU='1'              END              ELSE              BEGIN              IF NOT EXISTS (SELECT PHAUTHUAT_ID FROM TT_PHAUTHUAT WHERE PHAUTHUAT_ID='3747' AND BENHVIEN_ID='HLU01')              BEGIN              SELECT -3 AS RESULT              END              ELSE              BEGIN              SELECT 1 AS RESULT              END              END              END              END              ELSE IF 'LUU'='LUU'              BEGIN              IF EXISTS ( SELECT PHAUTHUAT_ID FROM TT_PHAUTHUAT WHERE PHAUTHUAT_ID='3747' AND BENHVIEN_ID='HLU01' AND KHOADULIEU='1' )              BEGIN              SELECT -2 AS RESULT              END              ELSE              BEGIN              SELECT 1 AS RESULT              END              END              ELSE              BEGIN              SELECT 10 AS RESULT              END]
2019-09-20 15:51:46,857 [1] DEBUG - Statement Id: [DAO00048_TT_PHAUTHUAT_Update] PreparedStatement : [update TT_PHAUTHUAT set              SOPHIEUPHAUTHUAT =  @param0               , LOAI =  @param1               , BENHAN_ID =  @param2               , LUUTRU_ID =  @param3               , TIEPNHAN_ID =  @param4               , PHONGBANTHUCHIEN_ID =  @param5               , NGAYTHUCHIEN =  @param6               , THOIGIANBATDAU =  @param7               , THOIGIANKETTHUC =  @param8               , ICD_VAOKHOA =  @param9               , ICD_VAOKHOA_MOTA =  @param10               , ICD_TRUOCPHAUTHUAT =  @param11               , ICD_TRUOCPHAUTHUAT_MOTA =  @param12               , ICD_SAUPHAUTHUAT =  @param13               , ICD_SAUPHAUTHUAT_MOTA =  @param14               , NHOMDICHVU_ID =  @param15               , DICHVU_ID =  @param16               , PHUONGPHAPVOCAM_ID =  @param17               , TAIBIEN_ID =  @param18               , CHEDO_ID =  @param19               , TUVONG_ID =  @param20               , TRINHTUTHUCHIEN =  @param21               , MOTA =  @param22               , KETQUA =  @param23               , BENHNHANBENNGOAI =  @param24               , NGUONBENH_ID =  @param25               , LOAIPHAUTHUAT =  @param26               , DANLUU =  @param27               , NGAYRUT =  @param28               , NGAYCATCHI =  @param29               , KHAC =  @param30               , SOLANMOLAI =  @param31               , LYDOMOLAI =  @param32               , CANTHIEPPHAUTHUAT =  @param33               , TUDIENKETQUA_ID =  @param34               , PHONGBANCHIDINH_ID =  @param35               , PPMO_ID =  @param36               , THOIGIANGAYME =  @param37               , KHOADULIEU =  @param38               , NGUOIKHOA_ID =  @param39               , TENNGUOIKHOA =  @param40               , NGAYKHOADULIEU =  @param41               , THOIGIANKHOADULIEU =  @param42                            , NGAYCAPNHAT =  @param43             , NGUOICAPNHAT_ID =  @param44             , BENHVIEN_ID =  @param45              ,               PHUONGPHAPPTTT =  @param46                            where              PHAUTHUAT_ID = 3747]
2019-09-20 15:51:46,857 [1] DEBUG - Statement Id: [DAO00048_TT_PHAUTHUAT_Update] Parameters: [@param0=[SOPHIEUPHAUTHUAT,19.T.03907], @param1=[LOAI,T], @param2=[BENHAN_ID,null], @param3=[LUUTRU_ID,null], @param4=[TIEPNHAN_ID,27478], @param5=[PHONGBANTHUCHIEN_ID,27], @param6=[NGAYTHUCHIEN,9/20/2019 3:51:46 PM], @param7=[THOIGIANBATDAU,9/20/2019 4:50:00 PM], @param8=[THOIGIANKETTHUC,9/20/2019 5:50:00 PM], @param9=[ICD_VAOKHOA,null], @param10=[ICD_VAOKHOA_MOTA,null], @param11=[ICD_TRUOCPHAUTHUAT,null], @param12=[ICD_TRUOCPHAUTHUAT_MOTA,null], @param13=[ICD_SAUPHAUTHUAT,null], @param14=[ICD_SAUPHAUTHUAT_MOTA,null], @param15=[NHOMDICHVU_ID,null], @param16=[DICHVU_ID,null], @param17=[PHUONGPHAPVOCAM_ID,null], @param18=[TAIBIEN_ID,null], @param19=[CHEDO_ID,768], @param20=[TUVONG_ID,null], @param21=[TRINHTUTHUCHIEN,null], @param22=[MOTA,null], @param23=[KETQUA,null], @param24=[BENHNHANBENNGOAI,null], @param25=[NGUONBENH_ID,745], @param26=[LOAIPHAUTHUAT,PTM], @param27=[DANLUU,null], @param28=[NGAYRUT,null], @param29=[NGAYCATCHI,null], @param30=[KHAC,null], @param31=[SOLANMOLAI,null], @param32=[LYDOMOLAI,null], @param33=[CANTHIEPPHAUTHUAT,null], @param34=[TUDIENKETQUA_ID,null], @param35=[PHONGBANCHIDINH_ID,null], @param36=[PPMO_ID,null], @param37=[THOIGIANGAYME,null], @param38=[KHOADULIEU,0], @param39=[NGUOIKHOA_ID,null], @param40=[TENNGUOIKHOA,null], @param41=[NGAYKHOADULIEU,null], @param42=[THOIGIANKHOADULIEU,null], @param43=[NGAYCAPNHAT,9/20/2019 3:51:46 PM], @param44=[NGUOICAPNHAT_ID,1], @param45=[BENHVIEN_ID,HLU01], @param46=[PHUONGPHAPPTTT,null]]
2019-09-20 15:51:46,857 [1] DEBUG - Statement Id: [DAO00048_TT_PHAUTHUAT_Update] Types: [@param0=[String, System.String], @param1=[String, System.String], @param2=[System.DBNull, null], @param3=[System.DBNull, null], @param4=[Int64, System.Int64], @param5=[Int64, System.Int64], @param6=[DateTime, System.DateTime], @param7=[DateTime, System.DateTime], @param8=[DateTime, System.DateTime], @param9=[System.DBNull, null], @param10=[System.DBNull, null], @param11=[System.DBNull, null], @param12=[System.DBNull, null], @param13=[System.DBNull, null], @param14=[System.DBNull, null], @param15=[System.DBNull, null], @param16=[System.DBNull, null], @param17=[System.DBNull, null], @param18=[System.DBNull, null], @param19=[Int64, System.Int64], @param20=[System.DBNull, null], @param21=[System.DBNull, null], @param22=[System.DBNull, null], @param23=[System.DBNull, null], @param24=[System.DBNull, null], @param25=[Int64, System.Int64], @param26=[String, System.String], @param27=[System.DBNull, null], @param28=[System.DBNull, null], @param29=[System.DBNull, null], @param30=[System.DBNull, null], @param31=[System.DBNull, null], @param32=[System.DBNull, null], @param33=[System.DBNull, null], @param34=[System.DBNull, null], @param35=[System.DBNull, null], @param36=[System.DBNull, null], @param37=[System.DBNull, null], @param38=[String, System.String], @param39=[System.DBNull, null], @param40=[System.DBNull, null], @param41=[System.DBNull, null], @param42=[System.DBNull, null], @param43=[DateTime, System.DateTime], @param44=[Int64, System.Int64], @param45=[String, System.String], @param46=[System.DBNull, null]]
2019-09-20 15:51:46,943 [1] DEBUG - Statement Id: [DAO00049_KiemtraloaiDV] PreparedStatement : [select DICHVU_ID AS HA, '' AS XN, '' as TDCN, '' as TT, '' as KB from TM_DICHVU            left join TM_NHOMDICHVU ndv on ndv.NHOMDICHVU_ID = TM_DICHVU.NHOMDICHVU_ID            where DICHVU_ID = '' and left(ndv.MANHOMDICHVU, 2) = '02'            union            select  '' as HA, DICHVU_ID AS XN, '' as TDCN, '' as TT, '' as KB from TM_DICHVU            left join TM_NHOMDICHVU ndv on ndv.NHOMDICHVU_ID = TM_DICHVU.NHOMDICHVU_ID            where DICHVU_ID = '' and left(ndv.MANHOMDICHVU, 2) = '01'            union            select  '' as HA, '' AS XN, DICHVU_ID as TDCN, '' as TT, '' as KB from TM_DICHVU            left join TM_NHOMDICHVU ndv on ndv.NHOMDICHVU_ID = TM_DICHVU.NHOMDICHVU_ID            where DICHVU_ID = '' and left(ndv.MANHOMDICHVU, 2) = '03'            union            select  '' as HA, '' AS XN, '' as TDCN, DICHVU_ID as TT, '' as KB from TM_DICHVU            left join TM_NHOMDICHVU ndv on ndv.NHOMDICHVU_ID = TM_DICHVU.NHOMDICHVU_ID            where DICHVU_ID = '' and left(ndv.MANHOMDICHVU, 2) = '05'            union            select  '' as HA, '' AS XN, '' as TDCN, DICHVU_ID as TT, '' as KB from TM_DICHVU            left join TM_NHOMDICHVU ndv on ndv.NHOMDICHVU_ID = TM_DICHVU.NHOMDICHVU_ID            where DICHVU_ID = '' and left(ndv.MANHOMDICHVU, 2) = '06'            union            select  '' as HA, '' AS XN, '' as TDCN, '' as TT, DICHVU_ID as KB from TM_DICHVU            left join TM_NHOMDICHVU ndv on ndv.NHOMDICHVU_ID = TM_DICHVU.NHOMDICHVU_ID            where DICHVU_ID = '' and left(ndv.MANHOMDICHVU, 2) = '04']
2019-09-20 15:51:47,001 [1] DEBUG - Statement Id: [DAO00009_GetThutiensauDVThuthuatPhauThuat] PreparedStatement : [select A.THUTIENSAU, B.SOTIEPNHAN, A.DICHVU_ID, A.DVYEUCAU_ID        from TT_DVYEUCAU A        inner join TT_TIEPNHAN B on B.TIEPNHAN_ID = A.TIEPNHAN_ID        inner join TT_PHAUTHUAT_YEUCAU C on C.DVYEUCAU_ID = A.DVYEUCAU_ID        where C.PHAUTHUAT_ID =  '3747']
2019-09-20 15:51:47,042 [1] DEBUG - Statement Id: [DAO00009_TT_TIEPNHAN_GetProcess] PreparedStatement : [select PROCESS_ID from TT_TIEPNHAN where SOTIEPNHAN = 'TN190920.0000001']
2019-09-20 15:51:47,107 [1] DEBUG - Statement Id: [DAOWF001_Kiemtrathongtindayeucaureturn] PreparedStatement : [select * from TT_REQUEST        where        PARA = '{"HOSPITAL_ID":"HLU01","SOTIEPNHAN":"TN190920.0000001"}']
2019-09-20 15:51:47,165 [1] DEBUG - Statement Id: [DAOWF001_Kiemtrathongtindichvudayeucaureturn] PreparedStatement : [select top 1 * from TT_REQUEST_SERVICE        where        PARA = '{"DICHVU_ID":"1111","DVYEUCAU_ID":"205442"}'  order by ID desc]
2019-09-20 15:51:47,221 [1] DEBUG - Statement Id: [DAOWF005_ReturnStateCuaDichVuYeuCau] PreparedStatement : [declare        @Detail_Id int,        @CurentState char(8),        @OldState char(8)          select top 1 @Detail_Id = ID, @CurentState = OLD_STATE_CODE, @OldState = CURR_STATE_CODE from TT_REQUEST_SERVICE_DETAIL        where        REQUEST_ID = '31779'        AND REQUEST_SERVICE_ID = '147389'        order by ID desc;          update TT_REQUEST_SERVICE set CURR_STATE_CODE = @CurentState, ISACTIVE = 1, ISCOMPLETE = 0 where ID = '147389';        delete from TT_REQUEST_SERVICE_DETAIL where ID = @Detail_Id;        insert into TT_REQUEST_SERVICE_HISTORY        (REQUEST_ID,REQUEST_SERVICE_ID, OLD_STATE_CODE, CURR_STATE_CODE) values ('31779','147389',@OldState, @CurentState);        select top 1 A.*, B.STATUS_CODE from TT_REQUEST_SERVICE A        left join TM_STATE B on A.CURR_STATE_CODE = B.STATE_CODE and A.PROCESS_CODE = B.PROCESS_CODE        where A.ID = '147389';]
2019-09-20 15:51:47,282 [1] DEBUG - Statement Id: [DAO00009_TT_DVYEUCAU_Update] PreparedStatement : [Update TT_DVYEUCAU set TRANGTHAI_WFL = 'CHUAKETQUA' where DVYEUCAU_ID = '205442']
2019-09-20 15:51:47,311 [1] DEBUG - Statement Id: [DAO00048_TT_PHAUTHUAT_YEUCAU_DeleteP] PreparedStatement : [delete from TT_PHAUTHUAT_YEUCAU             where                     TT_PHAUTHUAT_YEUCAU.PHAUTHUAT_ID = '3747']
2019-09-20 15:51:47,344 [1] DEBUG - Statement Id: [DAO00048_TT_PHAUTHUAT_PPVOCAM_DeleteP] PreparedStatement : [delete from TT_PHAUTHUAT_PPVOCAM              where PHAUTHUAT_ID = '3747']
2019-09-20 15:51:47,373 [1] DEBUG - Statement Id: [DAO00049_KiemtraloaiDV] PreparedStatement : [select DICHVU_ID AS HA, '' AS XN, '' as TDCN, '' as TT, '' as KB from TM_DICHVU            left join TM_NHOMDICHVU ndv on ndv.NHOMDICHVU_ID = TM_DICHVU.NHOMDICHVU_ID            where DICHVU_ID = '1111' and left(ndv.MANHOMDICHVU, 2) = '02'            union            select  '' as HA, DICHVU_ID AS XN, '' as TDCN, '' as TT, '' as KB from TM_DICHVU            left join TM_NHOMDICHVU ndv on ndv.NHOMDICHVU_ID = TM_DICHVU.NHOMDICHVU_ID            where DICHVU_ID = '1111' and left(ndv.MANHOMDICHVU, 2) = '01'            union            select  '' as HA, '' AS XN, DICHVU_ID as TDCN, '' as TT, '' as KB from TM_DICHVU            left join TM_NHOMDICHVU ndv on ndv.NHOMDICHVU_ID = TM_DICHVU.NHOMDICHVU_ID            where DICHVU_ID = '1111' and left(ndv.MANHOMDICHVU, 2) = '03'            union            select  '' as HA, '' AS XN, '' as TDCN, DICHVU_ID as TT, '' as KB from TM_DICHVU            left join TM_NHOMDICHVU ndv on ndv.NHOMDICHVU_ID = TM_DICHVU.NHOMDICHVU_ID            where DICHVU_ID = '1111' and left(ndv.MANHOMDICHVU, 2) = '05'            union            select  '' as HA, '' AS XN, '' as TDCN, DICHVU_ID as TT, '' as KB from TM_DICHVU            left join TM_NHOMDICHVU ndv on ndv.NHOMDICHVU_ID = TM_DICHVU.NHOMDICHVU_ID            where DICHVU_ID = '1111' and left(ndv.MANHOMDICHVU, 2) = '06'            union            select  '' as HA, '' AS XN, '' as TDCN, '' as TT, DICHVU_ID as KB from TM_DICHVU            left join TM_NHOMDICHVU ndv on ndv.NHOMDICHVU_ID = TM_DICHVU.NHOMDICHVU_ID            where DICHVU_ID = '1111' and left(ndv.MANHOMDICHVU, 2) = '04']
2019-09-20 15:51:47,406 [1] DEBUG - Statement Id: [DAO00009_GetThutiensauDVThuthuat] PreparedStatement : [select A.THUTIENSAU, B.SOTIEPNHAN, A.DICHVU_ID, A.DVYEUCAU_ID        from TT_DVYEUCAU A        inner join TT_TIEPNHAN B on B.TIEPNHAN_ID = A.TIEPNHAN_ID        where        A.DVYEUCAU_ID = '205442']
2019-09-20 15:51:47,436 [1] DEBUG - Statement Id: [DAO00009_TT_TIEPNHAN_GetProcess] PreparedStatement : [select PROCESS_ID from TT_TIEPNHAN where SOTIEPNHAN = 'TN190920.0000001']
2019-09-20 15:51:47,499 [1] DEBUG - Statement Id: [DAOWF001_Kiemtrathongtindayeucaudacochua] PreparedStatement : [select * from TT_REQUEST        where        PARA = '{"HOSPITAL_ID":"HLU01","SOTIEPNHAN":"TN190920.0000001"}'        AND ISACTIVE = '1']
2019-09-20 15:51:47,551 [1] DEBUG - Statement Id: [DAOWF001_Kiemtrathongtindichvudayeucau] PreparedStatement : [select top 1 * from TT_REQUEST_SERVICE        where        PARA = '{"DICHVU_ID":"1111","DVYEUCAU_ID":"205442"}'                AND ISACTIVE = '1' order by ID desc]
2019-09-20 15:51:47,580 [1] DEBUG - Statement Id: [DAOWF001_KiemtrathongtinchitietDichvuYeucau] PreparedStatement : [select * from TT_REQUEST_SERVICE_DETAIL        where        REQUEST_SERVICE_ID = '147389']
2019-09-20 15:51:47,643 [1] DEBUG - Statement Id: [DAOWF001_Laythongtinwithstatecode] PreparedStatement : [select A.*, B.STATUS_CODE from        TM_STATE_ACTION A        left join TM_STATE B on B.STATE_CODE = A.NEXT_STATE_CODE and A.PROCESS_CODE = B.PROCESS_CODE        where        A.CURR_STATE_CODE = '1     '        AND A.PROCESS_CODE = 'P02'        Order By ORDER_ID ASC]
2019-09-20 15:51:47,743 [1] DEBUG - Statement Id: [DAOWF003_Update] PreparedStatement : [update TT_REQUEST_SERVICE set        CURR_STATE_CODE =  @param0                   , ISACTIVE =  @param1                     , ISCOMPLETE =  @param2                        where        ID = '147389']
2019-09-20 15:51:47,743 [1] DEBUG - Statement Id: [DAOWF003_Update] Parameters: [@param0=[CURR_STATE_CODE,2], @param1=[ISACTIVE,1], @param2=[ISCOMPLETE,0]]
2019-09-20 15:51:47,743 [1] DEBUG - Statement Id: [DAOWF003_Update] Types: [@param0=[String, System.String], @param1=[String, System.String], @param2=[String, System.String]]
2019-09-20 15:51:47,773 [1] DEBUG - Statement Id: [DAOWF005_Add] PreparedStatement : [insert into TT_REQUEST_SERVICE_DETAIL (        REQUEST_ID        ,REQUEST_SERVICE_ID        , OLD_STATE_CODE        , CURR_STATE_CODE        ) values (         @param0         , @param1         ,  @param2         ,  @param3         )        SELECT SCOPE_IDENTITY()]
2019-09-20 15:51:47,773 [1] DEBUG - Statement Id: [DAOWF005_Add] Parameters: [@param0=[REQUEST_ID,31779], @param1=[REQUEST_SERVICE_ID,147389], @param2=[OLD_STATE_CODE,1     ], @param3=[CURR_STATE_CODE,2]]
2019-09-20 15:51:47,773 [1] DEBUG - Statement Id: [DAOWF005_Add] Types: [@param0=[String, System.String], @param1=[Int32, System.Int32], @param2=[String, System.String], @param3=[String, System.String]]
2019-09-20 15:51:47,804 [1] DEBUG - Statement Id: [DAOWF005_Add_History] PreparedStatement : [insert into TT_REQUEST_SERVICE_HISTORY (        REQUEST_ID        ,REQUEST_SERVICE_ID        , OLD_STATE_CODE        , CURR_STATE_CODE        ) values (         @param0         , @param1         ,  @param2         ,  @param3         )]
2019-09-20 15:51:47,804 [1] DEBUG - Statement Id: [DAOWF005_Add_History] Parameters: [@param0=[REQUEST_ID,31779], @param1=[REQUEST_SERVICE_ID,147389], @param2=[OLD_STATE_CODE,1     ], @param3=[CURR_STATE_CODE,2]]
2019-09-20 15:51:47,804 [1] DEBUG - Statement Id: [DAOWF005_Add_History] Types: [@param0=[String, System.String], @param1=[Int32, System.Int32], @param2=[String, System.String], @param3=[String, System.String]]
2019-09-20 15:51:47,835 [1] DEBUG - Statement Id: [DAO00009_TT_DVYEUCAU_Update] PreparedStatement : [Update TT_DVYEUCAU set TRANGTHAI_WFL = 'HOANTAT' where DVYEUCAU_ID = '205442']
2019-09-20 15:51:47,863 [1] DEBUG - Statement Id: [DAO00048_TT_PHAUTHUAT_YEUCAU_Add] PreparedStatement : [insert into TT_PHAUTHUAT_YEUCAU (              PHAUTHUAT_ID              , DVYEUCAU_ID              , NHOMDICHVU_ID              , DICHVU_ID              , LOAIGIA_ID              , THANHTIEN_DOANHTHU              , BHYT_THANHTIEN_CHITRA              , BENHNHAN_PHAITHANHTOAN              , BENHVIEN_ID              ) values (               @param0               ,  @param1               ,  @param2               ,  @param3               ,  @param4               ,  @param5               ,  @param6               ,  @param7               ,  @param8               )]
2019-09-20 15:51:47,863 [1] DEBUG - Statement Id: [DAO00048_TT_PHAUTHUAT_YEUCAU_Add] Parameters: [@param0=[PHAUTHUAT_ID,3747], @param1=[DVYEUCAU_ID,205442], @param2=[NHOMDICHVU_ID,38], @param3=[DICHVU_ID,1111], @param4=[LOAIGIA_ID,2], @param5=[THANHTIEN_DOANHTHU,37000], @param6=[BHYT_THANHTIEN_CHITRA,29600], @param7=[BENHNHAN_PHAITHANHTOAN,7400], @param8=[BENHVIEN_ID,HLU01]]
2019-09-20 15:51:47,863 [1] DEBUG - Statement Id: [DAO00048_TT_PHAUTHUAT_YEUCAU_Add] Types: [@param0=[Int64, System.Int64], @param1=[Int64, System.Int64], @param2=[Int64, System.Int64], @param3=[Int64, System.Int64], @param4=[Int64, System.Int64], @param5=[Double, System.Double], @param6=[Double, System.Double], @param7=[Double, System.Double], @param8=[String, System.String]]
2019-09-20 15:51:47,892 [1] DEBUG - Statement Id: [DAO00048_UpdateDVYeuCauVienPhi] PreparedStatement : [update  TT_VIENPHI              set DATHUCHIEN = '1',              NGUOICAPNHAT_ID =  @param0 ,              NGAYCAPNHAT =  @param1               where              VIENPHI_ID =  @param2]
2019-09-20 15:51:47,892 [1] DEBUG - Statement Id: [DAO00048_UpdateDVYeuCauVienPhi] Parameters: [@param0=[NGUOICAPNHAT_ID,1], @param1=[NGAYCAPNHAT,9/20/2019 3:51:47 PM], @param2=[VIENPHI_ID,674726]]
2019-09-20 15:51:47,892 [1] DEBUG - Statement Id: [DAO00048_UpdateDVYeuCauVienPhi] Types: [@param0=[Int64, System.Int64], @param1=[DateTime, System.DateTime], @param2=[Int64, System.Int64]]
2019-09-20 15:51:47,923 [1] DEBUG - Statement Id: [DAO00048_UpdateDVYeuCau] PreparedStatement : [update  TT_DVYEUCAU              set TRANGTHAI =  @param0 ,              NGUOICAPNHAT_ID =  @param1 ,              NGAYCAPNHAT =  @param2               where              DVYEUCAU_ID =  @param3]
2019-09-20 15:51:47,923 [1] DEBUG - Statement Id: [DAO00048_UpdateDVYeuCau] Parameters: [@param0=[TRANGTHAI,CHOXACNHAN], @param1=[NGUOICAPNHAT_ID,1], @param2=[NGAYCAPNHAT,9/20/2019 3:51:47 PM], @param3=[DVYEUCAU_ID,205442]]
2019-09-20 15:51:47,923 [1] DEBUG - Statement Id: [DAO00048_UpdateDVYeuCau] Types: [@param0=[String, System.String], @param1=[Int64, System.Int64], @param2=[DateTime, System.DateTime], @param3=[Int64, System.Int64]]
2019-09-20 15:51:47,983 [1] DEBUG - Statement Id: [DAO00048_TT_PHAUTHUAT_GetDetail] PreparedStatement : [select PT.*, TN.BENHNHAN_ID              from              TT_PHAUTHUAT PT, TT_TIEPNHAN TN              where              PT.TIEPNHAN_ID = TN.TIEPNHAN_ID              AND PHAUTHUAT_ID  = 3747]
2019-09-20 15:51:48,014 [1] DEBUG - Statement Id: [DAO00048_CheckDVPhauThuatBHYT] PreparedStatement : [select count(0) from TT_VIENPHI          where REF_TABLE = 'TT_DVYEUCAU' and REF_ID = (select top 1 DVYEUCAU_ID from TT_PHAUTHUAT_YEUCAU where PHAUTHUAT_ID =  @param0 )          and TIEPNHAN_ID =  @param1  and BHYT_DONGIA > 0]
2019-09-20 15:51:48,014 [1] DEBUG - Statement Id: [DAO00048_CheckDVPhauThuatBHYT] Parameters: [@param0=[PHAUTHUAT_ID,3747], @param1=[TIEPNHAN_ID,27478]]
2019-09-20 15:51:48,014 [1] DEBUG - Statement Id: [DAO00048_CheckDVPhauThuatBHYT] Types: [@param0=[Int64, System.Int64], @param1=[Int64, System.Int64]]
2019-09-20 15:51:48,051 [1] DEBUG - Statement Id: [DAO00116_File_GetList] PreparedStatement : [select *              from TT_FILE_DINHKEM               where                             TT_FILE_DINHKEM.REF_TABLE = 'TT_PHAUTHUAT'                       and                           TT_FILE_DINHKEM.REF_ID = '3747'                       and                           TT_FILE_DINHKEM.BENHVIEN_ID = 'HLU01'                                     order by FILE_ID]
2019-09-20 15:51:48,117 [1] DEBUG - Statement Id: [DAO00048_TT_PHAUTHUAT_YEUCAU_GetList] PreparedStatement : [SELECT YC.[PHAUTHUAT_YEUCAU_ID]              ,YC.[PHAUTHUAT_ID]              ,YC.[DVYEUCAU_ID]              ,YC.[NHOMDICHVU_ID]              ,YC.[DICHVU_ID]              ,YC.[LOAIGIA_ID]              ,VP.[BHYT_THANHTIEN_CHITRA]              ,VP.[BENHNHAN_PHAITHANHTOAN]              ,VP.[THANHTIEN_DOANHTHU]              ,YC.[BENHVIEN_ID]              ,DVYC.NGAYGIOYEUCAU              ,DV.TENDICHVU              ,NDV.TENNHOMDICHVU              FROM [TT_PHAUTHUAT_YEUCAU] YC              INNER JOIN TT_VIENPHI VP ON YC.DVYEUCAU_ID= VP.REF_ID AND VP.REF_TABLE ='TT_DVYEUCAU'              INNER JOIN TT_DVYEUCAU DVYC ON DVYC.DVYEUCAU_ID = YC.DVYEUCAU_ID              INNER JOIN TM_DICHVU DV ON DV.DICHVU_ID = DVYC.DICHVU_ID              INNER JOIN TM_NHOMDICHVU NDV ON NDV.NHOMDICHVU_ID = DV.NHOMDICHVU_ID               where                             YC.PHAUTHUAT_ID = '3747'                       and                           YC.BENHVIEN_ID = 'HLU01'                                     order by PHAUTHUAT_YEUCAU_ID]
2019-09-20 15:51:48,185 [1] DEBUG - Statement Id: [DAO00048_TT_PHAUTHUAT_PPVOCAM_GetDetail] PreparedStatement : [select *              from TT_PHAUTHUAT_PPVOCAM              where PHAUTHUAT_ID  = 3747]
2019-09-20 15:51:54,316 [1] DEBUG - Statement Id: [DAO00020_ListKhoDuocOfPhongBan] PreparedStatement : [select B.* from TM_PHONGBAN_KHODUOC A        inner join TM_KHODUOC B on B.KHODUOC_ID = A.KHODUOC_ID        where        A.PHONGBAN_ID = ''        and A.BENHVIEN_ID = 'HLU01']
2019-09-20 15:51:54,674 [1] DEBUG - Statement Id: [DAO00020_ListKhoDuocOfPhongBan] PreparedStatement : [select B.* from TM_PHONGBAN_KHODUOC A        inner join TM_KHODUOC B on B.KHODUOC_ID = A.KHODUOC_ID        where        A.PHONGBAN_ID = '27'        and A.BENHVIEN_ID = 'HLU01']
2019-09-20 15:51:59,617 [1] DEBUG - Statement Id: [DAO00020_ListKhoDuocOfPhongBan] PreparedStatement : [select B.* from TM_PHONGBAN_KHODUOC A        inner join TM_KHODUOC B on B.KHODUOC_ID = A.KHODUOC_ID        where        A.PHONGBAN_ID = '58'        and A.BENHVIEN_ID = 'HLU01']
2019-09-20 15:51:59,756 [1] DEBUG - Statement Id: [DAO00008_UpdateUserIdPhongBanKhoDuoc] PreparedStatement : [IF EXISTS            (SELECT ACCOUNT_ID FROM TM_SYS_USERS WHERE ACCOUNT_ID =  @param0  and HOSPITAL_ID =  @param1 )            BEGIN            update TM_SYS_USERS set INVENTORY_ID =  @param2 , WORKING_DEPT_ID =  @param3             WHERE ACCOUNT_ID =  @param0  and HOSPITAL_ID =  @param1             END            ELSE            BEGIN            insert into TM_SYS_USERS ([ACCOUNT_ID], [ACCOUNT_NAME], [INVENTORY_ID], [WORKING_DEPT_ID], [HOSPITAL_ID])            values ( @param0 ,  @param4 ,  @param2 ,  @param3 ,  @param1 )            END]
2019-09-20 15:51:59,756 [1] DEBUG - Statement Id: [DAO00008_UpdateUserIdPhongBanKhoDuoc] Parameters: [@param0=[ACCOUNT_ID,113], @param1=[HOSPITAL_ID,HLU01], @param2=[INVENTORY_ID,null], @param3=[WORKING_DEPT_ID,58], @param4=[ACCOUNT_NAME,admin]]
2019-09-20 15:51:59,756 [1] DEBUG - Statement Id: [DAO00008_UpdateUserIdPhongBanKhoDuoc] Types: [@param0=[String, System.String], @param1=[String, System.String], @param2=[System.DBNull, null], @param3=[String, System.String], @param4=[String, System.String]]
2019-09-20 15:52:24,241 [1] DEBUG - Statement Id: [DAO00019_GetDanhsachKhambenh] PreparedStatement : [select *        from        (SELECT COUNT(*) OVER() as TOTALROWS, ROW_NUMBER() OVER(order by isnull(dv.SOTHUTU,'999999999'), dv.NGAYGIOYEUCAU) as ROWNUMBER,        bn.MAYTE, bn.TENBENHNHAN, bn.NAMSINH, bn.NGAYSINH as TUOI, ISNULL(CONVERT(VARCHAR(10), bn.NGAYSINH, 103),CAST(bn.NAMSINH AS varchar)) as NGAYSINH, bn.DIACHILIENLAC as DIACHI, bn.GIOITINH, GD.DESCRIPTION as TENGIOITINH,        tn.DOITUONG_ID, tn.THOIGIANTIEPNHAN, tn.BENHNHAN_ID, tn.TIEPNHAN_ID, tn.TRAITUYEN, tn.SOTIEPNHAN,        dv.DICHVU_ID, dv.NOITHUCHIEN_ID, isnull(dv.NGAYTAO, dv.NGAYCAPNHAT) as THOIGIANDKDICHVU,        dv.KHAN, dv.NOIYEUCAU_ID, dv.NGAYGIOYEUCAU, dv.BACSICHIDINH_ID, dv.DONVIGIOITHIEU_ID, dv.NGUOIGIOITHIEU_ID,        tn.NOIGIOITHIEU_ID, kbnt.HUONGGIAIQUYET_ID,        dv.DVYEUCAU_ID, dv.MARIS, dv.TRANGTHAI as TRANGTHAICODE, B.TENNHOMDICHVU, dv.SOPHIEUYEUCAU, dv.KHAMBENH_NGOAITRU_ID, dv.NGUOICAPNHAT_ID, dv.NGAYCAPNHAT,        CASE WHEN Left(B.MANHOMDICHVU,2) = '03' THEN '02' ELSE Left(B.MANHOMDICHVU,2) END AS MANHOMDICHVU, B.MANHOMDICHVU as MANHOMDICHVUCHITIET, tn.TRANGTHAI as TRANGTHAI_TIEPNHAN,        'False' as DAKHAM, isnull(dv.SOTHUTU,'999999999') as SOHANGDOI,        vp.DATHANHTOAN, dv.TRANGTHAI_WFL,        BA.SOBENHAN, dv.CHANDOAN, dt.TENDOITUONG, isnull(kbnt.THOIGIANKHAM, dv.NGAYCAPNHAT) as THOIGIANKHAM,        tn.SOBHYT        FROM TT_DVYEUCAU (NOLOCK) dv        inner join TT_TIEPNHAN (NOLOCK) tn on dv.TIEPNHAN_ID = tn.TIEPNHAN_ID        inner join TT_BENHNHAN (NOLOCK) bn on tn.BENHNHAN_ID = bn.BENHNHAN_ID        inner join TM_DICHVU A on A.DICHVU_ID = dv.DICHVU_ID        inner join TM_NHOMDICHVU B on B.NHOMDICHVU_ID = A.NHOMDICHVU_ID        inner join TT_VIENPHI(NOLOCK) VP on VP.TIEPNHAN_ID = tn.TIEPNHAN_ID and VP.DICHVU_ID = dv.DICHVU_ID and VP.REF_ID = dv.DVYEUCAU_ID        left join TT_NOITRU_BENHAN (NOLOCK) BA on BA.TIEPNHAN_ID = tn.TIEPNHAN_ID AND dv.BENHAN_ID = BA.BENHAN_ID        inner join TM_GENDER GD on GD.ID = bn.GIOITINH        left join TT_NGOAITRU_KHAMBENH (NOLOCK) kbnt on kbnt.KHAMBENH_ID = dv.KHAMBENH_NGOAITRU_ID        inner join TM_DOITUONG dt on dt.DOITUONG_ID = tn.DOITUONG_ID        where        dv.DICHVU_ID IS NOT NULL        and tn.BENHVIEN_ID = 'HLU01'        and HUYYEUCAU = 0        and dv.NGAYHENCLS is NULL         and           dv.NGAYYEUCAU >= '9/20/2019 12:00:00 AM'         and           dv.NGAYYEUCAU <= '9/20/2019 12:00:00 AM'         and           dv.NOITHUCHIEN_ID = 58          AND             (                         ((dv.TRANGTHAI_WFL = 'CHUAKETQUA' or (dv.TRANGTHAI = 'CHUAKETQUA' and dv.TRANGTHAI_WFL = 'HOANTHANH')) and (isnull(kbnt.HUONGGIAIQUYET_ID, 0) = 0)))            and (tn.TRANGTHAI != 'HOANTHANH')           and           (CASE WHEN Left(B.MANHOMDICHVU,2) = '03' THEN '02' ELSE Left(B.MANHOMDICHVU,2) END) = '04'                 ) lst                    where          lst.ROWNUMBER between 1 and 20                 order by SOHANGDOI, NGAYGIOYEUCAU asc]
2019-09-20 15:52:27,852 [1] DEBUG - Statement Id: [DAO00019_GetDanhsachKhambenh] PreparedStatement : [select *        from        (SELECT COUNT(*) OVER() as TOTALROWS, ROW_NUMBER() OVER(order by isnull(dv.SOTHUTU,'999999999'), dv.NGAYGIOYEUCAU) as ROWNUMBER,        bn.MAYTE, bn.TENBENHNHAN, bn.NAMSINH, bn.NGAYSINH as TUOI, ISNULL(CONVERT(VARCHAR(10), bn.NGAYSINH, 103),CAST(bn.NAMSINH AS varchar)) as NGAYSINH, bn.DIACHILIENLAC as DIACHI, bn.GIOITINH, GD.DESCRIPTION as TENGIOITINH,        tn.DOITUONG_ID, tn.THOIGIANTIEPNHAN, tn.BENHNHAN_ID, tn.TIEPNHAN_ID, tn.TRAITUYEN, tn.SOTIEPNHAN,        dv.DICHVU_ID, dv.NOITHUCHIEN_ID, isnull(dv.NGAYTAO, dv.NGAYCAPNHAT) as THOIGIANDKDICHVU,        dv.KHAN, dv.NOIYEUCAU_ID, dv.NGAYGIOYEUCAU, dv.BACSICHIDINH_ID, dv.DONVIGIOITHIEU_ID, dv.NGUOIGIOITHIEU_ID,        tn.NOIGIOITHIEU_ID, kbnt.HUONGGIAIQUYET_ID,        dv.DVYEUCAU_ID, dv.MARIS, dv.TRANGTHAI as TRANGTHAICODE, B.TENNHOMDICHVU, dv.SOPHIEUYEUCAU, dv.KHAMBENH_NGOAITRU_ID, dv.NGUOICAPNHAT_ID, dv.NGAYCAPNHAT,        CASE WHEN Left(B.MANHOMDICHVU,2) = '03' THEN '02' ELSE Left(B.MANHOMDICHVU,2) END AS MANHOMDICHVU, B.MANHOMDICHVU as MANHOMDICHVUCHITIET, tn.TRANGTHAI as TRANGTHAI_TIEPNHAN,        'True' as DAKHAM, isnull(dv.SOTHUTU,'999999999') as SOHANGDOI,        vp.DATHANHTOAN, dv.TRANGTHAI_WFL,        BA.SOBENHAN, dv.CHANDOAN, dt.TENDOITUONG, isnull(kbnt.THOIGIANKHAM, dv.NGAYCAPNHAT) as THOIGIANKHAM,        tn.SOBHYT        FROM TT_DVYEUCAU (NOLOCK) dv        inner join TT_TIEPNHAN (NOLOCK) tn on dv.TIEPNHAN_ID = tn.TIEPNHAN_ID        inner join TT_BENHNHAN (NOLOCK) bn on tn.BENHNHAN_ID = bn.BENHNHAN_ID        inner join TM_DICHVU A on A.DICHVU_ID = dv.DICHVU_ID        inner join TM_NHOMDICHVU B on B.NHOMDICHVU_ID = A.NHOMDICHVU_ID        inner join TT_VIENPHI(NOLOCK) VP on VP.TIEPNHAN_ID = tn.TIEPNHAN_ID and VP.DICHVU_ID = dv.DICHVU_ID and VP.REF_ID = dv.DVYEUCAU_ID        left join TT_NOITRU_BENHAN (NOLOCK) BA on BA.TIEPNHAN_ID = tn.TIEPNHAN_ID AND dv.BENHAN_ID = BA.BENHAN_ID        inner join TM_GENDER GD on GD.ID = bn.GIOITINH        left join TT_NGOAITRU_KHAMBENH (NOLOCK) kbnt on kbnt.KHAMBENH_ID = dv.KHAMBENH_NGOAITRU_ID        inner join TM_DOITUONG dt on dt.DOITUONG_ID = tn.DOITUONG_ID        where        dv.DICHVU_ID IS NOT NULL        and tn.BENHVIEN_ID = 'HLU01'        and HUYYEUCAU = 0        and dv.NGAYHENCLS is NULL         and           dv.NGAYYEUCAU >= '9/20/2019 12:00:00 AM'         and           dv.NGAYYEUCAU <= '9/20/2019 12:00:00 AM'         and           dv.NOITHUCHIEN_ID = 58          AND              (dv.TRANGTHAI != 'CHUAKETQUA' or isnull(kbnt.HUONGGIAIQUYET_ID, 0) > 0)           and           (CASE WHEN Left(B.MANHOMDICHVU,2) = '03' THEN '02' ELSE Left(B.MANHOMDICHVU,2) END) = '04'                 ) lst                    where          lst.ROWNUMBER between 1 and 20                 order by SOHANGDOI, NGAYGIOYEUCAU asc]
2019-09-20 15:52:34,292 [1] DEBUG - Statement Id: [DAO00017_GetLoaiGiaByDoiTuongId] PreparedStatement : [select dtlg.DOUUTIEN, dtlg.DOITUONG_ID, lg.LOAIGIA_ID, lg.TENLOAIGIA, lg.MALOAIGIA              from TM_LOAIGIA lg              left join TM_DOITUONG_LOAIGIA dtlg              on lg.LOAIGIA_ID = dtlg.LOAIGIA_ID and dtlg.BENHVIEN_ID = 'HLU01'              where lg.TAMNGUNG = 0 and lg.BENHVIEN_ID = 'HLU01'                             order by dtlg.DOUUTIEN]
2019-09-20 15:52:34,415 [1] DEBUG - Statement Id: [DAO00014_KiemTraDVYCCoBHYT] PreparedStatement : [select *        from TT_VIENPHI        where REF_ID  = '' and REF_TABLE = 'TT_DVYEUCAU' and BHYT_DONGIA > 0]
2019-09-20 15:52:34,477 [1] DEBUG - Statement Id: [DAO00040_LayListToaMau] PreparedStatement : [select A.*, dc.TENDUOCDAYDU, dc.BHYT DUOC_BHYT, ld.LOAIVATTU_ID, ld.MALOAIDUOC, dd.DICTIONARY_NAME DUONGDUNG, dc.TAMNGUNG            from TT_TOATHUOCMAU A            left join TM_DUOC dc on A.DUOC_ID = dc.DUOC_ID            left join TM_LOAIDUOC ld on dc.LOAIDUOC_ID = ld.LOAIDUOC_ID            left join (select * from LST_DICTIONARY where DICTIONARY_TYPE_CODE like 'DuongDung') dd on dd.DICTIONARY_ID = dc.DUONGDUNG_ID            where (1=1)             and               A.BACSI_ID  = 1              and A.LOAITOATHUOC in  (                        @param0                   ,                           @param1                   ,                           @param2                   ,                           @param3                   )]
2019-09-20 15:52:34,477 [1] DEBUG - Statement Id: [DAO00040_LayListToaMau] Parameters: [@param0=[LSTLOAITOATHUOC[0],BV], @param1=[LSTLOAITOATHUOC[1],MN], @param2=[LSTLOAITOATHUOC[2],MP], @param3=[LSTLOAITOATHUOC[3],TV]]
2019-09-20 15:52:34,477 [1] DEBUG - Statement Id: [DAO00040_LayListToaMau] Types: [@param0=[String, System.String], @param1=[String, System.String], @param2=[String, System.String], @param3=[String, System.String]]
2019-09-20 15:52:34,584 [1] DEBUG - Statement Id: [DAO00040_LayListToaMau] PreparedStatement : [select A.*, dc.TENDUOCDAYDU, dc.BHYT DUOC_BHYT, ld.LOAIVATTU_ID, ld.MALOAIDUOC, dd.DICTIONARY_NAME DUONGDUNG, dc.TAMNGUNG            from TT_TOATHUOCMAU A            left join TM_DUOC dc on A.DUOC_ID = dc.DUOC_ID            left join TM_LOAIDUOC ld on dc.LOAIDUOC_ID = ld.LOAIDUOC_ID            left join (select * from LST_DICTIONARY where DICTIONARY_TYPE_CODE like 'DuongDung') dd on dd.DICTIONARY_ID = dc.DUONGDUNG_ID            where (1=1)             and               A.BACSI_ID  = 1              and A.LOAITOATHUOC in  (                        @param0                   ,                           @param1                   ,                           @param2                   ,                           @param3                   )]
2019-09-20 15:52:34,584 [1] DEBUG - Statement Id: [DAO00040_LayListToaMau] Parameters: [@param0=[LSTLOAITOATHUOC[0],BV], @param1=[LSTLOAITOATHUOC[1],MN], @param2=[LSTLOAITOATHUOC[2],MP], @param3=[LSTLOAITOATHUOC[3],TV]]
2019-09-20 15:52:34,584 [1] DEBUG - Statement Id: [DAO00040_LayListToaMau] Types: [@param0=[String, System.String], @param1=[String, System.String], @param2=[String, System.String], @param3=[String, System.String]]
2019-09-20 15:52:34,639 [1] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoVaBookingCOM23UpdateRedis_TheoPhamvi] PreparedStatement : [declare @TOAMUANGOAI int = 0;        select @TOAMUANGOAI = isnull(VALUE,0) from TM_SYS_APPSETTINGS where CODE = 'OPD_TOAMUANGOAI_DUNGDANHMUC_DUOC'                if @TOAMUANGOAI = 1        begin        select  distinct '0' + '_' + LTRIM(d.DUOC_ID) + '_' + '0' as DUOC_KEY, 999999999 as SOLUONG        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        where  @param0  = 0        union all        select distinct tk.DUOC_KEY, tk.SOLUONG        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        inner join        (        select  LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')) DUOC_KEY, (SUM(dtk.SOLUONG) - isnull(sum(A.SOLUONG),0) - isnull(sum(B.SOLUONG),0)) SOLUONG, pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        from (select sum(soluong) soluong,duoc_id,nguonduoc_id,khoduoc_id,benhvien_id from TT_DUOC_TONKHO  group by duoc_id,nguonduoc_id,khoduoc_id,benhvien_id) dtk        inner join TM_DUOC_PHAMVISD_MAPPING pvsd on dtk.KHODUOC_ID = pvsd.KHODUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NOITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) B on B.DUOC_ID = dtk.DUOC_ID and B.PHAMVI_ID = pvsd.PHAMVI_ID and B.NGUONHANG_ID = dtk.NGUONDUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NGOAITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) A on A.DUOC_ID = dtk.DUOC_ID and A.PHAMVI_ID = pvsd.PHAMVI_ID and A.NGUONHANG_ID = dtk.NGUONDUOC_ID        where dtk.BENHVIEN_ID = 'HLU01'        group by LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')), pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        ) tk on tk.DUOC_ID = d.DUOC_ID        left join TM_DUOC_PHAMVISUDUNG kd on kd.PHAMVI_ID = tk.PHAMVI_ID and kd.BENHVIEN_ID = 'HLU01'        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = tk.NGUONDUOC_ID and nh.BENHVIEN_ID = 'HLU01'        where d.BENHVIEN_ID = 'HLU01' and tk.PHAMVI_ID =  @param0         end        else        begin        select distinct tk.DUOC_KEY, tk.SOLUONG        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        inner join        (        select  LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')) DUOC_KEY, (SUM(dtk.SOLUONG) - isnull(sum(A.SOLUONG),0) - isnull(sum(B.SOLUONG),0)) SOLUONG, pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        from (select sum(soluong) soluong,duoc_id,nguonduoc_id,khoduoc_id,benhvien_id from TT_DUOC_TONKHO  group by duoc_id,nguonduoc_id,khoduoc_id,benhvien_id) dtk        inner join TM_DUOC_PHAMVISD_MAPPING pvsd on dtk.KHODUOC_ID = pvsd.KHODUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NOITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) B on B.DUOC_ID = dtk.DUOC_ID and B.PHAMVI_ID = pvsd.PHAMVI_ID and B.NGUONHANG_ID = dtk.NGUONDUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NGOAITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) A on A.DUOC_ID = dtk.DUOC_ID and A.PHAMVI_ID = pvsd.PHAMVI_ID and A.NGUONHANG_ID = dtk.NGUONDUOC_ID        where dtk.BENHVIEN_ID = 'HLU01'        group by LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')), pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        ) tk on tk.DUOC_ID = d.DUOC_ID        left join TM_DUOC_PHAMVISUDUNG kd on kd.PHAMVI_ID = tk.PHAMVI_ID and kd.BENHVIEN_ID = 'HLU01'        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = tk.NGUONDUOC_ID and nh.BENHVIEN_ID = 'HLU01'        where d.BENHVIEN_ID = 'HLU01' and tk.PHAMVI_ID =  @param0         end]
2019-09-20 15:52:34,639 [1] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoVaBookingCOM23UpdateRedis_TheoPhamvi] Parameters: [@param0=[PHAMVI_ID,1033]]
2019-09-20 15:52:34,639 [1] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoVaBookingCOM23UpdateRedis_TheoPhamvi] Types: [@param0=[Int64, System.Int64]]
2019-09-20 15:52:35,016 [1] DEBUG - Statement Id: [DAO00019_ThongTinBenhNhanDvYeuCau] PreparedStatement : [select distinct A.SOTIEPNHAN, A.TIEPNHAN_ID, A.DOITUONG_ID, A.TRANGTHAI,        A.LOAITHANHVIEN_ID, A.SUDUNG_BHTN, A.THE_ID, A.THANHVIEN_ID, A.VIP, A.NGUON_BENHNHAN_ID, A.BAOLANH_VIENPHI, A.NGAYMIENDONGCHITRA,        B.*,  C.DICHVU_ID, C.DVYEUCAU_ID, C.NOITHUCHIEN_ID, A.SOBHYT        from TT_TIEPNHAN A        inner join TT_DVYEUCAU C on C.TIEPNHAN_ID = A.TIEPNHAN_ID        inner join TT_BENHNHAN B on B.BENHNHAN_ID = A.BENHNHAN_ID and B.ACTIVE = '1'        where                    C.DVYEUCAU_ID = '205440'                 and A.BENHVIEN_ID = 'HLU01']
2019-09-20 15:52:35,143 [1] DEBUG - Statement Id: [DAO00017_GetLoaiGiaByDoiTuongId] PreparedStatement : [select dtlg.DOUUTIEN, dtlg.DOITUONG_ID, lg.LOAIGIA_ID, lg.TENLOAIGIA, lg.MALOAIGIA              from TM_LOAIGIA lg              left join TM_DOITUONG_LOAIGIA dtlg              on lg.LOAIGIA_ID = dtlg.LOAIGIA_ID and dtlg.BENHVIEN_ID = 'HLU01'              where lg.TAMNGUNG = 0 and lg.BENHVIEN_ID = 'HLU01'                             order by dtlg.DOUUTIEN]
2019-09-20 15:52:35,184 [1] DEBUG - Statement Id: [DAO00014_KiemTraDVYCCoBHYT] PreparedStatement : [select *        from TT_VIENPHI        where REF_ID  = '205440' and REF_TABLE = 'TT_DVYEUCAU' and BHYT_DONGIA > 0]
2019-09-20 15:52:35,226 [1] DEBUG - Statement Id: [DAO00040_LayListToaMau] PreparedStatement : [select A.*, dc.TENDUOCDAYDU, dc.BHYT DUOC_BHYT, ld.LOAIVATTU_ID, ld.MALOAIDUOC, dd.DICTIONARY_NAME DUONGDUNG, dc.TAMNGUNG            from TT_TOATHUOCMAU A            left join TM_DUOC dc on A.DUOC_ID = dc.DUOC_ID            left join TM_LOAIDUOC ld on dc.LOAIDUOC_ID = ld.LOAIDUOC_ID            left join (select * from LST_DICTIONARY where DICTIONARY_TYPE_CODE like 'DuongDung') dd on dd.DICTIONARY_ID = dc.DUONGDUNG_ID            where (1=1)             and               A.BACSI_ID  = 1              and A.LOAITOATHUOC in  (                        @param0                   ,                           @param1                   ,                           @param2                   ,                           @param3                   )]
2019-09-20 15:52:35,226 [1] DEBUG - Statement Id: [DAO00040_LayListToaMau] Parameters: [@param0=[LSTLOAITOATHUOC[0],BV], @param1=[LSTLOAITOATHUOC[1],MN], @param2=[LSTLOAITOATHUOC[2],MP], @param3=[LSTLOAITOATHUOC[3],TV]]
2019-09-20 15:52:35,226 [1] DEBUG - Statement Id: [DAO00040_LayListToaMau] Types: [@param0=[String, System.String], @param1=[String, System.String], @param2=[String, System.String], @param3=[String, System.String]]
2019-09-20 15:52:35,333 [1] DEBUG - Statement Id: [DAO00040_LayListToaMau] PreparedStatement : [select A.*, dc.TENDUOCDAYDU, dc.BHYT DUOC_BHYT, ld.LOAIVATTU_ID, ld.MALOAIDUOC, dd.DICTIONARY_NAME DUONGDUNG, dc.TAMNGUNG            from TT_TOATHUOCMAU A            left join TM_DUOC dc on A.DUOC_ID = dc.DUOC_ID            left join TM_LOAIDUOC ld on dc.LOAIDUOC_ID = ld.LOAIDUOC_ID            left join (select * from LST_DICTIONARY where DICTIONARY_TYPE_CODE like 'DuongDung') dd on dd.DICTIONARY_ID = dc.DUONGDUNG_ID            where (1=1)             and               A.BACSI_ID  = 1              and A.LOAITOATHUOC in  (                        @param0                   ,                           @param1                   ,                           @param2                   ,                           @param3                   )]
2019-09-20 15:52:35,333 [1] DEBUG - Statement Id: [DAO00040_LayListToaMau] Parameters: [@param0=[LSTLOAITOATHUOC[0],BV], @param1=[LSTLOAITOATHUOC[1],MN], @param2=[LSTLOAITOATHUOC[2],MP], @param3=[LSTLOAITOATHUOC[3],TV]]
2019-09-20 15:52:35,333 [1] DEBUG - Statement Id: [DAO00040_LayListToaMau] Types: [@param0=[String, System.String], @param1=[String, System.String], @param2=[String, System.String], @param3=[String, System.String]]
2019-09-20 15:52:35,394 [1] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoVaBookingCOM23UpdateRedis_TheoPhamvi] PreparedStatement : [declare @TOAMUANGOAI int = 0;        select @TOAMUANGOAI = isnull(VALUE,0) from TM_SYS_APPSETTINGS where CODE = 'OPD_TOAMUANGOAI_DUNGDANHMUC_DUOC'                if @TOAMUANGOAI = 1        begin        select  distinct '0' + '_' + LTRIM(d.DUOC_ID) + '_' + '0' as DUOC_KEY, 999999999 as SOLUONG        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        where  @param0  = 0        union all        select distinct tk.DUOC_KEY, tk.SOLUONG        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        inner join        (        select  LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')) DUOC_KEY, (SUM(dtk.SOLUONG) - isnull(sum(A.SOLUONG),0) - isnull(sum(B.SOLUONG),0)) SOLUONG, pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        from (select sum(soluong) soluong,duoc_id,nguonduoc_id,khoduoc_id,benhvien_id from TT_DUOC_TONKHO  group by duoc_id,nguonduoc_id,khoduoc_id,benhvien_id) dtk        inner join TM_DUOC_PHAMVISD_MAPPING pvsd on dtk.KHODUOC_ID = pvsd.KHODUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NOITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) B on B.DUOC_ID = dtk.DUOC_ID and B.PHAMVI_ID = pvsd.PHAMVI_ID and B.NGUONHANG_ID = dtk.NGUONDUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NGOAITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) A on A.DUOC_ID = dtk.DUOC_ID and A.PHAMVI_ID = pvsd.PHAMVI_ID and A.NGUONHANG_ID = dtk.NGUONDUOC_ID        where dtk.BENHVIEN_ID = 'HLU01'        group by LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')), pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        ) tk on tk.DUOC_ID = d.DUOC_ID        left join TM_DUOC_PHAMVISUDUNG kd on kd.PHAMVI_ID = tk.PHAMVI_ID and kd.BENHVIEN_ID = 'HLU01'        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = tk.NGUONDUOC_ID and nh.BENHVIEN_ID = 'HLU01'        where d.BENHVIEN_ID = 'HLU01' and tk.PHAMVI_ID =  @param0         end        else        begin        select distinct tk.DUOC_KEY, tk.SOLUONG        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        inner join        (        select  LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')) DUOC_KEY, (SUM(dtk.SOLUONG) - isnull(sum(A.SOLUONG),0) - isnull(sum(B.SOLUONG),0)) SOLUONG, pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        from (select sum(soluong) soluong,duoc_id,nguonduoc_id,khoduoc_id,benhvien_id from TT_DUOC_TONKHO  group by duoc_id,nguonduoc_id,khoduoc_id,benhvien_id) dtk        inner join TM_DUOC_PHAMVISD_MAPPING pvsd on dtk.KHODUOC_ID = pvsd.KHODUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NOITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) B on B.DUOC_ID = dtk.DUOC_ID and B.PHAMVI_ID = pvsd.PHAMVI_ID and B.NGUONHANG_ID = dtk.NGUONDUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NGOAITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) A on A.DUOC_ID = dtk.DUOC_ID and A.PHAMVI_ID = pvsd.PHAMVI_ID and A.NGUONHANG_ID = dtk.NGUONDUOC_ID        where dtk.BENHVIEN_ID = 'HLU01'        group by LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')), pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        ) tk on tk.DUOC_ID = d.DUOC_ID        left join TM_DUOC_PHAMVISUDUNG kd on kd.PHAMVI_ID = tk.PHAMVI_ID and kd.BENHVIEN_ID = 'HLU01'        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = tk.NGUONDUOC_ID and nh.BENHVIEN_ID = 'HLU01'        where d.BENHVIEN_ID = 'HLU01' and tk.PHAMVI_ID =  @param0         end]
2019-09-20 15:52:35,394 [1] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoVaBookingCOM23UpdateRedis_TheoPhamvi] Parameters: [@param0=[PHAMVI_ID,1028]]
2019-09-20 15:52:35,394 [1] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoVaBookingCOM23UpdateRedis_TheoPhamvi] Types: [@param0=[Int64, System.Int64]]
2019-09-20 15:52:35,602 [1] DEBUG - Statement Id: [DAO00013_GetTienSuBenh] PreparedStatement : [select TIENSUBENH, TIENSUDIUNG              from TT_BENHNHAN              where TT_BENHNHAN.BENHNHAN_ID  = '23423']
2019-09-20 15:52:35,630 [1] DEBUG - Statement Id: [DAO00095_GetTTDiUngThuoc] PreparedStatement : [select *              from TT_BENHNHAN_DIUNG_THUOC              where BENHNHAN_ID = '23423'              and BENHVIEN_ID = 'HLU01']
2019-09-20 15:52:35,659 [1] DEBUG - Statement Id: [DAO00014_GetTotalChiPhiDVByTiepNhan] PreparedStatement : [select sum(THANHTIEN_DOANHTHU) as THANHTIEN_DOANHTHU from TT_VIENPHI        where ACTIVE = '1'        and TIEPNHAN_ID = '27478'        and REF_TABLE = 'TT_DVYEUCAU'        and exists (select DVYEUCAU_ID from TT_DVYEUCAU where HUYYEUCAU = '0' and TIEPNHAN_ID = '27478' and TT_VIENPHI.REF_ID = DVYEUCAU_ID)]
2019-09-20 15:52:35,693 [1] DEBUG - Statement Id: [DAO00014_GetKhamBenhInfo] PreparedStatement : [select * from TT_NGOAITRU_KHAMBENH where KHAMBENH_ID =        (select KHAMBENH_NGOAITRU_ID from TT_DVYEUCAU where DVYEUCAU_ID = '205440')]
2019-09-20 15:52:35,725 [1] DEBUG - Statement Id: [DAO00068_GetSinhHieuBySinhHieuID] PreparedStatement : [select top (1) *            from TT_NGOAITRU_KHAMBENH_SINHHIEU            where KHAMBENH_SINHHIEU_ID = '0'            and BENHVIEN_ID = 'HLU01'             and               BENHNHAN_ID = '23423'                           order by KHAMBENH_SINHHIEU_ID]
2019-09-20 15:52:35,821 [1] DEBUG - Statement Id: [DAO00014_GetKhamBenhICDInfo] PreparedStatement : [select *        from TT_NGOAITRU_KHAMBENH_ICD        where KHAMBENH_ID  = '26172']
2019-09-20 15:52:35,851 [1] DEBUG - Statement Id: [DAO00014_GetListToaThuoc] PreparedStatement : [select A.*        from TT_NGOAITRU_KHAMBENH_TOATHUOC A        where A.KHAMBENH_ID = '26172']
2019-09-20 15:52:35,881 [1] DEBUG - Statement Id: [DAO00014_KiemTraDVYCCoBHYT] PreparedStatement : [select *        from TT_VIENPHI        where REF_ID  = '205440' and REF_TABLE = 'TT_DVYEUCAU' and BHYT_DONGIA > 0]
2019-09-20 15:52:35,926 [1] DEBUG - Statement Id: [DAO00040_LayListToaMau] PreparedStatement : [select A.*, dc.TENDUOCDAYDU, dc.BHYT DUOC_BHYT, ld.LOAIVATTU_ID, ld.MALOAIDUOC, dd.DICTIONARY_NAME DUONGDUNG, dc.TAMNGUNG            from TT_TOATHUOCMAU A            left join TM_DUOC dc on A.DUOC_ID = dc.DUOC_ID            left join TM_LOAIDUOC ld on dc.LOAIDUOC_ID = ld.LOAIDUOC_ID            left join (select * from LST_DICTIONARY where DICTIONARY_TYPE_CODE like 'DuongDung') dd on dd.DICTIONARY_ID = dc.DUONGDUNG_ID            where (1=1)             and               A.BACSI_ID  = 1              and A.LOAITOATHUOC in  (                        @param0                   ,                           @param1                   ,                           @param2                   ,                           @param3                   )]
2019-09-20 15:52:35,926 [1] DEBUG - Statement Id: [DAO00040_LayListToaMau] Parameters: [@param0=[LSTLOAITOATHUOC[0],BV], @param1=[LSTLOAITOATHUOC[1],MN], @param2=[LSTLOAITOATHUOC[2],MP], @param3=[LSTLOAITOATHUOC[3],TV]]
2019-09-20 15:52:35,926 [1] DEBUG - Statement Id: [DAO00040_LayListToaMau] Types: [@param0=[String, System.String], @param1=[String, System.String], @param2=[String, System.String], @param3=[String, System.String]]
2019-09-20 15:52:36,034 [1] DEBUG - Statement Id: [DAO00040_LayListToaMau] PreparedStatement : [select A.*, dc.TENDUOCDAYDU, dc.BHYT DUOC_BHYT, ld.LOAIVATTU_ID, ld.MALOAIDUOC, dd.DICTIONARY_NAME DUONGDUNG, dc.TAMNGUNG            from TT_TOATHUOCMAU A            left join TM_DUOC dc on A.DUOC_ID = dc.DUOC_ID            left join TM_LOAIDUOC ld on dc.LOAIDUOC_ID = ld.LOAIDUOC_ID            left join (select * from LST_DICTIONARY where DICTIONARY_TYPE_CODE like 'DuongDung') dd on dd.DICTIONARY_ID = dc.DUONGDUNG_ID            where (1=1)             and               A.BACSI_ID  = 1              and A.LOAITOATHUOC in  (                        @param0                   ,                           @param1                   ,                           @param2                   ,                           @param3                   )]
2019-09-20 15:52:36,034 [1] DEBUG - Statement Id: [DAO00040_LayListToaMau] Parameters: [@param0=[LSTLOAITOATHUOC[0],BV], @param1=[LSTLOAITOATHUOC[1],MN], @param2=[LSTLOAITOATHUOC[2],MP], @param3=[LSTLOAITOATHUOC[3],TV]]
2019-09-20 15:52:36,034 [1] DEBUG - Statement Id: [DAO00040_LayListToaMau] Types: [@param0=[String, System.String], @param1=[String, System.String], @param2=[String, System.String], @param3=[String, System.String]]
2019-09-20 15:52:36,069 [1] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoVaBookingCOM23UpdateRedis_TheoPhamvi] PreparedStatement : [declare @TOAMUANGOAI int = 0;        select @TOAMUANGOAI = isnull(VALUE,0) from TM_SYS_APPSETTINGS where CODE = 'OPD_TOAMUANGOAI_DUNGDANHMUC_DUOC'                if @TOAMUANGOAI = 1        begin        select  distinct '0' + '_' + LTRIM(d.DUOC_ID) + '_' + '0' as DUOC_KEY, 999999999 as SOLUONG        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        where  @param0  = 0        union all        select distinct tk.DUOC_KEY, tk.SOLUONG        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        inner join        (        select  LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')) DUOC_KEY, (SUM(dtk.SOLUONG) - isnull(sum(A.SOLUONG),0) - isnull(sum(B.SOLUONG),0)) SOLUONG, pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        from (select sum(soluong) soluong,duoc_id,nguonduoc_id,khoduoc_id,benhvien_id from TT_DUOC_TONKHO  group by duoc_id,nguonduoc_id,khoduoc_id,benhvien_id) dtk        inner join TM_DUOC_PHAMVISD_MAPPING pvsd on dtk.KHODUOC_ID = pvsd.KHODUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NOITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) B on B.DUOC_ID = dtk.DUOC_ID and B.PHAMVI_ID = pvsd.PHAMVI_ID and B.NGUONHANG_ID = dtk.NGUONDUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NGOAITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) A on A.DUOC_ID = dtk.DUOC_ID and A.PHAMVI_ID = pvsd.PHAMVI_ID and A.NGUONHANG_ID = dtk.NGUONDUOC_ID        where dtk.BENHVIEN_ID = 'HLU01'        group by LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')), pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        ) tk on tk.DUOC_ID = d.DUOC_ID        left join TM_DUOC_PHAMVISUDUNG kd on kd.PHAMVI_ID = tk.PHAMVI_ID and kd.BENHVIEN_ID = 'HLU01'        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = tk.NGUONDUOC_ID and nh.BENHVIEN_ID = 'HLU01'        where d.BENHVIEN_ID = 'HLU01' and tk.PHAMVI_ID =  @param0         end        else        begin        select distinct tk.DUOC_KEY, tk.SOLUONG        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        inner join        (        select  LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')) DUOC_KEY, (SUM(dtk.SOLUONG) - isnull(sum(A.SOLUONG),0) - isnull(sum(B.SOLUONG),0)) SOLUONG, pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        from (select sum(soluong) soluong,duoc_id,nguonduoc_id,khoduoc_id,benhvien_id from TT_DUOC_TONKHO  group by duoc_id,nguonduoc_id,khoduoc_id,benhvien_id) dtk        inner join TM_DUOC_PHAMVISD_MAPPING pvsd on dtk.KHODUOC_ID = pvsd.KHODUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NOITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) B on B.DUOC_ID = dtk.DUOC_ID and B.PHAMVI_ID = pvsd.PHAMVI_ID and B.NGUONHANG_ID = dtk.NGUONDUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NGOAITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) A on A.DUOC_ID = dtk.DUOC_ID and A.PHAMVI_ID = pvsd.PHAMVI_ID and A.NGUONHANG_ID = dtk.NGUONDUOC_ID        where dtk.BENHVIEN_ID = 'HLU01'        group by LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')), pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        ) tk on tk.DUOC_ID = d.DUOC_ID        left join TM_DUOC_PHAMVISUDUNG kd on kd.PHAMVI_ID = tk.PHAMVI_ID and kd.BENHVIEN_ID = 'HLU01'        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = tk.NGUONDUOC_ID and nh.BENHVIEN_ID = 'HLU01'        where d.BENHVIEN_ID = 'HLU01' and tk.PHAMVI_ID =  @param0         end]
2019-09-20 15:52:36,069 [1] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoVaBookingCOM23UpdateRedis_TheoPhamvi] Parameters: [@param0=[PHAMVI_ID,1028]]
2019-09-20 15:52:36,069 [1] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoVaBookingCOM23UpdateRedis_TheoPhamvi] Types: [@param0=[Int64, System.Int64]]
2019-09-20 15:52:36,288 [1] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoVaBookingCOM23UpdateRedis_TheoPhamvi] PreparedStatement : [declare @TOAMUANGOAI int = 0;        select @TOAMUANGOAI = isnull(VALUE,0) from TM_SYS_APPSETTINGS where CODE = 'OPD_TOAMUANGOAI_DUNGDANHMUC_DUOC'                if @TOAMUANGOAI = 1        begin        select  distinct '0' + '_' + LTRIM(d.DUOC_ID) + '_' + '0' as DUOC_KEY, 999999999 as SOLUONG        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        where  @param0  = 0        union all        select distinct tk.DUOC_KEY, tk.SOLUONG        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        inner join        (        select  LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')) DUOC_KEY, (SUM(dtk.SOLUONG) - isnull(sum(A.SOLUONG),0) - isnull(sum(B.SOLUONG),0)) SOLUONG, pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        from (select sum(soluong) soluong,duoc_id,nguonduoc_id,khoduoc_id,benhvien_id from TT_DUOC_TONKHO  group by duoc_id,nguonduoc_id,khoduoc_id,benhvien_id) dtk        inner join TM_DUOC_PHAMVISD_MAPPING pvsd on dtk.KHODUOC_ID = pvsd.KHODUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NOITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) B on B.DUOC_ID = dtk.DUOC_ID and B.PHAMVI_ID = pvsd.PHAMVI_ID and B.NGUONHANG_ID = dtk.NGUONDUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NGOAITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) A on A.DUOC_ID = dtk.DUOC_ID and A.PHAMVI_ID = pvsd.PHAMVI_ID and A.NGUONHANG_ID = dtk.NGUONDUOC_ID        where dtk.BENHVIEN_ID = 'HLU01'        group by LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')), pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        ) tk on tk.DUOC_ID = d.DUOC_ID        left join TM_DUOC_PHAMVISUDUNG kd on kd.PHAMVI_ID = tk.PHAMVI_ID and kd.BENHVIEN_ID = 'HLU01'        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = tk.NGUONDUOC_ID and nh.BENHVIEN_ID = 'HLU01'        where d.BENHVIEN_ID = 'HLU01' and tk.PHAMVI_ID =  @param0         end        else        begin        select distinct tk.DUOC_KEY, tk.SOLUONG        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        inner join        (        select  LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')) DUOC_KEY, (SUM(dtk.SOLUONG) - isnull(sum(A.SOLUONG),0) - isnull(sum(B.SOLUONG),0)) SOLUONG, pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        from (select sum(soluong) soluong,duoc_id,nguonduoc_id,khoduoc_id,benhvien_id from TT_DUOC_TONKHO  group by duoc_id,nguonduoc_id,khoduoc_id,benhvien_id) dtk        inner join TM_DUOC_PHAMVISD_MAPPING pvsd on dtk.KHODUOC_ID = pvsd.KHODUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NOITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) B on B.DUOC_ID = dtk.DUOC_ID and B.PHAMVI_ID = pvsd.PHAMVI_ID and B.NGUONHANG_ID = dtk.NGUONDUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NGOAITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) A on A.DUOC_ID = dtk.DUOC_ID and A.PHAMVI_ID = pvsd.PHAMVI_ID and A.NGUONHANG_ID = dtk.NGUONDUOC_ID        where dtk.BENHVIEN_ID = 'HLU01'        group by LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')), pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        ) tk on tk.DUOC_ID = d.DUOC_ID        left join TM_DUOC_PHAMVISUDUNG kd on kd.PHAMVI_ID = tk.PHAMVI_ID and kd.BENHVIEN_ID = 'HLU01'        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = tk.NGUONDUOC_ID and nh.BENHVIEN_ID = 'HLU01'        where d.BENHVIEN_ID = 'HLU01' and tk.PHAMVI_ID =  @param0         end]
2019-09-20 15:52:36,288 [1] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoVaBookingCOM23UpdateRedis_TheoPhamvi] Parameters: [@param0=[PHAMVI_ID,1028]]
2019-09-20 15:52:36,288 [1] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoVaBookingCOM23UpdateRedis_TheoPhamvi] Types: [@param0=[Int64, System.Int64]]
2019-09-20 15:52:36,598 [1] DEBUG - Statement Id: [DAO00068_GetLastedSinhHieuInfo] PreparedStatement : [select top (1) *, CHISOBMI as BMI              from TT_NGOAITRU_KHAMBENH_SINHHIEU              where BENHNHAN_ID = '23423'              order by KHAMBENH_SINHHIEU_ID desc]
2019-09-20 15:52:48,513 [1] DEBUG - Statement Id: [DAO00014_GetChitietDVYeucauKhamBenh] PreparedStatement : [select *        from TT_DVYEUCAU        where DVYEUCAU_ID  = '205440']
2019-09-20 15:52:48,546 [1] DEBUG - Statement Id: [DAO00014_GetPatientStatus] PreparedStatement : [select        CASE        when tn.TRANGTHAI = 'HOANTHANH' Then tn.TRANGTHAI        WHEN xncp.XACNHANCHIPHI_ID is not null THEN 'XACNHANCHIPHI'        WHEN (tn.KHOADULIEU = '1') THEN 'KHOADULIEU'        ELSE tn.TRANGTHAI        END        as TRANGTHAI        from TT_TIEPNHAN tn        left join TT_XACNHANCHIPHI xncp on tn.TIEPNHAN_ID = xncp.TIEPNHAN_ID        where tn.TIEPNHAN_ID = '27478'        and tn.BENHVIEN_ID = 'HLU01']
2019-09-20 15:52:48,642 [1] DEBUG - Statement Id: [DAO00014_GetThongtinKhamsuckhoeTheoDVyc] PreparedStatement : [select HOPDONG_ID, HOPDONG_BENHNHAN_ID from TT_DVYEUCAU where DVYEUCAU_ID =  @param0]
2019-09-20 15:52:48,642 [1] DEBUG - Statement Id: [DAO00014_GetThongtinKhamsuckhoeTheoDVyc] Parameters: [@param0=[DVYEUCAU_ID,205440]]
2019-09-20 15:52:48,642 [1] DEBUG - Statement Id: [DAO00014_GetThongtinKhamsuckhoeTheoDVyc] Types: [@param0=[Int64, System.Int64]]
2019-09-20 15:52:48,672 [1] DEBUG - Statement Id: [DAO00009_TT_TIEPNHAN_GetProcess] PreparedStatement : [select PROCESS_ID from TT_TIEPNHAN where SOTIEPNHAN = 'TN190920.0000001']
2019-09-20 15:52:48,776 [1] DEBUG - Statement Id: [DAOWF004_laytrangthaiDV] PreparedStatement : [select top 1 A.CURR_STATE_CODE as STATE_CODE, isNull(C.SHORT_NAME,C.NAME) as TRANGTHAI, C.NAME as TRANGTHAI_CHITIET, C.STATUS_CODE, D.ISACTIVE as ACTIVE, E.STATUS_CODE  as OLD_STATUSCODE        from TT_REQUEST_SERVICE_DETAIL A                left join (select * from TT_REQUEST_SERVICE where PARA = '{"DICHVU_ID":"5685","DVYEUCAU_ID":"205440"}') D on D.ID = A.REQUEST_SERVICE_ID        left join TM_STATE C on A.CURR_STATE_CODE = C.STATE_CODE and C.PROCESS_CODE = D.PROCESS_CODE        left join TM_STATE E on A.OLD_STATE_CODE = E.STATE_CODE and E.PROCESS_CODE = D.PROCESS_CODE        where        A.REQUEST_SERVICE_ID = (select top 1 ID from TT_REQUEST_SERVICE where PARA = '{"DICHVU_ID":"5685","DVYEUCAU_ID":"205440"}' order by ID desc)        order by A.ID desc]
2019-09-20 15:52:48,872 [1] DEBUG - Statement Id: [DAO00014_CheckExistNhapVien] PreparedStatement : [select NHAPVIEN_ID        from TT_NOITRU_NHAPVIEN        where TIEPNHAN_ID  = '27478'        and TRANGTHAI != 'CHOXACNHAN']
2019-09-20 15:52:48,909 [1] DEBUG - Statement Id: [DAO00014_CheckExistCapCuu] PreparedStatement : [select THONGTINCAPCUU_ID        from TT_TIEPNHAN_THONGTINCAPCUU        where TIEPNHAN_ID  = '27478' and BENHVIEN_ID = 'HLU01']
2019-09-20 15:52:48,941 [1] DEBUG - Statement Id: [DAO00014_CheckExistChuyenVien] PreparedStatement : [select CHUYENVIEN_ID        from TT_CHUYENVIEN        where TIEPNHAN_ID  = '27478']
2019-09-20 15:52:48,976 [1] DEBUG - Statement Id: [DAO00014_GetTrangThaiTiepNhan] PreparedStatement : [select tn.TIEPNHAN_ID, tn.KHOADULIEU, xncp.XACNHANCHIPHI_ID from TT_TIEPNHAN tn        left join TT_XACNHANCHIPHI xncp        on tn.TIEPNHAN_ID = xncp.TIEPNHAN_ID        where tn.TIEPNHAN_ID = '27478'        and tn.BENHVIEN_ID = 'HLU01']
2019-09-20 15:52:49,021 [1] DEBUG - Statement Id: [DAO00014_GetListToaThuoc] PreparedStatement : [select A.*        from TT_NGOAITRU_KHAMBENH_TOATHUOC A        where A.KHAMBENH_ID = '26172']
2019-09-20 15:52:49,056 [1] DEBUG - Statement Id: [DAOLOG01_LockBegin] PreparedStatement : [INSERT into TT_LOG_UPDATE ( REF_TABLE , REF_ID , BENHVIEN_ID )         values ( @param0 ,  @param1 ,  @param2 );]
2019-09-20 15:52:49,056 [1] DEBUG - Statement Id: [DAOLOG01_LockBegin] Parameters: [@param0=[REF_TABLE,TT_NGOAITRU_KHAMBENH], @param1=[REF_ID,27478], @param2=[BENHVIEN_ID,HLU01]]
2019-09-20 15:52:49,056 [1] DEBUG - Statement Id: [DAOLOG01_LockBegin] Types: [@param0=[String, System.String], @param1=[Int64, System.Int64], @param2=[String, System.String]]
2019-09-20 15:52:49,088 [1] DEBUG - Statement Id: [DAO00014_GetTTNhapVien] PreparedStatement : [select *        from TT_NOITRU_NHAPVIEN        where TIEPNHAN_ID  = '27478']
2019-09-20 15:52:49,157 [1] DEBUG - Statement Id: [DAO00014_GetTTDVYeucauOPD] PreparedStatement : [select A.KHAMBENH_NGOAITRU_ID, B.KHAMBENH_ID        from TT_DVYEUCAU A        left join TT_NGOAITRU_KHAMBENH B on A.KHAMBENH_NGOAITRU_ID = B.KHAMBENH_ID        where A.DVYEUCAU_ID = '205440' and A.TIEPNHAN_ID =  @param0]
2019-09-20 15:52:49,157 [1] DEBUG - Statement Id: [DAO00014_GetTTDVYeucauOPD] Parameters: [@param0=[TIEPNHAN_ID,27478]]
2019-09-20 15:52:49,157 [1] DEBUG - Statement Id: [DAO00014_GetTTDVYeucauOPD] Types: [@param0=[String, System.String]]
2019-09-20 15:52:49,189 [1] DEBUG - Statement Id: [DAO00014_Update] PreparedStatement : [update TT_NGOAITRU_KHAMBENH set        BENHNHAN_ID =  @param0         , DICHVU_ID =  @param1                 , NGAYKHAM =  @param2         , CHANDOANICD_ID =  @param3         , HUONGGIAIQUYET_ID =  @param4                 , YEUCAUCHITIET_ID =  @param5         , CHANDOANKHOAKHAM =  @param6         , SONGAYHENTAIKHAM =  @param7         , NHANAP_MT =  @param8         , NHANAP_MP =  @param9         , CHANDOANPHUICD_ID =  @param10         , TRIEUCHUNGLAMSANG =  @param11         , HUYETAPTHAP =  @param12         , HUYETAPCAO =  @param13         , BENHMANTINH_ID =  @param14         , NHAPKHOA_ID =  @param15         , CHANDOANSOBOICD_ID =  @param16         , CHANDOANSOBO =  @param17         , CHUYENDENBENHVIEN_ID =  @param18         , LYDONHAPVIEN_ID =  @param19         , NGHIOM_TUNGAY =  @param20         , NGHIOM_DENNGAY =  @param21         , TLDG_MT_TEXT =  @param22         , TLDG_MP_TEXT =  @param23         , TKLT_MP_TEXT =  @param24         , TKLT_MT_TEXT =  @param25         , SIEUHIENVI =  @param26         , SOIDAYMAT =  @param27         , MACH =  @param28         , CANNANG =  @param29         , CHIEUCAO =  @param30         , BMI =  @param31         , NHIPTHO =  @param32         , NHIETDO =  @param33         , GHICHU =  @param34         , KHOADULIEU =  @param35         , NGUOIKHOA_ID =  @param36         , NGAYKHOA =  @param37         , THOIGIANKHOA =  @param38         , NGAYCAPNHAT =  @param39         , NGUOICAPNHAT_ID =  @param40         , KHAMBENH_SINHHIEU_ID =  @param41         where        KHAMBENH_ID =  @param42]
2019-09-20 15:52:49,189 [1] DEBUG - Statement Id: [DAO00014_Update] Parameters: [@param0=[BENHNHAN_ID,23423], @param1=[DICHVU_ID,5685], @param2=[NGAYKHAM,9/20/2019 12:00:00 AM], @param3=[CHANDOANICD_ID,3990], @param4=[HUONGGIAIQUYET_ID,1331], @param5=[YEUCAUCHITIET_ID,null], @param6=[CHANDOANKHOAKHAM,Viêm phế quản cấp(J20)], @param7=[SONGAYHENTAIKHAM,null], @param8=[NHANAP_MT,null], @param9=[NHANAP_MP,null], @param10=[CHANDOANPHUICD_ID,null], @param11=[TRIEUCHUNGLAMSANG,test], @param12=[HUYETAPTHAP,null], @param13=[HUYETAPCAO,null], @param14=[BENHMANTINH_ID,null], @param15=[NHAPKHOA_ID,null], @param16=[CHANDOANSOBOICD_ID,null], @param17=[CHANDOANSOBO,], @param18=[CHUYENDENBENHVIEN_ID,null], @param19=[LYDONHAPVIEN_ID,null], @param20=[NGHIOM_TUNGAY,null], @param21=[NGHIOM_DENNGAY,null], @param22=[TLDG_MT_TEXT,], @param23=[TLDG_MP_TEXT,], @param24=[TKLT_MP_TEXT,], @param25=[TKLT_MT_TEXT,], @param26=[SIEUHIENVI,], @param27=[SOIDAYMAT,], @param28=[MACH,null], @param29=[CANNANG,null], @param30=[CHIEUCAO,null], @param31=[BMI,null], @param32=[NHIPTHO,null], @param33=[NHIETDO,null], @param34=[GHICHU,], @param35=[KHOADULIEU,0], @param36=[NGUOIKHOA_ID,null], @param37=[NGAYKHOA,null], @param38=[THOIGIANKHOA,null], @param39=[NGAYCAPNHAT,9/20/2019 3:52:49 PM], @param40=[NGUOICAPNHAT_ID,1], @param41=[KHAMBENH_SINHHIEU_ID,0], @param42=[KHAMBENH_ID,26172]]
2019-09-20 15:52:49,189 [1] DEBUG - Statement Id: [DAO00014_Update] Types: [@param0=[Int64, System.Int64], @param1=[Int64, System.Int64], @param2=[DateTime, System.DateTime], @param3=[String, System.String], @param4=[String, System.String], @param5=[System.DBNull, null], @param6=[String, System.String], @param7=[System.DBNull, null], @param8=[System.DBNull, null], @param9=[System.DBNull, null], @param10=[System.DBNull, null], @param11=[String, System.String], @param12=[System.DBNull, null], @param13=[System.DBNull, null], @param14=[System.DBNull, null], @param15=[System.DBNull, null], @param16=[System.DBNull, null], @param17=[String, System.String], @param18=[System.DBNull, null], @param19=[System.DBNull, null], @param20=[System.DBNull, null], @param21=[System.DBNull, null], @param22=[String, System.String], @param23=[String, System.String], @param24=[String, System.String], @param25=[String, System.String], @param26=[String, System.String], @param27=[String, System.String], @param28=[System.DBNull, null], @param29=[System.DBNull, null], @param30=[System.DBNull, null], @param31=[System.DBNull, null], @param32=[System.DBNull, null], @param33=[System.DBNull, null], @param34=[String, System.String], @param35=[String, System.String], @param36=[System.DBNull, null], @param37=[System.DBNull, null], @param38=[System.DBNull, null], @param39=[DateTime, System.DateTime], @param40=[Int64, System.Int64], @param41=[Int64, System.Int64], @param42=[Int64, System.Int64]]
2019-09-20 15:52:49,244 [1] DEBUG - Statement Id: [DAO00014_CheckExistHenTaiKHam] PreparedStatement : [select KHAMBENH_HENTAIKHAM        from TT_NGOAITRU_KHAMBENH_HENTK        where KHAMBENH_ID  = '26172']
2019-09-20 15:52:49,282 [1] DEBUG - Statement Id: [DAO00020_UpdateKhamBenhIDInDVYC] PreparedStatement : [update TT_DVYEUCAU        set KHAMBENH_NGOAITRU_ID =  @param0                 , TRANGTHAI =  @param1         , NGUOICAPNHAT_ID =  @param2         , NGAYCAPNHAT =  @param3         where TIEPNHAN_ID = 27478        and DVYEUCAU_ID = 205440                update TT_VIENPHI        set DATHUCHIEN =  @param4         , NGUOICAPNHAT_ID =  @param2         , NGAYCAPNHAT =  @param3         where REF_ID = 205440        and REF_TABLE = 'TT_DVYEUCAU']
2019-09-20 15:52:49,282 [1] DEBUG - Statement Id: [DAO00020_UpdateKhamBenhIDInDVYC] Parameters: [@param0=[KHAMBENH_ID,26172], @param1=[TRANGTHAI,HOANTAT], @param2=[NGUOICAPNHAT_ID,1], @param3=[NGAYCAPNHAT,9/20/2019 3:52:49 PM], @param4=[DATHUCHIEN,1]]
2019-09-20 15:52:49,282 [1] DEBUG - Statement Id: [DAO00020_UpdateKhamBenhIDInDVYC] Types: [@param0=[Int32, System.Int32], @param1=[String, System.String], @param2=[Int64, System.Int64], @param3=[DateTime, System.DateTime], @param4=[Int32, System.Int32]]
2019-09-20 15:52:49,339 [1] DEBUG - Statement Id: [DAO00023_GetSOBHYT_HUONG_ID] PreparedStatement : [select isnull(MAX(SOBHYT_HUONG_ID),0) SOBHYT_HUONG_ID        from TT_TIEPNHAN_SOTHEBHYT        where TIEPNHAN_ID = '27478']
2019-09-20 15:52:49,377 [1] DEBUG - Statement Id: [DAO00062_GetAllPhamviKhoDuoc] PreparedStatement : [select distinct dmap.*        from TM_DUOC_PHAMVISD_MAPPING dmap        left join TM_DUOC_PHAMVISUDUNG dpv on dpv.PHAMVI_ID = dmap.PHAMVI_ID]
2019-09-20 15:52:49,417 [1] DEBUG - Statement Id: [DAO00049_KiemtraloaiDV] PreparedStatement : [select DICHVU_ID AS HA, '' AS XN, '' as TDCN, '' as TT, '' as KB from TM_DICHVU            left join TM_NHOMDICHVU ndv on ndv.NHOMDICHVU_ID = TM_DICHVU.NHOMDICHVU_ID            where DICHVU_ID = '5685' and left(ndv.MANHOMDICHVU, 2) = '02'            union            select  '' as HA, DICHVU_ID AS XN, '' as TDCN, '' as TT, '' as KB from TM_DICHVU            left join TM_NHOMDICHVU ndv on ndv.NHOMDICHVU_ID = TM_DICHVU.NHOMDICHVU_ID            where DICHVU_ID = '5685' and left(ndv.MANHOMDICHVU, 2) = '01'            union            select  '' as HA, '' AS XN, DICHVU_ID as TDCN, '' as TT, '' as KB from TM_DICHVU            left join TM_NHOMDICHVU ndv on ndv.NHOMDICHVU_ID = TM_DICHVU.NHOMDICHVU_ID            where DICHVU_ID = '5685' and left(ndv.MANHOMDICHVU, 2) = '03'            union            select  '' as HA, '' AS XN, '' as TDCN, DICHVU_ID as TT, '' as KB from TM_DICHVU            left join TM_NHOMDICHVU ndv on ndv.NHOMDICHVU_ID = TM_DICHVU.NHOMDICHVU_ID            where DICHVU_ID = '5685' and left(ndv.MANHOMDICHVU, 2) = '05'            union            select  '' as HA, '' AS XN, '' as TDCN, DICHVU_ID as TT, '' as KB from TM_DICHVU            left join TM_NHOMDICHVU ndv on ndv.NHOMDICHVU_ID = TM_DICHVU.NHOMDICHVU_ID            where DICHVU_ID = '5685' and left(ndv.MANHOMDICHVU, 2) = '06'            union            select  '' as HA, '' AS XN, '' as TDCN, '' as TT, DICHVU_ID as KB from TM_DICHVU            left join TM_NHOMDICHVU ndv on ndv.NHOMDICHVU_ID = TM_DICHVU.NHOMDICHVU_ID            where DICHVU_ID = '5685' and left(ndv.MANHOMDICHVU, 2) = '04']
2019-09-20 15:52:49,456 [1] DEBUG - Statement Id: [DAO00009_GetThutiensauDVThuthuatKhamBenh] PreparedStatement : [select A.THUTIENSAU, B.SOTIEPNHAN, A.DICHVU_ID, A.DVYEUCAU_ID        from TT_DVYEUCAU A        inner join TT_TIEPNHAN B on B.TIEPNHAN_ID = A.TIEPNHAN_ID        left join TT_NGOAITRU_KHAMBENH C on A.TIEPNHAN_ID = C.TIEPNHAN_ID and A.DICHVU_ID = C.DICHVU_ID        where        C.KHAMBENH_ID = '26172']
2019-09-20 15:52:49,503 [1] DEBUG - Statement Id: [DAO00009_TT_TIEPNHAN_GetProcess] PreparedStatement : [select PROCESS_ID from TT_TIEPNHAN where SOTIEPNHAN = 'TN190920.0000001']
2019-09-20 15:52:49,573 [1] DEBUG - Statement Id: [DAOWF001_Kiemtrathongtindayeucaureturn] PreparedStatement : [select * from TT_REQUEST        where        PARA = '{"HOSPITAL_ID":"HLU01","SOTIEPNHAN":"TN190920.0000001"}']
2019-09-20 15:52:49,628 [1] DEBUG - Statement Id: [DAOWF001_Kiemtrathongtindichvudayeucaureturn] PreparedStatement : [select top 1 * from TT_REQUEST_SERVICE        where        PARA = '{"DICHVU_ID":"5685","DVYEUCAU_ID":"205440"}'  order by ID desc]
2019-09-20 15:52:49,660 [1] DEBUG - Statement Id: [DAOWF005_ReturnStateCuaDichVuYeuCau] PreparedStatement : [declare        @Detail_Id int,        @CurentState char(8),        @OldState char(8)          select top 1 @Detail_Id = ID, @CurentState = OLD_STATE_CODE, @OldState = CURR_STATE_CODE from TT_REQUEST_SERVICE_DETAIL        where        REQUEST_ID = '31779'        AND REQUEST_SERVICE_ID = '147387'        order by ID desc;          update TT_REQUEST_SERVICE set CURR_STATE_CODE = @CurentState, ISACTIVE = 1, ISCOMPLETE = 0 where ID = '147387';        delete from TT_REQUEST_SERVICE_DETAIL where ID = @Detail_Id;        insert into TT_REQUEST_SERVICE_HISTORY        (REQUEST_ID,REQUEST_SERVICE_ID, OLD_STATE_CODE, CURR_STATE_CODE) values ('31779','147387',@OldState, @CurentState);        select top 1 A.*, B.STATUS_CODE from TT_REQUEST_SERVICE A        left join TM_STATE B on A.CURR_STATE_CODE = B.STATE_CODE and A.PROCESS_CODE = B.PROCESS_CODE        where A.ID = '147387';]
2019-09-20 15:52:49,943 [1] DEBUG - Statement Id: [DAO00009_TT_DVYEUCAU_Update] PreparedStatement : [Update TT_DVYEUCAU set TRANGTHAI_WFL = 'CHUAKETQUA' where DVYEUCAU_ID = '205440']
2019-09-20 15:52:49,972 [1] DEBUG - Statement Id: [DAO00049_KiemtraloaiDV] PreparedStatement : [select DICHVU_ID AS HA, '' AS XN, '' as TDCN, '' as TT, '' as KB from TM_DICHVU            left join TM_NHOMDICHVU ndv on ndv.NHOMDICHVU_ID = TM_DICHVU.NHOMDICHVU_ID            where DICHVU_ID = '5685' and left(ndv.MANHOMDICHVU, 2) = '02'            union            select  '' as HA, DICHVU_ID AS XN, '' as TDCN, '' as TT, '' as KB from TM_DICHVU            left join TM_NHOMDICHVU ndv on ndv.NHOMDICHVU_ID = TM_DICHVU.NHOMDICHVU_ID            where DICHVU_ID = '5685' and left(ndv.MANHOMDICHVU, 2) = '01'            union            select  '' as HA, '' AS XN, DICHVU_ID as TDCN, '' as TT, '' as KB from TM_DICHVU            left join TM_NHOMDICHVU ndv on ndv.NHOMDICHVU_ID = TM_DICHVU.NHOMDICHVU_ID            where DICHVU_ID = '5685' and left(ndv.MANHOMDICHVU, 2) = '03'            union            select  '' as HA, '' AS XN, '' as TDCN, DICHVU_ID as TT, '' as KB from TM_DICHVU            left join TM_NHOMDICHVU ndv on ndv.NHOMDICHVU_ID = TM_DICHVU.NHOMDICHVU_ID            where DICHVU_ID = '5685' and left(ndv.MANHOMDICHVU, 2) = '05'            union            select  '' as HA, '' AS XN, '' as TDCN, DICHVU_ID as TT, '' as KB from TM_DICHVU            left join TM_NHOMDICHVU ndv on ndv.NHOMDICHVU_ID = TM_DICHVU.NHOMDICHVU_ID            where DICHVU_ID = '5685' and left(ndv.MANHOMDICHVU, 2) = '06'            union            select  '' as HA, '' AS XN, '' as TDCN, '' as TT, DICHVU_ID as KB from TM_DICHVU            left join TM_NHOMDICHVU ndv on ndv.NHOMDICHVU_ID = TM_DICHVU.NHOMDICHVU_ID            where DICHVU_ID = '5685' and left(ndv.MANHOMDICHVU, 2) = '04']
2019-09-20 15:52:50,004 [1] DEBUG - Statement Id: [DAO00009_GetThutiensauDVThuthuat] PreparedStatement : [select A.THUTIENSAU, B.SOTIEPNHAN, A.DICHVU_ID, A.DVYEUCAU_ID        from TT_DVYEUCAU A        inner join TT_TIEPNHAN B on B.TIEPNHAN_ID = A.TIEPNHAN_ID        where        A.DVYEUCAU_ID = '205440']
2019-09-20 15:52:50,034 [1] DEBUG - Statement Id: [DAO00009_TT_TIEPNHAN_GetProcess] PreparedStatement : [select PROCESS_ID from TT_TIEPNHAN where SOTIEPNHAN = 'TN190920.0000001']
2019-09-20 15:52:50,099 [1] DEBUG - Statement Id: [DAOWF001_Kiemtrathongtindayeucaudacochua] PreparedStatement : [select * from TT_REQUEST        where        PARA = '{"HOSPITAL_ID":"HLU01","SOTIEPNHAN":"TN190920.0000001"}'        AND ISACTIVE = '1']
2019-09-20 15:52:50,152 [1] DEBUG - Statement Id: [DAOWF001_Kiemtrathongtindichvudayeucau] PreparedStatement : [select top 1 * from TT_REQUEST_SERVICE        where        PARA = '{"DICHVU_ID":"5685","DVYEUCAU_ID":"205440"}'                AND ISACTIVE = '1' order by ID desc]
2019-09-20 15:52:50,182 [1] DEBUG - Statement Id: [DAOWF001_KiemtrathongtinchitietDichvuYeucau] PreparedStatement : [select * from TT_REQUEST_SERVICE_DETAIL        where        REQUEST_SERVICE_ID = '147387']
2019-09-20 15:52:50,245 [1] DEBUG - Statement Id: [DAOWF001_Laythongtinwithstatecode] PreparedStatement : [select A.*, B.STATUS_CODE from        TM_STATE_ACTION A        left join TM_STATE B on B.STATE_CODE = A.NEXT_STATE_CODE and A.PROCESS_CODE = B.PROCESS_CODE        where        A.CURR_STATE_CODE = '0     '        AND A.PROCESS_CODE = 'P02'        Order By ORDER_ID ASC]
2019-09-20 15:52:50,277 [1] DEBUG - Statement Id: [DAOWF003_Update] PreparedStatement : [update TT_REQUEST_SERVICE set        CURR_STATE_CODE =  @param0                   , ISACTIVE =  @param1                     , ISCOMPLETE =  @param2                        where        ID = '147387']
2019-09-20 15:52:50,277 [1] DEBUG - Statement Id: [DAOWF003_Update] Parameters: [@param0=[CURR_STATE_CODE,8], @param1=[ISACTIVE,1], @param2=[ISCOMPLETE,0]]
2019-09-20 15:52:50,277 [1] DEBUG - Statement Id: [DAOWF003_Update] Types: [@param0=[String, System.String], @param1=[String, System.String], @param2=[String, System.String]]
2019-09-20 15:52:50,309 [1] DEBUG - Statement Id: [DAOWF005_Add] PreparedStatement : [insert into TT_REQUEST_SERVICE_DETAIL (        REQUEST_ID        ,REQUEST_SERVICE_ID        , OLD_STATE_CODE        , CURR_STATE_CODE        ) values (         @param0         , @param1         ,  @param2         ,  @param3         )        SELECT SCOPE_IDENTITY()]
2019-09-20 15:52:50,309 [1] DEBUG - Statement Id: [DAOWF005_Add] Parameters: [@param0=[REQUEST_ID,31779], @param1=[REQUEST_SERVICE_ID,147387], @param2=[OLD_STATE_CODE,0     ], @param3=[CURR_STATE_CODE,8]]
2019-09-20 15:52:50,309 [1] DEBUG - Statement Id: [DAOWF005_Add] Types: [@param0=[String, System.String], @param1=[Int32, System.Int32], @param2=[String, System.String], @param3=[String, System.String]]
2019-09-20 15:52:50,377 [1] DEBUG - Statement Id: [DAOWF005_Add_History] PreparedStatement : [insert into TT_REQUEST_SERVICE_HISTORY (        REQUEST_ID        ,REQUEST_SERVICE_ID        , OLD_STATE_CODE        , CURR_STATE_CODE        ) values (         @param0         , @param1         ,  @param2         ,  @param3         )]
2019-09-20 15:52:50,377 [1] DEBUG - Statement Id: [DAOWF005_Add_History] Parameters: [@param0=[REQUEST_ID,31779], @param1=[REQUEST_SERVICE_ID,147387], @param2=[OLD_STATE_CODE,0     ], @param3=[CURR_STATE_CODE,8]]
2019-09-20 15:52:50,377 [1] DEBUG - Statement Id: [DAOWF005_Add_History] Types: [@param0=[String, System.String], @param1=[Int32, System.Int32], @param2=[String, System.String], @param3=[String, System.String]]
2019-09-20 15:52:50,418 [1] DEBUG - Statement Id: [DAO00009_TT_DVYEUCAU_Update] PreparedStatement : [Update TT_DVYEUCAU set TRANGTHAI_WFL = 'HOANTAT' where DVYEUCAU_ID = '205440']
2019-09-20 15:52:50,450 [1] DEBUG - Statement Id: [DAO00026_GetListDanhSachDichVuGhiNhanVTYT_COM25_WithTN] PreparedStatement : [select distinct CONVERT(VARCHAR(11),C.NGAYYEUCAU,103) as NGAYYEUCAU, C.DICHVU_ID, C.DVYEUCAU_ID, D.TENDICHVU, C.NOITHUCHIEN_ID, A.SOTIEPNHAN, A.TRAITUYEN, A.NGAYMIENDONGCHITRA, A.TIEPNHAN_ID, A.DOITUONG_ID, A.TRANGTHAI,            A.LOAITHANHVIEN_ID, A.SUDUNG_BHTN, A.THE_ID, A.THANHVIEN_ID, A.VIP, A.NGUON_BENHNHAN_ID, A.BAOLANH_VIENPHI,            CASE WHEN (A.TRANGTHAI = 'NOITRU' OR A.TRANGTHAI = 'CAPCUU') THEN 'IN' ELSE 'OUT' END AS LOAIBENHAN,            CASE WHEN (C.TRANGTHAI = 'CHUAKETQUA') THEN 'CHUAKETQUA' ELSE 'HOANTAT' END AS TRANGTHAIDICHVU,            B.*, isnull(ntba.SOBENHAN, '') SOBENHAN, isnull(ntba.BENHAN_ID, 0) BENHAN_ID,            CASE WHEN Left(E.MANHOMDICHVU,2) = '03' THEN '02' ELSE Left(E.MANHOMDICHVU,2) END AS MANHOMDICHVU            from TT_TIEPNHAN A            inner join TT_BENHNHAN B on B.BENHNHAN_ID = A.BENHNHAN_ID and B.ACTIVE = '1'            inner join TT_DVYEUCAU C on C.TIEPNHAN_ID = A.TIEPNHAN_ID                        left join TM_DICHVU D on D.DICHVU_ID = C.DICHVU_ID            left join TM_NHOMDICHVU E on E.NHOMDICHVU_ID = D.NHOMDICHVU_ID            left join TT_NOITRU_BENHAN ntba on ntba.BENHAN_ID = C.BENHAN_ID              where            C.NGAYHENCLS is NULL and A.BENHVIEN_ID = 'HLU01'            and (A.TRANGTHAI = 'DATIEPNHAN' or A.TRANGTHAI = 'NOITRU' or A.TRANGTHAI = 'CAPCUU' or A.TRANGTHAI = 'NGOAITRU')            and (CASE WHEN Left(E.MANHOMDICHVU,2) = '03' THEN '02' ELSE Left(E.MANHOMDICHVU,2) END in ('02', '04'))            and A.TIEPNHAN_ID = '27478']
2019-09-20 15:52:51,231 [1] DEBUG - Statement Id: [DAOLOG01_LockEnd] PreparedStatement : [DELETE TT_LOG_UPDATE        where REF_TABLE = 'TT_NGOAITRU_KHAMBENH' and REF_ID = '27478' and BENHVIEN_ID = 'HLU01']
2019-09-20 15:52:51,271 [1] DEBUG - Statement Id: [DAO00014_Clear_1ToaThuocKhambenh] PreparedStatement : [DELETE FROM TT_DUOC_TONKHO_BOOK_NGOAITRU where REF_TABLE = 'TT_NGOAITRU_TOATHUOC'        and REF_ID in (        select TOATHUOC_ID from TT_NGOAITRU_TOATHUOC        where             KHAMBENH_TOATHUOC_ID in (select KHAMBENH_TOATHUOC_ID from TT_NGOAITRU_KHAMBENH_TOATHUOC        where TIEPNHAN_ID = '27478' and                   KHAMBENH_ID not in (select KHAMBENH_ID from TT_NGOAITRU_KHAMBENH where  TIEPNHAN_ID = '27478'))        and TIEPNHAN_ID = '27478')          DELETE FROM TT_VIENPHI where REF_TABLE = 'TT_NGOAITRU_TOATHUOC'        and REF_ID in (        select TOATHUOC_ID from TT_NGOAITRU_TOATHUOC        where KHAMBENH_TOATHUOC_ID in (select KHAMBENH_TOATHUOC_ID from TT_NGOAITRU_KHAMBENH_TOATHUOC        where TIEPNHAN_ID = '27478' and KHAMBENH_ID not in (select KHAMBENH_ID from TT_NGOAITRU_KHAMBENH where TIEPNHAN_ID = '27478'))        and TIEPNHAN_ID = '27478')          delete from TT_NGOAITRU_TOATHUOC        where KHAMBENH_TOATHUOC_ID in (select KHAMBENH_TOATHUOC_ID from TT_NGOAITRU_KHAMBENH_TOATHUOC        where TIEPNHAN_ID = '27478' and KHAMBENH_ID not in (select KHAMBENH_ID from TT_NGOAITRU_KHAMBENH where TIEPNHAN_ID = '27478')        and TIEPNHAN_ID = '27478')          delete from TT_NGOAITRU_KHAMBENH_TOATHUOC where TIEPNHAN_ID = '27478'        and KHAMBENH_ID not in (select KHAMBENH_ID from TT_NGOAITRU_KHAMBENH where TIEPNHAN_ID = '27478') and TIEPNHAN_ID = '27478']
2019-09-20 15:52:51,639 [1] DEBUG - Statement Id: [DAO00014_GetKhamBenhInfo] PreparedStatement : [select * from TT_NGOAITRU_KHAMBENH where KHAMBENH_ID =        (select KHAMBENH_NGOAITRU_ID from TT_DVYEUCAU where DVYEUCAU_ID = '205440')]
2019-09-20 15:52:51,759 [1] DEBUG - Statement Id: [DAO00068_GetSinhHieuBySinhHieuID] PreparedStatement : [select top (1) *            from TT_NGOAITRU_KHAMBENH_SINHHIEU            where KHAMBENH_SINHHIEU_ID = '0'            and BENHVIEN_ID = 'HLU01'             and               BENHNHAN_ID = '23423'                           order by KHAMBENH_SINHHIEU_ID]
2019-09-20 15:52:51,801 [1] DEBUG - Statement Id: [DAO00014_GetKhamBenhICDInfo] PreparedStatement : [select *        from TT_NGOAITRU_KHAMBENH_ICD        where KHAMBENH_ID  = '26172']
2019-09-20 15:52:51,832 [1] DEBUG - Statement Id: [DAO00014_GetListToaThuoc] PreparedStatement : [select A.*        from TT_NGOAITRU_KHAMBENH_TOATHUOC A        where A.KHAMBENH_ID = '26172']
2019-09-20 15:52:51,869 [1] DEBUG - Statement Id: [DAO00014_KiemTraDVYCCoBHYT] PreparedStatement : [select *        from TT_VIENPHI        where REF_ID  = '205440' and REF_TABLE = 'TT_DVYEUCAU' and BHYT_DONGIA > 0]
2019-09-20 15:52:51,927 [1] DEBUG - Statement Id: [DAO00040_LayListToaMau] PreparedStatement : [select A.*, dc.TENDUOCDAYDU, dc.BHYT DUOC_BHYT, ld.LOAIVATTU_ID, ld.MALOAIDUOC, dd.DICTIONARY_NAME DUONGDUNG, dc.TAMNGUNG            from TT_TOATHUOCMAU A            left join TM_DUOC dc on A.DUOC_ID = dc.DUOC_ID            left join TM_LOAIDUOC ld on dc.LOAIDUOC_ID = ld.LOAIDUOC_ID            left join (select * from LST_DICTIONARY where DICTIONARY_TYPE_CODE like 'DuongDung') dd on dd.DICTIONARY_ID = dc.DUONGDUNG_ID            where (1=1)             and               A.BACSI_ID  = 1              and A.LOAITOATHUOC in  (                        @param0                   ,                           @param1                   ,                           @param2                   ,                           @param3                   )]
2019-09-20 15:52:51,927 [1] DEBUG - Statement Id: [DAO00040_LayListToaMau] Parameters: [@param0=[LSTLOAITOATHUOC[0],BV], @param1=[LSTLOAITOATHUOC[1],MN], @param2=[LSTLOAITOATHUOC[2],MP], @param3=[LSTLOAITOATHUOC[3],TV]]
2019-09-20 15:52:51,927 [1] DEBUG - Statement Id: [DAO00040_LayListToaMau] Types: [@param0=[String, System.String], @param1=[String, System.String], @param2=[String, System.String], @param3=[String, System.String]]
2019-09-20 15:52:52,028 [1] DEBUG - Statement Id: [DAO00040_LayListToaMau] PreparedStatement : [select A.*, dc.TENDUOCDAYDU, dc.BHYT DUOC_BHYT, ld.LOAIVATTU_ID, ld.MALOAIDUOC, dd.DICTIONARY_NAME DUONGDUNG, dc.TAMNGUNG            from TT_TOATHUOCMAU A            left join TM_DUOC dc on A.DUOC_ID = dc.DUOC_ID            left join TM_LOAIDUOC ld on dc.LOAIDUOC_ID = ld.LOAIDUOC_ID            left join (select * from LST_DICTIONARY where DICTIONARY_TYPE_CODE like 'DuongDung') dd on dd.DICTIONARY_ID = dc.DUONGDUNG_ID            where (1=1)             and               A.BACSI_ID  = 1              and A.LOAITOATHUOC in  (                        @param0                   ,                           @param1                   ,                           @param2                   ,                           @param3                   )]
2019-09-20 15:52:52,028 [1] DEBUG - Statement Id: [DAO00040_LayListToaMau] Parameters: [@param0=[LSTLOAITOATHUOC[0],BV], @param1=[LSTLOAITOATHUOC[1],MN], @param2=[LSTLOAITOATHUOC[2],MP], @param3=[LSTLOAITOATHUOC[3],TV]]
2019-09-20 15:52:52,028 [1] DEBUG - Statement Id: [DAO00040_LayListToaMau] Types: [@param0=[String, System.String], @param1=[String, System.String], @param2=[String, System.String], @param3=[String, System.String]]
2019-09-20 15:52:52,398 [1] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoVaBookingCOM23UpdateRedis_TheoPhamvi] PreparedStatement : [declare @TOAMUANGOAI int = 0;        select @TOAMUANGOAI = isnull(VALUE,0) from TM_SYS_APPSETTINGS where CODE = 'OPD_TOAMUANGOAI_DUNGDANHMUC_DUOC'                if @TOAMUANGOAI = 1        begin        select  distinct '0' + '_' + LTRIM(d.DUOC_ID) + '_' + '0' as DUOC_KEY, 999999999 as SOLUONG        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        where  @param0  = 0        union all        select distinct tk.DUOC_KEY, tk.SOLUONG        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        inner join        (        select  LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')) DUOC_KEY, (SUM(dtk.SOLUONG) - isnull(sum(A.SOLUONG),0) - isnull(sum(B.SOLUONG),0)) SOLUONG, pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        from (select sum(soluong) soluong,duoc_id,nguonduoc_id,khoduoc_id,benhvien_id from TT_DUOC_TONKHO  group by duoc_id,nguonduoc_id,khoduoc_id,benhvien_id) dtk        inner join TM_DUOC_PHAMVISD_MAPPING pvsd on dtk.KHODUOC_ID = pvsd.KHODUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NOITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) B on B.DUOC_ID = dtk.DUOC_ID and B.PHAMVI_ID = pvsd.PHAMVI_ID and B.NGUONHANG_ID = dtk.NGUONDUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NGOAITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) A on A.DUOC_ID = dtk.DUOC_ID and A.PHAMVI_ID = pvsd.PHAMVI_ID and A.NGUONHANG_ID = dtk.NGUONDUOC_ID        where dtk.BENHVIEN_ID = 'HLU01'        group by LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')), pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        ) tk on tk.DUOC_ID = d.DUOC_ID        left join TM_DUOC_PHAMVISUDUNG kd on kd.PHAMVI_ID = tk.PHAMVI_ID and kd.BENHVIEN_ID = 'HLU01'        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = tk.NGUONDUOC_ID and nh.BENHVIEN_ID = 'HLU01'        where d.BENHVIEN_ID = 'HLU01' and tk.PHAMVI_ID =  @param0         end        else        begin        select distinct tk.DUOC_KEY, tk.SOLUONG        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        inner join        (        select  LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')) DUOC_KEY, (SUM(dtk.SOLUONG) - isnull(sum(A.SOLUONG),0) - isnull(sum(B.SOLUONG),0)) SOLUONG, pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        from (select sum(soluong) soluong,duoc_id,nguonduoc_id,khoduoc_id,benhvien_id from TT_DUOC_TONKHO  group by duoc_id,nguonduoc_id,khoduoc_id,benhvien_id) dtk        inner join TM_DUOC_PHAMVISD_MAPPING pvsd on dtk.KHODUOC_ID = pvsd.KHODUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NOITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) B on B.DUOC_ID = dtk.DUOC_ID and B.PHAMVI_ID = pvsd.PHAMVI_ID and B.NGUONHANG_ID = dtk.NGUONDUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NGOAITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) A on A.DUOC_ID = dtk.DUOC_ID and A.PHAMVI_ID = pvsd.PHAMVI_ID and A.NGUONHANG_ID = dtk.NGUONDUOC_ID        where dtk.BENHVIEN_ID = 'HLU01'        group by LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')), pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        ) tk on tk.DUOC_ID = d.DUOC_ID        left join TM_DUOC_PHAMVISUDUNG kd on kd.PHAMVI_ID = tk.PHAMVI_ID and kd.BENHVIEN_ID = 'HLU01'        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = tk.NGUONDUOC_ID and nh.BENHVIEN_ID = 'HLU01'        where d.BENHVIEN_ID = 'HLU01' and tk.PHAMVI_ID =  @param0         end]
2019-09-20 15:52:52,398 [1] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoVaBookingCOM23UpdateRedis_TheoPhamvi] Parameters: [@param0=[PHAMVI_ID,1028]]
2019-09-20 15:52:52,398 [1] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoVaBookingCOM23UpdateRedis_TheoPhamvi] Types: [@param0=[Int64, System.Int64]]
2019-09-20 15:52:52,740 [1] DEBUG - Statement Id: [DAO00064_GetlistTT_TIEPNHAN_SOTHEBHYT] PreparedStatement : [select stbhyt.*, ba.SOBENHAN,         tn.SOTIEPNHAN, tn.LOAITHANHVIEN_ID, tn.THE_ID, tn.THANHVIEN_ID,        tn.SUDUNG_BHTN, tn.BAOLANH_VIENPHI, tn.VIP, tn.NGUOINUOCNGOAI        from TT_TIEPNHAN_SOTHEBHYT stbhyt        left join TT_TIEPNHAN tn on tn.TIEPNHAN_ID = stbhyt.TIEPNHAN_ID        left join TT_NOITRU_BENHAN ba on ba.TIEPNHAN_ID = stbhyt.TIEPNHAN_ID        where         stbhyt.TIEPNHAN_ID = '27478' and isnull(stbhyt.KHONGSUDUNG, '0') = '0']
2019-09-20 15:52:52,801 [1] DEBUG - Statement Id: [DAO00064_GetListVienPhiByTiepNnan] PreparedStatement : [select distinct        B.DOITUONG_ID, B.NGAYMIENDONGCHITRA, B.BENHNHAN_ID as TIEPNHAN_BENHNHAN_ID, B.TRAITUYEN,        B.BHYTTREN3NAM as TREN3NAM, B.BHYTTREN5NAM as TREN5NAM, B.SOTIEPNHAN, B.SOBENHAN,        B.LOAITHANHVIEN_ID, B.SUDUNG_BHTN, B.THE_ID, B.THANHVIEN_ID, B.BAOLANH_VIENPHI, B.VIP, B.NGUOINUOCNGOAI,        C.GIATRIMIENGIAM as GIATRIMIENGIAM, D.GIATRIMIENGIAM as GIATRIMIENGIAM_BHTN, E.GIATRIMIENGIAM as GIATRIMIENGIAM_THANHVIEN,        F.GIATRIMIENGIAM as GIATRIMIENGIAM_CONGTY, DVYC.THE_ID as DVDUNGTHE, DVYC.TRANGTHAI as TRANGTHAIDICHVU, ndv.MANHOMDICHVU,        A.* from TT_VIENPHI A        left join        (select B.*, C.SOBENHAN, C.BENHAN_ID        from TT_TIEPNHAN B        left join TT_NOITRU_BENHAN C on B.TIEPNHAN_ID = C.TIEPNHAN_ID                 where B.TIEPNHAN_ID = '27478') B on B.TIEPNHAN_ID = A.TIEPNHAN_ID        left join (select sum(GIATRIMIENGIAM) as GIATRIMIENGIAM, VIENPHI_ID, REF_TABLE        from TT_MIENGIAM_CHITIET        where REF_TABLE = 'TT_MIENGIAM'        and exists (select MIENGIAM_ID from TT_MIENGIAM where TT_MIENGIAM_CHITIET.MIENGIAM_ID = MIENGIAM_ID and TINHTRANG = 1 and TIEPNHAN_ID = '27478')        group by VIENPHI_ID, REF_TABLE) C on C.REF_TABLE = 'TT_MIENGIAM' and C.VIENPHI_ID = A.VIENPHI_ID        left join (select sum(GIATRIMIENGIAM) as GIATRIMIENGIAM, VIENPHI_ID, REF_TABLE        from TT_MIENGIAM_CHITIET        where REF_TABLE = 'TT_MIENGIAM_BHTN'        and exists (select MIENGIAM_BHTN_ID from TT_MIENGIAM_BHTN where TT_MIENGIAM_CHITIET.MIENGIAM_ID = MIENGIAM_BHTN_ID and  TINHTRANG = 1 and TIEPNHAN_ID = '27478')        group by VIENPHI_ID, REF_TABLE) D on D.REF_TABLE = 'TT_MIENGIAM_BHTN' and D.VIENPHI_ID = A.VIENPHI_ID        left join (select sum(GIATRIMIENGIAM) as GIATRIMIENGIAM, VIENPHI_ID, REF_TABLE        from TT_MIENGIAM_CHITIET        where REF_TABLE = 'TT_MIENGIAM_THANHVIEN'        and exists (select MIENGIAM_THANHVIEN_ID from TT_MIENGIAM_THANHVIEN where TT_MIENGIAM_CHITIET.MIENGIAM_ID = MIENGIAM_THANHVIEN_ID and TINHTRANG = 1 and TIEPNHAN_ID = '27478')        group by VIENPHI_ID, REF_TABLE) E on E.REF_TABLE = 'TT_MIENGIAM_THANHVIEN' and E.VIENPHI_ID = A.VIENPHI_ID        left join (select sum(GIATRIMIENGIAM) as GIATRIMIENGIAM, VIENPHI_ID, REF_TABLE        from TT_MIENGIAM_CHITIET        where REF_TABLE = 'TT_MIENGIAM_CONGTY'        and exists (select MIENGIAM_CONGTY_ID from TT_MIENGIAM_CONGTY where TT_MIENGIAM_CHITIET.MIENGIAM_ID = MIENGIAM_CONGTY_ID and TINHTRANG = 1 and TIEPNHAN_ID = '27478')        group by VIENPHI_ID, REF_TABLE) F on F.REF_TABLE = 'TT_MIENGIAM_CONGTY' and F.VIENPHI_ID = A.VIENPHI_ID        left join TT_DVYEUCAU DVYC on DVYC.DVYEUCAU_ID = A.REF_ID and A.REF_TABLE = 'TT_DVYEUCAU'        left join TM_DICHVU DV on DVYC.DICHVU_ID = DV.DICHVU_ID and A.REF_TABLE = 'TT_DVYEUCAU'        left join TM_NHOMDICHVU ndv on ndv.NHOMDICHVU_ID = DV.NHOMDICHVU_ID and A.REF_TABLE = 'TT_DVYEUCAU'        where        A.TIEPNHAN_ID = '27478' and ((DVYC.HUYYEUCAU = '0' and A.DICHVU_ID is not null)        or A.DUOC_ID is not null or A.REF_TABLE = 'TT_NUT_XACNHANSUATAN_CHITIET')        and A.ACTIVE = '1'                 and A.BENHVIEN_ID = 'HLU01'        order by A.VIENPHI_ID]
2019-09-20 15:52:52,853 [1] DEBUG - Statement Id: [DAO00006_GetListDuocTyle] PreparedStatement : [select DUOC_ID, DOITUONG_ID, (TYLE/100) as TYLE, DONGIA MUCTRAN_THANHTOAN from TM_DOITUONG_GIADUOC_TYLE            where            BENHVIEN_ID = 'HLU01'            and DOITUONG_ID = '4']
2019-09-20 15:52:52,887 [1] DEBUG - Statement Id: [DAO00027_GetListTuongTrinhDichVuPhauThuatCuaTiepNhan] PreparedStatement : [declare @ManhomDSA varchar(10);        declare @PhanLoaiNhomDV varchar(20) = '05';        select top 1  @ManhomDSA = VALUE from TM_SYS_APPSETTINGS where CODE = 'MANHOM_DICHVU_DSA'        if (@ManhomDSA is not null) set @PhanLoaiNhomDV += ',' + @ManhomDSA        select distinct ptyc.*        from TT_PHAUTHUAT_YEUCAU ptyc        inner join TM_DICHVU dv on dv.DICHVU_ID = ptyc.DICHVU_ID        inner join TM_NHOMDICHVU ndv on ndv.NHOMDICHVU_ID = dv.NHOMDICHVU_ID        inner join TT_PHAUTHUAT pt on pt.PHAUTHUAT_ID = ptyc.PHAUTHUAT_ID        where        pt.TIEPNHAN_ID = 27478        and (left(ndv.MANHOMDICHVU, 2) in (select * from STRING_SPLIT(@PhanLoaiNhomDV,',')) or ndv.MANHOMDICHVU in (select * from STRING_SPLIT(@PhanLoaiNhomDV,',')))]
2019-09-20 15:52:52,935 [1] DEBUG - Statement Id: [DAO00006_GetList] PreparedStatement : [select dv.*, loaiDV.MALOAIDICHVU, captren.NHOMDICHVU_ID as NHOMDICHVU_CAPTREN_ID, captren.TENNHOMDICHVU as NHOMDICHVU_CAPTREN,              nhom_dv.TENNHOMDICHVU as TENNHOMDICHVU, nhom_dv.MANHOMDICHVU,              case when dv.ATTRIBUTE5 is null then 'TT' else 'KTC' end as LOAI_CHIPHI              from TM_DICHVU as dv              left join TM_NHOMDICHVU as nhom_dv on nhom_dv.NHOMDICHVU_ID = dv.NHOMDICHVU_ID and nhom_dv.BENHVIEN_ID = 'HLU01'              left join TM_NHOMDICHVU as captren on nhom_dv.CAPTREN_ID = captren.NHOMDICHVU_ID and captren.BENHVIEN_ID = 'HLU01'              left join TM_LOAIDICHVU loaiDV on nhom_dv.LOAIDICHVU_ID = loaiDV.LOAIDICHVU_ID and loaiDV.BENHVIEN_ID = 'HLU01'              where nhom_dv.TAMNGUNG = '0' and dv.BENHVIEN_ID = 'HLU01'              and dv.TAMNGUNG = '0'               AND                   loaiDV.MALOAIDICHVU = 'KhamBenh']
2019-09-20 15:52:53,055 [1] DEBUG - Statement Id: [DAO00023_UpdateNhieuVP] PreparedStatement : [declare @jsonVienPhi nvarchar(max) = N'[{"VIENPHI_ID":674724,"TIEPNHAN_ID":27478,"BENHAN_ID":0,"SOLUONG":1.0000,"DONGIA_DOANHTHU":33000.0000,"THANHTIEN_DOANHTHU":33000.00,"BHYT_TL":0.8000,"BHYT_DONGIA":33000.0000,"BHYT_THANHTIEN":33000.00,"BHYT_DONGIA_CONGKHAM_DAU":33000.0000,"BHYT_CONGKHAM_DAU_TYLE":1.0,"BHYT_DONGIA_CHITRA":26400.0,"BHYT_THANHTIEN_CHITRA":26400.00,"BENHNHAN_PHAITHANHTOAN":6600.00,"GIATRI_HOADON":6600.00,"GIATRI_HOADON_DATHANHTOAN":0.0,"GIATRI_BIENLAI":0.0,"GIATRI_BIENLAI_DATHANHTOAN":0.0,"GIATRI_BENHNHAN_DATHANHTOAN":0.0,"DATHUCHIEN":"1","KHONGTHUTIEN":"0","BHYTDONGTIEN":"0","DICHVU_TL":1.0,"BHYT_DONGIA_DONGCT_DAU":0.0,"SOBHYT":"DN453534653452338289","SOBHYT_HUONG_ID":28501,"GIATRIMIENGIAM":0.0,"GIATRIMIENGIAM_BHTN":0.0,"GIATRIMIENGIAM_THANHVIEN":0.0,"GIATRIMIENGIAM_CONGTY":0.0},{"VIENPHI_ID":674725,"TIEPNHAN_ID":27478,"BENHAN_ID":0,"SOLUONG":1.0000,"DONGIA_DOANHTHU":260000.0000,"THANHTIEN_DOANHTHU":260000.00,"BHYT_TL":0.8000,"BHYT_DONGIA":260000.0000,"BHYT_THANHTIEN":260000.00,"BHYT_DONGIA_CONGKHAM_DAU":33000.0000,"BHYT_CONGKHAM_DAU_TYLE":1.0,"BHYT_DONGIA_CHITRA":208000.0,"BHYT_THANHTIEN_CHITRA":208000.00,"BENHNHAN_PHAITHANHTOAN":52000.00,"GIATRI_HOADON":52000.00,"GIATRI_HOADON_DATHANHTOAN":0.0,"GIATRI_BIENLAI":0.0,"GIATRI_BIENLAI_DATHANHTOAN":0.0,"GIATRI_BENHNHAN_DATHANHTOAN":0.0,"DATHUCHIEN":"1","KHONGTHUTIEN":"0","BHYTDONGTIEN":"0","DICHVU_TL":1.0,"BHYT_DONGIA_DONGCT_DAU":0.0,"SOBHYT":"DN453534653452338289","SOBHYT_HUONG_ID":28501,"GIATRIMIENGIAM":0.0,"GIATRIMIENGIAM_BHTN":0.0,"GIATRIMIENGIAM_THANHVIEN":0.0,"GIATRIMIENGIAM_CONGTY":0.0},{"VIENPHI_ID":674726,"TIEPNHAN_ID":27478,"BENHAN_ID":0,"SOLUONG":1.0000,"DONGIA_DOANHTHU":37000.0000,"THANHTIEN_DOANHTHU":37000.00,"BHYT_TL":0.8000,"BHYT_DONGIA":37000.0000,"BHYT_THANHTIEN":37000.00,"BHYT_DONGIA_CONGKHAM_DAU":33000.0000,"BHYT_CONGKHAM_DAU_TYLE":1.0,"BHYT_DONGIA_CHITRA":29600.0,"BHYT_THANHTIEN_CHITRA":29600.00,"BENHNHAN_PHAITHANHTOAN":7400.00,"GIATRI_HOADON":7400.00,"GIATRI_HOADON_DATHANHTOAN":0.0,"GIATRI_BIENLAI":0.0,"GIATRI_BIENLAI_DATHANHTOAN":0.0,"GIATRI_BENHNHAN_DATHANHTOAN":0.0,"DATHUCHIEN":"1","KHONGTHUTIEN":"0","BHYTDONGTIEN":"0","DICHVU_TL":1.0,"BHYT_DONGIA_DONGCT_DAU":0.0,"SOBHYT":"DN453534653452338289","SOBHYT_HUONG_ID":28501,"GIATRIMIENGIAM":0.0,"GIATRIMIENGIAM_BHTN":0.0,"GIATRIMIENGIAM_THANHVIEN":0.0,"GIATRIMIENGIAM_CONGTY":0.0}]';        begin        UPDATE TT_VIENPHI        SET        SOLUONG = json.SOLUONG,        DONGIA_DOANHTHU = json.DONGIA_DOANHTHU,        THANHTIEN_DOANHTHU = json.THANHTIEN_DOANHTHU,        BHYT_TL = json.BHYT_TL,        BHYT_DONGIA = json.BHYT_DONGIA,        BHYT_THANHTIEN = json.BHYT_THANHTIEN,        BHYT_DONGIA_CONGKHAM_DAU = json.BHYT_DONGIA_CONGKHAM_DAU,        BHYT_CONGKHAM_DAU_TYLE = json.BHYT_CONGKHAM_DAU_TYLE,        BHYT_DONGIA_CHITRA = json.BHYT_DONGIA_CHITRA,        BHYT_THANHTIEN_CHITRA = json.BHYT_THANHTIEN_CHITRA,        BENHNHAN_PHAITHANHTOAN = json.BENHNHAN_PHAITHANHTOAN,        GIATRI_HOADON = json.GIATRI_HOADON,                GIATRI_BIENLAI = json.GIATRI_BIENLAI,                DATHUCHIEN = json.DATHUCHIEN,                DICHVU_TL = json.DICHVU_TL,        BHYT_DONGIA_DONGCT_DAU = json.BHYT_DONGIA_DONGCT_DAU,        NGAYCAPNHAT = GETDATE()        FROM OPENJSON (@jsonVienPhi)        WITH (        VIENPHI_ID int,        SOLUONG numeric(25, 4),        DONGIA_DOANHTHU numeric(25, 4),        THANHTIEN_DOANHTHU numeric(25, 4),        BHYT_TL numeric(25, 4),        BHYT_DONGIA numeric(25, 4),        BHYT_THANHTIEN numeric(25, 4),        BHYT_DONGIA_CONGKHAM_DAU numeric(25, 4),        BHYT_CONGKHAM_DAU_TYLE numeric(25, 4),        BHYT_DONGIA_CHITRA numeric(25, 4),        BHYT_THANHTIEN_CHITRA numeric(25, 4),        BENHNHAN_PHAITHANHTOAN numeric(25, 4),        GIATRI_HOADON numeric(25, 4),                GIATRI_BIENLAI numeric(25, 4),                DATHUCHIEN char(1),        KHONGTHUTIEN char(1),        BHYTDONGTIEN char(1),        DICHVU_TL numeric(25, 4),        BHYT_DONGIA_DONGCT_DAU numeric(25, 4))  json        WHERE TT_VIENPHI.VIENPHI_ID = json.VIENPHI_ID                        insert into TT_TINH_VIENPHI_LOG        SELECT json.VIENPHI_ID, json.TIEPNHAN_ID, json.BENHAN_ID, json.SOLUONG, json.BHYT_TL, json.DONGIA_DOANHTHU,        json.THANHTIEN_DOANHTHU, json.BHYT_DONGIA, json.BHYT_THANHTIEN, json.BHYT_DONGIA_CHITRA, json.BHYT_THANHTIEN_CHITRA, json.BENHNHAN_PHAITHANHTOAN,        json.SOBHYT_HUONG_ID, json.SOBHYT, GETDATE(), -1, 'HLU01'        FROM OPENJSON(@jsonVienPhi)        WITH (        VIENPHI_ID int,        TIEPNHAN_ID int,        BENHAN_ID int,        SOLUONG numeric(25, 4),        DONGIA_DOANHTHU numeric(25, 4),        THANHTIEN_DOANHTHU numeric(25, 4),        BHYT_TL numeric(25, 4),        BHYT_DONGIA numeric(25, 4),        BHYT_THANHTIEN numeric(25, 4),        BHYT_DONGIA_CHITRA numeric(25, 4),        BHYT_THANHTIEN_CHITRA numeric(25, 4),        BENHNHAN_PHAITHANHTOAN numeric(25, 4),        SOBHYT_HUONG_ID int,        SOBHYT nvarchar(30)) json        end]
2019-09-20 15:52:53,119 [1] DEBUG - Statement Id: [DAO00067_UpdateDataVienPhiDongiaBHYT] PreparedStatement : [update TT_VIENPHI          set BHYT_DONGIA_CHITRA = 0, BHYT_THANHTIEN = 0, BHYT_THANHTIEN_CHITRA = 0          where          TIEPNHAN_ID = 27478 and BHYT_DONGIA = 0          and (BHYT_DONGIA_CHITRA > 0 or BHYT_THANHTIEN > 0 or BHYT_THANHTIEN_CHITRA > 0)]
2019-09-20 15:52:53,151 [1] DEBUG - Statement Id: [DAO00067_CapnhatDataVienphiKhiHuyThanhtoanHoadon] PreparedStatement : [update TT_VIENPHI        set TT_VIENPHI.HOADON_ID = hdct.HOADON_ID, TT_VIENPHI.GIATRI_BENHNHAN_DATHANHTOAN = TT_VIENPHI.GIATRI_BENHNHAN_DATHANHTOAN + hdct.GIATRI_BENHNHAN_DATHANHTOAN        from (select CT.HOADON_ID, CT.VIENPHI_ID, CT.GIATRI_BENHNHAN_DATHANHTOAN        from TT_HOADON_CHITIET_NGOAITRU CT        join TT_HOADON HD on HD.HOADON_ID = CT.HOADON_ID        join TT_VIENPHI vp on vp.VIENPHI_ID = ct.VIENPHI_ID        where HD.DATHANHTOAN = 1 and HD.HUYHOADON = 0 and HD.HOANTRA = 0 and vp.TIEPNHAN_ID =  @param0 ) hdct        where        TT_VIENPHI.VIENPHI_ID = hdct.VIENPHI_ID and TT_VIENPHI.HOADON_ID is null and isnull(TT_VIENPHI.GIATRI_BENHNHAN_DATHANHTOAN,0) = 0        and TT_VIENPHI.TIEPNHAN_ID =  @param0           update TT_VIENPHI        set TT_VIENPHI.HOADON_ID = null, TT_VIENPHI.GIATRI_BENHNHAN_DATHANHTOAN = TT_VIENPHI.GIATRI_BENHNHAN_DATHANHTOAN - hdct.GIATRI_BENHNHAN_DATHANHTOAN,        TT_VIENPHI.DATHANHTOAN = '0'        from (select CT.HOADON_ID, CT.VIENPHI_ID, CT.GIATRI_BENHNHAN_DATHANHTOAN        from TT_HOADON_CHITIET_NGOAITRU CT        join TT_HOADON HD on HD.HOADON_ID = CT.HOADON_ID        join TT_VIENPHI vp on vp.VIENPHI_ID = ct.VIENPHI_ID and vp.HOADON_ID = ct.HOADON_ID        where HD.DATHANHTOAN = 0 and (HD.HUYHOADON = 1 or HD.HOANTRA = 1) and vp.TIEPNHAN_ID =  @param0 ) hdct        where        TT_VIENPHI.VIENPHI_ID = hdct.VIENPHI_ID and TT_VIENPHI.HOADON_ID = hdct.HOADON_ID        and TT_VIENPHI.TIEPNHAN_ID =  @param0]
2019-09-20 15:52:53,151 [1] DEBUG - Statement Id: [DAO00067_CapnhatDataVienphiKhiHuyThanhtoanHoadon] Parameters: [@param0=[TIEPNHAN_ID,27478]]
2019-09-20 15:52:53,151 [1] DEBUG - Statement Id: [DAO00067_CapnhatDataVienphiKhiHuyThanhtoanHoadon] Types: [@param0=[Int64, System.Int64]]
2019-09-20 15:52:53,312 [1] DEBUG - Statement Id: [DAO00017_GetLoaiGiaByDoiTuongId] PreparedStatement : [select dtlg.DOUUTIEN, dtlg.DOITUONG_ID, lg.LOAIGIA_ID, lg.TENLOAIGIA, lg.MALOAIGIA              from TM_LOAIGIA lg              left join TM_DOITUONG_LOAIGIA dtlg              on lg.LOAIGIA_ID = dtlg.LOAIGIA_ID and dtlg.BENHVIEN_ID = 'HLU01'              where lg.TAMNGUNG = 0 and lg.BENHVIEN_ID = 'HLU01'                             order by dtlg.DOUUTIEN]
2019-09-20 15:52:53,353 [1] DEBUG - Statement Id: [DAO00014_KiemTraDVYCCoBHYT] PreparedStatement : [select *        from TT_VIENPHI        where REF_ID  = '205440' and REF_TABLE = 'TT_DVYEUCAU' and BHYT_DONGIA > 0]
2019-09-20 15:52:53,393 [1] DEBUG - Statement Id: [DAO00040_LayListToaMau] PreparedStatement : [select A.*, dc.TENDUOCDAYDU, dc.BHYT DUOC_BHYT, ld.LOAIVATTU_ID, ld.MALOAIDUOC, dd.DICTIONARY_NAME DUONGDUNG, dc.TAMNGUNG            from TT_TOATHUOCMAU A            left join TM_DUOC dc on A.DUOC_ID = dc.DUOC_ID            left join TM_LOAIDUOC ld on dc.LOAIDUOC_ID = ld.LOAIDUOC_ID            left join (select * from LST_DICTIONARY where DICTIONARY_TYPE_CODE like 'DuongDung') dd on dd.DICTIONARY_ID = dc.DUONGDUNG_ID            where (1=1)             and               A.BACSI_ID  = 1              and A.LOAITOATHUOC in  (                        @param0                   ,                           @param1                   ,                           @param2                   ,                           @param3                   )]
2019-09-20 15:52:53,393 [1] DEBUG - Statement Id: [DAO00040_LayListToaMau] Parameters: [@param0=[LSTLOAITOATHUOC[0],BV], @param1=[LSTLOAITOATHUOC[1],MN], @param2=[LSTLOAITOATHUOC[2],MP], @param3=[LSTLOAITOATHUOC[3],TV]]
2019-09-20 15:52:53,393 [1] DEBUG - Statement Id: [DAO00040_LayListToaMau] Types: [@param0=[String, System.String], @param1=[String, System.String], @param2=[String, System.String], @param3=[String, System.String]]
2019-09-20 15:52:53,479 [1] DEBUG - Statement Id: [DAO00040_LayListToaMau] PreparedStatement : [select A.*, dc.TENDUOCDAYDU, dc.BHYT DUOC_BHYT, ld.LOAIVATTU_ID, ld.MALOAIDUOC, dd.DICTIONARY_NAME DUONGDUNG, dc.TAMNGUNG            from TT_TOATHUOCMAU A            left join TM_DUOC dc on A.DUOC_ID = dc.DUOC_ID            left join TM_LOAIDUOC ld on dc.LOAIDUOC_ID = ld.LOAIDUOC_ID            left join (select * from LST_DICTIONARY where DICTIONARY_TYPE_CODE like 'DuongDung') dd on dd.DICTIONARY_ID = dc.DUONGDUNG_ID            where (1=1)             and               A.BACSI_ID  = 1              and A.LOAITOATHUOC in  (                        @param0                   ,                           @param1                   ,                           @param2                   ,                           @param3                   )]
2019-09-20 15:52:53,479 [1] DEBUG - Statement Id: [DAO00040_LayListToaMau] Parameters: [@param0=[LSTLOAITOATHUOC[0],BV], @param1=[LSTLOAITOATHUOC[1],MN], @param2=[LSTLOAITOATHUOC[2],MP], @param3=[LSTLOAITOATHUOC[3],TV]]
2019-09-20 15:52:53,479 [1] DEBUG - Statement Id: [DAO00040_LayListToaMau] Types: [@param0=[String, System.String], @param1=[String, System.String], @param2=[String, System.String], @param3=[String, System.String]]
2019-09-20 15:52:53,537 [1] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoVaBookingCOM23UpdateRedis_TheoPhamvi] PreparedStatement : [declare @TOAMUANGOAI int = 0;        select @TOAMUANGOAI = isnull(VALUE,0) from TM_SYS_APPSETTINGS where CODE = 'OPD_TOAMUANGOAI_DUNGDANHMUC_DUOC'                if @TOAMUANGOAI = 1        begin        select  distinct '0' + '_' + LTRIM(d.DUOC_ID) + '_' + '0' as DUOC_KEY, 999999999 as SOLUONG        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        where  @param0  = 0        union all        select distinct tk.DUOC_KEY, tk.SOLUONG        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        inner join        (        select  LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')) DUOC_KEY, (SUM(dtk.SOLUONG) - isnull(sum(A.SOLUONG),0) - isnull(sum(B.SOLUONG),0)) SOLUONG, pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        from (select sum(soluong) soluong,duoc_id,nguonduoc_id,khoduoc_id,benhvien_id from TT_DUOC_TONKHO  group by duoc_id,nguonduoc_id,khoduoc_id,benhvien_id) dtk        inner join TM_DUOC_PHAMVISD_MAPPING pvsd on dtk.KHODUOC_ID = pvsd.KHODUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NOITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) B on B.DUOC_ID = dtk.DUOC_ID and B.PHAMVI_ID = pvsd.PHAMVI_ID and B.NGUONHANG_ID = dtk.NGUONDUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NGOAITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) A on A.DUOC_ID = dtk.DUOC_ID and A.PHAMVI_ID = pvsd.PHAMVI_ID and A.NGUONHANG_ID = dtk.NGUONDUOC_ID        where dtk.BENHVIEN_ID = 'HLU01'        group by LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')), pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        ) tk on tk.DUOC_ID = d.DUOC_ID        left join TM_DUOC_PHAMVISUDUNG kd on kd.PHAMVI_ID = tk.PHAMVI_ID and kd.BENHVIEN_ID = 'HLU01'        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = tk.NGUONDUOC_ID and nh.BENHVIEN_ID = 'HLU01'        where d.BENHVIEN_ID = 'HLU01' and tk.PHAMVI_ID =  @param0         end        else        begin        select distinct tk.DUOC_KEY, tk.SOLUONG        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        inner join        (        select  LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')) DUOC_KEY, (SUM(dtk.SOLUONG) - isnull(sum(A.SOLUONG),0) - isnull(sum(B.SOLUONG),0)) SOLUONG, pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        from (select sum(soluong) soluong,duoc_id,nguonduoc_id,khoduoc_id,benhvien_id from TT_DUOC_TONKHO  group by duoc_id,nguonduoc_id,khoduoc_id,benhvien_id) dtk        inner join TM_DUOC_PHAMVISD_MAPPING pvsd on dtk.KHODUOC_ID = pvsd.KHODUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NOITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) B on B.DUOC_ID = dtk.DUOC_ID and B.PHAMVI_ID = pvsd.PHAMVI_ID and B.NGUONHANG_ID = dtk.NGUONDUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NGOAITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) A on A.DUOC_ID = dtk.DUOC_ID and A.PHAMVI_ID = pvsd.PHAMVI_ID and A.NGUONHANG_ID = dtk.NGUONDUOC_ID        where dtk.BENHVIEN_ID = 'HLU01'        group by LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')), pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        ) tk on tk.DUOC_ID = d.DUOC_ID        left join TM_DUOC_PHAMVISUDUNG kd on kd.PHAMVI_ID = tk.PHAMVI_ID and kd.BENHVIEN_ID = 'HLU01'        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = tk.NGUONDUOC_ID and nh.BENHVIEN_ID = 'HLU01'        where d.BENHVIEN_ID = 'HLU01' and tk.PHAMVI_ID =  @param0         end]
2019-09-20 15:52:53,537 [1] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoVaBookingCOM23UpdateRedis_TheoPhamvi] Parameters: [@param0=[PHAMVI_ID,1028]]
2019-09-20 15:52:53,537 [1] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoVaBookingCOM23UpdateRedis_TheoPhamvi] Types: [@param0=[Int64, System.Int64]]
2019-09-20 15:52:53,762 [1] DEBUG - Statement Id: [DAO00013_GetTienSuBenh] PreparedStatement : [select TIENSUBENH, TIENSUDIUNG              from TT_BENHNHAN              where TT_BENHNHAN.BENHNHAN_ID  = '23423']
2019-09-20 15:52:53,795 [1] DEBUG - Statement Id: [DAO00095_GetTTDiUngThuoc] PreparedStatement : [select *              from TT_BENHNHAN_DIUNG_THUOC              where BENHNHAN_ID = '23423'              and BENHVIEN_ID = 'HLU01']
2019-09-20 15:52:53,823 [1] DEBUG - Statement Id: [DAO00014_GetTotalChiPhiDVByTiepNhan] PreparedStatement : [select sum(THANHTIEN_DOANHTHU) as THANHTIEN_DOANHTHU from TT_VIENPHI        where ACTIVE = '1'        and TIEPNHAN_ID = '27478'        and REF_TABLE = 'TT_DVYEUCAU'        and exists (select DVYEUCAU_ID from TT_DVYEUCAU where HUYYEUCAU = '0' and TIEPNHAN_ID = '27478' and TT_VIENPHI.REF_ID = DVYEUCAU_ID)]
2019-09-20 15:52:53,861 [1] DEBUG - Statement Id: [DAO00014_GetKhamBenhInfo] PreparedStatement : [select * from TT_NGOAITRU_KHAMBENH where KHAMBENH_ID =        (select KHAMBENH_NGOAITRU_ID from TT_DVYEUCAU where DVYEUCAU_ID = '205440')]
2019-09-20 15:52:53,900 [1] DEBUG - Statement Id: [DAO00068_GetSinhHieuBySinhHieuID] PreparedStatement : [select top (1) *            from TT_NGOAITRU_KHAMBENH_SINHHIEU            where KHAMBENH_SINHHIEU_ID = '0'            and BENHVIEN_ID = 'HLU01'             and               BENHNHAN_ID = '23423'                           order by KHAMBENH_SINHHIEU_ID]
2019-09-20 15:52:54,003 [1] DEBUG - Statement Id: [DAO00014_GetKhamBenhICDInfo] PreparedStatement : [select *        from TT_NGOAITRU_KHAMBENH_ICD        where KHAMBENH_ID  = '26172']
2019-09-20 15:52:54,034 [1] DEBUG - Statement Id: [DAO00014_GetListToaThuoc] PreparedStatement : [select A.*        from TT_NGOAITRU_KHAMBENH_TOATHUOC A        where A.KHAMBENH_ID = '26172']
2019-09-20 15:52:54,065 [1] DEBUG - Statement Id: [DAO00014_KiemTraDVYCCoBHYT] PreparedStatement : [select *        from TT_VIENPHI        where REF_ID  = '205440' and REF_TABLE = 'TT_DVYEUCAU' and BHYT_DONGIA > 0]
2019-09-20 15:52:54,107 [1] DEBUG - Statement Id: [DAO00040_LayListToaMau] PreparedStatement : [select A.*, dc.TENDUOCDAYDU, dc.BHYT DUOC_BHYT, ld.LOAIVATTU_ID, ld.MALOAIDUOC, dd.DICTIONARY_NAME DUONGDUNG, dc.TAMNGUNG            from TT_TOATHUOCMAU A            left join TM_DUOC dc on A.DUOC_ID = dc.DUOC_ID            left join TM_LOAIDUOC ld on dc.LOAIDUOC_ID = ld.LOAIDUOC_ID            left join (select * from LST_DICTIONARY where DICTIONARY_TYPE_CODE like 'DuongDung') dd on dd.DICTIONARY_ID = dc.DUONGDUNG_ID            where (1=1)             and               A.BACSI_ID  = 1              and A.LOAITOATHUOC in  (                        @param0                   ,                           @param1                   ,                           @param2                   ,                           @param3                   )]
2019-09-20 15:52:54,107 [1] DEBUG - Statement Id: [DAO00040_LayListToaMau] Parameters: [@param0=[LSTLOAITOATHUOC[0],BV], @param1=[LSTLOAITOATHUOC[1],MN], @param2=[LSTLOAITOATHUOC[2],MP], @param3=[LSTLOAITOATHUOC[3],TV]]
2019-09-20 15:52:54,107 [1] DEBUG - Statement Id: [DAO00040_LayListToaMau] Types: [@param0=[String, System.String], @param1=[String, System.String], @param2=[String, System.String], @param3=[String, System.String]]
2019-09-20 15:52:54,199 [1] DEBUG - Statement Id: [DAO00040_LayListToaMau] PreparedStatement : [select A.*, dc.TENDUOCDAYDU, dc.BHYT DUOC_BHYT, ld.LOAIVATTU_ID, ld.MALOAIDUOC, dd.DICTIONARY_NAME DUONGDUNG, dc.TAMNGUNG            from TT_TOATHUOCMAU A            left join TM_DUOC dc on A.DUOC_ID = dc.DUOC_ID            left join TM_LOAIDUOC ld on dc.LOAIDUOC_ID = ld.LOAIDUOC_ID            left join (select * from LST_DICTIONARY where DICTIONARY_TYPE_CODE like 'DuongDung') dd on dd.DICTIONARY_ID = dc.DUONGDUNG_ID            where (1=1)             and               A.BACSI_ID  = 1              and A.LOAITOATHUOC in  (                        @param0                   ,                           @param1                   ,                           @param2                   ,                           @param3                   )]
2019-09-20 15:52:54,199 [1] DEBUG - Statement Id: [DAO00040_LayListToaMau] Parameters: [@param0=[LSTLOAITOATHUOC[0],BV], @param1=[LSTLOAITOATHUOC[1],MN], @param2=[LSTLOAITOATHUOC[2],MP], @param3=[LSTLOAITOATHUOC[3],TV]]
2019-09-20 15:52:54,199 [1] DEBUG - Statement Id: [DAO00040_LayListToaMau] Types: [@param0=[String, System.String], @param1=[String, System.String], @param2=[String, System.String], @param3=[String, System.String]]
2019-09-20 15:52:54,242 [1] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoVaBookingCOM23UpdateRedis_TheoPhamvi] PreparedStatement : [declare @TOAMUANGOAI int = 0;        select @TOAMUANGOAI = isnull(VALUE,0) from TM_SYS_APPSETTINGS where CODE = 'OPD_TOAMUANGOAI_DUNGDANHMUC_DUOC'                if @TOAMUANGOAI = 1        begin        select  distinct '0' + '_' + LTRIM(d.DUOC_ID) + '_' + '0' as DUOC_KEY, 999999999 as SOLUONG        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        where  @param0  = 0        union all        select distinct tk.DUOC_KEY, tk.SOLUONG        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        inner join        (        select  LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')) DUOC_KEY, (SUM(dtk.SOLUONG) - isnull(sum(A.SOLUONG),0) - isnull(sum(B.SOLUONG),0)) SOLUONG, pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        from (select sum(soluong) soluong,duoc_id,nguonduoc_id,khoduoc_id,benhvien_id from TT_DUOC_TONKHO  group by duoc_id,nguonduoc_id,khoduoc_id,benhvien_id) dtk        inner join TM_DUOC_PHAMVISD_MAPPING pvsd on dtk.KHODUOC_ID = pvsd.KHODUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NOITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) B on B.DUOC_ID = dtk.DUOC_ID and B.PHAMVI_ID = pvsd.PHAMVI_ID and B.NGUONHANG_ID = dtk.NGUONDUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NGOAITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) A on A.DUOC_ID = dtk.DUOC_ID and A.PHAMVI_ID = pvsd.PHAMVI_ID and A.NGUONHANG_ID = dtk.NGUONDUOC_ID        where dtk.BENHVIEN_ID = 'HLU01'        group by LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')), pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        ) tk on tk.DUOC_ID = d.DUOC_ID        left join TM_DUOC_PHAMVISUDUNG kd on kd.PHAMVI_ID = tk.PHAMVI_ID and kd.BENHVIEN_ID = 'HLU01'        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = tk.NGUONDUOC_ID and nh.BENHVIEN_ID = 'HLU01'        where d.BENHVIEN_ID = 'HLU01' and tk.PHAMVI_ID =  @param0         end        else        begin        select distinct tk.DUOC_KEY, tk.SOLUONG        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        inner join        (        select  LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')) DUOC_KEY, (SUM(dtk.SOLUONG) - isnull(sum(A.SOLUONG),0) - isnull(sum(B.SOLUONG),0)) SOLUONG, pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        from (select sum(soluong) soluong,duoc_id,nguonduoc_id,khoduoc_id,benhvien_id from TT_DUOC_TONKHO  group by duoc_id,nguonduoc_id,khoduoc_id,benhvien_id) dtk        inner join TM_DUOC_PHAMVISD_MAPPING pvsd on dtk.KHODUOC_ID = pvsd.KHODUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NOITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) B on B.DUOC_ID = dtk.DUOC_ID and B.PHAMVI_ID = pvsd.PHAMVI_ID and B.NGUONHANG_ID = dtk.NGUONDUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NGOAITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) A on A.DUOC_ID = dtk.DUOC_ID and A.PHAMVI_ID = pvsd.PHAMVI_ID and A.NGUONHANG_ID = dtk.NGUONDUOC_ID        where dtk.BENHVIEN_ID = 'HLU01'        group by LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')), pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        ) tk on tk.DUOC_ID = d.DUOC_ID        left join TM_DUOC_PHAMVISUDUNG kd on kd.PHAMVI_ID = tk.PHAMVI_ID and kd.BENHVIEN_ID = 'HLU01'        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = tk.NGUONDUOC_ID and nh.BENHVIEN_ID = 'HLU01'        where d.BENHVIEN_ID = 'HLU01' and tk.PHAMVI_ID =  @param0         end]
2019-09-20 15:52:54,242 [1] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoVaBookingCOM23UpdateRedis_TheoPhamvi] Parameters: [@param0=[PHAMVI_ID,1028]]
2019-09-20 15:52:54,242 [1] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoVaBookingCOM23UpdateRedis_TheoPhamvi] Types: [@param0=[Int64, System.Int64]]
2019-09-20 15:52:54,476 [1] DEBUG - Statement Id: [DAO00068_GetLastedSinhHieuInfo] PreparedStatement : [select top (1) *, CHISOBMI as BMI              from TT_NGOAITRU_KHAMBENH_SINHHIEU              where BENHNHAN_ID = '23423'              order by KHAMBENH_SINHHIEU_ID desc]
2019-09-20 15:52:54,590 [1] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoVaBookingCOM23UpdateRedis_TheoPhamvi] PreparedStatement : [declare @TOAMUANGOAI int = 0;        select @TOAMUANGOAI = isnull(VALUE,0) from TM_SYS_APPSETTINGS where CODE = 'OPD_TOAMUANGOAI_DUNGDANHMUC_DUOC'                if @TOAMUANGOAI = 1        begin        select  distinct '0' + '_' + LTRIM(d.DUOC_ID) + '_' + '0' as DUOC_KEY, 999999999 as SOLUONG        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        where  @param0  = 0        union all        select distinct tk.DUOC_KEY, tk.SOLUONG        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        inner join        (        select  LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')) DUOC_KEY, (SUM(dtk.SOLUONG) - isnull(sum(A.SOLUONG),0) - isnull(sum(B.SOLUONG),0)) SOLUONG, pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        from (select sum(soluong) soluong,duoc_id,nguonduoc_id,khoduoc_id,benhvien_id from TT_DUOC_TONKHO  group by duoc_id,nguonduoc_id,khoduoc_id,benhvien_id) dtk        inner join TM_DUOC_PHAMVISD_MAPPING pvsd on dtk.KHODUOC_ID = pvsd.KHODUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NOITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) B on B.DUOC_ID = dtk.DUOC_ID and B.PHAMVI_ID = pvsd.PHAMVI_ID and B.NGUONHANG_ID = dtk.NGUONDUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NGOAITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) A on A.DUOC_ID = dtk.DUOC_ID and A.PHAMVI_ID = pvsd.PHAMVI_ID and A.NGUONHANG_ID = dtk.NGUONDUOC_ID        where dtk.BENHVIEN_ID = 'HLU01'        group by LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')), pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        ) tk on tk.DUOC_ID = d.DUOC_ID        left join TM_DUOC_PHAMVISUDUNG kd on kd.PHAMVI_ID = tk.PHAMVI_ID and kd.BENHVIEN_ID = 'HLU01'        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = tk.NGUONDUOC_ID and nh.BENHVIEN_ID = 'HLU01'        where d.BENHVIEN_ID = 'HLU01' and tk.PHAMVI_ID =  @param0         end        else        begin        select distinct tk.DUOC_KEY, tk.SOLUONG        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        inner join        (        select  LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')) DUOC_KEY, (SUM(dtk.SOLUONG) - isnull(sum(A.SOLUONG),0) - isnull(sum(B.SOLUONG),0)) SOLUONG, pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        from (select sum(soluong) soluong,duoc_id,nguonduoc_id,khoduoc_id,benhvien_id from TT_DUOC_TONKHO  group by duoc_id,nguonduoc_id,khoduoc_id,benhvien_id) dtk        inner join TM_DUOC_PHAMVISD_MAPPING pvsd on dtk.KHODUOC_ID = pvsd.KHODUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NOITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) B on B.DUOC_ID = dtk.DUOC_ID and B.PHAMVI_ID = pvsd.PHAMVI_ID and B.NGUONHANG_ID = dtk.NGUONDUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NGOAITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) A on A.DUOC_ID = dtk.DUOC_ID and A.PHAMVI_ID = pvsd.PHAMVI_ID and A.NGUONHANG_ID = dtk.NGUONDUOC_ID        where dtk.BENHVIEN_ID = 'HLU01'        group by LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')), pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        ) tk on tk.DUOC_ID = d.DUOC_ID        left join TM_DUOC_PHAMVISUDUNG kd on kd.PHAMVI_ID = tk.PHAMVI_ID and kd.BENHVIEN_ID = 'HLU01'        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = tk.NGUONDUOC_ID and nh.BENHVIEN_ID = 'HLU01'        where d.BENHVIEN_ID = 'HLU01' and tk.PHAMVI_ID =  @param0         end]
2019-09-20 15:52:54,590 [1] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoVaBookingCOM23UpdateRedis_TheoPhamvi] Parameters: [@param0=[PHAMVI_ID,1028]]
2019-09-20 15:52:54,590 [1] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoVaBookingCOM23UpdateRedis_TheoPhamvi] Types: [@param0=[Int64, System.Int64]]
2019-09-20 15:53:02,389 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'BIL09'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2019-09-20 15:53:02,599 [1] DEBUG - Statement Id: [DAO00031_GetList] PreparedStatement : [select *              from TM_DOITUONG              where ACTIVE = 1 and BENHVIEN_ID = 'HLU01'               and                   MADOITUONG like '%BHYT%']
2019-09-20 15:53:08,577 [1] DEBUG - Statement Id: [DAO00064_GetListBenhNhan] PreparedStatement : [select * from        (        select *, COUNT(*) OVER() as TOTALROWS,  ROW_NUMBER() OVER(order by lst.SOTIEPNHAN desc) as ROWNUMBER        from        (select distinct        B.SOBHYT, B.NGAYTIEPNHAN , B.THOIGIANTIEPNHAN as NGAYVAO, B.SOTIEPNHAN, B.DOITUONG_ID, B.TIEPNHAN_ID, B.GHICHU_KHOADULIEU,        C.MAYTE as MABN, C.TENBENHNHAN as TENBN, C.NAMSINH , C.BENHNHAN_ID, B.BENHVIEN_ID,        D.XACNHANCHIPHI_ID, D.NGAYXACNHAN, C.SONHA as DIACHITHUONGTRU, isnull(C.SONHA, C.DIACHITHUONGTRU) AS DIACHILIENLAC, PB.TENPHONGBAN        from TT_TIEPNHAN B        inner join TT_BENHNHAN C on B.BENHNHAN_ID = C.BENHNHAN_ID        left join TT_XACNHANCHIPHI D on D.TIEPNHAN_ID = B.TIEPNHAN_ID        left join (        select tn.TIEPNHAN_ID, max(kb.KHAMBENH_ID) AS KHAMBENH_ID        from TT_TIEPNHAN TN        inner join TT_NGOAITRU_KHAMBENH kb on kb.TIEPNHAN_ID = tn.TIEPNHAN_ID and kb.BENHVIEN_ID = tn.BENHVIEN_ID        where 1=1         and           TN.NGAYTIEPNHAN >= '9/20/2019 12:00:00 AM'         and           TN.NGAYTIEPNHAN <= '9/20/2019 3:53:02 PM'                 group by tn.TIEPNHAN_ID        ) E on E.TIEPNHAN_ID = B.TIEPNHAN_ID        left join TT_NGOAITRU_KHAMBENH kb on kb.KHAMBENH_ID = E.KHAMBENH_ID        left join TM_PHONGBAN PB on PB.PHONGBAN_ID = KB.PHONGBAN_ID        where        (not exists (select TIEPNHAN_ID from TT_NOITRU_BENHAN where TIEPNHAN_ID = B.TIEPNHAN_ID)) and        (B.SOBHYT is not null and B.SOBHYT != '') and        (B.TRANGTHAI = 'DATIEPNHAN' or B.TRANGTHAI = 'HOANTHANH' ) and C.MAYTE is not null         and           B.NGAYTIEPNHAN >= '9/20/2019 12:00:00 AM'         and           B.NGAYTIEPNHAN <= '9/20/2019 3:53:02 PM'                 and B.BENHVIEN_ID = 'HLU01'                 ) lst        ) ds                    where          ds.ROWNUMBER between 1 and 20]
2019-09-20 15:53:08,754 [1] DEBUG - Statement Id: [DAO00064_GetThongtinKhambenh] PreparedStatement : [select top 1 pb.TENPHONGBAN, nv.TENNHANVIEN        from TT_NGOAITRU_KHAMBENH A        left join TT_DVYEUCAU B on A.KHAMBENH_ID = B.KHAMBENH_NGOAITRU_ID        left join TM_NHANVIEN nv on nv.NHANVIEN_ID = A.BACSIKHAM_ID        left join TM_PHONGBAN pb on pb.PHONGBAN_ID = B.NOITHUCHIEN_ID        where A.TIEPNHAN_ID = '27478']
2019-09-20 15:53:10,256 [1] DEBUG - Statement Id: [DAO00014_GetPatientStatusXacNhanChiPhi] PreparedStatement : [select        tn.TRANGTHAI as TRANGTHAI        from TT_TIEPNHAN tn        where tn.TIEPNHAN_ID = '27478'        and tn.BENHVIEN_ID = 'HLU01']
2019-09-20 15:53:10,353 [1] DEBUG - Statement Id: [DAO00064_TT_NGOAITRU_KHAMBENH_TOATHUOC_GetListToaThuocBHYT] PreparedStatement : [select * from TT_NGOAITRU_KHAMBENH_TOATHUOC        where (exists (select KHAMBENH_NGOAITRU_ID from TT_DVYEUCAU where TT_NGOAITRU_KHAMBENH_TOATHUOC.KHAMBENH_ID = KHAMBENH_NGOAITRU_ID and TIEPNHAN_ID = '27478')) and TIEPNHAN_ID = '27478' and LOAITOATHUOC = 'BV']
2019-09-20 15:53:10,405 [1] DEBUG - Statement Id: [DAO00064_GetlistTT_TIEPNHAN_SOTHEBHYT] PreparedStatement : [select stbhyt.*, ba.SOBENHAN,         tn.SOTIEPNHAN, tn.LOAITHANHVIEN_ID, tn.THE_ID, tn.THANHVIEN_ID,        tn.SUDUNG_BHTN, tn.BAOLANH_VIENPHI, tn.VIP, tn.NGUOINUOCNGOAI        from TT_TIEPNHAN_SOTHEBHYT stbhyt        left join TT_TIEPNHAN tn on tn.TIEPNHAN_ID = stbhyt.TIEPNHAN_ID        left join TT_NOITRU_BENHAN ba on ba.TIEPNHAN_ID = stbhyt.TIEPNHAN_ID        where         stbhyt.TIEPNHAN_ID = '27478' and isnull(stbhyt.KHONGSUDUNG, '0') = '0']
2019-09-20 15:53:10,471 [1] DEBUG - Statement Id: [DAO00064_GetListVienPhiByTiepNnan] PreparedStatement : [select distinct        B.DOITUONG_ID, B.NGAYMIENDONGCHITRA, B.BENHNHAN_ID as TIEPNHAN_BENHNHAN_ID, B.TRAITUYEN,        B.BHYTTREN3NAM as TREN3NAM, B.BHYTTREN5NAM as TREN5NAM, B.SOTIEPNHAN, B.SOBENHAN,        B.LOAITHANHVIEN_ID, B.SUDUNG_BHTN, B.THE_ID, B.THANHVIEN_ID, B.BAOLANH_VIENPHI, B.VIP, B.NGUOINUOCNGOAI,        C.GIATRIMIENGIAM as GIATRIMIENGIAM, D.GIATRIMIENGIAM as GIATRIMIENGIAM_BHTN, E.GIATRIMIENGIAM as GIATRIMIENGIAM_THANHVIEN,        F.GIATRIMIENGIAM as GIATRIMIENGIAM_CONGTY, DVYC.THE_ID as DVDUNGTHE, DVYC.TRANGTHAI as TRANGTHAIDICHVU, ndv.MANHOMDICHVU,        A.* from TT_VIENPHI A        left join        (select B.*, C.SOBENHAN, C.BENHAN_ID        from TT_TIEPNHAN B        left join TT_NOITRU_BENHAN C on B.TIEPNHAN_ID = C.TIEPNHAN_ID                 where B.TIEPNHAN_ID = '27478') B on B.TIEPNHAN_ID = A.TIEPNHAN_ID        left join (select sum(GIATRIMIENGIAM) as GIATRIMIENGIAM, VIENPHI_ID, REF_TABLE        from TT_MIENGIAM_CHITIET        where REF_TABLE = 'TT_MIENGIAM'        and exists (select MIENGIAM_ID from TT_MIENGIAM where TT_MIENGIAM_CHITIET.MIENGIAM_ID = MIENGIAM_ID and TINHTRANG = 1 and TIEPNHAN_ID = '27478')        group by VIENPHI_ID, REF_TABLE) C on C.REF_TABLE = 'TT_MIENGIAM' and C.VIENPHI_ID = A.VIENPHI_ID        left join (select sum(GIATRIMIENGIAM) as GIATRIMIENGIAM, VIENPHI_ID, REF_TABLE        from TT_MIENGIAM_CHITIET        where REF_TABLE = 'TT_MIENGIAM_BHTN'        and exists (select MIENGIAM_BHTN_ID from TT_MIENGIAM_BHTN where TT_MIENGIAM_CHITIET.MIENGIAM_ID = MIENGIAM_BHTN_ID and  TINHTRANG = 1 and TIEPNHAN_ID = '27478')        group by VIENPHI_ID, REF_TABLE) D on D.REF_TABLE = 'TT_MIENGIAM_BHTN' and D.VIENPHI_ID = A.VIENPHI_ID        left join (select sum(GIATRIMIENGIAM) as GIATRIMIENGIAM, VIENPHI_ID, REF_TABLE        from TT_MIENGIAM_CHITIET        where REF_TABLE = 'TT_MIENGIAM_THANHVIEN'        and exists (select MIENGIAM_THANHVIEN_ID from TT_MIENGIAM_THANHVIEN where TT_MIENGIAM_CHITIET.MIENGIAM_ID = MIENGIAM_THANHVIEN_ID and TINHTRANG = 1 and TIEPNHAN_ID = '27478')        group by VIENPHI_ID, REF_TABLE) E on E.REF_TABLE = 'TT_MIENGIAM_THANHVIEN' and E.VIENPHI_ID = A.VIENPHI_ID        left join (select sum(GIATRIMIENGIAM) as GIATRIMIENGIAM, VIENPHI_ID, REF_TABLE        from TT_MIENGIAM_CHITIET        where REF_TABLE = 'TT_MIENGIAM_CONGTY'        and exists (select MIENGIAM_CONGTY_ID from TT_MIENGIAM_CONGTY where TT_MIENGIAM_CHITIET.MIENGIAM_ID = MIENGIAM_CONGTY_ID and TINHTRANG = 1 and TIEPNHAN_ID = '27478')        group by VIENPHI_ID, REF_TABLE) F on F.REF_TABLE = 'TT_MIENGIAM_CONGTY' and F.VIENPHI_ID = A.VIENPHI_ID        left join TT_DVYEUCAU DVYC on DVYC.DVYEUCAU_ID = A.REF_ID and A.REF_TABLE = 'TT_DVYEUCAU'        left join TM_DICHVU DV on DVYC.DICHVU_ID = DV.DICHVU_ID and A.REF_TABLE = 'TT_DVYEUCAU'        left join TM_NHOMDICHVU ndv on ndv.NHOMDICHVU_ID = DV.NHOMDICHVU_ID and A.REF_TABLE = 'TT_DVYEUCAU'        where        A.TIEPNHAN_ID = '27478' and ((DVYC.HUYYEUCAU = '0' and A.DICHVU_ID is not null)        or A.DUOC_ID is not null or A.REF_TABLE = 'TT_NUT_XACNHANSUATAN_CHITIET')        and A.ACTIVE = '1'                 and A.BENHVIEN_ID = 'HLU01'        order by A.VIENPHI_ID]
2019-09-20 15:53:10,567 [1] DEBUG - Statement Id: [DAO00006_GetListDuocTyle] PreparedStatement : [select DUOC_ID, DOITUONG_ID, (TYLE/100) as TYLE, DONGIA MUCTRAN_THANHTOAN from TM_DOITUONG_GIADUOC_TYLE            where            BENHVIEN_ID = 'HLU01'            and DOITUONG_ID = '4']
2019-09-20 15:53:10,601 [1] DEBUG - Statement Id: [DAO00027_GetListTuongTrinhDichVuPhauThuatCuaTiepNhan] PreparedStatement : [declare @ManhomDSA varchar(10);        declare @PhanLoaiNhomDV varchar(20) = '05';        select top 1  @ManhomDSA = VALUE from TM_SYS_APPSETTINGS where CODE = 'MANHOM_DICHVU_DSA'        if (@ManhomDSA is not null) set @PhanLoaiNhomDV += ',' + @ManhomDSA        select distinct ptyc.*        from TT_PHAUTHUAT_YEUCAU ptyc        inner join TM_DICHVU dv on dv.DICHVU_ID = ptyc.DICHVU_ID        inner join TM_NHOMDICHVU ndv on ndv.NHOMDICHVU_ID = dv.NHOMDICHVU_ID        inner join TT_PHAUTHUAT pt on pt.PHAUTHUAT_ID = ptyc.PHAUTHUAT_ID        where        pt.TIEPNHAN_ID = 27478        and (left(ndv.MANHOMDICHVU, 2) in (select * from STRING_SPLIT(@PhanLoaiNhomDV,',')) or ndv.MANHOMDICHVU in (select * from STRING_SPLIT(@PhanLoaiNhomDV,',')))]
2019-09-20 15:53:10,661 [1] DEBUG - Statement Id: [DAO00006_GetList] PreparedStatement : [select dv.*, loaiDV.MALOAIDICHVU, captren.NHOMDICHVU_ID as NHOMDICHVU_CAPTREN_ID, captren.TENNHOMDICHVU as NHOMDICHVU_CAPTREN,              nhom_dv.TENNHOMDICHVU as TENNHOMDICHVU, nhom_dv.MANHOMDICHVU,              case when dv.ATTRIBUTE5 is null then 'TT' else 'KTC' end as LOAI_CHIPHI              from TM_DICHVU as dv              left join TM_NHOMDICHVU as nhom_dv on nhom_dv.NHOMDICHVU_ID = dv.NHOMDICHVU_ID and nhom_dv.BENHVIEN_ID = 'HLU01'              left join TM_NHOMDICHVU as captren on nhom_dv.CAPTREN_ID = captren.NHOMDICHVU_ID and captren.BENHVIEN_ID = 'HLU01'              left join TM_LOAIDICHVU loaiDV on nhom_dv.LOAIDICHVU_ID = loaiDV.LOAIDICHVU_ID and loaiDV.BENHVIEN_ID = 'HLU01'              where nhom_dv.TAMNGUNG = '0' and dv.BENHVIEN_ID = 'HLU01'              and dv.TAMNGUNG = '0'               AND                   loaiDV.MALOAIDICHVU = 'KhamBenh']
2019-09-20 15:53:10,716 [1] DEBUG - Statement Id: [DAO00023_UpdateNhieuVP] PreparedStatement : [declare @jsonVienPhi nvarchar(max) = N'[{"VIENPHI_ID":674724,"TIEPNHAN_ID":27478,"BENHAN_ID":0,"SOLUONG":1.0000,"DONGIA_DOANHTHU":33000.0000,"THANHTIEN_DOANHTHU":33000.00,"BHYT_TL":0.8000,"BHYT_DONGIA":33000.0000,"BHYT_THANHTIEN":33000.00,"BHYT_DONGIA_CONGKHAM_DAU":33000.0000,"BHYT_CONGKHAM_DAU_TYLE":1.0,"BHYT_DONGIA_CHITRA":26400.0,"BHYT_THANHTIEN_CHITRA":26400.00,"BENHNHAN_PHAITHANHTOAN":6600.00,"GIATRI_HOADON":6600.00,"GIATRI_HOADON_DATHANHTOAN":0.0,"GIATRI_BIENLAI":0.0,"GIATRI_BIENLAI_DATHANHTOAN":0.0,"GIATRI_BENHNHAN_DATHANHTOAN":0.0,"DATHUCHIEN":"1","KHONGTHUTIEN":"0","BHYTDONGTIEN":"0","DICHVU_TL":1.0,"BHYT_DONGIA_DONGCT_DAU":0.0,"SOBHYT":"DN453534653452338289","SOBHYT_HUONG_ID":28501,"GIATRIMIENGIAM":0.0,"GIATRIMIENGIAM_BHTN":0.0,"GIATRIMIENGIAM_THANHVIEN":0.0,"GIATRIMIENGIAM_CONGTY":0.0},{"VIENPHI_ID":674725,"TIEPNHAN_ID":27478,"BENHAN_ID":0,"SOLUONG":1.0000,"DONGIA_DOANHTHU":260000.0000,"THANHTIEN_DOANHTHU":260000.00,"BHYT_TL":0.8000,"BHYT_DONGIA":260000.0000,"BHYT_THANHTIEN":260000.00,"BHYT_DONGIA_CONGKHAM_DAU":33000.0000,"BHYT_CONGKHAM_DAU_TYLE":1.0,"BHYT_DONGIA_CHITRA":208000.0,"BHYT_THANHTIEN_CHITRA":208000.00,"BENHNHAN_PHAITHANHTOAN":52000.00,"GIATRI_HOADON":52000.00,"GIATRI_HOADON_DATHANHTOAN":0.0,"GIATRI_BIENLAI":0.0,"GIATRI_BIENLAI_DATHANHTOAN":0.0,"GIATRI_BENHNHAN_DATHANHTOAN":0.0,"DATHUCHIEN":"1","KHONGTHUTIEN":"0","BHYTDONGTIEN":"0","DICHVU_TL":1.0,"BHYT_DONGIA_DONGCT_DAU":0.0,"SOBHYT":"DN453534653452338289","SOBHYT_HUONG_ID":28501,"GIATRIMIENGIAM":0.0,"GIATRIMIENGIAM_BHTN":0.0,"GIATRIMIENGIAM_THANHVIEN":0.0,"GIATRIMIENGIAM_CONGTY":0.0},{"VIENPHI_ID":674726,"TIEPNHAN_ID":27478,"BENHAN_ID":0,"SOLUONG":1.0000,"DONGIA_DOANHTHU":37000.0000,"THANHTIEN_DOANHTHU":37000.00,"BHYT_TL":0.8000,"BHYT_DONGIA":37000.0000,"BHYT_THANHTIEN":37000.00,"BHYT_DONGIA_CONGKHAM_DAU":33000.0000,"BHYT_CONGKHAM_DAU_TYLE":1.0,"BHYT_DONGIA_CHITRA":29600.0,"BHYT_THANHTIEN_CHITRA":29600.00,"BENHNHAN_PHAITHANHTOAN":7400.00,"GIATRI_HOADON":7400.00,"GIATRI_HOADON_DATHANHTOAN":0.0,"GIATRI_BIENLAI":0.0,"GIATRI_BIENLAI_DATHANHTOAN":0.0,"GIATRI_BENHNHAN_DATHANHTOAN":0.0,"DATHUCHIEN":"1","KHONGTHUTIEN":"0","BHYTDONGTIEN":"0","DICHVU_TL":1.0,"BHYT_DONGIA_DONGCT_DAU":0.0,"SOBHYT":"DN453534653452338289","SOBHYT_HUONG_ID":28501,"GIATRIMIENGIAM":0.0,"GIATRIMIENGIAM_BHTN":0.0,"GIATRIMIENGIAM_THANHVIEN":0.0,"GIATRIMIENGIAM_CONGTY":0.0}]';        begin        UPDATE TT_VIENPHI        SET        SOLUONG = json.SOLUONG,        DONGIA_DOANHTHU = json.DONGIA_DOANHTHU,        THANHTIEN_DOANHTHU = json.THANHTIEN_DOANHTHU,        BHYT_TL = json.BHYT_TL,        BHYT_DONGIA = json.BHYT_DONGIA,        BHYT_THANHTIEN = json.BHYT_THANHTIEN,        BHYT_DONGIA_CONGKHAM_DAU = json.BHYT_DONGIA_CONGKHAM_DAU,        BHYT_CONGKHAM_DAU_TYLE = json.BHYT_CONGKHAM_DAU_TYLE,        BHYT_DONGIA_CHITRA = json.BHYT_DONGIA_CHITRA,        BHYT_THANHTIEN_CHITRA = json.BHYT_THANHTIEN_CHITRA,        BENHNHAN_PHAITHANHTOAN = json.BENHNHAN_PHAITHANHTOAN,        GIATRI_HOADON = json.GIATRI_HOADON,                GIATRI_BIENLAI = json.GIATRI_BIENLAI,                DATHUCHIEN = json.DATHUCHIEN,                DICHVU_TL = json.DICHVU_TL,        BHYT_DONGIA_DONGCT_DAU = json.BHYT_DONGIA_DONGCT_DAU,        NGAYCAPNHAT = GETDATE()        FROM OPENJSON (@jsonVienPhi)        WITH (        VIENPHI_ID int,        SOLUONG numeric(25, 4),        DONGIA_DOANHTHU numeric(25, 4),        THANHTIEN_DOANHTHU numeric(25, 4),        BHYT_TL numeric(25, 4),        BHYT_DONGIA numeric(25, 4),        BHYT_THANHTIEN numeric(25, 4),        BHYT_DONGIA_CONGKHAM_DAU numeric(25, 4),        BHYT_CONGKHAM_DAU_TYLE numeric(25, 4),        BHYT_DONGIA_CHITRA numeric(25, 4),        BHYT_THANHTIEN_CHITRA numeric(25, 4),        BENHNHAN_PHAITHANHTOAN numeric(25, 4),        GIATRI_HOADON numeric(25, 4),                GIATRI_BIENLAI numeric(25, 4),                DATHUCHIEN char(1),        KHONGTHUTIEN char(1),        BHYTDONGTIEN char(1),        DICHVU_TL numeric(25, 4),        BHYT_DONGIA_DONGCT_DAU numeric(25, 4))  json        WHERE TT_VIENPHI.VIENPHI_ID = json.VIENPHI_ID                        insert into TT_TINH_VIENPHI_LOG        SELECT json.VIENPHI_ID, json.TIEPNHAN_ID, json.BENHAN_ID, json.SOLUONG, json.BHYT_TL, json.DONGIA_DOANHTHU,        json.THANHTIEN_DOANHTHU, json.BHYT_DONGIA, json.BHYT_THANHTIEN, json.BHYT_DONGIA_CHITRA, json.BHYT_THANHTIEN_CHITRA, json.BENHNHAN_PHAITHANHTOAN,        json.SOBHYT_HUONG_ID, json.SOBHYT, GETDATE(), -1, 'HLU01'        FROM OPENJSON(@jsonVienPhi)        WITH (        VIENPHI_ID int,        TIEPNHAN_ID int,        BENHAN_ID int,        SOLUONG numeric(25, 4),        DONGIA_DOANHTHU numeric(25, 4),        THANHTIEN_DOANHTHU numeric(25, 4),        BHYT_TL numeric(25, 4),        BHYT_DONGIA numeric(25, 4),        BHYT_THANHTIEN numeric(25, 4),        BHYT_DONGIA_CHITRA numeric(25, 4),        BHYT_THANHTIEN_CHITRA numeric(25, 4),        BENHNHAN_PHAITHANHTOAN numeric(25, 4),        SOBHYT_HUONG_ID int,        SOBHYT nvarchar(30)) json        end]
2019-09-20 15:53:10,818 [1] DEBUG - Statement Id: [DAO00067_UpdateDataVienPhiDongiaBHYT] PreparedStatement : [update TT_VIENPHI          set BHYT_DONGIA_CHITRA = 0, BHYT_THANHTIEN = 0, BHYT_THANHTIEN_CHITRA = 0          where          TIEPNHAN_ID = 27478 and BHYT_DONGIA = 0          and (BHYT_DONGIA_CHITRA > 0 or BHYT_THANHTIEN > 0 or BHYT_THANHTIEN_CHITRA > 0)]
2019-09-20 15:53:10,862 [1] DEBUG - Statement Id: [DAO00067_CapnhatDataVienphiKhiHuyThanhtoanHoadon] PreparedStatement : [update TT_VIENPHI        set TT_VIENPHI.HOADON_ID = hdct.HOADON_ID, TT_VIENPHI.GIATRI_BENHNHAN_DATHANHTOAN = TT_VIENPHI.GIATRI_BENHNHAN_DATHANHTOAN + hdct.GIATRI_BENHNHAN_DATHANHTOAN        from (select CT.HOADON_ID, CT.VIENPHI_ID, CT.GIATRI_BENHNHAN_DATHANHTOAN        from TT_HOADON_CHITIET_NGOAITRU CT        join TT_HOADON HD on HD.HOADON_ID = CT.HOADON_ID        join TT_VIENPHI vp on vp.VIENPHI_ID = ct.VIENPHI_ID        where HD.DATHANHTOAN = 1 and HD.HUYHOADON = 0 and HD.HOANTRA = 0 and vp.TIEPNHAN_ID =  @param0 ) hdct        where        TT_VIENPHI.VIENPHI_ID = hdct.VIENPHI_ID and TT_VIENPHI.HOADON_ID is null and isnull(TT_VIENPHI.GIATRI_BENHNHAN_DATHANHTOAN,0) = 0        and TT_VIENPHI.TIEPNHAN_ID =  @param0           update TT_VIENPHI        set TT_VIENPHI.HOADON_ID = null, TT_VIENPHI.GIATRI_BENHNHAN_DATHANHTOAN = TT_VIENPHI.GIATRI_BENHNHAN_DATHANHTOAN - hdct.GIATRI_BENHNHAN_DATHANHTOAN,        TT_VIENPHI.DATHANHTOAN = '0'        from (select CT.HOADON_ID, CT.VIENPHI_ID, CT.GIATRI_BENHNHAN_DATHANHTOAN        from TT_HOADON_CHITIET_NGOAITRU CT        join TT_HOADON HD on HD.HOADON_ID = CT.HOADON_ID        join TT_VIENPHI vp on vp.VIENPHI_ID = ct.VIENPHI_ID and vp.HOADON_ID = ct.HOADON_ID        where HD.DATHANHTOAN = 0 and (HD.HUYHOADON = 1 or HD.HOANTRA = 1) and vp.TIEPNHAN_ID =  @param0 ) hdct        where        TT_VIENPHI.VIENPHI_ID = hdct.VIENPHI_ID and TT_VIENPHI.HOADON_ID = hdct.HOADON_ID        and TT_VIENPHI.TIEPNHAN_ID =  @param0]
2019-09-20 15:53:10,862 [1] DEBUG - Statement Id: [DAO00067_CapnhatDataVienphiKhiHuyThanhtoanHoadon] Parameters: [@param0=[TIEPNHAN_ID,27478]]
2019-09-20 15:53:10,862 [1] DEBUG - Statement Id: [DAO00067_CapnhatDataVienphiKhiHuyThanhtoanHoadon] Types: [@param0=[Int64, System.Int64]]
2019-09-20 15:53:10,956 [1] DEBUG - Statement Id: [DAO00064_GetVienphiTiepNhan_BIL09] PreparedStatement : [select distinct case when c.DVYEUCAU_ID is not null then c.TRANGTHAI        when tk.KHAMBENH_TOATHUOC_ID is not null then case when tk.CHUNGTUPHATTHUOC_ID is not null then 'DAXUAT' else 'CHUAXUAT' end        when vtyt.PHAUTHUAT_VTYT_ID is not null then case when vtyt.CHUNGTU_ID is not null then 'DAXUAT' else 'CHUAXUAT' end        when kqvtyt.CLSKETQUA_VTYT_ID is not null then case when kqvtyt.TRANGTHAI is not null then 'DAXUAT' else 'CHUAXUAT' end        else '' end as TRANGTHAI        , C.NOITHUCHIEN_ID as PHONGBAN_ID, D.NGAYKHAM,        ISNULL(A.DICHVU_ID, A.DUOC_ID) as NOIDUNG_ID, A.REF_ID as IDREF, A.VIENPHI_ID,        A.SOLUONG as SOLUONG, A.SOLUONG as SOLUONG_NEW, A.DICHVU_ID, A.DUOC_ID, A.BHYT_DONGIA_CHITRA,        A.DONGIA_DOANHTHU, A.DONGIA_DOANHTHU as DONGIADOANHTHU, A.BHYT_DONGIA as DONGIAHOTRO, A.BHYT_THANHTIEN_CHITRA as DONGIAHOTROCHITRA, A.BHYT_DONGIA_CHITRA as DONGIAHOTROCHITRA_NEW,        A.REF_TABLE as LOAI, A.BHYT_DONGIA, A.BHYT_THANHTIEN, A.BHYT_THANHTIEN_CHITRA, A.BENHNHAN_PHAITHANHTOAN, A.GIATRI_BENHNHAN_DATHANHTOAN, A.BENHVIEN_ID, A.THANHTIEN_DOANHTHU,        A.LOAI_CHIPHI, A.LOAIGIA_ID, REF_TABLE, A.KHAMBENH_ID, A.REF_ID, A.DUOCPHEPTHUCHIEN,        A.HUY, A.KHONGTHUTIEN, A.DATHANHTOAN, A.HOADON_ID, A.ACTIVE, C.DVYEUCAU_ID, C.NGAYYEUCAU, ISNULL(C.BACSICHIDINH_ID, C.NGUOIGIOITHIEU_ID) as BACSICHIDINH_ID, C.NOIYEUCAU_ID        , A.DATHUCHIEN,        isnull(dv.TENDICHVU, dc.TENDUOCDAYDU) NOIDUNG, isnull(dv.MADICHVU, dc.MADUOC) MADICHVU, dv.NORESULT, dc.DONVITINH, ld.MALOAIDUOC, dc.BHYT DUOC_BHYT, ld.LOAIVATTU_ID,        ndv.MANHOMDICHVU, D.KBPBHUONGGIAIQUYET NOIDUNG2, D.HUONGGIAIQUYET_ID        from TT_VIENPHI A        left join (select * from TT_DVYEUCAU where TIEPNHAN_ID = '27478') C on C.TIEPNHAN_ID = A.TIEPNHAN_ID and C.DICHVU_ID = A.DICHVU_ID  and C.DVYEUCAU_ID = A.REF_ID        left join (        select pb.TENPHONGBAN + ' - ' + nv.TENNHANVIEN + ' - '+ hgq.DICTIONARY_NAME KBPBHUONGGIAIQUYET, kb.* from TT_NGOAITRU_KHAMBENH kb        left join TM_PHONGBAN pb on pb.PHONGBAN_ID = kb.PHONGBAN_ID        left join TM_NHANVIEN nv on nv.NHANVIEN_ID = kb.BACSIKHAM_ID        left join (select * from LST_DICTIONARY where DICTIONARY_TYPE_CODE = 'GiaiQuyetKhamBenh') hgq on hgq.DICTIONARY_ID = kb.HUONGGIAIQUYET_ID        where kb.TIEPNHAN_ID = '27478'        ) D on D.TIEPNHAN_ID = A.TIEPNHAN_ID and D.DICHVU_ID = A.DICHVU_ID and C.KHAMBENH_NGOAITRU_ID = D.KHAMBENH_ID        left join (select * from TT_NGOAITRU_TOATHUOC where TIEPNHAN_ID = '27478') E on E.DUOC_ID = A.DUOC_ID and E.TOATHUOC_ID = A.REF_ID and A.REF_TABLE = 'TT_NGOAITRU_TOATHUOC'        left join TT_NGOAITRU_KHAMBENH_TOATHUOC tk on tk.KHAMBENH_TOATHUOC_ID = e.KHAMBENH_TOATHUOC_ID        left join TT_PHAUTHUAT_VTYT vtyt on vtyt.PHAUTHUAT_VTYT_ID = a.REF_ID and a.REF_TABLE = 'TT_PHAUTHUAT_VTYT'        left join TT_CLSKETQUA_VTYT kqvtyt on kqvtyt.CLSKETQUA_VTYT_ID = a.REF_ID and a.REF_TABLE = 'TT_CLSKETQUA_VTYT'        left join TM_DICHVU dv on A.DICHVU_ID = dv.DICHVU_ID and A.REF_TABLE = 'TT_DVYEUCAU'        left join TM_DUOC dc on A.DUOC_ID = dc.DUOC_ID        left join TM_LOAIDUOC ld on dc.LOAIDUOC_ID = ld.LOAIDUOC_ID        left join TM_NHOMDICHVU ndv on ndv.NHOMDICHVU_ID = dv.NHOMDICHVU_ID        where        A.TIEPNHAN_ID = '27478' and A.BENHVIEN_ID = 'HLU01' and (A.BENHAN_ID is NULL or A.BENHAN_ID = '')          and A.REF_TABLE != 'TT_DUOC_CHUNGTU_CHITIET' and A.KHONGTHUTIEN != '1'        and (exists (select KHAMBENH_ID from TT_NGOAITRU_KHAMBENH where A.KHAMBENH_ID = KHAMBENH_ID and TIEPNHAN_ID = '27478') or A.KHAMBENH_ID is null)        and (C.HUYYEUCAU = '0' or C.HUYYEUCAU is null)          AND             (A.BHYT_DONGIA > 0                           )                       and        (        (A.DICHVU_ID is not null and C.HUYYEUCAU != '1') or (A.DICHVU_ID is null and A.DUOC_ID is not null and A.REF_TABLE != 'TT_DUOC_CHUNGTU_CHITIET')        )        ORDER BY A.VIENPHI_ID]
2019-09-20 15:53:11,345 [1] DEBUG - Statement Id: [DAO00066_GetNhapVienById] PreparedStatement : [select *        from TT_NOITRU_NHAPVIEN        where TT_NOITRU_NHAPVIEN.TIEPNHAN_ID  = '27478' and TT_NOITRU_NHAPVIEN.TRANGTHAI = 'CHOXACNHAN' and TT_NOITRU_NHAPVIEN.LOAIBENHAN != 2        order by NHAPVIEN_ID desc]
2019-09-20 15:53:11,641 [1] DEBUG - Statement Id: [DAO00064_CheckBenhNhanChuaXSDVTYT] PreparedStatement : [IF EXISTS (        select vt.KHAMBENH_VTYT_ID        from TT_NGOAITRU_KHAMBENH_VTYT vt        inner join TT_NGOAITRU_KHAMBENH kb on kb.KHAMBENH_ID = vt.KHAMBENH_ID        where kb.TIEPNHAN_ID = 27478        and kb.BENHVIEN_ID = 'HLU01'        and vt.CHUNGTU_ID is null          union all          select vt.CLSKETQUA_VTYT_ID        from TT_CLSKETQUA_VTYT vt        inner join TT_DVYEUCAU yc on yc.DVYEUCAU_ID = vt.DVYEUCAU_ID and yc.BENHVIEN_ID = vt.BENHVIEN_ID        where yc.TIEPNHAN_ID = 27478        and yc.BENHVIEN_ID = 'HLU01'        and vt.CHUNGTU_ID is null        )        BEGIN        SELECT -1 AS RESULT        END        ELSE        BEGIN        SELECT 1 AS RESULT        END]
2019-09-20 15:53:15,433 [1] DEBUG - Statement Id: [DAO00066_GetNhapVienById] PreparedStatement : [select *        from TT_NOITRU_NHAPVIEN        where TT_NOITRU_NHAPVIEN.TIEPNHAN_ID  = '27478' and TT_NOITRU_NHAPVIEN.TRANGTHAI = 'CHOXACNHAN' and TT_NOITRU_NHAPVIEN.LOAIBENHAN != 2        order by NHAPVIEN_ID desc]
2019-09-20 15:53:15,530 [1] DEBUG - Statement Id: [DAO00064_CheckBenhNhanChuaXSDVTYT] PreparedStatement : [IF EXISTS (        select vt.KHAMBENH_VTYT_ID        from TT_NGOAITRU_KHAMBENH_VTYT vt        inner join TT_NGOAITRU_KHAMBENH kb on kb.KHAMBENH_ID = vt.KHAMBENH_ID        where kb.TIEPNHAN_ID = 27478        and kb.BENHVIEN_ID = 'HLU01'        and vt.CHUNGTU_ID is null          union all          select vt.CLSKETQUA_VTYT_ID        from TT_CLSKETQUA_VTYT vt        inner join TT_DVYEUCAU yc on yc.DVYEUCAU_ID = vt.DVYEUCAU_ID and yc.BENHVIEN_ID = vt.BENHVIEN_ID        where yc.TIEPNHAN_ID = 27478        and yc.BENHVIEN_ID = 'HLU01'        and vt.CHUNGTU_ID is null        )        BEGIN        SELECT -1 AS RESULT        END        ELSE        BEGIN        SELECT 1 AS RESULT        END]
2019-09-20 15:53:15,633 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'COM15'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2019-09-20 15:53:19,700 [1] DEBUG - Statement Id: [DAO00064_ValidateThoiGianXacNhanBHYT] PreparedStatement : [IF EXISTS (SELECT DVYEUCAU_ID        FROM TT_DVYEUCAU        WHERE TIEPNHAN_ID = 27478 AND BENHVIEN_ID = 'HLU01' AND NGAYGIOYEUCAU > '9/20/2019 3:53:15 PM'        )        BEGIN        SELECT -1 AS RESULT        END        ELSE        IF EXISTS (SELECT CLSKETQUA_ID        FROM TT_CLSKETQUA        WHERE TIEPNHAN_ID = 27478 AND BENHVIEN_ID = 'HLU01' AND THOIGIANTHUCHIEN > '9/20/2019 3:53:15 PM'        )        BEGIN        SELECT -2 AS RESULT        END        ELSE        IF EXISTS (SELECT PHAUTHUAT_ID        FROM TT_PHAUTHUAT        WHERE TIEPNHAN_ID = 27478 AND BENHVIEN_ID = 'HLU01' AND THOIGIANKETTHUC > '9/20/2019 3:53:15 PM'        )        BEGIN        SELECT -3 AS RESULT        END        ELSE        BEGIN        SELECT 0 AS RESULT        END]
2019-09-20 15:53:32,967 [1] DEBUG - Statement Id: [DAO00066_GetNhapVienById] PreparedStatement : [select *        from TT_NOITRU_NHAPVIEN        where TT_NOITRU_NHAPVIEN.TIEPNHAN_ID  = '27478' and TT_NOITRU_NHAPVIEN.TRANGTHAI = 'CHOXACNHAN' and TT_NOITRU_NHAPVIEN.LOAIBENHAN != 2        order by NHAPVIEN_ID desc]
2019-09-20 15:53:33,105 [1] DEBUG - Statement Id: [DAO00064_CheckBenhNhanChuaXSDVTYT] PreparedStatement : [IF EXISTS (        select vt.KHAMBENH_VTYT_ID        from TT_NGOAITRU_KHAMBENH_VTYT vt        inner join TT_NGOAITRU_KHAMBENH kb on kb.KHAMBENH_ID = vt.KHAMBENH_ID        where kb.TIEPNHAN_ID = 27478        and kb.BENHVIEN_ID = 'HLU01'        and vt.CHUNGTU_ID is null          union all          select vt.CLSKETQUA_VTYT_ID        from TT_CLSKETQUA_VTYT vt        inner join TT_DVYEUCAU yc on yc.DVYEUCAU_ID = vt.DVYEUCAU_ID and yc.BENHVIEN_ID = vt.BENHVIEN_ID        where yc.TIEPNHAN_ID = 27478        and yc.BENHVIEN_ID = 'HLU01'        and vt.CHUNGTU_ID is null        )        BEGIN        SELECT -1 AS RESULT        END        ELSE        BEGIN        SELECT 1 AS RESULT        END]
2019-09-20 15:53:45,252 [1] DEBUG - Statement Id: [DAO00064_ValidateThoiGianXacNhanBHYT] PreparedStatement : [IF EXISTS (SELECT DVYEUCAU_ID        FROM TT_DVYEUCAU        WHERE TIEPNHAN_ID = 27478 AND BENHVIEN_ID = 'HLU01' AND NGAYGIOYEUCAU > '9/20/2019 5:49:33 PM'        )        BEGIN        SELECT -1 AS RESULT        END        ELSE        IF EXISTS (SELECT CLSKETQUA_ID        FROM TT_CLSKETQUA        WHERE TIEPNHAN_ID = 27478 AND BENHVIEN_ID = 'HLU01' AND THOIGIANTHUCHIEN > '9/20/2019 5:49:33 PM'        )        BEGIN        SELECT -2 AS RESULT        END        ELSE        IF EXISTS (SELECT PHAUTHUAT_ID        FROM TT_PHAUTHUAT        WHERE TIEPNHAN_ID = 27478 AND BENHVIEN_ID = 'HLU01' AND THOIGIANKETTHUC > '9/20/2019 5:49:33 PM'        )        BEGIN        SELECT -3 AS RESULT        END        ELSE        BEGIN        SELECT 0 AS RESULT        END]
2019-09-20 15:53:57,031 [1] DEBUG - Statement Id: [DAO00066_GetNhapVienById] PreparedStatement : [select *        from TT_NOITRU_NHAPVIEN        where TT_NOITRU_NHAPVIEN.TIEPNHAN_ID  = '27478' and TT_NOITRU_NHAPVIEN.TRANGTHAI = 'CHOXACNHAN' and TT_NOITRU_NHAPVIEN.LOAIBENHAN != 2        order by NHAPVIEN_ID desc]
2019-09-20 15:53:57,176 [1] DEBUG - Statement Id: [DAO00064_CheckBenhNhanChuaXSDVTYT] PreparedStatement : [IF EXISTS (        select vt.KHAMBENH_VTYT_ID        from TT_NGOAITRU_KHAMBENH_VTYT vt        inner join TT_NGOAITRU_KHAMBENH kb on kb.KHAMBENH_ID = vt.KHAMBENH_ID        where kb.TIEPNHAN_ID = 27478        and kb.BENHVIEN_ID = 'HLU01'        and vt.CHUNGTU_ID is null          union all          select vt.CLSKETQUA_VTYT_ID        from TT_CLSKETQUA_VTYT vt        inner join TT_DVYEUCAU yc on yc.DVYEUCAU_ID = vt.DVYEUCAU_ID and yc.BENHVIEN_ID = vt.BENHVIEN_ID        where yc.TIEPNHAN_ID = 27478        and yc.BENHVIEN_ID = 'HLU01'        and vt.CHUNGTU_ID is null        )        BEGIN        SELECT -1 AS RESULT        END        ELSE        BEGIN        SELECT 1 AS RESULT        END]
2019-09-20 15:56:09,766 [1] DEBUG - Statement Id: [DAO00064_ValidateThoiGianXacNhanBHYT] PreparedStatement : [IF EXISTS (SELECT DVYEUCAU_ID        FROM TT_DVYEUCAU        WHERE TIEPNHAN_ID = 27478 AND BENHVIEN_ID = 'HLU01' AND NGAYGIOYEUCAU > '9/20/2019 3:49:00 PM'        )        BEGIN        SELECT -1 AS RESULT        END        ELSE        IF EXISTS (SELECT CLSKETQUA_ID        FROM TT_CLSKETQUA        WHERE TIEPNHAN_ID = 27478 AND BENHVIEN_ID = 'HLU01' AND THOIGIANTHUCHIEN > '9/20/2019 3:49:00 PM'        )        BEGIN        SELECT -2 AS RESULT        END        ELSE        IF EXISTS (SELECT PHAUTHUAT_ID        FROM TT_PHAUTHUAT        WHERE TIEPNHAN_ID = 27478 AND BENHVIEN_ID = 'HLU01' AND THOIGIANKETTHUC > '9/20/2019 3:49:00 PM'        )        BEGIN        SELECT -3 AS RESULT        END        ELSE        BEGIN        SELECT 0 AS RESULT        END]
2019-09-20 15:56:26,720 [1] DEBUG - Statement Id: [DAO00066_GetNhapVienById] PreparedStatement : [select *        from TT_NOITRU_NHAPVIEN        where TT_NOITRU_NHAPVIEN.TIEPNHAN_ID  = '27478' and TT_NOITRU_NHAPVIEN.TRANGTHAI = 'CHOXACNHAN' and TT_NOITRU_NHAPVIEN.LOAIBENHAN != 2        order by NHAPVIEN_ID desc]
2019-09-20 15:56:26,835 [1] DEBUG - Statement Id: [DAO00064_CheckBenhNhanChuaXSDVTYT] PreparedStatement : [IF EXISTS (        select vt.KHAMBENH_VTYT_ID        from TT_NGOAITRU_KHAMBENH_VTYT vt        inner join TT_NGOAITRU_KHAMBENH kb on kb.KHAMBENH_ID = vt.KHAMBENH_ID        where kb.TIEPNHAN_ID = 27478        and kb.BENHVIEN_ID = 'HLU01'        and vt.CHUNGTU_ID is null          union all          select vt.CLSKETQUA_VTYT_ID        from TT_CLSKETQUA_VTYT vt        inner join TT_DVYEUCAU yc on yc.DVYEUCAU_ID = vt.DVYEUCAU_ID and yc.BENHVIEN_ID = vt.BENHVIEN_ID        where yc.TIEPNHAN_ID = 27478        and yc.BENHVIEN_ID = 'HLU01'        and vt.CHUNGTU_ID is null        )        BEGIN        SELECT -1 AS RESULT        END        ELSE        BEGIN        SELECT 1 AS RESULT        END]
2019-09-20 15:56:42,849 [1] DEBUG - Statement Id: [DAO00064_ValidateThoiGianXacNhanBHYT] PreparedStatement : [IF EXISTS (SELECT DVYEUCAU_ID        FROM TT_DVYEUCAU        WHERE TIEPNHAN_ID = 27478 AND BENHVIEN_ID = 'HLU01' AND NGAYGIOYEUCAU > '9/20/2019 5:49:59 PM'        )        BEGIN        SELECT -1 AS RESULT        END        ELSE        IF EXISTS (SELECT CLSKETQUA_ID        FROM TT_CLSKETQUA        WHERE TIEPNHAN_ID = 27478 AND BENHVIEN_ID = 'HLU01' AND THOIGIANTHUCHIEN > '9/20/2019 5:49:59 PM'        )        BEGIN        SELECT -2 AS RESULT        END        ELSE        IF EXISTS (SELECT PHAUTHUAT_ID        FROM TT_PHAUTHUAT        WHERE TIEPNHAN_ID = 27478 AND BENHVIEN_ID = 'HLU01' AND THOIGIANKETTHUC > '9/20/2019 5:49:59 PM'        )        BEGIN        SELECT -3 AS RESULT        END        ELSE        BEGIN        SELECT 0 AS RESULT        END]
2019-09-20 15:56:46,767 [1] DEBUG - Statement Id: [DAO00066_GetNhapVienById] PreparedStatement : [select *        from TT_NOITRU_NHAPVIEN        where TT_NOITRU_NHAPVIEN.TIEPNHAN_ID  = '27478' and TT_NOITRU_NHAPVIEN.TRANGTHAI = 'CHOXACNHAN' and TT_NOITRU_NHAPVIEN.LOAIBENHAN != 2        order by NHAPVIEN_ID desc]
2019-09-20 15:56:46,944 [1] DEBUG - Statement Id: [DAO00064_CheckBenhNhanChuaXSDVTYT] PreparedStatement : [IF EXISTS (        select vt.KHAMBENH_VTYT_ID        from TT_NGOAITRU_KHAMBENH_VTYT vt        inner join TT_NGOAITRU_KHAMBENH kb on kb.KHAMBENH_ID = vt.KHAMBENH_ID        where kb.TIEPNHAN_ID = 27478        and kb.BENHVIEN_ID = 'HLU01'        and vt.CHUNGTU_ID is null          union all          select vt.CLSKETQUA_VTYT_ID        from TT_CLSKETQUA_VTYT vt        inner join TT_DVYEUCAU yc on yc.DVYEUCAU_ID = vt.DVYEUCAU_ID and yc.BENHVIEN_ID = vt.BENHVIEN_ID        where yc.TIEPNHAN_ID = 27478        and yc.BENHVIEN_ID = 'HLU01'        and vt.CHUNGTU_ID is null        )        BEGIN        SELECT -1 AS RESULT        END        ELSE        BEGIN        SELECT 1 AS RESULT        END]
2019-09-20 15:56:51,756 [1] DEBUG - Statement Id: [DAO00064_ValidateThoiGianXacNhanBHYT] PreparedStatement : [IF EXISTS (SELECT DVYEUCAU_ID        FROM TT_DVYEUCAU        WHERE TIEPNHAN_ID = 27478 AND BENHVIEN_ID = 'HLU01' AND NGAYGIOYEUCAU > '9/20/2019 5:56:46 PM'        )        BEGIN        SELECT -1 AS RESULT        END        ELSE        IF EXISTS (SELECT CLSKETQUA_ID        FROM TT_CLSKETQUA        WHERE TIEPNHAN_ID = 27478 AND BENHVIEN_ID = 'HLU01' AND THOIGIANTHUCHIEN > '9/20/2019 5:56:46 PM'        )        BEGIN        SELECT -2 AS RESULT        END        ELSE        IF EXISTS (SELECT PHAUTHUAT_ID        FROM TT_PHAUTHUAT        WHERE TIEPNHAN_ID = 27478 AND BENHVIEN_ID = 'HLU01' AND THOIGIANKETTHUC > '9/20/2019 5:56:46 PM'        )        BEGIN        SELECT -3 AS RESULT        END        ELSE        BEGIN        SELECT 0 AS RESULT        END]
2019-09-20 15:56:51,827 [1] DEBUG - Statement Id: [DAO00064_TT_NGOAITRU_KHAMBENH_TOATHUOC_GetListToaThuocBHYT] PreparedStatement : [select * from TT_NGOAITRU_KHAMBENH_TOATHUOC        where (exists (select KHAMBENH_NGOAITRU_ID from TT_DVYEUCAU where TT_NGOAITRU_KHAMBENH_TOATHUOC.KHAMBENH_ID = KHAMBENH_NGOAITRU_ID and TIEPNHAN_ID = '27478')) and TIEPNHAN_ID = '27478' and LOAITOATHUOC = 'BV']
2019-09-20 15:56:52,162 [1] DEBUG - Statement Id: [DAO00064_GetlistTT_TIEPNHAN_SOTHEBHYT] PreparedStatement : [select stbhyt.*, ba.SOBENHAN,         tn.SOTIEPNHAN, tn.LOAITHANHVIEN_ID, tn.THE_ID, tn.THANHVIEN_ID,        tn.SUDUNG_BHTN, tn.BAOLANH_VIENPHI, tn.VIP, tn.NGUOINUOCNGOAI        from TT_TIEPNHAN_SOTHEBHYT stbhyt        left join TT_TIEPNHAN tn on tn.TIEPNHAN_ID = stbhyt.TIEPNHAN_ID        left join TT_NOITRU_BENHAN ba on ba.TIEPNHAN_ID = stbhyt.TIEPNHAN_ID        where         stbhyt.TIEPNHAN_ID = '27478' and isnull(stbhyt.KHONGSUDUNG, '0') = '0']
2019-09-20 15:56:52,234 [1] DEBUG - Statement Id: [DAO00064_GetListVienPhiByTiepNnan] PreparedStatement : [select distinct        B.DOITUONG_ID, B.NGAYMIENDONGCHITRA, B.BENHNHAN_ID as TIEPNHAN_BENHNHAN_ID, B.TRAITUYEN,        B.BHYTTREN3NAM as TREN3NAM, B.BHYTTREN5NAM as TREN5NAM, B.SOTIEPNHAN, B.SOBENHAN,        B.LOAITHANHVIEN_ID, B.SUDUNG_BHTN, B.THE_ID, B.THANHVIEN_ID, B.BAOLANH_VIENPHI, B.VIP, B.NGUOINUOCNGOAI,        C.GIATRIMIENGIAM as GIATRIMIENGIAM, D.GIATRIMIENGIAM as GIATRIMIENGIAM_BHTN, E.GIATRIMIENGIAM as GIATRIMIENGIAM_THANHVIEN,        F.GIATRIMIENGIAM as GIATRIMIENGIAM_CONGTY, DVYC.THE_ID as DVDUNGTHE, DVYC.TRANGTHAI as TRANGTHAIDICHVU, ndv.MANHOMDICHVU,        A.* from TT_VIENPHI A        left join        (select B.*, C.SOBENHAN, C.BENHAN_ID        from TT_TIEPNHAN B        left join TT_NOITRU_BENHAN C on B.TIEPNHAN_ID = C.TIEPNHAN_ID                 where B.TIEPNHAN_ID = '27478') B on B.TIEPNHAN_ID = A.TIEPNHAN_ID        left join (select sum(GIATRIMIENGIAM) as GIATRIMIENGIAM, VIENPHI_ID, REF_TABLE        from TT_MIENGIAM_CHITIET        where REF_TABLE = 'TT_MIENGIAM'        and exists (select MIENGIAM_ID from TT_MIENGIAM where TT_MIENGIAM_CHITIET.MIENGIAM_ID = MIENGIAM_ID and TINHTRANG = 1 and TIEPNHAN_ID = '27478')        group by VIENPHI_ID, REF_TABLE) C on C.REF_TABLE = 'TT_MIENGIAM' and C.VIENPHI_ID = A.VIENPHI_ID        left join (select sum(GIATRIMIENGIAM) as GIATRIMIENGIAM, VIENPHI_ID, REF_TABLE        from TT_MIENGIAM_CHITIET        where REF_TABLE = 'TT_MIENGIAM_BHTN'        and exists (select MIENGIAM_BHTN_ID from TT_MIENGIAM_BHTN where TT_MIENGIAM_CHITIET.MIENGIAM_ID = MIENGIAM_BHTN_ID and  TINHTRANG = 1 and TIEPNHAN_ID = '27478')        group by VIENPHI_ID, REF_TABLE) D on D.REF_TABLE = 'TT_MIENGIAM_BHTN' and D.VIENPHI_ID = A.VIENPHI_ID        left join (select sum(GIATRIMIENGIAM) as GIATRIMIENGIAM, VIENPHI_ID, REF_TABLE        from TT_MIENGIAM_CHITIET        where REF_TABLE = 'TT_MIENGIAM_THANHVIEN'        and exists (select MIENGIAM_THANHVIEN_ID from TT_MIENGIAM_THANHVIEN where TT_MIENGIAM_CHITIET.MIENGIAM_ID = MIENGIAM_THANHVIEN_ID and TINHTRANG = 1 and TIEPNHAN_ID = '27478')        group by VIENPHI_ID, REF_TABLE) E on E.REF_TABLE = 'TT_MIENGIAM_THANHVIEN' and E.VIENPHI_ID = A.VIENPHI_ID        left join (select sum(GIATRIMIENGIAM) as GIATRIMIENGIAM, VIENPHI_ID, REF_TABLE        from TT_MIENGIAM_CHITIET        where REF_TABLE = 'TT_MIENGIAM_CONGTY'        and exists (select MIENGIAM_CONGTY_ID from TT_MIENGIAM_CONGTY where TT_MIENGIAM_CHITIET.MIENGIAM_ID = MIENGIAM_CONGTY_ID and TINHTRANG = 1 and TIEPNHAN_ID = '27478')        group by VIENPHI_ID, REF_TABLE) F on F.REF_TABLE = 'TT_MIENGIAM_CONGTY' and F.VIENPHI_ID = A.VIENPHI_ID        left join TT_DVYEUCAU DVYC on DVYC.DVYEUCAU_ID = A.REF_ID and A.REF_TABLE = 'TT_DVYEUCAU'        left join TM_DICHVU DV on DVYC.DICHVU_ID = DV.DICHVU_ID and A.REF_TABLE = 'TT_DVYEUCAU'        left join TM_NHOMDICHVU ndv on ndv.NHOMDICHVU_ID = DV.NHOMDICHVU_ID and A.REF_TABLE = 'TT_DVYEUCAU'        where        A.TIEPNHAN_ID = '27478' and ((DVYC.HUYYEUCAU = '0' and A.DICHVU_ID is not null)        or A.DUOC_ID is not null or A.REF_TABLE = 'TT_NUT_XACNHANSUATAN_CHITIET')        and A.ACTIVE = '1'                 and A.BENHVIEN_ID = 'HLU01'        order by A.VIENPHI_ID]
2019-09-20 15:56:52,310 [1] DEBUG - Statement Id: [DAO00006_GetListDuocTyle] PreparedStatement : [select DUOC_ID, DOITUONG_ID, (TYLE/100) as TYLE, DONGIA MUCTRAN_THANHTOAN from TM_DOITUONG_GIADUOC_TYLE            where            BENHVIEN_ID = 'HLU01'            and DOITUONG_ID = '4']
2019-09-20 15:56:52,352 [1] DEBUG - Statement Id: [DAO00027_GetListTuongTrinhDichVuPhauThuatCuaTiepNhan] PreparedStatement : [declare @ManhomDSA varchar(10);        declare @PhanLoaiNhomDV varchar(20) = '05';        select top 1  @ManhomDSA = VALUE from TM_SYS_APPSETTINGS where CODE = 'MANHOM_DICHVU_DSA'        if (@ManhomDSA is not null) set @PhanLoaiNhomDV += ',' + @ManhomDSA        select distinct ptyc.*        from TT_PHAUTHUAT_YEUCAU ptyc        inner join TM_DICHVU dv on dv.DICHVU_ID = ptyc.DICHVU_ID        inner join TM_NHOMDICHVU ndv on ndv.NHOMDICHVU_ID = dv.NHOMDICHVU_ID        inner join TT_PHAUTHUAT pt on pt.PHAUTHUAT_ID = ptyc.PHAUTHUAT_ID        where        pt.TIEPNHAN_ID = 27478        and (left(ndv.MANHOMDICHVU, 2) in (select * from STRING_SPLIT(@PhanLoaiNhomDV,',')) or ndv.MANHOMDICHVU in (select * from STRING_SPLIT(@PhanLoaiNhomDV,',')))]
2019-09-20 15:56:52,398 [1] DEBUG - Statement Id: [DAO00006_GetList] PreparedStatement : [select dv.*, loaiDV.MALOAIDICHVU, captren.NHOMDICHVU_ID as NHOMDICHVU_CAPTREN_ID, captren.TENNHOMDICHVU as NHOMDICHVU_CAPTREN,              nhom_dv.TENNHOMDICHVU as TENNHOMDICHVU, nhom_dv.MANHOMDICHVU,              case when dv.ATTRIBUTE5 is null then 'TT' else 'KTC' end as LOAI_CHIPHI              from TM_DICHVU as dv              left join TM_NHOMDICHVU as nhom_dv on nhom_dv.NHOMDICHVU_ID = dv.NHOMDICHVU_ID and nhom_dv.BENHVIEN_ID = 'HLU01'              left join TM_NHOMDICHVU as captren on nhom_dv.CAPTREN_ID = captren.NHOMDICHVU_ID and captren.BENHVIEN_ID = 'HLU01'              left join TM_LOAIDICHVU loaiDV on nhom_dv.LOAIDICHVU_ID = loaiDV.LOAIDICHVU_ID and loaiDV.BENHVIEN_ID = 'HLU01'              where nhom_dv.TAMNGUNG = '0' and dv.BENHVIEN_ID = 'HLU01'              and dv.TAMNGUNG = '0'               AND                   loaiDV.MALOAIDICHVU = 'KhamBenh']
2019-09-20 15:56:52,500 [1] DEBUG - Statement Id: [DAO00023_UpdateNhieuVP] PreparedStatement : [declare @jsonVienPhi nvarchar(max) = N'[{"VIENPHI_ID":674724,"TIEPNHAN_ID":27478,"BENHAN_ID":0,"SOLUONG":1.0000,"DONGIA_DOANHTHU":33000.0000,"THANHTIEN_DOANHTHU":33000.00,"BHYT_TL":0.8000,"BHYT_DONGIA":33000.0000,"BHYT_THANHTIEN":33000.00,"BHYT_DONGIA_CONGKHAM_DAU":33000.0000,"BHYT_CONGKHAM_DAU_TYLE":1.0,"BHYT_DONGIA_CHITRA":26400.0,"BHYT_THANHTIEN_CHITRA":26400.00,"BENHNHAN_PHAITHANHTOAN":6600.00,"GIATRI_HOADON":6600.00,"GIATRI_HOADON_DATHANHTOAN":0.0,"GIATRI_BIENLAI":0.0,"GIATRI_BIENLAI_DATHANHTOAN":0.0,"GIATRI_BENHNHAN_DATHANHTOAN":0.0,"DATHUCHIEN":"1","KHONGTHUTIEN":"0","BHYTDONGTIEN":"0","DICHVU_TL":1.0,"BHYT_DONGIA_DONGCT_DAU":0.0,"SOBHYT":"DN453534653452338289","SOBHYT_HUONG_ID":28501,"GIATRIMIENGIAM":0.0,"GIATRIMIENGIAM_BHTN":0.0,"GIATRIMIENGIAM_THANHVIEN":0.0,"GIATRIMIENGIAM_CONGTY":0.0},{"VIENPHI_ID":674725,"TIEPNHAN_ID":27478,"BENHAN_ID":0,"SOLUONG":1.0000,"DONGIA_DOANHTHU":260000.0000,"THANHTIEN_DOANHTHU":260000.00,"BHYT_TL":0.8000,"BHYT_DONGIA":260000.0000,"BHYT_THANHTIEN":260000.00,"BHYT_DONGIA_CONGKHAM_DAU":33000.0000,"BHYT_CONGKHAM_DAU_TYLE":1.0,"BHYT_DONGIA_CHITRA":208000.0,"BHYT_THANHTIEN_CHITRA":208000.00,"BENHNHAN_PHAITHANHTOAN":52000.00,"GIATRI_HOADON":52000.00,"GIATRI_HOADON_DATHANHTOAN":0.0,"GIATRI_BIENLAI":0.0,"GIATRI_BIENLAI_DATHANHTOAN":0.0,"GIATRI_BENHNHAN_DATHANHTOAN":0.0,"DATHUCHIEN":"1","KHONGTHUTIEN":"0","BHYTDONGTIEN":"0","DICHVU_TL":1.0,"BHYT_DONGIA_DONGCT_DAU":0.0,"SOBHYT":"DN453534653452338289","SOBHYT_HUONG_ID":28501,"GIATRIMIENGIAM":0.0,"GIATRIMIENGIAM_BHTN":0.0,"GIATRIMIENGIAM_THANHVIEN":0.0,"GIATRIMIENGIAM_CONGTY":0.0},{"VIENPHI_ID":674726,"TIEPNHAN_ID":27478,"BENHAN_ID":0,"SOLUONG":1.0000,"DONGIA_DOANHTHU":37000.0000,"THANHTIEN_DOANHTHU":37000.00,"BHYT_TL":0.8000,"BHYT_DONGIA":37000.0000,"BHYT_THANHTIEN":37000.00,"BHYT_DONGIA_CONGKHAM_DAU":33000.0000,"BHYT_CONGKHAM_DAU_TYLE":1.0,"BHYT_DONGIA_CHITRA":29600.0,"BHYT_THANHTIEN_CHITRA":29600.00,"BENHNHAN_PHAITHANHTOAN":7400.00,"GIATRI_HOADON":7400.00,"GIATRI_HOADON_DATHANHTOAN":0.0,"GIATRI_BIENLAI":0.0,"GIATRI_BIENLAI_DATHANHTOAN":0.0,"GIATRI_BENHNHAN_DATHANHTOAN":0.0,"DATHUCHIEN":"1","KHONGTHUTIEN":"0","BHYTDONGTIEN":"0","DICHVU_TL":1.0,"BHYT_DONGIA_DONGCT_DAU":0.0,"SOBHYT":"DN453534653452338289","SOBHYT_HUONG_ID":28501,"GIATRIMIENGIAM":0.0,"GIATRIMIENGIAM_BHTN":0.0,"GIATRIMIENGIAM_THANHVIEN":0.0,"GIATRIMIENGIAM_CONGTY":0.0}]';        begin        UPDATE TT_VIENPHI        SET        SOLUONG = json.SOLUONG,        DONGIA_DOANHTHU = json.DONGIA_DOANHTHU,        THANHTIEN_DOANHTHU = json.THANHTIEN_DOANHTHU,        BHYT_TL = json.BHYT_TL,        BHYT_DONGIA = json.BHYT_DONGIA,        BHYT_THANHTIEN = json.BHYT_THANHTIEN,        BHYT_DONGIA_CONGKHAM_DAU = json.BHYT_DONGIA_CONGKHAM_DAU,        BHYT_CONGKHAM_DAU_TYLE = json.BHYT_CONGKHAM_DAU_TYLE,        BHYT_DONGIA_CHITRA = json.BHYT_DONGIA_CHITRA,        BHYT_THANHTIEN_CHITRA = json.BHYT_THANHTIEN_CHITRA,        BENHNHAN_PHAITHANHTOAN = json.BENHNHAN_PHAITHANHTOAN,        GIATRI_HOADON = json.GIATRI_HOADON,                GIATRI_BIENLAI = json.GIATRI_BIENLAI,                DATHUCHIEN = json.DATHUCHIEN,                DICHVU_TL = json.DICHVU_TL,        BHYT_DONGIA_DONGCT_DAU = json.BHYT_DONGIA_DONGCT_DAU,        NGAYCAPNHAT = GETDATE()        FROM OPENJSON (@jsonVienPhi)        WITH (        VIENPHI_ID int,        SOLUONG numeric(25, 4),        DONGIA_DOANHTHU numeric(25, 4),        THANHTIEN_DOANHTHU numeric(25, 4),        BHYT_TL numeric(25, 4),        BHYT_DONGIA numeric(25, 4),        BHYT_THANHTIEN numeric(25, 4),        BHYT_DONGIA_CONGKHAM_DAU numeric(25, 4),        BHYT_CONGKHAM_DAU_TYLE numeric(25, 4),        BHYT_DONGIA_CHITRA numeric(25, 4),        BHYT_THANHTIEN_CHITRA numeric(25, 4),        BENHNHAN_PHAITHANHTOAN numeric(25, 4),        GIATRI_HOADON numeric(25, 4),                GIATRI_BIENLAI numeric(25, 4),                DATHUCHIEN char(1),        KHONGTHUTIEN char(1),        BHYTDONGTIEN char(1),        DICHVU_TL numeric(25, 4),        BHYT_DONGIA_DONGCT_DAU numeric(25, 4))  json        WHERE TT_VIENPHI.VIENPHI_ID = json.VIENPHI_ID                        insert into TT_TINH_VIENPHI_LOG        SELECT json.VIENPHI_ID, json.TIEPNHAN_ID, json.BENHAN_ID, json.SOLUONG, json.BHYT_TL, json.DONGIA_DOANHTHU,        json.THANHTIEN_DOANHTHU, json.BHYT_DONGIA, json.BHYT_THANHTIEN, json.BHYT_DONGIA_CHITRA, json.BHYT_THANHTIEN_CHITRA, json.BENHNHAN_PHAITHANHTOAN,        json.SOBHYT_HUONG_ID, json.SOBHYT, GETDATE(), -1, 'HLU01'        FROM OPENJSON(@jsonVienPhi)        WITH (        VIENPHI_ID int,        TIEPNHAN_ID int,        BENHAN_ID int,        SOLUONG numeric(25, 4),        DONGIA_DOANHTHU numeric(25, 4),        THANHTIEN_DOANHTHU numeric(25, 4),        BHYT_TL numeric(25, 4),        BHYT_DONGIA numeric(25, 4),        BHYT_THANHTIEN numeric(25, 4),        BHYT_DONGIA_CHITRA numeric(25, 4),        BHYT_THANHTIEN_CHITRA numeric(25, 4),        BENHNHAN_PHAITHANHTOAN numeric(25, 4),        SOBHYT_HUONG_ID int,        SOBHYT nvarchar(30)) json        end]
2019-09-20 15:56:52,540 [1] DEBUG - Statement Id: [DAO00067_UpdateDataVienPhiDongiaBHYT] PreparedStatement : [update TT_VIENPHI          set BHYT_DONGIA_CHITRA = 0, BHYT_THANHTIEN = 0, BHYT_THANHTIEN_CHITRA = 0          where          TIEPNHAN_ID = 27478 and BHYT_DONGIA = 0          and (BHYT_DONGIA_CHITRA > 0 or BHYT_THANHTIEN > 0 or BHYT_THANHTIEN_CHITRA > 0)]
2019-09-20 15:56:52,572 [1] DEBUG - Statement Id: [DAO00067_CapnhatDataVienphiKhiHuyThanhtoanHoadon] PreparedStatement : [update TT_VIENPHI        set TT_VIENPHI.HOADON_ID = hdct.HOADON_ID, TT_VIENPHI.GIATRI_BENHNHAN_DATHANHTOAN = TT_VIENPHI.GIATRI_BENHNHAN_DATHANHTOAN + hdct.GIATRI_BENHNHAN_DATHANHTOAN        from (select CT.HOADON_ID, CT.VIENPHI_ID, CT.GIATRI_BENHNHAN_DATHANHTOAN        from TT_HOADON_CHITIET_NGOAITRU CT        join TT_HOADON HD on HD.HOADON_ID = CT.HOADON_ID        join TT_VIENPHI vp on vp.VIENPHI_ID = ct.VIENPHI_ID        where HD.DATHANHTOAN = 1 and HD.HUYHOADON = 0 and HD.HOANTRA = 0 and vp.TIEPNHAN_ID =  @param0 ) hdct        where        TT_VIENPHI.VIENPHI_ID = hdct.VIENPHI_ID and TT_VIENPHI.HOADON_ID is null and isnull(TT_VIENPHI.GIATRI_BENHNHAN_DATHANHTOAN,0) = 0        and TT_VIENPHI.TIEPNHAN_ID =  @param0           update TT_VIENPHI        set TT_VIENPHI.HOADON_ID = null, TT_VIENPHI.GIATRI_BENHNHAN_DATHANHTOAN = TT_VIENPHI.GIATRI_BENHNHAN_DATHANHTOAN - hdct.GIATRI_BENHNHAN_DATHANHTOAN,        TT_VIENPHI.DATHANHTOAN = '0'        from (select CT.HOADON_ID, CT.VIENPHI_ID, CT.GIATRI_BENHNHAN_DATHANHTOAN        from TT_HOADON_CHITIET_NGOAITRU CT        join TT_HOADON HD on HD.HOADON_ID = CT.HOADON_ID        join TT_VIENPHI vp on vp.VIENPHI_ID = ct.VIENPHI_ID and vp.HOADON_ID = ct.HOADON_ID        where HD.DATHANHTOAN = 0 and (HD.HUYHOADON = 1 or HD.HOANTRA = 1) and vp.TIEPNHAN_ID =  @param0 ) hdct        where        TT_VIENPHI.VIENPHI_ID = hdct.VIENPHI_ID and TT_VIENPHI.HOADON_ID = hdct.HOADON_ID        and TT_VIENPHI.TIEPNHAN_ID =  @param0]
2019-09-20 15:56:52,572 [1] DEBUG - Statement Id: [DAO00067_CapnhatDataVienphiKhiHuyThanhtoanHoadon] Parameters: [@param0=[TIEPNHAN_ID,27478]]
2019-09-20 15:56:52,572 [1] DEBUG - Statement Id: [DAO00067_CapnhatDataVienphiKhiHuyThanhtoanHoadon] Types: [@param0=[Int64, System.Int64]]
2019-09-20 15:56:52,660 [1] DEBUG - Statement Id: [DAO00064_GetVienphiTiepNhan_BIL09] PreparedStatement : [select distinct case when c.DVYEUCAU_ID is not null then c.TRANGTHAI        when tk.KHAMBENH_TOATHUOC_ID is not null then case when tk.CHUNGTUPHATTHUOC_ID is not null then 'DAXUAT' else 'CHUAXUAT' end        when vtyt.PHAUTHUAT_VTYT_ID is not null then case when vtyt.CHUNGTU_ID is not null then 'DAXUAT' else 'CHUAXUAT' end        when kqvtyt.CLSKETQUA_VTYT_ID is not null then case when kqvtyt.TRANGTHAI is not null then 'DAXUAT' else 'CHUAXUAT' end        else '' end as TRANGTHAI        , C.NOITHUCHIEN_ID as PHONGBAN_ID, D.NGAYKHAM,        ISNULL(A.DICHVU_ID, A.DUOC_ID) as NOIDUNG_ID, A.REF_ID as IDREF, A.VIENPHI_ID,        A.SOLUONG as SOLUONG, A.SOLUONG as SOLUONG_NEW, A.DICHVU_ID, A.DUOC_ID, A.BHYT_DONGIA_CHITRA,        A.DONGIA_DOANHTHU, A.DONGIA_DOANHTHU as DONGIADOANHTHU, A.BHYT_DONGIA as DONGIAHOTRO, A.BHYT_THANHTIEN_CHITRA as DONGIAHOTROCHITRA, A.BHYT_DONGIA_CHITRA as DONGIAHOTROCHITRA_NEW,        A.REF_TABLE as LOAI, A.BHYT_DONGIA, A.BHYT_THANHTIEN, A.BHYT_THANHTIEN_CHITRA, A.BENHNHAN_PHAITHANHTOAN, A.GIATRI_BENHNHAN_DATHANHTOAN, A.BENHVIEN_ID, A.THANHTIEN_DOANHTHU,        A.LOAI_CHIPHI, A.LOAIGIA_ID, REF_TABLE, A.KHAMBENH_ID, A.REF_ID, A.DUOCPHEPTHUCHIEN,        A.HUY, A.KHONGTHUTIEN, A.DATHANHTOAN, A.HOADON_ID, A.ACTIVE, C.DVYEUCAU_ID, C.NGAYYEUCAU, ISNULL(C.BACSICHIDINH_ID, C.NGUOIGIOITHIEU_ID) as BACSICHIDINH_ID, C.NOIYEUCAU_ID        , A.DATHUCHIEN,        isnull(dv.TENDICHVU, dc.TENDUOCDAYDU) NOIDUNG, isnull(dv.MADICHVU, dc.MADUOC) MADICHVU, dv.NORESULT, dc.DONVITINH, ld.MALOAIDUOC, dc.BHYT DUOC_BHYT, ld.LOAIVATTU_ID,        ndv.MANHOMDICHVU, D.KBPBHUONGGIAIQUYET NOIDUNG2, D.HUONGGIAIQUYET_ID        from TT_VIENPHI A        left join (select * from TT_DVYEUCAU where TIEPNHAN_ID = '27478') C on C.TIEPNHAN_ID = A.TIEPNHAN_ID and C.DICHVU_ID = A.DICHVU_ID  and C.DVYEUCAU_ID = A.REF_ID        left join (        select pb.TENPHONGBAN + ' - ' + nv.TENNHANVIEN + ' - '+ hgq.DICTIONARY_NAME KBPBHUONGGIAIQUYET, kb.* from TT_NGOAITRU_KHAMBENH kb        left join TM_PHONGBAN pb on pb.PHONGBAN_ID = kb.PHONGBAN_ID        left join TM_NHANVIEN nv on nv.NHANVIEN_ID = kb.BACSIKHAM_ID        left join (select * from LST_DICTIONARY where DICTIONARY_TYPE_CODE = 'GiaiQuyetKhamBenh') hgq on hgq.DICTIONARY_ID = kb.HUONGGIAIQUYET_ID        where kb.TIEPNHAN_ID = '27478'        ) D on D.TIEPNHAN_ID = A.TIEPNHAN_ID and D.DICHVU_ID = A.DICHVU_ID and C.KHAMBENH_NGOAITRU_ID = D.KHAMBENH_ID        left join (select * from TT_NGOAITRU_TOATHUOC where TIEPNHAN_ID = '27478') E on E.DUOC_ID = A.DUOC_ID and E.TOATHUOC_ID = A.REF_ID and A.REF_TABLE = 'TT_NGOAITRU_TOATHUOC'        left join TT_NGOAITRU_KHAMBENH_TOATHUOC tk on tk.KHAMBENH_TOATHUOC_ID = e.KHAMBENH_TOATHUOC_ID        left join TT_PHAUTHUAT_VTYT vtyt on vtyt.PHAUTHUAT_VTYT_ID = a.REF_ID and a.REF_TABLE = 'TT_PHAUTHUAT_VTYT'        left join TT_CLSKETQUA_VTYT kqvtyt on kqvtyt.CLSKETQUA_VTYT_ID = a.REF_ID and a.REF_TABLE = 'TT_CLSKETQUA_VTYT'        left join TM_DICHVU dv on A.DICHVU_ID = dv.DICHVU_ID and A.REF_TABLE = 'TT_DVYEUCAU'        left join TM_DUOC dc on A.DUOC_ID = dc.DUOC_ID        left join TM_LOAIDUOC ld on dc.LOAIDUOC_ID = ld.LOAIDUOC_ID        left join TM_NHOMDICHVU ndv on ndv.NHOMDICHVU_ID = dv.NHOMDICHVU_ID        where        A.TIEPNHAN_ID = '27478' and A.BENHVIEN_ID = 'HLU01' and (A.BENHAN_ID is NULL or A.BENHAN_ID = '')          and A.REF_TABLE != 'TT_DUOC_CHUNGTU_CHITIET' and A.KHONGTHUTIEN != '1'        and (exists (select KHAMBENH_ID from TT_NGOAITRU_KHAMBENH where A.KHAMBENH_ID = KHAMBENH_ID and TIEPNHAN_ID = '27478') or A.KHAMBENH_ID is null)        and (C.HUYYEUCAU = '0' or C.HUYYEUCAU is null)          AND             (A.BHYT_DONGIA > 0                           )                       and        (        (A.DICHVU_ID is not null and C.HUYYEUCAU != '1') or (A.DICHVU_ID is null and A.DUOC_ID is not null and A.REF_TABLE != 'TT_DUOC_CHUNGTU_CHITIET')        )        ORDER BY A.VIENPHI_ID]
2019-09-20 15:56:52,699 [1] DEBUG - Statement Id: [DAOLOG01_LockBegin] PreparedStatement : [INSERT into TT_LOG_UPDATE ( REF_TABLE , REF_ID , BENHVIEN_ID )         values ( @param0 ,  @param1 ,  @param2 );]
2019-09-20 15:56:52,699 [1] DEBUG - Statement Id: [DAOLOG01_LockBegin] Parameters: [@param0=[REF_TABLE,TT_XACNHAN_CHIPHI], @param1=[REF_ID,27478], @param2=[BENHVIEN_ID,HLU01]]
2019-09-20 15:56:52,699 [1] DEBUG - Statement Id: [DAOLOG01_LockBegin] Types: [@param0=[String, System.String], @param1=[Int64, System.Int64], @param2=[String, System.String]]
2019-09-20 15:56:52,793 [1] DEBUG - Statement Id: [DAO00064_Delete] PreparedStatement : [delete from TT_XACNHANCHIPHICHITIET        where XACNHANCHIPHI_ID in        (select XACNHANCHIPHI_ID from TT_XACNHANCHIPHI where TIEPNHAN_ID = '27478');        delete from TT_XACNHANCHIPHI where TIEPNHAN_ID = '27478';]
2019-09-20 15:56:53,006 [1] DEBUG - Statement Id: [DAO00064_Add] PreparedStatement : [insert into TT_XACNHANCHIPHI (        SOXACNHAN        , TIEPNHAN_ID        , BENHAN_ID        , KHAMBENH_ID        , BENHNHAN_ID        , DOITUONG_ID        , SOBHYT        , NGAYVAO        , NGAYRA        , NGAYKHAM        , CHANDOAN        , LOAI        , NGAYXACNHAN        , BENHVIEN_ID        , IDCHUYEN        , IDCHUYENHUY        , IDCHUYENHOAN        , TUYENKHAMBENH        , THOIGIANXACNHAN        , NGAYXUATTHUOC        , NOIXACNHAN_ID        , MABENH        , BENHKHAC        , TENPHONGKHAM        , NGAYTAO        , NGUOITAO_ID        , NGAYCAPNHAT        , NGUOICAPNHAT_ID        ) values (         @param0         ,  @param1         ,  @param2         ,  @param3         ,  @param4         ,  @param5         ,  @param6         ,  @param7         ,  @param8         ,  @param9         ,  @param10         ,  @param11         ,  @param12         ,  @param13         ,  @param14         ,  @param15         ,  @param16         ,  @param17         ,  @param18         ,  @param19         ,  @param20         ,  @param21         ,  @param22         ,  @param23         ,  @param24         ,  @param25         ,  @param26         ,  @param27         )        SELECT SCOPE_IDENTITY()]
2019-09-20 15:56:53,006 [1] DEBUG - Statement Id: [DAO00064_Add] Parameters: [@param0=[SOXACNHAN,null], @param1=[TIEPNHAN_ID,27478], @param2=[BENHAN_ID,null], @param3=[KHAMBENH_ID,null], @param4=[BENHNHAN_ID,23423], @param5=[DOITUONG_ID,4], @param6=[SOBHYT,DN453534653452338289], @param7=[NGAYVAO,9/20/2019 3:45:13 PM], @param8=[NGAYRA,null], @param9=[NGAYKHAM,null], @param10=[CHANDOAN,null], @param11=[LOAI,NGOAITRU], @param12=[NGAYXACNHAN,9/20/2019 12:00:00 AM], @param13=[BENHVIEN_ID,HLU01], @param14=[IDCHUYEN,null], @param15=[IDCHUYENHUY,null], @param16=[IDCHUYENHOAN,null], @param17=[TUYENKHAMBENH,null], @param18=[THOIGIANXACNHAN,9/20/2019 5:56:46 PM], @param19=[NGAYXUATTHUOC,null], @param20=[NOIXACNHAN_ID,58], @param21=[MABENH,null], @param22=[BENHKHAC,null], @param23=[TENPHONGKHAM,null], @param24=[NGAYTAO,9/20/2019 3:56:53 PM], @param25=[NGUOITAO_ID,1], @param26=[NGAYCAPNHAT,9/20/2019 3:56:53 PM], @param27=[NGUOICAPNHAT_ID,1]]
2019-09-20 15:56:53,006 [1] DEBUG - Statement Id: [DAO00064_Add] Types: [@param0=[System.DBNull, null], @param1=[String, System.String], @param2=[System.DBNull, null], @param3=[System.DBNull, null], @param4=[Int64, System.Int64], @param5=[Int64, System.Int64], @param6=[String, System.String], @param7=[DateTime, System.DateTime], @param8=[System.DBNull, null], @param9=[System.DBNull, null], @param10=[System.DBNull, null], @param11=[String, System.String], @param12=[DateTime, System.DateTime], @param13=[String, System.String], @param14=[System.DBNull, null], @param15=[System.DBNull, null], @param16=[System.DBNull, null], @param17=[System.DBNull, null], @param18=[DateTime, System.DateTime], @param19=[System.DBNull, null], @param20=[Int64, System.Int64], @param21=[System.DBNull, null], @param22=[System.DBNull, null], @param23=[System.DBNull, null], @param24=[DateTime, System.DateTime], @param25=[Int64, System.Int64], @param26=[DateTime, System.DateTime], @param27=[Int64, System.Int64]]
2019-09-20 15:56:53,369 [1] DEBUG - Statement Id: [DAO00064_TT_NGOAITRU_KHAMBENH_TOATHUOC_GetListToaThuocBHYT] PreparedStatement : [select * from TT_NGOAITRU_KHAMBENH_TOATHUOC        where (exists (select KHAMBENH_NGOAITRU_ID from TT_DVYEUCAU where TT_NGOAITRU_KHAMBENH_TOATHUOC.KHAMBENH_ID = KHAMBENH_NGOAITRU_ID and TIEPNHAN_ID = '27478')) and TIEPNHAN_ID = '27478' and LOAITOATHUOC = 'BV']
2019-09-20 15:56:53,399 [1] DEBUG - Statement Id: [DAO00064_KiemtraBHYTNgoaitruDaThanhtoan] PreparedStatement : [select COUNT(*)        from TT_VIENPHI A        left join (select * from TT_DVYEUCAU where TIEPNHAN_ID = '27478') C on C.TIEPNHAN_ID = A.TIEPNHAN_ID and C.DICHVU_ID = A.DICHVU_ID  and C.DVYEUCAU_ID = A.REF_ID        left join (select * from TT_NGOAITRU_KHAMBENH where TIEPNHAN_ID = '27478') D on D.TIEPNHAN_ID = A.TIEPNHAN_ID and D.DICHVU_ID = A.DICHVU_ID and C.KHAMBENH_NGOAITRU_ID = D.KHAMBENH_ID        left join (select * from TT_NGOAITRU_TOATHUOC where TIEPNHAN_ID = '27478') E on E.DUOC_ID = A.DUOC_ID and E.TOATHUOC_ID = A.REF_ID and A.REF_TABLE = 'TT_NGOAITRU_TOATHUOC'        left join TT_NGOAITRU_KHAMBENH_TOATHUOC tk on tk.KHAMBENH_TOATHUOC_ID = e.KHAMBENH_TOATHUOC_ID        left join TT_PHAUTHUAT_VTYT vtyt on vtyt.PHAUTHUAT_VTYT_ID = a.REF_ID and a.REF_TABLE = 'TT_PHAUTHUAT_VTYT'        where        A.TIEPNHAN_ID = '27478' and (A.BENHAN_ID is NULL or A.BENHAN_ID = '')        and A.REF_TABLE != 'TT_DUOC_CHUNGTU_CHITIET' and A.KHONGTHUTIEN != '1'        and (exists (select KHAMBENH_ID from TT_NGOAITRU_KHAMBENH where A.KHAMBENH_ID = KHAMBENH_ID and TIEPNHAN_ID = '27478') or A.KHAMBENH_ID is null)        and (C.HUYYEUCAU = '0' or C.HUYYEUCAU is null)         and        (        (A.DICHVU_ID is not null and C.HUYYEUCAU != '1') or (A.DICHVU_ID is null and A.DUOC_ID is not null and A.REF_TABLE != 'TT_DUOC_CHUNGTU_CHITIET')        )        and A.BENHNHAN_PHAITHANHTOAN > A.GIATRI_BENHNHAN_DATHANHTOAN]
2019-09-20 15:56:57,004 [1] DEBUG - Statement Id: [DAO00009_TT_TIEPNHAN_GetProcess] PreparedStatement : [select PROCESS_ID from TT_TIEPNHAN where SOTIEPNHAN = 'TN190920.0000001']
2019-09-20 15:56:57,183 [1] DEBUG - Statement Id: [DAOWF001_Kiemtrathongtindayeucaudacochua] PreparedStatement : [select * from TT_REQUEST        where        PARA = '{"HOSPITAL_ID":"HLU01","SOTIEPNHAN":"TN190920.0000001"}'        AND ISACTIVE = '1']
2019-09-20 15:56:57,234 [1] DEBUG - Statement Id: [DAOWF001_Kiemtrathongtindichvudayeucau] PreparedStatement : [select top 1 * from TT_REQUEST_SERVICE        where        PARA = '{"DICHVU_ID":"5685","DVYEUCAU_ID":"205440"}'                AND ISACTIVE = '1' order by ID desc]
2019-09-20 15:56:57,274 [1] DEBUG - Statement Id: [DAOWF001_KiemtrathongtinchitietDichvuYeucau] PreparedStatement : [select * from TT_REQUEST_SERVICE_DETAIL        where        REQUEST_SERVICE_ID = '147387']
2019-09-20 15:56:57,336 [1] DEBUG - Statement Id: [DAOWF001_Laythongtinwithstatecode] PreparedStatement : [select A.*, B.STATUS_CODE from        TM_STATE_ACTION A        left join TM_STATE B on B.STATE_CODE = A.NEXT_STATE_CODE and A.PROCESS_CODE = B.PROCESS_CODE        where        A.CURR_STATE_CODE = '8     '        AND A.PROCESS_CODE = 'P02'        Order By ORDER_ID ASC]
2019-09-20 15:56:57,389 [1] DEBUG - Statement Id: [DAOWF003_Update] PreparedStatement : [update TT_REQUEST_SERVICE set        CURR_STATE_CODE =  @param0                   , ISACTIVE =  @param1                     , ISCOMPLETE =  @param2                        where        ID = '147387']
2019-09-20 15:56:57,389 [1] DEBUG - Statement Id: [DAOWF003_Update] Parameters: [@param0=[CURR_STATE_CODE,5], @param1=[ISACTIVE,1], @param2=[ISCOMPLETE,0]]
2019-09-20 15:56:57,389 [1] DEBUG - Statement Id: [DAOWF003_Update] Types: [@param0=[String, System.String], @param1=[String, System.String], @param2=[String, System.String]]
2019-09-20 15:56:57,436 [1] DEBUG - Statement Id: [DAOWF005_Add] PreparedStatement : [insert into TT_REQUEST_SERVICE_DETAIL (        REQUEST_ID        ,REQUEST_SERVICE_ID        , OLD_STATE_CODE        , CURR_STATE_CODE        ) values (         @param0         , @param1         ,  @param2         ,  @param3         )        SELECT SCOPE_IDENTITY()]
2019-09-20 15:56:57,436 [1] DEBUG - Statement Id: [DAOWF005_Add] Parameters: [@param0=[REQUEST_ID,31779], @param1=[REQUEST_SERVICE_ID,147387], @param2=[OLD_STATE_CODE,8     ], @param3=[CURR_STATE_CODE,5]]
2019-09-20 15:56:57,436 [1] DEBUG - Statement Id: [DAOWF005_Add] Types: [@param0=[String, System.String], @param1=[Int32, System.Int32], @param2=[String, System.String], @param3=[String, System.String]]
2019-09-20 15:56:57,471 [1] DEBUG - Statement Id: [DAOWF005_Add_History] PreparedStatement : [insert into TT_REQUEST_SERVICE_HISTORY (        REQUEST_ID        ,REQUEST_SERVICE_ID        , OLD_STATE_CODE        , CURR_STATE_CODE        ) values (         @param0         , @param1         ,  @param2         ,  @param3         )]
2019-09-20 15:56:57,471 [1] DEBUG - Statement Id: [DAOWF005_Add_History] Parameters: [@param0=[REQUEST_ID,31779], @param1=[REQUEST_SERVICE_ID,147387], @param2=[OLD_STATE_CODE,8     ], @param3=[CURR_STATE_CODE,5]]
2019-09-20 15:56:57,471 [1] DEBUG - Statement Id: [DAOWF005_Add_History] Types: [@param0=[String, System.String], @param1=[Int32, System.Int32], @param2=[String, System.String], @param3=[String, System.String]]
2019-09-20 15:56:57,506 [1] DEBUG - Statement Id: [DAO00009_TT_DVYEUCAU_Update] PreparedStatement : [Update TT_DVYEUCAU set TRANGTHAI_WFL = 'HOANTHANH' where DVYEUCAU_ID = '205440']
2019-09-20 15:56:57,536 [1] DEBUG - Statement Id: [DAO00064_InsertXacnhanChitietBHYTNgoaitru] PreparedStatement : [insert into TT_XACNHANCHIPHICHITIET        select distinct        '17757' as XACNHANCHIPHI_ID, A.VIENPHI_ID, A.REF_ID as IDREF, ISNULL(A.DICHVU_ID, A.DUOC_ID) as NOIDUNG_ID, isnull(dv.TENDICHVU, dc.TENDUOCDAYDU) NOIDUNG,        A.SOLUONG as SOLUONG,        A.DONGIA_DOANHTHU as DONGIADOANHTHU, A.BHYT_DONGIA as DONGIAHOTRO, A.BHYT_THANHTIEN_CHITRA as DONGIAHOTROCHITRA, A.BHYT_DONGIA_CHITRA as DONGIATHANHTOAN,        'NGOAITRU' as LOAI, null as NGOAITRU_TOATHUOC_ID, null as NOITRU_TOATHUOC_ID, C.NOITHUCHIEN_ID as PHONGBAN_ID,        'HLU01' as BENHVIEN_ID, getdate() as NGAYCAPNHAT, null as NGUOICAPNHAT_ID        , 0 THANHTIEN, 0 MUCHUONG, 0 BN_TT, 0 THANHTIEN_BHYT, 0 BN_CTT        from TT_VIENPHI A        left join (select * from TT_DVYEUCAU where TIEPNHAN_ID = '27478') C on C.TIEPNHAN_ID = A.TIEPNHAN_ID and C.DICHVU_ID = A.DICHVU_ID  and C.DVYEUCAU_ID = A.REF_ID        left join (select * from TT_NGOAITRU_KHAMBENH where TIEPNHAN_ID = '27478') D on D.TIEPNHAN_ID = A.TIEPNHAN_ID and D.DICHVU_ID = A.DICHVU_ID and C.KHAMBENH_NGOAITRU_ID = D.KHAMBENH_ID        left join (select * from TT_NGOAITRU_TOATHUOC where TIEPNHAN_ID = '27478') E on E.DUOC_ID = A.DUOC_ID and E.TOATHUOC_ID = A.REF_ID and A.REF_TABLE = 'TT_NGOAITRU_TOATHUOC'        left join TT_NGOAITRU_KHAMBENH_TOATHUOC tk on tk.KHAMBENH_TOATHUOC_ID = e.KHAMBENH_TOATHUOC_ID        left join TT_PHAUTHUAT_VTYT vtyt on vtyt.PHAUTHUAT_VTYT_ID = a.REF_ID and a.REF_TABLE = 'TT_PHAUTHUAT_VTYT'        left join TM_DICHVU dv on dv.DICHVU_ID = A.DICHVU_ID        left join TM_DUOC dc on dc.DUOC_ID = A.DUOC_ID        where        A.TIEPNHAN_ID = '27478' and (A.BENHAN_ID is NULL or A.BENHAN_ID = '')        and A.REF_TABLE != 'TT_DUOC_CHUNGTU_CHITIET' and isnull(A.KHONGTHUTIEN, '0') != '1'        and (exists (select KHAMBENH_ID from TT_NGOAITRU_KHAMBENH where A.KHAMBENH_ID = KHAMBENH_ID and TIEPNHAN_ID = '27478') or A.KHAMBENH_ID is null)        and (C.HUYYEUCAU = '0' or C.HUYYEUCAU is null) and A.SOLUONG > 0 and A.REF_ID != 0 and        ((A.BHYT_DONGIA > 0 and A.BHYT_DONGIA_CHITRA > 0)                 )        and        (        (A.DICHVU_ID is not null and C.HUYYEUCAU != '1') or (A.DICHVU_ID is null and A.DUOC_ID is not null and A.REF_TABLE != 'TT_DUOC_CHUNGTU_CHITIET')        )        ORDER BY A.VIENPHI_ID]
2019-09-20 15:56:58,940 [1] DEBUG - Statement Id: [DAO00064_TT_XACNHAN_BHYT_Add] PreparedStatement : [INSERT INTO [TT_XACNHAN_BHYT]        ([BENHNHAN_ID]        ,[TIEPNHAN_ID]        ,[BENHAN_ID]        ,[SOBHYT]        ,[TRANGTHAI_XACNHAN]        ,[NOITHUCHIEN_ID]        ,[NGUOITHUCHIEN_ID]        ,[NGAYTHUCHIEN])        VALUES        ( @param0         , @param1         , @param2         , @param3         , @param4         , @param5         , @param6         , @param7 )]
2019-09-20 15:56:58,940 [1] DEBUG - Statement Id: [DAO00064_TT_XACNHAN_BHYT_Add] Parameters: [@param0=[BENHNHAN_ID,23423], @param1=[TIEPNHAN_ID,27478], @param2=[BENHAN_ID,null], @param3=[SOBHYT,DN453534653452338289], @param4=[TRANGTHAI_XACNHAN,XACNHAN], @param5=[NOITHUCHIEN_ID,58], @param6=[NGUOITHUCHIEN_ID,1], @param7=[NGAYTHUCHIEN,9/20/2019 3:56:58 PM]]
2019-09-20 15:56:58,940 [1] DEBUG - Statement Id: [DAO00064_TT_XACNHAN_BHYT_Add] Types: [@param0=[Int64, System.Int64], @param1=[String, System.String], @param2=[System.DBNull, null], @param3=[String, System.String], @param4=[String, System.String], @param5=[String, System.String], @param6=[Int64, System.Int64], @param7=[DateTime, System.DateTime]]
2019-09-20 15:56:59,167 [1] DEBUG - Statement Id: [DAOLOG01_LockEnd] PreparedStatement : [DELETE TT_LOG_UPDATE        where REF_TABLE = 'TT_XACNHAN_CHIPHI' and REF_ID = '27478' and BENHVIEN_ID = 'HLU01']
2019-09-20 15:56:59,274 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'RPT02'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2019-09-20 15:57:00,086 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'RPT01'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2019-09-20 15:57:01,029 [1] DEBUG - Statement Id: [DAO00200_GetDetail] PreparedStatement : [select *              from TM_REPORT              where TM_REPORT.REPORT_CODE  = 'BIL09P00101' AND TM_REPORT.BENHVIEN_ID = 'HLU01']
2019-09-20 15:57:01,373 [1] DEBUG - Statement Id: [DAO00201_GetList] PreparedStatement : [select *              from TM_REPORT_DETAIL               where                             TM_REPORT_DETAIL.REPORT_CODE = 'BIL09P00101'                       and                           TM_REPORT_DETAIL.BENHVIEN_ID = 'HLU01'                                     order by PARAMETER_INDEX]
2019-09-20 15:57:02,256 [1] DEBUG - Statement Id: [DAO00203_GetList] PreparedStatement : [select *              from TM_REPORT_SUB_DEFINITION               where                             TM_REPORT_SUB_DEFINITION.REPORT_CODE = 'BIL09P00101'                       and                           TM_REPORT_SUB_DEFINITION.BENHVIEN_ID = 'HLU01'                                     order by REPORT_SUB_DEFINITION_ID]
2019-09-20 15:57:02,344 [1] DEBUG - Statement Id: [DAO00201_GetListByParentReportID] PreparedStatement : [select RD.*              from TM_REPORT AS R              INNER JOIN TM_REPORT_SUB_DEFINITION AS RS ON R.REPORT_CODE = RS.REPORT_CODE AND R.BENHVIEN_ID = RS.BENHVIEN_ID              INNER JOIN TM_REPORT_DETAIL AS RD ON RD.REPORT_CODE = RS.SUB_REPORT_CODE AND RD.BENHVIEN_ID = RS.BENHVIEN_ID              where R.REPORT_CODE  = 'BIL09P00101' AND R.BENHVIEN_ID = 'HLU01']
2019-09-20 15:57:02,516 [1] DEBUG - Statement Id: [DAO00203_GetListReportSubFileByReportID] PreparedStatement : [select R.*              from TM_REPORT_SUB_DEFINITION AS RS              inner join TM_REPORT AS R ON RS.SUB_REPORT_CODE = R.REPORT_CODE AND R.BENHVIEN_ID = RS.BENHVIEN_ID              where RS.REPORT_CODE = 'BIL09P00101' AND RS.BENHVIEN_ID = 'HLU01']
2019-09-20 15:57:02,580 [1] DEBUG - Statement Id: [DAO00204_GetListParameter] PreparedStatement : [SELECT SUBSTRING(p.name, 2, LEN(p.name) - 1) AS PARAMETER, p.parameter_id AS Idx, CONVERT(varchar(1),p.is_nullable) as Allow_Null              FROM sys.procedures sp              INNER JOIN sys.parameters p ON sp.object_id = p.object_id              WHERE sp.name = 'BIL09P00101_MBV01'              ORDER BY p.parameter_id]
2019-09-20 15:57:02,647 [1] DEBUG - Statement Id: [DAO00204_GetReportData] PreparedStatement : [BIL09P00101_MBV01]
2019-09-20 15:57:02,648 [1] DEBUG - Statement Id: [DAO00204_GetReportData] Parameters: [@SOTIEPNHAN=[PARAMETERS.SOTIEPNHAN,27478], @MABENHVIEN=[PARAMETERS.MABENHVIEN,HLU01]]
2019-09-20 15:57:02,648 [1] DEBUG - Statement Id: [DAO00204_GetReportData] Types: [@SOTIEPNHAN=[String, System.String], @MABENHVIEN=[String, System.String]]
2019-09-20 15:57:03,491 [1] DEBUG - Statement Id: [DAO00204_GetListParameter] PreparedStatement : [SELECT SUBSTRING(p.name, 2, LEN(p.name) - 1) AS PARAMETER, p.parameter_id AS Idx, CONVERT(varchar(1),p.is_nullable) as Allow_Null              FROM sys.procedures sp              INNER JOIN sys.parameters p ON sp.object_id = p.object_id              WHERE sp.name = 'BIL09P00102_MBV01_VienPhi'              ORDER BY p.parameter_id]
2019-09-20 15:57:03,568 [1] DEBUG - Statement Id: [DAO00204_GetReportData] PreparedStatement : [BIL09P00102_MBV01_VienPhi]
2019-09-20 15:57:03,568 [1] DEBUG - Statement Id: [DAO00204_GetReportData] Parameters: [@SOTIEPNHAN=[PARAMETERS.SOTIEPNHAN,27478], @MABENHVIEN=[PARAMETERS.MABENHVIEN,HLU01]]
2019-09-20 15:57:03,568 [1] DEBUG - Statement Id: [DAO00204_GetReportData] Types: [@SOTIEPNHAN=[String, System.String], @MABENHVIEN=[String, System.String]]
2019-09-20 15:57:04,191 [1] DEBUG - Statement Id: [DAO00200_GetSettingReportPrinting] PreparedStatement : [SELECT DICTIONARY_CODE AS REPORT_CODE, DICTIONARY_NAME AS COMPUTER_NAME, DICTIONARY_NAME_EN AS NAME_PRINTER          FROM LST_DICTIONARY          WHERE BENHVIEN_ID = 'HLU01' AND ENABLED = '1' AND DICTIONARY_TYPE_CODE = 'Report_Printer_Setting'          AND DICTIONARY_CODE = 'BIL09P00101' AND DICTIONARY_NAME = 'GMC-HAIPN6']
2019-09-20 15:57:23,160 [1] DEBUG - Statement Id: [DAO00014_GetPatientStatusXacNhanChiPhi] PreparedStatement : [select        tn.TRANGTHAI as TRANGTHAI        from TT_TIEPNHAN tn        where tn.TIEPNHAN_ID = '27478'        and tn.BENHVIEN_ID = 'HLU01']
2019-09-20 15:57:23,267 [1] DEBUG - Statement Id: [DAO00064_TT_NGOAITRU_KHAMBENH_TOATHUOC_GetListToaThuocBHYT] PreparedStatement : [select * from TT_NGOAITRU_KHAMBENH_TOATHUOC        where (exists (select KHAMBENH_NGOAITRU_ID from TT_DVYEUCAU where TT_NGOAITRU_KHAMBENH_TOATHUOC.KHAMBENH_ID = KHAMBENH_NGOAITRU_ID and TIEPNHAN_ID = '27478')) and TIEPNHAN_ID = '27478' and LOAITOATHUOC = 'BV']
2019-09-20 15:57:23,298 [1] DEBUG - Statement Id: [DAO00064_GetVienphiTiepNhan_BIL09_DaBHYT] PreparedStatement : [select distinct case when YC.DVYEUCAU_ID is not null then YC.TRANGTHAI        when KBTT.KHAMBENH_TOATHUOC_ID is not null then KBTT.TRANGTHAI        when PT.PHAUTHUAT_VTYT_ID is not null then case when PT.CHUNGTU_ID is not null then 'DAXUAT' else 'CHUAXUAT' end        when VTYT.KHAMBENH_VTYT_ID is not null then case when VTYT.CHUNGTU_ID is not null then 'DAXUAT' else 'CHUAXUAT' end        when kqvtyt.CLSKETQUA_VTYT_ID is not null then case when kqvtyt.TRANGTHAI is not null then 'DAXUAT' else 'CHUAXUAT' end        else '' end as TRANGTHAI        , YC.NOITHUCHIEN_ID as PHONGBAN_ID, KB.NGAYKHAM,        XNCT.NOIDUNG_ID, VP.REF_ID as IDREF, XNCT.VIENPHI_ID,        VP.SOLUONG as SOLUONG, VP.SOLUONG as SOLUONG_NEW, VP.DICHVU_ID, VP.DUOC_ID, VP.BHYT_DONGIA_CHITRA,        VP.DONGIA_DOANHTHU, VP.DONGIA_DOANHTHU as DONGIADOANHTHU, VP.BHYT_DONGIA as DONGIAHOTRO, VP.BHYT_THANHTIEN_CHITRA as DONGIAHOTROCHITRA, VP.BHYT_DONGIA_CHITRA as DONGIAHOTROCHITRA_NEW,        VP.REF_TABLE as LOAI, VP.BHYT_DONGIA, VP.BHYT_THANHTIEN, VP.BHYT_THANHTIEN_CHITRA, VP.BENHNHAN_PHAITHANHTOAN, VP.GIATRI_BENHNHAN_DATHANHTOAN, VP.BENHVIEN_ID, VP.THANHTIEN_DOANHTHU,        VP.LOAI_CHIPHI, VP.LOAIGIA_ID, REF_TABLE, VP.KHAMBENH_ID, VP.REF_ID, VP.DUOCPHEPTHUCHIEN,        VP.HUY, VP.KHONGTHUTIEN, VP.DATHANHTOAN, VP.HOADON_ID, VP.ACTIVE, YC.DVYEUCAU_ID, YC.NGAYYEUCAU, ISNULL(YC.BACSICHIDINH_ID, YC.NGUOIGIOITHIEU_ID) as BACSICHIDINH_ID, YC.NOIYEUCAU_ID        , VP.DATHUCHIEN,        isnull(dv.TENDICHVU, dc.TENDUOCDAYDU) NOIDUNG, isnull(dv.MADICHVU, dc.MADUOC) MADICHVU, dv.NORESULT, dc.DONVITINH, ld.MALOAIDUOC, dc.BHYT DUOC_BHYT, ld.LOAIVATTU_ID,        ndv.MANHOMDICHVU, KB.KBHUONGGIAIQUYET NOIDUNG2        from TT_XACNHANCHIPHI XN        inner join TT_XACNHANCHIPHICHITIET XNCT on XNCT.XACNHANCHIPHI_ID = XN.XACNHANCHIPHI_ID and XNCT.BENHVIEN_ID = XN.BENHVIEN_ID        inner join TT_VIENPHI VP on VP.VIENPHI_ID = XNCT.VIENPHI_ID and VP.BENHVIEN_ID = XNCT.BENHVIEN_ID        left join TT_DVYEUCAU YC on YC.BENHVIEN_ID = VP.BENHVIEN_ID and YC.DVYEUCAU_ID = VP.REF_ID and VP.REF_TABLE = 'TT_DVYEUCAU'        left join TT_NGOAITRU_TOATHUOC TT on TT.BENHVIEN_ID = VP.BENHVIEN_ID and TT.TOATHUOC_ID = VP.REF_ID and VP.REF_TABLE = 'TT_NGOAITRU_TOATHUOC'        left join TT_NGOAITRU_KHAMBENH_TOATHUOC KBTT on KBTT.BENHVIEN_ID = TT.BENHVIEN_ID and KBTT.KHAMBENH_TOATHUOC_ID = TT.KHAMBENH_TOATHUOC_ID        left join TT_NGOAITRU_KHAMBENH_VTYT VTYT on VTYT.BENHVIEN_ID = VP.BENHVIEN_ID and VTYT.KHAMBENH_VTYT_ID = VP.REF_ID and VP.REF_TABLE = 'TT_NGOAITRU_KHAMBENH_VTYT'        left join TT_PHAUTHUAT_VTYT PT on PT.BENHVIEN_ID = VP.BENHVIEN_ID and PT.PHAUTHUAT_VTYT_ID = VP.REF_ID and VP.REF_TABLE = 'TT_PHAUTHUAT_VTYT'        left join (        select pb.TENPHONGBAN + ' - ' + nv.TENNHANVIEN + ' - '+ hgq.DICTIONARY_NAME KBHUONGGIAIQUYET, kb.* from TT_NGOAITRU_KHAMBENH kb        left join TM_PHONGBAN pb on pb.PHONGBAN_ID = kb.PHONGBAN_ID        left join TM_NHANVIEN nv on nv.NHANVIEN_ID = kb.BACSIKHAM_ID        left join (select * from LST_DICTIONARY where DICTIONARY_TYPE_CODE = 'GiaiQuyetKhamBenh') hgq on hgq.DICTIONARY_ID = kb.HUONGGIAIQUYET_ID        ) KB on KB.TIEPNHAN_ID = XN.TIEPNHAN_ID and KB.DICHVU_ID = VP.DICHVU_ID and YC.KHAMBENH_NGOAITRU_ID = KB.KHAMBENH_ID        left join TT_CLSKETQUA_VTYT kqvtyt on kqvtyt.CLSKETQUA_VTYT_ID = VP.REF_ID and VP.REF_TABLE = 'TT_CLSKETQUA_VTYT'        left join TM_DICHVU dv on VP.DICHVU_ID = dv.DICHVU_ID and VP.REF_TABLE = 'TT_DVYEUCAU'        left join TM_DUOC dc on VP.DUOC_ID = dc.DUOC_ID        left join TM_LOAIDUOC ld on dc.LOAIDUOC_ID = ld.LOAIDUOC_ID        left join TM_NHOMDICHVU ndv on ndv.NHOMDICHVU_ID = dv.NHOMDICHVU_ID        where XN.TIEPNHAN_ID = '27478' and XN.BENHVIEN_ID = 'HLU01'        ORDER BY XNCT.VIENPHI_ID]
2019-09-20 15:57:23,612 [1] DEBUG - Statement Id: [DAO00066_GetNhapVienById] PreparedStatement : [select *        from TT_NOITRU_NHAPVIEN        where TT_NOITRU_NHAPVIEN.TIEPNHAN_ID  = '27478' and TT_NOITRU_NHAPVIEN.TRANGTHAI = 'CHOXACNHAN' and TT_NOITRU_NHAPVIEN.LOAIBENHAN != 2        order by NHAPVIEN_ID desc]
2019-09-20 15:57:23,734 [1] DEBUG - Statement Id: [DAO00064_CheckBenhNhanChuaXSDVTYT] PreparedStatement : [IF EXISTS (        select vt.KHAMBENH_VTYT_ID        from TT_NGOAITRU_KHAMBENH_VTYT vt        inner join TT_NGOAITRU_KHAMBENH kb on kb.KHAMBENH_ID = vt.KHAMBENH_ID        where kb.TIEPNHAN_ID = 27478        and kb.BENHVIEN_ID = 'HLU01'        and vt.CHUNGTU_ID is null          union all          select vt.CLSKETQUA_VTYT_ID        from TT_CLSKETQUA_VTYT vt        inner join TT_DVYEUCAU yc on yc.DVYEUCAU_ID = vt.DVYEUCAU_ID and yc.BENHVIEN_ID = vt.BENHVIEN_ID        where yc.TIEPNHAN_ID = 27478        and yc.BENHVIEN_ID = 'HLU01'        and vt.CHUNGTU_ID is null        )        BEGIN        SELECT -1 AS RESULT        END        ELSE        BEGIN        SELECT 1 AS RESULT        END]
--------------------------------------------------------------------------------
2019-09-20 16:45:52,433 [1] DEBUG - Statement Id: [DAO00001_DBList] PreparedStatement : [select *              from TM_SYS_SERVER              where HOSPITAL_ID = '_SYSTEM_' and TYPE = 'D']
2019-09-20 16:45:52,782 [1] DEBUG - Statement Id: [DAO00001_DaoList] PreparedStatement : [select              TM_SYS_SERVICEMAP.ID,              TM_SYS_SERVICEMAP.HOSPITAL_ID,              TM_SYS_SERVICEMAP.DB_NAME,              TM_SYS_SERVICEMAP.TYPE,              TM_SYS_SERVICEMAP.NAME,              TM_SYS_SERVICEMAP.CLASS,              (TM_SYS_DIC.VALUE + '.' + TM_SYS_SERVICEMAP.CLASS) as CLASSFULL,              TM_SYS_SERVICEMAP.ASSEMBLY              from TM_SYS_SERVICEMAP              inner join TM_SYS_DIC              on TM_SYS_SERVICEMAP.NAMESPACE = TM_SYS_DIC.ID              where HOSPITAL_ID = '_SYSTEM_' AND TYPE = 'D' AND ACTIVE = '1'              order by DB_NAME]
2019-09-20 16:45:52,828 [1] DEBUG - Statement Id: [DAO00001_ServiceList] PreparedStatement : [select              TM_SYS_SERVICEMAP.ID,              TM_SYS_SERVICEMAP.HOSPITAL_ID,              TM_SYS_SERVICEMAP.DB_NAME,              TM_SYS_SERVICEMAP.TYPE,              TM_SYS_SERVICEMAP.NAME,              TM_SYS_SERVICEMAP.CLASS,              (TM_SYS_DIC.VALUE + '.' + TM_SYS_SERVICEMAP.CLASS) as CLASSFULL,              TM_SYS_SERVICEMAP.ASSEMBLY,              TM_SYS_SERVER.URL              from TM_SYS_SERVICEMAP              inner join TM_SYS_DIC on TM_SYS_SERVICEMAP.NAMESPACE = TM_SYS_DIC.ID              inner join TM_SYS_SERVER on (TM_SYS_SERVICEMAP.DB_NAME = TM_SYS_SERVER.NAME) and (TM_SYS_SERVER.HOSPITAL_ID = '_SYSTEM_')              where TM_SYS_SERVICEMAP.HOSPITAL_ID = '_SYSTEM_' AND TM_SYS_SERVICEMAP.TYPE = 'S'  AND ACTIVE = '1'              order by URL]
2019-09-20 16:45:53,349 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = '_SYSTEM_'               AND                   TM_SYS_SCREEN.PAGE = 'LOGIN'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2019-09-20 16:45:53,618 [1] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = '_SYSTEM_'               AND                   TM_SYS_CACHE.ACTIVE = '1']
2019-09-20 16:46:01,043 [1] DEBUG - Statement Id: [DAO00001_DBList] PreparedStatement : [select *              from TM_SYS_SERVER              where HOSPITAL_ID = 'HLU01' and TYPE = 'D']
2019-09-20 16:46:01,088 [1] DEBUG - Statement Id: [DAO00001_DaoList] PreparedStatement : [select              TM_SYS_SERVICEMAP.ID,              TM_SYS_SERVICEMAP.HOSPITAL_ID,              TM_SYS_SERVICEMAP.DB_NAME,              TM_SYS_SERVICEMAP.TYPE,              TM_SYS_SERVICEMAP.NAME,              TM_SYS_SERVICEMAP.CLASS,              (TM_SYS_DIC.VALUE + '.' + TM_SYS_SERVICEMAP.CLASS) as CLASSFULL,              TM_SYS_SERVICEMAP.ASSEMBLY              from TM_SYS_SERVICEMAP              inner join TM_SYS_DIC              on TM_SYS_SERVICEMAP.NAMESPACE = TM_SYS_DIC.ID              where HOSPITAL_ID = 'HLU01' AND TYPE = 'D' AND ACTIVE = '1'              order by DB_NAME]
2019-09-20 16:46:03,965 [1] DEBUG - Statement Id: [DAO00001_ServiceList] PreparedStatement : [select              TM_SYS_SERVICEMAP.ID,              TM_SYS_SERVICEMAP.HOSPITAL_ID,              TM_SYS_SERVICEMAP.DB_NAME,              TM_SYS_SERVICEMAP.TYPE,              TM_SYS_SERVICEMAP.NAME,              TM_SYS_SERVICEMAP.CLASS,              (TM_SYS_DIC.VALUE + '.' + TM_SYS_SERVICEMAP.CLASS) as CLASSFULL,              TM_SYS_SERVICEMAP.ASSEMBLY,              TM_SYS_SERVER.URL              from TM_SYS_SERVICEMAP              inner join TM_SYS_DIC on TM_SYS_SERVICEMAP.NAMESPACE = TM_SYS_DIC.ID              inner join TM_SYS_SERVER on (TM_SYS_SERVICEMAP.DB_NAME = TM_SYS_SERVER.NAME) and (TM_SYS_SERVER.HOSPITAL_ID = 'HLU01')              where TM_SYS_SERVICEMAP.HOSPITAL_ID = 'HLU01' AND TM_SYS_SERVICEMAP.TYPE = 'S'  AND ACTIVE = '1'              order by URL]
2019-09-20 16:46:04,050 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1']
2019-09-20 16:46:04,961 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM005']
2019-09-20 16:46:05,211 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM015']
2019-09-20 16:46:05,295 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM067']
2019-09-20 16:46:05,384 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM008']
2019-09-20 16:46:05,461 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM068']
2019-09-20 16:46:05,540 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM006']
2019-09-20 16:46:05,636 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM030']
2019-09-20 16:46:05,745 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM025']
2019-09-20 16:46:05,834 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM024']
2019-09-20 16:46:06,343 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM033']
2019-09-20 16:46:06,395 [5] DEBUG - Statement Id: [DAO00027_GetListDuocKyGuiTonKho] PreparedStatement : [select  distinct TT_TONKHO.DUOC_KEY, LTRIM(TT_TONKHO.KHODUOC_ID) as KHODUOC_ID, TM_DUOC.DUOC_ID, TM_LOAIDUOC.MALOAIDUOC,TM_DUOC.SOVISA,TM_DUOC.TYLE_VAT,TM_DUOC.COTOA,        TM_DUOC.MADUOC, TM_DUOC.TENHANG, TM_DUOC.TENDUOCDAYDU, dvt.TENDONVITINH as DONVITINH,  TM_DUOC.DONVITINH_ID,TM_DUOC.BHYT,TM_DUOC.PHAMVI,        TM_DUOC.TENHOATCHAT, TM_DUOC.HAMLUONG, TM_DUOC.HANGSANXUAT, TM_DUOC.QUOCGIA, TM_DUOC.LOAIDUOC_ID, TM_DUOC.DUONGDUNG_ID,        TM_TENDUOC.TENDUOC, TM_TENDUOC.TENDUOC_EN, TM_TENDUOC.MAQUOCTE, TM_TENDUOC.MAQUOCTEBT,        TM_LOAIDUOC.LOAIVATTU_ID, TM_DUOC.BENHVIEN_ID,TT_TONKHO.SOLUONG, TT_TONKHO.NGUONDUOC_ID, NH.TENNGUONDUOC        , TAMNGUNG = CASE WHEN TM_DUOC.TAMNGUNG = '1' OR nh.TAMNGUNG = '1' OR KD.TAMNGUNG = '1' THEN '1' ELSE '0' END        , TM_DUOC.DANGTRINHBAY        from TM_DUOC        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = TM_DUOC.DONVITINH_ID        left join TM_TENDUOC on TM_DUOC.TENDUOC_ID = TM_TENDUOC.TENDUOC_ID and TM_DUOC.BENHVIEN_ID = 'HLU01' and TM_DUOC.TAMNGUNG = '0'        left join TM_LOAIDUOC on TM_LOAIDUOC.LOAIDUOC_ID = TM_DUOC.LOAIDUOC_ID and TM_LOAIDUOC.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG on (TM_LOAIDUOC.LOAIVATTU_ID = TM_DUOC_HANDUNG.LOAIDUOC and TM_DUOC_HANDUNG.BENHVIEN_ID = 'HLU01')        inner join        (select LTRIM(A.KHODUOC_ID) + '_' + LTRIM(A.DUOC_ID) + '_' + LTRIM(ISNULL(A.NGUONDUOC_ID,'')) as DUOC_KEY, A.KHODUOC_ID, A.DUOC_ID,A.NGUONDUOC_ID,        SUM(isnull(A.SOLUONG,0)) as SOLUONG        from        (select SUM(SOLUONG) as SOLUONG, KHODUOC_ID, DUOC_ID, NGUONDUOC_ID from TT_DUOC_KYGUI_TONKHO        where BENHVIEN_ID = 'HLU01' group by KHODUOC_ID, DUOC_ID, NGUONDUOC_ID) A        group by LTRIM(A.KHODUOC_ID) + '_' + LTRIM(A.DUOC_ID) + '_' + LTRIM(A.NGUONDUOC_ID), A.KHODUOC_ID, A.DUOC_ID, A.NGUONDUOC_ID)        TT_TONKHO on TT_TONKHO.DUOC_ID = TM_DUOC.DUOC_ID        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = TT_TONKHO.NGUONDUOC_ID and nh.BENHVIEN_ID = 'HLU01'        LEFT JOIN TM_KHODUOC KD ON KD.KHODUOC_ID = TT_TONKHO.KHODUOC_ID        where TM_DUOC.BENHVIEN_ID = 'HLU01' AND TT_TONKHO.SOLUONG >= 0]
2019-09-20 16:46:06,465 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM018']
2019-09-20 16:46:06,913 [5] DEBUG - Statement Id: [DAO00027_GetListDuocTonKho] PreparedStatement : [select distinct TT_TONKHO.DUOC_KEY, LTRIM(TT_TONKHO.KHODUOC_ID) as KHODUOC_ID, TM_DUOC.DUOC_ID, TM_LOAIDUOC.MALOAIDUOC,TM_DUOC.SOVISA,TM_DUOC.TYLE_VAT,TM_DUOC.COTOA,        TM_DUOC.MADUOC, TM_DUOC.TENHANG, TM_DUOC.TENDUOCDAYDU, dvt.TENDONVITINH as DONVITINH,  TM_DUOC.DONVITINH_ID,TM_DUOC.BHYT,                TM_DUOC.TENHOATCHAT,          TM_DUOC.HAMLUONG, TM_DUOC.HANGSANXUAT, TM_DUOC.QUOCGIA, TM_DUOC.LOAIDUOC_ID, TM_DUOC.DUONGDUNG_ID,        TM_TENDUOC.TENDUOC, TM_TENDUOC.TENDUOC_EN, TM_TENDUOC.MAQUOCTE, TM_TENDUOC.MAQUOCTEBT,        TM_LOAIDUOC.LOAIVATTU_ID, TM_DUOC.BENHVIEN_ID,        TT_TONKHO.SOLUONG, TM_DUOC.VTYT_PHANLOAI, TM_DUOC.PHAMVI, TT_TONKHO.NGUONDUOC_ID, NG.TENNGUONDUOC AS TENNGUONDUOC        , TAMNGUNG = CASE WHEN TM_DUOC.TAMNGUNG = '1' OR NG.TAMNGUNG = '1' OR KD.TAMNGUNG = '1' THEN '1' ELSE '0' END        , TM_DUOC.DANGTRINHBAY        from TM_DUOC        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = TM_DUOC.DONVITINH_ID        left join TM_TENDUOC on TM_DUOC.TENDUOC_ID = TM_TENDUOC.TENDUOC_ID and TM_DUOC.BENHVIEN_ID = 'HLU01' and TM_DUOC.TAMNGUNG = '0'        left join TM_LOAIDUOC on TM_LOAIDUOC.LOAIDUOC_ID = TM_DUOC.LOAIDUOC_ID and TM_LOAIDUOC.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG on (TM_LOAIDUOC.LOAIVATTU_ID = TM_DUOC_HANDUNG.LOAIDUOC and TM_DUOC_HANDUNG.BENHVIEN_ID = 'HLU01')        inner join        (select LTRIM(A.KHODUOC_ID) + '_' + LTRIM(A.DUOC_ID) + '_' + LTRIM(ISNULL(A.NGUONDUOC_ID,'')) as DUOC_KEY, A.KHODUOC_ID, A.DUOC_ID, A.NGUONDUOC_ID,        SUM(isnull(A.SOLUONG,0)) as SOLUONG        from        (select SUM(SOLUONG) as SOLUONG, KHODUOC_ID, DUOC_ID, NGUONDUOC_ID from TT_DUOC_TONKHO        where BENHVIEN_ID = 'HLU01' group by KHODUOC_ID, DUOC_ID, NGUONDUOC_ID) A        group by LTRIM(A.KHODUOC_ID) + '_' + LTRIM(A.DUOC_ID) + '_' + LTRIM(ISNULL(A.NGUONDUOC_ID,'')), A.KHODUOC_ID, A.DUOC_ID, NGUONDUOC_ID        ) TT_TONKHO on TT_TONKHO.DUOC_ID = TM_DUOC.DUOC_ID        LEFT JOIN TM_NGUONHANG NG ON NG.NGUONDUOC_ID = TT_TONKHO.NGUONDUOC_ID        LEFT JOIN TM_KHODUOC KD ON KD.KHODUOC_ID = TT_TONKHO.KHODUOC_ID        where TM_DUOC.BENHVIEN_ID = 'HLU01' and TT_TONKHO.SOLUONG >= 0]
2019-09-20 16:46:08,609 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM023']
2019-09-20 16:46:08,647 [5] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoVaBooking] PreparedStatement : [declare @NGUONDUOC_MACDINH varchar(5) = '0';        declare @TOAMUANGOAI int = 0;        select @NGUONDUOC_MACDINH = isnull(VALUE,0) from TM_SYS_APPSETTINGS where CODE = 'PHA_NGUONDUOC'        select @TOAMUANGOAI = isnull(VALUE,0) from TM_SYS_APPSETTINGS where CODE = 'OPD_TOAMUANGOAI_DUNGDANHMUC_DUOC'                if @TOAMUANGOAI = 1        begin        select  distinct '0' + '_' + LTRIM(d.DUOC_ID) + '_' + @NGUONDUOC_MACDINH as DUOC_KEY, 0 as PHAMVI_ID, @NGUONDUOC_MACDINH as NGUONDUOC_ID, null as TENNGUONDUOC, null as TINHTIEN, d.DUOC_ID, ld.MALOAIDUOC,        d.SOVISA,d.TYLE_VAT,d.COTOA, d.MADUOC, d.TENHANG, d.TENDUOCDAYDU, d.DONVITINH as DONVITINH, d.BHYT,        d.TENHOATCHAT, d.HAMLUONG, d.HANGSANXUAT, d.QUOCGIA, d.LOAIDUOC_ID, d.DUONGDUNG_ID, d.TINHTIEN_PTTT,        ten.TENDUOC, ten.TENDUOC_EN, ten.MAQUOCTE, ten.MAQUOCTEBT,        '' as BHYT_TEXT        , ld.LOAIVATTU_ID        , d.BENHVIEN_ID,        999999999 as SOLUONG, d.VTYT_PHANLOAI, d.PHAMVI, d.SUASOLUONGTONGHOP, d.MADUOCBV, d.DANGTRINHBAY        , TAMNGUNG = CASE WHEN d.TAMNGUNG = '1' THEN '1' ELSE '0' END        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        union all        select  distinct tk.DUOC_KEY, LTRIM(tk.PHAMVI_ID) as PHAMVI_ID, tk.NGUONDUOC_ID, nh.TENNGUONDUOC, nh.TINHTIEN, d.DUOC_ID, ld.MALOAIDUOC,        d.SOVISA,d.TYLE_VAT,d.COTOA, d.MADUOC, d.TENHANG, d.TENDUOCDAYDU, d.DONVITINH as DONVITINH, d.BHYT,        d.TENHOATCHAT, d.HAMLUONG, d.HANGSANXUAT, d.QUOCGIA, d.LOAIDUOC_ID, d.DUONGDUNG_ID, d.TINHTIEN_PTTT,        ten.TENDUOC, ten.TENDUOC_EN, ten.MAQUOCTE, ten.MAQUOCTEBT,        CASE WHEN d.BHYT = '1' THEN 'BHYT' ELSE '' END as BHYT_TEXT        , ld.LOAIVATTU_ID        , d.BENHVIEN_ID,        tk.SOLUONG, d.VTYT_PHANLOAI, d.PHAMVI, d.SUASOLUONGTONGHOP, d.MADUOCBV, d.DANGTRINHBAY        , TAMNGUNG = CASE WHEN d.TAMNGUNG = '1' OR nh.TAMNGUNG = '1' OR kd.TAMNGUNG = '1' THEN '1' ELSE '0' END        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        inner join        (        select  LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')) DUOC_KEY, (SUM(dtk.SOLUONG) - isnull(sum(A.SOLUONG),0) - isnull(sum(B.SOLUONG),0)) SOLUONG, pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        from (select sum(soluong) soluong,duoc_id,nguonduoc_id,khoduoc_id,benhvien_id from TT_DUOC_TONKHO  group by duoc_id,nguonduoc_id,khoduoc_id,benhvien_id) dtk        inner join TM_DUOC_PHAMVISD_MAPPING pvsd on dtk.KHODUOC_ID = pvsd.KHODUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NOITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) B on B.DUOC_ID = dtk.DUOC_ID and B.SOLUONG > 0 and B.PHAMVI_ID = pvsd.PHAMVI_ID and B.NGUONHANG_ID = dtk.NGUONDUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NGOAITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) A on A.DUOC_ID = dtk.DUOC_ID and A.SOLUONG > 0 and A.PHAMVI_ID = pvsd.PHAMVI_ID and A.NGUONHANG_ID = dtk.NGUONDUOC_ID        where dtk.SOLUONG > 0 and dtk.BENHVIEN_ID = 'HLU01'        group by LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')), pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        ) tk on tk.DUOC_ID = d.DUOC_ID        left join TM_DUOC_PHAMVISUDUNG kd on kd.PHAMVI_ID = tk.PHAMVI_ID and kd.BENHVIEN_ID = 'HLU01'        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = tk.NGUONDUOC_ID and nh.BENHVIEN_ID = 'HLU01'        where d.BENHVIEN_ID = 'HLU01'  and tk.SOLUONG >= 0        end        else        begin                  select  distinct tk.DUOC_KEY, LTRIM(tk.PHAMVI_ID) as PHAMVI_ID, tk.NGUONDUOC_ID, nh.TENNGUONDUOC, nh.TINHTIEN, d.DUOC_ID, ld.MALOAIDUOC,        d.SOVISA,d.TYLE_VAT,d.COTOA, d.MADUOC, d.TENHANG, d.TENDUOCDAYDU, d.DONVITINH as DONVITINH, d.BHYT,        d.TENHOATCHAT, d.HAMLUONG, d.HANGSANXUAT, d.QUOCGIA, d.LOAIDUOC_ID, d.DUONGDUNG_ID, d.TINHTIEN_PTTT,        ten.TENDUOC, ten.TENDUOC_EN, ten.MAQUOCTE, ten.MAQUOCTEBT,        CASE WHEN d.BHYT = '1' THEN 'BHYT' ELSE '' END as BHYT_TEXT        , ld.LOAIVATTU_ID        , d.BENHVIEN_ID,        tk.SOLUONG, d.VTYT_PHANLOAI, d.PHAMVI, d.SUASOLUONGTONGHOP, d.MADUOCBV, d.DANGTRINHBAY        , TAMNGUNG = CASE WHEN d.TAMNGUNG = '1' OR nh.TAMNGUNG = '1' OR kd.TAMNGUNG = '1' THEN '1' ELSE '0' END        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        inner join        (        select  LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')) DUOC_KEY, (SUM(dtk.SOLUONG) - isnull(sum(A.SOLUONG),0) - isnull(sum(B.SOLUONG),0)) SOLUONG, pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        from (select sum(soluong) soluong,duoc_id,nguonduoc_id,khoduoc_id,benhvien_id from TT_DUOC_TONKHO  group by duoc_id,nguonduoc_id,khoduoc_id,benhvien_id) dtk        inner join TM_DUOC_PHAMVISD_MAPPING pvsd on dtk.KHODUOC_ID = pvsd.KHODUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NOITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) B on B.DUOC_ID = dtk.DUOC_ID and B.SOLUONG > 0 and B.PHAMVI_ID = pvsd.PHAMVI_ID and B.NGUONHANG_ID = dtk.NGUONDUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NGOAITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) A on A.DUOC_ID = dtk.DUOC_ID and A.SOLUONG > 0 and A.PHAMVI_ID = pvsd.PHAMVI_ID and A.NGUONHANG_ID = dtk.NGUONDUOC_ID        where dtk.SOLUONG > 0 and dtk.BENHVIEN_ID = 'HLU01'        group by LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')), pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        ) tk on tk.DUOC_ID = d.DUOC_ID        left join TM_DUOC_PHAMVISUDUNG kd on kd.PHAMVI_ID = tk.PHAMVI_ID and kd.BENHVIEN_ID = 'HLU01'        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = tk.NGUONDUOC_ID and nh.BENHVIEN_ID = 'HLU01'        where d.BENHVIEN_ID = 'HLU01'  and tk.SOLUONG >= 0        end]
2019-09-20 16:46:11,917 [5] DEBUG - Statement Id: [DAO00320_GetList] PreparedStatement : [select M.*            from TM_MAU M            LEFT JOIN TM_MAU_DONVITINH DVT on M.DONVITINH_ID=DVT.DONVITINH_ID            where            M.TAMNGUNG = '0'            and M.BENHVIEN_ID = 'HLU01'            order by M.TENMAU]
2019-09-20 16:46:12,028 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM071']
2019-09-20 16:46:12,068 [5] DEBUG - Statement Id: [DAO00322_GetListMauTonKhoForCreateCached] PreparedStatement : [SELECT DISTINCT          TK.MAU_KEY, TK.KHOMAU_ID, M.MAU_ID, M.MAMAU, M.TENMAU, M.NHOM_ABO, M.NHOM_RH, M.LOAIMAU_ID,          TK.SOLONHAP_ID, SLN.SOLONHAP, SLN.SOKIEMSOAT, TK.NGUONHANG_ID, NG.TENNGUONMAU, M.BENHVIEN_ID, M.DONVITINH_ID,          SUM(tk.SOLUONG) AS SOLUONG,K.TENKHO,DVT.TENDONVITINH          FROM TT_MAU_TONKHO TK          JOIN TM_KHO K ON TK.KHOMAU_ID = K.KHO_ID          JOIN TT_MAU_CHUNGTU_SOLONHAP SLN ON TK.SOLONHAP_ID = SLN.SOLONHAP_ID          JOIN TM_MAU M on TK.MAU_ID = M.MAU_ID and M.TAMNGUNG = '0'          LEFT JOIN TM_MAU_DONVITINH DVT on M.DONVITINH_ID=DVT.DONVITINH_ID          LEFT JOIN TM_NGUONMAU NG ON NG.NGUONMAU_ID = TK.NGUONHANG_ID          WHERE TK.SOLUONG > 0          GROUP BY TK.MAU_KEY, TK.KHOMAU_ID, M.MAU_ID, M.MAMAU, M.TENMAU, M.NHOM_ABO, M.NHOM_RH, M.LOAIMAU_ID,          TK.SOLONHAP_ID, SLN.SOLONHAP, SLN.SOKIEMSOAT,TK.NGUONHANG_ID, NG.TENNGUONMAU, M.BENHVIEN_ID, M.DONVITINH_ID,K.TENKHO,DVT.TENDONVITINH]
2019-09-20 16:46:12,137 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM073']
2019-09-20 16:46:12,173 [5] DEBUG - Statement Id: [DAO00322_GetListMauTonKhoTruBooking] PreparedStatement : [select distinct          TK.MAU_KEY, TK.KHOMAU_ID, M.MAU_ID, M.MAMAU, M.TENMAU, M.NHOM_ABO, M.NHOM_RH, M.LOAIMAU_ID, M.DONVITINH_ID,          TK.SOLONHAP_ID, TK.SOLONHAP, TK.SOKIEMSOAT,M.PHAMVI, TK.NGUONHANG_ID, NG.TENNGUONMAU, M.BENHVIEN_ID,          TK.SOLUONG,TK.TENKHO,DVT.TENDONVITINH          from TM_MAU M          JOIN          (          select          A.MAU_KEY, A.KHOMAU_ID, A.MAU_ID ,a.NGUONHANG_ID, A.SOLONHAP_ID, A.SOLONHAP, A.SOKIEMSOAT, A.SOLUONG,A.TENKHO          from          (          select KHOMAU_ID, TK.MAU_ID, TK.NGUONHANG_ID, TK.MAU_KEY, SLN.SOLONHAP_ID, SLN.SOLONHAP, SLN.SOKIEMSOAT, ISNULL(TK.SOLUONG,0) - ISNULL(book.SOLUONG,0) as SOLUONG,K.TENKHO          from TT_MAU_TONKHO TK          JOIN TM_KHO K ON TK.KHOMAU_ID = K.KHO_ID          inner join TT_MAU_CHUNGTU_SOLONHAP SLN ON TK.SOLONHAP_ID = SLN.SOLONHAP_ID          left join dbo.TT_MAU_TONKHO_BOOK book ON book.MAU_KEY = TK.MAU_KEY AND book.TRANGTHAI = 'HIEULUC'          where ISNULL(TK.SOLUONG,0) - ISNULL(book.SOLUONG,0) > 0          ) A          )TK on TK.MAU_ID = M.MAU_ID and M.TAMNGUNG = '0'          LEFT JOIN TM_MAU_DONVITINH DVT on M.DONVITINH_ID=DVT.DONVITINH_ID          LEFT JOIN TM_NGUONMAU NG ON NG.NGUONMAU_ID = TK.NGUONHANG_ID]
2019-09-20 16:46:12,247 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM072']
2019-09-20 16:46:13,184 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'MAIN'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2019-09-20 16:46:14,473 [1] DEBUG - Statement Id: [DAO00002_FormList] PreparedStatement : [select              TM_SYS_FORM.HOSPITAL_ID,              TM_SYS_FORM.NAME,              TM_SYS_FORM.CLASS,              TM_SYS_FORM.ASSEMBLY,              TM_SYS_FORM.TITLE_VI as TITLE              from TM_SYS_FORM              where HOSPITAL_ID = 'HLU01']
2019-09-20 16:46:21,008 [1] DEBUG - Statement Id: [DAO00300_GetShortcutListByUserID] PreparedStatement : [SELECT S.SHORTCUT_CODE, S.SHORTCUT_VALUE              FROM TM_SHORTCUT AS S              WHERE S.BENHVIEN_ID = 'HLU01' AND S.USER_ID = '1' AND TAMNGUNG = '0']
2019-09-20 16:46:21,179 [1] DEBUG - Statement Id: [DAO00087_GetList] PreparedStatement : [select CODE, VALUE, BENHVIEN_ID              from TM_SYS_APPSETTINGS              where LOCKED = '0' and BENHVIEN_ID = 'HLU01'              order by SETTING_ID]
2019-09-20 16:46:21,262 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'MSG01'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2019-09-20 16:46:21,382 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'MSG02'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2019-09-20 16:46:21,694 [1] DEBUG - Statement Id: [DAO00008_GetUserSettings] PreparedStatement : [select A.*, B.TENKHO , C.TENPHONGBAN, B.MAKHO, C.MAPHONGBAN          from TM_SYS_USERS A          left join TM_KHODUOC B on B.KHODUOC_ID = A.INVENTORY_ID          left join TM_PHONGBAN C on (C.PHONGBAN_ID = A.WORKING_DEPT_ID and C.BENHVIEN_ID =  @param0 )          left join TM_SYS_USERKHO D on (D.ACCOUNT_ID = A.ACCOUNT_ID and D.HOSPITAL_ID =  @param0 )          where          A.HOSPITAL_ID =  @param0            and                 A.ACCOUNT_ID =  @param1]
2019-09-20 16:46:21,696 [1] DEBUG - Statement Id: [DAO00008_GetUserSettings] Parameters: [@param0=[HOSPITAL_ID,HLU01], @param1=[ACCOUNT_ID,113]]
2019-09-20 16:46:21,696 [1] DEBUG - Statement Id: [DAO00008_GetUserSettings] Types: [@param0=[String, System.String], @param1=[String, System.String]]
2019-09-20 16:46:22,678 [1] DEBUG - Statement Id: [DAO00008_GetUserInvSettings] PreparedStatement : [select A.*, B.TENKHO, B.MAKHO, B.LOAIKHO_ID, B.KHOQUANLY_ID          from TM_SYS_USERKHO A          left join TM_KHO B on B.MODULE_ID = A.MODULE_ID and B.KHO_ID = A.KHO_ID          where A.HOSPITAL_ID =  @param0  and A.ACCOUNT_ID =  @param1           order by B.TENKHO]
2019-09-20 16:46:22,678 [1] DEBUG - Statement Id: [DAO00008_GetUserInvSettings] Parameters: [@param0=[HOSPITAL_ID,HLU01], @param1=[ACCOUNT_ID,113]]
2019-09-20 16:46:22,678 [1] DEBUG - Statement Id: [DAO00008_GetUserInvSettings] Types: [@param0=[String, System.String], @param1=[String, System.String]]
2019-09-20 16:46:22,840 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'COM30'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2019-09-20 16:46:23,605 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'RIS04'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2019-09-20 16:46:34,551 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'MENU1'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2019-09-20 16:46:34,648 [1] DEBUG - Statement Id: [DAO00011_GetList] PreparedStatement : [select              TM_SYS_MENU.ID,              TM_SYS_MENU.PARENTID,              TM_SYS_MENU.SCREEN,              TM_SYS_MENU.SMALLIMAGE,              TM_SYS_MENU.LARGEIMAGE,              TM_SYS_MENU.DESCRIPTION,              TM_SYS_MENU.TYPE,              TM_SYS_MENU.TITLE_VI as TITLE              from TM_SYS_MENU              where TM_SYS_MENU.HOSPITAL_ID = 'HLU01' and TM_SYS_MENU.ACTIVE = '1'               AND                   (TM_SYS_MENU.TYPE & '8' = '8')                             order by TM_SYS_MENU.ORDERNUM]
2019-09-20 16:46:35,094 [1] DEBUG - Statement Id: [DAO00011_usermenu_list] PreparedStatement : [select              TM_SYS_HOMEMENU.MENUID as ID,              TM_SYS_MENU.TITLE_VI as TITLE,              TM_SYS_MENU.SCREEN,              TM_SYS_MENU.SMALLIMAGE,              TM_SYS_MENU.LARGEIMAGE,              TM_SYS_MENU.TYPE              from TM_SYS_HOMEMENU              left join TM_SYS_MENU on TM_SYS_MENU.ID = TM_SYS_HOMEMENU.MENUID and TM_SYS_MENU.HOSPITAL_ID = TM_SYS_HOMEMENU.HOSPITAL_ID              where TM_SYS_HOMEMENU.HOSPITAL_ID = 'HLU01' and TM_SYS_HOMEMENU.USERID = '113' and TM_SYS_MENU.ACTIVE = '1'               AND                   (TM_SYS_MENU.TYPE & '8' = '8')                             ORDER BY TM_SYS_HOMEMENU.ORDERNUM]
2019-09-20 16:46:39,601 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'COM98'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2019-09-20 16:46:40,248 [1] DEBUG - Statement Id: [DAO00020_ListKhoDuocOfPhongBan] PreparedStatement : [select B.* from TM_PHONGBAN_KHODUOC A        inner join TM_KHODUOC B on B.KHODUOC_ID = A.KHODUOC_ID        where        A.PHONGBAN_ID = '58'        and A.BENHVIEN_ID = 'HLU01']
2019-09-20 16:46:50,798 [1] DEBUG - Statement Id: [DAO00020_ListKhoDuocOfPhongBan] PreparedStatement : [select B.* from TM_PHONGBAN_KHODUOC A        inner join TM_KHODUOC B on B.KHODUOC_ID = A.KHODUOC_ID        where        A.PHONGBAN_ID = '62'        and A.BENHVIEN_ID = 'HLU01']
2019-09-20 16:46:51,538 [1] DEBUG - Statement Id: [DAO00008_UpdateUserIdPhongBanKhoDuoc] PreparedStatement : [IF EXISTS            (SELECT ACCOUNT_ID FROM TM_SYS_USERS WHERE ACCOUNT_ID =  @param0  and HOSPITAL_ID =  @param1 )            BEGIN            update TM_SYS_USERS set INVENTORY_ID =  @param2 , WORKING_DEPT_ID =  @param3             WHERE ACCOUNT_ID =  @param0  and HOSPITAL_ID =  @param1             END            ELSE            BEGIN            insert into TM_SYS_USERS ([ACCOUNT_ID], [ACCOUNT_NAME], [INVENTORY_ID], [WORKING_DEPT_ID], [HOSPITAL_ID])            values ( @param0 ,  @param4 ,  @param2 ,  @param3 ,  @param1 )            END]
2019-09-20 16:46:51,538 [1] DEBUG - Statement Id: [DAO00008_UpdateUserIdPhongBanKhoDuoc] Parameters: [@param0=[ACCOUNT_ID,113], @param1=[HOSPITAL_ID,HLU01], @param2=[INVENTORY_ID,32], @param3=[WORKING_DEPT_ID,62], @param4=[ACCOUNT_NAME,admin]]
2019-09-20 16:46:51,538 [1] DEBUG - Statement Id: [DAO00008_UpdateUserIdPhongBanKhoDuoc] Types: [@param0=[String, System.String], @param1=[String, System.String], @param2=[String, System.String], @param3=[String, System.String], @param4=[String, System.String]]
2019-09-20 16:46:59,868 [1] DEBUG - Statement Id: [DAO00087_GetServiceParams] PreparedStatement : [select CODE, VALUE              from TM_SYS_APPSETTINGS              where LOCKED = '0' and BENHVIEN_ID = 'HLU01']
2019-09-20 16:47:00,315 [1] DEBUG - Statement Id: [DAO00030_GetMucDichChungTuID] PreparedStatement : [SELECT DICTIONARY_ID              FROM              LST_DICTIONARY              WHERE              DICTIONARY_TYPE_CODE = 'MucDichChungTu'              and DICTIONARY_CODE = 'X13']
2019-09-20 16:47:00,470 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'PHA22'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2019-09-20 16:47:01,299 [1] DEBUG - Statement Id: [DAO00030_GET_SOLONHAP] PreparedStatement : [SELECT DISTINCT            SLN.SOLONHAP_ID, SLN.SOLONHAP, SLN.SOLOSANPHAM, SLN.SOKIEMSOAT, SLN.SOVISA, CONVERT(varchar(20), SLN.SOLOSANPHAM) + '/' + CONVERT(varchar(20), TK.SOLUONG) AS SOLOSOTON,            SLN.NGAYNHAP AS NGAYNHAPLO, SLN.HANDUNG AS HANSUDUNG,  SLN.HANDUNG, SLN.NGUONDUOC_ID, SLN.NGUONDUOC_ID as NGUONHANG_ID,            SLNGB.DONGIAMUA, SLNGB.DONGIAVON, SLNGB.TYLEVAT_DAUVAO as TYLEVAT, d.TYLE_VAT, SLNGB.DONGIAVONVAT, SLNGB.DONGIABAN, SLNGB.DONGIABANVAT_DAUVAO as DONGIABAN_VAT,            TK.DUOCTONKHO_ID, TK.KHODUOC_ID, TK.DUOC_ID, TK.SOLUONG, TK.SOLUONG AS SOLUONGTON,            D.TENDUOCDAYDU,D.DONVITINH_ID, D.DONVITINH, D.BHYT, NH.TENNGUONDUOC AS NGUONHANG,            LTRIM(TK.KHODUOC_ID) + '_' + LTRIM(TK.DUOC_ID) + '_' + LTRIM(TK.NGUONDUOC_ID) as DUOC_KEY, D.SO_QDTT            FROM            TT_DUOC_CHUNGTU_SOLONHAP SLN,            TT_DUOC_TONKHO TK,            TT_DUOC_SOLONHAP_GIABAN SLNGB,            TM_DUOC D,            TM_NGUONHANG NH            WHERE            SLN.SOLONHAP_ID = TK.SOLONHAP_ID            AND SLN.SOLONHAP_ID = SLNGB.SOLONHAP_ID            AND SLN.NGUONDUOC_ID = NH.NGUONDUOC_ID            AND SLN.DUOC_ID = D.DUOC_ID            AND TK.DUOC_ID = ''            AND TK.KHODUOC_ID = ''            AND SLN.BENHVIEN_ID = 'HLU01'            AND TK.SOLUONG > 0                 and                     SLN.NGUONDUOC_ID = '1'                                      ORDER BY NGAYNHAP]
2019-09-20 16:47:01,596 [1] DEBUG - Statement Id: [DAO00030_GetMucDichChungTuID] PreparedStatement : [SELECT DICTIONARY_ID              FROM              LST_DICTIONARY              WHERE              DICTIONARY_TYPE_CODE = 'MucDichChungTu'              and DICTIONARY_CODE = 'X13']
2019-09-20 16:47:01,708 [1] DEBUG - Statement Id: [DAO00030_GetMucDichChungTuID] PreparedStatement : [SELECT DICTIONARY_ID              FROM              LST_DICTIONARY              WHERE              DICTIONARY_TYPE_CODE = 'MucDichChungTu'              and DICTIONARY_CODE = 'X13']
2019-09-20 16:47:02,767 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'PHA74'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2019-09-20 16:47:07,900 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'PHA73'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2019-09-20 16:47:08,145 [1] DEBUG - Statement Id: [DAO00030_XUATSUDUNG_TOANOITRU] PreparedStatement : [SELECT            N'Người bệnh: ' + BN.MAYTE + ' - ' + BN.TENBENHNHAN + ' - '  + N'Bệnh án: ' + BA.SOBENHAN  as BENHNHAN,            CASE WHEN BN.GIOITINH = 1 THEN 'Nam' WHEN BN.GIOITINH = 2 THEN N'Nữ'  END  AS GIOITINH ,            CASE WHEN BN.NGAYSINH IS NOT NULL THEN CONVERT(VARCHAR(10), BN.NGAYSINH, 103) ELSE CONVERT(VARCHAR(10), BN.NAMSINH) END as NGAYSINH,            CASE WHEN dt.TENDOITUONG IS NOT NULL THEN dt.TENDOITUONG  ELSE '' END as DOITUONG,            N'Y lệnh:' + TT.SOTHUTUTOA + ' - Ngày: ' + CONVERT(VARCHAR(10), KB.THOIGIANKHAM, 103) + ' - ' + CONVERT(VARCHAR(5), KB.THOIGIANKHAM, 108)            + CASE WHEN NV.TENNHANVIEN IS NOT NULL THEN + N' - Người lập: ' +  NV.TENNHANVIEN ELSE '' END            AS YLENH,            TT.TOATHUOC_ID,            TT.SOTHUTUTOA as REF_ID,            PL.MACHUNGTU,            TT.DUOC_ID,            d.MADUOC,            d.TENDUOCDAYDU,            d.DONVITINH,            TT.SOLUONG as SOLUONGYEUCAU,            trt.SOLUONG as SOLUONGTRA,            TT.NGAYTAO            FROM            TT_NOITRU_TOATHUOC TT            inner join TT_NOITRU_KHAMBENH KB on KB.KHAMBENH_ID = TT.KHAMBENH_ID            inner join TT_NOITRU_BENHAN BA on BA.BENHAN_ID = KB.BENHAN_ID            inner join TT_BENHNHAN BN on BA.BENHNHAN_ID = BN.BENHNHAN_ID            inner join TM_DUOC D on D.DUOC_ID = TT.DUOC_ID            inner join TM_LOAIDUOC LD on LD.LOAIDUOC_ID = D.LOAIDUOC_ID            left join TM_DOITUONG dt on BA.DOITUONG_ID = dt.DOITUONG_ID            left join TT_DUOC_PHIEULINH PL on PL.CHUNGTU_ID = TT.PHIEULINH_ID            left join TT_NOITRU_TRATHUOC_CHITIET trt on (trt.TOATHUOC_ID = TT.TOATHUOC_ID)            left join TM_NHANVIEN NV on TT.NGUOITAO_ID = NV.NHANVIEN_ID            WHERE            CONVERT(date, KB.THOIGIANKHAM) BETWEEN  CONVERT(date, '9/20/2019 12:00:00 AM')  AND  CONVERT(date, '9/20/2019 12:00:00 AM')            AND TT.CHUNGTU_ID is null            AND BA.TRANGTHAI = 'DANGDIEUTRI'            AND TT.PHONGBANRATOA_ID = '62'             and               TT.KHOTAO_ID = '32'                         AND (            (tt.COSO = '0'            AND tt.PHIEULINH_ID IS NOT NULL            AND tt.TOATHUOC_ID IN            (SELECT ctct.TOATHUOCNOITRU_ID FROM TT_DUOC_CHUNGTU_CHITIET ctct            inner join TT_DUOC_CHUNGTU ct on ct.CHUNGTU_ID = ctct.CHUNGTU_ID            and ct.MUCDICHCHUNGTU_CODE = 'N05'            and ct.KHONHAP_ID =  '32'            )            )            or            (tt.COSO = '1')            )            AND TT.BENHVIEN_ID = 'HLU01'            AND (BN.TENBENHNHAN like N'%%' OR BN.MAYTE like N'%%'  OR  BA.SOBENHAN  like N'%%'            or D.TENDUOCDAYDU like N'%%'            OR PL.MACHUNGTU like '%%'            )            AND LD.LOAIVATTU_ID = 'V'            order by NGAYTAO DESC]
2019-09-20 16:47:08,577 [1] DEBUG - Statement Id: [DAO00030_XUATSUDUNG_KHAMBENH_NGOAITRU_VTYT] PreparedStatement : [SELECT            N'Người bệnh: ' + BN.MAYTE + ' - ' + BN.TENBENHNHAN + ' - ' + N'Số TN: ' + TN.SOTIEPNHAN  as BENHNHAN,            CASE WHEN BN.GIOITINH = 1 THEN 'Nam' WHEN BN.GIOITINH = 2 THEN N'Nữ' END  AS GIOITINH ,            CASE WHEN BN.NGAYSINH IS NOT NULL THEN CONVERT(VARCHAR(10), BN.NGAYSINH, 103) ELSE CONVERT(VARCHAR(10), BN.NAMSINH) END as NGAYSINH,            CASE WHEN dt.TENDOITUONG IS NOT NULL THEN dt.TENDOITUONG  ELSE '' END as DOITUONG,            N'VTYT Ngoại trú ngày: ' + CONVERT(VARCHAR(10), VT.NGAYTAO, 103) + ' - ' + CONVERT(VARCHAR(5), VT.NGAYTAO, 108)            + CASE WHEN NV.TENNHANVIEN IS NOT NULL THEN + N' - Người lập: ' +  NV.TENNHANVIEN ELSE '' END            AS YLENH,            VT.KHAMBENH_VTYT_ID as TOATHUOC_ID,            DV.DVYEUCAU_ID as REF_ID,            PL.MACHUNGTU,            VT.DUOC_ID,            d.MADUOC,            d.TENDUOCDAYDU,            d.DONVITINH,            VT.SOLUONG as SOLUONGYEUCAU,            VT.NGAYTAO            FROM            TT_NGOAITRU_KHAMBENH_VTYT VT            inner join TT_DVYEUCAU DV on DV.DVYEUCAU_ID = VT.DVYEUCAU_ID            inner join TT_BENHNHAN BN on DV.BENHNHAN_ID = BN.BENHNHAN_ID            inner join TT_TIEPNHAN TN on TN.TIEPNHAN_ID = DV.TIEPNHAN_ID            left join TM_DOITUONG dt on TN.DOITUONG_ID = dt.DOITUONG_ID            left join TM_NHANVIEN NV on VT.NGUOITAO_ID = NV.NHANVIEN_ID            inner join TM_DUOC D on D.DUOC_ID = VT.DUOC_ID            inner join TM_LOAIDUOC LD on LD.LOAIDUOC_ID = D.LOAIDUOC_ID            left join TT_DUOC_PHIEULINH PL on PL.CHUNGTU_ID = VT.PHIEULINH_ID            WHERE            CONVERT(date, VT.NGAYTAO) BETWEEN  CONVERT(date, '9/20/2019 12:00:00 AM')  AND  CONVERT(date, '9/20/2019 12:00:00 AM')            AND VT.CHUNGTU_ID is null            AND VT.PHONGBAN_ID = '62'                          AND VT.BENHVIEN_ID = 'HLU01'              AND (BN.TENBENHNHAN like N'%%' OR BN.MAYTE like N'%%'              OR  TN.SOTIEPNHAN  like N'%%' or D.TENDUOCDAYDU like N'%%'              OR PL.MACHUNGTU like '%%'              )              AND LD.LOAIVATTU_ID = 'V'              order by NGAYTAO DESC]
2019-09-20 16:47:08,682 [1] DEBUG - Statement Id: [DAO00030_XUATSUDUNG_PTTT_VTYT] PreparedStatement : [SELECT            N'Người bệnh: ' + BN.MAYTE + ' - ' + BN.TENBENHNHAN + ' - '  + N'Số TN: ' + TN.SOTIEPNHAN  as BENHNHAN,            CASE WHEN BN.GIOITINH = 1 THEN 'Nam' WHEN BN.GIOITINH = 2 THEN N'Nữ' END  AS GIOITINH,            CASE WHEN BN.NGAYSINH IS NOT NULL THEN CONVERT(VARCHAR(10), BN.NGAYSINH, 103) ELSE CONVERT(VARCHAR(10), BN.NAMSINH) END as NGAYSINH,            CASE WHEN dt.TENDOITUONG IS NOT NULL THEN dt.TENDOITUONG  ELSE '' END as DOITUONG,            CASE            WHEN PT.LOAI = 'P'THEN N'Số phiếu Phẫu thuật: ' +  ISNULL(PT.SOPHIEUPHAUTHUAT,'')  + N' - Ngày: ' +  CONVERT(VARCHAR(10), ISNULL(VT.NGAYTAO,''), 103) + ' - ' + CONVERT(VARCHAR(5), ISNULL(VT.NGAYTAO,''), 108) + CASE WHEN NV.TENNHANVIEN IS NOT NULL THEN + N' - Người lập: ' +  NV.TENNHANVIEN ELSE '' END            ELSE N'Số phiếu Thủ thuật: ' +  ISNULL(PT.SOPHIEUPHAUTHUAT,'')  + N' - Ngày: ' +  CONVERT(VARCHAR(10), ISNULL(VT.NGAYTAO,''), 103) + ' - ' + CONVERT(VARCHAR(5), ISNULL(VT.NGAYTAO,''), 108) + CASE WHEN NV.TENNHANVIEN IS NOT NULL THEN + N' - Người lập: ' +  NV.TENNHANVIEN ELSE '' END            END  AS YLENH,            VT.PHAUTHUAT_VTYT_ID as TOATHUOC_ID,            VT.PHAUTHUAT_ID as REF_ID,            PL.MACHUNGTU,            VT.DUOC_ID,            d.MADUOC,            d.TENDUOCDAYDU,            d.DONVITINH,            VT.SOLUONG as SOLUONGYEUCAU,            VT.NGAYTAO            FROM            TT_PHAUTHUAT_VTYT VT            inner join TT_PHAUTHUAT PT on PT.PHAUTHUAT_ID = VT.PHAUTHUAT_ID            left join TT_TIEPNHAN TN on TN.TIEPNHAN_ID = PT.TIEPNHAN_ID            left join TT_BENHNHAN BN on BN.BENHNHAN_ID = TN.BENHNHAN_ID            left join TM_DOITUONG dt on TN.DOITUONG_ID = dt.DOITUONG_ID            left join TM_DUOC D on D.DUOC_ID = VT.DUOC_ID            left join TM_LOAIDUOC LD on LD.LOAIDUOC_ID = D.LOAIDUOC_ID            left join TM_NHANVIEN NV on VT.NGUOITAO_ID = NV.NHANVIEN_ID            left join TT_DUOC_PHIEULINH PL on PL.CHUNGTU_ID = VT.CHUNGTU_ID            WHERE            CONVERT(date, VT.NGAYTAO) BETWEEN  CONVERT(date, '9/20/2019 12:00:00 AM')  AND  CONVERT(date, '9/20/2019 12:00:00 AM')            AND VT.CHUNGTU_ID is null                          AND PT.PHONGBANTHUCHIEN_ID = '62'              AND VT.BENHVIEN_ID = 'HLU01'              AND (BN.TENBENHNHAN like N'%%' OR BN.MAYTE like N'%%' OR  TN.SOTIEPNHAN  like N'%%' or D.TENDUOCDAYDU like N'%%'              OR PL.MACHUNGTU like '%%'              )              AND LD.LOAIVATTU_ID = 'V'              order by NGAYTAO DESC]
2019-09-20 16:47:08,761 [1] DEBUG - Statement Id: [DAO00030_XUATSUDUNG_CLS_VTYT] PreparedStatement : [SELECT            N'Người bệnh: ' + BN.MAYTE + ' - ' + BN.TENBENHNHAN + ' - '  + N'Số TN: ' + TN.SOTIEPNHAN  as BENHNHAN,            CASE WHEN BN.GIOITINH = 1 THEN 'Nam' WHEN BN.GIOITINH = 2 THEN N'Nữ' END  AS GIOITINH,            CASE WHEN BN.NGAYSINH IS NOT NULL THEN CONVERT(VARCHAR(10), BN.NGAYSINH, 103) ELSE CONVERT(VARCHAR(10), BN.NAMSINH) END as NGAYSINH,            CASE WHEN dt.TENDOITUONG IS NOT NULL THEN dt.TENDOITUONG  ELSE '' END as DOITUONG,            N'Số phiếu CLS: ' +  ISNULL(DV.SOPHIEUYEUCAU,'')  + N' - Ngày: ' +  CONVERT(VARCHAR(10), ISNULL(CLS_VT.NGAYTAO,''), 103) + ' - ' + CONVERT(VARCHAR(5), ISNULL(CLS_VT.NGAYTAO,''), 108) + CASE WHEN NV.TENNHANVIEN IS NOT NULL THEN + N' - Người lập: ' +  NV.TENNHANVIEN ELSE '' END            AS YLENH,            CLS_VT.CLSKETQUA_VTYT_ID as TOATHUOC_ID,            DV.DVYEUCAU_ID as REF_ID,            PL.MACHUNGTU,            CLS_VT.DUOC_ID,            d.MADUOC,            d.TENDUOCDAYDU,            d.DONVITINH,            CLS_VT.SOLUONG as SOLUONGYEUCAU,            CLS_VT.NGAYTAO            FROM            TT_CLSKETQUA_VTYT CLS_VT            inner join TT_DVYEUCAU DV on DV.DVYEUCAU_ID = CLS_VT.DVYEUCAU_ID            left join TT_CLSKETQUA CLS on CLS.CLSKETQUA_ID = CLS_VT.CLSKETQUA_ID            left join TT_BENHNHAN BN on DV.BENHNHAN_ID = BN.BENHNHAN_ID            left join TT_TIEPNHAN TN on TN.TIEPNHAN_ID = DV.TIEPNHAN_ID            left join TM_PHONGBAN pb on pb.PHONGBAN_ID = CLS_VT.PHONGBAN_ID            left join TM_DOITUONG dt on dt.DOITUONG_ID = DV.DOITUONG_ID            left join TM_NHANVIEN NV on NV.NHANVIEN_ID = CLS_VT.NGUOITAO_ID            left join TM_DUOC D on D.DUOC_ID = CLS_VT.DUOC_ID            left join TM_LOAIDUOC LD on LD.LOAIDUOC_ID = D.LOAIDUOC_ID            left join TT_DUOC_PHIEULINH PL on PL.CHUNGTU_ID = CLS_VT.CHUNGTU_ID            WHERE            CONVERT(date, CLS_VT.NGAYTAO) BETWEEN  CONVERT(date, '9/20/2019 12:00:00 AM')  AND  CONVERT(date, '9/20/2019 12:00:00 AM')            AND CLS_VT.CHUNGTU_ID is null                          AND CLS_VT.PHONGBAN_ID = '62'              AND CLS_VT.BENHVIEN_ID = 'HLU01'              AND (BN.TENBENHNHAN like N'%%' OR BN.MAYTE like N'%%' OR  TN.SOTIEPNHAN  like N'%%' or D.TENDUOCDAYDU like N'%%'              OR PL.MACHUNGTU like '%%'              )              AND LD.LOAIVATTU_ID = 'V'              order by NGAYTAO DESC]
2019-09-20 16:47:17,340 [1] DEBUG - Statement Id: [DAO00030_XUATSUDUNG_TOANOITRU] PreparedStatement : [SELECT            N'Người bệnh: ' + BN.MAYTE + ' - ' + BN.TENBENHNHAN + ' - '  + N'Bệnh án: ' + BA.SOBENHAN  as BENHNHAN,            CASE WHEN BN.GIOITINH = 1 THEN 'Nam' WHEN BN.GIOITINH = 2 THEN N'Nữ'  END  AS GIOITINH ,            CASE WHEN BN.NGAYSINH IS NOT NULL THEN CONVERT(VARCHAR(10), BN.NGAYSINH, 103) ELSE CONVERT(VARCHAR(10), BN.NAMSINH) END as NGAYSINH,            CASE WHEN dt.TENDOITUONG IS NOT NULL THEN dt.TENDOITUONG  ELSE '' END as DOITUONG,            N'Y lệnh:' + TT.SOTHUTUTOA + ' - Ngày: ' + CONVERT(VARCHAR(10), KB.THOIGIANKHAM, 103) + ' - ' + CONVERT(VARCHAR(5), KB.THOIGIANKHAM, 108)            + CASE WHEN NV.TENNHANVIEN IS NOT NULL THEN + N' - Người lập: ' +  NV.TENNHANVIEN ELSE '' END            AS YLENH,            TT.TOATHUOC_ID,            TT.SOTHUTUTOA as REF_ID,            PL.MACHUNGTU,            TT.DUOC_ID,            d.MADUOC,            d.TENDUOCDAYDU,            d.DONVITINH,            TT.SOLUONG as SOLUONGYEUCAU,            trt.SOLUONG as SOLUONGTRA,            TT.NGAYTAO            FROM            TT_NOITRU_TOATHUOC TT            inner join TT_NOITRU_KHAMBENH KB on KB.KHAMBENH_ID = TT.KHAMBENH_ID            inner join TT_NOITRU_BENHAN BA on BA.BENHAN_ID = KB.BENHAN_ID            inner join TT_BENHNHAN BN on BA.BENHNHAN_ID = BN.BENHNHAN_ID            inner join TM_DUOC D on D.DUOC_ID = TT.DUOC_ID            inner join TM_LOAIDUOC LD on LD.LOAIDUOC_ID = D.LOAIDUOC_ID            left join TM_DOITUONG dt on BA.DOITUONG_ID = dt.DOITUONG_ID            left join TT_DUOC_PHIEULINH PL on PL.CHUNGTU_ID = TT.PHIEULINH_ID            left join TT_NOITRU_TRATHUOC_CHITIET trt on (trt.TOATHUOC_ID = TT.TOATHUOC_ID)            left join TM_NHANVIEN NV on TT.NGUOITAO_ID = NV.NHANVIEN_ID            WHERE            CONVERT(date, KB.THOIGIANKHAM) BETWEEN  CONVERT(date, '2/1/2019 12:00:00 AM')  AND  CONVERT(date, '9/20/2019 12:00:00 AM')            AND TT.CHUNGTU_ID is null            AND BA.TRANGTHAI = 'DANGDIEUTRI'            AND TT.PHONGBANRATOA_ID = '62'             and               TT.KHOTAO_ID = '32'                         AND (            (tt.COSO = '0'            AND tt.PHIEULINH_ID IS NOT NULL            AND tt.TOATHUOC_ID IN            (SELECT ctct.TOATHUOCNOITRU_ID FROM TT_DUOC_CHUNGTU_CHITIET ctct            inner join TT_DUOC_CHUNGTU ct on ct.CHUNGTU_ID = ctct.CHUNGTU_ID            and ct.MUCDICHCHUNGTU_CODE = 'N05'            and ct.KHONHAP_ID =  '32'            )            )            or            (tt.COSO = '1')            )            AND TT.BENHVIEN_ID = 'HLU01'            AND (BN.TENBENHNHAN like N'%%' OR BN.MAYTE like N'%%'  OR  BA.SOBENHAN  like N'%%'            or D.TENDUOCDAYDU like N'%%'            OR PL.MACHUNGTU like '%%'            )            AND LD.LOAIVATTU_ID = 'V'            order by NGAYTAO DESC]
2019-09-20 16:47:17,760 [1] DEBUG - Statement Id: [DAO00030_XUATSUDUNG_KHAMBENH_NGOAITRU_VTYT] PreparedStatement : [SELECT            N'Người bệnh: ' + BN.MAYTE + ' - ' + BN.TENBENHNHAN + ' - ' + N'Số TN: ' + TN.SOTIEPNHAN  as BENHNHAN,            CASE WHEN BN.GIOITINH = 1 THEN 'Nam' WHEN BN.GIOITINH = 2 THEN N'Nữ' END  AS GIOITINH ,            CASE WHEN BN.NGAYSINH IS NOT NULL THEN CONVERT(VARCHAR(10), BN.NGAYSINH, 103) ELSE CONVERT(VARCHAR(10), BN.NAMSINH) END as NGAYSINH,            CASE WHEN dt.TENDOITUONG IS NOT NULL THEN dt.TENDOITUONG  ELSE '' END as DOITUONG,            N'VTYT Ngoại trú ngày: ' + CONVERT(VARCHAR(10), VT.NGAYTAO, 103) + ' - ' + CONVERT(VARCHAR(5), VT.NGAYTAO, 108)            + CASE WHEN NV.TENNHANVIEN IS NOT NULL THEN + N' - Người lập: ' +  NV.TENNHANVIEN ELSE '' END            AS YLENH,            VT.KHAMBENH_VTYT_ID as TOATHUOC_ID,            DV.DVYEUCAU_ID as REF_ID,            PL.MACHUNGTU,            VT.DUOC_ID,            d.MADUOC,            d.TENDUOCDAYDU,            d.DONVITINH,            VT.SOLUONG as SOLUONGYEUCAU,            VT.NGAYTAO            FROM            TT_NGOAITRU_KHAMBENH_VTYT VT            inner join TT_DVYEUCAU DV on DV.DVYEUCAU_ID = VT.DVYEUCAU_ID            inner join TT_BENHNHAN BN on DV.BENHNHAN_ID = BN.BENHNHAN_ID            inner join TT_TIEPNHAN TN on TN.TIEPNHAN_ID = DV.TIEPNHAN_ID            left join TM_DOITUONG dt on TN.DOITUONG_ID = dt.DOITUONG_ID            left join TM_NHANVIEN NV on VT.NGUOITAO_ID = NV.NHANVIEN_ID            inner join TM_DUOC D on D.DUOC_ID = VT.DUOC_ID            inner join TM_LOAIDUOC LD on LD.LOAIDUOC_ID = D.LOAIDUOC_ID            left join TT_DUOC_PHIEULINH PL on PL.CHUNGTU_ID = VT.PHIEULINH_ID            WHERE            CONVERT(date, VT.NGAYTAO) BETWEEN  CONVERT(date, '2/1/2019 12:00:00 AM')  AND  CONVERT(date, '9/20/2019 12:00:00 AM')            AND VT.CHUNGTU_ID is null            AND VT.PHONGBAN_ID = '62'                          AND VT.BENHVIEN_ID = 'HLU01'              AND (BN.TENBENHNHAN like N'%%' OR BN.MAYTE like N'%%'              OR  TN.SOTIEPNHAN  like N'%%' or D.TENDUOCDAYDU like N'%%'              OR PL.MACHUNGTU like '%%'              )              AND LD.LOAIVATTU_ID = 'V'              order by NGAYTAO DESC]
2019-09-20 16:47:18,376 [1] DEBUG - Statement Id: [DAO00030_XUATSUDUNG_PTTT_VTYT] PreparedStatement : [SELECT            N'Người bệnh: ' + BN.MAYTE + ' - ' + BN.TENBENHNHAN + ' - '  + N'Số TN: ' + TN.SOTIEPNHAN  as BENHNHAN,            CASE WHEN BN.GIOITINH = 1 THEN 'Nam' WHEN BN.GIOITINH = 2 THEN N'Nữ' END  AS GIOITINH,            CASE WHEN BN.NGAYSINH IS NOT NULL THEN CONVERT(VARCHAR(10), BN.NGAYSINH, 103) ELSE CONVERT(VARCHAR(10), BN.NAMSINH) END as NGAYSINH,            CASE WHEN dt.TENDOITUONG IS NOT NULL THEN dt.TENDOITUONG  ELSE '' END as DOITUONG,            CASE            WHEN PT.LOAI = 'P'THEN N'Số phiếu Phẫu thuật: ' +  ISNULL(PT.SOPHIEUPHAUTHUAT,'')  + N' - Ngày: ' +  CONVERT(VARCHAR(10), ISNULL(VT.NGAYTAO,''), 103) + ' - ' + CONVERT(VARCHAR(5), ISNULL(VT.NGAYTAO,''), 108) + CASE WHEN NV.TENNHANVIEN IS NOT NULL THEN + N' - Người lập: ' +  NV.TENNHANVIEN ELSE '' END            ELSE N'Số phiếu Thủ thuật: ' +  ISNULL(PT.SOPHIEUPHAUTHUAT,'')  + N' - Ngày: ' +  CONVERT(VARCHAR(10), ISNULL(VT.NGAYTAO,''), 103) + ' - ' + CONVERT(VARCHAR(5), ISNULL(VT.NGAYTAO,''), 108) + CASE WHEN NV.TENNHANVIEN IS NOT NULL THEN + N' - Người lập: ' +  NV.TENNHANVIEN ELSE '' END            END  AS YLENH,            VT.PHAUTHUAT_VTYT_ID as TOATHUOC_ID,            VT.PHAUTHUAT_ID as REF_ID,            PL.MACHUNGTU,            VT.DUOC_ID,            d.MADUOC,            d.TENDUOCDAYDU,            d.DONVITINH,            VT.SOLUONG as SOLUONGYEUCAU,            VT.NGAYTAO            FROM            TT_PHAUTHUAT_VTYT VT            inner join TT_PHAUTHUAT PT on PT.PHAUTHUAT_ID = VT.PHAUTHUAT_ID            left join TT_TIEPNHAN TN on TN.TIEPNHAN_ID = PT.TIEPNHAN_ID            left join TT_BENHNHAN BN on BN.BENHNHAN_ID = TN.BENHNHAN_ID            left join TM_DOITUONG dt on TN.DOITUONG_ID = dt.DOITUONG_ID            left join TM_DUOC D on D.DUOC_ID = VT.DUOC_ID            left join TM_LOAIDUOC LD on LD.LOAIDUOC_ID = D.LOAIDUOC_ID            left join TM_NHANVIEN NV on VT.NGUOITAO_ID = NV.NHANVIEN_ID            left join TT_DUOC_PHIEULINH PL on PL.CHUNGTU_ID = VT.CHUNGTU_ID            WHERE            CONVERT(date, VT.NGAYTAO) BETWEEN  CONVERT(date, '2/1/2019 12:00:00 AM')  AND  CONVERT(date, '9/20/2019 12:00:00 AM')            AND VT.CHUNGTU_ID is null                          AND PT.PHONGBANTHUCHIEN_ID = '62'              AND VT.BENHVIEN_ID = 'HLU01'              AND (BN.TENBENHNHAN like N'%%' OR BN.MAYTE like N'%%' OR  TN.SOTIEPNHAN  like N'%%' or D.TENDUOCDAYDU like N'%%'              OR PL.MACHUNGTU like '%%'              )              AND LD.LOAIVATTU_ID = 'V'              order by NGAYTAO DESC]
2019-09-20 16:47:18,764 [1] DEBUG - Statement Id: [DAO00030_XUATSUDUNG_CLS_VTYT] PreparedStatement : [SELECT            N'Người bệnh: ' + BN.MAYTE + ' - ' + BN.TENBENHNHAN + ' - '  + N'Số TN: ' + TN.SOTIEPNHAN  as BENHNHAN,            CASE WHEN BN.GIOITINH = 1 THEN 'Nam' WHEN BN.GIOITINH = 2 THEN N'Nữ' END  AS GIOITINH,            CASE WHEN BN.NGAYSINH IS NOT NULL THEN CONVERT(VARCHAR(10), BN.NGAYSINH, 103) ELSE CONVERT(VARCHAR(10), BN.NAMSINH) END as NGAYSINH,            CASE WHEN dt.TENDOITUONG IS NOT NULL THEN dt.TENDOITUONG  ELSE '' END as DOITUONG,            N'Số phiếu CLS: ' +  ISNULL(DV.SOPHIEUYEUCAU,'')  + N' - Ngày: ' +  CONVERT(VARCHAR(10), ISNULL(CLS_VT.NGAYTAO,''), 103) + ' - ' + CONVERT(VARCHAR(5), ISNULL(CLS_VT.NGAYTAO,''), 108) + CASE WHEN NV.TENNHANVIEN IS NOT NULL THEN + N' - Người lập: ' +  NV.TENNHANVIEN ELSE '' END            AS YLENH,            CLS_VT.CLSKETQUA_VTYT_ID as TOATHUOC_ID,            DV.DVYEUCAU_ID as REF_ID,            PL.MACHUNGTU,            CLS_VT.DUOC_ID,            d.MADUOC,            d.TENDUOCDAYDU,            d.DONVITINH,            CLS_VT.SOLUONG as SOLUONGYEUCAU,            CLS_VT.NGAYTAO            FROM            TT_CLSKETQUA_VTYT CLS_VT            inner join TT_DVYEUCAU DV on DV.DVYEUCAU_ID = CLS_VT.DVYEUCAU_ID            left join TT_CLSKETQUA CLS on CLS.CLSKETQUA_ID = CLS_VT.CLSKETQUA_ID            left join TT_BENHNHAN BN on DV.BENHNHAN_ID = BN.BENHNHAN_ID            left join TT_TIEPNHAN TN on TN.TIEPNHAN_ID = DV.TIEPNHAN_ID            left join TM_PHONGBAN pb on pb.PHONGBAN_ID = CLS_VT.PHONGBAN_ID            left join TM_DOITUONG dt on dt.DOITUONG_ID = DV.DOITUONG_ID            left join TM_NHANVIEN NV on NV.NHANVIEN_ID = CLS_VT.NGUOITAO_ID            left join TM_DUOC D on D.DUOC_ID = CLS_VT.DUOC_ID            left join TM_LOAIDUOC LD on LD.LOAIDUOC_ID = D.LOAIDUOC_ID            left join TT_DUOC_PHIEULINH PL on PL.CHUNGTU_ID = CLS_VT.CHUNGTU_ID            WHERE            CONVERT(date, CLS_VT.NGAYTAO) BETWEEN  CONVERT(date, '2/1/2019 12:00:00 AM')  AND  CONVERT(date, '9/20/2019 12:00:00 AM')            AND CLS_VT.CHUNGTU_ID is null                          AND CLS_VT.PHONGBAN_ID = '62'              AND CLS_VT.BENHVIEN_ID = 'HLU01'              AND (BN.TENBENHNHAN like N'%%' OR BN.MAYTE like N'%%' OR  TN.SOTIEPNHAN  like N'%%' or D.TENDUOCDAYDU like N'%%'              OR PL.MACHUNGTU like '%%'              )              AND LD.LOAIVATTU_ID = 'V'              order by NGAYTAO DESC]
2019-09-20 16:47:18,871 [1] DEBUG - Statement Id: [DAO00030_DUOCTONKHO_GetSoTonTheoDuoc] PreparedStatement : [SELECT              DUOC_ID,              SUM(SOLUONG) AS TONGTON              FROM              TT_DUOC_TONKHO              WHERE              KHODUOC_ID = '32'              and BENHVIEN_ID = 'HLU01'              and DUOC_ID IN (1,11,305,305,1,572,305,11,512,6,14,71,1,3,69,305,3)              GROUP BY DUOC_ID]
2019-09-20 16:48:34,539 [1] DEBUG - Statement Id: [DAO00030_GetMucDichChungTuID] PreparedStatement : [SELECT DICTIONARY_ID              FROM              LST_DICTIONARY              WHERE              DICTIONARY_TYPE_CODE = 'MucDichChungTu'              and DICTIONARY_CODE = 'X13']
2019-09-20 16:48:35,778 [1] DEBUG - Statement Id: [DAO00020_ListKhoDuocOfPhongBan] PreparedStatement : [select B.* from TM_PHONGBAN_KHODUOC A        inner join TM_KHODUOC B on B.KHODUOC_ID = A.KHODUOC_ID        where        A.PHONGBAN_ID = ''        and A.BENHVIEN_ID = 'HLU01']
2019-09-20 16:48:36,110 [1] DEBUG - Statement Id: [DAO00020_ListKhoDuocOfPhongBan] PreparedStatement : [select B.* from TM_PHONGBAN_KHODUOC A        inner join TM_KHODUOC B on B.KHODUOC_ID = A.KHODUOC_ID        where        A.PHONGBAN_ID = '62'        and A.BENHVIEN_ID = 'HLU01']
2019-09-20 16:48:39,459 [1] DEBUG - Statement Id: [DAO00020_ListKhoDuocOfPhongBan] PreparedStatement : [select B.* from TM_PHONGBAN_KHODUOC A        inner join TM_KHODUOC B on B.KHODUOC_ID = A.KHODUOC_ID        where        A.PHONGBAN_ID = '58'        and A.BENHVIEN_ID = 'HLU01']
2019-09-20 16:48:39,604 [1] DEBUG - Statement Id: [DAO00008_UpdateUserIdPhongBanKhoDuoc] PreparedStatement : [IF EXISTS            (SELECT ACCOUNT_ID FROM TM_SYS_USERS WHERE ACCOUNT_ID =  @param0  and HOSPITAL_ID =  @param1 )            BEGIN            update TM_SYS_USERS set INVENTORY_ID =  @param2 , WORKING_DEPT_ID =  @param3             WHERE ACCOUNT_ID =  @param0  and HOSPITAL_ID =  @param1             END            ELSE            BEGIN            insert into TM_SYS_USERS ([ACCOUNT_ID], [ACCOUNT_NAME], [INVENTORY_ID], [WORKING_DEPT_ID], [HOSPITAL_ID])            values ( @param0 ,  @param4 ,  @param2 ,  @param3 ,  @param1 )            END]
2019-09-20 16:48:39,604 [1] DEBUG - Statement Id: [DAO00008_UpdateUserIdPhongBanKhoDuoc] Parameters: [@param0=[ACCOUNT_ID,113], @param1=[HOSPITAL_ID,HLU01], @param2=[INVENTORY_ID,null], @param3=[WORKING_DEPT_ID,58], @param4=[ACCOUNT_NAME,admin]]
2019-09-20 16:48:39,604 [1] DEBUG - Statement Id: [DAO00008_UpdateUserIdPhongBanKhoDuoc] Types: [@param0=[String, System.String], @param1=[String, System.String], @param2=[System.DBNull, null], @param3=[String, System.String], @param4=[String, System.String]]
2019-09-20 16:48:43,427 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'OPD22'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2019-09-20 16:48:44,135 [1] DEBUG - Statement Id: [DAO00019_GetDanhsachKhambenh] PreparedStatement : [select *        from        (SELECT COUNT(*) OVER() as TOTALROWS, ROW_NUMBER() OVER(order by isnull(dv.SOTHUTU,'999999999'), dv.NGAYGIOYEUCAU) as ROWNUMBER,        bn.MAYTE, bn.TENBENHNHAN, bn.NAMSINH, bn.NGAYSINH as TUOI, ISNULL(CONVERT(VARCHAR(10), bn.NGAYSINH, 103),CAST(bn.NAMSINH AS varchar)) as NGAYSINH, bn.DIACHILIENLAC as DIACHI, bn.GIOITINH, GD.DESCRIPTION as TENGIOITINH,        tn.DOITUONG_ID, tn.THOIGIANTIEPNHAN, tn.BENHNHAN_ID, tn.TIEPNHAN_ID, tn.TRAITUYEN, tn.SOTIEPNHAN,        dv.DICHVU_ID, dv.NOITHUCHIEN_ID, isnull(dv.NGAYTAO, dv.NGAYCAPNHAT) as THOIGIANDKDICHVU,        dv.KHAN, dv.NOIYEUCAU_ID, dv.NGAYGIOYEUCAU, dv.BACSICHIDINH_ID, dv.DONVIGIOITHIEU_ID, dv.NGUOIGIOITHIEU_ID,        tn.NOIGIOITHIEU_ID, kbnt.HUONGGIAIQUYET_ID,        dv.DVYEUCAU_ID, dv.MARIS, dv.TRANGTHAI as TRANGTHAICODE, B.TENNHOMDICHVU, dv.SOPHIEUYEUCAU, dv.KHAMBENH_NGOAITRU_ID, dv.NGUOICAPNHAT_ID, dv.NGAYCAPNHAT,        CASE WHEN Left(B.MANHOMDICHVU,2) = '03' THEN '02' ELSE Left(B.MANHOMDICHVU,2) END AS MANHOMDICHVU, B.MANHOMDICHVU as MANHOMDICHVUCHITIET, tn.TRANGTHAI as TRANGTHAI_TIEPNHAN,        'False' as DAKHAM, isnull(dv.SOTHUTU,'999999999') as SOHANGDOI,        vp.DATHANHTOAN, dv.TRANGTHAI_WFL,        BA.SOBENHAN, dv.CHANDOAN, dt.TENDOITUONG, isnull(kbnt.THOIGIANKHAM, dv.NGAYCAPNHAT) as THOIGIANKHAM,        tn.SOBHYT        FROM TT_DVYEUCAU (NOLOCK) dv        inner join TT_TIEPNHAN (NOLOCK) tn on dv.TIEPNHAN_ID = tn.TIEPNHAN_ID        inner join TT_BENHNHAN (NOLOCK) bn on tn.BENHNHAN_ID = bn.BENHNHAN_ID        inner join TM_DICHVU A on A.DICHVU_ID = dv.DICHVU_ID        inner join TM_NHOMDICHVU B on B.NHOMDICHVU_ID = A.NHOMDICHVU_ID        inner join TT_VIENPHI(NOLOCK) VP on VP.TIEPNHAN_ID = tn.TIEPNHAN_ID and VP.DICHVU_ID = dv.DICHVU_ID and VP.REF_ID = dv.DVYEUCAU_ID        left join TT_NOITRU_BENHAN (NOLOCK) BA on BA.TIEPNHAN_ID = tn.TIEPNHAN_ID AND dv.BENHAN_ID = BA.BENHAN_ID        inner join TM_GENDER GD on GD.ID = bn.GIOITINH        left join TT_NGOAITRU_KHAMBENH (NOLOCK) kbnt on kbnt.KHAMBENH_ID = dv.KHAMBENH_NGOAITRU_ID        inner join TM_DOITUONG dt on dt.DOITUONG_ID = tn.DOITUONG_ID        where        dv.DICHVU_ID IS NOT NULL        and tn.BENHVIEN_ID = 'HLU01'        and HUYYEUCAU = 0        and dv.NGAYHENCLS is NULL         and           dv.NGAYYEUCAU >= '9/20/2019 12:00:00 AM'         and           dv.NGAYYEUCAU <= '9/20/2019 12:00:00 AM'         and           dv.NOITHUCHIEN_ID = 58          AND             (                         ((dv.TRANGTHAI_WFL = 'CHUAKETQUA' or (dv.TRANGTHAI = 'CHUAKETQUA' and dv.TRANGTHAI_WFL = 'HOANTHANH')) and (isnull(kbnt.HUONGGIAIQUYET_ID, 0) = 0)))            and (tn.TRANGTHAI != 'HOANTHANH')           and           (CASE WHEN Left(B.MANHOMDICHVU,2) = '03' THEN '02' ELSE Left(B.MANHOMDICHVU,2) END) = '04'                 ) lst                    where          lst.ROWNUMBER between 1 and 20                 order by SOHANGDOI, NGAYGIOYEUCAU asc]
2019-09-20 16:48:52,426 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'BIL09'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2019-09-20 16:48:52,832 [1] DEBUG - Statement Id: [DAO00031_GetList] PreparedStatement : [select *              from TM_DOITUONG              where ACTIVE = 1 and BENHVIEN_ID = 'HLU01'               and                   MADOITUONG like '%BHYT%']
2019-09-20 16:48:53,543 [1] DEBUG - Statement Id: [DAO00064_GetListBenhNhan] PreparedStatement : [select * from        (        select *, COUNT(*) OVER() as TOTALROWS,  ROW_NUMBER() OVER(order by lst.SOTIEPNHAN desc) as ROWNUMBER        from        (select distinct        B.SOBHYT, B.NGAYTIEPNHAN , B.THOIGIANTIEPNHAN as NGAYVAO, B.SOTIEPNHAN, B.DOITUONG_ID, B.TIEPNHAN_ID, B.GHICHU_KHOADULIEU,        C.MAYTE as MABN, C.TENBENHNHAN as TENBN, C.NAMSINH , C.BENHNHAN_ID, B.BENHVIEN_ID,        D.XACNHANCHIPHI_ID, D.NGAYXACNHAN, C.SONHA as DIACHITHUONGTRU, isnull(C.SONHA, C.DIACHITHUONGTRU) AS DIACHILIENLAC, PB.TENPHONGBAN        from TT_TIEPNHAN B        inner join TT_BENHNHAN C on B.BENHNHAN_ID = C.BENHNHAN_ID        left join TT_XACNHANCHIPHI D on D.TIEPNHAN_ID = B.TIEPNHAN_ID        left join (        select tn.TIEPNHAN_ID, max(kb.KHAMBENH_ID) AS KHAMBENH_ID        from TT_TIEPNHAN TN        inner join TT_NGOAITRU_KHAMBENH kb on kb.TIEPNHAN_ID = tn.TIEPNHAN_ID and kb.BENHVIEN_ID = tn.BENHVIEN_ID        where 1=1         and           TN.NGAYTIEPNHAN >= '9/20/2019 12:00:00 AM'         and           TN.NGAYTIEPNHAN <= '9/20/2019 4:48:53 PM'                 group by tn.TIEPNHAN_ID        ) E on E.TIEPNHAN_ID = B.TIEPNHAN_ID        left join TT_NGOAITRU_KHAMBENH kb on kb.KHAMBENH_ID = E.KHAMBENH_ID        left join TM_PHONGBAN PB on PB.PHONGBAN_ID = KB.PHONGBAN_ID        where        (not exists (select TIEPNHAN_ID from TT_NOITRU_BENHAN where TIEPNHAN_ID = B.TIEPNHAN_ID)) and        (B.SOBHYT is not null and B.SOBHYT != '') and        (B.TRANGTHAI = 'DATIEPNHAN' or B.TRANGTHAI = 'HOANTHANH' ) and C.MAYTE is not null         and           B.NGAYTIEPNHAN >= '9/20/2019 12:00:00 AM'         and           B.NGAYTIEPNHAN <= '9/20/2019 4:48:53 PM'                 and B.BENHVIEN_ID = 'HLU01'                 ) lst        ) ds                    where          ds.ROWNUMBER between 1 and 20]
2019-09-20 16:48:53,719 [1] DEBUG - Statement Id: [DAO00064_GetThongtinKhambenh] PreparedStatement : [select top 1 pb.TENPHONGBAN, nv.TENNHANVIEN        from TT_NGOAITRU_KHAMBENH A        left join TT_DVYEUCAU B on A.KHAMBENH_ID = B.KHAMBENH_NGOAITRU_ID        left join TM_NHANVIEN nv on nv.NHANVIEN_ID = A.BACSIKHAM_ID        left join TM_PHONGBAN pb on pb.PHONGBAN_ID = B.NOITHUCHIEN_ID        where A.TIEPNHAN_ID = '27478']
2019-09-20 16:48:55,336 [1] DEBUG - Statement Id: [DAO00014_GetPatientStatusXacNhanChiPhi] PreparedStatement : [select        tn.TRANGTHAI as TRANGTHAI        from TT_TIEPNHAN tn        where tn.TIEPNHAN_ID = '27478'        and tn.BENHVIEN_ID = 'HLU01']
2019-09-20 16:48:55,439 [1] DEBUG - Statement Id: [DAO00064_TT_NGOAITRU_KHAMBENH_TOATHUOC_GetListToaThuocBHYT] PreparedStatement : [select * from TT_NGOAITRU_KHAMBENH_TOATHUOC        where (exists (select KHAMBENH_NGOAITRU_ID from TT_DVYEUCAU where TT_NGOAITRU_KHAMBENH_TOATHUOC.KHAMBENH_ID = KHAMBENH_NGOAITRU_ID and TIEPNHAN_ID = '27478')) and TIEPNHAN_ID = '27478' and LOAITOATHUOC = 'BV']
2019-09-20 16:48:55,473 [1] DEBUG - Statement Id: [DAO00064_GetVienphiTiepNhan_BIL09_DaBHYT] PreparedStatement : [select distinct case when YC.DVYEUCAU_ID is not null then YC.TRANGTHAI        when KBTT.KHAMBENH_TOATHUOC_ID is not null then KBTT.TRANGTHAI        when PT.PHAUTHUAT_VTYT_ID is not null then case when PT.CHUNGTU_ID is not null then 'DAXUAT' else 'CHUAXUAT' end        when VTYT.KHAMBENH_VTYT_ID is not null then case when VTYT.CHUNGTU_ID is not null then 'DAXUAT' else 'CHUAXUAT' end        when kqvtyt.CLSKETQUA_VTYT_ID is not null then case when kqvtyt.TRANGTHAI is not null then 'DAXUAT' else 'CHUAXUAT' end        else '' end as TRANGTHAI        , YC.NOITHUCHIEN_ID as PHONGBAN_ID, KB.NGAYKHAM,        XNCT.NOIDUNG_ID, VP.REF_ID as IDREF, XNCT.VIENPHI_ID,        VP.SOLUONG as SOLUONG, VP.SOLUONG as SOLUONG_NEW, VP.DICHVU_ID, VP.DUOC_ID, VP.BHYT_DONGIA_CHITRA,        VP.DONGIA_DOANHTHU, VP.DONGIA_DOANHTHU as DONGIADOANHTHU, VP.BHYT_DONGIA as DONGIAHOTRO, VP.BHYT_THANHTIEN_CHITRA as DONGIAHOTROCHITRA, VP.BHYT_DONGIA_CHITRA as DONGIAHOTROCHITRA_NEW,        VP.REF_TABLE as LOAI, VP.BHYT_DONGIA, VP.BHYT_THANHTIEN, VP.BHYT_THANHTIEN_CHITRA, VP.BENHNHAN_PHAITHANHTOAN, VP.GIATRI_BENHNHAN_DATHANHTOAN, VP.BENHVIEN_ID, VP.THANHTIEN_DOANHTHU,        VP.LOAI_CHIPHI, VP.LOAIGIA_ID, REF_TABLE, VP.KHAMBENH_ID, VP.REF_ID, VP.DUOCPHEPTHUCHIEN,        VP.HUY, VP.KHONGTHUTIEN, VP.DATHANHTOAN, VP.HOADON_ID, VP.ACTIVE, YC.DVYEUCAU_ID, YC.NGAYYEUCAU, ISNULL(YC.BACSICHIDINH_ID, YC.NGUOIGIOITHIEU_ID) as BACSICHIDINH_ID, YC.NOIYEUCAU_ID        , VP.DATHUCHIEN,        isnull(dv.TENDICHVU, dc.TENDUOCDAYDU) NOIDUNG, isnull(dv.MADICHVU, dc.MADUOC) MADICHVU, dv.NORESULT, dc.DONVITINH, ld.MALOAIDUOC, dc.BHYT DUOC_BHYT, ld.LOAIVATTU_ID,        ndv.MANHOMDICHVU, KB.KBHUONGGIAIQUYET NOIDUNG2        from TT_XACNHANCHIPHI XN        inner join TT_XACNHANCHIPHICHITIET XNCT on XNCT.XACNHANCHIPHI_ID = XN.XACNHANCHIPHI_ID and XNCT.BENHVIEN_ID = XN.BENHVIEN_ID        inner join TT_VIENPHI VP on VP.VIENPHI_ID = XNCT.VIENPHI_ID and VP.BENHVIEN_ID = XNCT.BENHVIEN_ID        left join TT_DVYEUCAU YC on YC.BENHVIEN_ID = VP.BENHVIEN_ID and YC.DVYEUCAU_ID = VP.REF_ID and VP.REF_TABLE = 'TT_DVYEUCAU'        left join TT_NGOAITRU_TOATHUOC TT on TT.BENHVIEN_ID = VP.BENHVIEN_ID and TT.TOATHUOC_ID = VP.REF_ID and VP.REF_TABLE = 'TT_NGOAITRU_TOATHUOC'        left join TT_NGOAITRU_KHAMBENH_TOATHUOC KBTT on KBTT.BENHVIEN_ID = TT.BENHVIEN_ID and KBTT.KHAMBENH_TOATHUOC_ID = TT.KHAMBENH_TOATHUOC_ID        left join TT_NGOAITRU_KHAMBENH_VTYT VTYT on VTYT.BENHVIEN_ID = VP.BENHVIEN_ID and VTYT.KHAMBENH_VTYT_ID = VP.REF_ID and VP.REF_TABLE = 'TT_NGOAITRU_KHAMBENH_VTYT'        left join TT_PHAUTHUAT_VTYT PT on PT.BENHVIEN_ID = VP.BENHVIEN_ID and PT.PHAUTHUAT_VTYT_ID = VP.REF_ID and VP.REF_TABLE = 'TT_PHAUTHUAT_VTYT'        left join (        select pb.TENPHONGBAN + ' - ' + nv.TENNHANVIEN + ' - '+ hgq.DICTIONARY_NAME KBHUONGGIAIQUYET, kb.* from TT_NGOAITRU_KHAMBENH kb        left join TM_PHONGBAN pb on pb.PHONGBAN_ID = kb.PHONGBAN_ID        left join TM_NHANVIEN nv on nv.NHANVIEN_ID = kb.BACSIKHAM_ID        left join (select * from LST_DICTIONARY where DICTIONARY_TYPE_CODE = 'GiaiQuyetKhamBenh') hgq on hgq.DICTIONARY_ID = kb.HUONGGIAIQUYET_ID        ) KB on KB.TIEPNHAN_ID = XN.TIEPNHAN_ID and KB.DICHVU_ID = VP.DICHVU_ID and YC.KHAMBENH_NGOAITRU_ID = KB.KHAMBENH_ID        left join TT_CLSKETQUA_VTYT kqvtyt on kqvtyt.CLSKETQUA_VTYT_ID = VP.REF_ID and VP.REF_TABLE = 'TT_CLSKETQUA_VTYT'        left join TM_DICHVU dv on VP.DICHVU_ID = dv.DICHVU_ID and VP.REF_TABLE = 'TT_DVYEUCAU'        left join TM_DUOC dc on VP.DUOC_ID = dc.DUOC_ID        left join TM_LOAIDUOC ld on dc.LOAIDUOC_ID = ld.LOAIDUOC_ID        left join TM_NHOMDICHVU ndv on ndv.NHOMDICHVU_ID = dv.NHOMDICHVU_ID        where XN.TIEPNHAN_ID = '27478' and XN.BENHVIEN_ID = 'HLU01'        ORDER BY XNCT.VIENPHI_ID]
2019-09-20 16:48:56,671 [1] DEBUG - Statement Id: [DAO00066_GetNhapVienById] PreparedStatement : [select *        from TT_NOITRU_NHAPVIEN        where TT_NOITRU_NHAPVIEN.TIEPNHAN_ID  = '27478' and TT_NOITRU_NHAPVIEN.TRANGTHAI = 'CHOXACNHAN' and TT_NOITRU_NHAPVIEN.LOAIBENHAN != 2        order by NHAPVIEN_ID desc]
2019-09-20 16:48:56,769 [1] DEBUG - Statement Id: [DAO00064_CheckBenhNhanChuaXSDVTYT] PreparedStatement : [IF EXISTS (        select vt.KHAMBENH_VTYT_ID        from TT_NGOAITRU_KHAMBENH_VTYT vt        inner join TT_NGOAITRU_KHAMBENH kb on kb.KHAMBENH_ID = vt.KHAMBENH_ID        where kb.TIEPNHAN_ID = 27478        and kb.BENHVIEN_ID = 'HLU01'        and vt.CHUNGTU_ID is null          union all          select vt.CLSKETQUA_VTYT_ID        from TT_CLSKETQUA_VTYT vt        inner join TT_DVYEUCAU yc on yc.DVYEUCAU_ID = vt.DVYEUCAU_ID and yc.BENHVIEN_ID = vt.BENHVIEN_ID        where yc.TIEPNHAN_ID = 27478        and yc.BENHVIEN_ID = 'HLU01'        and vt.CHUNGTU_ID is null        )        BEGIN        SELECT -1 AS RESULT        END        ELSE        BEGIN        SELECT 1 AS RESULT        END]
2019-09-20 16:48:59,525 [1] DEBUG - Statement Id: [DAO00064_TT_NGOAITRU_KHAMBENH_TOATHUOC_GetListToaThuocBHYT] PreparedStatement : [select * from TT_NGOAITRU_KHAMBENH_TOATHUOC        where (exists (select KHAMBENH_NGOAITRU_ID from TT_DVYEUCAU where TT_NGOAITRU_KHAMBENH_TOATHUOC.KHAMBENH_ID = KHAMBENH_NGOAITRU_ID and TIEPNHAN_ID = '27478')) and TIEPNHAN_ID = '27478' and LOAITOATHUOC = 'BV']
2019-09-20 16:48:59,779 [1] DEBUG - Statement Id: [DAO00058_GetDanhsachCHungtuToathuocNgoaitruBHYT] PreparedStatement : [select A.TOATHUOCNGOAITRU_ID, A.SOLUONGDAXUAT, A.DUOC_ID, A.NGUONHANG_ID NGUONDUOC_ID, B.KHOXUAT_ID, A.CHUNGTU_ID,          A.SOLONHAP_ID, B.TIEPNHAN_ID, A.CHUNGTUCHITIET_ID          from TT_DUOC_CHUNGTU_CHITIET A          left join TT_DUOC_CHUNGTU B on A.CHUNGTU_ID = B.CHUNGTU_ID          join TT_NGOAITRU_KHAMBENH_TOATHUOC tt on tt.CHUNGTUPHATTHUOC_ID = B.CHUNGTU_ID and tt.LOAITOATHUOC = 'BV'          where B.TIEPNHAN_ID =  @param0]
2019-09-20 16:48:59,779 [1] DEBUG - Statement Id: [DAO00058_GetDanhsachCHungtuToathuocNgoaitruBHYT] Parameters: [@param0=[TIEPNHAN_ID,27478]]
2019-09-20 16:48:59,779 [1] DEBUG - Statement Id: [DAO00058_GetDanhsachCHungtuToathuocNgoaitruBHYT] Types: [@param0=[Int64, System.Int64]]
2019-09-20 16:49:00,085 [1] DEBUG - Statement Id: [DAO00058_DuyetOrHuyDuyetToathuocNgoaitruBHYT] PreparedStatement : [update TT_NGOAITRU_KHAMBENH_TOATHUOC              set DUYET = '0'              , NGAYDUYET =  @param0               , THOIGIANDUYET =  @param1               , NGUOIDUYET_ID =  @param2               where TIEPNHAN_ID = '27478' and LOAITOATHUOC ='BV'                            update TT_VIENPHI              set DUYET = '0'              FROM              TT_VIENPHI VP              WHERE VP.TIEPNHAN_ID = '27478' AND VP.REF_TABLE = 'TT_NGOAITRU_TOATHUOC']
2019-09-20 16:49:00,085 [1] DEBUG - Statement Id: [DAO00058_DuyetOrHuyDuyetToathuocNgoaitruBHYT] Parameters: [@param0=[NGAYDUYET,null], @param1=[THOIGIANDUYET,null], @param2=[NGUOIDUYET_ID,null]]
2019-09-20 16:49:00,085 [1] DEBUG - Statement Id: [DAO00058_DuyetOrHuyDuyetToathuocNgoaitruBHYT] Types: [@param0=[System.DBNull, null], @param1=[System.DBNull, null], @param2=[System.DBNull, null]]
2019-09-20 16:49:00,442 [1] DEBUG - Statement Id: [DAO00064_Delete] PreparedStatement : [delete from TT_XACNHANCHIPHICHITIET        where XACNHANCHIPHI_ID in        (select XACNHANCHIPHI_ID from TT_XACNHANCHIPHI where TIEPNHAN_ID = '27478');        delete from TT_XACNHANCHIPHI where TIEPNHAN_ID = '27478';]
2019-09-20 16:49:00,553 [1] DEBUG - Statement Id: [DAO00064_TT_NGOAITRU_KHAMBENH_TOATHUOC_GetListToaThuocBHYT] PreparedStatement : [select * from TT_NGOAITRU_KHAMBENH_TOATHUOC        where (exists (select KHAMBENH_NGOAITRU_ID from TT_DVYEUCAU where TT_NGOAITRU_KHAMBENH_TOATHUOC.KHAMBENH_ID = KHAMBENH_NGOAITRU_ID and TIEPNHAN_ID = '27478')) and TIEPNHAN_ID = '27478' and LOAITOATHUOC = 'BV']
2019-09-20 16:49:00,595 [1] DEBUG - Statement Id: [DAO00019_UpdateTrangThai] PreparedStatement : [update TT_TIEPNHAN set        TRANGTHAI =  @param0         , NGAYCAPNHAT =  @param1         , NGUOICAPNHAT_ID =  @param2         where        TIEPNHAN_ID = '27478']
2019-09-20 16:49:00,595 [1] DEBUG - Statement Id: [DAO00019_UpdateTrangThai] Parameters: [@param0=[TRANGTHAI,DATIEPNHAN], @param1=[NGAYCAPNHAT,9/20/2019 4:49:00 PM], @param2=[NGUOICAPNHAT_ID,1]]
2019-09-20 16:49:00,595 [1] DEBUG - Statement Id: [DAO00019_UpdateTrangThai] Types: [@param0=[String, System.String], @param1=[DateTime, System.DateTime], @param2=[Int64, System.Int64]]
2019-09-20 16:49:00,638 [1] DEBUG - Statement Id: [DAO00027_GetListTiepNhanAllCOM30] PreparedStatement : [select distinct A.SOTIEPNHAN, A.TRAITUYEN, A.NGAYMIENDONGCHITRA, A.TIEPNHAN_ID, A.DOITUONG_ID, isnull(C.SOBENHAN,NULL) as SOBENHAN,        A.LOAITHANHVIEN_ID, A.SUDUNG_BHTN, A.THE_ID, A.THANHVIEN_ID, A.VIP, A.NGUON_BENHNHAN_ID, A.BAOLANH_VIENPHI, A.SOBHYT, CONVERT(VARCHAR(11),A.NGAYTIEPNHAN,103) as NGAYTIEPNHAN,        B.*        , A.UUTIEN        from TT_TIEPNHAN A        inner join (select * from TT_BENHNHAN where MAYTE = '' and ACTIVE = '1') B on B.BENHNHAN_ID = A.BENHNHAN_ID  and B.ACTIVE = '1'        left join TT_NOITRU_BENHAN C on C.TIEPNHAN_ID = A.TIEPNHAN_ID        where A.TIEPNHAN_ID = '27478' and A.BENHVIEN_ID = 'HLU01' and (A.TRANGTHAI not in ('HUY','CAPCUU', 'NOITRU', 'NGOAITRU'))]
2019-09-20 16:49:00,797 [1] DEBUG - Statement Id: [DAO00009_TT_TIEPNHAN_GetProcess] PreparedStatement : [select PROCESS_ID from TT_TIEPNHAN where SOTIEPNHAN = 'TN190920.0000001']
2019-09-20 16:49:02,046 [1] DEBUG - Statement Id: [DAOWF001_Kiemtrathongtindayeucaureturn] PreparedStatement : [select * from TT_REQUEST        where        PARA = '{"HOSPITAL_ID":"HLU01","SOTIEPNHAN":"TN190920.0000001"}']
2019-09-20 16:49:02,466 [1] DEBUG - Statement Id: [DAOWF001_Kiemtrathongtindichvudayeucaureturn] PreparedStatement : [select top 1 * from TT_REQUEST_SERVICE        where        PARA = '{"DICHVU_ID":"5685","DVYEUCAU_ID":"205440"}'  order by ID desc]
2019-09-20 16:49:02,506 [1] DEBUG - Statement Id: [DAOWF005_ReturnStateCuaDichVuYeuCau] PreparedStatement : [declare        @Detail_Id int,        @CurentState char(8),        @OldState char(8)          select top 1 @Detail_Id = ID, @CurentState = OLD_STATE_CODE, @OldState = CURR_STATE_CODE from TT_REQUEST_SERVICE_DETAIL        where        REQUEST_ID = '31779'        AND REQUEST_SERVICE_ID = '147387'        order by ID desc;          update TT_REQUEST_SERVICE set CURR_STATE_CODE = @CurentState, ISACTIVE = 1, ISCOMPLETE = 0 where ID = '147387';        delete from TT_REQUEST_SERVICE_DETAIL where ID = @Detail_Id;        insert into TT_REQUEST_SERVICE_HISTORY        (REQUEST_ID,REQUEST_SERVICE_ID, OLD_STATE_CODE, CURR_STATE_CODE) values ('31779','147387',@OldState, @CurentState);        select top 1 A.*, B.STATUS_CODE from TT_REQUEST_SERVICE A        left join TM_STATE B on A.CURR_STATE_CODE = B.STATE_CODE and A.PROCESS_CODE = B.PROCESS_CODE        where A.ID = '147387';]
2019-09-20 16:49:02,575 [1] DEBUG - Statement Id: [DAO00009_TT_DVYEUCAU_Update] PreparedStatement : [Update TT_DVYEUCAU set TRANGTHAI_WFL = 'HOANTAT' where DVYEUCAU_ID = '205440']
2019-09-20 16:49:02,618 [1] DEBUG - Statement Id: [DAO00027_ThongTinTiepNhanCOM006] PreparedStatement : [select distinct CONVERT(VARCHAR(11),A.NGAYTIEPNHAN,103) as NGAYYEUCAU, C.DICHVU_ID, C.DVYEUCAU_ID, D.TENDICHVU, C.NOITHUCHIEN_ID,        A.SOTIEPNHAN, A.TRAITUYEN, A.NGAYMIENDONGCHITRA, A.TIEPNHAN_ID, A.DOITUONG_ID, A.TRANGTHAI,        A.LOAITHANHVIEN_ID, A.SUDUNG_BHTN, A.THE_ID, A.THANHVIEN_ID, A.VIP, A.NGUON_BENHNHAN_ID, A.BAOLANH_VIENPHI,        CASE WHEN (A.TRANGTHAI = 'NOITRU' OR A.TRANGTHAI = 'CAPCUU'   or A.TRANGTHAI = 'NGOAITRU') THEN 'IN' ELSE 'OUT' END AS LOAIBENHAN,        CASE WHEN (C.TRANGTHAI = 'CHUAKETQUA') THEN 'CHUAKETQUA' ELSE 'HOANTAT' END AS TRANGTHAIDICHVU, A.SOBHYT,        B.*,        CASE WHEN Left(E.MANHOMDICHVU,2) = '03' THEN '02' ELSE Left(E.MANHOMDICHVU,2) END AS MANHOMDICHVU        , A.UUTIEN        from TT_TIEPNHAN A        inner join TT_BENHNHAN B on B.BENHNHAN_ID = A.BENHNHAN_ID and (A.TRANGTHAI = 'DATIEPNHAN' or A.TRANGTHAI = 'NOITRU' or A.TRANGTHAI = 'CAPCUU'  or A.TRANGTHAI = 'NGOAITRU') and B.ACTIVE = '1'        inner join TT_DVYEUCAU C on C.TIEPNHAN_ID = A.TIEPNHAN_ID        left join TM_DICHVU D on D.DICHVU_ID = C.DICHVU_ID        left join TM_NHOMDICHVU E on E.NHOMDICHVU_ID = D.NHOMDICHVU_ID        where C.NGAYHENCLS is NULL and A.TIEPNHAN_ID = '27478' and C.DICHVU_ID = '5685' and A.BENHVIEN_ID = 'HLU01']
2019-09-20 16:49:03,489 [1] DEBUG - Statement Id: [DAO00027_ThongTinTiepNhanCOM015] PreparedStatement : [declare @ManhomDSA varchar(10);        select top 1  @ManhomDSA = VALUE from TM_SYS_APPSETTINGS where CODE = 'MANHOM_DICHVU_DSA'        SELECT * FROM        (        SELECT        (A.SOTIEPNHAN + (CASE WHEN Left(E.MANHOMDICHVU,2) = '03' THEN '02' ELSE Left(E.MANHOMDICHVU,2) END) + LTRIM(C.NOITHUCHIEN_ID)) AS acss_lookupID,        ROW_NUMBER() OVER        (PARTITION BY (A.SOTIEPNHAN + (CASE WHEN Left(E.MANHOMDICHVU,2) = '03' THEN '02' ELSE Left(E.MANHOMDICHVU,2) END) + LTRIM(C.NOITHUCHIEN_ID))        ORDER BY (A.SOTIEPNHAN + (CASE WHEN Left(E.MANHOMDICHVU,2) = '03' THEN '02' ELSE Left(E.MANHOMDICHVU,2) END) + LTRIM(C.NOITHUCHIEN_ID)))        as num,        A.SOTIEPNHAN + (CASE WHEN Left(E.MANHOMDICHVU,2) = '03' THEN '02' ELSE Left(E.MANHOMDICHVU,2) END) + LTRIM(C.NOITHUCHIEN_ID) as KEYCOM15,        C.NOITHUCHIEN_ID, A.SOTIEPNHAN, A.TRAITUYEN, A.NGAYMIENDONGCHITRA, A.TIEPNHAN_ID, A.DOITUONG_ID, A.TRANGTHAI,        CASE WHEN (A.TRANGTHAI = 'NOITRU' OR A.TRANGTHAI = 'CAPCUU' or A.TRANGTHAI = 'NGOAITRU') THEN 'IN' ELSE 'OUT' END AS LOAIBENHAN,        CASE WHEN (C.TRANGTHAI = 'CHUAKETQUA') THEN 'CHUAKETQUA' ELSE 'HOANTAT' END AS TRANGTHAIDICHVU, A.SOBHYT,        B.*, F.TRANGTHAI as TRANGTHAI_BENHAN_NOITRU,        A.LOAITHANHVIEN_ID, A.SUDUNG_BHTN, A.THE_ID, A.THANHVIEN_ID, A.VIP, A.NGUON_BENHNHAN_ID, A.BAOLANH_VIENPHI,        CASE        WHEN @ManhomDSA is not null and E.MANHOMDICHVU in (@ManhomDSA) THEN E.MANHOMDICHVU        WHEN Left(E.MANHOMDICHVU,2) = '03' THEN '02' ELSE Left(E.MANHOMDICHVU,2) END AS MANHOMDICHVU        , A.UUTIEN        from TT_TIEPNHAN A        inner join TT_BENHNHAN B on B.BENHNHAN_ID = A.BENHNHAN_ID and (A.TRANGTHAI = 'DATIEPNHAN' or A.TRANGTHAI = 'NOITRU' or A.TRANGTHAI = 'CAPCUU' or A.TRANGTHAI = 'NGOAITRU') and B.ACTIVE = '1'        inner join TT_DVYEUCAU C on C.TIEPNHAN_ID = A.TIEPNHAN_ID        left join TM_DICHVU D on D.DICHVU_ID = C.DICHVU_ID        left join TM_NHOMDICHVU E on E.NHOMDICHVU_ID = D.NHOMDICHVU_ID        left join TT_NOITRU_BENHAN F on F.TIEPNHAN_ID = A.TIEPNHAN_ID        where C.NGAYHENCLS is NULL and A.TIEPNHAN_ID = '27478' and A.BENHVIEN_ID = 'HLU01'        ) a where a.num = 1]
2019-09-20 16:49:04,209 [1] DEBUG - Statement Id: [DAO00027_ThongTinTiepNhanCOM006] PreparedStatement : [select distinct CONVERT(VARCHAR(11),A.NGAYTIEPNHAN,103) as NGAYYEUCAU, C.DICHVU_ID, C.DVYEUCAU_ID, D.TENDICHVU, C.NOITHUCHIEN_ID,        A.SOTIEPNHAN, A.TRAITUYEN, A.NGAYMIENDONGCHITRA, A.TIEPNHAN_ID, A.DOITUONG_ID, A.TRANGTHAI,        A.LOAITHANHVIEN_ID, A.SUDUNG_BHTN, A.THE_ID, A.THANHVIEN_ID, A.VIP, A.NGUON_BENHNHAN_ID, A.BAOLANH_VIENPHI,        CASE WHEN (A.TRANGTHAI = 'NOITRU' OR A.TRANGTHAI = 'CAPCUU'   or A.TRANGTHAI = 'NGOAITRU') THEN 'IN' ELSE 'OUT' END AS LOAIBENHAN,        CASE WHEN (C.TRANGTHAI = 'CHUAKETQUA') THEN 'CHUAKETQUA' ELSE 'HOANTAT' END AS TRANGTHAIDICHVU, A.SOBHYT,        B.*,        CASE WHEN Left(E.MANHOMDICHVU,2) = '03' THEN '02' ELSE Left(E.MANHOMDICHVU,2) END AS MANHOMDICHVU        , A.UUTIEN        from TT_TIEPNHAN A        inner join TT_BENHNHAN B on B.BENHNHAN_ID = A.BENHNHAN_ID and (A.TRANGTHAI = 'DATIEPNHAN' or A.TRANGTHAI = 'NOITRU' or A.TRANGTHAI = 'CAPCUU'  or A.TRANGTHAI = 'NGOAITRU') and B.ACTIVE = '1'        inner join TT_DVYEUCAU C on C.TIEPNHAN_ID = A.TIEPNHAN_ID        left join TM_DICHVU D on D.DICHVU_ID = C.DICHVU_ID        left join TM_NHOMDICHVU E on E.NHOMDICHVU_ID = D.NHOMDICHVU_ID        where C.NGAYHENCLS is NULL and A.TIEPNHAN_ID = '27478' and C.DICHVU_ID = '4145' and A.BENHVIEN_ID = 'HLU01']
2019-09-20 16:49:04,513 [1] DEBUG - Statement Id: [DAO00027_ThongTinTiepNhanCOM015] PreparedStatement : [declare @ManhomDSA varchar(10);        select top 1  @ManhomDSA = VALUE from TM_SYS_APPSETTINGS where CODE = 'MANHOM_DICHVU_DSA'        SELECT * FROM        (        SELECT        (A.SOTIEPNHAN + (CASE WHEN Left(E.MANHOMDICHVU,2) = '03' THEN '02' ELSE Left(E.MANHOMDICHVU,2) END) + LTRIM(C.NOITHUCHIEN_ID)) AS acss_lookupID,        ROW_NUMBER() OVER        (PARTITION BY (A.SOTIEPNHAN + (CASE WHEN Left(E.MANHOMDICHVU,2) = '03' THEN '02' ELSE Left(E.MANHOMDICHVU,2) END) + LTRIM(C.NOITHUCHIEN_ID))        ORDER BY (A.SOTIEPNHAN + (CASE WHEN Left(E.MANHOMDICHVU,2) = '03' THEN '02' ELSE Left(E.MANHOMDICHVU,2) END) + LTRIM(C.NOITHUCHIEN_ID)))        as num,        A.SOTIEPNHAN + (CASE WHEN Left(E.MANHOMDICHVU,2) = '03' THEN '02' ELSE Left(E.MANHOMDICHVU,2) END) + LTRIM(C.NOITHUCHIEN_ID) as KEYCOM15,        C.NOITHUCHIEN_ID, A.SOTIEPNHAN, A.TRAITUYEN, A.NGAYMIENDONGCHITRA, A.TIEPNHAN_ID, A.DOITUONG_ID, A.TRANGTHAI,        CASE WHEN (A.TRANGTHAI = 'NOITRU' OR A.TRANGTHAI = 'CAPCUU' or A.TRANGTHAI = 'NGOAITRU') THEN 'IN' ELSE 'OUT' END AS LOAIBENHAN,        CASE WHEN (C.TRANGTHAI = 'CHUAKETQUA') THEN 'CHUAKETQUA' ELSE 'HOANTAT' END AS TRANGTHAIDICHVU, A.SOBHYT,        B.*, F.TRANGTHAI as TRANGTHAI_BENHAN_NOITRU,        A.LOAITHANHVIEN_ID, A.SUDUNG_BHTN, A.THE_ID, A.THANHVIEN_ID, A.VIP, A.NGUON_BENHNHAN_ID, A.BAOLANH_VIENPHI,        CASE        WHEN @ManhomDSA is not null and E.MANHOMDICHVU in (@ManhomDSA) THEN E.MANHOMDICHVU        WHEN Left(E.MANHOMDICHVU,2) = '03' THEN '02' ELSE Left(E.MANHOMDICHVU,2) END AS MANHOMDICHVU        , A.UUTIEN        from TT_TIEPNHAN A        inner join TT_BENHNHAN B on B.BENHNHAN_ID = A.BENHNHAN_ID and (A.TRANGTHAI = 'DATIEPNHAN' or A.TRANGTHAI = 'NOITRU' or A.TRANGTHAI = 'CAPCUU' or A.TRANGTHAI = 'NGOAITRU') and B.ACTIVE = '1'        inner join TT_DVYEUCAU C on C.TIEPNHAN_ID = A.TIEPNHAN_ID        left join TM_DICHVU D on D.DICHVU_ID = C.DICHVU_ID        left join TM_NHOMDICHVU E on E.NHOMDICHVU_ID = D.NHOMDICHVU_ID        left join TT_NOITRU_BENHAN F on F.TIEPNHAN_ID = A.TIEPNHAN_ID        where C.NGAYHENCLS is NULL and A.TIEPNHAN_ID = '27478' and A.BENHVIEN_ID = 'HLU01'        ) a where a.num = 1]
2019-09-20 16:49:05,256 [1] DEBUG - Statement Id: [DAO00027_ThongTinTiepNhanCOM006] PreparedStatement : [select distinct CONVERT(VARCHAR(11),A.NGAYTIEPNHAN,103) as NGAYYEUCAU, C.DICHVU_ID, C.DVYEUCAU_ID, D.TENDICHVU, C.NOITHUCHIEN_ID,        A.SOTIEPNHAN, A.TRAITUYEN, A.NGAYMIENDONGCHITRA, A.TIEPNHAN_ID, A.DOITUONG_ID, A.TRANGTHAI,        A.LOAITHANHVIEN_ID, A.SUDUNG_BHTN, A.THE_ID, A.THANHVIEN_ID, A.VIP, A.NGUON_BENHNHAN_ID, A.BAOLANH_VIENPHI,        CASE WHEN (A.TRANGTHAI = 'NOITRU' OR A.TRANGTHAI = 'CAPCUU'   or A.TRANGTHAI = 'NGOAITRU') THEN 'IN' ELSE 'OUT' END AS LOAIBENHAN,        CASE WHEN (C.TRANGTHAI = 'CHUAKETQUA') THEN 'CHUAKETQUA' ELSE 'HOANTAT' END AS TRANGTHAIDICHVU, A.SOBHYT,        B.*,        CASE WHEN Left(E.MANHOMDICHVU,2) = '03' THEN '02' ELSE Left(E.MANHOMDICHVU,2) END AS MANHOMDICHVU        , A.UUTIEN        from TT_TIEPNHAN A        inner join TT_BENHNHAN B on B.BENHNHAN_ID = A.BENHNHAN_ID and (A.TRANGTHAI = 'DATIEPNHAN' or A.TRANGTHAI = 'NOITRU' or A.TRANGTHAI = 'CAPCUU'  or A.TRANGTHAI = 'NGOAITRU') and B.ACTIVE = '1'        inner join TT_DVYEUCAU C on C.TIEPNHAN_ID = A.TIEPNHAN_ID        left join TM_DICHVU D on D.DICHVU_ID = C.DICHVU_ID        left join TM_NHOMDICHVU E on E.NHOMDICHVU_ID = D.NHOMDICHVU_ID        where C.NGAYHENCLS is NULL and A.TIEPNHAN_ID = '27478' and C.DICHVU_ID = '1111' and A.BENHVIEN_ID = 'HLU01']
2019-09-20 16:49:05,553 [1] DEBUG - Statement Id: [DAO00027_ThongTinTiepNhanCOM015] PreparedStatement : [declare @ManhomDSA varchar(10);        select top 1  @ManhomDSA = VALUE from TM_SYS_APPSETTINGS where CODE = 'MANHOM_DICHVU_DSA'        SELECT * FROM        (        SELECT        (A.SOTIEPNHAN + (CASE WHEN Left(E.MANHOMDICHVU,2) = '03' THEN '02' ELSE Left(E.MANHOMDICHVU,2) END) + LTRIM(C.NOITHUCHIEN_ID)) AS acss_lookupID,        ROW_NUMBER() OVER        (PARTITION BY (A.SOTIEPNHAN + (CASE WHEN Left(E.MANHOMDICHVU,2) = '03' THEN '02' ELSE Left(E.MANHOMDICHVU,2) END) + LTRIM(C.NOITHUCHIEN_ID))        ORDER BY (A.SOTIEPNHAN + (CASE WHEN Left(E.MANHOMDICHVU,2) = '03' THEN '02' ELSE Left(E.MANHOMDICHVU,2) END) + LTRIM(C.NOITHUCHIEN_ID)))        as num,        A.SOTIEPNHAN + (CASE WHEN Left(E.MANHOMDICHVU,2) = '03' THEN '02' ELSE Left(E.MANHOMDICHVU,2) END) + LTRIM(C.NOITHUCHIEN_ID) as KEYCOM15,        C.NOITHUCHIEN_ID, A.SOTIEPNHAN, A.TRAITUYEN, A.NGAYMIENDONGCHITRA, A.TIEPNHAN_ID, A.DOITUONG_ID, A.TRANGTHAI,        CASE WHEN (A.TRANGTHAI = 'NOITRU' OR A.TRANGTHAI = 'CAPCUU' or A.TRANGTHAI = 'NGOAITRU') THEN 'IN' ELSE 'OUT' END AS LOAIBENHAN,        CASE WHEN (C.TRANGTHAI = 'CHUAKETQUA') THEN 'CHUAKETQUA' ELSE 'HOANTAT' END AS TRANGTHAIDICHVU, A.SOBHYT,        B.*, F.TRANGTHAI as TRANGTHAI_BENHAN_NOITRU,        A.LOAITHANHVIEN_ID, A.SUDUNG_BHTN, A.THE_ID, A.THANHVIEN_ID, A.VIP, A.NGUON_BENHNHAN_ID, A.BAOLANH_VIENPHI,        CASE        WHEN @ManhomDSA is not null and E.MANHOMDICHVU in (@ManhomDSA) THEN E.MANHOMDICHVU        WHEN Left(E.MANHOMDICHVU,2) = '03' THEN '02' ELSE Left(E.MANHOMDICHVU,2) END AS MANHOMDICHVU        , A.UUTIEN        from TT_TIEPNHAN A        inner join TT_BENHNHAN B on B.BENHNHAN_ID = A.BENHNHAN_ID and (A.TRANGTHAI = 'DATIEPNHAN' or A.TRANGTHAI = 'NOITRU' or A.TRANGTHAI = 'CAPCUU' or A.TRANGTHAI = 'NGOAITRU') and B.ACTIVE = '1'        inner join TT_DVYEUCAU C on C.TIEPNHAN_ID = A.TIEPNHAN_ID        left join TM_DICHVU D on D.DICHVU_ID = C.DICHVU_ID        left join TM_NHOMDICHVU E on E.NHOMDICHVU_ID = D.NHOMDICHVU_ID        left join TT_NOITRU_BENHAN F on F.TIEPNHAN_ID = A.TIEPNHAN_ID        where C.NGAYHENCLS is NULL and A.TIEPNHAN_ID = '27478' and A.BENHVIEN_ID = 'HLU01'        ) a where a.num = 1]
2019-09-20 16:49:06,286 [1] DEBUG - Statement Id: [DAO00027_ThongTinTiepNhanCOM015] PreparedStatement : [declare @ManhomDSA varchar(10);        select top 1  @ManhomDSA = VALUE from TM_SYS_APPSETTINGS where CODE = 'MANHOM_DICHVU_DSA'        SELECT * FROM        (        SELECT        (A.SOTIEPNHAN + (CASE WHEN Left(E.MANHOMDICHVU,2) = '03' THEN '02' ELSE Left(E.MANHOMDICHVU,2) END) + LTRIM(C.NOITHUCHIEN_ID)) AS acss_lookupID,        ROW_NUMBER() OVER        (PARTITION BY (A.SOTIEPNHAN + (CASE WHEN Left(E.MANHOMDICHVU,2) = '03' THEN '02' ELSE Left(E.MANHOMDICHVU,2) END) + LTRIM(C.NOITHUCHIEN_ID))        ORDER BY (A.SOTIEPNHAN + (CASE WHEN Left(E.MANHOMDICHVU,2) = '03' THEN '02' ELSE Left(E.MANHOMDICHVU,2) END) + LTRIM(C.NOITHUCHIEN_ID)))        as num,        A.SOTIEPNHAN + (CASE WHEN Left(E.MANHOMDICHVU,2) = '03' THEN '02' ELSE Left(E.MANHOMDICHVU,2) END) + LTRIM(C.NOITHUCHIEN_ID) as KEYCOM15,        C.NOITHUCHIEN_ID, A.SOTIEPNHAN, A.TRAITUYEN, A.NGAYMIENDONGCHITRA, A.TIEPNHAN_ID, A.DOITUONG_ID, A.TRANGTHAI,        CASE WHEN (A.TRANGTHAI = 'NOITRU' OR A.TRANGTHAI = 'CAPCUU' or A.TRANGTHAI = 'NGOAITRU') THEN 'IN' ELSE 'OUT' END AS LOAIBENHAN,        CASE WHEN (C.TRANGTHAI = 'CHUAKETQUA') THEN 'CHUAKETQUA' ELSE 'HOANTAT' END AS TRANGTHAIDICHVU, A.SOBHYT,        B.*, F.TRANGTHAI as TRANGTHAI_BENHAN_NOITRU,        A.LOAITHANHVIEN_ID, A.SUDUNG_BHTN, A.THE_ID, A.THANHVIEN_ID, A.VIP, A.NGUON_BENHNHAN_ID, A.BAOLANH_VIENPHI,        CASE        WHEN @ManhomDSA is not null and E.MANHOMDICHVU in (@ManhomDSA) THEN E.MANHOMDICHVU        WHEN Left(E.MANHOMDICHVU,2) = '03' THEN '02' ELSE Left(E.MANHOMDICHVU,2) END AS MANHOMDICHVU        , A.UUTIEN        from TT_TIEPNHAN A        inner join TT_BENHNHAN B on B.BENHNHAN_ID = A.BENHNHAN_ID and (A.TRANGTHAI = 'DATIEPNHAN' or A.TRANGTHAI = 'NOITRU' or A.TRANGTHAI = 'CAPCUU' or A.TRANGTHAI = 'NGOAITRU') and B.ACTIVE = '1'        inner join TT_DVYEUCAU C on C.TIEPNHAN_ID = A.TIEPNHAN_ID        left join TM_DICHVU D on D.DICHVU_ID = C.DICHVU_ID        left join TM_NHOMDICHVU E on E.NHOMDICHVU_ID = D.NHOMDICHVU_ID        left join TT_NOITRU_BENHAN F on F.TIEPNHAN_ID = A.TIEPNHAN_ID        where C.NGAYHENCLS is NULL and A.TIEPNHAN_ID = '27478' and A.BENHVIEN_ID = 'HLU01'        ) a where a.num = 1]
2019-09-20 16:49:07,252 [1] DEBUG - Statement Id: [DAO00026_GetListDanhSachDichVuGhiNhanVTYT_COM25_WithTN] PreparedStatement : [select distinct CONVERT(VARCHAR(11),C.NGAYYEUCAU,103) as NGAYYEUCAU, C.DICHVU_ID, C.DVYEUCAU_ID, D.TENDICHVU, C.NOITHUCHIEN_ID, A.SOTIEPNHAN, A.TRAITUYEN, A.NGAYMIENDONGCHITRA, A.TIEPNHAN_ID, A.DOITUONG_ID, A.TRANGTHAI,            A.LOAITHANHVIEN_ID, A.SUDUNG_BHTN, A.THE_ID, A.THANHVIEN_ID, A.VIP, A.NGUON_BENHNHAN_ID, A.BAOLANH_VIENPHI,            CASE WHEN (A.TRANGTHAI = 'NOITRU' OR A.TRANGTHAI = 'CAPCUU') THEN 'IN' ELSE 'OUT' END AS LOAIBENHAN,            CASE WHEN (C.TRANGTHAI = 'CHUAKETQUA') THEN 'CHUAKETQUA' ELSE 'HOANTAT' END AS TRANGTHAIDICHVU,            B.*, isnull(ntba.SOBENHAN, '') SOBENHAN, isnull(ntba.BENHAN_ID, 0) BENHAN_ID,            CASE WHEN Left(E.MANHOMDICHVU,2) = '03' THEN '02' ELSE Left(E.MANHOMDICHVU,2) END AS MANHOMDICHVU            from TT_TIEPNHAN A            inner join TT_BENHNHAN B on B.BENHNHAN_ID = A.BENHNHAN_ID and B.ACTIVE = '1'            inner join TT_DVYEUCAU C on C.TIEPNHAN_ID = A.TIEPNHAN_ID                        left join TM_DICHVU D on D.DICHVU_ID = C.DICHVU_ID            left join TM_NHOMDICHVU E on E.NHOMDICHVU_ID = D.NHOMDICHVU_ID            left join TT_NOITRU_BENHAN ntba on ntba.BENHAN_ID = C.BENHAN_ID              where            C.NGAYHENCLS is NULL and A.BENHVIEN_ID = 'HLU01'            and (A.TRANGTHAI = 'DATIEPNHAN' or A.TRANGTHAI = 'NOITRU' or A.TRANGTHAI = 'CAPCUU' or A.TRANGTHAI = 'NGOAITRU')            and (CASE WHEN Left(E.MANHOMDICHVU,2) = '03' THEN '02' ELSE Left(E.MANHOMDICHVU,2) END in ('02', '04'))            and A.TIEPNHAN_ID = '27478']
2019-09-20 16:49:07,732 [1] DEBUG - Statement Id: [DAO00064_TT_XACNHAN_BHYT_Add] PreparedStatement : [INSERT INTO [TT_XACNHAN_BHYT]        ([BENHNHAN_ID]        ,[TIEPNHAN_ID]        ,[BENHAN_ID]        ,[SOBHYT]        ,[TRANGTHAI_XACNHAN]        ,[NOITHUCHIEN_ID]        ,[NGUOITHUCHIEN_ID]        ,[NGAYTHUCHIEN])        VALUES        ( @param0         , @param1         , @param2         , @param3         , @param4         , @param5         , @param6         , @param7 )]
2019-09-20 16:49:07,733 [1] DEBUG - Statement Id: [DAO00064_TT_XACNHAN_BHYT_Add] Parameters: [@param0=[BENHNHAN_ID,23423], @param1=[TIEPNHAN_ID,27478], @param2=[BENHAN_ID,null], @param3=[SOBHYT,DN453534653452338289], @param4=[TRANGTHAI_XACNHAN,HUYXACNHAN], @param5=[NOITHUCHIEN_ID,58], @param6=[NGUOITHUCHIEN_ID,1], @param7=[NGAYTHUCHIEN,9/20/2019 4:49:07 PM]]
2019-09-20 16:49:07,733 [1] DEBUG - Statement Id: [DAO00064_TT_XACNHAN_BHYT_Add] Types: [@param0=[Int64, System.Int64], @param1=[Int64, System.Int64], @param2=[System.DBNull, null], @param3=[String, System.String], @param4=[String, System.String], @param5=[String, System.String], @param6=[Int64, System.Int64], @param7=[DateTime, System.DateTime]]
2019-09-20 16:49:07,769 [1] DEBUG - Statement Id: [DAO00026_GetListDanhSachDichVuGhiNhanVTYT_COM25_WithTN] PreparedStatement : [select distinct CONVERT(VARCHAR(11),C.NGAYYEUCAU,103) as NGAYYEUCAU, C.DICHVU_ID, C.DVYEUCAU_ID, D.TENDICHVU, C.NOITHUCHIEN_ID, A.SOTIEPNHAN, A.TRAITUYEN, A.NGAYMIENDONGCHITRA, A.TIEPNHAN_ID, A.DOITUONG_ID, A.TRANGTHAI,            A.LOAITHANHVIEN_ID, A.SUDUNG_BHTN, A.THE_ID, A.THANHVIEN_ID, A.VIP, A.NGUON_BENHNHAN_ID, A.BAOLANH_VIENPHI,            CASE WHEN (A.TRANGTHAI = 'NOITRU' OR A.TRANGTHAI = 'CAPCUU') THEN 'IN' ELSE 'OUT' END AS LOAIBENHAN,            CASE WHEN (C.TRANGTHAI = 'CHUAKETQUA') THEN 'CHUAKETQUA' ELSE 'HOANTAT' END AS TRANGTHAIDICHVU,            B.*, isnull(ntba.SOBENHAN, '') SOBENHAN, isnull(ntba.BENHAN_ID, 0) BENHAN_ID,            CASE WHEN Left(E.MANHOMDICHVU,2) = '03' THEN '02' ELSE Left(E.MANHOMDICHVU,2) END AS MANHOMDICHVU            from TT_TIEPNHAN A            inner join TT_BENHNHAN B on B.BENHNHAN_ID = A.BENHNHAN_ID and B.ACTIVE = '1'            inner join TT_DVYEUCAU C on C.TIEPNHAN_ID = A.TIEPNHAN_ID                        left join TM_DICHVU D on D.DICHVU_ID = C.DICHVU_ID            left join TM_NHOMDICHVU E on E.NHOMDICHVU_ID = D.NHOMDICHVU_ID            left join TT_NOITRU_BENHAN ntba on ntba.BENHAN_ID = C.BENHAN_ID              where            C.NGAYHENCLS is NULL and A.BENHVIEN_ID = 'HLU01'            and (A.TRANGTHAI = 'DATIEPNHAN' or A.TRANGTHAI = 'NOITRU' or A.TRANGTHAI = 'CAPCUU' or A.TRANGTHAI = 'NGOAITRU')            and (CASE WHEN Left(E.MANHOMDICHVU,2) = '03' THEN '02' ELSE Left(E.MANHOMDICHVU,2) END in ('02', '04'))            and A.TIEPNHAN_ID = '27478']
2019-09-20 16:49:08,437 [1] DEBUG - Statement Id: [DAO00014_GetPatientStatusXacNhanChiPhi] PreparedStatement : [select        tn.TRANGTHAI as TRANGTHAI        from TT_TIEPNHAN tn        where tn.TIEPNHAN_ID = '27478'        and tn.BENHVIEN_ID = 'HLU01']
2019-09-20 16:49:08,526 [1] DEBUG - Statement Id: [DAO00064_TT_NGOAITRU_KHAMBENH_TOATHUOC_GetListToaThuocBHYT] PreparedStatement : [select * from TT_NGOAITRU_KHAMBENH_TOATHUOC        where (exists (select KHAMBENH_NGOAITRU_ID from TT_DVYEUCAU where TT_NGOAITRU_KHAMBENH_TOATHUOC.KHAMBENH_ID = KHAMBENH_NGOAITRU_ID and TIEPNHAN_ID = '27478')) and TIEPNHAN_ID = '27478' and LOAITOATHUOC = 'BV']
2019-09-20 16:49:08,561 [1] DEBUG - Statement Id: [DAO00064_GetlistTT_TIEPNHAN_SOTHEBHYT] PreparedStatement : [select stbhyt.*, ba.SOBENHAN,         tn.SOTIEPNHAN, tn.LOAITHANHVIEN_ID, tn.THE_ID, tn.THANHVIEN_ID,        tn.SUDUNG_BHTN, tn.BAOLANH_VIENPHI, tn.VIP, tn.NGUOINUOCNGOAI        from TT_TIEPNHAN_SOTHEBHYT stbhyt        left join TT_TIEPNHAN tn on tn.TIEPNHAN_ID = stbhyt.TIEPNHAN_ID        left join TT_NOITRU_BENHAN ba on ba.TIEPNHAN_ID = stbhyt.TIEPNHAN_ID        where         stbhyt.TIEPNHAN_ID = '27478' and isnull(stbhyt.KHONGSUDUNG, '0') = '0']
2019-09-20 16:49:08,619 [1] DEBUG - Statement Id: [DAO00064_GetListVienPhiByTiepNnan] PreparedStatement : [select distinct        B.DOITUONG_ID, B.NGAYMIENDONGCHITRA, B.BENHNHAN_ID as TIEPNHAN_BENHNHAN_ID, B.TRAITUYEN,        B.BHYTTREN3NAM as TREN3NAM, B.BHYTTREN5NAM as TREN5NAM, B.SOTIEPNHAN, B.SOBENHAN,        B.LOAITHANHVIEN_ID, B.SUDUNG_BHTN, B.THE_ID, B.THANHVIEN_ID, B.BAOLANH_VIENPHI, B.VIP, B.NGUOINUOCNGOAI,        C.GIATRIMIENGIAM as GIATRIMIENGIAM, D.GIATRIMIENGIAM as GIATRIMIENGIAM_BHTN, E.GIATRIMIENGIAM as GIATRIMIENGIAM_THANHVIEN,        F.GIATRIMIENGIAM as GIATRIMIENGIAM_CONGTY, DVYC.THE_ID as DVDUNGTHE, DVYC.TRANGTHAI as TRANGTHAIDICHVU, ndv.MANHOMDICHVU,        A.* from TT_VIENPHI A        left join        (select B.*, C.SOBENHAN, C.BENHAN_ID        from TT_TIEPNHAN B        left join TT_NOITRU_BENHAN C on B.TIEPNHAN_ID = C.TIEPNHAN_ID                 where B.TIEPNHAN_ID = '27478') B on B.TIEPNHAN_ID = A.TIEPNHAN_ID        left join (select sum(GIATRIMIENGIAM) as GIATRIMIENGIAM, VIENPHI_ID, REF_TABLE        from TT_MIENGIAM_CHITIET        where REF_TABLE = 'TT_MIENGIAM'        and exists (select MIENGIAM_ID from TT_MIENGIAM where TT_MIENGIAM_CHITIET.MIENGIAM_ID = MIENGIAM_ID and TINHTRANG = 1 and TIEPNHAN_ID = '27478')        group by VIENPHI_ID, REF_TABLE) C on C.REF_TABLE = 'TT_MIENGIAM' and C.VIENPHI_ID = A.VIENPHI_ID        left join (select sum(GIATRIMIENGIAM) as GIATRIMIENGIAM, VIENPHI_ID, REF_TABLE        from TT_MIENGIAM_CHITIET        where REF_TABLE = 'TT_MIENGIAM_BHTN'        and exists (select MIENGIAM_BHTN_ID from TT_MIENGIAM_BHTN where TT_MIENGIAM_CHITIET.MIENGIAM_ID = MIENGIAM_BHTN_ID and  TINHTRANG = 1 and TIEPNHAN_ID = '27478')        group by VIENPHI_ID, REF_TABLE) D on D.REF_TABLE = 'TT_MIENGIAM_BHTN' and D.VIENPHI_ID = A.VIENPHI_ID        left join (select sum(GIATRIMIENGIAM) as GIATRIMIENGIAM, VIENPHI_ID, REF_TABLE        from TT_MIENGIAM_CHITIET        where REF_TABLE = 'TT_MIENGIAM_THANHVIEN'        and exists (select MIENGIAM_THANHVIEN_ID from TT_MIENGIAM_THANHVIEN where TT_MIENGIAM_CHITIET.MIENGIAM_ID = MIENGIAM_THANHVIEN_ID and TINHTRANG = 1 and TIEPNHAN_ID = '27478')        group by VIENPHI_ID, REF_TABLE) E on E.REF_TABLE = 'TT_MIENGIAM_THANHVIEN' and E.VIENPHI_ID = A.VIENPHI_ID        left join (select sum(GIATRIMIENGIAM) as GIATRIMIENGIAM, VIENPHI_ID, REF_TABLE        from TT_MIENGIAM_CHITIET        where REF_TABLE = 'TT_MIENGIAM_CONGTY'        and exists (select MIENGIAM_CONGTY_ID from TT_MIENGIAM_CONGTY where TT_MIENGIAM_CHITIET.MIENGIAM_ID = MIENGIAM_CONGTY_ID and TINHTRANG = 1 and TIEPNHAN_ID = '27478')        group by VIENPHI_ID, REF_TABLE) F on F.REF_TABLE = 'TT_MIENGIAM_CONGTY' and F.VIENPHI_ID = A.VIENPHI_ID        left join TT_DVYEUCAU DVYC on DVYC.DVYEUCAU_ID = A.REF_ID and A.REF_TABLE = 'TT_DVYEUCAU'        left join TM_DICHVU DV on DVYC.DICHVU_ID = DV.DICHVU_ID and A.REF_TABLE = 'TT_DVYEUCAU'        left join TM_NHOMDICHVU ndv on ndv.NHOMDICHVU_ID = DV.NHOMDICHVU_ID and A.REF_TABLE = 'TT_DVYEUCAU'        where        A.TIEPNHAN_ID = '27478' and ((DVYC.HUYYEUCAU = '0' and A.DICHVU_ID is not null)        or A.DUOC_ID is not null or A.REF_TABLE = 'TT_NUT_XACNHANSUATAN_CHITIET')        and A.ACTIVE = '1'                 and A.BENHVIEN_ID = 'HLU01'        order by A.VIENPHI_ID]
2019-09-20 16:49:08,697 [1] DEBUG - Statement Id: [DAO00006_GetListDuocTyle] PreparedStatement : [select DUOC_ID, DOITUONG_ID, (TYLE/100) as TYLE, DONGIA MUCTRAN_THANHTOAN from TM_DOITUONG_GIADUOC_TYLE            where            BENHVIEN_ID = 'HLU01'            and DOITUONG_ID = '4']
2019-09-20 16:49:08,729 [1] DEBUG - Statement Id: [DAO00027_GetListTuongTrinhDichVuPhauThuatCuaTiepNhan] PreparedStatement : [declare @ManhomDSA varchar(10);        declare @PhanLoaiNhomDV varchar(20) = '05';        select top 1  @ManhomDSA = VALUE from TM_SYS_APPSETTINGS where CODE = 'MANHOM_DICHVU_DSA'        if (@ManhomDSA is not null) set @PhanLoaiNhomDV += ',' + @ManhomDSA        select distinct ptyc.*        from TT_PHAUTHUAT_YEUCAU ptyc        inner join TM_DICHVU dv on dv.DICHVU_ID = ptyc.DICHVU_ID        inner join TM_NHOMDICHVU ndv on ndv.NHOMDICHVU_ID = dv.NHOMDICHVU_ID        inner join TT_PHAUTHUAT pt on pt.PHAUTHUAT_ID = ptyc.PHAUTHUAT_ID        where        pt.TIEPNHAN_ID = 27478        and (left(ndv.MANHOMDICHVU, 2) in (select * from STRING_SPLIT(@PhanLoaiNhomDV,',')) or ndv.MANHOMDICHVU in (select * from STRING_SPLIT(@PhanLoaiNhomDV,',')))]
2019-09-20 16:49:08,797 [1] DEBUG - Statement Id: [DAO00006_GetList] PreparedStatement : [select dv.*, loaiDV.MALOAIDICHVU, captren.NHOMDICHVU_ID as NHOMDICHVU_CAPTREN_ID, captren.TENNHOMDICHVU as NHOMDICHVU_CAPTREN,              nhom_dv.TENNHOMDICHVU as TENNHOMDICHVU, nhom_dv.MANHOMDICHVU,              case when dv.ATTRIBUTE5 is null then 'TT' else 'KTC' end as LOAI_CHIPHI              from TM_DICHVU as dv              left join TM_NHOMDICHVU as nhom_dv on nhom_dv.NHOMDICHVU_ID = dv.NHOMDICHVU_ID and nhom_dv.BENHVIEN_ID = 'HLU01'              left join TM_NHOMDICHVU as captren on nhom_dv.CAPTREN_ID = captren.NHOMDICHVU_ID and captren.BENHVIEN_ID = 'HLU01'              left join TM_LOAIDICHVU loaiDV on nhom_dv.LOAIDICHVU_ID = loaiDV.LOAIDICHVU_ID and loaiDV.BENHVIEN_ID = 'HLU01'              where nhom_dv.TAMNGUNG = '0' and dv.BENHVIEN_ID = 'HLU01'              and dv.TAMNGUNG = '0'               AND                   loaiDV.MALOAIDICHVU = 'KhamBenh']
2019-09-20 16:49:08,940 [1] DEBUG - Statement Id: [DAO00023_UpdateNhieuVP] PreparedStatement : [declare @jsonVienPhi nvarchar(max) = N'[{"VIENPHI_ID":674724,"TIEPNHAN_ID":27478,"DICHVU_ID":5685,"BENHAN_ID":0,"SOLUONG":1.0000,"DONGIA_DOANHTHU":33000.0000,"THANHTIEN_DOANHTHU":33000.00,"BHYT_TL":0.8000,"BHYT_DONGIA":33000.0000,"BHYT_THANHTIEN":33000.00,"BHYT_DONGIA_CONGKHAM_DAU":33000.0000,"BHYT_CONGKHAM_DAU_TYLE":1.0,"BHYT_DONGIA_CHITRA":26400.0,"BHYT_THANHTIEN_CHITRA":26400.00,"BENHNHAN_PHAITHANHTOAN":6600.00,"GIATRI_HOADON":6600.00,"GIATRI_HOADON_DATHANHTOAN":0.0,"GIATRI_BIENLAI":0.0,"GIATRI_BIENLAI_DATHANHTOAN":0.0,"GIATRI_BENHNHAN_DATHANHTOAN":0.0,"DATHUCHIEN":"1","KHONGTHUTIEN":"0","BHYTDONGTIEN":"0","DICHVU_TL":1.0,"BHYT_DONGIA_DONGCT_DAU":0.0,"SOBHYT":"DN453534653452338289","SOBHYT_HUONG_ID":28501,"GIATRIMIENGIAM":0.0,"GIATRIMIENGIAM_BHTN":0.0,"GIATRIMIENGIAM_THANHVIEN":0.0,"GIATRIMIENGIAM_CONGTY":0.0,"BHYT_CK2_KHONGTHANHTOAN":false},{"VIENPHI_ID":674725,"TIEPNHAN_ID":27478,"DICHVU_ID":4145,"BENHAN_ID":0,"SOLUONG":1.0000,"DONGIA_DOANHTHU":260000.0000,"THANHTIEN_DOANHTHU":260000.00,"BHYT_TL":0.8000,"BHYT_DONGIA":260000.0000,"BHYT_THANHTIEN":260000.00,"BHYT_DONGIA_CONGKHAM_DAU":33000.0000,"BHYT_CONGKHAM_DAU_TYLE":1.0,"BHYT_DONGIA_CHITRA":208000.0,"BHYT_THANHTIEN_CHITRA":208000.00,"BENHNHAN_PHAITHANHTOAN":52000.00,"GIATRI_HOADON":52000.00,"GIATRI_HOADON_DATHANHTOAN":0.0,"GIATRI_BIENLAI":0.0,"GIATRI_BIENLAI_DATHANHTOAN":0.0,"GIATRI_BENHNHAN_DATHANHTOAN":0.0,"DATHUCHIEN":"1","KHONGTHUTIEN":"0","BHYTDONGTIEN":"0","DICHVU_TL":1.0,"BHYT_DONGIA_DONGCT_DAU":0.0,"SOBHYT":"DN453534653452338289","SOBHYT_HUONG_ID":28501,"GIATRIMIENGIAM":0.0,"GIATRIMIENGIAM_BHTN":0.0,"GIATRIMIENGIAM_THANHVIEN":0.0,"GIATRIMIENGIAM_CONGTY":0.0,"BHYT_CK2_KHONGTHANHTOAN":false},{"VIENPHI_ID":674726,"TIEPNHAN_ID":27478,"DICHVU_ID":1111,"BENHAN_ID":0,"SOLUONG":1.0000,"DONGIA_DOANHTHU":37000.0000,"THANHTIEN_DOANHTHU":37000.00,"BHYT_TL":0.8000,"BHYT_DONGIA":37000.0000,"BHYT_THANHTIEN":37000.00,"BHYT_DONGIA_CONGKHAM_DAU":33000.0000,"BHYT_CONGKHAM_DAU_TYLE":1.0,"BHYT_DONGIA_CHITRA":29600.0,"BHYT_THANHTIEN_CHITRA":29600.00,"BENHNHAN_PHAITHANHTOAN":7400.00,"GIATRI_HOADON":7400.00,"GIATRI_HOADON_DATHANHTOAN":0.0,"GIATRI_BIENLAI":0.0,"GIATRI_BIENLAI_DATHANHTOAN":0.0,"GIATRI_BENHNHAN_DATHANHTOAN":0.0,"DATHUCHIEN":"1","KHONGTHUTIEN":"0","BHYTDONGTIEN":"0","DICHVU_TL":1.0,"BHYT_DONGIA_DONGCT_DAU":0.0,"SOBHYT":"DN453534653452338289","SOBHYT_HUONG_ID":28501,"GIATRIMIENGIAM":0.0,"GIATRIMIENGIAM_BHTN":0.0,"GIATRIMIENGIAM_THANHVIEN":0.0,"GIATRIMIENGIAM_CONGTY":0.0,"BHYT_CK2_KHONGTHANHTOAN":false}]';        begin        UPDATE TT_VIENPHI        SET        SOLUONG = json.SOLUONG,        DONGIA_DOANHTHU = json.DONGIA_DOANHTHU,        THANHTIEN_DOANHTHU = json.THANHTIEN_DOANHTHU,        BHYT_TL = json.BHYT_TL,        BHYT_DONGIA = json.BHYT_DONGIA,        BHYT_THANHTIEN = json.BHYT_THANHTIEN,        BHYT_DONGIA_CONGKHAM_DAU = json.BHYT_DONGIA_CONGKHAM_DAU,        BHYT_CONGKHAM_DAU_TYLE = json.BHYT_CONGKHAM_DAU_TYLE,        BHYT_DONGIA_CHITRA = json.BHYT_DONGIA_CHITRA,        BHYT_THANHTIEN_CHITRA = json.BHYT_THANHTIEN_CHITRA,        BENHNHAN_PHAITHANHTOAN = json.BENHNHAN_PHAITHANHTOAN,        GIATRI_HOADON = json.GIATRI_HOADON,                GIATRI_BIENLAI = json.GIATRI_BIENLAI,                DATHUCHIEN = json.DATHUCHIEN,                DICHVU_TL = json.DICHVU_TL,        BHYT_DONGIA_DONGCT_DAU = json.BHYT_DONGIA_DONGCT_DAU,        NGAYCAPNHAT = GETDATE()        FROM OPENJSON (@jsonVienPhi)        WITH (        VIENPHI_ID int,        SOLUONG numeric(25, 4),        DONGIA_DOANHTHU numeric(25, 4),        THANHTIEN_DOANHTHU numeric(25, 4),        BHYT_TL numeric(25, 4),        BHYT_DONGIA numeric(25, 4),        BHYT_THANHTIEN numeric(25, 4),        BHYT_DONGIA_CONGKHAM_DAU numeric(25, 4),        BHYT_CONGKHAM_DAU_TYLE numeric(25, 4),        BHYT_DONGIA_CHITRA numeric(25, 4),        BHYT_THANHTIEN_CHITRA numeric(25, 4),        BENHNHAN_PHAITHANHTOAN numeric(25, 4),        GIATRI_HOADON numeric(25, 4),                GIATRI_BIENLAI numeric(25, 4),                DATHUCHIEN char(1),        KHONGTHUTIEN char(1),        BHYTDONGTIEN char(1),        DICHVU_TL numeric(25, 4),        BHYT_DONGIA_DONGCT_DAU numeric(25, 4))  json        WHERE TT_VIENPHI.VIENPHI_ID = json.VIENPHI_ID                        insert into TT_TINH_VIENPHI_LOG        SELECT json.VIENPHI_ID, json.TIEPNHAN_ID, json.BENHAN_ID, json.SOLUONG, json.BHYT_TL, json.DONGIA_DOANHTHU,        json.THANHTIEN_DOANHTHU, json.BHYT_DONGIA, json.BHYT_THANHTIEN, json.BHYT_DONGIA_CHITRA, json.BHYT_THANHTIEN_CHITRA, json.BENHNHAN_PHAITHANHTOAN,        json.SOBHYT_HUONG_ID, json.SOBHYT, GETDATE(), -1, 'HLU01'        FROM OPENJSON(@jsonVienPhi)        WITH (        VIENPHI_ID int,        TIEPNHAN_ID int,        BENHAN_ID int,        SOLUONG numeric(25, 4),        DONGIA_DOANHTHU numeric(25, 4),        THANHTIEN_DOANHTHU numeric(25, 4),        BHYT_TL numeric(25, 4),        BHYT_DONGIA numeric(25, 4),        BHYT_THANHTIEN numeric(25, 4),        BHYT_DONGIA_CHITRA numeric(25, 4),        BHYT_THANHTIEN_CHITRA numeric(25, 4),        BENHNHAN_PHAITHANHTOAN numeric(25, 4),        SOBHYT_HUONG_ID int,        SOBHYT nvarchar(30)) json        end]
2019-09-20 16:49:09,019 [1] DEBUG - Statement Id: [DAO00067_UpdateDataVienPhiDongiaBHYT] PreparedStatement : [update TT_VIENPHI          set BHYT_DONGIA_CHITRA = 0, BHYT_THANHTIEN = 0, BHYT_THANHTIEN_CHITRA = 0          where          TIEPNHAN_ID = 27478 and BHYT_DONGIA = 0          and (BHYT_DONGIA_CHITRA > 0 or BHYT_THANHTIEN > 0 or BHYT_THANHTIEN_CHITRA > 0)]
2019-09-20 16:49:09,053 [1] DEBUG - Statement Id: [DAO00067_CapnhatDataVienphiKhiHuyThanhtoanHoadon] PreparedStatement : [update TT_VIENPHI        set TT_VIENPHI.HOADON_ID = hdct.HOADON_ID, TT_VIENPHI.GIATRI_BENHNHAN_DATHANHTOAN = TT_VIENPHI.GIATRI_BENHNHAN_DATHANHTOAN + hdct.GIATRI_BENHNHAN_DATHANHTOAN        from (select CT.HOADON_ID, CT.VIENPHI_ID, CT.GIATRI_BENHNHAN_DATHANHTOAN        from TT_HOADON_CHITIET_NGOAITRU CT        join TT_HOADON HD on HD.HOADON_ID = CT.HOADON_ID        join TT_VIENPHI vp on vp.VIENPHI_ID = ct.VIENPHI_ID        where HD.DATHANHTOAN = 1 and HD.HUYHOADON = 0 and HD.HOANTRA = 0 and vp.TIEPNHAN_ID =  @param0 ) hdct        where        TT_VIENPHI.VIENPHI_ID = hdct.VIENPHI_ID and TT_VIENPHI.HOADON_ID is null and isnull(TT_VIENPHI.GIATRI_BENHNHAN_DATHANHTOAN,0) = 0        and TT_VIENPHI.TIEPNHAN_ID =  @param0           update TT_VIENPHI        set TT_VIENPHI.HOADON_ID = null, TT_VIENPHI.GIATRI_BENHNHAN_DATHANHTOAN = TT_VIENPHI.GIATRI_BENHNHAN_DATHANHTOAN - hdct.GIATRI_BENHNHAN_DATHANHTOAN,        TT_VIENPHI.DATHANHTOAN = '0'        from (select CT.HOADON_ID, CT.VIENPHI_ID, CT.GIATRI_BENHNHAN_DATHANHTOAN        from TT_HOADON_CHITIET_NGOAITRU CT        join TT_HOADON HD on HD.HOADON_ID = CT.HOADON_ID        join TT_VIENPHI vp on vp.VIENPHI_ID = ct.VIENPHI_ID and vp.HOADON_ID = ct.HOADON_ID        where HD.DATHANHTOAN = 0 and (HD.HUYHOADON = 1 or HD.HOANTRA = 1) and vp.TIEPNHAN_ID =  @param0 ) hdct        where        TT_VIENPHI.VIENPHI_ID = hdct.VIENPHI_ID and TT_VIENPHI.HOADON_ID = hdct.HOADON_ID        and TT_VIENPHI.TIEPNHAN_ID =  @param0]
2019-09-20 16:49:09,054 [1] DEBUG - Statement Id: [DAO00067_CapnhatDataVienphiKhiHuyThanhtoanHoadon] Parameters: [@param0=[TIEPNHAN_ID,27478]]
2019-09-20 16:49:09,054 [1] DEBUG - Statement Id: [DAO00067_CapnhatDataVienphiKhiHuyThanhtoanHoadon] Types: [@param0=[Int64, System.Int64]]
2019-09-20 16:49:09,150 [1] DEBUG - Statement Id: [DAO00064_GetVienphiTiepNhan_BIL09] PreparedStatement : [select distinct case when c.DVYEUCAU_ID is not null then c.TRANGTHAI        when tk.KHAMBENH_TOATHUOC_ID is not null then case when tk.CHUNGTUPHATTHUOC_ID is not null then 'DAXUAT' else 'CHUAXUAT' end        when vtyt.PHAUTHUAT_VTYT_ID is not null then case when vtyt.CHUNGTU_ID is not null then 'DAXUAT' else 'CHUAXUAT' end        when kqvtyt.CLSKETQUA_VTYT_ID is not null then case when kqvtyt.TRANGTHAI is not null then 'DAXUAT' else 'CHUAXUAT' end        else '' end as TRANGTHAI        , C.NOITHUCHIEN_ID as PHONGBAN_ID, D.NGAYKHAM,        ISNULL(A.DICHVU_ID, A.DUOC_ID) as NOIDUNG_ID, A.REF_ID as IDREF, A.VIENPHI_ID,        A.SOLUONG as SOLUONG, A.SOLUONG as SOLUONG_NEW, A.DICHVU_ID, A.DUOC_ID, A.BHYT_DONGIA_CHITRA,        A.DONGIA_DOANHTHU, A.DONGIA_DOANHTHU as DONGIADOANHTHU, A.BHYT_DONGIA as DONGIAHOTRO, A.BHYT_THANHTIEN_CHITRA as DONGIAHOTROCHITRA, A.BHYT_DONGIA_CHITRA as DONGIAHOTROCHITRA_NEW,        A.REF_TABLE as LOAI, A.BHYT_DONGIA, A.BHYT_THANHTIEN, A.BHYT_THANHTIEN_CHITRA, A.BENHNHAN_PHAITHANHTOAN, A.GIATRI_BENHNHAN_DATHANHTOAN, A.BENHVIEN_ID, A.THANHTIEN_DOANHTHU,        A.LOAI_CHIPHI, A.LOAIGIA_ID, REF_TABLE, A.KHAMBENH_ID, A.REF_ID, A.DUOCPHEPTHUCHIEN,        A.HUY, A.KHONGTHUTIEN, A.DATHANHTOAN, A.HOADON_ID, A.ACTIVE, C.DVYEUCAU_ID, C.NGAYYEUCAU, ISNULL(C.BACSICHIDINH_ID, C.NGUOIGIOITHIEU_ID) as BACSICHIDINH_ID, C.NOIYEUCAU_ID        , A.DATHUCHIEN,        isnull(dv.TENDICHVU, dc.TENDUOCDAYDU) NOIDUNG, isnull(dv.MADICHVU, dc.MADUOC) MADICHVU, dv.NORESULT, dc.DONVITINH, ld.MALOAIDUOC, dc.BHYT DUOC_BHYT, ld.LOAIVATTU_ID,        ndv.MANHOMDICHVU, D.KBPBHUONGGIAIQUYET NOIDUNG2, D.HUONGGIAIQUYET_ID        from TT_VIENPHI A        left join (select * from TT_DVYEUCAU where TIEPNHAN_ID = '27478') C on C.TIEPNHAN_ID = A.TIEPNHAN_ID and C.DICHVU_ID = A.DICHVU_ID  and C.DVYEUCAU_ID = A.REF_ID        left join (        select pb.TENPHONGBAN + ' - ' + nv.TENNHANVIEN + ' - '+ hgq.DICTIONARY_NAME KBPBHUONGGIAIQUYET, kb.* from TT_NGOAITRU_KHAMBENH kb        left join TM_PHONGBAN pb on pb.PHONGBAN_ID = kb.PHONGBAN_ID        left join TM_NHANVIEN nv on nv.NHANVIEN_ID = kb.BACSIKHAM_ID        left join (select * from LST_DICTIONARY where DICTIONARY_TYPE_CODE = 'GiaiQuyetKhamBenh') hgq on hgq.DICTIONARY_ID = kb.HUONGGIAIQUYET_ID        where kb.TIEPNHAN_ID = '27478'        ) D on D.TIEPNHAN_ID = A.TIEPNHAN_ID and D.DICHVU_ID = A.DICHVU_ID and C.KHAMBENH_NGOAITRU_ID = D.KHAMBENH_ID        left join (select * from TT_NGOAITRU_TOATHUOC where TIEPNHAN_ID = '27478') E on E.DUOC_ID = A.DUOC_ID and E.TOATHUOC_ID = A.REF_ID and A.REF_TABLE = 'TT_NGOAITRU_TOATHUOC'        left join TT_NGOAITRU_KHAMBENH_TOATHUOC tk on tk.KHAMBENH_TOATHUOC_ID = e.KHAMBENH_TOATHUOC_ID        left join TT_PHAUTHUAT_VTYT vtyt on vtyt.PHAUTHUAT_VTYT_ID = a.REF_ID and a.REF_TABLE = 'TT_PHAUTHUAT_VTYT'        left join TT_CLSKETQUA_VTYT kqvtyt on kqvtyt.CLSKETQUA_VTYT_ID = a.REF_ID and a.REF_TABLE = 'TT_CLSKETQUA_VTYT'        left join TM_DICHVU dv on A.DICHVU_ID = dv.DICHVU_ID and A.REF_TABLE = 'TT_DVYEUCAU'        left join TM_DUOC dc on A.DUOC_ID = dc.DUOC_ID        left join TM_LOAIDUOC ld on dc.LOAIDUOC_ID = ld.LOAIDUOC_ID        left join TM_NHOMDICHVU ndv on ndv.NHOMDICHVU_ID = dv.NHOMDICHVU_ID        where        A.TIEPNHAN_ID = '27478' and A.BENHVIEN_ID = 'HLU01' and (A.BENHAN_ID is NULL or A.BENHAN_ID = '')          and A.REF_TABLE != 'TT_DUOC_CHUNGTU_CHITIET' and A.KHONGTHUTIEN != '1'        and (exists (select KHAMBENH_ID from TT_NGOAITRU_KHAMBENH where A.KHAMBENH_ID = KHAMBENH_ID and TIEPNHAN_ID = '27478') or A.KHAMBENH_ID is null)        and (C.HUYYEUCAU = '0' or C.HUYYEUCAU is null)          AND             (A.BHYT_DONGIA > 0                           )                       and        (        (A.DICHVU_ID is not null and C.HUYYEUCAU != '1') or (A.DICHVU_ID is null and A.DUOC_ID is not null and A.REF_TABLE != 'TT_DUOC_CHUNGTU_CHITIET')        )        ORDER BY A.VIENPHI_ID]
2019-09-20 16:49:09,222 [1] DEBUG - Statement Id: [DAO00066_GetNhapVienById] PreparedStatement : [select *        from TT_NOITRU_NHAPVIEN        where TT_NOITRU_NHAPVIEN.TIEPNHAN_ID  = '27478' and TT_NOITRU_NHAPVIEN.TRANGTHAI = 'CHOXACNHAN' and TT_NOITRU_NHAPVIEN.LOAIBENHAN != 2        order by NHAPVIEN_ID desc]
2019-09-20 16:49:09,323 [1] DEBUG - Statement Id: [DAO00064_CheckBenhNhanChuaXSDVTYT] PreparedStatement : [IF EXISTS (        select vt.KHAMBENH_VTYT_ID        from TT_NGOAITRU_KHAMBENH_VTYT vt        inner join TT_NGOAITRU_KHAMBENH kb on kb.KHAMBENH_ID = vt.KHAMBENH_ID        where kb.TIEPNHAN_ID = 27478        and kb.BENHVIEN_ID = 'HLU01'        and vt.CHUNGTU_ID is null          union all          select vt.CLSKETQUA_VTYT_ID        from TT_CLSKETQUA_VTYT vt        inner join TT_DVYEUCAU yc on yc.DVYEUCAU_ID = vt.DVYEUCAU_ID and yc.BENHVIEN_ID = vt.BENHVIEN_ID        where yc.TIEPNHAN_ID = 27478        and yc.BENHVIEN_ID = 'HLU01'        and vt.CHUNGTU_ID is null        )        BEGIN        SELECT -1 AS RESULT        END        ELSE        BEGIN        SELECT 1 AS RESULT        END]
2019-09-20 16:49:11,999 [1] DEBUG - Statement Id: [DAO00019_GetDanhsachKhambenh] PreparedStatement : [select *        from        (SELECT COUNT(*) OVER() as TOTALROWS, ROW_NUMBER() OVER(order by isnull(dv.SOTHUTU,'999999999'), dv.NGAYGIOYEUCAU) as ROWNUMBER,        bn.MAYTE, bn.TENBENHNHAN, bn.NAMSINH, bn.NGAYSINH as TUOI, ISNULL(CONVERT(VARCHAR(10), bn.NGAYSINH, 103),CAST(bn.NAMSINH AS varchar)) as NGAYSINH, bn.DIACHILIENLAC as DIACHI, bn.GIOITINH, GD.DESCRIPTION as TENGIOITINH,        tn.DOITUONG_ID, tn.THOIGIANTIEPNHAN, tn.BENHNHAN_ID, tn.TIEPNHAN_ID, tn.TRAITUYEN, tn.SOTIEPNHAN,        dv.DICHVU_ID, dv.NOITHUCHIEN_ID, isnull(dv.NGAYTAO, dv.NGAYCAPNHAT) as THOIGIANDKDICHVU,        dv.KHAN, dv.NOIYEUCAU_ID, dv.NGAYGIOYEUCAU, dv.BACSICHIDINH_ID, dv.DONVIGIOITHIEU_ID, dv.NGUOIGIOITHIEU_ID,        tn.NOIGIOITHIEU_ID, kbnt.HUONGGIAIQUYET_ID,        dv.DVYEUCAU_ID, dv.MARIS, dv.TRANGTHAI as TRANGTHAICODE, B.TENNHOMDICHVU, dv.SOPHIEUYEUCAU, dv.KHAMBENH_NGOAITRU_ID, dv.NGUOICAPNHAT_ID, dv.NGAYCAPNHAT,        CASE WHEN Left(B.MANHOMDICHVU,2) = '03' THEN '02' ELSE Left(B.MANHOMDICHVU,2) END AS MANHOMDICHVU, B.MANHOMDICHVU as MANHOMDICHVUCHITIET, tn.TRANGTHAI as TRANGTHAI_TIEPNHAN,        'True' as DAKHAM, isnull(dv.SOTHUTU,'999999999') as SOHANGDOI,        vp.DATHANHTOAN, dv.TRANGTHAI_WFL,        BA.SOBENHAN, dv.CHANDOAN, dt.TENDOITUONG, isnull(kbnt.THOIGIANKHAM, dv.NGAYCAPNHAT) as THOIGIANKHAM,        tn.SOBHYT        FROM TT_DVYEUCAU (NOLOCK) dv        inner join TT_TIEPNHAN (NOLOCK) tn on dv.TIEPNHAN_ID = tn.TIEPNHAN_ID        inner join TT_BENHNHAN (NOLOCK) bn on tn.BENHNHAN_ID = bn.BENHNHAN_ID        inner join TM_DICHVU A on A.DICHVU_ID = dv.DICHVU_ID        inner join TM_NHOMDICHVU B on B.NHOMDICHVU_ID = A.NHOMDICHVU_ID        inner join TT_VIENPHI(NOLOCK) VP on VP.TIEPNHAN_ID = tn.TIEPNHAN_ID and VP.DICHVU_ID = dv.DICHVU_ID and VP.REF_ID = dv.DVYEUCAU_ID        left join TT_NOITRU_BENHAN (NOLOCK) BA on BA.TIEPNHAN_ID = tn.TIEPNHAN_ID AND dv.BENHAN_ID = BA.BENHAN_ID        inner join TM_GENDER GD on GD.ID = bn.GIOITINH        left join TT_NGOAITRU_KHAMBENH (NOLOCK) kbnt on kbnt.KHAMBENH_ID = dv.KHAMBENH_NGOAITRU_ID        inner join TM_DOITUONG dt on dt.DOITUONG_ID = tn.DOITUONG_ID        where        dv.DICHVU_ID IS NOT NULL        and tn.BENHVIEN_ID = 'HLU01'        and HUYYEUCAU = 0        and dv.NGAYHENCLS is NULL         and           dv.NGAYYEUCAU >= '9/20/2019 12:00:00 AM'         and           dv.NGAYYEUCAU <= '9/20/2019 12:00:00 AM'         and           dv.NOITHUCHIEN_ID = 58          AND              (dv.TRANGTHAI != 'CHUAKETQUA' or isnull(kbnt.HUONGGIAIQUYET_ID, 0) > 0)           and           (CASE WHEN Left(B.MANHOMDICHVU,2) = '03' THEN '02' ELSE Left(B.MANHOMDICHVU,2) END) = '04'                 ) lst                    where          lst.ROWNUMBER between 1 and 20                 order by SOHANGDOI, NGAYGIOYEUCAU asc]
2019-09-20 16:49:13,357 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'OPD02'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2019-09-20 16:49:14,486 [1] DEBUG - Statement Id: [DAO00017_GetLoaiGiaByDoiTuongId] PreparedStatement : [select dtlg.DOUUTIEN, dtlg.DOITUONG_ID, lg.LOAIGIA_ID, lg.TENLOAIGIA, lg.MALOAIGIA              from TM_LOAIGIA lg              left join TM_DOITUONG_LOAIGIA dtlg              on lg.LOAIGIA_ID = dtlg.LOAIGIA_ID and dtlg.BENHVIEN_ID = 'HLU01'              where lg.TAMNGUNG = 0 and lg.BENHVIEN_ID = 'HLU01'                             order by dtlg.DOUUTIEN]
2019-09-20 16:49:14,676 [1] DEBUG - Statement Id: [DAO00092_GetList_ToathuocNgoaitru] PreparedStatement : [select A.*, B.PHAMVI_ID, C.KHODUOC_ID from TM_TOATHUOC_NGOAITRU A        left join TM_DUOC_PHAMVISUDUNG B on B.MAPHAMVI = A.MAPHAMVI        left join (select distinct PHAMVI_ID, KHODUOC_ID from TM_DUOC_PHAMVISD_MAPPING) C on C.PHAMVI_ID = B.PHAMVI_ID        where A.TAMNGUNG != '1' and A.BENHVIEN_ID = 'HLU01'        ORDER BY A.SAPXEP ASC]
2019-09-20 16:49:18,813 [1] DEBUG - Statement Id: [DAO00019_ThongTinBenhNhanDvYeuCau] PreparedStatement : [select distinct A.SOTIEPNHAN, A.TIEPNHAN_ID, A.DOITUONG_ID, A.TRANGTHAI,        A.LOAITHANHVIEN_ID, A.SUDUNG_BHTN, A.THE_ID, A.THANHVIEN_ID, A.VIP, A.NGUON_BENHNHAN_ID, A.BAOLANH_VIENPHI, A.NGAYMIENDONGCHITRA,        B.*,  C.DICHVU_ID, C.DVYEUCAU_ID, C.NOITHUCHIEN_ID, A.SOBHYT        from TT_TIEPNHAN A        inner join TT_DVYEUCAU C on C.TIEPNHAN_ID = A.TIEPNHAN_ID        inner join TT_BENHNHAN B on B.BENHNHAN_ID = A.BENHNHAN_ID and B.ACTIVE = '1'        where                    C.DVYEUCAU_ID = '205440'                 and A.BENHVIEN_ID = 'HLU01']
2019-09-20 16:49:18,973 [1] DEBUG - Statement Id: [DAO00017_GetLoaiGiaByDoiTuongId] PreparedStatement : [select dtlg.DOUUTIEN, dtlg.DOITUONG_ID, lg.LOAIGIA_ID, lg.TENLOAIGIA, lg.MALOAIGIA              from TM_LOAIGIA lg              left join TM_DOITUONG_LOAIGIA dtlg              on lg.LOAIGIA_ID = dtlg.LOAIGIA_ID and dtlg.BENHVIEN_ID = 'HLU01'              where lg.TAMNGUNG = 0 and lg.BENHVIEN_ID = 'HLU01'                             order by dtlg.DOUUTIEN]
2019-09-20 16:49:19,056 [1] DEBUG - Statement Id: [DAO00014_KiemTraDVYCCoBHYT] PreparedStatement : [select *        from TT_VIENPHI        where REF_ID  = '205440' and REF_TABLE = 'TT_DVYEUCAU' and BHYT_DONGIA > 0]
2019-09-20 16:49:19,100 [1] DEBUG - Statement Id: [DAO00040_LayListToaMau] PreparedStatement : [select A.*, dc.TENDUOCDAYDU, dc.BHYT DUOC_BHYT, ld.LOAIVATTU_ID, ld.MALOAIDUOC, dd.DICTIONARY_NAME DUONGDUNG, dc.TAMNGUNG            from TT_TOATHUOCMAU A            left join TM_DUOC dc on A.DUOC_ID = dc.DUOC_ID            left join TM_LOAIDUOC ld on dc.LOAIDUOC_ID = ld.LOAIDUOC_ID            left join (select * from LST_DICTIONARY where DICTIONARY_TYPE_CODE like 'DuongDung') dd on dd.DICTIONARY_ID = dc.DUONGDUNG_ID            where (1=1)             and               A.BACSI_ID  = 1              and A.LOAITOATHUOC in  (                        @param0                   ,                           @param1                   ,                           @param2                   ,                           @param3                   )]
2019-09-20 16:49:19,101 [1] DEBUG - Statement Id: [DAO00040_LayListToaMau] Parameters: [@param0=[LSTLOAITOATHUOC[0],BV], @param1=[LSTLOAITOATHUOC[1],MN], @param2=[LSTLOAITOATHUOC[2],MP], @param3=[LSTLOAITOATHUOC[3],TV]]
2019-09-20 16:49:19,101 [1] DEBUG - Statement Id: [DAO00040_LayListToaMau] Types: [@param0=[String, System.String], @param1=[String, System.String], @param2=[String, System.String], @param3=[String, System.String]]
2019-09-20 16:49:19,194 [1] DEBUG - Statement Id: [DAO00040_LayListToaMau] PreparedStatement : [select A.*, dc.TENDUOCDAYDU, dc.BHYT DUOC_BHYT, ld.LOAIVATTU_ID, ld.MALOAIDUOC, dd.DICTIONARY_NAME DUONGDUNG, dc.TAMNGUNG            from TT_TOATHUOCMAU A            left join TM_DUOC dc on A.DUOC_ID = dc.DUOC_ID            left join TM_LOAIDUOC ld on dc.LOAIDUOC_ID = ld.LOAIDUOC_ID            left join (select * from LST_DICTIONARY where DICTIONARY_TYPE_CODE like 'DuongDung') dd on dd.DICTIONARY_ID = dc.DUONGDUNG_ID            where (1=1)             and               A.BACSI_ID  = 1              and A.LOAITOATHUOC in  (                        @param0                   ,                           @param1                   ,                           @param2                   ,                           @param3                   )]
2019-09-20 16:49:19,194 [1] DEBUG - Statement Id: [DAO00040_LayListToaMau] Parameters: [@param0=[LSTLOAITOATHUOC[0],BV], @param1=[LSTLOAITOATHUOC[1],MN], @param2=[LSTLOAITOATHUOC[2],MP], @param3=[LSTLOAITOATHUOC[3],TV]]
2019-09-20 16:49:19,194 [1] DEBUG - Statement Id: [DAO00040_LayListToaMau] Types: [@param0=[String, System.String], @param1=[String, System.String], @param2=[String, System.String], @param3=[String, System.String]]
2019-09-20 16:49:19,290 [1] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoVaBookingCOM23UpdateRedis_TheoPhamvi] PreparedStatement : [declare @TOAMUANGOAI int = 0;        select @TOAMUANGOAI = isnull(VALUE,0) from TM_SYS_APPSETTINGS where CODE = 'OPD_TOAMUANGOAI_DUNGDANHMUC_DUOC'                if @TOAMUANGOAI = 1        begin        select  distinct '0' + '_' + LTRIM(d.DUOC_ID) + '_' + '0' as DUOC_KEY, 999999999 as SOLUONG        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        where  @param0  = 0        union all        select distinct tk.DUOC_KEY, tk.SOLUONG        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        inner join        (        select  LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')) DUOC_KEY, (SUM(dtk.SOLUONG) - isnull(sum(A.SOLUONG),0) - isnull(sum(B.SOLUONG),0)) SOLUONG, pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        from (select sum(soluong) soluong,duoc_id,nguonduoc_id,khoduoc_id,benhvien_id from TT_DUOC_TONKHO  group by duoc_id,nguonduoc_id,khoduoc_id,benhvien_id) dtk        inner join TM_DUOC_PHAMVISD_MAPPING pvsd on dtk.KHODUOC_ID = pvsd.KHODUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NOITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) B on B.DUOC_ID = dtk.DUOC_ID and B.PHAMVI_ID = pvsd.PHAMVI_ID and B.NGUONHANG_ID = dtk.NGUONDUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NGOAITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) A on A.DUOC_ID = dtk.DUOC_ID and A.PHAMVI_ID = pvsd.PHAMVI_ID and A.NGUONHANG_ID = dtk.NGUONDUOC_ID        where dtk.BENHVIEN_ID = 'HLU01'        group by LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')), pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        ) tk on tk.DUOC_ID = d.DUOC_ID        left join TM_DUOC_PHAMVISUDUNG kd on kd.PHAMVI_ID = tk.PHAMVI_ID and kd.BENHVIEN_ID = 'HLU01'        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = tk.NGUONDUOC_ID and nh.BENHVIEN_ID = 'HLU01'        where d.BENHVIEN_ID = 'HLU01' and tk.PHAMVI_ID =  @param0         end        else        begin        select distinct tk.DUOC_KEY, tk.SOLUONG        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        inner join        (        select  LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')) DUOC_KEY, (SUM(dtk.SOLUONG) - isnull(sum(A.SOLUONG),0) - isnull(sum(B.SOLUONG),0)) SOLUONG, pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        from (select sum(soluong) soluong,duoc_id,nguonduoc_id,khoduoc_id,benhvien_id from TT_DUOC_TONKHO  group by duoc_id,nguonduoc_id,khoduoc_id,benhvien_id) dtk        inner join TM_DUOC_PHAMVISD_MAPPING pvsd on dtk.KHODUOC_ID = pvsd.KHODUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NOITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) B on B.DUOC_ID = dtk.DUOC_ID and B.PHAMVI_ID = pvsd.PHAMVI_ID and B.NGUONHANG_ID = dtk.NGUONDUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NGOAITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) A on A.DUOC_ID = dtk.DUOC_ID and A.PHAMVI_ID = pvsd.PHAMVI_ID and A.NGUONHANG_ID = dtk.NGUONDUOC_ID        where dtk.BENHVIEN_ID = 'HLU01'        group by LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')), pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        ) tk on tk.DUOC_ID = d.DUOC_ID        left join TM_DUOC_PHAMVISUDUNG kd on kd.PHAMVI_ID = tk.PHAMVI_ID and kd.BENHVIEN_ID = 'HLU01'        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = tk.NGUONDUOC_ID and nh.BENHVIEN_ID = 'HLU01'        where d.BENHVIEN_ID = 'HLU01' and tk.PHAMVI_ID =  @param0         end]
2019-09-20 16:49:19,290 [1] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoVaBookingCOM23UpdateRedis_TheoPhamvi] Parameters: [@param0=[PHAMVI_ID,1028]]
2019-09-20 16:49:19,290 [1] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoVaBookingCOM23UpdateRedis_TheoPhamvi] Types: [@param0=[Int64, System.Int64]]
2019-09-20 16:49:19,551 [1] DEBUG - Statement Id: [DAO00013_GetTienSuBenh] PreparedStatement : [select TIENSUBENH, TIENSUDIUNG              from TT_BENHNHAN              where TT_BENHNHAN.BENHNHAN_ID  = '23423']
2019-09-20 16:49:19,717 [1] DEBUG - Statement Id: [DAO00095_GetTTDiUngThuoc] PreparedStatement : [select *              from TT_BENHNHAN_DIUNG_THUOC              where BENHNHAN_ID = '23423'              and BENHVIEN_ID = 'HLU01']
2019-09-20 16:49:19,750 [1] DEBUG - Statement Id: [DAO00014_GetTotalChiPhiDVByTiepNhan] PreparedStatement : [select sum(THANHTIEN_DOANHTHU) as THANHTIEN_DOANHTHU from TT_VIENPHI        where ACTIVE = '1'        and TIEPNHAN_ID = '27478'        and REF_TABLE = 'TT_DVYEUCAU'        and exists (select DVYEUCAU_ID from TT_DVYEUCAU where HUYYEUCAU = '0' and TIEPNHAN_ID = '27478' and TT_VIENPHI.REF_ID = DVYEUCAU_ID)]
2019-09-20 16:49:19,788 [1] DEBUG - Statement Id: [DAO00014_GetKhamBenhInfo] PreparedStatement : [select * from TT_NGOAITRU_KHAMBENH where KHAMBENH_ID =        (select KHAMBENH_NGOAITRU_ID from TT_DVYEUCAU where DVYEUCAU_ID = '205440')]
2019-09-20 16:49:19,823 [1] DEBUG - Statement Id: [DAO00068_GetSinhHieuBySinhHieuID] PreparedStatement : [select top (1) *            from TT_NGOAITRU_KHAMBENH_SINHHIEU            where KHAMBENH_SINHHIEU_ID = '0'            and BENHVIEN_ID = 'HLU01'             and               BENHNHAN_ID = '23423'                           order by KHAMBENH_SINHHIEU_ID]
2019-09-20 16:49:19,953 [1] DEBUG - Statement Id: [DAO00014_GetKhamBenhICDInfo] PreparedStatement : [select *        from TT_NGOAITRU_KHAMBENH_ICD        where KHAMBENH_ID  = '26172']
2019-09-20 16:49:19,985 [1] DEBUG - Statement Id: [DAO00014_GetListToaThuoc] PreparedStatement : [select A.*        from TT_NGOAITRU_KHAMBENH_TOATHUOC A        where A.KHAMBENH_ID = '26172']
2019-09-20 16:49:20,014 [1] DEBUG - Statement Id: [DAO00014_KiemTraDVYCCoBHYT] PreparedStatement : [select *        from TT_VIENPHI        where REF_ID  = '205440' and REF_TABLE = 'TT_DVYEUCAU' and BHYT_DONGIA > 0]
2019-09-20 16:49:20,052 [1] DEBUG - Statement Id: [DAO00040_LayListToaMau] PreparedStatement : [select A.*, dc.TENDUOCDAYDU, dc.BHYT DUOC_BHYT, ld.LOAIVATTU_ID, ld.MALOAIDUOC, dd.DICTIONARY_NAME DUONGDUNG, dc.TAMNGUNG            from TT_TOATHUOCMAU A            left join TM_DUOC dc on A.DUOC_ID = dc.DUOC_ID            left join TM_LOAIDUOC ld on dc.LOAIDUOC_ID = ld.LOAIDUOC_ID            left join (select * from LST_DICTIONARY where DICTIONARY_TYPE_CODE like 'DuongDung') dd on dd.DICTIONARY_ID = dc.DUONGDUNG_ID            where (1=1)             and               A.BACSI_ID  = 1              and A.LOAITOATHUOC in  (                        @param0                   ,                           @param1                   ,                           @param2                   ,                           @param3                   )]
2019-09-20 16:49:20,052 [1] DEBUG - Statement Id: [DAO00040_LayListToaMau] Parameters: [@param0=[LSTLOAITOATHUOC[0],BV], @param1=[LSTLOAITOATHUOC[1],MN], @param2=[LSTLOAITOATHUOC[2],MP], @param3=[LSTLOAITOATHUOC[3],TV]]
2019-09-20 16:49:20,052 [1] DEBUG - Statement Id: [DAO00040_LayListToaMau] Types: [@param0=[String, System.String], @param1=[String, System.String], @param2=[String, System.String], @param3=[String, System.String]]
2019-09-20 16:49:20,121 [1] DEBUG - Statement Id: [DAO00040_LayListToaMau] PreparedStatement : [select A.*, dc.TENDUOCDAYDU, dc.BHYT DUOC_BHYT, ld.LOAIVATTU_ID, ld.MALOAIDUOC, dd.DICTIONARY_NAME DUONGDUNG, dc.TAMNGUNG            from TT_TOATHUOCMAU A            left join TM_DUOC dc on A.DUOC_ID = dc.DUOC_ID            left join TM_LOAIDUOC ld on dc.LOAIDUOC_ID = ld.LOAIDUOC_ID            left join (select * from LST_DICTIONARY where DICTIONARY_TYPE_CODE like 'DuongDung') dd on dd.DICTIONARY_ID = dc.DUONGDUNG_ID            where (1=1)             and               A.BACSI_ID  = 1              and A.LOAITOATHUOC in  (                        @param0                   ,                           @param1                   ,                           @param2                   ,                           @param3                   )]
2019-09-20 16:49:20,121 [1] DEBUG - Statement Id: [DAO00040_LayListToaMau] Parameters: [@param0=[LSTLOAITOATHUOC[0],BV], @param1=[LSTLOAITOATHUOC[1],MN], @param2=[LSTLOAITOATHUOC[2],MP], @param3=[LSTLOAITOATHUOC[3],TV]]
2019-09-20 16:49:20,121 [1] DEBUG - Statement Id: [DAO00040_LayListToaMau] Types: [@param0=[String, System.String], @param1=[String, System.String], @param2=[String, System.String], @param3=[String, System.String]]
2019-09-20 16:49:20,235 [1] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoVaBookingCOM23UpdateRedis_TheoPhamvi] PreparedStatement : [declare @TOAMUANGOAI int = 0;        select @TOAMUANGOAI = isnull(VALUE,0) from TM_SYS_APPSETTINGS where CODE = 'OPD_TOAMUANGOAI_DUNGDANHMUC_DUOC'                if @TOAMUANGOAI = 1        begin        select  distinct '0' + '_' + LTRIM(d.DUOC_ID) + '_' + '0' as DUOC_KEY, 999999999 as SOLUONG        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        where  @param0  = 0        union all        select distinct tk.DUOC_KEY, tk.SOLUONG        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        inner join        (        select  LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')) DUOC_KEY, (SUM(dtk.SOLUONG) - isnull(sum(A.SOLUONG),0) - isnull(sum(B.SOLUONG),0)) SOLUONG, pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        from (select sum(soluong) soluong,duoc_id,nguonduoc_id,khoduoc_id,benhvien_id from TT_DUOC_TONKHO  group by duoc_id,nguonduoc_id,khoduoc_id,benhvien_id) dtk        inner join TM_DUOC_PHAMVISD_MAPPING pvsd on dtk.KHODUOC_ID = pvsd.KHODUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NOITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) B on B.DUOC_ID = dtk.DUOC_ID and B.PHAMVI_ID = pvsd.PHAMVI_ID and B.NGUONHANG_ID = dtk.NGUONDUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NGOAITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) A on A.DUOC_ID = dtk.DUOC_ID and A.PHAMVI_ID = pvsd.PHAMVI_ID and A.NGUONHANG_ID = dtk.NGUONDUOC_ID        where dtk.BENHVIEN_ID = 'HLU01'        group by LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')), pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        ) tk on tk.DUOC_ID = d.DUOC_ID        left join TM_DUOC_PHAMVISUDUNG kd on kd.PHAMVI_ID = tk.PHAMVI_ID and kd.BENHVIEN_ID = 'HLU01'        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = tk.NGUONDUOC_ID and nh.BENHVIEN_ID = 'HLU01'        where d.BENHVIEN_ID = 'HLU01' and tk.PHAMVI_ID =  @param0         end        else        begin        select distinct tk.DUOC_KEY, tk.SOLUONG        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        inner join        (        select  LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')) DUOC_KEY, (SUM(dtk.SOLUONG) - isnull(sum(A.SOLUONG),0) - isnull(sum(B.SOLUONG),0)) SOLUONG, pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        from (select sum(soluong) soluong,duoc_id,nguonduoc_id,khoduoc_id,benhvien_id from TT_DUOC_TONKHO  group by duoc_id,nguonduoc_id,khoduoc_id,benhvien_id) dtk        inner join TM_DUOC_PHAMVISD_MAPPING pvsd on dtk.KHODUOC_ID = pvsd.KHODUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NOITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) B on B.DUOC_ID = dtk.DUOC_ID and B.PHAMVI_ID = pvsd.PHAMVI_ID and B.NGUONHANG_ID = dtk.NGUONDUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NGOAITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) A on A.DUOC_ID = dtk.DUOC_ID and A.PHAMVI_ID = pvsd.PHAMVI_ID and A.NGUONHANG_ID = dtk.NGUONDUOC_ID        where dtk.BENHVIEN_ID = 'HLU01'        group by LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')), pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        ) tk on tk.DUOC_ID = d.DUOC_ID        left join TM_DUOC_PHAMVISUDUNG kd on kd.PHAMVI_ID = tk.PHAMVI_ID and kd.BENHVIEN_ID = 'HLU01'        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = tk.NGUONDUOC_ID and nh.BENHVIEN_ID = 'HLU01'        where d.BENHVIEN_ID = 'HLU01' and tk.PHAMVI_ID =  @param0         end]
2019-09-20 16:49:20,235 [1] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoVaBookingCOM23UpdateRedis_TheoPhamvi] Parameters: [@param0=[PHAMVI_ID,1028]]
2019-09-20 16:49:20,235 [1] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoVaBookingCOM23UpdateRedis_TheoPhamvi] Types: [@param0=[Int64, System.Int64]]
2019-09-20 16:49:20,499 [1] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoVaBookingCOM23UpdateRedis_TheoPhamvi] PreparedStatement : [declare @TOAMUANGOAI int = 0;        select @TOAMUANGOAI = isnull(VALUE,0) from TM_SYS_APPSETTINGS where CODE = 'OPD_TOAMUANGOAI_DUNGDANHMUC_DUOC'                if @TOAMUANGOAI = 1        begin        select  distinct '0' + '_' + LTRIM(d.DUOC_ID) + '_' + '0' as DUOC_KEY, 999999999 as SOLUONG        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        where  @param0  = 0        union all        select distinct tk.DUOC_KEY, tk.SOLUONG        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        inner join        (        select  LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')) DUOC_KEY, (SUM(dtk.SOLUONG) - isnull(sum(A.SOLUONG),0) - isnull(sum(B.SOLUONG),0)) SOLUONG, pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        from (select sum(soluong) soluong,duoc_id,nguonduoc_id,khoduoc_id,benhvien_id from TT_DUOC_TONKHO  group by duoc_id,nguonduoc_id,khoduoc_id,benhvien_id) dtk        inner join TM_DUOC_PHAMVISD_MAPPING pvsd on dtk.KHODUOC_ID = pvsd.KHODUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NOITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) B on B.DUOC_ID = dtk.DUOC_ID and B.PHAMVI_ID = pvsd.PHAMVI_ID and B.NGUONHANG_ID = dtk.NGUONDUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NGOAITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) A on A.DUOC_ID = dtk.DUOC_ID and A.PHAMVI_ID = pvsd.PHAMVI_ID and A.NGUONHANG_ID = dtk.NGUONDUOC_ID        where dtk.BENHVIEN_ID = 'HLU01'        group by LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')), pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        ) tk on tk.DUOC_ID = d.DUOC_ID        left join TM_DUOC_PHAMVISUDUNG kd on kd.PHAMVI_ID = tk.PHAMVI_ID and kd.BENHVIEN_ID = 'HLU01'        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = tk.NGUONDUOC_ID and nh.BENHVIEN_ID = 'HLU01'        where d.BENHVIEN_ID = 'HLU01' and tk.PHAMVI_ID =  @param0         end        else        begin        select distinct tk.DUOC_KEY, tk.SOLUONG        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        inner join        (        select  LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')) DUOC_KEY, (SUM(dtk.SOLUONG) - isnull(sum(A.SOLUONG),0) - isnull(sum(B.SOLUONG),0)) SOLUONG, pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        from (select sum(soluong) soluong,duoc_id,nguonduoc_id,khoduoc_id,benhvien_id from TT_DUOC_TONKHO  group by duoc_id,nguonduoc_id,khoduoc_id,benhvien_id) dtk        inner join TM_DUOC_PHAMVISD_MAPPING pvsd on dtk.KHODUOC_ID = pvsd.KHODUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NOITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) B on B.DUOC_ID = dtk.DUOC_ID and B.PHAMVI_ID = pvsd.PHAMVI_ID and B.NGUONHANG_ID = dtk.NGUONDUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NGOAITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) A on A.DUOC_ID = dtk.DUOC_ID and A.PHAMVI_ID = pvsd.PHAMVI_ID and A.NGUONHANG_ID = dtk.NGUONDUOC_ID        where dtk.BENHVIEN_ID = 'HLU01'        group by LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')), pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        ) tk on tk.DUOC_ID = d.DUOC_ID        left join TM_DUOC_PHAMVISUDUNG kd on kd.PHAMVI_ID = tk.PHAMVI_ID and kd.BENHVIEN_ID = 'HLU01'        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = tk.NGUONDUOC_ID and nh.BENHVIEN_ID = 'HLU01'        where d.BENHVIEN_ID = 'HLU01' and tk.PHAMVI_ID =  @param0         end]
2019-09-20 16:49:20,499 [1] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoVaBookingCOM23UpdateRedis_TheoPhamvi] Parameters: [@param0=[PHAMVI_ID,1028]]
2019-09-20 16:49:20,499 [1] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoVaBookingCOM23UpdateRedis_TheoPhamvi] Types: [@param0=[Int64, System.Int64]]
2019-09-20 16:49:21,168 [1] DEBUG - Statement Id: [DAO00068_GetLastedSinhHieuInfo] PreparedStatement : [select top (1) *, CHISOBMI as BMI              from TT_NGOAITRU_KHAMBENH_SINHHIEU              where BENHNHAN_ID = '23423'              order by KHAMBENH_SINHHIEU_ID desc]
2019-09-20 16:49:27,195 [1] DEBUG - Statement Id: [DAO00014_GetPatientStatus] PreparedStatement : [select        CASE        when tn.TRANGTHAI = 'HOANTHANH' Then tn.TRANGTHAI        WHEN xncp.XACNHANCHIPHI_ID is not null THEN 'XACNHANCHIPHI'        WHEN (tn.KHOADULIEU = '1') THEN 'KHOADULIEU'        ELSE tn.TRANGTHAI        END        as TRANGTHAI        from TT_TIEPNHAN tn        left join TT_XACNHANCHIPHI xncp on tn.TIEPNHAN_ID = xncp.TIEPNHAN_ID        where tn.TIEPNHAN_ID = '27478'        and tn.BENHVIEN_ID = 'HLU01']
2019-09-20 16:49:27,285 [1] DEBUG - Statement Id: [DAO00014_GetThongtinKhamsuckhoeTheoDVyc] PreparedStatement : [select HOPDONG_ID, HOPDONG_BENHNHAN_ID from TT_DVYEUCAU where DVYEUCAU_ID =  @param0]
2019-09-20 16:49:27,285 [1] DEBUG - Statement Id: [DAO00014_GetThongtinKhamsuckhoeTheoDVyc] Parameters: [@param0=[DVYEUCAU_ID,205440]]
2019-09-20 16:49:27,285 [1] DEBUG - Statement Id: [DAO00014_GetThongtinKhamsuckhoeTheoDVyc] Types: [@param0=[Int64, System.Int64]]
2019-09-20 16:49:27,322 [1] DEBUG - Statement Id: [DAO00009_TT_TIEPNHAN_GetProcess] PreparedStatement : [select PROCESS_ID from TT_TIEPNHAN where SOTIEPNHAN = 'TN190920.0000001']
2019-09-20 16:49:27,424 [1] DEBUG - Statement Id: [DAOWF004_laytrangthaiDV] PreparedStatement : [select top 1 A.CURR_STATE_CODE as STATE_CODE, isNull(C.SHORT_NAME,C.NAME) as TRANGTHAI, C.NAME as TRANGTHAI_CHITIET, C.STATUS_CODE, D.ISACTIVE as ACTIVE, E.STATUS_CODE  as OLD_STATUSCODE        from TT_REQUEST_SERVICE_DETAIL A                left join (select * from TT_REQUEST_SERVICE where PARA = '{"DICHVU_ID":"5685","DVYEUCAU_ID":"205440"}') D on D.ID = A.REQUEST_SERVICE_ID        left join TM_STATE C on A.CURR_STATE_CODE = C.STATE_CODE and C.PROCESS_CODE = D.PROCESS_CODE        left join TM_STATE E on A.OLD_STATE_CODE = E.STATE_CODE and E.PROCESS_CODE = D.PROCESS_CODE        where        A.REQUEST_SERVICE_ID = (select top 1 ID from TT_REQUEST_SERVICE where PARA = '{"DICHVU_ID":"5685","DVYEUCAU_ID":"205440"}' order by ID desc)        order by A.ID desc]
2019-09-20 16:49:27,486 [1] DEBUG - Statement Id: [DAO00014_CheckExistNhapVien] PreparedStatement : [select NHAPVIEN_ID        from TT_NOITRU_NHAPVIEN        where TIEPNHAN_ID  = '27478'        and TRANGTHAI != 'CHOXACNHAN']
2019-09-20 16:49:27,525 [1] DEBUG - Statement Id: [DAO00014_CheckExistCapCuu] PreparedStatement : [select THONGTINCAPCUU_ID        from TT_TIEPNHAN_THONGTINCAPCUU        where TIEPNHAN_ID  = '27478' and BENHVIEN_ID = 'HLU01']
2019-09-20 16:49:27,554 [1] DEBUG - Statement Id: [DAO00014_CheckExistChuyenVien] PreparedStatement : [select CHUYENVIEN_ID        from TT_CHUYENVIEN        where TIEPNHAN_ID  = '27478']
2019-09-20 16:49:27,586 [1] DEBUG - Statement Id: [DAO00014_GetTrangThaiTiepNhan] PreparedStatement : [select tn.TIEPNHAN_ID, tn.KHOADULIEU, xncp.XACNHANCHIPHI_ID from TT_TIEPNHAN tn        left join TT_XACNHANCHIPHI xncp        on tn.TIEPNHAN_ID = xncp.TIEPNHAN_ID        where tn.TIEPNHAN_ID = '27478'        and tn.BENHVIEN_ID = 'HLU01']
2019-09-20 16:49:27,629 [1] DEBUG - Statement Id: [DAO00014_GetListToaThuoc] PreparedStatement : [select A.*        from TT_NGOAITRU_KHAMBENH_TOATHUOC A        where A.KHAMBENH_ID = '26172']
2019-09-20 16:49:27,685 [1] DEBUG - Statement Id: [DAOLOG01_LockBegin] PreparedStatement : [INSERT into TT_LOG_UPDATE ( REF_TABLE , REF_ID , BENHVIEN_ID )         values ( @param0 ,  @param1 ,  @param2 );]
2019-09-20 16:49:27,685 [1] DEBUG - Statement Id: [DAOLOG01_LockBegin] Parameters: [@param0=[REF_TABLE,TT_NGOAITRU_KHAMBENH], @param1=[REF_ID,27478], @param2=[BENHVIEN_ID,HLU01]]
2019-09-20 16:49:27,685 [1] DEBUG - Statement Id: [DAOLOG01_LockBegin] Types: [@param0=[String, System.String], @param1=[Int64, System.Int64], @param2=[String, System.String]]
2019-09-20 16:49:27,732 [1] DEBUG - Statement Id: [DAO00014_GetTTNhapVien] PreparedStatement : [select *        from TT_NOITRU_NHAPVIEN        where TIEPNHAN_ID  = '27478']
2019-09-20 16:49:27,802 [1] DEBUG - Statement Id: [DAO00014_GetTTDVYeucauOPD] PreparedStatement : [select A.KHAMBENH_NGOAITRU_ID, B.KHAMBENH_ID        from TT_DVYEUCAU A        left join TT_NGOAITRU_KHAMBENH B on A.KHAMBENH_NGOAITRU_ID = B.KHAMBENH_ID        where A.DVYEUCAU_ID = '205440' and A.TIEPNHAN_ID =  @param0]
2019-09-20 16:49:27,802 [1] DEBUG - Statement Id: [DAO00014_GetTTDVYeucauOPD] Parameters: [@param0=[TIEPNHAN_ID,27478]]
2019-09-20 16:49:27,802 [1] DEBUG - Statement Id: [DAO00014_GetTTDVYeucauOPD] Types: [@param0=[String, System.String]]
2019-09-20 16:49:27,833 [1] DEBUG - Statement Id: [DAO00014_Update] PreparedStatement : [update TT_NGOAITRU_KHAMBENH set        BENHNHAN_ID =  @param0         , DICHVU_ID =  @param1                 , NGAYKHAM =  @param2         , CHANDOANICD_ID =  @param3         , HUONGGIAIQUYET_ID =  @param4                 , YEUCAUCHITIET_ID =  @param5         , CHANDOANKHOAKHAM =  @param6         , SONGAYHENTAIKHAM =  @param7         , NHANAP_MT =  @param8         , NHANAP_MP =  @param9         , CHANDOANPHUICD_ID =  @param10         , TRIEUCHUNGLAMSANG =  @param11         , HUYETAPTHAP =  @param12         , HUYETAPCAO =  @param13         , BENHMANTINH_ID =  @param14         , NHAPKHOA_ID =  @param15         , CHANDOANSOBOICD_ID =  @param16         , CHANDOANSOBO =  @param17         , CHUYENDENBENHVIEN_ID =  @param18         , LYDONHAPVIEN_ID =  @param19         , NGHIOM_TUNGAY =  @param20         , NGHIOM_DENNGAY =  @param21         , TLDG_MT_TEXT =  @param22         , TLDG_MP_TEXT =  @param23         , TKLT_MP_TEXT =  @param24         , TKLT_MT_TEXT =  @param25         , SIEUHIENVI =  @param26         , SOIDAYMAT =  @param27         , MACH =  @param28         , CANNANG =  @param29         , CHIEUCAO =  @param30         , BMI =  @param31         , NHIPTHO =  @param32         , NHIETDO =  @param33         , GHICHU =  @param34         , KHOADULIEU =  @param35         , NGUOIKHOA_ID =  @param36         , NGAYKHOA =  @param37         , THOIGIANKHOA =  @param38         , NGAYCAPNHAT =  @param39         , NGUOICAPNHAT_ID =  @param40         , KHAMBENH_SINHHIEU_ID =  @param41         where        KHAMBENH_ID =  @param42]
2019-09-20 16:49:27,833 [1] DEBUG - Statement Id: [DAO00014_Update] Parameters: [@param0=[BENHNHAN_ID,23423], @param1=[DICHVU_ID,5685], @param2=[NGAYKHAM,9/20/2019 12:00:00 AM], @param3=[CHANDOANICD_ID,3990], @param4=[HUONGGIAIQUYET_ID,8343], @param5=[YEUCAUCHITIET_ID,null], @param6=[CHANDOANKHOAKHAM,Viêm phế quản cấp(J20)], @param7=[SONGAYHENTAIKHAM,null], @param8=[NHANAP_MT,null], @param9=[NHANAP_MP,null], @param10=[CHANDOANPHUICD_ID,null], @param11=[TRIEUCHUNGLAMSANG,test], @param12=[HUYETAPTHAP,null], @param13=[HUYETAPCAO,null], @param14=[BENHMANTINH_ID,null], @param15=[NHAPKHOA_ID,null], @param16=[CHANDOANSOBOICD_ID,null], @param17=[CHANDOANSOBO,], @param18=[CHUYENDENBENHVIEN_ID,null], @param19=[LYDONHAPVIEN_ID,null], @param20=[NGHIOM_TUNGAY,null], @param21=[NGHIOM_DENNGAY,null], @param22=[TLDG_MT_TEXT,], @param23=[TLDG_MP_TEXT,], @param24=[TKLT_MP_TEXT,], @param25=[TKLT_MT_TEXT,], @param26=[SIEUHIENVI,], @param27=[SOIDAYMAT,], @param28=[MACH,null], @param29=[CANNANG,null], @param30=[CHIEUCAO,null], @param31=[BMI,null], @param32=[NHIPTHO,null], @param33=[NHIETDO,null], @param34=[GHICHU,], @param35=[KHOADULIEU,0], @param36=[NGUOIKHOA_ID,null], @param37=[NGAYKHOA,null], @param38=[THOIGIANKHOA,null], @param39=[NGAYCAPNHAT,9/20/2019 4:49:27 PM], @param40=[NGUOICAPNHAT_ID,1], @param41=[KHAMBENH_SINHHIEU_ID,0], @param42=[KHAMBENH_ID,26172]]
2019-09-20 16:49:27,833 [1] DEBUG - Statement Id: [DAO00014_Update] Types: [@param0=[Int64, System.Int64], @param1=[Int64, System.Int64], @param2=[DateTime, System.DateTime], @param3=[String, System.String], @param4=[String, System.String], @param5=[System.DBNull, null], @param6=[String, System.String], @param7=[System.DBNull, null], @param8=[System.DBNull, null], @param9=[System.DBNull, null], @param10=[System.DBNull, null], @param11=[String, System.String], @param12=[System.DBNull, null], @param13=[System.DBNull, null], @param14=[System.DBNull, null], @param15=[System.DBNull, null], @param16=[System.DBNull, null], @param17=[String, System.String], @param18=[System.DBNull, null], @param19=[System.DBNull, null], @param20=[System.DBNull, null], @param21=[System.DBNull, null], @param22=[String, System.String], @param23=[String, System.String], @param24=[String, System.String], @param25=[String, System.String], @param26=[String, System.String], @param27=[String, System.String], @param28=[System.DBNull, null], @param29=[System.DBNull, null], @param30=[System.DBNull, null], @param31=[System.DBNull, null], @param32=[System.DBNull, null], @param33=[System.DBNull, null], @param34=[String, System.String], @param35=[String, System.String], @param36=[System.DBNull, null], @param37=[System.DBNull, null], @param38=[System.DBNull, null], @param39=[DateTime, System.DateTime], @param40=[Int64, System.Int64], @param41=[Int64, System.Int64], @param42=[Int64, System.Int64]]
2019-09-20 16:49:27,894 [1] DEBUG - Statement Id: [DAO00014_CheckExistHenTaiKHam] PreparedStatement : [select KHAMBENH_HENTAIKHAM        from TT_NGOAITRU_KHAMBENH_HENTK        where KHAMBENH_ID  = '26172']
2019-09-20 16:49:27,928 [1] DEBUG - Statement Id: [DAO00020_UpdateKhamBenhIDInDVYC] PreparedStatement : [update TT_DVYEUCAU        set KHAMBENH_NGOAITRU_ID =  @param0                 , TRANGTHAI =  @param1         , NGUOICAPNHAT_ID =  @param2         , NGAYCAPNHAT =  @param3         where TIEPNHAN_ID = 27478        and DVYEUCAU_ID = 205440                update TT_VIENPHI        set DATHUCHIEN =  @param4         , NGUOICAPNHAT_ID =  @param2         , NGAYCAPNHAT =  @param3         where REF_ID = 205440        and REF_TABLE = 'TT_DVYEUCAU']
2019-09-20 16:49:27,928 [1] DEBUG - Statement Id: [DAO00020_UpdateKhamBenhIDInDVYC] Parameters: [@param0=[KHAMBENH_ID,26172], @param1=[TRANGTHAI,DANGTHUCHIEN], @param2=[NGUOICAPNHAT_ID,1], @param3=[NGAYCAPNHAT,9/20/2019 4:49:27 PM], @param4=[DATHUCHIEN,1]]
2019-09-20 16:49:27,928 [1] DEBUG - Statement Id: [DAO00020_UpdateKhamBenhIDInDVYC] Types: [@param0=[Int32, System.Int32], @param1=[String, System.String], @param2=[Int64, System.Int64], @param3=[DateTime, System.DateTime], @param4=[Int32, System.Int32]]
2019-09-20 16:49:27,969 [1] DEBUG - Statement Id: [DAO00023_GetSOBHYT_HUONG_ID] PreparedStatement : [select isnull(MAX(SOBHYT_HUONG_ID),0) SOBHYT_HUONG_ID        from TT_TIEPNHAN_SOTHEBHYT        where TIEPNHAN_ID = '27478']
2019-09-20 16:49:28,010 [1] DEBUG - Statement Id: [DAO00062_GetAllPhamviKhoDuoc] PreparedStatement : [select distinct dmap.*        from TM_DUOC_PHAMVISD_MAPPING dmap        left join TM_DUOC_PHAMVISUDUNG dpv on dpv.PHAMVI_ID = dmap.PHAMVI_ID]
2019-09-20 16:49:28,047 [1] DEBUG - Statement Id: [DAO00049_KiemtraloaiDV] PreparedStatement : [select DICHVU_ID AS HA, '' AS XN, '' as TDCN, '' as TT, '' as KB from TM_DICHVU            left join TM_NHOMDICHVU ndv on ndv.NHOMDICHVU_ID = TM_DICHVU.NHOMDICHVU_ID            where DICHVU_ID = '5685' and left(ndv.MANHOMDICHVU, 2) = '02'            union            select  '' as HA, DICHVU_ID AS XN, '' as TDCN, '' as TT, '' as KB from TM_DICHVU            left join TM_NHOMDICHVU ndv on ndv.NHOMDICHVU_ID = TM_DICHVU.NHOMDICHVU_ID            where DICHVU_ID = '5685' and left(ndv.MANHOMDICHVU, 2) = '01'            union            select  '' as HA, '' AS XN, DICHVU_ID as TDCN, '' as TT, '' as KB from TM_DICHVU            left join TM_NHOMDICHVU ndv on ndv.NHOMDICHVU_ID = TM_DICHVU.NHOMDICHVU_ID            where DICHVU_ID = '5685' and left(ndv.MANHOMDICHVU, 2) = '03'            union            select  '' as HA, '' AS XN, '' as TDCN, DICHVU_ID as TT, '' as KB from TM_DICHVU            left join TM_NHOMDICHVU ndv on ndv.NHOMDICHVU_ID = TM_DICHVU.NHOMDICHVU_ID            where DICHVU_ID = '5685' and left(ndv.MANHOMDICHVU, 2) = '05'            union            select  '' as HA, '' AS XN, '' as TDCN, DICHVU_ID as TT, '' as KB from TM_DICHVU            left join TM_NHOMDICHVU ndv on ndv.NHOMDICHVU_ID = TM_DICHVU.NHOMDICHVU_ID            where DICHVU_ID = '5685' and left(ndv.MANHOMDICHVU, 2) = '06'            union            select  '' as HA, '' AS XN, '' as TDCN, '' as TT, DICHVU_ID as KB from TM_DICHVU            left join TM_NHOMDICHVU ndv on ndv.NHOMDICHVU_ID = TM_DICHVU.NHOMDICHVU_ID            where DICHVU_ID = '5685' and left(ndv.MANHOMDICHVU, 2) = '04']
2019-09-20 16:49:28,084 [1] DEBUG - Statement Id: [DAO00009_GetThutiensauDVThuthuatKhamBenh] PreparedStatement : [select A.THUTIENSAU, B.SOTIEPNHAN, A.DICHVU_ID, A.DVYEUCAU_ID        from TT_DVYEUCAU A        inner join TT_TIEPNHAN B on B.TIEPNHAN_ID = A.TIEPNHAN_ID        left join TT_NGOAITRU_KHAMBENH C on A.TIEPNHAN_ID = C.TIEPNHAN_ID and A.DICHVU_ID = C.DICHVU_ID        where        C.KHAMBENH_ID = '26172']
2019-09-20 16:49:28,116 [1] DEBUG - Statement Id: [DAO00009_TT_TIEPNHAN_GetProcess] PreparedStatement : [select PROCESS_ID from TT_TIEPNHAN where SOTIEPNHAN = 'TN190920.0000001']
2019-09-20 16:49:28,183 [1] DEBUG - Statement Id: [DAOWF001_Kiemtrathongtindayeucaureturn] PreparedStatement : [select * from TT_REQUEST        where        PARA = '{"HOSPITAL_ID":"HLU01","SOTIEPNHAN":"TN190920.0000001"}']
2019-09-20 16:49:28,234 [1] DEBUG - Statement Id: [DAOWF001_Kiemtrathongtindichvudayeucaureturn] PreparedStatement : [select top 1 * from TT_REQUEST_SERVICE        where        PARA = '{"DICHVU_ID":"5685","DVYEUCAU_ID":"205440"}'  order by ID desc]
2019-09-20 16:49:28,267 [1] DEBUG - Statement Id: [DAOWF005_ReturnStateCuaDichVuYeuCau] PreparedStatement : [declare        @Detail_Id int,        @CurentState char(8),        @OldState char(8)          select top 1 @Detail_Id = ID, @CurentState = OLD_STATE_CODE, @OldState = CURR_STATE_CODE from TT_REQUEST_SERVICE_DETAIL        where        REQUEST_ID = '31779'        AND REQUEST_SERVICE_ID = '147387'        order by ID desc;          update TT_REQUEST_SERVICE set CURR_STATE_CODE = @CurentState, ISACTIVE = 1, ISCOMPLETE = 0 where ID = '147387';        delete from TT_REQUEST_SERVICE_DETAIL where ID = @Detail_Id;        insert into TT_REQUEST_SERVICE_HISTORY        (REQUEST_ID,REQUEST_SERVICE_ID, OLD_STATE_CODE, CURR_STATE_CODE) values ('31779','147387',@OldState, @CurentState);        select top 1 A.*, B.STATUS_CODE from TT_REQUEST_SERVICE A        left join TM_STATE B on A.CURR_STATE_CODE = B.STATE_CODE and A.PROCESS_CODE = B.PROCESS_CODE        where A.ID = '147387';]
2019-09-20 16:49:28,318 [1] DEBUG - Statement Id: [DAO00009_TT_DVYEUCAU_Update] PreparedStatement : [Update TT_DVYEUCAU set TRANGTHAI_WFL = 'CHUAKETQUA' where DVYEUCAU_ID = '205440']
2019-09-20 16:49:28,348 [1] DEBUG - Statement Id: [DAO00049_KiemtraloaiDV] PreparedStatement : [select DICHVU_ID AS HA, '' AS XN, '' as TDCN, '' as TT, '' as KB from TM_DICHVU            left join TM_NHOMDICHVU ndv on ndv.NHOMDICHVU_ID = TM_DICHVU.NHOMDICHVU_ID            where DICHVU_ID = '5685' and left(ndv.MANHOMDICHVU, 2) = '02'            union            select  '' as HA, DICHVU_ID AS XN, '' as TDCN, '' as TT, '' as KB from TM_DICHVU            left join TM_NHOMDICHVU ndv on ndv.NHOMDICHVU_ID = TM_DICHVU.NHOMDICHVU_ID            where DICHVU_ID = '5685' and left(ndv.MANHOMDICHVU, 2) = '01'            union            select  '' as HA, '' AS XN, DICHVU_ID as TDCN, '' as TT, '' as KB from TM_DICHVU            left join TM_NHOMDICHVU ndv on ndv.NHOMDICHVU_ID = TM_DICHVU.NHOMDICHVU_ID            where DICHVU_ID = '5685' and left(ndv.MANHOMDICHVU, 2) = '03'            union            select  '' as HA, '' AS XN, '' as TDCN, DICHVU_ID as TT, '' as KB from TM_DICHVU            left join TM_NHOMDICHVU ndv on ndv.NHOMDICHVU_ID = TM_DICHVU.NHOMDICHVU_ID            where DICHVU_ID = '5685' and left(ndv.MANHOMDICHVU, 2) = '05'            union            select  '' as HA, '' AS XN, '' as TDCN, DICHVU_ID as TT, '' as KB from TM_DICHVU            left join TM_NHOMDICHVU ndv on ndv.NHOMDICHVU_ID = TM_DICHVU.NHOMDICHVU_ID            where DICHVU_ID = '5685' and left(ndv.MANHOMDICHVU, 2) = '06'            union            select  '' as HA, '' AS XN, '' as TDCN, '' as TT, DICHVU_ID as KB from TM_DICHVU            left join TM_NHOMDICHVU ndv on ndv.NHOMDICHVU_ID = TM_DICHVU.NHOMDICHVU_ID            where DICHVU_ID = '5685' and left(ndv.MANHOMDICHVU, 2) = '04']
2019-09-20 16:49:28,395 [1] DEBUG - Statement Id: [DAO00009_GetThutiensauDVThuthuat] PreparedStatement : [select A.THUTIENSAU, B.SOTIEPNHAN, A.DICHVU_ID, A.DVYEUCAU_ID        from TT_DVYEUCAU A        inner join TT_TIEPNHAN B on B.TIEPNHAN_ID = A.TIEPNHAN_ID        where        A.DVYEUCAU_ID = '205440']
2019-09-20 16:49:28,731 [1] DEBUG - Statement Id: [DAO00009_TT_TIEPNHAN_GetProcess] PreparedStatement : [select PROCESS_ID from TT_TIEPNHAN where SOTIEPNHAN = 'TN190920.0000001']
2019-09-20 16:49:28,796 [1] DEBUG - Statement Id: [DAOWF001_Kiemtrathongtindayeucaudacochua] PreparedStatement : [select * from TT_REQUEST        where        PARA = '{"HOSPITAL_ID":"HLU01","SOTIEPNHAN":"TN190920.0000001"}'        AND ISACTIVE = '1']
2019-09-20 16:49:28,846 [1] DEBUG - Statement Id: [DAOWF001_Kiemtrathongtindichvudayeucau] PreparedStatement : [select top 1 * from TT_REQUEST_SERVICE        where        PARA = '{"DICHVU_ID":"5685","DVYEUCAU_ID":"205440"}'                AND ISACTIVE = '1' order by ID desc]
2019-09-20 16:49:28,880 [1] DEBUG - Statement Id: [DAOWF001_KiemtrathongtinchitietDichvuYeucau] PreparedStatement : [select * from TT_REQUEST_SERVICE_DETAIL        where        REQUEST_SERVICE_ID = '147387']
2019-09-20 16:49:28,946 [1] DEBUG - Statement Id: [DAOWF001_Laythongtinwithstatecode] PreparedStatement : [select A.*, B.STATUS_CODE from        TM_STATE_ACTION A        left join TM_STATE B on B.STATE_CODE = A.NEXT_STATE_CODE and A.PROCESS_CODE = B.PROCESS_CODE        where        A.CURR_STATE_CODE = '0     '        AND A.PROCESS_CODE = 'P02'        Order By ORDER_ID ASC]
2019-09-20 16:49:28,985 [1] DEBUG - Statement Id: [DAOWF003_Update] PreparedStatement : [update TT_REQUEST_SERVICE set        CURR_STATE_CODE =  @param0                   , ISACTIVE =  @param1                     , ISCOMPLETE =  @param2                        where        ID = '147387']
2019-09-20 16:49:28,986 [1] DEBUG - Statement Id: [DAOWF003_Update] Parameters: [@param0=[CURR_STATE_CODE,3], @param1=[ISACTIVE,1], @param2=[ISCOMPLETE,0]]
2019-09-20 16:49:28,986 [1] DEBUG - Statement Id: [DAOWF003_Update] Types: [@param0=[String, System.String], @param1=[String, System.String], @param2=[String, System.String]]
2019-09-20 16:49:29,018 [1] DEBUG - Statement Id: [DAOWF005_Add] PreparedStatement : [insert into TT_REQUEST_SERVICE_DETAIL (        REQUEST_ID        ,REQUEST_SERVICE_ID        , OLD_STATE_CODE        , CURR_STATE_CODE        ) values (         @param0         , @param1         ,  @param2         ,  @param3         )        SELECT SCOPE_IDENTITY()]
2019-09-20 16:49:29,018 [1] DEBUG - Statement Id: [DAOWF005_Add] Parameters: [@param0=[REQUEST_ID,31779], @param1=[REQUEST_SERVICE_ID,147387], @param2=[OLD_STATE_CODE,0     ], @param3=[CURR_STATE_CODE,3]]
2019-09-20 16:49:29,018 [1] DEBUG - Statement Id: [DAOWF005_Add] Types: [@param0=[String, System.String], @param1=[Int32, System.Int32], @param2=[String, System.String], @param3=[String, System.String]]
2019-09-20 16:49:29,054 [1] DEBUG - Statement Id: [DAOWF005_Add_History] PreparedStatement : [insert into TT_REQUEST_SERVICE_HISTORY (        REQUEST_ID        ,REQUEST_SERVICE_ID        , OLD_STATE_CODE        , CURR_STATE_CODE        ) values (         @param0         , @param1         ,  @param2         ,  @param3         )]
2019-09-20 16:49:29,054 [1] DEBUG - Statement Id: [DAOWF005_Add_History] Parameters: [@param0=[REQUEST_ID,31779], @param1=[REQUEST_SERVICE_ID,147387], @param2=[OLD_STATE_CODE,0     ], @param3=[CURR_STATE_CODE,3]]
2019-09-20 16:49:29,054 [1] DEBUG - Statement Id: [DAOWF005_Add_History] Types: [@param0=[String, System.String], @param1=[Int32, System.Int32], @param2=[String, System.String], @param3=[String, System.String]]
2019-09-20 16:49:29,086 [1] DEBUG - Statement Id: [DAO00009_TT_DVYEUCAU_Update] PreparedStatement : [Update TT_DVYEUCAU set TRANGTHAI_WFL = 'DANGTHUCHIEN' where DVYEUCAU_ID = '205440']
2019-09-20 16:49:29,118 [1] DEBUG - Statement Id: [DAO00026_GetListDanhSachDichVuGhiNhanVTYT_COM25_WithTN] PreparedStatement : [select distinct CONVERT(VARCHAR(11),C.NGAYYEUCAU,103) as NGAYYEUCAU, C.DICHVU_ID, C.DVYEUCAU_ID, D.TENDICHVU, C.NOITHUCHIEN_ID, A.SOTIEPNHAN, A.TRAITUYEN, A.NGAYMIENDONGCHITRA, A.TIEPNHAN_ID, A.DOITUONG_ID, A.TRANGTHAI,            A.LOAITHANHVIEN_ID, A.SUDUNG_BHTN, A.THE_ID, A.THANHVIEN_ID, A.VIP, A.NGUON_BENHNHAN_ID, A.BAOLANH_VIENPHI,            CASE WHEN (A.TRANGTHAI = 'NOITRU' OR A.TRANGTHAI = 'CAPCUU') THEN 'IN' ELSE 'OUT' END AS LOAIBENHAN,            CASE WHEN (C.TRANGTHAI = 'CHUAKETQUA') THEN 'CHUAKETQUA' ELSE 'HOANTAT' END AS TRANGTHAIDICHVU,            B.*, isnull(ntba.SOBENHAN, '') SOBENHAN, isnull(ntba.BENHAN_ID, 0) BENHAN_ID,            CASE WHEN Left(E.MANHOMDICHVU,2) = '03' THEN '02' ELSE Left(E.MANHOMDICHVU,2) END AS MANHOMDICHVU            from TT_TIEPNHAN A            inner join TT_BENHNHAN B on B.BENHNHAN_ID = A.BENHNHAN_ID and B.ACTIVE = '1'            inner join TT_DVYEUCAU C on C.TIEPNHAN_ID = A.TIEPNHAN_ID                        left join TM_DICHVU D on D.DICHVU_ID = C.DICHVU_ID            left join TM_NHOMDICHVU E on E.NHOMDICHVU_ID = D.NHOMDICHVU_ID            left join TT_NOITRU_BENHAN ntba on ntba.BENHAN_ID = C.BENHAN_ID              where            C.NGAYHENCLS is NULL and A.BENHVIEN_ID = 'HLU01'            and (A.TRANGTHAI = 'DATIEPNHAN' or A.TRANGTHAI = 'NOITRU' or A.TRANGTHAI = 'CAPCUU' or A.TRANGTHAI = 'NGOAITRU')            and (CASE WHEN Left(E.MANHOMDICHVU,2) = '03' THEN '02' ELSE Left(E.MANHOMDICHVU,2) END in ('02', '04'))            and A.TIEPNHAN_ID = '27478']
2019-09-20 16:49:29,963 [1] DEBUG - Statement Id: [DAOLOG01_LockEnd] PreparedStatement : [DELETE TT_LOG_UPDATE        where REF_TABLE = 'TT_NGOAITRU_KHAMBENH' and REF_ID = '27478' and BENHVIEN_ID = 'HLU01']
2019-09-20 16:49:29,997 [1] DEBUG - Statement Id: [DAO00014_Clear_1ToaThuocKhambenh] PreparedStatement : [DELETE FROM TT_DUOC_TONKHO_BOOK_NGOAITRU where REF_TABLE = 'TT_NGOAITRU_TOATHUOC'        and REF_ID in (        select TOATHUOC_ID from TT_NGOAITRU_TOATHUOC        where             KHAMBENH_TOATHUOC_ID in (select KHAMBENH_TOATHUOC_ID from TT_NGOAITRU_KHAMBENH_TOATHUOC        where TIEPNHAN_ID = '27478' and                   KHAMBENH_ID not in (select KHAMBENH_ID from TT_NGOAITRU_KHAMBENH where  TIEPNHAN_ID = '27478'))        and TIEPNHAN_ID = '27478')          DELETE FROM TT_VIENPHI where REF_TABLE = 'TT_NGOAITRU_TOATHUOC'        and REF_ID in (        select TOATHUOC_ID from TT_NGOAITRU_TOATHUOC        where KHAMBENH_TOATHUOC_ID in (select KHAMBENH_TOATHUOC_ID from TT_NGOAITRU_KHAMBENH_TOATHUOC        where TIEPNHAN_ID = '27478' and KHAMBENH_ID not in (select KHAMBENH_ID from TT_NGOAITRU_KHAMBENH where TIEPNHAN_ID = '27478'))        and TIEPNHAN_ID = '27478')          delete from TT_NGOAITRU_TOATHUOC        where KHAMBENH_TOATHUOC_ID in (select KHAMBENH_TOATHUOC_ID from TT_NGOAITRU_KHAMBENH_TOATHUOC        where TIEPNHAN_ID = '27478' and KHAMBENH_ID not in (select KHAMBENH_ID from TT_NGOAITRU_KHAMBENH where TIEPNHAN_ID = '27478')        and TIEPNHAN_ID = '27478')          delete from TT_NGOAITRU_KHAMBENH_TOATHUOC where TIEPNHAN_ID = '27478'        and KHAMBENH_ID not in (select KHAMBENH_ID from TT_NGOAITRU_KHAMBENH where TIEPNHAN_ID = '27478') and TIEPNHAN_ID = '27478']
2019-09-20 16:49:30,093 [1] DEBUG - Statement Id: [DAO00014_GetKhamBenhInfo] PreparedStatement : [select * from TT_NGOAITRU_KHAMBENH where KHAMBENH_ID =        (select KHAMBENH_NGOAITRU_ID from TT_DVYEUCAU where DVYEUCAU_ID = '205440')]
2019-09-20 16:49:30,127 [1] DEBUG - Statement Id: [DAO00068_GetSinhHieuBySinhHieuID] PreparedStatement : [select top (1) *            from TT_NGOAITRU_KHAMBENH_SINHHIEU            where KHAMBENH_SINHHIEU_ID = '0'            and BENHVIEN_ID = 'HLU01'             and               BENHNHAN_ID = '23423'                           order by KHAMBENH_SINHHIEU_ID]
2019-09-20 16:49:30,158 [1] DEBUG - Statement Id: [DAO00014_GetKhamBenhICDInfo] PreparedStatement : [select *        from TT_NGOAITRU_KHAMBENH_ICD        where KHAMBENH_ID  = '26172']
2019-09-20 16:49:30,194 [1] DEBUG - Statement Id: [DAO00014_GetListToaThuoc] PreparedStatement : [select A.*        from TT_NGOAITRU_KHAMBENH_TOATHUOC A        where A.KHAMBENH_ID = '26172']
2019-09-20 16:49:30,229 [1] DEBUG - Statement Id: [DAO00014_KiemTraDVYCCoBHYT] PreparedStatement : [select *        from TT_VIENPHI        where REF_ID  = '205440' and REF_TABLE = 'TT_DVYEUCAU' and BHYT_DONGIA > 0]
2019-09-20 16:49:30,269 [1] DEBUG - Statement Id: [DAO00040_LayListToaMau] PreparedStatement : [select A.*, dc.TENDUOCDAYDU, dc.BHYT DUOC_BHYT, ld.LOAIVATTU_ID, ld.MALOAIDUOC, dd.DICTIONARY_NAME DUONGDUNG, dc.TAMNGUNG            from TT_TOATHUOCMAU A            left join TM_DUOC dc on A.DUOC_ID = dc.DUOC_ID            left join TM_LOAIDUOC ld on dc.LOAIDUOC_ID = ld.LOAIDUOC_ID            left join (select * from LST_DICTIONARY where DICTIONARY_TYPE_CODE like 'DuongDung') dd on dd.DICTIONARY_ID = dc.DUONGDUNG_ID            where (1=1)             and               A.BACSI_ID  = 1              and A.LOAITOATHUOC in  (                        @param0                   ,                           @param1                   ,                           @param2                   ,                           @param3                   )]
2019-09-20 16:49:30,269 [1] DEBUG - Statement Id: [DAO00040_LayListToaMau] Parameters: [@param0=[LSTLOAITOATHUOC[0],BV], @param1=[LSTLOAITOATHUOC[1],MN], @param2=[LSTLOAITOATHUOC[2],MP], @param3=[LSTLOAITOATHUOC[3],TV]]
2019-09-20 16:49:30,269 [1] DEBUG - Statement Id: [DAO00040_LayListToaMau] Types: [@param0=[String, System.String], @param1=[String, System.String], @param2=[String, System.String], @param3=[String, System.String]]
2019-09-20 16:49:30,374 [1] DEBUG - Statement Id: [DAO00040_LayListToaMau] PreparedStatement : [select A.*, dc.TENDUOCDAYDU, dc.BHYT DUOC_BHYT, ld.LOAIVATTU_ID, ld.MALOAIDUOC, dd.DICTIONARY_NAME DUONGDUNG, dc.TAMNGUNG            from TT_TOATHUOCMAU A            left join TM_DUOC dc on A.DUOC_ID = dc.DUOC_ID            left join TM_LOAIDUOC ld on dc.LOAIDUOC_ID = ld.LOAIDUOC_ID            left join (select * from LST_DICTIONARY where DICTIONARY_TYPE_CODE like 'DuongDung') dd on dd.DICTIONARY_ID = dc.DUONGDUNG_ID            where (1=1)             and               A.BACSI_ID  = 1              and A.LOAITOATHUOC in  (                        @param0                   ,                           @param1                   ,                           @param2                   ,                           @param3                   )]
2019-09-20 16:49:30,374 [1] DEBUG - Statement Id: [DAO00040_LayListToaMau] Parameters: [@param0=[LSTLOAITOATHUOC[0],BV], @param1=[LSTLOAITOATHUOC[1],MN], @param2=[LSTLOAITOATHUOC[2],MP], @param3=[LSTLOAITOATHUOC[3],TV]]
2019-09-20 16:49:30,374 [1] DEBUG - Statement Id: [DAO00040_LayListToaMau] Types: [@param0=[String, System.String], @param1=[String, System.String], @param2=[String, System.String], @param3=[String, System.String]]
2019-09-20 16:49:30,415 [1] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoVaBookingCOM23UpdateRedis_TheoPhamvi] PreparedStatement : [declare @TOAMUANGOAI int = 0;        select @TOAMUANGOAI = isnull(VALUE,0) from TM_SYS_APPSETTINGS where CODE = 'OPD_TOAMUANGOAI_DUNGDANHMUC_DUOC'                if @TOAMUANGOAI = 1        begin        select  distinct '0' + '_' + LTRIM(d.DUOC_ID) + '_' + '0' as DUOC_KEY, 999999999 as SOLUONG        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        where  @param0  = 0        union all        select distinct tk.DUOC_KEY, tk.SOLUONG        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        inner join        (        select  LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')) DUOC_KEY, (SUM(dtk.SOLUONG) - isnull(sum(A.SOLUONG),0) - isnull(sum(B.SOLUONG),0)) SOLUONG, pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        from (select sum(soluong) soluong,duoc_id,nguonduoc_id,khoduoc_id,benhvien_id from TT_DUOC_TONKHO  group by duoc_id,nguonduoc_id,khoduoc_id,benhvien_id) dtk        inner join TM_DUOC_PHAMVISD_MAPPING pvsd on dtk.KHODUOC_ID = pvsd.KHODUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NOITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) B on B.DUOC_ID = dtk.DUOC_ID and B.PHAMVI_ID = pvsd.PHAMVI_ID and B.NGUONHANG_ID = dtk.NGUONDUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NGOAITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) A on A.DUOC_ID = dtk.DUOC_ID and A.PHAMVI_ID = pvsd.PHAMVI_ID and A.NGUONHANG_ID = dtk.NGUONDUOC_ID        where dtk.BENHVIEN_ID = 'HLU01'        group by LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')), pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        ) tk on tk.DUOC_ID = d.DUOC_ID        left join TM_DUOC_PHAMVISUDUNG kd on kd.PHAMVI_ID = tk.PHAMVI_ID and kd.BENHVIEN_ID = 'HLU01'        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = tk.NGUONDUOC_ID and nh.BENHVIEN_ID = 'HLU01'        where d.BENHVIEN_ID = 'HLU01' and tk.PHAMVI_ID =  @param0         end        else        begin        select distinct tk.DUOC_KEY, tk.SOLUONG        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        inner join        (        select  LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')) DUOC_KEY, (SUM(dtk.SOLUONG) - isnull(sum(A.SOLUONG),0) - isnull(sum(B.SOLUONG),0)) SOLUONG, pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        from (select sum(soluong) soluong,duoc_id,nguonduoc_id,khoduoc_id,benhvien_id from TT_DUOC_TONKHO  group by duoc_id,nguonduoc_id,khoduoc_id,benhvien_id) dtk        inner join TM_DUOC_PHAMVISD_MAPPING pvsd on dtk.KHODUOC_ID = pvsd.KHODUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NOITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) B on B.DUOC_ID = dtk.DUOC_ID and B.PHAMVI_ID = pvsd.PHAMVI_ID and B.NGUONHANG_ID = dtk.NGUONDUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NGOAITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) A on A.DUOC_ID = dtk.DUOC_ID and A.PHAMVI_ID = pvsd.PHAMVI_ID and A.NGUONHANG_ID = dtk.NGUONDUOC_ID        where dtk.BENHVIEN_ID = 'HLU01'        group by LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')), pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        ) tk on tk.DUOC_ID = d.DUOC_ID        left join TM_DUOC_PHAMVISUDUNG kd on kd.PHAMVI_ID = tk.PHAMVI_ID and kd.BENHVIEN_ID = 'HLU01'        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = tk.NGUONDUOC_ID and nh.BENHVIEN_ID = 'HLU01'        where d.BENHVIEN_ID = 'HLU01' and tk.PHAMVI_ID =  @param0         end]
2019-09-20 16:49:30,415 [1] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoVaBookingCOM23UpdateRedis_TheoPhamvi] Parameters: [@param0=[PHAMVI_ID,1028]]
2019-09-20 16:49:30,415 [1] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoVaBookingCOM23UpdateRedis_TheoPhamvi] Types: [@param0=[Int64, System.Int64]]
2019-09-20 16:49:30,772 [1] DEBUG - Statement Id: [DAO00064_GetlistTT_TIEPNHAN_SOTHEBHYT] PreparedStatement : [select stbhyt.*, ba.SOBENHAN,         tn.SOTIEPNHAN, tn.LOAITHANHVIEN_ID, tn.THE_ID, tn.THANHVIEN_ID,        tn.SUDUNG_BHTN, tn.BAOLANH_VIENPHI, tn.VIP, tn.NGUOINUOCNGOAI        from TT_TIEPNHAN_SOTHEBHYT stbhyt        left join TT_TIEPNHAN tn on tn.TIEPNHAN_ID = stbhyt.TIEPNHAN_ID        left join TT_NOITRU_BENHAN ba on ba.TIEPNHAN_ID = stbhyt.TIEPNHAN_ID        where         stbhyt.TIEPNHAN_ID = '27478' and isnull(stbhyt.KHONGSUDUNG, '0') = '0']
2019-09-20 16:49:30,835 [1] DEBUG - Statement Id: [DAO00064_GetListVienPhiByTiepNnan] PreparedStatement : [select distinct        B.DOITUONG_ID, B.NGAYMIENDONGCHITRA, B.BENHNHAN_ID as TIEPNHAN_BENHNHAN_ID, B.TRAITUYEN,        B.BHYTTREN3NAM as TREN3NAM, B.BHYTTREN5NAM as TREN5NAM, B.SOTIEPNHAN, B.SOBENHAN,        B.LOAITHANHVIEN_ID, B.SUDUNG_BHTN, B.THE_ID, B.THANHVIEN_ID, B.BAOLANH_VIENPHI, B.VIP, B.NGUOINUOCNGOAI,        C.GIATRIMIENGIAM as GIATRIMIENGIAM, D.GIATRIMIENGIAM as GIATRIMIENGIAM_BHTN, E.GIATRIMIENGIAM as GIATRIMIENGIAM_THANHVIEN,        F.GIATRIMIENGIAM as GIATRIMIENGIAM_CONGTY, DVYC.THE_ID as DVDUNGTHE, DVYC.TRANGTHAI as TRANGTHAIDICHVU, ndv.MANHOMDICHVU,        A.* from TT_VIENPHI A        left join        (select B.*, C.SOBENHAN, C.BENHAN_ID        from TT_TIEPNHAN B        left join TT_NOITRU_BENHAN C on B.TIEPNHAN_ID = C.TIEPNHAN_ID                 where B.TIEPNHAN_ID = '27478') B on B.TIEPNHAN_ID = A.TIEPNHAN_ID        left join (select sum(GIATRIMIENGIAM) as GIATRIMIENGIAM, VIENPHI_ID, REF_TABLE        from TT_MIENGIAM_CHITIET        where REF_TABLE = 'TT_MIENGIAM'        and exists (select MIENGIAM_ID from TT_MIENGIAM where TT_MIENGIAM_CHITIET.MIENGIAM_ID = MIENGIAM_ID and TINHTRANG = 1 and TIEPNHAN_ID = '27478')        group by VIENPHI_ID, REF_TABLE) C on C.REF_TABLE = 'TT_MIENGIAM' and C.VIENPHI_ID = A.VIENPHI_ID        left join (select sum(GIATRIMIENGIAM) as GIATRIMIENGIAM, VIENPHI_ID, REF_TABLE        from TT_MIENGIAM_CHITIET        where REF_TABLE = 'TT_MIENGIAM_BHTN'        and exists (select MIENGIAM_BHTN_ID from TT_MIENGIAM_BHTN where TT_MIENGIAM_CHITIET.MIENGIAM_ID = MIENGIAM_BHTN_ID and  TINHTRANG = 1 and TIEPNHAN_ID = '27478')        group by VIENPHI_ID, REF_TABLE) D on D.REF_TABLE = 'TT_MIENGIAM_BHTN' and D.VIENPHI_ID = A.VIENPHI_ID        left join (select sum(GIATRIMIENGIAM) as GIATRIMIENGIAM, VIENPHI_ID, REF_TABLE        from TT_MIENGIAM_CHITIET        where REF_TABLE = 'TT_MIENGIAM_THANHVIEN'        and exists (select MIENGIAM_THANHVIEN_ID from TT_MIENGIAM_THANHVIEN where TT_MIENGIAM_CHITIET.MIENGIAM_ID = MIENGIAM_THANHVIEN_ID and TINHTRANG = 1 and TIEPNHAN_ID = '27478')        group by VIENPHI_ID, REF_TABLE) E on E.REF_TABLE = 'TT_MIENGIAM_THANHVIEN' and E.VIENPHI_ID = A.VIENPHI_ID        left join (select sum(GIATRIMIENGIAM) as GIATRIMIENGIAM, VIENPHI_ID, REF_TABLE        from TT_MIENGIAM_CHITIET        where REF_TABLE = 'TT_MIENGIAM_CONGTY'        and exists (select MIENGIAM_CONGTY_ID from TT_MIENGIAM_CONGTY where TT_MIENGIAM_CHITIET.MIENGIAM_ID = MIENGIAM_CONGTY_ID and TINHTRANG = 1 and TIEPNHAN_ID = '27478')        group by VIENPHI_ID, REF_TABLE) F on F.REF_TABLE = 'TT_MIENGIAM_CONGTY' and F.VIENPHI_ID = A.VIENPHI_ID        left join TT_DVYEUCAU DVYC on DVYC.DVYEUCAU_ID = A.REF_ID and A.REF_TABLE = 'TT_DVYEUCAU'        left join TM_DICHVU DV on DVYC.DICHVU_ID = DV.DICHVU_ID and A.REF_TABLE = 'TT_DVYEUCAU'        left join TM_NHOMDICHVU ndv on ndv.NHOMDICHVU_ID = DV.NHOMDICHVU_ID and A.REF_TABLE = 'TT_DVYEUCAU'        where        A.TIEPNHAN_ID = '27478' and ((DVYC.HUYYEUCAU = '0' and A.DICHVU_ID is not null)        or A.DUOC_ID is not null or A.REF_TABLE = 'TT_NUT_XACNHANSUATAN_CHITIET')        and A.ACTIVE = '1'                 and A.BENHVIEN_ID = 'HLU01'        order by A.VIENPHI_ID]
2019-09-20 16:49:31,279 [1] DEBUG - Statement Id: [DAO00006_GetListDuocTyle] PreparedStatement : [select DUOC_ID, DOITUONG_ID, (TYLE/100) as TYLE, DONGIA MUCTRAN_THANHTOAN from TM_DOITUONG_GIADUOC_TYLE            where            BENHVIEN_ID = 'HLU01'            and DOITUONG_ID = '4']
2019-09-20 16:49:31,310 [1] DEBUG - Statement Id: [DAO00027_GetListTuongTrinhDichVuPhauThuatCuaTiepNhan] PreparedStatement : [declare @ManhomDSA varchar(10);        declare @PhanLoaiNhomDV varchar(20) = '05';        select top 1  @ManhomDSA = VALUE from TM_SYS_APPSETTINGS where CODE = 'MANHOM_DICHVU_DSA'        if (@ManhomDSA is not null) set @PhanLoaiNhomDV += ',' + @ManhomDSA        select distinct ptyc.*        from TT_PHAUTHUAT_YEUCAU ptyc        inner join TM_DICHVU dv on dv.DICHVU_ID = ptyc.DICHVU_ID        inner join TM_NHOMDICHVU ndv on ndv.NHOMDICHVU_ID = dv.NHOMDICHVU_ID        inner join TT_PHAUTHUAT pt on pt.PHAUTHUAT_ID = ptyc.PHAUTHUAT_ID        where        pt.TIEPNHAN_ID = 27478        and (left(ndv.MANHOMDICHVU, 2) in (select * from STRING_SPLIT(@PhanLoaiNhomDV,',')) or ndv.MANHOMDICHVU in (select * from STRING_SPLIT(@PhanLoaiNhomDV,',')))]
2019-09-20 16:49:31,356 [1] DEBUG - Statement Id: [DAO00006_GetList] PreparedStatement : [select dv.*, loaiDV.MALOAIDICHVU, captren.NHOMDICHVU_ID as NHOMDICHVU_CAPTREN_ID, captren.TENNHOMDICHVU as NHOMDICHVU_CAPTREN,              nhom_dv.TENNHOMDICHVU as TENNHOMDICHVU, nhom_dv.MANHOMDICHVU,              case when dv.ATTRIBUTE5 is null then 'TT' else 'KTC' end as LOAI_CHIPHI              from TM_DICHVU as dv              left join TM_NHOMDICHVU as nhom_dv on nhom_dv.NHOMDICHVU_ID = dv.NHOMDICHVU_ID and nhom_dv.BENHVIEN_ID = 'HLU01'              left join TM_NHOMDICHVU as captren on nhom_dv.CAPTREN_ID = captren.NHOMDICHVU_ID and captren.BENHVIEN_ID = 'HLU01'              left join TM_LOAIDICHVU loaiDV on nhom_dv.LOAIDICHVU_ID = loaiDV.LOAIDICHVU_ID and loaiDV.BENHVIEN_ID = 'HLU01'              where nhom_dv.TAMNGUNG = '0' and dv.BENHVIEN_ID = 'HLU01'              and dv.TAMNGUNG = '0'               AND                   loaiDV.MALOAIDICHVU = 'KhamBenh']
2019-09-20 16:49:32,649 [1] DEBUG - Statement Id: [DAO00023_UpdateNhieuVP] PreparedStatement : [declare @jsonVienPhi nvarchar(max) = N'[{"VIENPHI_ID":674724,"TIEPNHAN_ID":27478,"DICHVU_ID":5685,"BENHAN_ID":0,"SOLUONG":1.0000,"DONGIA_DOANHTHU":33000.0000,"THANHTIEN_DOANHTHU":33000.00,"BHYT_TL":0.8000,"BHYT_DONGIA":33000.0000,"BHYT_THANHTIEN":33000.00,"BHYT_DONGIA_CONGKHAM_DAU":33000.0000,"BHYT_CONGKHAM_DAU_TYLE":1.0,"BHYT_DONGIA_CHITRA":26400.0,"BHYT_THANHTIEN_CHITRA":26400.00,"BENHNHAN_PHAITHANHTOAN":6600.00,"GIATRI_HOADON":6600.00,"GIATRI_HOADON_DATHANHTOAN":0.0,"GIATRI_BIENLAI":0.0,"GIATRI_BIENLAI_DATHANHTOAN":0.0,"GIATRI_BENHNHAN_DATHANHTOAN":0.0,"DATHUCHIEN":"1","KHONGTHUTIEN":"0","BHYTDONGTIEN":"0","DICHVU_TL":1.0,"BHYT_DONGIA_DONGCT_DAU":0.0,"SOBHYT":"DN453534653452338289","SOBHYT_HUONG_ID":28501,"GIATRIMIENGIAM":0.0,"GIATRIMIENGIAM_BHTN":0.0,"GIATRIMIENGIAM_THANHVIEN":0.0,"GIATRIMIENGIAM_CONGTY":0.0,"BHYT_CK2_KHONGTHANHTOAN":false},{"VIENPHI_ID":674725,"TIEPNHAN_ID":27478,"DICHVU_ID":4145,"BENHAN_ID":0,"SOLUONG":1.0000,"DONGIA_DOANHTHU":260000.0000,"THANHTIEN_DOANHTHU":260000.00,"BHYT_TL":0.8000,"BHYT_DONGIA":260000.0000,"BHYT_THANHTIEN":260000.00,"BHYT_DONGIA_CONGKHAM_DAU":33000.0000,"BHYT_CONGKHAM_DAU_TYLE":1.0,"BHYT_DONGIA_CHITRA":208000.0,"BHYT_THANHTIEN_CHITRA":208000.00,"BENHNHAN_PHAITHANHTOAN":52000.00,"GIATRI_HOADON":52000.00,"GIATRI_HOADON_DATHANHTOAN":0.0,"GIATRI_BIENLAI":0.0,"GIATRI_BIENLAI_DATHANHTOAN":0.0,"GIATRI_BENHNHAN_DATHANHTOAN":0.0,"DATHUCHIEN":"1","KHONGTHUTIEN":"0","BHYTDONGTIEN":"0","DICHVU_TL":1.0,"BHYT_DONGIA_DONGCT_DAU":0.0,"SOBHYT":"DN453534653452338289","SOBHYT_HUONG_ID":28501,"GIATRIMIENGIAM":0.0,"GIATRIMIENGIAM_BHTN":0.0,"GIATRIMIENGIAM_THANHVIEN":0.0,"GIATRIMIENGIAM_CONGTY":0.0,"BHYT_CK2_KHONGTHANHTOAN":false},{"VIENPHI_ID":674726,"TIEPNHAN_ID":27478,"DICHVU_ID":1111,"BENHAN_ID":0,"SOLUONG":1.0000,"DONGIA_DOANHTHU":37000.0000,"THANHTIEN_DOANHTHU":37000.00,"BHYT_TL":0.8000,"BHYT_DONGIA":37000.0000,"BHYT_THANHTIEN":37000.00,"BHYT_DONGIA_CONGKHAM_DAU":33000.0000,"BHYT_CONGKHAM_DAU_TYLE":1.0,"BHYT_DONGIA_CHITRA":29600.0,"BHYT_THANHTIEN_CHITRA":29600.00,"BENHNHAN_PHAITHANHTOAN":7400.00,"GIATRI_HOADON":7400.00,"GIATRI_HOADON_DATHANHTOAN":0.0,"GIATRI_BIENLAI":0.0,"GIATRI_BIENLAI_DATHANHTOAN":0.0,"GIATRI_BENHNHAN_DATHANHTOAN":0.0,"DATHUCHIEN":"1","KHONGTHUTIEN":"0","BHYTDONGTIEN":"0","DICHVU_TL":1.0,"BHYT_DONGIA_DONGCT_DAU":0.0,"SOBHYT":"DN453534653452338289","SOBHYT_HUONG_ID":28501,"GIATRIMIENGIAM":0.0,"GIATRIMIENGIAM_BHTN":0.0,"GIATRIMIENGIAM_THANHVIEN":0.0,"GIATRIMIENGIAM_CONGTY":0.0,"BHYT_CK2_KHONGTHANHTOAN":false}]';        begin        UPDATE TT_VIENPHI        SET        SOLUONG = json.SOLUONG,        DONGIA_DOANHTHU = json.DONGIA_DOANHTHU,        THANHTIEN_DOANHTHU = json.THANHTIEN_DOANHTHU,        BHYT_TL = json.BHYT_TL,        BHYT_DONGIA = json.BHYT_DONGIA,        BHYT_THANHTIEN = json.BHYT_THANHTIEN,        BHYT_DONGIA_CONGKHAM_DAU = json.BHYT_DONGIA_CONGKHAM_DAU,        BHYT_CONGKHAM_DAU_TYLE = json.BHYT_CONGKHAM_DAU_TYLE,        BHYT_DONGIA_CHITRA = json.BHYT_DONGIA_CHITRA,        BHYT_THANHTIEN_CHITRA = json.BHYT_THANHTIEN_CHITRA,        BENHNHAN_PHAITHANHTOAN = json.BENHNHAN_PHAITHANHTOAN,        GIATRI_HOADON = json.GIATRI_HOADON,                GIATRI_BIENLAI = json.GIATRI_BIENLAI,                DATHUCHIEN = json.DATHUCHIEN,                DICHVU_TL = json.DICHVU_TL,        BHYT_DONGIA_DONGCT_DAU = json.BHYT_DONGIA_DONGCT_DAU,        NGAYCAPNHAT = GETDATE()        FROM OPENJSON (@jsonVienPhi)        WITH (        VIENPHI_ID int,        SOLUONG numeric(25, 4),        DONGIA_DOANHTHU numeric(25, 4),        THANHTIEN_DOANHTHU numeric(25, 4),        BHYT_TL numeric(25, 4),        BHYT_DONGIA numeric(25, 4),        BHYT_THANHTIEN numeric(25, 4),        BHYT_DONGIA_CONGKHAM_DAU numeric(25, 4),        BHYT_CONGKHAM_DAU_TYLE numeric(25, 4),        BHYT_DONGIA_CHITRA numeric(25, 4),        BHYT_THANHTIEN_CHITRA numeric(25, 4),        BENHNHAN_PHAITHANHTOAN numeric(25, 4),        GIATRI_HOADON numeric(25, 4),                GIATRI_BIENLAI numeric(25, 4),                DATHUCHIEN char(1),        KHONGTHUTIEN char(1),        BHYTDONGTIEN char(1),        DICHVU_TL numeric(25, 4),        BHYT_DONGIA_DONGCT_DAU numeric(25, 4))  json        WHERE TT_VIENPHI.VIENPHI_ID = json.VIENPHI_ID                        insert into TT_TINH_VIENPHI_LOG        SELECT json.VIENPHI_ID, json.TIEPNHAN_ID, json.BENHAN_ID, json.SOLUONG, json.BHYT_TL, json.DONGIA_DOANHTHU,        json.THANHTIEN_DOANHTHU, json.BHYT_DONGIA, json.BHYT_THANHTIEN, json.BHYT_DONGIA_CHITRA, json.BHYT_THANHTIEN_CHITRA, json.BENHNHAN_PHAITHANHTOAN,        json.SOBHYT_HUONG_ID, json.SOBHYT, GETDATE(), -1, 'HLU01'        FROM OPENJSON(@jsonVienPhi)        WITH (        VIENPHI_ID int,        TIEPNHAN_ID int,        BENHAN_ID int,        SOLUONG numeric(25, 4),        DONGIA_DOANHTHU numeric(25, 4),        THANHTIEN_DOANHTHU numeric(25, 4),        BHYT_TL numeric(25, 4),        BHYT_DONGIA numeric(25, 4),        BHYT_THANHTIEN numeric(25, 4),        BHYT_DONGIA_CHITRA numeric(25, 4),        BHYT_THANHTIEN_CHITRA numeric(25, 4),        BENHNHAN_PHAITHANHTOAN numeric(25, 4),        SOBHYT_HUONG_ID int,        SOBHYT nvarchar(30)) json        end]
2019-09-20 16:49:32,713 [1] DEBUG - Statement Id: [DAO00067_UpdateDataVienPhiDongiaBHYT] PreparedStatement : [update TT_VIENPHI          set BHYT_DONGIA_CHITRA = 0, BHYT_THANHTIEN = 0, BHYT_THANHTIEN_CHITRA = 0          where          TIEPNHAN_ID = 27478 and BHYT_DONGIA = 0          and (BHYT_DONGIA_CHITRA > 0 or BHYT_THANHTIEN > 0 or BHYT_THANHTIEN_CHITRA > 0)]
2019-09-20 16:49:32,742 [1] DEBUG - Statement Id: [DAO00067_CapnhatDataVienphiKhiHuyThanhtoanHoadon] PreparedStatement : [update TT_VIENPHI        set TT_VIENPHI.HOADON_ID = hdct.HOADON_ID, TT_VIENPHI.GIATRI_BENHNHAN_DATHANHTOAN = TT_VIENPHI.GIATRI_BENHNHAN_DATHANHTOAN + hdct.GIATRI_BENHNHAN_DATHANHTOAN        from (select CT.HOADON_ID, CT.VIENPHI_ID, CT.GIATRI_BENHNHAN_DATHANHTOAN        from TT_HOADON_CHITIET_NGOAITRU CT        join TT_HOADON HD on HD.HOADON_ID = CT.HOADON_ID        join TT_VIENPHI vp on vp.VIENPHI_ID = ct.VIENPHI_ID        where HD.DATHANHTOAN = 1 and HD.HUYHOADON = 0 and HD.HOANTRA = 0 and vp.TIEPNHAN_ID =  @param0 ) hdct        where        TT_VIENPHI.VIENPHI_ID = hdct.VIENPHI_ID and TT_VIENPHI.HOADON_ID is null and isnull(TT_VIENPHI.GIATRI_BENHNHAN_DATHANHTOAN,0) = 0        and TT_VIENPHI.TIEPNHAN_ID =  @param0           update TT_VIENPHI        set TT_VIENPHI.HOADON_ID = null, TT_VIENPHI.GIATRI_BENHNHAN_DATHANHTOAN = TT_VIENPHI.GIATRI_BENHNHAN_DATHANHTOAN - hdct.GIATRI_BENHNHAN_DATHANHTOAN,        TT_VIENPHI.DATHANHTOAN = '0'        from (select CT.HOADON_ID, CT.VIENPHI_ID, CT.GIATRI_BENHNHAN_DATHANHTOAN        from TT_HOADON_CHITIET_NGOAITRU CT        join TT_HOADON HD on HD.HOADON_ID = CT.HOADON_ID        join TT_VIENPHI vp on vp.VIENPHI_ID = ct.VIENPHI_ID and vp.HOADON_ID = ct.HOADON_ID        where HD.DATHANHTOAN = 0 and (HD.HUYHOADON = 1 or HD.HOANTRA = 1) and vp.TIEPNHAN_ID =  @param0 ) hdct        where        TT_VIENPHI.VIENPHI_ID = hdct.VIENPHI_ID and TT_VIENPHI.HOADON_ID = hdct.HOADON_ID        and TT_VIENPHI.TIEPNHAN_ID =  @param0]
2019-09-20 16:49:32,742 [1] DEBUG - Statement Id: [DAO00067_CapnhatDataVienphiKhiHuyThanhtoanHoadon] Parameters: [@param0=[TIEPNHAN_ID,27478]]
2019-09-20 16:49:32,742 [1] DEBUG - Statement Id: [DAO00067_CapnhatDataVienphiKhiHuyThanhtoanHoadon] Types: [@param0=[Int64, System.Int64]]
2019-09-20 16:49:32,934 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'COM11'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2019-09-20 16:49:34,482 [1] DEBUG - Statement Id: [DAO00017_GetDanhSachNoiThucHien] PreparedStatement : [select pb.PHONGBAN_ID, pb.TENPHONGBAN              from [TM_PHONGBAN] as pb              left join LST_DICTIONARY dic on pb.LOAIPHONGBAN_ID = dic.DICTIONARY_ID              where pb.BENHVIEN_ID = 'HLU01'                          and dic.DICTIONARY_TYPE_CODE = 'LoaiPhongBan'            and dic.DICTIONARY_CODE in ('KhamBenh','PhongBenh','KhoaNoi','PhongMo','KhoaDuoc','KhoaCLS', 'KhoaNgoai')]
2019-09-20 16:49:34,582 [1] DEBUG - Statement Id: [DAO00012_GetList] PreparedStatement : [select        DICTIONARY_ID,        DICTIONARY_CODE,        DICTIONARY_NAME,        ATTRIBUTE1,        ATTRIBUTE2,        DICTIONARY_NAME_EN        from LST_DICTIONARY        where LST_DICTIONARY.Enabled = '1'         AND           LST_DICTIONARY.DICTIONARY_TYPE_CODE = 'NguonBN'                 order by LST_DICTIONARY.IDX]
2019-09-20 16:49:34,842 [1] DEBUG - Statement Id: [DAO00014_GetPatientStatus] PreparedStatement : [select        CASE        when tn.TRANGTHAI = 'HOANTHANH' Then tn.TRANGTHAI        WHEN xncp.XACNHANCHIPHI_ID is not null THEN 'XACNHANCHIPHI'        WHEN (tn.KHOADULIEU = '1') THEN 'KHOADULIEU'        ELSE tn.TRANGTHAI        END        as TRANGTHAI        from TT_TIEPNHAN tn        left join TT_XACNHANCHIPHI xncp on tn.TIEPNHAN_ID = xncp.TIEPNHAN_ID        where tn.TIEPNHAN_ID = '27478'        and tn.BENHVIEN_ID = 'HLU01']
2019-09-20 16:49:34,948 [1] DEBUG - Statement Id: [DAO00013_GetTienSuBenh] PreparedStatement : [select TIENSUBENH, TIENSUDIUNG              from TT_BENHNHAN              where TT_BENHNHAN.BENHNHAN_ID  = '23423']
2019-09-20 16:49:34,977 [1] DEBUG - Statement Id: [DAO00095_GetTTDiUngThuoc] PreparedStatement : [select *              from TT_BENHNHAN_DIUNG_THUOC              where BENHNHAN_ID = '23423'              and BENHVIEN_ID = 'HLU01']
2019-09-20 16:49:35,011 [1] DEBUG - Statement Id: [DAO00017_GetLoaiGiaByDoiTuongId] PreparedStatement : [select dtlg.DOUUTIEN, dtlg.DOITUONG_ID, lg.LOAIGIA_ID, lg.TENLOAIGIA, lg.MALOAIGIA              from TM_LOAIGIA lg              left join TM_DOITUONG_LOAIGIA dtlg              on lg.LOAIGIA_ID = dtlg.LOAIGIA_ID and dtlg.BENHVIEN_ID = 'HLU01'              where lg.TAMNGUNG = 0 and lg.BENHVIEN_ID = 'HLU01'               AND                   dtlg.DOITUONG_ID = '4'                             order by dtlg.DOUUTIEN]
2019-09-20 16:49:35,110 [1] DEBUG - Statement Id: [DAO00099_TT_CSKH_GOI_DANGKY_Service_GetList_01] PreparedStatement : [select GDV.*, GOI.TENGOI, GOI.LOAIGOI_ID from TT_CSKH_GOI_DANGKY GDV        left join TM_CSKH_GOI GOI on GOI.GOI_ID = GDV.GOI_ID        where LOAIGOI_ID in (select DICTIONARY_ID from LST_DICTIONARY where DICTIONARY_CODE = 'NgoaiTru'                              and DICTIONARY_TYPE_CODE = 'LoaiGoiDV')                 and             GDV.BENHNHAN_ID = '23423'           and             GDV.TRANGTHAI in ('DAKICHHOAT','FOLLOWUP')           and             GDV.BENHVIEN_ID = 'HLU01']
2019-09-20 16:49:35,145 [1] DEBUG - Statement Id: [DAO00085_GetDSDichVuThe] PreparedStatement : [select *        from TT_CSKH_THETHANHVIEN_SUDUNG        where THE_ID = '0'        and BENHVIEN_ID = 'HLU01']
2019-09-20 16:49:35,178 [1] DEBUG - Statement Id: [DAO00020_GetDSDichVuYC] PreparedStatement : [select dvyc.*,        dv.TENDICHVU, dv.MADICHVU, dv.NORESULT, ndv.MANHOMDICHVU, ndv.TENNHOMDICHVU, vp.KHONGTHUTIEN        from TT_DVYEUCAU dvyc        left join TM_DICHVU dv on dvyc.DICHVU_ID = dv.DICHVU_ID        left join TM_NHOMDICHVU ndv on ndv.NHOMDICHVU_ID = dv.NHOMDICHVU_ID        left join (select * from TT_VIENPHI where TIEPNHAN_ID = '27478') vp on dvyc.DVYEUCAU_ID = vp.REF_ID                 where        dvyc.TIEPNHAN_ID = 27478        and REF_TABLE = 'TT_DVYEUCAU'                 order by DVYEUCAU_ID desc]
2019-09-20 16:49:35,215 [1] DEBUG - Statement Id: [DAO00020_GetDanhsachVPCuaDichvuYeucau] PreparedStatement : [select V.*, CASE WHEN A.VIENPHI_ID IS NULL AND B.VIENPHI_ID IS NULL THEN '0' ELSE '1' END AS EXIST_HOADON_HUY,        dv.TENDICHVU, dv.MADICHVU, dv.NORESULT, ndv.MANHOMDICHVU, ndv.TENNHOMDICHVU        from TT_VIENPHI AS V        left join TM_DICHVU dv on V.DICHVU_ID = dv.DICHVU_ID and V.REF_TABLE = 'TT_DVYEUCAU'        left join TM_NHOMDICHVU ndv on ndv.NHOMDICHVU_ID = dv.NHOMDICHVU_ID        left join (select DISTINCT HD.VIENPHI_ID from TT_HOADON_CHITIET_NGOAITRU AS HD        inner join TT_HOADON AS H ON H.HOADON_ID = HD.HOADON_ID AND H.HUYHOADON = '1'        where H.TIEPNHAN_ID = '27478'        ) AS A ON A.VIENPHI_ID = V.VIENPHI_ID        left join (select DISTINCT HD.VIENPHI_ID from TT_HOADON_CHITIET_NOITRU AS HD        inner join TT_HOADON AS H ON H.HOADON_ID = HD.HOADON_ID AND H.HUYHOADON = '1'        where H.TIEPNHAN_ID = 27478                 ) AS B ON B.VIENPHI_ID = V.VIENPHI_ID                 where        V.TIEPNHAN_ID = 27478 and V.REF_TABLE = 'TT_DVYEUCAU']
2019-09-20 16:49:42,968 [1] DEBUG - Statement Id: [DAO00019_GetLoaiGiaLoaiKhachHang] PreparedStatement : [select A.*, B.DICTIONARY_CODE MAKHACHHANG, C.TENLOAIGIA        from TM_NGUONKHACHHANG_LOAIGIA A        left join LST_DICTIONARY B on A.NGUONKHACHHANG_BENHNHAN_ID = B.DICTIONARY_ID        inner join TM_LOAIGIA C on C.LOAIGIA_ID = A.LOAIGIA_ID and CAPTREN_ID  = (select LOAIGIA_ID from TM_LOAIGIA where MALOAIGIA = 'GiaDichVu')        left join TM_DICHVU_DONGIA dvdg on dvdg.LOAIGIA_ID = A.LOAIGIA_ID        where B.DICTIONARY_TYPE_CODE = 'NguonKhachHang' and dvdg.DICHVU_ID  =  @param0]
2019-09-20 16:49:42,968 [1] DEBUG - Statement Id: [DAO00019_GetLoaiGiaLoaiKhachHang] Parameters: [@param0=[DICHVU_ID,5492]]
2019-09-20 16:49:42,968 [1] DEBUG - Statement Id: [DAO00019_GetLoaiGiaLoaiKhachHang] Types: [@param0=[Int64, System.Int64]]
2019-09-20 16:49:43,037 [1] DEBUG - Statement Id: [DAO00017_GetLoaiGiaDoiTuongDichVu] PreparedStatement : [select a.LOAIGIA_ID, a.TENLOAIGIA, a.MALOAIGIA, a.CAPTREN_ID, MIN(a.UUTIEN_NGUON) AS UUTIEN_NGUON          , MAX(a.DOUUTIEN) AS DOUUTIEN, MIN(ISNULL(a.GIAHOTRO,0)) AS GIAHOTRO          from(                        select distinct A.LOAIGIA_ID, C.TENLOAIGIA, C.MALOAIGIA, 0 as UUTIEN_NGUON, isnull(B.DOUUTIEN,0) as DOUUTIEN, B.GIAHOTRO, C.CAPTREN_ID            from TM_DOITUONG_GIADICHVU A            left join TM_DOITUONG_LOAIGIA B on A.LOAIGIA_ID = B.LOAIGIA_ID and A.DOITUONG_ID = B.DOITUONG_ID and B.BENHVIEN_ID = 'HLU01'            inner join TM_LOAIGIA C on A.LOAIGIA_ID = C.LOAIGIA_ID and C.BENHVIEN_ID = 'HLU01'            where A.DOITUONG_ID = '4'                            and A.DICHVU_ID = '5492'                            and C.CAPTREN_ID = (select LOAIGIA_ID from TM_LOAIGIA              where MALOAIGIA = 'GiaDichVu'              and BENHVIEN_ID = 'HLU01')                         and A.BENHVIEN_ID = 'HLU01'                     ) a          where a.DOUUTIEN != 0 and a.DOUUTIEN is not null          group by a.LOAIGIA_ID, a.TENLOAIGIA, a.MALOAIGIA, a.CAPTREN_ID          order by MAX(a.UUTIEN_NGUON) desc ,MAX(a.DOUUTIEN) asc]
2019-09-20 16:49:43,210 [1] DEBUG - Statement Id: [DAO00000_GetDICHVU_DONGIA_LOAIGIA] PreparedStatement : [select A.LOAIGIA_ID, A.BANGGIA_ID, A.GIAVON, A.TYLEVAT  as TYLE_VAT, A.TYLE_LOINHUAN,            A.DONGIA as DONGIA_DOANHTHU, NULL as DONGIA_KHAC, isnull(D.MAPHANNHOMDICHVU, 'TT') as LOAI_CHIPHI            from TM_DICHVU_DONGIA A            inner join TM_BANGGIA B on B.LOAIGIA_ID = A.LOAIGIA_ID AND B.BENHVIEN_ID = 'HLU01'            left join (select B.MAPHANNHOMDICHVU, A.* from TM_DICHVU_PHANNHOMDICHVU A            inner join TM_PHANNHOMDICHVU B on  B.PHANNHOMDICHVU_ID = A.PHANNHOMDICHVU_ID            where A.DICHVU_ID = '5492' AND A.BENHVIEN_ID = 'HLU01') D on A.DICHVU_ID = D.DICHVU_ID            where A.LOAIGIA_ID = '2' and A.DICHVU_ID = '5492'            union            select A.LOAIGIA_ID, null as BANGGIA_ID, null as GIAVON, null as TYLE_VAT, null as TYLE_LOINHUAN,            null as DONGIA_DOANHTHU, C.DONGIA as DONGIA_KHAC, isnull(D.MAPHANNHOMDICHVU, 'TT') as LOAI_CHIPHI            from TM_DOITUONG_GIADICHVU A            inner join TM_BANGGIA B on B.LOAIGIA_ID = A.LOAIGIA_ID AND B.BENHVIEN_ID = 'HLU01'            left join TM_DICHVU_DONGIA C on C.LOAIGIA_ID = A.LOAIGIA_ID AND C.BENHVIEN_ID = 'HLU01'            and C.BANGGIA_ID = B.BANGGIA_ID and C.DICHVU_ID = A.DICHVU_ID            left join (select B.MAPHANNHOMDICHVU, A.* from TM_DICHVU_PHANNHOMDICHVU A            inner join TM_PHANNHOMDICHVU B on  B.PHANNHOMDICHVU_ID = A.PHANNHOMDICHVU_ID            where A.DICHVU_ID = '5492' AND A.BENHVIEN_ID = 'HLU01') D on A.DICHVU_ID = D.DICHVU_ID            where A.DOITUONG_ID = '4'  and A.DICHVU_ID = '5492' and A.LOAIGIA_ID            in (select top 1 LOAIGIA_ID from TM_DOITUONG_LOAIGIA            where DOITUONG_ID = '4' and GIAHOTRO = '1'  AND BENHVIEN_ID = 'HLU01'            and LOAIGIA_ID            in (select LOAIGIA_ID from TM_BANGGIA            where LOAIBANGGIA in            (select LOAIBANGGIA from TM_BANGGIA where LOAIGIA_ID = '2'  AND BENHVIEN_ID = 'HLU01')            and TAMNGUNG = '0')  AND BENHVIEN_ID = 'HLU01'            )]
2019-09-20 16:49:43,364 [1] DEBUG - Statement Id: [DAO00024_TM_TIEPNHAN_BANGGIA_DICHVU_getlist] PreparedStatement : [select * from TM_TIEPNHAN_BANGGIA_DICHVU where TAMNGUNG != '1' and BENHVIEN_ID = 'HLU01']
2019-09-20 16:49:43,399 [1] DEBUG - Statement Id: [DAO00000_GetDICHVU_DONGIA_LOAIGIA] PreparedStatement : [select A.LOAIGIA_ID, A.BANGGIA_ID, A.GIAVON, A.TYLEVAT  as TYLE_VAT, A.TYLE_LOINHUAN,            A.DONGIA as DONGIA_DOANHTHU, NULL as DONGIA_KHAC, isnull(D.MAPHANNHOMDICHVU, 'TT') as LOAI_CHIPHI            from TM_DICHVU_DONGIA A            inner join TM_BANGGIA B on B.LOAIGIA_ID = A.LOAIGIA_ID AND B.BENHVIEN_ID = 'HLU01'            left join (select B.MAPHANNHOMDICHVU, A.* from TM_DICHVU_PHANNHOMDICHVU A            inner join TM_PHANNHOMDICHVU B on  B.PHANNHOMDICHVU_ID = A.PHANNHOMDICHVU_ID            where A.DICHVU_ID = '5492' AND A.BENHVIEN_ID = 'HLU01') D on A.DICHVU_ID = D.DICHVU_ID            where A.LOAIGIA_ID = '2' and A.DICHVU_ID = '5492'            union            select A.LOAIGIA_ID, null as BANGGIA_ID, null as GIAVON, null as TYLE_VAT, null as TYLE_LOINHUAN,            null as DONGIA_DOANHTHU, C.DONGIA as DONGIA_KHAC, isnull(D.MAPHANNHOMDICHVU, 'TT') as LOAI_CHIPHI            from TM_DOITUONG_GIADICHVU A            inner join TM_BANGGIA B on B.LOAIGIA_ID = A.LOAIGIA_ID AND B.BENHVIEN_ID = 'HLU01'            left join TM_DICHVU_DONGIA C on C.LOAIGIA_ID = A.LOAIGIA_ID AND C.BENHVIEN_ID = 'HLU01'            and C.BANGGIA_ID = B.BANGGIA_ID and C.DICHVU_ID = A.DICHVU_ID            left join (select B.MAPHANNHOMDICHVU, A.* from TM_DICHVU_PHANNHOMDICHVU A            inner join TM_PHANNHOMDICHVU B on  B.PHANNHOMDICHVU_ID = A.PHANNHOMDICHVU_ID            where A.DICHVU_ID = '5492' AND A.BENHVIEN_ID = 'HLU01') D on A.DICHVU_ID = D.DICHVU_ID            where A.DOITUONG_ID = '4'  and A.DICHVU_ID = '5492' and A.LOAIGIA_ID            in (select top 1 LOAIGIA_ID from TM_DOITUONG_LOAIGIA            where DOITUONG_ID = '4' and GIAHOTRO = '1'  AND BENHVIEN_ID = 'HLU01'            and LOAIGIA_ID            in (select LOAIGIA_ID from TM_BANGGIA            where LOAIBANGGIA in            (select LOAIBANGGIA from TM_BANGGIA where LOAIGIA_ID = '2'  AND BENHVIEN_ID = 'HLU01')            and TAMNGUNG = '0')  AND BENHVIEN_ID = 'HLU01'            )]
2019-09-20 16:49:43,530 [1] DEBUG - Statement Id: [DAO00024_TM_TIEPNHAN_BANGGIA_DICHVU_getlist] PreparedStatement : [select * from TM_TIEPNHAN_BANGGIA_DICHVU where TAMNGUNG != '1' and BENHVIEN_ID = 'HLU01']
2019-09-20 16:49:50,229 [1] DEBUG - Statement Id: [DAO00020_KiemtrangaychidinhdvHople] PreparedStatement : [select * from TT_TIEPNHAN where  THOIGIANTIEPNHAN >  @param0  and TIEPNHAN_ID =  @param1]
2019-09-20 16:49:50,229 [1] DEBUG - Statement Id: [DAO00020_KiemtrangaychidinhdvHople] Parameters: [@param0=[NGAYGIOYEUCAU,9/20/2019 4:49:35 PM], @param1=[TIEPNHAN_ID,27478]]
2019-09-20 16:49:50,229 [1] DEBUG - Statement Id: [DAO00020_KiemtrangaychidinhdvHople] Types: [@param0=[DateTime, System.DateTime], @param1=[Int64, System.Int64]]
2019-09-20 16:49:50,276 [1] DEBUG - Statement Id: [DAO00020_GetDSDichVuYC_TN] PreparedStatement : [select top 1 dvyc.TIEPNHAN_ID, dvyc.BENHNHAN_ID, ntba.BENHAN_ID, dvyc.DICHVU_ID, dvyc.HUYYEUCAU,        case when ntba.SOBENHAN is null then N'ngoại trú'        when ntba.SOBENHAN like '%CC' then N'cấp cứu'        when ntba.SOBENHAN is not null then N'nội trú'        else N'' end as SUDUNGTAI        from TT_DVYEUCAU dvyc        left join TT_NOITRU_BENHAN ntba on dvyc.BENHAN_ID = ntba.BENHAN_ID        where        dvyc.TIEPNHAN_ID = 27478        and dvyc.HUYYEUCAU = 0        and dvyc.DICHVU_ID = 5492        order by dvyc.NGAYGIOYEUCAU desc]
2019-09-20 16:49:52,004 [1] DEBUG - Statement Id: [DAO00014_GetPatientStatus] PreparedStatement : [select        CASE        when tn.TRANGTHAI = 'HOANTHANH' Then tn.TRANGTHAI        WHEN xncp.XACNHANCHIPHI_ID is not null THEN 'XACNHANCHIPHI'        WHEN (tn.KHOADULIEU = '1') THEN 'KHOADULIEU'        ELSE tn.TRANGTHAI        END        as TRANGTHAI        from TT_TIEPNHAN tn        left join TT_XACNHANCHIPHI xncp on tn.TIEPNHAN_ID = xncp.TIEPNHAN_ID        where tn.TIEPNHAN_ID = '27478'        and tn.BENHVIEN_ID = 'HLU01']
2019-09-20 16:49:52,147 [1] DEBUG - Statement Id: [DAO00020_GetListTrangthaiDvKhamBenh] PreparedStatement : [select dvyc.KHAMBENH_NGOAITRU_ID, dvyc.TRANGTHAI, dvyc.DVYEUCAU_ID, dvyc.DICHVU_ID, dvyc.NOITHUCHIEN_ID, dvyc.DALAYMAU, dv.TENDICHVU        from TT_DVYEUCAU dvyc        left join TM_DICHVU dv on dv.DICHVU_ID = dvyc.DICHVU_ID        left join TM_NHOMDICHVU ndv on ndv.NHOMDICHVU_ID = dv.NHOMDICHVU_ID        where left(ndv.MANHOMDICHVU, 2) = '04'        and TIEPNHAN_ID = 27478]
2019-09-20 16:49:52,192 [1] DEBUG - Statement Id: [DAO00020_GetListTrangThaiDV] PreparedStatement : [select vp.*,                 mgct.MIENGIAMCHITIET_ID        from TT_VIENPHI vp        left join (select VIENPHI_ID, MIENGIAMCHITIET_ID from TT_MIENGIAM_CHITIET where REF_TABLE = 'TT_MIENGIAM'        or REF_TABLE = 'TT_MIENGIAM_CONGTY'        or REF_TABLE = 'TT_MIENGIAM_BHTN') mgct        on vp.VIENPHI_ID = mgct.VIENPHI_ID        where REF_TABLE = 'TT_DVYEUCAU'        and vp.TIEPNHAN_ID = 27478                 order by vp.VIENPHI_ID]
2019-09-20 16:49:52,314 [1] DEBUG - Statement Id: [DAOLOG01_LockBegin] PreparedStatement : [INSERT into TT_LOG_UPDATE ( REF_TABLE , REF_ID , BENHVIEN_ID )         values ( @param0 ,  @param1 ,  @param2 );]
2019-09-20 16:49:52,314 [1] DEBUG - Statement Id: [DAOLOG01_LockBegin] Parameters: [@param0=[REF_TABLE,TT_VIENPHI], @param1=[REF_ID,27478], @param2=[BENHVIEN_ID,HLU01]]
2019-09-20 16:49:52,314 [1] DEBUG - Statement Id: [DAOLOG01_LockBegin] Types: [@param0=[String, System.String], @param1=[Int64, System.Int64], @param2=[String, System.String]]
2019-09-20 16:49:52,357 [1] DEBUG - Statement Id: [DAO00023_GetSOBHYT_HUONG_ID] PreparedStatement : [select isnull(MAX(SOBHYT_HUONG_ID),0) SOBHYT_HUONG_ID        from TT_TIEPNHAN_SOTHEBHYT        where TIEPNHAN_ID = '27478']
2019-09-20 16:49:52,415 [1] DEBUG - Statement Id: [DAO00020_GetListAllDvYeucau] PreparedStatement : [select A.*, B.KHONGTHUTIEN, B.SOLUONG, B.YEUCAUVP, B.DICHVU_TL        from TT_DVYEUCAU A        left join        (select * from TT_VIENPHI where TIEPNHAN_ID =  @param0  and BENHVIEN_ID = 'HLU01') B on B.REF_ID = A.DVYEUCAU_ID and B.REF_TABLE = 'TT_DVYEUCAU'        where A.TIEPNHAN_ID =  @param0  and A.BENHVIEN_ID = 'HLU01']
2019-09-20 16:49:52,415 [1] DEBUG - Statement Id: [DAO00020_GetListAllDvYeucau] Parameters: [@param0=[TIEPNHAN_ID,27478]]
2019-09-20 16:49:52,415 [1] DEBUG - Statement Id: [DAO00020_GetListAllDvYeucau] Types: [@param0=[Int64, System.Int64]]
2019-09-20 16:49:52,448 [1] DEBUG - Statement Id: [DAO00020_Add] PreparedStatement : [declare        @keyValue int, @BenhVienId varchar(10), @yearNow int, @SoPhieuYeu varchar(20), @SoRender varchar(20), @MaNhomDichVu varchar(20)        set @keyValue = 0;        set @BenhVienId = 'HLU01'        set @yearNow = YEAR(getdate())        set @MaNhomDichVu = '5'                 select @keyValue = KEYVALUE from LST_KEYDATA        where KEYTYPE = 'SOPHIEUYEUCAU' and KEYYEAR = @yearNow and SEGMENT_1 = @MaNhomDichVu and BENHVIEN_ID = @BenhVienId        if @keyValue = 0        Insert into LST_KEYDATA values ('SOPHIEUYEUCAU', @yearNow, '0', '0', @MaNhomDichVu, '0', '0', 0, @BenhVienId);          Update LST_KEYDATA set KEYVALUE = KEYVALUE + 1, @keyValue = (KEYVALUE + 1) where KEYTYPE = 'SOPHIEUYEUCAU' and KEYYEAR = @yearNow and SEGMENT_1 = @MaNhomDichVu and BENHVIEN_ID = @BenhVienId        set @SoRender = right('000000'+convert(varchar(6), @keyValue), 6)        set @SoPhieuYeu = RIGHT(@yearNow, 2) + '.' + @MaNhomDichVu + '.' + @SoRender                 insert into TT_DVYEUCAU (        TIEPNHAN_ID        , BENHAN_ID        , KHAMBENH_ID        , SODICHVUYEUCAU        , KHAMBENH_NGOAITRU_ID        , SOPHIEUYEUCAU        , BENHNHAN_ID        , DOITUONG_ID        , DICHVU_ID         ,           NGUOICHIDINH_ID                 , BACSICHIDINH_ID        , GIOYEUCAU        , NGAYYEUCAU        , THANGYEUCAU        , NAMYEUCAU        , NGAYGIOYEUCAU        , THUTUYEUCAU        , NOIYEUCAU_ID        , NOITHUCHIEN_ID        , TRANGTHAI_HANGDOI        , NOIDUNGCHITIET        , CHANDOAN        , LUUTRU_ID        , SODICHVUDONGTIEN        , DICHVU_KHAMBENH_ID        , DALAYMAU        , SINHTHIET        , CLOTEST        , TIEMCANQUANG        , TRIEUCHUNG        , DAITHE        , VITHE        , BENHPHAM        , DANHANBENHPHAM        , NGAYNHANBENHPHAM        , THOIGIANNHANBENHPHAM        , NGUOINHANBENHPHAM_ID        , MANGUOINHAPBENHPHAM        , TENNGUOINHAPBENHPHAM        , KETQUAXNKHAC        , YEUCAUBENNGOAI        , THUCHIENBENNGOAI        , DONVIBENNGOAI_ID        , BACSIBENNGOAI_ID        , TENBACSIBENNGOAI        , KHOABENNGOAI_ID        , KHOABENNGOAI         ,           NGUOIGIOITHIEU_ID         ,           DONVIGIOITHIEU_ID         ,           NGUONDICHVU_ID                 , NOITHUCHIENTHAYDOI_ID        , LOAIKHACHHANG_ID        , THE_ID        , BARCODEID        , HOPDONG_ID        , HOPDONG_BENHNHAN_ID        , HINHTHUCTHANHTOAN_ID        , DANGKY_ID        , DANGKY_CHITIET_ID        , LICHHEN_ID        , THOIGIANLICHHEN        , BNKHONGDENBV        , GHICHU        , THANHTOANTRUOC        , KHAN        , DUOCPHEPTHUCHIEN        , HUYYEUCAU        , LYDOHUY        , TRANGTHAI        , KHOADULIEU        , NGAYKHOADULIEU        , THOIGIANKHOADULIEU        , NGUOIKHOA_ID        , MANGUOIKHOA        , TENNGUOIKHOA        , BENHVIEN_ID        , NGAYTAO        , NGUOITAO_ID        , NGAYHENCLS        , CREATININEMAU        , VUNGCANKHAOSAT        , BHYTDONGTIEN        , THUTIENSAU         ,           DV30                 , DVKEMTHEO        , DVKEMTHEO_KHACEKIP        , LIENCHUYENKHOA         ,           BHYT_TYLETHANHTOAN_ID         ,           CHUADUYET_BHYT         ,           SOPHIEUGOINGOAI                 )        OUTPUT INSERTED.DVYEUCAU_ID, INSERTED.SOPHIEUYEUCAU        values (         @param0         ,  @param1         ,  @param2         ,  @param3         ,  @param4         , @SoPhieuYeu        ,  @param5         ,  @param6         ,  @param7          ,            @param8                  ,  @param9         ,  @param10         ,  @param11         ,  @param12         ,  @param13         ,  @param14         ,  @param15         ,  @param16         ,  @param17         ,  @param18         ,  @param19         ,  @param20         ,  @param21         ,  @param22         ,  @param23         ,  @param24         ,  @param25         ,  @param26         ,  @param27         ,  @param28         ,  @param29         ,  @param30         ,  @param31         ,  @param32         ,  @param33         ,  @param34         ,  @param35         ,  @param36         ,  @param37         ,  @param38         ,  @param39         ,  @param40         ,  @param41         ,  @param42         ,  @param43         ,  @param44         ,  @param45          ,            @param46          ,            @param47          ,            @param48                  ,  @param49         ,  @param50         ,  @param51         ,  @param52         ,  @param53         ,  @param54         ,  @param55         ,  @param56         ,  @param57         ,  @param58         ,  @param59         ,  @param60         ,  @param61         ,  @param62         ,  @param63         ,  @param64         ,  @param65         ,  @param66         ,  @param67         ,  @param68         ,  @param69         ,  @param70         ,  @param71         ,  @param72         ,  @param73         ,  @param74         ,  @param75         ,  @param76         ,  @param77         ,  @param78         ,  @param79         ,  @param80         ,  @param81          ,            @param82                  ,  @param83         ,  @param84         ,  @param85          ,            @param86          ,            @param87          ,            @param88                  );]
2019-09-20 16:49:52,448 [1] DEBUG - Statement Id: [DAO00020_Add] Parameters: [@param0=[TIEPNHAN_ID,27478], @param1=[BENHAN_ID,null], @param2=[KHAMBENH_ID,26172], @param3=[SODICHVUYEUCAU,1], @param4=[KHAMBENH_NGOAITRU_ID,null], @param5=[BENHNHAN_ID,23423], @param6=[DOITUONG_ID,4], @param7=[DICHVU_ID,5492], @param8=[NGUOICHIDINH_ID,1], @param9=[BACSICHIDINH_ID,1], @param10=[GIOYEUCAU,16], @param11=[NGAYYEUCAU,9/20/2019 12:00:00 AM], @param12=[THANGYEUCAU,9], @param13=[NAMYEUCAU,2019], @param14=[NGAYGIOYEUCAU,9/20/2019 4:49:35 PM], @param15=[THUTUYEUCAU,4], @param16=[NOIYEUCAU_ID,58], @param17=[NOITHUCHIEN_ID,62], @param18=[TRANGTHAI_HANGDOI,null], @param19=[NOIDUNGCHITIET,null], @param20=[CHANDOAN,Viêm phế quản cấp(J20)], @param21=[LUUTRU_ID,null], @param22=[SODICHVUDONGTIEN,0], @param23=[DICHVU_KHAMBENH_ID,null], @param24=[DALAYMAU,null], @param25=[SINHTHIET,0], @param26=[CLOTEST,0], @param27=[TIEMCANQUANG,0], @param28=[TRIEUCHUNG,null], @param29=[DAITHE,null], @param30=[VITHE,null], @param31=[BENHPHAM,null], @param32=[DANHANBENHPHAM,0], @param33=[NGAYNHANBENHPHAM,null], @param34=[THOIGIANNHANBENHPHAM,null], @param35=[NGUOINHANBENHPHAM_ID,null], @param36=[MANGUOINHAPBENHPHAM,null], @param37=[TENNGUOINHAPBENHPHAM,null], @param38=[KETQUAXNKHAC,null], @param39=[YEUCAUBENNGOAI,0], @param40=[THUCHIENBENNGOAI,0], @param41=[DONVIBENNGOAI_ID,null], @param42=[BACSIBENNGOAI_ID,null], @param43=[TENBACSIBENNGOAI,null], @param44=[KHOABENNGOAI_ID,null], @param45=[KHOABENNGOAI,null], @param46=[NGUOIGIOITHIEU_ID,null], @param47=[DONVIGIOITHIEU_ID,null], @param48=[NGUONDICHVU_ID,1], @param49=[NOITHUCHIENTHAYDOI_ID,null], @param50=[LOAIKHACHHANG_ID,null], @param51=[THE_ID,null], @param52=[BARCODEID,null], @param53=[HOPDONG_ID,null], @param54=[HOPDONG_BENHNHAN_ID,null], @param55=[HINHTHUCTHANHTOAN_ID,null], @param56=[DANGKY_ID,null], @param57=[DANGKY_CHITIET_ID,null], @param58=[LICHHEN_ID,null], @param59=[THOIGIANLICHHEN,null], @param60=[BNKHONGDENBV,null], @param61=[GHICHU,null], @param62=[THANHTOANTRUOC,1], @param63=[KHAN,0], @param64=[DUOCPHEPTHUCHIEN,0], @param65=[HUYYEUCAU,0], @param66=[LYDOHUY,null], @param67=[TRANGTHAI,CHUAKETQUA], @param68=[KHOADULIEU,null], @param69=[NGAYKHOADULIEU,null], @param70=[THOIGIANKHOADULIEU,null], @param71=[NGUOIKHOA_ID,null], @param72=[MANGUOIKHOA,null], @param73=[TENNGUOIKHOA,null], @param74=[BENHVIEN_ID,HLU01], @param75=[NGAYTAO,9/20/2019 4:49:52 PM], @param76=[NGUOITAO_ID,1], @param77=[NGAYHENCLS,null], @param78=[CREATININEMAU,null], @param79=[VUNGCANKHAOSAT,null], @param80=[BHYTDONGTIEN,0], @param81=[THUTIENSAU,0], @param82=[DV30,False], @param83=[DVKEMTHEO,0], @param84=[DVKEMTHEO_KHACEKIP,0], @param85=[LIENCHUYENKHOA,0], @param86=[BHYT_TYLETHANHTOAN_ID,null], @param87=[CHUADUYET_BHYT,False], @param88=[SOPHIEUGOINGOAI,null]]
2019-09-20 16:49:52,448 [1] DEBUG - Statement Id: [DAO00020_Add] Types: [@param0=[Int64, System.Int64], @param1=[System.DBNull, null], @param2=[Int64, System.Int64], @param3=[Double, System.Double], @param4=[System.DBNull, null], @param5=[Int64, System.Int64], @param6=[Int64, System.Int64], @param7=[Int64, System.Int64], @param8=[Int64, System.Int64], @param9=[Int64, System.Int64], @param10=[Int64, System.Int64], @param11=[DateTime, System.DateTime], @param12=[Int64, System.Int64], @param13=[Int64, System.Int64], @param14=[DateTime, System.DateTime], @param15=[String, System.String], @param16=[Int64, System.Int64], @param17=[Int64, System.Int64], @param18=[System.DBNull, null], @param19=[System.DBNull, null], @param20=[String, System.String], @param21=[System.DBNull, null], @param22=[Int32, System.Int32], @param23=[System.DBNull, null], @param24=[System.DBNull, null], @param25=[Int64, System.Int64], @param26=[Int64, System.Int64], @param27=[Int64, System.Int64], @param28=[System.DBNull, null], @param29=[System.DBNull, null], @param30=[System.DBNull, null], @param31=[System.DBNull, null], @param32=[Int64, System.Int64], @param33=[System.DBNull, null], @param34=[System.DBNull, null], @param35=[System.DBNull, null], @param36=[System.DBNull, null], @param37=[System.DBNull, null], @param38=[System.DBNull, null], @param39=[String, System.String], @param40=[Int64, System.Int64], @param41=[System.DBNull, null], @param42=[System.DBNull, null], @param43=[System.DBNull, null], @param44=[System.DBNull, null], @param45=[System.DBNull, null], @param46=[System.DBNull, null], @param47=[System.DBNull, null], @param48=[Int64, System.Int64], @param49=[System.DBNull, null], @param50=[System.DBNull, null], @param51=[System.DBNull, null], @param52=[System.DBNull, null], @param53=[System.DBNull, null], @param54=[System.DBNull, null], @param55=[System.DBNull, null], @param56=[System.DBNull, null], @param57=[System.DBNull, null], @param58=[System.DBNull, null], @param59=[System.DBNull, null], @param60=[System.DBNull, null], @param61=[System.DBNull, null], @param62=[Int64, System.Int64], @param63=[String, System.String], @param64=[Int64, System.Int64], @param65=[String, System.String], @param66=[System.DBNull, null], @param67=[String, System.String], @param68=[System.DBNull, null], @param69=[System.DBNull, null], @param70=[System.DBNull, null], @param71=[System.DBNull, null], @param72=[System.DBNull, null], @param73=[System.DBNull, null], @param74=[String, System.String], @param75=[DateTime, System.DateTime], @param76=[Int32, System.Int32], @param77=[System.DBNull, null], @param78=[System.DBNull, null], @param79=[System.DBNull, null], @param80=[String, System.String], @param81=[String, System.String], @param82=[Boolean, System.Boolean], @param83=[String, System.String], @param84=[String, System.String], @param85=[String, System.String], @param86=[System.DBNull, null], @param87=[Boolean, System.Boolean], @param88=[System.DBNull, null]]
2019-09-20 16:49:52,482 [1] DEBUG - Statement Id: [DAO00020_GetDVYeuCau_ByDvYeuCau_id] PreparedStatement : [select *        from TT_DVYEUCAU where DVYEUCAU_ID = 205443]
2019-09-20 16:49:52,518 [1] DEBUG - Statement Id: [DAO00049_KiemtraloaiDV] PreparedStatement : [select DICHVU_ID AS HA, '' AS XN, '' as TDCN, '' as TT, '' as KB from TM_DICHVU            left join TM_NHOMDICHVU ndv on ndv.NHOMDICHVU_ID = TM_DICHVU.NHOMDICHVU_ID            where DICHVU_ID = '5492' and left(ndv.MANHOMDICHVU, 2) = '02'            union            select  '' as HA, DICHVU_ID AS XN, '' as TDCN, '' as TT, '' as KB from TM_DICHVU            left join TM_NHOMDICHVU ndv on ndv.NHOMDICHVU_ID = TM_DICHVU.NHOMDICHVU_ID            where DICHVU_ID = '5492' and left(ndv.MANHOMDICHVU, 2) = '01'            union            select  '' as HA, '' AS XN, DICHVU_ID as TDCN, '' as TT, '' as KB from TM_DICHVU            left join TM_NHOMDICHVU ndv on ndv.NHOMDICHVU_ID = TM_DICHVU.NHOMDICHVU_ID            where DICHVU_ID = '5492' and left(ndv.MANHOMDICHVU, 2) = '03'            union            select  '' as HA, '' AS XN, '' as TDCN, DICHVU_ID as TT, '' as KB from TM_DICHVU            left join TM_NHOMDICHVU ndv on ndv.NHOMDICHVU_ID = TM_DICHVU.NHOMDICHVU_ID            where DICHVU_ID = '5492' and left(ndv.MANHOMDICHVU, 2) = '05'            union            select  '' as HA, '' AS XN, '' as TDCN, DICHVU_ID as TT, '' as KB from TM_DICHVU            left join TM_NHOMDICHVU ndv on ndv.NHOMDICHVU_ID = TM_DICHVU.NHOMDICHVU_ID            where DICHVU_ID = '5492' and left(ndv.MANHOMDICHVU, 2) = '06'            union            select  '' as HA, '' AS XN, '' as TDCN, '' as TT, DICHVU_ID as KB from TM_DICHVU            left join TM_NHOMDICHVU ndv on ndv.NHOMDICHVU_ID = TM_DICHVU.NHOMDICHVU_ID            where DICHVU_ID = '5492' and left(ndv.MANHOMDICHVU, 2) = '04']
2019-09-20 16:49:52,550 [1] DEBUG - Statement Id: [DAO00009_TT_TIEPNHAN_GetProcess] PreparedStatement : [select PROCESS_ID from TT_TIEPNHAN where SOTIEPNHAN = 'TN190920.0000001']
2019-09-20 16:49:52,616 [1] DEBUG - Statement Id: [DAOWF001_Kiemtrathongtindayeucaudacochua] PreparedStatement : [select * from TT_REQUEST        where        PARA = '{"HOSPITAL_ID":"HLU01","SOTIEPNHAN":"TN190920.0000001"}'        AND ISACTIVE = '1']
2019-09-20 16:49:52,672 [1] DEBUG - Statement Id: [DAOWF001_Kiemtrathongtindichvudayeucau] PreparedStatement : [select top 1 * from TT_REQUEST_SERVICE        where        PARA = '{"DICHVU_ID":"5492","DVYEUCAU_ID":"205443"}'                AND ISACTIVE = '1' order by ID desc]
2019-09-20 16:49:52,766 [1] DEBUG - Statement Id: [DAOWF001_KiemtrathongtinchitietDichvuYeucau] PreparedStatement : [select * from TT_REQUEST_SERVICE_DETAIL        where        REQUEST_SERVICE_ID = '']
2019-09-20 16:49:52,827 [1] DEBUG - Statement Id: [DAOWF001_GetStartStateOfProcess] PreparedStatement : [select STATE_CODE from TM_STATE where TYPE_CODE = 'S' and PROCESS_CODE = 'P02']
2019-09-20 16:49:52,863 [1] DEBUG - Statement Id: [DAOWF001_Laythongtinwithstatecode] PreparedStatement : [select A.*, B.STATUS_CODE from        TM_STATE_ACTION A        left join TM_STATE B on B.STATE_CODE = A.NEXT_STATE_CODE and A.PROCESS_CODE = B.PROCESS_CODE        where        A.CURR_STATE_CODE = '7'        AND A.PROCESS_CODE = 'P02'        Order By ORDER_ID ASC]
2019-09-20 16:49:52,895 [1] DEBUG - Statement Id: [DAOWF003_Add] PreparedStatement : [insert into TT_REQUEST_SERVICE (        REQUEST_ID        , PARA        , CURR_STATE_CODE        , PROCESS_CODE        ) values (         @param0         ,  @param1         ,  @param2         ,  @param3         )        SELECT SCOPE_IDENTITY()]
2019-09-20 16:49:52,895 [1] DEBUG - Statement Id: [DAOWF003_Add] Parameters: [@param0=[REQUEST_ID,31779], @param1=[SERVICEPARA,{"DICHVU_ID":"5492","DVYEUCAU_ID":"205443"}], @param2=[CURR_STATE_CODE,0], @param3=[PROCESS_CODE,P02]]
2019-09-20 16:49:52,895 [1] DEBUG - Statement Id: [DAOWF003_Add] Types: [@param0=[Int32, System.Int32], @param1=[String, System.String], @param2=[String, System.String], @param3=[String, System.String]]
2019-09-20 16:49:52,932 [1] DEBUG - Statement Id: [DAOWF005_Add] PreparedStatement : [insert into TT_REQUEST_SERVICE_DETAIL (        REQUEST_ID        ,REQUEST_SERVICE_ID        , OLD_STATE_CODE        , CURR_STATE_CODE        ) values (         @param0         , @param1         ,  @param2         ,  @param3         )        SELECT SCOPE_IDENTITY()]
2019-09-20 16:49:52,932 [1] DEBUG - Statement Id: [DAOWF005_Add] Parameters: [@param0=[REQUEST_ID,31779], @param1=[REQUEST_SERVICE_ID,147390], @param2=[OLD_STATE_CODE,null], @param3=[CURR_STATE_CODE,0]]
2019-09-20 16:49:52,932 [1] DEBUG - Statement Id: [DAOWF005_Add] Types: [@param0=[String, System.String], @param1=[Int64, System.Int64], @param2=[System.DBNull, null], @param3=[String, System.String]]
2019-09-20 16:49:52,965 [1] DEBUG - Statement Id: [DAOWF005_Add_History] PreparedStatement : [insert into TT_REQUEST_SERVICE_HISTORY (        REQUEST_ID        ,REQUEST_SERVICE_ID        , OLD_STATE_CODE        , CURR_STATE_CODE        ) values (         @param0         , @param1         ,  @param2         ,  @param3         )]
2019-09-20 16:49:52,965 [1] DEBUG - Statement Id: [DAOWF005_Add_History] Parameters: [@param0=[REQUEST_ID,31779], @param1=[REQUEST_SERVICE_ID,147390], @param2=[OLD_STATE_CODE,null], @param3=[CURR_STATE_CODE,0]]
2019-09-20 16:49:52,965 [1] DEBUG - Statement Id: [DAOWF005_Add_History] Types: [@param0=[String, System.String], @param1=[Int64, System.Int64], @param2=[System.DBNull, null], @param3=[String, System.String]]
2019-09-20 16:49:53,052 [1] DEBUG - Statement Id: [DAO00009_TT_DVYEUCAU_Update] PreparedStatement : [Update TT_DVYEUCAU set TRANGTHAI_WFL = 'CHUAKETQUA' where DVYEUCAU_ID = '205443']
2019-09-20 16:49:53,091 [1] DEBUG - Statement Id: [DAO00023_Add] PreparedStatement : [insert into TT_VIENPHI (        TIEPNHAN_ID        , BENHAN_ID         ,           BENHNHAN_ID         ,           DOTDIEUTRI_ID                 , KHAMBENH_ID        , REF_ID        , REF_TABLE        , DICHVU_ID        , DUOC_ID        , LOAI_CHIPHI        , LOAIGIA_ID        , SOLUONG        , DONGIA_DOANHTHU        , THANHTIEN_DOANHTHU        , BHYT_TL        , BHYT_DONGIA        , BHYT_THANHTIEN        , BHYT_DONGIA_CHITRA        , BHYT_THANHTIEN_CHITRA        , BENHNHAN_PHAITHANHTOAN        , GIATRI_HOADON        , GIATRI_HOADON_DATHANHTOAN        , GIATRI_BIENLAI        , GIATRI_BIENLAI_DATHANHTOAN        , GIATRI_BENHNHAN_DATHANHTOAN        , GIATRI_THATTHU        , MIENGIAM_TL        , MIENGIAM_GIATRI        , NGANSACH_TL        , NGANSACH_GIATRI        , TAITRO_TL        , TAITRO_GIATRI        , BHTN_TL        , BHTN_DONGIA        , BHTN_THANHTIEN        , BHTN_DONGIA_CHITRA        , BHTN_THANHTIEN_CHITRA         ,           DUOCPHEPTHUCHIEN         ,           HUY         ,           DATHANHTOAN         ,           DATHUCHIEN         ,           KHONGTHUTIEN         ,           BHYTDONGTIEN                 , DUYET        , HOADON_ID         ,           ACTIVE         ,           TYLE_VAT         ,           GIAVON         ,           BANGGIA_ID                 , BENHVIEN_ID        , NGUOITAO_ID        , NGAYTAO        , NGUOICAPNHAT_ID        , NGAYCAPNHAT        , DONGIA_BHYT_BANDAU        , DONGIADOANHTHU_BANDAU         ,           YEUCAUVP         ,           DOITUONG_HUONG_ID         ,           SOBHYT_HUONG_ID         ,           DICHVU_TL                 ) values (         @param0         ,  @param1          ,            @param2          ,            @param3                  ,  @param4         ,  @param5         ,  @param6         ,  @param7         ,  @param8         ,  @param9         ,  @param10         ,  @param11         ,  @param12         ,  @param13         ,  @param14         ,  @param15         ,  @param16         ,  @param17         ,  @param18         ,  @param19         ,  @param20         ,  @param21         ,  @param22         ,  @param23         ,  @param24         ,  @param25         ,  @param26         ,  @param27         ,  @param28         ,  @param29         ,  @param30         ,  @param31         ,  @param32         ,  @param33         ,  @param34         ,  @param35         ,  @param36          ,            @param37          ,            @param38          ,            @param39          ,            @param40          ,            @param41          ,            @param42                  ,  @param43         ,  @param44          ,            @param45          ,            @param46          ,            @param47          ,            @param48                  ,  @param49         ,  @param50         ,  @param51         ,  @param52         ,  @param53         ,  @param54         ,  @param55          ,            @param56          ,            @param57          ,            @param58          ,            @param59                  )        SELECT SCOPE_IDENTITY()]
2019-09-20 16:49:53,092 [1] DEBUG - Statement Id: [DAO00023_Add] Parameters: [@param0=[TIEPNHAN_ID,27478], @param1=[BENHAN_ID,null], @param2=[BENHNHAN_ID,23423], @param3=[DOTDIEUTRI_ID,null], @param4=[KHAMBENH_ID,null], @param5=[REF_ID,205443], @param6=[REF_TABLE,TT_DVYEUCAU], @param7=[DICHVU_ID,5492], @param8=[DUOC_ID,null], @param9=[LOAI_CHIPHI,TT], @param10=[LOAIGIA_ID,2], @param11=[SOLUONG,1], @param12=[DONGIA_DOANHTHU,33000], @param13=[THANHTIEN_DOANHTHU,33000], @param14=[BHYT_TL,0], @param15=[BHYT_DONGIA,33000], @param16=[BHYT_THANHTIEN,33000], @param17=[BHYT_DONGIA_CHITRA,0], @param18=[BHYT_THANHTIEN_CHITRA,0], @param19=[BENHNHAN_PHAITHANHTOAN,0], @param20=[GIATRI_HOADON,0], @param21=[GIATRI_HOADON_DATHANHTOAN,0], @param22=[GIATRI_BIENLAI,0], @param23=[GIATRI_BIENLAI_DATHANHTOAN,0], @param24=[GIATRI_BENHNHAN_DATHANHTOAN,0], @param25=[GIATRI_THATTHU,0], @param26=[MIENGIAM_TL,0], @param27=[MIENGIAM_GIATRI,0], @param28=[NGANSACH_TL,0], @param29=[NGANSACH_GIATRI,0], @param30=[TAITRO_TL,0], @param31=[TAITRO_GIATRI,0], @param32=[BHTN_TL,0], @param33=[BHTN_DONGIA,0], @param34=[BHTN_THANHTIEN,0], @param35=[BHTN_DONGIA_CHITRA,0], @param36=[BHTN_THANHTIEN_CHITRA,0], @param37=[DUOCPHEPTHUCHIEN,1], @param38=[HUY,0], @param39=[DATHANHTOAN,0], @param40=[DATHUCHIEN,0], @param41=[KHONGTHUTIEN,1], @param42=[BHYTDONGTIEN,0], @param43=[DUYET,null], @param44=[HOADON_ID,null], @param45=[ACTIVE,1], @param46=[TYLE_VAT,0], @param47=[GIAVON,0], @param48=[BANGGIA_ID,996], @param49=[BENHVIEN_ID,HLU01], @param50=[NGUOITAO_ID,1], @param51=[NGAYTAO,9/20/2019 4:49:53 PM], @param52=[NGUOICAPNHAT_ID,1], @param53=[NGAYCAPNHAT,9/20/2019 4:49:53 PM], @param54=[DONGIA_BHYT_BANDAU,33000], @param55=[DONGIADOANHTHU_BANDAU,33000], @param56=[YEUCAUVP,0], @param57=[DOITUONG_HUONG_ID,4], @param58=[SOBHYT_HUONG_ID,28501], @param59=[DICHVU_TL,1]]
2019-09-20 16:49:53,092 [1] DEBUG - Statement Id: [DAO00023_Add] Types: [@param0=[Int64, System.Int64], @param1=[System.DBNull, null], @param2=[Int64, System.Int64], @param3=[System.DBNull, null], @param4=[System.DBNull, null], @param5=[Int32, System.Int32], @param6=[String, System.String], @param7=[Int64, System.Int64], @param8=[System.DBNull, null], @param9=[String, System.String], @param10=[Int64, System.Int64], @param11=[Double, System.Double], @param12=[Double, System.Double], @param13=[Double, System.Double], @param14=[Double, System.Double], @param15=[Double, System.Double], @param16=[Double, System.Double], @param17=[Double, System.Double], @param18=[Double, System.Double], @param19=[Double, System.Double], @param20=[Double, System.Double], @param21=[Double, System.Double], @param22=[Double, System.Double], @param23=[Double, System.Double], @param24=[Double, System.Double], @param25=[Double, System.Double], @param26=[Double, System.Double], @param27=[Double, System.Double], @param28=[Double, System.Double], @param29=[Double, System.Double], @param30=[Double, System.Double], @param31=[Double, System.Double], @param32=[Double, System.Double], @param33=[Double, System.Double], @param34=[Double, System.Double], @param35=[Double, System.Double], @param36=[Double, System.Double], @param37=[String, System.String], @param38=[Int64, System.Int64], @param39=[Int64, System.Int64], @param40=[Int64, System.Int64], @param41=[String, System.String], @param42=[String, System.String], @param43=[System.DBNull, null], @param44=[System.DBNull, null], @param45=[Int64, System.Int64], @param46=[Int64, System.Int64], @param47=[Double, System.Double], @param48=[Int64, System.Int64], @param49=[String, System.String], @param50=[Int32, System.Int32], @param51=[DateTime, System.DateTime], @param52=[Int32, System.Int32], @param53=[DateTime, System.DateTime], @param54=[Double, System.Double], @param55=[Double, System.Double], @param56=[String, System.String], @param57=[Int64, System.Int64], @param58=[Int32, System.Int32], @param59=[Double, System.Double]]
2019-09-20 16:49:53,129 [1] DEBUG - Statement Id: [DAO00027_ThongTinTiepNhanCOM006NhieuDVYeucau] PreparedStatement : [select distinct CONVERT(VARCHAR(11),A.NGAYTIEPNHAN,103) as NGAYYEUCAU, C.DICHVU_ID, C.DVYEUCAU_ID, D.TENDICHVU, C.NOITHUCHIEN_ID,        A.SOTIEPNHAN, A.TRAITUYEN, A.NGAYMIENDONGCHITRA, A.TIEPNHAN_ID, A.DOITUONG_ID, A.TRANGTHAI,        A.LOAITHANHVIEN_ID, A.SUDUNG_BHTN, A.THE_ID, A.THANHVIEN_ID, A.VIP, A.NGUON_BENHNHAN_ID, A.BAOLANH_VIENPHI,        CASE WHEN (A.TRANGTHAI = 'NOITRU' OR A.TRANGTHAI = 'CAPCUU'   or A.TRANGTHAI = 'NGOAITRU') THEN 'IN' ELSE 'OUT' END AS LOAIBENHAN,        CASE WHEN (C.TRANGTHAI = 'CHUAKETQUA') THEN 'CHUAKETQUA' ELSE 'HOANTAT' END AS TRANGTHAIDICHVU, A.SOBHYT,        B.*,        CASE WHEN Left(E.MANHOMDICHVU,2) = '03' THEN '02' ELSE Left(E.MANHOMDICHVU,2) END AS MANHOMDICHVU        , A.UUTIEN        from TT_TIEPNHAN A        inner join TT_BENHNHAN B on B.BENHNHAN_ID = A.BENHNHAN_ID and (A.TRANGTHAI = 'DATIEPNHAN' or A.TRANGTHAI = 'NOITRU' or A.TRANGTHAI = 'CAPCUU'  or A.TRANGTHAI = 'NGOAITRU') and B.ACTIVE = '1'        inner join TT_DVYEUCAU C on C.TIEPNHAN_ID = A.TIEPNHAN_ID        left join TM_DICHVU D on D.DICHVU_ID = C.DICHVU_ID        left join TM_NHOMDICHVU E on E.NHOMDICHVU_ID = D.NHOMDICHVU_ID        where C.NGAYHENCLS is NULL and A.TIEPNHAN_ID = '27478' and A.BENHVIEN_ID = 'HLU01'         and           C.DVYEUCAU_ID in (205443)]
2019-09-20 16:49:53,313 [1] DEBUG - Statement Id: [DAO00027_ThongTinTiepNhanCOM015] PreparedStatement : [declare @ManhomDSA varchar(10);        select top 1  @ManhomDSA = VALUE from TM_SYS_APPSETTINGS where CODE = 'MANHOM_DICHVU_DSA'        SELECT * FROM        (        SELECT        (A.SOTIEPNHAN + (CASE WHEN Left(E.MANHOMDICHVU,2) = '03' THEN '02' ELSE Left(E.MANHOMDICHVU,2) END) + LTRIM(C.NOITHUCHIEN_ID)) AS acss_lookupID,        ROW_NUMBER() OVER        (PARTITION BY (A.SOTIEPNHAN + (CASE WHEN Left(E.MANHOMDICHVU,2) = '03' THEN '02' ELSE Left(E.MANHOMDICHVU,2) END) + LTRIM(C.NOITHUCHIEN_ID))        ORDER BY (A.SOTIEPNHAN + (CASE WHEN Left(E.MANHOMDICHVU,2) = '03' THEN '02' ELSE Left(E.MANHOMDICHVU,2) END) + LTRIM(C.NOITHUCHIEN_ID)))        as num,        A.SOTIEPNHAN + (CASE WHEN Left(E.MANHOMDICHVU,2) = '03' THEN '02' ELSE Left(E.MANHOMDICHVU,2) END) + LTRIM(C.NOITHUCHIEN_ID) as KEYCOM15,        C.NOITHUCHIEN_ID, A.SOTIEPNHAN, A.TRAITUYEN, A.NGAYMIENDONGCHITRA, A.TIEPNHAN_ID, A.DOITUONG_ID, A.TRANGTHAI,        CASE WHEN (A.TRANGTHAI = 'NOITRU' OR A.TRANGTHAI = 'CAPCUU' or A.TRANGTHAI = 'NGOAITRU') THEN 'IN' ELSE 'OUT' END AS LOAIBENHAN,        CASE WHEN (C.TRANGTHAI = 'CHUAKETQUA') THEN 'CHUAKETQUA' ELSE 'HOANTAT' END AS TRANGTHAIDICHVU, A.SOBHYT,        B.*, F.TRANGTHAI as TRANGTHAI_BENHAN_NOITRU,        A.LOAITHANHVIEN_ID, A.SUDUNG_BHTN, A.THE_ID, A.THANHVIEN_ID, A.VIP, A.NGUON_BENHNHAN_ID, A.BAOLANH_VIENPHI,        CASE        WHEN @ManhomDSA is not null and E.MANHOMDICHVU in (@ManhomDSA) THEN E.MANHOMDICHVU        WHEN Left(E.MANHOMDICHVU,2) = '03' THEN '02' ELSE Left(E.MANHOMDICHVU,2) END AS MANHOMDICHVU        , A.UUTIEN        from TT_TIEPNHAN A        inner join TT_BENHNHAN B on B.BENHNHAN_ID = A.BENHNHAN_ID and (A.TRANGTHAI = 'DATIEPNHAN' or A.TRANGTHAI = 'NOITRU' or A.TRANGTHAI = 'CAPCUU' or A.TRANGTHAI = 'NGOAITRU') and B.ACTIVE = '1'        inner join TT_DVYEUCAU C on C.TIEPNHAN_ID = A.TIEPNHAN_ID        left join TM_DICHVU D on D.DICHVU_ID = C.DICHVU_ID        left join TM_NHOMDICHVU E on E.NHOMDICHVU_ID = D.NHOMDICHVU_ID        left join TT_NOITRU_BENHAN F on F.TIEPNHAN_ID = A.TIEPNHAN_ID        where C.NGAYHENCLS is NULL and A.TIEPNHAN_ID = '27478' and A.BENHVIEN_ID = 'HLU01'        ) a where a.num = 1]
2019-09-20 16:49:54,216 [1] DEBUG - Statement Id: [DAO00026_GetListDanhSachDichVuGhiNhanVTYT_COM25_WithTN] PreparedStatement : [select distinct CONVERT(VARCHAR(11),C.NGAYYEUCAU,103) as NGAYYEUCAU, C.DICHVU_ID, C.DVYEUCAU_ID, D.TENDICHVU, C.NOITHUCHIEN_ID, A.SOTIEPNHAN, A.TRAITUYEN, A.NGAYMIENDONGCHITRA, A.TIEPNHAN_ID, A.DOITUONG_ID, A.TRANGTHAI,            A.LOAITHANHVIEN_ID, A.SUDUNG_BHTN, A.THE_ID, A.THANHVIEN_ID, A.VIP, A.NGUON_BENHNHAN_ID, A.BAOLANH_VIENPHI,            CASE WHEN (A.TRANGTHAI = 'NOITRU' OR A.TRANGTHAI = 'CAPCUU') THEN 'IN' ELSE 'OUT' END AS LOAIBENHAN,            CASE WHEN (C.TRANGTHAI = 'CHUAKETQUA') THEN 'CHUAKETQUA' ELSE 'HOANTAT' END AS TRANGTHAIDICHVU,            B.*, isnull(ntba.SOBENHAN, '') SOBENHAN, isnull(ntba.BENHAN_ID, 0) BENHAN_ID,            CASE WHEN Left(E.MANHOMDICHVU,2) = '03' THEN '02' ELSE Left(E.MANHOMDICHVU,2) END AS MANHOMDICHVU            from TT_TIEPNHAN A            inner join TT_BENHNHAN B on B.BENHNHAN_ID = A.BENHNHAN_ID and B.ACTIVE = '1'            inner join TT_DVYEUCAU C on C.TIEPNHAN_ID = A.TIEPNHAN_ID                        left join TM_DICHVU D on D.DICHVU_ID = C.DICHVU_ID            left join TM_NHOMDICHVU E on E.NHOMDICHVU_ID = D.NHOMDICHVU_ID            left join TT_NOITRU_BENHAN ntba on ntba.BENHAN_ID = C.BENHAN_ID              where            C.NGAYHENCLS is NULL and A.BENHVIEN_ID = 'HLU01'            and (A.TRANGTHAI = 'DATIEPNHAN' or A.TRANGTHAI = 'NOITRU' or A.TRANGTHAI = 'CAPCUU' or A.TRANGTHAI = 'NGOAITRU')            and (CASE WHEN Left(E.MANHOMDICHVU,2) = '03' THEN '02' ELSE Left(E.MANHOMDICHVU,2) END in ('02', '04'))            and A.TIEPNHAN_ID = '27478']
2019-09-20 16:49:54,904 [1] DEBUG - Statement Id: [DAO00020_UpdateTienSuBenhNhan] PreparedStatement : [update TT_BENHNHAN set        TIENSUDIUNG =  @param0         , TIENSUBENH =  @param1         , NGUOICAPNHAT_ID =  @param2         , NGAYCAPNHAT =  @param3         where        BENHNHAN_ID =  @param4]
2019-09-20 16:49:54,904 [1] DEBUG - Statement Id: [DAO00020_UpdateTienSuBenhNhan] Parameters: [@param0=[TIENSUDIUNG,], @param1=[TIENSUBENH,], @param2=[NGUOICAPNHAT_ID,1], @param3=[NGAYCAPNHAT,9/20/2019 4:49:54 PM], @param4=[BENHNHAN_ID,23423]]
2019-09-20 16:49:54,904 [1] DEBUG - Statement Id: [DAO00020_UpdateTienSuBenhNhan] Types: [@param0=[String, System.String], @param1=[String, System.String], @param2=[Int32, System.Int32], @param3=[DateTime, System.DateTime], @param4=[Int64, System.Int64]]
2019-09-20 16:49:54,995 [1] DEBUG - Statement Id: [DAOLOG01_LockEnd] PreparedStatement : [DELETE TT_LOG_UPDATE        where REF_TABLE = 'TT_VIENPHI' and REF_ID = '27478' and BENHVIEN_ID = 'HLU01']
2019-09-20 16:49:55,030 [1] DEBUG - Statement Id: [DAO00067_ClearDataVienPhi] PreparedStatement : [delete from TT_VIENPHI where TIEPNHAN_ID = 27478 and REF_ID = 0                     update TT_VIENPHI set SOLUONG = 0          where REF_TABLE = 'TT_DVYEUCAU' and TIEPNHAN_ID =  @param0           and not exists (select DVYEUCAU_ID from TT_DVYEUCAU where TT_VIENPHI.REF_ID = DVYEUCAU_ID and TIEPNHAN_ID =  @param0 )                       update TT_VIENPHI set SOLUONG = 0          where REF_TABLE = 'TT_NGOAITRU_TOATHUOC'          and TIEPNHAN_ID =  @param0           and HOADON_ID is null and TIEPNHAN_ID =  @param0           and not exists (select TOATHUOC_ID from TT_NGOAITRU_TOATHUOC where TT_VIENPHI.REF_ID = TOATHUOC_ID and TIEPNHAN_ID =  @param0 )                     delete TT_DUOC_TONKHO_BOOK_NOITRU where REF_TABLE = 'TT_NOITRU_TOATHUOC' and (REF_ID is null or REF_ID = 0)        delete TT_DUOC_TONKHO_BOOK_NGOAITRU where REF_ID is null or REF_ID = 0                      update TT_VIENPHI set          THANHTIEN_DOANHTHU = 0, BHYT_THANHTIEN = 0, BHYT_THANHTIEN_CHITRA = 0          , GIATRI_BENHNHAN_DATHANHTOAN = 0, BENHNHAN_PHAITHANHTOAN = 0          where TIEPNHAN_ID = 27478 and SOLUONG = 0                       update TT_VIENPHI set          GIATRI_BENHNHAN_DATHANHTOAN = 0          where TIEPNHAN_ID = '27478' and GIATRI_BENHNHAN_DATHANHTOAN is null            update TT_VIENPHI set          BENHNHAN_PHAITHANHTOAN = 0          where TIEPNHAN_ID = '27478' and BENHNHAN_PHAITHANHTOAN is null]
2019-09-20 16:49:55,030 [1] DEBUG - Statement Id: [DAO00067_ClearDataVienPhi] Parameters: [@param0=[TIEPNHAN_ID,27478]]
2019-09-20 16:49:55,030 [1] DEBUG - Statement Id: [DAO00067_ClearDataVienPhi] Types: [@param0=[Int64, System.Int64]]
2019-09-20 16:49:55,419 [1] DEBUG - Statement Id: [DAO00020_GetDSDichVuYC] PreparedStatement : [select dvyc.*,        dv.TENDICHVU, dv.MADICHVU, dv.NORESULT, ndv.MANHOMDICHVU, ndv.TENNHOMDICHVU, vp.KHONGTHUTIEN        from TT_DVYEUCAU dvyc        left join TM_DICHVU dv on dvyc.DICHVU_ID = dv.DICHVU_ID        left join TM_NHOMDICHVU ndv on ndv.NHOMDICHVU_ID = dv.NHOMDICHVU_ID        left join (select * from TT_VIENPHI where TIEPNHAN_ID = '27478') vp on dvyc.DVYEUCAU_ID = vp.REF_ID                 where        dvyc.TIEPNHAN_ID = 27478        and REF_TABLE = 'TT_DVYEUCAU'                 order by DVYEUCAU_ID desc]
2019-09-20 16:49:55,682 [1] DEBUG - Statement Id: [DAO00020_GetDanhsachVPCuaDichvuYeucau] PreparedStatement : [select V.*, CASE WHEN A.VIENPHI_ID IS NULL AND B.VIENPHI_ID IS NULL THEN '0' ELSE '1' END AS EXIST_HOADON_HUY,        dv.TENDICHVU, dv.MADICHVU, dv.NORESULT, ndv.MANHOMDICHVU, ndv.TENNHOMDICHVU        from TT_VIENPHI AS V        left join TM_DICHVU dv on V.DICHVU_ID = dv.DICHVU_ID and V.REF_TABLE = 'TT_DVYEUCAU'        left join TM_NHOMDICHVU ndv on ndv.NHOMDICHVU_ID = dv.NHOMDICHVU_ID        left join (select DISTINCT HD.VIENPHI_ID from TT_HOADON_CHITIET_NGOAITRU AS HD        inner join TT_HOADON AS H ON H.HOADON_ID = HD.HOADON_ID AND H.HUYHOADON = '1'        where H.TIEPNHAN_ID = '27478'        ) AS A ON A.VIENPHI_ID = V.VIENPHI_ID        left join (select DISTINCT HD.VIENPHI_ID from TT_HOADON_CHITIET_NOITRU AS HD        inner join TT_HOADON AS H ON H.HOADON_ID = HD.HOADON_ID AND H.HUYHOADON = '1'        where H.TIEPNHAN_ID = 27478                 ) AS B ON B.VIENPHI_ID = V.VIENPHI_ID                 where        V.TIEPNHAN_ID = 27478 and V.REF_TABLE = 'TT_DVYEUCAU']
2019-09-20 16:49:55,841 [1] DEBUG - Statement Id: [DAO00099_TT_CSKH_GOI_DANGKY_Service_GetList_01] PreparedStatement : [select GDV.*, GOI.TENGOI, GOI.LOAIGOI_ID from TT_CSKH_GOI_DANGKY GDV        left join TM_CSKH_GOI GOI on GOI.GOI_ID = GDV.GOI_ID        where LOAIGOI_ID in (select DICTIONARY_ID from LST_DICTIONARY where DICTIONARY_CODE = 'NgoaiTru'                              and DICTIONARY_TYPE_CODE = 'LoaiGoiDV')                 and             GDV.BENHNHAN_ID = '23423'           and             GDV.TRANGTHAI in ('DAKICHHOAT','FOLLOWUP')           and             GDV.BENHVIEN_ID = 'HLU01']
2019-09-20 16:49:56,236 [1] DEBUG - Statement Id: [DAO00085_GetDSDichVuThe] PreparedStatement : [select *        from TT_CSKH_THETHANHVIEN_SUDUNG        where THE_ID = '0'        and BENHVIEN_ID = 'HLU01']
2019-09-20 16:50:02,473 [1] DEBUG - Statement Id: [DAO00014_GetTotalChiPhiDVByTiepNhan] PreparedStatement : [select sum(THANHTIEN_DOANHTHU) as THANHTIEN_DOANHTHU from TT_VIENPHI        where ACTIVE = '1'        and TIEPNHAN_ID = '27478'        and REF_TABLE = 'TT_DVYEUCAU'        and exists (select DVYEUCAU_ID from TT_DVYEUCAU where HUYYEUCAU = '0' and TIEPNHAN_ID = '27478' and TT_VIENPHI.REF_ID = DVYEUCAU_ID)]
2019-09-20 16:50:06,834 [1] DEBUG - Statement Id: [DAO00020_ListKhoDuocOfPhongBan] PreparedStatement : [select B.* from TM_PHONGBAN_KHODUOC A        inner join TM_KHODUOC B on B.KHODUOC_ID = A.KHODUOC_ID        where        A.PHONGBAN_ID = ''        and A.BENHVIEN_ID = 'HLU01']
2019-09-20 16:50:07,341 [1] DEBUG - Statement Id: [DAO00020_ListKhoDuocOfPhongBan] PreparedStatement : [select B.* from TM_PHONGBAN_KHODUOC A        inner join TM_KHODUOC B on B.KHODUOC_ID = A.KHODUOC_ID        where        A.PHONGBAN_ID = '58'        and A.BENHVIEN_ID = 'HLU01']
2019-09-20 16:50:11,963 [1] DEBUG - Statement Id: [DAO00020_ListKhoDuocOfPhongBan] PreparedStatement : [select B.* from TM_PHONGBAN_KHODUOC A        inner join TM_KHODUOC B on B.KHODUOC_ID = A.KHODUOC_ID        where        A.PHONGBAN_ID = '62'        and A.BENHVIEN_ID = 'HLU01']
2019-09-20 16:50:13,149 [1] DEBUG - Statement Id: [DAO00008_UpdateUserIdPhongBanKhoDuoc] PreparedStatement : [IF EXISTS            (SELECT ACCOUNT_ID FROM TM_SYS_USERS WHERE ACCOUNT_ID =  @param0  and HOSPITAL_ID =  @param1 )            BEGIN            update TM_SYS_USERS set INVENTORY_ID =  @param2 , WORKING_DEPT_ID =  @param3             WHERE ACCOUNT_ID =  @param0  and HOSPITAL_ID =  @param1             END            ELSE            BEGIN            insert into TM_SYS_USERS ([ACCOUNT_ID], [ACCOUNT_NAME], [INVENTORY_ID], [WORKING_DEPT_ID], [HOSPITAL_ID])            values ( @param0 ,  @param4 ,  @param2 ,  @param3 ,  @param1 )            END]
2019-09-20 16:50:13,149 [1] DEBUG - Statement Id: [DAO00008_UpdateUserIdPhongBanKhoDuoc] Parameters: [@param0=[ACCOUNT_ID,113], @param1=[HOSPITAL_ID,HLU01], @param2=[INVENTORY_ID,32], @param3=[WORKING_DEPT_ID,62], @param4=[ACCOUNT_NAME,admin]]
2019-09-20 16:50:13,149 [1] DEBUG - Statement Id: [DAO00008_UpdateUserIdPhongBanKhoDuoc] Types: [@param0=[String, System.String], @param1=[String, System.String], @param2=[String, System.String], @param3=[String, System.String], @param4=[String, System.String]]
2019-09-20 16:50:15,956 [1] DEBUG - Statement Id: [DAO00019_GetDanhsachKhambenh] PreparedStatement : [select *        from        (SELECT COUNT(*) OVER() as TOTALROWS, ROW_NUMBER() OVER(order by isnull(dv.SOTHUTU,'999999999'), dv.NGAYGIOYEUCAU) as ROWNUMBER,        bn.MAYTE, bn.TENBENHNHAN, bn.NAMSINH, bn.NGAYSINH as TUOI, ISNULL(CONVERT(VARCHAR(10), bn.NGAYSINH, 103),CAST(bn.NAMSINH AS varchar)) as NGAYSINH, bn.DIACHILIENLAC as DIACHI, bn.GIOITINH, GD.DESCRIPTION as TENGIOITINH,        tn.DOITUONG_ID, tn.THOIGIANTIEPNHAN, tn.BENHNHAN_ID, tn.TIEPNHAN_ID, tn.TRAITUYEN, tn.SOTIEPNHAN,        dv.DICHVU_ID, dv.NOITHUCHIEN_ID, isnull(dv.NGAYTAO, dv.NGAYCAPNHAT) as THOIGIANDKDICHVU,        dv.KHAN, dv.NOIYEUCAU_ID, dv.NGAYGIOYEUCAU, dv.BACSICHIDINH_ID, dv.DONVIGIOITHIEU_ID, dv.NGUOIGIOITHIEU_ID,        tn.NOIGIOITHIEU_ID, kbnt.HUONGGIAIQUYET_ID,        dv.DVYEUCAU_ID, dv.MARIS, dv.TRANGTHAI as TRANGTHAICODE, B.TENNHOMDICHVU, dv.SOPHIEUYEUCAU, dv.KHAMBENH_NGOAITRU_ID, dv.NGUOICAPNHAT_ID, dv.NGAYCAPNHAT,        CASE WHEN Left(B.MANHOMDICHVU,2) = '03' THEN '02' ELSE Left(B.MANHOMDICHVU,2) END AS MANHOMDICHVU, B.MANHOMDICHVU as MANHOMDICHVUCHITIET, tn.TRANGTHAI as TRANGTHAI_TIEPNHAN,        'False' as DAKHAM, isnull(dv.SOTHUTU,'999999999') as SOHANGDOI,        vp.DATHANHTOAN, dv.TRANGTHAI_WFL,        BA.SOBENHAN, dv.CHANDOAN, dt.TENDOITUONG, isnull(kbnt.THOIGIANKHAM, dv.NGAYCAPNHAT) as THOIGIANKHAM,        tn.SOBHYT        FROM TT_DVYEUCAU (NOLOCK) dv        inner join TT_TIEPNHAN (NOLOCK) tn on dv.TIEPNHAN_ID = tn.TIEPNHAN_ID        inner join TT_BENHNHAN (NOLOCK) bn on tn.BENHNHAN_ID = bn.BENHNHAN_ID        inner join TM_DICHVU A on A.DICHVU_ID = dv.DICHVU_ID        inner join TM_NHOMDICHVU B on B.NHOMDICHVU_ID = A.NHOMDICHVU_ID        inner join TT_VIENPHI(NOLOCK) VP on VP.TIEPNHAN_ID = tn.TIEPNHAN_ID and VP.DICHVU_ID = dv.DICHVU_ID and VP.REF_ID = dv.DVYEUCAU_ID        left join TT_NOITRU_BENHAN (NOLOCK) BA on BA.TIEPNHAN_ID = tn.TIEPNHAN_ID AND dv.BENHAN_ID = BA.BENHAN_ID        inner join TM_GENDER GD on GD.ID = bn.GIOITINH        left join TT_NGOAITRU_KHAMBENH (NOLOCK) kbnt on kbnt.KHAMBENH_ID = dv.KHAMBENH_NGOAITRU_ID        inner join TM_DOITUONG dt on dt.DOITUONG_ID = tn.DOITUONG_ID        where        dv.DICHVU_ID IS NOT NULL        and tn.BENHVIEN_ID = 'HLU01'        and HUYYEUCAU = 0        and dv.NGAYHENCLS is NULL         and           dv.NGAYYEUCAU >= '9/20/2019 12:00:00 AM'         and           dv.NGAYYEUCAU <= '9/20/2019 12:00:00 AM'         and           dv.NOITHUCHIEN_ID = 62          AND             (                         ((dv.TRANGTHAI_WFL = 'CHUAKETQUA' or (dv.TRANGTHAI = 'CHUAKETQUA' and dv.TRANGTHAI_WFL = 'HOANTHANH')) and (isnull(kbnt.HUONGGIAIQUYET_ID, 0) = 0)))            and (tn.TRANGTHAI != 'HOANTHANH')           and           (CASE WHEN Left(B.MANHOMDICHVU,2) = '03' THEN '02' ELSE Left(B.MANHOMDICHVU,2) END) = '04'                 ) lst                    where          lst.ROWNUMBER between 1 and 20                 order by SOHANGDOI, NGAYGIOYEUCAU asc]
2019-09-20 16:50:16,893 [1] DEBUG - Statement Id: [DAO00019_GetDanhsachKhambenh] PreparedStatement : [select *        from        (SELECT COUNT(*) OVER() as TOTALROWS, ROW_NUMBER() OVER(order by isnull(dv.SOTHUTU,'999999999'), dv.NGAYGIOYEUCAU) as ROWNUMBER,        bn.MAYTE, bn.TENBENHNHAN, bn.NAMSINH, bn.NGAYSINH as TUOI, ISNULL(CONVERT(VARCHAR(10), bn.NGAYSINH, 103),CAST(bn.NAMSINH AS varchar)) as NGAYSINH, bn.DIACHILIENLAC as DIACHI, bn.GIOITINH, GD.DESCRIPTION as TENGIOITINH,        tn.DOITUONG_ID, tn.THOIGIANTIEPNHAN, tn.BENHNHAN_ID, tn.TIEPNHAN_ID, tn.TRAITUYEN, tn.SOTIEPNHAN,        dv.DICHVU_ID, dv.NOITHUCHIEN_ID, isnull(dv.NGAYTAO, dv.NGAYCAPNHAT) as THOIGIANDKDICHVU,        dv.KHAN, dv.NOIYEUCAU_ID, dv.NGAYGIOYEUCAU, dv.BACSICHIDINH_ID, dv.DONVIGIOITHIEU_ID, dv.NGUOIGIOITHIEU_ID,        tn.NOIGIOITHIEU_ID, kbnt.HUONGGIAIQUYET_ID,        dv.DVYEUCAU_ID, dv.MARIS, dv.TRANGTHAI as TRANGTHAICODE, B.TENNHOMDICHVU, dv.SOPHIEUYEUCAU, dv.KHAMBENH_NGOAITRU_ID, dv.NGUOICAPNHAT_ID, dv.NGAYCAPNHAT,        CASE WHEN Left(B.MANHOMDICHVU,2) = '03' THEN '02' ELSE Left(B.MANHOMDICHVU,2) END AS MANHOMDICHVU, B.MANHOMDICHVU as MANHOMDICHVUCHITIET, tn.TRANGTHAI as TRANGTHAI_TIEPNHAN,        'False' as DAKHAM, isnull(dv.SOTHUTU,'999999999') as SOHANGDOI,        vp.DATHANHTOAN, dv.TRANGTHAI_WFL,        BA.SOBENHAN, dv.CHANDOAN, dt.TENDOITUONG, isnull(kbnt.THOIGIANKHAM, dv.NGAYCAPNHAT) as THOIGIANKHAM,        tn.SOBHYT        FROM TT_DVYEUCAU (NOLOCK) dv        inner join TT_TIEPNHAN (NOLOCK) tn on dv.TIEPNHAN_ID = tn.TIEPNHAN_ID        inner join TT_BENHNHAN (NOLOCK) bn on tn.BENHNHAN_ID = bn.BENHNHAN_ID        inner join TM_DICHVU A on A.DICHVU_ID = dv.DICHVU_ID        inner join TM_NHOMDICHVU B on B.NHOMDICHVU_ID = A.NHOMDICHVU_ID        inner join TT_VIENPHI(NOLOCK) VP on VP.TIEPNHAN_ID = tn.TIEPNHAN_ID and VP.DICHVU_ID = dv.DICHVU_ID and VP.REF_ID = dv.DVYEUCAU_ID        left join TT_NOITRU_BENHAN (NOLOCK) BA on BA.TIEPNHAN_ID = tn.TIEPNHAN_ID AND dv.BENHAN_ID = BA.BENHAN_ID        inner join TM_GENDER GD on GD.ID = bn.GIOITINH        left join TT_NGOAITRU_KHAMBENH (NOLOCK) kbnt on kbnt.KHAMBENH_ID = dv.KHAMBENH_NGOAITRU_ID        inner join TM_DOITUONG dt on dt.DOITUONG_ID = tn.DOITUONG_ID        where        dv.DICHVU_ID IS NOT NULL        and tn.BENHVIEN_ID = 'HLU01'        and HUYYEUCAU = 0        and dv.NGAYHENCLS is NULL         and           dv.NGAYYEUCAU >= '9/20/2019 12:00:00 AM'         and           dv.NGAYYEUCAU <= '9/20/2019 12:00:00 AM'         and           dv.NOITHUCHIEN_ID = 62          AND             (                         ((dv.TRANGTHAI_WFL = 'CHUAKETQUA' or (dv.TRANGTHAI = 'CHUAKETQUA' and dv.TRANGTHAI_WFL = 'HOANTHANH')) and (isnull(kbnt.HUONGGIAIQUYET_ID, 0) = 0)))            and (tn.TRANGTHAI != 'HOANTHANH')           and           (CASE WHEN Left(B.MANHOMDICHVU,2) = '03' THEN '02' ELSE Left(B.MANHOMDICHVU,2) END) = '04'                 ) lst                    where          lst.ROWNUMBER between 1 and 20                 order by SOHANGDOI, NGAYGIOYEUCAU asc]
2019-09-20 16:50:19,648 [1] DEBUG - Statement Id: [DAO00017_GetLoaiGiaByDoiTuongId] PreparedStatement : [select dtlg.DOUUTIEN, dtlg.DOITUONG_ID, lg.LOAIGIA_ID, lg.TENLOAIGIA, lg.MALOAIGIA              from TM_LOAIGIA lg              left join TM_DOITUONG_LOAIGIA dtlg              on lg.LOAIGIA_ID = dtlg.LOAIGIA_ID and dtlg.BENHVIEN_ID = 'HLU01'              where lg.TAMNGUNG = 0 and lg.BENHVIEN_ID = 'HLU01'                             order by dtlg.DOUUTIEN]
2019-09-20 16:50:19,778 [1] DEBUG - Statement Id: [DAO00014_KiemTraDVYCCoBHYT] PreparedStatement : [select *        from TT_VIENPHI        where REF_ID  = '' and REF_TABLE = 'TT_DVYEUCAU' and BHYT_DONGIA > 0]
2019-09-20 16:50:19,825 [1] DEBUG - Statement Id: [DAO00040_LayListToaMau] PreparedStatement : [select A.*, dc.TENDUOCDAYDU, dc.BHYT DUOC_BHYT, ld.LOAIVATTU_ID, ld.MALOAIDUOC, dd.DICTIONARY_NAME DUONGDUNG, dc.TAMNGUNG            from TT_TOATHUOCMAU A            left join TM_DUOC dc on A.DUOC_ID = dc.DUOC_ID            left join TM_LOAIDUOC ld on dc.LOAIDUOC_ID = ld.LOAIDUOC_ID            left join (select * from LST_DICTIONARY where DICTIONARY_TYPE_CODE like 'DuongDung') dd on dd.DICTIONARY_ID = dc.DUONGDUNG_ID            where (1=1)             and               A.BACSI_ID  = 1              and A.LOAITOATHUOC in  (                        @param0                   ,                           @param1                   ,                           @param2                   ,                           @param3                   )]
2019-09-20 16:50:19,825 [1] DEBUG - Statement Id: [DAO00040_LayListToaMau] Parameters: [@param0=[LSTLOAITOATHUOC[0],BV], @param1=[LSTLOAITOATHUOC[1],MN], @param2=[LSTLOAITOATHUOC[2],MP], @param3=[LSTLOAITOATHUOC[3],TV]]
2019-09-20 16:50:19,825 [1] DEBUG - Statement Id: [DAO00040_LayListToaMau] Types: [@param0=[String, System.String], @param1=[String, System.String], @param2=[String, System.String], @param3=[String, System.String]]
2019-09-20 16:50:19,919 [1] DEBUG - Statement Id: [DAO00040_LayListToaMau] PreparedStatement : [select A.*, dc.TENDUOCDAYDU, dc.BHYT DUOC_BHYT, ld.LOAIVATTU_ID, ld.MALOAIDUOC, dd.DICTIONARY_NAME DUONGDUNG, dc.TAMNGUNG            from TT_TOATHUOCMAU A            left join TM_DUOC dc on A.DUOC_ID = dc.DUOC_ID            left join TM_LOAIDUOC ld on dc.LOAIDUOC_ID = ld.LOAIDUOC_ID            left join (select * from LST_DICTIONARY where DICTIONARY_TYPE_CODE like 'DuongDung') dd on dd.DICTIONARY_ID = dc.DUONGDUNG_ID            where (1=1)             and               A.BACSI_ID  = 1              and A.LOAITOATHUOC in  (                        @param0                   ,                           @param1                   ,                           @param2                   ,                           @param3                   )]
2019-09-20 16:50:19,919 [1] DEBUG - Statement Id: [DAO00040_LayListToaMau] Parameters: [@param0=[LSTLOAITOATHUOC[0],BV], @param1=[LSTLOAITOATHUOC[1],MN], @param2=[LSTLOAITOATHUOC[2],MP], @param3=[LSTLOAITOATHUOC[3],TV]]
2019-09-20 16:50:19,919 [1] DEBUG - Statement Id: [DAO00040_LayListToaMau] Types: [@param0=[String, System.String], @param1=[String, System.String], @param2=[String, System.String], @param3=[String, System.String]]
2019-09-20 16:50:19,962 [1] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoVaBookingCOM23UpdateRedis_TheoPhamvi] PreparedStatement : [declare @TOAMUANGOAI int = 0;        select @TOAMUANGOAI = isnull(VALUE,0) from TM_SYS_APPSETTINGS where CODE = 'OPD_TOAMUANGOAI_DUNGDANHMUC_DUOC'                if @TOAMUANGOAI = 1        begin        select  distinct '0' + '_' + LTRIM(d.DUOC_ID) + '_' + '0' as DUOC_KEY, 999999999 as SOLUONG        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        where  @param0  = 0        union all        select distinct tk.DUOC_KEY, tk.SOLUONG        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        inner join        (        select  LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')) DUOC_KEY, (SUM(dtk.SOLUONG) - isnull(sum(A.SOLUONG),0) - isnull(sum(B.SOLUONG),0)) SOLUONG, pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        from (select sum(soluong) soluong,duoc_id,nguonduoc_id,khoduoc_id,benhvien_id from TT_DUOC_TONKHO  group by duoc_id,nguonduoc_id,khoduoc_id,benhvien_id) dtk        inner join TM_DUOC_PHAMVISD_MAPPING pvsd on dtk.KHODUOC_ID = pvsd.KHODUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NOITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) B on B.DUOC_ID = dtk.DUOC_ID and B.PHAMVI_ID = pvsd.PHAMVI_ID and B.NGUONHANG_ID = dtk.NGUONDUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NGOAITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) A on A.DUOC_ID = dtk.DUOC_ID and A.PHAMVI_ID = pvsd.PHAMVI_ID and A.NGUONHANG_ID = dtk.NGUONDUOC_ID        where dtk.BENHVIEN_ID = 'HLU01'        group by LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')), pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        ) tk on tk.DUOC_ID = d.DUOC_ID        left join TM_DUOC_PHAMVISUDUNG kd on kd.PHAMVI_ID = tk.PHAMVI_ID and kd.BENHVIEN_ID = 'HLU01'        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = tk.NGUONDUOC_ID and nh.BENHVIEN_ID = 'HLU01'        where d.BENHVIEN_ID = 'HLU01' and tk.PHAMVI_ID =  @param0         end        else        begin        select distinct tk.DUOC_KEY, tk.SOLUONG        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        inner join        (        select  LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')) DUOC_KEY, (SUM(dtk.SOLUONG) - isnull(sum(A.SOLUONG),0) - isnull(sum(B.SOLUONG),0)) SOLUONG, pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        from (select sum(soluong) soluong,duoc_id,nguonduoc_id,khoduoc_id,benhvien_id from TT_DUOC_TONKHO  group by duoc_id,nguonduoc_id,khoduoc_id,benhvien_id) dtk        inner join TM_DUOC_PHAMVISD_MAPPING pvsd on dtk.KHODUOC_ID = pvsd.KHODUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NOITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) B on B.DUOC_ID = dtk.DUOC_ID and B.PHAMVI_ID = pvsd.PHAMVI_ID and B.NGUONHANG_ID = dtk.NGUONDUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NGOAITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) A on A.DUOC_ID = dtk.DUOC_ID and A.PHAMVI_ID = pvsd.PHAMVI_ID and A.NGUONHANG_ID = dtk.NGUONDUOC_ID        where dtk.BENHVIEN_ID = 'HLU01'        group by LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')), pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        ) tk on tk.DUOC_ID = d.DUOC_ID        left join TM_DUOC_PHAMVISUDUNG kd on kd.PHAMVI_ID = tk.PHAMVI_ID and kd.BENHVIEN_ID = 'HLU01'        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = tk.NGUONDUOC_ID and nh.BENHVIEN_ID = 'HLU01'        where d.BENHVIEN_ID = 'HLU01' and tk.PHAMVI_ID =  @param0         end]
2019-09-20 16:50:19,962 [1] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoVaBookingCOM23UpdateRedis_TheoPhamvi] Parameters: [@param0=[PHAMVI_ID,1033]]
2019-09-20 16:50:19,962 [1] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoVaBookingCOM23UpdateRedis_TheoPhamvi] Types: [@param0=[Int64, System.Int64]]
2019-09-20 16:50:20,417 [1] DEBUG - Statement Id: [DAO00019_ThongTinBenhNhanDvYeuCau] PreparedStatement : [select distinct A.SOTIEPNHAN, A.TIEPNHAN_ID, A.DOITUONG_ID, A.TRANGTHAI,        A.LOAITHANHVIEN_ID, A.SUDUNG_BHTN, A.THE_ID, A.THANHVIEN_ID, A.VIP, A.NGUON_BENHNHAN_ID, A.BAOLANH_VIENPHI, A.NGAYMIENDONGCHITRA,        B.*,  C.DICHVU_ID, C.DVYEUCAU_ID, C.NOITHUCHIEN_ID, A.SOBHYT        from TT_TIEPNHAN A        inner join TT_DVYEUCAU C on C.TIEPNHAN_ID = A.TIEPNHAN_ID        inner join TT_BENHNHAN B on B.BENHNHAN_ID = A.BENHNHAN_ID and B.ACTIVE = '1'        where                    C.DVYEUCAU_ID = '205443'                 and A.BENHVIEN_ID = 'HLU01']
2019-09-20 16:50:20,647 [1] DEBUG - Statement Id: [DAO00017_GetLoaiGiaByDoiTuongId] PreparedStatement : [select dtlg.DOUUTIEN, dtlg.DOITUONG_ID, lg.LOAIGIA_ID, lg.TENLOAIGIA, lg.MALOAIGIA              from TM_LOAIGIA lg              left join TM_DOITUONG_LOAIGIA dtlg              on lg.LOAIGIA_ID = dtlg.LOAIGIA_ID and dtlg.BENHVIEN_ID = 'HLU01'              where lg.TAMNGUNG = 0 and lg.BENHVIEN_ID = 'HLU01'                             order by dtlg.DOUUTIEN]
2019-09-20 16:50:20,695 [1] DEBUG - Statement Id: [DAO00014_KiemTraDVYCCoBHYT] PreparedStatement : [select *        from TT_VIENPHI        where REF_ID  = '205443' and REF_TABLE = 'TT_DVYEUCAU' and BHYT_DONGIA > 0]
2019-09-20 16:50:20,755 [1] DEBUG - Statement Id: [DAO00040_LayListToaMau] PreparedStatement : [select A.*, dc.TENDUOCDAYDU, dc.BHYT DUOC_BHYT, ld.LOAIVATTU_ID, ld.MALOAIDUOC, dd.DICTIONARY_NAME DUONGDUNG, dc.TAMNGUNG            from TT_TOATHUOCMAU A            left join TM_DUOC dc on A.DUOC_ID = dc.DUOC_ID            left join TM_LOAIDUOC ld on dc.LOAIDUOC_ID = ld.LOAIDUOC_ID            left join (select * from LST_DICTIONARY where DICTIONARY_TYPE_CODE like 'DuongDung') dd on dd.DICTIONARY_ID = dc.DUONGDUNG_ID            where (1=1)             and               A.BACSI_ID  = 1              and A.LOAITOATHUOC in  (                        @param0                   ,                           @param1                   ,                           @param2                   ,                           @param3                   )]
2019-09-20 16:50:20,755 [1] DEBUG - Statement Id: [DAO00040_LayListToaMau] Parameters: [@param0=[LSTLOAITOATHUOC[0],BV], @param1=[LSTLOAITOATHUOC[1],MN], @param2=[LSTLOAITOATHUOC[2],MP], @param3=[LSTLOAITOATHUOC[3],TV]]
2019-09-20 16:50:20,755 [1] DEBUG - Statement Id: [DAO00040_LayListToaMau] Types: [@param0=[String, System.String], @param1=[String, System.String], @param2=[String, System.String], @param3=[String, System.String]]
2019-09-20 16:50:20,854 [1] DEBUG - Statement Id: [DAO00040_LayListToaMau] PreparedStatement : [select A.*, dc.TENDUOCDAYDU, dc.BHYT DUOC_BHYT, ld.LOAIVATTU_ID, ld.MALOAIDUOC, dd.DICTIONARY_NAME DUONGDUNG, dc.TAMNGUNG            from TT_TOATHUOCMAU A            left join TM_DUOC dc on A.DUOC_ID = dc.DUOC_ID            left join TM_LOAIDUOC ld on dc.LOAIDUOC_ID = ld.LOAIDUOC_ID            left join (select * from LST_DICTIONARY where DICTIONARY_TYPE_CODE like 'DuongDung') dd on dd.DICTIONARY_ID = dc.DUONGDUNG_ID            where (1=1)             and               A.BACSI_ID  = 1              and A.LOAITOATHUOC in  (                        @param0                   ,                           @param1                   ,                           @param2                   ,                           @param3                   )]
2019-09-20 16:50:20,854 [1] DEBUG - Statement Id: [DAO00040_LayListToaMau] Parameters: [@param0=[LSTLOAITOATHUOC[0],BV], @param1=[LSTLOAITOATHUOC[1],MN], @param2=[LSTLOAITOATHUOC[2],MP], @param3=[LSTLOAITOATHUOC[3],TV]]
2019-09-20 16:50:20,855 [1] DEBUG - Statement Id: [DAO00040_LayListToaMau] Types: [@param0=[String, System.String], @param1=[String, System.String], @param2=[String, System.String], @param3=[String, System.String]]
2019-09-20 16:50:20,962 [1] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoVaBookingCOM23UpdateRedis_TheoPhamvi] PreparedStatement : [declare @TOAMUANGOAI int = 0;        select @TOAMUANGOAI = isnull(VALUE,0) from TM_SYS_APPSETTINGS where CODE = 'OPD_TOAMUANGOAI_DUNGDANHMUC_DUOC'                if @TOAMUANGOAI = 1        begin        select  distinct '0' + '_' + LTRIM(d.DUOC_ID) + '_' + '0' as DUOC_KEY, 999999999 as SOLUONG        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        where  @param0  = 0        union all        select distinct tk.DUOC_KEY, tk.SOLUONG        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        inner join        (        select  LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')) DUOC_KEY, (SUM(dtk.SOLUONG) - isnull(sum(A.SOLUONG),0) - isnull(sum(B.SOLUONG),0)) SOLUONG, pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        from (select sum(soluong) soluong,duoc_id,nguonduoc_id,khoduoc_id,benhvien_id from TT_DUOC_TONKHO  group by duoc_id,nguonduoc_id,khoduoc_id,benhvien_id) dtk        inner join TM_DUOC_PHAMVISD_MAPPING pvsd on dtk.KHODUOC_ID = pvsd.KHODUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NOITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) B on B.DUOC_ID = dtk.DUOC_ID and B.PHAMVI_ID = pvsd.PHAMVI_ID and B.NGUONHANG_ID = dtk.NGUONDUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NGOAITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) A on A.DUOC_ID = dtk.DUOC_ID and A.PHAMVI_ID = pvsd.PHAMVI_ID and A.NGUONHANG_ID = dtk.NGUONDUOC_ID        where dtk.BENHVIEN_ID = 'HLU01'        group by LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')), pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        ) tk on tk.DUOC_ID = d.DUOC_ID        left join TM_DUOC_PHAMVISUDUNG kd on kd.PHAMVI_ID = tk.PHAMVI_ID and kd.BENHVIEN_ID = 'HLU01'        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = tk.NGUONDUOC_ID and nh.BENHVIEN_ID = 'HLU01'        where d.BENHVIEN_ID = 'HLU01' and tk.PHAMVI_ID =  @param0         end        else        begin        select distinct tk.DUOC_KEY, tk.SOLUONG        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        inner join        (        select  LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')) DUOC_KEY, (SUM(dtk.SOLUONG) - isnull(sum(A.SOLUONG),0) - isnull(sum(B.SOLUONG),0)) SOLUONG, pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        from (select sum(soluong) soluong,duoc_id,nguonduoc_id,khoduoc_id,benhvien_id from TT_DUOC_TONKHO  group by duoc_id,nguonduoc_id,khoduoc_id,benhvien_id) dtk        inner join TM_DUOC_PHAMVISD_MAPPING pvsd on dtk.KHODUOC_ID = pvsd.KHODUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NOITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) B on B.DUOC_ID = dtk.DUOC_ID and B.PHAMVI_ID = pvsd.PHAMVI_ID and B.NGUONHANG_ID = dtk.NGUONDUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NGOAITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) A on A.DUOC_ID = dtk.DUOC_ID and A.PHAMVI_ID = pvsd.PHAMVI_ID and A.NGUONHANG_ID = dtk.NGUONDUOC_ID        where dtk.BENHVIEN_ID = 'HLU01'        group by LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')), pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        ) tk on tk.DUOC_ID = d.DUOC_ID        left join TM_DUOC_PHAMVISUDUNG kd on kd.PHAMVI_ID = tk.PHAMVI_ID and kd.BENHVIEN_ID = 'HLU01'        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = tk.NGUONDUOC_ID and nh.BENHVIEN_ID = 'HLU01'        where d.BENHVIEN_ID = 'HLU01' and tk.PHAMVI_ID =  @param0         end]
2019-09-20 16:50:20,962 [1] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoVaBookingCOM23UpdateRedis_TheoPhamvi] Parameters: [@param0=[PHAMVI_ID,1028]]
2019-09-20 16:50:20,962 [1] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoVaBookingCOM23UpdateRedis_TheoPhamvi] Types: [@param0=[Int64, System.Int64]]
2019-09-20 16:50:21,231 [1] DEBUG - Statement Id: [DAO00013_GetTienSuBenh] PreparedStatement : [select TIENSUBENH, TIENSUDIUNG              from TT_BENHNHAN              where TT_BENHNHAN.BENHNHAN_ID  = '23423']
2019-09-20 16:50:21,263 [1] DEBUG - Statement Id: [DAO00095_GetTTDiUngThuoc] PreparedStatement : [select *              from TT_BENHNHAN_DIUNG_THUOC              where BENHNHAN_ID = '23423'              and BENHVIEN_ID = 'HLU01']
2019-09-20 16:50:21,293 [1] DEBUG - Statement Id: [DAO00014_GetTotalChiPhiDVByTiepNhan] PreparedStatement : [select sum(THANHTIEN_DOANHTHU) as THANHTIEN_DOANHTHU from TT_VIENPHI        where ACTIVE = '1'        and TIEPNHAN_ID = '27478'        and REF_TABLE = 'TT_DVYEUCAU'        and exists (select DVYEUCAU_ID from TT_DVYEUCAU where HUYYEUCAU = '0' and TIEPNHAN_ID = '27478' and TT_VIENPHI.REF_ID = DVYEUCAU_ID)]
2019-09-20 16:50:21,333 [1] DEBUG - Statement Id: [DAO00014_GetKhamBenhInfo] PreparedStatement : [select * from TT_NGOAITRU_KHAMBENH where KHAMBENH_ID =        (select KHAMBENH_NGOAITRU_ID from TT_DVYEUCAU where DVYEUCAU_ID = '205443')]
2019-09-20 16:50:21,376 [1] DEBUG - Statement Id: [DAO00014_GetSoCaKhamTrongNgay] PreparedStatement : [select Count(KB.KHAMBENH_ID) as SOCAKHAMTRONGNGAY        from TT_NGOAITRU_KHAMBENH KB        inner join TT_TIEPNHAN TN on TN.TIEPNHAN_ID = KB.TIEPNHAN_ID        where KB.NGAYKHAM = convert(date, GETDATE())        and KB.BACSIKHAM_ID = '1'        and KB.BENHVIEN_ID = 'HLU01'        and TN.SOBHYT IS NOT NULL and TN.SOBHYT != '']
2019-09-20 16:50:21,519 [1] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoVaBookingCOM23UpdateRedis_TheoPhamvi] PreparedStatement : [declare @TOAMUANGOAI int = 0;        select @TOAMUANGOAI = isnull(VALUE,0) from TM_SYS_APPSETTINGS where CODE = 'OPD_TOAMUANGOAI_DUNGDANHMUC_DUOC'                if @TOAMUANGOAI = 1        begin        select  distinct '0' + '_' + LTRIM(d.DUOC_ID) + '_' + '0' as DUOC_KEY, 999999999 as SOLUONG        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        where  @param0  = 0        union all        select distinct tk.DUOC_KEY, tk.SOLUONG        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        inner join        (        select  LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')) DUOC_KEY, (SUM(dtk.SOLUONG) - isnull(sum(A.SOLUONG),0) - isnull(sum(B.SOLUONG),0)) SOLUONG, pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        from (select sum(soluong) soluong,duoc_id,nguonduoc_id,khoduoc_id,benhvien_id from TT_DUOC_TONKHO  group by duoc_id,nguonduoc_id,khoduoc_id,benhvien_id) dtk        inner join TM_DUOC_PHAMVISD_MAPPING pvsd on dtk.KHODUOC_ID = pvsd.KHODUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NOITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) B on B.DUOC_ID = dtk.DUOC_ID and B.PHAMVI_ID = pvsd.PHAMVI_ID and B.NGUONHANG_ID = dtk.NGUONDUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NGOAITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) A on A.DUOC_ID = dtk.DUOC_ID and A.PHAMVI_ID = pvsd.PHAMVI_ID and A.NGUONHANG_ID = dtk.NGUONDUOC_ID        where dtk.BENHVIEN_ID = 'HLU01'        group by LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')), pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        ) tk on tk.DUOC_ID = d.DUOC_ID        left join TM_DUOC_PHAMVISUDUNG kd on kd.PHAMVI_ID = tk.PHAMVI_ID and kd.BENHVIEN_ID = 'HLU01'        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = tk.NGUONDUOC_ID and nh.BENHVIEN_ID = 'HLU01'        where d.BENHVIEN_ID = 'HLU01' and tk.PHAMVI_ID =  @param0         end        else        begin        select distinct tk.DUOC_KEY, tk.SOLUONG        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        inner join        (        select  LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')) DUOC_KEY, (SUM(dtk.SOLUONG) - isnull(sum(A.SOLUONG),0) - isnull(sum(B.SOLUONG),0)) SOLUONG, pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        from (select sum(soluong) soluong,duoc_id,nguonduoc_id,khoduoc_id,benhvien_id from TT_DUOC_TONKHO  group by duoc_id,nguonduoc_id,khoduoc_id,benhvien_id) dtk        inner join TM_DUOC_PHAMVISD_MAPPING pvsd on dtk.KHODUOC_ID = pvsd.KHODUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NOITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) B on B.DUOC_ID = dtk.DUOC_ID and B.PHAMVI_ID = pvsd.PHAMVI_ID and B.NGUONHANG_ID = dtk.NGUONDUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NGOAITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) A on A.DUOC_ID = dtk.DUOC_ID and A.PHAMVI_ID = pvsd.PHAMVI_ID and A.NGUONHANG_ID = dtk.NGUONDUOC_ID        where dtk.BENHVIEN_ID = 'HLU01'        group by LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')), pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        ) tk on tk.DUOC_ID = d.DUOC_ID        left join TM_DUOC_PHAMVISUDUNG kd on kd.PHAMVI_ID = tk.PHAMVI_ID and kd.BENHVIEN_ID = 'HLU01'        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = tk.NGUONDUOC_ID and nh.BENHVIEN_ID = 'HLU01'        where d.BENHVIEN_ID = 'HLU01' and tk.PHAMVI_ID =  @param0         end]
2019-09-20 16:50:21,519 [1] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoVaBookingCOM23UpdateRedis_TheoPhamvi] Parameters: [@param0=[PHAMVI_ID,1028]]
2019-09-20 16:50:21,519 [1] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoVaBookingCOM23UpdateRedis_TheoPhamvi] Types: [@param0=[Int64, System.Int64]]
2019-09-20 16:50:21,864 [1] DEBUG - Statement Id: [DAO00068_GetLastedSinhHieuInfo] PreparedStatement : [select top (1) *, CHISOBMI as BMI              from TT_NGOAITRU_KHAMBENH_SINHHIEU              where BENHNHAN_ID = '23423'              order by KHAMBENH_SINHHIEU_ID desc]
2019-09-20 16:50:54,088 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'OPD45'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2019-09-20 16:50:54,937 [1] DEBUG - Statement Id: [DAO00017_GetLoaiGiaByDoiTuongId] PreparedStatement : [select dtlg.DOUUTIEN, dtlg.DOITUONG_ID, lg.LOAIGIA_ID, lg.TENLOAIGIA, lg.MALOAIGIA              from TM_LOAIGIA lg              left join TM_DOITUONG_LOAIGIA dtlg              on lg.LOAIGIA_ID = dtlg.LOAIGIA_ID and dtlg.BENHVIEN_ID = 'HLU01'              where lg.TAMNGUNG = 0 and lg.BENHVIEN_ID = 'HLU01'                             order by dtlg.DOUUTIEN]
2019-09-20 16:50:54,990 [1] DEBUG - Statement Id: [DAO00030_GetPhamViByKhoDuoc] PreparedStatement : [SELECT DISTINCT pv.PHAMVI_ID          FROM TM_DUOC_PHAMVISD_MAPPING mp          INNER JOIN TM_DUOC_PHAMVISUDUNG pv ON mp.PHAMVI_ID = pv.PHAMVI_ID          WHERE          mp.KHODUOC_ID IN (32)          AND mp.BENHVIEN_ID ='HLU01'          AND mp.TAMNGUNG = '0'          AND pv.TAMNGUNG = '0']
2019-09-20 16:50:58,065 [1] DEBUG - Statement Id: [DAO00009_TT_TIEPNHAN_GetProcess] PreparedStatement : [select PROCESS_ID from TT_TIEPNHAN where SOTIEPNHAN = 'TN190920.0000001']
2019-09-20 16:50:58,158 [1] DEBUG - Statement Id: [DAOWF004_laytrangthaiDV] PreparedStatement : [select top 1 A.CURR_STATE_CODE as STATE_CODE, isNull(C.SHORT_NAME,C.NAME) as TRANGTHAI, C.NAME as TRANGTHAI_CHITIET, C.STATUS_CODE, D.ISACTIVE as ACTIVE, E.STATUS_CODE  as OLD_STATUSCODE        from TT_REQUEST_SERVICE_DETAIL A                left join (select * from TT_REQUEST_SERVICE where PARA = '{"DICHVU_ID":"5492","DVYEUCAU_ID":"205443"}') D on D.ID = A.REQUEST_SERVICE_ID        left join TM_STATE C on A.CURR_STATE_CODE = C.STATE_CODE and C.PROCESS_CODE = D.PROCESS_CODE        left join TM_STATE E on A.OLD_STATE_CODE = E.STATE_CODE and E.PROCESS_CODE = D.PROCESS_CODE        where        A.REQUEST_SERVICE_ID = (select top 1 ID from TT_REQUEST_SERVICE where PARA = '{"DICHVU_ID":"5492","DVYEUCAU_ID":"205443"}' order by ID desc)        order by A.ID desc]
2019-09-20 16:50:58,257 [1] DEBUG - Statement Id: [DAO00000_GetDoiTuongIsBHYT] PreparedStatement : [select * from TM_DOITUONG Where DOITUONG_ID = 4 and MADOITUONG like '%BHYT%']
2019-09-20 16:50:58,349 [1] DEBUG - Statement Id: [DAO00030_GetPhamViByKhoDuoc] PreparedStatement : [SELECT DISTINCT pv.PHAMVI_ID          FROM TM_DUOC_PHAMVISD_MAPPING mp          INNER JOIN TM_DUOC_PHAMVISUDUNG pv ON mp.PHAMVI_ID = pv.PHAMVI_ID          WHERE          mp.KHODUOC_ID IN (32)          AND mp.BENHVIEN_ID ='HLU01'          AND mp.TAMNGUNG = '0'          AND pv.TAMNGUNG = '0']
2019-09-20 16:51:00,094 [1] DEBUG - Statement Id: [DAO00020_GetDSDichVuYC] PreparedStatement : [select dvyc.*,        dv.TENDICHVU, dv.MADICHVU, dv.NORESULT, ndv.MANHOMDICHVU, ndv.TENNHOMDICHVU, vp.KHONGTHUTIEN        from TT_DVYEUCAU dvyc        left join TM_DICHVU dv on dvyc.DICHVU_ID = dv.DICHVU_ID        left join TM_NHOMDICHVU ndv on ndv.NHOMDICHVU_ID = dv.NHOMDICHVU_ID        left join (select * from TT_VIENPHI where TIEPNHAN_ID = '27478') vp on dvyc.DVYEUCAU_ID = vp.REF_ID                 where        dvyc.TIEPNHAN_ID = 27478        and REF_TABLE = 'TT_DVYEUCAU'                 order by DVYEUCAU_ID desc]
2019-09-20 16:51:01,104 [1] DEBUG - Statement Id: [DAO00020_GetTTDVYeuCauByID] PreparedStatement : [select *        from TT_DVYEUCAU        where TT_DVYEUCAU.DVYEUCAU_ID  = 205443        order by DVYEUCAU_ID]
2019-09-20 16:51:01,847 [1] DEBUG - Statement Id: [DAO00083_GetCLSKetQua_ID] PreparedStatement : [select CLSKETQUA_ID        from TT_CLSKETQUA        where DVYEUCAU_ID  = '205443']
2019-09-20 16:51:01,969 [1] DEBUG - Statement Id: [DAO00083_GetCLSKQIDInCLSKQChiTiet] PreparedStatement : [select CLSKETQUA_ID        from TT_CLSKETQUACHITIET        where DVYEUCAU_ID  = '205443']
2019-09-20 16:51:02,022 [1] DEBUG - Statement Id: [DAO00083_GetList_PhieuGhiNhanVTYT] PreparedStatement : [select DICHVU_GHINHANVTYT_ID, SOPHIEU, KHAMBENH_ID, TIEPNHAN_ID, DVYEUCAU_ID        from TT_DICHVU_GHINHANVTYT        where TIEPNHAN_ID = '27478'        and BENHVIEN_ID = 'HLU01'         and           DVYEUCAU_ID = '205443'                 order by THOIGIANGHINHAN desc]
2019-09-20 16:51:02,066 [1] DEBUG - Statement Id: [DAO00014_GetTrangThaiTiepNhan] PreparedStatement : [select tn.TIEPNHAN_ID, tn.KHOADULIEU, xncp.XACNHANCHIPHI_ID from TT_TIEPNHAN tn        left join TT_XACNHANCHIPHI xncp        on tn.TIEPNHAN_ID = xncp.TIEPNHAN_ID        where tn.TIEPNHAN_ID = '27478'        and tn.BENHVIEN_ID = 'HLU01']
2019-09-20 16:51:02,114 [1] DEBUG - Statement Id: [DAO00014_GetPatientStatus] PreparedStatement : [select        CASE        when tn.TRANGTHAI = 'HOANTHANH' Then tn.TRANGTHAI        WHEN xncp.XACNHANCHIPHI_ID is not null THEN 'XACNHANCHIPHI'        WHEN (tn.KHOADULIEU = '1') THEN 'KHOADULIEU'        ELSE tn.TRANGTHAI        END        as TRANGTHAI        from TT_TIEPNHAN tn        left join TT_XACNHANCHIPHI xncp on tn.TIEPNHAN_ID = xncp.TIEPNHAN_ID        where tn.TIEPNHAN_ID = '27478'        and tn.BENHVIEN_ID = 'HLU01']
2019-09-20 16:51:14,240 [1] DEBUG - Statement Id: [DAO00014_GetPatientStatus] PreparedStatement : [select        CASE        when tn.TRANGTHAI = 'HOANTHANH' Then tn.TRANGTHAI        WHEN xncp.XACNHANCHIPHI_ID is not null THEN 'XACNHANCHIPHI'        WHEN (tn.KHOADULIEU = '1') THEN 'KHOADULIEU'        ELSE tn.TRANGTHAI        END        as TRANGTHAI        from TT_TIEPNHAN tn        left join TT_XACNHANCHIPHI xncp on tn.TIEPNHAN_ID = xncp.TIEPNHAN_ID        where tn.TIEPNHAN_ID = '27478'        and tn.BENHVIEN_ID = 'HLU01']
2019-09-20 16:51:56,253 [1] DEBUG - Statement Id: [DAO00014_GetChitietDVYeucauKhamBenh] PreparedStatement : [select *        from TT_DVYEUCAU        where DVYEUCAU_ID  = '205443']
2019-09-20 16:51:56,865 [1] DEBUG - Statement Id: [DAO00014_GetPatientStatus] PreparedStatement : [select        CASE        when tn.TRANGTHAI = 'HOANTHANH' Then tn.TRANGTHAI        WHEN xncp.XACNHANCHIPHI_ID is not null THEN 'XACNHANCHIPHI'        WHEN (tn.KHOADULIEU = '1') THEN 'KHOADULIEU'        ELSE tn.TRANGTHAI        END        as TRANGTHAI        from TT_TIEPNHAN tn        left join TT_XACNHANCHIPHI xncp on tn.TIEPNHAN_ID = xncp.TIEPNHAN_ID        where tn.TIEPNHAN_ID = '27478'        and tn.BENHVIEN_ID = 'HLU01']
2019-09-20 16:51:57,213 [1] DEBUG - Statement Id: [DAO00014_GetTTDVYeucauOPD] PreparedStatement : [select A.KHAMBENH_NGOAITRU_ID, B.KHAMBENH_ID        from TT_DVYEUCAU A        left join TT_NGOAITRU_KHAMBENH B on A.KHAMBENH_NGOAITRU_ID = B.KHAMBENH_ID        where A.DVYEUCAU_ID = '205443' and A.TIEPNHAN_ID =  @param0]
2019-09-20 16:51:57,213 [1] DEBUG - Statement Id: [DAO00014_GetTTDVYeucauOPD] Parameters: [@param0=[TIEPNHAN_ID,27478]]
2019-09-20 16:51:57,213 [1] DEBUG - Statement Id: [DAO00014_GetTTDVYeucauOPD] Types: [@param0=[Int64, System.Int64]]
2019-09-20 16:51:57,308 [1] DEBUG - Statement Id: [DAO00014_GetThongtinKhamsuckhoeTheoDVyc] PreparedStatement : [select HOPDONG_ID, HOPDONG_BENHNHAN_ID from TT_DVYEUCAU where DVYEUCAU_ID =  @param0]
2019-09-20 16:51:57,308 [1] DEBUG - Statement Id: [DAO00014_GetThongtinKhamsuckhoeTheoDVyc] Parameters: [@param0=[DVYEUCAU_ID,205443]]
2019-09-20 16:51:57,308 [1] DEBUG - Statement Id: [DAO00014_GetThongtinKhamsuckhoeTheoDVyc] Types: [@param0=[Int64, System.Int64]]
2019-09-20 16:51:57,337 [1] DEBUG - Statement Id: [DAO00009_TT_TIEPNHAN_GetProcess] PreparedStatement : [select PROCESS_ID from TT_TIEPNHAN where SOTIEPNHAN = 'TN190920.0000001']
2019-09-20 16:51:57,433 [1] DEBUG - Statement Id: [DAOWF004_laytrangthaiDV] PreparedStatement : [select top 1 A.CURR_STATE_CODE as STATE_CODE, isNull(C.SHORT_NAME,C.NAME) as TRANGTHAI, C.NAME as TRANGTHAI_CHITIET, C.STATUS_CODE, D.ISACTIVE as ACTIVE, E.STATUS_CODE  as OLD_STATUSCODE        from TT_REQUEST_SERVICE_DETAIL A                left join (select * from TT_REQUEST_SERVICE where PARA = '{"DICHVU_ID":"5492","DVYEUCAU_ID":"205443"}') D on D.ID = A.REQUEST_SERVICE_ID        left join TM_STATE C on A.CURR_STATE_CODE = C.STATE_CODE and C.PROCESS_CODE = D.PROCESS_CODE        left join TM_STATE E on A.OLD_STATE_CODE = E.STATE_CODE and E.PROCESS_CODE = D.PROCESS_CODE        where        A.REQUEST_SERVICE_ID = (select top 1 ID from TT_REQUEST_SERVICE where PARA = '{"DICHVU_ID":"5492","DVYEUCAU_ID":"205443"}' order by ID desc)        order by A.ID desc]
2019-09-20 16:51:57,496 [1] DEBUG - Statement Id: [DAO00014_CheckExistNhapVien] PreparedStatement : [select NHAPVIEN_ID        from TT_NOITRU_NHAPVIEN        where TIEPNHAN_ID  = '27478'        and TRANGTHAI != 'CHOXACNHAN']
2019-09-20 16:51:57,533 [1] DEBUG - Statement Id: [DAO00014_CheckExistCapCuu] PreparedStatement : [select THONGTINCAPCUU_ID        from TT_TIEPNHAN_THONGTINCAPCUU        where TIEPNHAN_ID  = '27478' and BENHVIEN_ID = 'HLU01']
2019-09-20 16:51:57,564 [1] DEBUG - Statement Id: [DAO00014_CheckExistChuyenVien] PreparedStatement : [select CHUYENVIEN_ID        from TT_CHUYENVIEN        where TIEPNHAN_ID  = '27478']
2019-09-20 16:51:57,594 [1] DEBUG - Statement Id: [DAO00014_GetTrangThaiTiepNhan] PreparedStatement : [select tn.TIEPNHAN_ID, tn.KHOADULIEU, xncp.XACNHANCHIPHI_ID from TT_TIEPNHAN tn        left join TT_XACNHANCHIPHI xncp        on tn.TIEPNHAN_ID = xncp.TIEPNHAN_ID        where tn.TIEPNHAN_ID = '27478'        and tn.BENHVIEN_ID = 'HLU01']
2019-09-20 16:51:57,625 [1] DEBUG - Statement Id: [DAOLOG01_LockBegin] PreparedStatement : [INSERT into TT_LOG_UPDATE ( REF_TABLE , REF_ID , BENHVIEN_ID )         values ( @param0 ,  @param1 ,  @param2 );]
2019-09-20 16:51:57,626 [1] DEBUG - Statement Id: [DAOLOG01_LockBegin] Parameters: [@param0=[REF_TABLE,TT_NGOAITRU_KHAMBENH], @param1=[REF_ID,27478], @param2=[BENHVIEN_ID,HLU01]]
2019-09-20 16:51:57,626 [1] DEBUG - Statement Id: [DAOLOG01_LockBegin] Types: [@param0=[String, System.String], @param1=[Int64, System.Int64], @param2=[String, System.String]]
2019-09-20 16:51:57,656 [1] DEBUG - Statement Id: [DAO00014_GetTTNhapVien] PreparedStatement : [select *        from TT_NOITRU_NHAPVIEN        where TIEPNHAN_ID  = '27478']
2019-09-20 16:51:57,728 [1] DEBUG - Statement Id: [DAO00014_GetTTDVYeucauOPD] PreparedStatement : [select A.KHAMBENH_NGOAITRU_ID, B.KHAMBENH_ID        from TT_DVYEUCAU A        left join TT_NGOAITRU_KHAMBENH B on A.KHAMBENH_NGOAITRU_ID = B.KHAMBENH_ID        where A.DVYEUCAU_ID = '205443' and A.TIEPNHAN_ID =  @param0]
2019-09-20 16:51:57,728 [1] DEBUG - Statement Id: [DAO00014_GetTTDVYeucauOPD] Parameters: [@param0=[TIEPNHAN_ID,27478]]
2019-09-20 16:51:57,728 [1] DEBUG - Statement Id: [DAO00014_GetTTDVYeucauOPD] Types: [@param0=[String, System.String]]
2019-09-20 16:51:57,766 [1] DEBUG - Statement Id: [DAO00014_Add] PreparedStatement : [insert into TT_NGOAITRU_KHAMBENH (        BENHNHAN_ID        , TIEPNHAN_ID        , BENHAN_ID        , DICHVU_ID        , PHONGBAN_ID        , NGAYKHAM        , THOIGIANKHAM        , BACSIKHAM_ID        , DIEUDUONG_ID        , DOITUONG_ID        , CHANDOANICD_ID        , CHANDOANPHUICD_ID        , CHANDOANICD        , BENHMANTINH_ID        , HUONGGIAIQUYET_ID        , YEUCAUCHITIET_ID        , CHANDOANKHOAKHAM        , TLDG_MT        , TLDG_MP        , TKLT_MP        , TKLT_MT        , TLDG_MT_TEXT        , TLDG_MP_TEXT        , TKLT_MP_TEXT        , TKLT_MT_TEXT        , NHANAP_MT        , NHANAP_MP        , MACH        , CANNANG        , CHIEUCAO        , HUYETAPTHAP        , HUYETAPCAO        , NHIPTHO        , NHIETDO        , BMI        , TYLEMO        , VONGBUNG        , SIEUHIENVI        , SOIDAYMAT        , TRIEUCHUNGLAMSANG        , CHANDOANSOBOICD_ID        , CHANDOANSOBO        , CHUYENDENBENHVIEN_ID        , LYDONHAPVIEN_ID        , THOIGIANNHAPVIENDUKIEN        , KHAMBENHLANDAU_ID        , KHAMBENH_CHUYENKHOA_ID        , NHAPKHOA_ID        , CHUYENKHOA_ID        , NGHIOM_TUNGAY        , NGHIOM_DENNGAY        , HUONGDIEUTRI_ID        , CHEDOANUONG_ID        , CHEDOCHAMSOC_ID        , DIEUTRIDUPHONG        , SONGAYDIEUTRI        , GIAIDOANBENH        , TOATHUOCMUANGOAI        , TACDUNGPHU        , TUANTHUCUABN        , SONGAYHENTAIKHAM        , SOBENHANNGOAITRU_ID        , KHAMCAPCUU        , GHICHU        , KHOADULIEU        , NGUOIKHOA_ID        , NGAYKHOA        , THOIGIANKHOA        , BENHVIEN_ID        , NGAYTAO        , NGUOITAO_ID        , NGAYCAPNHAT        , NGUOICAPNHAT_ID        , KHAMBENH_SINHHIEU_ID        ) values (         @param0         ,  @param1         ,  @param2         ,  @param3         ,  @param4         ,  @param5         ,  @param6         ,  @param7         ,  @param8         ,  @param9         ,  @param10         ,  @param11         ,  @param12         ,  @param13         ,  @param14         ,  @param15         ,  @param16         ,  @param17         ,  @param18         ,  @param19         ,  @param20         ,  @param21         ,  @param22         ,  @param23         ,  @param24         ,  @param25         ,  @param26         ,  @param27         ,  @param28         ,  @param29         ,  @param30         ,  @param31         ,  @param32         ,  @param33         ,  @param34         ,  @param35         ,  @param36         ,  @param37         ,  @param38         ,  @param39         ,  @param40         ,  @param41         ,  @param42         ,  @param43         ,  @param44         ,  @param45         ,  @param46         ,  @param47         ,  @param48         ,  @param49         ,  @param50         ,  @param51         ,  @param52         ,  @param53         ,  @param54         ,  @param55         ,  @param56         ,  @param57         ,  @param58         ,  @param59         ,  @param60         ,  @param61         ,  @param62         ,  @param63         ,  @param64         ,  @param65         ,  @param66         ,  @param67         ,  @param68         ,  @param69         ,  @param70         ,  @param71         ,  @param72         ,  @param73         )        SELECT SCOPE_IDENTITY()]
2019-09-20 16:51:57,766 [1] DEBUG - Statement Id: [DAO00014_Add] Parameters: [@param0=[BENHNHAN_ID,23423], @param1=[TIEPNHAN_ID,27478], @param2=[BENHAN_ID,null], @param3=[DICHVU_ID,5492], @param4=[PHONGBAN_ID,62], @param5=[NGAYKHAM,9/20/2019 12:00:00 AM], @param6=[THOIGIANKHAM,9/20/2019 4:50:20 PM], @param7=[BACSIKHAM_ID,1], @param8=[DIEUDUONG_ID,null], @param9=[DOITUONG_ID,4], @param10=[CHANDOANICD_ID,3990], @param11=[CHANDOANPHUICD_ID,null], @param12=[CHANDOANICD,null], @param13=[BENHMANTINH_ID,null], @param14=[HUONGGIAIQUYET_ID,8343], @param15=[YEUCAUCHITIET_ID,null], @param16=[CHANDOANKHOAKHAM,Viêm phế quản cấp(J20)], @param17=[TLDG_MT,null], @param18=[TLDG_MP,null], @param19=[TKLT_MP,null], @param20=[TKLT_MT,null], @param21=[TLDG_MT_TEXT,], @param22=[TLDG_MP_TEXT,], @param23=[TKLT_MP_TEXT,], @param24=[TKLT_MT_TEXT,], @param25=[NHANAP_MT,null], @param26=[NHANAP_MP,null], @param27=[MACH,null], @param28=[CANNANG,null], @param29=[CHIEUCAO,null], @param30=[HUYETAPTHAP,null], @param31=[HUYETAPCAO,null], @param32=[NHIPTHO,null], @param33=[NHIETDO,null], @param34=[BMI,null], @param35=[TYLEMO,null], @param36=[VONGBUNG,null], @param37=[SIEUHIENVI,], @param38=[SOIDAYMAT,], @param39=[TRIEUCHUNGLAMSANG,test], @param40=[CHANDOANSOBOICD_ID,null], @param41=[CHANDOANSOBO,], @param42=[CHUYENDENBENHVIEN_ID,null], @param43=[LYDONHAPVIEN_ID,null], @param44=[THOIGIANNHAPVIENDUKIEN,null], @param45=[KHAMBENHLANDAU_ID,null], @param46=[KHAMBENH_CHUYENKHOA_ID,null], @param47=[NHAPKHOA_ID,null], @param48=[CHUYENKHOA_ID,null], @param49=[NGHIOM_TUNGAY,null], @param50=[NGHIOM_DENNGAY,null], @param51=[HUONGDIEUTRI_ID,null], @param52=[CHEDOANUONG_ID,null], @param53=[CHEDOCHAMSOC_ID,null], @param54=[DIEUTRIDUPHONG,null], @param55=[SONGAYDIEUTRI,null], @param56=[GIAIDOANBENH,null], @param57=[TOATHUOCMUANGOAI,null], @param58=[TACDUNGPHU,null], @param59=[TUANTHUCUABN,null], @param60=[SONGAYHENTAIKHAM,null], @param61=[SOBENHANNGOAITRU_ID,null], @param62=[KHAMCAPCUU,null], @param63=[GHICHU,], @param64=[KHOADULIEU,0], @param65=[NGUOIKHOA_ID,null], @param66=[NGAYKHOA,null], @param67=[THOIGIANKHOA,null], @param68=[BENHVIEN_ID,HLU01], @param69=[NGAYTAO,9/20/2019 4:51:57 PM], @param70=[NGUOITAO_ID,1], @param71=[NGAYCAPNHAT,9/20/2019 4:51:57 PM], @param72=[NGUOICAPNHAT_ID,1], @param73=[KHAMBENH_SINHHIEU_ID,0]]
2019-09-20 16:51:57,766 [1] DEBUG - Statement Id: [DAO00014_Add] Types: [@param0=[Int64, System.Int64], @param1=[String, System.String], @param2=[System.DBNull, null], @param3=[Int64, System.Int64], @param4=[String, System.String], @param5=[DateTime, System.DateTime], @param6=[DateTime, System.DateTime], @param7=[Int64, System.Int64], @param8=[System.DBNull, null], @param9=[Int64, System.Int64], @param10=[String, System.String], @param11=[System.DBNull, null], @param12=[System.DBNull, null], @param13=[System.DBNull, null], @param14=[String, System.String], @param15=[System.DBNull, null], @param16=[String, System.String], @param17=[System.DBNull, null], @param18=[System.DBNull, null], @param19=[System.DBNull, null], @param20=[System.DBNull, null], @param21=[String, System.String], @param22=[String, System.String], @param23=[String, System.String], @param24=[String, System.String], @param25=[System.DBNull, null], @param26=[System.DBNull, null], @param27=[System.DBNull, null], @param28=[System.DBNull, null], @param29=[System.DBNull, null], @param30=[System.DBNull, null], @param31=[System.DBNull, null], @param32=[System.DBNull, null], @param33=[System.DBNull, null], @param34=[System.DBNull, null], @param35=[System.DBNull, null], @param36=[System.DBNull, null], @param37=[String, System.String], @param38=[String, System.String], @param39=[String, System.String], @param40=[System.DBNull, null], @param41=[String, System.String], @param42=[System.DBNull, null], @param43=[System.DBNull, null], @param44=[System.DBNull, null], @param45=[System.DBNull, null], @param46=[System.DBNull, null], @param47=[System.DBNull, null], @param48=[System.DBNull, null], @param49=[System.DBNull, null], @param50=[System.DBNull, null], @param51=[System.DBNull, null], @param52=[System.DBNull, null], @param53=[System.DBNull, null], @param54=[System.DBNull, null], @param55=[System.DBNull, null], @param56=[System.DBNull, null], @param57=[System.DBNull, null], @param58=[System.DBNull, null], @param59=[System.DBNull, null], @param60=[System.DBNull, null], @param61=[System.DBNull, null], @param62=[System.DBNull, null], @param63=[String, System.String], @param64=[String, System.String], @param65=[System.DBNull, null], @param66=[System.DBNull, null], @param67=[System.DBNull, null], @param68=[String, System.String], @param69=[DateTime, System.DateTime], @param70=[String, System.String], @param71=[DateTime, System.DateTime], @param72=[String, System.String], @param73=[Int64, System.Int64]]
2019-09-20 16:51:57,832 [1] DEBUG - Statement Id: [DAO00014_CheckExistHenTaiKHam] PreparedStatement : [select KHAMBENH_HENTAIKHAM        from TT_NGOAITRU_KHAMBENH_HENTK        where KHAMBENH_ID  = '26173']
2019-09-20 16:51:57,886 [1] DEBUG - Statement Id: [DAO00020_UpdateKhamBenhIDInDVYC] PreparedStatement : [update TT_DVYEUCAU        set KHAMBENH_NGOAITRU_ID =  @param0                 , TRANGTHAI =  @param1         , NGUOICAPNHAT_ID =  @param2         , NGAYCAPNHAT =  @param3         where TIEPNHAN_ID = 27478        and DVYEUCAU_ID = 205443                update TT_VIENPHI        set DATHUCHIEN =  @param4         , NGUOICAPNHAT_ID =  @param2         , NGAYCAPNHAT =  @param3         where REF_ID = 205443        and REF_TABLE = 'TT_DVYEUCAU']
2019-09-20 16:51:57,887 [1] DEBUG - Statement Id: [DAO00020_UpdateKhamBenhIDInDVYC] Parameters: [@param0=[KHAMBENH_ID,26173], @param1=[TRANGTHAI,DANGTHUCHIEN], @param2=[NGUOICAPNHAT_ID,1], @param3=[NGAYCAPNHAT,9/20/2019 4:51:57 PM], @param4=[DATHUCHIEN,1]]
2019-09-20 16:51:57,887 [1] DEBUG - Statement Id: [DAO00020_UpdateKhamBenhIDInDVYC] Types: [@param0=[Int64, System.Int64], @param1=[String, System.String], @param2=[Int64, System.Int64], @param3=[DateTime, System.DateTime], @param4=[Int32, System.Int32]]
2019-09-20 16:51:57,959 [1] DEBUG - Statement Id: [DAO00023_GetSOBHYT_HUONG_ID] PreparedStatement : [select isnull(MAX(SOBHYT_HUONG_ID),0) SOBHYT_HUONG_ID        from TT_TIEPNHAN_SOTHEBHYT        where TIEPNHAN_ID = '27478']
2019-09-20 16:51:57,987 [1] DEBUG - Statement Id: [DAO00062_GetAllPhamviKhoDuoc] PreparedStatement : [select distinct dmap.*        from TM_DUOC_PHAMVISD_MAPPING dmap        left join TM_DUOC_PHAMVISUDUNG dpv on dpv.PHAMVI_ID = dmap.PHAMVI_ID]
2019-09-20 16:51:58,019 [1] DEBUG - Statement Id: [DAO00049_KiemtraloaiDV] PreparedStatement : [select DICHVU_ID AS HA, '' AS XN, '' as TDCN, '' as TT, '' as KB from TM_DICHVU            left join TM_NHOMDICHVU ndv on ndv.NHOMDICHVU_ID = TM_DICHVU.NHOMDICHVU_ID            where DICHVU_ID = '5492' and left(ndv.MANHOMDICHVU, 2) = '02'            union            select  '' as HA, DICHVU_ID AS XN, '' as TDCN, '' as TT, '' as KB from TM_DICHVU            left join TM_NHOMDICHVU ndv on ndv.NHOMDICHVU_ID = TM_DICHVU.NHOMDICHVU_ID            where DICHVU_ID = '5492' and left(ndv.MANHOMDICHVU, 2) = '01'            union            select  '' as HA, '' AS XN, DICHVU_ID as TDCN, '' as TT, '' as KB from TM_DICHVU            left join TM_NHOMDICHVU ndv on ndv.NHOMDICHVU_ID = TM_DICHVU.NHOMDICHVU_ID            where DICHVU_ID = '5492' and left(ndv.MANHOMDICHVU, 2) = '03'            union            select  '' as HA, '' AS XN, '' as TDCN, DICHVU_ID as TT, '' as KB from TM_DICHVU            left join TM_NHOMDICHVU ndv on ndv.NHOMDICHVU_ID = TM_DICHVU.NHOMDICHVU_ID            where DICHVU_ID = '5492' and left(ndv.MANHOMDICHVU, 2) = '05'            union            select  '' as HA, '' AS XN, '' as TDCN, DICHVU_ID as TT, '' as KB from TM_DICHVU            left join TM_NHOMDICHVU ndv on ndv.NHOMDICHVU_ID = TM_DICHVU.NHOMDICHVU_ID            where DICHVU_ID = '5492' and left(ndv.MANHOMDICHVU, 2) = '06'            union            select  '' as HA, '' AS XN, '' as TDCN, '' as TT, DICHVU_ID as KB from TM_DICHVU            left join TM_NHOMDICHVU ndv on ndv.NHOMDICHVU_ID = TM_DICHVU.NHOMDICHVU_ID            where DICHVU_ID = '5492' and left(ndv.MANHOMDICHVU, 2) = '04']
2019-09-20 16:51:58,052 [1] DEBUG - Statement Id: [DAO00009_GetThutiensauDVThuthuat] PreparedStatement : [select A.THUTIENSAU, B.SOTIEPNHAN, A.DICHVU_ID, A.DVYEUCAU_ID        from TT_DVYEUCAU A        inner join TT_TIEPNHAN B on B.TIEPNHAN_ID = A.TIEPNHAN_ID        where        A.DVYEUCAU_ID = '205443']
2019-09-20 16:51:58,087 [1] DEBUG - Statement Id: [DAO00009_TT_TIEPNHAN_GetProcess] PreparedStatement : [select PROCESS_ID from TT_TIEPNHAN where SOTIEPNHAN = 'TN190920.0000001']
2019-09-20 16:51:58,152 [1] DEBUG - Statement Id: [DAOWF001_Kiemtrathongtindayeucaudacochua] PreparedStatement : [select * from TT_REQUEST        where        PARA = '{"HOSPITAL_ID":"HLU01","SOTIEPNHAN":"TN190920.0000001"}'        AND ISACTIVE = '1']
2019-09-20 16:51:58,203 [1] DEBUG - Statement Id: [DAOWF001_Kiemtrathongtindichvudayeucau] PreparedStatement : [select top 1 * from TT_REQUEST_SERVICE        where        PARA = '{"DICHVU_ID":"5492","DVYEUCAU_ID":"205443"}'                AND ISACTIVE = '1' order by ID desc]
2019-09-20 16:51:58,233 [1] DEBUG - Statement Id: [DAOWF001_KiemtrathongtinchitietDichvuYeucau] PreparedStatement : [select * from TT_REQUEST_SERVICE_DETAIL        where        REQUEST_SERVICE_ID = '147390']
2019-09-20 16:51:58,295 [1] DEBUG - Statement Id: [DAOWF001_Laythongtinwithstatecode] PreparedStatement : [select A.*, B.STATUS_CODE from        TM_STATE_ACTION A        left join TM_STATE B on B.STATE_CODE = A.NEXT_STATE_CODE and A.PROCESS_CODE = B.PROCESS_CODE        where        A.CURR_STATE_CODE = '0     '        AND A.PROCESS_CODE = 'P02'        Order By ORDER_ID ASC]
2019-09-20 16:51:58,330 [1] DEBUG - Statement Id: [DAOWF003_Update] PreparedStatement : [update TT_REQUEST_SERVICE set        CURR_STATE_CODE =  @param0                   , ISACTIVE =  @param1                     , ISCOMPLETE =  @param2                        where        ID = '147390']
2019-09-20 16:51:58,330 [1] DEBUG - Statement Id: [DAOWF003_Update] Parameters: [@param0=[CURR_STATE_CODE,3], @param1=[ISACTIVE,1], @param2=[ISCOMPLETE,0]]
2019-09-20 16:51:58,330 [1] DEBUG - Statement Id: [DAOWF003_Update] Types: [@param0=[String, System.String], @param1=[String, System.String], @param2=[String, System.String]]
2019-09-20 16:51:58,367 [1] DEBUG - Statement Id: [DAOWF005_Add] PreparedStatement : [insert into TT_REQUEST_SERVICE_DETAIL (        REQUEST_ID        ,REQUEST_SERVICE_ID        , OLD_STATE_CODE        , CURR_STATE_CODE        ) values (         @param0         , @param1         ,  @param2         ,  @param3         )        SELECT SCOPE_IDENTITY()]
2019-09-20 16:51:58,367 [1] DEBUG - Statement Id: [DAOWF005_Add] Parameters: [@param0=[REQUEST_ID,31779], @param1=[REQUEST_SERVICE_ID,147390], @param2=[OLD_STATE_CODE,0     ], @param3=[CURR_STATE_CODE,3]]
2019-09-20 16:51:58,367 [1] DEBUG - Statement Id: [DAOWF005_Add] Types: [@param0=[String, System.String], @param1=[Int32, System.Int32], @param2=[String, System.String], @param3=[String, System.String]]
2019-09-20 16:51:58,397 [1] DEBUG - Statement Id: [DAOWF005_Add_History] PreparedStatement : [insert into TT_REQUEST_SERVICE_HISTORY (        REQUEST_ID        ,REQUEST_SERVICE_ID        , OLD_STATE_CODE        , CURR_STATE_CODE        ) values (         @param0         , @param1         ,  @param2         ,  @param3         )]
2019-09-20 16:51:58,397 [1] DEBUG - Statement Id: [DAOWF005_Add_History] Parameters: [@param0=[REQUEST_ID,31779], @param1=[REQUEST_SERVICE_ID,147390], @param2=[OLD_STATE_CODE,0     ], @param3=[CURR_STATE_CODE,3]]
2019-09-20 16:51:58,397 [1] DEBUG - Statement Id: [DAOWF005_Add_History] Types: [@param0=[String, System.String], @param1=[Int32, System.Int32], @param2=[String, System.String], @param3=[String, System.String]]
2019-09-20 16:51:58,434 [1] DEBUG - Statement Id: [DAO00009_TT_DVYEUCAU_Update] PreparedStatement : [Update TT_DVYEUCAU set TRANGTHAI_WFL = 'DANGTHUCHIEN' where DVYEUCAU_ID = '205443']
2019-09-20 16:51:58,464 [1] DEBUG - Statement Id: [DAO00026_GetListDanhSachDichVuGhiNhanVTYT_COM25_WithTN] PreparedStatement : [select distinct CONVERT(VARCHAR(11),C.NGAYYEUCAU,103) as NGAYYEUCAU, C.DICHVU_ID, C.DVYEUCAU_ID, D.TENDICHVU, C.NOITHUCHIEN_ID, A.SOTIEPNHAN, A.TRAITUYEN, A.NGAYMIENDONGCHITRA, A.TIEPNHAN_ID, A.DOITUONG_ID, A.TRANGTHAI,            A.LOAITHANHVIEN_ID, A.SUDUNG_BHTN, A.THE_ID, A.THANHVIEN_ID, A.VIP, A.NGUON_BENHNHAN_ID, A.BAOLANH_VIENPHI,            CASE WHEN (A.TRANGTHAI = 'NOITRU' OR A.TRANGTHAI = 'CAPCUU') THEN 'IN' ELSE 'OUT' END AS LOAIBENHAN,            CASE WHEN (C.TRANGTHAI = 'CHUAKETQUA') THEN 'CHUAKETQUA' ELSE 'HOANTAT' END AS TRANGTHAIDICHVU,            B.*, isnull(ntba.SOBENHAN, '') SOBENHAN, isnull(ntba.BENHAN_ID, 0) BENHAN_ID,            CASE WHEN Left(E.MANHOMDICHVU,2) = '03' THEN '02' ELSE Left(E.MANHOMDICHVU,2) END AS MANHOMDICHVU            from TT_TIEPNHAN A            inner join TT_BENHNHAN B on B.BENHNHAN_ID = A.BENHNHAN_ID and B.ACTIVE = '1'            inner join TT_DVYEUCAU C on C.TIEPNHAN_ID = A.TIEPNHAN_ID                        left join TM_DICHVU D on D.DICHVU_ID = C.DICHVU_ID            left join TM_NHOMDICHVU E on E.NHOMDICHVU_ID = D.NHOMDICHVU_ID            left join TT_NOITRU_BENHAN ntba on ntba.BENHAN_ID = C.BENHAN_ID              where            C.NGAYHENCLS is NULL and A.BENHVIEN_ID = 'HLU01'            and (A.TRANGTHAI = 'DATIEPNHAN' or A.TRANGTHAI = 'NOITRU' or A.TRANGTHAI = 'CAPCUU' or A.TRANGTHAI = 'NGOAITRU')            and (CASE WHEN Left(E.MANHOMDICHVU,2) = '03' THEN '02' ELSE Left(E.MANHOMDICHVU,2) END in ('02', '04'))            and A.TIEPNHAN_ID = '27478']
2019-09-20 16:51:59,742 [1] DEBUG - Statement Id: [DAOLOG01_LockEnd] PreparedStatement : [DELETE TT_LOG_UPDATE        where REF_TABLE = 'TT_NGOAITRU_KHAMBENH' and REF_ID = '27478' and BENHVIEN_ID = 'HLU01']
2019-09-20 16:51:59,851 [1] DEBUG - Statement Id: [DAO00014_Clear_1ToaThuocKhambenh] PreparedStatement : [DELETE FROM TT_DUOC_TONKHO_BOOK_NGOAITRU where REF_TABLE = 'TT_NGOAITRU_TOATHUOC'        and REF_ID in (        select TOATHUOC_ID from TT_NGOAITRU_TOATHUOC        where             KHAMBENH_TOATHUOC_ID in (select KHAMBENH_TOATHUOC_ID from TT_NGOAITRU_KHAMBENH_TOATHUOC        where TIEPNHAN_ID = '27478' and                   KHAMBENH_ID not in (select KHAMBENH_ID from TT_NGOAITRU_KHAMBENH where  TIEPNHAN_ID = '27478'))        and TIEPNHAN_ID = '27478')          DELETE FROM TT_VIENPHI where REF_TABLE = 'TT_NGOAITRU_TOATHUOC'        and REF_ID in (        select TOATHUOC_ID from TT_NGOAITRU_TOATHUOC        where KHAMBENH_TOATHUOC_ID in (select KHAMBENH_TOATHUOC_ID from TT_NGOAITRU_KHAMBENH_TOATHUOC        where TIEPNHAN_ID = '27478' and KHAMBENH_ID not in (select KHAMBENH_ID from TT_NGOAITRU_KHAMBENH where TIEPNHAN_ID = '27478'))        and TIEPNHAN_ID = '27478')          delete from TT_NGOAITRU_TOATHUOC        where KHAMBENH_TOATHUOC_ID in (select KHAMBENH_TOATHUOC_ID from TT_NGOAITRU_KHAMBENH_TOATHUOC        where TIEPNHAN_ID = '27478' and KHAMBENH_ID not in (select KHAMBENH_ID from TT_NGOAITRU_KHAMBENH where TIEPNHAN_ID = '27478')        and TIEPNHAN_ID = '27478')          delete from TT_NGOAITRU_KHAMBENH_TOATHUOC where TIEPNHAN_ID = '27478'        and KHAMBENH_ID not in (select KHAMBENH_ID from TT_NGOAITRU_KHAMBENH where TIEPNHAN_ID = '27478') and TIEPNHAN_ID = '27478']
2019-09-20 16:51:59,938 [1] DEBUG - Statement Id: [DAO00014_GetKhamBenhInfo] PreparedStatement : [select * from TT_NGOAITRU_KHAMBENH where KHAMBENH_ID =        (select KHAMBENH_NGOAITRU_ID from TT_DVYEUCAU where DVYEUCAU_ID = '205443')]
2019-09-20 16:51:59,968 [1] DEBUG - Statement Id: [DAO00068_GetSinhHieuBySinhHieuID] PreparedStatement : [select top (1) *            from TT_NGOAITRU_KHAMBENH_SINHHIEU            where KHAMBENH_SINHHIEU_ID = '0'            and BENHVIEN_ID = 'HLU01'             and               BENHNHAN_ID = '23423'                           order by KHAMBENH_SINHHIEU_ID]
2019-09-20 16:52:00,013 [1] DEBUG - Statement Id: [DAO00014_GetKhamBenhICDInfo] PreparedStatement : [select *        from TT_NGOAITRU_KHAMBENH_ICD        where KHAMBENH_ID  = '26173']
2019-09-20 16:52:00,049 [1] DEBUG - Statement Id: [DAO00014_GetListToaThuoc] PreparedStatement : [select A.*        from TT_NGOAITRU_KHAMBENH_TOATHUOC A        where A.KHAMBENH_ID = '26173']
2019-09-20 16:52:00,084 [1] DEBUG - Statement Id: [DAO00014_KiemTraDVYCCoBHYT] PreparedStatement : [select *        from TT_VIENPHI        where REF_ID  = '205443' and REF_TABLE = 'TT_DVYEUCAU' and BHYT_DONGIA > 0]
2019-09-20 16:52:00,121 [1] DEBUG - Statement Id: [DAO00040_LayListToaMau] PreparedStatement : [select A.*, dc.TENDUOCDAYDU, dc.BHYT DUOC_BHYT, ld.LOAIVATTU_ID, ld.MALOAIDUOC, dd.DICTIONARY_NAME DUONGDUNG, dc.TAMNGUNG            from TT_TOATHUOCMAU A            left join TM_DUOC dc on A.DUOC_ID = dc.DUOC_ID            left join TM_LOAIDUOC ld on dc.LOAIDUOC_ID = ld.LOAIDUOC_ID            left join (select * from LST_DICTIONARY where DICTIONARY_TYPE_CODE like 'DuongDung') dd on dd.DICTIONARY_ID = dc.DUONGDUNG_ID            where (1=1)             and               A.BACSI_ID  = 1              and A.LOAITOATHUOC in  (                        @param0                   ,                           @param1                   ,                           @param2                   ,                           @param3                   )]
2019-09-20 16:52:00,121 [1] DEBUG - Statement Id: [DAO00040_LayListToaMau] Parameters: [@param0=[LSTLOAITOATHUOC[0],BV], @param1=[LSTLOAITOATHUOC[1],MN], @param2=[LSTLOAITOATHUOC[2],MP], @param3=[LSTLOAITOATHUOC[3],TV]]
2019-09-20 16:52:00,121 [1] DEBUG - Statement Id: [DAO00040_LayListToaMau] Types: [@param0=[String, System.String], @param1=[String, System.String], @param2=[String, System.String], @param3=[String, System.String]]
2019-09-20 16:52:00,216 [1] DEBUG - Statement Id: [DAO00040_LayListToaMau] PreparedStatement : [select A.*, dc.TENDUOCDAYDU, dc.BHYT DUOC_BHYT, ld.LOAIVATTU_ID, ld.MALOAIDUOC, dd.DICTIONARY_NAME DUONGDUNG, dc.TAMNGUNG            from TT_TOATHUOCMAU A            left join TM_DUOC dc on A.DUOC_ID = dc.DUOC_ID            left join TM_LOAIDUOC ld on dc.LOAIDUOC_ID = ld.LOAIDUOC_ID            left join (select * from LST_DICTIONARY where DICTIONARY_TYPE_CODE like 'DuongDung') dd on dd.DICTIONARY_ID = dc.DUONGDUNG_ID            where (1=1)             and               A.BACSI_ID  = 1              and A.LOAITOATHUOC in  (                        @param0                   ,                           @param1                   ,                           @param2                   ,                           @param3                   )]
2019-09-20 16:52:00,216 [1] DEBUG - Statement Id: [DAO00040_LayListToaMau] Parameters: [@param0=[LSTLOAITOATHUOC[0],BV], @param1=[LSTLOAITOATHUOC[1],MN], @param2=[LSTLOAITOATHUOC[2],MP], @param3=[LSTLOAITOATHUOC[3],TV]]
2019-09-20 16:52:00,216 [1] DEBUG - Statement Id: [DAO00040_LayListToaMau] Types: [@param0=[String, System.String], @param1=[String, System.String], @param2=[String, System.String], @param3=[String, System.String]]
2019-09-20 16:52:00,254 [1] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoVaBookingCOM23UpdateRedis_TheoPhamvi] PreparedStatement : [declare @TOAMUANGOAI int = 0;        select @TOAMUANGOAI = isnull(VALUE,0) from TM_SYS_APPSETTINGS where CODE = 'OPD_TOAMUANGOAI_DUNGDANHMUC_DUOC'                if @TOAMUANGOAI = 1        begin        select  distinct '0' + '_' + LTRIM(d.DUOC_ID) + '_' + '0' as DUOC_KEY, 999999999 as SOLUONG        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        where  @param0  = 0        union all        select distinct tk.DUOC_KEY, tk.SOLUONG        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        inner join        (        select  LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')) DUOC_KEY, (SUM(dtk.SOLUONG) - isnull(sum(A.SOLUONG),0) - isnull(sum(B.SOLUONG),0)) SOLUONG, pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        from (select sum(soluong) soluong,duoc_id,nguonduoc_id,khoduoc_id,benhvien_id from TT_DUOC_TONKHO  group by duoc_id,nguonduoc_id,khoduoc_id,benhvien_id) dtk        inner join TM_DUOC_PHAMVISD_MAPPING pvsd on dtk.KHODUOC_ID = pvsd.KHODUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NOITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) B on B.DUOC_ID = dtk.DUOC_ID and B.PHAMVI_ID = pvsd.PHAMVI_ID and B.NGUONHANG_ID = dtk.NGUONDUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NGOAITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) A on A.DUOC_ID = dtk.DUOC_ID and A.PHAMVI_ID = pvsd.PHAMVI_ID and A.NGUONHANG_ID = dtk.NGUONDUOC_ID        where dtk.BENHVIEN_ID = 'HLU01'        group by LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')), pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        ) tk on tk.DUOC_ID = d.DUOC_ID        left join TM_DUOC_PHAMVISUDUNG kd on kd.PHAMVI_ID = tk.PHAMVI_ID and kd.BENHVIEN_ID = 'HLU01'        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = tk.NGUONDUOC_ID and nh.BENHVIEN_ID = 'HLU01'        where d.BENHVIEN_ID = 'HLU01' and tk.PHAMVI_ID =  @param0         end        else        begin        select distinct tk.DUOC_KEY, tk.SOLUONG        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        inner join        (        select  LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')) DUOC_KEY, (SUM(dtk.SOLUONG) - isnull(sum(A.SOLUONG),0) - isnull(sum(B.SOLUONG),0)) SOLUONG, pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        from (select sum(soluong) soluong,duoc_id,nguonduoc_id,khoduoc_id,benhvien_id from TT_DUOC_TONKHO  group by duoc_id,nguonduoc_id,khoduoc_id,benhvien_id) dtk        inner join TM_DUOC_PHAMVISD_MAPPING pvsd on dtk.KHODUOC_ID = pvsd.KHODUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NOITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) B on B.DUOC_ID = dtk.DUOC_ID and B.PHAMVI_ID = pvsd.PHAMVI_ID and B.NGUONHANG_ID = dtk.NGUONDUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NGOAITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) A on A.DUOC_ID = dtk.DUOC_ID and A.PHAMVI_ID = pvsd.PHAMVI_ID and A.NGUONHANG_ID = dtk.NGUONDUOC_ID        where dtk.BENHVIEN_ID = 'HLU01'        group by LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')), pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        ) tk on tk.DUOC_ID = d.DUOC_ID        left join TM_DUOC_PHAMVISUDUNG kd on kd.PHAMVI_ID = tk.PHAMVI_ID and kd.BENHVIEN_ID = 'HLU01'        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = tk.NGUONDUOC_ID and nh.BENHVIEN_ID = 'HLU01'        where d.BENHVIEN_ID = 'HLU01' and tk.PHAMVI_ID =  @param0         end]
2019-09-20 16:52:00,254 [1] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoVaBookingCOM23UpdateRedis_TheoPhamvi] Parameters: [@param0=[PHAMVI_ID,1028]]
2019-09-20 16:52:00,254 [1] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoVaBookingCOM23UpdateRedis_TheoPhamvi] Types: [@param0=[Int64, System.Int64]]
2019-09-20 16:52:00,658 [1] DEBUG - Statement Id: [DAO00064_GetlistTT_TIEPNHAN_SOTHEBHYT] PreparedStatement : [select stbhyt.*, ba.SOBENHAN,         tn.SOTIEPNHAN, tn.LOAITHANHVIEN_ID, tn.THE_ID, tn.THANHVIEN_ID,        tn.SUDUNG_BHTN, tn.BAOLANH_VIENPHI, tn.VIP, tn.NGUOINUOCNGOAI        from TT_TIEPNHAN_SOTHEBHYT stbhyt        left join TT_TIEPNHAN tn on tn.TIEPNHAN_ID = stbhyt.TIEPNHAN_ID        left join TT_NOITRU_BENHAN ba on ba.TIEPNHAN_ID = stbhyt.TIEPNHAN_ID        where         stbhyt.TIEPNHAN_ID = '27478' and isnull(stbhyt.KHONGSUDUNG, '0') = '0']
2019-09-20 16:52:00,718 [1] DEBUG - Statement Id: [DAO00064_GetListVienPhiByTiepNnan] PreparedStatement : [select distinct        B.DOITUONG_ID, B.NGAYMIENDONGCHITRA, B.BENHNHAN_ID as TIEPNHAN_BENHNHAN_ID, B.TRAITUYEN,        B.BHYTTREN3NAM as TREN3NAM, B.BHYTTREN5NAM as TREN5NAM, B.SOTIEPNHAN, B.SOBENHAN,        B.LOAITHANHVIEN_ID, B.SUDUNG_BHTN, B.THE_ID, B.THANHVIEN_ID, B.BAOLANH_VIENPHI, B.VIP, B.NGUOINUOCNGOAI,        C.GIATRIMIENGIAM as GIATRIMIENGIAM, D.GIATRIMIENGIAM as GIATRIMIENGIAM_BHTN, E.GIATRIMIENGIAM as GIATRIMIENGIAM_THANHVIEN,        F.GIATRIMIENGIAM as GIATRIMIENGIAM_CONGTY, DVYC.THE_ID as DVDUNGTHE, DVYC.TRANGTHAI as TRANGTHAIDICHVU, ndv.MANHOMDICHVU,        A.* from TT_VIENPHI A        left join        (select B.*, C.SOBENHAN, C.BENHAN_ID        from TT_TIEPNHAN B        left join TT_NOITRU_BENHAN C on B.TIEPNHAN_ID = C.TIEPNHAN_ID                 where B.TIEPNHAN_ID = '27478') B on B.TIEPNHAN_ID = A.TIEPNHAN_ID        left join (select sum(GIATRIMIENGIAM) as GIATRIMIENGIAM, VIENPHI_ID, REF_TABLE        from TT_MIENGIAM_CHITIET        where REF_TABLE = 'TT_MIENGIAM'        and exists (select MIENGIAM_ID from TT_MIENGIAM where TT_MIENGIAM_CHITIET.MIENGIAM_ID = MIENGIAM_ID and TINHTRANG = 1 and TIEPNHAN_ID = '27478')        group by VIENPHI_ID, REF_TABLE) C on C.REF_TABLE = 'TT_MIENGIAM' and C.VIENPHI_ID = A.VIENPHI_ID        left join (select sum(GIATRIMIENGIAM) as GIATRIMIENGIAM, VIENPHI_ID, REF_TABLE        from TT_MIENGIAM_CHITIET        where REF_TABLE = 'TT_MIENGIAM_BHTN'        and exists (select MIENGIAM_BHTN_ID from TT_MIENGIAM_BHTN where TT_MIENGIAM_CHITIET.MIENGIAM_ID = MIENGIAM_BHTN_ID and  TINHTRANG = 1 and TIEPNHAN_ID = '27478')        group by VIENPHI_ID, REF_TABLE) D on D.REF_TABLE = 'TT_MIENGIAM_BHTN' and D.VIENPHI_ID = A.VIENPHI_ID        left join (select sum(GIATRIMIENGIAM) as GIATRIMIENGIAM, VIENPHI_ID, REF_TABLE        from TT_MIENGIAM_CHITIET        where REF_TABLE = 'TT_MIENGIAM_THANHVIEN'        and exists (select MIENGIAM_THANHVIEN_ID from TT_MIENGIAM_THANHVIEN where TT_MIENGIAM_CHITIET.MIENGIAM_ID = MIENGIAM_THANHVIEN_ID and TINHTRANG = 1 and TIEPNHAN_ID = '27478')        group by VIENPHI_ID, REF_TABLE) E on E.REF_TABLE = 'TT_MIENGIAM_THANHVIEN' and E.VIENPHI_ID = A.VIENPHI_ID        left join (select sum(GIATRIMIENGIAM) as GIATRIMIENGIAM, VIENPHI_ID, REF_TABLE        from TT_MIENGIAM_CHITIET        where REF_TABLE = 'TT_MIENGIAM_CONGTY'        and exists (select MIENGIAM_CONGTY_ID from TT_MIENGIAM_CONGTY where TT_MIENGIAM_CHITIET.MIENGIAM_ID = MIENGIAM_CONGTY_ID and TINHTRANG = 1 and TIEPNHAN_ID = '27478')        group by VIENPHI_ID, REF_TABLE) F on F.REF_TABLE = 'TT_MIENGIAM_CONGTY' and F.VIENPHI_ID = A.VIENPHI_ID        left join TT_DVYEUCAU DVYC on DVYC.DVYEUCAU_ID = A.REF_ID and A.REF_TABLE = 'TT_DVYEUCAU'        left join TM_DICHVU DV on DVYC.DICHVU_ID = DV.DICHVU_ID and A.REF_TABLE = 'TT_DVYEUCAU'        left join TM_NHOMDICHVU ndv on ndv.NHOMDICHVU_ID = DV.NHOMDICHVU_ID and A.REF_TABLE = 'TT_DVYEUCAU'        where        A.TIEPNHAN_ID = '27478' and ((DVYC.HUYYEUCAU = '0' and A.DICHVU_ID is not null)        or A.DUOC_ID is not null or A.REF_TABLE = 'TT_NUT_XACNHANSUATAN_CHITIET')        and A.ACTIVE = '1'                 and A.BENHVIEN_ID = 'HLU01'        order by A.VIENPHI_ID]
2019-09-20 16:52:00,759 [1] DEBUG - Statement Id: [DAO00006_GetListDuocTyle] PreparedStatement : [select DUOC_ID, DOITUONG_ID, (TYLE/100) as TYLE, DONGIA MUCTRAN_THANHTOAN from TM_DOITUONG_GIADUOC_TYLE            where            BENHVIEN_ID = 'HLU01'            and DOITUONG_ID = '4']
2019-09-20 16:52:00,793 [1] DEBUG - Statement Id: [DAO00027_GetListTuongTrinhDichVuPhauThuatCuaTiepNhan] PreparedStatement : [declare @ManhomDSA varchar(10);        declare @PhanLoaiNhomDV varchar(20) = '05';        select top 1  @ManhomDSA = VALUE from TM_SYS_APPSETTINGS where CODE = 'MANHOM_DICHVU_DSA'        if (@ManhomDSA is not null) set @PhanLoaiNhomDV += ',' + @ManhomDSA        select distinct ptyc.*        from TT_PHAUTHUAT_YEUCAU ptyc        inner join TM_DICHVU dv on dv.DICHVU_ID = ptyc.DICHVU_ID        inner join TM_NHOMDICHVU ndv on ndv.NHOMDICHVU_ID = dv.NHOMDICHVU_ID        inner join TT_PHAUTHUAT pt on pt.PHAUTHUAT_ID = ptyc.PHAUTHUAT_ID        where        pt.TIEPNHAN_ID = 27478        and (left(ndv.MANHOMDICHVU, 2) in (select * from STRING_SPLIT(@PhanLoaiNhomDV,',')) or ndv.MANHOMDICHVU in (select * from STRING_SPLIT(@PhanLoaiNhomDV,',')))]
2019-09-20 16:52:00,841 [1] DEBUG - Statement Id: [DAO00006_GetList] PreparedStatement : [select dv.*, loaiDV.MALOAIDICHVU, captren.NHOMDICHVU_ID as NHOMDICHVU_CAPTREN_ID, captren.TENNHOMDICHVU as NHOMDICHVU_CAPTREN,              nhom_dv.TENNHOMDICHVU as TENNHOMDICHVU, nhom_dv.MANHOMDICHVU,              case when dv.ATTRIBUTE5 is null then 'TT' else 'KTC' end as LOAI_CHIPHI              from TM_DICHVU as dv              left join TM_NHOMDICHVU as nhom_dv on nhom_dv.NHOMDICHVU_ID = dv.NHOMDICHVU_ID and nhom_dv.BENHVIEN_ID = 'HLU01'              left join TM_NHOMDICHVU as captren on nhom_dv.CAPTREN_ID = captren.NHOMDICHVU_ID and captren.BENHVIEN_ID = 'HLU01'              left join TM_LOAIDICHVU loaiDV on nhom_dv.LOAIDICHVU_ID = loaiDV.LOAIDICHVU_ID and loaiDV.BENHVIEN_ID = 'HLU01'              where nhom_dv.TAMNGUNG = '0' and dv.BENHVIEN_ID = 'HLU01'              and dv.TAMNGUNG = '0'               AND                   loaiDV.MALOAIDICHVU = 'KhamBenh']
2019-09-20 16:52:00,925 [1] DEBUG - Statement Id: [DAO00023_UpdateNhieuVP] PreparedStatement : [declare @jsonVienPhi nvarchar(max) = N'[{"VIENPHI_ID":674724,"TIEPNHAN_ID":27478,"DICHVU_ID":5685,"BENHAN_ID":0,"SOLUONG":1.0000,"DONGIA_DOANHTHU":33000.0000,"THANHTIEN_DOANHTHU":33000.00,"BHYT_TL":0.8000,"BHYT_DONGIA":33000.0000,"BHYT_THANHTIEN":33000.00,"BHYT_DONGIA_CONGKHAM_DAU":33000.0000,"BHYT_CONGKHAM_DAU_TYLE":1.0,"BHYT_DONGIA_CHITRA":26400.0,"BHYT_THANHTIEN_CHITRA":26400.00,"BENHNHAN_PHAITHANHTOAN":6600.00,"GIATRI_HOADON":6600.00,"GIATRI_HOADON_DATHANHTOAN":0.0,"GIATRI_BIENLAI":0.0,"GIATRI_BIENLAI_DATHANHTOAN":0.0,"GIATRI_BENHNHAN_DATHANHTOAN":0.0,"DATHUCHIEN":"1","KHONGTHUTIEN":"0","BHYTDONGTIEN":"0","DICHVU_TL":1.0,"BHYT_DONGIA_DONGCT_DAU":0.0,"SOBHYT":"DN453534653452338289","SOBHYT_HUONG_ID":28501,"GIATRIMIENGIAM":0.0,"GIATRIMIENGIAM_BHTN":0.0,"GIATRIMIENGIAM_THANHVIEN":0.0,"GIATRIMIENGIAM_CONGTY":0.0,"BHYT_CK2_KHONGTHANHTOAN":false},{"VIENPHI_ID":674725,"TIEPNHAN_ID":27478,"DICHVU_ID":4145,"BENHAN_ID":0,"SOLUONG":1.0000,"DONGIA_DOANHTHU":260000.0000,"THANHTIEN_DOANHTHU":260000.00,"BHYT_TL":0.8000,"BHYT_DONGIA":260000.0000,"BHYT_THANHTIEN":260000.00,"BHYT_DONGIA_CONGKHAM_DAU":33000.0000,"BHYT_CONGKHAM_DAU_TYLE":1.0,"BHYT_DONGIA_CHITRA":208000.0,"BHYT_THANHTIEN_CHITRA":208000.00,"BENHNHAN_PHAITHANHTOAN":52000.00,"GIATRI_HOADON":52000.00,"GIATRI_HOADON_DATHANHTOAN":0.0,"GIATRI_BIENLAI":0.0,"GIATRI_BIENLAI_DATHANHTOAN":0.0,"GIATRI_BENHNHAN_DATHANHTOAN":0.0,"DATHUCHIEN":"1","KHONGTHUTIEN":"0","BHYTDONGTIEN":"0","DICHVU_TL":1.0,"BHYT_DONGIA_DONGCT_DAU":0.0,"SOBHYT":"DN453534653452338289","SOBHYT_HUONG_ID":28501,"GIATRIMIENGIAM":0.0,"GIATRIMIENGIAM_BHTN":0.0,"GIATRIMIENGIAM_THANHVIEN":0.0,"GIATRIMIENGIAM_CONGTY":0.0,"BHYT_CK2_KHONGTHANHTOAN":false},{"VIENPHI_ID":674726,"TIEPNHAN_ID":27478,"DICHVU_ID":1111,"BENHAN_ID":0,"SOLUONG":1.0000,"DONGIA_DOANHTHU":37000.0000,"THANHTIEN_DOANHTHU":37000.00,"BHYT_TL":0.8000,"BHYT_DONGIA":37000.0000,"BHYT_THANHTIEN":37000.00,"BHYT_DONGIA_CONGKHAM_DAU":33000.0000,"BHYT_CONGKHAM_DAU_TYLE":1.0,"BHYT_DONGIA_CHITRA":29600.0,"BHYT_THANHTIEN_CHITRA":29600.00,"BENHNHAN_PHAITHANHTOAN":7400.00,"GIATRI_HOADON":7400.00,"GIATRI_HOADON_DATHANHTOAN":0.0,"GIATRI_BIENLAI":0.0,"GIATRI_BIENLAI_DATHANHTOAN":0.0,"GIATRI_BENHNHAN_DATHANHTOAN":0.0,"DATHUCHIEN":"1","KHONGTHUTIEN":"0","BHYTDONGTIEN":"0","DICHVU_TL":1.0,"BHYT_DONGIA_DONGCT_DAU":0.0,"SOBHYT":"DN453534653452338289","SOBHYT_HUONG_ID":28501,"GIATRIMIENGIAM":0.0,"GIATRIMIENGIAM_BHTN":0.0,"GIATRIMIENGIAM_THANHVIEN":0.0,"GIATRIMIENGIAM_CONGTY":0.0,"BHYT_CK2_KHONGTHANHTOAN":false},{"VIENPHI_ID":674727,"TIEPNHAN_ID":27478,"DICHVU_ID":5492,"BENHAN_ID":0,"SOLUONG":1.0000,"DONGIA_DOANHTHU":33000.0000,"THANHTIEN_DOANHTHU":33000.00,"BHYT_TL":0.8000,"BHYT_DONGIA":33000.0000,"BHYT_THANHTIEN":33000.00,"BHYT_DONGIA_CONGKHAM_DAU":33000.0000,"BHYT_CONGKHAM_DAU_TYLE":1.0,"BHYT_DONGIA_CHITRA":26400.0,"BHYT_THANHTIEN_CHITRA":26400.00,"BENHNHAN_PHAITHANHTOAN":0.0,"GIATRI_HOADON":0.0,"GIATRI_HOADON_DATHANHTOAN":0.0,"GIATRI_BIENLAI":0.0,"GIATRI_BIENLAI_DATHANHTOAN":0.0,"GIATRI_BENHNHAN_DATHANHTOAN":0.0,"DATHUCHIEN":"1","KHONGTHUTIEN":"1","BHYTDONGTIEN":"0","DICHVU_TL":1.0,"BHYT_DONGIA_DONGCT_DAU":0.0,"SOBHYT":"DN453534653452338289","SOBHYT_HUONG_ID":28501,"GIATRIMIENGIAM":0.0,"GIATRIMIENGIAM_BHTN":0.0,"GIATRIMIENGIAM_THANHVIEN":0.0,"GIATRIMIENGIAM_CONGTY":0.0,"BHYT_CK2_KHONGTHANHTOAN":false}]';        begin        UPDATE TT_VIENPHI        SET        SOLUONG = json.SOLUONG,        DONGIA_DOANHTHU = json.DONGIA_DOANHTHU,        THANHTIEN_DOANHTHU = json.THANHTIEN_DOANHTHU,        BHYT_TL = json.BHYT_TL,        BHYT_DONGIA = json.BHYT_DONGIA,        BHYT_THANHTIEN = json.BHYT_THANHTIEN,        BHYT_DONGIA_CONGKHAM_DAU = json.BHYT_DONGIA_CONGKHAM_DAU,        BHYT_CONGKHAM_DAU_TYLE = json.BHYT_CONGKHAM_DAU_TYLE,        BHYT_DONGIA_CHITRA = json.BHYT_DONGIA_CHITRA,        BHYT_THANHTIEN_CHITRA = json.BHYT_THANHTIEN_CHITRA,        BENHNHAN_PHAITHANHTOAN = json.BENHNHAN_PHAITHANHTOAN,        GIATRI_HOADON = json.GIATRI_HOADON,                GIATRI_BIENLAI = json.GIATRI_BIENLAI,                DATHUCHIEN = json.DATHUCHIEN,                DICHVU_TL = json.DICHVU_TL,        BHYT_DONGIA_DONGCT_DAU = json.BHYT_DONGIA_DONGCT_DAU,        NGAYCAPNHAT = GETDATE()        FROM OPENJSON (@jsonVienPhi)        WITH (        VIENPHI_ID int,        SOLUONG numeric(25, 4),        DONGIA_DOANHTHU numeric(25, 4),        THANHTIEN_DOANHTHU numeric(25, 4),        BHYT_TL numeric(25, 4),        BHYT_DONGIA numeric(25, 4),        BHYT_THANHTIEN numeric(25, 4),        BHYT_DONGIA_CONGKHAM_DAU numeric(25, 4),        BHYT_CONGKHAM_DAU_TYLE numeric(25, 4),        BHYT_DONGIA_CHITRA numeric(25, 4),        BHYT_THANHTIEN_CHITRA numeric(25, 4),        BENHNHAN_PHAITHANHTOAN numeric(25, 4),        GIATRI_HOADON numeric(25, 4),                GIATRI_BIENLAI numeric(25, 4),                DATHUCHIEN char(1),        KHONGTHUTIEN char(1),        BHYTDONGTIEN char(1),        DICHVU_TL numeric(25, 4),        BHYT_DONGIA_DONGCT_DAU numeric(25, 4))  json        WHERE TT_VIENPHI.VIENPHI_ID = json.VIENPHI_ID                        insert into TT_TINH_VIENPHI_LOG        SELECT json.VIENPHI_ID, json.TIEPNHAN_ID, json.BENHAN_ID, json.SOLUONG, json.BHYT_TL, json.DONGIA_DOANHTHU,        json.THANHTIEN_DOANHTHU, json.BHYT_DONGIA, json.BHYT_THANHTIEN, json.BHYT_DONGIA_CHITRA, json.BHYT_THANHTIEN_CHITRA, json.BENHNHAN_PHAITHANHTOAN,        json.SOBHYT_HUONG_ID, json.SOBHYT, GETDATE(), -1, 'HLU01'        FROM OPENJSON(@jsonVienPhi)        WITH (        VIENPHI_ID int,        TIEPNHAN_ID int,        BENHAN_ID int,        SOLUONG numeric(25, 4),        DONGIA_DOANHTHU numeric(25, 4),        THANHTIEN_DOANHTHU numeric(25, 4),        BHYT_TL numeric(25, 4),        BHYT_DONGIA numeric(25, 4),        BHYT_THANHTIEN numeric(25, 4),        BHYT_DONGIA_CHITRA numeric(25, 4),        BHYT_THANHTIEN_CHITRA numeric(25, 4),        BENHNHAN_PHAITHANHTOAN numeric(25, 4),        SOBHYT_HUONG_ID int,        SOBHYT nvarchar(30)) json        end]
2019-09-20 16:52:01,002 [1] DEBUG - Statement Id: [DAO00067_UpdateDataVienPhiDongiaBHYT] PreparedStatement : [update TT_VIENPHI          set BHYT_DONGIA_CHITRA = 0, BHYT_THANHTIEN = 0, BHYT_THANHTIEN_CHITRA = 0          where          TIEPNHAN_ID = 27478 and BHYT_DONGIA = 0          and (BHYT_DONGIA_CHITRA > 0 or BHYT_THANHTIEN > 0 or BHYT_THANHTIEN_CHITRA > 0)]
2019-09-20 16:52:01,031 [1] DEBUG - Statement Id: [DAO00067_CapnhatDataVienphiKhiHuyThanhtoanHoadon] PreparedStatement : [update TT_VIENPHI        set TT_VIENPHI.HOADON_ID = hdct.HOADON_ID, TT_VIENPHI.GIATRI_BENHNHAN_DATHANHTOAN = TT_VIENPHI.GIATRI_BENHNHAN_DATHANHTOAN + hdct.GIATRI_BENHNHAN_DATHANHTOAN        from (select CT.HOADON_ID, CT.VIENPHI_ID, CT.GIATRI_BENHNHAN_DATHANHTOAN        from TT_HOADON_CHITIET_NGOAITRU CT        join TT_HOADON HD on HD.HOADON_ID = CT.HOADON_ID        join TT_VIENPHI vp on vp.VIENPHI_ID = ct.VIENPHI_ID        where HD.DATHANHTOAN = 1 and HD.HUYHOADON = 0 and HD.HOANTRA = 0 and vp.TIEPNHAN_ID =  @param0 ) hdct        where        TT_VIENPHI.VIENPHI_ID = hdct.VIENPHI_ID and TT_VIENPHI.HOADON_ID is null and isnull(TT_VIENPHI.GIATRI_BENHNHAN_DATHANHTOAN,0) = 0        and TT_VIENPHI.TIEPNHAN_ID =  @param0           update TT_VIENPHI        set TT_VIENPHI.HOADON_ID = null, TT_VIENPHI.GIATRI_BENHNHAN_DATHANHTOAN = TT_VIENPHI.GIATRI_BENHNHAN_DATHANHTOAN - hdct.GIATRI_BENHNHAN_DATHANHTOAN,        TT_VIENPHI.DATHANHTOAN = '0'        from (select CT.HOADON_ID, CT.VIENPHI_ID, CT.GIATRI_BENHNHAN_DATHANHTOAN        from TT_HOADON_CHITIET_NGOAITRU CT        join TT_HOADON HD on HD.HOADON_ID = CT.HOADON_ID        join TT_VIENPHI vp on vp.VIENPHI_ID = ct.VIENPHI_ID and vp.HOADON_ID = ct.HOADON_ID        where HD.DATHANHTOAN = 0 and (HD.HUYHOADON = 1 or HD.HOANTRA = 1) and vp.TIEPNHAN_ID =  @param0 ) hdct        where        TT_VIENPHI.VIENPHI_ID = hdct.VIENPHI_ID and TT_VIENPHI.HOADON_ID = hdct.HOADON_ID        and TT_VIENPHI.TIEPNHAN_ID =  @param0]
2019-09-20 16:52:01,031 [1] DEBUG - Statement Id: [DAO00067_CapnhatDataVienphiKhiHuyThanhtoanHoadon] Parameters: [@param0=[TIEPNHAN_ID,27478]]
2019-09-20 16:52:01,031 [1] DEBUG - Statement Id: [DAO00067_CapnhatDataVienphiKhiHuyThanhtoanHoadon] Types: [@param0=[Int64, System.Int64]]
2019-09-20 16:52:01,200 [1] DEBUG - Statement Id: [DAO00017_GetLoaiGiaByDoiTuongId] PreparedStatement : [select dtlg.DOUUTIEN, dtlg.DOITUONG_ID, lg.LOAIGIA_ID, lg.TENLOAIGIA, lg.MALOAIGIA              from TM_LOAIGIA lg              left join TM_DOITUONG_LOAIGIA dtlg              on lg.LOAIGIA_ID = dtlg.LOAIGIA_ID and dtlg.BENHVIEN_ID = 'HLU01'              where lg.TAMNGUNG = 0 and lg.BENHVIEN_ID = 'HLU01'                             order by dtlg.DOUUTIEN]
2019-09-20 16:52:01,242 [1] DEBUG - Statement Id: [DAO00014_KiemTraDVYCCoBHYT] PreparedStatement : [select *        from TT_VIENPHI        where REF_ID  = '205443' and REF_TABLE = 'TT_DVYEUCAU' and BHYT_DONGIA > 0]
2019-09-20 16:52:01,280 [1] DEBUG - Statement Id: [DAO00040_LayListToaMau] PreparedStatement : [select A.*, dc.TENDUOCDAYDU, dc.BHYT DUOC_BHYT, ld.LOAIVATTU_ID, ld.MALOAIDUOC, dd.DICTIONARY_NAME DUONGDUNG, dc.TAMNGUNG            from TT_TOATHUOCMAU A            left join TM_DUOC dc on A.DUOC_ID = dc.DUOC_ID            left join TM_LOAIDUOC ld on dc.LOAIDUOC_ID = ld.LOAIDUOC_ID            left join (select * from LST_DICTIONARY where DICTIONARY_TYPE_CODE like 'DuongDung') dd on dd.DICTIONARY_ID = dc.DUONGDUNG_ID            where (1=1)             and               A.BACSI_ID  = 1              and A.LOAITOATHUOC in  (                        @param0                   ,                           @param1                   ,                           @param2                   ,                           @param3                   )]
2019-09-20 16:52:01,280 [1] DEBUG - Statement Id: [DAO00040_LayListToaMau] Parameters: [@param0=[LSTLOAITOATHUOC[0],BV], @param1=[LSTLOAITOATHUOC[1],MN], @param2=[LSTLOAITOATHUOC[2],MP], @param3=[LSTLOAITOATHUOC[3],TV]]
2019-09-20 16:52:01,280 [1] DEBUG - Statement Id: [DAO00040_LayListToaMau] Types: [@param0=[String, System.String], @param1=[String, System.String], @param2=[String, System.String], @param3=[String, System.String]]
2019-09-20 16:52:01,695 [1] DEBUG - Statement Id: [DAO00040_LayListToaMau] PreparedStatement : [select A.*, dc.TENDUOCDAYDU, dc.BHYT DUOC_BHYT, ld.LOAIVATTU_ID, ld.MALOAIDUOC, dd.DICTIONARY_NAME DUONGDUNG, dc.TAMNGUNG            from TT_TOATHUOCMAU A            left join TM_DUOC dc on A.DUOC_ID = dc.DUOC_ID            left join TM_LOAIDUOC ld on dc.LOAIDUOC_ID = ld.LOAIDUOC_ID            left join (select * from LST_DICTIONARY where DICTIONARY_TYPE_CODE like 'DuongDung') dd on dd.DICTIONARY_ID = dc.DUONGDUNG_ID            where (1=1)             and               A.BACSI_ID  = 1              and A.LOAITOATHUOC in  (                        @param0                   ,                           @param1                   ,                           @param2                   ,                           @param3                   )]
2019-09-20 16:52:01,695 [1] DEBUG - Statement Id: [DAO00040_LayListToaMau] Parameters: [@param0=[LSTLOAITOATHUOC[0],BV], @param1=[LSTLOAITOATHUOC[1],MN], @param2=[LSTLOAITOATHUOC[2],MP], @param3=[LSTLOAITOATHUOC[3],TV]]
2019-09-20 16:52:01,695 [1] DEBUG - Statement Id: [DAO00040_LayListToaMau] Types: [@param0=[String, System.String], @param1=[String, System.String], @param2=[String, System.String], @param3=[String, System.String]]
2019-09-20 16:52:02,024 [1] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoVaBookingCOM23UpdateRedis_TheoPhamvi] PreparedStatement : [declare @TOAMUANGOAI int = 0;        select @TOAMUANGOAI = isnull(VALUE,0) from TM_SYS_APPSETTINGS where CODE = 'OPD_TOAMUANGOAI_DUNGDANHMUC_DUOC'                if @TOAMUANGOAI = 1        begin        select  distinct '0' + '_' + LTRIM(d.DUOC_ID) + '_' + '0' as DUOC_KEY, 999999999 as SOLUONG        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        where  @param0  = 0        union all        select distinct tk.DUOC_KEY, tk.SOLUONG        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        inner join        (        select  LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')) DUOC_KEY, (SUM(dtk.SOLUONG) - isnull(sum(A.SOLUONG),0) - isnull(sum(B.SOLUONG),0)) SOLUONG, pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        from (select sum(soluong) soluong,duoc_id,nguonduoc_id,khoduoc_id,benhvien_id from TT_DUOC_TONKHO  group by duoc_id,nguonduoc_id,khoduoc_id,benhvien_id) dtk        inner join TM_DUOC_PHAMVISD_MAPPING pvsd on dtk.KHODUOC_ID = pvsd.KHODUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NOITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) B on B.DUOC_ID = dtk.DUOC_ID and B.PHAMVI_ID = pvsd.PHAMVI_ID and B.NGUONHANG_ID = dtk.NGUONDUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NGOAITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) A on A.DUOC_ID = dtk.DUOC_ID and A.PHAMVI_ID = pvsd.PHAMVI_ID and A.NGUONHANG_ID = dtk.NGUONDUOC_ID        where dtk.BENHVIEN_ID = 'HLU01'        group by LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')), pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        ) tk on tk.DUOC_ID = d.DUOC_ID        left join TM_DUOC_PHAMVISUDUNG kd on kd.PHAMVI_ID = tk.PHAMVI_ID and kd.BENHVIEN_ID = 'HLU01'        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = tk.NGUONDUOC_ID and nh.BENHVIEN_ID = 'HLU01'        where d.BENHVIEN_ID = 'HLU01' and tk.PHAMVI_ID =  @param0         end        else        begin        select distinct tk.DUOC_KEY, tk.SOLUONG        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        inner join        (        select  LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')) DUOC_KEY, (SUM(dtk.SOLUONG) - isnull(sum(A.SOLUONG),0) - isnull(sum(B.SOLUONG),0)) SOLUONG, pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        from (select sum(soluong) soluong,duoc_id,nguonduoc_id,khoduoc_id,benhvien_id from TT_DUOC_TONKHO  group by duoc_id,nguonduoc_id,khoduoc_id,benhvien_id) dtk        inner join TM_DUOC_PHAMVISD_MAPPING pvsd on dtk.KHODUOC_ID = pvsd.KHODUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NOITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) B on B.DUOC_ID = dtk.DUOC_ID and B.PHAMVI_ID = pvsd.PHAMVI_ID and B.NGUONHANG_ID = dtk.NGUONDUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NGOAITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) A on A.DUOC_ID = dtk.DUOC_ID and A.PHAMVI_ID = pvsd.PHAMVI_ID and A.NGUONHANG_ID = dtk.NGUONDUOC_ID        where dtk.BENHVIEN_ID = 'HLU01'        group by LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')), pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        ) tk on tk.DUOC_ID = d.DUOC_ID        left join TM_DUOC_PHAMVISUDUNG kd on kd.PHAMVI_ID = tk.PHAMVI_ID and kd.BENHVIEN_ID = 'HLU01'        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = tk.NGUONDUOC_ID and nh.BENHVIEN_ID = 'HLU01'        where d.BENHVIEN_ID = 'HLU01' and tk.PHAMVI_ID =  @param0         end]
2019-09-20 16:52:02,025 [1] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoVaBookingCOM23UpdateRedis_TheoPhamvi] Parameters: [@param0=[PHAMVI_ID,1028]]
2019-09-20 16:52:02,025 [1] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoVaBookingCOM23UpdateRedis_TheoPhamvi] Types: [@param0=[Int64, System.Int64]]
2019-09-20 16:52:02,248 [1] DEBUG - Statement Id: [DAO00013_GetTienSuBenh] PreparedStatement : [select TIENSUBENH, TIENSUDIUNG              from TT_BENHNHAN              where TT_BENHNHAN.BENHNHAN_ID  = '23423']
2019-09-20 16:52:02,279 [1] DEBUG - Statement Id: [DAO00095_GetTTDiUngThuoc] PreparedStatement : [select *              from TT_BENHNHAN_DIUNG_THUOC              where BENHNHAN_ID = '23423'              and BENHVIEN_ID = 'HLU01']
2019-09-20 16:52:02,315 [1] DEBUG - Statement Id: [DAO00014_GetTotalChiPhiDVByTiepNhan] PreparedStatement : [select sum(THANHTIEN_DOANHTHU) as THANHTIEN_DOANHTHU from TT_VIENPHI        where ACTIVE = '1'        and TIEPNHAN_ID = '27478'        and REF_TABLE = 'TT_DVYEUCAU'        and exists (select DVYEUCAU_ID from TT_DVYEUCAU where HUYYEUCAU = '0' and TIEPNHAN_ID = '27478' and TT_VIENPHI.REF_ID = DVYEUCAU_ID)]
2019-09-20 16:52:02,351 [1] DEBUG - Statement Id: [DAO00014_GetKhamBenhInfo] PreparedStatement : [select * from TT_NGOAITRU_KHAMBENH where KHAMBENH_ID =        (select KHAMBENH_NGOAITRU_ID from TT_DVYEUCAU where DVYEUCAU_ID = '205443')]
2019-09-20 16:52:02,400 [1] DEBUG - Statement Id: [DAO00068_GetSinhHieuBySinhHieuID] PreparedStatement : [select top (1) *            from TT_NGOAITRU_KHAMBENH_SINHHIEU            where KHAMBENH_SINHHIEU_ID = '0'            and BENHVIEN_ID = 'HLU01'             and               BENHNHAN_ID = '23423'                           order by KHAMBENH_SINHHIEU_ID]
2019-09-20 16:52:02,521 [1] DEBUG - Statement Id: [DAO00014_GetKhamBenhICDInfo] PreparedStatement : [select *        from TT_NGOAITRU_KHAMBENH_ICD        where KHAMBENH_ID  = '26173']
2019-09-20 16:52:02,554 [1] DEBUG - Statement Id: [DAO00014_GetListToaThuoc] PreparedStatement : [select A.*        from TT_NGOAITRU_KHAMBENH_TOATHUOC A        where A.KHAMBENH_ID = '26173']
2019-09-20 16:52:02,584 [1] DEBUG - Statement Id: [DAO00014_KiemTraDVYCCoBHYT] PreparedStatement : [select *        from TT_VIENPHI        where REF_ID  = '205443' and REF_TABLE = 'TT_DVYEUCAU' and BHYT_DONGIA > 0]
2019-09-20 16:52:02,624 [1] DEBUG - Statement Id: [DAO00040_LayListToaMau] PreparedStatement : [select A.*, dc.TENDUOCDAYDU, dc.BHYT DUOC_BHYT, ld.LOAIVATTU_ID, ld.MALOAIDUOC, dd.DICTIONARY_NAME DUONGDUNG, dc.TAMNGUNG            from TT_TOATHUOCMAU A            left join TM_DUOC dc on A.DUOC_ID = dc.DUOC_ID            left join TM_LOAIDUOC ld on dc.LOAIDUOC_ID = ld.LOAIDUOC_ID            left join (select * from LST_DICTIONARY where DICTIONARY_TYPE_CODE like 'DuongDung') dd on dd.DICTIONARY_ID = dc.DUONGDUNG_ID            where (1=1)             and               A.BACSI_ID  = 1              and A.LOAITOATHUOC in  (                        @param0                   ,                           @param1                   ,                           @param2                   ,                           @param3                   )]
2019-09-20 16:52:02,624 [1] DEBUG - Statement Id: [DAO00040_LayListToaMau] Parameters: [@param0=[LSTLOAITOATHUOC[0],BV], @param1=[LSTLOAITOATHUOC[1],MN], @param2=[LSTLOAITOATHUOC[2],MP], @param3=[LSTLOAITOATHUOC[3],TV]]
2019-09-20 16:52:02,624 [1] DEBUG - Statement Id: [DAO00040_LayListToaMau] Types: [@param0=[String, System.String], @param1=[String, System.String], @param2=[String, System.String], @param3=[String, System.String]]
2019-09-20 16:52:02,718 [1] DEBUG - Statement Id: [DAO00040_LayListToaMau] PreparedStatement : [select A.*, dc.TENDUOCDAYDU, dc.BHYT DUOC_BHYT, ld.LOAIVATTU_ID, ld.MALOAIDUOC, dd.DICTIONARY_NAME DUONGDUNG, dc.TAMNGUNG            from TT_TOATHUOCMAU A            left join TM_DUOC dc on A.DUOC_ID = dc.DUOC_ID            left join TM_LOAIDUOC ld on dc.LOAIDUOC_ID = ld.LOAIDUOC_ID            left join (select * from LST_DICTIONARY where DICTIONARY_TYPE_CODE like 'DuongDung') dd on dd.DICTIONARY_ID = dc.DUONGDUNG_ID            where (1=1)             and               A.BACSI_ID  = 1              and A.LOAITOATHUOC in  (                        @param0                   ,                           @param1                   ,                           @param2                   ,                           @param3                   )]
2019-09-20 16:52:02,718 [1] DEBUG - Statement Id: [DAO00040_LayListToaMau] Parameters: [@param0=[LSTLOAITOATHUOC[0],BV], @param1=[LSTLOAITOATHUOC[1],MN], @param2=[LSTLOAITOATHUOC[2],MP], @param3=[LSTLOAITOATHUOC[3],TV]]
2019-09-20 16:52:02,718 [1] DEBUG - Statement Id: [DAO00040_LayListToaMau] Types: [@param0=[String, System.String], @param1=[String, System.String], @param2=[String, System.String], @param3=[String, System.String]]
2019-09-20 16:52:02,759 [1] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoVaBookingCOM23UpdateRedis_TheoPhamvi] PreparedStatement : [declare @TOAMUANGOAI int = 0;        select @TOAMUANGOAI = isnull(VALUE,0) from TM_SYS_APPSETTINGS where CODE = 'OPD_TOAMUANGOAI_DUNGDANHMUC_DUOC'                if @TOAMUANGOAI = 1        begin        select  distinct '0' + '_' + LTRIM(d.DUOC_ID) + '_' + '0' as DUOC_KEY, 999999999 as SOLUONG        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        where  @param0  = 0        union all        select distinct tk.DUOC_KEY, tk.SOLUONG        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        inner join        (        select  LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')) DUOC_KEY, (SUM(dtk.SOLUONG) - isnull(sum(A.SOLUONG),0) - isnull(sum(B.SOLUONG),0)) SOLUONG, pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        from (select sum(soluong) soluong,duoc_id,nguonduoc_id,khoduoc_id,benhvien_id from TT_DUOC_TONKHO  group by duoc_id,nguonduoc_id,khoduoc_id,benhvien_id) dtk        inner join TM_DUOC_PHAMVISD_MAPPING pvsd on dtk.KHODUOC_ID = pvsd.KHODUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NOITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) B on B.DUOC_ID = dtk.DUOC_ID and B.PHAMVI_ID = pvsd.PHAMVI_ID and B.NGUONHANG_ID = dtk.NGUONDUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NGOAITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) A on A.DUOC_ID = dtk.DUOC_ID and A.PHAMVI_ID = pvsd.PHAMVI_ID and A.NGUONHANG_ID = dtk.NGUONDUOC_ID        where dtk.BENHVIEN_ID = 'HLU01'        group by LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')), pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        ) tk on tk.DUOC_ID = d.DUOC_ID        left join TM_DUOC_PHAMVISUDUNG kd on kd.PHAMVI_ID = tk.PHAMVI_ID and kd.BENHVIEN_ID = 'HLU01'        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = tk.NGUONDUOC_ID and nh.BENHVIEN_ID = 'HLU01'        where d.BENHVIEN_ID = 'HLU01' and tk.PHAMVI_ID =  @param0         end        else        begin        select distinct tk.DUOC_KEY, tk.SOLUONG        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        inner join        (        select  LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')) DUOC_KEY, (SUM(dtk.SOLUONG) - isnull(sum(A.SOLUONG),0) - isnull(sum(B.SOLUONG),0)) SOLUONG, pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        from (select sum(soluong) soluong,duoc_id,nguonduoc_id,khoduoc_id,benhvien_id from TT_DUOC_TONKHO  group by duoc_id,nguonduoc_id,khoduoc_id,benhvien_id) dtk        inner join TM_DUOC_PHAMVISD_MAPPING pvsd on dtk.KHODUOC_ID = pvsd.KHODUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NOITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) B on B.DUOC_ID = dtk.DUOC_ID and B.PHAMVI_ID = pvsd.PHAMVI_ID and B.NGUONHANG_ID = dtk.NGUONDUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NGOAITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) A on A.DUOC_ID = dtk.DUOC_ID and A.PHAMVI_ID = pvsd.PHAMVI_ID and A.NGUONHANG_ID = dtk.NGUONDUOC_ID        where dtk.BENHVIEN_ID = 'HLU01'        group by LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')), pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        ) tk on tk.DUOC_ID = d.DUOC_ID        left join TM_DUOC_PHAMVISUDUNG kd on kd.PHAMVI_ID = tk.PHAMVI_ID and kd.BENHVIEN_ID = 'HLU01'        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = tk.NGUONDUOC_ID and nh.BENHVIEN_ID = 'HLU01'        where d.BENHVIEN_ID = 'HLU01' and tk.PHAMVI_ID =  @param0         end]
2019-09-20 16:52:02,759 [1] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoVaBookingCOM23UpdateRedis_TheoPhamvi] Parameters: [@param0=[PHAMVI_ID,1028]]
2019-09-20 16:52:02,759 [1] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoVaBookingCOM23UpdateRedis_TheoPhamvi] Types: [@param0=[Int64, System.Int64]]
2019-09-20 16:52:02,989 [1] DEBUG - Statement Id: [DAO00068_GetLastedSinhHieuInfo] PreparedStatement : [select top (1) *, CHISOBMI as BMI              from TT_NGOAITRU_KHAMBENH_SINHHIEU              where BENHNHAN_ID = '23423'              order by KHAMBENH_SINHHIEU_ID desc]
2019-09-20 16:52:03,098 [1] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoVaBookingCOM23UpdateRedis_TheoPhamvi] PreparedStatement : [declare @TOAMUANGOAI int = 0;        select @TOAMUANGOAI = isnull(VALUE,0) from TM_SYS_APPSETTINGS where CODE = 'OPD_TOAMUANGOAI_DUNGDANHMUC_DUOC'                if @TOAMUANGOAI = 1        begin        select  distinct '0' + '_' + LTRIM(d.DUOC_ID) + '_' + '0' as DUOC_KEY, 999999999 as SOLUONG        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        where  @param0  = 0        union all        select distinct tk.DUOC_KEY, tk.SOLUONG        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        inner join        (        select  LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')) DUOC_KEY, (SUM(dtk.SOLUONG) - isnull(sum(A.SOLUONG),0) - isnull(sum(B.SOLUONG),0)) SOLUONG, pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        from (select sum(soluong) soluong,duoc_id,nguonduoc_id,khoduoc_id,benhvien_id from TT_DUOC_TONKHO  group by duoc_id,nguonduoc_id,khoduoc_id,benhvien_id) dtk        inner join TM_DUOC_PHAMVISD_MAPPING pvsd on dtk.KHODUOC_ID = pvsd.KHODUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NOITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) B on B.DUOC_ID = dtk.DUOC_ID and B.PHAMVI_ID = pvsd.PHAMVI_ID and B.NGUONHANG_ID = dtk.NGUONDUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NGOAITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) A on A.DUOC_ID = dtk.DUOC_ID and A.PHAMVI_ID = pvsd.PHAMVI_ID and A.NGUONHANG_ID = dtk.NGUONDUOC_ID        where dtk.BENHVIEN_ID = 'HLU01'        group by LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')), pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        ) tk on tk.DUOC_ID = d.DUOC_ID        left join TM_DUOC_PHAMVISUDUNG kd on kd.PHAMVI_ID = tk.PHAMVI_ID and kd.BENHVIEN_ID = 'HLU01'        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = tk.NGUONDUOC_ID and nh.BENHVIEN_ID = 'HLU01'        where d.BENHVIEN_ID = 'HLU01' and tk.PHAMVI_ID =  @param0         end        else        begin        select distinct tk.DUOC_KEY, tk.SOLUONG        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        inner join        (        select  LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')) DUOC_KEY, (SUM(dtk.SOLUONG) - isnull(sum(A.SOLUONG),0) - isnull(sum(B.SOLUONG),0)) SOLUONG, pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        from (select sum(soluong) soluong,duoc_id,nguonduoc_id,khoduoc_id,benhvien_id from TT_DUOC_TONKHO  group by duoc_id,nguonduoc_id,khoduoc_id,benhvien_id) dtk        inner join TM_DUOC_PHAMVISD_MAPPING pvsd on dtk.KHODUOC_ID = pvsd.KHODUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NOITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) B on B.DUOC_ID = dtk.DUOC_ID and B.PHAMVI_ID = pvsd.PHAMVI_ID and B.NGUONHANG_ID = dtk.NGUONDUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NGOAITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) A on A.DUOC_ID = dtk.DUOC_ID and A.PHAMVI_ID = pvsd.PHAMVI_ID and A.NGUONHANG_ID = dtk.NGUONDUOC_ID        where dtk.BENHVIEN_ID = 'HLU01'        group by LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')), pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        ) tk on tk.DUOC_ID = d.DUOC_ID        left join TM_DUOC_PHAMVISUDUNG kd on kd.PHAMVI_ID = tk.PHAMVI_ID and kd.BENHVIEN_ID = 'HLU01'        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = tk.NGUONDUOC_ID and nh.BENHVIEN_ID = 'HLU01'        where d.BENHVIEN_ID = 'HLU01' and tk.PHAMVI_ID =  @param0         end]
2019-09-20 16:52:03,098 [1] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoVaBookingCOM23UpdateRedis_TheoPhamvi] Parameters: [@param0=[PHAMVI_ID,1028]]
2019-09-20 16:52:03,098 [1] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoVaBookingCOM23UpdateRedis_TheoPhamvi] Types: [@param0=[Int64, System.Int64]]
2019-09-20 16:52:12,544 [1] DEBUG - Statement Id: [DAO00017_GetLoaiGiaByDoiTuongId] PreparedStatement : [select dtlg.DOUUTIEN, dtlg.DOITUONG_ID, lg.LOAIGIA_ID, lg.TENLOAIGIA, lg.MALOAIGIA              from TM_LOAIGIA lg              left join TM_DOITUONG_LOAIGIA dtlg              on lg.LOAIGIA_ID = dtlg.LOAIGIA_ID and dtlg.BENHVIEN_ID = 'HLU01'              where lg.TAMNGUNG = 0 and lg.BENHVIEN_ID = 'HLU01'                             order by dtlg.DOUUTIEN]
2019-09-20 16:52:12,621 [1] DEBUG - Statement Id: [DAO00017_GetLoaiGiaByDoiTuongId] PreparedStatement : [select dtlg.DOUUTIEN, dtlg.DOITUONG_ID, lg.LOAIGIA_ID, lg.TENLOAIGIA, lg.MALOAIGIA              from TM_LOAIGIA lg              left join TM_DOITUONG_LOAIGIA dtlg              on lg.LOAIGIA_ID = dtlg.LOAIGIA_ID and dtlg.BENHVIEN_ID = 'HLU01'              where lg.TAMNGUNG = 0 and lg.BENHVIEN_ID = 'HLU01'                             order by dtlg.DOUUTIEN]
2019-09-20 16:52:12,678 [1] DEBUG - Statement Id: [DAO00030_GetPhamViByKhoDuoc] PreparedStatement : [SELECT DISTINCT pv.PHAMVI_ID          FROM TM_DUOC_PHAMVISD_MAPPING mp          INNER JOIN TM_DUOC_PHAMVISUDUNG pv ON mp.PHAMVI_ID = pv.PHAMVI_ID          WHERE          mp.KHODUOC_ID IN (32)          AND mp.BENHVIEN_ID ='HLU01'          AND mp.TAMNGUNG = '0'          AND pv.TAMNGUNG = '0']
2019-09-20 16:52:15,720 [1] DEBUG - Statement Id: [DAO00009_TT_TIEPNHAN_GetProcess] PreparedStatement : [select PROCESS_ID from TT_TIEPNHAN where SOTIEPNHAN = 'TN190920.0000001']
2019-09-20 16:52:15,814 [1] DEBUG - Statement Id: [DAOWF004_laytrangthaiDV] PreparedStatement : [select top 1 A.CURR_STATE_CODE as STATE_CODE, isNull(C.SHORT_NAME,C.NAME) as TRANGTHAI, C.NAME as TRANGTHAI_CHITIET, C.STATUS_CODE, D.ISACTIVE as ACTIVE, E.STATUS_CODE  as OLD_STATUSCODE        from TT_REQUEST_SERVICE_DETAIL A                left join (select * from TT_REQUEST_SERVICE where PARA = '{"DICHVU_ID":"5492","DVYEUCAU_ID":"205443"}') D on D.ID = A.REQUEST_SERVICE_ID        left join TM_STATE C on A.CURR_STATE_CODE = C.STATE_CODE and C.PROCESS_CODE = D.PROCESS_CODE        left join TM_STATE E on A.OLD_STATE_CODE = E.STATE_CODE and E.PROCESS_CODE = D.PROCESS_CODE        where        A.REQUEST_SERVICE_ID = (select top 1 ID from TT_REQUEST_SERVICE where PARA = '{"DICHVU_ID":"5492","DVYEUCAU_ID":"205443"}' order by ID desc)        order by A.ID desc]
2019-09-20 16:52:15,883 [1] DEBUG - Statement Id: [DAO00000_GetDoiTuongIsBHYT] PreparedStatement : [select * from TM_DOITUONG Where DOITUONG_ID = 4 and MADOITUONG like '%BHYT%']
2019-09-20 16:52:15,995 [1] DEBUG - Statement Id: [DAO00030_GetPhamViByKhoDuoc] PreparedStatement : [SELECT DISTINCT pv.PHAMVI_ID          FROM TM_DUOC_PHAMVISD_MAPPING mp          INNER JOIN TM_DUOC_PHAMVISUDUNG pv ON mp.PHAMVI_ID = pv.PHAMVI_ID          WHERE          mp.KHODUOC_ID IN (32)          AND mp.BENHVIEN_ID ='HLU01'          AND mp.TAMNGUNG = '0'          AND pv.TAMNGUNG = '0']
2019-09-20 16:52:18,895 [1] DEBUG - Statement Id: [DAO00020_GetDSDichVuYC] PreparedStatement : [select dvyc.*,        dv.TENDICHVU, dv.MADICHVU, dv.NORESULT, ndv.MANHOMDICHVU, ndv.TENNHOMDICHVU, vp.KHONGTHUTIEN        from TT_DVYEUCAU dvyc        left join TM_DICHVU dv on dvyc.DICHVU_ID = dv.DICHVU_ID        left join TM_NHOMDICHVU ndv on ndv.NHOMDICHVU_ID = dv.NHOMDICHVU_ID        left join (select * from TT_VIENPHI where TIEPNHAN_ID = '27478') vp on dvyc.DVYEUCAU_ID = vp.REF_ID                 where        dvyc.TIEPNHAN_ID = 27478        and REF_TABLE = 'TT_DVYEUCAU'                 order by DVYEUCAU_ID desc]
2019-09-20 16:52:18,977 [1] DEBUG - Statement Id: [DAO00020_GetTTDVYeuCauByID] PreparedStatement : [select *        from TT_DVYEUCAU        where TT_DVYEUCAU.DVYEUCAU_ID  = 205443        order by DVYEUCAU_ID]
2019-09-20 16:52:19,071 [1] DEBUG - Statement Id: [DAO00083_GetList_PhieuGhiNhanVTYT] PreparedStatement : [select DICHVU_GHINHANVTYT_ID, SOPHIEU, KHAMBENH_ID, TIEPNHAN_ID, DVYEUCAU_ID        from TT_DICHVU_GHINHANVTYT        where TIEPNHAN_ID = '27478'        and BENHVIEN_ID = 'HLU01'         and           KHAMBENH_ID = '26173'         and           DVYEUCAU_ID = '205443'                 order by THOIGIANGHINHAN desc]
2019-09-20 16:52:19,115 [1] DEBUG - Statement Id: [DAO00014_GetTrangThaiTiepNhan] PreparedStatement : [select tn.TIEPNHAN_ID, tn.KHOADULIEU, xncp.XACNHANCHIPHI_ID from TT_TIEPNHAN tn        left join TT_XACNHANCHIPHI xncp        on tn.TIEPNHAN_ID = xncp.TIEPNHAN_ID        where tn.TIEPNHAN_ID = '27478'        and tn.BENHVIEN_ID = 'HLU01']
2019-09-20 16:52:19,158 [1] DEBUG - Statement Id: [DAO00014_GetPatientStatus] PreparedStatement : [select        CASE        when tn.TRANGTHAI = 'HOANTHANH' Then tn.TRANGTHAI        WHEN xncp.XACNHANCHIPHI_ID is not null THEN 'XACNHANCHIPHI'        WHEN (tn.KHOADULIEU = '1') THEN 'KHOADULIEU'        ELSE tn.TRANGTHAI        END        as TRANGTHAI        from TT_TIEPNHAN tn        left join TT_XACNHANCHIPHI xncp on tn.TIEPNHAN_ID = xncp.TIEPNHAN_ID        where tn.TIEPNHAN_ID = '27478'        and tn.BENHVIEN_ID = 'HLU01']
2019-09-20 16:52:30,904 [1] DEBUG - Statement Id: [DAO00014_GetPatientStatus] PreparedStatement : [select        CASE        when tn.TRANGTHAI = 'HOANTHANH' Then tn.TRANGTHAI        WHEN xncp.XACNHANCHIPHI_ID is not null THEN 'XACNHANCHIPHI'        WHEN (tn.KHOADULIEU = '1') THEN 'KHOADULIEU'        ELSE tn.TRANGTHAI        END        as TRANGTHAI        from TT_TIEPNHAN tn        left join TT_XACNHANCHIPHI xncp on tn.TIEPNHAN_ID = xncp.TIEPNHAN_ID        where tn.TIEPNHAN_ID = '27478'        and tn.BENHVIEN_ID = 'HLU01']
2019-09-20 16:52:31,000 [1] DEBUG - Statement Id: [DAO00014_GetTrangThaiTiepNhan] PreparedStatement : [select tn.TIEPNHAN_ID, tn.KHOADULIEU, xncp.XACNHANCHIPHI_ID from TT_TIEPNHAN tn        left join TT_XACNHANCHIPHI xncp        on tn.TIEPNHAN_ID = xncp.TIEPNHAN_ID        where tn.TIEPNHAN_ID = '27478'        and tn.BENHVIEN_ID = 'HLU01']
2019-09-20 16:52:31,127 [1] DEBUG - Statement Id: [DAO00063_KiemtraSoluongDuocXuatNgoaitru] PreparedStatement : [select A.TONKHO, isnull(B.BOOK_NGOAI,0) BOOK_NGOAI, isnull(D.BOOK_NOI,0) BOOK_NOI,  (A.TONKHO - isnull(B.BOOK_NGOAI,0) - isnull(D.BOOK_NOI,0)) TONKHO_BOOK        from(        select SUM(tk.SOLUONG) TONKHO, tk.DUOC_ID, sd.PHAMVI_ID, tk.NGUONDUOC_ID from TT_DUOC_TONKHO tk        inner join TM_DUOC_PHAMVISD_MAPPING sd on sd.KHODUOC_ID = tk.KHODUOC_ID        where sd.PHAMVI_ID  = '1055' and tk.DUOC_ID = '1' and tk.NGUONDUOC_ID = '1'        group by tk.DUOC_ID, sd.PHAMVI_ID, tk.NGUONDUOC_ID) A        left join (        select SUM(SOLUONG) BOOK_NGOAI,DUOC_ID, PHAMVI_ID, NGUONHANG_ID from TT_DUOC_TONKHO_BOOK_NGOAITRU        where PHAMVI_ID  = '1055' and DUOC_ID = '1' and NGUONHANG_ID = '1' and TRANGTHAI = 'HIEULUC' and SOLUONG > 0        group by DUOC_ID, PHAMVI_ID, NGUONHANG_ID) B on A.DUOC_ID = B.DUOC_ID and A.PHAMVI_ID = B.PHAMVI_ID and A.NGUONDUOC_ID = B.NGUONHANG_ID        left join (        select SUM(SOLUONG) BOOK_NOI,DUOC_ID, PHAMVI_ID, NGUONHANG_ID from TT_DUOC_TONKHO_BOOK_NOITRU        where PHAMVI_ID  = '1055' and DUOC_ID = '1' and NGUONHANG_ID = '1' and TRANGTHAI = 'HIEULUC'  and SOLUONG > 0        group by DUOC_ID, PHAMVI_ID, NGUONHANG_ID) D on A.DUOC_ID = D.DUOC_ID and A.PHAMVI_ID = D.PHAMVI_ID and A.NGUONDUOC_ID = D.NGUONHANG_ID]
2019-09-20 16:52:35,156 [1] DEBUG - Statement Id: [DAO00014_KiemTraDVYCCoBHYT] PreparedStatement : [select *        from TT_VIENPHI        where REF_ID  = '205443' and REF_TABLE = 'TT_DVYEUCAU' and BHYT_DONGIA > 0]
2019-09-20 16:52:35,192 [1] DEBUG - Statement Id: [DAO00000_GetCHECK_DOITUONG_BHYT] PreparedStatement : [select count(*) as DOITUONG_BHYT FROM TM_DOITUONG A            WHERE A.DOITUONG_ID = '4' and A.BENHVIEN_ID = 'HLU01' and MADOITUONG like '%BHYT%']
2019-09-20 16:52:35,449 [1] DEBUG - Statement Id: [DAO00000_GetLOAIGIATHUOC_NOI_NGOAI_VIEN] PreparedStatement : [SELECT LOAIGIA_ID              FROM TM_LOAIGIA              WHERE MALOAIGIA = 'GiaThuoc_NoiVien' and BENHVIEN_ID = 'HLU01']
2019-09-20 16:52:35,489 [1] DEBUG - Statement Id: [DAO00000_GetDUOC_DONGIADOANHTHU_NOIVIEN] PreparedStatement : [declare @doanhthu numeric(24,2);          declare @hotro numeric(24,2);          declare @bhyt char(1);          select top 1 @doanhthu = dg.DONGIA           from TM_DUOC_DONGIA dg          left join TM_DOITUONG_LOAIGIA dtlg on dtlg.LOAIGIA_ID = dg.LOAIGIA_ID                     where dg.DUOC_ID = '1' and dtlg.DOITUONG_ID = '4' and dg.DONGIA is not null and dg.DONGIA > 0           order by dtlg.DOUUTIEN asc          select top 1 @hotro = dg.DONGIA          from TM_DUOC_DONGIA dg          left join TM_DOITUONG_LOAIGIA dtlg on dtlg.LOAIGIA_ID = dg.LOAIGIA_ID          where dg.DUOC_ID = '1' and dtlg.DOITUONG_ID = '4' and dg.DONGIA is not null and dg.DONGIA > 0  and GIAHOTRO = '1'          order by dtlg.DOUUTIEN asc          select top 1 @bhyt = BHYT from TM_DUOC where DUOC_ID = 1          select ISNULL(@doanhthu,0.0) DONGIA_DOANHTHU, ISNULL(@hotro, 0.0) DONGIA_KHAC, isnull(@bhyt, '0') BHYT]
2019-09-20 16:52:35,771 [1] DEBUG - Statement Id: [DAO00000_GetDuocBHYT] PreparedStatement : [select count(*) BHYT FROM TM_DUOC A WHERE A.DUOC_ID = '1' and BHYT = '1']
2019-09-20 16:52:39,866 [1] DEBUG - Statement Id: [DAO00023_GetSOBHYT_HUONG_ID] PreparedStatement : [select isnull(MAX(SOBHYT_HUONG_ID),0) SOBHYT_HUONG_ID        from TT_TIEPNHAN_SOTHEBHYT        where TIEPNHAN_ID = '27478']
2019-09-20 16:52:40,172 [1] DEBUG - Statement Id: [DAO00062_GetKhoThuocCosoKhongCoso] PreparedStatement : [select distinct kd.KHODUOC_ID, lst.DICTIONARY_CODE  LOAIKHO from TM_KHODUOC kd        left join TM_PHONGBAN_KHODUOC pbkd        on kd.KHODUOC_ID = pbkd.KHODUOC_ID        and kd.BENHVIEN_ID = pbkd.BENHVIEN_ID        left join LST_DICTIONARY lst on lst.DICTIONARY_ID = kd.LOAIKHO_ID        where lst.DICTIONARY_CODE = 'Coso']
2019-09-20 16:52:40,201 [1] DEBUG - Statement Id: [DAO00062_GetAllPhamviKhoDuoc] PreparedStatement : [select distinct dmap.*        from TM_DUOC_PHAMVISD_MAPPING dmap        left join TM_DUOC_PHAMVISUDUNG dpv on dpv.PHAMVI_ID = dmap.PHAMVI_ID]
2019-09-20 16:52:40,248 [1] DEBUG - Statement Id: [DAO00026_GEN_EXAM_KEY] PreparedStatement : [select max(KEYVALUE) KEYVALUE              from LST_KEYDATA_TOATHUOC               where                             LST_KEYDATA_TOATHUOC.KEYTYPE = 'SOPHIEUGHINHANVTYT'                       and                           LST_KEYDATA_TOATHUOC.KEYYEAR = '2019'                       and                           LST_KEYDATA_TOATHUOC.KEYMONTH = '9'                       and                           LST_KEYDATA_TOATHUOC.KEYDAY = '20']
2019-09-20 16:52:40,705 [1] DEBUG - Statement Id: [DAO00026_Add] PreparedStatement : [IF EXISTS (select KEYTYPE from LST_KEYDATA_TOATHUOC where KEYTYPE = 'SOPHIEUGHINHANVTYT' AND KEYYEAR = '2019' AND KEYMONTH = '9' AND KEYDAY = '20')            BEGIN            update LST_KEYDATA_TOATHUOC set            KEYVALUE =  @param0             where            KEYTYPE = 'SOPHIEUGHINHANVTYT'            AND KEYYEAR = '2019'            AND KEYMONTH = '9'            AND KEYDAY = '20'            AND SEGMENT_1 = '0'            AND SEGMENT_2 = '0'            AND SEGMENT_3 = '0'            END            ELSE            BEGIN            insert into LST_KEYDATA_TOATHUOC (            KEYTYPE            , KEYYEAR            , KEYMONTH            , KEYDAY            , SEGMENT_1            , SEGMENT_2            , SEGMENT_3            , KEYVALUE            , BENHVIEN_ID            ) values (             @param1             ,  @param2             ,  @param3             ,  @param4             ,  @param5             ,  @param6             ,  @param7             ,  @param0             ,  @param8             )            END]
2019-09-20 16:52:40,706 [1] DEBUG - Statement Id: [DAO00026_Add] Parameters: [@param0=[KEYVALUE,0001], @param1=[KEYTYPE,SOPHIEUGHINHANVTYT], @param2=[KEYYEAR,2019], @param3=[KEYMONTH,9], @param4=[KEYDAY,20], @param5=[SEGMENT_1,0], @param6=[SEGMENT_2,0], @param7=[SEGMENT_3,0], @param8=[BENHVIEN_ID,HLU01]]
2019-09-20 16:52:40,706 [1] DEBUG - Statement Id: [DAO00026_Add] Types: [@param0=[String, System.String], @param1=[String, System.String], @param2=[Int32, System.Int32], @param3=[Int32, System.Int32], @param4=[Int32, System.Int32], @param5=[String, System.String], @param6=[String, System.String], @param7=[String, System.String], @param8=[String, System.String]]
2019-09-20 16:52:40,756 [1] DEBUG - Statement Id: [DAO00083_Add_PhieuGhiNhanVTYT] PreparedStatement : [insert into TT_DICHVU_GHINHANVTYT (        SOPHIEU        , KHAMBENH_ID        , TIEPNHAN_ID        , DVYEUCAU_ID        , NGAYGHINHAN        , THOIGIANGHINHAN        , KHOXUAT_ID        , BENHVIEN_ID        , THOIGIANTAO        , NGUOITAO_ID        ) values (         @param0         ,  @param1         ,  @param2         ,  @param3         ,  @param4         ,  @param5         ,  @param6         ,  @param7         ,  @param8         ,  @param9         )        SELECT SCOPE_IDENTITY()]
2019-09-20 16:52:40,757 [1] DEBUG - Statement Id: [DAO00083_Add_PhieuGhiNhanVTYT] Parameters: [@param0=[SOPHIEU,1909200001], @param1=[KHAMBENH_ID,26173], @param2=[TIEPNHAN_ID,27478], @param3=[DVYEUCAU_ID,205443], @param4=[NGAYGHINHAN,9/20/2019 12:00:00 AM], @param5=[THOIGIANGHINHAN,9/20/2019 4:52:40 PM], @param6=[KHOXUAT_ID,32], @param7=[BENHVIEN_ID,HLU01], @param8=[THOIGIANTAO,9/20/2019 4:52:40 PM], @param9=[NGUOITAO_ID,1]]
2019-09-20 16:52:40,757 [1] DEBUG - Statement Id: [DAO00083_Add_PhieuGhiNhanVTYT] Types: [@param0=[String, System.String], @param1=[Int32, System.Int32], @param2=[Int64, System.Int64], @param3=[Int64, System.Int64], @param4=[DateTime, System.DateTime], @param5=[DateTime, System.DateTime], @param6=[String, System.String], @param7=[String, System.String], @param8=[DateTime, System.DateTime], @param9=[Int64, System.Int64]]
2019-09-20 16:52:44,832 [1] DEBUG - Statement Id: [DAO00083_Add] PreparedStatement : [insert into TT_NGOAITRU_KHAMBENH_VTYT (        KHAMBENH_ID        ,COSO        , DVYEUCAU_ID        , DUOC_ID        , SOLUONG        , CHUNGTU_ID        , GHICHU        , CHUNGTUTONGHOP_ID        , KHOSUDUNG_ID        , KHOTAO_ID        , TINHTIEN        , BHYTDONGTIEN        , TRANGTHAI        , NGAYSUDUNG        , THOIGIANSUDUNG        , NGUONHANG_ID         ,           PHONGBAN_ID                 , PHIEULINH_ID        , BENHVIEN_ID        , NGAYTAO        , NGUOITAO_ID        , NGAYCAPNHAT        , NGUOICAPNHAT_ID         ,           PHAMVI_ID         ,           KHOPHAT_ID         ,           DICHVU_GHINHANVTYT_ID                 ) values (         @param0         , @param1         ,  @param2         ,  @param3         ,  @param4         ,  @param5         ,  @param6         ,  @param7         ,  @param8         ,  @param9         ,  @param10         ,  @param11         ,  @param12         ,  @param13         ,  @param14         ,  @param15          ,            @param16                  ,  @param17         ,  @param18         ,  @param19         ,  @param20         ,  @param21         ,  @param22          ,            @param23          ,            @param24          ,            @param25                  )        SELECT SCOPE_IDENTITY()]
2019-09-20 16:52:44,833 [1] DEBUG - Statement Id: [DAO00083_Add] Parameters: [@param0=[REF_ID,26173], @param1=[COSO,1], @param2=[DVYEUCAU_ID,205443], @param3=[DUOC_ID,1], @param4=[SOLUONG,2], @param5=[CHUNGTU_ID,null], @param6=[GHICHU,tét], @param7=[CHUNGTUTONGHOP_ID,null], @param8=[KHOSUDUNG_ID,32], @param9=[KHOTAO_ID,32], @param10=[TINHTIEN,1], @param11=[BHYTDONGTIEN,0], @param12=[TRANGTHAI,null], @param13=[NGAYSUDUNG,9/20/2019 12:00:00 AM], @param14=[THOIGIANSUDUNG,9/20/2019 4:52:44 PM], @param15=[NGUONHANG_ID,1], @param16=[PHONGBAN_ID,62], @param17=[PHIEULINH_ID,null], @param18=[BENHVIEN_ID,HLU01], @param19=[NGAYTAO,9/20/2019 4:52:44 PM], @param20=[NGUOITAO_ID,1], @param21=[NGAYCAPNHAT,9/20/2019 4:52:44 PM], @param22=[NGUOICAPNHAT_ID,1], @param23=[PHAMVI_ID,1055], @param24=[KHOPHAT_ID,32], @param25=[DICHVU_GHINHANVTYT_ID,4918]]
2019-09-20 16:52:44,833 [1] DEBUG - Statement Id: [DAO00083_Add] Types: [@param0=[Int64, System.Int64], @param1=[String, System.String], @param2=[Int64, System.Int64], @param3=[Int64, System.Int64], @param4=[Double, System.Double], @param5=[System.DBNull, null], @param6=[String, System.String], @param7=[System.DBNull, null], @param8=[Int64, System.Int64], @param9=[String, System.String], @param10=[String, System.String], @param11=[String, System.String], @param12=[System.DBNull, null], @param13=[DateTime, System.DateTime], @param14=[DateTime, System.DateTime], @param15=[Int64, System.Int64], @param16=[Int64, System.Int64], @param17=[System.DBNull, null], @param18=[String, System.String], @param19=[DateTime, System.DateTime], @param20=[Int64, System.Int64], @param21=[DateTime, System.DateTime], @param22=[Int64, System.Int64], @param23=[Int64, System.Int64], @param24=[Int32, System.Int32], @param25=[Int64, System.Int64]]
2019-09-20 16:52:45,757 [1] DEBUG - Statement Id: [DAO00016_CheckThuocUngThu] PreparedStatement : [SELECT count(*)        from TM_DOITUONG_GIADUOC_TYLE        WHERE DOITUONG_ID = '4'        AND DUOC_ID = '1'        AND BENHVIEN_ID = 'HLU01']
2019-09-20 16:52:45,930 [1] DEBUG - Statement Id: [DAO00083_GetBookingInfo] PreparedStatement : [select *        from TT_DUOC_TONKHO_BOOK_NGOAITRU        where                 DUOC_ID = '1'        and NGUONHANG_ID = '1'        and REF_ID = '10593'        and REF_TABLE = 'TT_NGOAITRU_KHAMBENH_VTYT'         and           KHODUOC_ID =  @param0          and           PHAMVI_ID =  @param1]
2019-09-20 16:52:45,930 [1] DEBUG - Statement Id: [DAO00083_GetBookingInfo] Parameters: [@param0=[KHODUOC_ID,32], @param1=[PHAMVI_ID,1055]]
2019-09-20 16:52:45,930 [1] DEBUG - Statement Id: [DAO00083_GetBookingInfo] Types: [@param0=[Int32, System.Int32], @param1=[Int64, System.Int64]]
2019-09-20 16:52:45,994 [1] DEBUG - Statement Id: [DAO00083_Add_Booking] PreparedStatement : [insert into TT_DUOC_TONKHO_BOOK_NGOAITRU (        REF_TABLE        , REF_ID        , KHODUOC_ID        , NGUONHANG_ID        , DUOC_ID        , BENHVIEN_ID        , SOLUONG        , NGAYHIEULUC        , NGUOITAO_ID        , NGAYTAO        , NGUOICAPNHAT_ID        , NGAYCAPNHAT         ,           PHAMVI_ID                 ) values (         @param0         ,  @param1         ,  @param2         ,  @param3         ,  @param4         ,  @param5         ,  @param6         ,  @param7         ,  @param8         ,  @param9         ,  @param10         ,  @param11          ,            @param12                  )]
2019-09-20 16:52:45,994 [1] DEBUG - Statement Id: [DAO00083_Add_Booking] Parameters: [@param0=[REF_TABLE,TT_NGOAITRU_KHAMBENH_VTYT], @param1=[VTYT_ID,10593], @param2=[KHODUOC_ID,32], @param3=[NGUONHANG_ID,1], @param4=[DUOC_ID,1], @param5=[BENHVIEN_ID,HLU01], @param6=[SOLUONG,2], @param7=[NGAYHIEULUC,null], @param8=[NGUOITAO_ID,1], @param9=[NGAYTAO,9/20/2019 4:52:45 PM], @param10=[NGUOICAPNHAT_ID,1], @param11=[NGAYCAPNHAT,9/20/2019 4:52:45 PM], @param12=[PHAMVI_ID,1055]]
2019-09-20 16:52:45,994 [1] DEBUG - Statement Id: [DAO00083_Add_Booking] Types: [@param0=[String, System.String], @param1=[Int64, System.Int64], @param2=[Int32, System.Int32], @param3=[Int64, System.Int64], @param4=[Int64, System.Int64], @param5=[String, System.String], @param6=[Double, System.Double], @param7=[System.DBNull, null], @param8=[Int64, System.Int64], @param9=[DateTime, System.DateTime], @param10=[Int64, System.Int64], @param11=[DateTime, System.DateTime], @param12=[Int64, System.Int64]]
2019-09-20 16:52:46,029 [1] DEBUG - Statement Id: [DAO00083_UpdateTTGhiNhanVTYT] PreparedStatement : [update TT_DVYEUCAU        set GHINHANVTYT = '1',        NGUOICAPNHAT_ID = '1',        NGAYCAPNHAT = '9/20/2019 4:52:46 PM'        where DVYEUCAU_ID  = '205443']
2019-09-20 16:52:46,067 [1] DEBUG - Statement Id: [DAO00064_GetTopTT_TIEPNHAN_SOTHEBHYT] PreparedStatement : [select top 1 stbhyt.*, ba.SOBENHAN,         tn.SOTIEPNHAN, tn.LOAITHANHVIEN_ID, tn.THE_ID, tn.THANHVIEN_ID,        tn.SUDUNG_BHTN, tn.BAOLANH_VIENPHI, tn.VIP, tn.NGUOINUOCNGOAI        from TT_TIEPNHAN_SOTHEBHYT stbhyt        left join TT_TIEPNHAN tn on tn.TIEPNHAN_ID = stbhyt.TIEPNHAN_ID        left join TT_NOITRU_BENHAN ba on ba.TIEPNHAN_ID = stbhyt.TIEPNHAN_ID        where         stbhyt.TIEPNHAN_ID = '27478' and isnull(stbhyt.KHONGSUDUNG, '0') = '0'              order by SOBHYT_HUONG_ID desc]
2019-09-20 16:52:46,100 [1] DEBUG - Statement Id: [DAO00006_GetListDuocTyle] PreparedStatement : [select DUOC_ID, DOITUONG_ID, (TYLE/100) as TYLE, DONGIA MUCTRAN_THANHTOAN from TM_DOITUONG_GIADUOC_TYLE            where            BENHVIEN_ID = 'HLU01'            and DOITUONG_ID = '4']
2019-09-20 16:52:46,129 [1] DEBUG - Statement Id: [DAO00027_GetListTuongTrinhDichVuPhauThuatCuaTiepNhan] PreparedStatement : [declare @ManhomDSA varchar(10);        declare @PhanLoaiNhomDV varchar(20) = '05';        select top 1  @ManhomDSA = VALUE from TM_SYS_APPSETTINGS where CODE = 'MANHOM_DICHVU_DSA'        if (@ManhomDSA is not null) set @PhanLoaiNhomDV += ',' + @ManhomDSA        select distinct ptyc.*        from TT_PHAUTHUAT_YEUCAU ptyc        inner join TM_DICHVU dv on dv.DICHVU_ID = ptyc.DICHVU_ID        inner join TM_NHOMDICHVU ndv on ndv.NHOMDICHVU_ID = dv.NHOMDICHVU_ID        inner join TT_PHAUTHUAT pt on pt.PHAUTHUAT_ID = ptyc.PHAUTHUAT_ID        where        pt.TIEPNHAN_ID = 27478        and (left(ndv.MANHOMDICHVU, 2) in (select * from STRING_SPLIT(@PhanLoaiNhomDV,',')) or ndv.MANHOMDICHVU in (select * from STRING_SPLIT(@PhanLoaiNhomDV,',')))]
2019-09-20 16:52:46,173 [1] DEBUG - Statement Id: [DAO00006_GetList] PreparedStatement : [select dv.*, loaiDV.MALOAIDICHVU, captren.NHOMDICHVU_ID as NHOMDICHVU_CAPTREN_ID, captren.TENNHOMDICHVU as NHOMDICHVU_CAPTREN,              nhom_dv.TENNHOMDICHVU as TENNHOMDICHVU, nhom_dv.MANHOMDICHVU,              case when dv.ATTRIBUTE5 is null then 'TT' else 'KTC' end as LOAI_CHIPHI              from TM_DICHVU as dv              left join TM_NHOMDICHVU as nhom_dv on nhom_dv.NHOMDICHVU_ID = dv.NHOMDICHVU_ID and nhom_dv.BENHVIEN_ID = 'HLU01'              left join TM_NHOMDICHVU as captren on nhom_dv.CAPTREN_ID = captren.NHOMDICHVU_ID and captren.BENHVIEN_ID = 'HLU01'              left join TM_LOAIDICHVU loaiDV on nhom_dv.LOAIDICHVU_ID = loaiDV.LOAIDICHVU_ID and loaiDV.BENHVIEN_ID = 'HLU01'              where nhom_dv.TAMNGUNG = '0' and dv.BENHVIEN_ID = 'HLU01'              and dv.TAMNGUNG = '0'               AND                   loaiDV.MALOAIDICHVU = 'KhamBenh']
2019-09-20 16:52:46,246 [1] DEBUG - Statement Id: [DAO00023_GetVienPhiByDichVuID] PreparedStatement : [select *        from TT_VIENPHI        where TIEPNHAN_ID  = '27478'        and DUOC_ID  = '1'        and REF_ID = '10593'        and REF_TABLE = 'TT_NGOAITRU_KHAMBENH_VTYT'        and DATHANHTOAN = '0']
2019-09-20 16:52:46,462 [1] DEBUG - Statement Id: [DAO00023_Add] PreparedStatement : [insert into TT_VIENPHI (        TIEPNHAN_ID        , BENHAN_ID         ,           BENHNHAN_ID         ,           DOTDIEUTRI_ID                 , KHAMBENH_ID        , REF_ID        , REF_TABLE        , DICHVU_ID        , DUOC_ID        , LOAI_CHIPHI        , LOAIGIA_ID        , SOLUONG        , DONGIA_DOANHTHU        , THANHTIEN_DOANHTHU        , BHYT_TL        , BHYT_DONGIA        , BHYT_THANHTIEN        , BHYT_DONGIA_CHITRA        , BHYT_THANHTIEN_CHITRA        , BENHNHAN_PHAITHANHTOAN        , GIATRI_HOADON        , GIATRI_HOADON_DATHANHTOAN        , GIATRI_BIENLAI        , GIATRI_BIENLAI_DATHANHTOAN        , GIATRI_BENHNHAN_DATHANHTOAN        , GIATRI_THATTHU        , MIENGIAM_TL        , MIENGIAM_GIATRI        , NGANSACH_TL        , NGANSACH_GIATRI        , TAITRO_TL        , TAITRO_GIATRI        , BHTN_TL        , BHTN_DONGIA        , BHTN_THANHTIEN        , BHTN_DONGIA_CHITRA        , BHTN_THANHTIEN_CHITRA         ,           DUOCPHEPTHUCHIEN         ,           HUY         ,           DATHANHTOAN         ,           DATHUCHIEN         ,           KHONGTHUTIEN         ,           BHYTDONGTIEN                 , DUYET        , HOADON_ID         ,           ACTIVE         ,           TYLE_VAT         ,           GIAVON         ,           BANGGIA_ID                 , BENHVIEN_ID        , NGUOITAO_ID        , NGAYTAO        , NGUOICAPNHAT_ID        , NGAYCAPNHAT        , DONGIA_BHYT_BANDAU        , DONGIADOANHTHU_BANDAU         ,           YEUCAUVP         ,           DOITUONG_HUONG_ID         ,           SOBHYT_HUONG_ID         ,           DICHVU_TL                 ) values (         @param0         ,  @param1          ,            @param2          ,            @param3                  ,  @param4         ,  @param5         ,  @param6         ,  @param7         ,  @param8         ,  @param9         ,  @param10         ,  @param11         ,  @param12         ,  @param13         ,  @param14         ,  @param15         ,  @param16         ,  @param17         ,  @param18         ,  @param19         ,  @param20         ,  @param21         ,  @param22         ,  @param23         ,  @param24         ,  @param25         ,  @param26         ,  @param27         ,  @param28         ,  @param29         ,  @param30         ,  @param31         ,  @param32         ,  @param33         ,  @param34         ,  @param35         ,  @param36          ,            @param37          ,            @param38          ,            @param39          ,            @param40          ,            @param41          ,            @param42                  ,  @param43         ,  @param44          ,            @param45          ,            @param46          ,            @param47          ,            @param48                  ,  @param49         ,  @param50         ,  @param51         ,  @param52         ,  @param53         ,  @param54         ,  @param55          ,            @param56          ,            @param57          ,            @param58          ,            @param59                  )        SELECT SCOPE_IDENTITY()]
2019-09-20 16:52:46,463 [1] DEBUG - Statement Id: [DAO00023_Add] Parameters: [@param0=[TIEPNHAN_ID,27478], @param1=[BENHAN_ID,null], @param2=[BENHNHAN_ID,23423], @param3=[DOTDIEUTRI_ID,0], @param4=[KHAMBENH_ID,null], @param5=[REF_ID,10593], @param6=[REF_TABLE,TT_NGOAITRU_KHAMBENH_VTYT], @param7=[DICHVU_ID,null], @param8=[DUOC_ID,1], @param9=[LOAI_CHIPHI,TT], @param10=[LOAIGIA_ID,null], @param11=[SOLUONG,2], @param12=[DONGIA_DOANHTHU,1030], @param13=[THANHTIEN_DOANHTHU,2060], @param14=[BHYT_TL,1], @param15=[BHYT_DONGIA,1030], @param16=[BHYT_THANHTIEN,2060], @param17=[BHYT_DONGIA_CHITRA,1030], @param18=[BHYT_THANHTIEN_CHITRA,2060], @param19=[BENHNHAN_PHAITHANHTOAN,0], @param20=[GIATRI_HOADON,0], @param21=[GIATRI_HOADON_DATHANHTOAN,0], @param22=[GIATRI_BIENLAI,0], @param23=[GIATRI_BIENLAI_DATHANHTOAN,0], @param24=[GIATRI_BENHNHAN_DATHANHTOAN,0], @param25=[GIATRI_THATTHU,0], @param26=[MIENGIAM_TL,0], @param27=[MIENGIAM_GIATRI,0], @param28=[NGANSACH_TL,0], @param29=[NGANSACH_GIATRI,0], @param30=[TAITRO_TL,0], @param31=[TAITRO_GIATRI,0], @param32=[BHTN_TL,0], @param33=[BHTN_DONGIA,0], @param34=[BHTN_THANHTIEN,0], @param35=[BHTN_DONGIA_CHITRA,0], @param36=[BHTN_THANHTIEN_CHITRA,0], @param37=[DUOCPHEPTHUCHIEN,0], @param38=[HUY,0], @param39=[DATHANHTOAN,0], @param40=[DATHUCHIEN,0], @param41=[KHONGTHUTIEN,0], @param42=[BHYTDONGTIEN,0], @param43=[DUYET,null], @param44=[HOADON_ID,null], @param45=[ACTIVE,1], @param46=[TYLE_VAT,null], @param47=[GIAVON,null], @param48=[BANGGIA_ID,null], @param49=[BENHVIEN_ID,HLU01], @param50=[NGUOITAO_ID,1], @param51=[NGAYTAO,9/20/2019 4:52:46 PM], @param52=[NGUOICAPNHAT_ID,1], @param53=[NGAYCAPNHAT,9/20/2019 4:52:46 PM], @param54=[DONGIA_BHYT_BANDAU,null], @param55=[DONGIADOANHTHU_BANDAU,null], @param56=[YEUCAUVP,False], @param57=[DOITUONG_HUONG_ID,4], @param58=[SOBHYT_HUONG_ID,28501], @param59=[DICHVU_TL,1]]
2019-09-20 16:52:46,463 [1] DEBUG - Statement Id: [DAO00023_Add] Types: [@param0=[Int32, System.Int32], @param1=[System.DBNull, null], @param2=[Int32, System.Int32], @param3=[Int32, System.Int32], @param4=[System.DBNull, null], @param5=[Int32, System.Int32], @param6=[String, System.String], @param7=[System.DBNull, null], @param8=[Int32, System.Int32], @param9=[String, System.String], @param10=[System.DBNull, null], @param11=[Decimal, System.Decimal], @param12=[Decimal, System.Decimal], @param13=[Decimal, System.Decimal], @param14=[Decimal, System.Decimal], @param15=[Decimal, System.Decimal], @param16=[Decimal, System.Decimal], @param17=[Decimal, System.Decimal], @param18=[Decimal, System.Decimal], @param19=[Decimal, System.Decimal], @param20=[Decimal, System.Decimal], @param21=[Decimal, System.Decimal], @param22=[Decimal, System.Decimal], @param23=[Decimal, System.Decimal], @param24=[Decimal, System.Decimal], @param25=[Decimal, System.Decimal], @param26=[Decimal, System.Decimal], @param27=[Decimal, System.Decimal], @param28=[Decimal, System.Decimal], @param29=[Decimal, System.Decimal], @param30=[Decimal, System.Decimal], @param31=[Decimal, System.Decimal], @param32=[Decimal, System.Decimal], @param33=[Decimal, System.Decimal], @param34=[Decimal, System.Decimal], @param35=[Decimal, System.Decimal], @param36=[Decimal, System.Decimal], @param37=[Int32, System.Int32], @param38=[Int32, System.Int32], @param39=[Int32, System.Int32], @param40=[Int32, System.Int32], @param41=[Int32, System.Int32], @param42=[String, System.String], @param43=[System.DBNull, null], @param44=[System.DBNull, null], @param45=[Int32, System.Int32], @param46=[System.DBNull, null], @param47=[System.DBNull, null], @param48=[System.DBNull, null], @param49=[String, System.String], @param50=[Int64, System.Int64], @param51=[DateTime, System.DateTime], @param52=[Int64, System.Int64], @param53=[DateTime, System.DateTime], @param54=[System.DBNull, null], @param55=[System.DBNull, null], @param56=[Boolean, System.Boolean], @param57=[Int64, System.Int64], @param58=[Int32, System.Int32], @param59=[Decimal, System.Decimal]]
2019-09-20 16:52:46,508 [1] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoVaBookingCOM23UpdateRedis] PreparedStatement : [declare @NGUONDUOC_MACDINH varchar(5) = '0';        declare @TOAMUANGOAI int = 0;        select @NGUONDUOC_MACDINH = isnull(VALUE,0) from TM_SYS_APPSETTINGS where CODE = 'PHA_NGUONDUOC'        select @TOAMUANGOAI = isnull(VALUE,0) from TM_SYS_APPSETTINGS where CODE = 'OPD_TOAMUANGOAI_DUNGDANHMUC_DUOC'                if @TOAMUANGOAI = 1        begin        select  distinct '0' + '_' + LTRIM(d.DUOC_ID) + '_' + @NGUONDUOC_MACDINH as DUOC_KEY, 0 as PHAMVI_ID, @NGUONDUOC_MACDINH as NGUONDUOC_ID, null as TENNGUONDUOC, null as TINHTIEN, d.DUOC_ID, ld.MALOAIDUOC,        d.SOVISA,d.TYLE_VAT,d.COTOA, d.MADUOC, d.TENHANG, d.TENDUOCDAYDU, dvt.TENDONVITINH as DONVITINH, d.BHYT,        d.TENHOATCHAT, d.HAMLUONG, d.HANGSANXUAT, d.QUOCGIA, d.LOAIDUOC_ID, d.DUONGDUNG_ID, d.TINHTIEN_PTTT,        ten.TENDUOC, ten.TENDUOC_EN, ten.MAQUOCTE, ten.MAQUOCTEBT,        '' as BHYT_TEXT        , ld.LOAIVATTU_ID        , d.BENHVIEN_ID,        999999999 as SOLUONG, d.VTYT_PHANLOAI, d.PHAMVI, d.SUASOLUONGTONGHOP, d.MADUOCBV, d.DANGTRINHBAY        , TAMNGUNG = CASE WHEN d.TAMNGUNG = '1' THEN '1' ELSE '0' END        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        where d.DUOC_ID in (1)        union all        select  distinct tk.DUOC_KEY, LTRIM(tk.PHAMVI_ID) as PHAMVI_ID, tk.NGUONDUOC_ID, nh.TENNGUONDUOC, nh.TINHTIEN, d.DUOC_ID, ld.MALOAIDUOC,        d.SOVISA,d.TYLE_VAT,d.COTOA, d.MADUOC, d.TENHANG, d.TENDUOCDAYDU, dvt.TENDONVITINH as DONVITINH, d.BHYT,        d.TENHOATCHAT, d.HAMLUONG, d.HANGSANXUAT, d.QUOCGIA, d.LOAIDUOC_ID, d.DUONGDUNG_ID, d.TINHTIEN_PTTT,        ten.TENDUOC, ten.TENDUOC_EN, ten.MAQUOCTE, ten.MAQUOCTEBT,        CASE WHEN d.BHYT = '1' THEN 'BHYT' ELSE '' END as BHYT_TEXT        , ld.LOAIVATTU_ID        , d.BENHVIEN_ID,        tk.SOLUONG, d.VTYT_PHANLOAI, d.PHAMVI, d.SUASOLUONGTONGHOP, d.MADUOCBV, d.DANGTRINHBAY        , TAMNGUNG = CASE WHEN d.TAMNGUNG = '1' OR nh.TAMNGUNG = '1' OR kd.TAMNGUNG = '1' THEN '1' ELSE '0' END        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        inner join        (        select  LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')) DUOC_KEY, (SUM(dtk.SOLUONG) - isnull(sum(A.SOLUONG),0) - isnull(sum(B.SOLUONG),0)) SOLUONG, pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        from (select sum(soluong) soluong,duoc_id,nguonduoc_id,khoduoc_id,benhvien_id from TT_DUOC_TONKHO  group by duoc_id,nguonduoc_id,khoduoc_id,benhvien_id) dtk        inner join TM_DUOC_PHAMVISD_MAPPING pvsd on dtk.KHODUOC_ID = pvsd.KHODUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NOITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) B on B.DUOC_ID = dtk.DUOC_ID and B.SOLUONG > 0 and B.PHAMVI_ID = pvsd.PHAMVI_ID and B.NGUONHANG_ID = dtk.NGUONDUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NGOAITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) A on A.DUOC_ID = dtk.DUOC_ID and A.SOLUONG > 0 and A.PHAMVI_ID = pvsd.PHAMVI_ID and A.NGUONHANG_ID = dtk.NGUONDUOC_ID        where dtk.SOLUONG > 0 and dtk.BENHVIEN_ID = 'HLU01'        group by LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')), pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        ) tk on tk.DUOC_ID = d.DUOC_ID        left join TM_DUOC_PHAMVISUDUNG kd on kd.PHAMVI_ID = tk.PHAMVI_ID and kd.BENHVIEN_ID = 'HLU01'        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = tk.NGUONDUOC_ID and nh.BENHVIEN_ID = 'HLU01'        where  d.BENHVIEN_ID = 'HLU01' and d.DUOC_ID in (1)        end        else        begin        select  distinct tk.DUOC_KEY, LTRIM(tk.PHAMVI_ID) as PHAMVI_ID, tk.NGUONDUOC_ID, nh.TENNGUONDUOC, nh.TINHTIEN, d.DUOC_ID, ld.MALOAIDUOC,        d.SOVISA,d.TYLE_VAT,d.COTOA, d.MADUOC, d.TENHANG, d.TENDUOCDAYDU, dvt.TENDONVITINH as DONVITINH, d.BHYT,        d.TENHOATCHAT, d.HAMLUONG, d.HANGSANXUAT, d.QUOCGIA, d.LOAIDUOC_ID, d.DUONGDUNG_ID, d.TINHTIEN_PTTT,        ten.TENDUOC, ten.TENDUOC_EN, ten.MAQUOCTE, ten.MAQUOCTEBT,        CASE WHEN d.BHYT = '1' THEN 'BHYT' ELSE '' END as BHYT_TEXT        , ld.LOAIVATTU_ID        , d.BENHVIEN_ID,        tk.SOLUONG, d.VTYT_PHANLOAI, d.PHAMVI, d.SUASOLUONGTONGHOP, d.MADUOCBV, d.DANGTRINHBAY        , TAMNGUNG = CASE WHEN d.TAMNGUNG = '1' OR nh.TAMNGUNG = '1' OR kd.TAMNGUNG = '1' THEN '1' ELSE '0' END        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        inner join        (        select  LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')) DUOC_KEY, (SUM(dtk.SOLUONG) - isnull(sum(A.SOLUONG),0) - isnull(sum(B.SOLUONG),0)) SOLUONG, pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        from (select sum(soluong) soluong,duoc_id,nguonduoc_id,khoduoc_id,benhvien_id from TT_DUOC_TONKHO  group by duoc_id,nguonduoc_id,khoduoc_id,benhvien_id) dtk        inner join TM_DUOC_PHAMVISD_MAPPING pvsd on dtk.KHODUOC_ID = pvsd.KHODUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NOITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) B on B.DUOC_ID = dtk.DUOC_ID and B.SOLUONG > 0 and B.PHAMVI_ID = pvsd.PHAMVI_ID and B.NGUONHANG_ID = dtk.NGUONDUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NGOAITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) A on A.DUOC_ID = dtk.DUOC_ID and A.SOLUONG > 0 and A.PHAMVI_ID = pvsd.PHAMVI_ID and A.NGUONHANG_ID = dtk.NGUONDUOC_ID        where dtk.SOLUONG > 0 and dtk.BENHVIEN_ID = 'HLU01'        group by LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')), pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        ) tk on tk.DUOC_ID = d.DUOC_ID        left join TM_DUOC_PHAMVISUDUNG kd on kd.PHAMVI_ID = tk.PHAMVI_ID and kd.BENHVIEN_ID = 'HLU01'        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = tk.NGUONDUOC_ID and nh.BENHVIEN_ID = 'HLU01'        where  d.BENHVIEN_ID = 'HLU01' and d.DUOC_ID in (1)        end]
2019-09-20 16:52:51,549 [1] DEBUG - Statement Id: [DAO00030_GetKhoDuoc] PreparedStatement : [SELECT *            FROM            TM_KHODUOC            WHERE            KHODUOC_ID= '32'            and BENHVIEN_ID= 'HLU01']
2019-09-20 16:52:51,586 [1] DEBUG - Statement Id: [DAO00030_GetMucDichChungTuID] PreparedStatement : [SELECT DICTIONARY_ID              FROM              LST_DICTIONARY              WHERE              DICTIONARY_TYPE_CODE = 'MucDichChungTu'              and DICTIONARY_CODE = 'X13']
2019-09-20 16:52:51,624 [1] DEBUG - Statement Id: [DAO00036_GetDetail] PreparedStatement : [select KEYTYPE, KEYYEAR, KEYMONTH, KEYDAY, SEGMENT_1, SEGMENT_2, SEGMENT_3, KEYVALUE              from LST_KEYDATA_DUOCPHAM as kd               WHERE                        kd.KEYTYPE = 'SOCHUNGTUNHAPXUATBENNGOAI'                   AND                       kd.KEYYEAR = '2019'                   AND                       kd.KEYMONTH = '0'                   AND                       kd.KEYDAY = '0'                   AND                       kd.SEGMENT_1 = 'CS_KB'                   AND                       kd.SEGMENT_2 = 'X13'                   AND                       kd.SEGMENT_3 = ' ']
2019-09-20 16:52:51,740 [1] DEBUG - Statement Id: [DAO00036_Update] PreparedStatement : [update LST_KEYDATA_DUOCPHAM set              KEYVALUE =  @param0               where              KEYTYPE = 'SOCHUNGTUNHAPXUATBENNGOAI'              AND KEYYEAR = '2019'              AND KEYMONTH = '0'              AND KEYDAY = '0'              AND SEGMENT_1 = 'CS_KB'              AND SEGMENT_2 = 'X13'              AND SEGMENT_3 = ' ']
2019-09-20 16:52:51,740 [1] DEBUG - Statement Id: [DAO00036_Update] Parameters: [@param0=[KEYVALUE,003090]]
2019-09-20 16:52:51,740 [1] DEBUG - Statement Id: [DAO00036_Update] Types: [@param0=[String, System.String]]
2019-09-20 16:52:51,788 [1] DEBUG - Statement Id: [DAO00030_GetGhiNhanVTYTKhamBenhByKhamBenhID] PreparedStatement : [SELECT            N'Người bệnh: ' + bn.MAYTE + ' - ' + bn.TENBENHNHAN + ' - ' +  CONVERT(VARCHAR(10), KB.THOIGIANKHAM, 103) + ' - ' + CONVERT(VARCHAR(5), KB.THOIGIANKHAM, 108) as BENHNHAN            ,tt.* , tt.NGUONHANG_ID AS NGUONDUOC_ID            FROM TT_NGOAITRU_KHAMBENH_VTYT tt            INNER JOIN TT_NGOAITRU_KHAMBENH KB on KB.KHAMBENH_ID = TT.KHAMBENH_ID AND KB.BENHVIEN_ID = TT.BENHVIEN_ID            INNER JOIN TT_BENHNHAN bn on bn.BENHNHAN_ID = KB.BENHNHAN_ID AND BN.BENHVIEN_ID = KB.BENHVIEN_ID            WHERE            tt.KHAMBENH_ID= 26173 and tt.COSO = '1' and tt.CHUNGTU_ID is null            AND TT.BENHVIEN_ID = 'HLU01'             and               tt.DICHVU_GHINHANVTYT_ID = 4918]
2019-09-20 16:52:51,871 [1] DEBUG - Statement Id: [DAO00030_GET_SOLONHAP_XUATSUDUNG] PreparedStatement : [SELECT DISTINCT            SLN.SOLONHAP_ID, SLN.SOLONHAP, SLN.SOLOSANPHAM, SLN.SOKIEMSOAT, SLN.SOVISA, CONVERT(varchar(20), SLN.SOLOSANPHAM) + '/' + CONVERT(varchar(20), TK.SOLUONG) AS SOLOSOTON,            SLN.NGAYNHAP AS NGAYNHAPLO, SLN.HANDUNG AS HANSUDUNG,  SLN.HANDUNG, SLN.NGUONDUOC_ID, SLN.NGUONDUOC_ID as NGUONHANG_ID,            SLNGB.DONGIAMUA, SLNGB.DONGIAVON, SLNGB.TYLEVAT_DAUVAO as TYLEVAT, d.TYLE_VAT, SLNGB.DONGIAVONVAT, SLNGB.DONGIABANVAT_DAUVAO,            dg.DONGIA AS DONGIATHAU, dg.DONGIA AS DONGIABAN, dg.DONGIA AS DONGIABAN_VAT,                      TK.KHODUOC_ID,TK.DUOC_ID, TK.SOLUONG, TK.SOLUONG AS SOLUONGTON,            D.TENDUOCDAYDU,D.DONVITINH_ID, D.DONVITINH, D.BHYT, NH.TENNGUONDUOC AS NGUONHANG,            LTRIM(TK.KHODUOC_ID) + '_' + LTRIM(TK.DUOC_ID) + '_' + LTRIM(TK.NGUONDUOC_ID) as DUOC_KEY            FROM            TT_DUOC_CHUNGTU_SOLONHAP SLN            INNER JOIN TT_DUOC_TONKHO TK on SLN.SOLONHAP_ID = TK.SOLONHAP_ID            INNER JOIN TT_DUOC_SOLONHAP_GIABAN SLNGB on SLN.SOLONHAP_ID = SLNGB.SOLONHAP_ID            INNER JOIN TM_NGUONHANG NH on SLN.NGUONDUOC_ID = NH.NGUONDUOC_ID            INNER JOIN TM_DUOC D on SLN.DUOC_ID = D.DUOC_ID            LEFT JOIN TM_DUOC_DONGIA dg on dg.DUOC_ID = SLN.DUOC_ID            LEFT JOIN TM_LOAIGIA lg on (lg.LOAIGIA_ID = dg.LOAIGIA_ID AND lg.MALOAIGIA = 'GiaduocBHYT')            WHERE            TK.DUOC_ID = '1'            AND TK.KHODUOC_ID = '32'            AND TK.BENHVIEN_ID = 'HLU01'            AND TK.SOLUONG > 0                 and                     SLN.NGUONDUOC_ID = '1'                                      ORDER BY NGAYNHAP]
2019-09-20 16:52:53,731 [1] DEBUG - Statement Id: [DAO00030_Add] PreparedStatement : [insert into TT_DUOC_CHUNGTU (              MACHUNGTU              , SOCHUNGTU              , NGAYCHUNGTU              , LOAICHUNGTU              , MUCDICHCHUNGTU_ID              , MUCDICHCHUNGTU_CODE              , KHOXUAT_ID              , NGUOIGIAO_ID              , NGUOIGIAO              , KHONHAP_ID              , NGUOINHAN_ID              , NGUOINHAN              , NGUOIKIEMTRA_ID              , NGUOIKIEMTRA              , NGUOIDUYET_ID              , NGUOIDUYET              , PHUONGPHAPXUAT              , KETOANTRUONG_ID              , KETOANTRUONG              , THUKHO_ID              , THUKHO              , MAUHOADON              , SOHOADON              , SOSERI              , NGAYHOADON              , DIENGIAI              , GIATRI              , GIATRITHANHTOAN              , TYLEVAT              , GIATRIVAT              , THUESUAT              , GIATRITHUE              , TYLECHIETKHAU              , GIATRICHIETKHAU              , TIENTE_ID              , TYGIA              , SOCHUNGTUGOC              , NGAYCHUNGTUGOC              , NHACUNGCAP_ID              , HINHTHUCTHANHTOAN_ID              , NGUONDUOC_ID              , CHUNGTULIENQUAN_ID              , KHAMBENH_ID              , TOATHUOCNOITRU_ID              , TIEPNHAN_ID              , BENHAN_ID              , DANHANTHUOC              , NGUOINHAP_ID              , NGAYNHAP              , TRANGTHAI              , LOAITOATHUOC              , PHIEULINH_ID              , DIENGIAINGHIEPVUPHATSINH              , DONVIGIAO_ID              , KHOSUDUNG_ID              , LOAIVATTU_ID              , BENHNHAN_ID              , NGOAITRU_TOATHUOC_NGUOIMUA_ID              , TENBENHNHAN              , BACSIGIOITHIEU_ID              , DOITUONG_ID              , IDCHUYEN              , CHUNGTUKETOAN              , STATUS              , TRANSFER_VIENPHI_ID              , PHONGBAN_ID              , BACSI_ID              , TKNO              , TKCO              , MACHUNGTUREF              , LOAICHUNGTUREF              , PHIEULINHCANTRU_ID              , KHOTHUCHIEN_ID              , KHODOIUNG_ID              , MENU_LOAIDUOC_ID              , NGUOISUDUNGMAY_ID              , GOITHAU_ID              , XUATTHUOCBANGOAITRU              , NGAYGIOCHUNGTU              , NOIDAKHAM              , HOIDONGKIEMNHAP_ID              , HOIDONGTHANHLY_ID              , CHUYENCHUNGTUID              , CHUYENDOANHTHUID              , LYDOXUATSUDUNG_ID              , BENHVIEN_ID              , NGAYTAO              , NGUOITAO_ID              , NGAYCAPNHAT              , NGUOICAPNHAT_ID              ) values (               @param0               ,  @param1               ,  @param2               ,  @param3               ,  @param4               ,  @param5               ,  @param6               ,  @param7               ,  @param8               ,  @param9               ,  @param10               ,  @param11               ,  @param12               ,  @param13               ,  @param14               ,  @param15               ,  @param16               ,  @param17               ,  @param18               ,  @param19               ,  @param20               ,  @param21               ,  @param22               ,  @param23               ,  @param24               ,  @param25               ,  @param26               ,  @param27               ,  @param28               ,  @param29               ,  @param30               ,  @param31               ,  @param32               ,  @param33               ,  @param34               ,  @param35               ,  @param36               ,  @param37               ,  @param38               ,  @param39               ,  @param40               ,  @param41               ,  @param42               ,  @param43               ,  @param44               ,  @param45               ,  @param46               ,  @param47               ,  @param48               ,  @param49               ,  @param50               ,  @param51               ,  @param52               ,  @param53               ,  @param54               ,  @param55               ,  @param56               ,  @param57               ,  @param58               ,  @param59               ,  @param60               ,  @param61               ,  @param62               ,  @param63               ,  @param64               ,  @param65               ,  @param66               ,  @param67               ,  @param68               ,  @param69               ,  @param70               ,  @param71               ,  @param72               ,  @param73               ,  @param74               ,  @param75               ,  @param76               ,  @param77               ,  @param78               ,  @param79               ,  @param80               ,  @param81               ,  @param82               ,  @param83               ,  @param84               ,  @param85               ,  @param2               ,  @param86               ,  @param87               ,  @param88               )              select SCOPE_identity() as value]
2019-09-20 16:52:53,732 [1] DEBUG - Statement Id: [DAO00030_Add] Parameters: [@param0=[MACHUNGTU,CS_KBX1319003090], @param1=[SOCHUNGTU,003090], @param2=[NGAYCHUNGTU,9/20/2019 4:52:51 PM], @param3=[LOAICHUNGTU,X], @param4=[MUCDICHCHUNGTU_ID,1060], @param5=[MUCDICHCHUNGTU_CODE,X13], @param6=[KHOXUAT_ID,32], @param7=[NGUOIGIAO_ID,0], @param8=[NGUOIGIAO,null], @param9=[KHONHAP_ID,null], @param10=[NGUOINHAN_ID,null], @param11=[NGUOINHAN,null], @param12=[NGUOIKIEMTRA_ID,null], @param13=[NGUOIKIEMTRA,null], @param14=[NGUOIDUYET_ID,null], @param15=[NGUOIDUYET,null], @param16=[PHUONGPHAPXUAT,0], @param17=[KETOANTRUONG_ID,null], @param18=[KETOANTRUONG,null], @param19=[THUKHO_ID,null], @param20=[THUKHO,null], @param21=[MAUHOADON,null], @param22=[SOHOADON,null], @param23=[SOSERI,null], @param24=[NGAYHOADON,null], @param25=[DIENGIAI,null], @param26=[GIATRI,null], @param27=[GIATRITHANHTOAN,null], @param28=[TYLEVAT,5], @param29=[GIATRIVAT,0], @param30=[THUESUAT,null], @param31=[GIATRITHUE,null], @param32=[TYLECHIETKHAU,null], @param33=[GIATRICHIETKHAU,null], @param34=[TIENTE_ID,null], @param35=[TYGIA,null], @param36=[SOCHUNGTUGOC,null], @param37=[NGAYCHUNGTUGOC,null], @param38=[NHACUNGCAP_ID,null], @param39=[HINHTHUCTHANHTOAN_ID,null], @param40=[NGUONDUOC_ID,null], @param41=[CHUNGTULIENQUAN_ID,null], @param42=[KHAMBENH_ID,null], @param43=[TOATHUOCNOITRU_ID,null], @param44=[TIEPNHAN_ID,null], @param45=[BENHAN_ID,null], @param46=[DANHANTHUOC,], @param47=[NGUOINHAP_ID,null], @param48=[NGAYNHAP,null], @param49=[TRANGTHAI,DAXUAT], @param50=[LOAITOATHUOC,null], @param51=[PHIEULINH_ID,null], @param52=[DIENGIAINGHIEPVUPHATSINH,null], @param53=[DONVIGIAO_ID,null], @param54=[KHOSUDUNG_ID,null], @param55=[LOAIVATTU_ID,null], @param56=[BENHNHAN_ID,null], @param57=[NGOAITRU_TOATHUOC_NGUOIMUA_ID,null], @param58=[TENBENHNHAN,null], @param59=[BACSIGIOITHIEU_ID,null], @param60=[DOITUONG_ID,null], @param61=[IDCHUYEN,null], @param62=[CHUNGTUKETOAN,null], @param63=[STATUS,null], @param64=[TRANSFER_VIENPHI_ID,null], @param65=[PHONGBAN_ID,62], @param66=[BACSI_ID,null], @param67=[TKNO,null], @param68=[TKCO,null], @param69=[MACHUNGTUREF,null], @param70=[LOAICHUNGTUREF,null], @param71=[PHIEULINHCANTRU_ID,null], @param72=[KHOTHUCHIEN_ID,null], @param73=[KHODOIUNG_ID,null], @param74=[MENU_LOAIDUOC_ID,null], @param75=[NGUOISUDUNGMAY_ID,null], @param76=[GOITHAU_ID,null], @param77=[XUATTHUOCBANGOAITRU,null], @param78=[NGAYGIOCHUNGTU,null], @param79=[NOIDAKHAM,null], @param80=[HOIDONGKIEMNHAP_ID,null], @param81=[HOIDONGTHANHLY_ID,null], @param82=[CHUYENCHUNGTUID,null], @param83=[CHUYENDOANHTHUID,null], @param84=[LYDOXUATSUDUNG_ID,8294], @param85=[BENHVIEN_ID,HLU01], @param86=[NGUOITAO_ID,0], @param87=[NGAYCAPNHAT,9/20/2019 4:52:53 PM], @param88=[NGUOICAPNHAT_ID,0]]
2019-09-20 16:52:53,732 [1] DEBUG - Statement Id: [DAO00030_Add] Types: [@param0=[String, System.String], @param1=[String, System.String], @param2=[DateTime, System.DateTime], @param3=[String, System.String], @param4=[Int32, System.Int32], @param5=[String, System.String], @param6=[Int32, System.Int32], @param7=[Int32, System.Int32], @param8=[System.DBNull, null], @param9=[System.DBNull, null], @param10=[System.DBNull, null], @param11=[System.DBNull, null], @param12=[System.DBNull, null], @param13=[System.DBNull, null], @param14=[System.DBNull, null], @param15=[System.DBNull, null], @param16=[Int32, System.Int32], @param17=[System.DBNull, null], @param18=[System.DBNull, null], @param19=[System.DBNull, null], @param20=[System.DBNull, null], @param21=[System.DBNull, null], @param22=[System.DBNull, null], @param23=[System.DBNull, null], @param24=[System.DBNull, null], @param25=[System.DBNull, null], @param26=[System.DBNull, null], @param27=[System.DBNull, null], @param28=[Decimal, System.Decimal], @param29=[Decimal, System.Decimal], @param30=[System.DBNull, null], @param31=[System.DBNull, null], @param32=[System.DBNull, null], @param33=[System.DBNull, null], @param34=[System.DBNull, null], @param35=[System.DBNull, null], @param36=[System.DBNull, null], @param37=[System.DBNull, null], @param38=[System.DBNull, null], @param39=[System.DBNull, null], @param40=[System.DBNull, null], @param41=[System.DBNull, null], @param42=[System.DBNull, null], @param43=[System.DBNull, null], @param44=[System.DBNull, null], @param45=[System.DBNull, null], @param46=[String, System.String], @param47=[System.DBNull, null], @param48=[System.DBNull, null], @param49=[String, System.String], @param50=[System.DBNull, null], @param51=[System.DBNull, null], @param52=[System.DBNull, null], @param53=[System.DBNull, null], @param54=[System.DBNull, null], @param55=[System.DBNull, null], @param56=[System.DBNull, null], @param57=[System.DBNull, null], @param58=[System.DBNull, null], @param59=[System.DBNull, null], @param60=[System.DBNull, null], @param61=[System.DBNull, null], @param62=[System.DBNull, null], @param63=[System.DBNull, null], @param64=[System.DBNull, null], @param65=[Int32, System.Int32], @param66=[System.DBNull, null], @param67=[System.DBNull, null], @param68=[System.DBNull, null], @param69=[System.DBNull, null], @param70=[System.DBNull, null], @param71=[System.DBNull, null], @param72=[System.DBNull, null], @param73=[System.DBNull, null], @param74=[System.DBNull, null], @param75=[System.DBNull, null], @param76=[System.DBNull, null], @param77=[System.DBNull, null], @param78=[System.DBNull, null], @param79=[System.DBNull, null], @param80=[System.DBNull, null], @param81=[System.DBNull, null], @param82=[System.DBNull, null], @param83=[System.DBNull, null], @param84=[Int32, System.Int32], @param85=[String, System.String], @param86=[Int32, System.Int32], @param87=[DateTime, System.DateTime], @param88=[Int32, System.Int32]]
2019-09-20 16:52:57,034 [1] DEBUG - Statement Id: [DAO00030_CHUNGTUCT_AddMulti] PreparedStatement : [declare @json nvarchar(max) =  N'[{"SOLONHAP_ID":7541,"SOLONHAP":"190500624","SOLOSANPHAM":"a","SOKIEMSOAT":null,"SOVISA":"1","SOLOSOTON":"a/10.0000","NGAYNHAPLO":"2019-05-06T10:24:00","HANSUDUNG":"2026-12-12T00:00:00","HANDUNG":"2026-12-12T00:00:00","NGUONDUOC_ID":1,"NGUONHANG_ID":1,"DONGIAMUA":945.0000,"DONGIAVON":945.0000,"TYLEVAT":0.0000,"TYLE_VAT":0.00,"DONGIAVONVAT":945.0000,"DONGIABANVAT_DAUVAO":945.0000,"DONGIATHAU":1030.00,"DONGIABAN":1030.00,"DONGIABAN_VAT":1030.00,"KHODUOC_ID":32,"DUOC_ID":1,"SOLUONG":10.0000,"SOLUONGTON":10.0000,"TENDUOCDAYDU":null,"DONVITINH_ID":17,"DONVITINH":"Cái","BHYT":"1","NGUONHANG":"Nguồn Mua","DUOC_KEY":"32_1_1","CHUNGTUCHITIET_ID":0,"CHUNGTU_ID":137702,"SOLUONGTHUCTE":null,"TOATHUOC":"NGOAITRU_KHAMBENH_VTYT","TOATHUOCNOITRU_ID":null,"REF_TABLE":"TT_NGOAITRU_KHAMBENH_VTYT","REF_ID":10593,"KHAMBENH_VTYT_ID":10593,"BENHNHAN":"Người bệnh: 190043304 - Test Xn1 - 20/09/2019 - 16:50","SOLUONGYEUCAU":2,"PHAUTHUAT_VTYT_ID":null,"CLSKETQUA_VTYT_ID":null,"SOLUONGDAXUAT":2.0,"THANHTIENVON":1890.0000,"NGAYTAO":"20/Sep/2019 16:52:57","NGUOITAO_ID":0,"BENHVIEN_ID":"HLU01"}]';             INSERT INTO TT_DUOC_CHUNGTU_CHITIET           (           CHUNGTU_ID           , DUOC_ID           , SOLONHAP_ID           , SOKIEMSOAT           , SOVISA           , HANDUNG           , DONVITINH_ID           , SOLUONGYEUCAU           , SOLUONGTHUCTE           , SOLUONGDAXUAT           , TIENTE_ID           , TYGIA           , DONGIAMUA           , DONGIA_BHYT           , DONGIABAN           , DONGIABAN_VAT           , DONGIAVON           , DONGIATHANHTOAN           , SOQUYEN           , SOHOADONVAT           , TYLEVAT           , GIATRIVAT           , TYLECHIETKHAU           , GIATRICHIETKHAU           , MIENPHI           , LYDOMIENPHI_ID           , SOCHUNGTUKETOAN           , SOCHUNGTUTIENMAT           , TRANGTHAI           , DAPHATSINHPHIEUXUAT           , DAPHATSINHPHIEUHOANTRA           , KHUYENMAI           , PHUONGPHAPXUAT           , DONDATHANG_ID           , GHICHUCHITIET           , NGUONHANG_ID           , DONGIAVONVAT           , THANHTIENMUA           , THANHTIENVON           , THANHTIENHOPDONG           , ISTACHLO           , DONVITINHBANDAU_ID           , SOLUONGBANDAU           , GOITHAU_ID           , DONGIATHAU           , DONGIAPO           , TYLEQUIDOI           , TOATHUOCNOITRU_ID           , KHAMBENH_VTYT_ID           , PHAUTHUAT_VTYT_ID           , CLSKETQUA_VTYT_ID           , TOATHUOCNGOAITRU_ID           , CHUNGTUCHITIET_LIENQUAN_ID           , MASTER_ID           , BENHNHAN           , YLENH           , BENHVIEN_ID           , NGAYTAO           , NGUOITAO_ID                    )                  SELECT * FROM OPENJSON(@json)           WITH (           CHUNGTU_ID int           , DUOC_ID int           , SOLONHAP_ID int           , SOKIEMSOAT varchar(20)           , SOVISA varchar(20)           , HANDUNG datetime           , DONVITINH_ID int           , SOLUONGYEUCAU numeric(25, 4)           , SOLUONGTHUCTE numeric(25, 4)           , SOLUONGDAXUAT numeric(25, 4)           , TIENTE_ID nchar(3)           , TYGIA numeric(25, 4)           , DONGIAMUA numeric(25, 4)           , DONGIA_BHYT numeric(25, 4)           , DONGIABAN numeric(25, 4)           , DONGIABAN_VAT numeric(25, 4)           , DONGIAVON numeric(25, 4)           , DONGIATHANHTOAN numeric(25, 4)           , SOQUYEN varchar(20)           , SOHOADONVAT varchar(20)           , TYLEVAT  numeric(25, 4)           , GIATRIVAT numeric(25, 4)           , TYLECHIETKHAU numeric(25, 4)           , GIATRICHIETKHAU numeric(25, 4)           , MIENPHI char(1)           , LYDOMIENPHI_ID int           , SOCHUNGTUKETOAN varchar(20)           , SOCHUNGTUTIENMAT varchar(20)           , TRANGTHAI varchar(10)           , DAPHATSINHPHIEUXUAT char(1)           , DAPHATSINHPHIEUHOANTRA char(1)           , KHUYENMAI char(1)           , PHUONGPHAPXUAT int           , DONDATHANG_ID int           , GHICHUCHITIET nvarchar(255)           , NGUONHANG_ID int           , DONGIAVONVAT numeric(25, 4)           , THANHTIENMUA numeric(25, 4)           , THANHTIENVON numeric(25, 4)           , THANHTIENHOPDONG numeric(25, 4)           , ISTACHLO char(1)           , DONVITINHBANDAU_ID int           , SOLUONGBANDAU numeric(25, 4)           , GOITHAU_ID int           , DONGIATHAU numeric(25, 4)           , DONGIAPO numeric(25, 4)           , TYLEQUIDOI numeric(25, 4)           , TOATHUOCNOITRU_ID int           , KHAMBENH_VTYT_ID int           , PHAUTHUAT_VTYT_ID int           , CLSKETQUA_VTYT_ID int           , TOATHUOCNGOAITRU_ID int           , CHUNGTUCHITIET_LIENQUAN_ID int           , MASTER_ID int           , BENHNHAN nvarchar(1000)           , YLENH nvarchar(MAX)           , BENHVIEN_ID varchar(10)           , NGAYTAO datetime           , NGUOITAO_ID int                  )                      IF('X13' = 'X13')           BEGIN                      UPDATE TT_NOITRU_TOATHUOC SET CHUNGTU_ID = json.CHUNGTU_ID, TRANGTHAI = 'DAXUAT', NGAYCAPNHAT = getdate()           FROM OPENJSON(@json)           WITH (CHUNGTU_ID int, TOATHUOCNOITRU_ID int) json           WHERE TT_NOITRU_TOATHUOC.TOATHUOC_ID = json.TOATHUOCNOITRU_ID and json.TOATHUOCNOITRU_ID is not NULL                  UPDATE TT_VIENPHI set DUYET = '1', DATHUCHIEN = '1', NGAYCAPNHAT = getdate()           FROM OPENJSON(@json)           WITH (TOATHUOCNOITRU_ID int) json           WHERE TT_VIENPHI.REF_TABLE = 'TT_NOITRU_TOATHUOC' and TT_VIENPHI.REF_ID = json.TOATHUOCNOITRU_ID and json.TOATHUOCNOITRU_ID is not NULL                                 UPDATE TT_NGOAITRU_KHAMBENH_VTYT SET CHUNGTU_ID = json.CHUNGTU_ID, TRANGTHAI = 'DAXUAT', NGAYCAPNHAT = getdate()           FROM OPENJSON(@json)           WITH (CHUNGTU_ID int, KHAMBENH_VTYT_ID int) json           WHERE TT_NGOAITRU_KHAMBENH_VTYT.KHAMBENH_VTYT_ID = json.KHAMBENH_VTYT_ID and json.KHAMBENH_VTYT_ID is not NULL                  UPDATE TT_VIENPHI set DUYET = '1', DATHUCHIEN = '1', NGAYCAPNHAT = getdate()           FROM OPENJSON(@json)           WITH (KHAMBENH_VTYT_ID int) json           WHERE TT_VIENPHI.REF_TABLE = 'TT_NGOAITRU_KHAMBENH_VTYT' and TT_VIENPHI.REF_ID = json.KHAMBENH_VTYT_ID and json.KHAMBENH_VTYT_ID is not NULL                                  UPDATE TT_PHAUTHUAT_VTYT SET CHUNGTU_ID = json.CHUNGTU_ID           FROM OPENJSON(@json)           WITH (CHUNGTU_ID int, PHAUTHUAT_VTYT_ID int) json           WHERE TT_PHAUTHUAT_VTYT.PHAUTHUAT_VTYT_ID = json.PHAUTHUAT_VTYT_ID and json.PHAUTHUAT_VTYT_ID is not NULL                  UPDATE TT_VIENPHI set DUYET = '1', DATHUCHIEN = '1', NGAYCAPNHAT = getdate()           FROM OPENJSON(@json)           WITH (PHAUTHUAT_VTYT_ID int) json           WHERE TT_VIENPHI.REF_TABLE = 'TT_PHAUTHUAT_VTYT' and TT_VIENPHI.REF_ID = json.PHAUTHUAT_VTYT_ID and json.PHAUTHUAT_VTYT_ID is not NULL                              UPDATE TT_CLSKETQUA_VTYT SET CHUNGTU_ID = json.CHUNGTU_ID, TRANGTHAI = 'DAXUAT', NGAYCAPNHAT = getdate()           FROM OPENJSON(@json)           WITH (CHUNGTU_ID int, CLSKETQUA_VTYT_ID int) json           WHERE TT_CLSKETQUA_VTYT.CLSKETQUA_VTYT_ID = json.CLSKETQUA_VTYT_ID and json.CLSKETQUA_VTYT_ID is not NULL                  UPDATE TT_VIENPHI set DUYET = '1', DATHUCHIEN = '1', NGAYCAPNHAT = getdate()           FROM OPENJSON(@json)           WITH (CLSKETQUA_VTYT_ID int) json           WHERE TT_VIENPHI.REF_TABLE = 'TT_CLSKETQUA_VTYT' and TT_VIENPHI.REF_ID = json.CLSKETQUA_VTYT_ID and json.CLSKETQUA_VTYT_ID is not NULL                      END]
2019-09-20 16:52:58,206 [1] DEBUG - Statement Id: [DAO00030_DUOC_TONKHO_BOOKING_NGOAITRU_Giam] PreparedStatement : [update TT_DUOC_TONKHO_BOOK_NGOAITRU            set            SOLUONG = 0                     ,NGAYCAPNHAT = getdate()            where            REF_TABLE = 'TT_NGOAITRU_KHAMBENH_VTYT'            AND REF_ID = '10593'                AND BENHVIEN_ID = 'HLU01']
2019-09-20 16:52:58,270 [1] DEBUG - Statement Id: [DAO00030_DUOCTONKHO_Giam] PreparedStatement : [update TT_DUOC_TONKHO set            SOLUONG = SOLUONG -  @param0             , NGAYCAPNHAT =  getdate()            , NGUOICAPNHAT_ID =  @param1             where            KHODUOC_ID =  @param2             and DUOC_ID =  @param3             and SOLONHAP_ID =  @param4]
2019-09-20 16:52:58,270 [1] DEBUG - Statement Id: [DAO00030_DUOCTONKHO_Giam] Parameters: [@param0=[SOLUONGTHAYDOI,2], @param1=[NGUOICAPNHAT_ID,null], @param2=[KHODUOC_ID,32], @param3=[DUOC_ID,1], @param4=[SOLONHAP_ID,7541]]
2019-09-20 16:52:58,270 [1] DEBUG - Statement Id: [DAO00030_DUOCTONKHO_Giam] Types: [@param0=[Decimal, System.Decimal], @param1=[System.DBNull, null], @param2=[Int32, System.Int32], @param3=[Int32, System.Int32], @param4=[Int32, System.Int32]]
2019-09-20 16:52:58,336 [1] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoCOM18] PreparedStatement : [select  distinct TT_TONKHO.DUOC_KEY, LTRIM(TT_TONKHO.KHODUOC_ID) as KHODUOC_ID, TM_DUOC.DUOC_ID, TM_LOAIDUOC.MALOAIDUOC,TM_DUOC.SOVISA,TM_DUOC.TYLE_VAT,TM_DUOC.COTOA,        TM_DUOC.MADUOC, TM_DUOC.TENHANG, TM_DUOC.TENDUOCDAYDU, dvt.TENDONVITINH as DONVITINH, TM_DUOC.DONVITINH_ID, TM_DUOC.BHYT,        TM_DUOC.TENHOATCHAT, TM_DUOC.HAMLUONG, TM_DUOC.HANGSANXUAT, TM_DUOC.QUOCGIA, TM_DUOC.LOAIDUOC_ID, TM_DUOC.DUONGDUNG_ID,        TM_TENDUOC.TENDUOC, TM_TENDUOC.TENDUOC_EN, TM_TENDUOC.MAQUOCTE, TM_TENDUOC.MAQUOCTEBT,        TM_LOAIDUOC.LOAIVATTU_ID, TM_DUOC.BENHVIEN_ID,        TT_TONKHO.SOLUONG, TM_DUOC.VTYT_PHANLOAI, TM_DUOC.PHAMVI, TT_TONKHO.NGUONDUOC_ID, NG.TENNGUONDUOC        , TAMNGUNG = CASE WHEN TM_DUOC.TAMNGUNG = '1' OR NG.TAMNGUNG = '1' OR KD.TAMNGUNG = '1' THEN '1' ELSE '0' END        , TM_DUOC.DANGTRINHBAY        from TM_DUOC        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = TM_DUOC.DONVITINH_ID        left join TM_TENDUOC on TM_DUOC.TENDUOC_ID = TM_TENDUOC.TENDUOC_ID and TM_DUOC.BENHVIEN_ID = 'HLU01'  and TM_DUOC.TAMNGUNG = '0'        left join TM_LOAIDUOC on TM_LOAIDUOC.LOAIDUOC_ID = TM_DUOC.LOAIDUOC_ID and TM_LOAIDUOC.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG on (TM_LOAIDUOC.LOAIVATTU_ID = TM_DUOC_HANDUNG.LOAIDUOC and TM_DUOC_HANDUNG.BENHVIEN_ID = 'HLU01')        inner join        (select LTRIM(A.KHODUOC_ID) + '_' + LTRIM(A.DUOC_ID) + '_' + LTRIM(ISNULL(A.NGUONDUOC_ID,'')) as DUOC_KEY, A.KHODUOC_ID, A.DUOC_ID ,a.NGUONDUOC_ID,        SUM(isnull(A.SOLUONG,0)) as SOLUONG        from        (select SUM(SOLUONG) as SOLUONG, KHODUOC_ID, DUOC_ID, NGUONDUOC_ID from TT_DUOC_TONKHO        where KHODUOC_ID in (32) and DUOC_ID in (1) group by KHODUOC_ID, DUOC_ID, NGUONDUOC_ID        ) A        where A.KHODUOC_ID in (32) and A.DUOC_ID in (1)        group by LTRIM(A.KHODUOC_ID) + '_' + LTRIM(A.DUOC_ID) + '_' + LTRIM(A.NGUONDUOC_ID), A.KHODUOC_ID, A.DUOC_ID, A.NGUONDUOC_ID)        TT_TONKHO on TT_TONKHO.DUOC_ID = TM_DUOC.DUOC_ID        LEFT JOIN TM_NGUONHANG NG ON NG.NGUONDUOC_ID = TT_TONKHO.NGUONDUOC_ID        LEFT JOIN TM_KHODUOC KD ON KD.KHODUOC_ID = TT_TONKHO.KHODUOC_ID        where TM_DUOC.BENHVIEN_ID = 'HLU01' and TM_DUOC.DUOC_ID in (1)]
2019-09-20 16:52:58,403 [1] DEBUG - Statement Id: [DAO00030_GetListPhamViByKhoDuoc] PreparedStatement : [SELECT DISTINCT PHAMVI_ID          FROM TM_DUOC_PHAMVISD_MAPPING          WHERE          KHODUOC_ID IN (32)          AND BENHVIEN_ID ='HLU01'          AND TAMNGUNG = '0']
2019-09-20 16:52:58,437 [1] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoVaBookingCOM23] PreparedStatement : [declare @NGUONDUOC_MACDINH varchar(5) = '0';        declare @TOAMUANGOAI int = 0;        select @NGUONDUOC_MACDINH = isnull(VALUE,0) from TM_SYS_APPSETTINGS where CODE = 'PHA_NGUONDUOC'        select @TOAMUANGOAI = isnull(VALUE,0) from TM_SYS_APPSETTINGS where CODE = 'OPD_TOAMUANGOAI_DUNGDANHMUC_DUOC'                if @TOAMUANGOAI = 1        begin        select  distinct '0' + '_' + LTRIM(d.DUOC_ID) + '_' + @NGUONDUOC_MACDINH as DUOC_KEY, 0 as PHAMVI_ID, @NGUONDUOC_MACDINH as NGUONDUOC_ID, null as TENNGUONDUOC, null as TINHTIEN, d.DUOC_ID, ld.MALOAIDUOC,        d.SOVISA,d.TYLE_VAT,d.COTOA, d.MADUOC, d.TENHANG, d.TENDUOCDAYDU, dvt.TENDONVITINH as DONVITINH, d.BHYT,        d.TENHOATCHAT, d.HAMLUONG, d.HANGSANXUAT, d.QUOCGIA, d.LOAIDUOC_ID, d.DUONGDUNG_ID, d.TINHTIEN_PTTT,        ten.TENDUOC, ten.TENDUOC_EN, ten.MAQUOCTE, ten.MAQUOCTEBT,        '' as BHYT_TEXT        , ld.LOAIVATTU_ID        , d.BENHVIEN_ID,        999999999 as SOLUONG, d.VTYT_PHANLOAI, d.PHAMVI, d.SUASOLUONGTONGHOP, d.MADUOCBV, d.DANGTRINHBAY        , TAMNGUNG = CASE WHEN d.TAMNGUNG = '1' THEN '1' ELSE '0' END        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        where d.DUOC_ID in (1)        union all        select  distinct tk.DUOC_KEY, LTRIM(tk.PHAMVI_ID) as PHAMVI_ID, tk.NGUONDUOC_ID, nh.TENNGUONDUOC, nh.TINHTIEN, d.DUOC_ID, ld.MALOAIDUOC,        d.SOVISA,d.TYLE_VAT,d.COTOA, d.MADUOC, d.TENHANG, d.TENDUOCDAYDU, dvt.TENDONVITINH as DONVITINH, d.BHYT,        d.TENHOATCHAT, d.HAMLUONG, d.HANGSANXUAT, d.QUOCGIA, d.LOAIDUOC_ID, d.DUONGDUNG_ID, d.TINHTIEN_PTTT,        ten.TENDUOC, ten.TENDUOC_EN, ten.MAQUOCTE, ten.MAQUOCTEBT,        CASE WHEN d.BHYT = '1' THEN 'BHYT' ELSE '' END as BHYT_TEXT        , ld.LOAIVATTU_ID        , d.BENHVIEN_ID,        tk.SOLUONG, d.VTYT_PHANLOAI, d.PHAMVI, d.SUASOLUONGTONGHOP, d.MADUOCBV, d.DANGTRINHBAY        , TAMNGUNG = CASE WHEN d.TAMNGUNG = '1' OR nh.TAMNGUNG = '1' OR kd.TAMNGUNG = '1' THEN '1' ELSE '0' END        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        inner join        (        select  LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')) DUOC_KEY, (SUM(dtk.SOLUONG) - isnull(sum(A.SOLUONG),0) - isnull(sum(B.SOLUONG),0)) SOLUONG, pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        from (select sum(soluong) soluong,duoc_id,nguonduoc_id,khoduoc_id,benhvien_id from TT_DUOC_TONKHO  group by duoc_id,nguonduoc_id,khoduoc_id,benhvien_id) dtk        inner join TM_DUOC_PHAMVISD_MAPPING pvsd on dtk.KHODUOC_ID = pvsd.KHODUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NOITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) B on B.DUOC_ID = dtk.DUOC_ID and B.SOLUONG > 0 and B.PHAMVI_ID = pvsd.PHAMVI_ID and B.NGUONHANG_ID = dtk.NGUONDUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NGOAITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) A on A.DUOC_ID = dtk.DUOC_ID and A.SOLUONG > 0 and A.PHAMVI_ID = pvsd.PHAMVI_ID and A.NGUONHANG_ID = dtk.NGUONDUOC_ID        where dtk.SOLUONG > 0 and dtk.BENHVIEN_ID = 'HLU01'        group by LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')), pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        ) tk on tk.DUOC_ID = d.DUOC_ID        left join TM_DUOC_PHAMVISUDUNG kd on kd.PHAMVI_ID = tk.PHAMVI_ID and kd.BENHVIEN_ID = 'HLU01'        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = tk.NGUONDUOC_ID and nh.BENHVIEN_ID = 'HLU01'        where  d.BENHVIEN_ID = 'HLU01' and d.DUOC_ID in (1) and TK.PHAMVI_ID in (1055)        and tk.NGUONDUOC_ID in (1)         end        else        begin                select  distinct tk.DUOC_KEY, LTRIM(tk.PHAMVI_ID) as PHAMVI_ID, tk.NGUONDUOC_ID, nh.TENNGUONDUOC, nh.TINHTIEN, d.DUOC_ID, ld.MALOAIDUOC,        d.SOVISA,d.TYLE_VAT,d.COTOA, d.MADUOC, d.TENHANG, d.TENDUOCDAYDU, dvt.TENDONVITINH as DONVITINH, d.BHYT,        d.TENHOATCHAT, d.HAMLUONG, d.HANGSANXUAT, d.QUOCGIA, d.LOAIDUOC_ID, d.DUONGDUNG_ID, d.TINHTIEN_PTTT,        ten.TENDUOC, ten.TENDUOC_EN, ten.MAQUOCTE, ten.MAQUOCTEBT,        CASE WHEN d.BHYT = '1' THEN 'BHYT' ELSE '' END as BHYT_TEXT        , ld.LOAIVATTU_ID        , d.BENHVIEN_ID,        tk.SOLUONG, d.VTYT_PHANLOAI, d.PHAMVI, d.SUASOLUONGTONGHOP, d.MADUOCBV, d.DANGTRINHBAY        , TAMNGUNG = CASE WHEN d.TAMNGUNG = '1' OR nh.TAMNGUNG = '1' OR kd.TAMNGUNG = '1' THEN '1' ELSE '0' END        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        inner join        (        select  LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')) DUOC_KEY, (SUM(dtk.SOLUONG) - isnull(sum(A.SOLUONG),0) - isnull(sum(B.SOLUONG),0)) SOLUONG, pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        from (select sum(soluong) soluong,duoc_id,nguonduoc_id,khoduoc_id,benhvien_id from TT_DUOC_TONKHO  group by duoc_id,nguonduoc_id,khoduoc_id,benhvien_id) dtk        inner join TM_DUOC_PHAMVISD_MAPPING pvsd on dtk.KHODUOC_ID = pvsd.KHODUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NOITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) B on B.DUOC_ID = dtk.DUOC_ID and B.SOLUONG > 0 and B.PHAMVI_ID = pvsd.PHAMVI_ID and B.NGUONHANG_ID = dtk.NGUONDUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NGOAITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) A on A.DUOC_ID = dtk.DUOC_ID and A.SOLUONG > 0 and A.PHAMVI_ID = pvsd.PHAMVI_ID and A.NGUONHANG_ID = dtk.NGUONDUOC_ID        where dtk.SOLUONG > 0 and dtk.BENHVIEN_ID = 'HLU01'        group by LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')), pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        ) tk on tk.DUOC_ID = d.DUOC_ID        left join TM_DUOC_PHAMVISUDUNG kd on kd.PHAMVI_ID = tk.PHAMVI_ID and kd.BENHVIEN_ID = 'HLU01'        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = tk.NGUONDUOC_ID and nh.BENHVIEN_ID = 'HLU01'        where  d.BENHVIEN_ID = 'HLU01' and d.DUOC_ID in (1) and TK.PHAMVI_ID in (1055)        and tk.NGUONDUOC_ID in (1)         end]
2019-09-20 16:52:58,983 [1] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoCOM18UpdateRedis] PreparedStatement : [select distinct TT_TONKHO.DUOC_KEY, LTRIM(TT_TONKHO.KHODUOC_ID) as KHODUOC_ID, TM_DUOC.DUOC_ID, TM_LOAIDUOC.MALOAIDUOC,TM_DUOC.SOVISA,TM_DUOC.TYLE_VAT,TM_DUOC.COTOA,        TM_DUOC.MADUOC, TM_DUOC.TENHANG, TM_DUOC.TENDUOCDAYDU, dvt.TENDONVITINH as DONVITINH,  TM_DUOC.DONVITINH_ID,TM_DUOC.BHYT,        TM_DUOC.TENHOATCHAT,        TM_DUOC.HAMLUONG, TM_DUOC.HANGSANXUAT, TM_DUOC.QUOCGIA, TM_DUOC.LOAIDUOC_ID, TM_DUOC.DUONGDUNG_ID,        TM_TENDUOC.TENDUOC, TM_TENDUOC.TENDUOC_EN, TM_TENDUOC.MAQUOCTE, TM_TENDUOC.MAQUOCTEBT,        TM_LOAIDUOC.LOAIVATTU_ID, TM_DUOC.BENHVIEN_ID,        TT_TONKHO.SOLUONG, TM_DUOC.VTYT_PHANLOAI, TM_DUOC.PHAMVI, TT_TONKHO.NGUONDUOC_ID, NG.TENNGUONDUOC AS TENNGUONDUOC        , TAMNGUNG = CASE WHEN TM_DUOC.TAMNGUNG = '1' OR NG.TAMNGUNG = '1' OR KD.TAMNGUNG = '1' THEN '1' ELSE '0' END        , TM_DUOC.DANGTRINHBAY        from TM_DUOC        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = TM_DUOC.DONVITINH_ID        left join TM_TENDUOC on TM_DUOC.TENDUOC_ID = TM_TENDUOC.TENDUOC_ID and TM_DUOC.BENHVIEN_ID = 'HLU01' and TM_DUOC.TAMNGUNG = '0'        left join TM_LOAIDUOC on TM_LOAIDUOC.LOAIDUOC_ID = TM_DUOC.LOAIDUOC_ID and TM_LOAIDUOC.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG on (TM_LOAIDUOC.LOAIVATTU_ID = TM_DUOC_HANDUNG.LOAIDUOC and TM_DUOC_HANDUNG.BENHVIEN_ID = 'HLU01')        inner join        (select LTRIM(A.KHODUOC_ID) + '_' + LTRIM(A.DUOC_ID) + '_' + LTRIM(ISNULL(A.NGUONDUOC_ID,'')) as DUOC_KEY, A.KHODUOC_ID, A.DUOC_ID, A.NGUONDUOC_ID,        SUM(isnull(A.SOLUONG,0)) as SOLUONG        from        (select SUM(SOLUONG) as SOLUONG, KHODUOC_ID, DUOC_ID, NGUONDUOC_ID from TT_DUOC_TONKHO        where BENHVIEN_ID = 'HLU01' group by KHODUOC_ID, DUOC_ID, NGUONDUOC_ID) A        group by LTRIM(A.KHODUOC_ID) + '_' + LTRIM(A.DUOC_ID) + '_' + LTRIM(ISNULL(A.NGUONDUOC_ID,'')), A.KHODUOC_ID, A.DUOC_ID, NGUONDUOC_ID        ) TT_TONKHO on TT_TONKHO.DUOC_ID = TM_DUOC.DUOC_ID        LEFT JOIN TM_NGUONHANG NG ON NG.NGUONDUOC_ID = TT_TONKHO.NGUONDUOC_ID        LEFT JOIN TM_KHODUOC KD ON KD.KHODUOC_ID = TT_TONKHO.KHODUOC_ID        where TM_DUOC.BENHVIEN_ID = 'HLU01' and TT_TONKHO.SOLUONG >= 0        and TM_DUOC.DUOC_ID in (1)]
2019-09-20 16:52:59,137 [1] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoVaBookingCOM23UpdateRedis] PreparedStatement : [declare @NGUONDUOC_MACDINH varchar(5) = '0';        declare @TOAMUANGOAI int = 0;        select @NGUONDUOC_MACDINH = isnull(VALUE,0) from TM_SYS_APPSETTINGS where CODE = 'PHA_NGUONDUOC'        select @TOAMUANGOAI = isnull(VALUE,0) from TM_SYS_APPSETTINGS where CODE = 'OPD_TOAMUANGOAI_DUNGDANHMUC_DUOC'                if @TOAMUANGOAI = 1        begin        select  distinct '0' + '_' + LTRIM(d.DUOC_ID) + '_' + @NGUONDUOC_MACDINH as DUOC_KEY, 0 as PHAMVI_ID, @NGUONDUOC_MACDINH as NGUONDUOC_ID, null as TENNGUONDUOC, null as TINHTIEN, d.DUOC_ID, ld.MALOAIDUOC,        d.SOVISA,d.TYLE_VAT,d.COTOA, d.MADUOC, d.TENHANG, d.TENDUOCDAYDU, dvt.TENDONVITINH as DONVITINH, d.BHYT,        d.TENHOATCHAT, d.HAMLUONG, d.HANGSANXUAT, d.QUOCGIA, d.LOAIDUOC_ID, d.DUONGDUNG_ID, d.TINHTIEN_PTTT,        ten.TENDUOC, ten.TENDUOC_EN, ten.MAQUOCTE, ten.MAQUOCTEBT,        '' as BHYT_TEXT        , ld.LOAIVATTU_ID        , d.BENHVIEN_ID,        999999999 as SOLUONG, d.VTYT_PHANLOAI, d.PHAMVI, d.SUASOLUONGTONGHOP, d.MADUOCBV, d.DANGTRINHBAY        , TAMNGUNG = CASE WHEN d.TAMNGUNG = '1' THEN '1' ELSE '0' END        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        where d.DUOC_ID in (1)        union all        select  distinct tk.DUOC_KEY, LTRIM(tk.PHAMVI_ID) as PHAMVI_ID, tk.NGUONDUOC_ID, nh.TENNGUONDUOC, nh.TINHTIEN, d.DUOC_ID, ld.MALOAIDUOC,        d.SOVISA,d.TYLE_VAT,d.COTOA, d.MADUOC, d.TENHANG, d.TENDUOCDAYDU, dvt.TENDONVITINH as DONVITINH, d.BHYT,        d.TENHOATCHAT, d.HAMLUONG, d.HANGSANXUAT, d.QUOCGIA, d.LOAIDUOC_ID, d.DUONGDUNG_ID, d.TINHTIEN_PTTT,        ten.TENDUOC, ten.TENDUOC_EN, ten.MAQUOCTE, ten.MAQUOCTEBT,        CASE WHEN d.BHYT = '1' THEN 'BHYT' ELSE '' END as BHYT_TEXT        , ld.LOAIVATTU_ID        , d.BENHVIEN_ID,        tk.SOLUONG, d.VTYT_PHANLOAI, d.PHAMVI, d.SUASOLUONGTONGHOP, d.MADUOCBV, d.DANGTRINHBAY        , TAMNGUNG = CASE WHEN d.TAMNGUNG = '1' OR nh.TAMNGUNG = '1' OR kd.TAMNGUNG = '1' THEN '1' ELSE '0' END        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        inner join        (        select  LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')) DUOC_KEY, (SUM(dtk.SOLUONG) - isnull(sum(A.SOLUONG),0) - isnull(sum(B.SOLUONG),0)) SOLUONG, pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        from (select sum(soluong) soluong,duoc_id,nguonduoc_id,khoduoc_id,benhvien_id from TT_DUOC_TONKHO  group by duoc_id,nguonduoc_id,khoduoc_id,benhvien_id) dtk        inner join TM_DUOC_PHAMVISD_MAPPING pvsd on dtk.KHODUOC_ID = pvsd.KHODUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NOITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) B on B.DUOC_ID = dtk.DUOC_ID and B.SOLUONG > 0 and B.PHAMVI_ID = pvsd.PHAMVI_ID and B.NGUONHANG_ID = dtk.NGUONDUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NGOAITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) A on A.DUOC_ID = dtk.DUOC_ID and A.SOLUONG > 0 and A.PHAMVI_ID = pvsd.PHAMVI_ID and A.NGUONHANG_ID = dtk.NGUONDUOC_ID        where dtk.SOLUONG > 0 and dtk.BENHVIEN_ID = 'HLU01'        group by LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')), pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        ) tk on tk.DUOC_ID = d.DUOC_ID        left join TM_DUOC_PHAMVISUDUNG kd on kd.PHAMVI_ID = tk.PHAMVI_ID and kd.BENHVIEN_ID = 'HLU01'        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = tk.NGUONDUOC_ID and nh.BENHVIEN_ID = 'HLU01'        where  d.BENHVIEN_ID = 'HLU01' and d.DUOC_ID in (1)        end        else        begin        select  distinct tk.DUOC_KEY, LTRIM(tk.PHAMVI_ID) as PHAMVI_ID, tk.NGUONDUOC_ID, nh.TENNGUONDUOC, nh.TINHTIEN, d.DUOC_ID, ld.MALOAIDUOC,        d.SOVISA,d.TYLE_VAT,d.COTOA, d.MADUOC, d.TENHANG, d.TENDUOCDAYDU, dvt.TENDONVITINH as DONVITINH, d.BHYT,        d.TENHOATCHAT, d.HAMLUONG, d.HANGSANXUAT, d.QUOCGIA, d.LOAIDUOC_ID, d.DUONGDUNG_ID, d.TINHTIEN_PTTT,        ten.TENDUOC, ten.TENDUOC_EN, ten.MAQUOCTE, ten.MAQUOCTEBT,        CASE WHEN d.BHYT = '1' THEN 'BHYT' ELSE '' END as BHYT_TEXT        , ld.LOAIVATTU_ID        , d.BENHVIEN_ID,        tk.SOLUONG, d.VTYT_PHANLOAI, d.PHAMVI, d.SUASOLUONGTONGHOP, d.MADUOCBV, d.DANGTRINHBAY        , TAMNGUNG = CASE WHEN d.TAMNGUNG = '1' OR nh.TAMNGUNG = '1' OR kd.TAMNGUNG = '1' THEN '1' ELSE '0' END        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        inner join        (        select  LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')) DUOC_KEY, (SUM(dtk.SOLUONG) - isnull(sum(A.SOLUONG),0) - isnull(sum(B.SOLUONG),0)) SOLUONG, pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        from (select sum(soluong) soluong,duoc_id,nguonduoc_id,khoduoc_id,benhvien_id from TT_DUOC_TONKHO  group by duoc_id,nguonduoc_id,khoduoc_id,benhvien_id) dtk        inner join TM_DUOC_PHAMVISD_MAPPING pvsd on dtk.KHODUOC_ID = pvsd.KHODUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NOITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) B on B.DUOC_ID = dtk.DUOC_ID and B.SOLUONG > 0 and B.PHAMVI_ID = pvsd.PHAMVI_ID and B.NGUONHANG_ID = dtk.NGUONDUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NGOAITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) A on A.DUOC_ID = dtk.DUOC_ID and A.SOLUONG > 0 and A.PHAMVI_ID = pvsd.PHAMVI_ID and A.NGUONHANG_ID = dtk.NGUONDUOC_ID        where dtk.SOLUONG > 0 and dtk.BENHVIEN_ID = 'HLU01'        group by LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')), pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        ) tk on tk.DUOC_ID = d.DUOC_ID        left join TM_DUOC_PHAMVISUDUNG kd on kd.PHAMVI_ID = tk.PHAMVI_ID and kd.BENHVIEN_ID = 'HLU01'        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = tk.NGUONDUOC_ID and nh.BENHVIEN_ID = 'HLU01'        where  d.BENHVIEN_ID = 'HLU01' and d.DUOC_ID in (1)        end]
2019-09-20 16:52:59,469 [1] DEBUG - Statement Id: [DAO00083_GetList_PhieuGhiNhanVTYT] PreparedStatement : [select DICHVU_GHINHANVTYT_ID, SOPHIEU, KHAMBENH_ID, TIEPNHAN_ID, DVYEUCAU_ID        from TT_DICHVU_GHINHANVTYT        where TIEPNHAN_ID = '27478'        and BENHVIEN_ID = 'HLU01'         and           KHAMBENH_ID = '26173'         and           DVYEUCAU_ID = '205443'                 order by THOIGIANGHINHAN desc]
2019-09-20 16:52:59,525 [1] DEBUG - Statement Id: [DAO00083_GetDSVTYTGhiNhan] PreparedStatement : [select A.*, dc.TENDUOCDAYDU, dc.BHYT DUOC_BHYT, ld.LOAIVATTU_ID, dc.DONVITINH        from TT_NGOAITRU_KHAMBENH_VTYT A        left join TM_DUOC dc on A.DUOC_ID = dc.DUOC_ID        left join TM_LOAIDUOC ld on dc.LOAIDUOC_ID = ld.LOAIDUOC_ID        where A.DVYEUCAU_ID =  @param0          and           A.DICHVU_GHINHANVTYT_ID = '4918'                 order by A.KHAMBENH_VTYT_ID]
2019-09-20 16:52:59,525 [1] DEBUG - Statement Id: [DAO00083_GetDSVTYTGhiNhan] Parameters: [@param0=[DVYEUCAU_ID,205443]]
2019-09-20 16:52:59,525 [1] DEBUG - Statement Id: [DAO00083_GetDSVTYTGhiNhan] Types: [@param0=[Int64, System.Int64]]
2019-09-20 16:52:59,573 [1] DEBUG - Statement Id: [DAO00063_GetSoChungTuByChungTuID] PreparedStatement : [select MACHUNGTU as SOCHUNGTU        from TT_DUOC_CHUNGTU        where CHUNGTU_ID  = '137702']
2019-09-20 16:52:59,609 [1] DEBUG - Statement Id: [DAO00023_GetTTVienPhiThuoc] PreparedStatement : [select *        from TT_VIENPHI        where REF_ID = '10593'        and REF_TABLE = 'TT_NGOAITRU_KHAMBENH_VTYT']
2019-09-20 16:52:59,679 [1] DEBUG - Statement Id: [DAO00066_GetBENHAN_TIEPNHAN] PreparedStatement : [select top 1 *        from TT_NOITRU_BENHAN        where TIEPNHAN_ID = '27478'  and BENHVIEN_ID = 'HLU01'        order by NGAYTAO desc]
2019-09-20 16:53:03,942 [1] DEBUG - Statement Id: [DAO00083_GetDSVTYTGhiNhan] PreparedStatement : [select A.*, dc.TENDUOCDAYDU, dc.BHYT DUOC_BHYT, ld.LOAIVATTU_ID, dc.DONVITINH        from TT_NGOAITRU_KHAMBENH_VTYT A        left join TM_DUOC dc on A.DUOC_ID = dc.DUOC_ID        left join TM_LOAIDUOC ld on dc.LOAIDUOC_ID = ld.LOAIDUOC_ID        where A.DVYEUCAU_ID =  @param0          and           A.DICHVU_GHINHANVTYT_ID = '4918'                 order by A.KHAMBENH_VTYT_ID]
2019-09-20 16:53:03,942 [1] DEBUG - Statement Id: [DAO00083_GetDSVTYTGhiNhan] Parameters: [@param0=[DVYEUCAU_ID,205443]]
2019-09-20 16:53:03,942 [1] DEBUG - Statement Id: [DAO00083_GetDSVTYTGhiNhan] Types: [@param0=[Int64, System.Int64]]
2019-09-20 16:53:03,975 [1] DEBUG - Statement Id: [DAO00063_GetSoChungTuByChungTuID] PreparedStatement : [select MACHUNGTU as SOCHUNGTU        from TT_DUOC_CHUNGTU        where CHUNGTU_ID  = '137702']
2019-09-20 16:53:04,005 [1] DEBUG - Statement Id: [DAO00023_GetTTVienPhiThuoc] PreparedStatement : [select *        from TT_VIENPHI        where REF_ID = '10593'        and REF_TABLE = 'TT_NGOAITRU_KHAMBENH_VTYT']
2019-09-20 16:54:40,956 [1] DEBUG - Statement Id: [DAO00030_GetMucDichChungTuID] PreparedStatement : [SELECT DICTIONARY_ID              FROM              LST_DICTIONARY              WHERE              DICTIONARY_TYPE_CODE = 'MucDichChungTu'              and DICTIONARY_CODE = 'X13']
2019-09-20 16:54:41,060 [1] DEBUG - Statement Id: [DAO00030_GetMucDichChungTuID] PreparedStatement : [SELECT DICTIONARY_ID              FROM              LST_DICTIONARY              WHERE              DICTIONARY_TYPE_CODE = 'MucDichChungTu'              and DICTIONARY_CODE = 'X13']
2019-09-20 16:54:46,333 [1] DEBUG - Statement Id: [DAO00030_XUATSUDUNG_TOANOITRU] PreparedStatement : [SELECT            N'Người bệnh: ' + BN.MAYTE + ' - ' + BN.TENBENHNHAN + ' - '  + N'Bệnh án: ' + BA.SOBENHAN  as BENHNHAN,            CASE WHEN BN.GIOITINH = 1 THEN 'Nam' WHEN BN.GIOITINH = 2 THEN N'Nữ'  END  AS GIOITINH ,            CASE WHEN BN.NGAYSINH IS NOT NULL THEN CONVERT(VARCHAR(10), BN.NGAYSINH, 103) ELSE CONVERT(VARCHAR(10), BN.NAMSINH) END as NGAYSINH,            CASE WHEN dt.TENDOITUONG IS NOT NULL THEN dt.TENDOITUONG  ELSE '' END as DOITUONG,            N'Y lệnh:' + TT.SOTHUTUTOA + ' - Ngày: ' + CONVERT(VARCHAR(10), KB.THOIGIANKHAM, 103) + ' - ' + CONVERT(VARCHAR(5), KB.THOIGIANKHAM, 108)            + CASE WHEN NV.TENNHANVIEN IS NOT NULL THEN + N' - Người lập: ' +  NV.TENNHANVIEN ELSE '' END            AS YLENH,            TT.TOATHUOC_ID,            TT.SOTHUTUTOA as REF_ID,            PL.MACHUNGTU,            TT.DUOC_ID,            d.MADUOC,            d.TENDUOCDAYDU,            d.DONVITINH,            TT.SOLUONG as SOLUONGYEUCAU,            trt.SOLUONG as SOLUONGTRA,            TT.NGAYTAO            FROM            TT_NOITRU_TOATHUOC TT            inner join TT_NOITRU_KHAMBENH KB on KB.KHAMBENH_ID = TT.KHAMBENH_ID            inner join TT_NOITRU_BENHAN BA on BA.BENHAN_ID = KB.BENHAN_ID            inner join TT_BENHNHAN BN on BA.BENHNHAN_ID = BN.BENHNHAN_ID            inner join TM_DUOC D on D.DUOC_ID = TT.DUOC_ID            inner join TM_LOAIDUOC LD on LD.LOAIDUOC_ID = D.LOAIDUOC_ID            left join TM_DOITUONG dt on BA.DOITUONG_ID = dt.DOITUONG_ID            left join TT_DUOC_PHIEULINH PL on PL.CHUNGTU_ID = TT.PHIEULINH_ID            left join TT_NOITRU_TRATHUOC_CHITIET trt on (trt.TOATHUOC_ID = TT.TOATHUOC_ID)            left join TM_NHANVIEN NV on TT.NGUOITAO_ID = NV.NHANVIEN_ID            WHERE            CONVERT(date, KB.THOIGIANKHAM) BETWEEN  CONVERT(date, '2/1/2019 12:00:00 AM')  AND  CONVERT(date, '9/20/2019 12:00:00 AM')            AND TT.CHUNGTU_ID is null            AND BA.TRANGTHAI = 'DANGDIEUTRI'            AND TT.PHONGBANRATOA_ID = '62'             and               TT.KHOTAO_ID = '32'                         AND (            (tt.COSO = '0'            AND tt.PHIEULINH_ID IS NOT NULL            AND tt.TOATHUOC_ID IN            (SELECT ctct.TOATHUOCNOITRU_ID FROM TT_DUOC_CHUNGTU_CHITIET ctct            inner join TT_DUOC_CHUNGTU ct on ct.CHUNGTU_ID = ctct.CHUNGTU_ID            and ct.MUCDICHCHUNGTU_CODE = 'N05'            and ct.KHONHAP_ID =  '32'            )            )            or            (tt.COSO = '1')            )            AND TT.BENHVIEN_ID = 'HLU01'            AND (BN.TENBENHNHAN like N'%%' OR BN.MAYTE like N'%%'  OR  BA.SOBENHAN  like N'%%'            or D.TENDUOCDAYDU like N'%%'            OR PL.MACHUNGTU like '%%'            )            AND LD.LOAIVATTU_ID = 'V'            order by NGAYTAO DESC]
2019-09-20 16:54:46,527 [1] DEBUG - Statement Id: [DAO00030_XUATSUDUNG_KHAMBENH_NGOAITRU_VTYT] PreparedStatement : [SELECT            N'Người bệnh: ' + BN.MAYTE + ' - ' + BN.TENBENHNHAN + ' - ' + N'Số TN: ' + TN.SOTIEPNHAN  as BENHNHAN,            CASE WHEN BN.GIOITINH = 1 THEN 'Nam' WHEN BN.GIOITINH = 2 THEN N'Nữ' END  AS GIOITINH ,            CASE WHEN BN.NGAYSINH IS NOT NULL THEN CONVERT(VARCHAR(10), BN.NGAYSINH, 103) ELSE CONVERT(VARCHAR(10), BN.NAMSINH) END as NGAYSINH,            CASE WHEN dt.TENDOITUONG IS NOT NULL THEN dt.TENDOITUONG  ELSE '' END as DOITUONG,            N'VTYT Ngoại trú ngày: ' + CONVERT(VARCHAR(10), VT.NGAYTAO, 103) + ' - ' + CONVERT(VARCHAR(5), VT.NGAYTAO, 108)            + CASE WHEN NV.TENNHANVIEN IS NOT NULL THEN + N' - Người lập: ' +  NV.TENNHANVIEN ELSE '' END            AS YLENH,            VT.KHAMBENH_VTYT_ID as TOATHUOC_ID,            DV.DVYEUCAU_ID as REF_ID,            PL.MACHUNGTU,            VT.DUOC_ID,            d.MADUOC,            d.TENDUOCDAYDU,            d.DONVITINH,            VT.SOLUONG as SOLUONGYEUCAU,            VT.NGAYTAO            FROM            TT_NGOAITRU_KHAMBENH_VTYT VT            inner join TT_DVYEUCAU DV on DV.DVYEUCAU_ID = VT.DVYEUCAU_ID            inner join TT_BENHNHAN BN on DV.BENHNHAN_ID = BN.BENHNHAN_ID            inner join TT_TIEPNHAN TN on TN.TIEPNHAN_ID = DV.TIEPNHAN_ID            left join TM_DOITUONG dt on TN.DOITUONG_ID = dt.DOITUONG_ID            left join TM_NHANVIEN NV on VT.NGUOITAO_ID = NV.NHANVIEN_ID            inner join TM_DUOC D on D.DUOC_ID = VT.DUOC_ID            inner join TM_LOAIDUOC LD on LD.LOAIDUOC_ID = D.LOAIDUOC_ID            left join TT_DUOC_PHIEULINH PL on PL.CHUNGTU_ID = VT.PHIEULINH_ID            WHERE            CONVERT(date, VT.NGAYTAO) BETWEEN  CONVERT(date, '2/1/2019 12:00:00 AM')  AND  CONVERT(date, '9/20/2019 12:00:00 AM')            AND VT.CHUNGTU_ID is null            AND VT.PHONGBAN_ID = '62'                          AND VT.BENHVIEN_ID = 'HLU01'              AND (BN.TENBENHNHAN like N'%%' OR BN.MAYTE like N'%%'              OR  TN.SOTIEPNHAN  like N'%%' or D.TENDUOCDAYDU like N'%%'              OR PL.MACHUNGTU like '%%'              )              AND LD.LOAIVATTU_ID = 'V'              order by NGAYTAO DESC]
2019-09-20 16:54:46,649 [1] DEBUG - Statement Id: [DAO00030_XUATSUDUNG_PTTT_VTYT] PreparedStatement : [SELECT            N'Người bệnh: ' + BN.MAYTE + ' - ' + BN.TENBENHNHAN + ' - '  + N'Số TN: ' + TN.SOTIEPNHAN  as BENHNHAN,            CASE WHEN BN.GIOITINH = 1 THEN 'Nam' WHEN BN.GIOITINH = 2 THEN N'Nữ' END  AS GIOITINH,            CASE WHEN BN.NGAYSINH IS NOT NULL THEN CONVERT(VARCHAR(10), BN.NGAYSINH, 103) ELSE CONVERT(VARCHAR(10), BN.NAMSINH) END as NGAYSINH,            CASE WHEN dt.TENDOITUONG IS NOT NULL THEN dt.TENDOITUONG  ELSE '' END as DOITUONG,            CASE            WHEN PT.LOAI = 'P'THEN N'Số phiếu Phẫu thuật: ' +  ISNULL(PT.SOPHIEUPHAUTHUAT,'')  + N' - Ngày: ' +  CONVERT(VARCHAR(10), ISNULL(VT.NGAYTAO,''), 103) + ' - ' + CONVERT(VARCHAR(5), ISNULL(VT.NGAYTAO,''), 108) + CASE WHEN NV.TENNHANVIEN IS NOT NULL THEN + N' - Người lập: ' +  NV.TENNHANVIEN ELSE '' END            ELSE N'Số phiếu Thủ thuật: ' +  ISNULL(PT.SOPHIEUPHAUTHUAT,'')  + N' - Ngày: ' +  CONVERT(VARCHAR(10), ISNULL(VT.NGAYTAO,''), 103) + ' - ' + CONVERT(VARCHAR(5), ISNULL(VT.NGAYTAO,''), 108) + CASE WHEN NV.TENNHANVIEN IS NOT NULL THEN + N' - Người lập: ' +  NV.TENNHANVIEN ELSE '' END            END  AS YLENH,            VT.PHAUTHUAT_VTYT_ID as TOATHUOC_ID,            VT.PHAUTHUAT_ID as REF_ID,            PL.MACHUNGTU,            VT.DUOC_ID,            d.MADUOC,            d.TENDUOCDAYDU,            d.DONVITINH,            VT.SOLUONG as SOLUONGYEUCAU,            VT.NGAYTAO            FROM            TT_PHAUTHUAT_VTYT VT            inner join TT_PHAUTHUAT PT on PT.PHAUTHUAT_ID = VT.PHAUTHUAT_ID            left join TT_TIEPNHAN TN on TN.TIEPNHAN_ID = PT.TIEPNHAN_ID            left join TT_BENHNHAN BN on BN.BENHNHAN_ID = TN.BENHNHAN_ID            left join TM_DOITUONG dt on TN.DOITUONG_ID = dt.DOITUONG_ID            left join TM_DUOC D on D.DUOC_ID = VT.DUOC_ID            left join TM_LOAIDUOC LD on LD.LOAIDUOC_ID = D.LOAIDUOC_ID            left join TM_NHANVIEN NV on VT.NGUOITAO_ID = NV.NHANVIEN_ID            left join TT_DUOC_PHIEULINH PL on PL.CHUNGTU_ID = VT.CHUNGTU_ID            WHERE            CONVERT(date, VT.NGAYTAO) BETWEEN  CONVERT(date, '2/1/2019 12:00:00 AM')  AND  CONVERT(date, '9/20/2019 12:00:00 AM')            AND VT.CHUNGTU_ID is null                          AND PT.PHONGBANTHUCHIEN_ID = '62'              AND VT.BENHVIEN_ID = 'HLU01'              AND (BN.TENBENHNHAN like N'%%' OR BN.MAYTE like N'%%' OR  TN.SOTIEPNHAN  like N'%%' or D.TENDUOCDAYDU like N'%%'              OR PL.MACHUNGTU like '%%'              )              AND LD.LOAIVATTU_ID = 'V'              order by NGAYTAO DESC]
2019-09-20 16:54:46,685 [1] DEBUG - Statement Id: [DAO00030_XUATSUDUNG_CLS_VTYT] PreparedStatement : [SELECT            N'Người bệnh: ' + BN.MAYTE + ' - ' + BN.TENBENHNHAN + ' - '  + N'Số TN: ' + TN.SOTIEPNHAN  as BENHNHAN,            CASE WHEN BN.GIOITINH = 1 THEN 'Nam' WHEN BN.GIOITINH = 2 THEN N'Nữ' END  AS GIOITINH,            CASE WHEN BN.NGAYSINH IS NOT NULL THEN CONVERT(VARCHAR(10), BN.NGAYSINH, 103) ELSE CONVERT(VARCHAR(10), BN.NAMSINH) END as NGAYSINH,            CASE WHEN dt.TENDOITUONG IS NOT NULL THEN dt.TENDOITUONG  ELSE '' END as DOITUONG,            N'Số phiếu CLS: ' +  ISNULL(DV.SOPHIEUYEUCAU,'')  + N' - Ngày: ' +  CONVERT(VARCHAR(10), ISNULL(CLS_VT.NGAYTAO,''), 103) + ' - ' + CONVERT(VARCHAR(5), ISNULL(CLS_VT.NGAYTAO,''), 108) + CASE WHEN NV.TENNHANVIEN IS NOT NULL THEN + N' - Người lập: ' +  NV.TENNHANVIEN ELSE '' END            AS YLENH,            CLS_VT.CLSKETQUA_VTYT_ID as TOATHUOC_ID,            DV.DVYEUCAU_ID as REF_ID,            PL.MACHUNGTU,            CLS_VT.DUOC_ID,            d.MADUOC,            d.TENDUOCDAYDU,            d.DONVITINH,            CLS_VT.SOLUONG as SOLUONGYEUCAU,            CLS_VT.NGAYTAO            FROM            TT_CLSKETQUA_VTYT CLS_VT            inner join TT_DVYEUCAU DV on DV.DVYEUCAU_ID = CLS_VT.DVYEUCAU_ID            left join TT_CLSKETQUA CLS on CLS.CLSKETQUA_ID = CLS_VT.CLSKETQUA_ID            left join TT_BENHNHAN BN on DV.BENHNHAN_ID = BN.BENHNHAN_ID            left join TT_TIEPNHAN TN on TN.TIEPNHAN_ID = DV.TIEPNHAN_ID            left join TM_PHONGBAN pb on pb.PHONGBAN_ID = CLS_VT.PHONGBAN_ID            left join TM_DOITUONG dt on dt.DOITUONG_ID = DV.DOITUONG_ID            left join TM_NHANVIEN NV on NV.NHANVIEN_ID = CLS_VT.NGUOITAO_ID            left join TM_DUOC D on D.DUOC_ID = CLS_VT.DUOC_ID            left join TM_LOAIDUOC LD on LD.LOAIDUOC_ID = D.LOAIDUOC_ID            left join TT_DUOC_PHIEULINH PL on PL.CHUNGTU_ID = CLS_VT.CHUNGTU_ID            WHERE            CONVERT(date, CLS_VT.NGAYTAO) BETWEEN  CONVERT(date, '2/1/2019 12:00:00 AM')  AND  CONVERT(date, '9/20/2019 12:00:00 AM')            AND CLS_VT.CHUNGTU_ID is null                          AND CLS_VT.PHONGBAN_ID = '62'              AND CLS_VT.BENHVIEN_ID = 'HLU01'              AND (BN.TENBENHNHAN like N'%%' OR BN.MAYTE like N'%%' OR  TN.SOTIEPNHAN  like N'%%' or D.TENDUOCDAYDU like N'%%'              OR PL.MACHUNGTU like '%%'              )              AND LD.LOAIVATTU_ID = 'V'              order by NGAYTAO DESC]
2019-09-20 16:54:46,776 [1] DEBUG - Statement Id: [DAO00030_DUOCTONKHO_GetSoTonTheoDuoc] PreparedStatement : [SELECT              DUOC_ID,              SUM(SOLUONG) AS TONGTON              FROM              TT_DUOC_TONKHO              WHERE              KHODUOC_ID = '32'              and BENHVIEN_ID = 'HLU01'              and DUOC_ID IN (1,11,305,305,1,572,305,11,512,6,14,71,1,3,69,305,3)              GROUP BY DUOC_ID]
2019-09-20 16:54:52,219 [1] DEBUG - Statement Id: [DAO00030_XUATSUDUNG_TOANOITRU] PreparedStatement : [SELECT            N'Người bệnh: ' + BN.MAYTE + ' - ' + BN.TENBENHNHAN + ' - '  + N'Bệnh án: ' + BA.SOBENHAN  as BENHNHAN,            CASE WHEN BN.GIOITINH = 1 THEN 'Nam' WHEN BN.GIOITINH = 2 THEN N'Nữ'  END  AS GIOITINH ,            CASE WHEN BN.NGAYSINH IS NOT NULL THEN CONVERT(VARCHAR(10), BN.NGAYSINH, 103) ELSE CONVERT(VARCHAR(10), BN.NAMSINH) END as NGAYSINH,            CASE WHEN dt.TENDOITUONG IS NOT NULL THEN dt.TENDOITUONG  ELSE '' END as DOITUONG,            N'Y lệnh:' + TT.SOTHUTUTOA + ' - Ngày: ' + CONVERT(VARCHAR(10), KB.THOIGIANKHAM, 103) + ' - ' + CONVERT(VARCHAR(5), KB.THOIGIANKHAM, 108)            + CASE WHEN NV.TENNHANVIEN IS NOT NULL THEN + N' - Người lập: ' +  NV.TENNHANVIEN ELSE '' END            AS YLENH,            TT.TOATHUOC_ID,            TT.SOTHUTUTOA as REF_ID,            PL.MACHUNGTU,            TT.DUOC_ID,            d.MADUOC,            d.TENDUOCDAYDU,            d.DONVITINH,            TT.SOLUONG as SOLUONGYEUCAU,            trt.SOLUONG as SOLUONGTRA,            TT.NGAYTAO            FROM            TT_NOITRU_TOATHUOC TT            inner join TT_NOITRU_KHAMBENH KB on KB.KHAMBENH_ID = TT.KHAMBENH_ID            inner join TT_NOITRU_BENHAN BA on BA.BENHAN_ID = KB.BENHAN_ID            inner join TT_BENHNHAN BN on BA.BENHNHAN_ID = BN.BENHNHAN_ID            inner join TM_DUOC D on D.DUOC_ID = TT.DUOC_ID            inner join TM_LOAIDUOC LD on LD.LOAIDUOC_ID = D.LOAIDUOC_ID            left join TM_DOITUONG dt on BA.DOITUONG_ID = dt.DOITUONG_ID            left join TT_DUOC_PHIEULINH PL on PL.CHUNGTU_ID = TT.PHIEULINH_ID            left join TT_NOITRU_TRATHUOC_CHITIET trt on (trt.TOATHUOC_ID = TT.TOATHUOC_ID)            left join TM_NHANVIEN NV on TT.NGUOITAO_ID = NV.NHANVIEN_ID            WHERE            CONVERT(date, KB.THOIGIANKHAM) BETWEEN  CONVERT(date, '2/1/2019 12:00:00 AM')  AND  CONVERT(date, '9/20/2019 12:00:00 AM')            AND TT.CHUNGTU_ID is null            AND BA.TRANGTHAI = 'DANGDIEUTRI'            AND TT.PHONGBANRATOA_ID = '62'             and               TT.KHOTAO_ID = '32'                         AND (            (tt.COSO = '0'            AND tt.PHIEULINH_ID IS NOT NULL            AND tt.TOATHUOC_ID IN            (SELECT ctct.TOATHUOCNOITRU_ID FROM TT_DUOC_CHUNGTU_CHITIET ctct            inner join TT_DUOC_CHUNGTU ct on ct.CHUNGTU_ID = ctct.CHUNGTU_ID            and ct.MUCDICHCHUNGTU_CODE = 'N05'            and ct.KHONHAP_ID =  '32'            )            )            or            (tt.COSO = '1')            )            AND TT.BENHVIEN_ID = 'HLU01'            AND (BN.TENBENHNHAN like N'%%' OR BN.MAYTE like N'%%'  OR  BA.SOBENHAN  like N'%%'            or D.TENDUOCDAYDU like N'%%'            OR PL.MACHUNGTU like '%%'            )            AND LD.LOAIVATTU_ID = 'V'            order by NGAYTAO DESC]
2019-09-20 16:54:54,692 [1] DEBUG - Statement Id: [DAO00030_XUATSUDUNG_KHAMBENH_NGOAITRU_VTYT] PreparedStatement : [SELECT            N'Người bệnh: ' + BN.MAYTE + ' - ' + BN.TENBENHNHAN + ' - ' + N'Số TN: ' + TN.SOTIEPNHAN  as BENHNHAN,            CASE WHEN BN.GIOITINH = 1 THEN 'Nam' WHEN BN.GIOITINH = 2 THEN N'Nữ' END  AS GIOITINH ,            CASE WHEN BN.NGAYSINH IS NOT NULL THEN CONVERT(VARCHAR(10), BN.NGAYSINH, 103) ELSE CONVERT(VARCHAR(10), BN.NAMSINH) END as NGAYSINH,            CASE WHEN dt.TENDOITUONG IS NOT NULL THEN dt.TENDOITUONG  ELSE '' END as DOITUONG,            N'VTYT Ngoại trú ngày: ' + CONVERT(VARCHAR(10), VT.NGAYTAO, 103) + ' - ' + CONVERT(VARCHAR(5), VT.NGAYTAO, 108)            + CASE WHEN NV.TENNHANVIEN IS NOT NULL THEN + N' - Người lập: ' +  NV.TENNHANVIEN ELSE '' END            AS YLENH,            VT.KHAMBENH_VTYT_ID as TOATHUOC_ID,            DV.DVYEUCAU_ID as REF_ID,            PL.MACHUNGTU,            VT.DUOC_ID,            d.MADUOC,            d.TENDUOCDAYDU,            d.DONVITINH,            VT.SOLUONG as SOLUONGYEUCAU,            VT.NGAYTAO            FROM            TT_NGOAITRU_KHAMBENH_VTYT VT            inner join TT_DVYEUCAU DV on DV.DVYEUCAU_ID = VT.DVYEUCAU_ID            inner join TT_BENHNHAN BN on DV.BENHNHAN_ID = BN.BENHNHAN_ID            inner join TT_TIEPNHAN TN on TN.TIEPNHAN_ID = DV.TIEPNHAN_ID            left join TM_DOITUONG dt on TN.DOITUONG_ID = dt.DOITUONG_ID            left join TM_NHANVIEN NV on VT.NGUOITAO_ID = NV.NHANVIEN_ID            inner join TM_DUOC D on D.DUOC_ID = VT.DUOC_ID            inner join TM_LOAIDUOC LD on LD.LOAIDUOC_ID = D.LOAIDUOC_ID            left join TT_DUOC_PHIEULINH PL on PL.CHUNGTU_ID = VT.PHIEULINH_ID            WHERE            CONVERT(date, VT.NGAYTAO) BETWEEN  CONVERT(date, '2/1/2019 12:00:00 AM')  AND  CONVERT(date, '9/20/2019 12:00:00 AM')            AND VT.CHUNGTU_ID is null            AND VT.PHONGBAN_ID = '62'                          AND VT.BENHVIEN_ID = 'HLU01'              AND (BN.TENBENHNHAN like N'%%' OR BN.MAYTE like N'%%'              OR  TN.SOTIEPNHAN  like N'%%' or D.TENDUOCDAYDU like N'%%'              OR PL.MACHUNGTU like '%%'              )              AND LD.LOAIVATTU_ID = 'V'              order by NGAYTAO DESC]
2019-09-20 16:54:54,804 [1] DEBUG - Statement Id: [DAO00030_XUATSUDUNG_PTTT_VTYT] PreparedStatement : [SELECT            N'Người bệnh: ' + BN.MAYTE + ' - ' + BN.TENBENHNHAN + ' - '  + N'Số TN: ' + TN.SOTIEPNHAN  as BENHNHAN,            CASE WHEN BN.GIOITINH = 1 THEN 'Nam' WHEN BN.GIOITINH = 2 THEN N'Nữ' END  AS GIOITINH,            CASE WHEN BN.NGAYSINH IS NOT NULL THEN CONVERT(VARCHAR(10), BN.NGAYSINH, 103) ELSE CONVERT(VARCHAR(10), BN.NAMSINH) END as NGAYSINH,            CASE WHEN dt.TENDOITUONG IS NOT NULL THEN dt.TENDOITUONG  ELSE '' END as DOITUONG,            CASE            WHEN PT.LOAI = 'P'THEN N'Số phiếu Phẫu thuật: ' +  ISNULL(PT.SOPHIEUPHAUTHUAT,'')  + N' - Ngày: ' +  CONVERT(VARCHAR(10), ISNULL(VT.NGAYTAO,''), 103) + ' - ' + CONVERT(VARCHAR(5), ISNULL(VT.NGAYTAO,''), 108) + CASE WHEN NV.TENNHANVIEN IS NOT NULL THEN + N' - Người lập: ' +  NV.TENNHANVIEN ELSE '' END            ELSE N'Số phiếu Thủ thuật: ' +  ISNULL(PT.SOPHIEUPHAUTHUAT,'')  + N' - Ngày: ' +  CONVERT(VARCHAR(10), ISNULL(VT.NGAYTAO,''), 103) + ' - ' + CONVERT(VARCHAR(5), ISNULL(VT.NGAYTAO,''), 108) + CASE WHEN NV.TENNHANVIEN IS NOT NULL THEN + N' - Người lập: ' +  NV.TENNHANVIEN ELSE '' END            END  AS YLENH,            VT.PHAUTHUAT_VTYT_ID as TOATHUOC_ID,            VT.PHAUTHUAT_ID as REF_ID,            PL.MACHUNGTU,            VT.DUOC_ID,            d.MADUOC,            d.TENDUOCDAYDU,            d.DONVITINH,            VT.SOLUONG as SOLUONGYEUCAU,            VT.NGAYTAO            FROM            TT_PHAUTHUAT_VTYT VT            inner join TT_PHAUTHUAT PT on PT.PHAUTHUAT_ID = VT.PHAUTHUAT_ID            left join TT_TIEPNHAN TN on TN.TIEPNHAN_ID = PT.TIEPNHAN_ID            left join TT_BENHNHAN BN on BN.BENHNHAN_ID = TN.BENHNHAN_ID            left join TM_DOITUONG dt on TN.DOITUONG_ID = dt.DOITUONG_ID            left join TM_DUOC D on D.DUOC_ID = VT.DUOC_ID            left join TM_LOAIDUOC LD on LD.LOAIDUOC_ID = D.LOAIDUOC_ID            left join TM_NHANVIEN NV on VT.NGUOITAO_ID = NV.NHANVIEN_ID            left join TT_DUOC_PHIEULINH PL on PL.CHUNGTU_ID = VT.CHUNGTU_ID            WHERE            CONVERT(date, VT.NGAYTAO) BETWEEN  CONVERT(date, '2/1/2019 12:00:00 AM')  AND  CONVERT(date, '9/20/2019 12:00:00 AM')            AND VT.CHUNGTU_ID is null                          AND PT.PHONGBANTHUCHIEN_ID = '62'              AND VT.BENHVIEN_ID = 'HLU01'              AND (BN.TENBENHNHAN like N'%%' OR BN.MAYTE like N'%%' OR  TN.SOTIEPNHAN  like N'%%' or D.TENDUOCDAYDU like N'%%'              OR PL.MACHUNGTU like '%%'              )              AND LD.LOAIVATTU_ID = 'V'              order by NGAYTAO DESC]
2019-09-20 16:54:55,746 [1] DEBUG - Statement Id: [DAO00030_XUATSUDUNG_CLS_VTYT] PreparedStatement : [SELECT            N'Người bệnh: ' + BN.MAYTE + ' - ' + BN.TENBENHNHAN + ' - '  + N'Số TN: ' + TN.SOTIEPNHAN  as BENHNHAN,            CASE WHEN BN.GIOITINH = 1 THEN 'Nam' WHEN BN.GIOITINH = 2 THEN N'Nữ' END  AS GIOITINH,            CASE WHEN BN.NGAYSINH IS NOT NULL THEN CONVERT(VARCHAR(10), BN.NGAYSINH, 103) ELSE CONVERT(VARCHAR(10), BN.NAMSINH) END as NGAYSINH,            CASE WHEN dt.TENDOITUONG IS NOT NULL THEN dt.TENDOITUONG  ELSE '' END as DOITUONG,            N'Số phiếu CLS: ' +  ISNULL(DV.SOPHIEUYEUCAU,'')  + N' - Ngày: ' +  CONVERT(VARCHAR(10), ISNULL(CLS_VT.NGAYTAO,''), 103) + ' - ' + CONVERT(VARCHAR(5), ISNULL(CLS_VT.NGAYTAO,''), 108) + CASE WHEN NV.TENNHANVIEN IS NOT NULL THEN + N' - Người lập: ' +  NV.TENNHANVIEN ELSE '' END            AS YLENH,            CLS_VT.CLSKETQUA_VTYT_ID as TOATHUOC_ID,            DV.DVYEUCAU_ID as REF_ID,            PL.MACHUNGTU,            CLS_VT.DUOC_ID,            d.MADUOC,            d.TENDUOCDAYDU,            d.DONVITINH,            CLS_VT.SOLUONG as SOLUONGYEUCAU,            CLS_VT.NGAYTAO            FROM            TT_CLSKETQUA_VTYT CLS_VT            inner join TT_DVYEUCAU DV on DV.DVYEUCAU_ID = CLS_VT.DVYEUCAU_ID            left join TT_CLSKETQUA CLS on CLS.CLSKETQUA_ID = CLS_VT.CLSKETQUA_ID            left join TT_BENHNHAN BN on DV.BENHNHAN_ID = BN.BENHNHAN_ID            left join TT_TIEPNHAN TN on TN.TIEPNHAN_ID = DV.TIEPNHAN_ID            left join TM_PHONGBAN pb on pb.PHONGBAN_ID = CLS_VT.PHONGBAN_ID            left join TM_DOITUONG dt on dt.DOITUONG_ID = DV.DOITUONG_ID            left join TM_NHANVIEN NV on NV.NHANVIEN_ID = CLS_VT.NGUOITAO_ID            left join TM_DUOC D on D.DUOC_ID = CLS_VT.DUOC_ID            left join TM_LOAIDUOC LD on LD.LOAIDUOC_ID = D.LOAIDUOC_ID            left join TT_DUOC_PHIEULINH PL on PL.CHUNGTU_ID = CLS_VT.CHUNGTU_ID            WHERE            CONVERT(date, CLS_VT.NGAYTAO) BETWEEN  CONVERT(date, '2/1/2019 12:00:00 AM')  AND  CONVERT(date, '9/20/2019 12:00:00 AM')            AND CLS_VT.CHUNGTU_ID is null                          AND CLS_VT.PHONGBAN_ID = '62'              AND CLS_VT.BENHVIEN_ID = 'HLU01'              AND (BN.TENBENHNHAN like N'%%' OR BN.MAYTE like N'%%' OR  TN.SOTIEPNHAN  like N'%%' or D.TENDUOCDAYDU like N'%%'              OR PL.MACHUNGTU like '%%'              )              AND LD.LOAIVATTU_ID = 'V'              order by NGAYTAO DESC]
2019-09-20 16:54:55,782 [1] DEBUG - Statement Id: [DAO00030_DUOCTONKHO_GetSoTonTheoDuoc] PreparedStatement : [SELECT              DUOC_ID,              SUM(SOLUONG) AS TONGTON              FROM              TT_DUOC_TONKHO              WHERE              KHODUOC_ID = '32'              and BENHVIEN_ID = 'HLU01'              and DUOC_ID IN (1,11,305,305,1,572,305,11,512,6,14,71,1,3,69,305,3)              GROUP BY DUOC_ID]
2019-09-20 16:55:10,451 [1] DEBUG - Statement Id: [DAO00030_XUATSUDUNG_TOANOITRU] PreparedStatement : [SELECT            N'Người bệnh: ' + BN.MAYTE + ' - ' + BN.TENBENHNHAN + ' - '  + N'Bệnh án: ' + BA.SOBENHAN  as BENHNHAN,            CASE WHEN BN.GIOITINH = 1 THEN 'Nam' WHEN BN.GIOITINH = 2 THEN N'Nữ'  END  AS GIOITINH ,            CASE WHEN BN.NGAYSINH IS NOT NULL THEN CONVERT(VARCHAR(10), BN.NGAYSINH, 103) ELSE CONVERT(VARCHAR(10), BN.NAMSINH) END as NGAYSINH,            CASE WHEN dt.TENDOITUONG IS NOT NULL THEN dt.TENDOITUONG  ELSE '' END as DOITUONG,            N'Y lệnh:' + TT.SOTHUTUTOA + ' - Ngày: ' + CONVERT(VARCHAR(10), KB.THOIGIANKHAM, 103) + ' - ' + CONVERT(VARCHAR(5), KB.THOIGIANKHAM, 108)            + CASE WHEN NV.TENNHANVIEN IS NOT NULL THEN + N' - Người lập: ' +  NV.TENNHANVIEN ELSE '' END            AS YLENH,            TT.TOATHUOC_ID,            TT.SOTHUTUTOA as REF_ID,            PL.MACHUNGTU,            TT.DUOC_ID,            d.MADUOC,            d.TENDUOCDAYDU,            d.DONVITINH,            TT.SOLUONG as SOLUONGYEUCAU,            trt.SOLUONG as SOLUONGTRA,            TT.NGAYTAO            FROM            TT_NOITRU_TOATHUOC TT            inner join TT_NOITRU_KHAMBENH KB on KB.KHAMBENH_ID = TT.KHAMBENH_ID            inner join TT_NOITRU_BENHAN BA on BA.BENHAN_ID = KB.BENHAN_ID            inner join TT_BENHNHAN BN on BA.BENHNHAN_ID = BN.BENHNHAN_ID            inner join TM_DUOC D on D.DUOC_ID = TT.DUOC_ID            inner join TM_LOAIDUOC LD on LD.LOAIDUOC_ID = D.LOAIDUOC_ID            left join TM_DOITUONG dt on BA.DOITUONG_ID = dt.DOITUONG_ID            left join TT_DUOC_PHIEULINH PL on PL.CHUNGTU_ID = TT.PHIEULINH_ID            left join TT_NOITRU_TRATHUOC_CHITIET trt on (trt.TOATHUOC_ID = TT.TOATHUOC_ID)            left join TM_NHANVIEN NV on TT.NGUOITAO_ID = NV.NHANVIEN_ID            WHERE            CONVERT(date, KB.THOIGIANKHAM) BETWEEN  CONVERT(date, '9/20/2019 12:00:00 AM')  AND  CONVERT(date, '9/20/2019 12:00:00 AM')            AND TT.CHUNGTU_ID is null            AND BA.TRANGTHAI = 'DANGDIEUTRI'            AND TT.PHONGBANRATOA_ID = '62'             and               TT.KHOTAO_ID = '32'                         AND (            (tt.COSO = '0'            AND tt.PHIEULINH_ID IS NOT NULL            AND tt.TOATHUOC_ID IN            (SELECT ctct.TOATHUOCNOITRU_ID FROM TT_DUOC_CHUNGTU_CHITIET ctct            inner join TT_DUOC_CHUNGTU ct on ct.CHUNGTU_ID = ctct.CHUNGTU_ID            and ct.MUCDICHCHUNGTU_CODE = 'N05'            and ct.KHONHAP_ID =  '32'            )            )            or            (tt.COSO = '1')            )            AND TT.BENHVIEN_ID = 'HLU01'            AND (BN.TENBENHNHAN like N'%%' OR BN.MAYTE like N'%%'  OR  BA.SOBENHAN  like N'%%'            or D.TENDUOCDAYDU like N'%%'            OR PL.MACHUNGTU like '%%'            )            AND LD.LOAIVATTU_ID = 'V'            order by NGAYTAO DESC]
2019-09-20 16:55:11,899 [1] DEBUG - Statement Id: [DAO00030_XUATSUDUNG_KHAMBENH_NGOAITRU_VTYT] PreparedStatement : [SELECT            N'Người bệnh: ' + BN.MAYTE + ' - ' + BN.TENBENHNHAN + ' - ' + N'Số TN: ' + TN.SOTIEPNHAN  as BENHNHAN,            CASE WHEN BN.GIOITINH = 1 THEN 'Nam' WHEN BN.GIOITINH = 2 THEN N'Nữ' END  AS GIOITINH ,            CASE WHEN BN.NGAYSINH IS NOT NULL THEN CONVERT(VARCHAR(10), BN.NGAYSINH, 103) ELSE CONVERT(VARCHAR(10), BN.NAMSINH) END as NGAYSINH,            CASE WHEN dt.TENDOITUONG IS NOT NULL THEN dt.TENDOITUONG  ELSE '' END as DOITUONG,            N'VTYT Ngoại trú ngày: ' + CONVERT(VARCHAR(10), VT.NGAYTAO, 103) + ' - ' + CONVERT(VARCHAR(5), VT.NGAYTAO, 108)            + CASE WHEN NV.TENNHANVIEN IS NOT NULL THEN + N' - Người lập: ' +  NV.TENNHANVIEN ELSE '' END            AS YLENH,            VT.KHAMBENH_VTYT_ID as TOATHUOC_ID,            DV.DVYEUCAU_ID as REF_ID,            PL.MACHUNGTU,            VT.DUOC_ID,            d.MADUOC,            d.TENDUOCDAYDU,            d.DONVITINH,            VT.SOLUONG as SOLUONGYEUCAU,            VT.NGAYTAO            FROM            TT_NGOAITRU_KHAMBENH_VTYT VT            inner join TT_DVYEUCAU DV on DV.DVYEUCAU_ID = VT.DVYEUCAU_ID            inner join TT_BENHNHAN BN on DV.BENHNHAN_ID = BN.BENHNHAN_ID            inner join TT_TIEPNHAN TN on TN.TIEPNHAN_ID = DV.TIEPNHAN_ID            left join TM_DOITUONG dt on TN.DOITUONG_ID = dt.DOITUONG_ID            left join TM_NHANVIEN NV on VT.NGUOITAO_ID = NV.NHANVIEN_ID            inner join TM_DUOC D on D.DUOC_ID = VT.DUOC_ID            inner join TM_LOAIDUOC LD on LD.LOAIDUOC_ID = D.LOAIDUOC_ID            left join TT_DUOC_PHIEULINH PL on PL.CHUNGTU_ID = VT.PHIEULINH_ID            WHERE            CONVERT(date, VT.NGAYTAO) BETWEEN  CONVERT(date, '9/20/2019 12:00:00 AM')  AND  CONVERT(date, '9/20/2019 12:00:00 AM')            AND VT.CHUNGTU_ID is null            AND VT.PHONGBAN_ID = '62'                          AND VT.BENHVIEN_ID = 'HLU01'              AND (BN.TENBENHNHAN like N'%%' OR BN.MAYTE like N'%%'              OR  TN.SOTIEPNHAN  like N'%%' or D.TENDUOCDAYDU like N'%%'              OR PL.MACHUNGTU like '%%'              )              AND LD.LOAIVATTU_ID = 'V'              order by NGAYTAO DESC]
2019-09-20 16:55:11,999 [1] DEBUG - Statement Id: [DAO00030_XUATSUDUNG_PTTT_VTYT] PreparedStatement : [SELECT            N'Người bệnh: ' + BN.MAYTE + ' - ' + BN.TENBENHNHAN + ' - '  + N'Số TN: ' + TN.SOTIEPNHAN  as BENHNHAN,            CASE WHEN BN.GIOITINH = 1 THEN 'Nam' WHEN BN.GIOITINH = 2 THEN N'Nữ' END  AS GIOITINH,            CASE WHEN BN.NGAYSINH IS NOT NULL THEN CONVERT(VARCHAR(10), BN.NGAYSINH, 103) ELSE CONVERT(VARCHAR(10), BN.NAMSINH) END as NGAYSINH,            CASE WHEN dt.TENDOITUONG IS NOT NULL THEN dt.TENDOITUONG  ELSE '' END as DOITUONG,            CASE            WHEN PT.LOAI = 'P'THEN N'Số phiếu Phẫu thuật: ' +  ISNULL(PT.SOPHIEUPHAUTHUAT,'')  + N' - Ngày: ' +  CONVERT(VARCHAR(10), ISNULL(VT.NGAYTAO,''), 103) + ' - ' + CONVERT(VARCHAR(5), ISNULL(VT.NGAYTAO,''), 108) + CASE WHEN NV.TENNHANVIEN IS NOT NULL THEN + N' - Người lập: ' +  NV.TENNHANVIEN ELSE '' END            ELSE N'Số phiếu Thủ thuật: ' +  ISNULL(PT.SOPHIEUPHAUTHUAT,'')  + N' - Ngày: ' +  CONVERT(VARCHAR(10), ISNULL(VT.NGAYTAO,''), 103) + ' - ' + CONVERT(VARCHAR(5), ISNULL(VT.NGAYTAO,''), 108) + CASE WHEN NV.TENNHANVIEN IS NOT NULL THEN + N' - Người lập: ' +  NV.TENNHANVIEN ELSE '' END            END  AS YLENH,            VT.PHAUTHUAT_VTYT_ID as TOATHUOC_ID,            VT.PHAUTHUAT_ID as REF_ID,            PL.MACHUNGTU,            VT.DUOC_ID,            d.MADUOC,            d.TENDUOCDAYDU,            d.DONVITINH,            VT.SOLUONG as SOLUONGYEUCAU,            VT.NGAYTAO            FROM            TT_PHAUTHUAT_VTYT VT            inner join TT_PHAUTHUAT PT on PT.PHAUTHUAT_ID = VT.PHAUTHUAT_ID            left join TT_TIEPNHAN TN on TN.TIEPNHAN_ID = PT.TIEPNHAN_ID            left join TT_BENHNHAN BN on BN.BENHNHAN_ID = TN.BENHNHAN_ID            left join TM_DOITUONG dt on TN.DOITUONG_ID = dt.DOITUONG_ID            left join TM_DUOC D on D.DUOC_ID = VT.DUOC_ID            left join TM_LOAIDUOC LD on LD.LOAIDUOC_ID = D.LOAIDUOC_ID            left join TM_NHANVIEN NV on VT.NGUOITAO_ID = NV.NHANVIEN_ID            left join TT_DUOC_PHIEULINH PL on PL.CHUNGTU_ID = VT.CHUNGTU_ID            WHERE            CONVERT(date, VT.NGAYTAO) BETWEEN  CONVERT(date, '9/20/2019 12:00:00 AM')  AND  CONVERT(date, '9/20/2019 12:00:00 AM')            AND VT.CHUNGTU_ID is null                          AND PT.PHONGBANTHUCHIEN_ID = '62'              AND VT.BENHVIEN_ID = 'HLU01'              AND (BN.TENBENHNHAN like N'%%' OR BN.MAYTE like N'%%' OR  TN.SOTIEPNHAN  like N'%%' or D.TENDUOCDAYDU like N'%%'              OR PL.MACHUNGTU like '%%'              )              AND LD.LOAIVATTU_ID = 'V'              order by NGAYTAO DESC]
2019-09-20 16:55:12,082 [1] DEBUG - Statement Id: [DAO00030_XUATSUDUNG_CLS_VTYT] PreparedStatement : [SELECT            N'Người bệnh: ' + BN.MAYTE + ' - ' + BN.TENBENHNHAN + ' - '  + N'Số TN: ' + TN.SOTIEPNHAN  as BENHNHAN,            CASE WHEN BN.GIOITINH = 1 THEN 'Nam' WHEN BN.GIOITINH = 2 THEN N'Nữ' END  AS GIOITINH,            CASE WHEN BN.NGAYSINH IS NOT NULL THEN CONVERT(VARCHAR(10), BN.NGAYSINH, 103) ELSE CONVERT(VARCHAR(10), BN.NAMSINH) END as NGAYSINH,            CASE WHEN dt.TENDOITUONG IS NOT NULL THEN dt.TENDOITUONG  ELSE '' END as DOITUONG,            N'Số phiếu CLS: ' +  ISNULL(DV.SOPHIEUYEUCAU,'')  + N' - Ngày: ' +  CONVERT(VARCHAR(10), ISNULL(CLS_VT.NGAYTAO,''), 103) + ' - ' + CONVERT(VARCHAR(5), ISNULL(CLS_VT.NGAYTAO,''), 108) + CASE WHEN NV.TENNHANVIEN IS NOT NULL THEN + N' - Người lập: ' +  NV.TENNHANVIEN ELSE '' END            AS YLENH,            CLS_VT.CLSKETQUA_VTYT_ID as TOATHUOC_ID,            DV.DVYEUCAU_ID as REF_ID,            PL.MACHUNGTU,            CLS_VT.DUOC_ID,            d.MADUOC,            d.TENDUOCDAYDU,            d.DONVITINH,            CLS_VT.SOLUONG as SOLUONGYEUCAU,            CLS_VT.NGAYTAO            FROM            TT_CLSKETQUA_VTYT CLS_VT            inner join TT_DVYEUCAU DV on DV.DVYEUCAU_ID = CLS_VT.DVYEUCAU_ID            left join TT_CLSKETQUA CLS on CLS.CLSKETQUA_ID = CLS_VT.CLSKETQUA_ID            left join TT_BENHNHAN BN on DV.BENHNHAN_ID = BN.BENHNHAN_ID            left join TT_TIEPNHAN TN on TN.TIEPNHAN_ID = DV.TIEPNHAN_ID            left join TM_PHONGBAN pb on pb.PHONGBAN_ID = CLS_VT.PHONGBAN_ID            left join TM_DOITUONG dt on dt.DOITUONG_ID = DV.DOITUONG_ID            left join TM_NHANVIEN NV on NV.NHANVIEN_ID = CLS_VT.NGUOITAO_ID            left join TM_DUOC D on D.DUOC_ID = CLS_VT.DUOC_ID            left join TM_LOAIDUOC LD on LD.LOAIDUOC_ID = D.LOAIDUOC_ID            left join TT_DUOC_PHIEULINH PL on PL.CHUNGTU_ID = CLS_VT.CHUNGTU_ID            WHERE            CONVERT(date, CLS_VT.NGAYTAO) BETWEEN  CONVERT(date, '9/20/2019 12:00:00 AM')  AND  CONVERT(date, '9/20/2019 12:00:00 AM')            AND CLS_VT.CHUNGTU_ID is null                          AND CLS_VT.PHONGBAN_ID = '62'              AND CLS_VT.BENHVIEN_ID = 'HLU01'              AND (BN.TENBENHNHAN like N'%%' OR BN.MAYTE like N'%%' OR  TN.SOTIEPNHAN  like N'%%' or D.TENDUOCDAYDU like N'%%'              OR PL.MACHUNGTU like '%%'              )              AND LD.LOAIVATTU_ID = 'V'              order by NGAYTAO DESC]
2019-09-20 16:55:19,880 [1] DEBUG - Statement Id: [DAO00030_Search_PhieuXuatSD] PreparedStatement : [SELECT DISTINCT phieuxuat.* FROM          (          select DISTINCT          CT.CHUNGTU_ID,          CT.SOCHUNGTU,          CT.MACHUNGTU,          CT.NGAYCHUNGTU,          CT.NGAYTAO,          CT.KHOXUAT_ID,          CT.NGUOIGIAO_ID,          CT.KHONHAP_ID,          CT.NGUOINHAN_ID,          PL.MACHUNGTU as MAPHIEULINH,          PL.NGAYCHUNGTU as NGAYPHIEULINH,          bn.MAYTE,          bn.TENBENHNHAN,          CONVERT(VARCHAR(10), KB.THOIGIANKHAM, 103) + ' - ' + CONVERT(VARCHAR(5), KB.THOIGIANKHAM, 108) as THOIGIANKHAM,          nl.TENNHANVIEN as NGUOILAP,          CT.DIENGIAI          from TT_DUOC_CHUNGTU CT          inner join TT_DUOC_CHUNGTU_CHITIET ctct on ct.CHUNGTU_ID = ctct.CHUNGTU_ID          inner join TT_NOITRU_TOATHUOC TT on ctct.TOATHUOCNOITRU_ID = TT.TOATHUOC_ID          inner join TT_NOITRU_KHAMBENH KB on kb.KHAMBENH_ID = TT.KHAMBENH_ID          inner join TT_BENHNHAN BN on TT.BENHNHAN_ID = BN.BENHNHAN_ID          left join TT_DUOC_PHIEULINH PL on PL.CHUNGTU_ID = CT.PHIEULINH_ID          left join TM_NHANVIEN nl on nl.NHANVIEN_ID = TT.NGUOITAO_ID           where                   CT.MUCDICHCHUNGTU_ID = '1060'               and                 CT.KHOXUAT_ID = '32'               and                 CONVERT(date, CT.NGAYCHUNGTU) BETWEEN CONVERT(date, '9/20/2019 12:00:00 AM')  and  CONVERT(date, '9/20/2019 12:00:00 AM')               and                 CT.BENHVIEN_ID = 'HLU01'                           UNION            select DISTINCT          CT.CHUNGTU_ID,          CT.SOCHUNGTU,          CT.MACHUNGTU,          CT.NGAYCHUNGTU,          CT.NGAYTAO,          CT.KHOXUAT_ID,          CT.NGUOIGIAO_ID,          CT.KHONHAP_ID,          CT.NGUOINHAN_ID,          PL.MACHUNGTU as MAPHIEULINH,          PL.NGAYCHUNGTU as NGAYPHIEULINH,          bn.MAYTE,          bn.TENBENHNHAN,          CONVERT(VARCHAR(10), KB.THOIGIANKHAM, 103) + ' - ' + CONVERT(VARCHAR(5), KB.THOIGIANKHAM, 108) as THOIGIANKHAM,          nl.TENNHANVIEN as NGUOILAP,          CT.DIENGIAI          from TT_DUOC_CHUNGTU CT          inner join TT_DUOC_CHUNGTU_CHITIET ctct on ct.CHUNGTU_ID = ctct.CHUNGTU_ID          inner join TT_NGOAITRU_KHAMBENH_VTYT vt on ctct.KHAMBENH_VTYT_ID = vt.KHAMBENH_VTYT_ID          inner join TT_NGOAITRU_KHAMBENH kb on kb.KHAMBENH_ID = vt.KHAMBENH_ID          inner join TT_BENHNHAN BN on bn.BENHNHAN_ID = kb.BENHNHAN_ID          left join TT_DUOC_PHIEULINH PL on PL.CHUNGTU_ID = CT.PHIEULINH_ID          left join TM_NHANVIEN nl on nl.NHANVIEN_ID = vt.NGUOITAO_ID           where                   CT.MUCDICHCHUNGTU_ID = '1060'               and                 CT.KHOXUAT_ID = '32'               and                 CONVERT(date, CT.NGAYCHUNGTU) BETWEEN CONVERT(date, '9/20/2019 12:00:00 AM')  and  CONVERT(date, '9/20/2019 12:00:00 AM')               and                 CT.BENHVIEN_ID = 'HLU01'                           UNION            select DISTINCT          CT.CHUNGTU_ID,          CT.SOCHUNGTU,          CT.MACHUNGTU,          CT.NGAYCHUNGTU,          CT.NGAYTAO,          CT.KHOXUAT_ID,          CT.NGUOIGIAO_ID,          CT.KHONHAP_ID,          CT.NGUOINHAN_ID,          PL.MACHUNGTU as MAPHIEULINH,          PL.NGAYCHUNGTU as NGAYPHIEULINH,          bn.MAYTE,          bn.TENBENHNHAN,          CONVERT(VARCHAR(10), pt.NGAYTHUCHIEN, 103) + ' - ' + CONVERT(VARCHAR(5), pt.NGAYTHUCHIEN, 108) as THOIGIANKHAM,          nl.TENNHANVIEN as NGUOILAP,          CT.DIENGIAI          from TT_DUOC_CHUNGTU CT          inner join TT_DUOC_CHUNGTU_CHITIET ctct on ct.CHUNGTU_ID = ctct.CHUNGTU_ID          inner join TT_PHAUTHUAT_VTYT vt on ctct.PHAUTHUAT_VTYT_ID = vt.PHAUTHUAT_VTYT_ID          inner join TT_PHAUTHUAT pt on pt.PHAUTHUAT_ID = vt.PHAUTHUAT_ID          inner join TT_TIEPNHAN tn on tn.TIEPNHAN_ID = pt.TIEPNHAN_ID          inner join TT_BENHNHAN bn on bn.BENHNHAN_ID = tn.BENHNHAN_ID          left join TT_DUOC_PHIEULINH PL on PL.CHUNGTU_ID = CT.PHIEULINH_ID          left join TM_NHANVIEN nl on nl.NHANVIEN_ID = pt.NGUOITAO_ID           where                   CT.MUCDICHCHUNGTU_ID = '1060'               and                 CT.KHOXUAT_ID = '32'               and                 CONVERT(date, CT.NGAYCHUNGTU) BETWEEN CONVERT(date, '9/20/2019 12:00:00 AM')  and  CONVERT(date, '9/20/2019 12:00:00 AM')               and                 CT.BENHVIEN_ID = 'HLU01'                           UNION            select DISTINCT          CT.CHUNGTU_ID,          CT.SOCHUNGTU,          CT.MACHUNGTU,          CT.NGAYCHUNGTU,          CT.NGAYTAO,          CT.KHOXUAT_ID,          CT.NGUOIGIAO_ID,          CT.KHONHAP_ID,          CT.NGUOINHAN_ID,          PL.MACHUNGTU as MAPHIEULINH,          PL.NGAYCHUNGTU as NGAYPHIEULINH,          bn.MAYTE,          bn.TENBENHNHAN,          CONVERT(VARCHAR(10), cls.NGAYTAO, 103) + ' - ' + CONVERT(VARCHAR(5), cls.NGAYTAO, 108) as THOIGIANKHAM,          nl.TENNHANVIEN as NGUOILAP,          CT.DIENGIAI          from TT_DUOC_CHUNGTU CT          inner join TT_DUOC_CHUNGTU_CHITIET ctct on ct.CHUNGTU_ID = ctct.CHUNGTU_ID          inner join TT_CLSKETQUA_VTYT cls on ctct.CLSKETQUA_VTYT_ID = cls.CLSKETQUA_VTYT_ID          inner join TT_DVYEUCAU DV on DV.DVYEUCAU_ID = CLS.DVYEUCAU_ID          inner join TT_BENHNHAN bn on bn.BENHNHAN_ID = DV.BENHNHAN_ID          left join TT_DUOC_PHIEULINH PL on PL.CHUNGTU_ID = CT.PHIEULINH_ID          left join TM_NHANVIEN nl on nl.NHANVIEN_ID = cls.NGUOITAO_ID           where                   CT.MUCDICHCHUNGTU_ID = '1060'               and                 CT.KHOXUAT_ID = '32'               and                 CONVERT(date, CT.NGAYCHUNGTU) BETWEEN CONVERT(date, '9/20/2019 12:00:00 AM')  and  CONVERT(date, '9/20/2019 12:00:00 AM')               and                 CT.BENHVIEN_ID = 'HLU01'                           UNION            select DISTINCT          CT.CHUNGTU_ID,          CT.SOCHUNGTU,          CT.MACHUNGTU,          CT.NGAYCHUNGTU,          CT.NGAYTAO,          CT.KHOXUAT_ID,          CT.NGUOIGIAO_ID,          CT.KHONHAP_ID,          CT.NGUOINHAN_ID,          PL.MACHUNGTU as MAPHIEULINH,          PL.NGAYCHUNGTU as NGAYPHIEULINH,          null as MAYTE,          null as TENBENHNHAN,          null as THOIGIANKHAM,          nl.TENNHANVIEN as NGUOILAP,          CT.DIENGIAI          from TT_DUOC_CHUNGTU CT          inner join TT_DUOC_CHUNGTU_CHITIET ctct on ct.CHUNGTU_ID = ctct.CHUNGTU_ID          left join TT_DUOC_PHIEULINH PL on PL.CHUNGTU_ID = CT.PHIEULINH_ID          left join TM_NHANVIEN nl on nl.NHANVIEN_ID = ct.NGUOITAO_ID          WHERE (ctct.TOATHUOCNOITRU_ID IS NULL AND ctct.KHAMBENH_VTYT_ID IS NULL AND ctct.PHAUTHUAT_VTYT_ID IS NULL AND ctct.CLSKETQUA_VTYT_ID IS NULL)             and                 CT.MUCDICHCHUNGTU_ID = '1060'               and                 CT.KHOXUAT_ID = '32'               and                 CONVERT(date, CT.NGAYCHUNGTU) BETWEEN CONVERT(date, '9/20/2019 12:00:00 AM')  and  CONVERT(date, '9/20/2019 12:00:00 AM')               and                 CT.BENHVIEN_ID = 'HLU01'                         )PhieuXuat          ORDER BY PhieuXuat.CHUNGTU_ID desc]
2019-09-20 16:55:22,845 [1] DEBUG - Statement Id: [DAO00030_GetList] PreparedStatement : [select *              from TT_DUOC_CHUNGTU              where BENHVIEN_ID = 'HLU01'                and                   TT_DUOC_CHUNGTU.CHUNGTU_ID = '137702'                               order by CHUNGTU_ID]
2019-09-20 16:55:23,041 [1] DEBUG - Statement Id: [DAO00030_CHUNGTUXUAT_CHITIET_GetList] PreparedStatement : [SELECT            ctct.*,            d.MADUOC, d.TENHANG, d.TENDUOCDAYDU, dvt.TENDONVITINH as DONVITINH,n.TENNGUONDUOC as NGUONHANG,            sln.SOLONHAP, sln.SOLOSANPHAM, sln.NGAYNHAP as NGAYNHAPLO, sln.HANDUNG as HANSUDUNG,            isnull(tk.SOLUONG,0) as SOLUONGTON,            LTRIM(ct.KHOXUAT_ID) + '_' + LTRIM(sln.DUOC_ID) + '_' + LTRIM(sln.NGUONDUOC_ID) as DUOC_KEY            , NLD.MANHOMLOAIDUOC, ld.MALOAIDUOC, D.SO_QDTT            FROM            TT_DUOC_CHUNGTU_CHITIET ctct            INNER JOIN TT_DUOC_CHUNGTU ct ON (ct.CHUNGTU_ID = ctct.CHUNGTU_ID)            INNER JOIN TT_DUOC_CHUNGTU_SOLONHAP sln ON (sln.SOLONHAP_ID = ctct.SOLONHAP_ID)            LEFT JOIN (            select xx.DUOCTONKHO_ID, xx.KHODUOC_ID, xx.DUOC_ID, xx.SOLONHAP_ID, xx.SOLUONG, xx.NGUONDUOC_ID, xx.BENHVIEN_ID from TT_DUOC_TONKHO xx            join ( select max(DUOCTONKHO_ID) as DUOCTONKHO_ID, KHODUOC_ID, DUOC_ID, SOLONHAP_ID, NGUONDUOC_ID            from TT_DUOC_TONKHO group by KHODUOC_ID, DUOC_ID, SOLONHAP_ID, NGUONDUOC_ID) yy on xx.DUOCTONKHO_ID=yy.DUOCTONKHO_ID            ) tk ON (tk.SOLONHAP_ID = sln.SOLONHAP_ID AND tk.DUOC_ID = sln.DUOC_ID and tk.KHODUOC_ID = ct.KHOXUAT_ID)            INNER JOIN TM_DUOC d ON (d.DUOC_ID = ctct.DUOC_ID)            INNER JOIN TM_NGUONHANG n ON (n.NGUONDUOC_ID = ctct.NGUONHANG_ID)            LEFT JOIN TM_DONVITINH dvt ON (dvt.DONVITINH_ID = ctct.DONVITINH_ID)            left join TM_LOAIDUOC LD on LD.LOAIDUOC_ID = D.LOAIDUOC_ID            LEFT JOIN TM_NHOMLOAIDUOC NLD on NLD.NHOMLOAIDUOC_ID = LD.NHOMLOAIDUOC_ID             where                             ct.CHUNGTU_ID = '137702'                       and                           ct.BENHVIEN_ID = 'HLU01'                                     order by CHUNGTUCHITIET_ID]
2019-09-20 16:55:23,511 [1] DEBUG - Statement Id: [DAO00030_KiemTraChungTuKhoaSo] PreparedStatement : [SELECT CHUNGTU_ID              FROM TT_DUOC_CHUNGTU              WHERE              MACHUNGTU = 'CS_KBX1319003090'              and BENHVIEN_ID = 'HLU01'              and              convert(date, NGAYCHUNGTU) <=              (              SELECT TOP 1 convert(date, KHOADENNGAY)              FROM TT_DUOC_KHOASOCHUNGTU              WHERE              KHODUOC_ID = '32'              and BENHVIEN_ID = 'HLU01'              AND KHOASO = '1'              ORDER BY KHOADENNGAY DESC              )]
2019-09-20 16:55:23,558 [1] DEBUG - Statement Id: [DAO00030_KiemTraChungTuDaChuyenKeToan] PreparedStatement : [SELECT CHUNGTU_ID            FROM TT_DUOC_CHUNGTU            WHERE            CHUNGTU_ID = '137702'            and IDCHUYEN IS NOT NULL            and BENHVIEN_ID = 'HLU01']
2019-09-20 16:55:23,604 [1] DEBUG - Statement Id: [DAO00030_KiemTraBenhNhanXuatVien] PreparedStatement : [select              TT.TOATHUOC_ID              from              TT_NOITRU_TOATHUOC TT              inner join TT_NOITRU_KHAMBENH KB on TT.KHAMBENH_ID = KB.KHAMBENH_ID              inner join TT_NOITRU_BENHAN BA on BA.BENHAN_ID = KB.BENHAN_ID              WHERE              BA.TRANGTHAI = 'DAXUATVIEN'              AND TT.CHUNGTU_ID =  137702              and TT.BENHVIEN_ID = 'HLU01']
2019-09-20 16:55:23,817 [1] DEBUG - Statement Id: [DAO00030_DUOCTONKHO_GetSoTonTheoDuoc] PreparedStatement : [SELECT              DUOC_ID,              SUM(SOLUONG) AS TONGTON              FROM              TT_DUOC_TONKHO              WHERE              KHODUOC_ID = '32'              and BENHVIEN_ID = 'HLU01'              and DUOC_ID IN (1)              GROUP BY DUOC_ID]
2019-09-20 16:55:23,884 [1] DEBUG - Statement Id: [DAO00030_DUOCTONKHO_GetSoTonTheoDuocTheoLo] PreparedStatement : [SELECT              DUOC_ID,SOLONHAP_ID,              SUM(SOLUONG) AS SOLUONGTONLO              FROM              TT_DUOC_TONKHO              WHERE              KHODUOC_ID = '32'              and BENHVIEN_ID = 'HLU01'              and DUOC_ID IN (1)              and SOLONHAP_ID IN (7541)              GROUP BY DUOC_ID, SOLONHAP_ID]
2019-09-20 16:55:23,922 [1] DEBUG - Statement Id: [DAO00030_DUOCTONKHO_GetSoTonTheoDuoc] PreparedStatement : [SELECT              DUOC_ID,              SUM(SOLUONG) AS TONGTON              FROM              TT_DUOC_TONKHO              WHERE              KHODUOC_ID = '32'              and BENHVIEN_ID = 'HLU01'              and DUOC_ID IN (1)              GROUP BY DUOC_ID]
2019-09-20 16:55:24,027 [1] DEBUG - Statement Id: [DAO00030_KTDaPhatSinhBienLai] PreparedStatement : [SELECT CHUNGTU_ID            FROM TT_NOITRU_TOATHUOC tt            INNER JOIN TT_VIENPHI vp on (tt.TOATHUOC_ID = vp.REF_ID and REF_TABLE = 'TT_NOITRU_TOATHUOC')            WHERE            CHUNGTU_ID = '137702'            AND tt.BENHVIEN_ID = 'HLU01'            AND HOADON_ID is not NULL            AND vp.HUY = '0'              union all            SELECT  kbtt.CHUNGTUPHATTHUOC_ID as CHUNGTU_ID            FROM TT_NGOAITRU_TOATHUOC tt            INNER JOIN TT_NGOAITRU_KHAMBENH_TOATHUOC kbtt on (kbtt.KHAMBENH_TOATHUOC_ID = tt.KHAMBENH_TOATHUOC_ID)            INNER JOIN TT_VIENPHI vp on (tt.TOATHUOC_ID = vp.REF_ID and REF_TABLE = 'TT_NGOAITRU_TOATHUOC')            WHERE            kbtt.CHUNGTUPHATTHUOC_ID = '137702'            AND tt.BENHVIEN_ID = 'HLU01'            AND HOADON_ID is not NULL            AND vp.HUY = '0'              union all            SELECT ctct.CHUNGTU_ID from            TT_DUOC_CHUNGTU_CHITIET ctct            INNER JOIN TT_HOADON_CHITIET_NGOAITRU hdct on (hdct.REF_ID = ctct.CHUNGTUCHITIET_ID and hdct.REF_TABLE = 'TT_DUOC_CHUNGTU_CHITIET')            INNER JOIN TT_HOADON hd on hd.HOADON_ID = hdct.HOADON_ID            WHERE            ctct.CHUNGTU_ID = '137702'                            AND hd.HUYHOADON = '0'              AND hd.HOANTRA = '0'                                  AND ctct.BENHVIEN_ID = 'HLU01'                        union all            SELECT CHUNGTU_ID            FROM TT_NGOAITRU_KHAMBENH_VTYT tt            INNER JOIN TT_VIENPHI vp on (tt.KHAMBENH_VTYT_ID = vp.REF_ID and REF_TABLE = 'TT_NGOAITRU_KHAMBENH_VTYT')            WHERE            CHUNGTU_ID = '137702'            AND tt.BENHVIEN_ID = 'HLU01'            AND HOADON_ID is not NULL            AND vp.HUY = '0'                        union all            SELECT CHUNGTU_ID            FROM TT_PHAUTHUAT_VTYT tt            INNER JOIN TT_VIENPHI vp on (tt.PHAUTHUAT_VTYT_ID = vp.REF_ID and REF_TABLE = 'TT_PHAUTHUAT_VTYT')            WHERE            CHUNGTU_ID = '137702'            AND tt.BENHVIEN_ID = 'HLU01'            AND HOADON_ID is not NULL            AND vp.HUY = '0'                        union all            SELECT CHUNGTU_ID            FROM TT_CLSKETQUA_VTYT tt            INNER JOIN TT_VIENPHI vp on (tt.CLSKETQUA_VTYT_ID = vp.REF_ID and REF_TABLE = 'TT_CLSKETQUA_VTYT')            WHERE            CHUNGTU_ID = '137702'            AND tt.BENHVIEN_ID = 'HLU01'            AND HOADON_ID is not NULL            AND vp.HUY = '0']
2019-09-20 16:55:30,815 [1] DEBUG - Statement Id: [DAO00030_KTDaPhatSinhBienLai] PreparedStatement : [SELECT CHUNGTU_ID            FROM TT_NOITRU_TOATHUOC tt            INNER JOIN TT_VIENPHI vp on (tt.TOATHUOC_ID = vp.REF_ID and REF_TABLE = 'TT_NOITRU_TOATHUOC')            WHERE            CHUNGTU_ID = '137702'            AND tt.BENHVIEN_ID = 'HLU01'            AND HOADON_ID is not NULL            AND vp.HUY = '0'              union all            SELECT  kbtt.CHUNGTUPHATTHUOC_ID as CHUNGTU_ID            FROM TT_NGOAITRU_TOATHUOC tt            INNER JOIN TT_NGOAITRU_KHAMBENH_TOATHUOC kbtt on (kbtt.KHAMBENH_TOATHUOC_ID = tt.KHAMBENH_TOATHUOC_ID)            INNER JOIN TT_VIENPHI vp on (tt.TOATHUOC_ID = vp.REF_ID and REF_TABLE = 'TT_NGOAITRU_TOATHUOC')            WHERE            kbtt.CHUNGTUPHATTHUOC_ID = '137702'            AND tt.BENHVIEN_ID = 'HLU01'            AND HOADON_ID is not NULL            AND vp.HUY = '0'              union all            SELECT ctct.CHUNGTU_ID from            TT_DUOC_CHUNGTU_CHITIET ctct            INNER JOIN TT_HOADON_CHITIET_NGOAITRU hdct on (hdct.REF_ID = ctct.CHUNGTUCHITIET_ID and hdct.REF_TABLE = 'TT_DUOC_CHUNGTU_CHITIET')            INNER JOIN TT_HOADON hd on hd.HOADON_ID = hdct.HOADON_ID            WHERE            ctct.CHUNGTU_ID = '137702'                            AND hd.HUYHOADON = '0'              AND hd.HOANTRA = '0'                                  AND ctct.BENHVIEN_ID = 'HLU01'                        union all            SELECT CHUNGTU_ID            FROM TT_NGOAITRU_KHAMBENH_VTYT tt            INNER JOIN TT_VIENPHI vp on (tt.KHAMBENH_VTYT_ID = vp.REF_ID and REF_TABLE = 'TT_NGOAITRU_KHAMBENH_VTYT')            WHERE            CHUNGTU_ID = '137702'            AND tt.BENHVIEN_ID = 'HLU01'            AND HOADON_ID is not NULL            AND vp.HUY = '0'                        union all            SELECT CHUNGTU_ID            FROM TT_PHAUTHUAT_VTYT tt            INNER JOIN TT_VIENPHI vp on (tt.PHAUTHUAT_VTYT_ID = vp.REF_ID and REF_TABLE = 'TT_PHAUTHUAT_VTYT')            WHERE            CHUNGTU_ID = '137702'            AND tt.BENHVIEN_ID = 'HLU01'            AND HOADON_ID is not NULL            AND vp.HUY = '0'                        union all            SELECT CHUNGTU_ID            FROM TT_CLSKETQUA_VTYT tt            INNER JOIN TT_VIENPHI vp on (tt.CLSKETQUA_VTYT_ID = vp.REF_ID and REF_TABLE = 'TT_CLSKETQUA_VTYT')            WHERE            CHUNGTU_ID = '137702'            AND tt.BENHVIEN_ID = 'HLU01'            AND HOADON_ID is not NULL            AND vp.HUY = '0']
2019-09-20 16:55:32,042 [1] DEBUG - Statement Id: [DAO00030_KTDaPhatSinhPhieuBHTN] PreparedStatement : [SELECT vp.VIENPHI_ID              FROM TT_VIENPHI vp              INNER JOIN TT_MIENGIAM_CHITIET  mgct on mgct.VIENPHI_ID = vp.VIENPHI_ID              INNER JOIN TT_DUOC_CHUNGTU ct on ct.TIEPNHAN_ID = vp.TIEPNHAN_ID              WHERE              ct.CHUNGTU_ID = '137702'              AND vp.DUOC_ID is not null              AND vp.BENHVIEN_ID = 'HLU01']
2019-09-20 16:55:32,145 [1] DEBUG - Statement Id: [DAO00030_KiemTraBenhNhanXuatVien] PreparedStatement : [select              TT.TOATHUOC_ID              from              TT_NOITRU_TOATHUOC TT              inner join TT_NOITRU_KHAMBENH KB on TT.KHAMBENH_ID = KB.KHAMBENH_ID              inner join TT_NOITRU_BENHAN BA on BA.BENHAN_ID = KB.BENHAN_ID              WHERE              BA.TRANGTHAI = 'DAXUATVIEN'              AND TT.CHUNGTU_ID =  137702              and TT.BENHVIEN_ID = 'HLU01']
2019-09-20 16:55:32,314 [1] DEBUG - Statement Id: [DAO00030_KiemTraChungTuKhoaSo] PreparedStatement : [SELECT CHUNGTU_ID              FROM TT_DUOC_CHUNGTU              WHERE              MACHUNGTU = 'CS_KBX1319003090'              and BENHVIEN_ID = 'HLU01'              and              convert(date, NGAYCHUNGTU) <=              (              SELECT TOP 1 convert(date, KHOADENNGAY)              FROM TT_DUOC_KHOASOCHUNGTU              WHERE              KHODUOC_ID = '32'              and BENHVIEN_ID = 'HLU01'              AND KHOASO = '1'              ORDER BY KHOADENNGAY DESC              )]
2019-09-20 16:55:32,349 [1] DEBUG - Statement Id: [DAO00030_KiemTraChungTuKhoaSo] PreparedStatement : [SELECT CHUNGTU_ID              FROM TT_DUOC_CHUNGTU              WHERE              MACHUNGTU = 'CS_KBX1319003090'              and BENHVIEN_ID = 'HLU01'              and              convert(date, NGAYCHUNGTU) <=              (              SELECT TOP 1 convert(date, KHOADENNGAY)              FROM TT_DUOC_KHOASOCHUNGTU              WHERE              KHODUOC_ID = '32'              and BENHVIEN_ID = 'HLU01'              AND KHOASO = '1'              ORDER BY KHOADENNGAY DESC              )]
2019-09-20 16:55:32,377 [1] DEBUG - Statement Id: [DAO00030_KiemTraChungTuDaChuyenKeToan] PreparedStatement : [SELECT CHUNGTU_ID            FROM TT_DUOC_CHUNGTU            WHERE            CHUNGTU_ID = '137702'            and IDCHUYEN IS NOT NULL            and BENHVIEN_ID = 'HLU01']
2019-09-20 16:55:32,407 [1] DEBUG - Statement Id: [DAO00030_KTDaPhatSinhBienLai] PreparedStatement : [SELECT CHUNGTU_ID            FROM TT_NOITRU_TOATHUOC tt            INNER JOIN TT_VIENPHI vp on (tt.TOATHUOC_ID = vp.REF_ID and REF_TABLE = 'TT_NOITRU_TOATHUOC')            WHERE            CHUNGTU_ID = '137702'            AND tt.BENHVIEN_ID = 'HLU01'            AND HOADON_ID is not NULL            AND vp.HUY = '0'              union all            SELECT  kbtt.CHUNGTUPHATTHUOC_ID as CHUNGTU_ID            FROM TT_NGOAITRU_TOATHUOC tt            INNER JOIN TT_NGOAITRU_KHAMBENH_TOATHUOC kbtt on (kbtt.KHAMBENH_TOATHUOC_ID = tt.KHAMBENH_TOATHUOC_ID)            INNER JOIN TT_VIENPHI vp on (tt.TOATHUOC_ID = vp.REF_ID and REF_TABLE = 'TT_NGOAITRU_TOATHUOC')            WHERE            kbtt.CHUNGTUPHATTHUOC_ID = '137702'            AND tt.BENHVIEN_ID = 'HLU01'            AND HOADON_ID is not NULL            AND vp.HUY = '0'              union all            SELECT ctct.CHUNGTU_ID from            TT_DUOC_CHUNGTU_CHITIET ctct            INNER JOIN TT_HOADON_CHITIET_NGOAITRU hdct on (hdct.REF_ID = ctct.CHUNGTUCHITIET_ID and hdct.REF_TABLE = 'TT_DUOC_CHUNGTU_CHITIET')            INNER JOIN TT_HOADON hd on hd.HOADON_ID = hdct.HOADON_ID            WHERE            ctct.CHUNGTU_ID = '137702'                            AND hd.HUYHOADON = '0'              AND hd.HOANTRA = '0'                                  AND ctct.BENHVIEN_ID = 'HLU01'                        union all            SELECT CHUNGTU_ID            FROM TT_NGOAITRU_KHAMBENH_VTYT tt            INNER JOIN TT_VIENPHI vp on (tt.KHAMBENH_VTYT_ID = vp.REF_ID and REF_TABLE = 'TT_NGOAITRU_KHAMBENH_VTYT')            WHERE            CHUNGTU_ID = '137702'            AND tt.BENHVIEN_ID = 'HLU01'            AND HOADON_ID is not NULL            AND vp.HUY = '0'                        union all            SELECT CHUNGTU_ID            FROM TT_PHAUTHUAT_VTYT tt            INNER JOIN TT_VIENPHI vp on (tt.PHAUTHUAT_VTYT_ID = vp.REF_ID and REF_TABLE = 'TT_PHAUTHUAT_VTYT')            WHERE            CHUNGTU_ID = '137702'            AND tt.BENHVIEN_ID = 'HLU01'            AND HOADON_ID is not NULL            AND vp.HUY = '0'                        union all            SELECT CHUNGTU_ID            FROM TT_CLSKETQUA_VTYT tt            INNER JOIN TT_VIENPHI vp on (tt.CLSKETQUA_VTYT_ID = vp.REF_ID and REF_TABLE = 'TT_CLSKETQUA_VTYT')            WHERE            CHUNGTU_ID = '137702'            AND tt.BENHVIEN_ID = 'HLU01'            AND HOADON_ID is not NULL            AND vp.HUY = '0']
2019-09-20 16:55:32,661 [1] DEBUG - Statement Id: [DAO00030_KiemTraBenhNhanXuatVien] PreparedStatement : [select              TT.TOATHUOC_ID              from              TT_NOITRU_TOATHUOC TT              inner join TT_NOITRU_KHAMBENH KB on TT.KHAMBENH_ID = KB.KHAMBENH_ID              inner join TT_NOITRU_BENHAN BA on BA.BENHAN_ID = KB.BENHAN_ID              WHERE              BA.TRANGTHAI = 'DAXUATVIEN'              AND TT.CHUNGTU_ID =  137702              and TT.BENHVIEN_ID = 'HLU01']
2019-09-20 16:55:32,823 [1] DEBUG - Statement Id: [DAO00030_DUOCTONKHO_GetSoTonTheoDuocTheoLo] PreparedStatement : [SELECT              DUOC_ID,SOLONHAP_ID,              SUM(SOLUONG) AS SOLUONGTONLO              FROM              TT_DUOC_TONKHO              WHERE              KHODUOC_ID = '32'              and BENHVIEN_ID = 'HLU01'              and DUOC_ID IN (1)              and SOLONHAP_ID IN (7541)              GROUP BY DUOC_ID, SOLONHAP_ID]
2019-09-20 16:55:32,854 [1] DEBUG - Statement Id: [DAO00030_LayNgayKhoaSoCuoi] PreparedStatement : [SELECT TOP 1 KHOADENNGAY              FROM TT_DUOC_KHOASOCHUNGTU              WHERE              KHODUOC_ID = '32'              and BENHVIEN_ID = 'HLU01'              and KHOASO = '1'              ORDER BY KHOADENNGAY DESC]
2019-09-20 16:55:33,005 [1] DEBUG - Statement Id: [DAO00030_GetList] PreparedStatement : [select *              from TT_DUOC_CHUNGTU              where BENHVIEN_ID = 'HLU01'                and                   TT_DUOC_CHUNGTU.MACHUNGTU = 'CS_KBX1319003090'                               order by CHUNGTU_ID]
2019-09-20 16:55:33,166 [1] DEBUG - Statement Id: [DAO00030_KiemTraBenhNhanXuatVien] PreparedStatement : [select              TT.TOATHUOC_ID              from              TT_NOITRU_TOATHUOC TT              inner join TT_NOITRU_KHAMBENH KB on TT.KHAMBENH_ID = KB.KHAMBENH_ID              inner join TT_NOITRU_BENHAN BA on BA.BENHAN_ID = KB.BENHAN_ID              WHERE              BA.TRANGTHAI = 'DAXUATVIEN'              AND TT.CHUNGTU_ID =  137702              and TT.BENHVIEN_ID = 'HLU01']
2019-09-20 16:55:33,654 [1] DEBUG - Statement Id: [DAO00030_Update] PreparedStatement : [update TT_DUOC_CHUNGTU set              NGAYCHUNGTU =  @param0               , LOAICHUNGTU =  @param1               , MUCDICHCHUNGTU_ID =  @param2               , MUCDICHCHUNGTU_CODE =  @param3               , KHOXUAT_ID =  @param4               , NGUOIGIAO_ID =  @param5               , NGUOIGIAO =  @param6               , KHONHAP_ID =  @param7               , NGUOINHAN_ID =  @param8               , NGUOINHAN =  @param9               , NGUOIKIEMTRA_ID =  @param10               , NGUOIKIEMTRA =  @param11               , NGUOIDUYET_ID =  @param12               , NGUOIDUYET =  @param13               , PHUONGPHAPXUAT =  @param14               , KETOANTRUONG_ID =  @param15               , KETOANTRUONG =  @param16               , THUKHO_ID =  @param17               , THUKHO =  @param18               , MAUHOADON =  @param19               , SOHOADON =  @param20               , SOSERI =  @param21               , NGAYHOADON =  @param22               , DIENGIAI =  @param23               , GIATRI =  @param24               , GIATRITHANHTOAN =  @param25               , TYLEVAT =  @param26               , GIATRIVAT =  @param27               , THUESUAT =  @param28               , GIATRITHUE =  @param29               , TYLECHIETKHAU =  @param30               , GIATRICHIETKHAU =  @param31               , TIENTE_ID =  @param32               , TYGIA =  @param33               , SOCHUNGTUGOC =  @param34               , NGAYCHUNGTUGOC =  @param35               , NHACUNGCAP_ID =  @param36               , HINHTHUCTHANHTOAN_ID =  @param37               , NGUONDUOC_ID =  @param38               , CHUNGTULIENQUAN_ID =  @param39               , KHAMBENH_ID =  @param40               , TOATHUOCNOITRU_ID =  @param41               , TIEPNHAN_ID =  @param42               , BENHAN_ID =  @param43               , DANHANTHUOC =  @param44               , NGUOINHAP_ID =  @param45               , NGAYNHAP =  @param46               , TRANGTHAI =  @param47               , PHIEULINH_ID =  @param48               , LOAITOATHUOC =  @param49               , DIENGIAINGHIEPVUPHATSINH =  @param50               , DONVIGIAO_ID =  @param51               , KHOSUDUNG_ID =  @param52               , LOAIVATTU_ID =  @param53               , BENHNHAN_ID =  @param54               , TENBENHNHAN =  @param55               , BACSIGIOITHIEU_ID =  @param56               , DOITUONG_ID =  @param57               , IDCHUYEN =  @param58               , CHUNGTUKETOAN =  @param59               , STATUS =  @param60               , TRANSFER_VIENPHI_ID =  @param61               , PHONGBAN_ID =  @param62               , BACSI_ID =  @param63               , TKNO =  @param64               , TKCO =  @param65               , MACHUNGTUREF =  @param66               , LOAICHUNGTUREF =  @param67               , PHIEULINHCANTRU_ID =  @param68               , KHOTHUCHIEN_ID =  @param69               , KHODOIUNG_ID =  @param70               , MENU_LOAIDUOC_ID =  @param71               , NGUOISUDUNGMAY_ID =  @param72               , GOITHAU_ID =  @param73               , XUATTHUOCBANGOAITRU =  @param74               , NGAYGIOCHUNGTU =  @param75               , NOIDAKHAM =  @param76               , HOIDONGKIEMNHAP_ID =  @param77               , HOIDONGTHANHLY_ID =  @param78               , CHUYENCHUNGTUID =  @param79               , CHUYENDOANHTHUID =  @param80               , LYDOXUATSUDUNG_ID =  @param81                         , NGAYCAPNHAT =  @param82               , NGUOICAPNHAT_ID =  @param83               where              CHUNGTU_ID = '137702']
2019-09-20 16:55:33,655 [1] DEBUG - Statement Id: [DAO00030_Update] Parameters: [@param0=[NGAYCHUNGTU,9/20/2019 4:52:51 PM], @param1=[LOAICHUNGTU,X], @param2=[MUCDICHCHUNGTU_ID,1060], @param3=[MUCDICHCHUNGTU_CODE,X13], @param4=[KHOXUAT_ID,32], @param5=[NGUOIGIAO_ID,0], @param6=[NGUOIGIAO,null], @param7=[KHONHAP_ID,null], @param8=[NGUOINHAN_ID,null], @param9=[NGUOINHAN,null], @param10=[NGUOIKIEMTRA_ID,null], @param11=[NGUOIKIEMTRA,null], @param12=[NGUOIDUYET_ID,null], @param13=[NGUOIDUYET,null], @param14=[PHUONGPHAPXUAT,0], @param15=[KETOANTRUONG_ID,null], @param16=[KETOANTRUONG,null], @param17=[THUKHO_ID,null], @param18=[THUKHO,null], @param19=[MAUHOADON,null], @param20=[SOHOADON,null], @param21=[SOSERI,null], @param22=[NGAYHOADON,null], @param23=[DIENGIAI,null], @param24=[GIATRI,null], @param25=[GIATRITHANHTOAN,null], @param26=[TYLEVAT,5], @param27=[GIATRIVAT,0], @param28=[THUESUAT,null], @param29=[GIATRITHUE,null], @param30=[TYLECHIETKHAU,null], @param31=[GIATRICHIETKHAU,null], @param32=[TIENTE_ID,null], @param33=[TYGIA,null], @param34=[SOCHUNGTUGOC,null], @param35=[NGAYCHUNGTUGOC,null], @param36=[NHACUNGCAP_ID,null], @param37=[HINHTHUCTHANHTOAN_ID,null], @param38=[NGUONDUOC_ID,null], @param39=[CHUNGTULIENQUAN_ID,null], @param40=[KHAMBENH_ID,null], @param41=[TOATHUOCNOITRU_ID,null], @param42=[TIEPNHAN_ID,null], @param43=[BENHAN_ID,null], @param44=[DANHANTHUOC, ], @param45=[NGUOINHAP_ID,null], @param46=[NGAYNHAP,null], @param47=[TRANGTHAI,DAXUAT], @param48=[PHIEULINH_ID,null], @param49=[LOAITOATHUOC,null], @param50=[DIENGIAINGHIEPVUPHATSINH,null], @param51=[DONVIGIAO_ID,null], @param52=[KHOSUDUNG_ID,null], @param53=[LOAIVATTU_ID,null], @param54=[BENHNHAN_ID,null], @param55=[TENBENHNHAN,null], @param56=[BACSIGIOITHIEU_ID,null], @param57=[DOITUONG_ID,null], @param58=[IDCHUYEN,null], @param59=[CHUNGTUKETOAN,null], @param60=[STATUS,null], @param61=[TRANSFER_VIENPHI_ID,null], @param62=[PHONGBAN_ID,62], @param63=[BACSI_ID,null], @param64=[TKNO,null], @param65=[TKCO,null], @param66=[MACHUNGTUREF,null], @param67=[LOAICHUNGTUREF,null], @param68=[PHIEULINHCANTRU_ID,null], @param69=[KHOTHUCHIEN_ID,null], @param70=[KHODOIUNG_ID,null], @param71=[MENU_LOAIDUOC_ID,null], @param72=[NGUOISUDUNGMAY_ID,null], @param73=[GOITHAU_ID,null], @param74=[XUATTHUOCBANGOAITRU,null], @param75=[NGAYGIOCHUNGTU,null], @param76=[NOIDAKHAM,null], @param77=[HOIDONGKIEMNHAP_ID,null], @param78=[HOIDONGTHANHLY_ID,null], @param79=[CHUYENCHUNGTUID,null], @param80=[CHUYENDOANHTHUID,null], @param81=[LYDOXUATSUDUNG_ID,8294], @param82=[NGAYCAPNHAT,9/20/2019 4:55:33 PM], @param83=[NGUOICAPNHAT_ID,0]]
2019-09-20 16:55:33,655 [1] DEBUG - Statement Id: [DAO00030_Update] Types: [@param0=[DateTime, System.DateTime], @param1=[String, System.String], @param2=[Int64, System.Int64], @param3=[String, System.String], @param4=[Int64, System.Int64], @param5=[Int64, System.Int64], @param6=[System.DBNull, null], @param7=[System.DBNull, null], @param8=[System.DBNull, null], @param9=[System.DBNull, null], @param10=[System.DBNull, null], @param11=[System.DBNull, null], @param12=[System.DBNull, null], @param13=[System.DBNull, null], @param14=[Int64, System.Int64], @param15=[System.DBNull, null], @param16=[System.DBNull, null], @param17=[System.DBNull, null], @param18=[System.DBNull, null], @param19=[System.DBNull, null], @param20=[System.DBNull, null], @param21=[System.DBNull, null], @param22=[System.DBNull, null], @param23=[System.DBNull, null], @param24=[System.DBNull, null], @param25=[System.DBNull, null], @param26=[Double, System.Double], @param27=[Double, System.Double], @param28=[System.DBNull, null], @param29=[System.DBNull, null], @param30=[System.DBNull, null], @param31=[System.DBNull, null], @param32=[System.DBNull, null], @param33=[System.DBNull, null], @param34=[System.DBNull, null], @param35=[System.DBNull, null], @param36=[System.DBNull, null], @param37=[System.DBNull, null], @param38=[System.DBNull, null], @param39=[System.DBNull, null], @param40=[System.DBNull, null], @param41=[System.DBNull, null], @param42=[System.DBNull, null], @param43=[System.DBNull, null], @param44=[String, System.String], @param45=[System.DBNull, null], @param46=[System.DBNull, null], @param47=[String, System.String], @param48=[System.DBNull, null], @param49=[System.DBNull, null], @param50=[System.DBNull, null], @param51=[System.DBNull, null], @param52=[System.DBNull, null], @param53=[System.DBNull, null], @param54=[System.DBNull, null], @param55=[System.DBNull, null], @param56=[System.DBNull, null], @param57=[System.DBNull, null], @param58=[System.DBNull, null], @param59=[System.DBNull, null], @param60=[System.DBNull, null], @param61=[System.DBNull, null], @param62=[Int64, System.Int64], @param63=[System.DBNull, null], @param64=[System.DBNull, null], @param65=[System.DBNull, null], @param66=[System.DBNull, null], @param67=[System.DBNull, null], @param68=[System.DBNull, null], @param69=[System.DBNull, null], @param70=[System.DBNull, null], @param71=[System.DBNull, null], @param72=[System.DBNull, null], @param73=[System.DBNull, null], @param74=[System.DBNull, null], @param75=[System.DBNull, null], @param76=[System.DBNull, null], @param77=[System.DBNull, null], @param78=[System.DBNull, null], @param79=[System.DBNull, null], @param80=[System.DBNull, null], @param81=[Int64, System.Int64], @param82=[DateTime, System.DateTime], @param83=[Int64, System.Int64]]
2019-09-20 16:55:33,754 [1] DEBUG - Statement Id: [DAO00030_CHUNGTUCT_DeleteP] PreparedStatement : [delete from TT_DUOC_CHUNGTU_CHITIET               where                             TT_DUOC_CHUNGTU_CHITIET.CHUNGTU_ID = '137702']
2019-09-20 16:55:33,822 [1] DEBUG - Statement Id: [DAO00030_TT_DUOC_TONKHO_LOG_Add] PreparedStatement : [DECLARE @KHODUOC_ID int               DECLARE @TONTRUOC numeric(18, 4)               DECLARE @TONSAU numeric(18, 4)               DECLARE @SOLUONGNHAP numeric(18, 4)               DECLARE @SOLUONGXUAT numeric(18, 4)                              IF( @param0  = 'N')               BEGIN                SET @KHODUOC_ID =  @param1                END               ELSE               BEGIN                 SET @KHODUOC_ID =  @param2                END                              SELECT @TONTRUOC = SOLUONG FROM TT_DUOC_TONKHO WHERE KHODUOC_ID = @KHODUOC_ID  AND DUOC_ID =  @param3  AND SOLONHAP_ID =  @param4  AND NGUONDUOC_ID =  @param5                               IF( @param0  = 'N' AND  @param6  = 'ADD')               BEGIN                SET @TONSAU = ISNULL(@TONTRUOC,0) +  @param7                 SET @SOLUONGNHAP =  @param7                 SET @SOLUONGXUAT = 0               END               IF( @param0  = 'N' AND  @param6  = 'DEL')               BEGIN                SET @TONSAU = ISNULL(@TONTRUOC,0) -  @param7                 SET @SOLUONGXUAT =  @param7                 SET @SOLUONGNHAP = 0               END                                         IF( @param0  = 'X' AND  @param6  = 'ADD')               BEGIN                SET @TONSAU = ISNULL(@TONTRUOC,0) -  @param8                 SET @SOLUONGXUAT =  @param8                 SET @SOLUONGNHAP = 0               END               IF( @param0  = 'X' AND  @param6  = 'DEL')               BEGIN                SET @TONSAU = ISNULL(@TONTRUOC,0) +  @param8                 SET @SOLUONGNHAP =  @param8                 SET @SOLUONGXUAT = 0                             END                        insert into TT_DUOC_TONKHO_LOG (                           CHUNGTUCHITIET_ID              ,CHUNGTU_ID              ,MACHUNGTU              ,LOAICHUNGTU              ,MUCDICHCHUNGTU_CODE              ,KHONHAP_ID              ,KHOXUAT_ID              ,DUOC_ID              ,SOLONHAP_ID              ,NGUONDUOC_ID              ,SOLUONGNHAP              ,SOLUONGXUAT              ,DONGIAMUA              ,DONGIAVON              ,TYLE_VAT              ,DONGIAVONVAT              ,TONTRUOC              ,TONSAU              ,ACTION              ,BENHVIEN_ID              ,NGAYTAO              ,NGUOITAO_ID                          ) values (              @param9               , @param10               , @param11               , @param0               , @param12               , @param1               , @param2               , @param3               , @param4               , @param5               ,@SOLUONGNHAP              ,@SOLUONGXUAT              , @param13               , @param14               , @param15               , @param16               ,@TONTRUOC              ,@TONSAU              , @param6               , @param17               , @param18               , @param19               )]
2019-09-20 16:55:33,823 [1] DEBUG - Statement Id: [DAO00030_TT_DUOC_TONKHO_LOG_Add] Parameters: [@param0=[LOAICHUNGTU,X], @param1=[KHONHAP_ID,null], @param2=[KHOXUAT_ID,32], @param3=[DUOC_ID,1], @param4=[SOLONHAP_ID,7541], @param5=[NGUONDUOC_ID,1], @param6=[ACTION,DEL], @param7=[SOLUONGNHAP,0], @param8=[SOLUONGXUAT,2], @param9=[CHUNGTUCHITIET_ID,1299044], @param10=[CHUNGTU_ID,137702], @param11=[MACHUNGTU,CS_KBX1319003090], @param12=[MUCDICHCHUNGTU_CODE,X13], @param13=[DONGIAMUA,945], @param14=[DONGIAVON,945], @param15=[TYLE_VAT,0], @param16=[DONGIAVONVAT,945], @param17=[BENHVIEN_ID,HLU01], @param18=[NGAYTAO,9/20/2019 4:55:33 PM], @param19=[NGUOITAO_ID,0]]
2019-09-20 16:55:33,823 [1] DEBUG - Statement Id: [DAO00030_TT_DUOC_TONKHO_LOG_Add] Types: [@param0=[String, System.String], @param1=[System.DBNull, null], @param2=[Int64, System.Int64], @param3=[Int64, System.Int64], @param4=[Int64, System.Int64], @param5=[Int64, System.Int64], @param6=[String, System.String], @param7=[Decimal, System.Decimal], @param8=[Decimal, System.Decimal], @param9=[Int64, System.Int64], @param10=[Int64, System.Int64], @param11=[String, System.String], @param12=[String, System.String], @param13=[Decimal, System.Decimal], @param14=[Decimal, System.Decimal], @param15=[Double, System.Double], @param16=[Double, System.Double], @param17=[String, System.String], @param18=[DateTime, System.DateTime], @param19=[Int64, System.Int64]]
2019-09-20 16:55:33,926 [1] DEBUG - Statement Id: [DAO00030_DUOC_TONKHO_BOOKING_NGOAITRU_Tang] PreparedStatement : [update TT_DUOC_TONKHO_BOOK_NGOAITRU            set            SOLUONG = SOLUONG +  @param0             , NGUOICAPNHAT_ID =  @param1             , NGAYCAPNHAT = getdate()            where            REF_TABLE =  @param2             AND REF_ID =  @param3             AND KHODUOC_ID =  @param4             AND DUOC_ID =  @param5             AND SOLUONG = 0            AND BENHVIEN_ID = 'HLU01']
2019-09-20 16:55:33,926 [1] DEBUG - Statement Id: [DAO00030_DUOC_TONKHO_BOOKING_NGOAITRU_Tang] Parameters: [@param0=[SOLUONGTHAYDOI,2], @param1=[NGUOICAPNHAT_ID,0], @param2=[REF_TABLE,TT_NGOAITRU_KHAMBENH_VTYT], @param3=[REF_ID,10593], @param4=[KHODUOC_ID,32], @param5=[DUOC_ID,1]]
2019-09-20 16:55:33,926 [1] DEBUG - Statement Id: [DAO00030_DUOC_TONKHO_BOOKING_NGOAITRU_Tang] Types: [@param0=[Double, System.Double], @param1=[Int64, System.Int64], @param2=[String, System.String], @param3=[Int64, System.Int64], @param4=[Int64, System.Int64], @param5=[Int64, System.Int64]]
2019-09-20 16:55:33,993 [1] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoVaBookingCOM23UpdateRedis] PreparedStatement : [declare @NGUONDUOC_MACDINH varchar(5) = '0';        declare @TOAMUANGOAI int = 0;        select @NGUONDUOC_MACDINH = isnull(VALUE,0) from TM_SYS_APPSETTINGS where CODE = 'PHA_NGUONDUOC'        select @TOAMUANGOAI = isnull(VALUE,0) from TM_SYS_APPSETTINGS where CODE = 'OPD_TOAMUANGOAI_DUNGDANHMUC_DUOC'                if @TOAMUANGOAI = 1        begin        select  distinct '0' + '_' + LTRIM(d.DUOC_ID) + '_' + @NGUONDUOC_MACDINH as DUOC_KEY, 0 as PHAMVI_ID, @NGUONDUOC_MACDINH as NGUONDUOC_ID, null as TENNGUONDUOC, null as TINHTIEN, d.DUOC_ID, ld.MALOAIDUOC,        d.SOVISA,d.TYLE_VAT,d.COTOA, d.MADUOC, d.TENHANG, d.TENDUOCDAYDU, dvt.TENDONVITINH as DONVITINH, d.BHYT,        d.TENHOATCHAT, d.HAMLUONG, d.HANGSANXUAT, d.QUOCGIA, d.LOAIDUOC_ID, d.DUONGDUNG_ID, d.TINHTIEN_PTTT,        ten.TENDUOC, ten.TENDUOC_EN, ten.MAQUOCTE, ten.MAQUOCTEBT,        '' as BHYT_TEXT        , ld.LOAIVATTU_ID        , d.BENHVIEN_ID,        999999999 as SOLUONG, d.VTYT_PHANLOAI, d.PHAMVI, d.SUASOLUONGTONGHOP, d.MADUOCBV, d.DANGTRINHBAY        , TAMNGUNG = CASE WHEN d.TAMNGUNG = '1' THEN '1' ELSE '0' END        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        where d.DUOC_ID in (1)        union all        select  distinct tk.DUOC_KEY, LTRIM(tk.PHAMVI_ID) as PHAMVI_ID, tk.NGUONDUOC_ID, nh.TENNGUONDUOC, nh.TINHTIEN, d.DUOC_ID, ld.MALOAIDUOC,        d.SOVISA,d.TYLE_VAT,d.COTOA, d.MADUOC, d.TENHANG, d.TENDUOCDAYDU, dvt.TENDONVITINH as DONVITINH, d.BHYT,        d.TENHOATCHAT, d.HAMLUONG, d.HANGSANXUAT, d.QUOCGIA, d.LOAIDUOC_ID, d.DUONGDUNG_ID, d.TINHTIEN_PTTT,        ten.TENDUOC, ten.TENDUOC_EN, ten.MAQUOCTE, ten.MAQUOCTEBT,        CASE WHEN d.BHYT = '1' THEN 'BHYT' ELSE '' END as BHYT_TEXT        , ld.LOAIVATTU_ID        , d.BENHVIEN_ID,        tk.SOLUONG, d.VTYT_PHANLOAI, d.PHAMVI, d.SUASOLUONGTONGHOP, d.MADUOCBV, d.DANGTRINHBAY        , TAMNGUNG = CASE WHEN d.TAMNGUNG = '1' OR nh.TAMNGUNG = '1' OR kd.TAMNGUNG = '1' THEN '1' ELSE '0' END        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        inner join        (        select  LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')) DUOC_KEY, (SUM(dtk.SOLUONG) - isnull(sum(A.SOLUONG),0) - isnull(sum(B.SOLUONG),0)) SOLUONG, pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        from (select sum(soluong) soluong,duoc_id,nguonduoc_id,khoduoc_id,benhvien_id from TT_DUOC_TONKHO  group by duoc_id,nguonduoc_id,khoduoc_id,benhvien_id) dtk        inner join TM_DUOC_PHAMVISD_MAPPING pvsd on dtk.KHODUOC_ID = pvsd.KHODUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NOITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) B on B.DUOC_ID = dtk.DUOC_ID and B.SOLUONG > 0 and B.PHAMVI_ID = pvsd.PHAMVI_ID and B.NGUONHANG_ID = dtk.NGUONDUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NGOAITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) A on A.DUOC_ID = dtk.DUOC_ID and A.SOLUONG > 0 and A.PHAMVI_ID = pvsd.PHAMVI_ID and A.NGUONHANG_ID = dtk.NGUONDUOC_ID        where dtk.SOLUONG > 0 and dtk.BENHVIEN_ID = 'HLU01'        group by LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')), pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        ) tk on tk.DUOC_ID = d.DUOC_ID        left join TM_DUOC_PHAMVISUDUNG kd on kd.PHAMVI_ID = tk.PHAMVI_ID and kd.BENHVIEN_ID = 'HLU01'        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = tk.NGUONDUOC_ID and nh.BENHVIEN_ID = 'HLU01'        where  d.BENHVIEN_ID = 'HLU01' and d.DUOC_ID in (1)        end        else        begin        select  distinct tk.DUOC_KEY, LTRIM(tk.PHAMVI_ID) as PHAMVI_ID, tk.NGUONDUOC_ID, nh.TENNGUONDUOC, nh.TINHTIEN, d.DUOC_ID, ld.MALOAIDUOC,        d.SOVISA,d.TYLE_VAT,d.COTOA, d.MADUOC, d.TENHANG, d.TENDUOCDAYDU, dvt.TENDONVITINH as DONVITINH, d.BHYT,        d.TENHOATCHAT, d.HAMLUONG, d.HANGSANXUAT, d.QUOCGIA, d.LOAIDUOC_ID, d.DUONGDUNG_ID, d.TINHTIEN_PTTT,        ten.TENDUOC, ten.TENDUOC_EN, ten.MAQUOCTE, ten.MAQUOCTEBT,        CASE WHEN d.BHYT = '1' THEN 'BHYT' ELSE '' END as BHYT_TEXT        , ld.LOAIVATTU_ID        , d.BENHVIEN_ID,        tk.SOLUONG, d.VTYT_PHANLOAI, d.PHAMVI, d.SUASOLUONGTONGHOP, d.MADUOCBV, d.DANGTRINHBAY        , TAMNGUNG = CASE WHEN d.TAMNGUNG = '1' OR nh.TAMNGUNG = '1' OR kd.TAMNGUNG = '1' THEN '1' ELSE '0' END        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        inner join        (        select  LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')) DUOC_KEY, (SUM(dtk.SOLUONG) - isnull(sum(A.SOLUONG),0) - isnull(sum(B.SOLUONG),0)) SOLUONG, pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        from (select sum(soluong) soluong,duoc_id,nguonduoc_id,khoduoc_id,benhvien_id from TT_DUOC_TONKHO  group by duoc_id,nguonduoc_id,khoduoc_id,benhvien_id) dtk        inner join TM_DUOC_PHAMVISD_MAPPING pvsd on dtk.KHODUOC_ID = pvsd.KHODUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NOITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) B on B.DUOC_ID = dtk.DUOC_ID and B.SOLUONG > 0 and B.PHAMVI_ID = pvsd.PHAMVI_ID and B.NGUONHANG_ID = dtk.NGUONDUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NGOAITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) A on A.DUOC_ID = dtk.DUOC_ID and A.SOLUONG > 0 and A.PHAMVI_ID = pvsd.PHAMVI_ID and A.NGUONHANG_ID = dtk.NGUONDUOC_ID        where dtk.SOLUONG > 0 and dtk.BENHVIEN_ID = 'HLU01'        group by LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')), pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        ) tk on tk.DUOC_ID = d.DUOC_ID        left join TM_DUOC_PHAMVISUDUNG kd on kd.PHAMVI_ID = tk.PHAMVI_ID and kd.BENHVIEN_ID = 'HLU01'        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = tk.NGUONDUOC_ID and nh.BENHVIEN_ID = 'HLU01'        where  d.BENHVIEN_ID = 'HLU01' and d.DUOC_ID in (1)        end]
2019-09-20 16:55:34,245 [1] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoCOM18UpdateRedis] PreparedStatement : [select distinct TT_TONKHO.DUOC_KEY, LTRIM(TT_TONKHO.KHODUOC_ID) as KHODUOC_ID, TM_DUOC.DUOC_ID, TM_LOAIDUOC.MALOAIDUOC,TM_DUOC.SOVISA,TM_DUOC.TYLE_VAT,TM_DUOC.COTOA,        TM_DUOC.MADUOC, TM_DUOC.TENHANG, TM_DUOC.TENDUOCDAYDU, dvt.TENDONVITINH as DONVITINH,  TM_DUOC.DONVITINH_ID,TM_DUOC.BHYT,        TM_DUOC.TENHOATCHAT,        TM_DUOC.HAMLUONG, TM_DUOC.HANGSANXUAT, TM_DUOC.QUOCGIA, TM_DUOC.LOAIDUOC_ID, TM_DUOC.DUONGDUNG_ID,        TM_TENDUOC.TENDUOC, TM_TENDUOC.TENDUOC_EN, TM_TENDUOC.MAQUOCTE, TM_TENDUOC.MAQUOCTEBT,        TM_LOAIDUOC.LOAIVATTU_ID, TM_DUOC.BENHVIEN_ID,        TT_TONKHO.SOLUONG, TM_DUOC.VTYT_PHANLOAI, TM_DUOC.PHAMVI, TT_TONKHO.NGUONDUOC_ID, NG.TENNGUONDUOC AS TENNGUONDUOC        , TAMNGUNG = CASE WHEN TM_DUOC.TAMNGUNG = '1' OR NG.TAMNGUNG = '1' OR KD.TAMNGUNG = '1' THEN '1' ELSE '0' END        , TM_DUOC.DANGTRINHBAY        from TM_DUOC        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = TM_DUOC.DONVITINH_ID        left join TM_TENDUOC on TM_DUOC.TENDUOC_ID = TM_TENDUOC.TENDUOC_ID and TM_DUOC.BENHVIEN_ID = 'HLU01' and TM_DUOC.TAMNGUNG = '0'        left join TM_LOAIDUOC on TM_LOAIDUOC.LOAIDUOC_ID = TM_DUOC.LOAIDUOC_ID and TM_LOAIDUOC.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG on (TM_LOAIDUOC.LOAIVATTU_ID = TM_DUOC_HANDUNG.LOAIDUOC and TM_DUOC_HANDUNG.BENHVIEN_ID = 'HLU01')        inner join        (select LTRIM(A.KHODUOC_ID) + '_' + LTRIM(A.DUOC_ID) + '_' + LTRIM(ISNULL(A.NGUONDUOC_ID,'')) as DUOC_KEY, A.KHODUOC_ID, A.DUOC_ID, A.NGUONDUOC_ID,        SUM(isnull(A.SOLUONG,0)) as SOLUONG        from        (select SUM(SOLUONG) as SOLUONG, KHODUOC_ID, DUOC_ID, NGUONDUOC_ID from TT_DUOC_TONKHO        where BENHVIEN_ID = 'HLU01' group by KHODUOC_ID, DUOC_ID, NGUONDUOC_ID) A        group by LTRIM(A.KHODUOC_ID) + '_' + LTRIM(A.DUOC_ID) + '_' + LTRIM(ISNULL(A.NGUONDUOC_ID,'')), A.KHODUOC_ID, A.DUOC_ID, NGUONDUOC_ID        ) TT_TONKHO on TT_TONKHO.DUOC_ID = TM_DUOC.DUOC_ID        LEFT JOIN TM_NGUONHANG NG ON NG.NGUONDUOC_ID = TT_TONKHO.NGUONDUOC_ID        LEFT JOIN TM_KHODUOC KD ON KD.KHODUOC_ID = TT_TONKHO.KHODUOC_ID        where TM_DUOC.BENHVIEN_ID = 'HLU01' and TT_TONKHO.SOLUONG >= 0        and TM_DUOC.DUOC_ID in (1)]
2019-09-20 16:55:34,323 [1] DEBUG - Statement Id: [DAO00030_DUOCTONKHO_Tang] PreparedStatement : [IF EXISTS            (              SELECT DUOCTONKHO_ID              FROM TT_DUOC_TONKHO              WHERE              KHODUOC_ID =  @param0               AND DUOC_ID =  @param1               AND  SOLONHAP_ID =  @param2             )            BEGIN              update TT_DUOC_TONKHO set              SOLUONG = SOLUONG +   @param3               , NGAYCAPNHAT =  @param4               , NGUOICAPNHAT_ID =  @param5               where              KHODUOC_ID =  @param0               AND DUOC_ID =  @param1               AND  SOLONHAP_ID =  @param2             END            ELSE            BEGIN              insert into TT_DUOC_TONKHO (              KHODUOC_ID              , DUOC_ID              , NGUONDUOC_ID              , SOLONHAP_ID              , DONGIAMUA              , SOLUONG              , BENHVIEN_ID              , NGAYTAO              , NGUOITAO_ID                     ) values (               @param0               ,  @param1               ,  @param6               ,  @param2               ,  @param7               ,  @param3               ,  @param8               ,  @param9               ,  @param10                        )            END]
2019-09-20 16:55:34,323 [1] DEBUG - Statement Id: [DAO00030_DUOCTONKHO_Tang] Parameters: [@param0=[KHODUOC_ID,32], @param1=[DUOC_ID,1], @param2=[SOLONHAP_ID,7541], @param3=[SOLUONGTHAYDOI,2], @param4=[NGAYCAPNHAT,9/20/2019 4:55:34 PM], @param5=[NGUOICAPNHAT_ID,0], @param6=[NGUONDUOC_ID,1], @param7=[DONGIAMUA,945], @param8=[BENHVIEN_ID,HLU01], @param9=[NGAYTAO,9/20/2019 4:52:51 PM], @param10=[NGUOITAO_ID,0]]
2019-09-20 16:55:34,323 [1] DEBUG - Statement Id: [DAO00030_DUOCTONKHO_Tang] Types: [@param0=[Int64, System.Int64], @param1=[Int64, System.Int64], @param2=[Int64, System.Int64], @param3=[Double, System.Double], @param4=[DateTime, System.DateTime], @param5=[Int64, System.Int64], @param6=[Int64, System.Int64], @param7=[Double, System.Double], @param8=[String, System.String], @param9=[DateTime, System.DateTime], @param10=[Int64, System.Int64]]
2019-09-20 16:55:34,384 [1] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoCOM18] PreparedStatement : [select  distinct TT_TONKHO.DUOC_KEY, LTRIM(TT_TONKHO.KHODUOC_ID) as KHODUOC_ID, TM_DUOC.DUOC_ID, TM_LOAIDUOC.MALOAIDUOC,TM_DUOC.SOVISA,TM_DUOC.TYLE_VAT,TM_DUOC.COTOA,        TM_DUOC.MADUOC, TM_DUOC.TENHANG, TM_DUOC.TENDUOCDAYDU, dvt.TENDONVITINH as DONVITINH, TM_DUOC.DONVITINH_ID, TM_DUOC.BHYT,        TM_DUOC.TENHOATCHAT, TM_DUOC.HAMLUONG, TM_DUOC.HANGSANXUAT, TM_DUOC.QUOCGIA, TM_DUOC.LOAIDUOC_ID, TM_DUOC.DUONGDUNG_ID,        TM_TENDUOC.TENDUOC, TM_TENDUOC.TENDUOC_EN, TM_TENDUOC.MAQUOCTE, TM_TENDUOC.MAQUOCTEBT,        TM_LOAIDUOC.LOAIVATTU_ID, TM_DUOC.BENHVIEN_ID,        TT_TONKHO.SOLUONG, TM_DUOC.VTYT_PHANLOAI, TM_DUOC.PHAMVI, TT_TONKHO.NGUONDUOC_ID, NG.TENNGUONDUOC        , TAMNGUNG = CASE WHEN TM_DUOC.TAMNGUNG = '1' OR NG.TAMNGUNG = '1' OR KD.TAMNGUNG = '1' THEN '1' ELSE '0' END        , TM_DUOC.DANGTRINHBAY        from TM_DUOC        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = TM_DUOC.DONVITINH_ID        left join TM_TENDUOC on TM_DUOC.TENDUOC_ID = TM_TENDUOC.TENDUOC_ID and TM_DUOC.BENHVIEN_ID = 'HLU01'  and TM_DUOC.TAMNGUNG = '0'        left join TM_LOAIDUOC on TM_LOAIDUOC.LOAIDUOC_ID = TM_DUOC.LOAIDUOC_ID and TM_LOAIDUOC.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG on (TM_LOAIDUOC.LOAIVATTU_ID = TM_DUOC_HANDUNG.LOAIDUOC and TM_DUOC_HANDUNG.BENHVIEN_ID = 'HLU01')        inner join        (select LTRIM(A.KHODUOC_ID) + '_' + LTRIM(A.DUOC_ID) + '_' + LTRIM(ISNULL(A.NGUONDUOC_ID,'')) as DUOC_KEY, A.KHODUOC_ID, A.DUOC_ID ,a.NGUONDUOC_ID,        SUM(isnull(A.SOLUONG,0)) as SOLUONG        from        (select SUM(SOLUONG) as SOLUONG, KHODUOC_ID, DUOC_ID, NGUONDUOC_ID from TT_DUOC_TONKHO        where KHODUOC_ID in (32) and DUOC_ID in (1) group by KHODUOC_ID, DUOC_ID, NGUONDUOC_ID        ) A        where A.KHODUOC_ID in (32) and A.DUOC_ID in (1)        group by LTRIM(A.KHODUOC_ID) + '_' + LTRIM(A.DUOC_ID) + '_' + LTRIM(A.NGUONDUOC_ID), A.KHODUOC_ID, A.DUOC_ID, A.NGUONDUOC_ID)        TT_TONKHO on TT_TONKHO.DUOC_ID = TM_DUOC.DUOC_ID        LEFT JOIN TM_NGUONHANG NG ON NG.NGUONDUOC_ID = TT_TONKHO.NGUONDUOC_ID        LEFT JOIN TM_KHODUOC KD ON KD.KHODUOC_ID = TT_TONKHO.KHODUOC_ID        where TM_DUOC.BENHVIEN_ID = 'HLU01' and TM_DUOC.DUOC_ID in (1)]
2019-09-20 16:55:34,427 [1] DEBUG - Statement Id: [DAO00030_GetListPhamViByKhoDuoc] PreparedStatement : [SELECT DISTINCT PHAMVI_ID          FROM TM_DUOC_PHAMVISD_MAPPING          WHERE          KHODUOC_ID IN (32)          AND BENHVIEN_ID ='HLU01'          AND TAMNGUNG = '0']
2019-09-20 16:55:34,463 [1] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoVaBookingCOM23] PreparedStatement : [declare @NGUONDUOC_MACDINH varchar(5) = '0';        declare @TOAMUANGOAI int = 0;        select @NGUONDUOC_MACDINH = isnull(VALUE,0) from TM_SYS_APPSETTINGS where CODE = 'PHA_NGUONDUOC'        select @TOAMUANGOAI = isnull(VALUE,0) from TM_SYS_APPSETTINGS where CODE = 'OPD_TOAMUANGOAI_DUNGDANHMUC_DUOC'                if @TOAMUANGOAI = 1        begin        select  distinct '0' + '_' + LTRIM(d.DUOC_ID) + '_' + @NGUONDUOC_MACDINH as DUOC_KEY, 0 as PHAMVI_ID, @NGUONDUOC_MACDINH as NGUONDUOC_ID, null as TENNGUONDUOC, null as TINHTIEN, d.DUOC_ID, ld.MALOAIDUOC,        d.SOVISA,d.TYLE_VAT,d.COTOA, d.MADUOC, d.TENHANG, d.TENDUOCDAYDU, dvt.TENDONVITINH as DONVITINH, d.BHYT,        d.TENHOATCHAT, d.HAMLUONG, d.HANGSANXUAT, d.QUOCGIA, d.LOAIDUOC_ID, d.DUONGDUNG_ID, d.TINHTIEN_PTTT,        ten.TENDUOC, ten.TENDUOC_EN, ten.MAQUOCTE, ten.MAQUOCTEBT,        '' as BHYT_TEXT        , ld.LOAIVATTU_ID        , d.BENHVIEN_ID,        999999999 as SOLUONG, d.VTYT_PHANLOAI, d.PHAMVI, d.SUASOLUONGTONGHOP, d.MADUOCBV, d.DANGTRINHBAY        , TAMNGUNG = CASE WHEN d.TAMNGUNG = '1' THEN '1' ELSE '0' END        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        where d.DUOC_ID in (1)        union all        select  distinct tk.DUOC_KEY, LTRIM(tk.PHAMVI_ID) as PHAMVI_ID, tk.NGUONDUOC_ID, nh.TENNGUONDUOC, nh.TINHTIEN, d.DUOC_ID, ld.MALOAIDUOC,        d.SOVISA,d.TYLE_VAT,d.COTOA, d.MADUOC, d.TENHANG, d.TENDUOCDAYDU, dvt.TENDONVITINH as DONVITINH, d.BHYT,        d.TENHOATCHAT, d.HAMLUONG, d.HANGSANXUAT, d.QUOCGIA, d.LOAIDUOC_ID, d.DUONGDUNG_ID, d.TINHTIEN_PTTT,        ten.TENDUOC, ten.TENDUOC_EN, ten.MAQUOCTE, ten.MAQUOCTEBT,        CASE WHEN d.BHYT = '1' THEN 'BHYT' ELSE '' END as BHYT_TEXT        , ld.LOAIVATTU_ID        , d.BENHVIEN_ID,        tk.SOLUONG, d.VTYT_PHANLOAI, d.PHAMVI, d.SUASOLUONGTONGHOP, d.MADUOCBV, d.DANGTRINHBAY        , TAMNGUNG = CASE WHEN d.TAMNGUNG = '1' OR nh.TAMNGUNG = '1' OR kd.TAMNGUNG = '1' THEN '1' ELSE '0' END        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        inner join        (        select  LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')) DUOC_KEY, (SUM(dtk.SOLUONG) - isnull(sum(A.SOLUONG),0) - isnull(sum(B.SOLUONG),0)) SOLUONG, pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        from (select sum(soluong) soluong,duoc_id,nguonduoc_id,khoduoc_id,benhvien_id from TT_DUOC_TONKHO  group by duoc_id,nguonduoc_id,khoduoc_id,benhvien_id) dtk        inner join TM_DUOC_PHAMVISD_MAPPING pvsd on dtk.KHODUOC_ID = pvsd.KHODUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NOITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) B on B.DUOC_ID = dtk.DUOC_ID and B.SOLUONG > 0 and B.PHAMVI_ID = pvsd.PHAMVI_ID and B.NGUONHANG_ID = dtk.NGUONDUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NGOAITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) A on A.DUOC_ID = dtk.DUOC_ID and A.SOLUONG > 0 and A.PHAMVI_ID = pvsd.PHAMVI_ID and A.NGUONHANG_ID = dtk.NGUONDUOC_ID        where dtk.SOLUONG > 0 and dtk.BENHVIEN_ID = 'HLU01'        group by LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')), pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        ) tk on tk.DUOC_ID = d.DUOC_ID        left join TM_DUOC_PHAMVISUDUNG kd on kd.PHAMVI_ID = tk.PHAMVI_ID and kd.BENHVIEN_ID = 'HLU01'        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = tk.NGUONDUOC_ID and nh.BENHVIEN_ID = 'HLU01'        where  d.BENHVIEN_ID = 'HLU01' and d.DUOC_ID in (1) and TK.PHAMVI_ID in (1055)        and tk.NGUONDUOC_ID in (1)         end        else        begin                select  distinct tk.DUOC_KEY, LTRIM(tk.PHAMVI_ID) as PHAMVI_ID, tk.NGUONDUOC_ID, nh.TENNGUONDUOC, nh.TINHTIEN, d.DUOC_ID, ld.MALOAIDUOC,        d.SOVISA,d.TYLE_VAT,d.COTOA, d.MADUOC, d.TENHANG, d.TENDUOCDAYDU, dvt.TENDONVITINH as DONVITINH, d.BHYT,        d.TENHOATCHAT, d.HAMLUONG, d.HANGSANXUAT, d.QUOCGIA, d.LOAIDUOC_ID, d.DUONGDUNG_ID, d.TINHTIEN_PTTT,        ten.TENDUOC, ten.TENDUOC_EN, ten.MAQUOCTE, ten.MAQUOCTEBT,        CASE WHEN d.BHYT = '1' THEN 'BHYT' ELSE '' END as BHYT_TEXT        , ld.LOAIVATTU_ID        , d.BENHVIEN_ID,        tk.SOLUONG, d.VTYT_PHANLOAI, d.PHAMVI, d.SUASOLUONGTONGHOP, d.MADUOCBV, d.DANGTRINHBAY        , TAMNGUNG = CASE WHEN d.TAMNGUNG = '1' OR nh.TAMNGUNG = '1' OR kd.TAMNGUNG = '1' THEN '1' ELSE '0' END        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        inner join        (        select  LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')) DUOC_KEY, (SUM(dtk.SOLUONG) - isnull(sum(A.SOLUONG),0) - isnull(sum(B.SOLUONG),0)) SOLUONG, pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        from (select sum(soluong) soluong,duoc_id,nguonduoc_id,khoduoc_id,benhvien_id from TT_DUOC_TONKHO  group by duoc_id,nguonduoc_id,khoduoc_id,benhvien_id) dtk        inner join TM_DUOC_PHAMVISD_MAPPING pvsd on dtk.KHODUOC_ID = pvsd.KHODUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NOITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) B on B.DUOC_ID = dtk.DUOC_ID and B.SOLUONG > 0 and B.PHAMVI_ID = pvsd.PHAMVI_ID and B.NGUONHANG_ID = dtk.NGUONDUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NGOAITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) A on A.DUOC_ID = dtk.DUOC_ID and A.SOLUONG > 0 and A.PHAMVI_ID = pvsd.PHAMVI_ID and A.NGUONHANG_ID = dtk.NGUONDUOC_ID        where dtk.SOLUONG > 0 and dtk.BENHVIEN_ID = 'HLU01'        group by LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')), pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        ) tk on tk.DUOC_ID = d.DUOC_ID        left join TM_DUOC_PHAMVISUDUNG kd on kd.PHAMVI_ID = tk.PHAMVI_ID and kd.BENHVIEN_ID = 'HLU01'        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = tk.NGUONDUOC_ID and nh.BENHVIEN_ID = 'HLU01'        where  d.BENHVIEN_ID = 'HLU01' and d.DUOC_ID in (1) and TK.PHAMVI_ID in (1055)        and tk.NGUONDUOC_ID in (1)         end]
2019-09-20 16:55:34,622 [1] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoCOM18UpdateRedis] PreparedStatement : [select distinct TT_TONKHO.DUOC_KEY, LTRIM(TT_TONKHO.KHODUOC_ID) as KHODUOC_ID, TM_DUOC.DUOC_ID, TM_LOAIDUOC.MALOAIDUOC,TM_DUOC.SOVISA,TM_DUOC.TYLE_VAT,TM_DUOC.COTOA,        TM_DUOC.MADUOC, TM_DUOC.TENHANG, TM_DUOC.TENDUOCDAYDU, dvt.TENDONVITINH as DONVITINH,  TM_DUOC.DONVITINH_ID,TM_DUOC.BHYT,        TM_DUOC.TENHOATCHAT,        TM_DUOC.HAMLUONG, TM_DUOC.HANGSANXUAT, TM_DUOC.QUOCGIA, TM_DUOC.LOAIDUOC_ID, TM_DUOC.DUONGDUNG_ID,        TM_TENDUOC.TENDUOC, TM_TENDUOC.TENDUOC_EN, TM_TENDUOC.MAQUOCTE, TM_TENDUOC.MAQUOCTEBT,        TM_LOAIDUOC.LOAIVATTU_ID, TM_DUOC.BENHVIEN_ID,        TT_TONKHO.SOLUONG, TM_DUOC.VTYT_PHANLOAI, TM_DUOC.PHAMVI, TT_TONKHO.NGUONDUOC_ID, NG.TENNGUONDUOC AS TENNGUONDUOC        , TAMNGUNG = CASE WHEN TM_DUOC.TAMNGUNG = '1' OR NG.TAMNGUNG = '1' OR KD.TAMNGUNG = '1' THEN '1' ELSE '0' END        , TM_DUOC.DANGTRINHBAY        from TM_DUOC        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = TM_DUOC.DONVITINH_ID        left join TM_TENDUOC on TM_DUOC.TENDUOC_ID = TM_TENDUOC.TENDUOC_ID and TM_DUOC.BENHVIEN_ID = 'HLU01' and TM_DUOC.TAMNGUNG = '0'        left join TM_LOAIDUOC on TM_LOAIDUOC.LOAIDUOC_ID = TM_DUOC.LOAIDUOC_ID and TM_LOAIDUOC.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG on (TM_LOAIDUOC.LOAIVATTU_ID = TM_DUOC_HANDUNG.LOAIDUOC and TM_DUOC_HANDUNG.BENHVIEN_ID = 'HLU01')        inner join        (select LTRIM(A.KHODUOC_ID) + '_' + LTRIM(A.DUOC_ID) + '_' + LTRIM(ISNULL(A.NGUONDUOC_ID,'')) as DUOC_KEY, A.KHODUOC_ID, A.DUOC_ID, A.NGUONDUOC_ID,        SUM(isnull(A.SOLUONG,0)) as SOLUONG        from        (select SUM(SOLUONG) as SOLUONG, KHODUOC_ID, DUOC_ID, NGUONDUOC_ID from TT_DUOC_TONKHO        where BENHVIEN_ID = 'HLU01' group by KHODUOC_ID, DUOC_ID, NGUONDUOC_ID) A        group by LTRIM(A.KHODUOC_ID) + '_' + LTRIM(A.DUOC_ID) + '_' + LTRIM(ISNULL(A.NGUONDUOC_ID,'')), A.KHODUOC_ID, A.DUOC_ID, NGUONDUOC_ID        ) TT_TONKHO on TT_TONKHO.DUOC_ID = TM_DUOC.DUOC_ID        LEFT JOIN TM_NGUONHANG NG ON NG.NGUONDUOC_ID = TT_TONKHO.NGUONDUOC_ID        LEFT JOIN TM_KHODUOC KD ON KD.KHODUOC_ID = TT_TONKHO.KHODUOC_ID        where TM_DUOC.BENHVIEN_ID = 'HLU01' and TT_TONKHO.SOLUONG >= 0        and TM_DUOC.DUOC_ID in (1)]
2019-09-20 16:55:34,701 [1] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoVaBookingCOM23UpdateRedis] PreparedStatement : [declare @NGUONDUOC_MACDINH varchar(5) = '0';        declare @TOAMUANGOAI int = 0;        select @NGUONDUOC_MACDINH = isnull(VALUE,0) from TM_SYS_APPSETTINGS where CODE = 'PHA_NGUONDUOC'        select @TOAMUANGOAI = isnull(VALUE,0) from TM_SYS_APPSETTINGS where CODE = 'OPD_TOAMUANGOAI_DUNGDANHMUC_DUOC'                if @TOAMUANGOAI = 1        begin        select  distinct '0' + '_' + LTRIM(d.DUOC_ID) + '_' + @NGUONDUOC_MACDINH as DUOC_KEY, 0 as PHAMVI_ID, @NGUONDUOC_MACDINH as NGUONDUOC_ID, null as TENNGUONDUOC, null as TINHTIEN, d.DUOC_ID, ld.MALOAIDUOC,        d.SOVISA,d.TYLE_VAT,d.COTOA, d.MADUOC, d.TENHANG, d.TENDUOCDAYDU, dvt.TENDONVITINH as DONVITINH, d.BHYT,        d.TENHOATCHAT, d.HAMLUONG, d.HANGSANXUAT, d.QUOCGIA, d.LOAIDUOC_ID, d.DUONGDUNG_ID, d.TINHTIEN_PTTT,        ten.TENDUOC, ten.TENDUOC_EN, ten.MAQUOCTE, ten.MAQUOCTEBT,        '' as BHYT_TEXT        , ld.LOAIVATTU_ID        , d.BENHVIEN_ID,        999999999 as SOLUONG, d.VTYT_PHANLOAI, d.PHAMVI, d.SUASOLUONGTONGHOP, d.MADUOCBV, d.DANGTRINHBAY        , TAMNGUNG = CASE WHEN d.TAMNGUNG = '1' THEN '1' ELSE '0' END        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        where d.DUOC_ID in (1)        union all        select  distinct tk.DUOC_KEY, LTRIM(tk.PHAMVI_ID) as PHAMVI_ID, tk.NGUONDUOC_ID, nh.TENNGUONDUOC, nh.TINHTIEN, d.DUOC_ID, ld.MALOAIDUOC,        d.SOVISA,d.TYLE_VAT,d.COTOA, d.MADUOC, d.TENHANG, d.TENDUOCDAYDU, dvt.TENDONVITINH as DONVITINH, d.BHYT,        d.TENHOATCHAT, d.HAMLUONG, d.HANGSANXUAT, d.QUOCGIA, d.LOAIDUOC_ID, d.DUONGDUNG_ID, d.TINHTIEN_PTTT,        ten.TENDUOC, ten.TENDUOC_EN, ten.MAQUOCTE, ten.MAQUOCTEBT,        CASE WHEN d.BHYT = '1' THEN 'BHYT' ELSE '' END as BHYT_TEXT        , ld.LOAIVATTU_ID        , d.BENHVIEN_ID,        tk.SOLUONG, d.VTYT_PHANLOAI, d.PHAMVI, d.SUASOLUONGTONGHOP, d.MADUOCBV, d.DANGTRINHBAY        , TAMNGUNG = CASE WHEN d.TAMNGUNG = '1' OR nh.TAMNGUNG = '1' OR kd.TAMNGUNG = '1' THEN '1' ELSE '0' END        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        inner join        (        select  LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')) DUOC_KEY, (SUM(dtk.SOLUONG) - isnull(sum(A.SOLUONG),0) - isnull(sum(B.SOLUONG),0)) SOLUONG, pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        from (select sum(soluong) soluong,duoc_id,nguonduoc_id,khoduoc_id,benhvien_id from TT_DUOC_TONKHO  group by duoc_id,nguonduoc_id,khoduoc_id,benhvien_id) dtk        inner join TM_DUOC_PHAMVISD_MAPPING pvsd on dtk.KHODUOC_ID = pvsd.KHODUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NOITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) B on B.DUOC_ID = dtk.DUOC_ID and B.SOLUONG > 0 and B.PHAMVI_ID = pvsd.PHAMVI_ID and B.NGUONHANG_ID = dtk.NGUONDUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NGOAITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) A on A.DUOC_ID = dtk.DUOC_ID and A.SOLUONG > 0 and A.PHAMVI_ID = pvsd.PHAMVI_ID and A.NGUONHANG_ID = dtk.NGUONDUOC_ID        where dtk.SOLUONG > 0 and dtk.BENHVIEN_ID = 'HLU01'        group by LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')), pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        ) tk on tk.DUOC_ID = d.DUOC_ID        left join TM_DUOC_PHAMVISUDUNG kd on kd.PHAMVI_ID = tk.PHAMVI_ID and kd.BENHVIEN_ID = 'HLU01'        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = tk.NGUONDUOC_ID and nh.BENHVIEN_ID = 'HLU01'        where  d.BENHVIEN_ID = 'HLU01' and d.DUOC_ID in (1)        end        else        begin        select  distinct tk.DUOC_KEY, LTRIM(tk.PHAMVI_ID) as PHAMVI_ID, tk.NGUONDUOC_ID, nh.TENNGUONDUOC, nh.TINHTIEN, d.DUOC_ID, ld.MALOAIDUOC,        d.SOVISA,d.TYLE_VAT,d.COTOA, d.MADUOC, d.TENHANG, d.TENDUOCDAYDU, dvt.TENDONVITINH as DONVITINH, d.BHYT,        d.TENHOATCHAT, d.HAMLUONG, d.HANGSANXUAT, d.QUOCGIA, d.LOAIDUOC_ID, d.DUONGDUNG_ID, d.TINHTIEN_PTTT,        ten.TENDUOC, ten.TENDUOC_EN, ten.MAQUOCTE, ten.MAQUOCTEBT,        CASE WHEN d.BHYT = '1' THEN 'BHYT' ELSE '' END as BHYT_TEXT        , ld.LOAIVATTU_ID        , d.BENHVIEN_ID,        tk.SOLUONG, d.VTYT_PHANLOAI, d.PHAMVI, d.SUASOLUONGTONGHOP, d.MADUOCBV, d.DANGTRINHBAY        , TAMNGUNG = CASE WHEN d.TAMNGUNG = '1' OR nh.TAMNGUNG = '1' OR kd.TAMNGUNG = '1' THEN '1' ELSE '0' END        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        inner join        (        select  LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')) DUOC_KEY, (SUM(dtk.SOLUONG) - isnull(sum(A.SOLUONG),0) - isnull(sum(B.SOLUONG),0)) SOLUONG, pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        from (select sum(soluong) soluong,duoc_id,nguonduoc_id,khoduoc_id,benhvien_id from TT_DUOC_TONKHO  group by duoc_id,nguonduoc_id,khoduoc_id,benhvien_id) dtk        inner join TM_DUOC_PHAMVISD_MAPPING pvsd on dtk.KHODUOC_ID = pvsd.KHODUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NOITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) B on B.DUOC_ID = dtk.DUOC_ID and B.SOLUONG > 0 and B.PHAMVI_ID = pvsd.PHAMVI_ID and B.NGUONHANG_ID = dtk.NGUONDUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NGOAITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) A on A.DUOC_ID = dtk.DUOC_ID and A.SOLUONG > 0 and A.PHAMVI_ID = pvsd.PHAMVI_ID and A.NGUONHANG_ID = dtk.NGUONDUOC_ID        where dtk.SOLUONG > 0 and dtk.BENHVIEN_ID = 'HLU01'        group by LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')), pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        ) tk on tk.DUOC_ID = d.DUOC_ID        left join TM_DUOC_PHAMVISUDUNG kd on kd.PHAMVI_ID = tk.PHAMVI_ID and kd.BENHVIEN_ID = 'HLU01'        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = tk.NGUONDUOC_ID and nh.BENHVIEN_ID = 'HLU01'        where  d.BENHVIEN_ID = 'HLU01' and d.DUOC_ID in (1)        end]
2019-09-20 16:55:34,880 [1] DEBUG - Statement Id: [DAO00030_RemoveChungTuVTYTNgoaiTru] PreparedStatement : [update TT_NGOAITRU_KHAMBENH_VTYT set            CHUNGTU_ID = null,            TRANGTHAI = null            where            CHUNGTU_ID =   @param0               update TT_VIENPHI set            DUYET = '0',            DATHUCHIEN = '0'            where            REF_TABLE = 'TT_NGOAITRU_KHAMBENH_VTYT'            AND REF_ID IN (10593)]
2019-09-20 16:55:34,880 [1] DEBUG - Statement Id: [DAO00030_RemoveChungTuVTYTNgoaiTru] Parameters: [@param0=[CHUNGTU_ID,137702]]
2019-09-20 16:55:34,880 [1] DEBUG - Statement Id: [DAO00030_RemoveChungTuVTYTNgoaiTru] Types: [@param0=[Int64, System.Int64]]
2019-09-20 16:55:34,969 [1] DEBUG - Statement Id: [DAO00030_CHUNGTUCT_Add] PreparedStatement : [insert into TT_DUOC_CHUNGTU_CHITIET (            CHUNGTU_ID            , DUOC_ID            , SOLONHAP_ID            , SOKIEMSOAT            , SOVISA            , HANDUNG            , DONVITINH_ID            , SOLUONGYEUCAU            , SOLUONGTHUCTE            , SOLUONGDAXUAT            , TIENTE_ID            , TYGIA            , DONGIAMUA            , DONGIA_BHYT            , DONGIABAN            , DONGIABAN_VAT            , DONGIAVON            , DONGIATHANHTOAN            , SOQUYEN            , SOHOADONVAT            , TYLEVAT            , GIATRIVAT            , TYLECHIETKHAU            , GIATRICHIETKHAU            , MIENPHI            , LYDOMIENPHI_ID            , SOCHUNGTUKETOAN            , SOCHUNGTUTIENMAT            , TRANGTHAI            , DAPHATSINHPHIEUXUAT            , DAPHATSINHPHIEUHOANTRA            , KHUYENMAI            , PHUONGPHAPXUAT            , DONDATHANG_ID            , GHICHUCHITIET            , NGUONHANG_ID            , DONGIAVONVAT            , THANHTIENMUA            , THANHTIENVON            , THANHTIENHOPDONG            , ISTACHLO            , DONVITINHBANDAU_ID            , SOLUONGBANDAU            , GOITHAU_ID            , DONGIATHAU            , DONGIAPO            , TYLEQUIDOI            , TOATHUOCNOITRU_ID            , KHAMBENH_VTYT_ID            , PHAUTHUAT_VTYT_ID            , CLSKETQUA_VTYT_ID            , TOATHUOCNGOAITRU_ID            , MASTER_ID            , BENHNHAN            , YLENH                                   , BENHVIEN_ID            , NGAYTAO            , NGUOITAO_ID            , NGAYCAPNHAT            , NGUOICAPNHAT_ID            , THANHTIENMUABANDAU            , SOLUONGQUIDOI            ) values (             @param0             ,  @param1             ,  @param2             ,  @param3             ,  @param4             ,  @param5             ,  @param6             ,  @param7             ,  @param8             ,  @param9             ,  @param10             ,  @param11             ,  @param12             ,  @param13             ,  @param14             ,  @param15             ,  @param16             ,  @param17             ,  @param18             ,  @param19             ,  @param20             ,  @param21             ,  @param22             ,  @param23             ,  @param24             ,  @param25             ,  @param26             ,  @param27             ,  @param28             ,  @param29             ,  @param30             ,  @param31             ,  @param32             ,  @param33             ,  @param34             ,  @param35             ,  @param36             ,  @param37             ,  @param38             ,  @param39             ,  @param40             ,  @param41             ,  @param42             ,  @param43             ,  @param44             ,  @param45             ,  @param46             ,  @param47             ,  @param48             ,  @param49             ,  @param50             ,  @param51             ,  @param52             ,  @param53             ,  @param54                          ,  @param55             ,  @param56             ,  @param57             ,  @param58             ,  @param59             ,  @param60             ,  @param61             )            select SCOPE_identity() as value]
2019-09-20 16:55:34,969 [1] DEBUG - Statement Id: [DAO00030_CHUNGTUCT_Add] Parameters: [@param0=[CHUNGTU_ID,137702], @param1=[DUOC_ID,1], @param2=[SOLONHAP_ID,7541], @param3=[SOKIEMSOAT,null], @param4=[SOVISA,1], @param5=[HANDUNG,12/12/2026 12:00:00 AM], @param6=[DONVITINH_ID,17], @param7=[SOLUONGYEUCAU,2], @param8=[SOLUONGTHUCTE,null], @param9=[SOLUONGDAXUAT,2], @param10=[TIENTE_ID,null], @param11=[TYGIA,null], @param12=[DONGIAMUA,945], @param13=[DONGIA_BHYT,null], @param14=[DONGIABAN,1030], @param15=[DONGIABAN_VAT,1030], @param16=[DONGIAVON,945], @param17=[DONGIATHANHTOAN,null], @param18=[SOQUYEN,null], @param19=[SOHOADONVAT,null], @param20=[TYLEVAT,0], @param21=[GIATRIVAT,null], @param22=[TYLECHIETKHAU,null], @param23=[GIATRICHIETKHAU,null], @param24=[MIENPHI,null], @param25=[LYDOMIENPHI_ID,null], @param26=[SOCHUNGTUKETOAN,null], @param27=[SOCHUNGTUTIENMAT,null], @param28=[TRANGTHAI,null], @param29=[DAPHATSINHPHIEUXUAT,null], @param30=[DAPHATSINHPHIEUHOANTRA,null], @param31=[KHUYENMAI,null], @param32=[PHUONGPHAPXUAT,null], @param33=[DONDATHANG_ID,null], @param34=[GHICHUCHITIET,null], @param35=[NGUONHANG_ID,1], @param36=[DONGIAVONVAT,945], @param37=[THANHTIENMUA,1890], @param38=[THANHTIENVON,1890], @param39=[THANHTIENHOPDONG,null], @param40=[ISTACHLO,null], @param41=[DONVITINHBANDAU_ID,null], @param42=[SOLUONGBANDAU,null], @param43=[GOITHAU_ID,null], @param44=[DONGIATHAU,1030], @param45=[DONGIAPO,null], @param46=[TYLEQUIDOI,null], @param47=[TOATHUOCNOITRU_ID,null], @param48=[KHAMBENH_VTYT_ID,10593], @param49=[PHAUTHUAT_VTYT_ID,null], @param50=[CLSKETQUA_VTYT_ID,null], @param51=[TOATHUOCNGOAITRU_ID,null], @param52=[MASTER_ID,0], @param53=[BENHNHAN,Người bệnh: 190043304 - Test Xn1 - 20/09/2019 - 16:50], @param54=[YLENH,null], @param55=[BENHVIEN_ID,HLU01], @param56=[NGAYTAO,9/20/2019 4:55:34 PM], @param57=[NGUOITAO_ID,0], @param58=[NGAYCAPNHAT,9/20/2019 4:55:34 PM], @param59=[NGUOICAPNHAT_ID,0], @param60=[THANHTIENMUABANDAU,null], @param61=[SOLUONGQUIDOI,null]]
2019-09-20 16:55:34,969 [1] DEBUG - Statement Id: [DAO00030_CHUNGTUCT_Add] Types: [@param0=[Int64, System.Int64], @param1=[Int64, System.Int64], @param2=[Int64, System.Int64], @param3=[System.DBNull, null], @param4=[String, System.String], @param5=[DateTime, System.DateTime], @param6=[Int64, System.Int64], @param7=[Double, System.Double], @param8=[System.DBNull, null], @param9=[Double, System.Double], @param10=[System.DBNull, null], @param11=[System.DBNull, null], @param12=[Double, System.Double], @param13=[System.DBNull, null], @param14=[Double, System.Double], @param15=[Double, System.Double], @param16=[Double, System.Double], @param17=[System.DBNull, null], @param18=[System.DBNull, null], @param19=[System.DBNull, null], @param20=[Double, System.Double], @param21=[System.DBNull, null], @param22=[System.DBNull, null], @param23=[System.DBNull, null], @param24=[System.DBNull, null], @param25=[System.DBNull, null], @param26=[System.DBNull, null], @param27=[System.DBNull, null], @param28=[System.DBNull, null], @param29=[System.DBNull, null], @param30=[System.DBNull, null], @param31=[System.DBNull, null], @param32=[System.DBNull, null], @param33=[System.DBNull, null], @param34=[System.DBNull, null], @param35=[Int64, System.Int64], @param36=[Double, System.Double], @param37=[Double, System.Double], @param38=[Double, System.Double], @param39=[System.DBNull, null], @param40=[System.DBNull, null], @param41=[System.DBNull, null], @param42=[System.DBNull, null], @param43=[System.DBNull, null], @param44=[Double, System.Double], @param45=[System.DBNull, null], @param46=[System.DBNull, null], @param47=[System.DBNull, null], @param48=[Int64, System.Int64], @param49=[System.DBNull, null], @param50=[System.DBNull, null], @param51=[System.DBNull, null], @param52=[Int64, System.Int64], @param53=[String, System.String], @param54=[System.DBNull, null], @param55=[String, System.String], @param56=[DateTime, System.DateTime], @param57=[Int64, System.Int64], @param58=[DateTime, System.DateTime], @param59=[Int64, System.Int64], @param60=[System.DBNull, null], @param61=[System.DBNull, null]]
2019-09-20 16:55:35,313 [1] DEBUG - Statement Id: [DAO00030_TT_DUOC_TONKHO_LOG_Add] PreparedStatement : [DECLARE @KHODUOC_ID int               DECLARE @TONTRUOC numeric(18, 4)               DECLARE @TONSAU numeric(18, 4)               DECLARE @SOLUONGNHAP numeric(18, 4)               DECLARE @SOLUONGXUAT numeric(18, 4)                              IF( @param0  = 'N')               BEGIN                SET @KHODUOC_ID =  @param1                END               ELSE               BEGIN                 SET @KHODUOC_ID =  @param2                END                              SELECT @TONTRUOC = SOLUONG FROM TT_DUOC_TONKHO WHERE KHODUOC_ID = @KHODUOC_ID  AND DUOC_ID =  @param3  AND SOLONHAP_ID =  @param4  AND NGUONDUOC_ID =  @param5                               IF( @param0  = 'N' AND  @param6  = 'ADD')               BEGIN                SET @TONSAU = ISNULL(@TONTRUOC,0) +  @param7                 SET @SOLUONGNHAP =  @param7                 SET @SOLUONGXUAT = 0               END               IF( @param0  = 'N' AND  @param6  = 'DEL')               BEGIN                SET @TONSAU = ISNULL(@TONTRUOC,0) -  @param7                 SET @SOLUONGXUAT =  @param7                 SET @SOLUONGNHAP = 0               END                                         IF( @param0  = 'X' AND  @param6  = 'ADD')               BEGIN                SET @TONSAU = ISNULL(@TONTRUOC,0) -  @param8                 SET @SOLUONGXUAT =  @param8                 SET @SOLUONGNHAP = 0               END               IF( @param0  = 'X' AND  @param6  = 'DEL')               BEGIN                SET @TONSAU = ISNULL(@TONTRUOC,0) +  @param8                 SET @SOLUONGNHAP =  @param8                 SET @SOLUONGXUAT = 0                             END                        insert into TT_DUOC_TONKHO_LOG (                           CHUNGTUCHITIET_ID              ,CHUNGTU_ID              ,MACHUNGTU              ,LOAICHUNGTU              ,MUCDICHCHUNGTU_CODE              ,KHONHAP_ID              ,KHOXUAT_ID              ,DUOC_ID              ,SOLONHAP_ID              ,NGUONDUOC_ID              ,SOLUONGNHAP              ,SOLUONGXUAT              ,DONGIAMUA              ,DONGIAVON              ,TYLE_VAT              ,DONGIAVONVAT              ,TONTRUOC              ,TONSAU              ,ACTION              ,BENHVIEN_ID              ,NGAYTAO              ,NGUOITAO_ID                          ) values (              @param9               , @param10               , @param11               , @param0               , @param12               , @param1               , @param2               , @param3               , @param4               , @param5               ,@SOLUONGNHAP              ,@SOLUONGXUAT              , @param13               , @param14               , @param15               , @param16               ,@TONTRUOC              ,@TONSAU              , @param6               , @param17               , @param18               , @param19               )]
2019-09-20 16:55:35,313 [1] DEBUG - Statement Id: [DAO00030_TT_DUOC_TONKHO_LOG_Add] Parameters: [@param0=[LOAICHUNGTU,X], @param1=[KHONHAP_ID,null], @param2=[KHOXUAT_ID,32], @param3=[DUOC_ID,1], @param4=[SOLONHAP_ID,7541], @param5=[NGUONDUOC_ID,1], @param6=[ACTION,ADD], @param7=[SOLUONGNHAP,null], @param8=[SOLUONGXUAT,2], @param9=[CHUNGTUCHITIET_ID,1299045], @param10=[CHUNGTU_ID,137702], @param11=[MACHUNGTU,CS_KBX1319003090], @param12=[MUCDICHCHUNGTU_CODE,X13], @param13=[DONGIAMUA,945], @param14=[DONGIAVON,945], @param15=[TYLE_VAT,0], @param16=[DONGIAVONVAT,945], @param17=[BENHVIEN_ID,HLU01], @param18=[NGAYTAO,9/20/2019 4:55:35 PM], @param19=[NGUOITAO_ID,0]]
2019-09-20 16:55:35,313 [1] DEBUG - Statement Id: [DAO00030_TT_DUOC_TONKHO_LOG_Add] Types: [@param0=[String, System.String], @param1=[System.DBNull, null], @param2=[Int64, System.Int64], @param3=[Int64, System.Int64], @param4=[Int64, System.Int64], @param5=[Int64, System.Int64], @param6=[String, System.String], @param7=[System.DBNull, null], @param8=[Decimal, System.Decimal], @param9=[Int64, System.Int64], @param10=[Int64, System.Int64], @param11=[String, System.String], @param12=[String, System.String], @param13=[Decimal, System.Decimal], @param14=[Decimal, System.Decimal], @param15=[Double, System.Double], @param16=[Double, System.Double], @param17=[String, System.String], @param18=[DateTime, System.DateTime], @param19=[Int64, System.Int64]]
2019-09-20 16:55:35,361 [1] DEBUG - Statement Id: [DAO00030_DUOC_TONKHO_BOOKING_NGOAITRU_Giam] PreparedStatement : [update TT_DUOC_TONKHO_BOOK_NGOAITRU            set            SOLUONG = 0                     ,NGAYCAPNHAT = getdate()            where            REF_TABLE = 'TT_NGOAITRU_KHAMBENH_VTYT'            AND REF_ID = '10593'                AND BENHVIEN_ID = 'HLU01']
2019-09-20 16:55:35,420 [1] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoVaBookingCOM23UpdateRedis] PreparedStatement : [declare @NGUONDUOC_MACDINH varchar(5) = '0';        declare @TOAMUANGOAI int = 0;        select @NGUONDUOC_MACDINH = isnull(VALUE,0) from TM_SYS_APPSETTINGS where CODE = 'PHA_NGUONDUOC'        select @TOAMUANGOAI = isnull(VALUE,0) from TM_SYS_APPSETTINGS where CODE = 'OPD_TOAMUANGOAI_DUNGDANHMUC_DUOC'                if @TOAMUANGOAI = 1        begin        select  distinct '0' + '_' + LTRIM(d.DUOC_ID) + '_' + @NGUONDUOC_MACDINH as DUOC_KEY, 0 as PHAMVI_ID, @NGUONDUOC_MACDINH as NGUONDUOC_ID, null as TENNGUONDUOC, null as TINHTIEN, d.DUOC_ID, ld.MALOAIDUOC,        d.SOVISA,d.TYLE_VAT,d.COTOA, d.MADUOC, d.TENHANG, d.TENDUOCDAYDU, dvt.TENDONVITINH as DONVITINH, d.BHYT,        d.TENHOATCHAT, d.HAMLUONG, d.HANGSANXUAT, d.QUOCGIA, d.LOAIDUOC_ID, d.DUONGDUNG_ID, d.TINHTIEN_PTTT,        ten.TENDUOC, ten.TENDUOC_EN, ten.MAQUOCTE, ten.MAQUOCTEBT,        '' as BHYT_TEXT        , ld.LOAIVATTU_ID        , d.BENHVIEN_ID,        999999999 as SOLUONG, d.VTYT_PHANLOAI, d.PHAMVI, d.SUASOLUONGTONGHOP, d.MADUOCBV, d.DANGTRINHBAY        , TAMNGUNG = CASE WHEN d.TAMNGUNG = '1' THEN '1' ELSE '0' END        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        where d.DUOC_ID in (1)        union all        select  distinct tk.DUOC_KEY, LTRIM(tk.PHAMVI_ID) as PHAMVI_ID, tk.NGUONDUOC_ID, nh.TENNGUONDUOC, nh.TINHTIEN, d.DUOC_ID, ld.MALOAIDUOC,        d.SOVISA,d.TYLE_VAT,d.COTOA, d.MADUOC, d.TENHANG, d.TENDUOCDAYDU, dvt.TENDONVITINH as DONVITINH, d.BHYT,        d.TENHOATCHAT, d.HAMLUONG, d.HANGSANXUAT, d.QUOCGIA, d.LOAIDUOC_ID, d.DUONGDUNG_ID, d.TINHTIEN_PTTT,        ten.TENDUOC, ten.TENDUOC_EN, ten.MAQUOCTE, ten.MAQUOCTEBT,        CASE WHEN d.BHYT = '1' THEN 'BHYT' ELSE '' END as BHYT_TEXT        , ld.LOAIVATTU_ID        , d.BENHVIEN_ID,        tk.SOLUONG, d.VTYT_PHANLOAI, d.PHAMVI, d.SUASOLUONGTONGHOP, d.MADUOCBV, d.DANGTRINHBAY        , TAMNGUNG = CASE WHEN d.TAMNGUNG = '1' OR nh.TAMNGUNG = '1' OR kd.TAMNGUNG = '1' THEN '1' ELSE '0' END        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        inner join        (        select  LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')) DUOC_KEY, (SUM(dtk.SOLUONG) - isnull(sum(A.SOLUONG),0) - isnull(sum(B.SOLUONG),0)) SOLUONG, pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        from (select sum(soluong) soluong,duoc_id,nguonduoc_id,khoduoc_id,benhvien_id from TT_DUOC_TONKHO  group by duoc_id,nguonduoc_id,khoduoc_id,benhvien_id) dtk        inner join TM_DUOC_PHAMVISD_MAPPING pvsd on dtk.KHODUOC_ID = pvsd.KHODUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NOITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) B on B.DUOC_ID = dtk.DUOC_ID and B.SOLUONG > 0 and B.PHAMVI_ID = pvsd.PHAMVI_ID and B.NGUONHANG_ID = dtk.NGUONDUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NGOAITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) A on A.DUOC_ID = dtk.DUOC_ID and A.SOLUONG > 0 and A.PHAMVI_ID = pvsd.PHAMVI_ID and A.NGUONHANG_ID = dtk.NGUONDUOC_ID        where dtk.SOLUONG > 0 and dtk.BENHVIEN_ID = 'HLU01'        group by LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')), pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        ) tk on tk.DUOC_ID = d.DUOC_ID        left join TM_DUOC_PHAMVISUDUNG kd on kd.PHAMVI_ID = tk.PHAMVI_ID and kd.BENHVIEN_ID = 'HLU01'        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = tk.NGUONDUOC_ID and nh.BENHVIEN_ID = 'HLU01'        where  d.BENHVIEN_ID = 'HLU01' and d.DUOC_ID in (1)        end        else        begin        select  distinct tk.DUOC_KEY, LTRIM(tk.PHAMVI_ID) as PHAMVI_ID, tk.NGUONDUOC_ID, nh.TENNGUONDUOC, nh.TINHTIEN, d.DUOC_ID, ld.MALOAIDUOC,        d.SOVISA,d.TYLE_VAT,d.COTOA, d.MADUOC, d.TENHANG, d.TENDUOCDAYDU, dvt.TENDONVITINH as DONVITINH, d.BHYT,        d.TENHOATCHAT, d.HAMLUONG, d.HANGSANXUAT, d.QUOCGIA, d.LOAIDUOC_ID, d.DUONGDUNG_ID, d.TINHTIEN_PTTT,        ten.TENDUOC, ten.TENDUOC_EN, ten.MAQUOCTE, ten.MAQUOCTEBT,        CASE WHEN d.BHYT = '1' THEN 'BHYT' ELSE '' END as BHYT_TEXT        , ld.LOAIVATTU_ID        , d.BENHVIEN_ID,        tk.SOLUONG, d.VTYT_PHANLOAI, d.PHAMVI, d.SUASOLUONGTONGHOP, d.MADUOCBV, d.DANGTRINHBAY        , TAMNGUNG = CASE WHEN d.TAMNGUNG = '1' OR nh.TAMNGUNG = '1' OR kd.TAMNGUNG = '1' THEN '1' ELSE '0' END        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        inner join        (        select  LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')) DUOC_KEY, (SUM(dtk.SOLUONG) - isnull(sum(A.SOLUONG),0) - isnull(sum(B.SOLUONG),0)) SOLUONG, pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        from (select sum(soluong) soluong,duoc_id,nguonduoc_id,khoduoc_id,benhvien_id from TT_DUOC_TONKHO  group by duoc_id,nguonduoc_id,khoduoc_id,benhvien_id) dtk        inner join TM_DUOC_PHAMVISD_MAPPING pvsd on dtk.KHODUOC_ID = pvsd.KHODUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NOITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) B on B.DUOC_ID = dtk.DUOC_ID and B.SOLUONG > 0 and B.PHAMVI_ID = pvsd.PHAMVI_ID and B.NGUONHANG_ID = dtk.NGUONDUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NGOAITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) A on A.DUOC_ID = dtk.DUOC_ID and A.SOLUONG > 0 and A.PHAMVI_ID = pvsd.PHAMVI_ID and A.NGUONHANG_ID = dtk.NGUONDUOC_ID        where dtk.SOLUONG > 0 and dtk.BENHVIEN_ID = 'HLU01'        group by LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')), pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        ) tk on tk.DUOC_ID = d.DUOC_ID        left join TM_DUOC_PHAMVISUDUNG kd on kd.PHAMVI_ID = tk.PHAMVI_ID and kd.BENHVIEN_ID = 'HLU01'        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = tk.NGUONDUOC_ID and nh.BENHVIEN_ID = 'HLU01'        where  d.BENHVIEN_ID = 'HLU01' and d.DUOC_ID in (1)        end]
2019-09-20 16:55:35,705 [1] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoCOM18UpdateRedis] PreparedStatement : [select distinct TT_TONKHO.DUOC_KEY, LTRIM(TT_TONKHO.KHODUOC_ID) as KHODUOC_ID, TM_DUOC.DUOC_ID, TM_LOAIDUOC.MALOAIDUOC,TM_DUOC.SOVISA,TM_DUOC.TYLE_VAT,TM_DUOC.COTOA,        TM_DUOC.MADUOC, TM_DUOC.TENHANG, TM_DUOC.TENDUOCDAYDU, dvt.TENDONVITINH as DONVITINH,  TM_DUOC.DONVITINH_ID,TM_DUOC.BHYT,        TM_DUOC.TENHOATCHAT,        TM_DUOC.HAMLUONG, TM_DUOC.HANGSANXUAT, TM_DUOC.QUOCGIA, TM_DUOC.LOAIDUOC_ID, TM_DUOC.DUONGDUNG_ID,        TM_TENDUOC.TENDUOC, TM_TENDUOC.TENDUOC_EN, TM_TENDUOC.MAQUOCTE, TM_TENDUOC.MAQUOCTEBT,        TM_LOAIDUOC.LOAIVATTU_ID, TM_DUOC.BENHVIEN_ID,        TT_TONKHO.SOLUONG, TM_DUOC.VTYT_PHANLOAI, TM_DUOC.PHAMVI, TT_TONKHO.NGUONDUOC_ID, NG.TENNGUONDUOC AS TENNGUONDUOC        , TAMNGUNG = CASE WHEN TM_DUOC.TAMNGUNG = '1' OR NG.TAMNGUNG = '1' OR KD.TAMNGUNG = '1' THEN '1' ELSE '0' END        , TM_DUOC.DANGTRINHBAY        from TM_DUOC        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = TM_DUOC.DONVITINH_ID        left join TM_TENDUOC on TM_DUOC.TENDUOC_ID = TM_TENDUOC.TENDUOC_ID and TM_DUOC.BENHVIEN_ID = 'HLU01' and TM_DUOC.TAMNGUNG = '0'        left join TM_LOAIDUOC on TM_LOAIDUOC.LOAIDUOC_ID = TM_DUOC.LOAIDUOC_ID and TM_LOAIDUOC.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG on (TM_LOAIDUOC.LOAIVATTU_ID = TM_DUOC_HANDUNG.LOAIDUOC and TM_DUOC_HANDUNG.BENHVIEN_ID = 'HLU01')        inner join        (select LTRIM(A.KHODUOC_ID) + '_' + LTRIM(A.DUOC_ID) + '_' + LTRIM(ISNULL(A.NGUONDUOC_ID,'')) as DUOC_KEY, A.KHODUOC_ID, A.DUOC_ID, A.NGUONDUOC_ID,        SUM(isnull(A.SOLUONG,0)) as SOLUONG        from        (select SUM(SOLUONG) as SOLUONG, KHODUOC_ID, DUOC_ID, NGUONDUOC_ID from TT_DUOC_TONKHO        where BENHVIEN_ID = 'HLU01' group by KHODUOC_ID, DUOC_ID, NGUONDUOC_ID) A        group by LTRIM(A.KHODUOC_ID) + '_' + LTRIM(A.DUOC_ID) + '_' + LTRIM(ISNULL(A.NGUONDUOC_ID,'')), A.KHODUOC_ID, A.DUOC_ID, NGUONDUOC_ID        ) TT_TONKHO on TT_TONKHO.DUOC_ID = TM_DUOC.DUOC_ID        LEFT JOIN TM_NGUONHANG NG ON NG.NGUONDUOC_ID = TT_TONKHO.NGUONDUOC_ID        LEFT JOIN TM_KHODUOC KD ON KD.KHODUOC_ID = TT_TONKHO.KHODUOC_ID        where TM_DUOC.BENHVIEN_ID = 'HLU01' and TT_TONKHO.SOLUONG >= 0        and TM_DUOC.DUOC_ID in (1)]
2019-09-20 16:55:38,056 [1] DEBUG - Statement Id: [DAO00030_DUOCTONKHO_Giam] PreparedStatement : [update TT_DUOC_TONKHO set            SOLUONG = SOLUONG -  @param0             , NGAYCAPNHAT =  getdate()            , NGUOICAPNHAT_ID =  @param1             where            KHODUOC_ID =  @param2             and DUOC_ID =  @param3             and SOLONHAP_ID =  @param4]
2019-09-20 16:55:38,056 [1] DEBUG - Statement Id: [DAO00030_DUOCTONKHO_Giam] Parameters: [@param0=[SOLUONGTHAYDOI,2], @param1=[NGUOICAPNHAT_ID,0], @param2=[KHODUOC_ID,32], @param3=[DUOC_ID,1], @param4=[SOLONHAP_ID,7541]]
2019-09-20 16:55:38,056 [1] DEBUG - Statement Id: [DAO00030_DUOCTONKHO_Giam] Types: [@param0=[Double, System.Double], @param1=[Int64, System.Int64], @param2=[Int64, System.Int64], @param3=[Int64, System.Int64], @param4=[Int64, System.Int64]]
2019-09-20 16:55:38,099 [1] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoCOM18] PreparedStatement : [select  distinct TT_TONKHO.DUOC_KEY, LTRIM(TT_TONKHO.KHODUOC_ID) as KHODUOC_ID, TM_DUOC.DUOC_ID, TM_LOAIDUOC.MALOAIDUOC,TM_DUOC.SOVISA,TM_DUOC.TYLE_VAT,TM_DUOC.COTOA,        TM_DUOC.MADUOC, TM_DUOC.TENHANG, TM_DUOC.TENDUOCDAYDU, dvt.TENDONVITINH as DONVITINH, TM_DUOC.DONVITINH_ID, TM_DUOC.BHYT,        TM_DUOC.TENHOATCHAT, TM_DUOC.HAMLUONG, TM_DUOC.HANGSANXUAT, TM_DUOC.QUOCGIA, TM_DUOC.LOAIDUOC_ID, TM_DUOC.DUONGDUNG_ID,        TM_TENDUOC.TENDUOC, TM_TENDUOC.TENDUOC_EN, TM_TENDUOC.MAQUOCTE, TM_TENDUOC.MAQUOCTEBT,        TM_LOAIDUOC.LOAIVATTU_ID, TM_DUOC.BENHVIEN_ID,        TT_TONKHO.SOLUONG, TM_DUOC.VTYT_PHANLOAI, TM_DUOC.PHAMVI, TT_TONKHO.NGUONDUOC_ID, NG.TENNGUONDUOC        , TAMNGUNG = CASE WHEN TM_DUOC.TAMNGUNG = '1' OR NG.TAMNGUNG = '1' OR KD.TAMNGUNG = '1' THEN '1' ELSE '0' END        , TM_DUOC.DANGTRINHBAY        from TM_DUOC        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = TM_DUOC.DONVITINH_ID        left join TM_TENDUOC on TM_DUOC.TENDUOC_ID = TM_TENDUOC.TENDUOC_ID and TM_DUOC.BENHVIEN_ID = 'HLU01'  and TM_DUOC.TAMNGUNG = '0'        left join TM_LOAIDUOC on TM_LOAIDUOC.LOAIDUOC_ID = TM_DUOC.LOAIDUOC_ID and TM_LOAIDUOC.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG on (TM_LOAIDUOC.LOAIVATTU_ID = TM_DUOC_HANDUNG.LOAIDUOC and TM_DUOC_HANDUNG.BENHVIEN_ID = 'HLU01')        inner join        (select LTRIM(A.KHODUOC_ID) + '_' + LTRIM(A.DUOC_ID) + '_' + LTRIM(ISNULL(A.NGUONDUOC_ID,'')) as DUOC_KEY, A.KHODUOC_ID, A.DUOC_ID ,a.NGUONDUOC_ID,        SUM(isnull(A.SOLUONG,0)) as SOLUONG        from        (select SUM(SOLUONG) as SOLUONG, KHODUOC_ID, DUOC_ID, NGUONDUOC_ID from TT_DUOC_TONKHO        where KHODUOC_ID in (32) and DUOC_ID in (1) group by KHODUOC_ID, DUOC_ID, NGUONDUOC_ID        ) A        where A.KHODUOC_ID in (32) and A.DUOC_ID in (1)        group by LTRIM(A.KHODUOC_ID) + '_' + LTRIM(A.DUOC_ID) + '_' + LTRIM(A.NGUONDUOC_ID), A.KHODUOC_ID, A.DUOC_ID, A.NGUONDUOC_ID)        TT_TONKHO on TT_TONKHO.DUOC_ID = TM_DUOC.DUOC_ID        LEFT JOIN TM_NGUONHANG NG ON NG.NGUONDUOC_ID = TT_TONKHO.NGUONDUOC_ID        LEFT JOIN TM_KHODUOC KD ON KD.KHODUOC_ID = TT_TONKHO.KHODUOC_ID        where TM_DUOC.BENHVIEN_ID = 'HLU01' and TM_DUOC.DUOC_ID in (1)]
2019-09-20 16:55:38,161 [1] DEBUG - Statement Id: [DAO00030_GetListPhamViByKhoDuoc] PreparedStatement : [SELECT DISTINCT PHAMVI_ID          FROM TM_DUOC_PHAMVISD_MAPPING          WHERE          KHODUOC_ID IN (32)          AND BENHVIEN_ID ='HLU01'          AND TAMNGUNG = '0']
2019-09-20 16:55:38,190 [1] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoVaBookingCOM23] PreparedStatement : [declare @NGUONDUOC_MACDINH varchar(5) = '0';        declare @TOAMUANGOAI int = 0;        select @NGUONDUOC_MACDINH = isnull(VALUE,0) from TM_SYS_APPSETTINGS where CODE = 'PHA_NGUONDUOC'        select @TOAMUANGOAI = isnull(VALUE,0) from TM_SYS_APPSETTINGS where CODE = 'OPD_TOAMUANGOAI_DUNGDANHMUC_DUOC'                if @TOAMUANGOAI = 1        begin        select  distinct '0' + '_' + LTRIM(d.DUOC_ID) + '_' + @NGUONDUOC_MACDINH as DUOC_KEY, 0 as PHAMVI_ID, @NGUONDUOC_MACDINH as NGUONDUOC_ID, null as TENNGUONDUOC, null as TINHTIEN, d.DUOC_ID, ld.MALOAIDUOC,        d.SOVISA,d.TYLE_VAT,d.COTOA, d.MADUOC, d.TENHANG, d.TENDUOCDAYDU, dvt.TENDONVITINH as DONVITINH, d.BHYT,        d.TENHOATCHAT, d.HAMLUONG, d.HANGSANXUAT, d.QUOCGIA, d.LOAIDUOC_ID, d.DUONGDUNG_ID, d.TINHTIEN_PTTT,        ten.TENDUOC, ten.TENDUOC_EN, ten.MAQUOCTE, ten.MAQUOCTEBT,        '' as BHYT_TEXT        , ld.LOAIVATTU_ID        , d.BENHVIEN_ID,        999999999 as SOLUONG, d.VTYT_PHANLOAI, d.PHAMVI, d.SUASOLUONGTONGHOP, d.MADUOCBV, d.DANGTRINHBAY        , TAMNGUNG = CASE WHEN d.TAMNGUNG = '1' THEN '1' ELSE '0' END        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        where d.DUOC_ID in (1)        union all        select  distinct tk.DUOC_KEY, LTRIM(tk.PHAMVI_ID) as PHAMVI_ID, tk.NGUONDUOC_ID, nh.TENNGUONDUOC, nh.TINHTIEN, d.DUOC_ID, ld.MALOAIDUOC,        d.SOVISA,d.TYLE_VAT,d.COTOA, d.MADUOC, d.TENHANG, d.TENDUOCDAYDU, dvt.TENDONVITINH as DONVITINH, d.BHYT,        d.TENHOATCHAT, d.HAMLUONG, d.HANGSANXUAT, d.QUOCGIA, d.LOAIDUOC_ID, d.DUONGDUNG_ID, d.TINHTIEN_PTTT,        ten.TENDUOC, ten.TENDUOC_EN, ten.MAQUOCTE, ten.MAQUOCTEBT,        CASE WHEN d.BHYT = '1' THEN 'BHYT' ELSE '' END as BHYT_TEXT        , ld.LOAIVATTU_ID        , d.BENHVIEN_ID,        tk.SOLUONG, d.VTYT_PHANLOAI, d.PHAMVI, d.SUASOLUONGTONGHOP, d.MADUOCBV, d.DANGTRINHBAY        , TAMNGUNG = CASE WHEN d.TAMNGUNG = '1' OR nh.TAMNGUNG = '1' OR kd.TAMNGUNG = '1' THEN '1' ELSE '0' END        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        inner join        (        select  LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')) DUOC_KEY, (SUM(dtk.SOLUONG) - isnull(sum(A.SOLUONG),0) - isnull(sum(B.SOLUONG),0)) SOLUONG, pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        from (select sum(soluong) soluong,duoc_id,nguonduoc_id,khoduoc_id,benhvien_id from TT_DUOC_TONKHO  group by duoc_id,nguonduoc_id,khoduoc_id,benhvien_id) dtk        inner join TM_DUOC_PHAMVISD_MAPPING pvsd on dtk.KHODUOC_ID = pvsd.KHODUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NOITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) B on B.DUOC_ID = dtk.DUOC_ID and B.SOLUONG > 0 and B.PHAMVI_ID = pvsd.PHAMVI_ID and B.NGUONHANG_ID = dtk.NGUONDUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NGOAITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) A on A.DUOC_ID = dtk.DUOC_ID and A.SOLUONG > 0 and A.PHAMVI_ID = pvsd.PHAMVI_ID and A.NGUONHANG_ID = dtk.NGUONDUOC_ID        where dtk.SOLUONG > 0 and dtk.BENHVIEN_ID = 'HLU01'        group by LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')), pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        ) tk on tk.DUOC_ID = d.DUOC_ID        left join TM_DUOC_PHAMVISUDUNG kd on kd.PHAMVI_ID = tk.PHAMVI_ID and kd.BENHVIEN_ID = 'HLU01'        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = tk.NGUONDUOC_ID and nh.BENHVIEN_ID = 'HLU01'        where  d.BENHVIEN_ID = 'HLU01' and d.DUOC_ID in (1) and TK.PHAMVI_ID in (1055)        and tk.NGUONDUOC_ID in (1)         end        else        begin                select  distinct tk.DUOC_KEY, LTRIM(tk.PHAMVI_ID) as PHAMVI_ID, tk.NGUONDUOC_ID, nh.TENNGUONDUOC, nh.TINHTIEN, d.DUOC_ID, ld.MALOAIDUOC,        d.SOVISA,d.TYLE_VAT,d.COTOA, d.MADUOC, d.TENHANG, d.TENDUOCDAYDU, dvt.TENDONVITINH as DONVITINH, d.BHYT,        d.TENHOATCHAT, d.HAMLUONG, d.HANGSANXUAT, d.QUOCGIA, d.LOAIDUOC_ID, d.DUONGDUNG_ID, d.TINHTIEN_PTTT,        ten.TENDUOC, ten.TENDUOC_EN, ten.MAQUOCTE, ten.MAQUOCTEBT,        CASE WHEN d.BHYT = '1' THEN 'BHYT' ELSE '' END as BHYT_TEXT        , ld.LOAIVATTU_ID        , d.BENHVIEN_ID,        tk.SOLUONG, d.VTYT_PHANLOAI, d.PHAMVI, d.SUASOLUONGTONGHOP, d.MADUOCBV, d.DANGTRINHBAY        , TAMNGUNG = CASE WHEN d.TAMNGUNG = '1' OR nh.TAMNGUNG = '1' OR kd.TAMNGUNG = '1' THEN '1' ELSE '0' END        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        inner join        (        select  LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')) DUOC_KEY, (SUM(dtk.SOLUONG) - isnull(sum(A.SOLUONG),0) - isnull(sum(B.SOLUONG),0)) SOLUONG, pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        from (select sum(soluong) soluong,duoc_id,nguonduoc_id,khoduoc_id,benhvien_id from TT_DUOC_TONKHO  group by duoc_id,nguonduoc_id,khoduoc_id,benhvien_id) dtk        inner join TM_DUOC_PHAMVISD_MAPPING pvsd on dtk.KHODUOC_ID = pvsd.KHODUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NOITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) B on B.DUOC_ID = dtk.DUOC_ID and B.SOLUONG > 0 and B.PHAMVI_ID = pvsd.PHAMVI_ID and B.NGUONHANG_ID = dtk.NGUONDUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NGOAITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) A on A.DUOC_ID = dtk.DUOC_ID and A.SOLUONG > 0 and A.PHAMVI_ID = pvsd.PHAMVI_ID and A.NGUONHANG_ID = dtk.NGUONDUOC_ID        where dtk.SOLUONG > 0 and dtk.BENHVIEN_ID = 'HLU01'        group by LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')), pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        ) tk on tk.DUOC_ID = d.DUOC_ID        left join TM_DUOC_PHAMVISUDUNG kd on kd.PHAMVI_ID = tk.PHAMVI_ID and kd.BENHVIEN_ID = 'HLU01'        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = tk.NGUONDUOC_ID and nh.BENHVIEN_ID = 'HLU01'        where  d.BENHVIEN_ID = 'HLU01' and d.DUOC_ID in (1) and TK.PHAMVI_ID in (1055)        and tk.NGUONDUOC_ID in (1)         end]
2019-09-20 16:55:38,415 [1] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoCOM18UpdateRedis] PreparedStatement : [select distinct TT_TONKHO.DUOC_KEY, LTRIM(TT_TONKHO.KHODUOC_ID) as KHODUOC_ID, TM_DUOC.DUOC_ID, TM_LOAIDUOC.MALOAIDUOC,TM_DUOC.SOVISA,TM_DUOC.TYLE_VAT,TM_DUOC.COTOA,        TM_DUOC.MADUOC, TM_DUOC.TENHANG, TM_DUOC.TENDUOCDAYDU, dvt.TENDONVITINH as DONVITINH,  TM_DUOC.DONVITINH_ID,TM_DUOC.BHYT,        TM_DUOC.TENHOATCHAT,        TM_DUOC.HAMLUONG, TM_DUOC.HANGSANXUAT, TM_DUOC.QUOCGIA, TM_DUOC.LOAIDUOC_ID, TM_DUOC.DUONGDUNG_ID,        TM_TENDUOC.TENDUOC, TM_TENDUOC.TENDUOC_EN, TM_TENDUOC.MAQUOCTE, TM_TENDUOC.MAQUOCTEBT,        TM_LOAIDUOC.LOAIVATTU_ID, TM_DUOC.BENHVIEN_ID,        TT_TONKHO.SOLUONG, TM_DUOC.VTYT_PHANLOAI, TM_DUOC.PHAMVI, TT_TONKHO.NGUONDUOC_ID, NG.TENNGUONDUOC AS TENNGUONDUOC        , TAMNGUNG = CASE WHEN TM_DUOC.TAMNGUNG = '1' OR NG.TAMNGUNG = '1' OR KD.TAMNGUNG = '1' THEN '1' ELSE '0' END        , TM_DUOC.DANGTRINHBAY        from TM_DUOC        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = TM_DUOC.DONVITINH_ID        left join TM_TENDUOC on TM_DUOC.TENDUOC_ID = TM_TENDUOC.TENDUOC_ID and TM_DUOC.BENHVIEN_ID = 'HLU01' and TM_DUOC.TAMNGUNG = '0'        left join TM_LOAIDUOC on TM_LOAIDUOC.LOAIDUOC_ID = TM_DUOC.LOAIDUOC_ID and TM_LOAIDUOC.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG on (TM_LOAIDUOC.LOAIVATTU_ID = TM_DUOC_HANDUNG.LOAIDUOC and TM_DUOC_HANDUNG.BENHVIEN_ID = 'HLU01')        inner join        (select LTRIM(A.KHODUOC_ID) + '_' + LTRIM(A.DUOC_ID) + '_' + LTRIM(ISNULL(A.NGUONDUOC_ID,'')) as DUOC_KEY, A.KHODUOC_ID, A.DUOC_ID, A.NGUONDUOC_ID,        SUM(isnull(A.SOLUONG,0)) as SOLUONG        from        (select SUM(SOLUONG) as SOLUONG, KHODUOC_ID, DUOC_ID, NGUONDUOC_ID from TT_DUOC_TONKHO        where BENHVIEN_ID = 'HLU01' group by KHODUOC_ID, DUOC_ID, NGUONDUOC_ID) A        group by LTRIM(A.KHODUOC_ID) + '_' + LTRIM(A.DUOC_ID) + '_' + LTRIM(ISNULL(A.NGUONDUOC_ID,'')), A.KHODUOC_ID, A.DUOC_ID, NGUONDUOC_ID        ) TT_TONKHO on TT_TONKHO.DUOC_ID = TM_DUOC.DUOC_ID        LEFT JOIN TM_NGUONHANG NG ON NG.NGUONDUOC_ID = TT_TONKHO.NGUONDUOC_ID        LEFT JOIN TM_KHODUOC KD ON KD.KHODUOC_ID = TT_TONKHO.KHODUOC_ID        where TM_DUOC.BENHVIEN_ID = 'HLU01' and TT_TONKHO.SOLUONG >= 0        and TM_DUOC.DUOC_ID in (1)]
2019-09-20 16:55:38,516 [1] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoVaBookingCOM23UpdateRedis] PreparedStatement : [declare @NGUONDUOC_MACDINH varchar(5) = '0';        declare @TOAMUANGOAI int = 0;        select @NGUONDUOC_MACDINH = isnull(VALUE,0) from TM_SYS_APPSETTINGS where CODE = 'PHA_NGUONDUOC'        select @TOAMUANGOAI = isnull(VALUE,0) from TM_SYS_APPSETTINGS where CODE = 'OPD_TOAMUANGOAI_DUNGDANHMUC_DUOC'                if @TOAMUANGOAI = 1        begin        select  distinct '0' + '_' + LTRIM(d.DUOC_ID) + '_' + @NGUONDUOC_MACDINH as DUOC_KEY, 0 as PHAMVI_ID, @NGUONDUOC_MACDINH as NGUONDUOC_ID, null as TENNGUONDUOC, null as TINHTIEN, d.DUOC_ID, ld.MALOAIDUOC,        d.SOVISA,d.TYLE_VAT,d.COTOA, d.MADUOC, d.TENHANG, d.TENDUOCDAYDU, dvt.TENDONVITINH as DONVITINH, d.BHYT,        d.TENHOATCHAT, d.HAMLUONG, d.HANGSANXUAT, d.QUOCGIA, d.LOAIDUOC_ID, d.DUONGDUNG_ID, d.TINHTIEN_PTTT,        ten.TENDUOC, ten.TENDUOC_EN, ten.MAQUOCTE, ten.MAQUOCTEBT,        '' as BHYT_TEXT        , ld.LOAIVATTU_ID        , d.BENHVIEN_ID,        999999999 as SOLUONG, d.VTYT_PHANLOAI, d.PHAMVI, d.SUASOLUONGTONGHOP, d.MADUOCBV, d.DANGTRINHBAY        , TAMNGUNG = CASE WHEN d.TAMNGUNG = '1' THEN '1' ELSE '0' END        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        where d.DUOC_ID in (1)        union all        select  distinct tk.DUOC_KEY, LTRIM(tk.PHAMVI_ID) as PHAMVI_ID, tk.NGUONDUOC_ID, nh.TENNGUONDUOC, nh.TINHTIEN, d.DUOC_ID, ld.MALOAIDUOC,        d.SOVISA,d.TYLE_VAT,d.COTOA, d.MADUOC, d.TENHANG, d.TENDUOCDAYDU, dvt.TENDONVITINH as DONVITINH, d.BHYT,        d.TENHOATCHAT, d.HAMLUONG, d.HANGSANXUAT, d.QUOCGIA, d.LOAIDUOC_ID, d.DUONGDUNG_ID, d.TINHTIEN_PTTT,        ten.TENDUOC, ten.TENDUOC_EN, ten.MAQUOCTE, ten.MAQUOCTEBT,        CASE WHEN d.BHYT = '1' THEN 'BHYT' ELSE '' END as BHYT_TEXT        , ld.LOAIVATTU_ID        , d.BENHVIEN_ID,        tk.SOLUONG, d.VTYT_PHANLOAI, d.PHAMVI, d.SUASOLUONGTONGHOP, d.MADUOCBV, d.DANGTRINHBAY        , TAMNGUNG = CASE WHEN d.TAMNGUNG = '1' OR nh.TAMNGUNG = '1' OR kd.TAMNGUNG = '1' THEN '1' ELSE '0' END        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        inner join        (        select  LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')) DUOC_KEY, (SUM(dtk.SOLUONG) - isnull(sum(A.SOLUONG),0) - isnull(sum(B.SOLUONG),0)) SOLUONG, pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        from (select sum(soluong) soluong,duoc_id,nguonduoc_id,khoduoc_id,benhvien_id from TT_DUOC_TONKHO  group by duoc_id,nguonduoc_id,khoduoc_id,benhvien_id) dtk        inner join TM_DUOC_PHAMVISD_MAPPING pvsd on dtk.KHODUOC_ID = pvsd.KHODUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NOITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) B on B.DUOC_ID = dtk.DUOC_ID and B.SOLUONG > 0 and B.PHAMVI_ID = pvsd.PHAMVI_ID and B.NGUONHANG_ID = dtk.NGUONDUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NGOAITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) A on A.DUOC_ID = dtk.DUOC_ID and A.SOLUONG > 0 and A.PHAMVI_ID = pvsd.PHAMVI_ID and A.NGUONHANG_ID = dtk.NGUONDUOC_ID        where dtk.SOLUONG > 0 and dtk.BENHVIEN_ID = 'HLU01'        group by LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')), pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        ) tk on tk.DUOC_ID = d.DUOC_ID        left join TM_DUOC_PHAMVISUDUNG kd on kd.PHAMVI_ID = tk.PHAMVI_ID and kd.BENHVIEN_ID = 'HLU01'        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = tk.NGUONDUOC_ID and nh.BENHVIEN_ID = 'HLU01'        where  d.BENHVIEN_ID = 'HLU01' and d.DUOC_ID in (1)        end        else        begin        select  distinct tk.DUOC_KEY, LTRIM(tk.PHAMVI_ID) as PHAMVI_ID, tk.NGUONDUOC_ID, nh.TENNGUONDUOC, nh.TINHTIEN, d.DUOC_ID, ld.MALOAIDUOC,        d.SOVISA,d.TYLE_VAT,d.COTOA, d.MADUOC, d.TENHANG, d.TENDUOCDAYDU, dvt.TENDONVITINH as DONVITINH, d.BHYT,        d.TENHOATCHAT, d.HAMLUONG, d.HANGSANXUAT, d.QUOCGIA, d.LOAIDUOC_ID, d.DUONGDUNG_ID, d.TINHTIEN_PTTT,        ten.TENDUOC, ten.TENDUOC_EN, ten.MAQUOCTE, ten.MAQUOCTEBT,        CASE WHEN d.BHYT = '1' THEN 'BHYT' ELSE '' END as BHYT_TEXT        , ld.LOAIVATTU_ID        , d.BENHVIEN_ID,        tk.SOLUONG, d.VTYT_PHANLOAI, d.PHAMVI, d.SUASOLUONGTONGHOP, d.MADUOCBV, d.DANGTRINHBAY        , TAMNGUNG = CASE WHEN d.TAMNGUNG = '1' OR nh.TAMNGUNG = '1' OR kd.TAMNGUNG = '1' THEN '1' ELSE '0' END        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        inner join        (        select  LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')) DUOC_KEY, (SUM(dtk.SOLUONG) - isnull(sum(A.SOLUONG),0) - isnull(sum(B.SOLUONG),0)) SOLUONG, pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        from (select sum(soluong) soluong,duoc_id,nguonduoc_id,khoduoc_id,benhvien_id from TT_DUOC_TONKHO  group by duoc_id,nguonduoc_id,khoduoc_id,benhvien_id) dtk        inner join TM_DUOC_PHAMVISD_MAPPING pvsd on dtk.KHODUOC_ID = pvsd.KHODUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NOITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) B on B.DUOC_ID = dtk.DUOC_ID and B.SOLUONG > 0 and B.PHAMVI_ID = pvsd.PHAMVI_ID and B.NGUONHANG_ID = dtk.NGUONDUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NGOAITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) A on A.DUOC_ID = dtk.DUOC_ID and A.SOLUONG > 0 and A.PHAMVI_ID = pvsd.PHAMVI_ID and A.NGUONHANG_ID = dtk.NGUONDUOC_ID        where dtk.SOLUONG > 0 and dtk.BENHVIEN_ID = 'HLU01'        group by LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')), pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        ) tk on tk.DUOC_ID = d.DUOC_ID        left join TM_DUOC_PHAMVISUDUNG kd on kd.PHAMVI_ID = tk.PHAMVI_ID and kd.BENHVIEN_ID = 'HLU01'        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = tk.NGUONDUOC_ID and nh.BENHVIEN_ID = 'HLU01'        where  d.BENHVIEN_ID = 'HLU01' and d.DUOC_ID in (1)        end]
2019-09-20 16:55:38,891 [1] DEBUG - Statement Id: [DAO00030_GetList] PreparedStatement : [select *              from TT_DUOC_CHUNGTU              where BENHVIEN_ID = 'HLU01'                and                   TT_DUOC_CHUNGTU.CHUNGTU_ID = '137702'                               order by CHUNGTU_ID]
2019-09-20 16:55:39,012 [1] DEBUG - Statement Id: [DAO00030_CHUNGTUXUAT_CHITIET_GetList] PreparedStatement : [SELECT            ctct.*,            d.MADUOC, d.TENHANG, d.TENDUOCDAYDU, dvt.TENDONVITINH as DONVITINH,n.TENNGUONDUOC as NGUONHANG,            sln.SOLONHAP, sln.SOLOSANPHAM, sln.NGAYNHAP as NGAYNHAPLO, sln.HANDUNG as HANSUDUNG,            isnull(tk.SOLUONG,0) as SOLUONGTON,            LTRIM(ct.KHOXUAT_ID) + '_' + LTRIM(sln.DUOC_ID) + '_' + LTRIM(sln.NGUONDUOC_ID) as DUOC_KEY            , NLD.MANHOMLOAIDUOC, ld.MALOAIDUOC, D.SO_QDTT            FROM            TT_DUOC_CHUNGTU_CHITIET ctct            INNER JOIN TT_DUOC_CHUNGTU ct ON (ct.CHUNGTU_ID = ctct.CHUNGTU_ID)            INNER JOIN TT_DUOC_CHUNGTU_SOLONHAP sln ON (sln.SOLONHAP_ID = ctct.SOLONHAP_ID)            LEFT JOIN (            select xx.DUOCTONKHO_ID, xx.KHODUOC_ID, xx.DUOC_ID, xx.SOLONHAP_ID, xx.SOLUONG, xx.NGUONDUOC_ID, xx.BENHVIEN_ID from TT_DUOC_TONKHO xx            join ( select max(DUOCTONKHO_ID) as DUOCTONKHO_ID, KHODUOC_ID, DUOC_ID, SOLONHAP_ID, NGUONDUOC_ID            from TT_DUOC_TONKHO group by KHODUOC_ID, DUOC_ID, SOLONHAP_ID, NGUONDUOC_ID) yy on xx.DUOCTONKHO_ID=yy.DUOCTONKHO_ID            ) tk ON (tk.SOLONHAP_ID = sln.SOLONHAP_ID AND tk.DUOC_ID = sln.DUOC_ID and tk.KHODUOC_ID = ct.KHOXUAT_ID)            INNER JOIN TM_DUOC d ON (d.DUOC_ID = ctct.DUOC_ID)            INNER JOIN TM_NGUONHANG n ON (n.NGUONDUOC_ID = ctct.NGUONHANG_ID)            LEFT JOIN TM_DONVITINH dvt ON (dvt.DONVITINH_ID = ctct.DONVITINH_ID)            left join TM_LOAIDUOC LD on LD.LOAIDUOC_ID = D.LOAIDUOC_ID            LEFT JOIN TM_NHOMLOAIDUOC NLD on NLD.NHOMLOAIDUOC_ID = LD.NHOMLOAIDUOC_ID             where                             ct.CHUNGTU_ID = '137702'                       and                           ct.BENHVIEN_ID = 'HLU01'                                     order by CHUNGTUCHITIET_ID]
2019-09-20 16:55:39,522 [1] DEBUG - Statement Id: [DAO00030_KiemTraChungTuKhoaSo] PreparedStatement : [SELECT CHUNGTU_ID              FROM TT_DUOC_CHUNGTU              WHERE              MACHUNGTU = 'CS_KBX1319003090'              and BENHVIEN_ID = 'HLU01'              and              convert(date, NGAYCHUNGTU) <=              (              SELECT TOP 1 convert(date, KHOADENNGAY)              FROM TT_DUOC_KHOASOCHUNGTU              WHERE              KHODUOC_ID = '32'              and BENHVIEN_ID = 'HLU01'              AND KHOASO = '1'              ORDER BY KHOADENNGAY DESC              )]
2019-09-20 16:55:39,552 [1] DEBUG - Statement Id: [DAO00030_KiemTraChungTuDaChuyenKeToan] PreparedStatement : [SELECT CHUNGTU_ID            FROM TT_DUOC_CHUNGTU            WHERE            CHUNGTU_ID = '137702'            and IDCHUYEN IS NOT NULL            and BENHVIEN_ID = 'HLU01']
2019-09-20 16:55:39,580 [1] DEBUG - Statement Id: [DAO00030_KiemTraBenhNhanXuatVien] PreparedStatement : [select              TT.TOATHUOC_ID              from              TT_NOITRU_TOATHUOC TT              inner join TT_NOITRU_KHAMBENH KB on TT.KHAMBENH_ID = KB.KHAMBENH_ID              inner join TT_NOITRU_BENHAN BA on BA.BENHAN_ID = KB.BENHAN_ID              WHERE              BA.TRANGTHAI = 'DAXUATVIEN'              AND TT.CHUNGTU_ID =  137702              and TT.BENHVIEN_ID = 'HLU01']
2019-09-20 16:55:39,772 [1] DEBUG - Statement Id: [DAO00030_DUOCTONKHO_GetSoTonTheoDuoc] PreparedStatement : [SELECT              DUOC_ID,              SUM(SOLUONG) AS TONGTON              FROM              TT_DUOC_TONKHO              WHERE              KHODUOC_ID = '32'              and BENHVIEN_ID = 'HLU01'              and DUOC_ID IN (1)              GROUP BY DUOC_ID]
2019-09-20 16:55:39,812 [1] DEBUG - Statement Id: [DAO00030_DUOCTONKHO_GetSoTonTheoDuocTheoLo] PreparedStatement : [SELECT              DUOC_ID,SOLONHAP_ID,              SUM(SOLUONG) AS SOLUONGTONLO              FROM              TT_DUOC_TONKHO              WHERE              KHODUOC_ID = '32'              and BENHVIEN_ID = 'HLU01'              and DUOC_ID IN (1)              and SOLONHAP_ID IN (7541)              GROUP BY DUOC_ID, SOLONHAP_ID]
2019-09-20 16:55:39,842 [1] DEBUG - Statement Id: [DAO00030_DUOCTONKHO_GetSoTonTheoDuoc] PreparedStatement : [SELECT              DUOC_ID,              SUM(SOLUONG) AS TONGTON              FROM              TT_DUOC_TONKHO              WHERE              KHODUOC_ID = '32'              and BENHVIEN_ID = 'HLU01'              and DUOC_ID IN (1)              GROUP BY DUOC_ID]
2019-09-20 16:57:57,755 [1] DEBUG - Statement Id: [DAO00014_GetPatientStatus] PreparedStatement : [select        CASE        when tn.TRANGTHAI = 'HOANTHANH' Then tn.TRANGTHAI        WHEN xncp.XACNHANCHIPHI_ID is not null THEN 'XACNHANCHIPHI'        WHEN (tn.KHOADULIEU = '1') THEN 'KHOADULIEU'        ELSE tn.TRANGTHAI        END        as TRANGTHAI        from TT_TIEPNHAN tn        left join TT_XACNHANCHIPHI xncp on tn.TIEPNHAN_ID = xncp.TIEPNHAN_ID        where tn.TIEPNHAN_ID = '27478'        and tn.BENHVIEN_ID = 'HLU01']
2019-09-20 16:57:57,983 [1] DEBUG - Statement Id: [DAO00083_GetTrangThaiTruocKhiXoa_Update_KhamBenh_VTYT] PreparedStatement : [IF EXISTS (        SELECT KHAMBENH_VTYT_ID        FROM TT_NGOAITRU_KHAMBENH_VTYT        WHERE DVYEUCAU_ID ='205443'        AND BENHVIEN_ID ='HLU01'        AND (CHUNGTU_ID IS NOT NULL OR CHUNGTUTONGHOP_ID IS NOT NULL OR PHIEULINH_ID IS NOT NULL)         and           DICHVU_GHINHANVTYT_ID = '4918'                 )        BEGIN        SELECT -1 AS RESULT        END        ELSE        BEGIN        SELECT 1 AS RESULT        END]
2019-09-20 16:57:58,082 [1] DEBUG - Statement Id: [DAO00083_GetTrangThaiTruocKhiXoa_Update_KhamBenh_VTYT] PreparedStatement : [IF EXISTS (        SELECT KHAMBENH_VTYT_ID        FROM TT_NGOAITRU_KHAMBENH_VTYT        WHERE DVYEUCAU_ID ='205443'        AND BENHVIEN_ID ='HLU01'        AND (CHUNGTU_ID IS NOT NULL OR CHUNGTUTONGHOP_ID IS NOT NULL OR PHIEULINH_ID IS NOT NULL)         and           DICHVU_GHINHANVTYT_ID = '4918'                 )        BEGIN        SELECT -1 AS RESULT        END        ELSE        BEGIN        SELECT 1 AS RESULT        END]
2019-09-20 16:57:58,198 [1] DEBUG - Statement Id: [DAO00014_GetTrangThaiTiepNhan] PreparedStatement : [select tn.TIEPNHAN_ID, tn.KHOADULIEU, xncp.XACNHANCHIPHI_ID from TT_TIEPNHAN tn        left join TT_XACNHANCHIPHI xncp        on tn.TIEPNHAN_ID = xncp.TIEPNHAN_ID        where tn.TIEPNHAN_ID = '27478'        and tn.BENHVIEN_ID = 'HLU01']
2019-09-20 16:57:58,253 [1] DEBUG - Statement Id: [DAO00063_KiemtraSoluongDuocXuatNgoaitru] PreparedStatement : [select A.TONKHO, isnull(B.BOOK_NGOAI,0) BOOK_NGOAI, isnull(D.BOOK_NOI,0) BOOK_NOI,  (A.TONKHO - isnull(B.BOOK_NGOAI,0) - isnull(D.BOOK_NOI,0)) TONKHO_BOOK        from(        select SUM(tk.SOLUONG) TONKHO, tk.DUOC_ID, sd.PHAMVI_ID, tk.NGUONDUOC_ID from TT_DUOC_TONKHO tk        inner join TM_DUOC_PHAMVISD_MAPPING sd on sd.KHODUOC_ID = tk.KHODUOC_ID        where sd.PHAMVI_ID  = '1055' and tk.DUOC_ID = '1' and tk.NGUONDUOC_ID = '1'        group by tk.DUOC_ID, sd.PHAMVI_ID, tk.NGUONDUOC_ID) A        left join (        select SUM(SOLUONG) BOOK_NGOAI,DUOC_ID, PHAMVI_ID, NGUONHANG_ID from TT_DUOC_TONKHO_BOOK_NGOAITRU        where PHAMVI_ID  = '1055' and DUOC_ID = '1' and NGUONHANG_ID = '1' and TRANGTHAI = 'HIEULUC' and SOLUONG > 0        group by DUOC_ID, PHAMVI_ID, NGUONHANG_ID) B on A.DUOC_ID = B.DUOC_ID and A.PHAMVI_ID = B.PHAMVI_ID and A.NGUONDUOC_ID = B.NGUONHANG_ID        left join (        select SUM(SOLUONG) BOOK_NOI,DUOC_ID, PHAMVI_ID, NGUONHANG_ID from TT_DUOC_TONKHO_BOOK_NOITRU        where PHAMVI_ID  = '1055' and DUOC_ID = '1' and NGUONHANG_ID = '1' and TRANGTHAI = 'HIEULUC'  and SOLUONG > 0        group by DUOC_ID, PHAMVI_ID, NGUONHANG_ID) D on A.DUOC_ID = D.DUOC_ID and A.PHAMVI_ID = D.PHAMVI_ID and A.NGUONDUOC_ID = D.NGUONHANG_ID]
2019-09-20 16:57:58,389 [1] DEBUG - Statement Id: [DAO00014_KiemTraDVYCCoBHYT] PreparedStatement : [select *        from TT_VIENPHI        where REF_ID  = '205443' and REF_TABLE = 'TT_DVYEUCAU' and BHYT_DONGIA > 0]
2019-09-20 16:57:58,511 [1] DEBUG - Statement Id: [DAO00000_GetCHECK_DOITUONG_BHYT] PreparedStatement : [select count(*) as DOITUONG_BHYT FROM TM_DOITUONG A            WHERE A.DOITUONG_ID = '4' and A.BENHVIEN_ID = 'HLU01' and MADOITUONG like '%BHYT%']
2019-09-20 16:57:58,575 [1] DEBUG - Statement Id: [DAO00000_GetLOAIGIATHUOC_NOI_NGOAI_VIEN] PreparedStatement : [SELECT LOAIGIA_ID              FROM TM_LOAIGIA              WHERE MALOAIGIA = 'GiaThuoc_NoiVien' and BENHVIEN_ID = 'HLU01']
2019-09-20 16:57:58,666 [1] DEBUG - Statement Id: [DAO00000_GetDUOC_DONGIADOANHTHU_NOIVIEN] PreparedStatement : [declare @doanhthu numeric(24,2);          declare @hotro numeric(24,2);          declare @bhyt char(1);          select top 1 @doanhthu = dg.DONGIA           from TM_DUOC_DONGIA dg          left join TM_DOITUONG_LOAIGIA dtlg on dtlg.LOAIGIA_ID = dg.LOAIGIA_ID                     where dg.DUOC_ID = '1' and dtlg.DOITUONG_ID = '4' and dg.DONGIA is not null and dg.DONGIA > 0           order by dtlg.DOUUTIEN asc          select top 1 @hotro = dg.DONGIA          from TM_DUOC_DONGIA dg          left join TM_DOITUONG_LOAIGIA dtlg on dtlg.LOAIGIA_ID = dg.LOAIGIA_ID          where dg.DUOC_ID = '1' and dtlg.DOITUONG_ID = '4' and dg.DONGIA is not null and dg.DONGIA > 0  and GIAHOTRO = '1'          order by dtlg.DOUUTIEN asc          select top 1 @bhyt = BHYT from TM_DUOC where DUOC_ID = 1          select ISNULL(@doanhthu,0.0) DONGIA_DOANHTHU, ISNULL(@hotro, 0.0) DONGIA_KHAC, isnull(@bhyt, '0') BHYT]
2019-09-20 16:57:58,803 [1] DEBUG - Statement Id: [DAO00000_GetDuocBHYT] PreparedStatement : [select count(*) BHYT FROM TM_DUOC A WHERE A.DUOC_ID = '1' and BHYT = '1']
2019-09-20 16:57:58,887 [1] DEBUG - Statement Id: [DAO00023_GetSOBHYT_HUONG_ID] PreparedStatement : [select isnull(MAX(SOBHYT_HUONG_ID),0) SOBHYT_HUONG_ID        from TT_TIEPNHAN_SOTHEBHYT        where TIEPNHAN_ID = '27478']
2019-09-20 16:57:59,082 [1] DEBUG - Statement Id: [DAO00062_GetKhoThuocCosoKhongCoso] PreparedStatement : [select distinct kd.KHODUOC_ID, lst.DICTIONARY_CODE  LOAIKHO from TM_KHODUOC kd        left join TM_PHONGBAN_KHODUOC pbkd        on kd.KHODUOC_ID = pbkd.KHODUOC_ID        and kd.BENHVIEN_ID = pbkd.BENHVIEN_ID        left join LST_DICTIONARY lst on lst.DICTIONARY_ID = kd.LOAIKHO_ID        where lst.DICTIONARY_CODE = 'Coso']
2019-09-20 16:57:59,177 [1] DEBUG - Statement Id: [DAO00062_GetAllPhamviKhoDuoc] PreparedStatement : [select distinct dmap.*        from TM_DUOC_PHAMVISD_MAPPING dmap        left join TM_DUOC_PHAMVISUDUNG dpv on dpv.PHAMVI_ID = dmap.PHAMVI_ID]
2019-09-20 16:57:59,268 [1] DEBUG - Statement Id: [DAO00083_Update_PhieuGhiNhanVTYT] PreparedStatement : [update TT_DICHVU_GHINHANVTYT set        KHOXUAT_ID =  @param0 ,        THOIGIANCAPNHAT =  @param1 ,        NGUOICAPNHAT_ID =  @param2         where        DICHVU_GHINHANVTYT_ID = '4918']
2019-09-20 16:57:59,268 [1] DEBUG - Statement Id: [DAO00083_Update_PhieuGhiNhanVTYT] Parameters: [@param0=[KHOXUAT_ID,32], @param1=[THOIGIANCAPNHAT,9/20/2019 4:57:59 PM], @param2=[NGUOICAPNHAT_ID,1]]
2019-09-20 16:57:59,268 [1] DEBUG - Statement Id: [DAO00083_Update_PhieuGhiNhanVTYT] Types: [@param0=[String, System.String], @param1=[DateTime, System.DateTime], @param2=[Int64, System.Int64]]
2019-09-20 16:57:59,400 [1] DEBUG - Statement Id: [DAO00016_CheckThuocUngThu] PreparedStatement : [SELECT count(*)        from TM_DOITUONG_GIADUOC_TYLE        WHERE DOITUONG_ID = '4'        AND DUOC_ID = '1'        AND BENHVIEN_ID = 'HLU01']
2019-09-20 16:57:59,900 [1] DEBUG - Statement Id: [DAO00083_GetBookingInfo] PreparedStatement : [select *        from TT_DUOC_TONKHO_BOOK_NGOAITRU        where                 DUOC_ID = '1'        and NGUONHANG_ID = '1'        and REF_ID = '10593'        and REF_TABLE = 'TT_NGOAITRU_KHAMBENH_VTYT'         and           KHODUOC_ID =  @param0          and           PHAMVI_ID =  @param1]
2019-09-20 16:57:59,900 [1] DEBUG - Statement Id: [DAO00083_GetBookingInfo] Parameters: [@param0=[KHODUOC_ID,32], @param1=[PHAMVI_ID,1055]]
2019-09-20 16:57:59,900 [1] DEBUG - Statement Id: [DAO00083_GetBookingInfo] Types: [@param0=[Int32, System.Int32], @param1=[Int64, System.Int64]]
2019-09-20 16:57:59,988 [1] DEBUG - Statement Id: [DAO00083_Update_Booking] PreparedStatement : [update TT_DUOC_TONKHO_BOOK_NGOAITRU set        KHODUOC_ID =  @param0 ,        NGUONHANG_ID =  @param1 ,        DUOC_ID =  @param2 ,        SOLUONG =  @param3 ,        NGAYHIEULUC =  @param4 ,        NGUOICAPNHAT_ID =  @param5 ,        NGAYCAPNHAT =  @param6          ,           PHAMVI_ID =  @param7                  where        BOOKING_ID = '34589']
2019-09-20 16:57:59,988 [1] DEBUG - Statement Id: [DAO00083_Update_Booking] Parameters: [@param0=[KHODUOC_ID,32], @param1=[NGUONHANG_ID,1], @param2=[DUOC_ID,1], @param3=[SOLUONG,2], @param4=[NGAYHIEULUC,null], @param5=[NGUOICAPNHAT_ID,1], @param6=[NGAYCAPNHAT,9/20/2019 4:57:59 PM], @param7=[PHAMVI_ID,1055]]
2019-09-20 16:57:59,988 [1] DEBUG - Statement Id: [DAO00083_Update_Booking] Types: [@param0=[Int32, System.Int32], @param1=[Int64, System.Int64], @param2=[Int64, System.Int64], @param3=[Double, System.Double], @param4=[System.DBNull, null], @param5=[Int64, System.Int64], @param6=[DateTime, System.DateTime], @param7=[Int64, System.Int64]]
2019-09-20 16:58:00,055 [1] DEBUG - Statement Id: [DAO00083_UpdateTTGhiNhanVTYT] PreparedStatement : [update TT_DVYEUCAU        set GHINHANVTYT = '1',        NGUOICAPNHAT_ID = '1',        NGAYCAPNHAT = '9/20/2019 4:58:00 PM'        where DVYEUCAU_ID  = '205443']
2019-09-20 16:58:00,127 [1] DEBUG - Statement Id: [DAO00064_GetTopTT_TIEPNHAN_SOTHEBHYT] PreparedStatement : [select top 1 stbhyt.*, ba.SOBENHAN,         tn.SOTIEPNHAN, tn.LOAITHANHVIEN_ID, tn.THE_ID, tn.THANHVIEN_ID,        tn.SUDUNG_BHTN, tn.BAOLANH_VIENPHI, tn.VIP, tn.NGUOINUOCNGOAI        from TT_TIEPNHAN_SOTHEBHYT stbhyt        left join TT_TIEPNHAN tn on tn.TIEPNHAN_ID = stbhyt.TIEPNHAN_ID        left join TT_NOITRU_BENHAN ba on ba.TIEPNHAN_ID = stbhyt.TIEPNHAN_ID        where         stbhyt.TIEPNHAN_ID = '27478' and isnull(stbhyt.KHONGSUDUNG, '0') = '0'              order by SOBHYT_HUONG_ID desc]
2019-09-20 16:58:00,284 [1] DEBUG - Statement Id: [DAO00006_GetListDuocTyle] PreparedStatement : [select DUOC_ID, DOITUONG_ID, (TYLE/100) as TYLE, DONGIA MUCTRAN_THANHTOAN from TM_DOITUONG_GIADUOC_TYLE            where            BENHVIEN_ID = 'HLU01'            and DOITUONG_ID = '4']
2019-09-20 16:58:00,376 [1] DEBUG - Statement Id: [DAO00027_GetListTuongTrinhDichVuPhauThuatCuaTiepNhan] PreparedStatement : [declare @ManhomDSA varchar(10);        declare @PhanLoaiNhomDV varchar(20) = '05';        select top 1  @ManhomDSA = VALUE from TM_SYS_APPSETTINGS where CODE = 'MANHOM_DICHVU_DSA'        if (@ManhomDSA is not null) set @PhanLoaiNhomDV += ',' + @ManhomDSA        select distinct ptyc.*        from TT_PHAUTHUAT_YEUCAU ptyc        inner join TM_DICHVU dv on dv.DICHVU_ID = ptyc.DICHVU_ID        inner join TM_NHOMDICHVU ndv on ndv.NHOMDICHVU_ID = dv.NHOMDICHVU_ID        inner join TT_PHAUTHUAT pt on pt.PHAUTHUAT_ID = ptyc.PHAUTHUAT_ID        where        pt.TIEPNHAN_ID = 27478        and (left(ndv.MANHOMDICHVU, 2) in (select * from STRING_SPLIT(@PhanLoaiNhomDV,',')) or ndv.MANHOMDICHVU in (select * from STRING_SPLIT(@PhanLoaiNhomDV,',')))]
2019-09-20 16:58:00,441 [1] DEBUG - Statement Id: [DAO00006_GetList] PreparedStatement : [select dv.*, loaiDV.MALOAIDICHVU, captren.NHOMDICHVU_ID as NHOMDICHVU_CAPTREN_ID, captren.TENNHOMDICHVU as NHOMDICHVU_CAPTREN,              nhom_dv.TENNHOMDICHVU as TENNHOMDICHVU, nhom_dv.MANHOMDICHVU,              case when dv.ATTRIBUTE5 is null then 'TT' else 'KTC' end as LOAI_CHIPHI              from TM_DICHVU as dv              left join TM_NHOMDICHVU as nhom_dv on nhom_dv.NHOMDICHVU_ID = dv.NHOMDICHVU_ID and nhom_dv.BENHVIEN_ID = 'HLU01'              left join TM_NHOMDICHVU as captren on nhom_dv.CAPTREN_ID = captren.NHOMDICHVU_ID and captren.BENHVIEN_ID = 'HLU01'              left join TM_LOAIDICHVU loaiDV on nhom_dv.LOAIDICHVU_ID = loaiDV.LOAIDICHVU_ID and loaiDV.BENHVIEN_ID = 'HLU01'              where nhom_dv.TAMNGUNG = '0' and dv.BENHVIEN_ID = 'HLU01'              and dv.TAMNGUNG = '0'               AND                   loaiDV.MALOAIDICHVU = 'KhamBenh']
2019-09-20 16:58:00,544 [1] DEBUG - Statement Id: [DAO00023_GetVienPhiByDichVuID] PreparedStatement : [select *        from TT_VIENPHI        where TIEPNHAN_ID  = '27478'        and DUOC_ID  = '1'        and REF_ID = '10593'        and REF_TABLE = 'TT_NGOAITRU_KHAMBENH_VTYT'        and DATHANHTOAN = '0']
2019-09-20 16:58:00,579 [1] DEBUG - Statement Id: [DAO00023_UpdateDuocVienPhi] PreparedStatement : [update TT_VIENPHI set                 KHAMBENH_ID =  @param0         , LOAI_CHIPHI =  @param1         , LOAIGIA_ID =  @param2         , SOLUONG =  @param3         , DONGIA_DOANHTHU =  @param4         , THANHTIEN_DOANHTHU =  @param5         , BHYT_TL =  @param6         , BHYT_DONGIA =  @param7         , BHYT_THANHTIEN =  @param8         , BHYT_DONGIA_CHITRA =  @param9         , BHYT_THANHTIEN_CHITRA =  @param10         , BENHNHAN_PHAITHANHTOAN =  @param11         , GIATRI_HOADON =  @param12         , GIATRI_HOADON_DATHANHTOAN =  @param13         , GIATRI_BIENLAI =  @param14         , GIATRI_BIENLAI_DATHANHTOAN =  @param15         , GIATRI_BENHNHAN_DATHANHTOAN =  @param16         , GIATRI_THATTHU =  @param17         , MIENGIAM_TL =  @param18                  , NGANSACH_TL =  @param19         , NGANSACH_GIATRI =  @param20         , TAITRO_TL =  @param21         , TAITRO_GIATRI =  @param22         , BHTN_TL =  @param23         , BHTN_DONGIA =  @param24         , BHTN_THANHTIEN =  @param25         , BHTN_DONGIA_CHITRA =  @param26         , BHTN_THANHTIEN_CHITRA =  @param27         , DUOCPHEPTHUCHIEN =  @param28         , HUY =  @param29         , KHONGTHUTIEN =  @param30         , BHYTDONGTIEN =  @param31         , DATHANHTOAN =  @param32         , HOADON_ID =  @param33          ,           TYLE_VAT =  @param34                  , NGUOICAPNHAT_ID =  @param35         , NGAYCAPNHAT =  @param36         where        VIENPHI_ID = '674728']
2019-09-20 16:58:00,580 [1] DEBUG - Statement Id: [DAO00023_UpdateDuocVienPhi] Parameters: [@param0=[KHAMBENH_ID,null], @param1=[LOAI_CHIPHI,TT], @param2=[LOAIGIA_ID,null], @param3=[SOLUONG,2], @param4=[DONGIA_DOANHTHU,1030], @param5=[THANHTIEN_DOANHTHU,2060], @param6=[BHYT_TL,1], @param7=[BHYT_DONGIA,1030], @param8=[BHYT_THANHTIEN,2060], @param9=[BHYT_DONGIA_CHITRA,1030], @param10=[BHYT_THANHTIEN_CHITRA,2060], @param11=[BENHNHAN_PHAITHANHTOAN,0], @param12=[GIATRI_HOADON,0], @param13=[GIATRI_HOADON_DATHANHTOAN,0], @param14=[GIATRI_BIENLAI,0], @param15=[GIATRI_BIENLAI_DATHANHTOAN,0], @param16=[GIATRI_BENHNHAN_DATHANHTOAN,0], @param17=[GIATRI_THATTHU,0], @param18=[MIENGIAM_TL,0], @param19=[NGANSACH_TL,0], @param20=[NGANSACH_GIATRI,0], @param21=[TAITRO_TL,0], @param22=[TAITRO_GIATRI,0], @param23=[BHTN_TL,0], @param24=[BHTN_DONGIA,0], @param25=[BHTN_THANHTIEN,0], @param26=[BHTN_DONGIA_CHITRA,0], @param27=[BHTN_THANHTIEN_CHITRA,0], @param28=[DUOCPHEPTHUCHIEN,0], @param29=[HUY,0], @param30=[KHONGTHUTIEN,0], @param31=[BHYTDONGTIEN,0], @param32=[DATHANHTOAN,0], @param33=[HOADON_ID,null], @param34=[TYLE_VAT,null], @param35=[NGUOICAPNHAT_ID,1], @param36=[NGAYCAPNHAT,9/20/2019 4:58:00 PM]]
2019-09-20 16:58:00,580 [1] DEBUG - Statement Id: [DAO00023_UpdateDuocVienPhi] Types: [@param0=[System.DBNull, null], @param1=[String, System.String], @param2=[System.DBNull, null], @param3=[Decimal, System.Decimal], @param4=[Decimal, System.Decimal], @param5=[Decimal, System.Decimal], @param6=[Decimal, System.Decimal], @param7=[Decimal, System.Decimal], @param8=[Decimal, System.Decimal], @param9=[Decimal, System.Decimal], @param10=[Decimal, System.Decimal], @param11=[Decimal, System.Decimal], @param12=[Decimal, System.Decimal], @param13=[Decimal, System.Decimal], @param14=[Decimal, System.Decimal], @param15=[Decimal, System.Decimal], @param16=[Decimal, System.Decimal], @param17=[Decimal, System.Decimal], @param18=[Decimal, System.Decimal], @param19=[Decimal, System.Decimal], @param20=[Decimal, System.Decimal], @param21=[Decimal, System.Decimal], @param22=[Decimal, System.Decimal], @param23=[Decimal, System.Decimal], @param24=[Decimal, System.Decimal], @param25=[Decimal, System.Decimal], @param26=[Decimal, System.Decimal], @param27=[Decimal, System.Decimal], @param28=[String, System.String], @param29=[String, System.String], @param30=[Int32, System.Int32], @param31=[String, System.String], @param32=[String, System.String], @param33=[System.DBNull, null], @param34=[System.DBNull, null], @param35=[Int64, System.Int64], @param36=[DateTime, System.DateTime]]
2019-09-20 16:58:00,642 [1] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoVaBookingCOM23UpdateRedis] PreparedStatement : [declare @NGUONDUOC_MACDINH varchar(5) = '0';        declare @TOAMUANGOAI int = 0;        select @NGUONDUOC_MACDINH = isnull(VALUE,0) from TM_SYS_APPSETTINGS where CODE = 'PHA_NGUONDUOC'        select @TOAMUANGOAI = isnull(VALUE,0) from TM_SYS_APPSETTINGS where CODE = 'OPD_TOAMUANGOAI_DUNGDANHMUC_DUOC'                if @TOAMUANGOAI = 1        begin        select  distinct '0' + '_' + LTRIM(d.DUOC_ID) + '_' + @NGUONDUOC_MACDINH as DUOC_KEY, 0 as PHAMVI_ID, @NGUONDUOC_MACDINH as NGUONDUOC_ID, null as TENNGUONDUOC, null as TINHTIEN, d.DUOC_ID, ld.MALOAIDUOC,        d.SOVISA,d.TYLE_VAT,d.COTOA, d.MADUOC, d.TENHANG, d.TENDUOCDAYDU, dvt.TENDONVITINH as DONVITINH, d.BHYT,        d.TENHOATCHAT, d.HAMLUONG, d.HANGSANXUAT, d.QUOCGIA, d.LOAIDUOC_ID, d.DUONGDUNG_ID, d.TINHTIEN_PTTT,        ten.TENDUOC, ten.TENDUOC_EN, ten.MAQUOCTE, ten.MAQUOCTEBT,        '' as BHYT_TEXT        , ld.LOAIVATTU_ID        , d.BENHVIEN_ID,        999999999 as SOLUONG, d.VTYT_PHANLOAI, d.PHAMVI, d.SUASOLUONGTONGHOP, d.MADUOCBV, d.DANGTRINHBAY        , TAMNGUNG = CASE WHEN d.TAMNGUNG = '1' THEN '1' ELSE '0' END        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        where d.DUOC_ID in (1)        union all        select  distinct tk.DUOC_KEY, LTRIM(tk.PHAMVI_ID) as PHAMVI_ID, tk.NGUONDUOC_ID, nh.TENNGUONDUOC, nh.TINHTIEN, d.DUOC_ID, ld.MALOAIDUOC,        d.SOVISA,d.TYLE_VAT,d.COTOA, d.MADUOC, d.TENHANG, d.TENDUOCDAYDU, dvt.TENDONVITINH as DONVITINH, d.BHYT,        d.TENHOATCHAT, d.HAMLUONG, d.HANGSANXUAT, d.QUOCGIA, d.LOAIDUOC_ID, d.DUONGDUNG_ID, d.TINHTIEN_PTTT,        ten.TENDUOC, ten.TENDUOC_EN, ten.MAQUOCTE, ten.MAQUOCTEBT,        CASE WHEN d.BHYT = '1' THEN 'BHYT' ELSE '' END as BHYT_TEXT        , ld.LOAIVATTU_ID        , d.BENHVIEN_ID,        tk.SOLUONG, d.VTYT_PHANLOAI, d.PHAMVI, d.SUASOLUONGTONGHOP, d.MADUOCBV, d.DANGTRINHBAY        , TAMNGUNG = CASE WHEN d.TAMNGUNG = '1' OR nh.TAMNGUNG = '1' OR kd.TAMNGUNG = '1' THEN '1' ELSE '0' END        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        inner join        (        select  LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')) DUOC_KEY, (SUM(dtk.SOLUONG) - isnull(sum(A.SOLUONG),0) - isnull(sum(B.SOLUONG),0)) SOLUONG, pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        from (select sum(soluong) soluong,duoc_id,nguonduoc_id,khoduoc_id,benhvien_id from TT_DUOC_TONKHO  group by duoc_id,nguonduoc_id,khoduoc_id,benhvien_id) dtk        inner join TM_DUOC_PHAMVISD_MAPPING pvsd on dtk.KHODUOC_ID = pvsd.KHODUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NOITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) B on B.DUOC_ID = dtk.DUOC_ID and B.SOLUONG > 0 and B.PHAMVI_ID = pvsd.PHAMVI_ID and B.NGUONHANG_ID = dtk.NGUONDUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NGOAITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) A on A.DUOC_ID = dtk.DUOC_ID and A.SOLUONG > 0 and A.PHAMVI_ID = pvsd.PHAMVI_ID and A.NGUONHANG_ID = dtk.NGUONDUOC_ID        where dtk.SOLUONG > 0 and dtk.BENHVIEN_ID = 'HLU01'        group by LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')), pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        ) tk on tk.DUOC_ID = d.DUOC_ID        left join TM_DUOC_PHAMVISUDUNG kd on kd.PHAMVI_ID = tk.PHAMVI_ID and kd.BENHVIEN_ID = 'HLU01'        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = tk.NGUONDUOC_ID and nh.BENHVIEN_ID = 'HLU01'        where  d.BENHVIEN_ID = 'HLU01' and d.DUOC_ID in (1)        end        else        begin        select  distinct tk.DUOC_KEY, LTRIM(tk.PHAMVI_ID) as PHAMVI_ID, tk.NGUONDUOC_ID, nh.TENNGUONDUOC, nh.TINHTIEN, d.DUOC_ID, ld.MALOAIDUOC,        d.SOVISA,d.TYLE_VAT,d.COTOA, d.MADUOC, d.TENHANG, d.TENDUOCDAYDU, dvt.TENDONVITINH as DONVITINH, d.BHYT,        d.TENHOATCHAT, d.HAMLUONG, d.HANGSANXUAT, d.QUOCGIA, d.LOAIDUOC_ID, d.DUONGDUNG_ID, d.TINHTIEN_PTTT,        ten.TENDUOC, ten.TENDUOC_EN, ten.MAQUOCTE, ten.MAQUOCTEBT,        CASE WHEN d.BHYT = '1' THEN 'BHYT' ELSE '' END as BHYT_TEXT        , ld.LOAIVATTU_ID        , d.BENHVIEN_ID,        tk.SOLUONG, d.VTYT_PHANLOAI, d.PHAMVI, d.SUASOLUONGTONGHOP, d.MADUOCBV, d.DANGTRINHBAY        , TAMNGUNG = CASE WHEN d.TAMNGUNG = '1' OR nh.TAMNGUNG = '1' OR kd.TAMNGUNG = '1' THEN '1' ELSE '0' END        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        inner join        (        select  LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')) DUOC_KEY, (SUM(dtk.SOLUONG) - isnull(sum(A.SOLUONG),0) - isnull(sum(B.SOLUONG),0)) SOLUONG, pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        from (select sum(soluong) soluong,duoc_id,nguonduoc_id,khoduoc_id,benhvien_id from TT_DUOC_TONKHO  group by duoc_id,nguonduoc_id,khoduoc_id,benhvien_id) dtk        inner join TM_DUOC_PHAMVISD_MAPPING pvsd on dtk.KHODUOC_ID = pvsd.KHODUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NOITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) B on B.DUOC_ID = dtk.DUOC_ID and B.SOLUONG > 0 and B.PHAMVI_ID = pvsd.PHAMVI_ID and B.NGUONHANG_ID = dtk.NGUONDUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NGOAITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) A on A.DUOC_ID = dtk.DUOC_ID and A.SOLUONG > 0 and A.PHAMVI_ID = pvsd.PHAMVI_ID and A.NGUONHANG_ID = dtk.NGUONDUOC_ID        where dtk.SOLUONG > 0 and dtk.BENHVIEN_ID = 'HLU01'        group by LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')), pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        ) tk on tk.DUOC_ID = d.DUOC_ID        left join TM_DUOC_PHAMVISUDUNG kd on kd.PHAMVI_ID = tk.PHAMVI_ID and kd.BENHVIEN_ID = 'HLU01'        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = tk.NGUONDUOC_ID and nh.BENHVIEN_ID = 'HLU01'        where  d.BENHVIEN_ID = 'HLU01' and d.DUOC_ID in (1)        end]
2019-09-20 16:59:11,332 [1] DEBUG - Statement Id: [DAO00030_GetKhoDuoc] PreparedStatement : [SELECT *            FROM            TM_KHODUOC            WHERE            KHODUOC_ID= '32'            and BENHVIEN_ID= 'HLU01']
2019-09-20 16:59:11,382 [1] DEBUG - Statement Id: [DAO00030_GetMucDichChungTuID] PreparedStatement : [SELECT DICTIONARY_ID              FROM              LST_DICTIONARY              WHERE              DICTIONARY_TYPE_CODE = 'MucDichChungTu'              and DICTIONARY_CODE = 'X13']
2019-09-20 16:59:11,434 [1] DEBUG - Statement Id: [DAO00036_GetDetail] PreparedStatement : [select KEYTYPE, KEYYEAR, KEYMONTH, KEYDAY, SEGMENT_1, SEGMENT_2, SEGMENT_3, KEYVALUE              from LST_KEYDATA_DUOCPHAM as kd               WHERE                        kd.KEYTYPE = 'SOCHUNGTUNHAPXUATBENNGOAI'                   AND                       kd.KEYYEAR = '2019'                   AND                       kd.KEYMONTH = '0'                   AND                       kd.KEYDAY = '0'                   AND                       kd.SEGMENT_1 = 'CS_KB'                   AND                       kd.SEGMENT_2 = 'X13'                   AND                       kd.SEGMENT_3 = ' ']
2019-09-20 16:59:11,475 [1] DEBUG - Statement Id: [DAO00036_Update] PreparedStatement : [update LST_KEYDATA_DUOCPHAM set              KEYVALUE =  @param0               where              KEYTYPE = 'SOCHUNGTUNHAPXUATBENNGOAI'              AND KEYYEAR = '2019'              AND KEYMONTH = '0'              AND KEYDAY = '0'              AND SEGMENT_1 = 'CS_KB'              AND SEGMENT_2 = 'X13'              AND SEGMENT_3 = ' ']
2019-09-20 16:59:11,475 [1] DEBUG - Statement Id: [DAO00036_Update] Parameters: [@param0=[KEYVALUE,003091]]
2019-09-20 16:59:11,475 [1] DEBUG - Statement Id: [DAO00036_Update] Types: [@param0=[String, System.String]]
2019-09-20 16:59:11,508 [1] DEBUG - Statement Id: [DAO00030_GetGhiNhanVTYTKhamBenhByKhamBenhID] PreparedStatement : [SELECT            N'Người bệnh: ' + bn.MAYTE + ' - ' + bn.TENBENHNHAN + ' - ' +  CONVERT(VARCHAR(10), KB.THOIGIANKHAM, 103) + ' - ' + CONVERT(VARCHAR(5), KB.THOIGIANKHAM, 108) as BENHNHAN            ,tt.* , tt.NGUONHANG_ID AS NGUONDUOC_ID            FROM TT_NGOAITRU_KHAMBENH_VTYT tt            INNER JOIN TT_NGOAITRU_KHAMBENH KB on KB.KHAMBENH_ID = TT.KHAMBENH_ID AND KB.BENHVIEN_ID = TT.BENHVIEN_ID            INNER JOIN TT_BENHNHAN bn on bn.BENHNHAN_ID = KB.BENHNHAN_ID AND BN.BENHVIEN_ID = KB.BENHVIEN_ID            WHERE            tt.KHAMBENH_ID= 26173 and tt.COSO = '1' and tt.CHUNGTU_ID is null            AND TT.BENHVIEN_ID = 'HLU01'             and               tt.DICHVU_GHINHANVTYT_ID = 4918]
2019-09-20 16:59:11,568 [1] DEBUG - Statement Id: [DAO00030_GET_SOLONHAP_XUATSUDUNG] PreparedStatement : [SELECT DISTINCT            SLN.SOLONHAP_ID, SLN.SOLONHAP, SLN.SOLOSANPHAM, SLN.SOKIEMSOAT, SLN.SOVISA, CONVERT(varchar(20), SLN.SOLOSANPHAM) + '/' + CONVERT(varchar(20), TK.SOLUONG) AS SOLOSOTON,            SLN.NGAYNHAP AS NGAYNHAPLO, SLN.HANDUNG AS HANSUDUNG,  SLN.HANDUNG, SLN.NGUONDUOC_ID, SLN.NGUONDUOC_ID as NGUONHANG_ID,            SLNGB.DONGIAMUA, SLNGB.DONGIAVON, SLNGB.TYLEVAT_DAUVAO as TYLEVAT, d.TYLE_VAT, SLNGB.DONGIAVONVAT, SLNGB.DONGIABANVAT_DAUVAO,            dg.DONGIA AS DONGIATHAU, dg.DONGIA AS DONGIABAN, dg.DONGIA AS DONGIABAN_VAT,                      TK.KHODUOC_ID,TK.DUOC_ID, TK.SOLUONG, TK.SOLUONG AS SOLUONGTON,            D.TENDUOCDAYDU,D.DONVITINH_ID, D.DONVITINH, D.BHYT, NH.TENNGUONDUOC AS NGUONHANG,            LTRIM(TK.KHODUOC_ID) + '_' + LTRIM(TK.DUOC_ID) + '_' + LTRIM(TK.NGUONDUOC_ID) as DUOC_KEY            FROM            TT_DUOC_CHUNGTU_SOLONHAP SLN            INNER JOIN TT_DUOC_TONKHO TK on SLN.SOLONHAP_ID = TK.SOLONHAP_ID            INNER JOIN TT_DUOC_SOLONHAP_GIABAN SLNGB on SLN.SOLONHAP_ID = SLNGB.SOLONHAP_ID            INNER JOIN TM_NGUONHANG NH on SLN.NGUONDUOC_ID = NH.NGUONDUOC_ID            INNER JOIN TM_DUOC D on SLN.DUOC_ID = D.DUOC_ID            LEFT JOIN TM_DUOC_DONGIA dg on dg.DUOC_ID = SLN.DUOC_ID            LEFT JOIN TM_LOAIGIA lg on (lg.LOAIGIA_ID = dg.LOAIGIA_ID AND lg.MALOAIGIA = 'GiaduocBHYT')            WHERE            TK.DUOC_ID = '1'            AND TK.KHODUOC_ID = '32'            AND TK.BENHVIEN_ID = 'HLU01'            AND TK.SOLUONG > 0                 and                     SLN.NGUONDUOC_ID = '1'                                      ORDER BY NGAYNHAP]
2019-09-20 16:59:11,607 [1] DEBUG - Statement Id: [DAO00030_Add] PreparedStatement : [insert into TT_DUOC_CHUNGTU (              MACHUNGTU              , SOCHUNGTU              , NGAYCHUNGTU              , LOAICHUNGTU              , MUCDICHCHUNGTU_ID              , MUCDICHCHUNGTU_CODE              , KHOXUAT_ID              , NGUOIGIAO_ID              , NGUOIGIAO              , KHONHAP_ID              , NGUOINHAN_ID              , NGUOINHAN              , NGUOIKIEMTRA_ID              , NGUOIKIEMTRA              , NGUOIDUYET_ID              , NGUOIDUYET              , PHUONGPHAPXUAT              , KETOANTRUONG_ID              , KETOANTRUONG              , THUKHO_ID              , THUKHO              , MAUHOADON              , SOHOADON              , SOSERI              , NGAYHOADON              , DIENGIAI              , GIATRI              , GIATRITHANHTOAN              , TYLEVAT              , GIATRIVAT              , THUESUAT              , GIATRITHUE              , TYLECHIETKHAU              , GIATRICHIETKHAU              , TIENTE_ID              , TYGIA              , SOCHUNGTUGOC              , NGAYCHUNGTUGOC              , NHACUNGCAP_ID              , HINHTHUCTHANHTOAN_ID              , NGUONDUOC_ID              , CHUNGTULIENQUAN_ID              , KHAMBENH_ID              , TOATHUOCNOITRU_ID              , TIEPNHAN_ID              , BENHAN_ID              , DANHANTHUOC              , NGUOINHAP_ID              , NGAYNHAP              , TRANGTHAI              , LOAITOATHUOC              , PHIEULINH_ID              , DIENGIAINGHIEPVUPHATSINH              , DONVIGIAO_ID              , KHOSUDUNG_ID              , LOAIVATTU_ID              , BENHNHAN_ID              , NGOAITRU_TOATHUOC_NGUOIMUA_ID              , TENBENHNHAN              , BACSIGIOITHIEU_ID              , DOITUONG_ID              , IDCHUYEN              , CHUNGTUKETOAN              , STATUS              , TRANSFER_VIENPHI_ID              , PHONGBAN_ID              , BACSI_ID              , TKNO              , TKCO              , MACHUNGTUREF              , LOAICHUNGTUREF              , PHIEULINHCANTRU_ID              , KHOTHUCHIEN_ID              , KHODOIUNG_ID              , MENU_LOAIDUOC_ID              , NGUOISUDUNGMAY_ID              , GOITHAU_ID              , XUATTHUOCBANGOAITRU              , NGAYGIOCHUNGTU              , NOIDAKHAM              , HOIDONGKIEMNHAP_ID              , HOIDONGTHANHLY_ID              , CHUYENCHUNGTUID              , CHUYENDOANHTHUID              , LYDOXUATSUDUNG_ID              , BENHVIEN_ID              , NGAYTAO              , NGUOITAO_ID              , NGAYCAPNHAT              , NGUOICAPNHAT_ID              ) values (               @param0               ,  @param1               ,  @param2               ,  @param3               ,  @param4               ,  @param5               ,  @param6               ,  @param7               ,  @param8               ,  @param9               ,  @param10               ,  @param11               ,  @param12               ,  @param13               ,  @param14               ,  @param15               ,  @param16               ,  @param17               ,  @param18               ,  @param19               ,  @param20               ,  @param21               ,  @param22               ,  @param23               ,  @param24               ,  @param25               ,  @param26               ,  @param27               ,  @param28               ,  @param29               ,  @param30               ,  @param31               ,  @param32               ,  @param33               ,  @param34               ,  @param35               ,  @param36               ,  @param37               ,  @param38               ,  @param39               ,  @param40               ,  @param41               ,  @param42               ,  @param43               ,  @param44               ,  @param45               ,  @param46               ,  @param47               ,  @param48               ,  @param49               ,  @param50               ,  @param51               ,  @param52               ,  @param53               ,  @param54               ,  @param55               ,  @param56               ,  @param57               ,  @param58               ,  @param59               ,  @param60               ,  @param61               ,  @param62               ,  @param63               ,  @param64               ,  @param65               ,  @param66               ,  @param67               ,  @param68               ,  @param69               ,  @param70               ,  @param71               ,  @param72               ,  @param73               ,  @param74               ,  @param75               ,  @param76               ,  @param77               ,  @param78               ,  @param79               ,  @param80               ,  @param81               ,  @param82               ,  @param83               ,  @param84               ,  @param85               ,  @param2               ,  @param86               ,  @param87               ,  @param88               )              select SCOPE_identity() as value]
2019-09-20 16:59:11,607 [1] DEBUG - Statement Id: [DAO00030_Add] Parameters: [@param0=[MACHUNGTU,CS_KBX1319003091], @param1=[SOCHUNGTU,003091], @param2=[NGAYCHUNGTU,9/20/2019 4:59:11 PM], @param3=[LOAICHUNGTU,X], @param4=[MUCDICHCHUNGTU_ID,1060], @param5=[MUCDICHCHUNGTU_CODE,X13], @param6=[KHOXUAT_ID,32], @param7=[NGUOIGIAO_ID,0], @param8=[NGUOIGIAO,null], @param9=[KHONHAP_ID,null], @param10=[NGUOINHAN_ID,null], @param11=[NGUOINHAN,null], @param12=[NGUOIKIEMTRA_ID,null], @param13=[NGUOIKIEMTRA,null], @param14=[NGUOIDUYET_ID,null], @param15=[NGUOIDUYET,null], @param16=[PHUONGPHAPXUAT,0], @param17=[KETOANTRUONG_ID,null], @param18=[KETOANTRUONG,null], @param19=[THUKHO_ID,null], @param20=[THUKHO,null], @param21=[MAUHOADON,null], @param22=[SOHOADON,null], @param23=[SOSERI,null], @param24=[NGAYHOADON,null], @param25=[DIENGIAI,null], @param26=[GIATRI,null], @param27=[GIATRITHANHTOAN,null], @param28=[TYLEVAT,5], @param29=[GIATRIVAT,0], @param30=[THUESUAT,null], @param31=[GIATRITHUE,null], @param32=[TYLECHIETKHAU,null], @param33=[GIATRICHIETKHAU,null], @param34=[TIENTE_ID,null], @param35=[TYGIA,null], @param36=[SOCHUNGTUGOC,null], @param37=[NGAYCHUNGTUGOC,null], @param38=[NHACUNGCAP_ID,null], @param39=[HINHTHUCTHANHTOAN_ID,null], @param40=[NGUONDUOC_ID,null], @param41=[CHUNGTULIENQUAN_ID,null], @param42=[KHAMBENH_ID,null], @param43=[TOATHUOCNOITRU_ID,null], @param44=[TIEPNHAN_ID,null], @param45=[BENHAN_ID,null], @param46=[DANHANTHUOC,], @param47=[NGUOINHAP_ID,null], @param48=[NGAYNHAP,null], @param49=[TRANGTHAI,DAXUAT], @param50=[LOAITOATHUOC,null], @param51=[PHIEULINH_ID,null], @param52=[DIENGIAINGHIEPVUPHATSINH,null], @param53=[DONVIGIAO_ID,null], @param54=[KHOSUDUNG_ID,null], @param55=[LOAIVATTU_ID,null], @param56=[BENHNHAN_ID,null], @param57=[NGOAITRU_TOATHUOC_NGUOIMUA_ID,null], @param58=[TENBENHNHAN,null], @param59=[BACSIGIOITHIEU_ID,null], @param60=[DOITUONG_ID,null], @param61=[IDCHUYEN,null], @param62=[CHUNGTUKETOAN,null], @param63=[STATUS,null], @param64=[TRANSFER_VIENPHI_ID,null], @param65=[PHONGBAN_ID,62], @param66=[BACSI_ID,null], @param67=[TKNO,null], @param68=[TKCO,null], @param69=[MACHUNGTUREF,null], @param70=[LOAICHUNGTUREF,null], @param71=[PHIEULINHCANTRU_ID,null], @param72=[KHOTHUCHIEN_ID,null], @param73=[KHODOIUNG_ID,null], @param74=[MENU_LOAIDUOC_ID,null], @param75=[NGUOISUDUNGMAY_ID,null], @param76=[GOITHAU_ID,null], @param77=[XUATTHUOCBANGOAITRU,null], @param78=[NGAYGIOCHUNGTU,null], @param79=[NOIDAKHAM,null], @param80=[HOIDONGKIEMNHAP_ID,null], @param81=[HOIDONGTHANHLY_ID,null], @param82=[CHUYENCHUNGTUID,null], @param83=[CHUYENDOANHTHUID,null], @param84=[LYDOXUATSUDUNG_ID,8294], @param85=[BENHVIEN_ID,HLU01], @param86=[NGUOITAO_ID,0], @param87=[NGAYCAPNHAT,9/20/2019 4:59:11 PM], @param88=[NGUOICAPNHAT_ID,0]]
2019-09-20 16:59:11,607 [1] DEBUG - Statement Id: [DAO00030_Add] Types: [@param0=[String, System.String], @param1=[String, System.String], @param2=[DateTime, System.DateTime], @param3=[String, System.String], @param4=[Int32, System.Int32], @param5=[String, System.String], @param6=[Int32, System.Int32], @param7=[Int32, System.Int32], @param8=[System.DBNull, null], @param9=[System.DBNull, null], @param10=[System.DBNull, null], @param11=[System.DBNull, null], @param12=[System.DBNull, null], @param13=[System.DBNull, null], @param14=[System.DBNull, null], @param15=[System.DBNull, null], @param16=[Int32, System.Int32], @param17=[System.DBNull, null], @param18=[System.DBNull, null], @param19=[System.DBNull, null], @param20=[System.DBNull, null], @param21=[System.DBNull, null], @param22=[System.DBNull, null], @param23=[System.DBNull, null], @param24=[System.DBNull, null], @param25=[System.DBNull, null], @param26=[System.DBNull, null], @param27=[System.DBNull, null], @param28=[Decimal, System.Decimal], @param29=[Decimal, System.Decimal], @param30=[System.DBNull, null], @param31=[System.DBNull, null], @param32=[System.DBNull, null], @param33=[System.DBNull, null], @param34=[System.DBNull, null], @param35=[System.DBNull, null], @param36=[System.DBNull, null], @param37=[System.DBNull, null], @param38=[System.DBNull, null], @param39=[System.DBNull, null], @param40=[System.DBNull, null], @param41=[System.DBNull, null], @param42=[System.DBNull, null], @param43=[System.DBNull, null], @param44=[System.DBNull, null], @param45=[System.DBNull, null], @param46=[String, System.String], @param47=[System.DBNull, null], @param48=[System.DBNull, null], @param49=[String, System.String], @param50=[System.DBNull, null], @param51=[System.DBNull, null], @param52=[System.DBNull, null], @param53=[System.DBNull, null], @param54=[System.DBNull, null], @param55=[System.DBNull, null], @param56=[System.DBNull, null], @param57=[System.DBNull, null], @param58=[System.DBNull, null], @param59=[System.DBNull, null], @param60=[System.DBNull, null], @param61=[System.DBNull, null], @param62=[System.DBNull, null], @param63=[System.DBNull, null], @param64=[System.DBNull, null], @param65=[Int32, System.Int32], @param66=[System.DBNull, null], @param67=[System.DBNull, null], @param68=[System.DBNull, null], @param69=[System.DBNull, null], @param70=[System.DBNull, null], @param71=[System.DBNull, null], @param72=[System.DBNull, null], @param73=[System.DBNull, null], @param74=[System.DBNull, null], @param75=[System.DBNull, null], @param76=[System.DBNull, null], @param77=[System.DBNull, null], @param78=[System.DBNull, null], @param79=[System.DBNull, null], @param80=[System.DBNull, null], @param81=[System.DBNull, null], @param82=[System.DBNull, null], @param83=[System.DBNull, null], @param84=[Int32, System.Int32], @param85=[String, System.String], @param86=[Int32, System.Int32], @param87=[DateTime, System.DateTime], @param88=[Int32, System.Int32]]
2019-09-20 16:59:11,645 [1] DEBUG - Statement Id: [DAO00030_CHUNGTUCT_AddMulti] PreparedStatement : [declare @json nvarchar(max) =  N'[{"SOLONHAP_ID":7541,"SOLONHAP":"190500624","SOLOSANPHAM":"a","SOKIEMSOAT":null,"SOVISA":"1","SOLOSOTON":"a/8.0000","NGAYNHAPLO":"2019-05-06T10:24:00","HANSUDUNG":"2026-12-12T00:00:00","HANDUNG":"2026-12-12T00:00:00","NGUONDUOC_ID":1,"NGUONHANG_ID":1,"DONGIAMUA":945.0000,"DONGIAVON":945.0000,"TYLEVAT":0.0000,"TYLE_VAT":0.00,"DONGIAVONVAT":945.0000,"DONGIABANVAT_DAUVAO":945.0000,"DONGIATHAU":1030.00,"DONGIABAN":1030.00,"DONGIABAN_VAT":1030.00,"KHODUOC_ID":32,"DUOC_ID":1,"SOLUONG":8.0000,"SOLUONGTON":8.0000,"TENDUOCDAYDU":null,"DONVITINH_ID":17,"DONVITINH":"Cái","BHYT":"1","NGUONHANG":"Nguồn Mua","DUOC_KEY":"32_1_1","CHUNGTUCHITIET_ID":0,"CHUNGTU_ID":137703,"SOLUONGTHUCTE":null,"TOATHUOC":"NGOAITRU_KHAMBENH_VTYT","TOATHUOCNOITRU_ID":null,"REF_TABLE":"TT_NGOAITRU_KHAMBENH_VTYT","REF_ID":10593,"KHAMBENH_VTYT_ID":10593,"BENHNHAN":"Người bệnh: 190043304 - Test Xn1 - 20/09/2019 - 16:50","SOLUONGYEUCAU":2,"PHAUTHUAT_VTYT_ID":null,"CLSKETQUA_VTYT_ID":null,"SOLUONGDAXUAT":2.0,"THANHTIENVON":1890.0000,"NGAYTAO":"20/Sep/2019 16:59:11","NGUOITAO_ID":0,"BENHVIEN_ID":"HLU01"}]';             INSERT INTO TT_DUOC_CHUNGTU_CHITIET           (           CHUNGTU_ID           , DUOC_ID           , SOLONHAP_ID           , SOKIEMSOAT           , SOVISA           , HANDUNG           , DONVITINH_ID           , SOLUONGYEUCAU           , SOLUONGTHUCTE           , SOLUONGDAXUAT           , TIENTE_ID           , TYGIA           , DONGIAMUA           , DONGIA_BHYT           , DONGIABAN           , DONGIABAN_VAT           , DONGIAVON           , DONGIATHANHTOAN           , SOQUYEN           , SOHOADONVAT           , TYLEVAT           , GIATRIVAT           , TYLECHIETKHAU           , GIATRICHIETKHAU           , MIENPHI           , LYDOMIENPHI_ID           , SOCHUNGTUKETOAN           , SOCHUNGTUTIENMAT           , TRANGTHAI           , DAPHATSINHPHIEUXUAT           , DAPHATSINHPHIEUHOANTRA           , KHUYENMAI           , PHUONGPHAPXUAT           , DONDATHANG_ID           , GHICHUCHITIET           , NGUONHANG_ID           , DONGIAVONVAT           , THANHTIENMUA           , THANHTIENVON           , THANHTIENHOPDONG           , ISTACHLO           , DONVITINHBANDAU_ID           , SOLUONGBANDAU           , GOITHAU_ID           , DONGIATHAU           , DONGIAPO           , TYLEQUIDOI           , TOATHUOCNOITRU_ID           , KHAMBENH_VTYT_ID           , PHAUTHUAT_VTYT_ID           , CLSKETQUA_VTYT_ID           , TOATHUOCNGOAITRU_ID           , CHUNGTUCHITIET_LIENQUAN_ID           , MASTER_ID           , BENHNHAN           , YLENH           , BENHVIEN_ID           , NGAYTAO           , NGUOITAO_ID                    )                  SELECT * FROM OPENJSON(@json)           WITH (           CHUNGTU_ID int           , DUOC_ID int           , SOLONHAP_ID int           , SOKIEMSOAT varchar(20)           , SOVISA varchar(20)           , HANDUNG datetime           , DONVITINH_ID int           , SOLUONGYEUCAU numeric(25, 4)           , SOLUONGTHUCTE numeric(25, 4)           , SOLUONGDAXUAT numeric(25, 4)           , TIENTE_ID nchar(3)           , TYGIA numeric(25, 4)           , DONGIAMUA numeric(25, 4)           , DONGIA_BHYT numeric(25, 4)           , DONGIABAN numeric(25, 4)           , DONGIABAN_VAT numeric(25, 4)           , DONGIAVON numeric(25, 4)           , DONGIATHANHTOAN numeric(25, 4)           , SOQUYEN varchar(20)           , SOHOADONVAT varchar(20)           , TYLEVAT  numeric(25, 4)           , GIATRIVAT numeric(25, 4)           , TYLECHIETKHAU numeric(25, 4)           , GIATRICHIETKHAU numeric(25, 4)           , MIENPHI char(1)           , LYDOMIENPHI_ID int           , SOCHUNGTUKETOAN varchar(20)           , SOCHUNGTUTIENMAT varchar(20)           , TRANGTHAI varchar(10)           , DAPHATSINHPHIEUXUAT char(1)           , DAPHATSINHPHIEUHOANTRA char(1)           , KHUYENMAI char(1)           , PHUONGPHAPXUAT int           , DONDATHANG_ID int           , GHICHUCHITIET nvarchar(255)           , NGUONHANG_ID int           , DONGIAVONVAT numeric(25, 4)           , THANHTIENMUA numeric(25, 4)           , THANHTIENVON numeric(25, 4)           , THANHTIENHOPDONG numeric(25, 4)           , ISTACHLO char(1)           , DONVITINHBANDAU_ID int           , SOLUONGBANDAU numeric(25, 4)           , GOITHAU_ID int           , DONGIATHAU numeric(25, 4)           , DONGIAPO numeric(25, 4)           , TYLEQUIDOI numeric(25, 4)           , TOATHUOCNOITRU_ID int           , KHAMBENH_VTYT_ID int           , PHAUTHUAT_VTYT_ID int           , CLSKETQUA_VTYT_ID int           , TOATHUOCNGOAITRU_ID int           , CHUNGTUCHITIET_LIENQUAN_ID int           , MASTER_ID int           , BENHNHAN nvarchar(1000)           , YLENH nvarchar(MAX)           , BENHVIEN_ID varchar(10)           , NGAYTAO datetime           , NGUOITAO_ID int                  )                      IF('X13' = 'X13')           BEGIN                      UPDATE TT_NOITRU_TOATHUOC SET CHUNGTU_ID = json.CHUNGTU_ID, TRANGTHAI = 'DAXUAT', NGAYCAPNHAT = getdate()           FROM OPENJSON(@json)           WITH (CHUNGTU_ID int, TOATHUOCNOITRU_ID int) json           WHERE TT_NOITRU_TOATHUOC.TOATHUOC_ID = json.TOATHUOCNOITRU_ID and json.TOATHUOCNOITRU_ID is not NULL                  UPDATE TT_VIENPHI set DUYET = '1', DATHUCHIEN = '1', NGAYCAPNHAT = getdate()           FROM OPENJSON(@json)           WITH (TOATHUOCNOITRU_ID int) json           WHERE TT_VIENPHI.REF_TABLE = 'TT_NOITRU_TOATHUOC' and TT_VIENPHI.REF_ID = json.TOATHUOCNOITRU_ID and json.TOATHUOCNOITRU_ID is not NULL                                 UPDATE TT_NGOAITRU_KHAMBENH_VTYT SET CHUNGTU_ID = json.CHUNGTU_ID, TRANGTHAI = 'DAXUAT', NGAYCAPNHAT = getdate()           FROM OPENJSON(@json)           WITH (CHUNGTU_ID int, KHAMBENH_VTYT_ID int) json           WHERE TT_NGOAITRU_KHAMBENH_VTYT.KHAMBENH_VTYT_ID = json.KHAMBENH_VTYT_ID and json.KHAMBENH_VTYT_ID is not NULL                  UPDATE TT_VIENPHI set DUYET = '1', DATHUCHIEN = '1', NGAYCAPNHAT = getdate()           FROM OPENJSON(@json)           WITH (KHAMBENH_VTYT_ID int) json           WHERE TT_VIENPHI.REF_TABLE = 'TT_NGOAITRU_KHAMBENH_VTYT' and TT_VIENPHI.REF_ID = json.KHAMBENH_VTYT_ID and json.KHAMBENH_VTYT_ID is not NULL                                  UPDATE TT_PHAUTHUAT_VTYT SET CHUNGTU_ID = json.CHUNGTU_ID           FROM OPENJSON(@json)           WITH (CHUNGTU_ID int, PHAUTHUAT_VTYT_ID int) json           WHERE TT_PHAUTHUAT_VTYT.PHAUTHUAT_VTYT_ID = json.PHAUTHUAT_VTYT_ID and json.PHAUTHUAT_VTYT_ID is not NULL                  UPDATE TT_VIENPHI set DUYET = '1', DATHUCHIEN = '1', NGAYCAPNHAT = getdate()           FROM OPENJSON(@json)           WITH (PHAUTHUAT_VTYT_ID int) json           WHERE TT_VIENPHI.REF_TABLE = 'TT_PHAUTHUAT_VTYT' and TT_VIENPHI.REF_ID = json.PHAUTHUAT_VTYT_ID and json.PHAUTHUAT_VTYT_ID is not NULL                              UPDATE TT_CLSKETQUA_VTYT SET CHUNGTU_ID = json.CHUNGTU_ID, TRANGTHAI = 'DAXUAT', NGAYCAPNHAT = getdate()           FROM OPENJSON(@json)           WITH (CHUNGTU_ID int, CLSKETQUA_VTYT_ID int) json           WHERE TT_CLSKETQUA_VTYT.CLSKETQUA_VTYT_ID = json.CLSKETQUA_VTYT_ID and json.CLSKETQUA_VTYT_ID is not NULL                  UPDATE TT_VIENPHI set DUYET = '1', DATHUCHIEN = '1', NGAYCAPNHAT = getdate()           FROM OPENJSON(@json)           WITH (CLSKETQUA_VTYT_ID int) json           WHERE TT_VIENPHI.REF_TABLE = 'TT_CLSKETQUA_VTYT' and TT_VIENPHI.REF_ID = json.CLSKETQUA_VTYT_ID and json.CLSKETQUA_VTYT_ID is not NULL                      END]
2019-09-20 16:59:11,842 [1] DEBUG - Statement Id: [DAO00030_DUOC_TONKHO_BOOKING_NGOAITRU_Giam] PreparedStatement : [update TT_DUOC_TONKHO_BOOK_NGOAITRU            set            SOLUONG = 0                     ,NGAYCAPNHAT = getdate()            where            REF_TABLE = 'TT_NGOAITRU_KHAMBENH_VTYT'            AND REF_ID = '10593'                AND BENHVIEN_ID = 'HLU01']
2019-09-20 16:59:11,902 [1] DEBUG - Statement Id: [DAO00030_DUOCTONKHO_Giam] PreparedStatement : [update TT_DUOC_TONKHO set            SOLUONG = SOLUONG -  @param0             , NGAYCAPNHAT =  getdate()            , NGUOICAPNHAT_ID =  @param1             where            KHODUOC_ID =  @param2             and DUOC_ID =  @param3             and SOLONHAP_ID =  @param4]
2019-09-20 16:59:11,902 [1] DEBUG - Statement Id: [DAO00030_DUOCTONKHO_Giam] Parameters: [@param0=[SOLUONGTHAYDOI,2], @param1=[NGUOICAPNHAT_ID,null], @param2=[KHODUOC_ID,32], @param3=[DUOC_ID,1], @param4=[SOLONHAP_ID,7541]]
2019-09-20 16:59:11,902 [1] DEBUG - Statement Id: [DAO00030_DUOCTONKHO_Giam] Types: [@param0=[Decimal, System.Decimal], @param1=[System.DBNull, null], @param2=[Int32, System.Int32], @param3=[Int32, System.Int32], @param4=[Int32, System.Int32]]
2019-09-20 16:59:11,949 [1] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoCOM18] PreparedStatement : [select  distinct TT_TONKHO.DUOC_KEY, LTRIM(TT_TONKHO.KHODUOC_ID) as KHODUOC_ID, TM_DUOC.DUOC_ID, TM_LOAIDUOC.MALOAIDUOC,TM_DUOC.SOVISA,TM_DUOC.TYLE_VAT,TM_DUOC.COTOA,        TM_DUOC.MADUOC, TM_DUOC.TENHANG, TM_DUOC.TENDUOCDAYDU, dvt.TENDONVITINH as DONVITINH, TM_DUOC.DONVITINH_ID, TM_DUOC.BHYT,        TM_DUOC.TENHOATCHAT, TM_DUOC.HAMLUONG, TM_DUOC.HANGSANXUAT, TM_DUOC.QUOCGIA, TM_DUOC.LOAIDUOC_ID, TM_DUOC.DUONGDUNG_ID,        TM_TENDUOC.TENDUOC, TM_TENDUOC.TENDUOC_EN, TM_TENDUOC.MAQUOCTE, TM_TENDUOC.MAQUOCTEBT,        TM_LOAIDUOC.LOAIVATTU_ID, TM_DUOC.BENHVIEN_ID,        TT_TONKHO.SOLUONG, TM_DUOC.VTYT_PHANLOAI, TM_DUOC.PHAMVI, TT_TONKHO.NGUONDUOC_ID, NG.TENNGUONDUOC        , TAMNGUNG = CASE WHEN TM_DUOC.TAMNGUNG = '1' OR NG.TAMNGUNG = '1' OR KD.TAMNGUNG = '1' THEN '1' ELSE '0' END        , TM_DUOC.DANGTRINHBAY        from TM_DUOC        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = TM_DUOC.DONVITINH_ID        left join TM_TENDUOC on TM_DUOC.TENDUOC_ID = TM_TENDUOC.TENDUOC_ID and TM_DUOC.BENHVIEN_ID = 'HLU01'  and TM_DUOC.TAMNGUNG = '0'        left join TM_LOAIDUOC on TM_LOAIDUOC.LOAIDUOC_ID = TM_DUOC.LOAIDUOC_ID and TM_LOAIDUOC.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG on (TM_LOAIDUOC.LOAIVATTU_ID = TM_DUOC_HANDUNG.LOAIDUOC and TM_DUOC_HANDUNG.BENHVIEN_ID = 'HLU01')        inner join        (select LTRIM(A.KHODUOC_ID) + '_' + LTRIM(A.DUOC_ID) + '_' + LTRIM(ISNULL(A.NGUONDUOC_ID,'')) as DUOC_KEY, A.KHODUOC_ID, A.DUOC_ID ,a.NGUONDUOC_ID,        SUM(isnull(A.SOLUONG,0)) as SOLUONG        from        (select SUM(SOLUONG) as SOLUONG, KHODUOC_ID, DUOC_ID, NGUONDUOC_ID from TT_DUOC_TONKHO        where KHODUOC_ID in (32) and DUOC_ID in (1) group by KHODUOC_ID, DUOC_ID, NGUONDUOC_ID        ) A        where A.KHODUOC_ID in (32) and A.DUOC_ID in (1)        group by LTRIM(A.KHODUOC_ID) + '_' + LTRIM(A.DUOC_ID) + '_' + LTRIM(A.NGUONDUOC_ID), A.KHODUOC_ID, A.DUOC_ID, A.NGUONDUOC_ID)        TT_TONKHO on TT_TONKHO.DUOC_ID = TM_DUOC.DUOC_ID        LEFT JOIN TM_NGUONHANG NG ON NG.NGUONDUOC_ID = TT_TONKHO.NGUONDUOC_ID        LEFT JOIN TM_KHODUOC KD ON KD.KHODUOC_ID = TT_TONKHO.KHODUOC_ID        where TM_DUOC.BENHVIEN_ID = 'HLU01' and TM_DUOC.DUOC_ID in (1)]
2019-09-20 16:59:11,994 [1] DEBUG - Statement Id: [DAO00030_GetListPhamViByKhoDuoc] PreparedStatement : [SELECT DISTINCT PHAMVI_ID          FROM TM_DUOC_PHAMVISD_MAPPING          WHERE          KHODUOC_ID IN (32)          AND BENHVIEN_ID ='HLU01'          AND TAMNGUNG = '0']
2019-09-20 16:59:12,036 [1] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoVaBookingCOM23] PreparedStatement : [declare @NGUONDUOC_MACDINH varchar(5) = '0';        declare @TOAMUANGOAI int = 0;        select @NGUONDUOC_MACDINH = isnull(VALUE,0) from TM_SYS_APPSETTINGS where CODE = 'PHA_NGUONDUOC'        select @TOAMUANGOAI = isnull(VALUE,0) from TM_SYS_APPSETTINGS where CODE = 'OPD_TOAMUANGOAI_DUNGDANHMUC_DUOC'                if @TOAMUANGOAI = 1        begin        select  distinct '0' + '_' + LTRIM(d.DUOC_ID) + '_' + @NGUONDUOC_MACDINH as DUOC_KEY, 0 as PHAMVI_ID, @NGUONDUOC_MACDINH as NGUONDUOC_ID, null as TENNGUONDUOC, null as TINHTIEN, d.DUOC_ID, ld.MALOAIDUOC,        d.SOVISA,d.TYLE_VAT,d.COTOA, d.MADUOC, d.TENHANG, d.TENDUOCDAYDU, dvt.TENDONVITINH as DONVITINH, d.BHYT,        d.TENHOATCHAT, d.HAMLUONG, d.HANGSANXUAT, d.QUOCGIA, d.LOAIDUOC_ID, d.DUONGDUNG_ID, d.TINHTIEN_PTTT,        ten.TENDUOC, ten.TENDUOC_EN, ten.MAQUOCTE, ten.MAQUOCTEBT,        '' as BHYT_TEXT        , ld.LOAIVATTU_ID        , d.BENHVIEN_ID,        999999999 as SOLUONG, d.VTYT_PHANLOAI, d.PHAMVI, d.SUASOLUONGTONGHOP, d.MADUOCBV, d.DANGTRINHBAY        , TAMNGUNG = CASE WHEN d.TAMNGUNG = '1' THEN '1' ELSE '0' END        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        where d.DUOC_ID in (1)        union all        select  distinct tk.DUOC_KEY, LTRIM(tk.PHAMVI_ID) as PHAMVI_ID, tk.NGUONDUOC_ID, nh.TENNGUONDUOC, nh.TINHTIEN, d.DUOC_ID, ld.MALOAIDUOC,        d.SOVISA,d.TYLE_VAT,d.COTOA, d.MADUOC, d.TENHANG, d.TENDUOCDAYDU, dvt.TENDONVITINH as DONVITINH, d.BHYT,        d.TENHOATCHAT, d.HAMLUONG, d.HANGSANXUAT, d.QUOCGIA, d.LOAIDUOC_ID, d.DUONGDUNG_ID, d.TINHTIEN_PTTT,        ten.TENDUOC, ten.TENDUOC_EN, ten.MAQUOCTE, ten.MAQUOCTEBT,        CASE WHEN d.BHYT = '1' THEN 'BHYT' ELSE '' END as BHYT_TEXT        , ld.LOAIVATTU_ID        , d.BENHVIEN_ID,        tk.SOLUONG, d.VTYT_PHANLOAI, d.PHAMVI, d.SUASOLUONGTONGHOP, d.MADUOCBV, d.DANGTRINHBAY        , TAMNGUNG = CASE WHEN d.TAMNGUNG = '1' OR nh.TAMNGUNG = '1' OR kd.TAMNGUNG = '1' THEN '1' ELSE '0' END        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        inner join        (        select  LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')) DUOC_KEY, (SUM(dtk.SOLUONG) - isnull(sum(A.SOLUONG),0) - isnull(sum(B.SOLUONG),0)) SOLUONG, pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        from (select sum(soluong) soluong,duoc_id,nguonduoc_id,khoduoc_id,benhvien_id from TT_DUOC_TONKHO  group by duoc_id,nguonduoc_id,khoduoc_id,benhvien_id) dtk        inner join TM_DUOC_PHAMVISD_MAPPING pvsd on dtk.KHODUOC_ID = pvsd.KHODUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NOITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) B on B.DUOC_ID = dtk.DUOC_ID and B.SOLUONG > 0 and B.PHAMVI_ID = pvsd.PHAMVI_ID and B.NGUONHANG_ID = dtk.NGUONDUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NGOAITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) A on A.DUOC_ID = dtk.DUOC_ID and A.SOLUONG > 0 and A.PHAMVI_ID = pvsd.PHAMVI_ID and A.NGUONHANG_ID = dtk.NGUONDUOC_ID        where dtk.SOLUONG > 0 and dtk.BENHVIEN_ID = 'HLU01'        group by LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')), pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        ) tk on tk.DUOC_ID = d.DUOC_ID        left join TM_DUOC_PHAMVISUDUNG kd on kd.PHAMVI_ID = tk.PHAMVI_ID and kd.BENHVIEN_ID = 'HLU01'        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = tk.NGUONDUOC_ID and nh.BENHVIEN_ID = 'HLU01'        where  d.BENHVIEN_ID = 'HLU01' and d.DUOC_ID in (1) and TK.PHAMVI_ID in (1055)        and tk.NGUONDUOC_ID in (1)         end        else        begin                select  distinct tk.DUOC_KEY, LTRIM(tk.PHAMVI_ID) as PHAMVI_ID, tk.NGUONDUOC_ID, nh.TENNGUONDUOC, nh.TINHTIEN, d.DUOC_ID, ld.MALOAIDUOC,        d.SOVISA,d.TYLE_VAT,d.COTOA, d.MADUOC, d.TENHANG, d.TENDUOCDAYDU, dvt.TENDONVITINH as DONVITINH, d.BHYT,        d.TENHOATCHAT, d.HAMLUONG, d.HANGSANXUAT, d.QUOCGIA, d.LOAIDUOC_ID, d.DUONGDUNG_ID, d.TINHTIEN_PTTT,        ten.TENDUOC, ten.TENDUOC_EN, ten.MAQUOCTE, ten.MAQUOCTEBT,        CASE WHEN d.BHYT = '1' THEN 'BHYT' ELSE '' END as BHYT_TEXT        , ld.LOAIVATTU_ID        , d.BENHVIEN_ID,        tk.SOLUONG, d.VTYT_PHANLOAI, d.PHAMVI, d.SUASOLUONGTONGHOP, d.MADUOCBV, d.DANGTRINHBAY        , TAMNGUNG = CASE WHEN d.TAMNGUNG = '1' OR nh.TAMNGUNG = '1' OR kd.TAMNGUNG = '1' THEN '1' ELSE '0' END        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        inner join        (        select  LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')) DUOC_KEY, (SUM(dtk.SOLUONG) - isnull(sum(A.SOLUONG),0) - isnull(sum(B.SOLUONG),0)) SOLUONG, pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        from (select sum(soluong) soluong,duoc_id,nguonduoc_id,khoduoc_id,benhvien_id from TT_DUOC_TONKHO  group by duoc_id,nguonduoc_id,khoduoc_id,benhvien_id) dtk        inner join TM_DUOC_PHAMVISD_MAPPING pvsd on dtk.KHODUOC_ID = pvsd.KHODUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NOITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) B on B.DUOC_ID = dtk.DUOC_ID and B.SOLUONG > 0 and B.PHAMVI_ID = pvsd.PHAMVI_ID and B.NGUONHANG_ID = dtk.NGUONDUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NGOAITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) A on A.DUOC_ID = dtk.DUOC_ID and A.SOLUONG > 0 and A.PHAMVI_ID = pvsd.PHAMVI_ID and A.NGUONHANG_ID = dtk.NGUONDUOC_ID        where dtk.SOLUONG > 0 and dtk.BENHVIEN_ID = 'HLU01'        group by LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')), pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        ) tk on tk.DUOC_ID = d.DUOC_ID        left join TM_DUOC_PHAMVISUDUNG kd on kd.PHAMVI_ID = tk.PHAMVI_ID and kd.BENHVIEN_ID = 'HLU01'        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = tk.NGUONDUOC_ID and nh.BENHVIEN_ID = 'HLU01'        where  d.BENHVIEN_ID = 'HLU01' and d.DUOC_ID in (1) and TK.PHAMVI_ID in (1055)        and tk.NGUONDUOC_ID in (1)         end]
2019-09-20 16:59:12,229 [1] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoCOM18UpdateRedis] PreparedStatement : [select distinct TT_TONKHO.DUOC_KEY, LTRIM(TT_TONKHO.KHODUOC_ID) as KHODUOC_ID, TM_DUOC.DUOC_ID, TM_LOAIDUOC.MALOAIDUOC,TM_DUOC.SOVISA,TM_DUOC.TYLE_VAT,TM_DUOC.COTOA,        TM_DUOC.MADUOC, TM_DUOC.TENHANG, TM_DUOC.TENDUOCDAYDU, dvt.TENDONVITINH as DONVITINH,  TM_DUOC.DONVITINH_ID,TM_DUOC.BHYT,        TM_DUOC.TENHOATCHAT,        TM_DUOC.HAMLUONG, TM_DUOC.HANGSANXUAT, TM_DUOC.QUOCGIA, TM_DUOC.LOAIDUOC_ID, TM_DUOC.DUONGDUNG_ID,        TM_TENDUOC.TENDUOC, TM_TENDUOC.TENDUOC_EN, TM_TENDUOC.MAQUOCTE, TM_TENDUOC.MAQUOCTEBT,        TM_LOAIDUOC.LOAIVATTU_ID, TM_DUOC.BENHVIEN_ID,        TT_TONKHO.SOLUONG, TM_DUOC.VTYT_PHANLOAI, TM_DUOC.PHAMVI, TT_TONKHO.NGUONDUOC_ID, NG.TENNGUONDUOC AS TENNGUONDUOC        , TAMNGUNG = CASE WHEN TM_DUOC.TAMNGUNG = '1' OR NG.TAMNGUNG = '1' OR KD.TAMNGUNG = '1' THEN '1' ELSE '0' END        , TM_DUOC.DANGTRINHBAY        from TM_DUOC        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = TM_DUOC.DONVITINH_ID        left join TM_TENDUOC on TM_DUOC.TENDUOC_ID = TM_TENDUOC.TENDUOC_ID and TM_DUOC.BENHVIEN_ID = 'HLU01' and TM_DUOC.TAMNGUNG = '0'        left join TM_LOAIDUOC on TM_LOAIDUOC.LOAIDUOC_ID = TM_DUOC.LOAIDUOC_ID and TM_LOAIDUOC.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG on (TM_LOAIDUOC.LOAIVATTU_ID = TM_DUOC_HANDUNG.LOAIDUOC and TM_DUOC_HANDUNG.BENHVIEN_ID = 'HLU01')        inner join        (select LTRIM(A.KHODUOC_ID) + '_' + LTRIM(A.DUOC_ID) + '_' + LTRIM(ISNULL(A.NGUONDUOC_ID,'')) as DUOC_KEY, A.KHODUOC_ID, A.DUOC_ID, A.NGUONDUOC_ID,        SUM(isnull(A.SOLUONG,0)) as SOLUONG        from        (select SUM(SOLUONG) as SOLUONG, KHODUOC_ID, DUOC_ID, NGUONDUOC_ID from TT_DUOC_TONKHO        where BENHVIEN_ID = 'HLU01' group by KHODUOC_ID, DUOC_ID, NGUONDUOC_ID) A        group by LTRIM(A.KHODUOC_ID) + '_' + LTRIM(A.DUOC_ID) + '_' + LTRIM(ISNULL(A.NGUONDUOC_ID,'')), A.KHODUOC_ID, A.DUOC_ID, NGUONDUOC_ID        ) TT_TONKHO on TT_TONKHO.DUOC_ID = TM_DUOC.DUOC_ID        LEFT JOIN TM_NGUONHANG NG ON NG.NGUONDUOC_ID = TT_TONKHO.NGUONDUOC_ID        LEFT JOIN TM_KHODUOC KD ON KD.KHODUOC_ID = TT_TONKHO.KHODUOC_ID        where TM_DUOC.BENHVIEN_ID = 'HLU01' and TT_TONKHO.SOLUONG >= 0        and TM_DUOC.DUOC_ID in (1)]
2019-09-20 16:59:12,284 [1] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoVaBookingCOM23UpdateRedis] PreparedStatement : [declare @NGUONDUOC_MACDINH varchar(5) = '0';        declare @TOAMUANGOAI int = 0;        select @NGUONDUOC_MACDINH = isnull(VALUE,0) from TM_SYS_APPSETTINGS where CODE = 'PHA_NGUONDUOC'        select @TOAMUANGOAI = isnull(VALUE,0) from TM_SYS_APPSETTINGS where CODE = 'OPD_TOAMUANGOAI_DUNGDANHMUC_DUOC'                if @TOAMUANGOAI = 1        begin        select  distinct '0' + '_' + LTRIM(d.DUOC_ID) + '_' + @NGUONDUOC_MACDINH as DUOC_KEY, 0 as PHAMVI_ID, @NGUONDUOC_MACDINH as NGUONDUOC_ID, null as TENNGUONDUOC, null as TINHTIEN, d.DUOC_ID, ld.MALOAIDUOC,        d.SOVISA,d.TYLE_VAT,d.COTOA, d.MADUOC, d.TENHANG, d.TENDUOCDAYDU, dvt.TENDONVITINH as DONVITINH, d.BHYT,        d.TENHOATCHAT, d.HAMLUONG, d.HANGSANXUAT, d.QUOCGIA, d.LOAIDUOC_ID, d.DUONGDUNG_ID, d.TINHTIEN_PTTT,        ten.TENDUOC, ten.TENDUOC_EN, ten.MAQUOCTE, ten.MAQUOCTEBT,        '' as BHYT_TEXT        , ld.LOAIVATTU_ID        , d.BENHVIEN_ID,        999999999 as SOLUONG, d.VTYT_PHANLOAI, d.PHAMVI, d.SUASOLUONGTONGHOP, d.MADUOCBV, d.DANGTRINHBAY        , TAMNGUNG = CASE WHEN d.TAMNGUNG = '1' THEN '1' ELSE '0' END        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        where d.DUOC_ID in (1)        union all        select  distinct tk.DUOC_KEY, LTRIM(tk.PHAMVI_ID) as PHAMVI_ID, tk.NGUONDUOC_ID, nh.TENNGUONDUOC, nh.TINHTIEN, d.DUOC_ID, ld.MALOAIDUOC,        d.SOVISA,d.TYLE_VAT,d.COTOA, d.MADUOC, d.TENHANG, d.TENDUOCDAYDU, dvt.TENDONVITINH as DONVITINH, d.BHYT,        d.TENHOATCHAT, d.HAMLUONG, d.HANGSANXUAT, d.QUOCGIA, d.LOAIDUOC_ID, d.DUONGDUNG_ID, d.TINHTIEN_PTTT,        ten.TENDUOC, ten.TENDUOC_EN, ten.MAQUOCTE, ten.MAQUOCTEBT,        CASE WHEN d.BHYT = '1' THEN 'BHYT' ELSE '' END as BHYT_TEXT        , ld.LOAIVATTU_ID        , d.BENHVIEN_ID,        tk.SOLUONG, d.VTYT_PHANLOAI, d.PHAMVI, d.SUASOLUONGTONGHOP, d.MADUOCBV, d.DANGTRINHBAY        , TAMNGUNG = CASE WHEN d.TAMNGUNG = '1' OR nh.TAMNGUNG = '1' OR kd.TAMNGUNG = '1' THEN '1' ELSE '0' END        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        inner join        (        select  LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')) DUOC_KEY, (SUM(dtk.SOLUONG) - isnull(sum(A.SOLUONG),0) - isnull(sum(B.SOLUONG),0)) SOLUONG, pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        from (select sum(soluong) soluong,duoc_id,nguonduoc_id,khoduoc_id,benhvien_id from TT_DUOC_TONKHO  group by duoc_id,nguonduoc_id,khoduoc_id,benhvien_id) dtk        inner join TM_DUOC_PHAMVISD_MAPPING pvsd on dtk.KHODUOC_ID = pvsd.KHODUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NOITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) B on B.DUOC_ID = dtk.DUOC_ID and B.SOLUONG > 0 and B.PHAMVI_ID = pvsd.PHAMVI_ID and B.NGUONHANG_ID = dtk.NGUONDUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NGOAITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) A on A.DUOC_ID = dtk.DUOC_ID and A.SOLUONG > 0 and A.PHAMVI_ID = pvsd.PHAMVI_ID and A.NGUONHANG_ID = dtk.NGUONDUOC_ID        where dtk.SOLUONG > 0 and dtk.BENHVIEN_ID = 'HLU01'        group by LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')), pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        ) tk on tk.DUOC_ID = d.DUOC_ID        left join TM_DUOC_PHAMVISUDUNG kd on kd.PHAMVI_ID = tk.PHAMVI_ID and kd.BENHVIEN_ID = 'HLU01'        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = tk.NGUONDUOC_ID and nh.BENHVIEN_ID = 'HLU01'        where  d.BENHVIEN_ID = 'HLU01' and d.DUOC_ID in (1)        end        else        begin        select  distinct tk.DUOC_KEY, LTRIM(tk.PHAMVI_ID) as PHAMVI_ID, tk.NGUONDUOC_ID, nh.TENNGUONDUOC, nh.TINHTIEN, d.DUOC_ID, ld.MALOAIDUOC,        d.SOVISA,d.TYLE_VAT,d.COTOA, d.MADUOC, d.TENHANG, d.TENDUOCDAYDU, dvt.TENDONVITINH as DONVITINH, d.BHYT,        d.TENHOATCHAT, d.HAMLUONG, d.HANGSANXUAT, d.QUOCGIA, d.LOAIDUOC_ID, d.DUONGDUNG_ID, d.TINHTIEN_PTTT,        ten.TENDUOC, ten.TENDUOC_EN, ten.MAQUOCTE, ten.MAQUOCTEBT,        CASE WHEN d.BHYT = '1' THEN 'BHYT' ELSE '' END as BHYT_TEXT        , ld.LOAIVATTU_ID        , d.BENHVIEN_ID,        tk.SOLUONG, d.VTYT_PHANLOAI, d.PHAMVI, d.SUASOLUONGTONGHOP, d.MADUOCBV, d.DANGTRINHBAY        , TAMNGUNG = CASE WHEN d.TAMNGUNG = '1' OR nh.TAMNGUNG = '1' OR kd.TAMNGUNG = '1' THEN '1' ELSE '0' END        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        inner join        (        select  LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')) DUOC_KEY, (SUM(dtk.SOLUONG) - isnull(sum(A.SOLUONG),0) - isnull(sum(B.SOLUONG),0)) SOLUONG, pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        from (select sum(soluong) soluong,duoc_id,nguonduoc_id,khoduoc_id,benhvien_id from TT_DUOC_TONKHO  group by duoc_id,nguonduoc_id,khoduoc_id,benhvien_id) dtk        inner join TM_DUOC_PHAMVISD_MAPPING pvsd on dtk.KHODUOC_ID = pvsd.KHODUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NOITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) B on B.DUOC_ID = dtk.DUOC_ID and B.SOLUONG > 0 and B.PHAMVI_ID = pvsd.PHAMVI_ID and B.NGUONHANG_ID = dtk.NGUONDUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NGOAITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) A on A.DUOC_ID = dtk.DUOC_ID and A.SOLUONG > 0 and A.PHAMVI_ID = pvsd.PHAMVI_ID and A.NGUONHANG_ID = dtk.NGUONDUOC_ID        where dtk.SOLUONG > 0 and dtk.BENHVIEN_ID = 'HLU01'        group by LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')), pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        ) tk on tk.DUOC_ID = d.DUOC_ID        left join TM_DUOC_PHAMVISUDUNG kd on kd.PHAMVI_ID = tk.PHAMVI_ID and kd.BENHVIEN_ID = 'HLU01'        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = tk.NGUONDUOC_ID and nh.BENHVIEN_ID = 'HLU01'        where  d.BENHVIEN_ID = 'HLU01' and d.DUOC_ID in (1)        end]
2019-09-20 16:59:12,536 [1] DEBUG - Statement Id: [DAO00083_GetList_PhieuGhiNhanVTYT] PreparedStatement : [select DICHVU_GHINHANVTYT_ID, SOPHIEU, KHAMBENH_ID, TIEPNHAN_ID, DVYEUCAU_ID        from TT_DICHVU_GHINHANVTYT        where TIEPNHAN_ID = '27478'        and BENHVIEN_ID = 'HLU01'         and           KHAMBENH_ID = '26173'         and           DVYEUCAU_ID = '205443'                 order by THOIGIANGHINHAN desc]
2019-09-20 16:59:12,584 [1] DEBUG - Statement Id: [DAO00083_GetDSVTYTGhiNhan] PreparedStatement : [select A.*, dc.TENDUOCDAYDU, dc.BHYT DUOC_BHYT, ld.LOAIVATTU_ID, dc.DONVITINH        from TT_NGOAITRU_KHAMBENH_VTYT A        left join TM_DUOC dc on A.DUOC_ID = dc.DUOC_ID        left join TM_LOAIDUOC ld on dc.LOAIDUOC_ID = ld.LOAIDUOC_ID        where A.DVYEUCAU_ID =  @param0          and           A.DICHVU_GHINHANVTYT_ID = '4918'                 order by A.KHAMBENH_VTYT_ID]
2019-09-20 16:59:12,584 [1] DEBUG - Statement Id: [DAO00083_GetDSVTYTGhiNhan] Parameters: [@param0=[DVYEUCAU_ID,205443]]
2019-09-20 16:59:12,584 [1] DEBUG - Statement Id: [DAO00083_GetDSVTYTGhiNhan] Types: [@param0=[Int64, System.Int64]]
2019-09-20 16:59:12,615 [1] DEBUG - Statement Id: [DAO00063_GetSoChungTuByChungTuID] PreparedStatement : [select MACHUNGTU as SOCHUNGTU        from TT_DUOC_CHUNGTU        where CHUNGTU_ID  = '137703']
2019-09-20 16:59:12,650 [1] DEBUG - Statement Id: [DAO00023_GetTTVienPhiThuoc] PreparedStatement : [select *        from TT_VIENPHI        where REF_ID = '10593'        and REF_TABLE = 'TT_NGOAITRU_KHAMBENH_VTYT']
2019-09-20 16:59:12,708 [1] DEBUG - Statement Id: [DAO00066_GetBENHAN_TIEPNHAN] PreparedStatement : [select top 1 *        from TT_NOITRU_BENHAN        where TIEPNHAN_ID = '27478'  and BENHVIEN_ID = 'HLU01'        order by NGAYTAO desc]
2019-09-20 16:59:49,820 [1] DEBUG - Statement Id: [DAO00030_KTDaPhatSinhBienLai] PreparedStatement : [SELECT CHUNGTU_ID            FROM TT_NOITRU_TOATHUOC tt            INNER JOIN TT_VIENPHI vp on (tt.TOATHUOC_ID = vp.REF_ID and REF_TABLE = 'TT_NOITRU_TOATHUOC')            WHERE            CHUNGTU_ID = '137702'            AND tt.BENHVIEN_ID = 'HLU01'            AND HOADON_ID is not NULL            AND vp.HUY = '0'              union all            SELECT  kbtt.CHUNGTUPHATTHUOC_ID as CHUNGTU_ID            FROM TT_NGOAITRU_TOATHUOC tt            INNER JOIN TT_NGOAITRU_KHAMBENH_TOATHUOC kbtt on (kbtt.KHAMBENH_TOATHUOC_ID = tt.KHAMBENH_TOATHUOC_ID)            INNER JOIN TT_VIENPHI vp on (tt.TOATHUOC_ID = vp.REF_ID and REF_TABLE = 'TT_NGOAITRU_TOATHUOC')            WHERE            kbtt.CHUNGTUPHATTHUOC_ID = '137702'            AND tt.BENHVIEN_ID = 'HLU01'            AND HOADON_ID is not NULL            AND vp.HUY = '0'              union all            SELECT ctct.CHUNGTU_ID from            TT_DUOC_CHUNGTU_CHITIET ctct            INNER JOIN TT_HOADON_CHITIET_NGOAITRU hdct on (hdct.REF_ID = ctct.CHUNGTUCHITIET_ID and hdct.REF_TABLE = 'TT_DUOC_CHUNGTU_CHITIET')            INNER JOIN TT_HOADON hd on hd.HOADON_ID = hdct.HOADON_ID            WHERE            ctct.CHUNGTU_ID = '137702'                            AND hd.HUYHOADON = '0'              AND hd.HOANTRA = '0'                                  AND ctct.BENHVIEN_ID = 'HLU01'                        union all            SELECT CHUNGTU_ID            FROM TT_NGOAITRU_KHAMBENH_VTYT tt            INNER JOIN TT_VIENPHI vp on (tt.KHAMBENH_VTYT_ID = vp.REF_ID and REF_TABLE = 'TT_NGOAITRU_KHAMBENH_VTYT')            WHERE            CHUNGTU_ID = '137702'            AND tt.BENHVIEN_ID = 'HLU01'            AND HOADON_ID is not NULL            AND vp.HUY = '0'                        union all            SELECT CHUNGTU_ID            FROM TT_PHAUTHUAT_VTYT tt            INNER JOIN TT_VIENPHI vp on (tt.PHAUTHUAT_VTYT_ID = vp.REF_ID and REF_TABLE = 'TT_PHAUTHUAT_VTYT')            WHERE            CHUNGTU_ID = '137702'            AND tt.BENHVIEN_ID = 'HLU01'            AND HOADON_ID is not NULL            AND vp.HUY = '0'                        union all            SELECT CHUNGTU_ID            FROM TT_CLSKETQUA_VTYT tt            INNER JOIN TT_VIENPHI vp on (tt.CLSKETQUA_VTYT_ID = vp.REF_ID and REF_TABLE = 'TT_CLSKETQUA_VTYT')            WHERE            CHUNGTU_ID = '137702'            AND tt.BENHVIEN_ID = 'HLU01'            AND HOADON_ID is not NULL            AND vp.HUY = '0']
2019-09-20 16:59:50,127 [1] DEBUG - Statement Id: [DAO00030_KTDaPhatSinhPhieuBHTN] PreparedStatement : [SELECT vp.VIENPHI_ID              FROM TT_VIENPHI vp              INNER JOIN TT_MIENGIAM_CHITIET  mgct on mgct.VIENPHI_ID = vp.VIENPHI_ID              INNER JOIN TT_DUOC_CHUNGTU ct on ct.TIEPNHAN_ID = vp.TIEPNHAN_ID              WHERE              ct.CHUNGTU_ID = '137702'              AND vp.DUOC_ID is not null              AND vp.BENHVIEN_ID = 'HLU01']
2019-09-20 16:59:50,224 [1] DEBUG - Statement Id: [DAO00030_KiemTraBenhNhanXuatVien] PreparedStatement : [select              TT.TOATHUOC_ID              from              TT_NOITRU_TOATHUOC TT              inner join TT_NOITRU_KHAMBENH KB on TT.KHAMBENH_ID = KB.KHAMBENH_ID              inner join TT_NOITRU_BENHAN BA on BA.BENHAN_ID = KB.BENHAN_ID              WHERE              BA.TRANGTHAI = 'DAXUATVIEN'              AND TT.CHUNGTU_ID =  137702              and TT.BENHVIEN_ID = 'HLU01']
2019-09-20 16:59:50,400 [1] DEBUG - Statement Id: [DAO00030_KiemTraChungTuKhoaSo] PreparedStatement : [SELECT CHUNGTU_ID              FROM TT_DUOC_CHUNGTU              WHERE              MACHUNGTU = 'CS_KBX1319003090'              and BENHVIEN_ID = 'HLU01'              and              convert(date, NGAYCHUNGTU) <=              (              SELECT TOP 1 convert(date, KHOADENNGAY)              FROM TT_DUOC_KHOASOCHUNGTU              WHERE              KHODUOC_ID = '32'              and BENHVIEN_ID = 'HLU01'              AND KHOASO = '1'              ORDER BY KHOADENNGAY DESC              )]
2019-09-20 16:59:50,444 [1] DEBUG - Statement Id: [DAO00030_KiemTraChungTuKhoaSo] PreparedStatement : [SELECT CHUNGTU_ID              FROM TT_DUOC_CHUNGTU              WHERE              MACHUNGTU = 'CS_KBX1319003090'              and BENHVIEN_ID = 'HLU01'              and              convert(date, NGAYCHUNGTU) <=              (              SELECT TOP 1 convert(date, KHOADENNGAY)              FROM TT_DUOC_KHOASOCHUNGTU              WHERE              KHODUOC_ID = '32'              and BENHVIEN_ID = 'HLU01'              AND KHOASO = '1'              ORDER BY KHOADENNGAY DESC              )]
2019-09-20 16:59:50,481 [1] DEBUG - Statement Id: [DAO00030_KiemTraChungTuDaChuyenKeToan] PreparedStatement : [SELECT CHUNGTU_ID            FROM TT_DUOC_CHUNGTU            WHERE            CHUNGTU_ID = '137702'            and IDCHUYEN IS NOT NULL            and BENHVIEN_ID = 'HLU01']
2019-09-20 16:59:50,511 [1] DEBUG - Statement Id: [DAO00030_KTDaPhatSinhBienLai] PreparedStatement : [SELECT CHUNGTU_ID            FROM TT_NOITRU_TOATHUOC tt            INNER JOIN TT_VIENPHI vp on (tt.TOATHUOC_ID = vp.REF_ID and REF_TABLE = 'TT_NOITRU_TOATHUOC')            WHERE            CHUNGTU_ID = '137702'            AND tt.BENHVIEN_ID = 'HLU01'            AND HOADON_ID is not NULL            AND vp.HUY = '0'              union all            SELECT  kbtt.CHUNGTUPHATTHUOC_ID as CHUNGTU_ID            FROM TT_NGOAITRU_TOATHUOC tt            INNER JOIN TT_NGOAITRU_KHAMBENH_TOATHUOC kbtt on (kbtt.KHAMBENH_TOATHUOC_ID = tt.KHAMBENH_TOATHUOC_ID)            INNER JOIN TT_VIENPHI vp on (tt.TOATHUOC_ID = vp.REF_ID and REF_TABLE = 'TT_NGOAITRU_TOATHUOC')            WHERE            kbtt.CHUNGTUPHATTHUOC_ID = '137702'            AND tt.BENHVIEN_ID = 'HLU01'            AND HOADON_ID is not NULL            AND vp.HUY = '0'              union all            SELECT ctct.CHUNGTU_ID from            TT_DUOC_CHUNGTU_CHITIET ctct            INNER JOIN TT_HOADON_CHITIET_NGOAITRU hdct on (hdct.REF_ID = ctct.CHUNGTUCHITIET_ID and hdct.REF_TABLE = 'TT_DUOC_CHUNGTU_CHITIET')            INNER JOIN TT_HOADON hd on hd.HOADON_ID = hdct.HOADON_ID            WHERE            ctct.CHUNGTU_ID = '137702'                            AND hd.HUYHOADON = '0'              AND hd.HOANTRA = '0'                                  AND ctct.BENHVIEN_ID = 'HLU01'                        union all            SELECT CHUNGTU_ID            FROM TT_NGOAITRU_KHAMBENH_VTYT tt            INNER JOIN TT_VIENPHI vp on (tt.KHAMBENH_VTYT_ID = vp.REF_ID and REF_TABLE = 'TT_NGOAITRU_KHAMBENH_VTYT')            WHERE            CHUNGTU_ID = '137702'            AND tt.BENHVIEN_ID = 'HLU01'            AND HOADON_ID is not NULL            AND vp.HUY = '0'                        union all            SELECT CHUNGTU_ID            FROM TT_PHAUTHUAT_VTYT tt            INNER JOIN TT_VIENPHI vp on (tt.PHAUTHUAT_VTYT_ID = vp.REF_ID and REF_TABLE = 'TT_PHAUTHUAT_VTYT')            WHERE            CHUNGTU_ID = '137702'            AND tt.BENHVIEN_ID = 'HLU01'            AND HOADON_ID is not NULL            AND vp.HUY = '0'                        union all            SELECT CHUNGTU_ID            FROM TT_CLSKETQUA_VTYT tt            INNER JOIN TT_VIENPHI vp on (tt.CLSKETQUA_VTYT_ID = vp.REF_ID and REF_TABLE = 'TT_CLSKETQUA_VTYT')            WHERE            CHUNGTU_ID = '137702'            AND tt.BENHVIEN_ID = 'HLU01'            AND HOADON_ID is not NULL            AND vp.HUY = '0']
2019-09-20 16:59:51,658 [1] DEBUG - Statement Id: [DAO00030_KiemTraBenhNhanXuatVien] PreparedStatement : [select              TT.TOATHUOC_ID              from              TT_NOITRU_TOATHUOC TT              inner join TT_NOITRU_KHAMBENH KB on TT.KHAMBENH_ID = KB.KHAMBENH_ID              inner join TT_NOITRU_BENHAN BA on BA.BENHAN_ID = KB.BENHAN_ID              WHERE              BA.TRANGTHAI = 'DAXUATVIEN'              AND TT.CHUNGTU_ID =  137702              and TT.BENHVIEN_ID = 'HLU01']
2019-09-20 16:59:51,839 [1] DEBUG - Statement Id: [DAO00030_DUOCTONKHO_GetSoTonTheoDuocTheoLo] PreparedStatement : [SELECT              DUOC_ID,SOLONHAP_ID,              SUM(SOLUONG) AS SOLUONGTONLO              FROM              TT_DUOC_TONKHO              WHERE              KHODUOC_ID = '32'              and BENHVIEN_ID = 'HLU01'              and DUOC_ID IN (1)              and SOLONHAP_ID IN (7541)              GROUP BY DUOC_ID, SOLONHAP_ID]
2019-09-20 16:59:51,871 [1] DEBUG - Statement Id: [DAO00030_LayNgayKhoaSoCuoi] PreparedStatement : [SELECT TOP 1 KHOADENNGAY              FROM TT_DUOC_KHOASOCHUNGTU              WHERE              KHODUOC_ID = '32'              and BENHVIEN_ID = 'HLU01'              and KHOASO = '1'              ORDER BY KHOADENNGAY DESC]
2019-09-20 16:59:52,021 [1] DEBUG - Statement Id: [DAO00030_GetList] PreparedStatement : [select *              from TT_DUOC_CHUNGTU              where BENHVIEN_ID = 'HLU01'                and                   TT_DUOC_CHUNGTU.MACHUNGTU = 'CS_KBX1319003090'                               order by CHUNGTU_ID]
2019-09-20 16:59:52,212 [1] DEBUG - Statement Id: [DAO00030_KiemTraBenhNhanXuatVien] PreparedStatement : [select              TT.TOATHUOC_ID              from              TT_NOITRU_TOATHUOC TT              inner join TT_NOITRU_KHAMBENH KB on TT.KHAMBENH_ID = KB.KHAMBENH_ID              inner join TT_NOITRU_BENHAN BA on BA.BENHAN_ID = KB.BENHAN_ID              WHERE              BA.TRANGTHAI = 'DAXUATVIEN'              AND TT.CHUNGTU_ID =  137702              and TT.BENHVIEN_ID = 'HLU01']
2019-09-20 16:59:52,390 [1] DEBUG - Statement Id: [DAO00030_Update] PreparedStatement : [update TT_DUOC_CHUNGTU set              NGAYCHUNGTU =  @param0               , LOAICHUNGTU =  @param1               , MUCDICHCHUNGTU_ID =  @param2               , MUCDICHCHUNGTU_CODE =  @param3               , KHOXUAT_ID =  @param4               , NGUOIGIAO_ID =  @param5               , NGUOIGIAO =  @param6               , KHONHAP_ID =  @param7               , NGUOINHAN_ID =  @param8               , NGUOINHAN =  @param9               , NGUOIKIEMTRA_ID =  @param10               , NGUOIKIEMTRA =  @param11               , NGUOIDUYET_ID =  @param12               , NGUOIDUYET =  @param13               , PHUONGPHAPXUAT =  @param14               , KETOANTRUONG_ID =  @param15               , KETOANTRUONG =  @param16               , THUKHO_ID =  @param17               , THUKHO =  @param18               , MAUHOADON =  @param19               , SOHOADON =  @param20               , SOSERI =  @param21               , NGAYHOADON =  @param22               , DIENGIAI =  @param23               , GIATRI =  @param24               , GIATRITHANHTOAN =  @param25               , TYLEVAT =  @param26               , GIATRIVAT =  @param27               , THUESUAT =  @param28               , GIATRITHUE =  @param29               , TYLECHIETKHAU =  @param30               , GIATRICHIETKHAU =  @param31               , TIENTE_ID =  @param32               , TYGIA =  @param33               , SOCHUNGTUGOC =  @param34               , NGAYCHUNGTUGOC =  @param35               , NHACUNGCAP_ID =  @param36               , HINHTHUCTHANHTOAN_ID =  @param37               , NGUONDUOC_ID =  @param38               , CHUNGTULIENQUAN_ID =  @param39               , KHAMBENH_ID =  @param40               , TOATHUOCNOITRU_ID =  @param41               , TIEPNHAN_ID =  @param42               , BENHAN_ID =  @param43               , DANHANTHUOC =  @param44               , NGUOINHAP_ID =  @param45               , NGAYNHAP =  @param46               , TRANGTHAI =  @param47               , PHIEULINH_ID =  @param48               , LOAITOATHUOC =  @param49               , DIENGIAINGHIEPVUPHATSINH =  @param50               , DONVIGIAO_ID =  @param51               , KHOSUDUNG_ID =  @param52               , LOAIVATTU_ID =  @param53               , BENHNHAN_ID =  @param54               , TENBENHNHAN =  @param55               , BACSIGIOITHIEU_ID =  @param56               , DOITUONG_ID =  @param57               , IDCHUYEN =  @param58               , CHUNGTUKETOAN =  @param59               , STATUS =  @param60               , TRANSFER_VIENPHI_ID =  @param61               , PHONGBAN_ID =  @param62               , BACSI_ID =  @param63               , TKNO =  @param64               , TKCO =  @param65               , MACHUNGTUREF =  @param66               , LOAICHUNGTUREF =  @param67               , PHIEULINHCANTRU_ID =  @param68               , KHOTHUCHIEN_ID =  @param69               , KHODOIUNG_ID =  @param70               , MENU_LOAIDUOC_ID =  @param71               , NGUOISUDUNGMAY_ID =  @param72               , GOITHAU_ID =  @param73               , XUATTHUOCBANGOAITRU =  @param74               , NGAYGIOCHUNGTU =  @param75               , NOIDAKHAM =  @param76               , HOIDONGKIEMNHAP_ID =  @param77               , HOIDONGTHANHLY_ID =  @param78               , CHUYENCHUNGTUID =  @param79               , CHUYENDOANHTHUID =  @param80               , LYDOXUATSUDUNG_ID =  @param81                         , NGAYCAPNHAT =  @param82               , NGUOICAPNHAT_ID =  @param83               where              CHUNGTU_ID = '137702']
2019-09-20 16:59:52,390 [1] DEBUG - Statement Id: [DAO00030_Update] Parameters: [@param0=[NGAYCHUNGTU,9/20/2019 4:52:51 PM], @param1=[LOAICHUNGTU,X], @param2=[MUCDICHCHUNGTU_ID,1060], @param3=[MUCDICHCHUNGTU_CODE,X13], @param4=[KHOXUAT_ID,32], @param5=[NGUOIGIAO_ID,0], @param6=[NGUOIGIAO,null], @param7=[KHONHAP_ID,null], @param8=[NGUOINHAN_ID,null], @param9=[NGUOINHAN,null], @param10=[NGUOIKIEMTRA_ID,null], @param11=[NGUOIKIEMTRA,null], @param12=[NGUOIDUYET_ID,null], @param13=[NGUOIDUYET,null], @param14=[PHUONGPHAPXUAT,0], @param15=[KETOANTRUONG_ID,null], @param16=[KETOANTRUONG,null], @param17=[THUKHO_ID,null], @param18=[THUKHO,null], @param19=[MAUHOADON,null], @param20=[SOHOADON,null], @param21=[SOSERI,null], @param22=[NGAYHOADON,null], @param23=[DIENGIAI,null], @param24=[GIATRI,null], @param25=[GIATRITHANHTOAN,null], @param26=[TYLEVAT,5], @param27=[GIATRIVAT,0], @param28=[THUESUAT,null], @param29=[GIATRITHUE,null], @param30=[TYLECHIETKHAU,null], @param31=[GIATRICHIETKHAU,null], @param32=[TIENTE_ID,null], @param33=[TYGIA,null], @param34=[SOCHUNGTUGOC,null], @param35=[NGAYCHUNGTUGOC,null], @param36=[NHACUNGCAP_ID,null], @param37=[HINHTHUCTHANHTOAN_ID,null], @param38=[NGUONDUOC_ID,null], @param39=[CHUNGTULIENQUAN_ID,null], @param40=[KHAMBENH_ID,null], @param41=[TOATHUOCNOITRU_ID,null], @param42=[TIEPNHAN_ID,null], @param43=[BENHAN_ID,null], @param44=[DANHANTHUOC, ], @param45=[NGUOINHAP_ID,null], @param46=[NGAYNHAP,null], @param47=[TRANGTHAI,DAXUAT], @param48=[PHIEULINH_ID,null], @param49=[LOAITOATHUOC,null], @param50=[DIENGIAINGHIEPVUPHATSINH,null], @param51=[DONVIGIAO_ID,null], @param52=[KHOSUDUNG_ID,null], @param53=[LOAIVATTU_ID,null], @param54=[BENHNHAN_ID,null], @param55=[TENBENHNHAN,null], @param56=[BACSIGIOITHIEU_ID,null], @param57=[DOITUONG_ID,null], @param58=[IDCHUYEN,null], @param59=[CHUNGTUKETOAN,null], @param60=[STATUS,null], @param61=[TRANSFER_VIENPHI_ID,null], @param62=[PHONGBAN_ID,62], @param63=[BACSI_ID,null], @param64=[TKNO,null], @param65=[TKCO,null], @param66=[MACHUNGTUREF,null], @param67=[LOAICHUNGTUREF,null], @param68=[PHIEULINHCANTRU_ID,null], @param69=[KHOTHUCHIEN_ID,null], @param70=[KHODOIUNG_ID,null], @param71=[MENU_LOAIDUOC_ID,null], @param72=[NGUOISUDUNGMAY_ID,null], @param73=[GOITHAU_ID,null], @param74=[XUATTHUOCBANGOAITRU,null], @param75=[NGAYGIOCHUNGTU,null], @param76=[NOIDAKHAM,null], @param77=[HOIDONGKIEMNHAP_ID,null], @param78=[HOIDONGTHANHLY_ID,null], @param79=[CHUYENCHUNGTUID,null], @param80=[CHUYENDOANHTHUID,null], @param81=[LYDOXUATSUDUNG_ID,8294], @param82=[NGAYCAPNHAT,9/20/2019 4:59:52 PM], @param83=[NGUOICAPNHAT_ID,0]]
2019-09-20 16:59:52,390 [1] DEBUG - Statement Id: [DAO00030_Update] Types: [@param0=[DateTime, System.DateTime], @param1=[String, System.String], @param2=[Int64, System.Int64], @param3=[String, System.String], @param4=[Int64, System.Int64], @param5=[Int64, System.Int64], @param6=[System.DBNull, null], @param7=[System.DBNull, null], @param8=[System.DBNull, null], @param9=[System.DBNull, null], @param10=[System.DBNull, null], @param11=[System.DBNull, null], @param12=[System.DBNull, null], @param13=[System.DBNull, null], @param14=[Int64, System.Int64], @param15=[System.DBNull, null], @param16=[System.DBNull, null], @param17=[System.DBNull, null], @param18=[System.DBNull, null], @param19=[System.DBNull, null], @param20=[System.DBNull, null], @param21=[System.DBNull, null], @param22=[System.DBNull, null], @param23=[System.DBNull, null], @param24=[System.DBNull, null], @param25=[System.DBNull, null], @param26=[Double, System.Double], @param27=[Double, System.Double], @param28=[System.DBNull, null], @param29=[System.DBNull, null], @param30=[System.DBNull, null], @param31=[System.DBNull, null], @param32=[System.DBNull, null], @param33=[System.DBNull, null], @param34=[System.DBNull, null], @param35=[System.DBNull, null], @param36=[System.DBNull, null], @param37=[System.DBNull, null], @param38=[System.DBNull, null], @param39=[System.DBNull, null], @param40=[System.DBNull, null], @param41=[System.DBNull, null], @param42=[System.DBNull, null], @param43=[System.DBNull, null], @param44=[String, System.String], @param45=[System.DBNull, null], @param46=[System.DBNull, null], @param47=[String, System.String], @param48=[System.DBNull, null], @param49=[System.DBNull, null], @param50=[System.DBNull, null], @param51=[System.DBNull, null], @param52=[System.DBNull, null], @param53=[System.DBNull, null], @param54=[System.DBNull, null], @param55=[System.DBNull, null], @param56=[System.DBNull, null], @param57=[System.DBNull, null], @param58=[System.DBNull, null], @param59=[System.DBNull, null], @param60=[System.DBNull, null], @param61=[System.DBNull, null], @param62=[Int64, System.Int64], @param63=[System.DBNull, null], @param64=[System.DBNull, null], @param65=[System.DBNull, null], @param66=[System.DBNull, null], @param67=[System.DBNull, null], @param68=[System.DBNull, null], @param69=[System.DBNull, null], @param70=[System.DBNull, null], @param71=[System.DBNull, null], @param72=[System.DBNull, null], @param73=[System.DBNull, null], @param74=[System.DBNull, null], @param75=[System.DBNull, null], @param76=[System.DBNull, null], @param77=[System.DBNull, null], @param78=[System.DBNull, null], @param79=[System.DBNull, null], @param80=[System.DBNull, null], @param81=[Int64, System.Int64], @param82=[DateTime, System.DateTime], @param83=[Int64, System.Int64]]
2019-09-20 16:59:52,548 [1] DEBUG - Statement Id: [DAO00030_CHUNGTUCT_DeleteP] PreparedStatement : [delete from TT_DUOC_CHUNGTU_CHITIET               where                             TT_DUOC_CHUNGTU_CHITIET.CHUNGTU_ID = '137702']
2019-09-20 16:59:52,579 [1] DEBUG - Statement Id: [DAO00030_TT_DUOC_TONKHO_LOG_Add] PreparedStatement : [DECLARE @KHODUOC_ID int               DECLARE @TONTRUOC numeric(18, 4)               DECLARE @TONSAU numeric(18, 4)               DECLARE @SOLUONGNHAP numeric(18, 4)               DECLARE @SOLUONGXUAT numeric(18, 4)                              IF( @param0  = 'N')               BEGIN                SET @KHODUOC_ID =  @param1                END               ELSE               BEGIN                 SET @KHODUOC_ID =  @param2                END                              SELECT @TONTRUOC = SOLUONG FROM TT_DUOC_TONKHO WHERE KHODUOC_ID = @KHODUOC_ID  AND DUOC_ID =  @param3  AND SOLONHAP_ID =  @param4  AND NGUONDUOC_ID =  @param5                               IF( @param0  = 'N' AND  @param6  = 'ADD')               BEGIN                SET @TONSAU = ISNULL(@TONTRUOC,0) +  @param7                 SET @SOLUONGNHAP =  @param7                 SET @SOLUONGXUAT = 0               END               IF( @param0  = 'N' AND  @param6  = 'DEL')               BEGIN                SET @TONSAU = ISNULL(@TONTRUOC,0) -  @param7                 SET @SOLUONGXUAT =  @param7                 SET @SOLUONGNHAP = 0               END                                         IF( @param0  = 'X' AND  @param6  = 'ADD')               BEGIN                SET @TONSAU = ISNULL(@TONTRUOC,0) -  @param8                 SET @SOLUONGXUAT =  @param8                 SET @SOLUONGNHAP = 0               END               IF( @param0  = 'X' AND  @param6  = 'DEL')               BEGIN                SET @TONSAU = ISNULL(@TONTRUOC,0) +  @param8                 SET @SOLUONGNHAP =  @param8                 SET @SOLUONGXUAT = 0                             END                        insert into TT_DUOC_TONKHO_LOG (                           CHUNGTUCHITIET_ID              ,CHUNGTU_ID              ,MACHUNGTU              ,LOAICHUNGTU              ,MUCDICHCHUNGTU_CODE              ,KHONHAP_ID              ,KHOXUAT_ID              ,DUOC_ID              ,SOLONHAP_ID              ,NGUONDUOC_ID              ,SOLUONGNHAP              ,SOLUONGXUAT              ,DONGIAMUA              ,DONGIAVON              ,TYLE_VAT              ,DONGIAVONVAT              ,TONTRUOC              ,TONSAU              ,ACTION              ,BENHVIEN_ID              ,NGAYTAO              ,NGUOITAO_ID                          ) values (              @param9               , @param10               , @param11               , @param0               , @param12               , @param1               , @param2               , @param3               , @param4               , @param5               ,@SOLUONGNHAP              ,@SOLUONGXUAT              , @param13               , @param14               , @param15               , @param16               ,@TONTRUOC              ,@TONSAU              , @param6               , @param17               , @param18               , @param19               )]
2019-09-20 16:59:52,579 [1] DEBUG - Statement Id: [DAO00030_TT_DUOC_TONKHO_LOG_Add] Parameters: [@param0=[LOAICHUNGTU,X], @param1=[KHONHAP_ID,null], @param2=[KHOXUAT_ID,32], @param3=[DUOC_ID,1], @param4=[SOLONHAP_ID,7541], @param5=[NGUONDUOC_ID,1], @param6=[ACTION,DEL], @param7=[SOLUONGNHAP,0], @param8=[SOLUONGXUAT,2], @param9=[CHUNGTUCHITIET_ID,1299045], @param10=[CHUNGTU_ID,137702], @param11=[MACHUNGTU,CS_KBX1319003090], @param12=[MUCDICHCHUNGTU_CODE,X13], @param13=[DONGIAMUA,945], @param14=[DONGIAVON,945], @param15=[TYLE_VAT,0], @param16=[DONGIAVONVAT,945], @param17=[BENHVIEN_ID,HLU01], @param18=[NGAYTAO,9/20/2019 4:59:52 PM], @param19=[NGUOITAO_ID,0]]
2019-09-20 16:59:52,579 [1] DEBUG - Statement Id: [DAO00030_TT_DUOC_TONKHO_LOG_Add] Types: [@param0=[String, System.String], @param1=[System.DBNull, null], @param2=[Int64, System.Int64], @param3=[Int64, System.Int64], @param4=[Int64, System.Int64], @param5=[Int64, System.Int64], @param6=[String, System.String], @param7=[Decimal, System.Decimal], @param8=[Decimal, System.Decimal], @param9=[Int64, System.Int64], @param10=[Int64, System.Int64], @param11=[String, System.String], @param12=[String, System.String], @param13=[Decimal, System.Decimal], @param14=[Decimal, System.Decimal], @param15=[Double, System.Double], @param16=[Double, System.Double], @param17=[String, System.String], @param18=[DateTime, System.DateTime], @param19=[Int64, System.Int64]]
2019-09-20 16:59:52,615 [1] DEBUG - Statement Id: [DAO00030_DUOC_TONKHO_BOOKING_NGOAITRU_Tang] PreparedStatement : [update TT_DUOC_TONKHO_BOOK_NGOAITRU            set            SOLUONG = SOLUONG +  @param0             , NGUOICAPNHAT_ID =  @param1             , NGAYCAPNHAT = getdate()            where            REF_TABLE =  @param2             AND REF_ID =  @param3             AND KHODUOC_ID =  @param4             AND DUOC_ID =  @param5             AND SOLUONG = 0            AND BENHVIEN_ID = 'HLU01']
2019-09-20 16:59:52,615 [1] DEBUG - Statement Id: [DAO00030_DUOC_TONKHO_BOOKING_NGOAITRU_Tang] Parameters: [@param0=[SOLUONGTHAYDOI,2], @param1=[NGUOICAPNHAT_ID,0], @param2=[REF_TABLE,TT_NGOAITRU_KHAMBENH_VTYT], @param3=[REF_ID,10593], @param4=[KHODUOC_ID,32], @param5=[DUOC_ID,1]]
2019-09-20 16:59:52,615 [1] DEBUG - Statement Id: [DAO00030_DUOC_TONKHO_BOOKING_NGOAITRU_Tang] Types: [@param0=[Double, System.Double], @param1=[Int64, System.Int64], @param2=[String, System.String], @param3=[Int64, System.Int64], @param4=[Int64, System.Int64], @param5=[Int64, System.Int64]]
2019-09-20 16:59:52,681 [1] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoVaBookingCOM23UpdateRedis] PreparedStatement : [declare @NGUONDUOC_MACDINH varchar(5) = '0';        declare @TOAMUANGOAI int = 0;        select @NGUONDUOC_MACDINH = isnull(VALUE,0) from TM_SYS_APPSETTINGS where CODE = 'PHA_NGUONDUOC'        select @TOAMUANGOAI = isnull(VALUE,0) from TM_SYS_APPSETTINGS where CODE = 'OPD_TOAMUANGOAI_DUNGDANHMUC_DUOC'                if @TOAMUANGOAI = 1        begin        select  distinct '0' + '_' + LTRIM(d.DUOC_ID) + '_' + @NGUONDUOC_MACDINH as DUOC_KEY, 0 as PHAMVI_ID, @NGUONDUOC_MACDINH as NGUONDUOC_ID, null as TENNGUONDUOC, null as TINHTIEN, d.DUOC_ID, ld.MALOAIDUOC,        d.SOVISA,d.TYLE_VAT,d.COTOA, d.MADUOC, d.TENHANG, d.TENDUOCDAYDU, dvt.TENDONVITINH as DONVITINH, d.BHYT,        d.TENHOATCHAT, d.HAMLUONG, d.HANGSANXUAT, d.QUOCGIA, d.LOAIDUOC_ID, d.DUONGDUNG_ID, d.TINHTIEN_PTTT,        ten.TENDUOC, ten.TENDUOC_EN, ten.MAQUOCTE, ten.MAQUOCTEBT,        '' as BHYT_TEXT        , ld.LOAIVATTU_ID        , d.BENHVIEN_ID,        999999999 as SOLUONG, d.VTYT_PHANLOAI, d.PHAMVI, d.SUASOLUONGTONGHOP, d.MADUOCBV, d.DANGTRINHBAY        , TAMNGUNG = CASE WHEN d.TAMNGUNG = '1' THEN '1' ELSE '0' END        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        where d.DUOC_ID in (1)        union all        select  distinct tk.DUOC_KEY, LTRIM(tk.PHAMVI_ID) as PHAMVI_ID, tk.NGUONDUOC_ID, nh.TENNGUONDUOC, nh.TINHTIEN, d.DUOC_ID, ld.MALOAIDUOC,        d.SOVISA,d.TYLE_VAT,d.COTOA, d.MADUOC, d.TENHANG, d.TENDUOCDAYDU, dvt.TENDONVITINH as DONVITINH, d.BHYT,        d.TENHOATCHAT, d.HAMLUONG, d.HANGSANXUAT, d.QUOCGIA, d.LOAIDUOC_ID, d.DUONGDUNG_ID, d.TINHTIEN_PTTT,        ten.TENDUOC, ten.TENDUOC_EN, ten.MAQUOCTE, ten.MAQUOCTEBT,        CASE WHEN d.BHYT = '1' THEN 'BHYT' ELSE '' END as BHYT_TEXT        , ld.LOAIVATTU_ID        , d.BENHVIEN_ID,        tk.SOLUONG, d.VTYT_PHANLOAI, d.PHAMVI, d.SUASOLUONGTONGHOP, d.MADUOCBV, d.DANGTRINHBAY        , TAMNGUNG = CASE WHEN d.TAMNGUNG = '1' OR nh.TAMNGUNG = '1' OR kd.TAMNGUNG = '1' THEN '1' ELSE '0' END        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        inner join        (        select  LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')) DUOC_KEY, (SUM(dtk.SOLUONG) - isnull(sum(A.SOLUONG),0) - isnull(sum(B.SOLUONG),0)) SOLUONG, pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        from (select sum(soluong) soluong,duoc_id,nguonduoc_id,khoduoc_id,benhvien_id from TT_DUOC_TONKHO  group by duoc_id,nguonduoc_id,khoduoc_id,benhvien_id) dtk        inner join TM_DUOC_PHAMVISD_MAPPING pvsd on dtk.KHODUOC_ID = pvsd.KHODUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NOITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) B on B.DUOC_ID = dtk.DUOC_ID and B.SOLUONG > 0 and B.PHAMVI_ID = pvsd.PHAMVI_ID and B.NGUONHANG_ID = dtk.NGUONDUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NGOAITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) A on A.DUOC_ID = dtk.DUOC_ID and A.SOLUONG > 0 and A.PHAMVI_ID = pvsd.PHAMVI_ID and A.NGUONHANG_ID = dtk.NGUONDUOC_ID        where dtk.SOLUONG > 0 and dtk.BENHVIEN_ID = 'HLU01'        group by LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')), pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        ) tk on tk.DUOC_ID = d.DUOC_ID        left join TM_DUOC_PHAMVISUDUNG kd on kd.PHAMVI_ID = tk.PHAMVI_ID and kd.BENHVIEN_ID = 'HLU01'        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = tk.NGUONDUOC_ID and nh.BENHVIEN_ID = 'HLU01'        where  d.BENHVIEN_ID = 'HLU01' and d.DUOC_ID in (1)        end        else        begin        select  distinct tk.DUOC_KEY, LTRIM(tk.PHAMVI_ID) as PHAMVI_ID, tk.NGUONDUOC_ID, nh.TENNGUONDUOC, nh.TINHTIEN, d.DUOC_ID, ld.MALOAIDUOC,        d.SOVISA,d.TYLE_VAT,d.COTOA, d.MADUOC, d.TENHANG, d.TENDUOCDAYDU, dvt.TENDONVITINH as DONVITINH, d.BHYT,        d.TENHOATCHAT, d.HAMLUONG, d.HANGSANXUAT, d.QUOCGIA, d.LOAIDUOC_ID, d.DUONGDUNG_ID, d.TINHTIEN_PTTT,        ten.TENDUOC, ten.TENDUOC_EN, ten.MAQUOCTE, ten.MAQUOCTEBT,        CASE WHEN d.BHYT = '1' THEN 'BHYT' ELSE '' END as BHYT_TEXT        , ld.LOAIVATTU_ID        , d.BENHVIEN_ID,        tk.SOLUONG, d.VTYT_PHANLOAI, d.PHAMVI, d.SUASOLUONGTONGHOP, d.MADUOCBV, d.DANGTRINHBAY        , TAMNGUNG = CASE WHEN d.TAMNGUNG = '1' OR nh.TAMNGUNG = '1' OR kd.TAMNGUNG = '1' THEN '1' ELSE '0' END        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        inner join        (        select  LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')) DUOC_KEY, (SUM(dtk.SOLUONG) - isnull(sum(A.SOLUONG),0) - isnull(sum(B.SOLUONG),0)) SOLUONG, pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        from (select sum(soluong) soluong,duoc_id,nguonduoc_id,khoduoc_id,benhvien_id from TT_DUOC_TONKHO  group by duoc_id,nguonduoc_id,khoduoc_id,benhvien_id) dtk        inner join TM_DUOC_PHAMVISD_MAPPING pvsd on dtk.KHODUOC_ID = pvsd.KHODUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NOITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) B on B.DUOC_ID = dtk.DUOC_ID and B.SOLUONG > 0 and B.PHAMVI_ID = pvsd.PHAMVI_ID and B.NGUONHANG_ID = dtk.NGUONDUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NGOAITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) A on A.DUOC_ID = dtk.DUOC_ID and A.SOLUONG > 0 and A.PHAMVI_ID = pvsd.PHAMVI_ID and A.NGUONHANG_ID = dtk.NGUONDUOC_ID        where dtk.SOLUONG > 0 and dtk.BENHVIEN_ID = 'HLU01'        group by LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')), pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        ) tk on tk.DUOC_ID = d.DUOC_ID        left join TM_DUOC_PHAMVISUDUNG kd on kd.PHAMVI_ID = tk.PHAMVI_ID and kd.BENHVIEN_ID = 'HLU01'        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = tk.NGUONDUOC_ID and nh.BENHVIEN_ID = 'HLU01'        where  d.BENHVIEN_ID = 'HLU01' and d.DUOC_ID in (1)        end]
2019-09-20 16:59:52,945 [1] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoCOM18UpdateRedis] PreparedStatement : [select distinct TT_TONKHO.DUOC_KEY, LTRIM(TT_TONKHO.KHODUOC_ID) as KHODUOC_ID, TM_DUOC.DUOC_ID, TM_LOAIDUOC.MALOAIDUOC,TM_DUOC.SOVISA,TM_DUOC.TYLE_VAT,TM_DUOC.COTOA,        TM_DUOC.MADUOC, TM_DUOC.TENHANG, TM_DUOC.TENDUOCDAYDU, dvt.TENDONVITINH as DONVITINH,  TM_DUOC.DONVITINH_ID,TM_DUOC.BHYT,        TM_DUOC.TENHOATCHAT,        TM_DUOC.HAMLUONG, TM_DUOC.HANGSANXUAT, TM_DUOC.QUOCGIA, TM_DUOC.LOAIDUOC_ID, TM_DUOC.DUONGDUNG_ID,        TM_TENDUOC.TENDUOC, TM_TENDUOC.TENDUOC_EN, TM_TENDUOC.MAQUOCTE, TM_TENDUOC.MAQUOCTEBT,        TM_LOAIDUOC.LOAIVATTU_ID, TM_DUOC.BENHVIEN_ID,        TT_TONKHO.SOLUONG, TM_DUOC.VTYT_PHANLOAI, TM_DUOC.PHAMVI, TT_TONKHO.NGUONDUOC_ID, NG.TENNGUONDUOC AS TENNGUONDUOC        , TAMNGUNG = CASE WHEN TM_DUOC.TAMNGUNG = '1' OR NG.TAMNGUNG = '1' OR KD.TAMNGUNG = '1' THEN '1' ELSE '0' END        , TM_DUOC.DANGTRINHBAY        from TM_DUOC        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = TM_DUOC.DONVITINH_ID        left join TM_TENDUOC on TM_DUOC.TENDUOC_ID = TM_TENDUOC.TENDUOC_ID and TM_DUOC.BENHVIEN_ID = 'HLU01' and TM_DUOC.TAMNGUNG = '0'        left join TM_LOAIDUOC on TM_LOAIDUOC.LOAIDUOC_ID = TM_DUOC.LOAIDUOC_ID and TM_LOAIDUOC.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG on (TM_LOAIDUOC.LOAIVATTU_ID = TM_DUOC_HANDUNG.LOAIDUOC and TM_DUOC_HANDUNG.BENHVIEN_ID = 'HLU01')        inner join        (select LTRIM(A.KHODUOC_ID) + '_' + LTRIM(A.DUOC_ID) + '_' + LTRIM(ISNULL(A.NGUONDUOC_ID,'')) as DUOC_KEY, A.KHODUOC_ID, A.DUOC_ID, A.NGUONDUOC_ID,        SUM(isnull(A.SOLUONG,0)) as SOLUONG        from        (select SUM(SOLUONG) as SOLUONG, KHODUOC_ID, DUOC_ID, NGUONDUOC_ID from TT_DUOC_TONKHO        where BENHVIEN_ID = 'HLU01' group by KHODUOC_ID, DUOC_ID, NGUONDUOC_ID) A        group by LTRIM(A.KHODUOC_ID) + '_' + LTRIM(A.DUOC_ID) + '_' + LTRIM(ISNULL(A.NGUONDUOC_ID,'')), A.KHODUOC_ID, A.DUOC_ID, NGUONDUOC_ID        ) TT_TONKHO on TT_TONKHO.DUOC_ID = TM_DUOC.DUOC_ID        LEFT JOIN TM_NGUONHANG NG ON NG.NGUONDUOC_ID = TT_TONKHO.NGUONDUOC_ID        LEFT JOIN TM_KHODUOC KD ON KD.KHODUOC_ID = TT_TONKHO.KHODUOC_ID        where TM_DUOC.BENHVIEN_ID = 'HLU01' and TT_TONKHO.SOLUONG >= 0        and TM_DUOC.DUOC_ID in (1)]
2019-09-20 16:59:53,027 [1] DEBUG - Statement Id: [DAO00030_DUOCTONKHO_Tang] PreparedStatement : [IF EXISTS            (              SELECT DUOCTONKHO_ID              FROM TT_DUOC_TONKHO              WHERE              KHODUOC_ID =  @param0               AND DUOC_ID =  @param1               AND  SOLONHAP_ID =  @param2             )            BEGIN              update TT_DUOC_TONKHO set              SOLUONG = SOLUONG +   @param3               , NGAYCAPNHAT =  @param4               , NGUOICAPNHAT_ID =  @param5               where              KHODUOC_ID =  @param0               AND DUOC_ID =  @param1               AND  SOLONHAP_ID =  @param2             END            ELSE            BEGIN              insert into TT_DUOC_TONKHO (              KHODUOC_ID              , DUOC_ID              , NGUONDUOC_ID              , SOLONHAP_ID              , DONGIAMUA              , SOLUONG              , BENHVIEN_ID              , NGAYTAO              , NGUOITAO_ID                     ) values (               @param0               ,  @param1               ,  @param6               ,  @param2               ,  @param7               ,  @param3               ,  @param8               ,  @param9               ,  @param10                        )            END]
2019-09-20 16:59:53,027 [1] DEBUG - Statement Id: [DAO00030_DUOCTONKHO_Tang] Parameters: [@param0=[KHODUOC_ID,32], @param1=[DUOC_ID,1], @param2=[SOLONHAP_ID,7541], @param3=[SOLUONGTHAYDOI,2], @param4=[NGAYCAPNHAT,9/20/2019 4:59:53 PM], @param5=[NGUOICAPNHAT_ID,0], @param6=[NGUONDUOC_ID,1], @param7=[DONGIAMUA,945], @param8=[BENHVIEN_ID,HLU01], @param9=[NGAYTAO,9/20/2019 4:52:51 PM], @param10=[NGUOITAO_ID,0]]
2019-09-20 16:59:53,027 [1] DEBUG - Statement Id: [DAO00030_DUOCTONKHO_Tang] Types: [@param0=[Int64, System.Int64], @param1=[Int64, System.Int64], @param2=[Int64, System.Int64], @param3=[Double, System.Double], @param4=[DateTime, System.DateTime], @param5=[Int64, System.Int64], @param6=[Int64, System.Int64], @param7=[Double, System.Double], @param8=[String, System.String], @param9=[DateTime, System.DateTime], @param10=[Int64, System.Int64]]
2019-09-20 16:59:53,076 [1] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoCOM18] PreparedStatement : [select  distinct TT_TONKHO.DUOC_KEY, LTRIM(TT_TONKHO.KHODUOC_ID) as KHODUOC_ID, TM_DUOC.DUOC_ID, TM_LOAIDUOC.MALOAIDUOC,TM_DUOC.SOVISA,TM_DUOC.TYLE_VAT,TM_DUOC.COTOA,        TM_DUOC.MADUOC, TM_DUOC.TENHANG, TM_DUOC.TENDUOCDAYDU, dvt.TENDONVITINH as DONVITINH, TM_DUOC.DONVITINH_ID, TM_DUOC.BHYT,        TM_DUOC.TENHOATCHAT, TM_DUOC.HAMLUONG, TM_DUOC.HANGSANXUAT, TM_DUOC.QUOCGIA, TM_DUOC.LOAIDUOC_ID, TM_DUOC.DUONGDUNG_ID,        TM_TENDUOC.TENDUOC, TM_TENDUOC.TENDUOC_EN, TM_TENDUOC.MAQUOCTE, TM_TENDUOC.MAQUOCTEBT,        TM_LOAIDUOC.LOAIVATTU_ID, TM_DUOC.BENHVIEN_ID,        TT_TONKHO.SOLUONG, TM_DUOC.VTYT_PHANLOAI, TM_DUOC.PHAMVI, TT_TONKHO.NGUONDUOC_ID, NG.TENNGUONDUOC        , TAMNGUNG = CASE WHEN TM_DUOC.TAMNGUNG = '1' OR NG.TAMNGUNG = '1' OR KD.TAMNGUNG = '1' THEN '1' ELSE '0' END        , TM_DUOC.DANGTRINHBAY        from TM_DUOC        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = TM_DUOC.DONVITINH_ID        left join TM_TENDUOC on TM_DUOC.TENDUOC_ID = TM_TENDUOC.TENDUOC_ID and TM_DUOC.BENHVIEN_ID = 'HLU01'  and TM_DUOC.TAMNGUNG = '0'        left join TM_LOAIDUOC on TM_LOAIDUOC.LOAIDUOC_ID = TM_DUOC.LOAIDUOC_ID and TM_LOAIDUOC.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG on (TM_LOAIDUOC.LOAIVATTU_ID = TM_DUOC_HANDUNG.LOAIDUOC and TM_DUOC_HANDUNG.BENHVIEN_ID = 'HLU01')        inner join        (select LTRIM(A.KHODUOC_ID) + '_' + LTRIM(A.DUOC_ID) + '_' + LTRIM(ISNULL(A.NGUONDUOC_ID,'')) as DUOC_KEY, A.KHODUOC_ID, A.DUOC_ID ,a.NGUONDUOC_ID,        SUM(isnull(A.SOLUONG,0)) as SOLUONG        from        (select SUM(SOLUONG) as SOLUONG, KHODUOC_ID, DUOC_ID, NGUONDUOC_ID from TT_DUOC_TONKHO        where KHODUOC_ID in (32) and DUOC_ID in (1) group by KHODUOC_ID, DUOC_ID, NGUONDUOC_ID        ) A        where A.KHODUOC_ID in (32) and A.DUOC_ID in (1)        group by LTRIM(A.KHODUOC_ID) + '_' + LTRIM(A.DUOC_ID) + '_' + LTRIM(A.NGUONDUOC_ID), A.KHODUOC_ID, A.DUOC_ID, A.NGUONDUOC_ID)        TT_TONKHO on TT_TONKHO.DUOC_ID = TM_DUOC.DUOC_ID        LEFT JOIN TM_NGUONHANG NG ON NG.NGUONDUOC_ID = TT_TONKHO.NGUONDUOC_ID        LEFT JOIN TM_KHODUOC KD ON KD.KHODUOC_ID = TT_TONKHO.KHODUOC_ID        where TM_DUOC.BENHVIEN_ID = 'HLU01' and TM_DUOC.DUOC_ID in (1)]
2019-09-20 16:59:53,128 [1] DEBUG - Statement Id: [DAO00030_GetListPhamViByKhoDuoc] PreparedStatement : [SELECT DISTINCT PHAMVI_ID          FROM TM_DUOC_PHAMVISD_MAPPING          WHERE          KHODUOC_ID IN (32)          AND BENHVIEN_ID ='HLU01'          AND TAMNGUNG = '0']
2019-09-20 16:59:53,177 [1] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoVaBookingCOM23] PreparedStatement : [declare @NGUONDUOC_MACDINH varchar(5) = '0';        declare @TOAMUANGOAI int = 0;        select @NGUONDUOC_MACDINH = isnull(VALUE,0) from TM_SYS_APPSETTINGS where CODE = 'PHA_NGUONDUOC'        select @TOAMUANGOAI = isnull(VALUE,0) from TM_SYS_APPSETTINGS where CODE = 'OPD_TOAMUANGOAI_DUNGDANHMUC_DUOC'                if @TOAMUANGOAI = 1        begin        select  distinct '0' + '_' + LTRIM(d.DUOC_ID) + '_' + @NGUONDUOC_MACDINH as DUOC_KEY, 0 as PHAMVI_ID, @NGUONDUOC_MACDINH as NGUONDUOC_ID, null as TENNGUONDUOC, null as TINHTIEN, d.DUOC_ID, ld.MALOAIDUOC,        d.SOVISA,d.TYLE_VAT,d.COTOA, d.MADUOC, d.TENHANG, d.TENDUOCDAYDU, dvt.TENDONVITINH as DONVITINH, d.BHYT,        d.TENHOATCHAT, d.HAMLUONG, d.HANGSANXUAT, d.QUOCGIA, d.LOAIDUOC_ID, d.DUONGDUNG_ID, d.TINHTIEN_PTTT,        ten.TENDUOC, ten.TENDUOC_EN, ten.MAQUOCTE, ten.MAQUOCTEBT,        '' as BHYT_TEXT        , ld.LOAIVATTU_ID        , d.BENHVIEN_ID,        999999999 as SOLUONG, d.VTYT_PHANLOAI, d.PHAMVI, d.SUASOLUONGTONGHOP, d.MADUOCBV, d.DANGTRINHBAY        , TAMNGUNG = CASE WHEN d.TAMNGUNG = '1' THEN '1' ELSE '0' END        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        where d.DUOC_ID in (1)        union all        select  distinct tk.DUOC_KEY, LTRIM(tk.PHAMVI_ID) as PHAMVI_ID, tk.NGUONDUOC_ID, nh.TENNGUONDUOC, nh.TINHTIEN, d.DUOC_ID, ld.MALOAIDUOC,        d.SOVISA,d.TYLE_VAT,d.COTOA, d.MADUOC, d.TENHANG, d.TENDUOCDAYDU, dvt.TENDONVITINH as DONVITINH, d.BHYT,        d.TENHOATCHAT, d.HAMLUONG, d.HANGSANXUAT, d.QUOCGIA, d.LOAIDUOC_ID, d.DUONGDUNG_ID, d.TINHTIEN_PTTT,        ten.TENDUOC, ten.TENDUOC_EN, ten.MAQUOCTE, ten.MAQUOCTEBT,        CASE WHEN d.BHYT = '1' THEN 'BHYT' ELSE '' END as BHYT_TEXT        , ld.LOAIVATTU_ID        , d.BENHVIEN_ID,        tk.SOLUONG, d.VTYT_PHANLOAI, d.PHAMVI, d.SUASOLUONGTONGHOP, d.MADUOCBV, d.DANGTRINHBAY        , TAMNGUNG = CASE WHEN d.TAMNGUNG = '1' OR nh.TAMNGUNG = '1' OR kd.TAMNGUNG = '1' THEN '1' ELSE '0' END        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        inner join        (        select  LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')) DUOC_KEY, (SUM(dtk.SOLUONG) - isnull(sum(A.SOLUONG),0) - isnull(sum(B.SOLUONG),0)) SOLUONG, pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        from (select sum(soluong) soluong,duoc_id,nguonduoc_id,khoduoc_id,benhvien_id from TT_DUOC_TONKHO  group by duoc_id,nguonduoc_id,khoduoc_id,benhvien_id) dtk        inner join TM_DUOC_PHAMVISD_MAPPING pvsd on dtk.KHODUOC_ID = pvsd.KHODUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NOITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) B on B.DUOC_ID = dtk.DUOC_ID and B.SOLUONG > 0 and B.PHAMVI_ID = pvsd.PHAMVI_ID and B.NGUONHANG_ID = dtk.NGUONDUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NGOAITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) A on A.DUOC_ID = dtk.DUOC_ID and A.SOLUONG > 0 and A.PHAMVI_ID = pvsd.PHAMVI_ID and A.NGUONHANG_ID = dtk.NGUONDUOC_ID        where dtk.SOLUONG > 0 and dtk.BENHVIEN_ID = 'HLU01'        group by LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')), pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        ) tk on tk.DUOC_ID = d.DUOC_ID        left join TM_DUOC_PHAMVISUDUNG kd on kd.PHAMVI_ID = tk.PHAMVI_ID and kd.BENHVIEN_ID = 'HLU01'        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = tk.NGUONDUOC_ID and nh.BENHVIEN_ID = 'HLU01'        where  d.BENHVIEN_ID = 'HLU01' and d.DUOC_ID in (1) and TK.PHAMVI_ID in (1055)        and tk.NGUONDUOC_ID in (1)         end        else        begin                select  distinct tk.DUOC_KEY, LTRIM(tk.PHAMVI_ID) as PHAMVI_ID, tk.NGUONDUOC_ID, nh.TENNGUONDUOC, nh.TINHTIEN, d.DUOC_ID, ld.MALOAIDUOC,        d.SOVISA,d.TYLE_VAT,d.COTOA, d.MADUOC, d.TENHANG, d.TENDUOCDAYDU, dvt.TENDONVITINH as DONVITINH, d.BHYT,        d.TENHOATCHAT, d.HAMLUONG, d.HANGSANXUAT, d.QUOCGIA, d.LOAIDUOC_ID, d.DUONGDUNG_ID, d.TINHTIEN_PTTT,        ten.TENDUOC, ten.TENDUOC_EN, ten.MAQUOCTE, ten.MAQUOCTEBT,        CASE WHEN d.BHYT = '1' THEN 'BHYT' ELSE '' END as BHYT_TEXT        , ld.LOAIVATTU_ID        , d.BENHVIEN_ID,        tk.SOLUONG, d.VTYT_PHANLOAI, d.PHAMVI, d.SUASOLUONGTONGHOP, d.MADUOCBV, d.DANGTRINHBAY        , TAMNGUNG = CASE WHEN d.TAMNGUNG = '1' OR nh.TAMNGUNG = '1' OR kd.TAMNGUNG = '1' THEN '1' ELSE '0' END        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        inner join        (        select  LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')) DUOC_KEY, (SUM(dtk.SOLUONG) - isnull(sum(A.SOLUONG),0) - isnull(sum(B.SOLUONG),0)) SOLUONG, pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        from (select sum(soluong) soluong,duoc_id,nguonduoc_id,khoduoc_id,benhvien_id from TT_DUOC_TONKHO  group by duoc_id,nguonduoc_id,khoduoc_id,benhvien_id) dtk        inner join TM_DUOC_PHAMVISD_MAPPING pvsd on dtk.KHODUOC_ID = pvsd.KHODUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NOITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) B on B.DUOC_ID = dtk.DUOC_ID and B.SOLUONG > 0 and B.PHAMVI_ID = pvsd.PHAMVI_ID and B.NGUONHANG_ID = dtk.NGUONDUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NGOAITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) A on A.DUOC_ID = dtk.DUOC_ID and A.SOLUONG > 0 and A.PHAMVI_ID = pvsd.PHAMVI_ID and A.NGUONHANG_ID = dtk.NGUONDUOC_ID        where dtk.SOLUONG > 0 and dtk.BENHVIEN_ID = 'HLU01'        group by LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')), pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        ) tk on tk.DUOC_ID = d.DUOC_ID        left join TM_DUOC_PHAMVISUDUNG kd on kd.PHAMVI_ID = tk.PHAMVI_ID and kd.BENHVIEN_ID = 'HLU01'        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = tk.NGUONDUOC_ID and nh.BENHVIEN_ID = 'HLU01'        where  d.BENHVIEN_ID = 'HLU01' and d.DUOC_ID in (1) and TK.PHAMVI_ID in (1055)        and tk.NGUONDUOC_ID in (1)         end]
2019-09-20 16:59:53,344 [1] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoCOM18UpdateRedis] PreparedStatement : [select distinct TT_TONKHO.DUOC_KEY, LTRIM(TT_TONKHO.KHODUOC_ID) as KHODUOC_ID, TM_DUOC.DUOC_ID, TM_LOAIDUOC.MALOAIDUOC,TM_DUOC.SOVISA,TM_DUOC.TYLE_VAT,TM_DUOC.COTOA,        TM_DUOC.MADUOC, TM_DUOC.TENHANG, TM_DUOC.TENDUOCDAYDU, dvt.TENDONVITINH as DONVITINH,  TM_DUOC.DONVITINH_ID,TM_DUOC.BHYT,        TM_DUOC.TENHOATCHAT,        TM_DUOC.HAMLUONG, TM_DUOC.HANGSANXUAT, TM_DUOC.QUOCGIA, TM_DUOC.LOAIDUOC_ID, TM_DUOC.DUONGDUNG_ID,        TM_TENDUOC.TENDUOC, TM_TENDUOC.TENDUOC_EN, TM_TENDUOC.MAQUOCTE, TM_TENDUOC.MAQUOCTEBT,        TM_LOAIDUOC.LOAIVATTU_ID, TM_DUOC.BENHVIEN_ID,        TT_TONKHO.SOLUONG, TM_DUOC.VTYT_PHANLOAI, TM_DUOC.PHAMVI, TT_TONKHO.NGUONDUOC_ID, NG.TENNGUONDUOC AS TENNGUONDUOC        , TAMNGUNG = CASE WHEN TM_DUOC.TAMNGUNG = '1' OR NG.TAMNGUNG = '1' OR KD.TAMNGUNG = '1' THEN '1' ELSE '0' END        , TM_DUOC.DANGTRINHBAY        from TM_DUOC        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = TM_DUOC.DONVITINH_ID        left join TM_TENDUOC on TM_DUOC.TENDUOC_ID = TM_TENDUOC.TENDUOC_ID and TM_DUOC.BENHVIEN_ID = 'HLU01' and TM_DUOC.TAMNGUNG = '0'        left join TM_LOAIDUOC on TM_LOAIDUOC.LOAIDUOC_ID = TM_DUOC.LOAIDUOC_ID and TM_LOAIDUOC.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG on (TM_LOAIDUOC.LOAIVATTU_ID = TM_DUOC_HANDUNG.LOAIDUOC and TM_DUOC_HANDUNG.BENHVIEN_ID = 'HLU01')        inner join        (select LTRIM(A.KHODUOC_ID) + '_' + LTRIM(A.DUOC_ID) + '_' + LTRIM(ISNULL(A.NGUONDUOC_ID,'')) as DUOC_KEY, A.KHODUOC_ID, A.DUOC_ID, A.NGUONDUOC_ID,        SUM(isnull(A.SOLUONG,0)) as SOLUONG        from        (select SUM(SOLUONG) as SOLUONG, KHODUOC_ID, DUOC_ID, NGUONDUOC_ID from TT_DUOC_TONKHO        where BENHVIEN_ID = 'HLU01' group by KHODUOC_ID, DUOC_ID, NGUONDUOC_ID) A        group by LTRIM(A.KHODUOC_ID) + '_' + LTRIM(A.DUOC_ID) + '_' + LTRIM(ISNULL(A.NGUONDUOC_ID,'')), A.KHODUOC_ID, A.DUOC_ID, NGUONDUOC_ID        ) TT_TONKHO on TT_TONKHO.DUOC_ID = TM_DUOC.DUOC_ID        LEFT JOIN TM_NGUONHANG NG ON NG.NGUONDUOC_ID = TT_TONKHO.NGUONDUOC_ID        LEFT JOIN TM_KHODUOC KD ON KD.KHODUOC_ID = TT_TONKHO.KHODUOC_ID        where TM_DUOC.BENHVIEN_ID = 'HLU01' and TT_TONKHO.SOLUONG >= 0        and TM_DUOC.DUOC_ID in (1)]
2019-09-20 16:59:53,478 [1] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoVaBookingCOM23UpdateRedis] PreparedStatement : [declare @NGUONDUOC_MACDINH varchar(5) = '0';        declare @TOAMUANGOAI int = 0;        select @NGUONDUOC_MACDINH = isnull(VALUE,0) from TM_SYS_APPSETTINGS where CODE = 'PHA_NGUONDUOC'        select @TOAMUANGOAI = isnull(VALUE,0) from TM_SYS_APPSETTINGS where CODE = 'OPD_TOAMUANGOAI_DUNGDANHMUC_DUOC'                if @TOAMUANGOAI = 1        begin        select  distinct '0' + '_' + LTRIM(d.DUOC_ID) + '_' + @NGUONDUOC_MACDINH as DUOC_KEY, 0 as PHAMVI_ID, @NGUONDUOC_MACDINH as NGUONDUOC_ID, null as TENNGUONDUOC, null as TINHTIEN, d.DUOC_ID, ld.MALOAIDUOC,        d.SOVISA,d.TYLE_VAT,d.COTOA, d.MADUOC, d.TENHANG, d.TENDUOCDAYDU, dvt.TENDONVITINH as DONVITINH, d.BHYT,        d.TENHOATCHAT, d.HAMLUONG, d.HANGSANXUAT, d.QUOCGIA, d.LOAIDUOC_ID, d.DUONGDUNG_ID, d.TINHTIEN_PTTT,        ten.TENDUOC, ten.TENDUOC_EN, ten.MAQUOCTE, ten.MAQUOCTEBT,        '' as BHYT_TEXT        , ld.LOAIVATTU_ID        , d.BENHVIEN_ID,        999999999 as SOLUONG, d.VTYT_PHANLOAI, d.PHAMVI, d.SUASOLUONGTONGHOP, d.MADUOCBV, d.DANGTRINHBAY        , TAMNGUNG = CASE WHEN d.TAMNGUNG = '1' THEN '1' ELSE '0' END        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        where d.DUOC_ID in (1)        union all        select  distinct tk.DUOC_KEY, LTRIM(tk.PHAMVI_ID) as PHAMVI_ID, tk.NGUONDUOC_ID, nh.TENNGUONDUOC, nh.TINHTIEN, d.DUOC_ID, ld.MALOAIDUOC,        d.SOVISA,d.TYLE_VAT,d.COTOA, d.MADUOC, d.TENHANG, d.TENDUOCDAYDU, dvt.TENDONVITINH as DONVITINH, d.BHYT,        d.TENHOATCHAT, d.HAMLUONG, d.HANGSANXUAT, d.QUOCGIA, d.LOAIDUOC_ID, d.DUONGDUNG_ID, d.TINHTIEN_PTTT,        ten.TENDUOC, ten.TENDUOC_EN, ten.MAQUOCTE, ten.MAQUOCTEBT,        CASE WHEN d.BHYT = '1' THEN 'BHYT' ELSE '' END as BHYT_TEXT        , ld.LOAIVATTU_ID        , d.BENHVIEN_ID,        tk.SOLUONG, d.VTYT_PHANLOAI, d.PHAMVI, d.SUASOLUONGTONGHOP, d.MADUOCBV, d.DANGTRINHBAY        , TAMNGUNG = CASE WHEN d.TAMNGUNG = '1' OR nh.TAMNGUNG = '1' OR kd.TAMNGUNG = '1' THEN '1' ELSE '0' END        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        inner join        (        select  LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')) DUOC_KEY, (SUM(dtk.SOLUONG) - isnull(sum(A.SOLUONG),0) - isnull(sum(B.SOLUONG),0)) SOLUONG, pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        from (select sum(soluong) soluong,duoc_id,nguonduoc_id,khoduoc_id,benhvien_id from TT_DUOC_TONKHO  group by duoc_id,nguonduoc_id,khoduoc_id,benhvien_id) dtk        inner join TM_DUOC_PHAMVISD_MAPPING pvsd on dtk.KHODUOC_ID = pvsd.KHODUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NOITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) B on B.DUOC_ID = dtk.DUOC_ID and B.SOLUONG > 0 and B.PHAMVI_ID = pvsd.PHAMVI_ID and B.NGUONHANG_ID = dtk.NGUONDUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NGOAITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) A on A.DUOC_ID = dtk.DUOC_ID and A.SOLUONG > 0 and A.PHAMVI_ID = pvsd.PHAMVI_ID and A.NGUONHANG_ID = dtk.NGUONDUOC_ID        where dtk.SOLUONG > 0 and dtk.BENHVIEN_ID = 'HLU01'        group by LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')), pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        ) tk on tk.DUOC_ID = d.DUOC_ID        left join TM_DUOC_PHAMVISUDUNG kd on kd.PHAMVI_ID = tk.PHAMVI_ID and kd.BENHVIEN_ID = 'HLU01'        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = tk.NGUONDUOC_ID and nh.BENHVIEN_ID = 'HLU01'        where  d.BENHVIEN_ID = 'HLU01' and d.DUOC_ID in (1)        end        else        begin        select  distinct tk.DUOC_KEY, LTRIM(tk.PHAMVI_ID) as PHAMVI_ID, tk.NGUONDUOC_ID, nh.TENNGUONDUOC, nh.TINHTIEN, d.DUOC_ID, ld.MALOAIDUOC,        d.SOVISA,d.TYLE_VAT,d.COTOA, d.MADUOC, d.TENHANG, d.TENDUOCDAYDU, dvt.TENDONVITINH as DONVITINH, d.BHYT,        d.TENHOATCHAT, d.HAMLUONG, d.HANGSANXUAT, d.QUOCGIA, d.LOAIDUOC_ID, d.DUONGDUNG_ID, d.TINHTIEN_PTTT,        ten.TENDUOC, ten.TENDUOC_EN, ten.MAQUOCTE, ten.MAQUOCTEBT,        CASE WHEN d.BHYT = '1' THEN 'BHYT' ELSE '' END as BHYT_TEXT        , ld.LOAIVATTU_ID        , d.BENHVIEN_ID,        tk.SOLUONG, d.VTYT_PHANLOAI, d.PHAMVI, d.SUASOLUONGTONGHOP, d.MADUOCBV, d.DANGTRINHBAY        , TAMNGUNG = CASE WHEN d.TAMNGUNG = '1' OR nh.TAMNGUNG = '1' OR kd.TAMNGUNG = '1' THEN '1' ELSE '0' END        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        inner join        (        select  LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')) DUOC_KEY, (SUM(dtk.SOLUONG) - isnull(sum(A.SOLUONG),0) - isnull(sum(B.SOLUONG),0)) SOLUONG, pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        from (select sum(soluong) soluong,duoc_id,nguonduoc_id,khoduoc_id,benhvien_id from TT_DUOC_TONKHO  group by duoc_id,nguonduoc_id,khoduoc_id,benhvien_id) dtk        inner join TM_DUOC_PHAMVISD_MAPPING pvsd on dtk.KHODUOC_ID = pvsd.KHODUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NOITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) B on B.DUOC_ID = dtk.DUOC_ID and B.SOLUONG > 0 and B.PHAMVI_ID = pvsd.PHAMVI_ID and B.NGUONHANG_ID = dtk.NGUONDUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NGOAITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) A on A.DUOC_ID = dtk.DUOC_ID and A.SOLUONG > 0 and A.PHAMVI_ID = pvsd.PHAMVI_ID and A.NGUONHANG_ID = dtk.NGUONDUOC_ID        where dtk.SOLUONG > 0 and dtk.BENHVIEN_ID = 'HLU01'        group by LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')), pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        ) tk on tk.DUOC_ID = d.DUOC_ID        left join TM_DUOC_PHAMVISUDUNG kd on kd.PHAMVI_ID = tk.PHAMVI_ID and kd.BENHVIEN_ID = 'HLU01'        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = tk.NGUONDUOC_ID and nh.BENHVIEN_ID = 'HLU01'        where  d.BENHVIEN_ID = 'HLU01' and d.DUOC_ID in (1)        end]
2019-09-20 16:59:53,664 [1] DEBUG - Statement Id: [DAO00030_RemoveChungTuVTYTNgoaiTru] PreparedStatement : [update TT_NGOAITRU_KHAMBENH_VTYT set            CHUNGTU_ID = null,            TRANGTHAI = null            where            CHUNGTU_ID =   @param0               update TT_VIENPHI set            DUYET = '0',            DATHUCHIEN = '0'            where            REF_TABLE = 'TT_NGOAITRU_KHAMBENH_VTYT'            AND REF_ID IN (10593)]
2019-09-20 16:59:53,664 [1] DEBUG - Statement Id: [DAO00030_RemoveChungTuVTYTNgoaiTru] Parameters: [@param0=[CHUNGTU_ID,137702]]
2019-09-20 16:59:53,664 [1] DEBUG - Statement Id: [DAO00030_RemoveChungTuVTYTNgoaiTru] Types: [@param0=[Int64, System.Int64]]
2019-09-20 16:59:53,704 [1] DEBUG - Statement Id: [DAO00030_CHUNGTUCT_Add] PreparedStatement : [insert into TT_DUOC_CHUNGTU_CHITIET (            CHUNGTU_ID            , DUOC_ID            , SOLONHAP_ID            , SOKIEMSOAT            , SOVISA            , HANDUNG            , DONVITINH_ID            , SOLUONGYEUCAU            , SOLUONGTHUCTE            , SOLUONGDAXUAT            , TIENTE_ID            , TYGIA            , DONGIAMUA            , DONGIA_BHYT            , DONGIABAN            , DONGIABAN_VAT            , DONGIAVON            , DONGIATHANHTOAN            , SOQUYEN            , SOHOADONVAT            , TYLEVAT            , GIATRIVAT            , TYLECHIETKHAU            , GIATRICHIETKHAU            , MIENPHI            , LYDOMIENPHI_ID            , SOCHUNGTUKETOAN            , SOCHUNGTUTIENMAT            , TRANGTHAI            , DAPHATSINHPHIEUXUAT            , DAPHATSINHPHIEUHOANTRA            , KHUYENMAI            , PHUONGPHAPXUAT            , DONDATHANG_ID            , GHICHUCHITIET            , NGUONHANG_ID            , DONGIAVONVAT            , THANHTIENMUA            , THANHTIENVON            , THANHTIENHOPDONG            , ISTACHLO            , DONVITINHBANDAU_ID            , SOLUONGBANDAU            , GOITHAU_ID            , DONGIATHAU            , DONGIAPO            , TYLEQUIDOI            , TOATHUOCNOITRU_ID            , KHAMBENH_VTYT_ID            , PHAUTHUAT_VTYT_ID            , CLSKETQUA_VTYT_ID            , TOATHUOCNGOAITRU_ID            , MASTER_ID            , BENHNHAN            , YLENH                                   , BENHVIEN_ID            , NGAYTAO            , NGUOITAO_ID            , NGAYCAPNHAT            , NGUOICAPNHAT_ID            , THANHTIENMUABANDAU            , SOLUONGQUIDOI            ) values (             @param0             ,  @param1             ,  @param2             ,  @param3             ,  @param4             ,  @param5             ,  @param6             ,  @param7             ,  @param8             ,  @param9             ,  @param10             ,  @param11             ,  @param12             ,  @param13             ,  @param14             ,  @param15             ,  @param16             ,  @param17             ,  @param18             ,  @param19             ,  @param20             ,  @param21             ,  @param22             ,  @param23             ,  @param24             ,  @param25             ,  @param26             ,  @param27             ,  @param28             ,  @param29             ,  @param30             ,  @param31             ,  @param32             ,  @param33             ,  @param34             ,  @param35             ,  @param36             ,  @param37             ,  @param38             ,  @param39             ,  @param40             ,  @param41             ,  @param42             ,  @param43             ,  @param44             ,  @param45             ,  @param46             ,  @param47             ,  @param48             ,  @param49             ,  @param50             ,  @param51             ,  @param52             ,  @param53             ,  @param54                          ,  @param55             ,  @param56             ,  @param57             ,  @param58             ,  @param59             ,  @param60             ,  @param61             )            select SCOPE_identity() as value]
2019-09-20 16:59:53,704 [1] DEBUG - Statement Id: [DAO00030_CHUNGTUCT_Add] Parameters: [@param0=[CHUNGTU_ID,137702], @param1=[DUOC_ID,1], @param2=[SOLONHAP_ID,7541], @param3=[SOKIEMSOAT,null], @param4=[SOVISA,1], @param5=[HANDUNG,12/12/2026 12:00:00 AM], @param6=[DONVITINH_ID,17], @param7=[SOLUONGYEUCAU,2], @param8=[SOLUONGTHUCTE,null], @param9=[SOLUONGDAXUAT,2], @param10=[TIENTE_ID,null], @param11=[TYGIA,null], @param12=[DONGIAMUA,945], @param13=[DONGIA_BHYT,null], @param14=[DONGIABAN,1030], @param15=[DONGIABAN_VAT,1030], @param16=[DONGIAVON,945], @param17=[DONGIATHANHTOAN,null], @param18=[SOQUYEN,null], @param19=[SOHOADONVAT,null], @param20=[TYLEVAT,0], @param21=[GIATRIVAT,null], @param22=[TYLECHIETKHAU,null], @param23=[GIATRICHIETKHAU,null], @param24=[MIENPHI,null], @param25=[LYDOMIENPHI_ID,null], @param26=[SOCHUNGTUKETOAN,null], @param27=[SOCHUNGTUTIENMAT,null], @param28=[TRANGTHAI,null], @param29=[DAPHATSINHPHIEUXUAT,null], @param30=[DAPHATSINHPHIEUHOANTRA,null], @param31=[KHUYENMAI,null], @param32=[PHUONGPHAPXUAT,null], @param33=[DONDATHANG_ID,null], @param34=[GHICHUCHITIET,null], @param35=[NGUONHANG_ID,1], @param36=[DONGIAVONVAT,945], @param37=[THANHTIENMUA,1890], @param38=[THANHTIENVON,1890], @param39=[THANHTIENHOPDONG,null], @param40=[ISTACHLO,null], @param41=[DONVITINHBANDAU_ID,null], @param42=[SOLUONGBANDAU,null], @param43=[GOITHAU_ID,null], @param44=[DONGIATHAU,1030], @param45=[DONGIAPO,null], @param46=[TYLEQUIDOI,null], @param47=[TOATHUOCNOITRU_ID,null], @param48=[KHAMBENH_VTYT_ID,10593], @param49=[PHAUTHUAT_VTYT_ID,null], @param50=[CLSKETQUA_VTYT_ID,null], @param51=[TOATHUOCNGOAITRU_ID,null], @param52=[MASTER_ID,0], @param53=[BENHNHAN,Người bệnh: 190043304 - Test Xn1 - 20/09/2019 - 16:50], @param54=[YLENH,null], @param55=[BENHVIEN_ID,HLU01], @param56=[NGAYTAO,9/20/2019 4:59:53 PM], @param57=[NGUOITAO_ID,0], @param58=[NGAYCAPNHAT,9/20/2019 4:59:53 PM], @param59=[NGUOICAPNHAT_ID,0], @param60=[THANHTIENMUABANDAU,null], @param61=[SOLUONGQUIDOI,null]]
2019-09-20 16:59:53,704 [1] DEBUG - Statement Id: [DAO00030_CHUNGTUCT_Add] Types: [@param0=[Int64, System.Int64], @param1=[Int64, System.Int64], @param2=[Int64, System.Int64], @param3=[System.DBNull, null], @param4=[String, System.String], @param5=[DateTime, System.DateTime], @param6=[Int64, System.Int64], @param7=[Double, System.Double], @param8=[System.DBNull, null], @param9=[Double, System.Double], @param10=[System.DBNull, null], @param11=[System.DBNull, null], @param12=[Double, System.Double], @param13=[System.DBNull, null], @param14=[Double, System.Double], @param15=[Double, System.Double], @param16=[Double, System.Double], @param17=[System.DBNull, null], @param18=[System.DBNull, null], @param19=[System.DBNull, null], @param20=[Double, System.Double], @param21=[System.DBNull, null], @param22=[System.DBNull, null], @param23=[System.DBNull, null], @param24=[System.DBNull, null], @param25=[System.DBNull, null], @param26=[System.DBNull, null], @param27=[System.DBNull, null], @param28=[System.DBNull, null], @param29=[System.DBNull, null], @param30=[System.DBNull, null], @param31=[System.DBNull, null], @param32=[System.DBNull, null], @param33=[System.DBNull, null], @param34=[System.DBNull, null], @param35=[Int64, System.Int64], @param36=[Double, System.Double], @param37=[Double, System.Double], @param38=[Double, System.Double], @param39=[System.DBNull, null], @param40=[System.DBNull, null], @param41=[System.DBNull, null], @param42=[System.DBNull, null], @param43=[System.DBNull, null], @param44=[Double, System.Double], @param45=[System.DBNull, null], @param46=[System.DBNull, null], @param47=[System.DBNull, null], @param48=[Int64, System.Int64], @param49=[System.DBNull, null], @param50=[System.DBNull, null], @param51=[System.DBNull, null], @param52=[Int64, System.Int64], @param53=[String, System.String], @param54=[System.DBNull, null], @param55=[String, System.String], @param56=[DateTime, System.DateTime], @param57=[Int64, System.Int64], @param58=[DateTime, System.DateTime], @param59=[Int64, System.Int64], @param60=[System.DBNull, null], @param61=[System.DBNull, null]]
2019-09-20 16:59:53,737 [1] DEBUG - Statement Id: [DAO00030_TT_DUOC_TONKHO_LOG_Add] PreparedStatement : [DECLARE @KHODUOC_ID int               DECLARE @TONTRUOC numeric(18, 4)               DECLARE @TONSAU numeric(18, 4)               DECLARE @SOLUONGNHAP numeric(18, 4)               DECLARE @SOLUONGXUAT numeric(18, 4)                              IF( @param0  = 'N')               BEGIN                SET @KHODUOC_ID =  @param1                END               ELSE               BEGIN                 SET @KHODUOC_ID =  @param2                END                              SELECT @TONTRUOC = SOLUONG FROM TT_DUOC_TONKHO WHERE KHODUOC_ID = @KHODUOC_ID  AND DUOC_ID =  @param3  AND SOLONHAP_ID =  @param4  AND NGUONDUOC_ID =  @param5                               IF( @param0  = 'N' AND  @param6  = 'ADD')               BEGIN                SET @TONSAU = ISNULL(@TONTRUOC,0) +  @param7                 SET @SOLUONGNHAP =  @param7                 SET @SOLUONGXUAT = 0               END               IF( @param0  = 'N' AND  @param6  = 'DEL')               BEGIN                SET @TONSAU = ISNULL(@TONTRUOC,0) -  @param7                 SET @SOLUONGXUAT =  @param7                 SET @SOLUONGNHAP = 0               END                                         IF( @param0  = 'X' AND  @param6  = 'ADD')               BEGIN                SET @TONSAU = ISNULL(@TONTRUOC,0) -  @param8                 SET @SOLUONGXUAT =  @param8                 SET @SOLUONGNHAP = 0               END               IF( @param0  = 'X' AND  @param6  = 'DEL')               BEGIN                SET @TONSAU = ISNULL(@TONTRUOC,0) +  @param8                 SET @SOLUONGNHAP =  @param8                 SET @SOLUONGXUAT = 0                             END                        insert into TT_DUOC_TONKHO_LOG (                           CHUNGTUCHITIET_ID              ,CHUNGTU_ID              ,MACHUNGTU              ,LOAICHUNGTU              ,MUCDICHCHUNGTU_CODE              ,KHONHAP_ID              ,KHOXUAT_ID              ,DUOC_ID              ,SOLONHAP_ID              ,NGUONDUOC_ID              ,SOLUONGNHAP              ,SOLUONGXUAT              ,DONGIAMUA              ,DONGIAVON              ,TYLE_VAT              ,DONGIAVONVAT              ,TONTRUOC              ,TONSAU              ,ACTION              ,BENHVIEN_ID              ,NGAYTAO              ,NGUOITAO_ID                          ) values (              @param9               , @param10               , @param11               , @param0               , @param12               , @param1               , @param2               , @param3               , @param4               , @param5               ,@SOLUONGNHAP              ,@SOLUONGXUAT              , @param13               , @param14               , @param15               , @param16               ,@TONTRUOC              ,@TONSAU              , @param6               , @param17               , @param18               , @param19               )]
2019-09-20 16:59:53,737 [1] DEBUG - Statement Id: [DAO00030_TT_DUOC_TONKHO_LOG_Add] Parameters: [@param0=[LOAICHUNGTU,X], @param1=[KHONHAP_ID,null], @param2=[KHOXUAT_ID,32], @param3=[DUOC_ID,1], @param4=[SOLONHAP_ID,7541], @param5=[NGUONDUOC_ID,1], @param6=[ACTION,ADD], @param7=[SOLUONGNHAP,null], @param8=[SOLUONGXUAT,2], @param9=[CHUNGTUCHITIET_ID,1299047], @param10=[CHUNGTU_ID,137702], @param11=[MACHUNGTU,CS_KBX1319003090], @param12=[MUCDICHCHUNGTU_CODE,X13], @param13=[DONGIAMUA,945], @param14=[DONGIAVON,945], @param15=[TYLE_VAT,0], @param16=[DONGIAVONVAT,945], @param17=[BENHVIEN_ID,HLU01], @param18=[NGAYTAO,9/20/2019 4:59:53 PM], @param19=[NGUOITAO_ID,0]]
2019-09-20 16:59:53,737 [1] DEBUG - Statement Id: [DAO00030_TT_DUOC_TONKHO_LOG_Add] Types: [@param0=[String, System.String], @param1=[System.DBNull, null], @param2=[Int64, System.Int64], @param3=[Int64, System.Int64], @param4=[Int64, System.Int64], @param5=[Int64, System.Int64], @param6=[String, System.String], @param7=[System.DBNull, null], @param8=[Decimal, System.Decimal], @param9=[Int64, System.Int64], @param10=[Int64, System.Int64], @param11=[String, System.String], @param12=[String, System.String], @param13=[Decimal, System.Decimal], @param14=[Decimal, System.Decimal], @param15=[Double, System.Double], @param16=[Double, System.Double], @param17=[String, System.String], @param18=[DateTime, System.DateTime], @param19=[Int64, System.Int64]]
2019-09-20 16:59:53,774 [1] DEBUG - Statement Id: [DAO00030_DUOC_TONKHO_BOOKING_NGOAITRU_Giam] PreparedStatement : [update TT_DUOC_TONKHO_BOOK_NGOAITRU            set            SOLUONG = 0                     ,NGAYCAPNHAT = getdate()            where            REF_TABLE = 'TT_NGOAITRU_KHAMBENH_VTYT'            AND REF_ID = '10593'                AND BENHVIEN_ID = 'HLU01']
2019-09-20 16:59:53,835 [1] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoVaBookingCOM23UpdateRedis] PreparedStatement : [declare @NGUONDUOC_MACDINH varchar(5) = '0';        declare @TOAMUANGOAI int = 0;        select @NGUONDUOC_MACDINH = isnull(VALUE,0) from TM_SYS_APPSETTINGS where CODE = 'PHA_NGUONDUOC'        select @TOAMUANGOAI = isnull(VALUE,0) from TM_SYS_APPSETTINGS where CODE = 'OPD_TOAMUANGOAI_DUNGDANHMUC_DUOC'                if @TOAMUANGOAI = 1        begin        select  distinct '0' + '_' + LTRIM(d.DUOC_ID) + '_' + @NGUONDUOC_MACDINH as DUOC_KEY, 0 as PHAMVI_ID, @NGUONDUOC_MACDINH as NGUONDUOC_ID, null as TENNGUONDUOC, null as TINHTIEN, d.DUOC_ID, ld.MALOAIDUOC,        d.SOVISA,d.TYLE_VAT,d.COTOA, d.MADUOC, d.TENHANG, d.TENDUOCDAYDU, dvt.TENDONVITINH as DONVITINH, d.BHYT,        d.TENHOATCHAT, d.HAMLUONG, d.HANGSANXUAT, d.QUOCGIA, d.LOAIDUOC_ID, d.DUONGDUNG_ID, d.TINHTIEN_PTTT,        ten.TENDUOC, ten.TENDUOC_EN, ten.MAQUOCTE, ten.MAQUOCTEBT,        '' as BHYT_TEXT        , ld.LOAIVATTU_ID        , d.BENHVIEN_ID,        999999999 as SOLUONG, d.VTYT_PHANLOAI, d.PHAMVI, d.SUASOLUONGTONGHOP, d.MADUOCBV, d.DANGTRINHBAY        , TAMNGUNG = CASE WHEN d.TAMNGUNG = '1' THEN '1' ELSE '0' END        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        where d.DUOC_ID in (1)        union all        select  distinct tk.DUOC_KEY, LTRIM(tk.PHAMVI_ID) as PHAMVI_ID, tk.NGUONDUOC_ID, nh.TENNGUONDUOC, nh.TINHTIEN, d.DUOC_ID, ld.MALOAIDUOC,        d.SOVISA,d.TYLE_VAT,d.COTOA, d.MADUOC, d.TENHANG, d.TENDUOCDAYDU, dvt.TENDONVITINH as DONVITINH, d.BHYT,        d.TENHOATCHAT, d.HAMLUONG, d.HANGSANXUAT, d.QUOCGIA, d.LOAIDUOC_ID, d.DUONGDUNG_ID, d.TINHTIEN_PTTT,        ten.TENDUOC, ten.TENDUOC_EN, ten.MAQUOCTE, ten.MAQUOCTEBT,        CASE WHEN d.BHYT = '1' THEN 'BHYT' ELSE '' END as BHYT_TEXT        , ld.LOAIVATTU_ID        , d.BENHVIEN_ID,        tk.SOLUONG, d.VTYT_PHANLOAI, d.PHAMVI, d.SUASOLUONGTONGHOP, d.MADUOCBV, d.DANGTRINHBAY        , TAMNGUNG = CASE WHEN d.TAMNGUNG = '1' OR nh.TAMNGUNG = '1' OR kd.TAMNGUNG = '1' THEN '1' ELSE '0' END        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        inner join        (        select  LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')) DUOC_KEY, (SUM(dtk.SOLUONG) - isnull(sum(A.SOLUONG),0) - isnull(sum(B.SOLUONG),0)) SOLUONG, pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        from (select sum(soluong) soluong,duoc_id,nguonduoc_id,khoduoc_id,benhvien_id from TT_DUOC_TONKHO  group by duoc_id,nguonduoc_id,khoduoc_id,benhvien_id) dtk        inner join TM_DUOC_PHAMVISD_MAPPING pvsd on dtk.KHODUOC_ID = pvsd.KHODUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NOITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) B on B.DUOC_ID = dtk.DUOC_ID and B.SOLUONG > 0 and B.PHAMVI_ID = pvsd.PHAMVI_ID and B.NGUONHANG_ID = dtk.NGUONDUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NGOAITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) A on A.DUOC_ID = dtk.DUOC_ID and A.SOLUONG > 0 and A.PHAMVI_ID = pvsd.PHAMVI_ID and A.NGUONHANG_ID = dtk.NGUONDUOC_ID        where dtk.SOLUONG > 0 and dtk.BENHVIEN_ID = 'HLU01'        group by LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')), pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        ) tk on tk.DUOC_ID = d.DUOC_ID        left join TM_DUOC_PHAMVISUDUNG kd on kd.PHAMVI_ID = tk.PHAMVI_ID and kd.BENHVIEN_ID = 'HLU01'        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = tk.NGUONDUOC_ID and nh.BENHVIEN_ID = 'HLU01'        where  d.BENHVIEN_ID = 'HLU01' and d.DUOC_ID in (1)        end        else        begin        select  distinct tk.DUOC_KEY, LTRIM(tk.PHAMVI_ID) as PHAMVI_ID, tk.NGUONDUOC_ID, nh.TENNGUONDUOC, nh.TINHTIEN, d.DUOC_ID, ld.MALOAIDUOC,        d.SOVISA,d.TYLE_VAT,d.COTOA, d.MADUOC, d.TENHANG, d.TENDUOCDAYDU, dvt.TENDONVITINH as DONVITINH, d.BHYT,        d.TENHOATCHAT, d.HAMLUONG, d.HANGSANXUAT, d.QUOCGIA, d.LOAIDUOC_ID, d.DUONGDUNG_ID, d.TINHTIEN_PTTT,        ten.TENDUOC, ten.TENDUOC_EN, ten.MAQUOCTE, ten.MAQUOCTEBT,        CASE WHEN d.BHYT = '1' THEN 'BHYT' ELSE '' END as BHYT_TEXT        , ld.LOAIVATTU_ID        , d.BENHVIEN_ID,        tk.SOLUONG, d.VTYT_PHANLOAI, d.PHAMVI, d.SUASOLUONGTONGHOP, d.MADUOCBV, d.DANGTRINHBAY        , TAMNGUNG = CASE WHEN d.TAMNGUNG = '1' OR nh.TAMNGUNG = '1' OR kd.TAMNGUNG = '1' THEN '1' ELSE '0' END        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        inner join        (        select  LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')) DUOC_KEY, (SUM(dtk.SOLUONG) - isnull(sum(A.SOLUONG),0) - isnull(sum(B.SOLUONG),0)) SOLUONG, pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        from (select sum(soluong) soluong,duoc_id,nguonduoc_id,khoduoc_id,benhvien_id from TT_DUOC_TONKHO  group by duoc_id,nguonduoc_id,khoduoc_id,benhvien_id) dtk        inner join TM_DUOC_PHAMVISD_MAPPING pvsd on dtk.KHODUOC_ID = pvsd.KHODUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NOITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) B on B.DUOC_ID = dtk.DUOC_ID and B.SOLUONG > 0 and B.PHAMVI_ID = pvsd.PHAMVI_ID and B.NGUONHANG_ID = dtk.NGUONDUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NGOAITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) A on A.DUOC_ID = dtk.DUOC_ID and A.SOLUONG > 0 and A.PHAMVI_ID = pvsd.PHAMVI_ID and A.NGUONHANG_ID = dtk.NGUONDUOC_ID        where dtk.SOLUONG > 0 and dtk.BENHVIEN_ID = 'HLU01'        group by LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')), pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        ) tk on tk.DUOC_ID = d.DUOC_ID        left join TM_DUOC_PHAMVISUDUNG kd on kd.PHAMVI_ID = tk.PHAMVI_ID and kd.BENHVIEN_ID = 'HLU01'        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = tk.NGUONDUOC_ID and nh.BENHVIEN_ID = 'HLU01'        where  d.BENHVIEN_ID = 'HLU01' and d.DUOC_ID in (1)        end]
2019-09-20 16:59:54,037 [1] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoCOM18UpdateRedis] PreparedStatement : [select distinct TT_TONKHO.DUOC_KEY, LTRIM(TT_TONKHO.KHODUOC_ID) as KHODUOC_ID, TM_DUOC.DUOC_ID, TM_LOAIDUOC.MALOAIDUOC,TM_DUOC.SOVISA,TM_DUOC.TYLE_VAT,TM_DUOC.COTOA,        TM_DUOC.MADUOC, TM_DUOC.TENHANG, TM_DUOC.TENDUOCDAYDU, dvt.TENDONVITINH as DONVITINH,  TM_DUOC.DONVITINH_ID,TM_DUOC.BHYT,        TM_DUOC.TENHOATCHAT,        TM_DUOC.HAMLUONG, TM_DUOC.HANGSANXUAT, TM_DUOC.QUOCGIA, TM_DUOC.LOAIDUOC_ID, TM_DUOC.DUONGDUNG_ID,        TM_TENDUOC.TENDUOC, TM_TENDUOC.TENDUOC_EN, TM_TENDUOC.MAQUOCTE, TM_TENDUOC.MAQUOCTEBT,        TM_LOAIDUOC.LOAIVATTU_ID, TM_DUOC.BENHVIEN_ID,        TT_TONKHO.SOLUONG, TM_DUOC.VTYT_PHANLOAI, TM_DUOC.PHAMVI, TT_TONKHO.NGUONDUOC_ID, NG.TENNGUONDUOC AS TENNGUONDUOC        , TAMNGUNG = CASE WHEN TM_DUOC.TAMNGUNG = '1' OR NG.TAMNGUNG = '1' OR KD.TAMNGUNG = '1' THEN '1' ELSE '0' END        , TM_DUOC.DANGTRINHBAY        from TM_DUOC        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = TM_DUOC.DONVITINH_ID        left join TM_TENDUOC on TM_DUOC.TENDUOC_ID = TM_TENDUOC.TENDUOC_ID and TM_DUOC.BENHVIEN_ID = 'HLU01' and TM_DUOC.TAMNGUNG = '0'        left join TM_LOAIDUOC on TM_LOAIDUOC.LOAIDUOC_ID = TM_DUOC.LOAIDUOC_ID and TM_LOAIDUOC.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG on (TM_LOAIDUOC.LOAIVATTU_ID = TM_DUOC_HANDUNG.LOAIDUOC and TM_DUOC_HANDUNG.BENHVIEN_ID = 'HLU01')        inner join        (select LTRIM(A.KHODUOC_ID) + '_' + LTRIM(A.DUOC_ID) + '_' + LTRIM(ISNULL(A.NGUONDUOC_ID,'')) as DUOC_KEY, A.KHODUOC_ID, A.DUOC_ID, A.NGUONDUOC_ID,        SUM(isnull(A.SOLUONG,0)) as SOLUONG        from        (select SUM(SOLUONG) as SOLUONG, KHODUOC_ID, DUOC_ID, NGUONDUOC_ID from TT_DUOC_TONKHO        where BENHVIEN_ID = 'HLU01' group by KHODUOC_ID, DUOC_ID, NGUONDUOC_ID) A        group by LTRIM(A.KHODUOC_ID) + '_' + LTRIM(A.DUOC_ID) + '_' + LTRIM(ISNULL(A.NGUONDUOC_ID,'')), A.KHODUOC_ID, A.DUOC_ID, NGUONDUOC_ID        ) TT_TONKHO on TT_TONKHO.DUOC_ID = TM_DUOC.DUOC_ID        LEFT JOIN TM_NGUONHANG NG ON NG.NGUONDUOC_ID = TT_TONKHO.NGUONDUOC_ID        LEFT JOIN TM_KHODUOC KD ON KD.KHODUOC_ID = TT_TONKHO.KHODUOC_ID        where TM_DUOC.BENHVIEN_ID = 'HLU01' and TT_TONKHO.SOLUONG >= 0        and TM_DUOC.DUOC_ID in (1)]
2019-09-20 16:59:54,188 [1] DEBUG - Statement Id: [DAO00030_DUOCTONKHO_Giam] PreparedStatement : [update TT_DUOC_TONKHO set            SOLUONG = SOLUONG -  @param0             , NGAYCAPNHAT =  getdate()            , NGUOICAPNHAT_ID =  @param1             where            KHODUOC_ID =  @param2             and DUOC_ID =  @param3             and SOLONHAP_ID =  @param4]
2019-09-20 16:59:54,188 [1] DEBUG - Statement Id: [DAO00030_DUOCTONKHO_Giam] Parameters: [@param0=[SOLUONGTHAYDOI,2], @param1=[NGUOICAPNHAT_ID,0], @param2=[KHODUOC_ID,32], @param3=[DUOC_ID,1], @param4=[SOLONHAP_ID,7541]]
2019-09-20 16:59:54,188 [1] DEBUG - Statement Id: [DAO00030_DUOCTONKHO_Giam] Types: [@param0=[Double, System.Double], @param1=[Int64, System.Int64], @param2=[Int64, System.Int64], @param3=[Int64, System.Int64], @param4=[Int64, System.Int64]]
2019-09-20 16:59:54,221 [1] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoCOM18] PreparedStatement : [select  distinct TT_TONKHO.DUOC_KEY, LTRIM(TT_TONKHO.KHODUOC_ID) as KHODUOC_ID, TM_DUOC.DUOC_ID, TM_LOAIDUOC.MALOAIDUOC,TM_DUOC.SOVISA,TM_DUOC.TYLE_VAT,TM_DUOC.COTOA,        TM_DUOC.MADUOC, TM_DUOC.TENHANG, TM_DUOC.TENDUOCDAYDU, dvt.TENDONVITINH as DONVITINH, TM_DUOC.DONVITINH_ID, TM_DUOC.BHYT,        TM_DUOC.TENHOATCHAT, TM_DUOC.HAMLUONG, TM_DUOC.HANGSANXUAT, TM_DUOC.QUOCGIA, TM_DUOC.LOAIDUOC_ID, TM_DUOC.DUONGDUNG_ID,        TM_TENDUOC.TENDUOC, TM_TENDUOC.TENDUOC_EN, TM_TENDUOC.MAQUOCTE, TM_TENDUOC.MAQUOCTEBT,        TM_LOAIDUOC.LOAIVATTU_ID, TM_DUOC.BENHVIEN_ID,        TT_TONKHO.SOLUONG, TM_DUOC.VTYT_PHANLOAI, TM_DUOC.PHAMVI, TT_TONKHO.NGUONDUOC_ID, NG.TENNGUONDUOC        , TAMNGUNG = CASE WHEN TM_DUOC.TAMNGUNG = '1' OR NG.TAMNGUNG = '1' OR KD.TAMNGUNG = '1' THEN '1' ELSE '0' END        , TM_DUOC.DANGTRINHBAY        from TM_DUOC        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = TM_DUOC.DONVITINH_ID        left join TM_TENDUOC on TM_DUOC.TENDUOC_ID = TM_TENDUOC.TENDUOC_ID and TM_DUOC.BENHVIEN_ID = 'HLU01'  and TM_DUOC.TAMNGUNG = '0'        left join TM_LOAIDUOC on TM_LOAIDUOC.LOAIDUOC_ID = TM_DUOC.LOAIDUOC_ID and TM_LOAIDUOC.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG on (TM_LOAIDUOC.LOAIVATTU_ID = TM_DUOC_HANDUNG.LOAIDUOC and TM_DUOC_HANDUNG.BENHVIEN_ID = 'HLU01')        inner join        (select LTRIM(A.KHODUOC_ID) + '_' + LTRIM(A.DUOC_ID) + '_' + LTRIM(ISNULL(A.NGUONDUOC_ID,'')) as DUOC_KEY, A.KHODUOC_ID, A.DUOC_ID ,a.NGUONDUOC_ID,        SUM(isnull(A.SOLUONG,0)) as SOLUONG        from        (select SUM(SOLUONG) as SOLUONG, KHODUOC_ID, DUOC_ID, NGUONDUOC_ID from TT_DUOC_TONKHO        where KHODUOC_ID in (32) and DUOC_ID in (1) group by KHODUOC_ID, DUOC_ID, NGUONDUOC_ID        ) A        where A.KHODUOC_ID in (32) and A.DUOC_ID in (1)        group by LTRIM(A.KHODUOC_ID) + '_' + LTRIM(A.DUOC_ID) + '_' + LTRIM(A.NGUONDUOC_ID), A.KHODUOC_ID, A.DUOC_ID, A.NGUONDUOC_ID)        TT_TONKHO on TT_TONKHO.DUOC_ID = TM_DUOC.DUOC_ID        LEFT JOIN TM_NGUONHANG NG ON NG.NGUONDUOC_ID = TT_TONKHO.NGUONDUOC_ID        LEFT JOIN TM_KHODUOC KD ON KD.KHODUOC_ID = TT_TONKHO.KHODUOC_ID        where TM_DUOC.BENHVIEN_ID = 'HLU01' and TM_DUOC.DUOC_ID in (1)]
2019-09-20 16:59:54,265 [1] DEBUG - Statement Id: [DAO00030_GetListPhamViByKhoDuoc] PreparedStatement : [SELECT DISTINCT PHAMVI_ID          FROM TM_DUOC_PHAMVISD_MAPPING          WHERE          KHODUOC_ID IN (32)          AND BENHVIEN_ID ='HLU01'          AND TAMNGUNG = '0']
2019-09-20 16:59:54,305 [1] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoVaBookingCOM23] PreparedStatement : [declare @NGUONDUOC_MACDINH varchar(5) = '0';        declare @TOAMUANGOAI int = 0;        select @NGUONDUOC_MACDINH = isnull(VALUE,0) from TM_SYS_APPSETTINGS where CODE = 'PHA_NGUONDUOC'        select @TOAMUANGOAI = isnull(VALUE,0) from TM_SYS_APPSETTINGS where CODE = 'OPD_TOAMUANGOAI_DUNGDANHMUC_DUOC'                if @TOAMUANGOAI = 1        begin        select  distinct '0' + '_' + LTRIM(d.DUOC_ID) + '_' + @NGUONDUOC_MACDINH as DUOC_KEY, 0 as PHAMVI_ID, @NGUONDUOC_MACDINH as NGUONDUOC_ID, null as TENNGUONDUOC, null as TINHTIEN, d.DUOC_ID, ld.MALOAIDUOC,        d.SOVISA,d.TYLE_VAT,d.COTOA, d.MADUOC, d.TENHANG, d.TENDUOCDAYDU, dvt.TENDONVITINH as DONVITINH, d.BHYT,        d.TENHOATCHAT, d.HAMLUONG, d.HANGSANXUAT, d.QUOCGIA, d.LOAIDUOC_ID, d.DUONGDUNG_ID, d.TINHTIEN_PTTT,        ten.TENDUOC, ten.TENDUOC_EN, ten.MAQUOCTE, ten.MAQUOCTEBT,        '' as BHYT_TEXT        , ld.LOAIVATTU_ID        , d.BENHVIEN_ID,        999999999 as SOLUONG, d.VTYT_PHANLOAI, d.PHAMVI, d.SUASOLUONGTONGHOP, d.MADUOCBV, d.DANGTRINHBAY        , TAMNGUNG = CASE WHEN d.TAMNGUNG = '1' THEN '1' ELSE '0' END        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        where d.DUOC_ID in (1)        union all        select  distinct tk.DUOC_KEY, LTRIM(tk.PHAMVI_ID) as PHAMVI_ID, tk.NGUONDUOC_ID, nh.TENNGUONDUOC, nh.TINHTIEN, d.DUOC_ID, ld.MALOAIDUOC,        d.SOVISA,d.TYLE_VAT,d.COTOA, d.MADUOC, d.TENHANG, d.TENDUOCDAYDU, dvt.TENDONVITINH as DONVITINH, d.BHYT,        d.TENHOATCHAT, d.HAMLUONG, d.HANGSANXUAT, d.QUOCGIA, d.LOAIDUOC_ID, d.DUONGDUNG_ID, d.TINHTIEN_PTTT,        ten.TENDUOC, ten.TENDUOC_EN, ten.MAQUOCTE, ten.MAQUOCTEBT,        CASE WHEN d.BHYT = '1' THEN 'BHYT' ELSE '' END as BHYT_TEXT        , ld.LOAIVATTU_ID        , d.BENHVIEN_ID,        tk.SOLUONG, d.VTYT_PHANLOAI, d.PHAMVI, d.SUASOLUONGTONGHOP, d.MADUOCBV, d.DANGTRINHBAY        , TAMNGUNG = CASE WHEN d.TAMNGUNG = '1' OR nh.TAMNGUNG = '1' OR kd.TAMNGUNG = '1' THEN '1' ELSE '0' END        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        inner join        (        select  LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')) DUOC_KEY, (SUM(dtk.SOLUONG) - isnull(sum(A.SOLUONG),0) - isnull(sum(B.SOLUONG),0)) SOLUONG, pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        from (select sum(soluong) soluong,duoc_id,nguonduoc_id,khoduoc_id,benhvien_id from TT_DUOC_TONKHO  group by duoc_id,nguonduoc_id,khoduoc_id,benhvien_id) dtk        inner join TM_DUOC_PHAMVISD_MAPPING pvsd on dtk.KHODUOC_ID = pvsd.KHODUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NOITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) B on B.DUOC_ID = dtk.DUOC_ID and B.SOLUONG > 0 and B.PHAMVI_ID = pvsd.PHAMVI_ID and B.NGUONHANG_ID = dtk.NGUONDUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NGOAITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) A on A.DUOC_ID = dtk.DUOC_ID and A.SOLUONG > 0 and A.PHAMVI_ID = pvsd.PHAMVI_ID and A.NGUONHANG_ID = dtk.NGUONDUOC_ID        where dtk.SOLUONG > 0 and dtk.BENHVIEN_ID = 'HLU01'        group by LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')), pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        ) tk on tk.DUOC_ID = d.DUOC_ID        left join TM_DUOC_PHAMVISUDUNG kd on kd.PHAMVI_ID = tk.PHAMVI_ID and kd.BENHVIEN_ID = 'HLU01'        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = tk.NGUONDUOC_ID and nh.BENHVIEN_ID = 'HLU01'        where  d.BENHVIEN_ID = 'HLU01' and d.DUOC_ID in (1) and TK.PHAMVI_ID in (1055)        and tk.NGUONDUOC_ID in (1)         end        else        begin                select  distinct tk.DUOC_KEY, LTRIM(tk.PHAMVI_ID) as PHAMVI_ID, tk.NGUONDUOC_ID, nh.TENNGUONDUOC, nh.TINHTIEN, d.DUOC_ID, ld.MALOAIDUOC,        d.SOVISA,d.TYLE_VAT,d.COTOA, d.MADUOC, d.TENHANG, d.TENDUOCDAYDU, dvt.TENDONVITINH as DONVITINH, d.BHYT,        d.TENHOATCHAT, d.HAMLUONG, d.HANGSANXUAT, d.QUOCGIA, d.LOAIDUOC_ID, d.DUONGDUNG_ID, d.TINHTIEN_PTTT,        ten.TENDUOC, ten.TENDUOC_EN, ten.MAQUOCTE, ten.MAQUOCTEBT,        CASE WHEN d.BHYT = '1' THEN 'BHYT' ELSE '' END as BHYT_TEXT        , ld.LOAIVATTU_ID        , d.BENHVIEN_ID,        tk.SOLUONG, d.VTYT_PHANLOAI, d.PHAMVI, d.SUASOLUONGTONGHOP, d.MADUOCBV, d.DANGTRINHBAY        , TAMNGUNG = CASE WHEN d.TAMNGUNG = '1' OR nh.TAMNGUNG = '1' OR kd.TAMNGUNG = '1' THEN '1' ELSE '0' END        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        inner join        (        select  LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')) DUOC_KEY, (SUM(dtk.SOLUONG) - isnull(sum(A.SOLUONG),0) - isnull(sum(B.SOLUONG),0)) SOLUONG, pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        from (select sum(soluong) soluong,duoc_id,nguonduoc_id,khoduoc_id,benhvien_id from TT_DUOC_TONKHO  group by duoc_id,nguonduoc_id,khoduoc_id,benhvien_id) dtk        inner join TM_DUOC_PHAMVISD_MAPPING pvsd on dtk.KHODUOC_ID = pvsd.KHODUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NOITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) B on B.DUOC_ID = dtk.DUOC_ID and B.SOLUONG > 0 and B.PHAMVI_ID = pvsd.PHAMVI_ID and B.NGUONHANG_ID = dtk.NGUONDUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NGOAITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) A on A.DUOC_ID = dtk.DUOC_ID and A.SOLUONG > 0 and A.PHAMVI_ID = pvsd.PHAMVI_ID and A.NGUONHANG_ID = dtk.NGUONDUOC_ID        where dtk.SOLUONG > 0 and dtk.BENHVIEN_ID = 'HLU01'        group by LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')), pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        ) tk on tk.DUOC_ID = d.DUOC_ID        left join TM_DUOC_PHAMVISUDUNG kd on kd.PHAMVI_ID = tk.PHAMVI_ID and kd.BENHVIEN_ID = 'HLU01'        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = tk.NGUONDUOC_ID and nh.BENHVIEN_ID = 'HLU01'        where  d.BENHVIEN_ID = 'HLU01' and d.DUOC_ID in (1) and TK.PHAMVI_ID in (1055)        and tk.NGUONDUOC_ID in (1)         end]
2019-09-20 16:59:54,461 [1] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoCOM18UpdateRedis] PreparedStatement : [select distinct TT_TONKHO.DUOC_KEY, LTRIM(TT_TONKHO.KHODUOC_ID) as KHODUOC_ID, TM_DUOC.DUOC_ID, TM_LOAIDUOC.MALOAIDUOC,TM_DUOC.SOVISA,TM_DUOC.TYLE_VAT,TM_DUOC.COTOA,        TM_DUOC.MADUOC, TM_DUOC.TENHANG, TM_DUOC.TENDUOCDAYDU, dvt.TENDONVITINH as DONVITINH,  TM_DUOC.DONVITINH_ID,TM_DUOC.BHYT,        TM_DUOC.TENHOATCHAT,        TM_DUOC.HAMLUONG, TM_DUOC.HANGSANXUAT, TM_DUOC.QUOCGIA, TM_DUOC.LOAIDUOC_ID, TM_DUOC.DUONGDUNG_ID,        TM_TENDUOC.TENDUOC, TM_TENDUOC.TENDUOC_EN, TM_TENDUOC.MAQUOCTE, TM_TENDUOC.MAQUOCTEBT,        TM_LOAIDUOC.LOAIVATTU_ID, TM_DUOC.BENHVIEN_ID,        TT_TONKHO.SOLUONG, TM_DUOC.VTYT_PHANLOAI, TM_DUOC.PHAMVI, TT_TONKHO.NGUONDUOC_ID, NG.TENNGUONDUOC AS TENNGUONDUOC        , TAMNGUNG = CASE WHEN TM_DUOC.TAMNGUNG = '1' OR NG.TAMNGUNG = '1' OR KD.TAMNGUNG = '1' THEN '1' ELSE '0' END        , TM_DUOC.DANGTRINHBAY        from TM_DUOC        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = TM_DUOC.DONVITINH_ID        left join TM_TENDUOC on TM_DUOC.TENDUOC_ID = TM_TENDUOC.TENDUOC_ID and TM_DUOC.BENHVIEN_ID = 'HLU01' and TM_DUOC.TAMNGUNG = '0'        left join TM_LOAIDUOC on TM_LOAIDUOC.LOAIDUOC_ID = TM_DUOC.LOAIDUOC_ID and TM_LOAIDUOC.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG on (TM_LOAIDUOC.LOAIVATTU_ID = TM_DUOC_HANDUNG.LOAIDUOC and TM_DUOC_HANDUNG.BENHVIEN_ID = 'HLU01')        inner join        (select LTRIM(A.KHODUOC_ID) + '_' + LTRIM(A.DUOC_ID) + '_' + LTRIM(ISNULL(A.NGUONDUOC_ID,'')) as DUOC_KEY, A.KHODUOC_ID, A.DUOC_ID, A.NGUONDUOC_ID,        SUM(isnull(A.SOLUONG,0)) as SOLUONG        from        (select SUM(SOLUONG) as SOLUONG, KHODUOC_ID, DUOC_ID, NGUONDUOC_ID from TT_DUOC_TONKHO        where BENHVIEN_ID = 'HLU01' group by KHODUOC_ID, DUOC_ID, NGUONDUOC_ID) A        group by LTRIM(A.KHODUOC_ID) + '_' + LTRIM(A.DUOC_ID) + '_' + LTRIM(ISNULL(A.NGUONDUOC_ID,'')), A.KHODUOC_ID, A.DUOC_ID, NGUONDUOC_ID        ) TT_TONKHO on TT_TONKHO.DUOC_ID = TM_DUOC.DUOC_ID        LEFT JOIN TM_NGUONHANG NG ON NG.NGUONDUOC_ID = TT_TONKHO.NGUONDUOC_ID        LEFT JOIN TM_KHODUOC KD ON KD.KHODUOC_ID = TT_TONKHO.KHODUOC_ID        where TM_DUOC.BENHVIEN_ID = 'HLU01' and TT_TONKHO.SOLUONG >= 0        and TM_DUOC.DUOC_ID in (1)]
2019-09-20 16:59:54,512 [1] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoVaBookingCOM23UpdateRedis] PreparedStatement : [declare @NGUONDUOC_MACDINH varchar(5) = '0';        declare @TOAMUANGOAI int = 0;        select @NGUONDUOC_MACDINH = isnull(VALUE,0) from TM_SYS_APPSETTINGS where CODE = 'PHA_NGUONDUOC'        select @TOAMUANGOAI = isnull(VALUE,0) from TM_SYS_APPSETTINGS where CODE = 'OPD_TOAMUANGOAI_DUNGDANHMUC_DUOC'                if @TOAMUANGOAI = 1        begin        select  distinct '0' + '_' + LTRIM(d.DUOC_ID) + '_' + @NGUONDUOC_MACDINH as DUOC_KEY, 0 as PHAMVI_ID, @NGUONDUOC_MACDINH as NGUONDUOC_ID, null as TENNGUONDUOC, null as TINHTIEN, d.DUOC_ID, ld.MALOAIDUOC,        d.SOVISA,d.TYLE_VAT,d.COTOA, d.MADUOC, d.TENHANG, d.TENDUOCDAYDU, dvt.TENDONVITINH as DONVITINH, d.BHYT,        d.TENHOATCHAT, d.HAMLUONG, d.HANGSANXUAT, d.QUOCGIA, d.LOAIDUOC_ID, d.DUONGDUNG_ID, d.TINHTIEN_PTTT,        ten.TENDUOC, ten.TENDUOC_EN, ten.MAQUOCTE, ten.MAQUOCTEBT,        '' as BHYT_TEXT        , ld.LOAIVATTU_ID        , d.BENHVIEN_ID,        999999999 as SOLUONG, d.VTYT_PHANLOAI, d.PHAMVI, d.SUASOLUONGTONGHOP, d.MADUOCBV, d.DANGTRINHBAY        , TAMNGUNG = CASE WHEN d.TAMNGUNG = '1' THEN '1' ELSE '0' END        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        where d.DUOC_ID in (1)        union all        select  distinct tk.DUOC_KEY, LTRIM(tk.PHAMVI_ID) as PHAMVI_ID, tk.NGUONDUOC_ID, nh.TENNGUONDUOC, nh.TINHTIEN, d.DUOC_ID, ld.MALOAIDUOC,        d.SOVISA,d.TYLE_VAT,d.COTOA, d.MADUOC, d.TENHANG, d.TENDUOCDAYDU, dvt.TENDONVITINH as DONVITINH, d.BHYT,        d.TENHOATCHAT, d.HAMLUONG, d.HANGSANXUAT, d.QUOCGIA, d.LOAIDUOC_ID, d.DUONGDUNG_ID, d.TINHTIEN_PTTT,        ten.TENDUOC, ten.TENDUOC_EN, ten.MAQUOCTE, ten.MAQUOCTEBT,        CASE WHEN d.BHYT = '1' THEN 'BHYT' ELSE '' END as BHYT_TEXT        , ld.LOAIVATTU_ID        , d.BENHVIEN_ID,        tk.SOLUONG, d.VTYT_PHANLOAI, d.PHAMVI, d.SUASOLUONGTONGHOP, d.MADUOCBV, d.DANGTRINHBAY        , TAMNGUNG = CASE WHEN d.TAMNGUNG = '1' OR nh.TAMNGUNG = '1' OR kd.TAMNGUNG = '1' THEN '1' ELSE '0' END        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        inner join        (        select  LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')) DUOC_KEY, (SUM(dtk.SOLUONG) - isnull(sum(A.SOLUONG),0) - isnull(sum(B.SOLUONG),0)) SOLUONG, pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        from (select sum(soluong) soluong,duoc_id,nguonduoc_id,khoduoc_id,benhvien_id from TT_DUOC_TONKHO  group by duoc_id,nguonduoc_id,khoduoc_id,benhvien_id) dtk        inner join TM_DUOC_PHAMVISD_MAPPING pvsd on dtk.KHODUOC_ID = pvsd.KHODUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NOITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) B on B.DUOC_ID = dtk.DUOC_ID and B.SOLUONG > 0 and B.PHAMVI_ID = pvsd.PHAMVI_ID and B.NGUONHANG_ID = dtk.NGUONDUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NGOAITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) A on A.DUOC_ID = dtk.DUOC_ID and A.SOLUONG > 0 and A.PHAMVI_ID = pvsd.PHAMVI_ID and A.NGUONHANG_ID = dtk.NGUONDUOC_ID        where dtk.SOLUONG > 0 and dtk.BENHVIEN_ID = 'HLU01'        group by LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')), pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        ) tk on tk.DUOC_ID = d.DUOC_ID        left join TM_DUOC_PHAMVISUDUNG kd on kd.PHAMVI_ID = tk.PHAMVI_ID and kd.BENHVIEN_ID = 'HLU01'        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = tk.NGUONDUOC_ID and nh.BENHVIEN_ID = 'HLU01'        where  d.BENHVIEN_ID = 'HLU01' and d.DUOC_ID in (1)        end        else        begin        select  distinct tk.DUOC_KEY, LTRIM(tk.PHAMVI_ID) as PHAMVI_ID, tk.NGUONDUOC_ID, nh.TENNGUONDUOC, nh.TINHTIEN, d.DUOC_ID, ld.MALOAIDUOC,        d.SOVISA,d.TYLE_VAT,d.COTOA, d.MADUOC, d.TENHANG, d.TENDUOCDAYDU, dvt.TENDONVITINH as DONVITINH, d.BHYT,        d.TENHOATCHAT, d.HAMLUONG, d.HANGSANXUAT, d.QUOCGIA, d.LOAIDUOC_ID, d.DUONGDUNG_ID, d.TINHTIEN_PTTT,        ten.TENDUOC, ten.TENDUOC_EN, ten.MAQUOCTE, ten.MAQUOCTEBT,        CASE WHEN d.BHYT = '1' THEN 'BHYT' ELSE '' END as BHYT_TEXT        , ld.LOAIVATTU_ID        , d.BENHVIEN_ID,        tk.SOLUONG, d.VTYT_PHANLOAI, d.PHAMVI, d.SUASOLUONGTONGHOP, d.MADUOCBV, d.DANGTRINHBAY        , TAMNGUNG = CASE WHEN d.TAMNGUNG = '1' OR nh.TAMNGUNG = '1' OR kd.TAMNGUNG = '1' THEN '1' ELSE '0' END        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        inner join        (        select  LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')) DUOC_KEY, (SUM(dtk.SOLUONG) - isnull(sum(A.SOLUONG),0) - isnull(sum(B.SOLUONG),0)) SOLUONG, pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        from (select sum(soluong) soluong,duoc_id,nguonduoc_id,khoduoc_id,benhvien_id from TT_DUOC_TONKHO  group by duoc_id,nguonduoc_id,khoduoc_id,benhvien_id) dtk        inner join TM_DUOC_PHAMVISD_MAPPING pvsd on dtk.KHODUOC_ID = pvsd.KHODUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NOITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) B on B.DUOC_ID = dtk.DUOC_ID and B.SOLUONG > 0 and B.PHAMVI_ID = pvsd.PHAMVI_ID and B.NGUONHANG_ID = dtk.NGUONDUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NGOAITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) A on A.DUOC_ID = dtk.DUOC_ID and A.SOLUONG > 0 and A.PHAMVI_ID = pvsd.PHAMVI_ID and A.NGUONHANG_ID = dtk.NGUONDUOC_ID        where dtk.SOLUONG > 0 and dtk.BENHVIEN_ID = 'HLU01'        group by LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')), pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        ) tk on tk.DUOC_ID = d.DUOC_ID        left join TM_DUOC_PHAMVISUDUNG kd on kd.PHAMVI_ID = tk.PHAMVI_ID and kd.BENHVIEN_ID = 'HLU01'        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = tk.NGUONDUOC_ID and nh.BENHVIEN_ID = 'HLU01'        where  d.BENHVIEN_ID = 'HLU01' and d.DUOC_ID in (1)        end]
2019-09-20 16:59:54,781 [1] DEBUG - Statement Id: [DAO00030_GetList] PreparedStatement : [select *              from TT_DUOC_CHUNGTU              where BENHVIEN_ID = 'HLU01'                and                   TT_DUOC_CHUNGTU.CHUNGTU_ID = '137702'                               order by CHUNGTU_ID]
2019-09-20 16:59:55,302 [1] DEBUG - Statement Id: [DAO00030_CHUNGTUXUAT_CHITIET_GetList] PreparedStatement : [SELECT            ctct.*,            d.MADUOC, d.TENHANG, d.TENDUOCDAYDU, dvt.TENDONVITINH as DONVITINH,n.TENNGUONDUOC as NGUONHANG,            sln.SOLONHAP, sln.SOLOSANPHAM, sln.NGAYNHAP as NGAYNHAPLO, sln.HANDUNG as HANSUDUNG,            isnull(tk.SOLUONG,0) as SOLUONGTON,            LTRIM(ct.KHOXUAT_ID) + '_' + LTRIM(sln.DUOC_ID) + '_' + LTRIM(sln.NGUONDUOC_ID) as DUOC_KEY            , NLD.MANHOMLOAIDUOC, ld.MALOAIDUOC, D.SO_QDTT            FROM            TT_DUOC_CHUNGTU_CHITIET ctct            INNER JOIN TT_DUOC_CHUNGTU ct ON (ct.CHUNGTU_ID = ctct.CHUNGTU_ID)            INNER JOIN TT_DUOC_CHUNGTU_SOLONHAP sln ON (sln.SOLONHAP_ID = ctct.SOLONHAP_ID)            LEFT JOIN (            select xx.DUOCTONKHO_ID, xx.KHODUOC_ID, xx.DUOC_ID, xx.SOLONHAP_ID, xx.SOLUONG, xx.NGUONDUOC_ID, xx.BENHVIEN_ID from TT_DUOC_TONKHO xx            join ( select max(DUOCTONKHO_ID) as DUOCTONKHO_ID, KHODUOC_ID, DUOC_ID, SOLONHAP_ID, NGUONDUOC_ID            from TT_DUOC_TONKHO group by KHODUOC_ID, DUOC_ID, SOLONHAP_ID, NGUONDUOC_ID) yy on xx.DUOCTONKHO_ID=yy.DUOCTONKHO_ID            ) tk ON (tk.SOLONHAP_ID = sln.SOLONHAP_ID AND tk.DUOC_ID = sln.DUOC_ID and tk.KHODUOC_ID = ct.KHOXUAT_ID)            INNER JOIN TM_DUOC d ON (d.DUOC_ID = ctct.DUOC_ID)            INNER JOIN TM_NGUONHANG n ON (n.NGUONDUOC_ID = ctct.NGUONHANG_ID)            LEFT JOIN TM_DONVITINH dvt ON (dvt.DONVITINH_ID = ctct.DONVITINH_ID)            left join TM_LOAIDUOC LD on LD.LOAIDUOC_ID = D.LOAIDUOC_ID            LEFT JOIN TM_NHOMLOAIDUOC NLD on NLD.NHOMLOAIDUOC_ID = LD.NHOMLOAIDUOC_ID             where                             ct.CHUNGTU_ID = '137702'                       and                           ct.BENHVIEN_ID = 'HLU01'                                     order by CHUNGTUCHITIET_ID]
2019-09-20 16:59:55,446 [1] DEBUG - Statement Id: [DAO00030_KiemTraChungTuKhoaSo] PreparedStatement : [SELECT CHUNGTU_ID              FROM TT_DUOC_CHUNGTU              WHERE              MACHUNGTU = 'CS_KBX1319003090'              and BENHVIEN_ID = 'HLU01'              and              convert(date, NGAYCHUNGTU) <=              (              SELECT TOP 1 convert(date, KHOADENNGAY)              FROM TT_DUOC_KHOASOCHUNGTU              WHERE              KHODUOC_ID = '32'              and BENHVIEN_ID = 'HLU01'              AND KHOASO = '1'              ORDER BY KHOADENNGAY DESC              )]
2019-09-20 16:59:55,497 [1] DEBUG - Statement Id: [DAO00030_KiemTraChungTuDaChuyenKeToan] PreparedStatement : [SELECT CHUNGTU_ID            FROM TT_DUOC_CHUNGTU            WHERE            CHUNGTU_ID = '137702'            and IDCHUYEN IS NOT NULL            and BENHVIEN_ID = 'HLU01']
2019-09-20 16:59:55,532 [1] DEBUG - Statement Id: [DAO00030_KiemTraBenhNhanXuatVien] PreparedStatement : [select              TT.TOATHUOC_ID              from              TT_NOITRU_TOATHUOC TT              inner join TT_NOITRU_KHAMBENH KB on TT.KHAMBENH_ID = KB.KHAMBENH_ID              inner join TT_NOITRU_BENHAN BA on BA.BENHAN_ID = KB.BENHAN_ID              WHERE              BA.TRANGTHAI = 'DAXUATVIEN'              AND TT.CHUNGTU_ID =  137702              and TT.BENHVIEN_ID = 'HLU01']
2019-09-20 16:59:55,731 [1] DEBUG - Statement Id: [DAO00030_DUOCTONKHO_GetSoTonTheoDuoc] PreparedStatement : [SELECT              DUOC_ID,              SUM(SOLUONG) AS TONGTON              FROM              TT_DUOC_TONKHO              WHERE              KHODUOC_ID = '32'              and BENHVIEN_ID = 'HLU01'              and DUOC_ID IN (1)              GROUP BY DUOC_ID]
2019-09-20 16:59:55,762 [1] DEBUG - Statement Id: [DAO00030_DUOCTONKHO_GetSoTonTheoDuocTheoLo] PreparedStatement : [SELECT              DUOC_ID,SOLONHAP_ID,              SUM(SOLUONG) AS SOLUONGTONLO              FROM              TT_DUOC_TONKHO              WHERE              KHODUOC_ID = '32'              and BENHVIEN_ID = 'HLU01'              and DUOC_ID IN (1)              and SOLONHAP_ID IN (7541)              GROUP BY DUOC_ID, SOLONHAP_ID]
2019-09-20 16:59:55,792 [1] DEBUG - Statement Id: [DAO00030_DUOCTONKHO_GetSoTonTheoDuoc] PreparedStatement : [SELECT              DUOC_ID,              SUM(SOLUONG) AS TONGTON              FROM              TT_DUOC_TONKHO              WHERE              KHODUOC_ID = '32'              and BENHVIEN_ID = 'HLU01'              and DUOC_ID IN (1)              GROUP BY DUOC_ID]
2019-09-20 17:00:04,141 [1] DEBUG - Statement Id: [DAO00030_Search_PhieuXuatSD] PreparedStatement : [SELECT DISTINCT phieuxuat.* FROM          (          select DISTINCT          CT.CHUNGTU_ID,          CT.SOCHUNGTU,          CT.MACHUNGTU,          CT.NGAYCHUNGTU,          CT.NGAYTAO,          CT.KHOXUAT_ID,          CT.NGUOIGIAO_ID,          CT.KHONHAP_ID,          CT.NGUOINHAN_ID,          PL.MACHUNGTU as MAPHIEULINH,          PL.NGAYCHUNGTU as NGAYPHIEULINH,          bn.MAYTE,          bn.TENBENHNHAN,          CONVERT(VARCHAR(10), KB.THOIGIANKHAM, 103) + ' - ' + CONVERT(VARCHAR(5), KB.THOIGIANKHAM, 108) as THOIGIANKHAM,          nl.TENNHANVIEN as NGUOILAP,          CT.DIENGIAI          from TT_DUOC_CHUNGTU CT          inner join TT_DUOC_CHUNGTU_CHITIET ctct on ct.CHUNGTU_ID = ctct.CHUNGTU_ID          inner join TT_NOITRU_TOATHUOC TT on ctct.TOATHUOCNOITRU_ID = TT.TOATHUOC_ID          inner join TT_NOITRU_KHAMBENH KB on kb.KHAMBENH_ID = TT.KHAMBENH_ID          inner join TT_BENHNHAN BN on TT.BENHNHAN_ID = BN.BENHNHAN_ID          left join TT_DUOC_PHIEULINH PL on PL.CHUNGTU_ID = CT.PHIEULINH_ID          left join TM_NHANVIEN nl on nl.NHANVIEN_ID = TT.NGUOITAO_ID           where                   CT.MUCDICHCHUNGTU_ID = '1060'               and                 CT.KHOXUAT_ID = '32'               and                 CONVERT(date, CT.NGAYCHUNGTU) BETWEEN CONVERT(date, '9/20/2019 12:00:00 AM')  and  CONVERT(date, '9/20/2019 12:00:00 AM')               and                 CT.BENHVIEN_ID = 'HLU01'                           UNION            select DISTINCT          CT.CHUNGTU_ID,          CT.SOCHUNGTU,          CT.MACHUNGTU,          CT.NGAYCHUNGTU,          CT.NGAYTAO,          CT.KHOXUAT_ID,          CT.NGUOIGIAO_ID,          CT.KHONHAP_ID,          CT.NGUOINHAN_ID,          PL.MACHUNGTU as MAPHIEULINH,          PL.NGAYCHUNGTU as NGAYPHIEULINH,          bn.MAYTE,          bn.TENBENHNHAN,          CONVERT(VARCHAR(10), KB.THOIGIANKHAM, 103) + ' - ' + CONVERT(VARCHAR(5), KB.THOIGIANKHAM, 108) as THOIGIANKHAM,          nl.TENNHANVIEN as NGUOILAP,          CT.DIENGIAI          from TT_DUOC_CHUNGTU CT          inner join TT_DUOC_CHUNGTU_CHITIET ctct on ct.CHUNGTU_ID = ctct.CHUNGTU_ID          inner join TT_NGOAITRU_KHAMBENH_VTYT vt on ctct.KHAMBENH_VTYT_ID = vt.KHAMBENH_VTYT_ID          inner join TT_NGOAITRU_KHAMBENH kb on kb.KHAMBENH_ID = vt.KHAMBENH_ID          inner join TT_BENHNHAN BN on bn.BENHNHAN_ID = kb.BENHNHAN_ID          left join TT_DUOC_PHIEULINH PL on PL.CHUNGTU_ID = CT.PHIEULINH_ID          left join TM_NHANVIEN nl on nl.NHANVIEN_ID = vt.NGUOITAO_ID           where                   CT.MUCDICHCHUNGTU_ID = '1060'               and                 CT.KHOXUAT_ID = '32'               and                 CONVERT(date, CT.NGAYCHUNGTU) BETWEEN CONVERT(date, '9/20/2019 12:00:00 AM')  and  CONVERT(date, '9/20/2019 12:00:00 AM')               and                 CT.BENHVIEN_ID = 'HLU01'                           UNION            select DISTINCT          CT.CHUNGTU_ID,          CT.SOCHUNGTU,          CT.MACHUNGTU,          CT.NGAYCHUNGTU,          CT.NGAYTAO,          CT.KHOXUAT_ID,          CT.NGUOIGIAO_ID,          CT.KHONHAP_ID,          CT.NGUOINHAN_ID,          PL.MACHUNGTU as MAPHIEULINH,          PL.NGAYCHUNGTU as NGAYPHIEULINH,          bn.MAYTE,          bn.TENBENHNHAN,          CONVERT(VARCHAR(10), pt.NGAYTHUCHIEN, 103) + ' - ' + CONVERT(VARCHAR(5), pt.NGAYTHUCHIEN, 108) as THOIGIANKHAM,          nl.TENNHANVIEN as NGUOILAP,          CT.DIENGIAI          from TT_DUOC_CHUNGTU CT          inner join TT_DUOC_CHUNGTU_CHITIET ctct on ct.CHUNGTU_ID = ctct.CHUNGTU_ID          inner join TT_PHAUTHUAT_VTYT vt on ctct.PHAUTHUAT_VTYT_ID = vt.PHAUTHUAT_VTYT_ID          inner join TT_PHAUTHUAT pt on pt.PHAUTHUAT_ID = vt.PHAUTHUAT_ID          inner join TT_TIEPNHAN tn on tn.TIEPNHAN_ID = pt.TIEPNHAN_ID          inner join TT_BENHNHAN bn on bn.BENHNHAN_ID = tn.BENHNHAN_ID          left join TT_DUOC_PHIEULINH PL on PL.CHUNGTU_ID = CT.PHIEULINH_ID          left join TM_NHANVIEN nl on nl.NHANVIEN_ID = pt.NGUOITAO_ID           where                   CT.MUCDICHCHUNGTU_ID = '1060'               and                 CT.KHOXUAT_ID = '32'               and                 CONVERT(date, CT.NGAYCHUNGTU) BETWEEN CONVERT(date, '9/20/2019 12:00:00 AM')  and  CONVERT(date, '9/20/2019 12:00:00 AM')               and                 CT.BENHVIEN_ID = 'HLU01'                           UNION            select DISTINCT          CT.CHUNGTU_ID,          CT.SOCHUNGTU,          CT.MACHUNGTU,          CT.NGAYCHUNGTU,          CT.NGAYTAO,          CT.KHOXUAT_ID,          CT.NGUOIGIAO_ID,          CT.KHONHAP_ID,          CT.NGUOINHAN_ID,          PL.MACHUNGTU as MAPHIEULINH,          PL.NGAYCHUNGTU as NGAYPHIEULINH,          bn.MAYTE,          bn.TENBENHNHAN,          CONVERT(VARCHAR(10), cls.NGAYTAO, 103) + ' - ' + CONVERT(VARCHAR(5), cls.NGAYTAO, 108) as THOIGIANKHAM,          nl.TENNHANVIEN as NGUOILAP,          CT.DIENGIAI          from TT_DUOC_CHUNGTU CT          inner join TT_DUOC_CHUNGTU_CHITIET ctct on ct.CHUNGTU_ID = ctct.CHUNGTU_ID          inner join TT_CLSKETQUA_VTYT cls on ctct.CLSKETQUA_VTYT_ID = cls.CLSKETQUA_VTYT_ID          inner join TT_DVYEUCAU DV on DV.DVYEUCAU_ID = CLS.DVYEUCAU_ID          inner join TT_BENHNHAN bn on bn.BENHNHAN_ID = DV.BENHNHAN_ID          left join TT_DUOC_PHIEULINH PL on PL.CHUNGTU_ID = CT.PHIEULINH_ID          left join TM_NHANVIEN nl on nl.NHANVIEN_ID = cls.NGUOITAO_ID           where                   CT.MUCDICHCHUNGTU_ID = '1060'               and                 CT.KHOXUAT_ID = '32'               and                 CONVERT(date, CT.NGAYCHUNGTU) BETWEEN CONVERT(date, '9/20/2019 12:00:00 AM')  and  CONVERT(date, '9/20/2019 12:00:00 AM')               and                 CT.BENHVIEN_ID = 'HLU01'                           UNION            select DISTINCT          CT.CHUNGTU_ID,          CT.SOCHUNGTU,          CT.MACHUNGTU,          CT.NGAYCHUNGTU,          CT.NGAYTAO,          CT.KHOXUAT_ID,          CT.NGUOIGIAO_ID,          CT.KHONHAP_ID,          CT.NGUOINHAN_ID,          PL.MACHUNGTU as MAPHIEULINH,          PL.NGAYCHUNGTU as NGAYPHIEULINH,          null as MAYTE,          null as TENBENHNHAN,          null as THOIGIANKHAM,          nl.TENNHANVIEN as NGUOILAP,          CT.DIENGIAI          from TT_DUOC_CHUNGTU CT          inner join TT_DUOC_CHUNGTU_CHITIET ctct on ct.CHUNGTU_ID = ctct.CHUNGTU_ID          left join TT_DUOC_PHIEULINH PL on PL.CHUNGTU_ID = CT.PHIEULINH_ID          left join TM_NHANVIEN nl on nl.NHANVIEN_ID = ct.NGUOITAO_ID          WHERE (ctct.TOATHUOCNOITRU_ID IS NULL AND ctct.KHAMBENH_VTYT_ID IS NULL AND ctct.PHAUTHUAT_VTYT_ID IS NULL AND ctct.CLSKETQUA_VTYT_ID IS NULL)             and                 CT.MUCDICHCHUNGTU_ID = '1060'               and                 CT.KHOXUAT_ID = '32'               and                 CONVERT(date, CT.NGAYCHUNGTU) BETWEEN CONVERT(date, '9/20/2019 12:00:00 AM')  and  CONVERT(date, '9/20/2019 12:00:00 AM')               and                 CT.BENHVIEN_ID = 'HLU01'                         )PhieuXuat          ORDER BY PhieuXuat.CHUNGTU_ID desc]
2019-09-20 17:00:06,969 [1] DEBUG - Statement Id: [DAO00030_GetList] PreparedStatement : [select *              from TT_DUOC_CHUNGTU              where BENHVIEN_ID = 'HLU01'                and                   TT_DUOC_CHUNGTU.CHUNGTU_ID = '137702'                               order by CHUNGTU_ID]
2019-09-20 17:00:07,102 [1] DEBUG - Statement Id: [DAO00030_CHUNGTUXUAT_CHITIET_GetList] PreparedStatement : [SELECT            ctct.*,            d.MADUOC, d.TENHANG, d.TENDUOCDAYDU, dvt.TENDONVITINH as DONVITINH,n.TENNGUONDUOC as NGUONHANG,            sln.SOLONHAP, sln.SOLOSANPHAM, sln.NGAYNHAP as NGAYNHAPLO, sln.HANDUNG as HANSUDUNG,            isnull(tk.SOLUONG,0) as SOLUONGTON,            LTRIM(ct.KHOXUAT_ID) + '_' + LTRIM(sln.DUOC_ID) + '_' + LTRIM(sln.NGUONDUOC_ID) as DUOC_KEY            , NLD.MANHOMLOAIDUOC, ld.MALOAIDUOC, D.SO_QDTT            FROM            TT_DUOC_CHUNGTU_CHITIET ctct            INNER JOIN TT_DUOC_CHUNGTU ct ON (ct.CHUNGTU_ID = ctct.CHUNGTU_ID)            INNER JOIN TT_DUOC_CHUNGTU_SOLONHAP sln ON (sln.SOLONHAP_ID = ctct.SOLONHAP_ID)            LEFT JOIN (            select xx.DUOCTONKHO_ID, xx.KHODUOC_ID, xx.DUOC_ID, xx.SOLONHAP_ID, xx.SOLUONG, xx.NGUONDUOC_ID, xx.BENHVIEN_ID from TT_DUOC_TONKHO xx            join ( select max(DUOCTONKHO_ID) as DUOCTONKHO_ID, KHODUOC_ID, DUOC_ID, SOLONHAP_ID, NGUONDUOC_ID            from TT_DUOC_TONKHO group by KHODUOC_ID, DUOC_ID, SOLONHAP_ID, NGUONDUOC_ID) yy on xx.DUOCTONKHO_ID=yy.DUOCTONKHO_ID            ) tk ON (tk.SOLONHAP_ID = sln.SOLONHAP_ID AND tk.DUOC_ID = sln.DUOC_ID and tk.KHODUOC_ID = ct.KHOXUAT_ID)            INNER JOIN TM_DUOC d ON (d.DUOC_ID = ctct.DUOC_ID)            INNER JOIN TM_NGUONHANG n ON (n.NGUONDUOC_ID = ctct.NGUONHANG_ID)            LEFT JOIN TM_DONVITINH dvt ON (dvt.DONVITINH_ID = ctct.DONVITINH_ID)            left join TM_LOAIDUOC LD on LD.LOAIDUOC_ID = D.LOAIDUOC_ID            LEFT JOIN TM_NHOMLOAIDUOC NLD on NLD.NHOMLOAIDUOC_ID = LD.NHOMLOAIDUOC_ID             where                             ct.CHUNGTU_ID = '137702'                       and                           ct.BENHVIEN_ID = 'HLU01'                                     order by CHUNGTUCHITIET_ID]
2019-09-20 17:00:07,225 [1] DEBUG - Statement Id: [DAO00030_KiemTraChungTuKhoaSo] PreparedStatement : [SELECT CHUNGTU_ID              FROM TT_DUOC_CHUNGTU              WHERE              MACHUNGTU = 'CS_KBX1319003090'              and BENHVIEN_ID = 'HLU01'              and              convert(date, NGAYCHUNGTU) <=              (              SELECT TOP 1 convert(date, KHOADENNGAY)              FROM TT_DUOC_KHOASOCHUNGTU              WHERE              KHODUOC_ID = '32'              and BENHVIEN_ID = 'HLU01'              AND KHOASO = '1'              ORDER BY KHOADENNGAY DESC              )]
2019-09-20 17:00:07,266 [1] DEBUG - Statement Id: [DAO00030_KiemTraChungTuDaChuyenKeToan] PreparedStatement : [SELECT CHUNGTU_ID            FROM TT_DUOC_CHUNGTU            WHERE            CHUNGTU_ID = '137702'            and IDCHUYEN IS NOT NULL            and BENHVIEN_ID = 'HLU01']
2019-09-20 17:00:07,295 [1] DEBUG - Statement Id: [DAO00030_KiemTraBenhNhanXuatVien] PreparedStatement : [select              TT.TOATHUOC_ID              from              TT_NOITRU_TOATHUOC TT              inner join TT_NOITRU_KHAMBENH KB on TT.KHAMBENH_ID = KB.KHAMBENH_ID              inner join TT_NOITRU_BENHAN BA on BA.BENHAN_ID = KB.BENHAN_ID              WHERE              BA.TRANGTHAI = 'DAXUATVIEN'              AND TT.CHUNGTU_ID =  137702              and TT.BENHVIEN_ID = 'HLU01']
2019-09-20 17:00:07,511 [1] DEBUG - Statement Id: [DAO00030_DUOCTONKHO_GetSoTonTheoDuoc] PreparedStatement : [SELECT              DUOC_ID,              SUM(SOLUONG) AS TONGTON              FROM              TT_DUOC_TONKHO              WHERE              KHODUOC_ID = '32'              and BENHVIEN_ID = 'HLU01'              and DUOC_ID IN (1)              GROUP BY DUOC_ID]
2019-09-20 17:00:07,561 [1] DEBUG - Statement Id: [DAO00030_DUOCTONKHO_GetSoTonTheoDuocTheoLo] PreparedStatement : [SELECT              DUOC_ID,SOLONHAP_ID,              SUM(SOLUONG) AS SOLUONGTONLO              FROM              TT_DUOC_TONKHO              WHERE              KHODUOC_ID = '32'              and BENHVIEN_ID = 'HLU01'              and DUOC_ID IN (1)              and SOLONHAP_ID IN (7541)              GROUP BY DUOC_ID, SOLONHAP_ID]
2019-09-20 17:00:07,610 [1] DEBUG - Statement Id: [DAO00030_DUOCTONKHO_GetSoTonTheoDuoc] PreparedStatement : [SELECT              DUOC_ID,              SUM(SOLUONG) AS TONGTON              FROM              TT_DUOC_TONKHO              WHERE              KHODUOC_ID = '32'              and BENHVIEN_ID = 'HLU01'              and DUOC_ID IN (1)              GROUP BY DUOC_ID]
2019-09-20 17:00:07,672 [1] DEBUG - Statement Id: [DAO00030_KTDaPhatSinhBienLai] PreparedStatement : [SELECT CHUNGTU_ID            FROM TT_NOITRU_TOATHUOC tt            INNER JOIN TT_VIENPHI vp on (tt.TOATHUOC_ID = vp.REF_ID and REF_TABLE = 'TT_NOITRU_TOATHUOC')            WHERE            CHUNGTU_ID = '137702'            AND tt.BENHVIEN_ID = 'HLU01'            AND HOADON_ID is not NULL            AND vp.HUY = '0'              union all            SELECT  kbtt.CHUNGTUPHATTHUOC_ID as CHUNGTU_ID            FROM TT_NGOAITRU_TOATHUOC tt            INNER JOIN TT_NGOAITRU_KHAMBENH_TOATHUOC kbtt on (kbtt.KHAMBENH_TOATHUOC_ID = tt.KHAMBENH_TOATHUOC_ID)            INNER JOIN TT_VIENPHI vp on (tt.TOATHUOC_ID = vp.REF_ID and REF_TABLE = 'TT_NGOAITRU_TOATHUOC')            WHERE            kbtt.CHUNGTUPHATTHUOC_ID = '137702'            AND tt.BENHVIEN_ID = 'HLU01'            AND HOADON_ID is not NULL            AND vp.HUY = '0'              union all            SELECT ctct.CHUNGTU_ID from            TT_DUOC_CHUNGTU_CHITIET ctct            INNER JOIN TT_HOADON_CHITIET_NGOAITRU hdct on (hdct.REF_ID = ctct.CHUNGTUCHITIET_ID and hdct.REF_TABLE = 'TT_DUOC_CHUNGTU_CHITIET')            INNER JOIN TT_HOADON hd on hd.HOADON_ID = hdct.HOADON_ID            WHERE            ctct.CHUNGTU_ID = '137702'                            AND hd.HUYHOADON = '0'              AND hd.HOANTRA = '0'                                  AND ctct.BENHVIEN_ID = 'HLU01'                        union all            SELECT CHUNGTU_ID            FROM TT_NGOAITRU_KHAMBENH_VTYT tt            INNER JOIN TT_VIENPHI vp on (tt.KHAMBENH_VTYT_ID = vp.REF_ID and REF_TABLE = 'TT_NGOAITRU_KHAMBENH_VTYT')            WHERE            CHUNGTU_ID = '137702'            AND tt.BENHVIEN_ID = 'HLU01'            AND HOADON_ID is not NULL            AND vp.HUY = '0'                        union all            SELECT CHUNGTU_ID            FROM TT_PHAUTHUAT_VTYT tt            INNER JOIN TT_VIENPHI vp on (tt.PHAUTHUAT_VTYT_ID = vp.REF_ID and REF_TABLE = 'TT_PHAUTHUAT_VTYT')            WHERE            CHUNGTU_ID = '137702'            AND tt.BENHVIEN_ID = 'HLU01'            AND HOADON_ID is not NULL            AND vp.HUY = '0'                        union all            SELECT CHUNGTU_ID            FROM TT_CLSKETQUA_VTYT tt            INNER JOIN TT_VIENPHI vp on (tt.CLSKETQUA_VTYT_ID = vp.REF_ID and REF_TABLE = 'TT_CLSKETQUA_VTYT')            WHERE            CHUNGTU_ID = '137702'            AND tt.BENHVIEN_ID = 'HLU01'            AND HOADON_ID is not NULL            AND vp.HUY = '0']
2019-09-20 17:00:13,814 [1] DEBUG - Statement Id: [DAO00030_Search_PhieuXuatSD] PreparedStatement : [SELECT DISTINCT phieuxuat.* FROM          (          select DISTINCT          CT.CHUNGTU_ID,          CT.SOCHUNGTU,          CT.MACHUNGTU,          CT.NGAYCHUNGTU,          CT.NGAYTAO,          CT.KHOXUAT_ID,          CT.NGUOIGIAO_ID,          CT.KHONHAP_ID,          CT.NGUOINHAN_ID,          PL.MACHUNGTU as MAPHIEULINH,          PL.NGAYCHUNGTU as NGAYPHIEULINH,          bn.MAYTE,          bn.TENBENHNHAN,          CONVERT(VARCHAR(10), KB.THOIGIANKHAM, 103) + ' - ' + CONVERT(VARCHAR(5), KB.THOIGIANKHAM, 108) as THOIGIANKHAM,          nl.TENNHANVIEN as NGUOILAP,          CT.DIENGIAI          from TT_DUOC_CHUNGTU CT          inner join TT_DUOC_CHUNGTU_CHITIET ctct on ct.CHUNGTU_ID = ctct.CHUNGTU_ID          inner join TT_NOITRU_TOATHUOC TT on ctct.TOATHUOCNOITRU_ID = TT.TOATHUOC_ID          inner join TT_NOITRU_KHAMBENH KB on kb.KHAMBENH_ID = TT.KHAMBENH_ID          inner join TT_BENHNHAN BN on TT.BENHNHAN_ID = BN.BENHNHAN_ID          left join TT_DUOC_PHIEULINH PL on PL.CHUNGTU_ID = CT.PHIEULINH_ID          left join TM_NHANVIEN nl on nl.NHANVIEN_ID = TT.NGUOITAO_ID           where                   CT.MUCDICHCHUNGTU_ID = '1060'               and                 CT.KHOXUAT_ID = '32'               and                 CONVERT(date, CT.NGAYCHUNGTU) BETWEEN CONVERT(date, '9/20/2019 12:00:00 AM')  and  CONVERT(date, '9/20/2019 12:00:00 AM')               and                 CT.BENHVIEN_ID = 'HLU01'                           UNION            select DISTINCT          CT.CHUNGTU_ID,          CT.SOCHUNGTU,          CT.MACHUNGTU,          CT.NGAYCHUNGTU,          CT.NGAYTAO,          CT.KHOXUAT_ID,          CT.NGUOIGIAO_ID,          CT.KHONHAP_ID,          CT.NGUOINHAN_ID,          PL.MACHUNGTU as MAPHIEULINH,          PL.NGAYCHUNGTU as NGAYPHIEULINH,          bn.MAYTE,          bn.TENBENHNHAN,          CONVERT(VARCHAR(10), KB.THOIGIANKHAM, 103) + ' - ' + CONVERT(VARCHAR(5), KB.THOIGIANKHAM, 108) as THOIGIANKHAM,          nl.TENNHANVIEN as NGUOILAP,          CT.DIENGIAI          from TT_DUOC_CHUNGTU CT          inner join TT_DUOC_CHUNGTU_CHITIET ctct on ct.CHUNGTU_ID = ctct.CHUNGTU_ID          inner join TT_NGOAITRU_KHAMBENH_VTYT vt on ctct.KHAMBENH_VTYT_ID = vt.KHAMBENH_VTYT_ID          inner join TT_NGOAITRU_KHAMBENH kb on kb.KHAMBENH_ID = vt.KHAMBENH_ID          inner join TT_BENHNHAN BN on bn.BENHNHAN_ID = kb.BENHNHAN_ID          left join TT_DUOC_PHIEULINH PL on PL.CHUNGTU_ID = CT.PHIEULINH_ID          left join TM_NHANVIEN nl on nl.NHANVIEN_ID = vt.NGUOITAO_ID           where                   CT.MUCDICHCHUNGTU_ID = '1060'               and                 CT.KHOXUAT_ID = '32'               and                 CONVERT(date, CT.NGAYCHUNGTU) BETWEEN CONVERT(date, '9/20/2019 12:00:00 AM')  and  CONVERT(date, '9/20/2019 12:00:00 AM')               and                 CT.BENHVIEN_ID = 'HLU01'                           UNION            select DISTINCT          CT.CHUNGTU_ID,          CT.SOCHUNGTU,          CT.MACHUNGTU,          CT.NGAYCHUNGTU,          CT.NGAYTAO,          CT.KHOXUAT_ID,          CT.NGUOIGIAO_ID,          CT.KHONHAP_ID,          CT.NGUOINHAN_ID,          PL.MACHUNGTU as MAPHIEULINH,          PL.NGAYCHUNGTU as NGAYPHIEULINH,          bn.MAYTE,          bn.TENBENHNHAN,          CONVERT(VARCHAR(10), pt.NGAYTHUCHIEN, 103) + ' - ' + CONVERT(VARCHAR(5), pt.NGAYTHUCHIEN, 108) as THOIGIANKHAM,          nl.TENNHANVIEN as NGUOILAP,          CT.DIENGIAI          from TT_DUOC_CHUNGTU CT          inner join TT_DUOC_CHUNGTU_CHITIET ctct on ct.CHUNGTU_ID = ctct.CHUNGTU_ID          inner join TT_PHAUTHUAT_VTYT vt on ctct.PHAUTHUAT_VTYT_ID = vt.PHAUTHUAT_VTYT_ID          inner join TT_PHAUTHUAT pt on pt.PHAUTHUAT_ID = vt.PHAUTHUAT_ID          inner join TT_TIEPNHAN tn on tn.TIEPNHAN_ID = pt.TIEPNHAN_ID          inner join TT_BENHNHAN bn on bn.BENHNHAN_ID = tn.BENHNHAN_ID          left join TT_DUOC_PHIEULINH PL on PL.CHUNGTU_ID = CT.PHIEULINH_ID          left join TM_NHANVIEN nl on nl.NHANVIEN_ID = pt.NGUOITAO_ID           where                   CT.MUCDICHCHUNGTU_ID = '1060'               and                 CT.KHOXUAT_ID = '32'               and                 CONVERT(date, CT.NGAYCHUNGTU) BETWEEN CONVERT(date, '9/20/2019 12:00:00 AM')  and  CONVERT(date, '9/20/2019 12:00:00 AM')               and                 CT.BENHVIEN_ID = 'HLU01'                           UNION            select DISTINCT          CT.CHUNGTU_ID,          CT.SOCHUNGTU,          CT.MACHUNGTU,          CT.NGAYCHUNGTU,          CT.NGAYTAO,          CT.KHOXUAT_ID,          CT.NGUOIGIAO_ID,          CT.KHONHAP_ID,          CT.NGUOINHAN_ID,          PL.MACHUNGTU as MAPHIEULINH,          PL.NGAYCHUNGTU as NGAYPHIEULINH,          bn.MAYTE,          bn.TENBENHNHAN,          CONVERT(VARCHAR(10), cls.NGAYTAO, 103) + ' - ' + CONVERT(VARCHAR(5), cls.NGAYTAO, 108) as THOIGIANKHAM,          nl.TENNHANVIEN as NGUOILAP,          CT.DIENGIAI          from TT_DUOC_CHUNGTU CT          inner join TT_DUOC_CHUNGTU_CHITIET ctct on ct.CHUNGTU_ID = ctct.CHUNGTU_ID          inner join TT_CLSKETQUA_VTYT cls on ctct.CLSKETQUA_VTYT_ID = cls.CLSKETQUA_VTYT_ID          inner join TT_DVYEUCAU DV on DV.DVYEUCAU_ID = CLS.DVYEUCAU_ID          inner join TT_BENHNHAN bn on bn.BENHNHAN_ID = DV.BENHNHAN_ID          left join TT_DUOC_PHIEULINH PL on PL.CHUNGTU_ID = CT.PHIEULINH_ID          left join TM_NHANVIEN nl on nl.NHANVIEN_ID = cls.NGUOITAO_ID           where                   CT.MUCDICHCHUNGTU_ID = '1060'               and                 CT.KHOXUAT_ID = '32'               and                 CONVERT(date, CT.NGAYCHUNGTU) BETWEEN CONVERT(date, '9/20/2019 12:00:00 AM')  and  CONVERT(date, '9/20/2019 12:00:00 AM')               and                 CT.BENHVIEN_ID = 'HLU01'                           UNION            select DISTINCT          CT.CHUNGTU_ID,          CT.SOCHUNGTU,          CT.MACHUNGTU,          CT.NGAYCHUNGTU,          CT.NGAYTAO,          CT.KHOXUAT_ID,          CT.NGUOIGIAO_ID,          CT.KHONHAP_ID,          CT.NGUOINHAN_ID,          PL.MACHUNGTU as MAPHIEULINH,          PL.NGAYCHUNGTU as NGAYPHIEULINH,          null as MAYTE,          null as TENBENHNHAN,          null as THOIGIANKHAM,          nl.TENNHANVIEN as NGUOILAP,          CT.DIENGIAI          from TT_DUOC_CHUNGTU CT          inner join TT_DUOC_CHUNGTU_CHITIET ctct on ct.CHUNGTU_ID = ctct.CHUNGTU_ID          left join TT_DUOC_PHIEULINH PL on PL.CHUNGTU_ID = CT.PHIEULINH_ID          left join TM_NHANVIEN nl on nl.NHANVIEN_ID = ct.NGUOITAO_ID          WHERE (ctct.TOATHUOCNOITRU_ID IS NULL AND ctct.KHAMBENH_VTYT_ID IS NULL AND ctct.PHAUTHUAT_VTYT_ID IS NULL AND ctct.CLSKETQUA_VTYT_ID IS NULL)             and                 CT.MUCDICHCHUNGTU_ID = '1060'               and                 CT.KHOXUAT_ID = '32'               and                 CONVERT(date, CT.NGAYCHUNGTU) BETWEEN CONVERT(date, '9/20/2019 12:00:00 AM')  and  CONVERT(date, '9/20/2019 12:00:00 AM')               and                 CT.BENHVIEN_ID = 'HLU01'                         )PhieuXuat          ORDER BY PhieuXuat.CHUNGTU_ID desc]
2019-09-20 17:00:15,991 [1] DEBUG - Statement Id: [DAO00030_GetList] PreparedStatement : [select *              from TT_DUOC_CHUNGTU              where BENHVIEN_ID = 'HLU01'                and                   TT_DUOC_CHUNGTU.CHUNGTU_ID = '137703'                               order by CHUNGTU_ID]
2019-09-20 17:00:16,967 [1] DEBUG - Statement Id: [DAO00030_CHUNGTUXUAT_CHITIET_GetList] PreparedStatement : [SELECT            ctct.*,            d.MADUOC, d.TENHANG, d.TENDUOCDAYDU, dvt.TENDONVITINH as DONVITINH,n.TENNGUONDUOC as NGUONHANG,            sln.SOLONHAP, sln.SOLOSANPHAM, sln.NGAYNHAP as NGAYNHAPLO, sln.HANDUNG as HANSUDUNG,            isnull(tk.SOLUONG,0) as SOLUONGTON,            LTRIM(ct.KHOXUAT_ID) + '_' + LTRIM(sln.DUOC_ID) + '_' + LTRIM(sln.NGUONDUOC_ID) as DUOC_KEY            , NLD.MANHOMLOAIDUOC, ld.MALOAIDUOC, D.SO_QDTT            FROM            TT_DUOC_CHUNGTU_CHITIET ctct            INNER JOIN TT_DUOC_CHUNGTU ct ON (ct.CHUNGTU_ID = ctct.CHUNGTU_ID)            INNER JOIN TT_DUOC_CHUNGTU_SOLONHAP sln ON (sln.SOLONHAP_ID = ctct.SOLONHAP_ID)            LEFT JOIN (            select xx.DUOCTONKHO_ID, xx.KHODUOC_ID, xx.DUOC_ID, xx.SOLONHAP_ID, xx.SOLUONG, xx.NGUONDUOC_ID, xx.BENHVIEN_ID from TT_DUOC_TONKHO xx            join ( select max(DUOCTONKHO_ID) as DUOCTONKHO_ID, KHODUOC_ID, DUOC_ID, SOLONHAP_ID, NGUONDUOC_ID            from TT_DUOC_TONKHO group by KHODUOC_ID, DUOC_ID, SOLONHAP_ID, NGUONDUOC_ID) yy on xx.DUOCTONKHO_ID=yy.DUOCTONKHO_ID            ) tk ON (tk.SOLONHAP_ID = sln.SOLONHAP_ID AND tk.DUOC_ID = sln.DUOC_ID and tk.KHODUOC_ID = ct.KHOXUAT_ID)            INNER JOIN TM_DUOC d ON (d.DUOC_ID = ctct.DUOC_ID)            INNER JOIN TM_NGUONHANG n ON (n.NGUONDUOC_ID = ctct.NGUONHANG_ID)            LEFT JOIN TM_DONVITINH dvt ON (dvt.DONVITINH_ID = ctct.DONVITINH_ID)            left join TM_LOAIDUOC LD on LD.LOAIDUOC_ID = D.LOAIDUOC_ID            LEFT JOIN TM_NHOMLOAIDUOC NLD on NLD.NHOMLOAIDUOC_ID = LD.NHOMLOAIDUOC_ID             where                             ct.CHUNGTU_ID = '137703'                       and                           ct.BENHVIEN_ID = 'HLU01'                                     order by CHUNGTUCHITIET_ID]
2019-09-20 17:00:17,290 [1] DEBUG - Statement Id: [DAO00030_KiemTraChungTuKhoaSo] PreparedStatement : [SELECT CHUNGTU_ID              FROM TT_DUOC_CHUNGTU              WHERE              MACHUNGTU = 'CS_KBX1319003091'              and BENHVIEN_ID = 'HLU01'              and              convert(date, NGAYCHUNGTU) <=              (              SELECT TOP 1 convert(date, KHOADENNGAY)              FROM TT_DUOC_KHOASOCHUNGTU              WHERE              KHODUOC_ID = '32'              and BENHVIEN_ID = 'HLU01'              AND KHOASO = '1'              ORDER BY KHOADENNGAY DESC              )]
2019-09-20 17:00:17,357 [1] DEBUG - Statement Id: [DAO00030_KiemTraChungTuDaChuyenKeToan] PreparedStatement : [SELECT CHUNGTU_ID            FROM TT_DUOC_CHUNGTU            WHERE            CHUNGTU_ID = '137703'            and IDCHUYEN IS NOT NULL            and BENHVIEN_ID = 'HLU01']
2019-09-20 17:00:17,408 [1] DEBUG - Statement Id: [DAO00030_KiemTraBenhNhanXuatVien] PreparedStatement : [select              TT.TOATHUOC_ID              from              TT_NOITRU_TOATHUOC TT              inner join TT_NOITRU_KHAMBENH KB on TT.KHAMBENH_ID = KB.KHAMBENH_ID              inner join TT_NOITRU_BENHAN BA on BA.BENHAN_ID = KB.BENHAN_ID              WHERE              BA.TRANGTHAI = 'DAXUATVIEN'              AND TT.CHUNGTU_ID =  137703              and TT.BENHVIEN_ID = 'HLU01']
2019-09-20 17:00:17,672 [1] DEBUG - Statement Id: [DAO00030_DUOCTONKHO_GetSoTonTheoDuoc] PreparedStatement : [SELECT              DUOC_ID,              SUM(SOLUONG) AS TONGTON              FROM              TT_DUOC_TONKHO              WHERE              KHODUOC_ID = '32'              and BENHVIEN_ID = 'HLU01'              and DUOC_ID IN (1)              GROUP BY DUOC_ID]
2019-09-20 17:00:17,725 [1] DEBUG - Statement Id: [DAO00030_DUOCTONKHO_GetSoTonTheoDuocTheoLo] PreparedStatement : [SELECT              DUOC_ID,SOLONHAP_ID,              SUM(SOLUONG) AS SOLUONGTONLO              FROM              TT_DUOC_TONKHO              WHERE              KHODUOC_ID = '32'              and BENHVIEN_ID = 'HLU01'              and DUOC_ID IN (1)              and SOLONHAP_ID IN (7541)              GROUP BY DUOC_ID, SOLONHAP_ID]
2019-09-20 17:00:17,766 [1] DEBUG - Statement Id: [DAO00030_DUOCTONKHO_GetSoTonTheoDuoc] PreparedStatement : [SELECT              DUOC_ID,              SUM(SOLUONG) AS TONGTON              FROM              TT_DUOC_TONKHO              WHERE              KHODUOC_ID = '32'              and BENHVIEN_ID = 'HLU01'              and DUOC_ID IN (1)              GROUP BY DUOC_ID]
2019-09-20 17:00:17,841 [1] DEBUG - Statement Id: [DAO00030_KTDaPhatSinhBienLai] PreparedStatement : [SELECT CHUNGTU_ID            FROM TT_NOITRU_TOATHUOC tt            INNER JOIN TT_VIENPHI vp on (tt.TOATHUOC_ID = vp.REF_ID and REF_TABLE = 'TT_NOITRU_TOATHUOC')            WHERE            CHUNGTU_ID = '137703'            AND tt.BENHVIEN_ID = 'HLU01'            AND HOADON_ID is not NULL            AND vp.HUY = '0'              union all            SELECT  kbtt.CHUNGTUPHATTHUOC_ID as CHUNGTU_ID            FROM TT_NGOAITRU_TOATHUOC tt            INNER JOIN TT_NGOAITRU_KHAMBENH_TOATHUOC kbtt on (kbtt.KHAMBENH_TOATHUOC_ID = tt.KHAMBENH_TOATHUOC_ID)            INNER JOIN TT_VIENPHI vp on (tt.TOATHUOC_ID = vp.REF_ID and REF_TABLE = 'TT_NGOAITRU_TOATHUOC')            WHERE            kbtt.CHUNGTUPHATTHUOC_ID = '137703'            AND tt.BENHVIEN_ID = 'HLU01'            AND HOADON_ID is not NULL            AND vp.HUY = '0'              union all            SELECT ctct.CHUNGTU_ID from            TT_DUOC_CHUNGTU_CHITIET ctct            INNER JOIN TT_HOADON_CHITIET_NGOAITRU hdct on (hdct.REF_ID = ctct.CHUNGTUCHITIET_ID and hdct.REF_TABLE = 'TT_DUOC_CHUNGTU_CHITIET')            INNER JOIN TT_HOADON hd on hd.HOADON_ID = hdct.HOADON_ID            WHERE            ctct.CHUNGTU_ID = '137703'                            AND hd.HUYHOADON = '0'              AND hd.HOANTRA = '0'                                  AND ctct.BENHVIEN_ID = 'HLU01'                        union all            SELECT CHUNGTU_ID            FROM TT_NGOAITRU_KHAMBENH_VTYT tt            INNER JOIN TT_VIENPHI vp on (tt.KHAMBENH_VTYT_ID = vp.REF_ID and REF_TABLE = 'TT_NGOAITRU_KHAMBENH_VTYT')            WHERE            CHUNGTU_ID = '137703'            AND tt.BENHVIEN_ID = 'HLU01'            AND HOADON_ID is not NULL            AND vp.HUY = '0'                        union all            SELECT CHUNGTU_ID            FROM TT_PHAUTHUAT_VTYT tt            INNER JOIN TT_VIENPHI vp on (tt.PHAUTHUAT_VTYT_ID = vp.REF_ID and REF_TABLE = 'TT_PHAUTHUAT_VTYT')            WHERE            CHUNGTU_ID = '137703'            AND tt.BENHVIEN_ID = 'HLU01'            AND HOADON_ID is not NULL            AND vp.HUY = '0'                        union all            SELECT CHUNGTU_ID            FROM TT_CLSKETQUA_VTYT tt            INNER JOIN TT_VIENPHI vp on (tt.CLSKETQUA_VTYT_ID = vp.REF_ID and REF_TABLE = 'TT_CLSKETQUA_VTYT')            WHERE            CHUNGTU_ID = '137703'            AND tt.BENHVIEN_ID = 'HLU01'            AND HOADON_ID is not NULL            AND vp.HUY = '0']
2019-09-20 17:00:22,708 [1] DEBUG - Statement Id: [DAO00030_KTDaPhatSinhBienLai] PreparedStatement : [SELECT CHUNGTU_ID            FROM TT_NOITRU_TOATHUOC tt            INNER JOIN TT_VIENPHI vp on (tt.TOATHUOC_ID = vp.REF_ID and REF_TABLE = 'TT_NOITRU_TOATHUOC')            WHERE            CHUNGTU_ID = '137703'            AND tt.BENHVIEN_ID = 'HLU01'            AND HOADON_ID is not NULL            AND vp.HUY = '0'              union all            SELECT  kbtt.CHUNGTUPHATTHUOC_ID as CHUNGTU_ID            FROM TT_NGOAITRU_TOATHUOC tt            INNER JOIN TT_NGOAITRU_KHAMBENH_TOATHUOC kbtt on (kbtt.KHAMBENH_TOATHUOC_ID = tt.KHAMBENH_TOATHUOC_ID)            INNER JOIN TT_VIENPHI vp on (tt.TOATHUOC_ID = vp.REF_ID and REF_TABLE = 'TT_NGOAITRU_TOATHUOC')            WHERE            kbtt.CHUNGTUPHATTHUOC_ID = '137703'            AND tt.BENHVIEN_ID = 'HLU01'            AND HOADON_ID is not NULL            AND vp.HUY = '0'              union all            SELECT ctct.CHUNGTU_ID from            TT_DUOC_CHUNGTU_CHITIET ctct            INNER JOIN TT_HOADON_CHITIET_NGOAITRU hdct on (hdct.REF_ID = ctct.CHUNGTUCHITIET_ID and hdct.REF_TABLE = 'TT_DUOC_CHUNGTU_CHITIET')            INNER JOIN TT_HOADON hd on hd.HOADON_ID = hdct.HOADON_ID            WHERE            ctct.CHUNGTU_ID = '137703'                            AND hd.HUYHOADON = '0'              AND hd.HOANTRA = '0'                                  AND ctct.BENHVIEN_ID = 'HLU01'                        union all            SELECT CHUNGTU_ID            FROM TT_NGOAITRU_KHAMBENH_VTYT tt            INNER JOIN TT_VIENPHI vp on (tt.KHAMBENH_VTYT_ID = vp.REF_ID and REF_TABLE = 'TT_NGOAITRU_KHAMBENH_VTYT')            WHERE            CHUNGTU_ID = '137703'            AND tt.BENHVIEN_ID = 'HLU01'            AND HOADON_ID is not NULL            AND vp.HUY = '0'                        union all            SELECT CHUNGTU_ID            FROM TT_PHAUTHUAT_VTYT tt            INNER JOIN TT_VIENPHI vp on (tt.PHAUTHUAT_VTYT_ID = vp.REF_ID and REF_TABLE = 'TT_PHAUTHUAT_VTYT')            WHERE            CHUNGTU_ID = '137703'            AND tt.BENHVIEN_ID = 'HLU01'            AND HOADON_ID is not NULL            AND vp.HUY = '0'                        union all            SELECT CHUNGTU_ID            FROM TT_CLSKETQUA_VTYT tt            INNER JOIN TT_VIENPHI vp on (tt.CLSKETQUA_VTYT_ID = vp.REF_ID and REF_TABLE = 'TT_CLSKETQUA_VTYT')            WHERE            CHUNGTU_ID = '137703'            AND tt.BENHVIEN_ID = 'HLU01'            AND HOADON_ID is not NULL            AND vp.HUY = '0']
2019-09-20 17:00:22,989 [1] DEBUG - Statement Id: [DAO00030_KTDaPhatSinhPhieuBHTN] PreparedStatement : [SELECT vp.VIENPHI_ID              FROM TT_VIENPHI vp              INNER JOIN TT_MIENGIAM_CHITIET  mgct on mgct.VIENPHI_ID = vp.VIENPHI_ID              INNER JOIN TT_DUOC_CHUNGTU ct on ct.TIEPNHAN_ID = vp.TIEPNHAN_ID              WHERE              ct.CHUNGTU_ID = '137703'              AND vp.DUOC_ID is not null              AND vp.BENHVIEN_ID = 'HLU01']
2019-09-20 17:00:23,092 [1] DEBUG - Statement Id: [DAO00030_KiemTraBenhNhanXuatVien] PreparedStatement : [select              TT.TOATHUOC_ID              from              TT_NOITRU_TOATHUOC TT              inner join TT_NOITRU_KHAMBENH KB on TT.KHAMBENH_ID = KB.KHAMBENH_ID              inner join TT_NOITRU_BENHAN BA on BA.BENHAN_ID = KB.BENHAN_ID              WHERE              BA.TRANGTHAI = 'DAXUATVIEN'              AND TT.CHUNGTU_ID =  137703              and TT.BENHVIEN_ID = 'HLU01']
2019-09-20 17:00:23,268 [1] DEBUG - Statement Id: [DAO00030_KiemTraChungTuKhoaSo] PreparedStatement : [SELECT CHUNGTU_ID              FROM TT_DUOC_CHUNGTU              WHERE              MACHUNGTU = 'CS_KBX1319003091'              and BENHVIEN_ID = 'HLU01'              and              convert(date, NGAYCHUNGTU) <=              (              SELECT TOP 1 convert(date, KHOADENNGAY)              FROM TT_DUOC_KHOASOCHUNGTU              WHERE              KHODUOC_ID = '32'              and BENHVIEN_ID = 'HLU01'              AND KHOASO = '1'              ORDER BY KHOADENNGAY DESC              )]
2019-09-20 17:00:23,301 [1] DEBUG - Statement Id: [DAO00030_KiemTraChungTuKhoaSo] PreparedStatement : [SELECT CHUNGTU_ID              FROM TT_DUOC_CHUNGTU              WHERE              MACHUNGTU = 'CS_KBX1319003091'              and BENHVIEN_ID = 'HLU01'              and              convert(date, NGAYCHUNGTU) <=              (              SELECT TOP 1 convert(date, KHOADENNGAY)              FROM TT_DUOC_KHOASOCHUNGTU              WHERE              KHODUOC_ID = '32'              and BENHVIEN_ID = 'HLU01'              AND KHOASO = '1'              ORDER BY KHOADENNGAY DESC              )]
2019-09-20 17:00:23,341 [1] DEBUG - Statement Id: [DAO00030_KiemTraChungTuDaChuyenKeToan] PreparedStatement : [SELECT CHUNGTU_ID            FROM TT_DUOC_CHUNGTU            WHERE            CHUNGTU_ID = '137703'            and IDCHUYEN IS NOT NULL            and BENHVIEN_ID = 'HLU01']
2019-09-20 17:00:23,385 [1] DEBUG - Statement Id: [DAO00030_KTDaPhatSinhBienLai] PreparedStatement : [SELECT CHUNGTU_ID            FROM TT_NOITRU_TOATHUOC tt            INNER JOIN TT_VIENPHI vp on (tt.TOATHUOC_ID = vp.REF_ID and REF_TABLE = 'TT_NOITRU_TOATHUOC')            WHERE            CHUNGTU_ID = '137703'            AND tt.BENHVIEN_ID = 'HLU01'            AND HOADON_ID is not NULL            AND vp.HUY = '0'              union all            SELECT  kbtt.CHUNGTUPHATTHUOC_ID as CHUNGTU_ID            FROM TT_NGOAITRU_TOATHUOC tt            INNER JOIN TT_NGOAITRU_KHAMBENH_TOATHUOC kbtt on (kbtt.KHAMBENH_TOATHUOC_ID = tt.KHAMBENH_TOATHUOC_ID)            INNER JOIN TT_VIENPHI vp on (tt.TOATHUOC_ID = vp.REF_ID and REF_TABLE = 'TT_NGOAITRU_TOATHUOC')            WHERE            kbtt.CHUNGTUPHATTHUOC_ID = '137703'            AND tt.BENHVIEN_ID = 'HLU01'            AND HOADON_ID is not NULL            AND vp.HUY = '0'              union all            SELECT ctct.CHUNGTU_ID from            TT_DUOC_CHUNGTU_CHITIET ctct            INNER JOIN TT_HOADON_CHITIET_NGOAITRU hdct on (hdct.REF_ID = ctct.CHUNGTUCHITIET_ID and hdct.REF_TABLE = 'TT_DUOC_CHUNGTU_CHITIET')            INNER JOIN TT_HOADON hd on hd.HOADON_ID = hdct.HOADON_ID            WHERE            ctct.CHUNGTU_ID = '137703'                            AND hd.HUYHOADON = '0'              AND hd.HOANTRA = '0'                                  AND ctct.BENHVIEN_ID = 'HLU01'                        union all            SELECT CHUNGTU_ID            FROM TT_NGOAITRU_KHAMBENH_VTYT tt            INNER JOIN TT_VIENPHI vp on (tt.KHAMBENH_VTYT_ID = vp.REF_ID and REF_TABLE = 'TT_NGOAITRU_KHAMBENH_VTYT')            WHERE            CHUNGTU_ID = '137703'            AND tt.BENHVIEN_ID = 'HLU01'            AND HOADON_ID is not NULL            AND vp.HUY = '0'                        union all            SELECT CHUNGTU_ID            FROM TT_PHAUTHUAT_VTYT tt            INNER JOIN TT_VIENPHI vp on (tt.PHAUTHUAT_VTYT_ID = vp.REF_ID and REF_TABLE = 'TT_PHAUTHUAT_VTYT')            WHERE            CHUNGTU_ID = '137703'            AND tt.BENHVIEN_ID = 'HLU01'            AND HOADON_ID is not NULL            AND vp.HUY = '0'                        union all            SELECT CHUNGTU_ID            FROM TT_CLSKETQUA_VTYT tt            INNER JOIN TT_VIENPHI vp on (tt.CLSKETQUA_VTYT_ID = vp.REF_ID and REF_TABLE = 'TT_CLSKETQUA_VTYT')            WHERE            CHUNGTU_ID = '137703'            AND tt.BENHVIEN_ID = 'HLU01'            AND HOADON_ID is not NULL            AND vp.HUY = '0']
2019-09-20 17:00:23,636 [1] DEBUG - Statement Id: [DAO00030_KiemTraBenhNhanXuatVien] PreparedStatement : [select              TT.TOATHUOC_ID              from              TT_NOITRU_TOATHUOC TT              inner join TT_NOITRU_KHAMBENH KB on TT.KHAMBENH_ID = KB.KHAMBENH_ID              inner join TT_NOITRU_BENHAN BA on BA.BENHAN_ID = KB.BENHAN_ID              WHERE              BA.TRANGTHAI = 'DAXUATVIEN'              AND TT.CHUNGTU_ID =  137703              and TT.BENHVIEN_ID = 'HLU01']
2019-09-20 17:00:23,804 [1] DEBUG - Statement Id: [DAO00030_DUOCTONKHO_GetSoTonTheoDuocTheoLo] PreparedStatement : [SELECT              DUOC_ID,SOLONHAP_ID,              SUM(SOLUONG) AS SOLUONGTONLO              FROM              TT_DUOC_TONKHO              WHERE              KHODUOC_ID = '32'              and BENHVIEN_ID = 'HLU01'              and DUOC_ID IN (1)              and SOLONHAP_ID IN (7541)              GROUP BY DUOC_ID, SOLONHAP_ID]
2019-09-20 17:00:23,835 [1] DEBUG - Statement Id: [DAO00030_LayNgayKhoaSoCuoi] PreparedStatement : [SELECT TOP 1 KHOADENNGAY              FROM TT_DUOC_KHOASOCHUNGTU              WHERE              KHODUOC_ID = '32'              and BENHVIEN_ID = 'HLU01'              and KHOASO = '1'              ORDER BY KHOADENNGAY DESC]
2019-09-20 17:00:23,929 [1] DEBUG - Statement Id: [DAO00030_GetList] PreparedStatement : [select *              from TT_DUOC_CHUNGTU              where BENHVIEN_ID = 'HLU01'                and                   TT_DUOC_CHUNGTU.MACHUNGTU = 'CS_KBX1319003091'                               order by CHUNGTU_ID]
2019-09-20 17:00:24,021 [1] DEBUG - Statement Id: [DAO00030_KiemTraBenhNhanXuatVien] PreparedStatement : [select              TT.TOATHUOC_ID              from              TT_NOITRU_TOATHUOC TT              inner join TT_NOITRU_KHAMBENH KB on TT.KHAMBENH_ID = KB.KHAMBENH_ID              inner join TT_NOITRU_BENHAN BA on BA.BENHAN_ID = KB.BENHAN_ID              WHERE              BA.TRANGTHAI = 'DAXUATVIEN'              AND TT.CHUNGTU_ID =  137703              and TT.BENHVIEN_ID = 'HLU01']
2019-09-20 17:00:24,223 [1] DEBUG - Statement Id: [DAO00030_Update] PreparedStatement : [update TT_DUOC_CHUNGTU set              NGAYCHUNGTU =  @param0               , LOAICHUNGTU =  @param1               , MUCDICHCHUNGTU_ID =  @param2               , MUCDICHCHUNGTU_CODE =  @param3               , KHOXUAT_ID =  @param4               , NGUOIGIAO_ID =  @param5               , NGUOIGIAO =  @param6               , KHONHAP_ID =  @param7               , NGUOINHAN_ID =  @param8               , NGUOINHAN =  @param9               , NGUOIKIEMTRA_ID =  @param10               , NGUOIKIEMTRA =  @param11               , NGUOIDUYET_ID =  @param12               , NGUOIDUYET =  @param13               , PHUONGPHAPXUAT =  @param14               , KETOANTRUONG_ID =  @param15               , KETOANTRUONG =  @param16               , THUKHO_ID =  @param17               , THUKHO =  @param18               , MAUHOADON =  @param19               , SOHOADON =  @param20               , SOSERI =  @param21               , NGAYHOADON =  @param22               , DIENGIAI =  @param23               , GIATRI =  @param24               , GIATRITHANHTOAN =  @param25               , TYLEVAT =  @param26               , GIATRIVAT =  @param27               , THUESUAT =  @param28               , GIATRITHUE =  @param29               , TYLECHIETKHAU =  @param30               , GIATRICHIETKHAU =  @param31               , TIENTE_ID =  @param32               , TYGIA =  @param33               , SOCHUNGTUGOC =  @param34               , NGAYCHUNGTUGOC =  @param35               , NHACUNGCAP_ID =  @param36               , HINHTHUCTHANHTOAN_ID =  @param37               , NGUONDUOC_ID =  @param38               , CHUNGTULIENQUAN_ID =  @param39               , KHAMBENH_ID =  @param40               , TOATHUOCNOITRU_ID =  @param41               , TIEPNHAN_ID =  @param42               , BENHAN_ID =  @param43               , DANHANTHUOC =  @param44               , NGUOINHAP_ID =  @param45               , NGAYNHAP =  @param46               , TRANGTHAI =  @param47               , PHIEULINH_ID =  @param48               , LOAITOATHUOC =  @param49               , DIENGIAINGHIEPVUPHATSINH =  @param50               , DONVIGIAO_ID =  @param51               , KHOSUDUNG_ID =  @param52               , LOAIVATTU_ID =  @param53               , BENHNHAN_ID =  @param54               , TENBENHNHAN =  @param55               , BACSIGIOITHIEU_ID =  @param56               , DOITUONG_ID =  @param57               , IDCHUYEN =  @param58               , CHUNGTUKETOAN =  @param59               , STATUS =  @param60               , TRANSFER_VIENPHI_ID =  @param61               , PHONGBAN_ID =  @param62               , BACSI_ID =  @param63               , TKNO =  @param64               , TKCO =  @param65               , MACHUNGTUREF =  @param66               , LOAICHUNGTUREF =  @param67               , PHIEULINHCANTRU_ID =  @param68               , KHOTHUCHIEN_ID =  @param69               , KHODOIUNG_ID =  @param70               , MENU_LOAIDUOC_ID =  @param71               , NGUOISUDUNGMAY_ID =  @param72               , GOITHAU_ID =  @param73               , XUATTHUOCBANGOAITRU =  @param74               , NGAYGIOCHUNGTU =  @param75               , NOIDAKHAM =  @param76               , HOIDONGKIEMNHAP_ID =  @param77               , HOIDONGTHANHLY_ID =  @param78               , CHUYENCHUNGTUID =  @param79               , CHUYENDOANHTHUID =  @param80               , LYDOXUATSUDUNG_ID =  @param81                         , NGAYCAPNHAT =  @param82               , NGUOICAPNHAT_ID =  @param83               where              CHUNGTU_ID = '137703']
2019-09-20 17:00:24,223 [1] DEBUG - Statement Id: [DAO00030_Update] Parameters: [@param0=[NGAYCHUNGTU,9/20/2019 4:59:11 PM], @param1=[LOAICHUNGTU,X], @param2=[MUCDICHCHUNGTU_ID,1060], @param3=[MUCDICHCHUNGTU_CODE,X13], @param4=[KHOXUAT_ID,32], @param5=[NGUOIGIAO_ID,0], @param6=[NGUOIGIAO,null], @param7=[KHONHAP_ID,null], @param8=[NGUOINHAN_ID,null], @param9=[NGUOINHAN,null], @param10=[NGUOIKIEMTRA_ID,null], @param11=[NGUOIKIEMTRA,null], @param12=[NGUOIDUYET_ID,null], @param13=[NGUOIDUYET,null], @param14=[PHUONGPHAPXUAT,0], @param15=[KETOANTRUONG_ID,null], @param16=[KETOANTRUONG,null], @param17=[THUKHO_ID,null], @param18=[THUKHO,null], @param19=[MAUHOADON,null], @param20=[SOHOADON,null], @param21=[SOSERI,null], @param22=[NGAYHOADON,null], @param23=[DIENGIAI,null], @param24=[GIATRI,null], @param25=[GIATRITHANHTOAN,null], @param26=[TYLEVAT,5], @param27=[GIATRIVAT,0], @param28=[THUESUAT,null], @param29=[GIATRITHUE,null], @param30=[TYLECHIETKHAU,null], @param31=[GIATRICHIETKHAU,null], @param32=[TIENTE_ID,null], @param33=[TYGIA,null], @param34=[SOCHUNGTUGOC,null], @param35=[NGAYCHUNGTUGOC,null], @param36=[NHACUNGCAP_ID,null], @param37=[HINHTHUCTHANHTOAN_ID,null], @param38=[NGUONDUOC_ID,null], @param39=[CHUNGTULIENQUAN_ID,null], @param40=[KHAMBENH_ID,null], @param41=[TOATHUOCNOITRU_ID,null], @param42=[TIEPNHAN_ID,null], @param43=[BENHAN_ID,null], @param44=[DANHANTHUOC, ], @param45=[NGUOINHAP_ID,null], @param46=[NGAYNHAP,null], @param47=[TRANGTHAI,DAXUAT], @param48=[PHIEULINH_ID,null], @param49=[LOAITOATHUOC,null], @param50=[DIENGIAINGHIEPVUPHATSINH,null], @param51=[DONVIGIAO_ID,null], @param52=[KHOSUDUNG_ID,null], @param53=[LOAIVATTU_ID,null], @param54=[BENHNHAN_ID,null], @param55=[TENBENHNHAN,null], @param56=[BACSIGIOITHIEU_ID,null], @param57=[DOITUONG_ID,null], @param58=[IDCHUYEN,null], @param59=[CHUNGTUKETOAN,null], @param60=[STATUS,null], @param61=[TRANSFER_VIENPHI_ID,null], @param62=[PHONGBAN_ID,62], @param63=[BACSI_ID,null], @param64=[TKNO,null], @param65=[TKCO,null], @param66=[MACHUNGTUREF,null], @param67=[LOAICHUNGTUREF,null], @param68=[PHIEULINHCANTRU_ID,null], @param69=[KHOTHUCHIEN_ID,null], @param70=[KHODOIUNG_ID,null], @param71=[MENU_LOAIDUOC_ID,null], @param72=[NGUOISUDUNGMAY_ID,null], @param73=[GOITHAU_ID,null], @param74=[XUATTHUOCBANGOAITRU,null], @param75=[NGAYGIOCHUNGTU,null], @param76=[NOIDAKHAM,null], @param77=[HOIDONGKIEMNHAP_ID,null], @param78=[HOIDONGTHANHLY_ID,null], @param79=[CHUYENCHUNGTUID,null], @param80=[CHUYENDOANHTHUID,null], @param81=[LYDOXUATSUDUNG_ID,8294], @param82=[NGAYCAPNHAT,9/20/2019 5:00:24 PM], @param83=[NGUOICAPNHAT_ID,0]]
2019-09-20 17:00:24,224 [1] DEBUG - Statement Id: [DAO00030_Update] Types: [@param0=[DateTime, System.DateTime], @param1=[String, System.String], @param2=[Int64, System.Int64], @param3=[String, System.String], @param4=[Int64, System.Int64], @param5=[Int64, System.Int64], @param6=[System.DBNull, null], @param7=[System.DBNull, null], @param8=[System.DBNull, null], @param9=[System.DBNull, null], @param10=[System.DBNull, null], @param11=[System.DBNull, null], @param12=[System.DBNull, null], @param13=[System.DBNull, null], @param14=[Int64, System.Int64], @param15=[System.DBNull, null], @param16=[System.DBNull, null], @param17=[System.DBNull, null], @param18=[System.DBNull, null], @param19=[System.DBNull, null], @param20=[System.DBNull, null], @param21=[System.DBNull, null], @param22=[System.DBNull, null], @param23=[System.DBNull, null], @param24=[System.DBNull, null], @param25=[System.DBNull, null], @param26=[Double, System.Double], @param27=[Double, System.Double], @param28=[System.DBNull, null], @param29=[System.DBNull, null], @param30=[System.DBNull, null], @param31=[System.DBNull, null], @param32=[System.DBNull, null], @param33=[System.DBNull, null], @param34=[System.DBNull, null], @param35=[System.DBNull, null], @param36=[System.DBNull, null], @param37=[System.DBNull, null], @param38=[System.DBNull, null], @param39=[System.DBNull, null], @param40=[System.DBNull, null], @param41=[System.DBNull, null], @param42=[System.DBNull, null], @param43=[System.DBNull, null], @param44=[String, System.String], @param45=[System.DBNull, null], @param46=[System.DBNull, null], @param47=[String, System.String], @param48=[System.DBNull, null], @param49=[System.DBNull, null], @param50=[System.DBNull, null], @param51=[System.DBNull, null], @param52=[System.DBNull, null], @param53=[System.DBNull, null], @param54=[System.DBNull, null], @param55=[System.DBNull, null], @param56=[System.DBNull, null], @param57=[System.DBNull, null], @param58=[System.DBNull, null], @param59=[System.DBNull, null], @param60=[System.DBNull, null], @param61=[System.DBNull, null], @param62=[Int64, System.Int64], @param63=[System.DBNull, null], @param64=[System.DBNull, null], @param65=[System.DBNull, null], @param66=[System.DBNull, null], @param67=[System.DBNull, null], @param68=[System.DBNull, null], @param69=[System.DBNull, null], @param70=[System.DBNull, null], @param71=[System.DBNull, null], @param72=[System.DBNull, null], @param73=[System.DBNull, null], @param74=[System.DBNull, null], @param75=[System.DBNull, null], @param76=[System.DBNull, null], @param77=[System.DBNull, null], @param78=[System.DBNull, null], @param79=[System.DBNull, null], @param80=[System.DBNull, null], @param81=[Int64, System.Int64], @param82=[DateTime, System.DateTime], @param83=[Int64, System.Int64]]
2019-09-20 17:00:24,332 [1] DEBUG - Statement Id: [DAO00030_CHUNGTUCT_DeleteP] PreparedStatement : [delete from TT_DUOC_CHUNGTU_CHITIET               where                             TT_DUOC_CHUNGTU_CHITIET.CHUNGTU_ID = '137703']
2019-09-20 17:00:24,363 [1] DEBUG - Statement Id: [DAO00030_TT_DUOC_TONKHO_LOG_Add] PreparedStatement : [DECLARE @KHODUOC_ID int               DECLARE @TONTRUOC numeric(18, 4)               DECLARE @TONSAU numeric(18, 4)               DECLARE @SOLUONGNHAP numeric(18, 4)               DECLARE @SOLUONGXUAT numeric(18, 4)                              IF( @param0  = 'N')               BEGIN                SET @KHODUOC_ID =  @param1                END               ELSE               BEGIN                 SET @KHODUOC_ID =  @param2                END                              SELECT @TONTRUOC = SOLUONG FROM TT_DUOC_TONKHO WHERE KHODUOC_ID = @KHODUOC_ID  AND DUOC_ID =  @param3  AND SOLONHAP_ID =  @param4  AND NGUONDUOC_ID =  @param5                               IF( @param0  = 'N' AND  @param6  = 'ADD')               BEGIN                SET @TONSAU = ISNULL(@TONTRUOC,0) +  @param7                 SET @SOLUONGNHAP =  @param7                 SET @SOLUONGXUAT = 0               END               IF( @param0  = 'N' AND  @param6  = 'DEL')               BEGIN                SET @TONSAU = ISNULL(@TONTRUOC,0) -  @param7                 SET @SOLUONGXUAT =  @param7                 SET @SOLUONGNHAP = 0               END                                         IF( @param0  = 'X' AND  @param6  = 'ADD')               BEGIN                SET @TONSAU = ISNULL(@TONTRUOC,0) -  @param8                 SET @SOLUONGXUAT =  @param8                 SET @SOLUONGNHAP = 0               END               IF( @param0  = 'X' AND  @param6  = 'DEL')               BEGIN                SET @TONSAU = ISNULL(@TONTRUOC,0) +  @param8                 SET @SOLUONGNHAP =  @param8                 SET @SOLUONGXUAT = 0                             END                        insert into TT_DUOC_TONKHO_LOG (                           CHUNGTUCHITIET_ID              ,CHUNGTU_ID              ,MACHUNGTU              ,LOAICHUNGTU              ,MUCDICHCHUNGTU_CODE              ,KHONHAP_ID              ,KHOXUAT_ID              ,DUOC_ID              ,SOLONHAP_ID              ,NGUONDUOC_ID              ,SOLUONGNHAP              ,SOLUONGXUAT              ,DONGIAMUA              ,DONGIAVON              ,TYLE_VAT              ,DONGIAVONVAT              ,TONTRUOC              ,TONSAU              ,ACTION              ,BENHVIEN_ID              ,NGAYTAO              ,NGUOITAO_ID                          ) values (              @param9               , @param10               , @param11               , @param0               , @param12               , @param1               , @param2               , @param3               , @param4               , @param5               ,@SOLUONGNHAP              ,@SOLUONGXUAT              , @param13               , @param14               , @param15               , @param16               ,@TONTRUOC              ,@TONSAU              , @param6               , @param17               , @param18               , @param19               )]
2019-09-20 17:00:24,363 [1] DEBUG - Statement Id: [DAO00030_TT_DUOC_TONKHO_LOG_Add] Parameters: [@param0=[LOAICHUNGTU,X], @param1=[KHONHAP_ID,null], @param2=[KHOXUAT_ID,32], @param3=[DUOC_ID,1], @param4=[SOLONHAP_ID,7541], @param5=[NGUONDUOC_ID,1], @param6=[ACTION,DEL], @param7=[SOLUONGNHAP,0], @param8=[SOLUONGXUAT,2], @param9=[CHUNGTUCHITIET_ID,1299046], @param10=[CHUNGTU_ID,137703], @param11=[MACHUNGTU,CS_KBX1319003091], @param12=[MUCDICHCHUNGTU_CODE,X13], @param13=[DONGIAMUA,945], @param14=[DONGIAVON,945], @param15=[TYLE_VAT,0], @param16=[DONGIAVONVAT,945], @param17=[BENHVIEN_ID,HLU01], @param18=[NGAYTAO,9/20/2019 5:00:24 PM], @param19=[NGUOITAO_ID,0]]
2019-09-20 17:00:24,363 [1] DEBUG - Statement Id: [DAO00030_TT_DUOC_TONKHO_LOG_Add] Types: [@param0=[String, System.String], @param1=[System.DBNull, null], @param2=[Int64, System.Int64], @param3=[Int64, System.Int64], @param4=[Int64, System.Int64], @param5=[Int64, System.Int64], @param6=[String, System.String], @param7=[Decimal, System.Decimal], @param8=[Decimal, System.Decimal], @param9=[Int64, System.Int64], @param10=[Int64, System.Int64], @param11=[String, System.String], @param12=[String, System.String], @param13=[Decimal, System.Decimal], @param14=[Decimal, System.Decimal], @param15=[Double, System.Double], @param16=[Double, System.Double], @param17=[String, System.String], @param18=[DateTime, System.DateTime], @param19=[Int64, System.Int64]]
2019-09-20 17:00:24,404 [1] DEBUG - Statement Id: [DAO00030_DUOC_TONKHO_BOOKING_NGOAITRU_Tang] PreparedStatement : [update TT_DUOC_TONKHO_BOOK_NGOAITRU            set            SOLUONG = SOLUONG +  @param0             , NGUOICAPNHAT_ID =  @param1             , NGAYCAPNHAT = getdate()            where            REF_TABLE =  @param2             AND REF_ID =  @param3             AND KHODUOC_ID =  @param4             AND DUOC_ID =  @param5             AND SOLUONG = 0            AND BENHVIEN_ID = 'HLU01']
2019-09-20 17:00:24,404 [1] DEBUG - Statement Id: [DAO00030_DUOC_TONKHO_BOOKING_NGOAITRU_Tang] Parameters: [@param0=[SOLUONGTHAYDOI,2], @param1=[NGUOICAPNHAT_ID,0], @param2=[REF_TABLE,TT_NGOAITRU_KHAMBENH_VTYT], @param3=[REF_ID,10593], @param4=[KHODUOC_ID,32], @param5=[DUOC_ID,1]]
2019-09-20 17:00:24,404 [1] DEBUG - Statement Id: [DAO00030_DUOC_TONKHO_BOOKING_NGOAITRU_Tang] Types: [@param0=[Double, System.Double], @param1=[Int64, System.Int64], @param2=[String, System.String], @param3=[Int64, System.Int64], @param4=[Int64, System.Int64], @param5=[Int64, System.Int64]]
2019-09-20 17:00:24,462 [1] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoVaBookingCOM23UpdateRedis] PreparedStatement : [declare @NGUONDUOC_MACDINH varchar(5) = '0';        declare @TOAMUANGOAI int = 0;        select @NGUONDUOC_MACDINH = isnull(VALUE,0) from TM_SYS_APPSETTINGS where CODE = 'PHA_NGUONDUOC'        select @TOAMUANGOAI = isnull(VALUE,0) from TM_SYS_APPSETTINGS where CODE = 'OPD_TOAMUANGOAI_DUNGDANHMUC_DUOC'                if @TOAMUANGOAI = 1        begin        select  distinct '0' + '_' + LTRIM(d.DUOC_ID) + '_' + @NGUONDUOC_MACDINH as DUOC_KEY, 0 as PHAMVI_ID, @NGUONDUOC_MACDINH as NGUONDUOC_ID, null as TENNGUONDUOC, null as TINHTIEN, d.DUOC_ID, ld.MALOAIDUOC,        d.SOVISA,d.TYLE_VAT,d.COTOA, d.MADUOC, d.TENHANG, d.TENDUOCDAYDU, dvt.TENDONVITINH as DONVITINH, d.BHYT,        d.TENHOATCHAT, d.HAMLUONG, d.HANGSANXUAT, d.QUOCGIA, d.LOAIDUOC_ID, d.DUONGDUNG_ID, d.TINHTIEN_PTTT,        ten.TENDUOC, ten.TENDUOC_EN, ten.MAQUOCTE, ten.MAQUOCTEBT,        '' as BHYT_TEXT        , ld.LOAIVATTU_ID        , d.BENHVIEN_ID,        999999999 as SOLUONG, d.VTYT_PHANLOAI, d.PHAMVI, d.SUASOLUONGTONGHOP, d.MADUOCBV, d.DANGTRINHBAY        , TAMNGUNG = CASE WHEN d.TAMNGUNG = '1' THEN '1' ELSE '0' END        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        where d.DUOC_ID in (1)        union all        select  distinct tk.DUOC_KEY, LTRIM(tk.PHAMVI_ID) as PHAMVI_ID, tk.NGUONDUOC_ID, nh.TENNGUONDUOC, nh.TINHTIEN, d.DUOC_ID, ld.MALOAIDUOC,        d.SOVISA,d.TYLE_VAT,d.COTOA, d.MADUOC, d.TENHANG, d.TENDUOCDAYDU, dvt.TENDONVITINH as DONVITINH, d.BHYT,        d.TENHOATCHAT, d.HAMLUONG, d.HANGSANXUAT, d.QUOCGIA, d.LOAIDUOC_ID, d.DUONGDUNG_ID, d.TINHTIEN_PTTT,        ten.TENDUOC, ten.TENDUOC_EN, ten.MAQUOCTE, ten.MAQUOCTEBT,        CASE WHEN d.BHYT = '1' THEN 'BHYT' ELSE '' END as BHYT_TEXT        , ld.LOAIVATTU_ID        , d.BENHVIEN_ID,        tk.SOLUONG, d.VTYT_PHANLOAI, d.PHAMVI, d.SUASOLUONGTONGHOP, d.MADUOCBV, d.DANGTRINHBAY        , TAMNGUNG = CASE WHEN d.TAMNGUNG = '1' OR nh.TAMNGUNG = '1' OR kd.TAMNGUNG = '1' THEN '1' ELSE '0' END        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        inner join        (        select  LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')) DUOC_KEY, (SUM(dtk.SOLUONG) - isnull(sum(A.SOLUONG),0) - isnull(sum(B.SOLUONG),0)) SOLUONG, pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        from (select sum(soluong) soluong,duoc_id,nguonduoc_id,khoduoc_id,benhvien_id from TT_DUOC_TONKHO  group by duoc_id,nguonduoc_id,khoduoc_id,benhvien_id) dtk        inner join TM_DUOC_PHAMVISD_MAPPING pvsd on dtk.KHODUOC_ID = pvsd.KHODUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NOITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) B on B.DUOC_ID = dtk.DUOC_ID and B.SOLUONG > 0 and B.PHAMVI_ID = pvsd.PHAMVI_ID and B.NGUONHANG_ID = dtk.NGUONDUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NGOAITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) A on A.DUOC_ID = dtk.DUOC_ID and A.SOLUONG > 0 and A.PHAMVI_ID = pvsd.PHAMVI_ID and A.NGUONHANG_ID = dtk.NGUONDUOC_ID        where dtk.SOLUONG > 0 and dtk.BENHVIEN_ID = 'HLU01'        group by LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')), pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        ) tk on tk.DUOC_ID = d.DUOC_ID        left join TM_DUOC_PHAMVISUDUNG kd on kd.PHAMVI_ID = tk.PHAMVI_ID and kd.BENHVIEN_ID = 'HLU01'        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = tk.NGUONDUOC_ID and nh.BENHVIEN_ID = 'HLU01'        where  d.BENHVIEN_ID = 'HLU01' and d.DUOC_ID in (1)        end        else        begin        select  distinct tk.DUOC_KEY, LTRIM(tk.PHAMVI_ID) as PHAMVI_ID, tk.NGUONDUOC_ID, nh.TENNGUONDUOC, nh.TINHTIEN, d.DUOC_ID, ld.MALOAIDUOC,        d.SOVISA,d.TYLE_VAT,d.COTOA, d.MADUOC, d.TENHANG, d.TENDUOCDAYDU, dvt.TENDONVITINH as DONVITINH, d.BHYT,        d.TENHOATCHAT, d.HAMLUONG, d.HANGSANXUAT, d.QUOCGIA, d.LOAIDUOC_ID, d.DUONGDUNG_ID, d.TINHTIEN_PTTT,        ten.TENDUOC, ten.TENDUOC_EN, ten.MAQUOCTE, ten.MAQUOCTEBT,        CASE WHEN d.BHYT = '1' THEN 'BHYT' ELSE '' END as BHYT_TEXT        , ld.LOAIVATTU_ID        , d.BENHVIEN_ID,        tk.SOLUONG, d.VTYT_PHANLOAI, d.PHAMVI, d.SUASOLUONGTONGHOP, d.MADUOCBV, d.DANGTRINHBAY        , TAMNGUNG = CASE WHEN d.TAMNGUNG = '1' OR nh.TAMNGUNG = '1' OR kd.TAMNGUNG = '1' THEN '1' ELSE '0' END        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        inner join        (        select  LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')) DUOC_KEY, (SUM(dtk.SOLUONG) - isnull(sum(A.SOLUONG),0) - isnull(sum(B.SOLUONG),0)) SOLUONG, pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        from (select sum(soluong) soluong,duoc_id,nguonduoc_id,khoduoc_id,benhvien_id from TT_DUOC_TONKHO  group by duoc_id,nguonduoc_id,khoduoc_id,benhvien_id) dtk        inner join TM_DUOC_PHAMVISD_MAPPING pvsd on dtk.KHODUOC_ID = pvsd.KHODUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NOITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) B on B.DUOC_ID = dtk.DUOC_ID and B.SOLUONG > 0 and B.PHAMVI_ID = pvsd.PHAMVI_ID and B.NGUONHANG_ID = dtk.NGUONDUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NGOAITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) A on A.DUOC_ID = dtk.DUOC_ID and A.SOLUONG > 0 and A.PHAMVI_ID = pvsd.PHAMVI_ID and A.NGUONHANG_ID = dtk.NGUONDUOC_ID        where dtk.SOLUONG > 0 and dtk.BENHVIEN_ID = 'HLU01'        group by LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')), pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        ) tk on tk.DUOC_ID = d.DUOC_ID        left join TM_DUOC_PHAMVISUDUNG kd on kd.PHAMVI_ID = tk.PHAMVI_ID and kd.BENHVIEN_ID = 'HLU01'        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = tk.NGUONDUOC_ID and nh.BENHVIEN_ID = 'HLU01'        where  d.BENHVIEN_ID = 'HLU01' and d.DUOC_ID in (1)        end]
2019-09-20 17:00:24,787 [1] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoCOM18UpdateRedis] PreparedStatement : [select distinct TT_TONKHO.DUOC_KEY, LTRIM(TT_TONKHO.KHODUOC_ID) as KHODUOC_ID, TM_DUOC.DUOC_ID, TM_LOAIDUOC.MALOAIDUOC,TM_DUOC.SOVISA,TM_DUOC.TYLE_VAT,TM_DUOC.COTOA,        TM_DUOC.MADUOC, TM_DUOC.TENHANG, TM_DUOC.TENDUOCDAYDU, dvt.TENDONVITINH as DONVITINH,  TM_DUOC.DONVITINH_ID,TM_DUOC.BHYT,        TM_DUOC.TENHOATCHAT,        TM_DUOC.HAMLUONG, TM_DUOC.HANGSANXUAT, TM_DUOC.QUOCGIA, TM_DUOC.LOAIDUOC_ID, TM_DUOC.DUONGDUNG_ID,        TM_TENDUOC.TENDUOC, TM_TENDUOC.TENDUOC_EN, TM_TENDUOC.MAQUOCTE, TM_TENDUOC.MAQUOCTEBT,        TM_LOAIDUOC.LOAIVATTU_ID, TM_DUOC.BENHVIEN_ID,        TT_TONKHO.SOLUONG, TM_DUOC.VTYT_PHANLOAI, TM_DUOC.PHAMVI, TT_TONKHO.NGUONDUOC_ID, NG.TENNGUONDUOC AS TENNGUONDUOC        , TAMNGUNG = CASE WHEN TM_DUOC.TAMNGUNG = '1' OR NG.TAMNGUNG = '1' OR KD.TAMNGUNG = '1' THEN '1' ELSE '0' END        , TM_DUOC.DANGTRINHBAY        from TM_DUOC        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = TM_DUOC.DONVITINH_ID        left join TM_TENDUOC on TM_DUOC.TENDUOC_ID = TM_TENDUOC.TENDUOC_ID and TM_DUOC.BENHVIEN_ID = 'HLU01' and TM_DUOC.TAMNGUNG = '0'        left join TM_LOAIDUOC on TM_LOAIDUOC.LOAIDUOC_ID = TM_DUOC.LOAIDUOC_ID and TM_LOAIDUOC.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG on (TM_LOAIDUOC.LOAIVATTU_ID = TM_DUOC_HANDUNG.LOAIDUOC and TM_DUOC_HANDUNG.BENHVIEN_ID = 'HLU01')        inner join        (select LTRIM(A.KHODUOC_ID) + '_' + LTRIM(A.DUOC_ID) + '_' + LTRIM(ISNULL(A.NGUONDUOC_ID,'')) as DUOC_KEY, A.KHODUOC_ID, A.DUOC_ID, A.NGUONDUOC_ID,        SUM(isnull(A.SOLUONG,0)) as SOLUONG        from        (select SUM(SOLUONG) as SOLUONG, KHODUOC_ID, DUOC_ID, NGUONDUOC_ID from TT_DUOC_TONKHO        where BENHVIEN_ID = 'HLU01' group by KHODUOC_ID, DUOC_ID, NGUONDUOC_ID) A        group by LTRIM(A.KHODUOC_ID) + '_' + LTRIM(A.DUOC_ID) + '_' + LTRIM(ISNULL(A.NGUONDUOC_ID,'')), A.KHODUOC_ID, A.DUOC_ID, NGUONDUOC_ID        ) TT_TONKHO on TT_TONKHO.DUOC_ID = TM_DUOC.DUOC_ID        LEFT JOIN TM_NGUONHANG NG ON NG.NGUONDUOC_ID = TT_TONKHO.NGUONDUOC_ID        LEFT JOIN TM_KHODUOC KD ON KD.KHODUOC_ID = TT_TONKHO.KHODUOC_ID        where TM_DUOC.BENHVIEN_ID = 'HLU01' and TT_TONKHO.SOLUONG >= 0        and TM_DUOC.DUOC_ID in (1)]
2019-09-20 17:00:24,889 [1] DEBUG - Statement Id: [DAO00030_DUOCTONKHO_Tang] PreparedStatement : [IF EXISTS            (              SELECT DUOCTONKHO_ID              FROM TT_DUOC_TONKHO              WHERE              KHODUOC_ID =  @param0               AND DUOC_ID =  @param1               AND  SOLONHAP_ID =  @param2             )            BEGIN              update TT_DUOC_TONKHO set              SOLUONG = SOLUONG +   @param3               , NGAYCAPNHAT =  @param4               , NGUOICAPNHAT_ID =  @param5               where              KHODUOC_ID =  @param0               AND DUOC_ID =  @param1               AND  SOLONHAP_ID =  @param2             END            ELSE            BEGIN              insert into TT_DUOC_TONKHO (              KHODUOC_ID              , DUOC_ID              , NGUONDUOC_ID              , SOLONHAP_ID              , DONGIAMUA              , SOLUONG              , BENHVIEN_ID              , NGAYTAO              , NGUOITAO_ID                     ) values (               @param0               ,  @param1               ,  @param6               ,  @param2               ,  @param7               ,  @param3               ,  @param8               ,  @param9               ,  @param10                        )            END]
2019-09-20 17:00:24,889 [1] DEBUG - Statement Id: [DAO00030_DUOCTONKHO_Tang] Parameters: [@param0=[KHODUOC_ID,32], @param1=[DUOC_ID,1], @param2=[SOLONHAP_ID,7541], @param3=[SOLUONGTHAYDOI,2], @param4=[NGAYCAPNHAT,9/20/2019 5:00:24 PM], @param5=[NGUOICAPNHAT_ID,0], @param6=[NGUONDUOC_ID,1], @param7=[DONGIAMUA,945], @param8=[BENHVIEN_ID,HLU01], @param9=[NGAYTAO,9/20/2019 4:59:11 PM], @param10=[NGUOITAO_ID,0]]
2019-09-20 17:00:24,889 [1] DEBUG - Statement Id: [DAO00030_DUOCTONKHO_Tang] Types: [@param0=[Int64, System.Int64], @param1=[Int64, System.Int64], @param2=[Int64, System.Int64], @param3=[Double, System.Double], @param4=[DateTime, System.DateTime], @param5=[Int64, System.Int64], @param6=[Int64, System.Int64], @param7=[Double, System.Double], @param8=[String, System.String], @param9=[DateTime, System.DateTime], @param10=[Int64, System.Int64]]
2019-09-20 17:00:24,936 [1] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoCOM18] PreparedStatement : [select  distinct TT_TONKHO.DUOC_KEY, LTRIM(TT_TONKHO.KHODUOC_ID) as KHODUOC_ID, TM_DUOC.DUOC_ID, TM_LOAIDUOC.MALOAIDUOC,TM_DUOC.SOVISA,TM_DUOC.TYLE_VAT,TM_DUOC.COTOA,        TM_DUOC.MADUOC, TM_DUOC.TENHANG, TM_DUOC.TENDUOCDAYDU, dvt.TENDONVITINH as DONVITINH, TM_DUOC.DONVITINH_ID, TM_DUOC.BHYT,        TM_DUOC.TENHOATCHAT, TM_DUOC.HAMLUONG, TM_DUOC.HANGSANXUAT, TM_DUOC.QUOCGIA, TM_DUOC.LOAIDUOC_ID, TM_DUOC.DUONGDUNG_ID,        TM_TENDUOC.TENDUOC, TM_TENDUOC.TENDUOC_EN, TM_TENDUOC.MAQUOCTE, TM_TENDUOC.MAQUOCTEBT,        TM_LOAIDUOC.LOAIVATTU_ID, TM_DUOC.BENHVIEN_ID,        TT_TONKHO.SOLUONG, TM_DUOC.VTYT_PHANLOAI, TM_DUOC.PHAMVI, TT_TONKHO.NGUONDUOC_ID, NG.TENNGUONDUOC        , TAMNGUNG = CASE WHEN TM_DUOC.TAMNGUNG = '1' OR NG.TAMNGUNG = '1' OR KD.TAMNGUNG = '1' THEN '1' ELSE '0' END        , TM_DUOC.DANGTRINHBAY        from TM_DUOC        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = TM_DUOC.DONVITINH_ID        left join TM_TENDUOC on TM_DUOC.TENDUOC_ID = TM_TENDUOC.TENDUOC_ID and TM_DUOC.BENHVIEN_ID = 'HLU01'  and TM_DUOC.TAMNGUNG = '0'        left join TM_LOAIDUOC on TM_LOAIDUOC.LOAIDUOC_ID = TM_DUOC.LOAIDUOC_ID and TM_LOAIDUOC.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG on (TM_LOAIDUOC.LOAIVATTU_ID = TM_DUOC_HANDUNG.LOAIDUOC and TM_DUOC_HANDUNG.BENHVIEN_ID = 'HLU01')        inner join        (select LTRIM(A.KHODUOC_ID) + '_' + LTRIM(A.DUOC_ID) + '_' + LTRIM(ISNULL(A.NGUONDUOC_ID,'')) as DUOC_KEY, A.KHODUOC_ID, A.DUOC_ID ,a.NGUONDUOC_ID,        SUM(isnull(A.SOLUONG,0)) as SOLUONG        from        (select SUM(SOLUONG) as SOLUONG, KHODUOC_ID, DUOC_ID, NGUONDUOC_ID from TT_DUOC_TONKHO        where KHODUOC_ID in (32) and DUOC_ID in (1) group by KHODUOC_ID, DUOC_ID, NGUONDUOC_ID        ) A        where A.KHODUOC_ID in (32) and A.DUOC_ID in (1)        group by LTRIM(A.KHODUOC_ID) + '_' + LTRIM(A.DUOC_ID) + '_' + LTRIM(A.NGUONDUOC_ID), A.KHODUOC_ID, A.DUOC_ID, A.NGUONDUOC_ID)        TT_TONKHO on TT_TONKHO.DUOC_ID = TM_DUOC.DUOC_ID        LEFT JOIN TM_NGUONHANG NG ON NG.NGUONDUOC_ID = TT_TONKHO.NGUONDUOC_ID        LEFT JOIN TM_KHODUOC KD ON KD.KHODUOC_ID = TT_TONKHO.KHODUOC_ID        where TM_DUOC.BENHVIEN_ID = 'HLU01' and TM_DUOC.DUOC_ID in (1)]
2019-09-20 17:00:24,990 [1] DEBUG - Statement Id: [DAO00030_GetListPhamViByKhoDuoc] PreparedStatement : [SELECT DISTINCT PHAMVI_ID          FROM TM_DUOC_PHAMVISD_MAPPING          WHERE          KHODUOC_ID IN (32)          AND BENHVIEN_ID ='HLU01'          AND TAMNGUNG = '0']
2019-09-20 17:00:25,024 [1] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoVaBookingCOM23] PreparedStatement : [declare @NGUONDUOC_MACDINH varchar(5) = '0';        declare @TOAMUANGOAI int = 0;        select @NGUONDUOC_MACDINH = isnull(VALUE,0) from TM_SYS_APPSETTINGS where CODE = 'PHA_NGUONDUOC'        select @TOAMUANGOAI = isnull(VALUE,0) from TM_SYS_APPSETTINGS where CODE = 'OPD_TOAMUANGOAI_DUNGDANHMUC_DUOC'                if @TOAMUANGOAI = 1        begin        select  distinct '0' + '_' + LTRIM(d.DUOC_ID) + '_' + @NGUONDUOC_MACDINH as DUOC_KEY, 0 as PHAMVI_ID, @NGUONDUOC_MACDINH as NGUONDUOC_ID, null as TENNGUONDUOC, null as TINHTIEN, d.DUOC_ID, ld.MALOAIDUOC,        d.SOVISA,d.TYLE_VAT,d.COTOA, d.MADUOC, d.TENHANG, d.TENDUOCDAYDU, dvt.TENDONVITINH as DONVITINH, d.BHYT,        d.TENHOATCHAT, d.HAMLUONG, d.HANGSANXUAT, d.QUOCGIA, d.LOAIDUOC_ID, d.DUONGDUNG_ID, d.TINHTIEN_PTTT,        ten.TENDUOC, ten.TENDUOC_EN, ten.MAQUOCTE, ten.MAQUOCTEBT,        '' as BHYT_TEXT        , ld.LOAIVATTU_ID        , d.BENHVIEN_ID,        999999999 as SOLUONG, d.VTYT_PHANLOAI, d.PHAMVI, d.SUASOLUONGTONGHOP, d.MADUOCBV, d.DANGTRINHBAY        , TAMNGUNG = CASE WHEN d.TAMNGUNG = '1' THEN '1' ELSE '0' END        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        where d.DUOC_ID in (1)        union all        select  distinct tk.DUOC_KEY, LTRIM(tk.PHAMVI_ID) as PHAMVI_ID, tk.NGUONDUOC_ID, nh.TENNGUONDUOC, nh.TINHTIEN, d.DUOC_ID, ld.MALOAIDUOC,        d.SOVISA,d.TYLE_VAT,d.COTOA, d.MADUOC, d.TENHANG, d.TENDUOCDAYDU, dvt.TENDONVITINH as DONVITINH, d.BHYT,        d.TENHOATCHAT, d.HAMLUONG, d.HANGSANXUAT, d.QUOCGIA, d.LOAIDUOC_ID, d.DUONGDUNG_ID, d.TINHTIEN_PTTT,        ten.TENDUOC, ten.TENDUOC_EN, ten.MAQUOCTE, ten.MAQUOCTEBT,        CASE WHEN d.BHYT = '1' THEN 'BHYT' ELSE '' END as BHYT_TEXT        , ld.LOAIVATTU_ID        , d.BENHVIEN_ID,        tk.SOLUONG, d.VTYT_PHANLOAI, d.PHAMVI, d.SUASOLUONGTONGHOP, d.MADUOCBV, d.DANGTRINHBAY        , TAMNGUNG = CASE WHEN d.TAMNGUNG = '1' OR nh.TAMNGUNG = '1' OR kd.TAMNGUNG = '1' THEN '1' ELSE '0' END        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        inner join        (        select  LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')) DUOC_KEY, (SUM(dtk.SOLUONG) - isnull(sum(A.SOLUONG),0) - isnull(sum(B.SOLUONG),0)) SOLUONG, pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        from (select sum(soluong) soluong,duoc_id,nguonduoc_id,khoduoc_id,benhvien_id from TT_DUOC_TONKHO  group by duoc_id,nguonduoc_id,khoduoc_id,benhvien_id) dtk        inner join TM_DUOC_PHAMVISD_MAPPING pvsd on dtk.KHODUOC_ID = pvsd.KHODUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NOITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) B on B.DUOC_ID = dtk.DUOC_ID and B.SOLUONG > 0 and B.PHAMVI_ID = pvsd.PHAMVI_ID and B.NGUONHANG_ID = dtk.NGUONDUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NGOAITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) A on A.DUOC_ID = dtk.DUOC_ID and A.SOLUONG > 0 and A.PHAMVI_ID = pvsd.PHAMVI_ID and A.NGUONHANG_ID = dtk.NGUONDUOC_ID        where dtk.SOLUONG > 0 and dtk.BENHVIEN_ID = 'HLU01'        group by LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')), pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        ) tk on tk.DUOC_ID = d.DUOC_ID        left join TM_DUOC_PHAMVISUDUNG kd on kd.PHAMVI_ID = tk.PHAMVI_ID and kd.BENHVIEN_ID = 'HLU01'        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = tk.NGUONDUOC_ID and nh.BENHVIEN_ID = 'HLU01'        where  d.BENHVIEN_ID = 'HLU01' and d.DUOC_ID in (1) and TK.PHAMVI_ID in (1055)        and tk.NGUONDUOC_ID in (1)         end        else        begin                select  distinct tk.DUOC_KEY, LTRIM(tk.PHAMVI_ID) as PHAMVI_ID, tk.NGUONDUOC_ID, nh.TENNGUONDUOC, nh.TINHTIEN, d.DUOC_ID, ld.MALOAIDUOC,        d.SOVISA,d.TYLE_VAT,d.COTOA, d.MADUOC, d.TENHANG, d.TENDUOCDAYDU, dvt.TENDONVITINH as DONVITINH, d.BHYT,        d.TENHOATCHAT, d.HAMLUONG, d.HANGSANXUAT, d.QUOCGIA, d.LOAIDUOC_ID, d.DUONGDUNG_ID, d.TINHTIEN_PTTT,        ten.TENDUOC, ten.TENDUOC_EN, ten.MAQUOCTE, ten.MAQUOCTEBT,        CASE WHEN d.BHYT = '1' THEN 'BHYT' ELSE '' END as BHYT_TEXT        , ld.LOAIVATTU_ID        , d.BENHVIEN_ID,        tk.SOLUONG, d.VTYT_PHANLOAI, d.PHAMVI, d.SUASOLUONGTONGHOP, d.MADUOCBV, d.DANGTRINHBAY        , TAMNGUNG = CASE WHEN d.TAMNGUNG = '1' OR nh.TAMNGUNG = '1' OR kd.TAMNGUNG = '1' THEN '1' ELSE '0' END        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        inner join        (        select  LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')) DUOC_KEY, (SUM(dtk.SOLUONG) - isnull(sum(A.SOLUONG),0) - isnull(sum(B.SOLUONG),0)) SOLUONG, pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        from (select sum(soluong) soluong,duoc_id,nguonduoc_id,khoduoc_id,benhvien_id from TT_DUOC_TONKHO  group by duoc_id,nguonduoc_id,khoduoc_id,benhvien_id) dtk        inner join TM_DUOC_PHAMVISD_MAPPING pvsd on dtk.KHODUOC_ID = pvsd.KHODUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NOITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) B on B.DUOC_ID = dtk.DUOC_ID and B.SOLUONG > 0 and B.PHAMVI_ID = pvsd.PHAMVI_ID and B.NGUONHANG_ID = dtk.NGUONDUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NGOAITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) A on A.DUOC_ID = dtk.DUOC_ID and A.SOLUONG > 0 and A.PHAMVI_ID = pvsd.PHAMVI_ID and A.NGUONHANG_ID = dtk.NGUONDUOC_ID        where dtk.SOLUONG > 0 and dtk.BENHVIEN_ID = 'HLU01'        group by LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')), pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        ) tk on tk.DUOC_ID = d.DUOC_ID        left join TM_DUOC_PHAMVISUDUNG kd on kd.PHAMVI_ID = tk.PHAMVI_ID and kd.BENHVIEN_ID = 'HLU01'        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = tk.NGUONDUOC_ID and nh.BENHVIEN_ID = 'HLU01'        where  d.BENHVIEN_ID = 'HLU01' and d.DUOC_ID in (1) and TK.PHAMVI_ID in (1055)        and tk.NGUONDUOC_ID in (1)         end]
2019-09-20 17:00:25,176 [1] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoCOM18UpdateRedis] PreparedStatement : [select distinct TT_TONKHO.DUOC_KEY, LTRIM(TT_TONKHO.KHODUOC_ID) as KHODUOC_ID, TM_DUOC.DUOC_ID, TM_LOAIDUOC.MALOAIDUOC,TM_DUOC.SOVISA,TM_DUOC.TYLE_VAT,TM_DUOC.COTOA,        TM_DUOC.MADUOC, TM_DUOC.TENHANG, TM_DUOC.TENDUOCDAYDU, dvt.TENDONVITINH as DONVITINH,  TM_DUOC.DONVITINH_ID,TM_DUOC.BHYT,        TM_DUOC.TENHOATCHAT,        TM_DUOC.HAMLUONG, TM_DUOC.HANGSANXUAT, TM_DUOC.QUOCGIA, TM_DUOC.LOAIDUOC_ID, TM_DUOC.DUONGDUNG_ID,        TM_TENDUOC.TENDUOC, TM_TENDUOC.TENDUOC_EN, TM_TENDUOC.MAQUOCTE, TM_TENDUOC.MAQUOCTEBT,        TM_LOAIDUOC.LOAIVATTU_ID, TM_DUOC.BENHVIEN_ID,        TT_TONKHO.SOLUONG, TM_DUOC.VTYT_PHANLOAI, TM_DUOC.PHAMVI, TT_TONKHO.NGUONDUOC_ID, NG.TENNGUONDUOC AS TENNGUONDUOC        , TAMNGUNG = CASE WHEN TM_DUOC.TAMNGUNG = '1' OR NG.TAMNGUNG = '1' OR KD.TAMNGUNG = '1' THEN '1' ELSE '0' END        , TM_DUOC.DANGTRINHBAY        from TM_DUOC        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = TM_DUOC.DONVITINH_ID        left join TM_TENDUOC on TM_DUOC.TENDUOC_ID = TM_TENDUOC.TENDUOC_ID and TM_DUOC.BENHVIEN_ID = 'HLU01' and TM_DUOC.TAMNGUNG = '0'        left join TM_LOAIDUOC on TM_LOAIDUOC.LOAIDUOC_ID = TM_DUOC.LOAIDUOC_ID and TM_LOAIDUOC.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG on (TM_LOAIDUOC.LOAIVATTU_ID = TM_DUOC_HANDUNG.LOAIDUOC and TM_DUOC_HANDUNG.BENHVIEN_ID = 'HLU01')        inner join        (select LTRIM(A.KHODUOC_ID) + '_' + LTRIM(A.DUOC_ID) + '_' + LTRIM(ISNULL(A.NGUONDUOC_ID,'')) as DUOC_KEY, A.KHODUOC_ID, A.DUOC_ID, A.NGUONDUOC_ID,        SUM(isnull(A.SOLUONG,0)) as SOLUONG        from        (select SUM(SOLUONG) as SOLUONG, KHODUOC_ID, DUOC_ID, NGUONDUOC_ID from TT_DUOC_TONKHO        where BENHVIEN_ID = 'HLU01' group by KHODUOC_ID, DUOC_ID, NGUONDUOC_ID) A        group by LTRIM(A.KHODUOC_ID) + '_' + LTRIM(A.DUOC_ID) + '_' + LTRIM(ISNULL(A.NGUONDUOC_ID,'')), A.KHODUOC_ID, A.DUOC_ID, NGUONDUOC_ID        ) TT_TONKHO on TT_TONKHO.DUOC_ID = TM_DUOC.DUOC_ID        LEFT JOIN TM_NGUONHANG NG ON NG.NGUONDUOC_ID = TT_TONKHO.NGUONDUOC_ID        LEFT JOIN TM_KHODUOC KD ON KD.KHODUOC_ID = TT_TONKHO.KHODUOC_ID        where TM_DUOC.BENHVIEN_ID = 'HLU01' and TT_TONKHO.SOLUONG >= 0        and TM_DUOC.DUOC_ID in (1)]
2019-09-20 17:00:25,244 [1] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoVaBookingCOM23UpdateRedis] PreparedStatement : [declare @NGUONDUOC_MACDINH varchar(5) = '0';        declare @TOAMUANGOAI int = 0;        select @NGUONDUOC_MACDINH = isnull(VALUE,0) from TM_SYS_APPSETTINGS where CODE = 'PHA_NGUONDUOC'        select @TOAMUANGOAI = isnull(VALUE,0) from TM_SYS_APPSETTINGS where CODE = 'OPD_TOAMUANGOAI_DUNGDANHMUC_DUOC'                if @TOAMUANGOAI = 1        begin        select  distinct '0' + '_' + LTRIM(d.DUOC_ID) + '_' + @NGUONDUOC_MACDINH as DUOC_KEY, 0 as PHAMVI_ID, @NGUONDUOC_MACDINH as NGUONDUOC_ID, null as TENNGUONDUOC, null as TINHTIEN, d.DUOC_ID, ld.MALOAIDUOC,        d.SOVISA,d.TYLE_VAT,d.COTOA, d.MADUOC, d.TENHANG, d.TENDUOCDAYDU, dvt.TENDONVITINH as DONVITINH, d.BHYT,        d.TENHOATCHAT, d.HAMLUONG, d.HANGSANXUAT, d.QUOCGIA, d.LOAIDUOC_ID, d.DUONGDUNG_ID, d.TINHTIEN_PTTT,        ten.TENDUOC, ten.TENDUOC_EN, ten.MAQUOCTE, ten.MAQUOCTEBT,        '' as BHYT_TEXT        , ld.LOAIVATTU_ID        , d.BENHVIEN_ID,        999999999 as SOLUONG, d.VTYT_PHANLOAI, d.PHAMVI, d.SUASOLUONGTONGHOP, d.MADUOCBV, d.DANGTRINHBAY        , TAMNGUNG = CASE WHEN d.TAMNGUNG = '1' THEN '1' ELSE '0' END        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        where d.DUOC_ID in (1)        union all        select  distinct tk.DUOC_KEY, LTRIM(tk.PHAMVI_ID) as PHAMVI_ID, tk.NGUONDUOC_ID, nh.TENNGUONDUOC, nh.TINHTIEN, d.DUOC_ID, ld.MALOAIDUOC,        d.SOVISA,d.TYLE_VAT,d.COTOA, d.MADUOC, d.TENHANG, d.TENDUOCDAYDU, dvt.TENDONVITINH as DONVITINH, d.BHYT,        d.TENHOATCHAT, d.HAMLUONG, d.HANGSANXUAT, d.QUOCGIA, d.LOAIDUOC_ID, d.DUONGDUNG_ID, d.TINHTIEN_PTTT,        ten.TENDUOC, ten.TENDUOC_EN, ten.MAQUOCTE, ten.MAQUOCTEBT,        CASE WHEN d.BHYT = '1' THEN 'BHYT' ELSE '' END as BHYT_TEXT        , ld.LOAIVATTU_ID        , d.BENHVIEN_ID,        tk.SOLUONG, d.VTYT_PHANLOAI, d.PHAMVI, d.SUASOLUONGTONGHOP, d.MADUOCBV, d.DANGTRINHBAY        , TAMNGUNG = CASE WHEN d.TAMNGUNG = '1' OR nh.TAMNGUNG = '1' OR kd.TAMNGUNG = '1' THEN '1' ELSE '0' END        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        inner join        (        select  LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')) DUOC_KEY, (SUM(dtk.SOLUONG) - isnull(sum(A.SOLUONG),0) - isnull(sum(B.SOLUONG),0)) SOLUONG, pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        from (select sum(soluong) soluong,duoc_id,nguonduoc_id,khoduoc_id,benhvien_id from TT_DUOC_TONKHO  group by duoc_id,nguonduoc_id,khoduoc_id,benhvien_id) dtk        inner join TM_DUOC_PHAMVISD_MAPPING pvsd on dtk.KHODUOC_ID = pvsd.KHODUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NOITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) B on B.DUOC_ID = dtk.DUOC_ID and B.SOLUONG > 0 and B.PHAMVI_ID = pvsd.PHAMVI_ID and B.NGUONHANG_ID = dtk.NGUONDUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NGOAITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) A on A.DUOC_ID = dtk.DUOC_ID and A.SOLUONG > 0 and A.PHAMVI_ID = pvsd.PHAMVI_ID and A.NGUONHANG_ID = dtk.NGUONDUOC_ID        where dtk.SOLUONG > 0 and dtk.BENHVIEN_ID = 'HLU01'        group by LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')), pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        ) tk on tk.DUOC_ID = d.DUOC_ID        left join TM_DUOC_PHAMVISUDUNG kd on kd.PHAMVI_ID = tk.PHAMVI_ID and kd.BENHVIEN_ID = 'HLU01'        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = tk.NGUONDUOC_ID and nh.BENHVIEN_ID = 'HLU01'        where  d.BENHVIEN_ID = 'HLU01' and d.DUOC_ID in (1)        end        else        begin        select  distinct tk.DUOC_KEY, LTRIM(tk.PHAMVI_ID) as PHAMVI_ID, tk.NGUONDUOC_ID, nh.TENNGUONDUOC, nh.TINHTIEN, d.DUOC_ID, ld.MALOAIDUOC,        d.SOVISA,d.TYLE_VAT,d.COTOA, d.MADUOC, d.TENHANG, d.TENDUOCDAYDU, dvt.TENDONVITINH as DONVITINH, d.BHYT,        d.TENHOATCHAT, d.HAMLUONG, d.HANGSANXUAT, d.QUOCGIA, d.LOAIDUOC_ID, d.DUONGDUNG_ID, d.TINHTIEN_PTTT,        ten.TENDUOC, ten.TENDUOC_EN, ten.MAQUOCTE, ten.MAQUOCTEBT,        CASE WHEN d.BHYT = '1' THEN 'BHYT' ELSE '' END as BHYT_TEXT        , ld.LOAIVATTU_ID        , d.BENHVIEN_ID,        tk.SOLUONG, d.VTYT_PHANLOAI, d.PHAMVI, d.SUASOLUONGTONGHOP, d.MADUOCBV, d.DANGTRINHBAY        , TAMNGUNG = CASE WHEN d.TAMNGUNG = '1' OR nh.TAMNGUNG = '1' OR kd.TAMNGUNG = '1' THEN '1' ELSE '0' END        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        inner join        (        select  LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')) DUOC_KEY, (SUM(dtk.SOLUONG) - isnull(sum(A.SOLUONG),0) - isnull(sum(B.SOLUONG),0)) SOLUONG, pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        from (select sum(soluong) soluong,duoc_id,nguonduoc_id,khoduoc_id,benhvien_id from TT_DUOC_TONKHO  group by duoc_id,nguonduoc_id,khoduoc_id,benhvien_id) dtk        inner join TM_DUOC_PHAMVISD_MAPPING pvsd on dtk.KHODUOC_ID = pvsd.KHODUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NOITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) B on B.DUOC_ID = dtk.DUOC_ID and B.SOLUONG > 0 and B.PHAMVI_ID = pvsd.PHAMVI_ID and B.NGUONHANG_ID = dtk.NGUONDUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NGOAITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) A on A.DUOC_ID = dtk.DUOC_ID and A.SOLUONG > 0 and A.PHAMVI_ID = pvsd.PHAMVI_ID and A.NGUONHANG_ID = dtk.NGUONDUOC_ID        where dtk.SOLUONG > 0 and dtk.BENHVIEN_ID = 'HLU01'        group by LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')), pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        ) tk on tk.DUOC_ID = d.DUOC_ID        left join TM_DUOC_PHAMVISUDUNG kd on kd.PHAMVI_ID = tk.PHAMVI_ID and kd.BENHVIEN_ID = 'HLU01'        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = tk.NGUONDUOC_ID and nh.BENHVIEN_ID = 'HLU01'        where  d.BENHVIEN_ID = 'HLU01' and d.DUOC_ID in (1)        end]
2019-09-20 17:00:25,479 [1] DEBUG - Statement Id: [DAO00030_RemoveChungTuVTYTNgoaiTru] PreparedStatement : [update TT_NGOAITRU_KHAMBENH_VTYT set            CHUNGTU_ID = null,            TRANGTHAI = null            where            CHUNGTU_ID =   @param0               update TT_VIENPHI set            DUYET = '0',            DATHUCHIEN = '0'            where            REF_TABLE = 'TT_NGOAITRU_KHAMBENH_VTYT'            AND REF_ID IN (10593)]
2019-09-20 17:00:25,479 [1] DEBUG - Statement Id: [DAO00030_RemoveChungTuVTYTNgoaiTru] Parameters: [@param0=[CHUNGTU_ID,137703]]
2019-09-20 17:00:25,479 [1] DEBUG - Statement Id: [DAO00030_RemoveChungTuVTYTNgoaiTru] Types: [@param0=[Int64, System.Int64]]
2019-09-20 17:00:25,522 [1] DEBUG - Statement Id: [DAO00030_CHUNGTUCT_Add] PreparedStatement : [insert into TT_DUOC_CHUNGTU_CHITIET (            CHUNGTU_ID            , DUOC_ID            , SOLONHAP_ID            , SOKIEMSOAT            , SOVISA            , HANDUNG            , DONVITINH_ID            , SOLUONGYEUCAU            , SOLUONGTHUCTE            , SOLUONGDAXUAT            , TIENTE_ID            , TYGIA            , DONGIAMUA            , DONGIA_BHYT            , DONGIABAN            , DONGIABAN_VAT            , DONGIAVON            , DONGIATHANHTOAN            , SOQUYEN            , SOHOADONVAT            , TYLEVAT            , GIATRIVAT            , TYLECHIETKHAU            , GIATRICHIETKHAU            , MIENPHI            , LYDOMIENPHI_ID            , SOCHUNGTUKETOAN            , SOCHUNGTUTIENMAT            , TRANGTHAI            , DAPHATSINHPHIEUXUAT            , DAPHATSINHPHIEUHOANTRA            , KHUYENMAI            , PHUONGPHAPXUAT            , DONDATHANG_ID            , GHICHUCHITIET            , NGUONHANG_ID            , DONGIAVONVAT            , THANHTIENMUA            , THANHTIENVON            , THANHTIENHOPDONG            , ISTACHLO            , DONVITINHBANDAU_ID            , SOLUONGBANDAU            , GOITHAU_ID            , DONGIATHAU            , DONGIAPO            , TYLEQUIDOI            , TOATHUOCNOITRU_ID            , KHAMBENH_VTYT_ID            , PHAUTHUAT_VTYT_ID            , CLSKETQUA_VTYT_ID            , TOATHUOCNGOAITRU_ID            , MASTER_ID            , BENHNHAN            , YLENH                                   , BENHVIEN_ID            , NGAYTAO            , NGUOITAO_ID            , NGAYCAPNHAT            , NGUOICAPNHAT_ID            , THANHTIENMUABANDAU            , SOLUONGQUIDOI            ) values (             @param0             ,  @param1             ,  @param2             ,  @param3             ,  @param4             ,  @param5             ,  @param6             ,  @param7             ,  @param8             ,  @param9             ,  @param10             ,  @param11             ,  @param12             ,  @param13             ,  @param14             ,  @param15             ,  @param16             ,  @param17             ,  @param18             ,  @param19             ,  @param20             ,  @param21             ,  @param22             ,  @param23             ,  @param24             ,  @param25             ,  @param26             ,  @param27             ,  @param28             ,  @param29             ,  @param30             ,  @param31             ,  @param32             ,  @param33             ,  @param34             ,  @param35             ,  @param36             ,  @param37             ,  @param38             ,  @param39             ,  @param40             ,  @param41             ,  @param42             ,  @param43             ,  @param44             ,  @param45             ,  @param46             ,  @param47             ,  @param48             ,  @param49             ,  @param50             ,  @param51             ,  @param52             ,  @param53             ,  @param54                          ,  @param55             ,  @param56             ,  @param57             ,  @param58             ,  @param59             ,  @param60             ,  @param61             )            select SCOPE_identity() as value]
2019-09-20 17:00:25,522 [1] DEBUG - Statement Id: [DAO00030_CHUNGTUCT_Add] Parameters: [@param0=[CHUNGTU_ID,137703], @param1=[DUOC_ID,1], @param2=[SOLONHAP_ID,7541], @param3=[SOKIEMSOAT,null], @param4=[SOVISA,1], @param5=[HANDUNG,12/12/2026 12:00:00 AM], @param6=[DONVITINH_ID,17], @param7=[SOLUONGYEUCAU,2], @param8=[SOLUONGTHUCTE,null], @param9=[SOLUONGDAXUAT,2], @param10=[TIENTE_ID,null], @param11=[TYGIA,null], @param12=[DONGIAMUA,945], @param13=[DONGIA_BHYT,null], @param14=[DONGIABAN,1030], @param15=[DONGIABAN_VAT,1030], @param16=[DONGIAVON,945], @param17=[DONGIATHANHTOAN,null], @param18=[SOQUYEN,null], @param19=[SOHOADONVAT,null], @param20=[TYLEVAT,0], @param21=[GIATRIVAT,null], @param22=[TYLECHIETKHAU,null], @param23=[GIATRICHIETKHAU,null], @param24=[MIENPHI,null], @param25=[LYDOMIENPHI_ID,null], @param26=[SOCHUNGTUKETOAN,null], @param27=[SOCHUNGTUTIENMAT,null], @param28=[TRANGTHAI,null], @param29=[DAPHATSINHPHIEUXUAT,null], @param30=[DAPHATSINHPHIEUHOANTRA,null], @param31=[KHUYENMAI,null], @param32=[PHUONGPHAPXUAT,null], @param33=[DONDATHANG_ID,null], @param34=[GHICHUCHITIET,null], @param35=[NGUONHANG_ID,1], @param36=[DONGIAVONVAT,945], @param37=[THANHTIENMUA,1890], @param38=[THANHTIENVON,1890], @param39=[THANHTIENHOPDONG,null], @param40=[ISTACHLO,null], @param41=[DONVITINHBANDAU_ID,null], @param42=[SOLUONGBANDAU,null], @param43=[GOITHAU_ID,null], @param44=[DONGIATHAU,1030], @param45=[DONGIAPO,null], @param46=[TYLEQUIDOI,null], @param47=[TOATHUOCNOITRU_ID,null], @param48=[KHAMBENH_VTYT_ID,10593], @param49=[PHAUTHUAT_VTYT_ID,null], @param50=[CLSKETQUA_VTYT_ID,null], @param51=[TOATHUOCNGOAITRU_ID,null], @param52=[MASTER_ID,0], @param53=[BENHNHAN,Người bệnh: 190043304 - Test Xn1 - 20/09/2019 - 16:50], @param54=[YLENH,null], @param55=[BENHVIEN_ID,HLU01], @param56=[NGAYTAO,9/20/2019 5:00:25 PM], @param57=[NGUOITAO_ID,0], @param58=[NGAYCAPNHAT,9/20/2019 5:00:25 PM], @param59=[NGUOICAPNHAT_ID,0], @param60=[THANHTIENMUABANDAU,null], @param61=[SOLUONGQUIDOI,null]]
2019-09-20 17:00:25,522 [1] DEBUG - Statement Id: [DAO00030_CHUNGTUCT_Add] Types: [@param0=[Int64, System.Int64], @param1=[Int64, System.Int64], @param2=[Int64, System.Int64], @param3=[System.DBNull, null], @param4=[String, System.String], @param5=[DateTime, System.DateTime], @param6=[Int64, System.Int64], @param7=[Double, System.Double], @param8=[System.DBNull, null], @param9=[Double, System.Double], @param10=[System.DBNull, null], @param11=[System.DBNull, null], @param12=[Double, System.Double], @param13=[System.DBNull, null], @param14=[Double, System.Double], @param15=[Double, System.Double], @param16=[Double, System.Double], @param17=[System.DBNull, null], @param18=[System.DBNull, null], @param19=[System.DBNull, null], @param20=[Double, System.Double], @param21=[System.DBNull, null], @param22=[System.DBNull, null], @param23=[System.DBNull, null], @param24=[System.DBNull, null], @param25=[System.DBNull, null], @param26=[System.DBNull, null], @param27=[System.DBNull, null], @param28=[System.DBNull, null], @param29=[System.DBNull, null], @param30=[System.DBNull, null], @param31=[System.DBNull, null], @param32=[System.DBNull, null], @param33=[System.DBNull, null], @param34=[System.DBNull, null], @param35=[Int64, System.Int64], @param36=[Double, System.Double], @param37=[Double, System.Double], @param38=[Double, System.Double], @param39=[System.DBNull, null], @param40=[System.DBNull, null], @param41=[System.DBNull, null], @param42=[System.DBNull, null], @param43=[System.DBNull, null], @param44=[Double, System.Double], @param45=[System.DBNull, null], @param46=[System.DBNull, null], @param47=[System.DBNull, null], @param48=[Int64, System.Int64], @param49=[System.DBNull, null], @param50=[System.DBNull, null], @param51=[System.DBNull, null], @param52=[Int64, System.Int64], @param53=[String, System.String], @param54=[System.DBNull, null], @param55=[String, System.String], @param56=[DateTime, System.DateTime], @param57=[Int64, System.Int64], @param58=[DateTime, System.DateTime], @param59=[Int64, System.Int64], @param60=[System.DBNull, null], @param61=[System.DBNull, null]]
2019-09-20 17:00:25,591 [1] DEBUG - Statement Id: [DAO00030_TT_DUOC_TONKHO_LOG_Add] PreparedStatement : [DECLARE @KHODUOC_ID int               DECLARE @TONTRUOC numeric(18, 4)               DECLARE @TONSAU numeric(18, 4)               DECLARE @SOLUONGNHAP numeric(18, 4)               DECLARE @SOLUONGXUAT numeric(18, 4)                              IF( @param0  = 'N')               BEGIN                SET @KHODUOC_ID =  @param1                END               ELSE               BEGIN                 SET @KHODUOC_ID =  @param2                END                              SELECT @TONTRUOC = SOLUONG FROM TT_DUOC_TONKHO WHERE KHODUOC_ID = @KHODUOC_ID  AND DUOC_ID =  @param3  AND SOLONHAP_ID =  @param4  AND NGUONDUOC_ID =  @param5                               IF( @param0  = 'N' AND  @param6  = 'ADD')               BEGIN                SET @TONSAU = ISNULL(@TONTRUOC,0) +  @param7                 SET @SOLUONGNHAP =  @param7                 SET @SOLUONGXUAT = 0               END               IF( @param0  = 'N' AND  @param6  = 'DEL')               BEGIN                SET @TONSAU = ISNULL(@TONTRUOC,0) -  @param7                 SET @SOLUONGXUAT =  @param7                 SET @SOLUONGNHAP = 0               END                                         IF( @param0  = 'X' AND  @param6  = 'ADD')               BEGIN                SET @TONSAU = ISNULL(@TONTRUOC,0) -  @param8                 SET @SOLUONGXUAT =  @param8                 SET @SOLUONGNHAP = 0               END               IF( @param0  = 'X' AND  @param6  = 'DEL')               BEGIN                SET @TONSAU = ISNULL(@TONTRUOC,0) +  @param8                 SET @SOLUONGNHAP =  @param8                 SET @SOLUONGXUAT = 0                             END                        insert into TT_DUOC_TONKHO_LOG (                           CHUNGTUCHITIET_ID              ,CHUNGTU_ID              ,MACHUNGTU              ,LOAICHUNGTU              ,MUCDICHCHUNGTU_CODE              ,KHONHAP_ID              ,KHOXUAT_ID              ,DUOC_ID              ,SOLONHAP_ID              ,NGUONDUOC_ID              ,SOLUONGNHAP              ,SOLUONGXUAT              ,DONGIAMUA              ,DONGIAVON              ,TYLE_VAT              ,DONGIAVONVAT              ,TONTRUOC              ,TONSAU              ,ACTION              ,BENHVIEN_ID              ,NGAYTAO              ,NGUOITAO_ID                          ) values (              @param9               , @param10               , @param11               , @param0               , @param12               , @param1               , @param2               , @param3               , @param4               , @param5               ,@SOLUONGNHAP              ,@SOLUONGXUAT              , @param13               , @param14               , @param15               , @param16               ,@TONTRUOC              ,@TONSAU              , @param6               , @param17               , @param18               , @param19               )]
2019-09-20 17:00:25,591 [1] DEBUG - Statement Id: [DAO00030_TT_DUOC_TONKHO_LOG_Add] Parameters: [@param0=[LOAICHUNGTU,X], @param1=[KHONHAP_ID,null], @param2=[KHOXUAT_ID,32], @param3=[DUOC_ID,1], @param4=[SOLONHAP_ID,7541], @param5=[NGUONDUOC_ID,1], @param6=[ACTION,ADD], @param7=[SOLUONGNHAP,null], @param8=[SOLUONGXUAT,2], @param9=[CHUNGTUCHITIET_ID,1299048], @param10=[CHUNGTU_ID,137703], @param11=[MACHUNGTU,CS_KBX1319003091], @param12=[MUCDICHCHUNGTU_CODE,X13], @param13=[DONGIAMUA,945], @param14=[DONGIAVON,945], @param15=[TYLE_VAT,0], @param16=[DONGIAVONVAT,945], @param17=[BENHVIEN_ID,HLU01], @param18=[NGAYTAO,9/20/2019 5:00:25 PM], @param19=[NGUOITAO_ID,0]]
2019-09-20 17:00:25,591 [1] DEBUG - Statement Id: [DAO00030_TT_DUOC_TONKHO_LOG_Add] Types: [@param0=[String, System.String], @param1=[System.DBNull, null], @param2=[Int64, System.Int64], @param3=[Int64, System.Int64], @param4=[Int64, System.Int64], @param5=[Int64, System.Int64], @param6=[String, System.String], @param7=[System.DBNull, null], @param8=[Decimal, System.Decimal], @param9=[Int64, System.Int64], @param10=[Int64, System.Int64], @param11=[String, System.String], @param12=[String, System.String], @param13=[Decimal, System.Decimal], @param14=[Decimal, System.Decimal], @param15=[Double, System.Double], @param16=[Double, System.Double], @param17=[String, System.String], @param18=[DateTime, System.DateTime], @param19=[Int64, System.Int64]]
2019-09-20 17:00:25,623 [1] DEBUG - Statement Id: [DAO00030_DUOC_TONKHO_BOOKING_NGOAITRU_Giam] PreparedStatement : [update TT_DUOC_TONKHO_BOOK_NGOAITRU            set            SOLUONG = 0                     ,NGAYCAPNHAT = getdate()            where            REF_TABLE = 'TT_NGOAITRU_KHAMBENH_VTYT'            AND REF_ID = '10593'                AND BENHVIEN_ID = 'HLU01']
2019-09-20 17:00:25,689 [1] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoVaBookingCOM23UpdateRedis] PreparedStatement : [declare @NGUONDUOC_MACDINH varchar(5) = '0';        declare @TOAMUANGOAI int = 0;        select @NGUONDUOC_MACDINH = isnull(VALUE,0) from TM_SYS_APPSETTINGS where CODE = 'PHA_NGUONDUOC'        select @TOAMUANGOAI = isnull(VALUE,0) from TM_SYS_APPSETTINGS where CODE = 'OPD_TOAMUANGOAI_DUNGDANHMUC_DUOC'                if @TOAMUANGOAI = 1        begin        select  distinct '0' + '_' + LTRIM(d.DUOC_ID) + '_' + @NGUONDUOC_MACDINH as DUOC_KEY, 0 as PHAMVI_ID, @NGUONDUOC_MACDINH as NGUONDUOC_ID, null as TENNGUONDUOC, null as TINHTIEN, d.DUOC_ID, ld.MALOAIDUOC,        d.SOVISA,d.TYLE_VAT,d.COTOA, d.MADUOC, d.TENHANG, d.TENDUOCDAYDU, dvt.TENDONVITINH as DONVITINH, d.BHYT,        d.TENHOATCHAT, d.HAMLUONG, d.HANGSANXUAT, d.QUOCGIA, d.LOAIDUOC_ID, d.DUONGDUNG_ID, d.TINHTIEN_PTTT,        ten.TENDUOC, ten.TENDUOC_EN, ten.MAQUOCTE, ten.MAQUOCTEBT,        '' as BHYT_TEXT        , ld.LOAIVATTU_ID        , d.BENHVIEN_ID,        999999999 as SOLUONG, d.VTYT_PHANLOAI, d.PHAMVI, d.SUASOLUONGTONGHOP, d.MADUOCBV, d.DANGTRINHBAY        , TAMNGUNG = CASE WHEN d.TAMNGUNG = '1' THEN '1' ELSE '0' END        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        where d.DUOC_ID in (1)        union all        select  distinct tk.DUOC_KEY, LTRIM(tk.PHAMVI_ID) as PHAMVI_ID, tk.NGUONDUOC_ID, nh.TENNGUONDUOC, nh.TINHTIEN, d.DUOC_ID, ld.MALOAIDUOC,        d.SOVISA,d.TYLE_VAT,d.COTOA, d.MADUOC, d.TENHANG, d.TENDUOCDAYDU, dvt.TENDONVITINH as DONVITINH, d.BHYT,        d.TENHOATCHAT, d.HAMLUONG, d.HANGSANXUAT, d.QUOCGIA, d.LOAIDUOC_ID, d.DUONGDUNG_ID, d.TINHTIEN_PTTT,        ten.TENDUOC, ten.TENDUOC_EN, ten.MAQUOCTE, ten.MAQUOCTEBT,        CASE WHEN d.BHYT = '1' THEN 'BHYT' ELSE '' END as BHYT_TEXT        , ld.LOAIVATTU_ID        , d.BENHVIEN_ID,        tk.SOLUONG, d.VTYT_PHANLOAI, d.PHAMVI, d.SUASOLUONGTONGHOP, d.MADUOCBV, d.DANGTRINHBAY        , TAMNGUNG = CASE WHEN d.TAMNGUNG = '1' OR nh.TAMNGUNG = '1' OR kd.TAMNGUNG = '1' THEN '1' ELSE '0' END        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        inner join        (        select  LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')) DUOC_KEY, (SUM(dtk.SOLUONG) - isnull(sum(A.SOLUONG),0) - isnull(sum(B.SOLUONG),0)) SOLUONG, pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        from (select sum(soluong) soluong,duoc_id,nguonduoc_id,khoduoc_id,benhvien_id from TT_DUOC_TONKHO  group by duoc_id,nguonduoc_id,khoduoc_id,benhvien_id) dtk        inner join TM_DUOC_PHAMVISD_MAPPING pvsd on dtk.KHODUOC_ID = pvsd.KHODUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NOITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) B on B.DUOC_ID = dtk.DUOC_ID and B.SOLUONG > 0 and B.PHAMVI_ID = pvsd.PHAMVI_ID and B.NGUONHANG_ID = dtk.NGUONDUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NGOAITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) A on A.DUOC_ID = dtk.DUOC_ID and A.SOLUONG > 0 and A.PHAMVI_ID = pvsd.PHAMVI_ID and A.NGUONHANG_ID = dtk.NGUONDUOC_ID        where dtk.SOLUONG > 0 and dtk.BENHVIEN_ID = 'HLU01'        group by LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')), pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        ) tk on tk.DUOC_ID = d.DUOC_ID        left join TM_DUOC_PHAMVISUDUNG kd on kd.PHAMVI_ID = tk.PHAMVI_ID and kd.BENHVIEN_ID = 'HLU01'        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = tk.NGUONDUOC_ID and nh.BENHVIEN_ID = 'HLU01'        where  d.BENHVIEN_ID = 'HLU01' and d.DUOC_ID in (1)        end        else        begin        select  distinct tk.DUOC_KEY, LTRIM(tk.PHAMVI_ID) as PHAMVI_ID, tk.NGUONDUOC_ID, nh.TENNGUONDUOC, nh.TINHTIEN, d.DUOC_ID, ld.MALOAIDUOC,        d.SOVISA,d.TYLE_VAT,d.COTOA, d.MADUOC, d.TENHANG, d.TENDUOCDAYDU, dvt.TENDONVITINH as DONVITINH, d.BHYT,        d.TENHOATCHAT, d.HAMLUONG, d.HANGSANXUAT, d.QUOCGIA, d.LOAIDUOC_ID, d.DUONGDUNG_ID, d.TINHTIEN_PTTT,        ten.TENDUOC, ten.TENDUOC_EN, ten.MAQUOCTE, ten.MAQUOCTEBT,        CASE WHEN d.BHYT = '1' THEN 'BHYT' ELSE '' END as BHYT_TEXT        , ld.LOAIVATTU_ID        , d.BENHVIEN_ID,        tk.SOLUONG, d.VTYT_PHANLOAI, d.PHAMVI, d.SUASOLUONGTONGHOP, d.MADUOCBV, d.DANGTRINHBAY        , TAMNGUNG = CASE WHEN d.TAMNGUNG = '1' OR nh.TAMNGUNG = '1' OR kd.TAMNGUNG = '1' THEN '1' ELSE '0' END        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        inner join        (        select  LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')) DUOC_KEY, (SUM(dtk.SOLUONG) - isnull(sum(A.SOLUONG),0) - isnull(sum(B.SOLUONG),0)) SOLUONG, pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        from (select sum(soluong) soluong,duoc_id,nguonduoc_id,khoduoc_id,benhvien_id from TT_DUOC_TONKHO  group by duoc_id,nguonduoc_id,khoduoc_id,benhvien_id) dtk        inner join TM_DUOC_PHAMVISD_MAPPING pvsd on dtk.KHODUOC_ID = pvsd.KHODUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NOITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) B on B.DUOC_ID = dtk.DUOC_ID and B.SOLUONG > 0 and B.PHAMVI_ID = pvsd.PHAMVI_ID and B.NGUONHANG_ID = dtk.NGUONDUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NGOAITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) A on A.DUOC_ID = dtk.DUOC_ID and A.SOLUONG > 0 and A.PHAMVI_ID = pvsd.PHAMVI_ID and A.NGUONHANG_ID = dtk.NGUONDUOC_ID        where dtk.SOLUONG > 0 and dtk.BENHVIEN_ID = 'HLU01'        group by LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')), pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        ) tk on tk.DUOC_ID = d.DUOC_ID        left join TM_DUOC_PHAMVISUDUNG kd on kd.PHAMVI_ID = tk.PHAMVI_ID and kd.BENHVIEN_ID = 'HLU01'        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = tk.NGUONDUOC_ID and nh.BENHVIEN_ID = 'HLU01'        where  d.BENHVIEN_ID = 'HLU01' and d.DUOC_ID in (1)        end]
2019-09-20 17:00:25,883 [1] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoCOM18UpdateRedis] PreparedStatement : [select distinct TT_TONKHO.DUOC_KEY, LTRIM(TT_TONKHO.KHODUOC_ID) as KHODUOC_ID, TM_DUOC.DUOC_ID, TM_LOAIDUOC.MALOAIDUOC,TM_DUOC.SOVISA,TM_DUOC.TYLE_VAT,TM_DUOC.COTOA,        TM_DUOC.MADUOC, TM_DUOC.TENHANG, TM_DUOC.TENDUOCDAYDU, dvt.TENDONVITINH as DONVITINH,  TM_DUOC.DONVITINH_ID,TM_DUOC.BHYT,        TM_DUOC.TENHOATCHAT,        TM_DUOC.HAMLUONG, TM_DUOC.HANGSANXUAT, TM_DUOC.QUOCGIA, TM_DUOC.LOAIDUOC_ID, TM_DUOC.DUONGDUNG_ID,        TM_TENDUOC.TENDUOC, TM_TENDUOC.TENDUOC_EN, TM_TENDUOC.MAQUOCTE, TM_TENDUOC.MAQUOCTEBT,        TM_LOAIDUOC.LOAIVATTU_ID, TM_DUOC.BENHVIEN_ID,        TT_TONKHO.SOLUONG, TM_DUOC.VTYT_PHANLOAI, TM_DUOC.PHAMVI, TT_TONKHO.NGUONDUOC_ID, NG.TENNGUONDUOC AS TENNGUONDUOC        , TAMNGUNG = CASE WHEN TM_DUOC.TAMNGUNG = '1' OR NG.TAMNGUNG = '1' OR KD.TAMNGUNG = '1' THEN '1' ELSE '0' END        , TM_DUOC.DANGTRINHBAY        from TM_DUOC        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = TM_DUOC.DONVITINH_ID        left join TM_TENDUOC on TM_DUOC.TENDUOC_ID = TM_TENDUOC.TENDUOC_ID and TM_DUOC.BENHVIEN_ID = 'HLU01' and TM_DUOC.TAMNGUNG = '0'        left join TM_LOAIDUOC on TM_LOAIDUOC.LOAIDUOC_ID = TM_DUOC.LOAIDUOC_ID and TM_LOAIDUOC.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG on (TM_LOAIDUOC.LOAIVATTU_ID = TM_DUOC_HANDUNG.LOAIDUOC and TM_DUOC_HANDUNG.BENHVIEN_ID = 'HLU01')        inner join        (select LTRIM(A.KHODUOC_ID) + '_' + LTRIM(A.DUOC_ID) + '_' + LTRIM(ISNULL(A.NGUONDUOC_ID,'')) as DUOC_KEY, A.KHODUOC_ID, A.DUOC_ID, A.NGUONDUOC_ID,        SUM(isnull(A.SOLUONG,0)) as SOLUONG        from        (select SUM(SOLUONG) as SOLUONG, KHODUOC_ID, DUOC_ID, NGUONDUOC_ID from TT_DUOC_TONKHO        where BENHVIEN_ID = 'HLU01' group by KHODUOC_ID, DUOC_ID, NGUONDUOC_ID) A        group by LTRIM(A.KHODUOC_ID) + '_' + LTRIM(A.DUOC_ID) + '_' + LTRIM(ISNULL(A.NGUONDUOC_ID,'')), A.KHODUOC_ID, A.DUOC_ID, NGUONDUOC_ID        ) TT_TONKHO on TT_TONKHO.DUOC_ID = TM_DUOC.DUOC_ID        LEFT JOIN TM_NGUONHANG NG ON NG.NGUONDUOC_ID = TT_TONKHO.NGUONDUOC_ID        LEFT JOIN TM_KHODUOC KD ON KD.KHODUOC_ID = TT_TONKHO.KHODUOC_ID        where TM_DUOC.BENHVIEN_ID = 'HLU01' and TT_TONKHO.SOLUONG >= 0        and TM_DUOC.DUOC_ID in (1)]
2019-09-20 17:00:25,935 [1] DEBUG - Statement Id: [DAO00030_DUOCTONKHO_Giam] PreparedStatement : [update TT_DUOC_TONKHO set            SOLUONG = SOLUONG -  @param0             , NGAYCAPNHAT =  getdate()            , NGUOICAPNHAT_ID =  @param1             where            KHODUOC_ID =  @param2             and DUOC_ID =  @param3             and SOLONHAP_ID =  @param4]
2019-09-20 17:00:25,935 [1] DEBUG - Statement Id: [DAO00030_DUOCTONKHO_Giam] Parameters: [@param0=[SOLUONGTHAYDOI,2], @param1=[NGUOICAPNHAT_ID,0], @param2=[KHODUOC_ID,32], @param3=[DUOC_ID,1], @param4=[SOLONHAP_ID,7541]]
2019-09-20 17:00:25,935 [1] DEBUG - Statement Id: [DAO00030_DUOCTONKHO_Giam] Types: [@param0=[Double, System.Double], @param1=[Int64, System.Int64], @param2=[Int64, System.Int64], @param3=[Int64, System.Int64], @param4=[Int64, System.Int64]]
2019-09-20 17:00:25,963 [1] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoCOM18] PreparedStatement : [select  distinct TT_TONKHO.DUOC_KEY, LTRIM(TT_TONKHO.KHODUOC_ID) as KHODUOC_ID, TM_DUOC.DUOC_ID, TM_LOAIDUOC.MALOAIDUOC,TM_DUOC.SOVISA,TM_DUOC.TYLE_VAT,TM_DUOC.COTOA,        TM_DUOC.MADUOC, TM_DUOC.TENHANG, TM_DUOC.TENDUOCDAYDU, dvt.TENDONVITINH as DONVITINH, TM_DUOC.DONVITINH_ID, TM_DUOC.BHYT,        TM_DUOC.TENHOATCHAT, TM_DUOC.HAMLUONG, TM_DUOC.HANGSANXUAT, TM_DUOC.QUOCGIA, TM_DUOC.LOAIDUOC_ID, TM_DUOC.DUONGDUNG_ID,        TM_TENDUOC.TENDUOC, TM_TENDUOC.TENDUOC_EN, TM_TENDUOC.MAQUOCTE, TM_TENDUOC.MAQUOCTEBT,        TM_LOAIDUOC.LOAIVATTU_ID, TM_DUOC.BENHVIEN_ID,        TT_TONKHO.SOLUONG, TM_DUOC.VTYT_PHANLOAI, TM_DUOC.PHAMVI, TT_TONKHO.NGUONDUOC_ID, NG.TENNGUONDUOC        , TAMNGUNG = CASE WHEN TM_DUOC.TAMNGUNG = '1' OR NG.TAMNGUNG = '1' OR KD.TAMNGUNG = '1' THEN '1' ELSE '0' END        , TM_DUOC.DANGTRINHBAY        from TM_DUOC        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = TM_DUOC.DONVITINH_ID        left join TM_TENDUOC on TM_DUOC.TENDUOC_ID = TM_TENDUOC.TENDUOC_ID and TM_DUOC.BENHVIEN_ID = 'HLU01'  and TM_DUOC.TAMNGUNG = '0'        left join TM_LOAIDUOC on TM_LOAIDUOC.LOAIDUOC_ID = TM_DUOC.LOAIDUOC_ID and TM_LOAIDUOC.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG on (TM_LOAIDUOC.LOAIVATTU_ID = TM_DUOC_HANDUNG.LOAIDUOC and TM_DUOC_HANDUNG.BENHVIEN_ID = 'HLU01')        inner join        (select LTRIM(A.KHODUOC_ID) + '_' + LTRIM(A.DUOC_ID) + '_' + LTRIM(ISNULL(A.NGUONDUOC_ID,'')) as DUOC_KEY, A.KHODUOC_ID, A.DUOC_ID ,a.NGUONDUOC_ID,        SUM(isnull(A.SOLUONG,0)) as SOLUONG        from        (select SUM(SOLUONG) as SOLUONG, KHODUOC_ID, DUOC_ID, NGUONDUOC_ID from TT_DUOC_TONKHO        where KHODUOC_ID in (32) and DUOC_ID in (1) group by KHODUOC_ID, DUOC_ID, NGUONDUOC_ID        ) A        where A.KHODUOC_ID in (32) and A.DUOC_ID in (1)        group by LTRIM(A.KHODUOC_ID) + '_' + LTRIM(A.DUOC_ID) + '_' + LTRIM(A.NGUONDUOC_ID), A.KHODUOC_ID, A.DUOC_ID, A.NGUONDUOC_ID)        TT_TONKHO on TT_TONKHO.DUOC_ID = TM_DUOC.DUOC_ID        LEFT JOIN TM_NGUONHANG NG ON NG.NGUONDUOC_ID = TT_TONKHO.NGUONDUOC_ID        LEFT JOIN TM_KHODUOC KD ON KD.KHODUOC_ID = TT_TONKHO.KHODUOC_ID        where TM_DUOC.BENHVIEN_ID = 'HLU01' and TM_DUOC.DUOC_ID in (1)]
2019-09-20 17:00:25,997 [1] DEBUG - Statement Id: [DAO00030_GetListPhamViByKhoDuoc] PreparedStatement : [SELECT DISTINCT PHAMVI_ID          FROM TM_DUOC_PHAMVISD_MAPPING          WHERE          KHODUOC_ID IN (32)          AND BENHVIEN_ID ='HLU01'          AND TAMNGUNG = '0']
2019-09-20 17:00:26,025 [1] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoVaBookingCOM23] PreparedStatement : [declare @NGUONDUOC_MACDINH varchar(5) = '0';        declare @TOAMUANGOAI int = 0;        select @NGUONDUOC_MACDINH = isnull(VALUE,0) from TM_SYS_APPSETTINGS where CODE = 'PHA_NGUONDUOC'        select @TOAMUANGOAI = isnull(VALUE,0) from TM_SYS_APPSETTINGS where CODE = 'OPD_TOAMUANGOAI_DUNGDANHMUC_DUOC'                if @TOAMUANGOAI = 1        begin        select  distinct '0' + '_' + LTRIM(d.DUOC_ID) + '_' + @NGUONDUOC_MACDINH as DUOC_KEY, 0 as PHAMVI_ID, @NGUONDUOC_MACDINH as NGUONDUOC_ID, null as TENNGUONDUOC, null as TINHTIEN, d.DUOC_ID, ld.MALOAIDUOC,        d.SOVISA,d.TYLE_VAT,d.COTOA, d.MADUOC, d.TENHANG, d.TENDUOCDAYDU, dvt.TENDONVITINH as DONVITINH, d.BHYT,        d.TENHOATCHAT, d.HAMLUONG, d.HANGSANXUAT, d.QUOCGIA, d.LOAIDUOC_ID, d.DUONGDUNG_ID, d.TINHTIEN_PTTT,        ten.TENDUOC, ten.TENDUOC_EN, ten.MAQUOCTE, ten.MAQUOCTEBT,        '' as BHYT_TEXT        , ld.LOAIVATTU_ID        , d.BENHVIEN_ID,        999999999 as SOLUONG, d.VTYT_PHANLOAI, d.PHAMVI, d.SUASOLUONGTONGHOP, d.MADUOCBV, d.DANGTRINHBAY        , TAMNGUNG = CASE WHEN d.TAMNGUNG = '1' THEN '1' ELSE '0' END        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        where d.DUOC_ID in (1)        union all        select  distinct tk.DUOC_KEY, LTRIM(tk.PHAMVI_ID) as PHAMVI_ID, tk.NGUONDUOC_ID, nh.TENNGUONDUOC, nh.TINHTIEN, d.DUOC_ID, ld.MALOAIDUOC,        d.SOVISA,d.TYLE_VAT,d.COTOA, d.MADUOC, d.TENHANG, d.TENDUOCDAYDU, dvt.TENDONVITINH as DONVITINH, d.BHYT,        d.TENHOATCHAT, d.HAMLUONG, d.HANGSANXUAT, d.QUOCGIA, d.LOAIDUOC_ID, d.DUONGDUNG_ID, d.TINHTIEN_PTTT,        ten.TENDUOC, ten.TENDUOC_EN, ten.MAQUOCTE, ten.MAQUOCTEBT,        CASE WHEN d.BHYT = '1' THEN 'BHYT' ELSE '' END as BHYT_TEXT        , ld.LOAIVATTU_ID        , d.BENHVIEN_ID,        tk.SOLUONG, d.VTYT_PHANLOAI, d.PHAMVI, d.SUASOLUONGTONGHOP, d.MADUOCBV, d.DANGTRINHBAY        , TAMNGUNG = CASE WHEN d.TAMNGUNG = '1' OR nh.TAMNGUNG = '1' OR kd.TAMNGUNG = '1' THEN '1' ELSE '0' END        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        inner join        (        select  LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')) DUOC_KEY, (SUM(dtk.SOLUONG) - isnull(sum(A.SOLUONG),0) - isnull(sum(B.SOLUONG),0)) SOLUONG, pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        from (select sum(soluong) soluong,duoc_id,nguonduoc_id,khoduoc_id,benhvien_id from TT_DUOC_TONKHO  group by duoc_id,nguonduoc_id,khoduoc_id,benhvien_id) dtk        inner join TM_DUOC_PHAMVISD_MAPPING pvsd on dtk.KHODUOC_ID = pvsd.KHODUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NOITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) B on B.DUOC_ID = dtk.DUOC_ID and B.SOLUONG > 0 and B.PHAMVI_ID = pvsd.PHAMVI_ID and B.NGUONHANG_ID = dtk.NGUONDUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NGOAITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) A on A.DUOC_ID = dtk.DUOC_ID and A.SOLUONG > 0 and A.PHAMVI_ID = pvsd.PHAMVI_ID and A.NGUONHANG_ID = dtk.NGUONDUOC_ID        where dtk.SOLUONG > 0 and dtk.BENHVIEN_ID = 'HLU01'        group by LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')), pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        ) tk on tk.DUOC_ID = d.DUOC_ID        left join TM_DUOC_PHAMVISUDUNG kd on kd.PHAMVI_ID = tk.PHAMVI_ID and kd.BENHVIEN_ID = 'HLU01'        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = tk.NGUONDUOC_ID and nh.BENHVIEN_ID = 'HLU01'        where  d.BENHVIEN_ID = 'HLU01' and d.DUOC_ID in (1) and TK.PHAMVI_ID in (1055)        and tk.NGUONDUOC_ID in (1)         end        else        begin                select  distinct tk.DUOC_KEY, LTRIM(tk.PHAMVI_ID) as PHAMVI_ID, tk.NGUONDUOC_ID, nh.TENNGUONDUOC, nh.TINHTIEN, d.DUOC_ID, ld.MALOAIDUOC,        d.SOVISA,d.TYLE_VAT,d.COTOA, d.MADUOC, d.TENHANG, d.TENDUOCDAYDU, dvt.TENDONVITINH as DONVITINH, d.BHYT,        d.TENHOATCHAT, d.HAMLUONG, d.HANGSANXUAT, d.QUOCGIA, d.LOAIDUOC_ID, d.DUONGDUNG_ID, d.TINHTIEN_PTTT,        ten.TENDUOC, ten.TENDUOC_EN, ten.MAQUOCTE, ten.MAQUOCTEBT,        CASE WHEN d.BHYT = '1' THEN 'BHYT' ELSE '' END as BHYT_TEXT        , ld.LOAIVATTU_ID        , d.BENHVIEN_ID,        tk.SOLUONG, d.VTYT_PHANLOAI, d.PHAMVI, d.SUASOLUONGTONGHOP, d.MADUOCBV, d.DANGTRINHBAY        , TAMNGUNG = CASE WHEN d.TAMNGUNG = '1' OR nh.TAMNGUNG = '1' OR kd.TAMNGUNG = '1' THEN '1' ELSE '0' END        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        inner join        (        select  LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')) DUOC_KEY, (SUM(dtk.SOLUONG) - isnull(sum(A.SOLUONG),0) - isnull(sum(B.SOLUONG),0)) SOLUONG, pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        from (select sum(soluong) soluong,duoc_id,nguonduoc_id,khoduoc_id,benhvien_id from TT_DUOC_TONKHO  group by duoc_id,nguonduoc_id,khoduoc_id,benhvien_id) dtk        inner join TM_DUOC_PHAMVISD_MAPPING pvsd on dtk.KHODUOC_ID = pvsd.KHODUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NOITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) B on B.DUOC_ID = dtk.DUOC_ID and B.SOLUONG > 0 and B.PHAMVI_ID = pvsd.PHAMVI_ID and B.NGUONHANG_ID = dtk.NGUONDUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NGOAITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) A on A.DUOC_ID = dtk.DUOC_ID and A.SOLUONG > 0 and A.PHAMVI_ID = pvsd.PHAMVI_ID and A.NGUONHANG_ID = dtk.NGUONDUOC_ID        where dtk.SOLUONG > 0 and dtk.BENHVIEN_ID = 'HLU01'        group by LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')), pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        ) tk on tk.DUOC_ID = d.DUOC_ID        left join TM_DUOC_PHAMVISUDUNG kd on kd.PHAMVI_ID = tk.PHAMVI_ID and kd.BENHVIEN_ID = 'HLU01'        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = tk.NGUONDUOC_ID and nh.BENHVIEN_ID = 'HLU01'        where  d.BENHVIEN_ID = 'HLU01' and d.DUOC_ID in (1) and TK.PHAMVI_ID in (1055)        and tk.NGUONDUOC_ID in (1)         end]
2019-09-20 17:00:26,174 [1] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoCOM18UpdateRedis] PreparedStatement : [select distinct TT_TONKHO.DUOC_KEY, LTRIM(TT_TONKHO.KHODUOC_ID) as KHODUOC_ID, TM_DUOC.DUOC_ID, TM_LOAIDUOC.MALOAIDUOC,TM_DUOC.SOVISA,TM_DUOC.TYLE_VAT,TM_DUOC.COTOA,        TM_DUOC.MADUOC, TM_DUOC.TENHANG, TM_DUOC.TENDUOCDAYDU, dvt.TENDONVITINH as DONVITINH,  TM_DUOC.DONVITINH_ID,TM_DUOC.BHYT,        TM_DUOC.TENHOATCHAT,        TM_DUOC.HAMLUONG, TM_DUOC.HANGSANXUAT, TM_DUOC.QUOCGIA, TM_DUOC.LOAIDUOC_ID, TM_DUOC.DUONGDUNG_ID,        TM_TENDUOC.TENDUOC, TM_TENDUOC.TENDUOC_EN, TM_TENDUOC.MAQUOCTE, TM_TENDUOC.MAQUOCTEBT,        TM_LOAIDUOC.LOAIVATTU_ID, TM_DUOC.BENHVIEN_ID,        TT_TONKHO.SOLUONG, TM_DUOC.VTYT_PHANLOAI, TM_DUOC.PHAMVI, TT_TONKHO.NGUONDUOC_ID, NG.TENNGUONDUOC AS TENNGUONDUOC        , TAMNGUNG = CASE WHEN TM_DUOC.TAMNGUNG = '1' OR NG.TAMNGUNG = '1' OR KD.TAMNGUNG = '1' THEN '1' ELSE '0' END        , TM_DUOC.DANGTRINHBAY        from TM_DUOC        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = TM_DUOC.DONVITINH_ID        left join TM_TENDUOC on TM_DUOC.TENDUOC_ID = TM_TENDUOC.TENDUOC_ID and TM_DUOC.BENHVIEN_ID = 'HLU01' and TM_DUOC.TAMNGUNG = '0'        left join TM_LOAIDUOC on TM_LOAIDUOC.LOAIDUOC_ID = TM_DUOC.LOAIDUOC_ID and TM_LOAIDUOC.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG on (TM_LOAIDUOC.LOAIVATTU_ID = TM_DUOC_HANDUNG.LOAIDUOC and TM_DUOC_HANDUNG.BENHVIEN_ID = 'HLU01')        inner join        (select LTRIM(A.KHODUOC_ID) + '_' + LTRIM(A.DUOC_ID) + '_' + LTRIM(ISNULL(A.NGUONDUOC_ID,'')) as DUOC_KEY, A.KHODUOC_ID, A.DUOC_ID, A.NGUONDUOC_ID,        SUM(isnull(A.SOLUONG,0)) as SOLUONG        from        (select SUM(SOLUONG) as SOLUONG, KHODUOC_ID, DUOC_ID, NGUONDUOC_ID from TT_DUOC_TONKHO        where BENHVIEN_ID = 'HLU01' group by KHODUOC_ID, DUOC_ID, NGUONDUOC_ID) A        group by LTRIM(A.KHODUOC_ID) + '_' + LTRIM(A.DUOC_ID) + '_' + LTRIM(ISNULL(A.NGUONDUOC_ID,'')), A.KHODUOC_ID, A.DUOC_ID, NGUONDUOC_ID        ) TT_TONKHO on TT_TONKHO.DUOC_ID = TM_DUOC.DUOC_ID        LEFT JOIN TM_NGUONHANG NG ON NG.NGUONDUOC_ID = TT_TONKHO.NGUONDUOC_ID        LEFT JOIN TM_KHODUOC KD ON KD.KHODUOC_ID = TT_TONKHO.KHODUOC_ID        where TM_DUOC.BENHVIEN_ID = 'HLU01' and TT_TONKHO.SOLUONG >= 0        and TM_DUOC.DUOC_ID in (1)]
2019-09-20 17:00:26,232 [1] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoVaBookingCOM23UpdateRedis] PreparedStatement : [declare @NGUONDUOC_MACDINH varchar(5) = '0';        declare @TOAMUANGOAI int = 0;        select @NGUONDUOC_MACDINH = isnull(VALUE,0) from TM_SYS_APPSETTINGS where CODE = 'PHA_NGUONDUOC'        select @TOAMUANGOAI = isnull(VALUE,0) from TM_SYS_APPSETTINGS where CODE = 'OPD_TOAMUANGOAI_DUNGDANHMUC_DUOC'                if @TOAMUANGOAI = 1        begin        select  distinct '0' + '_' + LTRIM(d.DUOC_ID) + '_' + @NGUONDUOC_MACDINH as DUOC_KEY, 0 as PHAMVI_ID, @NGUONDUOC_MACDINH as NGUONDUOC_ID, null as TENNGUONDUOC, null as TINHTIEN, d.DUOC_ID, ld.MALOAIDUOC,        d.SOVISA,d.TYLE_VAT,d.COTOA, d.MADUOC, d.TENHANG, d.TENDUOCDAYDU, dvt.TENDONVITINH as DONVITINH, d.BHYT,        d.TENHOATCHAT, d.HAMLUONG, d.HANGSANXUAT, d.QUOCGIA, d.LOAIDUOC_ID, d.DUONGDUNG_ID, d.TINHTIEN_PTTT,        ten.TENDUOC, ten.TENDUOC_EN, ten.MAQUOCTE, ten.MAQUOCTEBT,        '' as BHYT_TEXT        , ld.LOAIVATTU_ID        , d.BENHVIEN_ID,        999999999 as SOLUONG, d.VTYT_PHANLOAI, d.PHAMVI, d.SUASOLUONGTONGHOP, d.MADUOCBV, d.DANGTRINHBAY        , TAMNGUNG = CASE WHEN d.TAMNGUNG = '1' THEN '1' ELSE '0' END        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        where d.DUOC_ID in (1)        union all        select  distinct tk.DUOC_KEY, LTRIM(tk.PHAMVI_ID) as PHAMVI_ID, tk.NGUONDUOC_ID, nh.TENNGUONDUOC, nh.TINHTIEN, d.DUOC_ID, ld.MALOAIDUOC,        d.SOVISA,d.TYLE_VAT,d.COTOA, d.MADUOC, d.TENHANG, d.TENDUOCDAYDU, dvt.TENDONVITINH as DONVITINH, d.BHYT,        d.TENHOATCHAT, d.HAMLUONG, d.HANGSANXUAT, d.QUOCGIA, d.LOAIDUOC_ID, d.DUONGDUNG_ID, d.TINHTIEN_PTTT,        ten.TENDUOC, ten.TENDUOC_EN, ten.MAQUOCTE, ten.MAQUOCTEBT,        CASE WHEN d.BHYT = '1' THEN 'BHYT' ELSE '' END as BHYT_TEXT        , ld.LOAIVATTU_ID        , d.BENHVIEN_ID,        tk.SOLUONG, d.VTYT_PHANLOAI, d.PHAMVI, d.SUASOLUONGTONGHOP, d.MADUOCBV, d.DANGTRINHBAY        , TAMNGUNG = CASE WHEN d.TAMNGUNG = '1' OR nh.TAMNGUNG = '1' OR kd.TAMNGUNG = '1' THEN '1' ELSE '0' END        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        inner join        (        select  LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')) DUOC_KEY, (SUM(dtk.SOLUONG) - isnull(sum(A.SOLUONG),0) - isnull(sum(B.SOLUONG),0)) SOLUONG, pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        from (select sum(soluong) soluong,duoc_id,nguonduoc_id,khoduoc_id,benhvien_id from TT_DUOC_TONKHO  group by duoc_id,nguonduoc_id,khoduoc_id,benhvien_id) dtk        inner join TM_DUOC_PHAMVISD_MAPPING pvsd on dtk.KHODUOC_ID = pvsd.KHODUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NOITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) B on B.DUOC_ID = dtk.DUOC_ID and B.SOLUONG > 0 and B.PHAMVI_ID = pvsd.PHAMVI_ID and B.NGUONHANG_ID = dtk.NGUONDUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NGOAITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) A on A.DUOC_ID = dtk.DUOC_ID and A.SOLUONG > 0 and A.PHAMVI_ID = pvsd.PHAMVI_ID and A.NGUONHANG_ID = dtk.NGUONDUOC_ID        where dtk.SOLUONG > 0 and dtk.BENHVIEN_ID = 'HLU01'        group by LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')), pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        ) tk on tk.DUOC_ID = d.DUOC_ID        left join TM_DUOC_PHAMVISUDUNG kd on kd.PHAMVI_ID = tk.PHAMVI_ID and kd.BENHVIEN_ID = 'HLU01'        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = tk.NGUONDUOC_ID and nh.BENHVIEN_ID = 'HLU01'        where  d.BENHVIEN_ID = 'HLU01' and d.DUOC_ID in (1)        end        else        begin        select  distinct tk.DUOC_KEY, LTRIM(tk.PHAMVI_ID) as PHAMVI_ID, tk.NGUONDUOC_ID, nh.TENNGUONDUOC, nh.TINHTIEN, d.DUOC_ID, ld.MALOAIDUOC,        d.SOVISA,d.TYLE_VAT,d.COTOA, d.MADUOC, d.TENHANG, d.TENDUOCDAYDU, dvt.TENDONVITINH as DONVITINH, d.BHYT,        d.TENHOATCHAT, d.HAMLUONG, d.HANGSANXUAT, d.QUOCGIA, d.LOAIDUOC_ID, d.DUONGDUNG_ID, d.TINHTIEN_PTTT,        ten.TENDUOC, ten.TENDUOC_EN, ten.MAQUOCTE, ten.MAQUOCTEBT,        CASE WHEN d.BHYT = '1' THEN 'BHYT' ELSE '' END as BHYT_TEXT        , ld.LOAIVATTU_ID        , d.BENHVIEN_ID,        tk.SOLUONG, d.VTYT_PHANLOAI, d.PHAMVI, d.SUASOLUONGTONGHOP, d.MADUOCBV, d.DANGTRINHBAY        , TAMNGUNG = CASE WHEN d.TAMNGUNG = '1' OR nh.TAMNGUNG = '1' OR kd.TAMNGUNG = '1' THEN '1' ELSE '0' END        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        inner join        (        select  LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')) DUOC_KEY, (SUM(dtk.SOLUONG) - isnull(sum(A.SOLUONG),0) - isnull(sum(B.SOLUONG),0)) SOLUONG, pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        from (select sum(soluong) soluong,duoc_id,nguonduoc_id,khoduoc_id,benhvien_id from TT_DUOC_TONKHO  group by duoc_id,nguonduoc_id,khoduoc_id,benhvien_id) dtk        inner join TM_DUOC_PHAMVISD_MAPPING pvsd on dtk.KHODUOC_ID = pvsd.KHODUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NOITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) B on B.DUOC_ID = dtk.DUOC_ID and B.SOLUONG > 0 and B.PHAMVI_ID = pvsd.PHAMVI_ID and B.NGUONHANG_ID = dtk.NGUONDUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NGOAITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) A on A.DUOC_ID = dtk.DUOC_ID and A.SOLUONG > 0 and A.PHAMVI_ID = pvsd.PHAMVI_ID and A.NGUONHANG_ID = dtk.NGUONDUOC_ID        where dtk.SOLUONG > 0 and dtk.BENHVIEN_ID = 'HLU01'        group by LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')), pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        ) tk on tk.DUOC_ID = d.DUOC_ID        left join TM_DUOC_PHAMVISUDUNG kd on kd.PHAMVI_ID = tk.PHAMVI_ID and kd.BENHVIEN_ID = 'HLU01'        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = tk.NGUONDUOC_ID and nh.BENHVIEN_ID = 'HLU01'        where  d.BENHVIEN_ID = 'HLU01' and d.DUOC_ID in (1)        end]
2019-09-20 17:00:26,459 [1] DEBUG - Statement Id: [DAO00030_GetList] PreparedStatement : [select *              from TT_DUOC_CHUNGTU              where BENHVIEN_ID = 'HLU01'                and                   TT_DUOC_CHUNGTU.CHUNGTU_ID = '137703'                               order by CHUNGTU_ID]
2019-09-20 17:00:27,199 [1] DEBUG - Statement Id: [DAO00030_CHUNGTUXUAT_CHITIET_GetList] PreparedStatement : [SELECT            ctct.*,            d.MADUOC, d.TENHANG, d.TENDUOCDAYDU, dvt.TENDONVITINH as DONVITINH,n.TENNGUONDUOC as NGUONHANG,            sln.SOLONHAP, sln.SOLOSANPHAM, sln.NGAYNHAP as NGAYNHAPLO, sln.HANDUNG as HANSUDUNG,            isnull(tk.SOLUONG,0) as SOLUONGTON,            LTRIM(ct.KHOXUAT_ID) + '_' + LTRIM(sln.DUOC_ID) + '_' + LTRIM(sln.NGUONDUOC_ID) as DUOC_KEY            , NLD.MANHOMLOAIDUOC, ld.MALOAIDUOC, D.SO_QDTT            FROM            TT_DUOC_CHUNGTU_CHITIET ctct            INNER JOIN TT_DUOC_CHUNGTU ct ON (ct.CHUNGTU_ID = ctct.CHUNGTU_ID)            INNER JOIN TT_DUOC_CHUNGTU_SOLONHAP sln ON (sln.SOLONHAP_ID = ctct.SOLONHAP_ID)            LEFT JOIN (            select xx.DUOCTONKHO_ID, xx.KHODUOC_ID, xx.DUOC_ID, xx.SOLONHAP_ID, xx.SOLUONG, xx.NGUONDUOC_ID, xx.BENHVIEN_ID from TT_DUOC_TONKHO xx            join ( select max(DUOCTONKHO_ID) as DUOCTONKHO_ID, KHODUOC_ID, DUOC_ID, SOLONHAP_ID, NGUONDUOC_ID            from TT_DUOC_TONKHO group by KHODUOC_ID, DUOC_ID, SOLONHAP_ID, NGUONDUOC_ID) yy on xx.DUOCTONKHO_ID=yy.DUOCTONKHO_ID            ) tk ON (tk.SOLONHAP_ID = sln.SOLONHAP_ID AND tk.DUOC_ID = sln.DUOC_ID and tk.KHODUOC_ID = ct.KHOXUAT_ID)            INNER JOIN TM_DUOC d ON (d.DUOC_ID = ctct.DUOC_ID)            INNER JOIN TM_NGUONHANG n ON (n.NGUONDUOC_ID = ctct.NGUONHANG_ID)            LEFT JOIN TM_DONVITINH dvt ON (dvt.DONVITINH_ID = ctct.DONVITINH_ID)            left join TM_LOAIDUOC LD on LD.LOAIDUOC_ID = D.LOAIDUOC_ID            LEFT JOIN TM_NHOMLOAIDUOC NLD on NLD.NHOMLOAIDUOC_ID = LD.NHOMLOAIDUOC_ID             where                             ct.CHUNGTU_ID = '137703'                       and                           ct.BENHVIEN_ID = 'HLU01'                                     order by CHUNGTUCHITIET_ID]
2019-09-20 17:00:27,327 [1] DEBUG - Statement Id: [DAO00030_KiemTraChungTuKhoaSo] PreparedStatement : [SELECT CHUNGTU_ID              FROM TT_DUOC_CHUNGTU              WHERE              MACHUNGTU = 'CS_KBX1319003091'              and BENHVIEN_ID = 'HLU01'              and              convert(date, NGAYCHUNGTU) <=              (              SELECT TOP 1 convert(date, KHOADENNGAY)              FROM TT_DUOC_KHOASOCHUNGTU              WHERE              KHODUOC_ID = '32'              and BENHVIEN_ID = 'HLU01'              AND KHOASO = '1'              ORDER BY KHOADENNGAY DESC              )]
2019-09-20 17:00:27,363 [1] DEBUG - Statement Id: [DAO00030_KiemTraChungTuDaChuyenKeToan] PreparedStatement : [SELECT CHUNGTU_ID            FROM TT_DUOC_CHUNGTU            WHERE            CHUNGTU_ID = '137703'            and IDCHUYEN IS NOT NULL            and BENHVIEN_ID = 'HLU01']
2019-09-20 17:00:27,400 [1] DEBUG - Statement Id: [DAO00030_KiemTraBenhNhanXuatVien] PreparedStatement : [select              TT.TOATHUOC_ID              from              TT_NOITRU_TOATHUOC TT              inner join TT_NOITRU_KHAMBENH KB on TT.KHAMBENH_ID = KB.KHAMBENH_ID              inner join TT_NOITRU_BENHAN BA on BA.BENHAN_ID = KB.BENHAN_ID              WHERE              BA.TRANGTHAI = 'DAXUATVIEN'              AND TT.CHUNGTU_ID =  137703              and TT.BENHVIEN_ID = 'HLU01']
2019-09-20 17:00:27,614 [1] DEBUG - Statement Id: [DAO00030_DUOCTONKHO_GetSoTonTheoDuoc] PreparedStatement : [SELECT              DUOC_ID,              SUM(SOLUONG) AS TONGTON              FROM              TT_DUOC_TONKHO              WHERE              KHODUOC_ID = '32'              and BENHVIEN_ID = 'HLU01'              and DUOC_ID IN (1)              GROUP BY DUOC_ID]
2019-09-20 17:00:27,661 [1] DEBUG - Statement Id: [DAO00030_DUOCTONKHO_GetSoTonTheoDuocTheoLo] PreparedStatement : [SELECT              DUOC_ID,SOLONHAP_ID,              SUM(SOLUONG) AS SOLUONGTONLO              FROM              TT_DUOC_TONKHO              WHERE              KHODUOC_ID = '32'              and BENHVIEN_ID = 'HLU01'              and DUOC_ID IN (1)              and SOLONHAP_ID IN (7541)              GROUP BY DUOC_ID, SOLONHAP_ID]
2019-09-20 17:00:27,705 [1] DEBUG - Statement Id: [DAO00030_DUOCTONKHO_GetSoTonTheoDuoc] PreparedStatement : [SELECT              DUOC_ID,              SUM(SOLUONG) AS TONGTON              FROM              TT_DUOC_TONKHO              WHERE              KHODUOC_ID = '32'              and BENHVIEN_ID = 'HLU01'              and DUOC_ID IN (1)              GROUP BY DUOC_ID]
2019-09-20 17:03:34,059 [1] DEBUG - Statement Id: [DAO00014_GetPatientStatus] PreparedStatement : [select        CASE        when tn.TRANGTHAI = 'HOANTHANH' Then tn.TRANGTHAI        WHEN xncp.XACNHANCHIPHI_ID is not null THEN 'XACNHANCHIPHI'        WHEN (tn.KHOADULIEU = '1') THEN 'KHOADULIEU'        ELSE tn.TRANGTHAI        END        as TRANGTHAI        from TT_TIEPNHAN tn        left join TT_XACNHANCHIPHI xncp on tn.TIEPNHAN_ID = xncp.TIEPNHAN_ID        where tn.TIEPNHAN_ID = '27478'        and tn.BENHVIEN_ID = 'HLU01']
2019-09-20 17:03:34,157 [1] DEBUG - Statement Id: [DAO00083_GetTrangThaiTruocKhiXoa_Update_KhamBenh_VTYT] PreparedStatement : [IF EXISTS (        SELECT KHAMBENH_VTYT_ID        FROM TT_NGOAITRU_KHAMBENH_VTYT        WHERE DVYEUCAU_ID ='205443'        AND BENHVIEN_ID ='HLU01'        AND (CHUNGTU_ID IS NOT NULL OR CHUNGTUTONGHOP_ID IS NOT NULL OR PHIEULINH_ID IS NOT NULL)         and           DICHVU_GHINHANVTYT_ID = '4918'                 )        BEGIN        SELECT -1 AS RESULT        END        ELSE        BEGIN        SELECT 1 AS RESULT        END]
2019-09-20 17:03:34,272 [1] DEBUG - Statement Id: [DAO00083_GetTrangThaiTruocKhiXoa_Update_KhamBenh_VTYT] PreparedStatement : [IF EXISTS (        SELECT KHAMBENH_VTYT_ID        FROM TT_NGOAITRU_KHAMBENH_VTYT        WHERE DVYEUCAU_ID ='205443'        AND BENHVIEN_ID ='HLU01'        AND (CHUNGTU_ID IS NOT NULL OR CHUNGTUTONGHOP_ID IS NOT NULL OR PHIEULINH_ID IS NOT NULL)         and           DICHVU_GHINHANVTYT_ID = '4918'                 )        BEGIN        SELECT -1 AS RESULT        END        ELSE        BEGIN        SELECT 1 AS RESULT        END]
2019-09-20 17:03:34,366 [1] DEBUG - Statement Id: [DAO00014_GetTrangThaiTiepNhan] PreparedStatement : [select tn.TIEPNHAN_ID, tn.KHOADULIEU, xncp.XACNHANCHIPHI_ID from TT_TIEPNHAN tn        left join TT_XACNHANCHIPHI xncp        on tn.TIEPNHAN_ID = xncp.TIEPNHAN_ID        where tn.TIEPNHAN_ID = '27478'        and tn.BENHVIEN_ID = 'HLU01']
2019-09-20 17:03:34,398 [1] DEBUG - Statement Id: [DAO00063_KiemtraSoluongDuocXuatNgoaitru] PreparedStatement : [select A.TONKHO, isnull(B.BOOK_NGOAI,0) BOOK_NGOAI, isnull(D.BOOK_NOI,0) BOOK_NOI,  (A.TONKHO - isnull(B.BOOK_NGOAI,0) - isnull(D.BOOK_NOI,0)) TONKHO_BOOK        from(        select SUM(tk.SOLUONG) TONKHO, tk.DUOC_ID, sd.PHAMVI_ID, tk.NGUONDUOC_ID from TT_DUOC_TONKHO tk        inner join TM_DUOC_PHAMVISD_MAPPING sd on sd.KHODUOC_ID = tk.KHODUOC_ID        where sd.PHAMVI_ID  = '1055' and tk.DUOC_ID = '1' and tk.NGUONDUOC_ID = '1'        group by tk.DUOC_ID, sd.PHAMVI_ID, tk.NGUONDUOC_ID) A        left join (        select SUM(SOLUONG) BOOK_NGOAI,DUOC_ID, PHAMVI_ID, NGUONHANG_ID from TT_DUOC_TONKHO_BOOK_NGOAITRU        where PHAMVI_ID  = '1055' and DUOC_ID = '1' and NGUONHANG_ID = '1' and TRANGTHAI = 'HIEULUC' and SOLUONG > 0        group by DUOC_ID, PHAMVI_ID, NGUONHANG_ID) B on A.DUOC_ID = B.DUOC_ID and A.PHAMVI_ID = B.PHAMVI_ID and A.NGUONDUOC_ID = B.NGUONHANG_ID        left join (        select SUM(SOLUONG) BOOK_NOI,DUOC_ID, PHAMVI_ID, NGUONHANG_ID from TT_DUOC_TONKHO_BOOK_NOITRU        where PHAMVI_ID  = '1055' and DUOC_ID = '1' and NGUONHANG_ID = '1' and TRANGTHAI = 'HIEULUC'  and SOLUONG > 0        group by DUOC_ID, PHAMVI_ID, NGUONHANG_ID) D on A.DUOC_ID = D.DUOC_ID and A.PHAMVI_ID = D.PHAMVI_ID and A.NGUONDUOC_ID = D.NGUONHANG_ID]
2019-09-20 17:03:34,473 [1] DEBUG - Statement Id: [DAO00014_KiemTraDVYCCoBHYT] PreparedStatement : [select *        from TT_VIENPHI        where REF_ID  = '205443' and REF_TABLE = 'TT_DVYEUCAU' and BHYT_DONGIA > 0]
2019-09-20 17:03:34,509 [1] DEBUG - Statement Id: [DAO00000_GetCHECK_DOITUONG_BHYT] PreparedStatement : [select count(*) as DOITUONG_BHYT FROM TM_DOITUONG A            WHERE A.DOITUONG_ID = '4' and A.BENHVIEN_ID = 'HLU01' and MADOITUONG like '%BHYT%']
2019-09-20 17:03:34,538 [1] DEBUG - Statement Id: [DAO00000_GetLOAIGIATHUOC_NOI_NGOAI_VIEN] PreparedStatement : [SELECT LOAIGIA_ID              FROM TM_LOAIGIA              WHERE MALOAIGIA = 'GiaThuoc_NoiVien' and BENHVIEN_ID = 'HLU01']
2019-09-20 17:03:34,574 [1] DEBUG - Statement Id: [DAO00000_GetDUOC_DONGIADOANHTHU_NOIVIEN] PreparedStatement : [declare @doanhthu numeric(24,2);          declare @hotro numeric(24,2);          declare @bhyt char(1);          select top 1 @doanhthu = dg.DONGIA           from TM_DUOC_DONGIA dg          left join TM_DOITUONG_LOAIGIA dtlg on dtlg.LOAIGIA_ID = dg.LOAIGIA_ID                     where dg.DUOC_ID = '1' and dtlg.DOITUONG_ID = '4' and dg.DONGIA is not null and dg.DONGIA > 0           order by dtlg.DOUUTIEN asc          select top 1 @hotro = dg.DONGIA          from TM_DUOC_DONGIA dg          left join TM_DOITUONG_LOAIGIA dtlg on dtlg.LOAIGIA_ID = dg.LOAIGIA_ID          where dg.DUOC_ID = '1' and dtlg.DOITUONG_ID = '4' and dg.DONGIA is not null and dg.DONGIA > 0  and GIAHOTRO = '1'          order by dtlg.DOUUTIEN asc          select top 1 @bhyt = BHYT from TM_DUOC where DUOC_ID = 1          select ISNULL(@doanhthu,0.0) DONGIA_DOANHTHU, ISNULL(@hotro, 0.0) DONGIA_KHAC, isnull(@bhyt, '0') BHYT]
2019-09-20 17:03:34,605 [1] DEBUG - Statement Id: [DAO00000_GetDuocBHYT] PreparedStatement : [select count(*) BHYT FROM TM_DUOC A WHERE A.DUOC_ID = '1' and BHYT = '1']
2019-09-20 17:03:34,634 [1] DEBUG - Statement Id: [DAO00023_GetSOBHYT_HUONG_ID] PreparedStatement : [select isnull(MAX(SOBHYT_HUONG_ID),0) SOBHYT_HUONG_ID        from TT_TIEPNHAN_SOTHEBHYT        where TIEPNHAN_ID = '27478']
2019-09-20 17:03:34,691 [1] DEBUG - Statement Id: [DAO00062_GetKhoThuocCosoKhongCoso] PreparedStatement : [select distinct kd.KHODUOC_ID, lst.DICTIONARY_CODE  LOAIKHO from TM_KHODUOC kd        left join TM_PHONGBAN_KHODUOC pbkd        on kd.KHODUOC_ID = pbkd.KHODUOC_ID        and kd.BENHVIEN_ID = pbkd.BENHVIEN_ID        left join LST_DICTIONARY lst on lst.DICTIONARY_ID = kd.LOAIKHO_ID        where lst.DICTIONARY_CODE = 'Coso']
2019-09-20 17:03:34,722 [1] DEBUG - Statement Id: [DAO00062_GetAllPhamviKhoDuoc] PreparedStatement : [select distinct dmap.*        from TM_DUOC_PHAMVISD_MAPPING dmap        left join TM_DUOC_PHAMVISUDUNG dpv on dpv.PHAMVI_ID = dmap.PHAMVI_ID]
2019-09-20 17:03:34,764 [1] DEBUG - Statement Id: [DAO00083_Update_PhieuGhiNhanVTYT] PreparedStatement : [update TT_DICHVU_GHINHANVTYT set        KHOXUAT_ID =  @param0 ,        THOIGIANCAPNHAT =  @param1 ,        NGUOICAPNHAT_ID =  @param2         where        DICHVU_GHINHANVTYT_ID = '4918']
2019-09-20 17:03:34,764 [1] DEBUG - Statement Id: [DAO00083_Update_PhieuGhiNhanVTYT] Parameters: [@param0=[KHOXUAT_ID,32], @param1=[THOIGIANCAPNHAT,9/20/2019 5:03:34 PM], @param2=[NGUOICAPNHAT_ID,1]]
2019-09-20 17:03:34,764 [1] DEBUG - Statement Id: [DAO00083_Update_PhieuGhiNhanVTYT] Types: [@param0=[String, System.String], @param1=[DateTime, System.DateTime], @param2=[Int64, System.Int64]]
2019-09-20 17:03:34,798 [1] DEBUG - Statement Id: [DAO00016_CheckThuocUngThu] PreparedStatement : [SELECT count(*)        from TM_DOITUONG_GIADUOC_TYLE        WHERE DOITUONG_ID = '4'        AND DUOC_ID = '1'        AND BENHVIEN_ID = 'HLU01']
2019-09-20 17:03:34,832 [1] DEBUG - Statement Id: [DAO00083_GetBookingInfo] PreparedStatement : [select *        from TT_DUOC_TONKHO_BOOK_NGOAITRU        where                 DUOC_ID = '1'        and NGUONHANG_ID = '1'        and REF_ID = '10593'        and REF_TABLE = 'TT_NGOAITRU_KHAMBENH_VTYT'         and           KHODUOC_ID =  @param0          and           PHAMVI_ID =  @param1]
2019-09-20 17:03:34,832 [1] DEBUG - Statement Id: [DAO00083_GetBookingInfo] Parameters: [@param0=[KHODUOC_ID,32], @param1=[PHAMVI_ID,1055]]
2019-09-20 17:03:34,832 [1] DEBUG - Statement Id: [DAO00083_GetBookingInfo] Types: [@param0=[Int32, System.Int32], @param1=[Int64, System.Int64]]
2019-09-20 17:03:34,898 [1] DEBUG - Statement Id: [DAO00083_Update_Booking] PreparedStatement : [update TT_DUOC_TONKHO_BOOK_NGOAITRU set        KHODUOC_ID =  @param0 ,        NGUONHANG_ID =  @param1 ,        DUOC_ID =  @param2 ,        SOLUONG =  @param3 ,        NGAYHIEULUC =  @param4 ,        NGUOICAPNHAT_ID =  @param5 ,        NGAYCAPNHAT =  @param6          ,           PHAMVI_ID =  @param7                  where        BOOKING_ID = '34589']
2019-09-20 17:03:34,898 [1] DEBUG - Statement Id: [DAO00083_Update_Booking] Parameters: [@param0=[KHODUOC_ID,32], @param1=[NGUONHANG_ID,1], @param2=[DUOC_ID,1], @param3=[SOLUONG,2], @param4=[NGAYHIEULUC,null], @param5=[NGUOICAPNHAT_ID,1], @param6=[NGAYCAPNHAT,9/20/2019 5:03:34 PM], @param7=[PHAMVI_ID,1055]]
2019-09-20 17:03:34,898 [1] DEBUG - Statement Id: [DAO00083_Update_Booking] Types: [@param0=[Int32, System.Int32], @param1=[Int64, System.Int64], @param2=[Int64, System.Int64], @param3=[Double, System.Double], @param4=[System.DBNull, null], @param5=[Int64, System.Int64], @param6=[DateTime, System.DateTime], @param7=[Int64, System.Int64]]
2019-09-20 17:03:34,929 [1] DEBUG - Statement Id: [DAO00083_UpdateTTGhiNhanVTYT] PreparedStatement : [update TT_DVYEUCAU        set GHINHANVTYT = '1',        NGUOICAPNHAT_ID = '1',        NGAYCAPNHAT = '9/20/2019 5:03:34 PM'        where DVYEUCAU_ID  = '205443']
2019-09-20 17:03:34,966 [1] DEBUG - Statement Id: [DAO00064_GetTopTT_TIEPNHAN_SOTHEBHYT] PreparedStatement : [select top 1 stbhyt.*, ba.SOBENHAN,         tn.SOTIEPNHAN, tn.LOAITHANHVIEN_ID, tn.THE_ID, tn.THANHVIEN_ID,        tn.SUDUNG_BHTN, tn.BAOLANH_VIENPHI, tn.VIP, tn.NGUOINUOCNGOAI        from TT_TIEPNHAN_SOTHEBHYT stbhyt        left join TT_TIEPNHAN tn on tn.TIEPNHAN_ID = stbhyt.TIEPNHAN_ID        left join TT_NOITRU_BENHAN ba on ba.TIEPNHAN_ID = stbhyt.TIEPNHAN_ID        where         stbhyt.TIEPNHAN_ID = '27478' and isnull(stbhyt.KHONGSUDUNG, '0') = '0'              order by SOBHYT_HUONG_ID desc]
2019-09-20 17:03:34,998 [1] DEBUG - Statement Id: [DAO00006_GetListDuocTyle] PreparedStatement : [select DUOC_ID, DOITUONG_ID, (TYLE/100) as TYLE, DONGIA MUCTRAN_THANHTOAN from TM_DOITUONG_GIADUOC_TYLE            where            BENHVIEN_ID = 'HLU01'            and DOITUONG_ID = '4']
2019-09-20 17:03:35,028 [1] DEBUG - Statement Id: [DAO00027_GetListTuongTrinhDichVuPhauThuatCuaTiepNhan] PreparedStatement : [declare @ManhomDSA varchar(10);        declare @PhanLoaiNhomDV varchar(20) = '05';        select top 1  @ManhomDSA = VALUE from TM_SYS_APPSETTINGS where CODE = 'MANHOM_DICHVU_DSA'        if (@ManhomDSA is not null) set @PhanLoaiNhomDV += ',' + @ManhomDSA        select distinct ptyc.*        from TT_PHAUTHUAT_YEUCAU ptyc        inner join TM_DICHVU dv on dv.DICHVU_ID = ptyc.DICHVU_ID        inner join TM_NHOMDICHVU ndv on ndv.NHOMDICHVU_ID = dv.NHOMDICHVU_ID        inner join TT_PHAUTHUAT pt on pt.PHAUTHUAT_ID = ptyc.PHAUTHUAT_ID        where        pt.TIEPNHAN_ID = 27478        and (left(ndv.MANHOMDICHVU, 2) in (select * from STRING_SPLIT(@PhanLoaiNhomDV,',')) or ndv.MANHOMDICHVU in (select * from STRING_SPLIT(@PhanLoaiNhomDV,',')))]
2019-09-20 17:03:35,082 [1] DEBUG - Statement Id: [DAO00006_GetList] PreparedStatement : [select dv.*, loaiDV.MALOAIDICHVU, captren.NHOMDICHVU_ID as NHOMDICHVU_CAPTREN_ID, captren.TENNHOMDICHVU as NHOMDICHVU_CAPTREN,              nhom_dv.TENNHOMDICHVU as TENNHOMDICHVU, nhom_dv.MANHOMDICHVU,              case when dv.ATTRIBUTE5 is null then 'TT' else 'KTC' end as LOAI_CHIPHI              from TM_DICHVU as dv              left join TM_NHOMDICHVU as nhom_dv on nhom_dv.NHOMDICHVU_ID = dv.NHOMDICHVU_ID and nhom_dv.BENHVIEN_ID = 'HLU01'              left join TM_NHOMDICHVU as captren on nhom_dv.CAPTREN_ID = captren.NHOMDICHVU_ID and captren.BENHVIEN_ID = 'HLU01'              left join TM_LOAIDICHVU loaiDV on nhom_dv.LOAIDICHVU_ID = loaiDV.LOAIDICHVU_ID and loaiDV.BENHVIEN_ID = 'HLU01'              where nhom_dv.TAMNGUNG = '0' and dv.BENHVIEN_ID = 'HLU01'              and dv.TAMNGUNG = '0'               AND                   loaiDV.MALOAIDICHVU = 'KhamBenh']
2019-09-20 17:03:35,121 [1] DEBUG - Statement Id: [DAO00023_GetVienPhiByDichVuID] PreparedStatement : [select *        from TT_VIENPHI        where TIEPNHAN_ID  = '27478'        and DUOC_ID  = '1'        and REF_ID = '10593'        and REF_TABLE = 'TT_NGOAITRU_KHAMBENH_VTYT'        and DATHANHTOAN = '0']
2019-09-20 17:03:35,153 [1] DEBUG - Statement Id: [DAO00023_UpdateDuocVienPhi] PreparedStatement : [update TT_VIENPHI set                 KHAMBENH_ID =  @param0         , LOAI_CHIPHI =  @param1         , LOAIGIA_ID =  @param2         , SOLUONG =  @param3         , DONGIA_DOANHTHU =  @param4         , THANHTIEN_DOANHTHU =  @param5         , BHYT_TL =  @param6         , BHYT_DONGIA =  @param7         , BHYT_THANHTIEN =  @param8         , BHYT_DONGIA_CHITRA =  @param9         , BHYT_THANHTIEN_CHITRA =  @param10         , BENHNHAN_PHAITHANHTOAN =  @param11         , GIATRI_HOADON =  @param12         , GIATRI_HOADON_DATHANHTOAN =  @param13         , GIATRI_BIENLAI =  @param14         , GIATRI_BIENLAI_DATHANHTOAN =  @param15         , GIATRI_BENHNHAN_DATHANHTOAN =  @param16         , GIATRI_THATTHU =  @param17         , MIENGIAM_TL =  @param18                  , NGANSACH_TL =  @param19         , NGANSACH_GIATRI =  @param20         , TAITRO_TL =  @param21         , TAITRO_GIATRI =  @param22         , BHTN_TL =  @param23         , BHTN_DONGIA =  @param24         , BHTN_THANHTIEN =  @param25         , BHTN_DONGIA_CHITRA =  @param26         , BHTN_THANHTIEN_CHITRA =  @param27         , DUOCPHEPTHUCHIEN =  @param28         , HUY =  @param29         , KHONGTHUTIEN =  @param30         , BHYTDONGTIEN =  @param31         , DATHANHTOAN =  @param32         , HOADON_ID =  @param33          ,           TYLE_VAT =  @param34                  , NGUOICAPNHAT_ID =  @param35         , NGAYCAPNHAT =  @param36         where        VIENPHI_ID = '674728']
2019-09-20 17:03:35,153 [1] DEBUG - Statement Id: [DAO00023_UpdateDuocVienPhi] Parameters: [@param0=[KHAMBENH_ID,null], @param1=[LOAI_CHIPHI,TT], @param2=[LOAIGIA_ID,null], @param3=[SOLUONG,2], @param4=[DONGIA_DOANHTHU,1030], @param5=[THANHTIEN_DOANHTHU,2060], @param6=[BHYT_TL,1], @param7=[BHYT_DONGIA,1030], @param8=[BHYT_THANHTIEN,2060], @param9=[BHYT_DONGIA_CHITRA,1030], @param10=[BHYT_THANHTIEN_CHITRA,2060], @param11=[BENHNHAN_PHAITHANHTOAN,0], @param12=[GIATRI_HOADON,0], @param13=[GIATRI_HOADON_DATHANHTOAN,0], @param14=[GIATRI_BIENLAI,0], @param15=[GIATRI_BIENLAI_DATHANHTOAN,0], @param16=[GIATRI_BENHNHAN_DATHANHTOAN,0], @param17=[GIATRI_THATTHU,0], @param18=[MIENGIAM_TL,0], @param19=[NGANSACH_TL,0], @param20=[NGANSACH_GIATRI,0], @param21=[TAITRO_TL,0], @param22=[TAITRO_GIATRI,0], @param23=[BHTN_TL,0], @param24=[BHTN_DONGIA,0], @param25=[BHTN_THANHTIEN,0], @param26=[BHTN_DONGIA_CHITRA,0], @param27=[BHTN_THANHTIEN_CHITRA,0], @param28=[DUOCPHEPTHUCHIEN,0], @param29=[HUY,0], @param30=[KHONGTHUTIEN,0], @param31=[BHYTDONGTIEN,0], @param32=[DATHANHTOAN,0], @param33=[HOADON_ID,null], @param34=[TYLE_VAT,null], @param35=[NGUOICAPNHAT_ID,1], @param36=[NGAYCAPNHAT,9/20/2019 5:03:35 PM]]
2019-09-20 17:03:35,153 [1] DEBUG - Statement Id: [DAO00023_UpdateDuocVienPhi] Types: [@param0=[System.DBNull, null], @param1=[String, System.String], @param2=[System.DBNull, null], @param3=[Decimal, System.Decimal], @param4=[Decimal, System.Decimal], @param5=[Decimal, System.Decimal], @param6=[Decimal, System.Decimal], @param7=[Decimal, System.Decimal], @param8=[Decimal, System.Decimal], @param9=[Decimal, System.Decimal], @param10=[Decimal, System.Decimal], @param11=[Decimal, System.Decimal], @param12=[Decimal, System.Decimal], @param13=[Decimal, System.Decimal], @param14=[Decimal, System.Decimal], @param15=[Decimal, System.Decimal], @param16=[Decimal, System.Decimal], @param17=[Decimal, System.Decimal], @param18=[Decimal, System.Decimal], @param19=[Decimal, System.Decimal], @param20=[Decimal, System.Decimal], @param21=[Decimal, System.Decimal], @param22=[Decimal, System.Decimal], @param23=[Decimal, System.Decimal], @param24=[Decimal, System.Decimal], @param25=[Decimal, System.Decimal], @param26=[Decimal, System.Decimal], @param27=[Decimal, System.Decimal], @param28=[String, System.String], @param29=[String, System.String], @param30=[Int32, System.Int32], @param31=[String, System.String], @param32=[String, System.String], @param33=[System.DBNull, null], @param34=[System.DBNull, null], @param35=[Int64, System.Int64], @param36=[DateTime, System.DateTime]]
2019-09-20 17:03:35,197 [1] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoVaBookingCOM23UpdateRedis] PreparedStatement : [declare @NGUONDUOC_MACDINH varchar(5) = '0';        declare @TOAMUANGOAI int = 0;        select @NGUONDUOC_MACDINH = isnull(VALUE,0) from TM_SYS_APPSETTINGS where CODE = 'PHA_NGUONDUOC'        select @TOAMUANGOAI = isnull(VALUE,0) from TM_SYS_APPSETTINGS where CODE = 'OPD_TOAMUANGOAI_DUNGDANHMUC_DUOC'                if @TOAMUANGOAI = 1        begin        select  distinct '0' + '_' + LTRIM(d.DUOC_ID) + '_' + @NGUONDUOC_MACDINH as DUOC_KEY, 0 as PHAMVI_ID, @NGUONDUOC_MACDINH as NGUONDUOC_ID, null as TENNGUONDUOC, null as TINHTIEN, d.DUOC_ID, ld.MALOAIDUOC,        d.SOVISA,d.TYLE_VAT,d.COTOA, d.MADUOC, d.TENHANG, d.TENDUOCDAYDU, dvt.TENDONVITINH as DONVITINH, d.BHYT,        d.TENHOATCHAT, d.HAMLUONG, d.HANGSANXUAT, d.QUOCGIA, d.LOAIDUOC_ID, d.DUONGDUNG_ID, d.TINHTIEN_PTTT,        ten.TENDUOC, ten.TENDUOC_EN, ten.MAQUOCTE, ten.MAQUOCTEBT,        '' as BHYT_TEXT        , ld.LOAIVATTU_ID        , d.BENHVIEN_ID,        999999999 as SOLUONG, d.VTYT_PHANLOAI, d.PHAMVI, d.SUASOLUONGTONGHOP, d.MADUOCBV, d.DANGTRINHBAY        , TAMNGUNG = CASE WHEN d.TAMNGUNG = '1' THEN '1' ELSE '0' END        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        where d.DUOC_ID in (1)        union all        select  distinct tk.DUOC_KEY, LTRIM(tk.PHAMVI_ID) as PHAMVI_ID, tk.NGUONDUOC_ID, nh.TENNGUONDUOC, nh.TINHTIEN, d.DUOC_ID, ld.MALOAIDUOC,        d.SOVISA,d.TYLE_VAT,d.COTOA, d.MADUOC, d.TENHANG, d.TENDUOCDAYDU, dvt.TENDONVITINH as DONVITINH, d.BHYT,        d.TENHOATCHAT, d.HAMLUONG, d.HANGSANXUAT, d.QUOCGIA, d.LOAIDUOC_ID, d.DUONGDUNG_ID, d.TINHTIEN_PTTT,        ten.TENDUOC, ten.TENDUOC_EN, ten.MAQUOCTE, ten.MAQUOCTEBT,        CASE WHEN d.BHYT = '1' THEN 'BHYT' ELSE '' END as BHYT_TEXT        , ld.LOAIVATTU_ID        , d.BENHVIEN_ID,        tk.SOLUONG, d.VTYT_PHANLOAI, d.PHAMVI, d.SUASOLUONGTONGHOP, d.MADUOCBV, d.DANGTRINHBAY        , TAMNGUNG = CASE WHEN d.TAMNGUNG = '1' OR nh.TAMNGUNG = '1' OR kd.TAMNGUNG = '1' THEN '1' ELSE '0' END        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        inner join        (        select  LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')) DUOC_KEY, (SUM(dtk.SOLUONG) - isnull(sum(A.SOLUONG),0) - isnull(sum(B.SOLUONG),0)) SOLUONG, pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        from (select sum(soluong) soluong,duoc_id,nguonduoc_id,khoduoc_id,benhvien_id from TT_DUOC_TONKHO  group by duoc_id,nguonduoc_id,khoduoc_id,benhvien_id) dtk        inner join TM_DUOC_PHAMVISD_MAPPING pvsd on dtk.KHODUOC_ID = pvsd.KHODUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NOITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) B on B.DUOC_ID = dtk.DUOC_ID and B.SOLUONG > 0 and B.PHAMVI_ID = pvsd.PHAMVI_ID and B.NGUONHANG_ID = dtk.NGUONDUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NGOAITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) A on A.DUOC_ID = dtk.DUOC_ID and A.SOLUONG > 0 and A.PHAMVI_ID = pvsd.PHAMVI_ID and A.NGUONHANG_ID = dtk.NGUONDUOC_ID        where dtk.SOLUONG > 0 and dtk.BENHVIEN_ID = 'HLU01'        group by LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')), pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        ) tk on tk.DUOC_ID = d.DUOC_ID        left join TM_DUOC_PHAMVISUDUNG kd on kd.PHAMVI_ID = tk.PHAMVI_ID and kd.BENHVIEN_ID = 'HLU01'        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = tk.NGUONDUOC_ID and nh.BENHVIEN_ID = 'HLU01'        where  d.BENHVIEN_ID = 'HLU01' and d.DUOC_ID in (1)        end        else        begin        select  distinct tk.DUOC_KEY, LTRIM(tk.PHAMVI_ID) as PHAMVI_ID, tk.NGUONDUOC_ID, nh.TENNGUONDUOC, nh.TINHTIEN, d.DUOC_ID, ld.MALOAIDUOC,        d.SOVISA,d.TYLE_VAT,d.COTOA, d.MADUOC, d.TENHANG, d.TENDUOCDAYDU, dvt.TENDONVITINH as DONVITINH, d.BHYT,        d.TENHOATCHAT, d.HAMLUONG, d.HANGSANXUAT, d.QUOCGIA, d.LOAIDUOC_ID, d.DUONGDUNG_ID, d.TINHTIEN_PTTT,        ten.TENDUOC, ten.TENDUOC_EN, ten.MAQUOCTE, ten.MAQUOCTEBT,        CASE WHEN d.BHYT = '1' THEN 'BHYT' ELSE '' END as BHYT_TEXT        , ld.LOAIVATTU_ID        , d.BENHVIEN_ID,        tk.SOLUONG, d.VTYT_PHANLOAI, d.PHAMVI, d.SUASOLUONGTONGHOP, d.MADUOCBV, d.DANGTRINHBAY        , TAMNGUNG = CASE WHEN d.TAMNGUNG = '1' OR nh.TAMNGUNG = '1' OR kd.TAMNGUNG = '1' THEN '1' ELSE '0' END        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        inner join        (        select  LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')) DUOC_KEY, (SUM(dtk.SOLUONG) - isnull(sum(A.SOLUONG),0) - isnull(sum(B.SOLUONG),0)) SOLUONG, pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        from (select sum(soluong) soluong,duoc_id,nguonduoc_id,khoduoc_id,benhvien_id from TT_DUOC_TONKHO  group by duoc_id,nguonduoc_id,khoduoc_id,benhvien_id) dtk        inner join TM_DUOC_PHAMVISD_MAPPING pvsd on dtk.KHODUOC_ID = pvsd.KHODUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NOITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) B on B.DUOC_ID = dtk.DUOC_ID and B.SOLUONG > 0 and B.PHAMVI_ID = pvsd.PHAMVI_ID and B.NGUONHANG_ID = dtk.NGUONDUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NGOAITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) A on A.DUOC_ID = dtk.DUOC_ID and A.SOLUONG > 0 and A.PHAMVI_ID = pvsd.PHAMVI_ID and A.NGUONHANG_ID = dtk.NGUONDUOC_ID        where dtk.SOLUONG > 0 and dtk.BENHVIEN_ID = 'HLU01'        group by LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')), pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        ) tk on tk.DUOC_ID = d.DUOC_ID        left join TM_DUOC_PHAMVISUDUNG kd on kd.PHAMVI_ID = tk.PHAMVI_ID and kd.BENHVIEN_ID = 'HLU01'        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = tk.NGUONDUOC_ID and nh.BENHVIEN_ID = 'HLU01'        where  d.BENHVIEN_ID = 'HLU01' and d.DUOC_ID in (1)        end]
2019-09-20 17:03:37,190 [1] DEBUG - Statement Id: [DAO00030_GetKhoDuoc] PreparedStatement : [SELECT *            FROM            TM_KHODUOC            WHERE            KHODUOC_ID= '32'            and BENHVIEN_ID= 'HLU01']
2019-09-20 17:03:37,220 [1] DEBUG - Statement Id: [DAO00030_GetMucDichChungTuID] PreparedStatement : [SELECT DICTIONARY_ID              FROM              LST_DICTIONARY              WHERE              DICTIONARY_TYPE_CODE = 'MucDichChungTu'              and DICTIONARY_CODE = 'X13']
2019-09-20 17:03:37,253 [1] DEBUG - Statement Id: [DAO00036_GetDetail] PreparedStatement : [select KEYTYPE, KEYYEAR, KEYMONTH, KEYDAY, SEGMENT_1, SEGMENT_2, SEGMENT_3, KEYVALUE              from LST_KEYDATA_DUOCPHAM as kd               WHERE                        kd.KEYTYPE = 'SOCHUNGTUNHAPXUATBENNGOAI'                   AND                       kd.KEYYEAR = '2019'                   AND                       kd.KEYMONTH = '0'                   AND                       kd.KEYDAY = '0'                   AND                       kd.SEGMENT_1 = 'CS_KB'                   AND                       kd.SEGMENT_2 = 'X13'                   AND                       kd.SEGMENT_3 = ' ']
2019-09-20 17:03:37,298 [1] DEBUG - Statement Id: [DAO00036_Update] PreparedStatement : [update LST_KEYDATA_DUOCPHAM set              KEYVALUE =  @param0               where              KEYTYPE = 'SOCHUNGTUNHAPXUATBENNGOAI'              AND KEYYEAR = '2019'              AND KEYMONTH = '0'              AND KEYDAY = '0'              AND SEGMENT_1 = 'CS_KB'              AND SEGMENT_2 = 'X13'              AND SEGMENT_3 = ' ']
2019-09-20 17:03:37,298 [1] DEBUG - Statement Id: [DAO00036_Update] Parameters: [@param0=[KEYVALUE,003092]]
2019-09-20 17:03:37,299 [1] DEBUG - Statement Id: [DAO00036_Update] Types: [@param0=[String, System.String]]
2019-09-20 17:03:37,352 [1] DEBUG - Statement Id: [DAO00030_GetGhiNhanVTYTKhamBenhByKhamBenhID] PreparedStatement : [SELECT            N'Người bệnh: ' + bn.MAYTE + ' - ' + bn.TENBENHNHAN + ' - ' +  CONVERT(VARCHAR(10), KB.THOIGIANKHAM, 103) + ' - ' + CONVERT(VARCHAR(5), KB.THOIGIANKHAM, 108) as BENHNHAN            ,tt.* , tt.NGUONHANG_ID AS NGUONDUOC_ID            FROM TT_NGOAITRU_KHAMBENH_VTYT tt            INNER JOIN TT_NGOAITRU_KHAMBENH KB on KB.KHAMBENH_ID = TT.KHAMBENH_ID AND KB.BENHVIEN_ID = TT.BENHVIEN_ID            INNER JOIN TT_BENHNHAN bn on bn.BENHNHAN_ID = KB.BENHNHAN_ID AND BN.BENHVIEN_ID = KB.BENHVIEN_ID            WHERE            tt.KHAMBENH_ID= 26173 and tt.COSO = '1' and tt.CHUNGTU_ID is null            AND TT.BENHVIEN_ID = 'HLU01'             and               tt.DICHVU_GHINHANVTYT_ID = 4918]
2019-09-20 17:03:37,432 [1] DEBUG - Statement Id: [DAO00030_GET_SOLONHAP_XUATSUDUNG] PreparedStatement : [SELECT DISTINCT            SLN.SOLONHAP_ID, SLN.SOLONHAP, SLN.SOLOSANPHAM, SLN.SOKIEMSOAT, SLN.SOVISA, CONVERT(varchar(20), SLN.SOLOSANPHAM) + '/' + CONVERT(varchar(20), TK.SOLUONG) AS SOLOSOTON,            SLN.NGAYNHAP AS NGAYNHAPLO, SLN.HANDUNG AS HANSUDUNG,  SLN.HANDUNG, SLN.NGUONDUOC_ID, SLN.NGUONDUOC_ID as NGUONHANG_ID,            SLNGB.DONGIAMUA, SLNGB.DONGIAVON, SLNGB.TYLEVAT_DAUVAO as TYLEVAT, d.TYLE_VAT, SLNGB.DONGIAVONVAT, SLNGB.DONGIABANVAT_DAUVAO,            dg.DONGIA AS DONGIATHAU, dg.DONGIA AS DONGIABAN, dg.DONGIA AS DONGIABAN_VAT,                      TK.KHODUOC_ID,TK.DUOC_ID, TK.SOLUONG, TK.SOLUONG AS SOLUONGTON,            D.TENDUOCDAYDU,D.DONVITINH_ID, D.DONVITINH, D.BHYT, NH.TENNGUONDUOC AS NGUONHANG,            LTRIM(TK.KHODUOC_ID) + '_' + LTRIM(TK.DUOC_ID) + '_' + LTRIM(TK.NGUONDUOC_ID) as DUOC_KEY            FROM            TT_DUOC_CHUNGTU_SOLONHAP SLN            INNER JOIN TT_DUOC_TONKHO TK on SLN.SOLONHAP_ID = TK.SOLONHAP_ID            INNER JOIN TT_DUOC_SOLONHAP_GIABAN SLNGB on SLN.SOLONHAP_ID = SLNGB.SOLONHAP_ID            INNER JOIN TM_NGUONHANG NH on SLN.NGUONDUOC_ID = NH.NGUONDUOC_ID            INNER JOIN TM_DUOC D on SLN.DUOC_ID = D.DUOC_ID            LEFT JOIN TM_DUOC_DONGIA dg on dg.DUOC_ID = SLN.DUOC_ID            LEFT JOIN TM_LOAIGIA lg on (lg.LOAIGIA_ID = dg.LOAIGIA_ID AND lg.MALOAIGIA = 'GiaduocBHYT')            WHERE            TK.DUOC_ID = '1'            AND TK.KHODUOC_ID = '32'            AND TK.BENHVIEN_ID = 'HLU01'            AND TK.SOLUONG > 0                 and                     SLN.NGUONDUOC_ID = '1'                                      ORDER BY NGAYNHAP]
2019-09-20 17:03:37,481 [1] DEBUG - Statement Id: [DAO00030_Add] PreparedStatement : [insert into TT_DUOC_CHUNGTU (              MACHUNGTU              , SOCHUNGTU              , NGAYCHUNGTU              , LOAICHUNGTU              , MUCDICHCHUNGTU_ID              , MUCDICHCHUNGTU_CODE              , KHOXUAT_ID              , NGUOIGIAO_ID              , NGUOIGIAO              , KHONHAP_ID              , NGUOINHAN_ID              , NGUOINHAN              , NGUOIKIEMTRA_ID              , NGUOIKIEMTRA              , NGUOIDUYET_ID              , NGUOIDUYET              , PHUONGPHAPXUAT              , KETOANTRUONG_ID              , KETOANTRUONG              , THUKHO_ID              , THUKHO              , MAUHOADON              , SOHOADON              , SOSERI              , NGAYHOADON              , DIENGIAI              , GIATRI              , GIATRITHANHTOAN              , TYLEVAT              , GIATRIVAT              , THUESUAT              , GIATRITHUE              , TYLECHIETKHAU              , GIATRICHIETKHAU              , TIENTE_ID              , TYGIA              , SOCHUNGTUGOC              , NGAYCHUNGTUGOC              , NHACUNGCAP_ID              , HINHTHUCTHANHTOAN_ID              , NGUONDUOC_ID              , CHUNGTULIENQUAN_ID              , KHAMBENH_ID              , TOATHUOCNOITRU_ID              , TIEPNHAN_ID              , BENHAN_ID              , DANHANTHUOC              , NGUOINHAP_ID              , NGAYNHAP              , TRANGTHAI              , LOAITOATHUOC              , PHIEULINH_ID              , DIENGIAINGHIEPVUPHATSINH              , DONVIGIAO_ID              , KHOSUDUNG_ID              , LOAIVATTU_ID              , BENHNHAN_ID              , NGOAITRU_TOATHUOC_NGUOIMUA_ID              , TENBENHNHAN              , BACSIGIOITHIEU_ID              , DOITUONG_ID              , IDCHUYEN              , CHUNGTUKETOAN              , STATUS              , TRANSFER_VIENPHI_ID              , PHONGBAN_ID              , BACSI_ID              , TKNO              , TKCO              , MACHUNGTUREF              , LOAICHUNGTUREF              , PHIEULINHCANTRU_ID              , KHOTHUCHIEN_ID              , KHODOIUNG_ID              , MENU_LOAIDUOC_ID              , NGUOISUDUNGMAY_ID              , GOITHAU_ID              , XUATTHUOCBANGOAITRU              , NGAYGIOCHUNGTU              , NOIDAKHAM              , HOIDONGKIEMNHAP_ID              , HOIDONGTHANHLY_ID              , CHUYENCHUNGTUID              , CHUYENDOANHTHUID              , LYDOXUATSUDUNG_ID              , BENHVIEN_ID              , NGAYTAO              , NGUOITAO_ID              , NGAYCAPNHAT              , NGUOICAPNHAT_ID              ) values (               @param0               ,  @param1               ,  @param2               ,  @param3               ,  @param4               ,  @param5               ,  @param6               ,  @param7               ,  @param8               ,  @param9               ,  @param10               ,  @param11               ,  @param12               ,  @param13               ,  @param14               ,  @param15               ,  @param16               ,  @param17               ,  @param18               ,  @param19               ,  @param20               ,  @param21               ,  @param22               ,  @param23               ,  @param24               ,  @param25               ,  @param26               ,  @param27               ,  @param28               ,  @param29               ,  @param30               ,  @param31               ,  @param32               ,  @param33               ,  @param34               ,  @param35               ,  @param36               ,  @param37               ,  @param38               ,  @param39               ,  @param40               ,  @param41               ,  @param42               ,  @param43               ,  @param44               ,  @param45               ,  @param46               ,  @param47               ,  @param48               ,  @param49               ,  @param50               ,  @param51               ,  @param52               ,  @param53               ,  @param54               ,  @param55               ,  @param56               ,  @param57               ,  @param58               ,  @param59               ,  @param60               ,  @param61               ,  @param62               ,  @param63               ,  @param64               ,  @param65               ,  @param66               ,  @param67               ,  @param68               ,  @param69               ,  @param70               ,  @param71               ,  @param72               ,  @param73               ,  @param74               ,  @param75               ,  @param76               ,  @param77               ,  @param78               ,  @param79               ,  @param80               ,  @param81               ,  @param82               ,  @param83               ,  @param84               ,  @param85               ,  @param2               ,  @param86               ,  @param87               ,  @param88               )              select SCOPE_identity() as value]
2019-09-20 17:03:37,482 [1] DEBUG - Statement Id: [DAO00030_Add] Parameters: [@param0=[MACHUNGTU,CS_KBX1319003092], @param1=[SOCHUNGTU,003092], @param2=[NGAYCHUNGTU,9/20/2019 5:03:37 PM], @param3=[LOAICHUNGTU,X], @param4=[MUCDICHCHUNGTU_ID,1060], @param5=[MUCDICHCHUNGTU_CODE,X13], @param6=[KHOXUAT_ID,32], @param7=[NGUOIGIAO_ID,0], @param8=[NGUOIGIAO,null], @param9=[KHONHAP_ID,null], @param10=[NGUOINHAN_ID,null], @param11=[NGUOINHAN,null], @param12=[NGUOIKIEMTRA_ID,null], @param13=[NGUOIKIEMTRA,null], @param14=[NGUOIDUYET_ID,null], @param15=[NGUOIDUYET,null], @param16=[PHUONGPHAPXUAT,0], @param17=[KETOANTRUONG_ID,null], @param18=[KETOANTRUONG,null], @param19=[THUKHO_ID,null], @param20=[THUKHO,null], @param21=[MAUHOADON,null], @param22=[SOHOADON,null], @param23=[SOSERI,null], @param24=[NGAYHOADON,null], @param25=[DIENGIAI,null], @param26=[GIATRI,null], @param27=[GIATRITHANHTOAN,null], @param28=[TYLEVAT,5], @param29=[GIATRIVAT,0], @param30=[THUESUAT,null], @param31=[GIATRITHUE,null], @param32=[TYLECHIETKHAU,null], @param33=[GIATRICHIETKHAU,null], @param34=[TIENTE_ID,null], @param35=[TYGIA,null], @param36=[SOCHUNGTUGOC,null], @param37=[NGAYCHUNGTUGOC,null], @param38=[NHACUNGCAP_ID,null], @param39=[HINHTHUCTHANHTOAN_ID,null], @param40=[NGUONDUOC_ID,null], @param41=[CHUNGTULIENQUAN_ID,null], @param42=[KHAMBENH_ID,null], @param43=[TOATHUOCNOITRU_ID,null], @param44=[TIEPNHAN_ID,null], @param45=[BENHAN_ID,null], @param46=[DANHANTHUOC,], @param47=[NGUOINHAP_ID,null], @param48=[NGAYNHAP,null], @param49=[TRANGTHAI,DAXUAT], @param50=[LOAITOATHUOC,null], @param51=[PHIEULINH_ID,null], @param52=[DIENGIAINGHIEPVUPHATSINH,null], @param53=[DONVIGIAO_ID,null], @param54=[KHOSUDUNG_ID,null], @param55=[LOAIVATTU_ID,null], @param56=[BENHNHAN_ID,null], @param57=[NGOAITRU_TOATHUOC_NGUOIMUA_ID,null], @param58=[TENBENHNHAN,null], @param59=[BACSIGIOITHIEU_ID,null], @param60=[DOITUONG_ID,null], @param61=[IDCHUYEN,null], @param62=[CHUNGTUKETOAN,null], @param63=[STATUS,null], @param64=[TRANSFER_VIENPHI_ID,null], @param65=[PHONGBAN_ID,62], @param66=[BACSI_ID,null], @param67=[TKNO,null], @param68=[TKCO,null], @param69=[MACHUNGTUREF,null], @param70=[LOAICHUNGTUREF,null], @param71=[PHIEULINHCANTRU_ID,null], @param72=[KHOTHUCHIEN_ID,null], @param73=[KHODOIUNG_ID,null], @param74=[MENU_LOAIDUOC_ID,null], @param75=[NGUOISUDUNGMAY_ID,null], @param76=[GOITHAU_ID,null], @param77=[XUATTHUOCBANGOAITRU,null], @param78=[NGAYGIOCHUNGTU,null], @param79=[NOIDAKHAM,null], @param80=[HOIDONGKIEMNHAP_ID,null], @param81=[HOIDONGTHANHLY_ID,null], @param82=[CHUYENCHUNGTUID,null], @param83=[CHUYENDOANHTHUID,null], @param84=[LYDOXUATSUDUNG_ID,8294], @param85=[BENHVIEN_ID,HLU01], @param86=[NGUOITAO_ID,0], @param87=[NGAYCAPNHAT,9/20/2019 5:03:37 PM], @param88=[NGUOICAPNHAT_ID,0]]
2019-09-20 17:03:37,482 [1] DEBUG - Statement Id: [DAO00030_Add] Types: [@param0=[String, System.String], @param1=[String, System.String], @param2=[DateTime, System.DateTime], @param3=[String, System.String], @param4=[Int32, System.Int32], @param5=[String, System.String], @param6=[Int32, System.Int32], @param7=[Int32, System.Int32], @param8=[System.DBNull, null], @param9=[System.DBNull, null], @param10=[System.DBNull, null], @param11=[System.DBNull, null], @param12=[System.DBNull, null], @param13=[System.DBNull, null], @param14=[System.DBNull, null], @param15=[System.DBNull, null], @param16=[Int32, System.Int32], @param17=[System.DBNull, null], @param18=[System.DBNull, null], @param19=[System.DBNull, null], @param20=[System.DBNull, null], @param21=[System.DBNull, null], @param22=[System.DBNull, null], @param23=[System.DBNull, null], @param24=[System.DBNull, null], @param25=[System.DBNull, null], @param26=[System.DBNull, null], @param27=[System.DBNull, null], @param28=[Decimal, System.Decimal], @param29=[Decimal, System.Decimal], @param30=[System.DBNull, null], @param31=[System.DBNull, null], @param32=[System.DBNull, null], @param33=[System.DBNull, null], @param34=[System.DBNull, null], @param35=[System.DBNull, null], @param36=[System.DBNull, null], @param37=[System.DBNull, null], @param38=[System.DBNull, null], @param39=[System.DBNull, null], @param40=[System.DBNull, null], @param41=[System.DBNull, null], @param42=[System.DBNull, null], @param43=[System.DBNull, null], @param44=[System.DBNull, null], @param45=[System.DBNull, null], @param46=[String, System.String], @param47=[System.DBNull, null], @param48=[System.DBNull, null], @param49=[String, System.String], @param50=[System.DBNull, null], @param51=[System.DBNull, null], @param52=[System.DBNull, null], @param53=[System.DBNull, null], @param54=[System.DBNull, null], @param55=[System.DBNull, null], @param56=[System.DBNull, null], @param57=[System.DBNull, null], @param58=[System.DBNull, null], @param59=[System.DBNull, null], @param60=[System.DBNull, null], @param61=[System.DBNull, null], @param62=[System.DBNull, null], @param63=[System.DBNull, null], @param64=[System.DBNull, null], @param65=[Int32, System.Int32], @param66=[System.DBNull, null], @param67=[System.DBNull, null], @param68=[System.DBNull, null], @param69=[System.DBNull, null], @param70=[System.DBNull, null], @param71=[System.DBNull, null], @param72=[System.DBNull, null], @param73=[System.DBNull, null], @param74=[System.DBNull, null], @param75=[System.DBNull, null], @param76=[System.DBNull, null], @param77=[System.DBNull, null], @param78=[System.DBNull, null], @param79=[System.DBNull, null], @param80=[System.DBNull, null], @param81=[System.DBNull, null], @param82=[System.DBNull, null], @param83=[System.DBNull, null], @param84=[Int32, System.Int32], @param85=[String, System.String], @param86=[Int32, System.Int32], @param87=[DateTime, System.DateTime], @param88=[Int32, System.Int32]]
2019-09-20 17:03:37,534 [1] DEBUG - Statement Id: [DAO00030_CHUNGTUCT_AddMulti] PreparedStatement : [declare @json nvarchar(max) =  N'[{"SOLONHAP_ID":7541,"SOLONHAP":"190500624","SOLOSANPHAM":"a","SOKIEMSOAT":null,"SOVISA":"1","SOLOSOTON":"a/6.0000","NGAYNHAPLO":"2019-05-06T10:24:00","HANSUDUNG":"2026-12-12T00:00:00","HANDUNG":"2026-12-12T00:00:00","NGUONDUOC_ID":1,"NGUONHANG_ID":1,"DONGIAMUA":945.0000,"DONGIAVON":945.0000,"TYLEVAT":0.0000,"TYLE_VAT":0.00,"DONGIAVONVAT":945.0000,"DONGIABANVAT_DAUVAO":945.0000,"DONGIATHAU":1030.00,"DONGIABAN":1030.00,"DONGIABAN_VAT":1030.00,"KHODUOC_ID":32,"DUOC_ID":1,"SOLUONG":6.0000,"SOLUONGTON":6.0000,"TENDUOCDAYDU":null,"DONVITINH_ID":17,"DONVITINH":"Cái","BHYT":"1","NGUONHANG":"Nguồn Mua","DUOC_KEY":"32_1_1","CHUNGTUCHITIET_ID":0,"CHUNGTU_ID":137704,"SOLUONGTHUCTE":null,"TOATHUOC":"NGOAITRU_KHAMBENH_VTYT","TOATHUOCNOITRU_ID":null,"REF_TABLE":"TT_NGOAITRU_KHAMBENH_VTYT","REF_ID":10593,"KHAMBENH_VTYT_ID":10593,"BENHNHAN":"Người bệnh: 190043304 - Test Xn1 - 20/09/2019 - 16:50","SOLUONGYEUCAU":2,"PHAUTHUAT_VTYT_ID":null,"CLSKETQUA_VTYT_ID":null,"SOLUONGDAXUAT":2.0,"THANHTIENVON":1890.0000,"NGAYTAO":"20/Sep/2019 17:03:37","NGUOITAO_ID":0,"BENHVIEN_ID":"HLU01"}]';             INSERT INTO TT_DUOC_CHUNGTU_CHITIET           (           CHUNGTU_ID           , DUOC_ID           , SOLONHAP_ID           , SOKIEMSOAT           , SOVISA           , HANDUNG           , DONVITINH_ID           , SOLUONGYEUCAU           , SOLUONGTHUCTE           , SOLUONGDAXUAT           , TIENTE_ID           , TYGIA           , DONGIAMUA           , DONGIA_BHYT           , DONGIABAN           , DONGIABAN_VAT           , DONGIAVON           , DONGIATHANHTOAN           , SOQUYEN           , SOHOADONVAT           , TYLEVAT           , GIATRIVAT           , TYLECHIETKHAU           , GIATRICHIETKHAU           , MIENPHI           , LYDOMIENPHI_ID           , SOCHUNGTUKETOAN           , SOCHUNGTUTIENMAT           , TRANGTHAI           , DAPHATSINHPHIEUXUAT           , DAPHATSINHPHIEUHOANTRA           , KHUYENMAI           , PHUONGPHAPXUAT           , DONDATHANG_ID           , GHICHUCHITIET           , NGUONHANG_ID           , DONGIAVONVAT           , THANHTIENMUA           , THANHTIENVON           , THANHTIENHOPDONG           , ISTACHLO           , DONVITINHBANDAU_ID           , SOLUONGBANDAU           , GOITHAU_ID           , DONGIATHAU           , DONGIAPO           , TYLEQUIDOI           , TOATHUOCNOITRU_ID           , KHAMBENH_VTYT_ID           , PHAUTHUAT_VTYT_ID           , CLSKETQUA_VTYT_ID           , TOATHUOCNGOAITRU_ID           , CHUNGTUCHITIET_LIENQUAN_ID           , MASTER_ID           , BENHNHAN           , YLENH           , BENHVIEN_ID           , NGAYTAO           , NGUOITAO_ID                    )                  SELECT * FROM OPENJSON(@json)           WITH (           CHUNGTU_ID int           , DUOC_ID int           , SOLONHAP_ID int           , SOKIEMSOAT varchar(20)           , SOVISA varchar(20)           , HANDUNG datetime           , DONVITINH_ID int           , SOLUONGYEUCAU numeric(25, 4)           , SOLUONGTHUCTE numeric(25, 4)           , SOLUONGDAXUAT numeric(25, 4)           , TIENTE_ID nchar(3)           , TYGIA numeric(25, 4)           , DONGIAMUA numeric(25, 4)           , DONGIA_BHYT numeric(25, 4)           , DONGIABAN numeric(25, 4)           , DONGIABAN_VAT numeric(25, 4)           , DONGIAVON numeric(25, 4)           , DONGIATHANHTOAN numeric(25, 4)           , SOQUYEN varchar(20)           , SOHOADONVAT varchar(20)           , TYLEVAT  numeric(25, 4)           , GIATRIVAT numeric(25, 4)           , TYLECHIETKHAU numeric(25, 4)           , GIATRICHIETKHAU numeric(25, 4)           , MIENPHI char(1)           , LYDOMIENPHI_ID int           , SOCHUNGTUKETOAN varchar(20)           , SOCHUNGTUTIENMAT varchar(20)           , TRANGTHAI varchar(10)           , DAPHATSINHPHIEUXUAT char(1)           , DAPHATSINHPHIEUHOANTRA char(1)           , KHUYENMAI char(1)           , PHUONGPHAPXUAT int           , DONDATHANG_ID int           , GHICHUCHITIET nvarchar(255)           , NGUONHANG_ID int           , DONGIAVONVAT numeric(25, 4)           , THANHTIENMUA numeric(25, 4)           , THANHTIENVON numeric(25, 4)           , THANHTIENHOPDONG numeric(25, 4)           , ISTACHLO char(1)           , DONVITINHBANDAU_ID int           , SOLUONGBANDAU numeric(25, 4)           , GOITHAU_ID int           , DONGIATHAU numeric(25, 4)           , DONGIAPO numeric(25, 4)           , TYLEQUIDOI numeric(25, 4)           , TOATHUOCNOITRU_ID int           , KHAMBENH_VTYT_ID int           , PHAUTHUAT_VTYT_ID int           , CLSKETQUA_VTYT_ID int           , TOATHUOCNGOAITRU_ID int           , CHUNGTUCHITIET_LIENQUAN_ID int           , MASTER_ID int           , BENHNHAN nvarchar(1000)           , YLENH nvarchar(MAX)           , BENHVIEN_ID varchar(10)           , NGAYTAO datetime           , NGUOITAO_ID int                  )                      IF('X13' = 'X13')           BEGIN                      UPDATE TT_NOITRU_TOATHUOC SET CHUNGTU_ID = json.CHUNGTU_ID, TRANGTHAI = 'DAXUAT', NGAYCAPNHAT = getdate()           FROM OPENJSON(@json)           WITH (CHUNGTU_ID int, TOATHUOCNOITRU_ID int) json           WHERE TT_NOITRU_TOATHUOC.TOATHUOC_ID = json.TOATHUOCNOITRU_ID and json.TOATHUOCNOITRU_ID is not NULL                  UPDATE TT_VIENPHI set DUYET = '1', DATHUCHIEN = '1', NGAYCAPNHAT = getdate()           FROM OPENJSON(@json)           WITH (TOATHUOCNOITRU_ID int) json           WHERE TT_VIENPHI.REF_TABLE = 'TT_NOITRU_TOATHUOC' and TT_VIENPHI.REF_ID = json.TOATHUOCNOITRU_ID and json.TOATHUOCNOITRU_ID is not NULL                                 UPDATE TT_NGOAITRU_KHAMBENH_VTYT SET CHUNGTU_ID = json.CHUNGTU_ID, TRANGTHAI = 'DAXUAT', NGAYCAPNHAT = getdate()           FROM OPENJSON(@json)           WITH (CHUNGTU_ID int, KHAMBENH_VTYT_ID int) json           WHERE TT_NGOAITRU_KHAMBENH_VTYT.KHAMBENH_VTYT_ID = json.KHAMBENH_VTYT_ID and json.KHAMBENH_VTYT_ID is not NULL                  UPDATE TT_VIENPHI set DUYET = '1', DATHUCHIEN = '1', NGAYCAPNHAT = getdate()           FROM OPENJSON(@json)           WITH (KHAMBENH_VTYT_ID int) json           WHERE TT_VIENPHI.REF_TABLE = 'TT_NGOAITRU_KHAMBENH_VTYT' and TT_VIENPHI.REF_ID = json.KHAMBENH_VTYT_ID and json.KHAMBENH_VTYT_ID is not NULL                                  UPDATE TT_PHAUTHUAT_VTYT SET CHUNGTU_ID = json.CHUNGTU_ID           FROM OPENJSON(@json)           WITH (CHUNGTU_ID int, PHAUTHUAT_VTYT_ID int) json           WHERE TT_PHAUTHUAT_VTYT.PHAUTHUAT_VTYT_ID = json.PHAUTHUAT_VTYT_ID and json.PHAUTHUAT_VTYT_ID is not NULL                  UPDATE TT_VIENPHI set DUYET = '1', DATHUCHIEN = '1', NGAYCAPNHAT = getdate()           FROM OPENJSON(@json)           WITH (PHAUTHUAT_VTYT_ID int) json           WHERE TT_VIENPHI.REF_TABLE = 'TT_PHAUTHUAT_VTYT' and TT_VIENPHI.REF_ID = json.PHAUTHUAT_VTYT_ID and json.PHAUTHUAT_VTYT_ID is not NULL                              UPDATE TT_CLSKETQUA_VTYT SET CHUNGTU_ID = json.CHUNGTU_ID, TRANGTHAI = 'DAXUAT', NGAYCAPNHAT = getdate()           FROM OPENJSON(@json)           WITH (CHUNGTU_ID int, CLSKETQUA_VTYT_ID int) json           WHERE TT_CLSKETQUA_VTYT.CLSKETQUA_VTYT_ID = json.CLSKETQUA_VTYT_ID and json.CLSKETQUA_VTYT_ID is not NULL                  UPDATE TT_VIENPHI set DUYET = '1', DATHUCHIEN = '1', NGAYCAPNHAT = getdate()           FROM OPENJSON(@json)           WITH (CLSKETQUA_VTYT_ID int) json           WHERE TT_VIENPHI.REF_TABLE = 'TT_CLSKETQUA_VTYT' and TT_VIENPHI.REF_ID = json.CLSKETQUA_VTYT_ID and json.CLSKETQUA_VTYT_ID is not NULL                      END]
2019-09-20 17:03:38,614 [1] DEBUG - Statement Id: [DAO00030_DUOC_TONKHO_BOOKING_NGOAITRU_Giam] PreparedStatement : [update TT_DUOC_TONKHO_BOOK_NGOAITRU            set            SOLUONG = 0                     ,NGAYCAPNHAT = getdate()            where            REF_TABLE = 'TT_NGOAITRU_KHAMBENH_VTYT'            AND REF_ID = '10593'                AND BENHVIEN_ID = 'HLU01']
2019-09-20 17:03:38,671 [1] DEBUG - Statement Id: [DAO00030_DUOCTONKHO_Giam] PreparedStatement : [update TT_DUOC_TONKHO set            SOLUONG = SOLUONG -  @param0             , NGAYCAPNHAT =  getdate()            , NGUOICAPNHAT_ID =  @param1             where            KHODUOC_ID =  @param2             and DUOC_ID =  @param3             and SOLONHAP_ID =  @param4]
2019-09-20 17:03:38,671 [1] DEBUG - Statement Id: [DAO00030_DUOCTONKHO_Giam] Parameters: [@param0=[SOLUONGTHAYDOI,2], @param1=[NGUOICAPNHAT_ID,null], @param2=[KHODUOC_ID,32], @param3=[DUOC_ID,1], @param4=[SOLONHAP_ID,7541]]
2019-09-20 17:03:38,671 [1] DEBUG - Statement Id: [DAO00030_DUOCTONKHO_Giam] Types: [@param0=[Decimal, System.Decimal], @param1=[System.DBNull, null], @param2=[Int32, System.Int32], @param3=[Int32, System.Int32], @param4=[Int32, System.Int32]]
2019-09-20 17:03:38,700 [1] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoCOM18] PreparedStatement : [select  distinct TT_TONKHO.DUOC_KEY, LTRIM(TT_TONKHO.KHODUOC_ID) as KHODUOC_ID, TM_DUOC.DUOC_ID, TM_LOAIDUOC.MALOAIDUOC,TM_DUOC.SOVISA,TM_DUOC.TYLE_VAT,TM_DUOC.COTOA,        TM_DUOC.MADUOC, TM_DUOC.TENHANG, TM_DUOC.TENDUOCDAYDU, dvt.TENDONVITINH as DONVITINH, TM_DUOC.DONVITINH_ID, TM_DUOC.BHYT,        TM_DUOC.TENHOATCHAT, TM_DUOC.HAMLUONG, TM_DUOC.HANGSANXUAT, TM_DUOC.QUOCGIA, TM_DUOC.LOAIDUOC_ID, TM_DUOC.DUONGDUNG_ID,        TM_TENDUOC.TENDUOC, TM_TENDUOC.TENDUOC_EN, TM_TENDUOC.MAQUOCTE, TM_TENDUOC.MAQUOCTEBT,        TM_LOAIDUOC.LOAIVATTU_ID, TM_DUOC.BENHVIEN_ID,        TT_TONKHO.SOLUONG, TM_DUOC.VTYT_PHANLOAI, TM_DUOC.PHAMVI, TT_TONKHO.NGUONDUOC_ID, NG.TENNGUONDUOC        , TAMNGUNG = CASE WHEN TM_DUOC.TAMNGUNG = '1' OR NG.TAMNGUNG = '1' OR KD.TAMNGUNG = '1' THEN '1' ELSE '0' END        , TM_DUOC.DANGTRINHBAY        from TM_DUOC        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = TM_DUOC.DONVITINH_ID        left join TM_TENDUOC on TM_DUOC.TENDUOC_ID = TM_TENDUOC.TENDUOC_ID and TM_DUOC.BENHVIEN_ID = 'HLU01'  and TM_DUOC.TAMNGUNG = '0'        left join TM_LOAIDUOC on TM_LOAIDUOC.LOAIDUOC_ID = TM_DUOC.LOAIDUOC_ID and TM_LOAIDUOC.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG on (TM_LOAIDUOC.LOAIVATTU_ID = TM_DUOC_HANDUNG.LOAIDUOC and TM_DUOC_HANDUNG.BENHVIEN_ID = 'HLU01')        inner join        (select LTRIM(A.KHODUOC_ID) + '_' + LTRIM(A.DUOC_ID) + '_' + LTRIM(ISNULL(A.NGUONDUOC_ID,'')) as DUOC_KEY, A.KHODUOC_ID, A.DUOC_ID ,a.NGUONDUOC_ID,        SUM(isnull(A.SOLUONG,0)) as SOLUONG        from        (select SUM(SOLUONG) as SOLUONG, KHODUOC_ID, DUOC_ID, NGUONDUOC_ID from TT_DUOC_TONKHO        where KHODUOC_ID in (32) and DUOC_ID in (1) group by KHODUOC_ID, DUOC_ID, NGUONDUOC_ID        ) A        where A.KHODUOC_ID in (32) and A.DUOC_ID in (1)        group by LTRIM(A.KHODUOC_ID) + '_' + LTRIM(A.DUOC_ID) + '_' + LTRIM(A.NGUONDUOC_ID), A.KHODUOC_ID, A.DUOC_ID, A.NGUONDUOC_ID)        TT_TONKHO on TT_TONKHO.DUOC_ID = TM_DUOC.DUOC_ID        LEFT JOIN TM_NGUONHANG NG ON NG.NGUONDUOC_ID = TT_TONKHO.NGUONDUOC_ID        LEFT JOIN TM_KHODUOC KD ON KD.KHODUOC_ID = TT_TONKHO.KHODUOC_ID        where TM_DUOC.BENHVIEN_ID = 'HLU01' and TM_DUOC.DUOC_ID in (1)]
2019-09-20 17:03:38,736 [1] DEBUG - Statement Id: [DAO00030_GetListPhamViByKhoDuoc] PreparedStatement : [SELECT DISTINCT PHAMVI_ID          FROM TM_DUOC_PHAMVISD_MAPPING          WHERE          KHODUOC_ID IN (32)          AND BENHVIEN_ID ='HLU01'          AND TAMNGUNG = '0']
2019-09-20 17:03:38,766 [1] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoVaBookingCOM23] PreparedStatement : [declare @NGUONDUOC_MACDINH varchar(5) = '0';        declare @TOAMUANGOAI int = 0;        select @NGUONDUOC_MACDINH = isnull(VALUE,0) from TM_SYS_APPSETTINGS where CODE = 'PHA_NGUONDUOC'        select @TOAMUANGOAI = isnull(VALUE,0) from TM_SYS_APPSETTINGS where CODE = 'OPD_TOAMUANGOAI_DUNGDANHMUC_DUOC'                if @TOAMUANGOAI = 1        begin        select  distinct '0' + '_' + LTRIM(d.DUOC_ID) + '_' + @NGUONDUOC_MACDINH as DUOC_KEY, 0 as PHAMVI_ID, @NGUONDUOC_MACDINH as NGUONDUOC_ID, null as TENNGUONDUOC, null as TINHTIEN, d.DUOC_ID, ld.MALOAIDUOC,        d.SOVISA,d.TYLE_VAT,d.COTOA, d.MADUOC, d.TENHANG, d.TENDUOCDAYDU, dvt.TENDONVITINH as DONVITINH, d.BHYT,        d.TENHOATCHAT, d.HAMLUONG, d.HANGSANXUAT, d.QUOCGIA, d.LOAIDUOC_ID, d.DUONGDUNG_ID, d.TINHTIEN_PTTT,        ten.TENDUOC, ten.TENDUOC_EN, ten.MAQUOCTE, ten.MAQUOCTEBT,        '' as BHYT_TEXT        , ld.LOAIVATTU_ID        , d.BENHVIEN_ID,        999999999 as SOLUONG, d.VTYT_PHANLOAI, d.PHAMVI, d.SUASOLUONGTONGHOP, d.MADUOCBV, d.DANGTRINHBAY        , TAMNGUNG = CASE WHEN d.TAMNGUNG = '1' THEN '1' ELSE '0' END        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        where d.DUOC_ID in (1)        union all        select  distinct tk.DUOC_KEY, LTRIM(tk.PHAMVI_ID) as PHAMVI_ID, tk.NGUONDUOC_ID, nh.TENNGUONDUOC, nh.TINHTIEN, d.DUOC_ID, ld.MALOAIDUOC,        d.SOVISA,d.TYLE_VAT,d.COTOA, d.MADUOC, d.TENHANG, d.TENDUOCDAYDU, dvt.TENDONVITINH as DONVITINH, d.BHYT,        d.TENHOATCHAT, d.HAMLUONG, d.HANGSANXUAT, d.QUOCGIA, d.LOAIDUOC_ID, d.DUONGDUNG_ID, d.TINHTIEN_PTTT,        ten.TENDUOC, ten.TENDUOC_EN, ten.MAQUOCTE, ten.MAQUOCTEBT,        CASE WHEN d.BHYT = '1' THEN 'BHYT' ELSE '' END as BHYT_TEXT        , ld.LOAIVATTU_ID        , d.BENHVIEN_ID,        tk.SOLUONG, d.VTYT_PHANLOAI, d.PHAMVI, d.SUASOLUONGTONGHOP, d.MADUOCBV, d.DANGTRINHBAY        , TAMNGUNG = CASE WHEN d.TAMNGUNG = '1' OR nh.TAMNGUNG = '1' OR kd.TAMNGUNG = '1' THEN '1' ELSE '0' END        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        inner join        (        select  LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')) DUOC_KEY, (SUM(dtk.SOLUONG) - isnull(sum(A.SOLUONG),0) - isnull(sum(B.SOLUONG),0)) SOLUONG, pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        from (select sum(soluong) soluong,duoc_id,nguonduoc_id,khoduoc_id,benhvien_id from TT_DUOC_TONKHO  group by duoc_id,nguonduoc_id,khoduoc_id,benhvien_id) dtk        inner join TM_DUOC_PHAMVISD_MAPPING pvsd on dtk.KHODUOC_ID = pvsd.KHODUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NOITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) B on B.DUOC_ID = dtk.DUOC_ID and B.SOLUONG > 0 and B.PHAMVI_ID = pvsd.PHAMVI_ID and B.NGUONHANG_ID = dtk.NGUONDUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NGOAITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) A on A.DUOC_ID = dtk.DUOC_ID and A.SOLUONG > 0 and A.PHAMVI_ID = pvsd.PHAMVI_ID and A.NGUONHANG_ID = dtk.NGUONDUOC_ID        where dtk.SOLUONG > 0 and dtk.BENHVIEN_ID = 'HLU01'        group by LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')), pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        ) tk on tk.DUOC_ID = d.DUOC_ID        left join TM_DUOC_PHAMVISUDUNG kd on kd.PHAMVI_ID = tk.PHAMVI_ID and kd.BENHVIEN_ID = 'HLU01'        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = tk.NGUONDUOC_ID and nh.BENHVIEN_ID = 'HLU01'        where  d.BENHVIEN_ID = 'HLU01' and d.DUOC_ID in (1) and TK.PHAMVI_ID in (1055)        and tk.NGUONDUOC_ID in (1)         end        else        begin                select  distinct tk.DUOC_KEY, LTRIM(tk.PHAMVI_ID) as PHAMVI_ID, tk.NGUONDUOC_ID, nh.TENNGUONDUOC, nh.TINHTIEN, d.DUOC_ID, ld.MALOAIDUOC,        d.SOVISA,d.TYLE_VAT,d.COTOA, d.MADUOC, d.TENHANG, d.TENDUOCDAYDU, dvt.TENDONVITINH as DONVITINH, d.BHYT,        d.TENHOATCHAT, d.HAMLUONG, d.HANGSANXUAT, d.QUOCGIA, d.LOAIDUOC_ID, d.DUONGDUNG_ID, d.TINHTIEN_PTTT,        ten.TENDUOC, ten.TENDUOC_EN, ten.MAQUOCTE, ten.MAQUOCTEBT,        CASE WHEN d.BHYT = '1' THEN 'BHYT' ELSE '' END as BHYT_TEXT        , ld.LOAIVATTU_ID        , d.BENHVIEN_ID,        tk.SOLUONG, d.VTYT_PHANLOAI, d.PHAMVI, d.SUASOLUONGTONGHOP, d.MADUOCBV, d.DANGTRINHBAY        , TAMNGUNG = CASE WHEN d.TAMNGUNG = '1' OR nh.TAMNGUNG = '1' OR kd.TAMNGUNG = '1' THEN '1' ELSE '0' END        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        inner join        (        select  LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')) DUOC_KEY, (SUM(dtk.SOLUONG) - isnull(sum(A.SOLUONG),0) - isnull(sum(B.SOLUONG),0)) SOLUONG, pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        from (select sum(soluong) soluong,duoc_id,nguonduoc_id,khoduoc_id,benhvien_id from TT_DUOC_TONKHO  group by duoc_id,nguonduoc_id,khoduoc_id,benhvien_id) dtk        inner join TM_DUOC_PHAMVISD_MAPPING pvsd on dtk.KHODUOC_ID = pvsd.KHODUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NOITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) B on B.DUOC_ID = dtk.DUOC_ID and B.SOLUONG > 0 and B.PHAMVI_ID = pvsd.PHAMVI_ID and B.NGUONHANG_ID = dtk.NGUONDUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NGOAITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) A on A.DUOC_ID = dtk.DUOC_ID and A.SOLUONG > 0 and A.PHAMVI_ID = pvsd.PHAMVI_ID and A.NGUONHANG_ID = dtk.NGUONDUOC_ID        where dtk.SOLUONG > 0 and dtk.BENHVIEN_ID = 'HLU01'        group by LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')), pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        ) tk on tk.DUOC_ID = d.DUOC_ID        left join TM_DUOC_PHAMVISUDUNG kd on kd.PHAMVI_ID = tk.PHAMVI_ID and kd.BENHVIEN_ID = 'HLU01'        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = tk.NGUONDUOC_ID and nh.BENHVIEN_ID = 'HLU01'        where  d.BENHVIEN_ID = 'HLU01' and d.DUOC_ID in (1) and TK.PHAMVI_ID in (1055)        and tk.NGUONDUOC_ID in (1)         end]
2019-09-20 17:03:38,948 [1] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoCOM18UpdateRedis] PreparedStatement : [select distinct TT_TONKHO.DUOC_KEY, LTRIM(TT_TONKHO.KHODUOC_ID) as KHODUOC_ID, TM_DUOC.DUOC_ID, TM_LOAIDUOC.MALOAIDUOC,TM_DUOC.SOVISA,TM_DUOC.TYLE_VAT,TM_DUOC.COTOA,        TM_DUOC.MADUOC, TM_DUOC.TENHANG, TM_DUOC.TENDUOCDAYDU, dvt.TENDONVITINH as DONVITINH,  TM_DUOC.DONVITINH_ID,TM_DUOC.BHYT,        TM_DUOC.TENHOATCHAT,        TM_DUOC.HAMLUONG, TM_DUOC.HANGSANXUAT, TM_DUOC.QUOCGIA, TM_DUOC.LOAIDUOC_ID, TM_DUOC.DUONGDUNG_ID,        TM_TENDUOC.TENDUOC, TM_TENDUOC.TENDUOC_EN, TM_TENDUOC.MAQUOCTE, TM_TENDUOC.MAQUOCTEBT,        TM_LOAIDUOC.LOAIVATTU_ID, TM_DUOC.BENHVIEN_ID,        TT_TONKHO.SOLUONG, TM_DUOC.VTYT_PHANLOAI, TM_DUOC.PHAMVI, TT_TONKHO.NGUONDUOC_ID, NG.TENNGUONDUOC AS TENNGUONDUOC        , TAMNGUNG = CASE WHEN TM_DUOC.TAMNGUNG = '1' OR NG.TAMNGUNG = '1' OR KD.TAMNGUNG = '1' THEN '1' ELSE '0' END        , TM_DUOC.DANGTRINHBAY        from TM_DUOC        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = TM_DUOC.DONVITINH_ID        left join TM_TENDUOC on TM_DUOC.TENDUOC_ID = TM_TENDUOC.TENDUOC_ID and TM_DUOC.BENHVIEN_ID = 'HLU01' and TM_DUOC.TAMNGUNG = '0'        left join TM_LOAIDUOC on TM_LOAIDUOC.LOAIDUOC_ID = TM_DUOC.LOAIDUOC_ID and TM_LOAIDUOC.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG on (TM_LOAIDUOC.LOAIVATTU_ID = TM_DUOC_HANDUNG.LOAIDUOC and TM_DUOC_HANDUNG.BENHVIEN_ID = 'HLU01')        inner join        (select LTRIM(A.KHODUOC_ID) + '_' + LTRIM(A.DUOC_ID) + '_' + LTRIM(ISNULL(A.NGUONDUOC_ID,'')) as DUOC_KEY, A.KHODUOC_ID, A.DUOC_ID, A.NGUONDUOC_ID,        SUM(isnull(A.SOLUONG,0)) as SOLUONG        from        (select SUM(SOLUONG) as SOLUONG, KHODUOC_ID, DUOC_ID, NGUONDUOC_ID from TT_DUOC_TONKHO        where BENHVIEN_ID = 'HLU01' group by KHODUOC_ID, DUOC_ID, NGUONDUOC_ID) A        group by LTRIM(A.KHODUOC_ID) + '_' + LTRIM(A.DUOC_ID) + '_' + LTRIM(ISNULL(A.NGUONDUOC_ID,'')), A.KHODUOC_ID, A.DUOC_ID, NGUONDUOC_ID        ) TT_TONKHO on TT_TONKHO.DUOC_ID = TM_DUOC.DUOC_ID        LEFT JOIN TM_NGUONHANG NG ON NG.NGUONDUOC_ID = TT_TONKHO.NGUONDUOC_ID        LEFT JOIN TM_KHODUOC KD ON KD.KHODUOC_ID = TT_TONKHO.KHODUOC_ID        where TM_DUOC.BENHVIEN_ID = 'HLU01' and TT_TONKHO.SOLUONG >= 0        and TM_DUOC.DUOC_ID in (1)]
2019-09-20 17:03:39,138 [1] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoVaBookingCOM23UpdateRedis] PreparedStatement : [declare @NGUONDUOC_MACDINH varchar(5) = '0';        declare @TOAMUANGOAI int = 0;        select @NGUONDUOC_MACDINH = isnull(VALUE,0) from TM_SYS_APPSETTINGS where CODE = 'PHA_NGUONDUOC'        select @TOAMUANGOAI = isnull(VALUE,0) from TM_SYS_APPSETTINGS where CODE = 'OPD_TOAMUANGOAI_DUNGDANHMUC_DUOC'                if @TOAMUANGOAI = 1        begin        select  distinct '0' + '_' + LTRIM(d.DUOC_ID) + '_' + @NGUONDUOC_MACDINH as DUOC_KEY, 0 as PHAMVI_ID, @NGUONDUOC_MACDINH as NGUONDUOC_ID, null as TENNGUONDUOC, null as TINHTIEN, d.DUOC_ID, ld.MALOAIDUOC,        d.SOVISA,d.TYLE_VAT,d.COTOA, d.MADUOC, d.TENHANG, d.TENDUOCDAYDU, dvt.TENDONVITINH as DONVITINH, d.BHYT,        d.TENHOATCHAT, d.HAMLUONG, d.HANGSANXUAT, d.QUOCGIA, d.LOAIDUOC_ID, d.DUONGDUNG_ID, d.TINHTIEN_PTTT,        ten.TENDUOC, ten.TENDUOC_EN, ten.MAQUOCTE, ten.MAQUOCTEBT,        '' as BHYT_TEXT        , ld.LOAIVATTU_ID        , d.BENHVIEN_ID,        999999999 as SOLUONG, d.VTYT_PHANLOAI, d.PHAMVI, d.SUASOLUONGTONGHOP, d.MADUOCBV, d.DANGTRINHBAY        , TAMNGUNG = CASE WHEN d.TAMNGUNG = '1' THEN '1' ELSE '0' END        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        where d.DUOC_ID in (1)        union all        select  distinct tk.DUOC_KEY, LTRIM(tk.PHAMVI_ID) as PHAMVI_ID, tk.NGUONDUOC_ID, nh.TENNGUONDUOC, nh.TINHTIEN, d.DUOC_ID, ld.MALOAIDUOC,        d.SOVISA,d.TYLE_VAT,d.COTOA, d.MADUOC, d.TENHANG, d.TENDUOCDAYDU, dvt.TENDONVITINH as DONVITINH, d.BHYT,        d.TENHOATCHAT, d.HAMLUONG, d.HANGSANXUAT, d.QUOCGIA, d.LOAIDUOC_ID, d.DUONGDUNG_ID, d.TINHTIEN_PTTT,        ten.TENDUOC, ten.TENDUOC_EN, ten.MAQUOCTE, ten.MAQUOCTEBT,        CASE WHEN d.BHYT = '1' THEN 'BHYT' ELSE '' END as BHYT_TEXT        , ld.LOAIVATTU_ID        , d.BENHVIEN_ID,        tk.SOLUONG, d.VTYT_PHANLOAI, d.PHAMVI, d.SUASOLUONGTONGHOP, d.MADUOCBV, d.DANGTRINHBAY        , TAMNGUNG = CASE WHEN d.TAMNGUNG = '1' OR nh.TAMNGUNG = '1' OR kd.TAMNGUNG = '1' THEN '1' ELSE '0' END        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        inner join        (        select  LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')) DUOC_KEY, (SUM(dtk.SOLUONG) - isnull(sum(A.SOLUONG),0) - isnull(sum(B.SOLUONG),0)) SOLUONG, pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        from (select sum(soluong) soluong,duoc_id,nguonduoc_id,khoduoc_id,benhvien_id from TT_DUOC_TONKHO  group by duoc_id,nguonduoc_id,khoduoc_id,benhvien_id) dtk        inner join TM_DUOC_PHAMVISD_MAPPING pvsd on dtk.KHODUOC_ID = pvsd.KHODUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NOITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) B on B.DUOC_ID = dtk.DUOC_ID and B.SOLUONG > 0 and B.PHAMVI_ID = pvsd.PHAMVI_ID and B.NGUONHANG_ID = dtk.NGUONDUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NGOAITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) A on A.DUOC_ID = dtk.DUOC_ID and A.SOLUONG > 0 and A.PHAMVI_ID = pvsd.PHAMVI_ID and A.NGUONHANG_ID = dtk.NGUONDUOC_ID        where dtk.SOLUONG > 0 and dtk.BENHVIEN_ID = 'HLU01'        group by LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')), pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        ) tk on tk.DUOC_ID = d.DUOC_ID        left join TM_DUOC_PHAMVISUDUNG kd on kd.PHAMVI_ID = tk.PHAMVI_ID and kd.BENHVIEN_ID = 'HLU01'        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = tk.NGUONDUOC_ID and nh.BENHVIEN_ID = 'HLU01'        where  d.BENHVIEN_ID = 'HLU01' and d.DUOC_ID in (1)        end        else        begin        select  distinct tk.DUOC_KEY, LTRIM(tk.PHAMVI_ID) as PHAMVI_ID, tk.NGUONDUOC_ID, nh.TENNGUONDUOC, nh.TINHTIEN, d.DUOC_ID, ld.MALOAIDUOC,        d.SOVISA,d.TYLE_VAT,d.COTOA, d.MADUOC, d.TENHANG, d.TENDUOCDAYDU, dvt.TENDONVITINH as DONVITINH, d.BHYT,        d.TENHOATCHAT, d.HAMLUONG, d.HANGSANXUAT, d.QUOCGIA, d.LOAIDUOC_ID, d.DUONGDUNG_ID, d.TINHTIEN_PTTT,        ten.TENDUOC, ten.TENDUOC_EN, ten.MAQUOCTE, ten.MAQUOCTEBT,        CASE WHEN d.BHYT = '1' THEN 'BHYT' ELSE '' END as BHYT_TEXT        , ld.LOAIVATTU_ID        , d.BENHVIEN_ID,        tk.SOLUONG, d.VTYT_PHANLOAI, d.PHAMVI, d.SUASOLUONGTONGHOP, d.MADUOCBV, d.DANGTRINHBAY        , TAMNGUNG = CASE WHEN d.TAMNGUNG = '1' OR nh.TAMNGUNG = '1' OR kd.TAMNGUNG = '1' THEN '1' ELSE '0' END        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        inner join        (        select  LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')) DUOC_KEY, (SUM(dtk.SOLUONG) - isnull(sum(A.SOLUONG),0) - isnull(sum(B.SOLUONG),0)) SOLUONG, pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        from (select sum(soluong) soluong,duoc_id,nguonduoc_id,khoduoc_id,benhvien_id from TT_DUOC_TONKHO  group by duoc_id,nguonduoc_id,khoduoc_id,benhvien_id) dtk        inner join TM_DUOC_PHAMVISD_MAPPING pvsd on dtk.KHODUOC_ID = pvsd.KHODUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NOITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) B on B.DUOC_ID = dtk.DUOC_ID and B.SOLUONG > 0 and B.PHAMVI_ID = pvsd.PHAMVI_ID and B.NGUONHANG_ID = dtk.NGUONDUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NGOAITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) A on A.DUOC_ID = dtk.DUOC_ID and A.SOLUONG > 0 and A.PHAMVI_ID = pvsd.PHAMVI_ID and A.NGUONHANG_ID = dtk.NGUONDUOC_ID        where dtk.SOLUONG > 0 and dtk.BENHVIEN_ID = 'HLU01'        group by LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')), pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        ) tk on tk.DUOC_ID = d.DUOC_ID        left join TM_DUOC_PHAMVISUDUNG kd on kd.PHAMVI_ID = tk.PHAMVI_ID and kd.BENHVIEN_ID = 'HLU01'        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = tk.NGUONDUOC_ID and nh.BENHVIEN_ID = 'HLU01'        where  d.BENHVIEN_ID = 'HLU01' and d.DUOC_ID in (1)        end]
2019-09-20 17:03:39,419 [1] DEBUG - Statement Id: [DAO00083_GetList_PhieuGhiNhanVTYT] PreparedStatement : [select DICHVU_GHINHANVTYT_ID, SOPHIEU, KHAMBENH_ID, TIEPNHAN_ID, DVYEUCAU_ID        from TT_DICHVU_GHINHANVTYT        where TIEPNHAN_ID = '27478'        and BENHVIEN_ID = 'HLU01'         and           KHAMBENH_ID = '26173'         and           DVYEUCAU_ID = '205443'                 order by THOIGIANGHINHAN desc]
2019-09-20 17:03:39,465 [1] DEBUG - Statement Id: [DAO00083_GetDSVTYTGhiNhan] PreparedStatement : [select A.*, dc.TENDUOCDAYDU, dc.BHYT DUOC_BHYT, ld.LOAIVATTU_ID, dc.DONVITINH        from TT_NGOAITRU_KHAMBENH_VTYT A        left join TM_DUOC dc on A.DUOC_ID = dc.DUOC_ID        left join TM_LOAIDUOC ld on dc.LOAIDUOC_ID = ld.LOAIDUOC_ID        where A.DVYEUCAU_ID =  @param0          and           A.DICHVU_GHINHANVTYT_ID = '4918'                 order by A.KHAMBENH_VTYT_ID]
2019-09-20 17:03:39,466 [1] DEBUG - Statement Id: [DAO00083_GetDSVTYTGhiNhan] Parameters: [@param0=[DVYEUCAU_ID,205443]]
2019-09-20 17:03:39,466 [1] DEBUG - Statement Id: [DAO00083_GetDSVTYTGhiNhan] Types: [@param0=[Int64, System.Int64]]
2019-09-20 17:03:39,497 [1] DEBUG - Statement Id: [DAO00063_GetSoChungTuByChungTuID] PreparedStatement : [select MACHUNGTU as SOCHUNGTU        from TT_DUOC_CHUNGTU        where CHUNGTU_ID  = '137704']
2019-09-20 17:03:39,546 [1] DEBUG - Statement Id: [DAO00023_GetTTVienPhiThuoc] PreparedStatement : [select *        from TT_VIENPHI        where REF_ID = '10593'        and REF_TABLE = 'TT_NGOAITRU_KHAMBENH_VTYT']
2019-09-20 17:03:39,607 [1] DEBUG - Statement Id: [DAO00066_GetBENHAN_TIEPNHAN] PreparedStatement : [select top 1 *        from TT_NOITRU_BENHAN        where TIEPNHAN_ID = '27478'  and BENHVIEN_ID = 'HLU01'        order by NGAYTAO desc]
2019-09-20 17:03:56,694 [1] DEBUG - Statement Id: [DAO00030_Search_PhieuXuatSD] PreparedStatement : [SELECT DISTINCT phieuxuat.* FROM          (          select DISTINCT          CT.CHUNGTU_ID,          CT.SOCHUNGTU,          CT.MACHUNGTU,          CT.NGAYCHUNGTU,          CT.NGAYTAO,          CT.KHOXUAT_ID,          CT.NGUOIGIAO_ID,          CT.KHONHAP_ID,          CT.NGUOINHAN_ID,          PL.MACHUNGTU as MAPHIEULINH,          PL.NGAYCHUNGTU as NGAYPHIEULINH,          bn.MAYTE,          bn.TENBENHNHAN,          CONVERT(VARCHAR(10), KB.THOIGIANKHAM, 103) + ' - ' + CONVERT(VARCHAR(5), KB.THOIGIANKHAM, 108) as THOIGIANKHAM,          nl.TENNHANVIEN as NGUOILAP,          CT.DIENGIAI          from TT_DUOC_CHUNGTU CT          inner join TT_DUOC_CHUNGTU_CHITIET ctct on ct.CHUNGTU_ID = ctct.CHUNGTU_ID          inner join TT_NOITRU_TOATHUOC TT on ctct.TOATHUOCNOITRU_ID = TT.TOATHUOC_ID          inner join TT_NOITRU_KHAMBENH KB on kb.KHAMBENH_ID = TT.KHAMBENH_ID          inner join TT_BENHNHAN BN on TT.BENHNHAN_ID = BN.BENHNHAN_ID          left join TT_DUOC_PHIEULINH PL on PL.CHUNGTU_ID = CT.PHIEULINH_ID          left join TM_NHANVIEN nl on nl.NHANVIEN_ID = TT.NGUOITAO_ID           where                   CT.MUCDICHCHUNGTU_ID = '1060'               and                 CT.KHOXUAT_ID = '32'               and                 CONVERT(date, CT.NGAYCHUNGTU) BETWEEN CONVERT(date, '9/20/2019 12:00:00 AM')  and  CONVERT(date, '9/20/2019 12:00:00 AM')               and                 CT.BENHVIEN_ID = 'HLU01'                           UNION            select DISTINCT          CT.CHUNGTU_ID,          CT.SOCHUNGTU,          CT.MACHUNGTU,          CT.NGAYCHUNGTU,          CT.NGAYTAO,          CT.KHOXUAT_ID,          CT.NGUOIGIAO_ID,          CT.KHONHAP_ID,          CT.NGUOINHAN_ID,          PL.MACHUNGTU as MAPHIEULINH,          PL.NGAYCHUNGTU as NGAYPHIEULINH,          bn.MAYTE,          bn.TENBENHNHAN,          CONVERT(VARCHAR(10), KB.THOIGIANKHAM, 103) + ' - ' + CONVERT(VARCHAR(5), KB.THOIGIANKHAM, 108) as THOIGIANKHAM,          nl.TENNHANVIEN as NGUOILAP,          CT.DIENGIAI          from TT_DUOC_CHUNGTU CT          inner join TT_DUOC_CHUNGTU_CHITIET ctct on ct.CHUNGTU_ID = ctct.CHUNGTU_ID          inner join TT_NGOAITRU_KHAMBENH_VTYT vt on ctct.KHAMBENH_VTYT_ID = vt.KHAMBENH_VTYT_ID          inner join TT_NGOAITRU_KHAMBENH kb on kb.KHAMBENH_ID = vt.KHAMBENH_ID          inner join TT_BENHNHAN BN on bn.BENHNHAN_ID = kb.BENHNHAN_ID          left join TT_DUOC_PHIEULINH PL on PL.CHUNGTU_ID = CT.PHIEULINH_ID          left join TM_NHANVIEN nl on nl.NHANVIEN_ID = vt.NGUOITAO_ID           where                   CT.MUCDICHCHUNGTU_ID = '1060'               and                 CT.KHOXUAT_ID = '32'               and                 CONVERT(date, CT.NGAYCHUNGTU) BETWEEN CONVERT(date, '9/20/2019 12:00:00 AM')  and  CONVERT(date, '9/20/2019 12:00:00 AM')               and                 CT.BENHVIEN_ID = 'HLU01'                           UNION            select DISTINCT          CT.CHUNGTU_ID,          CT.SOCHUNGTU,          CT.MACHUNGTU,          CT.NGAYCHUNGTU,          CT.NGAYTAO,          CT.KHOXUAT_ID,          CT.NGUOIGIAO_ID,          CT.KHONHAP_ID,          CT.NGUOINHAN_ID,          PL.MACHUNGTU as MAPHIEULINH,          PL.NGAYCHUNGTU as NGAYPHIEULINH,          bn.MAYTE,          bn.TENBENHNHAN,          CONVERT(VARCHAR(10), pt.NGAYTHUCHIEN, 103) + ' - ' + CONVERT(VARCHAR(5), pt.NGAYTHUCHIEN, 108) as THOIGIANKHAM,          nl.TENNHANVIEN as NGUOILAP,          CT.DIENGIAI          from TT_DUOC_CHUNGTU CT          inner join TT_DUOC_CHUNGTU_CHITIET ctct on ct.CHUNGTU_ID = ctct.CHUNGTU_ID          inner join TT_PHAUTHUAT_VTYT vt on ctct.PHAUTHUAT_VTYT_ID = vt.PHAUTHUAT_VTYT_ID          inner join TT_PHAUTHUAT pt on pt.PHAUTHUAT_ID = vt.PHAUTHUAT_ID          inner join TT_TIEPNHAN tn on tn.TIEPNHAN_ID = pt.TIEPNHAN_ID          inner join TT_BENHNHAN bn on bn.BENHNHAN_ID = tn.BENHNHAN_ID          left join TT_DUOC_PHIEULINH PL on PL.CHUNGTU_ID = CT.PHIEULINH_ID          left join TM_NHANVIEN nl on nl.NHANVIEN_ID = pt.NGUOITAO_ID           where                   CT.MUCDICHCHUNGTU_ID = '1060'               and                 CT.KHOXUAT_ID = '32'               and                 CONVERT(date, CT.NGAYCHUNGTU) BETWEEN CONVERT(date, '9/20/2019 12:00:00 AM')  and  CONVERT(date, '9/20/2019 12:00:00 AM')               and                 CT.BENHVIEN_ID = 'HLU01'                           UNION            select DISTINCT          CT.CHUNGTU_ID,          CT.SOCHUNGTU,          CT.MACHUNGTU,          CT.NGAYCHUNGTU,          CT.NGAYTAO,          CT.KHOXUAT_ID,          CT.NGUOIGIAO_ID,          CT.KHONHAP_ID,          CT.NGUOINHAN_ID,          PL.MACHUNGTU as MAPHIEULINH,          PL.NGAYCHUNGTU as NGAYPHIEULINH,          bn.MAYTE,          bn.TENBENHNHAN,          CONVERT(VARCHAR(10), cls.NGAYTAO, 103) + ' - ' + CONVERT(VARCHAR(5), cls.NGAYTAO, 108) as THOIGIANKHAM,          nl.TENNHANVIEN as NGUOILAP,          CT.DIENGIAI          from TT_DUOC_CHUNGTU CT          inner join TT_DUOC_CHUNGTU_CHITIET ctct on ct.CHUNGTU_ID = ctct.CHUNGTU_ID          inner join TT_CLSKETQUA_VTYT cls on ctct.CLSKETQUA_VTYT_ID = cls.CLSKETQUA_VTYT_ID          inner join TT_DVYEUCAU DV on DV.DVYEUCAU_ID = CLS.DVYEUCAU_ID          inner join TT_BENHNHAN bn on bn.BENHNHAN_ID = DV.BENHNHAN_ID          left join TT_DUOC_PHIEULINH PL on PL.CHUNGTU_ID = CT.PHIEULINH_ID          left join TM_NHANVIEN nl on nl.NHANVIEN_ID = cls.NGUOITAO_ID           where                   CT.MUCDICHCHUNGTU_ID = '1060'               and                 CT.KHOXUAT_ID = '32'               and                 CONVERT(date, CT.NGAYCHUNGTU) BETWEEN CONVERT(date, '9/20/2019 12:00:00 AM')  and  CONVERT(date, '9/20/2019 12:00:00 AM')               and                 CT.BENHVIEN_ID = 'HLU01'                           UNION            select DISTINCT          CT.CHUNGTU_ID,          CT.SOCHUNGTU,          CT.MACHUNGTU,          CT.NGAYCHUNGTU,          CT.NGAYTAO,          CT.KHOXUAT_ID,          CT.NGUOIGIAO_ID,          CT.KHONHAP_ID,          CT.NGUOINHAN_ID,          PL.MACHUNGTU as MAPHIEULINH,          PL.NGAYCHUNGTU as NGAYPHIEULINH,          null as MAYTE,          null as TENBENHNHAN,          null as THOIGIANKHAM,          nl.TENNHANVIEN as NGUOILAP,          CT.DIENGIAI          from TT_DUOC_CHUNGTU CT          inner join TT_DUOC_CHUNGTU_CHITIET ctct on ct.CHUNGTU_ID = ctct.CHUNGTU_ID          left join TT_DUOC_PHIEULINH PL on PL.CHUNGTU_ID = CT.PHIEULINH_ID          left join TM_NHANVIEN nl on nl.NHANVIEN_ID = ct.NGUOITAO_ID          WHERE (ctct.TOATHUOCNOITRU_ID IS NULL AND ctct.KHAMBENH_VTYT_ID IS NULL AND ctct.PHAUTHUAT_VTYT_ID IS NULL AND ctct.CLSKETQUA_VTYT_ID IS NULL)             and                 CT.MUCDICHCHUNGTU_ID = '1060'               and                 CT.KHOXUAT_ID = '32'               and                 CONVERT(date, CT.NGAYCHUNGTU) BETWEEN CONVERT(date, '9/20/2019 12:00:00 AM')  and  CONVERT(date, '9/20/2019 12:00:00 AM')               and                 CT.BENHVIEN_ID = 'HLU01'                         )PhieuXuat          ORDER BY PhieuXuat.CHUNGTU_ID desc]
2019-09-20 17:03:58,889 [1] DEBUG - Statement Id: [DAO00030_GetList] PreparedStatement : [select *              from TT_DUOC_CHUNGTU              where BENHVIEN_ID = 'HLU01'                and                   TT_DUOC_CHUNGTU.CHUNGTU_ID = '137704'                               order by CHUNGTU_ID]
2019-09-20 17:03:59,034 [1] DEBUG - Statement Id: [DAO00030_CHUNGTUXUAT_CHITIET_GetList] PreparedStatement : [SELECT            ctct.*,            d.MADUOC, d.TENHANG, d.TENDUOCDAYDU, dvt.TENDONVITINH as DONVITINH,n.TENNGUONDUOC as NGUONHANG,            sln.SOLONHAP, sln.SOLOSANPHAM, sln.NGAYNHAP as NGAYNHAPLO, sln.HANDUNG as HANSUDUNG,            isnull(tk.SOLUONG,0) as SOLUONGTON,            LTRIM(ct.KHOXUAT_ID) + '_' + LTRIM(sln.DUOC_ID) + '_' + LTRIM(sln.NGUONDUOC_ID) as DUOC_KEY            , NLD.MANHOMLOAIDUOC, ld.MALOAIDUOC, D.SO_QDTT            FROM            TT_DUOC_CHUNGTU_CHITIET ctct            INNER JOIN TT_DUOC_CHUNGTU ct ON (ct.CHUNGTU_ID = ctct.CHUNGTU_ID)            INNER JOIN TT_DUOC_CHUNGTU_SOLONHAP sln ON (sln.SOLONHAP_ID = ctct.SOLONHAP_ID)            LEFT JOIN (            select xx.DUOCTONKHO_ID, xx.KHODUOC_ID, xx.DUOC_ID, xx.SOLONHAP_ID, xx.SOLUONG, xx.NGUONDUOC_ID, xx.BENHVIEN_ID from TT_DUOC_TONKHO xx            join ( select max(DUOCTONKHO_ID) as DUOCTONKHO_ID, KHODUOC_ID, DUOC_ID, SOLONHAP_ID, NGUONDUOC_ID            from TT_DUOC_TONKHO group by KHODUOC_ID, DUOC_ID, SOLONHAP_ID, NGUONDUOC_ID) yy on xx.DUOCTONKHO_ID=yy.DUOCTONKHO_ID            ) tk ON (tk.SOLONHAP_ID = sln.SOLONHAP_ID AND tk.DUOC_ID = sln.DUOC_ID and tk.KHODUOC_ID = ct.KHOXUAT_ID)            INNER JOIN TM_DUOC d ON (d.DUOC_ID = ctct.DUOC_ID)            INNER JOIN TM_NGUONHANG n ON (n.NGUONDUOC_ID = ctct.NGUONHANG_ID)            LEFT JOIN TM_DONVITINH dvt ON (dvt.DONVITINH_ID = ctct.DONVITINH_ID)            left join TM_LOAIDUOC LD on LD.LOAIDUOC_ID = D.LOAIDUOC_ID            LEFT JOIN TM_NHOMLOAIDUOC NLD on NLD.NHOMLOAIDUOC_ID = LD.NHOMLOAIDUOC_ID             where                             ct.CHUNGTU_ID = '137704'                       and                           ct.BENHVIEN_ID = 'HLU01'                                     order by CHUNGTUCHITIET_ID]
2019-09-20 17:03:59,243 [1] DEBUG - Statement Id: [DAO00030_KiemTraChungTuKhoaSo] PreparedStatement : [SELECT CHUNGTU_ID              FROM TT_DUOC_CHUNGTU              WHERE              MACHUNGTU = 'CS_KBX1319003092'              and BENHVIEN_ID = 'HLU01'              and              convert(date, NGAYCHUNGTU) <=              (              SELECT TOP 1 convert(date, KHOADENNGAY)              FROM TT_DUOC_KHOASOCHUNGTU              WHERE              KHODUOC_ID = '32'              and BENHVIEN_ID = 'HLU01'              AND KHOASO = '1'              ORDER BY KHOADENNGAY DESC              )]
2019-09-20 17:03:59,288 [1] DEBUG - Statement Id: [DAO00030_KiemTraChungTuDaChuyenKeToan] PreparedStatement : [SELECT CHUNGTU_ID            FROM TT_DUOC_CHUNGTU            WHERE            CHUNGTU_ID = '137704'            and IDCHUYEN IS NOT NULL            and BENHVIEN_ID = 'HLU01']
2019-09-20 17:03:59,317 [1] DEBUG - Statement Id: [DAO00030_KiemTraBenhNhanXuatVien] PreparedStatement : [select              TT.TOATHUOC_ID              from              TT_NOITRU_TOATHUOC TT              inner join TT_NOITRU_KHAMBENH KB on TT.KHAMBENH_ID = KB.KHAMBENH_ID              inner join TT_NOITRU_BENHAN BA on BA.BENHAN_ID = KB.BENHAN_ID              WHERE              BA.TRANGTHAI = 'DAXUATVIEN'              AND TT.CHUNGTU_ID =  137704              and TT.BENHVIEN_ID = 'HLU01']
2019-09-20 17:03:59,585 [1] DEBUG - Statement Id: [DAO00030_DUOCTONKHO_GetSoTonTheoDuoc] PreparedStatement : [SELECT              DUOC_ID,              SUM(SOLUONG) AS TONGTON              FROM              TT_DUOC_TONKHO              WHERE              KHODUOC_ID = '32'              and BENHVIEN_ID = 'HLU01'              and DUOC_ID IN (1)              GROUP BY DUOC_ID]
2019-09-20 17:03:59,616 [1] DEBUG - Statement Id: [DAO00030_DUOCTONKHO_GetSoTonTheoDuocTheoLo] PreparedStatement : [SELECT              DUOC_ID,SOLONHAP_ID,              SUM(SOLUONG) AS SOLUONGTONLO              FROM              TT_DUOC_TONKHO              WHERE              KHODUOC_ID = '32'              and BENHVIEN_ID = 'HLU01'              and DUOC_ID IN (1)              and SOLONHAP_ID IN (7541)              GROUP BY DUOC_ID, SOLONHAP_ID]
2019-09-20 17:03:59,671 [1] DEBUG - Statement Id: [DAO00030_DUOCTONKHO_GetSoTonTheoDuoc] PreparedStatement : [SELECT              DUOC_ID,              SUM(SOLUONG) AS TONGTON              FROM              TT_DUOC_TONKHO              WHERE              KHODUOC_ID = '32'              and BENHVIEN_ID = 'HLU01'              and DUOC_ID IN (1)              GROUP BY DUOC_ID]
2019-09-20 17:03:59,716 [1] DEBUG - Statement Id: [DAO00030_KTDaPhatSinhBienLai] PreparedStatement : [SELECT CHUNGTU_ID            FROM TT_NOITRU_TOATHUOC tt            INNER JOIN TT_VIENPHI vp on (tt.TOATHUOC_ID = vp.REF_ID and REF_TABLE = 'TT_NOITRU_TOATHUOC')            WHERE            CHUNGTU_ID = '137704'            AND tt.BENHVIEN_ID = 'HLU01'            AND HOADON_ID is not NULL            AND vp.HUY = '0'              union all            SELECT  kbtt.CHUNGTUPHATTHUOC_ID as CHUNGTU_ID            FROM TT_NGOAITRU_TOATHUOC tt            INNER JOIN TT_NGOAITRU_KHAMBENH_TOATHUOC kbtt on (kbtt.KHAMBENH_TOATHUOC_ID = tt.KHAMBENH_TOATHUOC_ID)            INNER JOIN TT_VIENPHI vp on (tt.TOATHUOC_ID = vp.REF_ID and REF_TABLE = 'TT_NGOAITRU_TOATHUOC')            WHERE            kbtt.CHUNGTUPHATTHUOC_ID = '137704'            AND tt.BENHVIEN_ID = 'HLU01'            AND HOADON_ID is not NULL            AND vp.HUY = '0'              union all            SELECT ctct.CHUNGTU_ID from            TT_DUOC_CHUNGTU_CHITIET ctct            INNER JOIN TT_HOADON_CHITIET_NGOAITRU hdct on (hdct.REF_ID = ctct.CHUNGTUCHITIET_ID and hdct.REF_TABLE = 'TT_DUOC_CHUNGTU_CHITIET')            INNER JOIN TT_HOADON hd on hd.HOADON_ID = hdct.HOADON_ID            WHERE            ctct.CHUNGTU_ID = '137704'                            AND hd.HUYHOADON = '0'              AND hd.HOANTRA = '0'                                  AND ctct.BENHVIEN_ID = 'HLU01'                        union all            SELECT CHUNGTU_ID            FROM TT_NGOAITRU_KHAMBENH_VTYT tt            INNER JOIN TT_VIENPHI vp on (tt.KHAMBENH_VTYT_ID = vp.REF_ID and REF_TABLE = 'TT_NGOAITRU_KHAMBENH_VTYT')            WHERE            CHUNGTU_ID = '137704'            AND tt.BENHVIEN_ID = 'HLU01'            AND HOADON_ID is not NULL            AND vp.HUY = '0'                        union all            SELECT CHUNGTU_ID            FROM TT_PHAUTHUAT_VTYT tt            INNER JOIN TT_VIENPHI vp on (tt.PHAUTHUAT_VTYT_ID = vp.REF_ID and REF_TABLE = 'TT_PHAUTHUAT_VTYT')            WHERE            CHUNGTU_ID = '137704'            AND tt.BENHVIEN_ID = 'HLU01'            AND HOADON_ID is not NULL            AND vp.HUY = '0'                        union all            SELECT CHUNGTU_ID            FROM TT_CLSKETQUA_VTYT tt            INNER JOIN TT_VIENPHI vp on (tt.CLSKETQUA_VTYT_ID = vp.REF_ID and REF_TABLE = 'TT_CLSKETQUA_VTYT')            WHERE            CHUNGTU_ID = '137704'            AND tt.BENHVIEN_ID = 'HLU01'            AND HOADON_ID is not NULL            AND vp.HUY = '0']
2019-09-20 17:04:45,884 [1] DEBUG - Statement Id: [DAO00030_KTDaPhatSinhBienLai] PreparedStatement : [SELECT CHUNGTU_ID            FROM TT_NOITRU_TOATHUOC tt            INNER JOIN TT_VIENPHI vp on (tt.TOATHUOC_ID = vp.REF_ID and REF_TABLE = 'TT_NOITRU_TOATHUOC')            WHERE            CHUNGTU_ID = '137704'            AND tt.BENHVIEN_ID = 'HLU01'            AND HOADON_ID is not NULL            AND vp.HUY = '0'              union all            SELECT  kbtt.CHUNGTUPHATTHUOC_ID as CHUNGTU_ID            FROM TT_NGOAITRU_TOATHUOC tt            INNER JOIN TT_NGOAITRU_KHAMBENH_TOATHUOC kbtt on (kbtt.KHAMBENH_TOATHUOC_ID = tt.KHAMBENH_TOATHUOC_ID)            INNER JOIN TT_VIENPHI vp on (tt.TOATHUOC_ID = vp.REF_ID and REF_TABLE = 'TT_NGOAITRU_TOATHUOC')            WHERE            kbtt.CHUNGTUPHATTHUOC_ID = '137704'            AND tt.BENHVIEN_ID = 'HLU01'            AND HOADON_ID is not NULL            AND vp.HUY = '0'              union all            SELECT ctct.CHUNGTU_ID from            TT_DUOC_CHUNGTU_CHITIET ctct            INNER JOIN TT_HOADON_CHITIET_NGOAITRU hdct on (hdct.REF_ID = ctct.CHUNGTUCHITIET_ID and hdct.REF_TABLE = 'TT_DUOC_CHUNGTU_CHITIET')            INNER JOIN TT_HOADON hd on hd.HOADON_ID = hdct.HOADON_ID            WHERE            ctct.CHUNGTU_ID = '137704'                            AND hd.HUYHOADON = '0'              AND hd.HOANTRA = '0'                                  AND ctct.BENHVIEN_ID = 'HLU01'                        union all            SELECT CHUNGTU_ID            FROM TT_NGOAITRU_KHAMBENH_VTYT tt            INNER JOIN TT_VIENPHI vp on (tt.KHAMBENH_VTYT_ID = vp.REF_ID and REF_TABLE = 'TT_NGOAITRU_KHAMBENH_VTYT')            WHERE            CHUNGTU_ID = '137704'            AND tt.BENHVIEN_ID = 'HLU01'            AND HOADON_ID is not NULL            AND vp.HUY = '0'                        union all            SELECT CHUNGTU_ID            FROM TT_PHAUTHUAT_VTYT tt            INNER JOIN TT_VIENPHI vp on (tt.PHAUTHUAT_VTYT_ID = vp.REF_ID and REF_TABLE = 'TT_PHAUTHUAT_VTYT')            WHERE            CHUNGTU_ID = '137704'            AND tt.BENHVIEN_ID = 'HLU01'            AND HOADON_ID is not NULL            AND vp.HUY = '0'                        union all            SELECT CHUNGTU_ID            FROM TT_CLSKETQUA_VTYT tt            INNER JOIN TT_VIENPHI vp on (tt.CLSKETQUA_VTYT_ID = vp.REF_ID and REF_TABLE = 'TT_CLSKETQUA_VTYT')            WHERE            CHUNGTU_ID = '137704'            AND tt.BENHVIEN_ID = 'HLU01'            AND HOADON_ID is not NULL            AND vp.HUY = '0']
2019-09-20 17:04:46,911 [1] DEBUG - Statement Id: [DAO00030_KTDaPhatSinhPhieuBHTN] PreparedStatement : [SELECT vp.VIENPHI_ID              FROM TT_VIENPHI vp              INNER JOIN TT_MIENGIAM_CHITIET  mgct on mgct.VIENPHI_ID = vp.VIENPHI_ID              INNER JOIN TT_DUOC_CHUNGTU ct on ct.TIEPNHAN_ID = vp.TIEPNHAN_ID              WHERE              ct.CHUNGTU_ID = '137704'              AND vp.DUOC_ID is not null              AND vp.BENHVIEN_ID = 'HLU01']
2019-09-20 17:04:47,017 [1] DEBUG - Statement Id: [DAO00030_KiemTraBenhNhanXuatVien] PreparedStatement : [select              TT.TOATHUOC_ID              from              TT_NOITRU_TOATHUOC TT              inner join TT_NOITRU_KHAMBENH KB on TT.KHAMBENH_ID = KB.KHAMBENH_ID              inner join TT_NOITRU_BENHAN BA on BA.BENHAN_ID = KB.BENHAN_ID              WHERE              BA.TRANGTHAI = 'DAXUATVIEN'              AND TT.CHUNGTU_ID =  137704              and TT.BENHVIEN_ID = 'HLU01']
2019-09-20 17:04:47,191 [1] DEBUG - Statement Id: [DAO00030_KiemTraChungTuKhoaSo] PreparedStatement : [SELECT CHUNGTU_ID              FROM TT_DUOC_CHUNGTU              WHERE              MACHUNGTU = 'CS_KBX1319003092'              and BENHVIEN_ID = 'HLU01'              and              convert(date, NGAYCHUNGTU) <=              (              SELECT TOP 1 convert(date, KHOADENNGAY)              FROM TT_DUOC_KHOASOCHUNGTU              WHERE              KHODUOC_ID = '32'              and BENHVIEN_ID = 'HLU01'              AND KHOASO = '1'              ORDER BY KHOADENNGAY DESC              )]
2019-09-20 17:05:00,987 [1] DEBUG - Statement Id: [DAO00030_KiemTraChungTuKhoaSo] PreparedStatement : [SELECT CHUNGTU_ID              FROM TT_DUOC_CHUNGTU              WHERE              MACHUNGTU = 'CS_KBX1319003092'              and BENHVIEN_ID = 'HLU01'              and              convert(date, NGAYCHUNGTU) <=              (              SELECT TOP 1 convert(date, KHOADENNGAY)              FROM TT_DUOC_KHOASOCHUNGTU              WHERE              KHODUOC_ID = '32'              and BENHVIEN_ID = 'HLU01'              AND KHOASO = '1'              ORDER BY KHOADENNGAY DESC              )]
2019-09-20 17:05:04,235 [1] DEBUG - Statement Id: [DAO00030_KiemTraChungTuDaChuyenKeToan] PreparedStatement : [SELECT CHUNGTU_ID            FROM TT_DUOC_CHUNGTU            WHERE            CHUNGTU_ID = '137704'            and IDCHUYEN IS NOT NULL            and BENHVIEN_ID = 'HLU01']
2019-09-20 17:05:10,172 [1] DEBUG - Statement Id: [DAO00030_KTDaPhatSinhBienLai] PreparedStatement : [SELECT CHUNGTU_ID            FROM TT_NOITRU_TOATHUOC tt            INNER JOIN TT_VIENPHI vp on (tt.TOATHUOC_ID = vp.REF_ID and REF_TABLE = 'TT_NOITRU_TOATHUOC')            WHERE            CHUNGTU_ID = '137704'            AND tt.BENHVIEN_ID = 'HLU01'            AND HOADON_ID is not NULL            AND vp.HUY = '0'              union all            SELECT  kbtt.CHUNGTUPHATTHUOC_ID as CHUNGTU_ID            FROM TT_NGOAITRU_TOATHUOC tt            INNER JOIN TT_NGOAITRU_KHAMBENH_TOATHUOC kbtt on (kbtt.KHAMBENH_TOATHUOC_ID = tt.KHAMBENH_TOATHUOC_ID)            INNER JOIN TT_VIENPHI vp on (tt.TOATHUOC_ID = vp.REF_ID and REF_TABLE = 'TT_NGOAITRU_TOATHUOC')            WHERE            kbtt.CHUNGTUPHATTHUOC_ID = '137704'            AND tt.BENHVIEN_ID = 'HLU01'            AND HOADON_ID is not NULL            AND vp.HUY = '0'              union all            SELECT ctct.CHUNGTU_ID from            TT_DUOC_CHUNGTU_CHITIET ctct            INNER JOIN TT_HOADON_CHITIET_NGOAITRU hdct on (hdct.REF_ID = ctct.CHUNGTUCHITIET_ID and hdct.REF_TABLE = 'TT_DUOC_CHUNGTU_CHITIET')            INNER JOIN TT_HOADON hd on hd.HOADON_ID = hdct.HOADON_ID            WHERE            ctct.CHUNGTU_ID = '137704'                            AND hd.HUYHOADON = '0'              AND hd.HOANTRA = '0'                                  AND ctct.BENHVIEN_ID = 'HLU01'                        union all            SELECT CHUNGTU_ID            FROM TT_NGOAITRU_KHAMBENH_VTYT tt            INNER JOIN TT_VIENPHI vp on (tt.KHAMBENH_VTYT_ID = vp.REF_ID and REF_TABLE = 'TT_NGOAITRU_KHAMBENH_VTYT')            WHERE            CHUNGTU_ID = '137704'            AND tt.BENHVIEN_ID = 'HLU01'            AND HOADON_ID is not NULL            AND vp.HUY = '0'                        union all            SELECT CHUNGTU_ID            FROM TT_PHAUTHUAT_VTYT tt            INNER JOIN TT_VIENPHI vp on (tt.PHAUTHUAT_VTYT_ID = vp.REF_ID and REF_TABLE = 'TT_PHAUTHUAT_VTYT')            WHERE            CHUNGTU_ID = '137704'            AND tt.BENHVIEN_ID = 'HLU01'            AND HOADON_ID is not NULL            AND vp.HUY = '0'                        union all            SELECT CHUNGTU_ID            FROM TT_CLSKETQUA_VTYT tt            INNER JOIN TT_VIENPHI vp on (tt.CLSKETQUA_VTYT_ID = vp.REF_ID and REF_TABLE = 'TT_CLSKETQUA_VTYT')            WHERE            CHUNGTU_ID = '137704'            AND tt.BENHVIEN_ID = 'HLU01'            AND HOADON_ID is not NULL            AND vp.HUY = '0']
2019-09-20 17:05:22,813 [1] DEBUG - Statement Id: [DAO00030_KiemTraBenhNhanXuatVien] PreparedStatement : [select              TT.TOATHUOC_ID              from              TT_NOITRU_TOATHUOC TT              inner join TT_NOITRU_KHAMBENH KB on TT.KHAMBENH_ID = KB.KHAMBENH_ID              inner join TT_NOITRU_BENHAN BA on BA.BENHAN_ID = KB.BENHAN_ID              WHERE              BA.TRANGTHAI = 'DAXUATVIEN'              AND TT.CHUNGTU_ID =  137704              and TT.BENHVIEN_ID = 'HLU01']
2019-09-20 17:05:29,238 [1] DEBUG - Statement Id: [DAO00030_DUOCTONKHO_GetSoTonTheoDuocTheoLo] PreparedStatement : [SELECT              DUOC_ID,SOLONHAP_ID,              SUM(SOLUONG) AS SOLUONGTONLO              FROM              TT_DUOC_TONKHO              WHERE              KHODUOC_ID = '32'              and BENHVIEN_ID = 'HLU01'              and DUOC_ID IN (1)              and SOLONHAP_ID IN (7541)              GROUP BY DUOC_ID, SOLONHAP_ID]
2019-09-20 17:05:57,546 [1] DEBUG - Statement Id: [DAO00030_LayNgayKhoaSoCuoi] PreparedStatement : [SELECT TOP 1 KHOADENNGAY              FROM TT_DUOC_KHOASOCHUNGTU              WHERE              KHODUOC_ID = '32'              and BENHVIEN_ID = 'HLU01'              and KHOASO = '1'              ORDER BY KHOADENNGAY DESC]
2019-09-20 17:06:00,580 [1] DEBUG - Statement Id: [DAO00030_GetList] PreparedStatement : [select *              from TT_DUOC_CHUNGTU              where BENHVIEN_ID = 'HLU01'                and                   TT_DUOC_CHUNGTU.MACHUNGTU = 'CS_KBX1319003092'                               order by CHUNGTU_ID]
2019-09-20 17:06:00,811 [1] DEBUG - Statement Id: [DAO00030_KiemTraBenhNhanXuatVien] PreparedStatement : [select              TT.TOATHUOC_ID              from              TT_NOITRU_TOATHUOC TT              inner join TT_NOITRU_KHAMBENH KB on TT.KHAMBENH_ID = KB.KHAMBENH_ID              inner join TT_NOITRU_BENHAN BA on BA.BENHAN_ID = KB.BENHAN_ID              WHERE              BA.TRANGTHAI = 'DAXUATVIEN'              AND TT.CHUNGTU_ID =  137704              and TT.BENHVIEN_ID = 'HLU01']
2019-09-20 17:06:23,978 [1] DEBUG - Statement Id: [DAO00030_GetList] PreparedStatement : [select *              from TT_DUOC_CHUNGTU              where BENHVIEN_ID = 'HLU01'                and                   TT_DUOC_CHUNGTU.MACHUNGTU = 'CS_KBX1319003092'                               order by CHUNGTU_ID]
2019-09-20 17:06:28,840 [1] DEBUG - Statement Id: [DAO00030_KiemTraBenhNhanXuatVien] PreparedStatement : [select              TT.TOATHUOC_ID              from              TT_NOITRU_TOATHUOC TT              inner join TT_NOITRU_KHAMBENH KB on TT.KHAMBENH_ID = KB.KHAMBENH_ID              inner join TT_NOITRU_BENHAN BA on BA.BENHAN_ID = KB.BENHAN_ID              WHERE              BA.TRANGTHAI = 'DAXUATVIEN'              AND TT.CHUNGTU_ID =  137704              and TT.BENHVIEN_ID = 'HLU01']
2019-09-20 17:08:09,895 [1] DEBUG - Statement Id: [DAO00030_Update] PreparedStatement : [update TT_DUOC_CHUNGTU set              NGAYCHUNGTU =  @param0               , LOAICHUNGTU =  @param1               , MUCDICHCHUNGTU_ID =  @param2               , MUCDICHCHUNGTU_CODE =  @param3               , KHOXUAT_ID =  @param4               , NGUOIGIAO_ID =  @param5               , NGUOIGIAO =  @param6               , KHONHAP_ID =  @param7               , NGUOINHAN_ID =  @param8               , NGUOINHAN =  @param9               , NGUOIKIEMTRA_ID =  @param10               , NGUOIKIEMTRA =  @param11               , NGUOIDUYET_ID =  @param12               , NGUOIDUYET =  @param13               , PHUONGPHAPXUAT =  @param14               , KETOANTRUONG_ID =  @param15               , KETOANTRUONG =  @param16               , THUKHO_ID =  @param17               , THUKHO =  @param18               , MAUHOADON =  @param19               , SOHOADON =  @param20               , SOSERI =  @param21               , NGAYHOADON =  @param22               , DIENGIAI =  @param23               , GIATRI =  @param24               , GIATRITHANHTOAN =  @param25               , TYLEVAT =  @param26               , GIATRIVAT =  @param27               , THUESUAT =  @param28               , GIATRITHUE =  @param29               , TYLECHIETKHAU =  @param30               , GIATRICHIETKHAU =  @param31               , TIENTE_ID =  @param32               , TYGIA =  @param33               , SOCHUNGTUGOC =  @param34               , NGAYCHUNGTUGOC =  @param35               , NHACUNGCAP_ID =  @param36               , HINHTHUCTHANHTOAN_ID =  @param37               , NGUONDUOC_ID =  @param38               , CHUNGTULIENQUAN_ID =  @param39               , KHAMBENH_ID =  @param40               , TOATHUOCNOITRU_ID =  @param41               , TIEPNHAN_ID =  @param42               , BENHAN_ID =  @param43               , DANHANTHUOC =  @param44               , NGUOINHAP_ID =  @param45               , NGAYNHAP =  @param46               , TRANGTHAI =  @param47               , PHIEULINH_ID =  @param48               , LOAITOATHUOC =  @param49               , DIENGIAINGHIEPVUPHATSINH =  @param50               , DONVIGIAO_ID =  @param51               , KHOSUDUNG_ID =  @param52               , LOAIVATTU_ID =  @param53               , BENHNHAN_ID =  @param54               , TENBENHNHAN =  @param55               , BACSIGIOITHIEU_ID =  @param56               , DOITUONG_ID =  @param57               , IDCHUYEN =  @param58               , CHUNGTUKETOAN =  @param59               , STATUS =  @param60               , TRANSFER_VIENPHI_ID =  @param61               , PHONGBAN_ID =  @param62               , BACSI_ID =  @param63               , TKNO =  @param64               , TKCO =  @param65               , MACHUNGTUREF =  @param66               , LOAICHUNGTUREF =  @param67               , PHIEULINHCANTRU_ID =  @param68               , KHOTHUCHIEN_ID =  @param69               , KHODOIUNG_ID =  @param70               , MENU_LOAIDUOC_ID =  @param71               , NGUOISUDUNGMAY_ID =  @param72               , GOITHAU_ID =  @param73               , XUATTHUOCBANGOAITRU =  @param74               , NGAYGIOCHUNGTU =  @param75               , NOIDAKHAM =  @param76               , HOIDONGKIEMNHAP_ID =  @param77               , HOIDONGTHANHLY_ID =  @param78               , CHUYENCHUNGTUID =  @param79               , CHUYENDOANHTHUID =  @param80               , LYDOXUATSUDUNG_ID =  @param81                         , NGAYCAPNHAT =  @param82               , NGUOICAPNHAT_ID =  @param83               where              CHUNGTU_ID = '137704']
2019-09-20 17:08:09,895 [1] DEBUG - Statement Id: [DAO00030_Update] Parameters: [@param0=[NGAYCHUNGTU,9/20/2019 5:03:37 PM], @param1=[LOAICHUNGTU,X], @param2=[MUCDICHCHUNGTU_ID,1060], @param3=[MUCDICHCHUNGTU_CODE,X13], @param4=[KHOXUAT_ID,32], @param5=[NGUOIGIAO_ID,0], @param6=[NGUOIGIAO,null], @param7=[KHONHAP_ID,null], @param8=[NGUOINHAN_ID,null], @param9=[NGUOINHAN,null], @param10=[NGUOIKIEMTRA_ID,null], @param11=[NGUOIKIEMTRA,null], @param12=[NGUOIDUYET_ID,null], @param13=[NGUOIDUYET,null], @param14=[PHUONGPHAPXUAT,0], @param15=[KETOANTRUONG_ID,null], @param16=[KETOANTRUONG,null], @param17=[THUKHO_ID,null], @param18=[THUKHO,null], @param19=[MAUHOADON,null], @param20=[SOHOADON,null], @param21=[SOSERI,null], @param22=[NGAYHOADON,null], @param23=[DIENGIAI,null], @param24=[GIATRI,null], @param25=[GIATRITHANHTOAN,null], @param26=[TYLEVAT,5], @param27=[GIATRIVAT,0], @param28=[THUESUAT,null], @param29=[GIATRITHUE,null], @param30=[TYLECHIETKHAU,null], @param31=[GIATRICHIETKHAU,null], @param32=[TIENTE_ID,null], @param33=[TYGIA,null], @param34=[SOCHUNGTUGOC,null], @param35=[NGAYCHUNGTUGOC,null], @param36=[NHACUNGCAP_ID,null], @param37=[HINHTHUCTHANHTOAN_ID,null], @param38=[NGUONDUOC_ID,null], @param39=[CHUNGTULIENQUAN_ID,null], @param40=[KHAMBENH_ID,null], @param41=[TOATHUOCNOITRU_ID,null], @param42=[TIEPNHAN_ID,null], @param43=[BENHAN_ID,null], @param44=[DANHANTHUOC, ], @param45=[NGUOINHAP_ID,null], @param46=[NGAYNHAP,null], @param47=[TRANGTHAI,DAXUAT], @param48=[PHIEULINH_ID,null], @param49=[LOAITOATHUOC,null], @param50=[DIENGIAINGHIEPVUPHATSINH,null], @param51=[DONVIGIAO_ID,null], @param52=[KHOSUDUNG_ID,null], @param53=[LOAIVATTU_ID,null], @param54=[BENHNHAN_ID,null], @param55=[TENBENHNHAN,null], @param56=[BACSIGIOITHIEU_ID,null], @param57=[DOITUONG_ID,null], @param58=[IDCHUYEN,null], @param59=[CHUNGTUKETOAN,null], @param60=[STATUS,null], @param61=[TRANSFER_VIENPHI_ID,null], @param62=[PHONGBAN_ID,62], @param63=[BACSI_ID,null], @param64=[TKNO,null], @param65=[TKCO,null], @param66=[MACHUNGTUREF,null], @param67=[LOAICHUNGTUREF,null], @param68=[PHIEULINHCANTRU_ID,null], @param69=[KHOTHUCHIEN_ID,null], @param70=[KHODOIUNG_ID,null], @param71=[MENU_LOAIDUOC_ID,null], @param72=[NGUOISUDUNGMAY_ID,null], @param73=[GOITHAU_ID,null], @param74=[XUATTHUOCBANGOAITRU,null], @param75=[NGAYGIOCHUNGTU,null], @param76=[NOIDAKHAM,null], @param77=[HOIDONGKIEMNHAP_ID,null], @param78=[HOIDONGTHANHLY_ID,null], @param79=[CHUYENCHUNGTUID,null], @param80=[CHUYENDOANHTHUID,null], @param81=[LYDOXUATSUDUNG_ID,8294], @param82=[NGAYCAPNHAT,9/20/2019 5:08:09 PM], @param83=[NGUOICAPNHAT_ID,0]]
2019-09-20 17:08:09,895 [1] DEBUG - Statement Id: [DAO00030_Update] Types: [@param0=[DateTime, System.DateTime], @param1=[String, System.String], @param2=[Int64, System.Int64], @param3=[String, System.String], @param4=[Int64, System.Int64], @param5=[Int64, System.Int64], @param6=[System.DBNull, null], @param7=[System.DBNull, null], @param8=[System.DBNull, null], @param9=[System.DBNull, null], @param10=[System.DBNull, null], @param11=[System.DBNull, null], @param12=[System.DBNull, null], @param13=[System.DBNull, null], @param14=[Int64, System.Int64], @param15=[System.DBNull, null], @param16=[System.DBNull, null], @param17=[System.DBNull, null], @param18=[System.DBNull, null], @param19=[System.DBNull, null], @param20=[System.DBNull, null], @param21=[System.DBNull, null], @param22=[System.DBNull, null], @param23=[System.DBNull, null], @param24=[System.DBNull, null], @param25=[System.DBNull, null], @param26=[Double, System.Double], @param27=[Double, System.Double], @param28=[System.DBNull, null], @param29=[System.DBNull, null], @param30=[System.DBNull, null], @param31=[System.DBNull, null], @param32=[System.DBNull, null], @param33=[System.DBNull, null], @param34=[System.DBNull, null], @param35=[System.DBNull, null], @param36=[System.DBNull, null], @param37=[System.DBNull, null], @param38=[System.DBNull, null], @param39=[System.DBNull, null], @param40=[System.DBNull, null], @param41=[System.DBNull, null], @param42=[System.DBNull, null], @param43=[System.DBNull, null], @param44=[String, System.String], @param45=[System.DBNull, null], @param46=[System.DBNull, null], @param47=[String, System.String], @param48=[System.DBNull, null], @param49=[System.DBNull, null], @param50=[System.DBNull, null], @param51=[System.DBNull, null], @param52=[System.DBNull, null], @param53=[System.DBNull, null], @param54=[System.DBNull, null], @param55=[System.DBNull, null], @param56=[System.DBNull, null], @param57=[System.DBNull, null], @param58=[System.DBNull, null], @param59=[System.DBNull, null], @param60=[System.DBNull, null], @param61=[System.DBNull, null], @param62=[Int64, System.Int64], @param63=[System.DBNull, null], @param64=[System.DBNull, null], @param65=[System.DBNull, null], @param66=[System.DBNull, null], @param67=[System.DBNull, null], @param68=[System.DBNull, null], @param69=[System.DBNull, null], @param70=[System.DBNull, null], @param71=[System.DBNull, null], @param72=[System.DBNull, null], @param73=[System.DBNull, null], @param74=[System.DBNull, null], @param75=[System.DBNull, null], @param76=[System.DBNull, null], @param77=[System.DBNull, null], @param78=[System.DBNull, null], @param79=[System.DBNull, null], @param80=[System.DBNull, null], @param81=[Int64, System.Int64], @param82=[DateTime, System.DateTime], @param83=[Int64, System.Int64]]
--------------------------------------------------------------------------------
2019-09-20 17:10:11,327 [1] DEBUG - Statement Id: [DAO00001_DBList] PreparedStatement : [select *              from TM_SYS_SERVER              where HOSPITAL_ID = '_SYSTEM_' and TYPE = 'D']
2019-09-20 17:10:11,634 [1] DEBUG - Statement Id: [DAO00001_DaoList] PreparedStatement : [select              TM_SYS_SERVICEMAP.ID,              TM_SYS_SERVICEMAP.HOSPITAL_ID,              TM_SYS_SERVICEMAP.DB_NAME,              TM_SYS_SERVICEMAP.TYPE,              TM_SYS_SERVICEMAP.NAME,              TM_SYS_SERVICEMAP.CLASS,              (TM_SYS_DIC.VALUE + '.' + TM_SYS_SERVICEMAP.CLASS) as CLASSFULL,              TM_SYS_SERVICEMAP.ASSEMBLY              from TM_SYS_SERVICEMAP              inner join TM_SYS_DIC              on TM_SYS_SERVICEMAP.NAMESPACE = TM_SYS_DIC.ID              where HOSPITAL_ID = '_SYSTEM_' AND TYPE = 'D' AND ACTIVE = '1'              order by DB_NAME]
2019-09-20 17:10:11,675 [1] DEBUG - Statement Id: [DAO00001_ServiceList] PreparedStatement : [select              TM_SYS_SERVICEMAP.ID,              TM_SYS_SERVICEMAP.HOSPITAL_ID,              TM_SYS_SERVICEMAP.DB_NAME,              TM_SYS_SERVICEMAP.TYPE,              TM_SYS_SERVICEMAP.NAME,              TM_SYS_SERVICEMAP.CLASS,              (TM_SYS_DIC.VALUE + '.' + TM_SYS_SERVICEMAP.CLASS) as CLASSFULL,              TM_SYS_SERVICEMAP.ASSEMBLY,              TM_SYS_SERVER.URL              from TM_SYS_SERVICEMAP              inner join TM_SYS_DIC on TM_SYS_SERVICEMAP.NAMESPACE = TM_SYS_DIC.ID              inner join TM_SYS_SERVER on (TM_SYS_SERVICEMAP.DB_NAME = TM_SYS_SERVER.NAME) and (TM_SYS_SERVER.HOSPITAL_ID = '_SYSTEM_')              where TM_SYS_SERVICEMAP.HOSPITAL_ID = '_SYSTEM_' AND TM_SYS_SERVICEMAP.TYPE = 'S'  AND ACTIVE = '1'              order by URL]
2019-09-20 17:10:12,213 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = '_SYSTEM_'               AND                   TM_SYS_SCREEN.PAGE = 'LOGIN'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2019-09-20 17:10:12,965 [1] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = '_SYSTEM_'               AND                   TM_SYS_CACHE.ACTIVE = '1']
2019-09-20 17:10:19,502 [1] DEBUG - Statement Id: [DAO00001_DBList] PreparedStatement : [select *              from TM_SYS_SERVER              where HOSPITAL_ID = 'HLU01' and TYPE = 'D']
2019-09-20 17:10:19,536 [1] DEBUG - Statement Id: [DAO00001_DaoList] PreparedStatement : [select              TM_SYS_SERVICEMAP.ID,              TM_SYS_SERVICEMAP.HOSPITAL_ID,              TM_SYS_SERVICEMAP.DB_NAME,              TM_SYS_SERVICEMAP.TYPE,              TM_SYS_SERVICEMAP.NAME,              TM_SYS_SERVICEMAP.CLASS,              (TM_SYS_DIC.VALUE + '.' + TM_SYS_SERVICEMAP.CLASS) as CLASSFULL,              TM_SYS_SERVICEMAP.ASSEMBLY              from TM_SYS_SERVICEMAP              inner join TM_SYS_DIC              on TM_SYS_SERVICEMAP.NAMESPACE = TM_SYS_DIC.ID              where HOSPITAL_ID = 'HLU01' AND TYPE = 'D' AND ACTIVE = '1'              order by DB_NAME]
2019-09-20 17:10:21,327 [1] DEBUG - Statement Id: [DAO00001_ServiceList] PreparedStatement : [select              TM_SYS_SERVICEMAP.ID,              TM_SYS_SERVICEMAP.HOSPITAL_ID,              TM_SYS_SERVICEMAP.DB_NAME,              TM_SYS_SERVICEMAP.TYPE,              TM_SYS_SERVICEMAP.NAME,              TM_SYS_SERVICEMAP.CLASS,              (TM_SYS_DIC.VALUE + '.' + TM_SYS_SERVICEMAP.CLASS) as CLASSFULL,              TM_SYS_SERVICEMAP.ASSEMBLY,              TM_SYS_SERVER.URL              from TM_SYS_SERVICEMAP              inner join TM_SYS_DIC on TM_SYS_SERVICEMAP.NAMESPACE = TM_SYS_DIC.ID              inner join TM_SYS_SERVER on (TM_SYS_SERVICEMAP.DB_NAME = TM_SYS_SERVER.NAME) and (TM_SYS_SERVER.HOSPITAL_ID = 'HLU01')              where TM_SYS_SERVICEMAP.HOSPITAL_ID = 'HLU01' AND TM_SYS_SERVICEMAP.TYPE = 'S'  AND ACTIVE = '1'              order by URL]
2019-09-20 17:10:21,426 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1']
2019-09-20 17:10:22,383 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM005']
2019-09-20 17:10:22,850 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM015']
2019-09-20 17:10:22,933 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM067']
2019-09-20 17:10:23,074 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM008']
2019-09-20 17:10:23,159 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM068']
2019-09-20 17:10:23,235 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM006']
2019-09-20 17:10:23,314 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM030']
2019-09-20 17:10:23,391 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM025']
2019-09-20 17:10:23,474 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM024']
2019-09-20 17:10:23,992 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM033']
2019-09-20 17:10:24,048 [5] DEBUG - Statement Id: [DAO00027_GetListDuocKyGuiTonKho] PreparedStatement : [select  distinct TT_TONKHO.DUOC_KEY, LTRIM(TT_TONKHO.KHODUOC_ID) as KHODUOC_ID, TM_DUOC.DUOC_ID, TM_LOAIDUOC.MALOAIDUOC,TM_DUOC.SOVISA,TM_DUOC.TYLE_VAT,TM_DUOC.COTOA,        TM_DUOC.MADUOC, TM_DUOC.TENHANG, TM_DUOC.TENDUOCDAYDU, dvt.TENDONVITINH as DONVITINH,  TM_DUOC.DONVITINH_ID,TM_DUOC.BHYT,TM_DUOC.PHAMVI,        TM_DUOC.TENHOATCHAT, TM_DUOC.HAMLUONG, TM_DUOC.HANGSANXUAT, TM_DUOC.QUOCGIA, TM_DUOC.LOAIDUOC_ID, TM_DUOC.DUONGDUNG_ID,        TM_TENDUOC.TENDUOC, TM_TENDUOC.TENDUOC_EN, TM_TENDUOC.MAQUOCTE, TM_TENDUOC.MAQUOCTEBT,        TM_LOAIDUOC.LOAIVATTU_ID, TM_DUOC.BENHVIEN_ID,TT_TONKHO.SOLUONG, TT_TONKHO.NGUONDUOC_ID, NH.TENNGUONDUOC        , TAMNGUNG = CASE WHEN TM_DUOC.TAMNGUNG = '1' OR nh.TAMNGUNG = '1' OR KD.TAMNGUNG = '1' THEN '1' ELSE '0' END        , TM_DUOC.DANGTRINHBAY        from TM_DUOC        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = TM_DUOC.DONVITINH_ID        left join TM_TENDUOC on TM_DUOC.TENDUOC_ID = TM_TENDUOC.TENDUOC_ID and TM_DUOC.BENHVIEN_ID = 'HLU01' and TM_DUOC.TAMNGUNG = '0'        left join TM_LOAIDUOC on TM_LOAIDUOC.LOAIDUOC_ID = TM_DUOC.LOAIDUOC_ID and TM_LOAIDUOC.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG on (TM_LOAIDUOC.LOAIVATTU_ID = TM_DUOC_HANDUNG.LOAIDUOC and TM_DUOC_HANDUNG.BENHVIEN_ID = 'HLU01')        inner join        (select LTRIM(A.KHODUOC_ID) + '_' + LTRIM(A.DUOC_ID) + '_' + LTRIM(ISNULL(A.NGUONDUOC_ID,'')) as DUOC_KEY, A.KHODUOC_ID, A.DUOC_ID,A.NGUONDUOC_ID,        SUM(isnull(A.SOLUONG,0)) as SOLUONG        from        (select SUM(SOLUONG) as SOLUONG, KHODUOC_ID, DUOC_ID, NGUONDUOC_ID from TT_DUOC_KYGUI_TONKHO        where BENHVIEN_ID = 'HLU01' group by KHODUOC_ID, DUOC_ID, NGUONDUOC_ID) A        group by LTRIM(A.KHODUOC_ID) + '_' + LTRIM(A.DUOC_ID) + '_' + LTRIM(A.NGUONDUOC_ID), A.KHODUOC_ID, A.DUOC_ID, A.NGUONDUOC_ID)        TT_TONKHO on TT_TONKHO.DUOC_ID = TM_DUOC.DUOC_ID        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = TT_TONKHO.NGUONDUOC_ID and nh.BENHVIEN_ID = 'HLU01'        LEFT JOIN TM_KHODUOC KD ON KD.KHODUOC_ID = TT_TONKHO.KHODUOC_ID        where TM_DUOC.BENHVIEN_ID = 'HLU01' AND TT_TONKHO.SOLUONG >= 0]
2019-09-20 17:10:24,134 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM018']
2019-09-20 17:10:24,170 [5] DEBUG - Statement Id: [DAO00027_GetListDuocTonKho] PreparedStatement : [select distinct TT_TONKHO.DUOC_KEY, LTRIM(TT_TONKHO.KHODUOC_ID) as KHODUOC_ID, TM_DUOC.DUOC_ID, TM_LOAIDUOC.MALOAIDUOC,TM_DUOC.SOVISA,TM_DUOC.TYLE_VAT,TM_DUOC.COTOA,        TM_DUOC.MADUOC, TM_DUOC.TENHANG, TM_DUOC.TENDUOCDAYDU, dvt.TENDONVITINH as DONVITINH,  TM_DUOC.DONVITINH_ID,TM_DUOC.BHYT,                TM_DUOC.TENHOATCHAT,          TM_DUOC.HAMLUONG, TM_DUOC.HANGSANXUAT, TM_DUOC.QUOCGIA, TM_DUOC.LOAIDUOC_ID, TM_DUOC.DUONGDUNG_ID,        TM_TENDUOC.TENDUOC, TM_TENDUOC.TENDUOC_EN, TM_TENDUOC.MAQUOCTE, TM_TENDUOC.MAQUOCTEBT,        TM_LOAIDUOC.LOAIVATTU_ID, TM_DUOC.BENHVIEN_ID,        TT_TONKHO.SOLUONG, TM_DUOC.VTYT_PHANLOAI, TM_DUOC.PHAMVI, TT_TONKHO.NGUONDUOC_ID, NG.TENNGUONDUOC AS TENNGUONDUOC        , TAMNGUNG = CASE WHEN TM_DUOC.TAMNGUNG = '1' OR NG.TAMNGUNG = '1' OR KD.TAMNGUNG = '1' THEN '1' ELSE '0' END        , TM_DUOC.DANGTRINHBAY        from TM_DUOC        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = TM_DUOC.DONVITINH_ID        left join TM_TENDUOC on TM_DUOC.TENDUOC_ID = TM_TENDUOC.TENDUOC_ID and TM_DUOC.BENHVIEN_ID = 'HLU01' and TM_DUOC.TAMNGUNG = '0'        left join TM_LOAIDUOC on TM_LOAIDUOC.LOAIDUOC_ID = TM_DUOC.LOAIDUOC_ID and TM_LOAIDUOC.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG on (TM_LOAIDUOC.LOAIVATTU_ID = TM_DUOC_HANDUNG.LOAIDUOC and TM_DUOC_HANDUNG.BENHVIEN_ID = 'HLU01')        inner join        (select LTRIM(A.KHODUOC_ID) + '_' + LTRIM(A.DUOC_ID) + '_' + LTRIM(ISNULL(A.NGUONDUOC_ID,'')) as DUOC_KEY, A.KHODUOC_ID, A.DUOC_ID, A.NGUONDUOC_ID,        SUM(isnull(A.SOLUONG,0)) as SOLUONG        from        (select SUM(SOLUONG) as SOLUONG, KHODUOC_ID, DUOC_ID, NGUONDUOC_ID from TT_DUOC_TONKHO        where BENHVIEN_ID = 'HLU01' group by KHODUOC_ID, DUOC_ID, NGUONDUOC_ID) A        group by LTRIM(A.KHODUOC_ID) + '_' + LTRIM(A.DUOC_ID) + '_' + LTRIM(ISNULL(A.NGUONDUOC_ID,'')), A.KHODUOC_ID, A.DUOC_ID, NGUONDUOC_ID        ) TT_TONKHO on TT_TONKHO.DUOC_ID = TM_DUOC.DUOC_ID        LEFT JOIN TM_NGUONHANG NG ON NG.NGUONDUOC_ID = TT_TONKHO.NGUONDUOC_ID        LEFT JOIN TM_KHODUOC KD ON KD.KHODUOC_ID = TT_TONKHO.KHODUOC_ID        where TM_DUOC.BENHVIEN_ID = 'HLU01' and TT_TONKHO.SOLUONG >= 0]
2019-09-20 17:10:24,980 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM023']
2019-09-20 17:10:25,018 [5] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoVaBooking] PreparedStatement : [declare @NGUONDUOC_MACDINH varchar(5) = '0';        declare @TOAMUANGOAI int = 0;        select @NGUONDUOC_MACDINH = isnull(VALUE,0) from TM_SYS_APPSETTINGS where CODE = 'PHA_NGUONDUOC'        select @TOAMUANGOAI = isnull(VALUE,0) from TM_SYS_APPSETTINGS where CODE = 'OPD_TOAMUANGOAI_DUNGDANHMUC_DUOC'                if @TOAMUANGOAI = 1        begin        select  distinct '0' + '_' + LTRIM(d.DUOC_ID) + '_' + @NGUONDUOC_MACDINH as DUOC_KEY, 0 as PHAMVI_ID, @NGUONDUOC_MACDINH as NGUONDUOC_ID, null as TENNGUONDUOC, null as TINHTIEN, d.DUOC_ID, ld.MALOAIDUOC,        d.SOVISA,d.TYLE_VAT,d.COTOA, d.MADUOC, d.TENHANG, d.TENDUOCDAYDU, d.DONVITINH as DONVITINH, d.BHYT,        d.TENHOATCHAT, d.HAMLUONG, d.HANGSANXUAT, d.QUOCGIA, d.LOAIDUOC_ID, d.DUONGDUNG_ID, d.TINHTIEN_PTTT,        ten.TENDUOC, ten.TENDUOC_EN, ten.MAQUOCTE, ten.MAQUOCTEBT,        '' as BHYT_TEXT        , ld.LOAIVATTU_ID        , d.BENHVIEN_ID,        999999999 as SOLUONG, d.VTYT_PHANLOAI, d.PHAMVI, d.SUASOLUONGTONGHOP, d.MADUOCBV, d.DANGTRINHBAY        , TAMNGUNG = CASE WHEN d.TAMNGUNG = '1' THEN '1' ELSE '0' END        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        union all        select  distinct tk.DUOC_KEY, LTRIM(tk.PHAMVI_ID) as PHAMVI_ID, tk.NGUONDUOC_ID, nh.TENNGUONDUOC, nh.TINHTIEN, d.DUOC_ID, ld.MALOAIDUOC,        d.SOVISA,d.TYLE_VAT,d.COTOA, d.MADUOC, d.TENHANG, d.TENDUOCDAYDU, d.DONVITINH as DONVITINH, d.BHYT,        d.TENHOATCHAT, d.HAMLUONG, d.HANGSANXUAT, d.QUOCGIA, d.LOAIDUOC_ID, d.DUONGDUNG_ID, d.TINHTIEN_PTTT,        ten.TENDUOC, ten.TENDUOC_EN, ten.MAQUOCTE, ten.MAQUOCTEBT,        CASE WHEN d.BHYT = '1' THEN 'BHYT' ELSE '' END as BHYT_TEXT        , ld.LOAIVATTU_ID        , d.BENHVIEN_ID,        tk.SOLUONG, d.VTYT_PHANLOAI, d.PHAMVI, d.SUASOLUONGTONGHOP, d.MADUOCBV, d.DANGTRINHBAY        , TAMNGUNG = CASE WHEN d.TAMNGUNG = '1' OR nh.TAMNGUNG = '1' OR kd.TAMNGUNG = '1' THEN '1' ELSE '0' END        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        inner join        (        select  LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')) DUOC_KEY, (SUM(dtk.SOLUONG) - isnull(sum(A.SOLUONG),0) - isnull(sum(B.SOLUONG),0)) SOLUONG, pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        from (select sum(soluong) soluong,duoc_id,nguonduoc_id,khoduoc_id,benhvien_id from TT_DUOC_TONKHO  group by duoc_id,nguonduoc_id,khoduoc_id,benhvien_id) dtk        inner join TM_DUOC_PHAMVISD_MAPPING pvsd on dtk.KHODUOC_ID = pvsd.KHODUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NOITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) B on B.DUOC_ID = dtk.DUOC_ID and B.SOLUONG > 0 and B.PHAMVI_ID = pvsd.PHAMVI_ID and B.NGUONHANG_ID = dtk.NGUONDUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NGOAITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) A on A.DUOC_ID = dtk.DUOC_ID and A.SOLUONG > 0 and A.PHAMVI_ID = pvsd.PHAMVI_ID and A.NGUONHANG_ID = dtk.NGUONDUOC_ID        where dtk.SOLUONG > 0 and dtk.BENHVIEN_ID = 'HLU01'        group by LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')), pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        ) tk on tk.DUOC_ID = d.DUOC_ID        left join TM_DUOC_PHAMVISUDUNG kd on kd.PHAMVI_ID = tk.PHAMVI_ID and kd.BENHVIEN_ID = 'HLU01'        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = tk.NGUONDUOC_ID and nh.BENHVIEN_ID = 'HLU01'        where d.BENHVIEN_ID = 'HLU01'  and tk.SOLUONG >= 0        end        else        begin                  select  distinct tk.DUOC_KEY, LTRIM(tk.PHAMVI_ID) as PHAMVI_ID, tk.NGUONDUOC_ID, nh.TENNGUONDUOC, nh.TINHTIEN, d.DUOC_ID, ld.MALOAIDUOC,        d.SOVISA,d.TYLE_VAT,d.COTOA, d.MADUOC, d.TENHANG, d.TENDUOCDAYDU, d.DONVITINH as DONVITINH, d.BHYT,        d.TENHOATCHAT, d.HAMLUONG, d.HANGSANXUAT, d.QUOCGIA, d.LOAIDUOC_ID, d.DUONGDUNG_ID, d.TINHTIEN_PTTT,        ten.TENDUOC, ten.TENDUOC_EN, ten.MAQUOCTE, ten.MAQUOCTEBT,        CASE WHEN d.BHYT = '1' THEN 'BHYT' ELSE '' END as BHYT_TEXT        , ld.LOAIVATTU_ID        , d.BENHVIEN_ID,        tk.SOLUONG, d.VTYT_PHANLOAI, d.PHAMVI, d.SUASOLUONGTONGHOP, d.MADUOCBV, d.DANGTRINHBAY        , TAMNGUNG = CASE WHEN d.TAMNGUNG = '1' OR nh.TAMNGUNG = '1' OR kd.TAMNGUNG = '1' THEN '1' ELSE '0' END        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        inner join        (        select  LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')) DUOC_KEY, (SUM(dtk.SOLUONG) - isnull(sum(A.SOLUONG),0) - isnull(sum(B.SOLUONG),0)) SOLUONG, pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        from (select sum(soluong) soluong,duoc_id,nguonduoc_id,khoduoc_id,benhvien_id from TT_DUOC_TONKHO  group by duoc_id,nguonduoc_id,khoduoc_id,benhvien_id) dtk        inner join TM_DUOC_PHAMVISD_MAPPING pvsd on dtk.KHODUOC_ID = pvsd.KHODUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NOITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) B on B.DUOC_ID = dtk.DUOC_ID and B.SOLUONG > 0 and B.PHAMVI_ID = pvsd.PHAMVI_ID and B.NGUONHANG_ID = dtk.NGUONDUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NGOAITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) A on A.DUOC_ID = dtk.DUOC_ID and A.SOLUONG > 0 and A.PHAMVI_ID = pvsd.PHAMVI_ID and A.NGUONHANG_ID = dtk.NGUONDUOC_ID        where dtk.SOLUONG > 0 and dtk.BENHVIEN_ID = 'HLU01'        group by LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')), pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        ) tk on tk.DUOC_ID = d.DUOC_ID        left join TM_DUOC_PHAMVISUDUNG kd on kd.PHAMVI_ID = tk.PHAMVI_ID and kd.BENHVIEN_ID = 'HLU01'        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = tk.NGUONDUOC_ID and nh.BENHVIEN_ID = 'HLU01'        where d.BENHVIEN_ID = 'HLU01'  and tk.SOLUONG >= 0        end]
2019-09-20 17:10:28,269 [5] DEBUG - Statement Id: [DAO00320_GetList] PreparedStatement : [select M.*            from TM_MAU M            LEFT JOIN TM_MAU_DONVITINH DVT on M.DONVITINH_ID=DVT.DONVITINH_ID            where            M.TAMNGUNG = '0'            and M.BENHVIEN_ID = 'HLU01'            order by M.TENMAU]
2019-09-20 17:10:28,345 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM071']
2019-09-20 17:10:28,394 [5] DEBUG - Statement Id: [DAO00322_GetListMauTonKhoForCreateCached] PreparedStatement : [SELECT DISTINCT          TK.MAU_KEY, TK.KHOMAU_ID, M.MAU_ID, M.MAMAU, M.TENMAU, M.NHOM_ABO, M.NHOM_RH, M.LOAIMAU_ID,          TK.SOLONHAP_ID, SLN.SOLONHAP, SLN.SOKIEMSOAT, TK.NGUONHANG_ID, NG.TENNGUONMAU, M.BENHVIEN_ID, M.DONVITINH_ID,          SUM(tk.SOLUONG) AS SOLUONG,K.TENKHO,DVT.TENDONVITINH          FROM TT_MAU_TONKHO TK          JOIN TM_KHO K ON TK.KHOMAU_ID = K.KHO_ID          JOIN TT_MAU_CHUNGTU_SOLONHAP SLN ON TK.SOLONHAP_ID = SLN.SOLONHAP_ID          JOIN TM_MAU M on TK.MAU_ID = M.MAU_ID and M.TAMNGUNG = '0'          LEFT JOIN TM_MAU_DONVITINH DVT on M.DONVITINH_ID=DVT.DONVITINH_ID          LEFT JOIN TM_NGUONMAU NG ON NG.NGUONMAU_ID = TK.NGUONHANG_ID          WHERE TK.SOLUONG > 0          GROUP BY TK.MAU_KEY, TK.KHOMAU_ID, M.MAU_ID, M.MAMAU, M.TENMAU, M.NHOM_ABO, M.NHOM_RH, M.LOAIMAU_ID,          TK.SOLONHAP_ID, SLN.SOLONHAP, SLN.SOKIEMSOAT,TK.NGUONHANG_ID, NG.TENNGUONMAU, M.BENHVIEN_ID, M.DONVITINH_ID,K.TENKHO,DVT.TENDONVITINH]
2019-09-20 17:10:28,481 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM073']
2019-09-20 17:10:28,517 [5] DEBUG - Statement Id: [DAO00322_GetListMauTonKhoTruBooking] PreparedStatement : [select distinct          TK.MAU_KEY, TK.KHOMAU_ID, M.MAU_ID, M.MAMAU, M.TENMAU, M.NHOM_ABO, M.NHOM_RH, M.LOAIMAU_ID, M.DONVITINH_ID,          TK.SOLONHAP_ID, TK.SOLONHAP, TK.SOKIEMSOAT,M.PHAMVI, TK.NGUONHANG_ID, NG.TENNGUONMAU, M.BENHVIEN_ID,          TK.SOLUONG,TK.TENKHO,DVT.TENDONVITINH          from TM_MAU M          JOIN          (          select          A.MAU_KEY, A.KHOMAU_ID, A.MAU_ID ,a.NGUONHANG_ID, A.SOLONHAP_ID, A.SOLONHAP, A.SOKIEMSOAT, A.SOLUONG,A.TENKHO          from          (          select KHOMAU_ID, TK.MAU_ID, TK.NGUONHANG_ID, TK.MAU_KEY, SLN.SOLONHAP_ID, SLN.SOLONHAP, SLN.SOKIEMSOAT, ISNULL(TK.SOLUONG,0) - ISNULL(book.SOLUONG,0) as SOLUONG,K.TENKHO          from TT_MAU_TONKHO TK          JOIN TM_KHO K ON TK.KHOMAU_ID = K.KHO_ID          inner join TT_MAU_CHUNGTU_SOLONHAP SLN ON TK.SOLONHAP_ID = SLN.SOLONHAP_ID          left join dbo.TT_MAU_TONKHO_BOOK book ON book.MAU_KEY = TK.MAU_KEY AND book.TRANGTHAI = 'HIEULUC'          where ISNULL(TK.SOLUONG,0) - ISNULL(book.SOLUONG,0) > 0          ) A          )TK on TK.MAU_ID = M.MAU_ID and M.TAMNGUNG = '0'          LEFT JOIN TM_MAU_DONVITINH DVT on M.DONVITINH_ID=DVT.DONVITINH_ID          LEFT JOIN TM_NGUONMAU NG ON NG.NGUONMAU_ID = TK.NGUONHANG_ID]
2019-09-20 17:10:28,595 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM072']
2019-09-20 17:10:29,531 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'MAIN'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2019-09-20 17:10:30,345 [1] DEBUG - Statement Id: [DAO00002_FormList] PreparedStatement : [select              TM_SYS_FORM.HOSPITAL_ID,              TM_SYS_FORM.NAME,              TM_SYS_FORM.CLASS,              TM_SYS_FORM.ASSEMBLY,              TM_SYS_FORM.TITLE_VI as TITLE              from TM_SYS_FORM              where HOSPITAL_ID = 'HLU01']
2019-09-20 17:10:35,310 [1] DEBUG - Statement Id: [DAO00300_GetShortcutListByUserID] PreparedStatement : [SELECT S.SHORTCUT_CODE, S.SHORTCUT_VALUE              FROM TM_SHORTCUT AS S              WHERE S.BENHVIEN_ID = 'HLU01' AND S.USER_ID = '1' AND TAMNGUNG = '0']
2019-09-20 17:10:35,345 [1] DEBUG - Statement Id: [DAO00087_GetList] PreparedStatement : [select CODE, VALUE, BENHVIEN_ID              from TM_SYS_APPSETTINGS              where LOCKED = '0' and BENHVIEN_ID = 'HLU01'              order by SETTING_ID]
2019-09-20 17:10:35,457 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'MSG01'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2019-09-20 17:10:35,614 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'MSG02'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2019-09-20 17:10:35,773 [1] DEBUG - Statement Id: [DAO00008_GetUserSettings] PreparedStatement : [select A.*, B.TENKHO , C.TENPHONGBAN, B.MAKHO, C.MAPHONGBAN          from TM_SYS_USERS A          left join TM_KHODUOC B on B.KHODUOC_ID = A.INVENTORY_ID          left join TM_PHONGBAN C on (C.PHONGBAN_ID = A.WORKING_DEPT_ID and C.BENHVIEN_ID =  @param0 )          left join TM_SYS_USERKHO D on (D.ACCOUNT_ID = A.ACCOUNT_ID and D.HOSPITAL_ID =  @param0 )          where          A.HOSPITAL_ID =  @param0            and                 A.ACCOUNT_ID =  @param1]
2019-09-20 17:10:35,775 [1] DEBUG - Statement Id: [DAO00008_GetUserSettings] Parameters: [@param0=[HOSPITAL_ID,HLU01], @param1=[ACCOUNT_ID,113]]
2019-09-20 17:10:35,775 [1] DEBUG - Statement Id: [DAO00008_GetUserSettings] Types: [@param0=[String, System.String], @param1=[String, System.String]]
2019-09-20 17:10:35,809 [1] DEBUG - Statement Id: [DAO00008_GetUserInvSettings] PreparedStatement : [select A.*, B.TENKHO, B.MAKHO, B.LOAIKHO_ID, B.KHOQUANLY_ID          from TM_SYS_USERKHO A          left join TM_KHO B on B.MODULE_ID = A.MODULE_ID and B.KHO_ID = A.KHO_ID          where A.HOSPITAL_ID =  @param0  and A.ACCOUNT_ID =  @param1           order by B.TENKHO]
2019-09-20 17:10:35,809 [1] DEBUG - Statement Id: [DAO00008_GetUserInvSettings] Parameters: [@param0=[HOSPITAL_ID,HLU01], @param1=[ACCOUNT_ID,113]]
2019-09-20 17:10:35,809 [1] DEBUG - Statement Id: [DAO00008_GetUserInvSettings] Types: [@param0=[String, System.String], @param1=[String, System.String]]
2019-09-20 17:10:35,940 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'COM30'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2019-09-20 17:10:36,100 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'RIS04'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2019-09-20 17:10:43,801 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'MENU1'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2019-09-20 17:10:43,935 [1] DEBUG - Statement Id: [DAO00011_GetList] PreparedStatement : [select              TM_SYS_MENU.ID,              TM_SYS_MENU.PARENTID,              TM_SYS_MENU.SCREEN,              TM_SYS_MENU.SMALLIMAGE,              TM_SYS_MENU.LARGEIMAGE,              TM_SYS_MENU.DESCRIPTION,              TM_SYS_MENU.TYPE,              TM_SYS_MENU.TITLE_VI as TITLE              from TM_SYS_MENU              where TM_SYS_MENU.HOSPITAL_ID = 'HLU01' and TM_SYS_MENU.ACTIVE = '1'               AND                   (TM_SYS_MENU.TYPE & '8' = '8')                             order by TM_SYS_MENU.ORDERNUM]
2019-09-20 17:10:44,206 [1] DEBUG - Statement Id: [DAO00011_usermenu_list] PreparedStatement : [select              TM_SYS_HOMEMENU.MENUID as ID,              TM_SYS_MENU.TITLE_VI as TITLE,              TM_SYS_MENU.SCREEN,              TM_SYS_MENU.SMALLIMAGE,              TM_SYS_MENU.LARGEIMAGE,              TM_SYS_MENU.TYPE              from TM_SYS_HOMEMENU              left join TM_SYS_MENU on TM_SYS_MENU.ID = TM_SYS_HOMEMENU.MENUID and TM_SYS_MENU.HOSPITAL_ID = TM_SYS_HOMEMENU.HOSPITAL_ID              where TM_SYS_HOMEMENU.HOSPITAL_ID = 'HLU01' and TM_SYS_HOMEMENU.USERID = '113' and TM_SYS_MENU.ACTIVE = '1'               AND                   (TM_SYS_MENU.TYPE & '8' = '8')                             ORDER BY TM_SYS_HOMEMENU.ORDERNUM]
2019-09-20 17:15:46,957 [1] DEBUG - Statement Id: [DAO00087_GetServiceParams] PreparedStatement : [select CODE, VALUE              from TM_SYS_APPSETTINGS              where LOCKED = '0' and BENHVIEN_ID = 'HLU01']
2019-09-20 17:15:47,342 [1] DEBUG - Statement Id: [DAO00030_GetMucDichChungTuID] PreparedStatement : [SELECT DICTIONARY_ID              FROM              LST_DICTIONARY              WHERE              DICTIONARY_TYPE_CODE = 'MucDichChungTu'              and DICTIONARY_CODE = 'X13']
2019-09-20 17:15:47,598 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'PHA22'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2019-09-20 17:15:48,234 [1] DEBUG - Statement Id: [DAO00030_GET_SOLONHAP] PreparedStatement : [SELECT DISTINCT            SLN.SOLONHAP_ID, SLN.SOLONHAP, SLN.SOLOSANPHAM, SLN.SOKIEMSOAT, SLN.SOVISA, CONVERT(varchar(20), SLN.SOLOSANPHAM) + '/' + CONVERT(varchar(20), TK.SOLUONG) AS SOLOSOTON,            SLN.NGAYNHAP AS NGAYNHAPLO, SLN.HANDUNG AS HANSUDUNG,  SLN.HANDUNG, SLN.NGUONDUOC_ID, SLN.NGUONDUOC_ID as NGUONHANG_ID,            SLNGB.DONGIAMUA, SLNGB.DONGIAVON, SLNGB.TYLEVAT_DAUVAO as TYLEVAT, d.TYLE_VAT, SLNGB.DONGIAVONVAT, SLNGB.DONGIABAN, SLNGB.DONGIABANVAT_DAUVAO as DONGIABAN_VAT,            TK.DUOCTONKHO_ID, TK.KHODUOC_ID, TK.DUOC_ID, TK.SOLUONG, TK.SOLUONG AS SOLUONGTON,            D.TENDUOCDAYDU,D.DONVITINH_ID, D.DONVITINH, D.BHYT, NH.TENNGUONDUOC AS NGUONHANG,            LTRIM(TK.KHODUOC_ID) + '_' + LTRIM(TK.DUOC_ID) + '_' + LTRIM(TK.NGUONDUOC_ID) as DUOC_KEY, D.SO_QDTT            FROM            TT_DUOC_CHUNGTU_SOLONHAP SLN,            TT_DUOC_TONKHO TK,            TT_DUOC_SOLONHAP_GIABAN SLNGB,            TM_DUOC D,            TM_NGUONHANG NH            WHERE            SLN.SOLONHAP_ID = TK.SOLONHAP_ID            AND SLN.SOLONHAP_ID = SLNGB.SOLONHAP_ID            AND SLN.NGUONDUOC_ID = NH.NGUONDUOC_ID            AND SLN.DUOC_ID = D.DUOC_ID            AND TK.DUOC_ID = ''            AND TK.KHODUOC_ID = ''            AND SLN.BENHVIEN_ID = 'HLU01'            AND TK.SOLUONG > 0                 and                     SLN.NGUONDUOC_ID = '1'                                      ORDER BY NGAYNHAP]
2019-09-20 17:15:48,305 [1] DEBUG - Statement Id: [DAO00030_GetMucDichChungTuID] PreparedStatement : [SELECT DICTIONARY_ID              FROM              LST_DICTIONARY              WHERE              DICTIONARY_TYPE_CODE = 'MucDichChungTu'              and DICTIONARY_CODE = 'X13']
2019-09-20 17:15:48,450 [1] DEBUG - Statement Id: [DAO00030_GetMucDichChungTuID] PreparedStatement : [SELECT DICTIONARY_ID              FROM              LST_DICTIONARY              WHERE              DICTIONARY_TYPE_CODE = 'MucDichChungTu'              and DICTIONARY_CODE = 'X13']
2019-09-20 17:15:49,844 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'PHA74'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2019-09-20 17:15:55,269 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'COM98'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2019-09-20 17:15:55,699 [1] DEBUG - Statement Id: [DAO00030_Search_PhieuXuatSD] PreparedStatement : [SELECT DISTINCT phieuxuat.* FROM          (          select DISTINCT          CT.CHUNGTU_ID,          CT.SOCHUNGTU,          CT.MACHUNGTU,          CT.NGAYCHUNGTU,          CT.NGAYTAO,          CT.KHOXUAT_ID,          CT.NGUOIGIAO_ID,          CT.KHONHAP_ID,          CT.NGUOINHAN_ID,          PL.MACHUNGTU as MAPHIEULINH,          PL.NGAYCHUNGTU as NGAYPHIEULINH,          bn.MAYTE,          bn.TENBENHNHAN,          CONVERT(VARCHAR(10), KB.THOIGIANKHAM, 103) + ' - ' + CONVERT(VARCHAR(5), KB.THOIGIANKHAM, 108) as THOIGIANKHAM,          nl.TENNHANVIEN as NGUOILAP,          CT.DIENGIAI          from TT_DUOC_CHUNGTU CT          inner join TT_DUOC_CHUNGTU_CHITIET ctct on ct.CHUNGTU_ID = ctct.CHUNGTU_ID          inner join TT_NOITRU_TOATHUOC TT on ctct.TOATHUOCNOITRU_ID = TT.TOATHUOC_ID          inner join TT_NOITRU_KHAMBENH KB on kb.KHAMBENH_ID = TT.KHAMBENH_ID          inner join TT_BENHNHAN BN on TT.BENHNHAN_ID = BN.BENHNHAN_ID          left join TT_DUOC_PHIEULINH PL on PL.CHUNGTU_ID = CT.PHIEULINH_ID          left join TM_NHANVIEN nl on nl.NHANVIEN_ID = TT.NGUOITAO_ID           where                   CT.MUCDICHCHUNGTU_ID = '1060'               and                 CT.KHOXUAT_ID = '32'               and                 CONVERT(date, CT.NGAYCHUNGTU) BETWEEN CONVERT(date, '9/20/2019 12:00:00 AM')  and  CONVERT(date, '9/20/2019 12:00:00 AM')               and                 CT.BENHVIEN_ID = 'HLU01'                           UNION            select DISTINCT          CT.CHUNGTU_ID,          CT.SOCHUNGTU,          CT.MACHUNGTU,          CT.NGAYCHUNGTU,          CT.NGAYTAO,          CT.KHOXUAT_ID,          CT.NGUOIGIAO_ID,          CT.KHONHAP_ID,          CT.NGUOINHAN_ID,          PL.MACHUNGTU as MAPHIEULINH,          PL.NGAYCHUNGTU as NGAYPHIEULINH,          bn.MAYTE,          bn.TENBENHNHAN,          CONVERT(VARCHAR(10), KB.THOIGIANKHAM, 103) + ' - ' + CONVERT(VARCHAR(5), KB.THOIGIANKHAM, 108) as THOIGIANKHAM,          nl.TENNHANVIEN as NGUOILAP,          CT.DIENGIAI          from TT_DUOC_CHUNGTU CT          inner join TT_DUOC_CHUNGTU_CHITIET ctct on ct.CHUNGTU_ID = ctct.CHUNGTU_ID          inner join TT_NGOAITRU_KHAMBENH_VTYT vt on ctct.KHAMBENH_VTYT_ID = vt.KHAMBENH_VTYT_ID          inner join TT_NGOAITRU_KHAMBENH kb on kb.KHAMBENH_ID = vt.KHAMBENH_ID          inner join TT_BENHNHAN BN on bn.BENHNHAN_ID = kb.BENHNHAN_ID          left join TT_DUOC_PHIEULINH PL on PL.CHUNGTU_ID = CT.PHIEULINH_ID          left join TM_NHANVIEN nl on nl.NHANVIEN_ID = vt.NGUOITAO_ID           where                   CT.MUCDICHCHUNGTU_ID = '1060'               and                 CT.KHOXUAT_ID = '32'               and                 CONVERT(date, CT.NGAYCHUNGTU) BETWEEN CONVERT(date, '9/20/2019 12:00:00 AM')  and  CONVERT(date, '9/20/2019 12:00:00 AM')               and                 CT.BENHVIEN_ID = 'HLU01'                           UNION            select DISTINCT          CT.CHUNGTU_ID,          CT.SOCHUNGTU,          CT.MACHUNGTU,          CT.NGAYCHUNGTU,          CT.NGAYTAO,          CT.KHOXUAT_ID,          CT.NGUOIGIAO_ID,          CT.KHONHAP_ID,          CT.NGUOINHAN_ID,          PL.MACHUNGTU as MAPHIEULINH,          PL.NGAYCHUNGTU as NGAYPHIEULINH,          bn.MAYTE,          bn.TENBENHNHAN,          CONVERT(VARCHAR(10), pt.NGAYTHUCHIEN, 103) + ' - ' + CONVERT(VARCHAR(5), pt.NGAYTHUCHIEN, 108) as THOIGIANKHAM,          nl.TENNHANVIEN as NGUOILAP,          CT.DIENGIAI          from TT_DUOC_CHUNGTU CT          inner join TT_DUOC_CHUNGTU_CHITIET ctct on ct.CHUNGTU_ID = ctct.CHUNGTU_ID          inner join TT_PHAUTHUAT_VTYT vt on ctct.PHAUTHUAT_VTYT_ID = vt.PHAUTHUAT_VTYT_ID          inner join TT_PHAUTHUAT pt on pt.PHAUTHUAT_ID = vt.PHAUTHUAT_ID          inner join TT_TIEPNHAN tn on tn.TIEPNHAN_ID = pt.TIEPNHAN_ID          inner join TT_BENHNHAN bn on bn.BENHNHAN_ID = tn.BENHNHAN_ID          left join TT_DUOC_PHIEULINH PL on PL.CHUNGTU_ID = CT.PHIEULINH_ID          left join TM_NHANVIEN nl on nl.NHANVIEN_ID = pt.NGUOITAO_ID           where                   CT.MUCDICHCHUNGTU_ID = '1060'               and                 CT.KHOXUAT_ID = '32'               and                 CONVERT(date, CT.NGAYCHUNGTU) BETWEEN CONVERT(date, '9/20/2019 12:00:00 AM')  and  CONVERT(date, '9/20/2019 12:00:00 AM')               and                 CT.BENHVIEN_ID = 'HLU01'                           UNION            select DISTINCT          CT.CHUNGTU_ID,          CT.SOCHUNGTU,          CT.MACHUNGTU,          CT.NGAYCHUNGTU,          CT.NGAYTAO,          CT.KHOXUAT_ID,          CT.NGUOIGIAO_ID,          CT.KHONHAP_ID,          CT.NGUOINHAN_ID,          PL.MACHUNGTU as MAPHIEULINH,          PL.NGAYCHUNGTU as NGAYPHIEULINH,          bn.MAYTE,          bn.TENBENHNHAN,          CONVERT(VARCHAR(10), cls.NGAYTAO, 103) + ' - ' + CONVERT(VARCHAR(5), cls.NGAYTAO, 108) as THOIGIANKHAM,          nl.TENNHANVIEN as NGUOILAP,          CT.DIENGIAI          from TT_DUOC_CHUNGTU CT          inner join TT_DUOC_CHUNGTU_CHITIET ctct on ct.CHUNGTU_ID = ctct.CHUNGTU_ID          inner join TT_CLSKETQUA_VTYT cls on ctct.CLSKETQUA_VTYT_ID = cls.CLSKETQUA_VTYT_ID          inner join TT_DVYEUCAU DV on DV.DVYEUCAU_ID = CLS.DVYEUCAU_ID          inner join TT_BENHNHAN bn on bn.BENHNHAN_ID = DV.BENHNHAN_ID          left join TT_DUOC_PHIEULINH PL on PL.CHUNGTU_ID = CT.PHIEULINH_ID          left join TM_NHANVIEN nl on nl.NHANVIEN_ID = cls.NGUOITAO_ID           where                   CT.MUCDICHCHUNGTU_ID = '1060'               and                 CT.KHOXUAT_ID = '32'               and                 CONVERT(date, CT.NGAYCHUNGTU) BETWEEN CONVERT(date, '9/20/2019 12:00:00 AM')  and  CONVERT(date, '9/20/2019 12:00:00 AM')               and                 CT.BENHVIEN_ID = 'HLU01'                           UNION            select DISTINCT          CT.CHUNGTU_ID,          CT.SOCHUNGTU,          CT.MACHUNGTU,          CT.NGAYCHUNGTU,          CT.NGAYTAO,          CT.KHOXUAT_ID,          CT.NGUOIGIAO_ID,          CT.KHONHAP_ID,          CT.NGUOINHAN_ID,          PL.MACHUNGTU as MAPHIEULINH,          PL.NGAYCHUNGTU as NGAYPHIEULINH,          null as MAYTE,          null as TENBENHNHAN,          null as THOIGIANKHAM,          nl.TENNHANVIEN as NGUOILAP,          CT.DIENGIAI          from TT_DUOC_CHUNGTU CT          inner join TT_DUOC_CHUNGTU_CHITIET ctct on ct.CHUNGTU_ID = ctct.CHUNGTU_ID          left join TT_DUOC_PHIEULINH PL on PL.CHUNGTU_ID = CT.PHIEULINH_ID          left join TM_NHANVIEN nl on nl.NHANVIEN_ID = ct.NGUOITAO_ID          WHERE (ctct.TOATHUOCNOITRU_ID IS NULL AND ctct.KHAMBENH_VTYT_ID IS NULL AND ctct.PHAUTHUAT_VTYT_ID IS NULL AND ctct.CLSKETQUA_VTYT_ID IS NULL)             and                 CT.MUCDICHCHUNGTU_ID = '1060'               and                 CT.KHOXUAT_ID = '32'               and                 CONVERT(date, CT.NGAYCHUNGTU) BETWEEN CONVERT(date, '9/20/2019 12:00:00 AM')  and  CONVERT(date, '9/20/2019 12:00:00 AM')               and                 CT.BENHVIEN_ID = 'HLU01'                         )PhieuXuat          ORDER BY PhieuXuat.CHUNGTU_ID desc]
2019-09-20 17:15:59,724 [1] DEBUG - Statement Id: [DAO00030_GetList] PreparedStatement : [select *              from TT_DUOC_CHUNGTU              where BENHVIEN_ID = 'HLU01'                and                   TT_DUOC_CHUNGTU.CHUNGTU_ID = '137704'                               order by CHUNGTU_ID]
2019-09-20 17:15:59,908 [1] DEBUG - Statement Id: [DAO00030_CHUNGTUXUAT_CHITIET_GetList] PreparedStatement : [SELECT            ctct.*,            d.MADUOC, d.TENHANG, d.TENDUOCDAYDU, dvt.TENDONVITINH as DONVITINH,n.TENNGUONDUOC as NGUONHANG,            sln.SOLONHAP, sln.SOLOSANPHAM, sln.NGAYNHAP as NGAYNHAPLO, sln.HANDUNG as HANSUDUNG,            isnull(tk.SOLUONG,0) as SOLUONGTON,            LTRIM(ct.KHOXUAT_ID) + '_' + LTRIM(sln.DUOC_ID) + '_' + LTRIM(sln.NGUONDUOC_ID) as DUOC_KEY            , NLD.MANHOMLOAIDUOC, ld.MALOAIDUOC, D.SO_QDTT            FROM            TT_DUOC_CHUNGTU_CHITIET ctct            INNER JOIN TT_DUOC_CHUNGTU ct ON (ct.CHUNGTU_ID = ctct.CHUNGTU_ID)            INNER JOIN TT_DUOC_CHUNGTU_SOLONHAP sln ON (sln.SOLONHAP_ID = ctct.SOLONHAP_ID)            LEFT JOIN (            select xx.DUOCTONKHO_ID, xx.KHODUOC_ID, xx.DUOC_ID, xx.SOLONHAP_ID, xx.SOLUONG, xx.NGUONDUOC_ID, xx.BENHVIEN_ID from TT_DUOC_TONKHO xx            join ( select max(DUOCTONKHO_ID) as DUOCTONKHO_ID, KHODUOC_ID, DUOC_ID, SOLONHAP_ID, NGUONDUOC_ID            from TT_DUOC_TONKHO group by KHODUOC_ID, DUOC_ID, SOLONHAP_ID, NGUONDUOC_ID) yy on xx.DUOCTONKHO_ID=yy.DUOCTONKHO_ID            ) tk ON (tk.SOLONHAP_ID = sln.SOLONHAP_ID AND tk.DUOC_ID = sln.DUOC_ID and tk.KHODUOC_ID = ct.KHOXUAT_ID)            INNER JOIN TM_DUOC d ON (d.DUOC_ID = ctct.DUOC_ID)            INNER JOIN TM_NGUONHANG n ON (n.NGUONDUOC_ID = ctct.NGUONHANG_ID)            LEFT JOIN TM_DONVITINH dvt ON (dvt.DONVITINH_ID = ctct.DONVITINH_ID)            left join TM_LOAIDUOC LD on LD.LOAIDUOC_ID = D.LOAIDUOC_ID            LEFT JOIN TM_NHOMLOAIDUOC NLD on NLD.NHOMLOAIDUOC_ID = LD.NHOMLOAIDUOC_ID             where                             ct.CHUNGTU_ID = '137704'                       and                           ct.BENHVIEN_ID = 'HLU01'                                     order by CHUNGTUCHITIET_ID]
2019-09-20 17:16:00,160 [1] DEBUG - Statement Id: [DAO00030_KiemTraChungTuKhoaSo] PreparedStatement : [SELECT CHUNGTU_ID              FROM TT_DUOC_CHUNGTU              WHERE              MACHUNGTU = 'CS_KBX1319003092'              and BENHVIEN_ID = 'HLU01'              and              convert(date, NGAYCHUNGTU) <=              (              SELECT TOP 1 convert(date, KHOADENNGAY)              FROM TT_DUOC_KHOASOCHUNGTU              WHERE              KHODUOC_ID = '32'              and BENHVIEN_ID = 'HLU01'              AND KHOASO = '1'              ORDER BY KHOADENNGAY DESC              )]
2019-09-20 17:16:00,214 [1] DEBUG - Statement Id: [DAO00030_KiemTraChungTuDaChuyenKeToan] PreparedStatement : [SELECT CHUNGTU_ID            FROM TT_DUOC_CHUNGTU            WHERE            CHUNGTU_ID = '137704'            and IDCHUYEN IS NOT NULL            and BENHVIEN_ID = 'HLU01']
2019-09-20 17:16:00,268 [1] DEBUG - Statement Id: [DAO00030_KiemTraBenhNhanXuatVien] PreparedStatement : [select              TT.TOATHUOC_ID              from              TT_NOITRU_TOATHUOC TT              inner join TT_NOITRU_KHAMBENH KB on TT.KHAMBENH_ID = KB.KHAMBENH_ID              inner join TT_NOITRU_BENHAN BA on BA.BENHAN_ID = KB.BENHAN_ID              WHERE              BA.TRANGTHAI = 'DAXUATVIEN'              AND TT.CHUNGTU_ID =  137704              and TT.BENHVIEN_ID = 'HLU01']
2019-09-20 17:16:00,462 [1] DEBUG - Statement Id: [DAO00030_DUOCTONKHO_GetSoTonTheoDuoc] PreparedStatement : [SELECT              DUOC_ID,              SUM(SOLUONG) AS TONGTON              FROM              TT_DUOC_TONKHO              WHERE              KHODUOC_ID = '32'              and BENHVIEN_ID = 'HLU01'              and DUOC_ID IN (1)              GROUP BY DUOC_ID]
2019-09-20 17:16:00,556 [1] DEBUG - Statement Id: [DAO00030_DUOCTONKHO_GetSoTonTheoDuocTheoLo] PreparedStatement : [SELECT              DUOC_ID,SOLONHAP_ID,              SUM(SOLUONG) AS SOLUONGTONLO              FROM              TT_DUOC_TONKHO              WHERE              KHODUOC_ID = '32'              and BENHVIEN_ID = 'HLU01'              and DUOC_ID IN (1)              and SOLONHAP_ID IN (7541)              GROUP BY DUOC_ID, SOLONHAP_ID]
2019-09-20 17:16:00,591 [1] DEBUG - Statement Id: [DAO00030_DUOCTONKHO_GetSoTonTheoDuoc] PreparedStatement : [SELECT              DUOC_ID,              SUM(SOLUONG) AS TONGTON              FROM              TT_DUOC_TONKHO              WHERE              KHODUOC_ID = '32'              and BENHVIEN_ID = 'HLU01'              and DUOC_ID IN (1)              GROUP BY DUOC_ID]
2019-09-20 17:16:00,675 [1] DEBUG - Statement Id: [DAO00030_KTDaPhatSinhBienLai] PreparedStatement : [SELECT CHUNGTU_ID            FROM TT_NOITRU_TOATHUOC tt            INNER JOIN TT_VIENPHI vp on (tt.TOATHUOC_ID = vp.REF_ID and REF_TABLE = 'TT_NOITRU_TOATHUOC')            WHERE            CHUNGTU_ID = '137704'            AND tt.BENHVIEN_ID = 'HLU01'            AND HOADON_ID is not NULL            AND vp.HUY = '0'              union all            SELECT  kbtt.CHUNGTUPHATTHUOC_ID as CHUNGTU_ID            FROM TT_NGOAITRU_TOATHUOC tt            INNER JOIN TT_NGOAITRU_KHAMBENH_TOATHUOC kbtt on (kbtt.KHAMBENH_TOATHUOC_ID = tt.KHAMBENH_TOATHUOC_ID)            INNER JOIN TT_VIENPHI vp on (tt.TOATHUOC_ID = vp.REF_ID and REF_TABLE = 'TT_NGOAITRU_TOATHUOC')            WHERE            kbtt.CHUNGTUPHATTHUOC_ID = '137704'            AND tt.BENHVIEN_ID = 'HLU01'            AND HOADON_ID is not NULL            AND vp.HUY = '0'              union all            SELECT ctct.CHUNGTU_ID from            TT_DUOC_CHUNGTU_CHITIET ctct            INNER JOIN TT_HOADON_CHITIET_NGOAITRU hdct on (hdct.REF_ID = ctct.CHUNGTUCHITIET_ID and hdct.REF_TABLE = 'TT_DUOC_CHUNGTU_CHITIET')            INNER JOIN TT_HOADON hd on hd.HOADON_ID = hdct.HOADON_ID            WHERE            ctct.CHUNGTU_ID = '137704'                            AND hd.HUYHOADON = '0'              AND hd.HOANTRA = '0'                                  AND ctct.BENHVIEN_ID = 'HLU01'                        union all            SELECT CHUNGTU_ID            FROM TT_NGOAITRU_KHAMBENH_VTYT tt            INNER JOIN TT_VIENPHI vp on (tt.KHAMBENH_VTYT_ID = vp.REF_ID and REF_TABLE = 'TT_NGOAITRU_KHAMBENH_VTYT')            WHERE            CHUNGTU_ID = '137704'            AND tt.BENHVIEN_ID = 'HLU01'            AND HOADON_ID is not NULL            AND vp.HUY = '0'                        union all            SELECT CHUNGTU_ID            FROM TT_PHAUTHUAT_VTYT tt            INNER JOIN TT_VIENPHI vp on (tt.PHAUTHUAT_VTYT_ID = vp.REF_ID and REF_TABLE = 'TT_PHAUTHUAT_VTYT')            WHERE            CHUNGTU_ID = '137704'            AND tt.BENHVIEN_ID = 'HLU01'            AND HOADON_ID is not NULL            AND vp.HUY = '0'                        union all            SELECT CHUNGTU_ID            FROM TT_CLSKETQUA_VTYT tt            INNER JOIN TT_VIENPHI vp on (tt.CLSKETQUA_VTYT_ID = vp.REF_ID and REF_TABLE = 'TT_CLSKETQUA_VTYT')            WHERE            CHUNGTU_ID = '137704'            AND tt.BENHVIEN_ID = 'HLU01'            AND HOADON_ID is not NULL            AND vp.HUY = '0']
2019-09-20 17:16:27,040 [1] DEBUG - Statement Id: [DAO00030_KTDaPhatSinhBienLai] PreparedStatement : [SELECT CHUNGTU_ID            FROM TT_NOITRU_TOATHUOC tt            INNER JOIN TT_VIENPHI vp on (tt.TOATHUOC_ID = vp.REF_ID and REF_TABLE = 'TT_NOITRU_TOATHUOC')            WHERE            CHUNGTU_ID = '137704'            AND tt.BENHVIEN_ID = 'HLU01'            AND HOADON_ID is not NULL            AND vp.HUY = '0'              union all            SELECT  kbtt.CHUNGTUPHATTHUOC_ID as CHUNGTU_ID            FROM TT_NGOAITRU_TOATHUOC tt            INNER JOIN TT_NGOAITRU_KHAMBENH_TOATHUOC kbtt on (kbtt.KHAMBENH_TOATHUOC_ID = tt.KHAMBENH_TOATHUOC_ID)            INNER JOIN TT_VIENPHI vp on (tt.TOATHUOC_ID = vp.REF_ID and REF_TABLE = 'TT_NGOAITRU_TOATHUOC')            WHERE            kbtt.CHUNGTUPHATTHUOC_ID = '137704'            AND tt.BENHVIEN_ID = 'HLU01'            AND HOADON_ID is not NULL            AND vp.HUY = '0'              union all            SELECT ctct.CHUNGTU_ID from            TT_DUOC_CHUNGTU_CHITIET ctct            INNER JOIN TT_HOADON_CHITIET_NGOAITRU hdct on (hdct.REF_ID = ctct.CHUNGTUCHITIET_ID and hdct.REF_TABLE = 'TT_DUOC_CHUNGTU_CHITIET')            INNER JOIN TT_HOADON hd on hd.HOADON_ID = hdct.HOADON_ID            WHERE            ctct.CHUNGTU_ID = '137704'                            AND hd.HUYHOADON = '0'              AND hd.HOANTRA = '0'                                  AND ctct.BENHVIEN_ID = 'HLU01'                        union all            SELECT CHUNGTU_ID            FROM TT_NGOAITRU_KHAMBENH_VTYT tt            INNER JOIN TT_VIENPHI vp on (tt.KHAMBENH_VTYT_ID = vp.REF_ID and REF_TABLE = 'TT_NGOAITRU_KHAMBENH_VTYT')            WHERE            CHUNGTU_ID = '137704'            AND tt.BENHVIEN_ID = 'HLU01'            AND HOADON_ID is not NULL            AND vp.HUY = '0'                        union all            SELECT CHUNGTU_ID            FROM TT_PHAUTHUAT_VTYT tt            INNER JOIN TT_VIENPHI vp on (tt.PHAUTHUAT_VTYT_ID = vp.REF_ID and REF_TABLE = 'TT_PHAUTHUAT_VTYT')            WHERE            CHUNGTU_ID = '137704'            AND tt.BENHVIEN_ID = 'HLU01'            AND HOADON_ID is not NULL            AND vp.HUY = '0'                        union all            SELECT CHUNGTU_ID            FROM TT_CLSKETQUA_VTYT tt            INNER JOIN TT_VIENPHI vp on (tt.CLSKETQUA_VTYT_ID = vp.REF_ID and REF_TABLE = 'TT_CLSKETQUA_VTYT')            WHERE            CHUNGTU_ID = '137704'            AND tt.BENHVIEN_ID = 'HLU01'            AND HOADON_ID is not NULL            AND vp.HUY = '0']
2019-09-20 17:16:27,327 [1] DEBUG - Statement Id: [DAO00030_KTDaPhatSinhPhieuBHTN] PreparedStatement : [SELECT vp.VIENPHI_ID              FROM TT_VIENPHI vp              INNER JOIN TT_MIENGIAM_CHITIET  mgct on mgct.VIENPHI_ID = vp.VIENPHI_ID              INNER JOIN TT_DUOC_CHUNGTU ct on ct.TIEPNHAN_ID = vp.TIEPNHAN_ID              WHERE              ct.CHUNGTU_ID = '137704'              AND vp.DUOC_ID is not null              AND vp.BENHVIEN_ID = 'HLU01']
2019-09-20 17:16:28,034 [1] DEBUG - Statement Id: [DAO00030_KiemTraBenhNhanXuatVien] PreparedStatement : [select              TT.TOATHUOC_ID              from              TT_NOITRU_TOATHUOC TT              inner join TT_NOITRU_KHAMBENH KB on TT.KHAMBENH_ID = KB.KHAMBENH_ID              inner join TT_NOITRU_BENHAN BA on BA.BENHAN_ID = KB.BENHAN_ID              WHERE              BA.TRANGTHAI = 'DAXUATVIEN'              AND TT.CHUNGTU_ID =  137704              and TT.BENHVIEN_ID = 'HLU01']
2019-09-20 17:16:28,223 [1] DEBUG - Statement Id: [DAO00030_KiemTraChungTuKhoaSo] PreparedStatement : [SELECT CHUNGTU_ID              FROM TT_DUOC_CHUNGTU              WHERE              MACHUNGTU = 'CS_KBX1319003092'              and BENHVIEN_ID = 'HLU01'              and              convert(date, NGAYCHUNGTU) <=              (              SELECT TOP 1 convert(date, KHOADENNGAY)              FROM TT_DUOC_KHOASOCHUNGTU              WHERE              KHODUOC_ID = '32'              and BENHVIEN_ID = 'HLU01'              AND KHOASO = '1'              ORDER BY KHOADENNGAY DESC              )]
2019-09-20 17:16:32,699 [1] DEBUG - Statement Id: [DAO00030_KiemTraChungTuKhoaSo] PreparedStatement : [SELECT CHUNGTU_ID              FROM TT_DUOC_CHUNGTU              WHERE              MACHUNGTU = 'CS_KBX1319003092'              and BENHVIEN_ID = 'HLU01'              and              convert(date, NGAYCHUNGTU) <=              (              SELECT TOP 1 convert(date, KHOADENNGAY)              FROM TT_DUOC_KHOASOCHUNGTU              WHERE              KHODUOC_ID = '32'              and BENHVIEN_ID = 'HLU01'              AND KHOASO = '1'              ORDER BY KHOADENNGAY DESC              )]
2019-09-20 17:16:33,024 [1] DEBUG - Statement Id: [DAO00030_KiemTraChungTuDaChuyenKeToan] PreparedStatement : [SELECT CHUNGTU_ID            FROM TT_DUOC_CHUNGTU            WHERE            CHUNGTU_ID = '137704'            and IDCHUYEN IS NOT NULL            and BENHVIEN_ID = 'HLU01']
2019-09-20 17:16:33,080 [1] DEBUG - Statement Id: [DAO00030_KTDaPhatSinhBienLai] PreparedStatement : [SELECT CHUNGTU_ID            FROM TT_NOITRU_TOATHUOC tt            INNER JOIN TT_VIENPHI vp on (tt.TOATHUOC_ID = vp.REF_ID and REF_TABLE = 'TT_NOITRU_TOATHUOC')            WHERE            CHUNGTU_ID = '137704'            AND tt.BENHVIEN_ID = 'HLU01'            AND HOADON_ID is not NULL            AND vp.HUY = '0'              union all            SELECT  kbtt.CHUNGTUPHATTHUOC_ID as CHUNGTU_ID            FROM TT_NGOAITRU_TOATHUOC tt            INNER JOIN TT_NGOAITRU_KHAMBENH_TOATHUOC kbtt on (kbtt.KHAMBENH_TOATHUOC_ID = tt.KHAMBENH_TOATHUOC_ID)            INNER JOIN TT_VIENPHI vp on (tt.TOATHUOC_ID = vp.REF_ID and REF_TABLE = 'TT_NGOAITRU_TOATHUOC')            WHERE            kbtt.CHUNGTUPHATTHUOC_ID = '137704'            AND tt.BENHVIEN_ID = 'HLU01'            AND HOADON_ID is not NULL            AND vp.HUY = '0'              union all            SELECT ctct.CHUNGTU_ID from            TT_DUOC_CHUNGTU_CHITIET ctct            INNER JOIN TT_HOADON_CHITIET_NGOAITRU hdct on (hdct.REF_ID = ctct.CHUNGTUCHITIET_ID and hdct.REF_TABLE = 'TT_DUOC_CHUNGTU_CHITIET')            INNER JOIN TT_HOADON hd on hd.HOADON_ID = hdct.HOADON_ID            WHERE            ctct.CHUNGTU_ID = '137704'                            AND hd.HUYHOADON = '0'              AND hd.HOANTRA = '0'                                  AND ctct.BENHVIEN_ID = 'HLU01'                        union all            SELECT CHUNGTU_ID            FROM TT_NGOAITRU_KHAMBENH_VTYT tt            INNER JOIN TT_VIENPHI vp on (tt.KHAMBENH_VTYT_ID = vp.REF_ID and REF_TABLE = 'TT_NGOAITRU_KHAMBENH_VTYT')            WHERE            CHUNGTU_ID = '137704'            AND tt.BENHVIEN_ID = 'HLU01'            AND HOADON_ID is not NULL            AND vp.HUY = '0'                        union all            SELECT CHUNGTU_ID            FROM TT_PHAUTHUAT_VTYT tt            INNER JOIN TT_VIENPHI vp on (tt.PHAUTHUAT_VTYT_ID = vp.REF_ID and REF_TABLE = 'TT_PHAUTHUAT_VTYT')            WHERE            CHUNGTU_ID = '137704'            AND tt.BENHVIEN_ID = 'HLU01'            AND HOADON_ID is not NULL            AND vp.HUY = '0'                        union all            SELECT CHUNGTU_ID            FROM TT_CLSKETQUA_VTYT tt            INNER JOIN TT_VIENPHI vp on (tt.CLSKETQUA_VTYT_ID = vp.REF_ID and REF_TABLE = 'TT_CLSKETQUA_VTYT')            WHERE            CHUNGTU_ID = '137704'            AND tt.BENHVIEN_ID = 'HLU01'            AND HOADON_ID is not NULL            AND vp.HUY = '0']
2019-09-20 17:16:33,389 [1] DEBUG - Statement Id: [DAO00030_KiemTraBenhNhanXuatVien] PreparedStatement : [select              TT.TOATHUOC_ID              from              TT_NOITRU_TOATHUOC TT              inner join TT_NOITRU_KHAMBENH KB on TT.KHAMBENH_ID = KB.KHAMBENH_ID              inner join TT_NOITRU_BENHAN BA on BA.BENHAN_ID = KB.BENHAN_ID              WHERE              BA.TRANGTHAI = 'DAXUATVIEN'              AND TT.CHUNGTU_ID =  137704              and TT.BENHVIEN_ID = 'HLU01']
2019-09-20 17:16:33,619 [1] DEBUG - Statement Id: [DAO00030_DUOCTONKHO_GetSoTonTheoDuocTheoLo] PreparedStatement : [SELECT              DUOC_ID,SOLONHAP_ID,              SUM(SOLUONG) AS SOLUONGTONLO              FROM              TT_DUOC_TONKHO              WHERE              KHODUOC_ID = '32'              and BENHVIEN_ID = 'HLU01'              and DUOC_ID IN (1)              and SOLONHAP_ID IN (7541)              GROUP BY DUOC_ID, SOLONHAP_ID]
2019-09-20 17:16:33,667 [1] DEBUG - Statement Id: [DAO00030_LayNgayKhoaSoCuoi] PreparedStatement : [SELECT TOP 1 KHOADENNGAY              FROM TT_DUOC_KHOASOCHUNGTU              WHERE              KHODUOC_ID = '32'              and BENHVIEN_ID = 'HLU01'              and KHOASO = '1'              ORDER BY KHOADENNGAY DESC]
2019-09-20 17:16:33,822 [1] DEBUG - Statement Id: [DAO00030_GetList] PreparedStatement : [select *              from TT_DUOC_CHUNGTU              where BENHVIEN_ID = 'HLU01'                and                   TT_DUOC_CHUNGTU.MACHUNGTU = 'CS_KBX1319003092'                               order by CHUNGTU_ID]
2019-09-20 17:16:34,098 [1] DEBUG - Statement Id: [DAO00030_KiemTraBenhNhanXuatVien] PreparedStatement : [select              TT.TOATHUOC_ID              from              TT_NOITRU_TOATHUOC TT              inner join TT_NOITRU_KHAMBENH KB on TT.KHAMBENH_ID = KB.KHAMBENH_ID              inner join TT_NOITRU_BENHAN BA on BA.BENHAN_ID = KB.BENHAN_ID              WHERE              BA.TRANGTHAI = 'DAXUATVIEN'              AND TT.CHUNGTU_ID =  137704              and TT.BENHVIEN_ID = 'HLU01']
2019-09-20 17:16:43,946 [1] DEBUG - Statement Id: [DAO00030_Update] PreparedStatement : [update TT_DUOC_CHUNGTU set              NGAYCHUNGTU =  @param0               , LOAICHUNGTU =  @param1               , MUCDICHCHUNGTU_ID =  @param2               , MUCDICHCHUNGTU_CODE =  @param3               , KHOXUAT_ID =  @param4               , NGUOIGIAO_ID =  @param5               , NGUOIGIAO =  @param6               , KHONHAP_ID =  @param7               , NGUOINHAN_ID =  @param8               , NGUOINHAN =  @param9               , NGUOIKIEMTRA_ID =  @param10               , NGUOIKIEMTRA =  @param11               , NGUOIDUYET_ID =  @param12               , NGUOIDUYET =  @param13               , PHUONGPHAPXUAT =  @param14               , KETOANTRUONG_ID =  @param15               , KETOANTRUONG =  @param16               , THUKHO_ID =  @param17               , THUKHO =  @param18               , MAUHOADON =  @param19               , SOHOADON =  @param20               , SOSERI =  @param21               , NGAYHOADON =  @param22               , DIENGIAI =  @param23               , GIATRI =  @param24               , GIATRITHANHTOAN =  @param25               , TYLEVAT =  @param26               , GIATRIVAT =  @param27               , THUESUAT =  @param28               , GIATRITHUE =  @param29               , TYLECHIETKHAU =  @param30               , GIATRICHIETKHAU =  @param31               , TIENTE_ID =  @param32               , TYGIA =  @param33               , SOCHUNGTUGOC =  @param34               , NGAYCHUNGTUGOC =  @param35               , NHACUNGCAP_ID =  @param36               , HINHTHUCTHANHTOAN_ID =  @param37               , NGUONDUOC_ID =  @param38               , CHUNGTULIENQUAN_ID =  @param39               , KHAMBENH_ID =  @param40               , TOATHUOCNOITRU_ID =  @param41               , TIEPNHAN_ID =  @param42               , BENHAN_ID =  @param43               , DANHANTHUOC =  @param44               , NGUOINHAP_ID =  @param45               , NGAYNHAP =  @param46               , TRANGTHAI =  @param47               , PHIEULINH_ID =  @param48               , LOAITOATHUOC =  @param49               , DIENGIAINGHIEPVUPHATSINH =  @param50               , DONVIGIAO_ID =  @param51               , KHOSUDUNG_ID =  @param52               , LOAIVATTU_ID =  @param53               , BENHNHAN_ID =  @param54               , TENBENHNHAN =  @param55               , BACSIGIOITHIEU_ID =  @param56               , DOITUONG_ID =  @param57               , IDCHUYEN =  @param58               , CHUNGTUKETOAN =  @param59               , STATUS =  @param60               , TRANSFER_VIENPHI_ID =  @param61               , PHONGBAN_ID =  @param62               , BACSI_ID =  @param63               , TKNO =  @param64               , TKCO =  @param65               , MACHUNGTUREF =  @param66               , LOAICHUNGTUREF =  @param67               , PHIEULINHCANTRU_ID =  @param68               , KHOTHUCHIEN_ID =  @param69               , KHODOIUNG_ID =  @param70               , MENU_LOAIDUOC_ID =  @param71               , NGUOISUDUNGMAY_ID =  @param72               , GOITHAU_ID =  @param73               , XUATTHUOCBANGOAITRU =  @param74               , NGAYGIOCHUNGTU =  @param75               , NOIDAKHAM =  @param76               , HOIDONGKIEMNHAP_ID =  @param77               , HOIDONGTHANHLY_ID =  @param78               , CHUYENCHUNGTUID =  @param79               , CHUYENDOANHTHUID =  @param80               , LYDOXUATSUDUNG_ID =  @param81                         , NGAYCAPNHAT =  @param82               , NGUOICAPNHAT_ID =  @param83               where              CHUNGTU_ID = '137704']
2019-09-20 17:16:43,949 [1] DEBUG - Statement Id: [DAO00030_Update] Parameters: [@param0=[NGAYCHUNGTU,9/20/2019 5:03:37 PM], @param1=[LOAICHUNGTU,X], @param2=[MUCDICHCHUNGTU_ID,1060], @param3=[MUCDICHCHUNGTU_CODE,X13], @param4=[KHOXUAT_ID,32], @param5=[NGUOIGIAO_ID,0], @param6=[NGUOIGIAO,null], @param7=[KHONHAP_ID,null], @param8=[NGUOINHAN_ID,null], @param9=[NGUOINHAN,null], @param10=[NGUOIKIEMTRA_ID,null], @param11=[NGUOIKIEMTRA,null], @param12=[NGUOIDUYET_ID,null], @param13=[NGUOIDUYET,null], @param14=[PHUONGPHAPXUAT,0], @param15=[KETOANTRUONG_ID,null], @param16=[KETOANTRUONG,null], @param17=[THUKHO_ID,null], @param18=[THUKHO,null], @param19=[MAUHOADON,null], @param20=[SOHOADON,null], @param21=[SOSERI,null], @param22=[NGAYHOADON,null], @param23=[DIENGIAI,null], @param24=[GIATRI,null], @param25=[GIATRITHANHTOAN,null], @param26=[TYLEVAT,5], @param27=[GIATRIVAT,0], @param28=[THUESUAT,null], @param29=[GIATRITHUE,null], @param30=[TYLECHIETKHAU,null], @param31=[GIATRICHIETKHAU,null], @param32=[TIENTE_ID,null], @param33=[TYGIA,null], @param34=[SOCHUNGTUGOC,null], @param35=[NGAYCHUNGTUGOC,null], @param36=[NHACUNGCAP_ID,null], @param37=[HINHTHUCTHANHTOAN_ID,null], @param38=[NGUONDUOC_ID,null], @param39=[CHUNGTULIENQUAN_ID,null], @param40=[KHAMBENH_ID,null], @param41=[TOATHUOCNOITRU_ID,null], @param42=[TIEPNHAN_ID,null], @param43=[BENHAN_ID,null], @param44=[DANHANTHUOC, ], @param45=[NGUOINHAP_ID,null], @param46=[NGAYNHAP,null], @param47=[TRANGTHAI,DAXUAT], @param48=[PHIEULINH_ID,null], @param49=[LOAITOATHUOC,null], @param50=[DIENGIAINGHIEPVUPHATSINH,null], @param51=[DONVIGIAO_ID,null], @param52=[KHOSUDUNG_ID,null], @param53=[LOAIVATTU_ID,null], @param54=[BENHNHAN_ID,null], @param55=[TENBENHNHAN,null], @param56=[BACSIGIOITHIEU_ID,null], @param57=[DOITUONG_ID,null], @param58=[IDCHUYEN,null], @param59=[CHUNGTUKETOAN,null], @param60=[STATUS,null], @param61=[TRANSFER_VIENPHI_ID,null], @param62=[PHONGBAN_ID,62], @param63=[BACSI_ID,null], @param64=[TKNO,null], @param65=[TKCO,null], @param66=[MACHUNGTUREF,null], @param67=[LOAICHUNGTUREF,null], @param68=[PHIEULINHCANTRU_ID,null], @param69=[KHOTHUCHIEN_ID,null], @param70=[KHODOIUNG_ID,null], @param71=[MENU_LOAIDUOC_ID,null], @param72=[NGUOISUDUNGMAY_ID,null], @param73=[GOITHAU_ID,null], @param74=[XUATTHUOCBANGOAITRU,null], @param75=[NGAYGIOCHUNGTU,null], @param76=[NOIDAKHAM,null], @param77=[HOIDONGKIEMNHAP_ID,null], @param78=[HOIDONGTHANHLY_ID,null], @param79=[CHUYENCHUNGTUID,null], @param80=[CHUYENDOANHTHUID,null], @param81=[LYDOXUATSUDUNG_ID,8294], @param82=[NGAYCAPNHAT,9/20/2019 5:16:43 PM], @param83=[NGUOICAPNHAT_ID,0]]
2019-09-20 17:16:43,949 [1] DEBUG - Statement Id: [DAO00030_Update] Types: [@param0=[DateTime, System.DateTime], @param1=[String, System.String], @param2=[Int64, System.Int64], @param3=[String, System.String], @param4=[Int64, System.Int64], @param5=[Int64, System.Int64], @param6=[System.DBNull, null], @param7=[System.DBNull, null], @param8=[System.DBNull, null], @param9=[System.DBNull, null], @param10=[System.DBNull, null], @param11=[System.DBNull, null], @param12=[System.DBNull, null], @param13=[System.DBNull, null], @param14=[Int64, System.Int64], @param15=[System.DBNull, null], @param16=[System.DBNull, null], @param17=[System.DBNull, null], @param18=[System.DBNull, null], @param19=[System.DBNull, null], @param20=[System.DBNull, null], @param21=[System.DBNull, null], @param22=[System.DBNull, null], @param23=[System.DBNull, null], @param24=[System.DBNull, null], @param25=[System.DBNull, null], @param26=[Double, System.Double], @param27=[Double, System.Double], @param28=[System.DBNull, null], @param29=[System.DBNull, null], @param30=[System.DBNull, null], @param31=[System.DBNull, null], @param32=[System.DBNull, null], @param33=[System.DBNull, null], @param34=[System.DBNull, null], @param35=[System.DBNull, null], @param36=[System.DBNull, null], @param37=[System.DBNull, null], @param38=[System.DBNull, null], @param39=[System.DBNull, null], @param40=[System.DBNull, null], @param41=[System.DBNull, null], @param42=[System.DBNull, null], @param43=[System.DBNull, null], @param44=[String, System.String], @param45=[System.DBNull, null], @param46=[System.DBNull, null], @param47=[String, System.String], @param48=[System.DBNull, null], @param49=[System.DBNull, null], @param50=[System.DBNull, null], @param51=[System.DBNull, null], @param52=[System.DBNull, null], @param53=[System.DBNull, null], @param54=[System.DBNull, null], @param55=[System.DBNull, null], @param56=[System.DBNull, null], @param57=[System.DBNull, null], @param58=[System.DBNull, null], @param59=[System.DBNull, null], @param60=[System.DBNull, null], @param61=[System.DBNull, null], @param62=[Int64, System.Int64], @param63=[System.DBNull, null], @param64=[System.DBNull, null], @param65=[System.DBNull, null], @param66=[System.DBNull, null], @param67=[System.DBNull, null], @param68=[System.DBNull, null], @param69=[System.DBNull, null], @param70=[System.DBNull, null], @param71=[System.DBNull, null], @param72=[System.DBNull, null], @param73=[System.DBNull, null], @param74=[System.DBNull, null], @param75=[System.DBNull, null], @param76=[System.DBNull, null], @param77=[System.DBNull, null], @param78=[System.DBNull, null], @param79=[System.DBNull, null], @param80=[System.DBNull, null], @param81=[Int64, System.Int64], @param82=[DateTime, System.DateTime], @param83=[Int64, System.Int64]]
2019-09-20 17:16:46,545 [1] DEBUG - Statement Id: [DAO00030_CHUNGTUCT_DeleteP] PreparedStatement : [delete from TT_DUOC_CHUNGTU_CHITIET               where                             TT_DUOC_CHUNGTU_CHITIET.CHUNGTU_ID = '137704']
2019-09-20 17:16:46,896 [1] DEBUG - Statement Id: [DAO00030_TT_DUOC_TONKHO_LOG_Add] PreparedStatement : [DECLARE @KHODUOC_ID int               DECLARE @TONTRUOC numeric(18, 4)               DECLARE @TONSAU numeric(18, 4)               DECLARE @SOLUONGNHAP numeric(18, 4)               DECLARE @SOLUONGXUAT numeric(18, 4)                              IF( @param0  = 'N')               BEGIN                SET @KHODUOC_ID =  @param1                END               ELSE               BEGIN                 SET @KHODUOC_ID =  @param2                END                              SELECT @TONTRUOC = SOLUONG FROM TT_DUOC_TONKHO WHERE KHODUOC_ID = @KHODUOC_ID  AND DUOC_ID =  @param3  AND SOLONHAP_ID =  @param4  AND NGUONDUOC_ID =  @param5                               IF( @param0  = 'N' AND  @param6  = 'ADD')               BEGIN                SET @TONSAU = ISNULL(@TONTRUOC,0) +  @param7                 SET @SOLUONGNHAP =  @param7                 SET @SOLUONGXUAT = 0               END               IF( @param0  = 'N' AND  @param6  = 'DEL')               BEGIN                SET @TONSAU = ISNULL(@TONTRUOC,0) -  @param7                 SET @SOLUONGXUAT =  @param7                 SET @SOLUONGNHAP = 0               END                                         IF( @param0  = 'X' AND  @param6  = 'ADD')               BEGIN                SET @TONSAU = ISNULL(@TONTRUOC,0) -  @param8                 SET @SOLUONGXUAT =  @param8                 SET @SOLUONGNHAP = 0               END               IF( @param0  = 'X' AND  @param6  = 'DEL')               BEGIN                SET @TONSAU = ISNULL(@TONTRUOC,0) +  @param8                 SET @SOLUONGNHAP =  @param8                 SET @SOLUONGXUAT = 0                             END                        insert into TT_DUOC_TONKHO_LOG (                           CHUNGTUCHITIET_ID              ,CHUNGTU_ID              ,MACHUNGTU              ,LOAICHUNGTU              ,MUCDICHCHUNGTU_CODE              ,KHONHAP_ID              ,KHOXUAT_ID              ,DUOC_ID              ,SOLONHAP_ID              ,NGUONDUOC_ID              ,SOLUONGNHAP              ,SOLUONGXUAT              ,DONGIAMUA              ,DONGIAVON              ,TYLE_VAT              ,DONGIAVONVAT              ,TONTRUOC              ,TONSAU              ,ACTION              ,BENHVIEN_ID              ,NGAYTAO              ,NGUOITAO_ID                          ) values (              @param9               , @param10               , @param11               , @param0               , @param12               , @param1               , @param2               , @param3               , @param4               , @param5               ,@SOLUONGNHAP              ,@SOLUONGXUAT              , @param13               , @param14               , @param15               , @param16               ,@TONTRUOC              ,@TONSAU              , @param6               , @param17               , @param18               , @param19               )]
2019-09-20 17:16:46,897 [1] DEBUG - Statement Id: [DAO00030_TT_DUOC_TONKHO_LOG_Add] Parameters: [@param0=[LOAICHUNGTU,X], @param1=[KHONHAP_ID,null], @param2=[KHOXUAT_ID,32], @param3=[DUOC_ID,1], @param4=[SOLONHAP_ID,7541], @param5=[NGUONDUOC_ID,1], @param6=[ACTION,DEL], @param7=[SOLUONGNHAP,0], @param8=[SOLUONGXUAT,2], @param9=[CHUNGTUCHITIET_ID,1299049], @param10=[CHUNGTU_ID,137704], @param11=[MACHUNGTU,CS_KBX1319003092], @param12=[MUCDICHCHUNGTU_CODE,X13], @param13=[DONGIAMUA,945], @param14=[DONGIAVON,945], @param15=[TYLE_VAT,0], @param16=[DONGIAVONVAT,945], @param17=[BENHVIEN_ID,HLU01], @param18=[NGAYTAO,9/20/2019 5:16:46 PM], @param19=[NGUOITAO_ID,0]]
2019-09-20 17:16:46,897 [1] DEBUG - Statement Id: [DAO00030_TT_DUOC_TONKHO_LOG_Add] Types: [@param0=[String, System.String], @param1=[System.DBNull, null], @param2=[Int64, System.Int64], @param3=[Int64, System.Int64], @param4=[Int64, System.Int64], @param5=[Int64, System.Int64], @param6=[String, System.String], @param7=[Decimal, System.Decimal], @param8=[Decimal, System.Decimal], @param9=[Int64, System.Int64], @param10=[Int64, System.Int64], @param11=[String, System.String], @param12=[String, System.String], @param13=[Decimal, System.Decimal], @param14=[Decimal, System.Decimal], @param15=[Double, System.Double], @param16=[Double, System.Double], @param17=[String, System.String], @param18=[DateTime, System.DateTime], @param19=[Int64, System.Int64]]
2019-09-20 17:16:47,709 [1] DEBUG - Statement Id: [DAO00030_DUOC_TONKHO_BOOKING_NGOAITRU_Tang] PreparedStatement : [update TT_DUOC_TONKHO_BOOK_NGOAITRU            set            SOLUONG = SOLUONG +  @param0             , NGUOICAPNHAT_ID =  @param1             , NGAYCAPNHAT = getdate()            where            REF_TABLE =  @param2             AND REF_ID =  @param3             AND KHODUOC_ID =  @param4             AND DUOC_ID =  @param5             AND SOLUONG = 0            AND BENHVIEN_ID = 'HLU01']
2019-09-20 17:16:47,709 [1] DEBUG - Statement Id: [DAO00030_DUOC_TONKHO_BOOKING_NGOAITRU_Tang] Parameters: [@param0=[SOLUONGTHAYDOI,2], @param1=[NGUOICAPNHAT_ID,0], @param2=[REF_TABLE,TT_NGOAITRU_KHAMBENH_VTYT], @param3=[REF_ID,10593], @param4=[KHODUOC_ID,32], @param5=[DUOC_ID,1]]
2019-09-20 17:16:47,709 [1] DEBUG - Statement Id: [DAO00030_DUOC_TONKHO_BOOKING_NGOAITRU_Tang] Types: [@param0=[Double, System.Double], @param1=[Int64, System.Int64], @param2=[String, System.String], @param3=[Int64, System.Int64], @param4=[Int64, System.Int64], @param5=[Int64, System.Int64]]
2019-09-20 17:16:47,800 [1] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoVaBookingCOM23UpdateRedis] PreparedStatement : [declare @NGUONDUOC_MACDINH varchar(5) = '0';        declare @TOAMUANGOAI int = 0;        select @NGUONDUOC_MACDINH = isnull(VALUE,0) from TM_SYS_APPSETTINGS where CODE = 'PHA_NGUONDUOC'        select @TOAMUANGOAI = isnull(VALUE,0) from TM_SYS_APPSETTINGS where CODE = 'OPD_TOAMUANGOAI_DUNGDANHMUC_DUOC'                if @TOAMUANGOAI = 1        begin        select  distinct '0' + '_' + LTRIM(d.DUOC_ID) + '_' + @NGUONDUOC_MACDINH as DUOC_KEY, 0 as PHAMVI_ID, @NGUONDUOC_MACDINH as NGUONDUOC_ID, null as TENNGUONDUOC, null as TINHTIEN, d.DUOC_ID, ld.MALOAIDUOC,        d.SOVISA,d.TYLE_VAT,d.COTOA, d.MADUOC, d.TENHANG, d.TENDUOCDAYDU, dvt.TENDONVITINH as DONVITINH, d.BHYT,        d.TENHOATCHAT, d.HAMLUONG, d.HANGSANXUAT, d.QUOCGIA, d.LOAIDUOC_ID, d.DUONGDUNG_ID, d.TINHTIEN_PTTT,        ten.TENDUOC, ten.TENDUOC_EN, ten.MAQUOCTE, ten.MAQUOCTEBT,        '' as BHYT_TEXT        , ld.LOAIVATTU_ID        , d.BENHVIEN_ID,        999999999 as SOLUONG, d.VTYT_PHANLOAI, d.PHAMVI, d.SUASOLUONGTONGHOP, d.MADUOCBV, d.DANGTRINHBAY        , TAMNGUNG = CASE WHEN d.TAMNGUNG = '1' THEN '1' ELSE '0' END        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        where d.DUOC_ID in (1)        union all        select  distinct tk.DUOC_KEY, LTRIM(tk.PHAMVI_ID) as PHAMVI_ID, tk.NGUONDUOC_ID, nh.TENNGUONDUOC, nh.TINHTIEN, d.DUOC_ID, ld.MALOAIDUOC,        d.SOVISA,d.TYLE_VAT,d.COTOA, d.MADUOC, d.TENHANG, d.TENDUOCDAYDU, dvt.TENDONVITINH as DONVITINH, d.BHYT,        d.TENHOATCHAT, d.HAMLUONG, d.HANGSANXUAT, d.QUOCGIA, d.LOAIDUOC_ID, d.DUONGDUNG_ID, d.TINHTIEN_PTTT,        ten.TENDUOC, ten.TENDUOC_EN, ten.MAQUOCTE, ten.MAQUOCTEBT,        CASE WHEN d.BHYT = '1' THEN 'BHYT' ELSE '' END as BHYT_TEXT        , ld.LOAIVATTU_ID        , d.BENHVIEN_ID,        tk.SOLUONG, d.VTYT_PHANLOAI, d.PHAMVI, d.SUASOLUONGTONGHOP, d.MADUOCBV, d.DANGTRINHBAY        , TAMNGUNG = CASE WHEN d.TAMNGUNG = '1' OR nh.TAMNGUNG = '1' OR kd.TAMNGUNG = '1' THEN '1' ELSE '0' END        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        inner join        (        select  LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')) DUOC_KEY, (SUM(dtk.SOLUONG) - isnull(sum(A.SOLUONG),0) - isnull(sum(B.SOLUONG),0)) SOLUONG, pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        from (select sum(soluong) soluong,duoc_id,nguonduoc_id,khoduoc_id,benhvien_id from TT_DUOC_TONKHO  group by duoc_id,nguonduoc_id,khoduoc_id,benhvien_id) dtk        inner join TM_DUOC_PHAMVISD_MAPPING pvsd on dtk.KHODUOC_ID = pvsd.KHODUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NOITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) B on B.DUOC_ID = dtk.DUOC_ID and B.SOLUONG > 0 and B.PHAMVI_ID = pvsd.PHAMVI_ID and B.NGUONHANG_ID = dtk.NGUONDUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NGOAITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) A on A.DUOC_ID = dtk.DUOC_ID and A.SOLUONG > 0 and A.PHAMVI_ID = pvsd.PHAMVI_ID and A.NGUONHANG_ID = dtk.NGUONDUOC_ID        where dtk.SOLUONG > 0 and dtk.BENHVIEN_ID = 'HLU01'        group by LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')), pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        ) tk on tk.DUOC_ID = d.DUOC_ID        left join TM_DUOC_PHAMVISUDUNG kd on kd.PHAMVI_ID = tk.PHAMVI_ID and kd.BENHVIEN_ID = 'HLU01'        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = tk.NGUONDUOC_ID and nh.BENHVIEN_ID = 'HLU01'        where  d.BENHVIEN_ID = 'HLU01' and d.DUOC_ID in (1)        end        else        begin        select  distinct tk.DUOC_KEY, LTRIM(tk.PHAMVI_ID) as PHAMVI_ID, tk.NGUONDUOC_ID, nh.TENNGUONDUOC, nh.TINHTIEN, d.DUOC_ID, ld.MALOAIDUOC,        d.SOVISA,d.TYLE_VAT,d.COTOA, d.MADUOC, d.TENHANG, d.TENDUOCDAYDU, dvt.TENDONVITINH as DONVITINH, d.BHYT,        d.TENHOATCHAT, d.HAMLUONG, d.HANGSANXUAT, d.QUOCGIA, d.LOAIDUOC_ID, d.DUONGDUNG_ID, d.TINHTIEN_PTTT,        ten.TENDUOC, ten.TENDUOC_EN, ten.MAQUOCTE, ten.MAQUOCTEBT,        CASE WHEN d.BHYT = '1' THEN 'BHYT' ELSE '' END as BHYT_TEXT        , ld.LOAIVATTU_ID        , d.BENHVIEN_ID,        tk.SOLUONG, d.VTYT_PHANLOAI, d.PHAMVI, d.SUASOLUONGTONGHOP, d.MADUOCBV, d.DANGTRINHBAY        , TAMNGUNG = CASE WHEN d.TAMNGUNG = '1' OR nh.TAMNGUNG = '1' OR kd.TAMNGUNG = '1' THEN '1' ELSE '0' END        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        inner join        (        select  LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')) DUOC_KEY, (SUM(dtk.SOLUONG) - isnull(sum(A.SOLUONG),0) - isnull(sum(B.SOLUONG),0)) SOLUONG, pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        from (select sum(soluong) soluong,duoc_id,nguonduoc_id,khoduoc_id,benhvien_id from TT_DUOC_TONKHO  group by duoc_id,nguonduoc_id,khoduoc_id,benhvien_id) dtk        inner join TM_DUOC_PHAMVISD_MAPPING pvsd on dtk.KHODUOC_ID = pvsd.KHODUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NOITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) B on B.DUOC_ID = dtk.DUOC_ID and B.SOLUONG > 0 and B.PHAMVI_ID = pvsd.PHAMVI_ID and B.NGUONHANG_ID = dtk.NGUONDUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NGOAITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) A on A.DUOC_ID = dtk.DUOC_ID and A.SOLUONG > 0 and A.PHAMVI_ID = pvsd.PHAMVI_ID and A.NGUONHANG_ID = dtk.NGUONDUOC_ID        where dtk.SOLUONG > 0 and dtk.BENHVIEN_ID = 'HLU01'        group by LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')), pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        ) tk on tk.DUOC_ID = d.DUOC_ID        left join TM_DUOC_PHAMVISUDUNG kd on kd.PHAMVI_ID = tk.PHAMVI_ID and kd.BENHVIEN_ID = 'HLU01'        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = tk.NGUONDUOC_ID and nh.BENHVIEN_ID = 'HLU01'        where  d.BENHVIEN_ID = 'HLU01' and d.DUOC_ID in (1)        end]
2019-09-20 17:16:48,167 [1] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoCOM18UpdateRedis] PreparedStatement : [select distinct TT_TONKHO.DUOC_KEY, LTRIM(TT_TONKHO.KHODUOC_ID) as KHODUOC_ID, TM_DUOC.DUOC_ID, TM_LOAIDUOC.MALOAIDUOC,TM_DUOC.SOVISA,TM_DUOC.TYLE_VAT,TM_DUOC.COTOA,        TM_DUOC.MADUOC, TM_DUOC.TENHANG, TM_DUOC.TENDUOCDAYDU, dvt.TENDONVITINH as DONVITINH,  TM_DUOC.DONVITINH_ID,TM_DUOC.BHYT,        TM_DUOC.TENHOATCHAT,        TM_DUOC.HAMLUONG, TM_DUOC.HANGSANXUAT, TM_DUOC.QUOCGIA, TM_DUOC.LOAIDUOC_ID, TM_DUOC.DUONGDUNG_ID,        TM_TENDUOC.TENDUOC, TM_TENDUOC.TENDUOC_EN, TM_TENDUOC.MAQUOCTE, TM_TENDUOC.MAQUOCTEBT,        TM_LOAIDUOC.LOAIVATTU_ID, TM_DUOC.BENHVIEN_ID,        TT_TONKHO.SOLUONG, TM_DUOC.VTYT_PHANLOAI, TM_DUOC.PHAMVI, TT_TONKHO.NGUONDUOC_ID, NG.TENNGUONDUOC AS TENNGUONDUOC        , TAMNGUNG = CASE WHEN TM_DUOC.TAMNGUNG = '1' OR NG.TAMNGUNG = '1' OR KD.TAMNGUNG = '1' THEN '1' ELSE '0' END        , TM_DUOC.DANGTRINHBAY        from TM_DUOC        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = TM_DUOC.DONVITINH_ID        left join TM_TENDUOC on TM_DUOC.TENDUOC_ID = TM_TENDUOC.TENDUOC_ID and TM_DUOC.BENHVIEN_ID = 'HLU01' and TM_DUOC.TAMNGUNG = '0'        left join TM_LOAIDUOC on TM_LOAIDUOC.LOAIDUOC_ID = TM_DUOC.LOAIDUOC_ID and TM_LOAIDUOC.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG on (TM_LOAIDUOC.LOAIVATTU_ID = TM_DUOC_HANDUNG.LOAIDUOC and TM_DUOC_HANDUNG.BENHVIEN_ID = 'HLU01')        inner join        (select LTRIM(A.KHODUOC_ID) + '_' + LTRIM(A.DUOC_ID) + '_' + LTRIM(ISNULL(A.NGUONDUOC_ID,'')) as DUOC_KEY, A.KHODUOC_ID, A.DUOC_ID, A.NGUONDUOC_ID,        SUM(isnull(A.SOLUONG,0)) as SOLUONG        from        (select SUM(SOLUONG) as SOLUONG, KHODUOC_ID, DUOC_ID, NGUONDUOC_ID from TT_DUOC_TONKHO        where BENHVIEN_ID = 'HLU01' group by KHODUOC_ID, DUOC_ID, NGUONDUOC_ID) A        group by LTRIM(A.KHODUOC_ID) + '_' + LTRIM(A.DUOC_ID) + '_' + LTRIM(ISNULL(A.NGUONDUOC_ID,'')), A.KHODUOC_ID, A.DUOC_ID, NGUONDUOC_ID        ) TT_TONKHO on TT_TONKHO.DUOC_ID = TM_DUOC.DUOC_ID        LEFT JOIN TM_NGUONHANG NG ON NG.NGUONDUOC_ID = TT_TONKHO.NGUONDUOC_ID        LEFT JOIN TM_KHODUOC KD ON KD.KHODUOC_ID = TT_TONKHO.KHODUOC_ID        where TM_DUOC.BENHVIEN_ID = 'HLU01' and TT_TONKHO.SOLUONG >= 0        and TM_DUOC.DUOC_ID in (1)]
2019-09-20 17:16:50,469 [1] DEBUG - Statement Id: [DAO00030_DUOCTONKHO_Tang] PreparedStatement : [IF EXISTS            (              SELECT DUOCTONKHO_ID              FROM TT_DUOC_TONKHO              WHERE              KHODUOC_ID =  @param0               AND DUOC_ID =  @param1               AND  SOLONHAP_ID =  @param2             )            BEGIN              update TT_DUOC_TONKHO set              SOLUONG = SOLUONG +   @param3               , NGAYCAPNHAT =  @param4               , NGUOICAPNHAT_ID =  @param5               where              KHODUOC_ID =  @param0               AND DUOC_ID =  @param1               AND  SOLONHAP_ID =  @param2             END            ELSE            BEGIN              insert into TT_DUOC_TONKHO (              KHODUOC_ID              , DUOC_ID              , NGUONDUOC_ID              , SOLONHAP_ID              , DONGIAMUA              , SOLUONG              , BENHVIEN_ID              , NGAYTAO              , NGUOITAO_ID                     ) values (               @param0               ,  @param1               ,  @param6               ,  @param2               ,  @param7               ,  @param3               ,  @param8               ,  @param9               ,  @param10                        )            END]
2019-09-20 17:16:50,470 [1] DEBUG - Statement Id: [DAO00030_DUOCTONKHO_Tang] Parameters: [@param0=[KHODUOC_ID,32], @param1=[DUOC_ID,1], @param2=[SOLONHAP_ID,7541], @param3=[SOLUONGTHAYDOI,2], @param4=[NGAYCAPNHAT,9/20/2019 5:16:50 PM], @param5=[NGUOICAPNHAT_ID,0], @param6=[NGUONDUOC_ID,1], @param7=[DONGIAMUA,945], @param8=[BENHVIEN_ID,HLU01], @param9=[NGAYTAO,9/20/2019 5:03:37 PM], @param10=[NGUOITAO_ID,0]]
2019-09-20 17:16:50,470 [1] DEBUG - Statement Id: [DAO00030_DUOCTONKHO_Tang] Types: [@param0=[Int64, System.Int64], @param1=[Int64, System.Int64], @param2=[Int64, System.Int64], @param3=[Double, System.Double], @param4=[DateTime, System.DateTime], @param5=[Int64, System.Int64], @param6=[Int64, System.Int64], @param7=[Double, System.Double], @param8=[String, System.String], @param9=[DateTime, System.DateTime], @param10=[Int64, System.Int64]]
2019-09-20 17:16:51,686 [1] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoCOM18] PreparedStatement : [select  distinct TT_TONKHO.DUOC_KEY, LTRIM(TT_TONKHO.KHODUOC_ID) as KHODUOC_ID, TM_DUOC.DUOC_ID, TM_LOAIDUOC.MALOAIDUOC,TM_DUOC.SOVISA,TM_DUOC.TYLE_VAT,TM_DUOC.COTOA,        TM_DUOC.MADUOC, TM_DUOC.TENHANG, TM_DUOC.TENDUOCDAYDU, dvt.TENDONVITINH as DONVITINH, TM_DUOC.DONVITINH_ID, TM_DUOC.BHYT,        TM_DUOC.TENHOATCHAT, TM_DUOC.HAMLUONG, TM_DUOC.HANGSANXUAT, TM_DUOC.QUOCGIA, TM_DUOC.LOAIDUOC_ID, TM_DUOC.DUONGDUNG_ID,        TM_TENDUOC.TENDUOC, TM_TENDUOC.TENDUOC_EN, TM_TENDUOC.MAQUOCTE, TM_TENDUOC.MAQUOCTEBT,        TM_LOAIDUOC.LOAIVATTU_ID, TM_DUOC.BENHVIEN_ID,        TT_TONKHO.SOLUONG, TM_DUOC.VTYT_PHANLOAI, TM_DUOC.PHAMVI, TT_TONKHO.NGUONDUOC_ID, NG.TENNGUONDUOC        , TAMNGUNG = CASE WHEN TM_DUOC.TAMNGUNG = '1' OR NG.TAMNGUNG = '1' OR KD.TAMNGUNG = '1' THEN '1' ELSE '0' END        , TM_DUOC.DANGTRINHBAY        from TM_DUOC        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = TM_DUOC.DONVITINH_ID        left join TM_TENDUOC on TM_DUOC.TENDUOC_ID = TM_TENDUOC.TENDUOC_ID and TM_DUOC.BENHVIEN_ID = 'HLU01'  and TM_DUOC.TAMNGUNG = '0'        left join TM_LOAIDUOC on TM_LOAIDUOC.LOAIDUOC_ID = TM_DUOC.LOAIDUOC_ID and TM_LOAIDUOC.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG on (TM_LOAIDUOC.LOAIVATTU_ID = TM_DUOC_HANDUNG.LOAIDUOC and TM_DUOC_HANDUNG.BENHVIEN_ID = 'HLU01')        inner join        (select LTRIM(A.KHODUOC_ID) + '_' + LTRIM(A.DUOC_ID) + '_' + LTRIM(ISNULL(A.NGUONDUOC_ID,'')) as DUOC_KEY, A.KHODUOC_ID, A.DUOC_ID ,a.NGUONDUOC_ID,        SUM(isnull(A.SOLUONG,0)) as SOLUONG        from        (select SUM(SOLUONG) as SOLUONG, KHODUOC_ID, DUOC_ID, NGUONDUOC_ID from TT_DUOC_TONKHO        where KHODUOC_ID in (32) and DUOC_ID in (1) group by KHODUOC_ID, DUOC_ID, NGUONDUOC_ID        ) A        where A.KHODUOC_ID in (32) and A.DUOC_ID in (1)        group by LTRIM(A.KHODUOC_ID) + '_' + LTRIM(A.DUOC_ID) + '_' + LTRIM(A.NGUONDUOC_ID), A.KHODUOC_ID, A.DUOC_ID, A.NGUONDUOC_ID)        TT_TONKHO on TT_TONKHO.DUOC_ID = TM_DUOC.DUOC_ID        LEFT JOIN TM_NGUONHANG NG ON NG.NGUONDUOC_ID = TT_TONKHO.NGUONDUOC_ID        LEFT JOIN TM_KHODUOC KD ON KD.KHODUOC_ID = TT_TONKHO.KHODUOC_ID        where TM_DUOC.BENHVIEN_ID = 'HLU01' and TM_DUOC.DUOC_ID in (1)]
2019-09-20 17:16:51,982 [1] DEBUG - Statement Id: [DAO00030_GetListPhamViByKhoDuoc] PreparedStatement : [SELECT DISTINCT PHAMVI_ID          FROM TM_DUOC_PHAMVISD_MAPPING          WHERE          KHODUOC_ID IN (32)          AND BENHVIEN_ID ='HLU01'          AND TAMNGUNG = '0']
2019-09-20 17:16:52,064 [1] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoVaBookingCOM23] PreparedStatement : [declare @NGUONDUOC_MACDINH varchar(5) = '0';        declare @TOAMUANGOAI int = 0;        select @NGUONDUOC_MACDINH = isnull(VALUE,0) from TM_SYS_APPSETTINGS where CODE = 'PHA_NGUONDUOC'        select @TOAMUANGOAI = isnull(VALUE,0) from TM_SYS_APPSETTINGS where CODE = 'OPD_TOAMUANGOAI_DUNGDANHMUC_DUOC'                if @TOAMUANGOAI = 1        begin        select  distinct '0' + '_' + LTRIM(d.DUOC_ID) + '_' + @NGUONDUOC_MACDINH as DUOC_KEY, 0 as PHAMVI_ID, @NGUONDUOC_MACDINH as NGUONDUOC_ID, null as TENNGUONDUOC, null as TINHTIEN, d.DUOC_ID, ld.MALOAIDUOC,        d.SOVISA,d.TYLE_VAT,d.COTOA, d.MADUOC, d.TENHANG, d.TENDUOCDAYDU, dvt.TENDONVITINH as DONVITINH, d.BHYT,        d.TENHOATCHAT, d.HAMLUONG, d.HANGSANXUAT, d.QUOCGIA, d.LOAIDUOC_ID, d.DUONGDUNG_ID, d.TINHTIEN_PTTT,        ten.TENDUOC, ten.TENDUOC_EN, ten.MAQUOCTE, ten.MAQUOCTEBT,        '' as BHYT_TEXT        , ld.LOAIVATTU_ID        , d.BENHVIEN_ID,        999999999 as SOLUONG, d.VTYT_PHANLOAI, d.PHAMVI, d.SUASOLUONGTONGHOP, d.MADUOCBV, d.DANGTRINHBAY        , TAMNGUNG = CASE WHEN d.TAMNGUNG = '1' THEN '1' ELSE '0' END        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        where d.DUOC_ID in (1)        union all        select  distinct tk.DUOC_KEY, LTRIM(tk.PHAMVI_ID) as PHAMVI_ID, tk.NGUONDUOC_ID, nh.TENNGUONDUOC, nh.TINHTIEN, d.DUOC_ID, ld.MALOAIDUOC,        d.SOVISA,d.TYLE_VAT,d.COTOA, d.MADUOC, d.TENHANG, d.TENDUOCDAYDU, dvt.TENDONVITINH as DONVITINH, d.BHYT,        d.TENHOATCHAT, d.HAMLUONG, d.HANGSANXUAT, d.QUOCGIA, d.LOAIDUOC_ID, d.DUONGDUNG_ID, d.TINHTIEN_PTTT,        ten.TENDUOC, ten.TENDUOC_EN, ten.MAQUOCTE, ten.MAQUOCTEBT,        CASE WHEN d.BHYT = '1' THEN 'BHYT' ELSE '' END as BHYT_TEXT        , ld.LOAIVATTU_ID        , d.BENHVIEN_ID,        tk.SOLUONG, d.VTYT_PHANLOAI, d.PHAMVI, d.SUASOLUONGTONGHOP, d.MADUOCBV, d.DANGTRINHBAY        , TAMNGUNG = CASE WHEN d.TAMNGUNG = '1' OR nh.TAMNGUNG = '1' OR kd.TAMNGUNG = '1' THEN '1' ELSE '0' END        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        inner join        (        select  LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')) DUOC_KEY, (SUM(dtk.SOLUONG) - isnull(sum(A.SOLUONG),0) - isnull(sum(B.SOLUONG),0)) SOLUONG, pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        from (select sum(soluong) soluong,duoc_id,nguonduoc_id,khoduoc_id,benhvien_id from TT_DUOC_TONKHO  group by duoc_id,nguonduoc_id,khoduoc_id,benhvien_id) dtk        inner join TM_DUOC_PHAMVISD_MAPPING pvsd on dtk.KHODUOC_ID = pvsd.KHODUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NOITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) B on B.DUOC_ID = dtk.DUOC_ID and B.SOLUONG > 0 and B.PHAMVI_ID = pvsd.PHAMVI_ID and B.NGUONHANG_ID = dtk.NGUONDUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NGOAITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) A on A.DUOC_ID = dtk.DUOC_ID and A.SOLUONG > 0 and A.PHAMVI_ID = pvsd.PHAMVI_ID and A.NGUONHANG_ID = dtk.NGUONDUOC_ID        where dtk.SOLUONG > 0 and dtk.BENHVIEN_ID = 'HLU01'        group by LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')), pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        ) tk on tk.DUOC_ID = d.DUOC_ID        left join TM_DUOC_PHAMVISUDUNG kd on kd.PHAMVI_ID = tk.PHAMVI_ID and kd.BENHVIEN_ID = 'HLU01'        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = tk.NGUONDUOC_ID and nh.BENHVIEN_ID = 'HLU01'        where  d.BENHVIEN_ID = 'HLU01' and d.DUOC_ID in (1) and TK.PHAMVI_ID in (1055)        and tk.NGUONDUOC_ID in (1)         end        else        begin                select  distinct tk.DUOC_KEY, LTRIM(tk.PHAMVI_ID) as PHAMVI_ID, tk.NGUONDUOC_ID, nh.TENNGUONDUOC, nh.TINHTIEN, d.DUOC_ID, ld.MALOAIDUOC,        d.SOVISA,d.TYLE_VAT,d.COTOA, d.MADUOC, d.TENHANG, d.TENDUOCDAYDU, dvt.TENDONVITINH as DONVITINH, d.BHYT,        d.TENHOATCHAT, d.HAMLUONG, d.HANGSANXUAT, d.QUOCGIA, d.LOAIDUOC_ID, d.DUONGDUNG_ID, d.TINHTIEN_PTTT,        ten.TENDUOC, ten.TENDUOC_EN, ten.MAQUOCTE, ten.MAQUOCTEBT,        CASE WHEN d.BHYT = '1' THEN 'BHYT' ELSE '' END as BHYT_TEXT        , ld.LOAIVATTU_ID        , d.BENHVIEN_ID,        tk.SOLUONG, d.VTYT_PHANLOAI, d.PHAMVI, d.SUASOLUONGTONGHOP, d.MADUOCBV, d.DANGTRINHBAY        , TAMNGUNG = CASE WHEN d.TAMNGUNG = '1' OR nh.TAMNGUNG = '1' OR kd.TAMNGUNG = '1' THEN '1' ELSE '0' END        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        inner join        (        select  LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')) DUOC_KEY, (SUM(dtk.SOLUONG) - isnull(sum(A.SOLUONG),0) - isnull(sum(B.SOLUONG),0)) SOLUONG, pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        from (select sum(soluong) soluong,duoc_id,nguonduoc_id,khoduoc_id,benhvien_id from TT_DUOC_TONKHO  group by duoc_id,nguonduoc_id,khoduoc_id,benhvien_id) dtk        inner join TM_DUOC_PHAMVISD_MAPPING pvsd on dtk.KHODUOC_ID = pvsd.KHODUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NOITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) B on B.DUOC_ID = dtk.DUOC_ID and B.SOLUONG > 0 and B.PHAMVI_ID = pvsd.PHAMVI_ID and B.NGUONHANG_ID = dtk.NGUONDUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NGOAITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) A on A.DUOC_ID = dtk.DUOC_ID and A.SOLUONG > 0 and A.PHAMVI_ID = pvsd.PHAMVI_ID and A.NGUONHANG_ID = dtk.NGUONDUOC_ID        where dtk.SOLUONG > 0 and dtk.BENHVIEN_ID = 'HLU01'        group by LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')), pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        ) tk on tk.DUOC_ID = d.DUOC_ID        left join TM_DUOC_PHAMVISUDUNG kd on kd.PHAMVI_ID = tk.PHAMVI_ID and kd.BENHVIEN_ID = 'HLU01'        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = tk.NGUONDUOC_ID and nh.BENHVIEN_ID = 'HLU01'        where  d.BENHVIEN_ID = 'HLU01' and d.DUOC_ID in (1) and TK.PHAMVI_ID in (1055)        and tk.NGUONDUOC_ID in (1)         end]
2019-09-20 17:16:52,306 [1] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoCOM18UpdateRedis] PreparedStatement : [select distinct TT_TONKHO.DUOC_KEY, LTRIM(TT_TONKHO.KHODUOC_ID) as KHODUOC_ID, TM_DUOC.DUOC_ID, TM_LOAIDUOC.MALOAIDUOC,TM_DUOC.SOVISA,TM_DUOC.TYLE_VAT,TM_DUOC.COTOA,        TM_DUOC.MADUOC, TM_DUOC.TENHANG, TM_DUOC.TENDUOCDAYDU, dvt.TENDONVITINH as DONVITINH,  TM_DUOC.DONVITINH_ID,TM_DUOC.BHYT,        TM_DUOC.TENHOATCHAT,        TM_DUOC.HAMLUONG, TM_DUOC.HANGSANXUAT, TM_DUOC.QUOCGIA, TM_DUOC.LOAIDUOC_ID, TM_DUOC.DUONGDUNG_ID,        TM_TENDUOC.TENDUOC, TM_TENDUOC.TENDUOC_EN, TM_TENDUOC.MAQUOCTE, TM_TENDUOC.MAQUOCTEBT,        TM_LOAIDUOC.LOAIVATTU_ID, TM_DUOC.BENHVIEN_ID,        TT_TONKHO.SOLUONG, TM_DUOC.VTYT_PHANLOAI, TM_DUOC.PHAMVI, TT_TONKHO.NGUONDUOC_ID, NG.TENNGUONDUOC AS TENNGUONDUOC        , TAMNGUNG = CASE WHEN TM_DUOC.TAMNGUNG = '1' OR NG.TAMNGUNG = '1' OR KD.TAMNGUNG = '1' THEN '1' ELSE '0' END        , TM_DUOC.DANGTRINHBAY        from TM_DUOC        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = TM_DUOC.DONVITINH_ID        left join TM_TENDUOC on TM_DUOC.TENDUOC_ID = TM_TENDUOC.TENDUOC_ID and TM_DUOC.BENHVIEN_ID = 'HLU01' and TM_DUOC.TAMNGUNG = '0'        left join TM_LOAIDUOC on TM_LOAIDUOC.LOAIDUOC_ID = TM_DUOC.LOAIDUOC_ID and TM_LOAIDUOC.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG on (TM_LOAIDUOC.LOAIVATTU_ID = TM_DUOC_HANDUNG.LOAIDUOC and TM_DUOC_HANDUNG.BENHVIEN_ID = 'HLU01')        inner join        (select LTRIM(A.KHODUOC_ID) + '_' + LTRIM(A.DUOC_ID) + '_' + LTRIM(ISNULL(A.NGUONDUOC_ID,'')) as DUOC_KEY, A.KHODUOC_ID, A.DUOC_ID, A.NGUONDUOC_ID,        SUM(isnull(A.SOLUONG,0)) as SOLUONG        from        (select SUM(SOLUONG) as SOLUONG, KHODUOC_ID, DUOC_ID, NGUONDUOC_ID from TT_DUOC_TONKHO        where BENHVIEN_ID = 'HLU01' group by KHODUOC_ID, DUOC_ID, NGUONDUOC_ID) A        group by LTRIM(A.KHODUOC_ID) + '_' + LTRIM(A.DUOC_ID) + '_' + LTRIM(ISNULL(A.NGUONDUOC_ID,'')), A.KHODUOC_ID, A.DUOC_ID, NGUONDUOC_ID        ) TT_TONKHO on TT_TONKHO.DUOC_ID = TM_DUOC.DUOC_ID        LEFT JOIN TM_NGUONHANG NG ON NG.NGUONDUOC_ID = TT_TONKHO.NGUONDUOC_ID        LEFT JOIN TM_KHODUOC KD ON KD.KHODUOC_ID = TT_TONKHO.KHODUOC_ID        where TM_DUOC.BENHVIEN_ID = 'HLU01' and TT_TONKHO.SOLUONG >= 0        and TM_DUOC.DUOC_ID in (1)]
2019-09-20 17:16:52,483 [1] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoVaBookingCOM23UpdateRedis] PreparedStatement : [declare @NGUONDUOC_MACDINH varchar(5) = '0';        declare @TOAMUANGOAI int = 0;        select @NGUONDUOC_MACDINH = isnull(VALUE,0) from TM_SYS_APPSETTINGS where CODE = 'PHA_NGUONDUOC'        select @TOAMUANGOAI = isnull(VALUE,0) from TM_SYS_APPSETTINGS where CODE = 'OPD_TOAMUANGOAI_DUNGDANHMUC_DUOC'                if @TOAMUANGOAI = 1        begin        select  distinct '0' + '_' + LTRIM(d.DUOC_ID) + '_' + @NGUONDUOC_MACDINH as DUOC_KEY, 0 as PHAMVI_ID, @NGUONDUOC_MACDINH as NGUONDUOC_ID, null as TENNGUONDUOC, null as TINHTIEN, d.DUOC_ID, ld.MALOAIDUOC,        d.SOVISA,d.TYLE_VAT,d.COTOA, d.MADUOC, d.TENHANG, d.TENDUOCDAYDU, dvt.TENDONVITINH as DONVITINH, d.BHYT,        d.TENHOATCHAT, d.HAMLUONG, d.HANGSANXUAT, d.QUOCGIA, d.LOAIDUOC_ID, d.DUONGDUNG_ID, d.TINHTIEN_PTTT,        ten.TENDUOC, ten.TENDUOC_EN, ten.MAQUOCTE, ten.MAQUOCTEBT,        '' as BHYT_TEXT        , ld.LOAIVATTU_ID        , d.BENHVIEN_ID,        999999999 as SOLUONG, d.VTYT_PHANLOAI, d.PHAMVI, d.SUASOLUONGTONGHOP, d.MADUOCBV, d.DANGTRINHBAY        , TAMNGUNG = CASE WHEN d.TAMNGUNG = '1' THEN '1' ELSE '0' END        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        where d.DUOC_ID in (1)        union all        select  distinct tk.DUOC_KEY, LTRIM(tk.PHAMVI_ID) as PHAMVI_ID, tk.NGUONDUOC_ID, nh.TENNGUONDUOC, nh.TINHTIEN, d.DUOC_ID, ld.MALOAIDUOC,        d.SOVISA,d.TYLE_VAT,d.COTOA, d.MADUOC, d.TENHANG, d.TENDUOCDAYDU, dvt.TENDONVITINH as DONVITINH, d.BHYT,        d.TENHOATCHAT, d.HAMLUONG, d.HANGSANXUAT, d.QUOCGIA, d.LOAIDUOC_ID, d.DUONGDUNG_ID, d.TINHTIEN_PTTT,        ten.TENDUOC, ten.TENDUOC_EN, ten.MAQUOCTE, ten.MAQUOCTEBT,        CASE WHEN d.BHYT = '1' THEN 'BHYT' ELSE '' END as BHYT_TEXT        , ld.LOAIVATTU_ID        , d.BENHVIEN_ID,        tk.SOLUONG, d.VTYT_PHANLOAI, d.PHAMVI, d.SUASOLUONGTONGHOP, d.MADUOCBV, d.DANGTRINHBAY        , TAMNGUNG = CASE WHEN d.TAMNGUNG = '1' OR nh.TAMNGUNG = '1' OR kd.TAMNGUNG = '1' THEN '1' ELSE '0' END        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        inner join        (        select  LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')) DUOC_KEY, (SUM(dtk.SOLUONG) - isnull(sum(A.SOLUONG),0) - isnull(sum(B.SOLUONG),0)) SOLUONG, pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        from (select sum(soluong) soluong,duoc_id,nguonduoc_id,khoduoc_id,benhvien_id from TT_DUOC_TONKHO  group by duoc_id,nguonduoc_id,khoduoc_id,benhvien_id) dtk        inner join TM_DUOC_PHAMVISD_MAPPING pvsd on dtk.KHODUOC_ID = pvsd.KHODUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NOITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) B on B.DUOC_ID = dtk.DUOC_ID and B.SOLUONG > 0 and B.PHAMVI_ID = pvsd.PHAMVI_ID and B.NGUONHANG_ID = dtk.NGUONDUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NGOAITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) A on A.DUOC_ID = dtk.DUOC_ID and A.SOLUONG > 0 and A.PHAMVI_ID = pvsd.PHAMVI_ID and A.NGUONHANG_ID = dtk.NGUONDUOC_ID        where dtk.SOLUONG > 0 and dtk.BENHVIEN_ID = 'HLU01'        group by LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')), pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        ) tk on tk.DUOC_ID = d.DUOC_ID        left join TM_DUOC_PHAMVISUDUNG kd on kd.PHAMVI_ID = tk.PHAMVI_ID and kd.BENHVIEN_ID = 'HLU01'        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = tk.NGUONDUOC_ID and nh.BENHVIEN_ID = 'HLU01'        where  d.BENHVIEN_ID = 'HLU01' and d.DUOC_ID in (1)        end        else        begin        select  distinct tk.DUOC_KEY, LTRIM(tk.PHAMVI_ID) as PHAMVI_ID, tk.NGUONDUOC_ID, nh.TENNGUONDUOC, nh.TINHTIEN, d.DUOC_ID, ld.MALOAIDUOC,        d.SOVISA,d.TYLE_VAT,d.COTOA, d.MADUOC, d.TENHANG, d.TENDUOCDAYDU, dvt.TENDONVITINH as DONVITINH, d.BHYT,        d.TENHOATCHAT, d.HAMLUONG, d.HANGSANXUAT, d.QUOCGIA, d.LOAIDUOC_ID, d.DUONGDUNG_ID, d.TINHTIEN_PTTT,        ten.TENDUOC, ten.TENDUOC_EN, ten.MAQUOCTE, ten.MAQUOCTEBT,        CASE WHEN d.BHYT = '1' THEN 'BHYT' ELSE '' END as BHYT_TEXT        , ld.LOAIVATTU_ID        , d.BENHVIEN_ID,        tk.SOLUONG, d.VTYT_PHANLOAI, d.PHAMVI, d.SUASOLUONGTONGHOP, d.MADUOCBV, d.DANGTRINHBAY        , TAMNGUNG = CASE WHEN d.TAMNGUNG = '1' OR nh.TAMNGUNG = '1' OR kd.TAMNGUNG = '1' THEN '1' ELSE '0' END        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        inner join        (        select  LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')) DUOC_KEY, (SUM(dtk.SOLUONG) - isnull(sum(A.SOLUONG),0) - isnull(sum(B.SOLUONG),0)) SOLUONG, pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        from (select sum(soluong) soluong,duoc_id,nguonduoc_id,khoduoc_id,benhvien_id from TT_DUOC_TONKHO  group by duoc_id,nguonduoc_id,khoduoc_id,benhvien_id) dtk        inner join TM_DUOC_PHAMVISD_MAPPING pvsd on dtk.KHODUOC_ID = pvsd.KHODUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NOITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) B on B.DUOC_ID = dtk.DUOC_ID and B.SOLUONG > 0 and B.PHAMVI_ID = pvsd.PHAMVI_ID and B.NGUONHANG_ID = dtk.NGUONDUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NGOAITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) A on A.DUOC_ID = dtk.DUOC_ID and A.SOLUONG > 0 and A.PHAMVI_ID = pvsd.PHAMVI_ID and A.NGUONHANG_ID = dtk.NGUONDUOC_ID        where dtk.SOLUONG > 0 and dtk.BENHVIEN_ID = 'HLU01'        group by LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')), pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        ) tk on tk.DUOC_ID = d.DUOC_ID        left join TM_DUOC_PHAMVISUDUNG kd on kd.PHAMVI_ID = tk.PHAMVI_ID and kd.BENHVIEN_ID = 'HLU01'        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = tk.NGUONDUOC_ID and nh.BENHVIEN_ID = 'HLU01'        where  d.BENHVIEN_ID = 'HLU01' and d.DUOC_ID in (1)        end]
2019-09-20 17:17:19,787 [1] DEBUG - Statement Id: [DAO00030_RemoveChungTuVTYTNgoaiTru] PreparedStatement : [update TT_NGOAITRU_KHAMBENH_VTYT set            CHUNGTU_ID = null,            TRANGTHAI = null            where            CHUNGTU_ID =   @param0               update TT_VIENPHI set            DUYET = '0',            DATHUCHIEN = '0'            where            REF_TABLE = 'TT_NGOAITRU_KHAMBENH_VTYT'            AND REF_ID IN (10593)]
2019-09-20 17:17:19,787 [1] DEBUG - Statement Id: [DAO00030_RemoveChungTuVTYTNgoaiTru] Parameters: [@param0=[CHUNGTU_ID,137704]]
2019-09-20 17:17:19,787 [1] DEBUG - Statement Id: [DAO00030_RemoveChungTuVTYTNgoaiTru] Types: [@param0=[Int64, System.Int64]]
2019-09-20 17:18:00,570 [1] DEBUG - Statement Id: [DAO00030_CHUNGTUCT_Add] PreparedStatement : [insert into TT_DUOC_CHUNGTU_CHITIET (            CHUNGTU_ID            , DUOC_ID            , SOLONHAP_ID            , SOKIEMSOAT            , SOVISA            , HANDUNG            , DONVITINH_ID            , SOLUONGYEUCAU            , SOLUONGTHUCTE            , SOLUONGDAXUAT            , TIENTE_ID            , TYGIA            , DONGIAMUA            , DONGIA_BHYT            , DONGIABAN            , DONGIABAN_VAT            , DONGIAVON            , DONGIATHANHTOAN            , SOQUYEN            , SOHOADONVAT            , TYLEVAT            , GIATRIVAT            , TYLECHIETKHAU            , GIATRICHIETKHAU            , MIENPHI            , LYDOMIENPHI_ID            , SOCHUNGTUKETOAN            , SOCHUNGTUTIENMAT            , TRANGTHAI            , DAPHATSINHPHIEUXUAT            , DAPHATSINHPHIEUHOANTRA            , KHUYENMAI            , PHUONGPHAPXUAT            , DONDATHANG_ID            , GHICHUCHITIET            , NGUONHANG_ID            , DONGIAVONVAT            , THANHTIENMUA            , THANHTIENVON            , THANHTIENHOPDONG            , ISTACHLO            , DONVITINHBANDAU_ID            , SOLUONGBANDAU            , GOITHAU_ID            , DONGIATHAU            , DONGIAPO            , TYLEQUIDOI            , TOATHUOCNOITRU_ID            , KHAMBENH_VTYT_ID            , PHAUTHUAT_VTYT_ID            , CLSKETQUA_VTYT_ID            , TOATHUOCNGOAITRU_ID            , MASTER_ID            , BENHNHAN            , YLENH                                   , BENHVIEN_ID            , NGAYTAO            , NGUOITAO_ID            , NGAYCAPNHAT            , NGUOICAPNHAT_ID            , THANHTIENMUABANDAU            , SOLUONGQUIDOI            ) values (             @param0             ,  @param1             ,  @param2             ,  @param3             ,  @param4             ,  @param5             ,  @param6             ,  @param7             ,  @param8             ,  @param9             ,  @param10             ,  @param11             ,  @param12             ,  @param13             ,  @param14             ,  @param15             ,  @param16             ,  @param17             ,  @param18             ,  @param19             ,  @param20             ,  @param21             ,  @param22             ,  @param23             ,  @param24             ,  @param25             ,  @param26             ,  @param27             ,  @param28             ,  @param29             ,  @param30             ,  @param31             ,  @param32             ,  @param33             ,  @param34             ,  @param35             ,  @param36             ,  @param37             ,  @param38             ,  @param39             ,  @param40             ,  @param41             ,  @param42             ,  @param43             ,  @param44             ,  @param45             ,  @param46             ,  @param47             ,  @param48             ,  @param49             ,  @param50             ,  @param51             ,  @param52             ,  @param53             ,  @param54                          ,  @param55             ,  @param56             ,  @param57             ,  @param58             ,  @param59             ,  @param60             ,  @param61             )            select SCOPE_identity() as value]
2019-09-20 17:18:00,571 [1] DEBUG - Statement Id: [DAO00030_CHUNGTUCT_Add] Parameters: [@param0=[CHUNGTU_ID,137704], @param1=[DUOC_ID,1], @param2=[SOLONHAP_ID,7541], @param3=[SOKIEMSOAT,null], @param4=[SOVISA,1], @param5=[HANDUNG,12/12/2026 12:00:00 AM], @param6=[DONVITINH_ID,17], @param7=[SOLUONGYEUCAU,2], @param8=[SOLUONGTHUCTE,null], @param9=[SOLUONGDAXUAT,2], @param10=[TIENTE_ID,null], @param11=[TYGIA,null], @param12=[DONGIAMUA,945], @param13=[DONGIA_BHYT,null], @param14=[DONGIABAN,1030], @param15=[DONGIABAN_VAT,1030], @param16=[DONGIAVON,945], @param17=[DONGIATHANHTOAN,null], @param18=[SOQUYEN,null], @param19=[SOHOADONVAT,null], @param20=[TYLEVAT,0], @param21=[GIATRIVAT,null], @param22=[TYLECHIETKHAU,null], @param23=[GIATRICHIETKHAU,null], @param24=[MIENPHI,null], @param25=[LYDOMIENPHI_ID,null], @param26=[SOCHUNGTUKETOAN,null], @param27=[SOCHUNGTUTIENMAT,null], @param28=[TRANGTHAI,null], @param29=[DAPHATSINHPHIEUXUAT,null], @param30=[DAPHATSINHPHIEUHOANTRA,null], @param31=[KHUYENMAI,null], @param32=[PHUONGPHAPXUAT,null], @param33=[DONDATHANG_ID,null], @param34=[GHICHUCHITIET,null], @param35=[NGUONHANG_ID,1], @param36=[DONGIAVONVAT,945], @param37=[THANHTIENMUA,1890], @param38=[THANHTIENVON,1890], @param39=[THANHTIENHOPDONG,null], @param40=[ISTACHLO,null], @param41=[DONVITINHBANDAU_ID,null], @param42=[SOLUONGBANDAU,null], @param43=[GOITHAU_ID,null], @param44=[DONGIATHAU,1030], @param45=[DONGIAPO,null], @param46=[TYLEQUIDOI,null], @param47=[TOATHUOCNOITRU_ID,null], @param48=[KHAMBENH_VTYT_ID,10593], @param49=[PHAUTHUAT_VTYT_ID,null], @param50=[CLSKETQUA_VTYT_ID,null], @param51=[TOATHUOCNGOAITRU_ID,null], @param52=[MASTER_ID,0], @param53=[BENHNHAN,Người bệnh: 190043304 - Test Xn1 - 20/09/2019 - 16:50], @param54=[YLENH,null], @param55=[BENHVIEN_ID,HLU01], @param56=[NGAYTAO,9/20/2019 5:18:00 PM], @param57=[NGUOITAO_ID,0], @param58=[NGAYCAPNHAT,9/20/2019 5:18:00 PM], @param59=[NGUOICAPNHAT_ID,0], @param60=[THANHTIENMUABANDAU,null], @param61=[SOLUONGQUIDOI,null]]
2019-09-20 17:18:00,571 [1] DEBUG - Statement Id: [DAO00030_CHUNGTUCT_Add] Types: [@param0=[Int64, System.Int64], @param1=[Int64, System.Int64], @param2=[Int64, System.Int64], @param3=[System.DBNull, null], @param4=[String, System.String], @param5=[DateTime, System.DateTime], @param6=[Int64, System.Int64], @param7=[Double, System.Double], @param8=[System.DBNull, null], @param9=[Double, System.Double], @param10=[System.DBNull, null], @param11=[System.DBNull, null], @param12=[Double, System.Double], @param13=[System.DBNull, null], @param14=[Double, System.Double], @param15=[Double, System.Double], @param16=[Double, System.Double], @param17=[System.DBNull, null], @param18=[System.DBNull, null], @param19=[System.DBNull, null], @param20=[Double, System.Double], @param21=[System.DBNull, null], @param22=[System.DBNull, null], @param23=[System.DBNull, null], @param24=[System.DBNull, null], @param25=[System.DBNull, null], @param26=[System.DBNull, null], @param27=[System.DBNull, null], @param28=[System.DBNull, null], @param29=[System.DBNull, null], @param30=[System.DBNull, null], @param31=[System.DBNull, null], @param32=[System.DBNull, null], @param33=[System.DBNull, null], @param34=[System.DBNull, null], @param35=[Int64, System.Int64], @param36=[Double, System.Double], @param37=[Double, System.Double], @param38=[Double, System.Double], @param39=[System.DBNull, null], @param40=[System.DBNull, null], @param41=[System.DBNull, null], @param42=[System.DBNull, null], @param43=[System.DBNull, null], @param44=[Double, System.Double], @param45=[System.DBNull, null], @param46=[System.DBNull, null], @param47=[System.DBNull, null], @param48=[Int64, System.Int64], @param49=[System.DBNull, null], @param50=[System.DBNull, null], @param51=[System.DBNull, null], @param52=[Int64, System.Int64], @param53=[String, System.String], @param54=[System.DBNull, null], @param55=[String, System.String], @param56=[DateTime, System.DateTime], @param57=[Int64, System.Int64], @param58=[DateTime, System.DateTime], @param59=[Int64, System.Int64], @param60=[System.DBNull, null], @param61=[System.DBNull, null]]
2019-09-20 17:18:00,605 [1] DEBUG - Statement Id: [DAO00030_TT_DUOC_TONKHO_LOG_Add] PreparedStatement : [DECLARE @KHODUOC_ID int               DECLARE @TONTRUOC numeric(18, 4)               DECLARE @TONSAU numeric(18, 4)               DECLARE @SOLUONGNHAP numeric(18, 4)               DECLARE @SOLUONGXUAT numeric(18, 4)                              IF( @param0  = 'N')               BEGIN                SET @KHODUOC_ID =  @param1                END               ELSE               BEGIN                 SET @KHODUOC_ID =  @param2                END                              SELECT @TONTRUOC = SOLUONG FROM TT_DUOC_TONKHO WHERE KHODUOC_ID = @KHODUOC_ID  AND DUOC_ID =  @param3  AND SOLONHAP_ID =  @param4  AND NGUONDUOC_ID =  @param5                               IF( @param0  = 'N' AND  @param6  = 'ADD')               BEGIN                SET @TONSAU = ISNULL(@TONTRUOC,0) +  @param7                 SET @SOLUONGNHAP =  @param7                 SET @SOLUONGXUAT = 0               END               IF( @param0  = 'N' AND  @param6  = 'DEL')               BEGIN                SET @TONSAU = ISNULL(@TONTRUOC,0) -  @param7                 SET @SOLUONGXUAT =  @param7                 SET @SOLUONGNHAP = 0               END                                         IF( @param0  = 'X' AND  @param6  = 'ADD')               BEGIN                SET @TONSAU = ISNULL(@TONTRUOC,0) -  @param8                 SET @SOLUONGXUAT =  @param8                 SET @SOLUONGNHAP = 0               END               IF( @param0  = 'X' AND  @param6  = 'DEL')               BEGIN                SET @TONSAU = ISNULL(@TONTRUOC,0) +  @param8                 SET @SOLUONGNHAP =  @param8                 SET @SOLUONGXUAT = 0                             END                        insert into TT_DUOC_TONKHO_LOG (                           CHUNGTUCHITIET_ID              ,CHUNGTU_ID              ,MACHUNGTU              ,LOAICHUNGTU              ,MUCDICHCHUNGTU_CODE              ,KHONHAP_ID              ,KHOXUAT_ID              ,DUOC_ID              ,SOLONHAP_ID              ,NGUONDUOC_ID              ,SOLUONGNHAP              ,SOLUONGXUAT              ,DONGIAMUA              ,DONGIAVON              ,TYLE_VAT              ,DONGIAVONVAT              ,TONTRUOC              ,TONSAU              ,ACTION              ,BENHVIEN_ID              ,NGAYTAO              ,NGUOITAO_ID                          ) values (              @param9               , @param10               , @param11               , @param0               , @param12               , @param1               , @param2               , @param3               , @param4               , @param5               ,@SOLUONGNHAP              ,@SOLUONGXUAT              , @param13               , @param14               , @param15               , @param16               ,@TONTRUOC              ,@TONSAU              , @param6               , @param17               , @param18               , @param19               )]
2019-09-20 17:18:00,605 [1] DEBUG - Statement Id: [DAO00030_TT_DUOC_TONKHO_LOG_Add] Parameters: [@param0=[LOAICHUNGTU,X], @param1=[KHONHAP_ID,null], @param2=[KHOXUAT_ID,32], @param3=[DUOC_ID,1], @param4=[SOLONHAP_ID,7541], @param5=[NGUONDUOC_ID,1], @param6=[ACTION,ADD], @param7=[SOLUONGNHAP,null], @param8=[SOLUONGXUAT,2], @param9=[CHUNGTUCHITIET_ID,1299050], @param10=[CHUNGTU_ID,137704], @param11=[MACHUNGTU,CS_KBX1319003092], @param12=[MUCDICHCHUNGTU_CODE,X13], @param13=[DONGIAMUA,945], @param14=[DONGIAVON,945], @param15=[TYLE_VAT,0], @param16=[DONGIAVONVAT,945], @param17=[BENHVIEN_ID,HLU01], @param18=[NGAYTAO,9/20/2019 5:18:00 PM], @param19=[NGUOITAO_ID,0]]
2019-09-20 17:18:00,605 [1] DEBUG - Statement Id: [DAO00030_TT_DUOC_TONKHO_LOG_Add] Types: [@param0=[String, System.String], @param1=[System.DBNull, null], @param2=[Int64, System.Int64], @param3=[Int64, System.Int64], @param4=[Int64, System.Int64], @param5=[Int64, System.Int64], @param6=[String, System.String], @param7=[System.DBNull, null], @param8=[Decimal, System.Decimal], @param9=[Int64, System.Int64], @param10=[Int64, System.Int64], @param11=[String, System.String], @param12=[String, System.String], @param13=[Decimal, System.Decimal], @param14=[Decimal, System.Decimal], @param15=[Double, System.Double], @param16=[Double, System.Double], @param17=[String, System.String], @param18=[DateTime, System.DateTime], @param19=[Int64, System.Int64]]
2019-09-20 17:18:02,530 [1] DEBUG - Statement Id: [DAO00030_DUOC_TONKHO_BOOKING_NGOAITRU_Giam] PreparedStatement : [update TT_DUOC_TONKHO_BOOK_NGOAITRU            set            SOLUONG = 0                     ,NGAYCAPNHAT = getdate()            where            REF_TABLE = 'TT_NGOAITRU_KHAMBENH_VTYT'            AND REF_ID = '10593'                AND BENHVIEN_ID = 'HLU01']
2019-09-20 17:18:02,885 [1] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoVaBookingCOM23UpdateRedis] PreparedStatement : [declare @NGUONDUOC_MACDINH varchar(5) = '0';        declare @TOAMUANGOAI int = 0;        select @NGUONDUOC_MACDINH = isnull(VALUE,0) from TM_SYS_APPSETTINGS where CODE = 'PHA_NGUONDUOC'        select @TOAMUANGOAI = isnull(VALUE,0) from TM_SYS_APPSETTINGS where CODE = 'OPD_TOAMUANGOAI_DUNGDANHMUC_DUOC'                if @TOAMUANGOAI = 1        begin        select  distinct '0' + '_' + LTRIM(d.DUOC_ID) + '_' + @NGUONDUOC_MACDINH as DUOC_KEY, 0 as PHAMVI_ID, @NGUONDUOC_MACDINH as NGUONDUOC_ID, null as TENNGUONDUOC, null as TINHTIEN, d.DUOC_ID, ld.MALOAIDUOC,        d.SOVISA,d.TYLE_VAT,d.COTOA, d.MADUOC, d.TENHANG, d.TENDUOCDAYDU, dvt.TENDONVITINH as DONVITINH, d.BHYT,        d.TENHOATCHAT, d.HAMLUONG, d.HANGSANXUAT, d.QUOCGIA, d.LOAIDUOC_ID, d.DUONGDUNG_ID, d.TINHTIEN_PTTT,        ten.TENDUOC, ten.TENDUOC_EN, ten.MAQUOCTE, ten.MAQUOCTEBT,        '' as BHYT_TEXT        , ld.LOAIVATTU_ID        , d.BENHVIEN_ID,        999999999 as SOLUONG, d.VTYT_PHANLOAI, d.PHAMVI, d.SUASOLUONGTONGHOP, d.MADUOCBV, d.DANGTRINHBAY        , TAMNGUNG = CASE WHEN d.TAMNGUNG = '1' THEN '1' ELSE '0' END        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        where d.DUOC_ID in (1)        union all        select  distinct tk.DUOC_KEY, LTRIM(tk.PHAMVI_ID) as PHAMVI_ID, tk.NGUONDUOC_ID, nh.TENNGUONDUOC, nh.TINHTIEN, d.DUOC_ID, ld.MALOAIDUOC,        d.SOVISA,d.TYLE_VAT,d.COTOA, d.MADUOC, d.TENHANG, d.TENDUOCDAYDU, dvt.TENDONVITINH as DONVITINH, d.BHYT,        d.TENHOATCHAT, d.HAMLUONG, d.HANGSANXUAT, d.QUOCGIA, d.LOAIDUOC_ID, d.DUONGDUNG_ID, d.TINHTIEN_PTTT,        ten.TENDUOC, ten.TENDUOC_EN, ten.MAQUOCTE, ten.MAQUOCTEBT,        CASE WHEN d.BHYT = '1' THEN 'BHYT' ELSE '' END as BHYT_TEXT        , ld.LOAIVATTU_ID        , d.BENHVIEN_ID,        tk.SOLUONG, d.VTYT_PHANLOAI, d.PHAMVI, d.SUASOLUONGTONGHOP, d.MADUOCBV, d.DANGTRINHBAY        , TAMNGUNG = CASE WHEN d.TAMNGUNG = '1' OR nh.TAMNGUNG = '1' OR kd.TAMNGUNG = '1' THEN '1' ELSE '0' END        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        inner join        (        select  LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')) DUOC_KEY, (SUM(dtk.SOLUONG) - isnull(sum(A.SOLUONG),0) - isnull(sum(B.SOLUONG),0)) SOLUONG, pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        from (select sum(soluong) soluong,duoc_id,nguonduoc_id,khoduoc_id,benhvien_id from TT_DUOC_TONKHO  group by duoc_id,nguonduoc_id,khoduoc_id,benhvien_id) dtk        inner join TM_DUOC_PHAMVISD_MAPPING pvsd on dtk.KHODUOC_ID = pvsd.KHODUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NOITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) B on B.DUOC_ID = dtk.DUOC_ID and B.SOLUONG > 0 and B.PHAMVI_ID = pvsd.PHAMVI_ID and B.NGUONHANG_ID = dtk.NGUONDUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NGOAITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) A on A.DUOC_ID = dtk.DUOC_ID and A.SOLUONG > 0 and A.PHAMVI_ID = pvsd.PHAMVI_ID and A.NGUONHANG_ID = dtk.NGUONDUOC_ID        where dtk.SOLUONG > 0 and dtk.BENHVIEN_ID = 'HLU01'        group by LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')), pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        ) tk on tk.DUOC_ID = d.DUOC_ID        left join TM_DUOC_PHAMVISUDUNG kd on kd.PHAMVI_ID = tk.PHAMVI_ID and kd.BENHVIEN_ID = 'HLU01'        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = tk.NGUONDUOC_ID and nh.BENHVIEN_ID = 'HLU01'        where  d.BENHVIEN_ID = 'HLU01' and d.DUOC_ID in (1)        end        else        begin        select  distinct tk.DUOC_KEY, LTRIM(tk.PHAMVI_ID) as PHAMVI_ID, tk.NGUONDUOC_ID, nh.TENNGUONDUOC, nh.TINHTIEN, d.DUOC_ID, ld.MALOAIDUOC,        d.SOVISA,d.TYLE_VAT,d.COTOA, d.MADUOC, d.TENHANG, d.TENDUOCDAYDU, dvt.TENDONVITINH as DONVITINH, d.BHYT,        d.TENHOATCHAT, d.HAMLUONG, d.HANGSANXUAT, d.QUOCGIA, d.LOAIDUOC_ID, d.DUONGDUNG_ID, d.TINHTIEN_PTTT,        ten.TENDUOC, ten.TENDUOC_EN, ten.MAQUOCTE, ten.MAQUOCTEBT,        CASE WHEN d.BHYT = '1' THEN 'BHYT' ELSE '' END as BHYT_TEXT        , ld.LOAIVATTU_ID        , d.BENHVIEN_ID,        tk.SOLUONG, d.VTYT_PHANLOAI, d.PHAMVI, d.SUASOLUONGTONGHOP, d.MADUOCBV, d.DANGTRINHBAY        , TAMNGUNG = CASE WHEN d.TAMNGUNG = '1' OR nh.TAMNGUNG = '1' OR kd.TAMNGUNG = '1' THEN '1' ELSE '0' END        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        inner join        (        select  LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')) DUOC_KEY, (SUM(dtk.SOLUONG) - isnull(sum(A.SOLUONG),0) - isnull(sum(B.SOLUONG),0)) SOLUONG, pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        from (select sum(soluong) soluong,duoc_id,nguonduoc_id,khoduoc_id,benhvien_id from TT_DUOC_TONKHO  group by duoc_id,nguonduoc_id,khoduoc_id,benhvien_id) dtk        inner join TM_DUOC_PHAMVISD_MAPPING pvsd on dtk.KHODUOC_ID = pvsd.KHODUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NOITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) B on B.DUOC_ID = dtk.DUOC_ID and B.SOLUONG > 0 and B.PHAMVI_ID = pvsd.PHAMVI_ID and B.NGUONHANG_ID = dtk.NGUONDUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NGOAITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) A on A.DUOC_ID = dtk.DUOC_ID and A.SOLUONG > 0 and A.PHAMVI_ID = pvsd.PHAMVI_ID and A.NGUONHANG_ID = dtk.NGUONDUOC_ID        where dtk.SOLUONG > 0 and dtk.BENHVIEN_ID = 'HLU01'        group by LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')), pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        ) tk on tk.DUOC_ID = d.DUOC_ID        left join TM_DUOC_PHAMVISUDUNG kd on kd.PHAMVI_ID = tk.PHAMVI_ID and kd.BENHVIEN_ID = 'HLU01'        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = tk.NGUONDUOC_ID and nh.BENHVIEN_ID = 'HLU01'        where  d.BENHVIEN_ID = 'HLU01' and d.DUOC_ID in (1)        end]
2019-09-20 17:18:03,069 [1] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoCOM18UpdateRedis] PreparedStatement : [select distinct TT_TONKHO.DUOC_KEY, LTRIM(TT_TONKHO.KHODUOC_ID) as KHODUOC_ID, TM_DUOC.DUOC_ID, TM_LOAIDUOC.MALOAIDUOC,TM_DUOC.SOVISA,TM_DUOC.TYLE_VAT,TM_DUOC.COTOA,        TM_DUOC.MADUOC, TM_DUOC.TENHANG, TM_DUOC.TENDUOCDAYDU, dvt.TENDONVITINH as DONVITINH,  TM_DUOC.DONVITINH_ID,TM_DUOC.BHYT,        TM_DUOC.TENHOATCHAT,        TM_DUOC.HAMLUONG, TM_DUOC.HANGSANXUAT, TM_DUOC.QUOCGIA, TM_DUOC.LOAIDUOC_ID, TM_DUOC.DUONGDUNG_ID,        TM_TENDUOC.TENDUOC, TM_TENDUOC.TENDUOC_EN, TM_TENDUOC.MAQUOCTE, TM_TENDUOC.MAQUOCTEBT,        TM_LOAIDUOC.LOAIVATTU_ID, TM_DUOC.BENHVIEN_ID,        TT_TONKHO.SOLUONG, TM_DUOC.VTYT_PHANLOAI, TM_DUOC.PHAMVI, TT_TONKHO.NGUONDUOC_ID, NG.TENNGUONDUOC AS TENNGUONDUOC        , TAMNGUNG = CASE WHEN TM_DUOC.TAMNGUNG = '1' OR NG.TAMNGUNG = '1' OR KD.TAMNGUNG = '1' THEN '1' ELSE '0' END        , TM_DUOC.DANGTRINHBAY        from TM_DUOC        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = TM_DUOC.DONVITINH_ID        left join TM_TENDUOC on TM_DUOC.TENDUOC_ID = TM_TENDUOC.TENDUOC_ID and TM_DUOC.BENHVIEN_ID = 'HLU01' and TM_DUOC.TAMNGUNG = '0'        left join TM_LOAIDUOC on TM_LOAIDUOC.LOAIDUOC_ID = TM_DUOC.LOAIDUOC_ID and TM_LOAIDUOC.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG on (TM_LOAIDUOC.LOAIVATTU_ID = TM_DUOC_HANDUNG.LOAIDUOC and TM_DUOC_HANDUNG.BENHVIEN_ID = 'HLU01')        inner join        (select LTRIM(A.KHODUOC_ID) + '_' + LTRIM(A.DUOC_ID) + '_' + LTRIM(ISNULL(A.NGUONDUOC_ID,'')) as DUOC_KEY, A.KHODUOC_ID, A.DUOC_ID, A.NGUONDUOC_ID,        SUM(isnull(A.SOLUONG,0)) as SOLUONG        from        (select SUM(SOLUONG) as SOLUONG, KHODUOC_ID, DUOC_ID, NGUONDUOC_ID from TT_DUOC_TONKHO        where BENHVIEN_ID = 'HLU01' group by KHODUOC_ID, DUOC_ID, NGUONDUOC_ID) A        group by LTRIM(A.KHODUOC_ID) + '_' + LTRIM(A.DUOC_ID) + '_' + LTRIM(ISNULL(A.NGUONDUOC_ID,'')), A.KHODUOC_ID, A.DUOC_ID, NGUONDUOC_ID        ) TT_TONKHO on TT_TONKHO.DUOC_ID = TM_DUOC.DUOC_ID        LEFT JOIN TM_NGUONHANG NG ON NG.NGUONDUOC_ID = TT_TONKHO.NGUONDUOC_ID        LEFT JOIN TM_KHODUOC KD ON KD.KHODUOC_ID = TT_TONKHO.KHODUOC_ID        where TM_DUOC.BENHVIEN_ID = 'HLU01' and TT_TONKHO.SOLUONG >= 0        and TM_DUOC.DUOC_ID in (1)]
2019-09-20 17:19:14,064 [1] DEBUG - Statement Id: [DAO00030_DUOCTONKHO_Giam] PreparedStatement : [update TT_DUOC_TONKHO set            SOLUONG = SOLUONG -  @param0             , NGAYCAPNHAT =  getdate()            , NGUOICAPNHAT_ID =  @param1             where            KHODUOC_ID =  @param2             and DUOC_ID =  @param3             and SOLONHAP_ID =  @param4]
2019-09-20 17:19:14,064 [1] DEBUG - Statement Id: [DAO00030_DUOCTONKHO_Giam] Parameters: [@param0=[SOLUONGTHAYDOI,2], @param1=[NGUOICAPNHAT_ID,0], @param2=[KHODUOC_ID,32], @param3=[DUOC_ID,1], @param4=[SOLONHAP_ID,7541]]
2019-09-20 17:19:14,064 [1] DEBUG - Statement Id: [DAO00030_DUOCTONKHO_Giam] Types: [@param0=[Double, System.Double], @param1=[Int64, System.Int64], @param2=[Int64, System.Int64], @param3=[Int64, System.Int64], @param4=[Int64, System.Int64]]
2019-09-20 17:19:15,060 [1] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoCOM18] PreparedStatement : [select  distinct TT_TONKHO.DUOC_KEY, LTRIM(TT_TONKHO.KHODUOC_ID) as KHODUOC_ID, TM_DUOC.DUOC_ID, TM_LOAIDUOC.MALOAIDUOC,TM_DUOC.SOVISA,TM_DUOC.TYLE_VAT,TM_DUOC.COTOA,        TM_DUOC.MADUOC, TM_DUOC.TENHANG, TM_DUOC.TENDUOCDAYDU, dvt.TENDONVITINH as DONVITINH, TM_DUOC.DONVITINH_ID, TM_DUOC.BHYT,        TM_DUOC.TENHOATCHAT, TM_DUOC.HAMLUONG, TM_DUOC.HANGSANXUAT, TM_DUOC.QUOCGIA, TM_DUOC.LOAIDUOC_ID, TM_DUOC.DUONGDUNG_ID,        TM_TENDUOC.TENDUOC, TM_TENDUOC.TENDUOC_EN, TM_TENDUOC.MAQUOCTE, TM_TENDUOC.MAQUOCTEBT,        TM_LOAIDUOC.LOAIVATTU_ID, TM_DUOC.BENHVIEN_ID,        TT_TONKHO.SOLUONG, TM_DUOC.VTYT_PHANLOAI, TM_DUOC.PHAMVI, TT_TONKHO.NGUONDUOC_ID, NG.TENNGUONDUOC        , TAMNGUNG = CASE WHEN TM_DUOC.TAMNGUNG = '1' OR NG.TAMNGUNG = '1' OR KD.TAMNGUNG = '1' THEN '1' ELSE '0' END        , TM_DUOC.DANGTRINHBAY        from TM_DUOC        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = TM_DUOC.DONVITINH_ID        left join TM_TENDUOC on TM_DUOC.TENDUOC_ID = TM_TENDUOC.TENDUOC_ID and TM_DUOC.BENHVIEN_ID = 'HLU01'  and TM_DUOC.TAMNGUNG = '0'        left join TM_LOAIDUOC on TM_LOAIDUOC.LOAIDUOC_ID = TM_DUOC.LOAIDUOC_ID and TM_LOAIDUOC.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG on (TM_LOAIDUOC.LOAIVATTU_ID = TM_DUOC_HANDUNG.LOAIDUOC and TM_DUOC_HANDUNG.BENHVIEN_ID = 'HLU01')        inner join        (select LTRIM(A.KHODUOC_ID) + '_' + LTRIM(A.DUOC_ID) + '_' + LTRIM(ISNULL(A.NGUONDUOC_ID,'')) as DUOC_KEY, A.KHODUOC_ID, A.DUOC_ID ,a.NGUONDUOC_ID,        SUM(isnull(A.SOLUONG,0)) as SOLUONG        from        (select SUM(SOLUONG) as SOLUONG, KHODUOC_ID, DUOC_ID, NGUONDUOC_ID from TT_DUOC_TONKHO        where KHODUOC_ID in (32) and DUOC_ID in (1) group by KHODUOC_ID, DUOC_ID, NGUONDUOC_ID        ) A        where A.KHODUOC_ID in (32) and A.DUOC_ID in (1)        group by LTRIM(A.KHODUOC_ID) + '_' + LTRIM(A.DUOC_ID) + '_' + LTRIM(A.NGUONDUOC_ID), A.KHODUOC_ID, A.DUOC_ID, A.NGUONDUOC_ID)        TT_TONKHO on TT_TONKHO.DUOC_ID = TM_DUOC.DUOC_ID        LEFT JOIN TM_NGUONHANG NG ON NG.NGUONDUOC_ID = TT_TONKHO.NGUONDUOC_ID        LEFT JOIN TM_KHODUOC KD ON KD.KHODUOC_ID = TT_TONKHO.KHODUOC_ID        where TM_DUOC.BENHVIEN_ID = 'HLU01' and TM_DUOC.DUOC_ID in (1)]
2019-09-20 17:19:15,098 [1] DEBUG - Statement Id: [DAO00030_GetListPhamViByKhoDuoc] PreparedStatement : [SELECT DISTINCT PHAMVI_ID          FROM TM_DUOC_PHAMVISD_MAPPING          WHERE          KHODUOC_ID IN (32)          AND BENHVIEN_ID ='HLU01'          AND TAMNGUNG = '0']
2019-09-20 17:19:15,128 [1] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoVaBookingCOM23] PreparedStatement : [declare @NGUONDUOC_MACDINH varchar(5) = '0';        declare @TOAMUANGOAI int = 0;        select @NGUONDUOC_MACDINH = isnull(VALUE,0) from TM_SYS_APPSETTINGS where CODE = 'PHA_NGUONDUOC'        select @TOAMUANGOAI = isnull(VALUE,0) from TM_SYS_APPSETTINGS where CODE = 'OPD_TOAMUANGOAI_DUNGDANHMUC_DUOC'                if @TOAMUANGOAI = 1        begin        select  distinct '0' + '_' + LTRIM(d.DUOC_ID) + '_' + @NGUONDUOC_MACDINH as DUOC_KEY, 0 as PHAMVI_ID, @NGUONDUOC_MACDINH as NGUONDUOC_ID, null as TENNGUONDUOC, null as TINHTIEN, d.DUOC_ID, ld.MALOAIDUOC,        d.SOVISA,d.TYLE_VAT,d.COTOA, d.MADUOC, d.TENHANG, d.TENDUOCDAYDU, dvt.TENDONVITINH as DONVITINH, d.BHYT,        d.TENHOATCHAT, d.HAMLUONG, d.HANGSANXUAT, d.QUOCGIA, d.LOAIDUOC_ID, d.DUONGDUNG_ID, d.TINHTIEN_PTTT,        ten.TENDUOC, ten.TENDUOC_EN, ten.MAQUOCTE, ten.MAQUOCTEBT,        '' as BHYT_TEXT        , ld.LOAIVATTU_ID        , d.BENHVIEN_ID,        999999999 as SOLUONG, d.VTYT_PHANLOAI, d.PHAMVI, d.SUASOLUONGTONGHOP, d.MADUOCBV, d.DANGTRINHBAY        , TAMNGUNG = CASE WHEN d.TAMNGUNG = '1' THEN '1' ELSE '0' END        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        where d.DUOC_ID in (1)        union all        select  distinct tk.DUOC_KEY, LTRIM(tk.PHAMVI_ID) as PHAMVI_ID, tk.NGUONDUOC_ID, nh.TENNGUONDUOC, nh.TINHTIEN, d.DUOC_ID, ld.MALOAIDUOC,        d.SOVISA,d.TYLE_VAT,d.COTOA, d.MADUOC, d.TENHANG, d.TENDUOCDAYDU, dvt.TENDONVITINH as DONVITINH, d.BHYT,        d.TENHOATCHAT, d.HAMLUONG, d.HANGSANXUAT, d.QUOCGIA, d.LOAIDUOC_ID, d.DUONGDUNG_ID, d.TINHTIEN_PTTT,        ten.TENDUOC, ten.TENDUOC_EN, ten.MAQUOCTE, ten.MAQUOCTEBT,        CASE WHEN d.BHYT = '1' THEN 'BHYT' ELSE '' END as BHYT_TEXT        , ld.LOAIVATTU_ID        , d.BENHVIEN_ID,        tk.SOLUONG, d.VTYT_PHANLOAI, d.PHAMVI, d.SUASOLUONGTONGHOP, d.MADUOCBV, d.DANGTRINHBAY        , TAMNGUNG = CASE WHEN d.TAMNGUNG = '1' OR nh.TAMNGUNG = '1' OR kd.TAMNGUNG = '1' THEN '1' ELSE '0' END        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        inner join        (        select  LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')) DUOC_KEY, (SUM(dtk.SOLUONG) - isnull(sum(A.SOLUONG),0) - isnull(sum(B.SOLUONG),0)) SOLUONG, pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        from (select sum(soluong) soluong,duoc_id,nguonduoc_id,khoduoc_id,benhvien_id from TT_DUOC_TONKHO  group by duoc_id,nguonduoc_id,khoduoc_id,benhvien_id) dtk        inner join TM_DUOC_PHAMVISD_MAPPING pvsd on dtk.KHODUOC_ID = pvsd.KHODUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NOITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) B on B.DUOC_ID = dtk.DUOC_ID and B.SOLUONG > 0 and B.PHAMVI_ID = pvsd.PHAMVI_ID and B.NGUONHANG_ID = dtk.NGUONDUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NGOAITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) A on A.DUOC_ID = dtk.DUOC_ID and A.SOLUONG > 0 and A.PHAMVI_ID = pvsd.PHAMVI_ID and A.NGUONHANG_ID = dtk.NGUONDUOC_ID        where dtk.SOLUONG > 0 and dtk.BENHVIEN_ID = 'HLU01'        group by LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')), pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        ) tk on tk.DUOC_ID = d.DUOC_ID        left join TM_DUOC_PHAMVISUDUNG kd on kd.PHAMVI_ID = tk.PHAMVI_ID and kd.BENHVIEN_ID = 'HLU01'        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = tk.NGUONDUOC_ID and nh.BENHVIEN_ID = 'HLU01'        where  d.BENHVIEN_ID = 'HLU01' and d.DUOC_ID in (1) and TK.PHAMVI_ID in (1055)        and tk.NGUONDUOC_ID in (1)         end        else        begin                select  distinct tk.DUOC_KEY, LTRIM(tk.PHAMVI_ID) as PHAMVI_ID, tk.NGUONDUOC_ID, nh.TENNGUONDUOC, nh.TINHTIEN, d.DUOC_ID, ld.MALOAIDUOC,        d.SOVISA,d.TYLE_VAT,d.COTOA, d.MADUOC, d.TENHANG, d.TENDUOCDAYDU, dvt.TENDONVITINH as DONVITINH, d.BHYT,        d.TENHOATCHAT, d.HAMLUONG, d.HANGSANXUAT, d.QUOCGIA, d.LOAIDUOC_ID, d.DUONGDUNG_ID, d.TINHTIEN_PTTT,        ten.TENDUOC, ten.TENDUOC_EN, ten.MAQUOCTE, ten.MAQUOCTEBT,        CASE WHEN d.BHYT = '1' THEN 'BHYT' ELSE '' END as BHYT_TEXT        , ld.LOAIVATTU_ID        , d.BENHVIEN_ID,        tk.SOLUONG, d.VTYT_PHANLOAI, d.PHAMVI, d.SUASOLUONGTONGHOP, d.MADUOCBV, d.DANGTRINHBAY        , TAMNGUNG = CASE WHEN d.TAMNGUNG = '1' OR nh.TAMNGUNG = '1' OR kd.TAMNGUNG = '1' THEN '1' ELSE '0' END        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        inner join        (        select  LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')) DUOC_KEY, (SUM(dtk.SOLUONG) - isnull(sum(A.SOLUONG),0) - isnull(sum(B.SOLUONG),0)) SOLUONG, pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        from (select sum(soluong) soluong,duoc_id,nguonduoc_id,khoduoc_id,benhvien_id from TT_DUOC_TONKHO  group by duoc_id,nguonduoc_id,khoduoc_id,benhvien_id) dtk        inner join TM_DUOC_PHAMVISD_MAPPING pvsd on dtk.KHODUOC_ID = pvsd.KHODUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NOITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) B on B.DUOC_ID = dtk.DUOC_ID and B.SOLUONG > 0 and B.PHAMVI_ID = pvsd.PHAMVI_ID and B.NGUONHANG_ID = dtk.NGUONDUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NGOAITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) A on A.DUOC_ID = dtk.DUOC_ID and A.SOLUONG > 0 and A.PHAMVI_ID = pvsd.PHAMVI_ID and A.NGUONHANG_ID = dtk.NGUONDUOC_ID        where dtk.SOLUONG > 0 and dtk.BENHVIEN_ID = 'HLU01'        group by LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')), pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        ) tk on tk.DUOC_ID = d.DUOC_ID        left join TM_DUOC_PHAMVISUDUNG kd on kd.PHAMVI_ID = tk.PHAMVI_ID and kd.BENHVIEN_ID = 'HLU01'        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = tk.NGUONDUOC_ID and nh.BENHVIEN_ID = 'HLU01'        where  d.BENHVIEN_ID = 'HLU01' and d.DUOC_ID in (1) and TK.PHAMVI_ID in (1055)        and tk.NGUONDUOC_ID in (1)         end]
2019-09-20 17:19:15,300 [1] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoCOM18UpdateRedis] PreparedStatement : [select distinct TT_TONKHO.DUOC_KEY, LTRIM(TT_TONKHO.KHODUOC_ID) as KHODUOC_ID, TM_DUOC.DUOC_ID, TM_LOAIDUOC.MALOAIDUOC,TM_DUOC.SOVISA,TM_DUOC.TYLE_VAT,TM_DUOC.COTOA,        TM_DUOC.MADUOC, TM_DUOC.TENHANG, TM_DUOC.TENDUOCDAYDU, dvt.TENDONVITINH as DONVITINH,  TM_DUOC.DONVITINH_ID,TM_DUOC.BHYT,        TM_DUOC.TENHOATCHAT,        TM_DUOC.HAMLUONG, TM_DUOC.HANGSANXUAT, TM_DUOC.QUOCGIA, TM_DUOC.LOAIDUOC_ID, TM_DUOC.DUONGDUNG_ID,        TM_TENDUOC.TENDUOC, TM_TENDUOC.TENDUOC_EN, TM_TENDUOC.MAQUOCTE, TM_TENDUOC.MAQUOCTEBT,        TM_LOAIDUOC.LOAIVATTU_ID, TM_DUOC.BENHVIEN_ID,        TT_TONKHO.SOLUONG, TM_DUOC.VTYT_PHANLOAI, TM_DUOC.PHAMVI, TT_TONKHO.NGUONDUOC_ID, NG.TENNGUONDUOC AS TENNGUONDUOC        , TAMNGUNG = CASE WHEN TM_DUOC.TAMNGUNG = '1' OR NG.TAMNGUNG = '1' OR KD.TAMNGUNG = '1' THEN '1' ELSE '0' END        , TM_DUOC.DANGTRINHBAY        from TM_DUOC        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = TM_DUOC.DONVITINH_ID        left join TM_TENDUOC on TM_DUOC.TENDUOC_ID = TM_TENDUOC.TENDUOC_ID and TM_DUOC.BENHVIEN_ID = 'HLU01' and TM_DUOC.TAMNGUNG = '0'        left join TM_LOAIDUOC on TM_LOAIDUOC.LOAIDUOC_ID = TM_DUOC.LOAIDUOC_ID and TM_LOAIDUOC.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG on (TM_LOAIDUOC.LOAIVATTU_ID = TM_DUOC_HANDUNG.LOAIDUOC and TM_DUOC_HANDUNG.BENHVIEN_ID = 'HLU01')        inner join        (select LTRIM(A.KHODUOC_ID) + '_' + LTRIM(A.DUOC_ID) + '_' + LTRIM(ISNULL(A.NGUONDUOC_ID,'')) as DUOC_KEY, A.KHODUOC_ID, A.DUOC_ID, A.NGUONDUOC_ID,        SUM(isnull(A.SOLUONG,0)) as SOLUONG        from        (select SUM(SOLUONG) as SOLUONG, KHODUOC_ID, DUOC_ID, NGUONDUOC_ID from TT_DUOC_TONKHO        where BENHVIEN_ID = 'HLU01' group by KHODUOC_ID, DUOC_ID, NGUONDUOC_ID) A        group by LTRIM(A.KHODUOC_ID) + '_' + LTRIM(A.DUOC_ID) + '_' + LTRIM(ISNULL(A.NGUONDUOC_ID,'')), A.KHODUOC_ID, A.DUOC_ID, NGUONDUOC_ID        ) TT_TONKHO on TT_TONKHO.DUOC_ID = TM_DUOC.DUOC_ID        LEFT JOIN TM_NGUONHANG NG ON NG.NGUONDUOC_ID = TT_TONKHO.NGUONDUOC_ID        LEFT JOIN TM_KHODUOC KD ON KD.KHODUOC_ID = TT_TONKHO.KHODUOC_ID        where TM_DUOC.BENHVIEN_ID = 'HLU01' and TT_TONKHO.SOLUONG >= 0        and TM_DUOC.DUOC_ID in (1)]
2019-09-20 17:19:15,401 [1] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoVaBookingCOM23UpdateRedis] PreparedStatement : [declare @NGUONDUOC_MACDINH varchar(5) = '0';        declare @TOAMUANGOAI int = 0;        select @NGUONDUOC_MACDINH = isnull(VALUE,0) from TM_SYS_APPSETTINGS where CODE = 'PHA_NGUONDUOC'        select @TOAMUANGOAI = isnull(VALUE,0) from TM_SYS_APPSETTINGS where CODE = 'OPD_TOAMUANGOAI_DUNGDANHMUC_DUOC'                if @TOAMUANGOAI = 1        begin        select  distinct '0' + '_' + LTRIM(d.DUOC_ID) + '_' + @NGUONDUOC_MACDINH as DUOC_KEY, 0 as PHAMVI_ID, @NGUONDUOC_MACDINH as NGUONDUOC_ID, null as TENNGUONDUOC, null as TINHTIEN, d.DUOC_ID, ld.MALOAIDUOC,        d.SOVISA,d.TYLE_VAT,d.COTOA, d.MADUOC, d.TENHANG, d.TENDUOCDAYDU, dvt.TENDONVITINH as DONVITINH, d.BHYT,        d.TENHOATCHAT, d.HAMLUONG, d.HANGSANXUAT, d.QUOCGIA, d.LOAIDUOC_ID, d.DUONGDUNG_ID, d.TINHTIEN_PTTT,        ten.TENDUOC, ten.TENDUOC_EN, ten.MAQUOCTE, ten.MAQUOCTEBT,        '' as BHYT_TEXT        , ld.LOAIVATTU_ID        , d.BENHVIEN_ID,        999999999 as SOLUONG, d.VTYT_PHANLOAI, d.PHAMVI, d.SUASOLUONGTONGHOP, d.MADUOCBV, d.DANGTRINHBAY        , TAMNGUNG = CASE WHEN d.TAMNGUNG = '1' THEN '1' ELSE '0' END        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        where d.DUOC_ID in (1)        union all        select  distinct tk.DUOC_KEY, LTRIM(tk.PHAMVI_ID) as PHAMVI_ID, tk.NGUONDUOC_ID, nh.TENNGUONDUOC, nh.TINHTIEN, d.DUOC_ID, ld.MALOAIDUOC,        d.SOVISA,d.TYLE_VAT,d.COTOA, d.MADUOC, d.TENHANG, d.TENDUOCDAYDU, dvt.TENDONVITINH as DONVITINH, d.BHYT,        d.TENHOATCHAT, d.HAMLUONG, d.HANGSANXUAT, d.QUOCGIA, d.LOAIDUOC_ID, d.DUONGDUNG_ID, d.TINHTIEN_PTTT,        ten.TENDUOC, ten.TENDUOC_EN, ten.MAQUOCTE, ten.MAQUOCTEBT,        CASE WHEN d.BHYT = '1' THEN 'BHYT' ELSE '' END as BHYT_TEXT        , ld.LOAIVATTU_ID        , d.BENHVIEN_ID,        tk.SOLUONG, d.VTYT_PHANLOAI, d.PHAMVI, d.SUASOLUONGTONGHOP, d.MADUOCBV, d.DANGTRINHBAY        , TAMNGUNG = CASE WHEN d.TAMNGUNG = '1' OR nh.TAMNGUNG = '1' OR kd.TAMNGUNG = '1' THEN '1' ELSE '0' END        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        inner join        (        select  LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')) DUOC_KEY, (SUM(dtk.SOLUONG) - isnull(sum(A.SOLUONG),0) - isnull(sum(B.SOLUONG),0)) SOLUONG, pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        from (select sum(soluong) soluong,duoc_id,nguonduoc_id,khoduoc_id,benhvien_id from TT_DUOC_TONKHO  group by duoc_id,nguonduoc_id,khoduoc_id,benhvien_id) dtk        inner join TM_DUOC_PHAMVISD_MAPPING pvsd on dtk.KHODUOC_ID = pvsd.KHODUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NOITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) B on B.DUOC_ID = dtk.DUOC_ID and B.SOLUONG > 0 and B.PHAMVI_ID = pvsd.PHAMVI_ID and B.NGUONHANG_ID = dtk.NGUONDUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NGOAITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) A on A.DUOC_ID = dtk.DUOC_ID and A.SOLUONG > 0 and A.PHAMVI_ID = pvsd.PHAMVI_ID and A.NGUONHANG_ID = dtk.NGUONDUOC_ID        where dtk.SOLUONG > 0 and dtk.BENHVIEN_ID = 'HLU01'        group by LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')), pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        ) tk on tk.DUOC_ID = d.DUOC_ID        left join TM_DUOC_PHAMVISUDUNG kd on kd.PHAMVI_ID = tk.PHAMVI_ID and kd.BENHVIEN_ID = 'HLU01'        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = tk.NGUONDUOC_ID and nh.BENHVIEN_ID = 'HLU01'        where  d.BENHVIEN_ID = 'HLU01' and d.DUOC_ID in (1)        end        else        begin        select  distinct tk.DUOC_KEY, LTRIM(tk.PHAMVI_ID) as PHAMVI_ID, tk.NGUONDUOC_ID, nh.TENNGUONDUOC, nh.TINHTIEN, d.DUOC_ID, ld.MALOAIDUOC,        d.SOVISA,d.TYLE_VAT,d.COTOA, d.MADUOC, d.TENHANG, d.TENDUOCDAYDU, dvt.TENDONVITINH as DONVITINH, d.BHYT,        d.TENHOATCHAT, d.HAMLUONG, d.HANGSANXUAT, d.QUOCGIA, d.LOAIDUOC_ID, d.DUONGDUNG_ID, d.TINHTIEN_PTTT,        ten.TENDUOC, ten.TENDUOC_EN, ten.MAQUOCTE, ten.MAQUOCTEBT,        CASE WHEN d.BHYT = '1' THEN 'BHYT' ELSE '' END as BHYT_TEXT        , ld.LOAIVATTU_ID        , d.BENHVIEN_ID,        tk.SOLUONG, d.VTYT_PHANLOAI, d.PHAMVI, d.SUASOLUONGTONGHOP, d.MADUOCBV, d.DANGTRINHBAY        , TAMNGUNG = CASE WHEN d.TAMNGUNG = '1' OR nh.TAMNGUNG = '1' OR kd.TAMNGUNG = '1' THEN '1' ELSE '0' END        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        inner join        (        select  LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')) DUOC_KEY, (SUM(dtk.SOLUONG) - isnull(sum(A.SOLUONG),0) - isnull(sum(B.SOLUONG),0)) SOLUONG, pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        from (select sum(soluong) soluong,duoc_id,nguonduoc_id,khoduoc_id,benhvien_id from TT_DUOC_TONKHO  group by duoc_id,nguonduoc_id,khoduoc_id,benhvien_id) dtk        inner join TM_DUOC_PHAMVISD_MAPPING pvsd on dtk.KHODUOC_ID = pvsd.KHODUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NOITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) B on B.DUOC_ID = dtk.DUOC_ID and B.SOLUONG > 0 and B.PHAMVI_ID = pvsd.PHAMVI_ID and B.NGUONHANG_ID = dtk.NGUONDUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NGOAITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) A on A.DUOC_ID = dtk.DUOC_ID and A.SOLUONG > 0 and A.PHAMVI_ID = pvsd.PHAMVI_ID and A.NGUONHANG_ID = dtk.NGUONDUOC_ID        where dtk.SOLUONG > 0 and dtk.BENHVIEN_ID = 'HLU01'        group by LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')), pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        ) tk on tk.DUOC_ID = d.DUOC_ID        left join TM_DUOC_PHAMVISUDUNG kd on kd.PHAMVI_ID = tk.PHAMVI_ID and kd.BENHVIEN_ID = 'HLU01'        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = tk.NGUONDUOC_ID and nh.BENHVIEN_ID = 'HLU01'        where  d.BENHVIEN_ID = 'HLU01' and d.DUOC_ID in (1)        end]
2019-09-20 17:30:34,645 [1] DEBUG - Statement Id: [DAO00030_GetList] PreparedStatement : [select *              from TT_DUOC_CHUNGTU              where BENHVIEN_ID = 'HLU01'                and                   TT_DUOC_CHUNGTU.CHUNGTU_ID = '137704'                               order by CHUNGTU_ID]
2019-09-20 17:30:34,755 [1] DEBUG - Statement Id: [DAO00030_CHUNGTUXUAT_CHITIET_GetList] PreparedStatement : [SELECT            ctct.*,            d.MADUOC, d.TENHANG, d.TENDUOCDAYDU, dvt.TENDONVITINH as DONVITINH,n.TENNGUONDUOC as NGUONHANG,            sln.SOLONHAP, sln.SOLOSANPHAM, sln.NGAYNHAP as NGAYNHAPLO, sln.HANDUNG as HANSUDUNG,            isnull(tk.SOLUONG,0) as SOLUONGTON,            LTRIM(ct.KHOXUAT_ID) + '_' + LTRIM(sln.DUOC_ID) + '_' + LTRIM(sln.NGUONDUOC_ID) as DUOC_KEY            , NLD.MANHOMLOAIDUOC, ld.MALOAIDUOC, D.SO_QDTT            FROM            TT_DUOC_CHUNGTU_CHITIET ctct            INNER JOIN TT_DUOC_CHUNGTU ct ON (ct.CHUNGTU_ID = ctct.CHUNGTU_ID)            INNER JOIN TT_DUOC_CHUNGTU_SOLONHAP sln ON (sln.SOLONHAP_ID = ctct.SOLONHAP_ID)            LEFT JOIN (            select xx.DUOCTONKHO_ID, xx.KHODUOC_ID, xx.DUOC_ID, xx.SOLONHAP_ID, xx.SOLUONG, xx.NGUONDUOC_ID, xx.BENHVIEN_ID from TT_DUOC_TONKHO xx            join ( select max(DUOCTONKHO_ID) as DUOCTONKHO_ID, KHODUOC_ID, DUOC_ID, SOLONHAP_ID, NGUONDUOC_ID            from TT_DUOC_TONKHO group by KHODUOC_ID, DUOC_ID, SOLONHAP_ID, NGUONDUOC_ID) yy on xx.DUOCTONKHO_ID=yy.DUOCTONKHO_ID            ) tk ON (tk.SOLONHAP_ID = sln.SOLONHAP_ID AND tk.DUOC_ID = sln.DUOC_ID and tk.KHODUOC_ID = ct.KHOXUAT_ID)            INNER JOIN TM_DUOC d ON (d.DUOC_ID = ctct.DUOC_ID)            INNER JOIN TM_NGUONHANG n ON (n.NGUONDUOC_ID = ctct.NGUONHANG_ID)            LEFT JOIN TM_DONVITINH dvt ON (dvt.DONVITINH_ID = ctct.DONVITINH_ID)            left join TM_LOAIDUOC LD on LD.LOAIDUOC_ID = D.LOAIDUOC_ID            LEFT JOIN TM_NHOMLOAIDUOC NLD on NLD.NHOMLOAIDUOC_ID = LD.NHOMLOAIDUOC_ID             where                             ct.CHUNGTU_ID = '137704'                       and                           ct.BENHVIEN_ID = 'HLU01'                                     order by CHUNGTUCHITIET_ID]
2019-09-20 17:30:34,879 [1] DEBUG - Statement Id: [DAO00030_KiemTraChungTuKhoaSo] PreparedStatement : [SELECT CHUNGTU_ID              FROM TT_DUOC_CHUNGTU              WHERE              MACHUNGTU = 'CS_KBX1319003092'              and BENHVIEN_ID = 'HLU01'              and              convert(date, NGAYCHUNGTU) <=              (              SELECT TOP 1 convert(date, KHOADENNGAY)              FROM TT_DUOC_KHOASOCHUNGTU              WHERE              KHODUOC_ID = '32'              and BENHVIEN_ID = 'HLU01'              AND KHOASO = '1'              ORDER BY KHOADENNGAY DESC              )]
2019-09-20 17:30:34,909 [1] DEBUG - Statement Id: [DAO00030_KiemTraChungTuDaChuyenKeToan] PreparedStatement : [SELECT CHUNGTU_ID            FROM TT_DUOC_CHUNGTU            WHERE            CHUNGTU_ID = '137704'            and IDCHUYEN IS NOT NULL            and BENHVIEN_ID = 'HLU01']
2019-09-20 17:30:34,938 [1] DEBUG - Statement Id: [DAO00030_KiemTraBenhNhanXuatVien] PreparedStatement : [select              TT.TOATHUOC_ID              from              TT_NOITRU_TOATHUOC TT              inner join TT_NOITRU_KHAMBENH KB on TT.KHAMBENH_ID = KB.KHAMBENH_ID              inner join TT_NOITRU_BENHAN BA on BA.BENHAN_ID = KB.BENHAN_ID              WHERE              BA.TRANGTHAI = 'DAXUATVIEN'              AND TT.CHUNGTU_ID =  137704              and TT.BENHVIEN_ID = 'HLU01']
2019-09-20 17:30:35,117 [1] DEBUG - Statement Id: [DAO00030_DUOCTONKHO_GetSoTonTheoDuoc] PreparedStatement : [SELECT              DUOC_ID,              SUM(SOLUONG) AS TONGTON              FROM              TT_DUOC_TONKHO              WHERE              KHODUOC_ID = '32'              and BENHVIEN_ID = 'HLU01'              and DUOC_ID IN (1)              GROUP BY DUOC_ID]
2019-09-20 17:30:35,149 [1] DEBUG - Statement Id: [DAO00030_DUOCTONKHO_GetSoTonTheoDuocTheoLo] PreparedStatement : [SELECT              DUOC_ID,SOLONHAP_ID,              SUM(SOLUONG) AS SOLUONGTONLO              FROM              TT_DUOC_TONKHO              WHERE              KHODUOC_ID = '32'              and BENHVIEN_ID = 'HLU01'              and DUOC_ID IN (1)              and SOLONHAP_ID IN (7541)              GROUP BY DUOC_ID, SOLONHAP_ID]
2019-09-20 17:30:35,178 [1] DEBUG - Statement Id: [DAO00030_DUOCTONKHO_GetSoTonTheoDuoc] PreparedStatement : [SELECT              DUOC_ID,              SUM(SOLUONG) AS TONGTON              FROM              TT_DUOC_TONKHO              WHERE              KHODUOC_ID = '32'              and BENHVIEN_ID = 'HLU01'              and DUOC_ID IN (1)              GROUP BY DUOC_ID]
--------------------------------------------------------------------------------
2019-09-20 17:41:03,967 [1] DEBUG - Statement Id: [DAO00001_DBList] PreparedStatement : [select *              from TM_SYS_SERVER              where HOSPITAL_ID = '_SYSTEM_' and TYPE = 'D']
2019-09-20 17:41:04,293 [1] DEBUG - Statement Id: [DAO00001_DaoList] PreparedStatement : [select              TM_SYS_SERVICEMAP.ID,              TM_SYS_SERVICEMAP.HOSPITAL_ID,              TM_SYS_SERVICEMAP.DB_NAME,              TM_SYS_SERVICEMAP.TYPE,              TM_SYS_SERVICEMAP.NAME,              TM_SYS_SERVICEMAP.CLASS,              (TM_SYS_DIC.VALUE + '.' + TM_SYS_SERVICEMAP.CLASS) as CLASSFULL,              TM_SYS_SERVICEMAP.ASSEMBLY              from TM_SYS_SERVICEMAP              inner join TM_SYS_DIC              on TM_SYS_SERVICEMAP.NAMESPACE = TM_SYS_DIC.ID              where HOSPITAL_ID = '_SYSTEM_' AND TYPE = 'D' AND ACTIVE = '1'              order by DB_NAME]
2019-09-20 17:41:04,332 [1] DEBUG - Statement Id: [DAO00001_ServiceList] PreparedStatement : [select              TM_SYS_SERVICEMAP.ID,              TM_SYS_SERVICEMAP.HOSPITAL_ID,              TM_SYS_SERVICEMAP.DB_NAME,              TM_SYS_SERVICEMAP.TYPE,              TM_SYS_SERVICEMAP.NAME,              TM_SYS_SERVICEMAP.CLASS,              (TM_SYS_DIC.VALUE + '.' + TM_SYS_SERVICEMAP.CLASS) as CLASSFULL,              TM_SYS_SERVICEMAP.ASSEMBLY,              TM_SYS_SERVER.URL              from TM_SYS_SERVICEMAP              inner join TM_SYS_DIC on TM_SYS_SERVICEMAP.NAMESPACE = TM_SYS_DIC.ID              inner join TM_SYS_SERVER on (TM_SYS_SERVICEMAP.DB_NAME = TM_SYS_SERVER.NAME) and (TM_SYS_SERVER.HOSPITAL_ID = '_SYSTEM_')              where TM_SYS_SERVICEMAP.HOSPITAL_ID = '_SYSTEM_' AND TM_SYS_SERVICEMAP.TYPE = 'S'  AND ACTIVE = '1'              order by URL]
2019-09-20 17:41:04,753 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = '_SYSTEM_'               AND                   TM_SYS_SCREEN.PAGE = 'LOGIN'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2019-09-20 17:41:04,981 [1] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = '_SYSTEM_'               AND                   TM_SYS_CACHE.ACTIVE = '1']
2019-09-20 17:41:12,142 [1] DEBUG - Statement Id: [DAO00001_DBList] PreparedStatement : [select *              from TM_SYS_SERVER              where HOSPITAL_ID = 'HLU01' and TYPE = 'D']
2019-09-20 17:41:12,172 [1] DEBUG - Statement Id: [DAO00001_DaoList] PreparedStatement : [select              TM_SYS_SERVICEMAP.ID,              TM_SYS_SERVICEMAP.HOSPITAL_ID,              TM_SYS_SERVICEMAP.DB_NAME,              TM_SYS_SERVICEMAP.TYPE,              TM_SYS_SERVICEMAP.NAME,              TM_SYS_SERVICEMAP.CLASS,              (TM_SYS_DIC.VALUE + '.' + TM_SYS_SERVICEMAP.CLASS) as CLASSFULL,              TM_SYS_SERVICEMAP.ASSEMBLY              from TM_SYS_SERVICEMAP              inner join TM_SYS_DIC              on TM_SYS_SERVICEMAP.NAMESPACE = TM_SYS_DIC.ID              where HOSPITAL_ID = 'HLU01' AND TYPE = 'D' AND ACTIVE = '1'              order by DB_NAME]
2019-09-20 17:41:13,597 [1] DEBUG - Statement Id: [DAO00001_ServiceList] PreparedStatement : [select              TM_SYS_SERVICEMAP.ID,              TM_SYS_SERVICEMAP.HOSPITAL_ID,              TM_SYS_SERVICEMAP.DB_NAME,              TM_SYS_SERVICEMAP.TYPE,              TM_SYS_SERVICEMAP.NAME,              TM_SYS_SERVICEMAP.CLASS,              (TM_SYS_DIC.VALUE + '.' + TM_SYS_SERVICEMAP.CLASS) as CLASSFULL,              TM_SYS_SERVICEMAP.ASSEMBLY,              TM_SYS_SERVER.URL              from TM_SYS_SERVICEMAP              inner join TM_SYS_DIC on TM_SYS_SERVICEMAP.NAMESPACE = TM_SYS_DIC.ID              inner join TM_SYS_SERVER on (TM_SYS_SERVICEMAP.DB_NAME = TM_SYS_SERVER.NAME) and (TM_SYS_SERVER.HOSPITAL_ID = 'HLU01')              where TM_SYS_SERVICEMAP.HOSPITAL_ID = 'HLU01' AND TM_SYS_SERVICEMAP.TYPE = 'S'  AND ACTIVE = '1'              order by URL]
2019-09-20 17:41:13,680 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1']
2019-09-20 17:41:14,465 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM005']
2019-09-20 17:41:14,603 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM015']
2019-09-20 17:41:14,685 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM067']
2019-09-20 17:41:14,767 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM008']
2019-09-20 17:41:14,841 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM068']
2019-09-20 17:41:14,917 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM006']
2019-09-20 17:41:14,994 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM030']
2019-09-20 17:41:15,088 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM025']
2019-09-20 17:41:15,166 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM024']
2019-09-20 17:41:15,678 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM033']
2019-09-20 17:41:15,720 [5] DEBUG - Statement Id: [DAO00027_GetListDuocKyGuiTonKho] PreparedStatement : [select  distinct TT_TONKHO.DUOC_KEY, LTRIM(TT_TONKHO.KHODUOC_ID) as KHODUOC_ID, TM_DUOC.DUOC_ID, TM_LOAIDUOC.MALOAIDUOC,TM_DUOC.SOVISA,TM_DUOC.TYLE_VAT,TM_DUOC.COTOA,        TM_DUOC.MADUOC, TM_DUOC.TENHANG, TM_DUOC.TENDUOCDAYDU, dvt.TENDONVITINH as DONVITINH,  TM_DUOC.DONVITINH_ID,TM_DUOC.BHYT,TM_DUOC.PHAMVI,        TM_DUOC.TENHOATCHAT, TM_DUOC.HAMLUONG, TM_DUOC.HANGSANXUAT, TM_DUOC.QUOCGIA, TM_DUOC.LOAIDUOC_ID, TM_DUOC.DUONGDUNG_ID,        TM_TENDUOC.TENDUOC, TM_TENDUOC.TENDUOC_EN, TM_TENDUOC.MAQUOCTE, TM_TENDUOC.MAQUOCTEBT,        TM_LOAIDUOC.LOAIVATTU_ID, TM_DUOC.BENHVIEN_ID,TT_TONKHO.SOLUONG, TT_TONKHO.NGUONDUOC_ID, NH.TENNGUONDUOC        , TAMNGUNG = CASE WHEN TM_DUOC.TAMNGUNG = '1' OR nh.TAMNGUNG = '1' OR KD.TAMNGUNG = '1' THEN '1' ELSE '0' END        , TM_DUOC.DANGTRINHBAY        from TM_DUOC        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = TM_DUOC.DONVITINH_ID        left join TM_TENDUOC on TM_DUOC.TENDUOC_ID = TM_TENDUOC.TENDUOC_ID and TM_DUOC.BENHVIEN_ID = 'HLU01' and TM_DUOC.TAMNGUNG = '0'        left join TM_LOAIDUOC on TM_LOAIDUOC.LOAIDUOC_ID = TM_DUOC.LOAIDUOC_ID and TM_LOAIDUOC.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG on (TM_LOAIDUOC.LOAIVATTU_ID = TM_DUOC_HANDUNG.LOAIDUOC and TM_DUOC_HANDUNG.BENHVIEN_ID = 'HLU01')        inner join        (select LTRIM(A.KHODUOC_ID) + '_' + LTRIM(A.DUOC_ID) + '_' + LTRIM(ISNULL(A.NGUONDUOC_ID,'')) as DUOC_KEY, A.KHODUOC_ID, A.DUOC_ID,A.NGUONDUOC_ID,        SUM(isnull(A.SOLUONG,0)) as SOLUONG        from        (select SUM(SOLUONG) as SOLUONG, KHODUOC_ID, DUOC_ID, NGUONDUOC_ID from TT_DUOC_KYGUI_TONKHO        where BENHVIEN_ID = 'HLU01' group by KHODUOC_ID, DUOC_ID, NGUONDUOC_ID) A        group by LTRIM(A.KHODUOC_ID) + '_' + LTRIM(A.DUOC_ID) + '_' + LTRIM(A.NGUONDUOC_ID), A.KHODUOC_ID, A.DUOC_ID, A.NGUONDUOC_ID)        TT_TONKHO on TT_TONKHO.DUOC_ID = TM_DUOC.DUOC_ID        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = TT_TONKHO.NGUONDUOC_ID and nh.BENHVIEN_ID = 'HLU01'        LEFT JOIN TM_KHODUOC KD ON KD.KHODUOC_ID = TT_TONKHO.KHODUOC_ID        where TM_DUOC.BENHVIEN_ID = 'HLU01' AND TT_TONKHO.SOLUONG >= 0]
2019-09-20 17:41:15,796 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM018']
2019-09-20 17:41:15,941 [5] DEBUG - Statement Id: [DAO00027_GetListDuocTonKho] PreparedStatement : [select distinct TT_TONKHO.DUOC_KEY, LTRIM(TT_TONKHO.KHODUOC_ID) as KHODUOC_ID, TM_DUOC.DUOC_ID, TM_LOAIDUOC.MALOAIDUOC,TM_DUOC.SOVISA,TM_DUOC.TYLE_VAT,TM_DUOC.COTOA,        TM_DUOC.MADUOC, TM_DUOC.TENHANG, TM_DUOC.TENDUOCDAYDU, dvt.TENDONVITINH as DONVITINH,  TM_DUOC.DONVITINH_ID,TM_DUOC.BHYT,                TM_DUOC.TENHOATCHAT,          TM_DUOC.HAMLUONG, TM_DUOC.HANGSANXUAT, TM_DUOC.QUOCGIA, TM_DUOC.LOAIDUOC_ID, TM_DUOC.DUONGDUNG_ID,        TM_TENDUOC.TENDUOC, TM_TENDUOC.TENDUOC_EN, TM_TENDUOC.MAQUOCTE, TM_TENDUOC.MAQUOCTEBT,        TM_LOAIDUOC.LOAIVATTU_ID, TM_DUOC.BENHVIEN_ID,        TT_TONKHO.SOLUONG, TM_DUOC.VTYT_PHANLOAI, TM_DUOC.PHAMVI, TT_TONKHO.NGUONDUOC_ID, NG.TENNGUONDUOC AS TENNGUONDUOC        , TAMNGUNG = CASE WHEN TM_DUOC.TAMNGUNG = '1' OR NG.TAMNGUNG = '1' OR KD.TAMNGUNG = '1' THEN '1' ELSE '0' END        , TM_DUOC.DANGTRINHBAY        from TM_DUOC        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = TM_DUOC.DONVITINH_ID        left join TM_TENDUOC on TM_DUOC.TENDUOC_ID = TM_TENDUOC.TENDUOC_ID and TM_DUOC.BENHVIEN_ID = 'HLU01' and TM_DUOC.TAMNGUNG = '0'        left join TM_LOAIDUOC on TM_LOAIDUOC.LOAIDUOC_ID = TM_DUOC.LOAIDUOC_ID and TM_LOAIDUOC.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG on (TM_LOAIDUOC.LOAIVATTU_ID = TM_DUOC_HANDUNG.LOAIDUOC and TM_DUOC_HANDUNG.BENHVIEN_ID = 'HLU01')        inner join        (select LTRIM(A.KHODUOC_ID) + '_' + LTRIM(A.DUOC_ID) + '_' + LTRIM(ISNULL(A.NGUONDUOC_ID,'')) as DUOC_KEY, A.KHODUOC_ID, A.DUOC_ID, A.NGUONDUOC_ID,        SUM(isnull(A.SOLUONG,0)) as SOLUONG        from        (select SUM(SOLUONG) as SOLUONG, KHODUOC_ID, DUOC_ID, NGUONDUOC_ID from TT_DUOC_TONKHO        where BENHVIEN_ID = 'HLU01' group by KHODUOC_ID, DUOC_ID, NGUONDUOC_ID) A        group by LTRIM(A.KHODUOC_ID) + '_' + LTRIM(A.DUOC_ID) + '_' + LTRIM(ISNULL(A.NGUONDUOC_ID,'')), A.KHODUOC_ID, A.DUOC_ID, NGUONDUOC_ID        ) TT_TONKHO on TT_TONKHO.DUOC_ID = TM_DUOC.DUOC_ID        LEFT JOIN TM_NGUONHANG NG ON NG.NGUONDUOC_ID = TT_TONKHO.NGUONDUOC_ID        LEFT JOIN TM_KHODUOC KD ON KD.KHODUOC_ID = TT_TONKHO.KHODUOC_ID        where TM_DUOC.BENHVIEN_ID = 'HLU01' and TT_TONKHO.SOLUONG >= 0]
2019-09-20 17:41:19,113 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM023']
2019-09-20 17:41:19,150 [5] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoVaBooking] PreparedStatement : [declare @NGUONDUOC_MACDINH varchar(5) = '0';        declare @TOAMUANGOAI int = 0;        select @NGUONDUOC_MACDINH = isnull(VALUE,0) from TM_SYS_APPSETTINGS where CODE = 'PHA_NGUONDUOC'        select @TOAMUANGOAI = isnull(VALUE,0) from TM_SYS_APPSETTINGS where CODE = 'OPD_TOAMUANGOAI_DUNGDANHMUC_DUOC'                if @TOAMUANGOAI = 1        begin        select  distinct '0' + '_' + LTRIM(d.DUOC_ID) + '_' + @NGUONDUOC_MACDINH as DUOC_KEY, 0 as PHAMVI_ID, @NGUONDUOC_MACDINH as NGUONDUOC_ID, null as TENNGUONDUOC, null as TINHTIEN, d.DUOC_ID, ld.MALOAIDUOC,        d.SOVISA,d.TYLE_VAT,d.COTOA, d.MADUOC, d.TENHANG, d.TENDUOCDAYDU, d.DONVITINH as DONVITINH, d.BHYT,        d.TENHOATCHAT, d.HAMLUONG, d.HANGSANXUAT, d.QUOCGIA, d.LOAIDUOC_ID, d.DUONGDUNG_ID, d.TINHTIEN_PTTT,        ten.TENDUOC, ten.TENDUOC_EN, ten.MAQUOCTE, ten.MAQUOCTEBT,        '' as BHYT_TEXT        , ld.LOAIVATTU_ID        , d.BENHVIEN_ID,        999999999 as SOLUONG, d.VTYT_PHANLOAI, d.PHAMVI, d.SUASOLUONGTONGHOP, d.MADUOCBV, d.DANGTRINHBAY        , TAMNGUNG = CASE WHEN d.TAMNGUNG = '1' THEN '1' ELSE '0' END        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        union all        select  distinct tk.DUOC_KEY, LTRIM(tk.PHAMVI_ID) as PHAMVI_ID, tk.NGUONDUOC_ID, nh.TENNGUONDUOC, nh.TINHTIEN, d.DUOC_ID, ld.MALOAIDUOC,        d.SOVISA,d.TYLE_VAT,d.COTOA, d.MADUOC, d.TENHANG, d.TENDUOCDAYDU, d.DONVITINH as DONVITINH, d.BHYT,        d.TENHOATCHAT, d.HAMLUONG, d.HANGSANXUAT, d.QUOCGIA, d.LOAIDUOC_ID, d.DUONGDUNG_ID, d.TINHTIEN_PTTT,        ten.TENDUOC, ten.TENDUOC_EN, ten.MAQUOCTE, ten.MAQUOCTEBT,        CASE WHEN d.BHYT = '1' THEN 'BHYT' ELSE '' END as BHYT_TEXT        , ld.LOAIVATTU_ID        , d.BENHVIEN_ID,        tk.SOLUONG, d.VTYT_PHANLOAI, d.PHAMVI, d.SUASOLUONGTONGHOP, d.MADUOCBV, d.DANGTRINHBAY        , TAMNGUNG = CASE WHEN d.TAMNGUNG = '1' OR nh.TAMNGUNG = '1' OR kd.TAMNGUNG = '1' THEN '1' ELSE '0' END        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        inner join        (        select  LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')) DUOC_KEY, (SUM(dtk.SOLUONG) - isnull(sum(A.SOLUONG),0) - isnull(sum(B.SOLUONG),0)) SOLUONG, pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        from (select sum(soluong) soluong,duoc_id,nguonduoc_id,khoduoc_id,benhvien_id from TT_DUOC_TONKHO  group by duoc_id,nguonduoc_id,khoduoc_id,benhvien_id) dtk        inner join TM_DUOC_PHAMVISD_MAPPING pvsd on dtk.KHODUOC_ID = pvsd.KHODUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NOITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) B on B.DUOC_ID = dtk.DUOC_ID and B.SOLUONG > 0 and B.PHAMVI_ID = pvsd.PHAMVI_ID and B.NGUONHANG_ID = dtk.NGUONDUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NGOAITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) A on A.DUOC_ID = dtk.DUOC_ID and A.SOLUONG > 0 and A.PHAMVI_ID = pvsd.PHAMVI_ID and A.NGUONHANG_ID = dtk.NGUONDUOC_ID        where dtk.SOLUONG > 0 and dtk.BENHVIEN_ID = 'HLU01'        group by LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')), pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        ) tk on tk.DUOC_ID = d.DUOC_ID        left join TM_DUOC_PHAMVISUDUNG kd on kd.PHAMVI_ID = tk.PHAMVI_ID and kd.BENHVIEN_ID = 'HLU01'        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = tk.NGUONDUOC_ID and nh.BENHVIEN_ID = 'HLU01'        where d.BENHVIEN_ID = 'HLU01'  and tk.SOLUONG >= 0        end        else        begin                  select  distinct tk.DUOC_KEY, LTRIM(tk.PHAMVI_ID) as PHAMVI_ID, tk.NGUONDUOC_ID, nh.TENNGUONDUOC, nh.TINHTIEN, d.DUOC_ID, ld.MALOAIDUOC,        d.SOVISA,d.TYLE_VAT,d.COTOA, d.MADUOC, d.TENHANG, d.TENDUOCDAYDU, d.DONVITINH as DONVITINH, d.BHYT,        d.TENHOATCHAT, d.HAMLUONG, d.HANGSANXUAT, d.QUOCGIA, d.LOAIDUOC_ID, d.DUONGDUNG_ID, d.TINHTIEN_PTTT,        ten.TENDUOC, ten.TENDUOC_EN, ten.MAQUOCTE, ten.MAQUOCTEBT,        CASE WHEN d.BHYT = '1' THEN 'BHYT' ELSE '' END as BHYT_TEXT        , ld.LOAIVATTU_ID        , d.BENHVIEN_ID,        tk.SOLUONG, d.VTYT_PHANLOAI, d.PHAMVI, d.SUASOLUONGTONGHOP, d.MADUOCBV, d.DANGTRINHBAY        , TAMNGUNG = CASE WHEN d.TAMNGUNG = '1' OR nh.TAMNGUNG = '1' OR kd.TAMNGUNG = '1' THEN '1' ELSE '0' END        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        inner join        (        select  LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')) DUOC_KEY, (SUM(dtk.SOLUONG) - isnull(sum(A.SOLUONG),0) - isnull(sum(B.SOLUONG),0)) SOLUONG, pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        from (select sum(soluong) soluong,duoc_id,nguonduoc_id,khoduoc_id,benhvien_id from TT_DUOC_TONKHO  group by duoc_id,nguonduoc_id,khoduoc_id,benhvien_id) dtk        inner join TM_DUOC_PHAMVISD_MAPPING pvsd on dtk.KHODUOC_ID = pvsd.KHODUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NOITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) B on B.DUOC_ID = dtk.DUOC_ID and B.SOLUONG > 0 and B.PHAMVI_ID = pvsd.PHAMVI_ID and B.NGUONHANG_ID = dtk.NGUONDUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NGOAITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) A on A.DUOC_ID = dtk.DUOC_ID and A.SOLUONG > 0 and A.PHAMVI_ID = pvsd.PHAMVI_ID and A.NGUONHANG_ID = dtk.NGUONDUOC_ID        where dtk.SOLUONG > 0 and dtk.BENHVIEN_ID = 'HLU01'        group by LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')), pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        ) tk on tk.DUOC_ID = d.DUOC_ID        left join TM_DUOC_PHAMVISUDUNG kd on kd.PHAMVI_ID = tk.PHAMVI_ID and kd.BENHVIEN_ID = 'HLU01'        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = tk.NGUONDUOC_ID and nh.BENHVIEN_ID = 'HLU01'        where d.BENHVIEN_ID = 'HLU01'  and tk.SOLUONG >= 0        end]
2019-09-20 17:41:21,235 [5] DEBUG - Statement Id: [DAO00320_GetList] PreparedStatement : [select M.*            from TM_MAU M            LEFT JOIN TM_MAU_DONVITINH DVT on M.DONVITINH_ID=DVT.DONVITINH_ID            where            M.TAMNGUNG = '0'            and M.BENHVIEN_ID = 'HLU01'            order by M.TENMAU]
2019-09-20 17:41:21,518 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM071']
2019-09-20 17:41:21,565 [5] DEBUG - Statement Id: [DAO00322_GetListMauTonKhoForCreateCached] PreparedStatement : [SELECT DISTINCT          TK.MAU_KEY, TK.KHOMAU_ID, M.MAU_ID, M.MAMAU, M.TENMAU, M.NHOM_ABO, M.NHOM_RH, M.LOAIMAU_ID,          TK.SOLONHAP_ID, SLN.SOLONHAP, SLN.SOKIEMSOAT, TK.NGUONHANG_ID, NG.TENNGUONMAU, M.BENHVIEN_ID, M.DONVITINH_ID,          SUM(tk.SOLUONG) AS SOLUONG,K.TENKHO,DVT.TENDONVITINH          FROM TT_MAU_TONKHO TK          JOIN TM_KHO K ON TK.KHOMAU_ID = K.KHO_ID          JOIN TT_MAU_CHUNGTU_SOLONHAP SLN ON TK.SOLONHAP_ID = SLN.SOLONHAP_ID          JOIN TM_MAU M on TK.MAU_ID = M.MAU_ID and M.TAMNGUNG = '0'          LEFT JOIN TM_MAU_DONVITINH DVT on M.DONVITINH_ID=DVT.DONVITINH_ID          LEFT JOIN TM_NGUONMAU NG ON NG.NGUONMAU_ID = TK.NGUONHANG_ID          WHERE TK.SOLUONG > 0          GROUP BY TK.MAU_KEY, TK.KHOMAU_ID, M.MAU_ID, M.MAMAU, M.TENMAU, M.NHOM_ABO, M.NHOM_RH, M.LOAIMAU_ID,          TK.SOLONHAP_ID, SLN.SOLONHAP, SLN.SOKIEMSOAT,TK.NGUONHANG_ID, NG.TENNGUONMAU, M.BENHVIEN_ID, M.DONVITINH_ID,K.TENKHO,DVT.TENDONVITINH]
2019-09-20 17:41:21,685 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM073']
2019-09-20 17:41:21,729 [5] DEBUG - Statement Id: [DAO00322_GetListMauTonKhoTruBooking] PreparedStatement : [select distinct          TK.MAU_KEY, TK.KHOMAU_ID, M.MAU_ID, M.MAMAU, M.TENMAU, M.NHOM_ABO, M.NHOM_RH, M.LOAIMAU_ID, M.DONVITINH_ID,          TK.SOLONHAP_ID, TK.SOLONHAP, TK.SOKIEMSOAT,M.PHAMVI, TK.NGUONHANG_ID, NG.TENNGUONMAU, M.BENHVIEN_ID,          TK.SOLUONG,TK.TENKHO,DVT.TENDONVITINH          from TM_MAU M          JOIN          (          select          A.MAU_KEY, A.KHOMAU_ID, A.MAU_ID ,a.NGUONHANG_ID, A.SOLONHAP_ID, A.SOLONHAP, A.SOKIEMSOAT, A.SOLUONG,A.TENKHO          from          (          select KHOMAU_ID, TK.MAU_ID, TK.NGUONHANG_ID, TK.MAU_KEY, SLN.SOLONHAP_ID, SLN.SOLONHAP, SLN.SOKIEMSOAT, ISNULL(TK.SOLUONG,0) - ISNULL(book.SOLUONG,0) as SOLUONG,K.TENKHO          from TT_MAU_TONKHO TK          JOIN TM_KHO K ON TK.KHOMAU_ID = K.KHO_ID          inner join TT_MAU_CHUNGTU_SOLONHAP SLN ON TK.SOLONHAP_ID = SLN.SOLONHAP_ID          left join dbo.TT_MAU_TONKHO_BOOK book ON book.MAU_KEY = TK.MAU_KEY AND book.TRANGTHAI = 'HIEULUC'          where ISNULL(TK.SOLUONG,0) - ISNULL(book.SOLUONG,0) > 0          ) A          )TK on TK.MAU_ID = M.MAU_ID and M.TAMNGUNG = '0'          LEFT JOIN TM_MAU_DONVITINH DVT on M.DONVITINH_ID=DVT.DONVITINH_ID          LEFT JOIN TM_NGUONMAU NG ON NG.NGUONMAU_ID = TK.NGUONHANG_ID]
2019-09-20 17:41:21,799 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM072']
2019-09-20 17:41:22,715 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'MAIN'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2019-09-20 17:41:23,481 [1] DEBUG - Statement Id: [DAO00002_FormList] PreparedStatement : [select              TM_SYS_FORM.HOSPITAL_ID,              TM_SYS_FORM.NAME,              TM_SYS_FORM.CLASS,              TM_SYS_FORM.ASSEMBLY,              TM_SYS_FORM.TITLE_VI as TITLE              from TM_SYS_FORM              where HOSPITAL_ID = 'HLU01']
2019-09-20 17:41:28,095 [1] DEBUG - Statement Id: [DAO00300_GetShortcutListByUserID] PreparedStatement : [SELECT S.SHORTCUT_CODE, S.SHORTCUT_VALUE              FROM TM_SHORTCUT AS S              WHERE S.BENHVIEN_ID = 'HLU01' AND S.USER_ID = '1' AND TAMNGUNG = '0']
2019-09-20 17:41:28,127 [1] DEBUG - Statement Id: [DAO00087_GetList] PreparedStatement : [select CODE, VALUE, BENHVIEN_ID              from TM_SYS_APPSETTINGS              where LOCKED = '0' and BENHVIEN_ID = 'HLU01'              order by SETTING_ID]
2019-09-20 17:41:28,199 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'MSG01'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2019-09-20 17:41:28,354 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'MSG02'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2019-09-20 17:41:28,506 [1] DEBUG - Statement Id: [DAO00008_GetUserSettings] PreparedStatement : [select A.*, B.TENKHO , C.TENPHONGBAN, B.MAKHO, C.MAPHONGBAN          from TM_SYS_USERS A          left join TM_KHODUOC B on B.KHODUOC_ID = A.INVENTORY_ID          left join TM_PHONGBAN C on (C.PHONGBAN_ID = A.WORKING_DEPT_ID and C.BENHVIEN_ID =  @param0 )          left join TM_SYS_USERKHO D on (D.ACCOUNT_ID = A.ACCOUNT_ID and D.HOSPITAL_ID =  @param0 )          where          A.HOSPITAL_ID =  @param0            and                 A.ACCOUNT_ID =  @param1]
2019-09-20 17:41:28,508 [1] DEBUG - Statement Id: [DAO00008_GetUserSettings] Parameters: [@param0=[HOSPITAL_ID,HLU01], @param1=[ACCOUNT_ID,113]]
2019-09-20 17:41:28,508 [1] DEBUG - Statement Id: [DAO00008_GetUserSettings] Types: [@param0=[String, System.String], @param1=[String, System.String]]
2019-09-20 17:41:28,540 [1] DEBUG - Statement Id: [DAO00008_GetUserInvSettings] PreparedStatement : [select A.*, B.TENKHO, B.MAKHO, B.LOAIKHO_ID, B.KHOQUANLY_ID          from TM_SYS_USERKHO A          left join TM_KHO B on B.MODULE_ID = A.MODULE_ID and B.KHO_ID = A.KHO_ID          where A.HOSPITAL_ID =  @param0  and A.ACCOUNT_ID =  @param1           order by B.TENKHO]
2019-09-20 17:41:28,540 [1] DEBUG - Statement Id: [DAO00008_GetUserInvSettings] Parameters: [@param0=[HOSPITAL_ID,HLU01], @param1=[ACCOUNT_ID,113]]
2019-09-20 17:41:28,540 [1] DEBUG - Statement Id: [DAO00008_GetUserInvSettings] Types: [@param0=[String, System.String], @param1=[String, System.String]]
2019-09-20 17:41:28,682 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'COM30'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2019-09-20 17:41:28,854 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'RIS04'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2019-09-20 17:41:35,841 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'MENU1'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2019-09-20 17:41:35,934 [1] DEBUG - Statement Id: [DAO00011_GetList] PreparedStatement : [select              TM_SYS_MENU.ID,              TM_SYS_MENU.PARENTID,              TM_SYS_MENU.SCREEN,              TM_SYS_MENU.SMALLIMAGE,              TM_SYS_MENU.LARGEIMAGE,              TM_SYS_MENU.DESCRIPTION,              TM_SYS_MENU.TYPE,              TM_SYS_MENU.TITLE_VI as TITLE              from TM_SYS_MENU              where TM_SYS_MENU.HOSPITAL_ID = 'HLU01' and TM_SYS_MENU.ACTIVE = '1'               AND                   (TM_SYS_MENU.TYPE & '8' = '8')                             order by TM_SYS_MENU.ORDERNUM]
2019-09-20 17:41:36,190 [1] DEBUG - Statement Id: [DAO00011_usermenu_list] PreparedStatement : [select              TM_SYS_HOMEMENU.MENUID as ID,              TM_SYS_MENU.TITLE_VI as TITLE,              TM_SYS_MENU.SCREEN,              TM_SYS_MENU.SMALLIMAGE,              TM_SYS_MENU.LARGEIMAGE,              TM_SYS_MENU.TYPE              from TM_SYS_HOMEMENU              left join TM_SYS_MENU on TM_SYS_MENU.ID = TM_SYS_HOMEMENU.MENUID and TM_SYS_MENU.HOSPITAL_ID = TM_SYS_HOMEMENU.HOSPITAL_ID              where TM_SYS_HOMEMENU.HOSPITAL_ID = 'HLU01' and TM_SYS_HOMEMENU.USERID = '113' and TM_SYS_MENU.ACTIVE = '1'               AND                   (TM_SYS_MENU.TYPE & '8' = '8')                             ORDER BY TM_SYS_HOMEMENU.ORDERNUM]
2019-09-20 17:42:44,312 [1] DEBUG - Statement Id: [DAO00087_GetServiceParams] PreparedStatement : [select CODE, VALUE              from TM_SYS_APPSETTINGS              where LOCKED = '0' and BENHVIEN_ID = 'HLU01']
2019-09-20 17:42:44,720 [1] DEBUG - Statement Id: [DAO00030_GetMucDichChungTuID] PreparedStatement : [SELECT DICTIONARY_ID              FROM              LST_DICTIONARY              WHERE              DICTIONARY_TYPE_CODE = 'MucDichChungTu'              and DICTIONARY_CODE = 'X13']
2019-09-20 17:42:44,874 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'PHA22'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2019-09-20 17:42:45,490 [1] DEBUG - Statement Id: [DAO00030_GET_SOLONHAP] PreparedStatement : [SELECT DISTINCT            SLN.SOLONHAP_ID, SLN.SOLONHAP, SLN.SOLOSANPHAM, SLN.SOKIEMSOAT, SLN.SOVISA, CONVERT(varchar(20), SLN.SOLOSANPHAM) + '/' + CONVERT(varchar(20), TK.SOLUONG) AS SOLOSOTON,            SLN.NGAYNHAP AS NGAYNHAPLO, SLN.HANDUNG AS HANSUDUNG,  SLN.HANDUNG, SLN.NGUONDUOC_ID, SLN.NGUONDUOC_ID as NGUONHANG_ID,            SLNGB.DONGIAMUA, SLNGB.DONGIAVON, SLNGB.TYLEVAT_DAUVAO as TYLEVAT, d.TYLE_VAT, SLNGB.DONGIAVONVAT, SLNGB.DONGIABAN, SLNGB.DONGIABANVAT_DAUVAO as DONGIABAN_VAT,            TK.DUOCTONKHO_ID, TK.KHODUOC_ID, TK.DUOC_ID, TK.SOLUONG, TK.SOLUONG AS SOLUONGTON,            D.TENDUOCDAYDU,D.DONVITINH_ID, D.DONVITINH, D.BHYT, NH.TENNGUONDUOC AS NGUONHANG,            LTRIM(TK.KHODUOC_ID) + '_' + LTRIM(TK.DUOC_ID) + '_' + LTRIM(TK.NGUONDUOC_ID) as DUOC_KEY, D.SO_QDTT            FROM            TT_DUOC_CHUNGTU_SOLONHAP SLN,            TT_DUOC_TONKHO TK,            TT_DUOC_SOLONHAP_GIABAN SLNGB,            TM_DUOC D,            TM_NGUONHANG NH            WHERE            SLN.SOLONHAP_ID = TK.SOLONHAP_ID            AND SLN.SOLONHAP_ID = SLNGB.SOLONHAP_ID            AND SLN.NGUONDUOC_ID = NH.NGUONDUOC_ID            AND SLN.DUOC_ID = D.DUOC_ID            AND TK.DUOC_ID = ''            AND TK.KHODUOC_ID = ''            AND SLN.BENHVIEN_ID = 'HLU01'            AND TK.SOLUONG > 0                 and                     SLN.NGUONDUOC_ID = '1'                                      ORDER BY NGAYNHAP]
2019-09-20 17:42:45,570 [1] DEBUG - Statement Id: [DAO00030_GetMucDichChungTuID] PreparedStatement : [SELECT DICTIONARY_ID              FROM              LST_DICTIONARY              WHERE              DICTIONARY_TYPE_CODE = 'MucDichChungTu'              and DICTIONARY_CODE = 'X13']
2019-09-20 17:42:45,685 [1] DEBUG - Statement Id: [DAO00030_GetMucDichChungTuID] PreparedStatement : [SELECT DICTIONARY_ID              FROM              LST_DICTIONARY              WHERE              DICTIONARY_TYPE_CODE = 'MucDichChungTu'              and DICTIONARY_CODE = 'X13']
2019-09-20 17:42:46,661 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'PHA74'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2019-09-20 17:42:48,488 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'COM98'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2019-09-20 17:42:49,296 [1] DEBUG - Statement Id: [DAO00030_Search_PhieuXuatSD] PreparedStatement : [SELECT DISTINCT phieuxuat.* FROM          (          select DISTINCT          CT.CHUNGTU_ID,          CT.SOCHUNGTU,          CT.MACHUNGTU,          CT.NGAYCHUNGTU,          CT.NGAYTAO,          CT.KHOXUAT_ID,          CT.NGUOIGIAO_ID,          CT.KHONHAP_ID,          CT.NGUOINHAN_ID,          PL.MACHUNGTU as MAPHIEULINH,          PL.NGAYCHUNGTU as NGAYPHIEULINH,          bn.MAYTE,          bn.TENBENHNHAN,          CONVERT(VARCHAR(10), KB.THOIGIANKHAM, 103) + ' - ' + CONVERT(VARCHAR(5), KB.THOIGIANKHAM, 108) as THOIGIANKHAM,          nl.TENNHANVIEN as NGUOILAP,          CT.DIENGIAI          from TT_DUOC_CHUNGTU CT          inner join TT_DUOC_CHUNGTU_CHITIET ctct on ct.CHUNGTU_ID = ctct.CHUNGTU_ID          inner join TT_NOITRU_TOATHUOC TT on ctct.TOATHUOCNOITRU_ID = TT.TOATHUOC_ID          inner join TT_NOITRU_KHAMBENH KB on kb.KHAMBENH_ID = TT.KHAMBENH_ID          inner join TT_BENHNHAN BN on TT.BENHNHAN_ID = BN.BENHNHAN_ID          left join TT_DUOC_PHIEULINH PL on PL.CHUNGTU_ID = CT.PHIEULINH_ID          left join TM_NHANVIEN nl on nl.NHANVIEN_ID = TT.NGUOITAO_ID           where                   CT.MUCDICHCHUNGTU_ID = '1060'               and                 CT.KHOXUAT_ID = '32'               and                 CONVERT(date, CT.NGAYCHUNGTU) BETWEEN CONVERT(date, '9/20/2019 12:00:00 AM')  and  CONVERT(date, '9/20/2019 12:00:00 AM')               and                 CT.BENHVIEN_ID = 'HLU01'                           UNION            select DISTINCT          CT.CHUNGTU_ID,          CT.SOCHUNGTU,          CT.MACHUNGTU,          CT.NGAYCHUNGTU,          CT.NGAYTAO,          CT.KHOXUAT_ID,          CT.NGUOIGIAO_ID,          CT.KHONHAP_ID,          CT.NGUOINHAN_ID,          PL.MACHUNGTU as MAPHIEULINH,          PL.NGAYCHUNGTU as NGAYPHIEULINH,          bn.MAYTE,          bn.TENBENHNHAN,          CONVERT(VARCHAR(10), KB.THOIGIANKHAM, 103) + ' - ' + CONVERT(VARCHAR(5), KB.THOIGIANKHAM, 108) as THOIGIANKHAM,          nl.TENNHANVIEN as NGUOILAP,          CT.DIENGIAI          from TT_DUOC_CHUNGTU CT          inner join TT_DUOC_CHUNGTU_CHITIET ctct on ct.CHUNGTU_ID = ctct.CHUNGTU_ID          inner join TT_NGOAITRU_KHAMBENH_VTYT vt on ctct.KHAMBENH_VTYT_ID = vt.KHAMBENH_VTYT_ID          inner join TT_NGOAITRU_KHAMBENH kb on kb.KHAMBENH_ID = vt.KHAMBENH_ID          inner join TT_BENHNHAN BN on bn.BENHNHAN_ID = kb.BENHNHAN_ID          left join TT_DUOC_PHIEULINH PL on PL.CHUNGTU_ID = CT.PHIEULINH_ID          left join TM_NHANVIEN nl on nl.NHANVIEN_ID = vt.NGUOITAO_ID           where                   CT.MUCDICHCHUNGTU_ID = '1060'               and                 CT.KHOXUAT_ID = '32'               and                 CONVERT(date, CT.NGAYCHUNGTU) BETWEEN CONVERT(date, '9/20/2019 12:00:00 AM')  and  CONVERT(date, '9/20/2019 12:00:00 AM')               and                 CT.BENHVIEN_ID = 'HLU01'                           UNION            select DISTINCT          CT.CHUNGTU_ID,          CT.SOCHUNGTU,          CT.MACHUNGTU,          CT.NGAYCHUNGTU,          CT.NGAYTAO,          CT.KHOXUAT_ID,          CT.NGUOIGIAO_ID,          CT.KHONHAP_ID,          CT.NGUOINHAN_ID,          PL.MACHUNGTU as MAPHIEULINH,          PL.NGAYCHUNGTU as NGAYPHIEULINH,          bn.MAYTE,          bn.TENBENHNHAN,          CONVERT(VARCHAR(10), pt.NGAYTHUCHIEN, 103) + ' - ' + CONVERT(VARCHAR(5), pt.NGAYTHUCHIEN, 108) as THOIGIANKHAM,          nl.TENNHANVIEN as NGUOILAP,          CT.DIENGIAI          from TT_DUOC_CHUNGTU CT          inner join TT_DUOC_CHUNGTU_CHITIET ctct on ct.CHUNGTU_ID = ctct.CHUNGTU_ID          inner join TT_PHAUTHUAT_VTYT vt on ctct.PHAUTHUAT_VTYT_ID = vt.PHAUTHUAT_VTYT_ID          inner join TT_PHAUTHUAT pt on pt.PHAUTHUAT_ID = vt.PHAUTHUAT_ID          inner join TT_TIEPNHAN tn on tn.TIEPNHAN_ID = pt.TIEPNHAN_ID          inner join TT_BENHNHAN bn on bn.BENHNHAN_ID = tn.BENHNHAN_ID          left join TT_DUOC_PHIEULINH PL on PL.CHUNGTU_ID = CT.PHIEULINH_ID          left join TM_NHANVIEN nl on nl.NHANVIEN_ID = pt.NGUOITAO_ID           where                   CT.MUCDICHCHUNGTU_ID = '1060'               and                 CT.KHOXUAT_ID = '32'               and                 CONVERT(date, CT.NGAYCHUNGTU) BETWEEN CONVERT(date, '9/20/2019 12:00:00 AM')  and  CONVERT(date, '9/20/2019 12:00:00 AM')               and                 CT.BENHVIEN_ID = 'HLU01'                           UNION            select DISTINCT          CT.CHUNGTU_ID,          CT.SOCHUNGTU,          CT.MACHUNGTU,          CT.NGAYCHUNGTU,          CT.NGAYTAO,          CT.KHOXUAT_ID,          CT.NGUOIGIAO_ID,          CT.KHONHAP_ID,          CT.NGUOINHAN_ID,          PL.MACHUNGTU as MAPHIEULINH,          PL.NGAYCHUNGTU as NGAYPHIEULINH,          bn.MAYTE,          bn.TENBENHNHAN,          CONVERT(VARCHAR(10), cls.NGAYTAO, 103) + ' - ' + CONVERT(VARCHAR(5), cls.NGAYTAO, 108) as THOIGIANKHAM,          nl.TENNHANVIEN as NGUOILAP,          CT.DIENGIAI          from TT_DUOC_CHUNGTU CT          inner join TT_DUOC_CHUNGTU_CHITIET ctct on ct.CHUNGTU_ID = ctct.CHUNGTU_ID          inner join TT_CLSKETQUA_VTYT cls on ctct.CLSKETQUA_VTYT_ID = cls.CLSKETQUA_VTYT_ID          inner join TT_DVYEUCAU DV on DV.DVYEUCAU_ID = CLS.DVYEUCAU_ID          inner join TT_BENHNHAN bn on bn.BENHNHAN_ID = DV.BENHNHAN_ID          left join TT_DUOC_PHIEULINH PL on PL.CHUNGTU_ID = CT.PHIEULINH_ID          left join TM_NHANVIEN nl on nl.NHANVIEN_ID = cls.NGUOITAO_ID           where                   CT.MUCDICHCHUNGTU_ID = '1060'               and                 CT.KHOXUAT_ID = '32'               and                 CONVERT(date, CT.NGAYCHUNGTU) BETWEEN CONVERT(date, '9/20/2019 12:00:00 AM')  and  CONVERT(date, '9/20/2019 12:00:00 AM')               and                 CT.BENHVIEN_ID = 'HLU01'                           UNION            select DISTINCT          CT.CHUNGTU_ID,          CT.SOCHUNGTU,          CT.MACHUNGTU,          CT.NGAYCHUNGTU,          CT.NGAYTAO,          CT.KHOXUAT_ID,          CT.NGUOIGIAO_ID,          CT.KHONHAP_ID,          CT.NGUOINHAN_ID,          PL.MACHUNGTU as MAPHIEULINH,          PL.NGAYCHUNGTU as NGAYPHIEULINH,          null as MAYTE,          null as TENBENHNHAN,          null as THOIGIANKHAM,          nl.TENNHANVIEN as NGUOILAP,          CT.DIENGIAI          from TT_DUOC_CHUNGTU CT          inner join TT_DUOC_CHUNGTU_CHITIET ctct on ct.CHUNGTU_ID = ctct.CHUNGTU_ID          left join TT_DUOC_PHIEULINH PL on PL.CHUNGTU_ID = CT.PHIEULINH_ID          left join TM_NHANVIEN nl on nl.NHANVIEN_ID = ct.NGUOITAO_ID          WHERE (ctct.TOATHUOCNOITRU_ID IS NULL AND ctct.KHAMBENH_VTYT_ID IS NULL AND ctct.PHAUTHUAT_VTYT_ID IS NULL AND ctct.CLSKETQUA_VTYT_ID IS NULL)             and                 CT.MUCDICHCHUNGTU_ID = '1060'               and                 CT.KHOXUAT_ID = '32'               and                 CONVERT(date, CT.NGAYCHUNGTU) BETWEEN CONVERT(date, '9/20/2019 12:00:00 AM')  and  CONVERT(date, '9/20/2019 12:00:00 AM')               and                 CT.BENHVIEN_ID = 'HLU01'                         )PhieuXuat          ORDER BY PhieuXuat.CHUNGTU_ID desc]
2019-09-20 17:42:52,437 [1] DEBUG - Statement Id: [DAO00030_GetList] PreparedStatement : [select *              from TT_DUOC_CHUNGTU              where BENHVIEN_ID = 'HLU01'                and                   TT_DUOC_CHUNGTU.CHUNGTU_ID = '137704'                               order by CHUNGTU_ID]
2019-09-20 17:42:52,563 [1] DEBUG - Statement Id: [DAO00030_CHUNGTUXUAT_CHITIET_GetList] PreparedStatement : [SELECT            ctct.*,            d.MADUOC, d.TENHANG, d.TENDUOCDAYDU, dvt.TENDONVITINH as DONVITINH,n.TENNGUONDUOC as NGUONHANG,            sln.SOLONHAP, sln.SOLOSANPHAM, sln.NGAYNHAP as NGAYNHAPLO, sln.HANDUNG as HANSUDUNG,            isnull(tk.SOLUONG,0) as SOLUONGTON,            LTRIM(ct.KHOXUAT_ID) + '_' + LTRIM(sln.DUOC_ID) + '_' + LTRIM(sln.NGUONDUOC_ID) as DUOC_KEY            , NLD.MANHOMLOAIDUOC, ld.MALOAIDUOC, D.SO_QDTT            FROM            TT_DUOC_CHUNGTU_CHITIET ctct            INNER JOIN TT_DUOC_CHUNGTU ct ON (ct.CHUNGTU_ID = ctct.CHUNGTU_ID)            INNER JOIN TT_DUOC_CHUNGTU_SOLONHAP sln ON (sln.SOLONHAP_ID = ctct.SOLONHAP_ID)            LEFT JOIN (            select xx.DUOCTONKHO_ID, xx.KHODUOC_ID, xx.DUOC_ID, xx.SOLONHAP_ID, xx.SOLUONG, xx.NGUONDUOC_ID, xx.BENHVIEN_ID from TT_DUOC_TONKHO xx            join ( select max(DUOCTONKHO_ID) as DUOCTONKHO_ID, KHODUOC_ID, DUOC_ID, SOLONHAP_ID, NGUONDUOC_ID            from TT_DUOC_TONKHO group by KHODUOC_ID, DUOC_ID, SOLONHAP_ID, NGUONDUOC_ID) yy on xx.DUOCTONKHO_ID=yy.DUOCTONKHO_ID            ) tk ON (tk.SOLONHAP_ID = sln.SOLONHAP_ID AND tk.DUOC_ID = sln.DUOC_ID and tk.KHODUOC_ID = ct.KHOXUAT_ID)            INNER JOIN TM_DUOC d ON (d.DUOC_ID = ctct.DUOC_ID)            INNER JOIN TM_NGUONHANG n ON (n.NGUONDUOC_ID = ctct.NGUONHANG_ID)            LEFT JOIN TM_DONVITINH dvt ON (dvt.DONVITINH_ID = ctct.DONVITINH_ID)            left join TM_LOAIDUOC LD on LD.LOAIDUOC_ID = D.LOAIDUOC_ID            LEFT JOIN TM_NHOMLOAIDUOC NLD on NLD.NHOMLOAIDUOC_ID = LD.NHOMLOAIDUOC_ID             where                             ct.CHUNGTU_ID = '137704'                       and                           ct.BENHVIEN_ID = 'HLU01'                                     order by CHUNGTUCHITIET_ID]
2019-09-20 17:42:53,091 [1] DEBUG - Statement Id: [DAO00030_KiemTraChungTuKhoaSo] PreparedStatement : [SELECT CHUNGTU_ID              FROM TT_DUOC_CHUNGTU              WHERE              MACHUNGTU = 'CS_KBX1319003092'              and BENHVIEN_ID = 'HLU01'              and              convert(date, NGAYCHUNGTU) <=              (              SELECT TOP 1 convert(date, KHOADENNGAY)              FROM TT_DUOC_KHOASOCHUNGTU              WHERE              KHODUOC_ID = '32'              and BENHVIEN_ID = 'HLU01'              AND KHOASO = '1'              ORDER BY KHOADENNGAY DESC              )]
2019-09-20 17:42:53,249 [1] DEBUG - Statement Id: [DAO00030_KiemTraChungTuDaChuyenKeToan] PreparedStatement : [SELECT CHUNGTU_ID            FROM TT_DUOC_CHUNGTU            WHERE            CHUNGTU_ID = '137704'            and IDCHUYEN IS NOT NULL            and BENHVIEN_ID = 'HLU01']
2019-09-20 17:42:53,278 [1] DEBUG - Statement Id: [DAO00030_KiemTraBenhNhanXuatVien] PreparedStatement : [select              TT.TOATHUOC_ID              from              TT_NOITRU_TOATHUOC TT              inner join TT_NOITRU_KHAMBENH KB on TT.KHAMBENH_ID = KB.KHAMBENH_ID              inner join TT_NOITRU_BENHAN BA on BA.BENHAN_ID = KB.BENHAN_ID              WHERE              BA.TRANGTHAI = 'DAXUATVIEN'              AND TT.CHUNGTU_ID =  137704              and TT.BENHVIEN_ID = 'HLU01']
2019-09-20 17:42:53,463 [1] DEBUG - Statement Id: [DAO00030_DUOCTONKHO_GetSoTonTheoDuoc] PreparedStatement : [SELECT              DUOC_ID,              SUM(SOLUONG) AS TONGTON              FROM              TT_DUOC_TONKHO              WHERE              KHODUOC_ID = '32'              and BENHVIEN_ID = 'HLU01'              and DUOC_ID IN (1)              GROUP BY DUOC_ID]
2019-09-20 17:42:53,528 [1] DEBUG - Statement Id: [DAO00030_DUOCTONKHO_GetSoTonTheoDuocTheoLo] PreparedStatement : [SELECT              DUOC_ID,SOLONHAP_ID,              SUM(SOLUONG) AS SOLUONGTONLO              FROM              TT_DUOC_TONKHO              WHERE              KHODUOC_ID = '32'              and BENHVIEN_ID = 'HLU01'              and DUOC_ID IN (1)              and SOLONHAP_ID IN (7541)              GROUP BY DUOC_ID, SOLONHAP_ID]
2019-09-20 17:42:53,564 [1] DEBUG - Statement Id: [DAO00030_DUOCTONKHO_GetSoTonTheoDuoc] PreparedStatement : [SELECT              DUOC_ID,              SUM(SOLUONG) AS TONGTON              FROM              TT_DUOC_TONKHO              WHERE              KHODUOC_ID = '32'              and BENHVIEN_ID = 'HLU01'              and DUOC_ID IN (1)              GROUP BY DUOC_ID]
2019-09-20 17:42:53,641 [1] DEBUG - Statement Id: [DAO00030_KTDaPhatSinhBienLai] PreparedStatement : [SELECT CHUNGTU_ID            FROM TT_NOITRU_TOATHUOC tt            INNER JOIN TT_VIENPHI vp on (tt.TOATHUOC_ID = vp.REF_ID and REF_TABLE = 'TT_NOITRU_TOATHUOC')            WHERE            CHUNGTU_ID = '137704'            AND tt.BENHVIEN_ID = 'HLU01'            AND HOADON_ID is not NULL            AND vp.HUY = '0'              union all            SELECT  kbtt.CHUNGTUPHATTHUOC_ID as CHUNGTU_ID            FROM TT_NGOAITRU_TOATHUOC tt            INNER JOIN TT_NGOAITRU_KHAMBENH_TOATHUOC kbtt on (kbtt.KHAMBENH_TOATHUOC_ID = tt.KHAMBENH_TOATHUOC_ID)            INNER JOIN TT_VIENPHI vp on (tt.TOATHUOC_ID = vp.REF_ID and REF_TABLE = 'TT_NGOAITRU_TOATHUOC')            WHERE            kbtt.CHUNGTUPHATTHUOC_ID = '137704'            AND tt.BENHVIEN_ID = 'HLU01'            AND HOADON_ID is not NULL            AND vp.HUY = '0'              union all            SELECT ctct.CHUNGTU_ID from            TT_DUOC_CHUNGTU_CHITIET ctct            INNER JOIN TT_HOADON_CHITIET_NGOAITRU hdct on (hdct.REF_ID = ctct.CHUNGTUCHITIET_ID and hdct.REF_TABLE = 'TT_DUOC_CHUNGTU_CHITIET')            INNER JOIN TT_HOADON hd on hd.HOADON_ID = hdct.HOADON_ID            WHERE            ctct.CHUNGTU_ID = '137704'                            AND hd.HUYHOADON = '0'              AND hd.HOANTRA = '0'                                  AND ctct.BENHVIEN_ID = 'HLU01'                        union all            SELECT CHUNGTU_ID            FROM TT_NGOAITRU_KHAMBENH_VTYT tt            INNER JOIN TT_VIENPHI vp on (tt.KHAMBENH_VTYT_ID = vp.REF_ID and REF_TABLE = 'TT_NGOAITRU_KHAMBENH_VTYT')            WHERE            CHUNGTU_ID = '137704'            AND tt.BENHVIEN_ID = 'HLU01'            AND HOADON_ID is not NULL            AND vp.HUY = '0'                        union all            SELECT CHUNGTU_ID            FROM TT_PHAUTHUAT_VTYT tt            INNER JOIN TT_VIENPHI vp on (tt.PHAUTHUAT_VTYT_ID = vp.REF_ID and REF_TABLE = 'TT_PHAUTHUAT_VTYT')            WHERE            CHUNGTU_ID = '137704'            AND tt.BENHVIEN_ID = 'HLU01'            AND HOADON_ID is not NULL            AND vp.HUY = '0'                        union all            SELECT CHUNGTU_ID            FROM TT_CLSKETQUA_VTYT tt            INNER JOIN TT_VIENPHI vp on (tt.CLSKETQUA_VTYT_ID = vp.REF_ID and REF_TABLE = 'TT_CLSKETQUA_VTYT')            WHERE            CHUNGTU_ID = '137704'            AND tt.BENHVIEN_ID = 'HLU01'            AND HOADON_ID is not NULL            AND vp.HUY = '0']
2019-09-20 17:42:59,609 [1] DEBUG - Statement Id: [DAO00030_KTDaPhatSinhBienLai] PreparedStatement : [SELECT CHUNGTU_ID            FROM TT_NOITRU_TOATHUOC tt            INNER JOIN TT_VIENPHI vp on (tt.TOATHUOC_ID = vp.REF_ID and REF_TABLE = 'TT_NOITRU_TOATHUOC')            WHERE            CHUNGTU_ID = '137704'            AND tt.BENHVIEN_ID = 'HLU01'            AND HOADON_ID is not NULL            AND vp.HUY = '0'              union all            SELECT  kbtt.CHUNGTUPHATTHUOC_ID as CHUNGTU_ID            FROM TT_NGOAITRU_TOATHUOC tt            INNER JOIN TT_NGOAITRU_KHAMBENH_TOATHUOC kbtt on (kbtt.KHAMBENH_TOATHUOC_ID = tt.KHAMBENH_TOATHUOC_ID)            INNER JOIN TT_VIENPHI vp on (tt.TOATHUOC_ID = vp.REF_ID and REF_TABLE = 'TT_NGOAITRU_TOATHUOC')            WHERE            kbtt.CHUNGTUPHATTHUOC_ID = '137704'            AND tt.BENHVIEN_ID = 'HLU01'            AND HOADON_ID is not NULL            AND vp.HUY = '0'              union all            SELECT ctct.CHUNGTU_ID from            TT_DUOC_CHUNGTU_CHITIET ctct            INNER JOIN TT_HOADON_CHITIET_NGOAITRU hdct on (hdct.REF_ID = ctct.CHUNGTUCHITIET_ID and hdct.REF_TABLE = 'TT_DUOC_CHUNGTU_CHITIET')            INNER JOIN TT_HOADON hd on hd.HOADON_ID = hdct.HOADON_ID            WHERE            ctct.CHUNGTU_ID = '137704'                            AND hd.HUYHOADON = '0'              AND hd.HOANTRA = '0'                                  AND ctct.BENHVIEN_ID = 'HLU01'                        union all            SELECT CHUNGTU_ID            FROM TT_NGOAITRU_KHAMBENH_VTYT tt            INNER JOIN TT_VIENPHI vp on (tt.KHAMBENH_VTYT_ID = vp.REF_ID and REF_TABLE = 'TT_NGOAITRU_KHAMBENH_VTYT')            WHERE            CHUNGTU_ID = '137704'            AND tt.BENHVIEN_ID = 'HLU01'            AND HOADON_ID is not NULL            AND vp.HUY = '0'                        union all            SELECT CHUNGTU_ID            FROM TT_PHAUTHUAT_VTYT tt            INNER JOIN TT_VIENPHI vp on (tt.PHAUTHUAT_VTYT_ID = vp.REF_ID and REF_TABLE = 'TT_PHAUTHUAT_VTYT')            WHERE            CHUNGTU_ID = '137704'            AND tt.BENHVIEN_ID = 'HLU01'            AND HOADON_ID is not NULL            AND vp.HUY = '0'                        union all            SELECT CHUNGTU_ID            FROM TT_CLSKETQUA_VTYT tt            INNER JOIN TT_VIENPHI vp on (tt.CLSKETQUA_VTYT_ID = vp.REF_ID and REF_TABLE = 'TT_CLSKETQUA_VTYT')            WHERE            CHUNGTU_ID = '137704'            AND tt.BENHVIEN_ID = 'HLU01'            AND HOADON_ID is not NULL            AND vp.HUY = '0']
2019-09-20 17:42:59,860 [1] DEBUG - Statement Id: [DAO00030_KTDaPhatSinhPhieuBHTN] PreparedStatement : [SELECT vp.VIENPHI_ID              FROM TT_VIENPHI vp              INNER JOIN TT_MIENGIAM_CHITIET  mgct on mgct.VIENPHI_ID = vp.VIENPHI_ID              INNER JOIN TT_DUOC_CHUNGTU ct on ct.TIEPNHAN_ID = vp.TIEPNHAN_ID              WHERE              ct.CHUNGTU_ID = '137704'              AND vp.DUOC_ID is not null              AND vp.BENHVIEN_ID = 'HLU01']
2019-09-20 17:42:59,945 [1] DEBUG - Statement Id: [DAO00030_KiemTraBenhNhanXuatVien] PreparedStatement : [select              TT.TOATHUOC_ID              from              TT_NOITRU_TOATHUOC TT              inner join TT_NOITRU_KHAMBENH KB on TT.KHAMBENH_ID = KB.KHAMBENH_ID              inner join TT_NOITRU_BENHAN BA on BA.BENHAN_ID = KB.BENHAN_ID              WHERE              BA.TRANGTHAI = 'DAXUATVIEN'              AND TT.CHUNGTU_ID =  137704              and TT.BENHVIEN_ID = 'HLU01']
2019-09-20 17:43:00,104 [1] DEBUG - Statement Id: [DAO00030_KiemTraChungTuKhoaSo] PreparedStatement : [SELECT CHUNGTU_ID              FROM TT_DUOC_CHUNGTU              WHERE              MACHUNGTU = 'CS_KBX1319003092'              and BENHVIEN_ID = 'HLU01'              and              convert(date, NGAYCHUNGTU) <=              (              SELECT TOP 1 convert(date, KHOADENNGAY)              FROM TT_DUOC_KHOASOCHUNGTU              WHERE              KHODUOC_ID = '32'              and BENHVIEN_ID = 'HLU01'              AND KHOASO = '1'              ORDER BY KHOADENNGAY DESC              )]
2019-09-20 17:43:09,256 [1] DEBUG - Statement Id: [DAO00030_KiemTraChungTuKhoaSo] PreparedStatement : [SELECT CHUNGTU_ID              FROM TT_DUOC_CHUNGTU              WHERE              MACHUNGTU = 'CS_KBX1319003092'              and BENHVIEN_ID = 'HLU01'              and              convert(date, NGAYCHUNGTU) <=              (              SELECT TOP 1 convert(date, KHOADENNGAY)              FROM TT_DUOC_KHOASOCHUNGTU              WHERE              KHODUOC_ID = '32'              and BENHVIEN_ID = 'HLU01'              AND KHOASO = '1'              ORDER BY KHOADENNGAY DESC              )]
2019-09-20 17:43:09,288 [1] DEBUG - Statement Id: [DAO00030_KiemTraChungTuDaChuyenKeToan] PreparedStatement : [SELECT CHUNGTU_ID            FROM TT_DUOC_CHUNGTU            WHERE            CHUNGTU_ID = '137704'            and IDCHUYEN IS NOT NULL            and BENHVIEN_ID = 'HLU01']
2019-09-20 17:43:09,319 [1] DEBUG - Statement Id: [DAO00030_KTDaPhatSinhBienLai] PreparedStatement : [SELECT CHUNGTU_ID            FROM TT_NOITRU_TOATHUOC tt            INNER JOIN TT_VIENPHI vp on (tt.TOATHUOC_ID = vp.REF_ID and REF_TABLE = 'TT_NOITRU_TOATHUOC')            WHERE            CHUNGTU_ID = '137704'            AND tt.BENHVIEN_ID = 'HLU01'            AND HOADON_ID is not NULL            AND vp.HUY = '0'              union all            SELECT  kbtt.CHUNGTUPHATTHUOC_ID as CHUNGTU_ID            FROM TT_NGOAITRU_TOATHUOC tt            INNER JOIN TT_NGOAITRU_KHAMBENH_TOATHUOC kbtt on (kbtt.KHAMBENH_TOATHUOC_ID = tt.KHAMBENH_TOATHUOC_ID)            INNER JOIN TT_VIENPHI vp on (tt.TOATHUOC_ID = vp.REF_ID and REF_TABLE = 'TT_NGOAITRU_TOATHUOC')            WHERE            kbtt.CHUNGTUPHATTHUOC_ID = '137704'            AND tt.BENHVIEN_ID = 'HLU01'            AND HOADON_ID is not NULL            AND vp.HUY = '0'              union all            SELECT ctct.CHUNGTU_ID from            TT_DUOC_CHUNGTU_CHITIET ctct            INNER JOIN TT_HOADON_CHITIET_NGOAITRU hdct on (hdct.REF_ID = ctct.CHUNGTUCHITIET_ID and hdct.REF_TABLE = 'TT_DUOC_CHUNGTU_CHITIET')            INNER JOIN TT_HOADON hd on hd.HOADON_ID = hdct.HOADON_ID            WHERE            ctct.CHUNGTU_ID = '137704'                            AND hd.HUYHOADON = '0'              AND hd.HOANTRA = '0'                                  AND ctct.BENHVIEN_ID = 'HLU01'                        union all            SELECT CHUNGTU_ID            FROM TT_NGOAITRU_KHAMBENH_VTYT tt            INNER JOIN TT_VIENPHI vp on (tt.KHAMBENH_VTYT_ID = vp.REF_ID and REF_TABLE = 'TT_NGOAITRU_KHAMBENH_VTYT')            WHERE            CHUNGTU_ID = '137704'            AND tt.BENHVIEN_ID = 'HLU01'            AND HOADON_ID is not NULL            AND vp.HUY = '0'                        union all            SELECT CHUNGTU_ID            FROM TT_PHAUTHUAT_VTYT tt            INNER JOIN TT_VIENPHI vp on (tt.PHAUTHUAT_VTYT_ID = vp.REF_ID and REF_TABLE = 'TT_PHAUTHUAT_VTYT')            WHERE            CHUNGTU_ID = '137704'            AND tt.BENHVIEN_ID = 'HLU01'            AND HOADON_ID is not NULL            AND vp.HUY = '0'                        union all            SELECT CHUNGTU_ID            FROM TT_CLSKETQUA_VTYT tt            INNER JOIN TT_VIENPHI vp on (tt.CLSKETQUA_VTYT_ID = vp.REF_ID and REF_TABLE = 'TT_CLSKETQUA_VTYT')            WHERE            CHUNGTU_ID = '137704'            AND tt.BENHVIEN_ID = 'HLU01'            AND HOADON_ID is not NULL            AND vp.HUY = '0']
2019-09-20 17:43:09,569 [1] DEBUG - Statement Id: [DAO00030_KiemTraBenhNhanXuatVien] PreparedStatement : [select              TT.TOATHUOC_ID              from              TT_NOITRU_TOATHUOC TT              inner join TT_NOITRU_KHAMBENH KB on TT.KHAMBENH_ID = KB.KHAMBENH_ID              inner join TT_NOITRU_BENHAN BA on BA.BENHAN_ID = KB.BENHAN_ID              WHERE              BA.TRANGTHAI = 'DAXUATVIEN'              AND TT.CHUNGTU_ID =  137704              and TT.BENHVIEN_ID = 'HLU01']
2019-09-20 17:43:09,734 [1] DEBUG - Statement Id: [DAO00030_DUOCTONKHO_GetSoTonTheoDuocTheoLo] PreparedStatement : [SELECT              DUOC_ID,SOLONHAP_ID,              SUM(SOLUONG) AS SOLUONGTONLO              FROM              TT_DUOC_TONKHO              WHERE              KHODUOC_ID = '32'              and BENHVIEN_ID = 'HLU01'              and DUOC_ID IN (1)              and SOLONHAP_ID IN (7541)              GROUP BY DUOC_ID, SOLONHAP_ID]
2019-09-20 17:43:09,772 [1] DEBUG - Statement Id: [DAO00030_LayNgayKhoaSoCuoi] PreparedStatement : [SELECT TOP 1 KHOADENNGAY              FROM TT_DUOC_KHOASOCHUNGTU              WHERE              KHODUOC_ID = '32'              and BENHVIEN_ID = 'HLU01'              and KHOASO = '1'              ORDER BY KHOADENNGAY DESC]
2019-09-20 17:43:09,862 [1] DEBUG - Statement Id: [DAO00030_GetList] PreparedStatement : [select *              from TT_DUOC_CHUNGTU              where BENHVIEN_ID = 'HLU01'                and                   TT_DUOC_CHUNGTU.MACHUNGTU = 'CS_KBX1319003092'                               order by CHUNGTU_ID]
2019-09-20 17:43:09,949 [1] DEBUG - Statement Id: [DAO00030_KiemTraBenhNhanXuatVien] PreparedStatement : [select              TT.TOATHUOC_ID              from              TT_NOITRU_TOATHUOC TT              inner join TT_NOITRU_KHAMBENH KB on TT.KHAMBENH_ID = KB.KHAMBENH_ID              inner join TT_NOITRU_BENHAN BA on BA.BENHAN_ID = KB.BENHAN_ID              WHERE              BA.TRANGTHAI = 'DAXUATVIEN'              AND TT.CHUNGTU_ID =  137704              and TT.BENHVIEN_ID = 'HLU01']
2019-09-20 17:43:15,937 [1] DEBUG - Statement Id: [DAO00030_Update] PreparedStatement : [update TT_DUOC_CHUNGTU set              NGAYCHUNGTU =  @param0               , LOAICHUNGTU =  @param1               , MUCDICHCHUNGTU_ID =  @param2               , MUCDICHCHUNGTU_CODE =  @param3               , KHOXUAT_ID =  @param4               , NGUOIGIAO_ID =  @param5               , NGUOIGIAO =  @param6               , KHONHAP_ID =  @param7               , NGUOINHAN_ID =  @param8               , NGUOINHAN =  @param9               , NGUOIKIEMTRA_ID =  @param10               , NGUOIKIEMTRA =  @param11               , NGUOIDUYET_ID =  @param12               , NGUOIDUYET =  @param13               , PHUONGPHAPXUAT =  @param14               , KETOANTRUONG_ID =  @param15               , KETOANTRUONG =  @param16               , THUKHO_ID =  @param17               , THUKHO =  @param18               , MAUHOADON =  @param19               , SOHOADON =  @param20               , SOSERI =  @param21               , NGAYHOADON =  @param22               , DIENGIAI =  @param23               , GIATRI =  @param24               , GIATRITHANHTOAN =  @param25               , TYLEVAT =  @param26               , GIATRIVAT =  @param27               , THUESUAT =  @param28               , GIATRITHUE =  @param29               , TYLECHIETKHAU =  @param30               , GIATRICHIETKHAU =  @param31               , TIENTE_ID =  @param32               , TYGIA =  @param33               , SOCHUNGTUGOC =  @param34               , NGAYCHUNGTUGOC =  @param35               , NHACUNGCAP_ID =  @param36               , HINHTHUCTHANHTOAN_ID =  @param37               , NGUONDUOC_ID =  @param38               , CHUNGTULIENQUAN_ID =  @param39               , KHAMBENH_ID =  @param40               , TOATHUOCNOITRU_ID =  @param41               , TIEPNHAN_ID =  @param42               , BENHAN_ID =  @param43               , DANHANTHUOC =  @param44               , NGUOINHAP_ID =  @param45               , NGAYNHAP =  @param46               , TRANGTHAI =  @param47               , PHIEULINH_ID =  @param48               , LOAITOATHUOC =  @param49               , DIENGIAINGHIEPVUPHATSINH =  @param50               , DONVIGIAO_ID =  @param51               , KHOSUDUNG_ID =  @param52               , LOAIVATTU_ID =  @param53               , BENHNHAN_ID =  @param54               , TENBENHNHAN =  @param55               , BACSIGIOITHIEU_ID =  @param56               , DOITUONG_ID =  @param57               , IDCHUYEN =  @param58               , CHUNGTUKETOAN =  @param59               , STATUS =  @param60               , TRANSFER_VIENPHI_ID =  @param61               , PHONGBAN_ID =  @param62               , BACSI_ID =  @param63               , TKNO =  @param64               , TKCO =  @param65               , MACHUNGTUREF =  @param66               , LOAICHUNGTUREF =  @param67               , PHIEULINHCANTRU_ID =  @param68               , KHOTHUCHIEN_ID =  @param69               , KHODOIUNG_ID =  @param70               , MENU_LOAIDUOC_ID =  @param71               , NGUOISUDUNGMAY_ID =  @param72               , GOITHAU_ID =  @param73               , XUATTHUOCBANGOAITRU =  @param74               , NGAYGIOCHUNGTU =  @param75               , NOIDAKHAM =  @param76               , HOIDONGKIEMNHAP_ID =  @param77               , HOIDONGTHANHLY_ID =  @param78               , CHUYENCHUNGTUID =  @param79               , CHUYENDOANHTHUID =  @param80               , LYDOXUATSUDUNG_ID =  @param81                         , NGAYCAPNHAT =  @param82               , NGUOICAPNHAT_ID =  @param83               where              CHUNGTU_ID = '137704']
2019-09-20 17:43:15,938 [1] DEBUG - Statement Id: [DAO00030_Update] Parameters: [@param0=[NGAYCHUNGTU,9/20/2019 5:03:37 PM], @param1=[LOAICHUNGTU,X], @param2=[MUCDICHCHUNGTU_ID,1060], @param3=[MUCDICHCHUNGTU_CODE,X13], @param4=[KHOXUAT_ID,32], @param5=[NGUOIGIAO_ID,0], @param6=[NGUOIGIAO,null], @param7=[KHONHAP_ID,null], @param8=[NGUOINHAN_ID,null], @param9=[NGUOINHAN,null], @param10=[NGUOIKIEMTRA_ID,null], @param11=[NGUOIKIEMTRA,null], @param12=[NGUOIDUYET_ID,null], @param13=[NGUOIDUYET,null], @param14=[PHUONGPHAPXUAT,0], @param15=[KETOANTRUONG_ID,null], @param16=[KETOANTRUONG,null], @param17=[THUKHO_ID,null], @param18=[THUKHO,null], @param19=[MAUHOADON,null], @param20=[SOHOADON,null], @param21=[SOSERI,null], @param22=[NGAYHOADON,null], @param23=[DIENGIAI,null], @param24=[GIATRI,null], @param25=[GIATRITHANHTOAN,null], @param26=[TYLEVAT,5], @param27=[GIATRIVAT,0], @param28=[THUESUAT,null], @param29=[GIATRITHUE,null], @param30=[TYLECHIETKHAU,null], @param31=[GIATRICHIETKHAU,null], @param32=[TIENTE_ID,null], @param33=[TYGIA,null], @param34=[SOCHUNGTUGOC,null], @param35=[NGAYCHUNGTUGOC,null], @param36=[NHACUNGCAP_ID,null], @param37=[HINHTHUCTHANHTOAN_ID,null], @param38=[NGUONDUOC_ID,null], @param39=[CHUNGTULIENQUAN_ID,null], @param40=[KHAMBENH_ID,null], @param41=[TOATHUOCNOITRU_ID,null], @param42=[TIEPNHAN_ID,null], @param43=[BENHAN_ID,null], @param44=[DANHANTHUOC, ], @param45=[NGUOINHAP_ID,null], @param46=[NGAYNHAP,null], @param47=[TRANGTHAI,DAXUAT], @param48=[PHIEULINH_ID,null], @param49=[LOAITOATHUOC,null], @param50=[DIENGIAINGHIEPVUPHATSINH,null], @param51=[DONVIGIAO_ID,null], @param52=[KHOSUDUNG_ID,null], @param53=[LOAIVATTU_ID,null], @param54=[BENHNHAN_ID,null], @param55=[TENBENHNHAN,null], @param56=[BACSIGIOITHIEU_ID,null], @param57=[DOITUONG_ID,null], @param58=[IDCHUYEN,null], @param59=[CHUNGTUKETOAN,null], @param60=[STATUS,null], @param61=[TRANSFER_VIENPHI_ID,null], @param62=[PHONGBAN_ID,62], @param63=[BACSI_ID,null], @param64=[TKNO,null], @param65=[TKCO,null], @param66=[MACHUNGTUREF,null], @param67=[LOAICHUNGTUREF,null], @param68=[PHIEULINHCANTRU_ID,null], @param69=[KHOTHUCHIEN_ID,null], @param70=[KHODOIUNG_ID,null], @param71=[MENU_LOAIDUOC_ID,null], @param72=[NGUOISUDUNGMAY_ID,null], @param73=[GOITHAU_ID,null], @param74=[XUATTHUOCBANGOAITRU,null], @param75=[NGAYGIOCHUNGTU,null], @param76=[NOIDAKHAM,null], @param77=[HOIDONGKIEMNHAP_ID,null], @param78=[HOIDONGTHANHLY_ID,null], @param79=[CHUYENCHUNGTUID,null], @param80=[CHUYENDOANHTHUID,null], @param81=[LYDOXUATSUDUNG_ID,8294], @param82=[NGAYCAPNHAT,9/20/2019 5:43:15 PM], @param83=[NGUOICAPNHAT_ID,0]]
2019-09-20 17:43:15,938 [1] DEBUG - Statement Id: [DAO00030_Update] Types: [@param0=[DateTime, System.DateTime], @param1=[String, System.String], @param2=[Int64, System.Int64], @param3=[String, System.String], @param4=[Int64, System.Int64], @param5=[Int64, System.Int64], @param6=[System.DBNull, null], @param7=[System.DBNull, null], @param8=[System.DBNull, null], @param9=[System.DBNull, null], @param10=[System.DBNull, null], @param11=[System.DBNull, null], @param12=[System.DBNull, null], @param13=[System.DBNull, null], @param14=[Int64, System.Int64], @param15=[System.DBNull, null], @param16=[System.DBNull, null], @param17=[System.DBNull, null], @param18=[System.DBNull, null], @param19=[System.DBNull, null], @param20=[System.DBNull, null], @param21=[System.DBNull, null], @param22=[System.DBNull, null], @param23=[System.DBNull, null], @param24=[System.DBNull, null], @param25=[System.DBNull, null], @param26=[Double, System.Double], @param27=[Double, System.Double], @param28=[System.DBNull, null], @param29=[System.DBNull, null], @param30=[System.DBNull, null], @param31=[System.DBNull, null], @param32=[System.DBNull, null], @param33=[System.DBNull, null], @param34=[System.DBNull, null], @param35=[System.DBNull, null], @param36=[System.DBNull, null], @param37=[System.DBNull, null], @param38=[System.DBNull, null], @param39=[System.DBNull, null], @param40=[System.DBNull, null], @param41=[System.DBNull, null], @param42=[System.DBNull, null], @param43=[System.DBNull, null], @param44=[String, System.String], @param45=[System.DBNull, null], @param46=[System.DBNull, null], @param47=[String, System.String], @param48=[System.DBNull, null], @param49=[System.DBNull, null], @param50=[System.DBNull, null], @param51=[System.DBNull, null], @param52=[System.DBNull, null], @param53=[System.DBNull, null], @param54=[System.DBNull, null], @param55=[System.DBNull, null], @param56=[System.DBNull, null], @param57=[System.DBNull, null], @param58=[System.DBNull, null], @param59=[System.DBNull, null], @param60=[System.DBNull, null], @param61=[System.DBNull, null], @param62=[Int64, System.Int64], @param63=[System.DBNull, null], @param64=[System.DBNull, null], @param65=[System.DBNull, null], @param66=[System.DBNull, null], @param67=[System.DBNull, null], @param68=[System.DBNull, null], @param69=[System.DBNull, null], @param70=[System.DBNull, null], @param71=[System.DBNull, null], @param72=[System.DBNull, null], @param73=[System.DBNull, null], @param74=[System.DBNull, null], @param75=[System.DBNull, null], @param76=[System.DBNull, null], @param77=[System.DBNull, null], @param78=[System.DBNull, null], @param79=[System.DBNull, null], @param80=[System.DBNull, null], @param81=[Int64, System.Int64], @param82=[DateTime, System.DateTime], @param83=[Int64, System.Int64]]
2019-09-20 17:43:16,002 [1] DEBUG - Statement Id: [DAO00030_CHUNGTUCT_DeleteP] PreparedStatement : [delete from TT_DUOC_CHUNGTU_CHITIET               where                             TT_DUOC_CHUNGTU_CHITIET.CHUNGTU_ID = '137704']
2019-09-20 17:43:16,036 [1] DEBUG - Statement Id: [DAO00030_TT_DUOC_TONKHO_LOG_Add] PreparedStatement : [DECLARE @KHODUOC_ID int               DECLARE @TONTRUOC numeric(18, 4)               DECLARE @TONSAU numeric(18, 4)               DECLARE @SOLUONGNHAP numeric(18, 4)               DECLARE @SOLUONGXUAT numeric(18, 4)                              IF( @param0  = 'N')               BEGIN                SET @KHODUOC_ID =  @param1                END               ELSE               BEGIN                 SET @KHODUOC_ID =  @param2                END                              SELECT @TONTRUOC = SOLUONG FROM TT_DUOC_TONKHO WHERE KHODUOC_ID = @KHODUOC_ID  AND DUOC_ID =  @param3  AND SOLONHAP_ID =  @param4  AND NGUONDUOC_ID =  @param5                               IF( @param0  = 'N' AND  @param6  = 'ADD')               BEGIN                SET @TONSAU = ISNULL(@TONTRUOC,0) +  @param7                 SET @SOLUONGNHAP =  @param7                 SET @SOLUONGXUAT = 0               END               IF( @param0  = 'N' AND  @param6  = 'DEL')               BEGIN                SET @TONSAU = ISNULL(@TONTRUOC,0) -  @param7                 SET @SOLUONGXUAT =  @param7                 SET @SOLUONGNHAP = 0               END                                         IF( @param0  = 'X' AND  @param6  = 'ADD')               BEGIN                SET @TONSAU = ISNULL(@TONTRUOC,0) -  @param8                 SET @SOLUONGXUAT =  @param8                 SET @SOLUONGNHAP = 0               END               IF( @param0  = 'X' AND  @param6  = 'DEL')               BEGIN                SET @TONSAU = ISNULL(@TONTRUOC,0) +  @param8                 SET @SOLUONGNHAP =  @param8                 SET @SOLUONGXUAT = 0                             END                        insert into TT_DUOC_TONKHO_LOG (                           CHUNGTUCHITIET_ID              ,CHUNGTU_ID              ,MACHUNGTU              ,LOAICHUNGTU              ,MUCDICHCHUNGTU_CODE              ,KHONHAP_ID              ,KHOXUAT_ID              ,DUOC_ID              ,SOLONHAP_ID              ,NGUONDUOC_ID              ,SOLUONGNHAP              ,SOLUONGXUAT              ,DONGIAMUA              ,DONGIAVON              ,TYLE_VAT              ,DONGIAVONVAT              ,TONTRUOC              ,TONSAU              ,ACTION              ,BENHVIEN_ID              ,NGAYTAO              ,NGUOITAO_ID                          ) values (              @param9               , @param10               , @param11               , @param0               , @param12               , @param1               , @param2               , @param3               , @param4               , @param5               ,@SOLUONGNHAP              ,@SOLUONGXUAT              , @param13               , @param14               , @param15               , @param16               ,@TONTRUOC              ,@TONSAU              , @param6               , @param17               , @param18               , @param19               )]
2019-09-20 17:43:16,036 [1] DEBUG - Statement Id: [DAO00030_TT_DUOC_TONKHO_LOG_Add] Parameters: [@param0=[LOAICHUNGTU,X], @param1=[KHONHAP_ID,null], @param2=[KHOXUAT_ID,32], @param3=[DUOC_ID,1], @param4=[SOLONHAP_ID,7541], @param5=[NGUONDUOC_ID,1], @param6=[ACTION,DEL], @param7=[SOLUONGNHAP,0], @param8=[SOLUONGXUAT,2], @param9=[CHUNGTUCHITIET_ID,1299050], @param10=[CHUNGTU_ID,137704], @param11=[MACHUNGTU,CS_KBX1319003092], @param12=[MUCDICHCHUNGTU_CODE,X13], @param13=[DONGIAMUA,945], @param14=[DONGIAVON,945], @param15=[TYLE_VAT,0], @param16=[DONGIAVONVAT,945], @param17=[BENHVIEN_ID,HLU01], @param18=[NGAYTAO,9/20/2019 5:43:16 PM], @param19=[NGUOITAO_ID,0]]
2019-09-20 17:43:16,036 [1] DEBUG - Statement Id: [DAO00030_TT_DUOC_TONKHO_LOG_Add] Types: [@param0=[String, System.String], @param1=[System.DBNull, null], @param2=[Int64, System.Int64], @param3=[Int64, System.Int64], @param4=[Int64, System.Int64], @param5=[Int64, System.Int64], @param6=[String, System.String], @param7=[Decimal, System.Decimal], @param8=[Decimal, System.Decimal], @param9=[Int64, System.Int64], @param10=[Int64, System.Int64], @param11=[String, System.String], @param12=[String, System.String], @param13=[Decimal, System.Decimal], @param14=[Decimal, System.Decimal], @param15=[Double, System.Double], @param16=[Double, System.Double], @param17=[String, System.String], @param18=[DateTime, System.DateTime], @param19=[Int64, System.Int64]]
2019-09-20 17:43:16,070 [1] DEBUG - Statement Id: [DAO00030_DUOC_TONKHO_BOOKING_NGOAITRU_Tang] PreparedStatement : [update TT_DUOC_TONKHO_BOOK_NGOAITRU            set            SOLUONG = SOLUONG +  @param0             , NGUOICAPNHAT_ID =  @param1             , NGAYCAPNHAT = getdate()            where            REF_TABLE =  @param2             AND REF_ID =  @param3             AND KHODUOC_ID =  @param4             AND DUOC_ID =  @param5             AND SOLUONG = 0            AND BENHVIEN_ID = 'HLU01']
2019-09-20 17:43:16,070 [1] DEBUG - Statement Id: [DAO00030_DUOC_TONKHO_BOOKING_NGOAITRU_Tang] Parameters: [@param0=[SOLUONGTHAYDOI,2], @param1=[NGUOICAPNHAT_ID,0], @param2=[REF_TABLE,TT_NGOAITRU_KHAMBENH_VTYT], @param3=[REF_ID,10593], @param4=[KHODUOC_ID,32], @param5=[DUOC_ID,1]]
2019-09-20 17:43:16,070 [1] DEBUG - Statement Id: [DAO00030_DUOC_TONKHO_BOOKING_NGOAITRU_Tang] Types: [@param0=[Double, System.Double], @param1=[Int64, System.Int64], @param2=[String, System.String], @param3=[Int64, System.Int64], @param4=[Int64, System.Int64], @param5=[Int64, System.Int64]]
2019-09-20 17:43:16,134 [1] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoVaBookingCOM23UpdateRedis] PreparedStatement : [declare @NGUONDUOC_MACDINH varchar(5) = '0';        declare @TOAMUANGOAI int = 0;        select @NGUONDUOC_MACDINH = isnull(VALUE,0) from TM_SYS_APPSETTINGS where CODE = 'PHA_NGUONDUOC'        select @TOAMUANGOAI = isnull(VALUE,0) from TM_SYS_APPSETTINGS where CODE = 'OPD_TOAMUANGOAI_DUNGDANHMUC_DUOC'                if @TOAMUANGOAI = 1        begin        select  distinct '0' + '_' + LTRIM(d.DUOC_ID) + '_' + @NGUONDUOC_MACDINH as DUOC_KEY, 0 as PHAMVI_ID, @NGUONDUOC_MACDINH as NGUONDUOC_ID, null as TENNGUONDUOC, null as TINHTIEN, d.DUOC_ID, ld.MALOAIDUOC,        d.SOVISA,d.TYLE_VAT,d.COTOA, d.MADUOC, d.TENHANG, d.TENDUOCDAYDU, dvt.TENDONVITINH as DONVITINH, d.BHYT,        d.TENHOATCHAT, d.HAMLUONG, d.HANGSANXUAT, d.QUOCGIA, d.LOAIDUOC_ID, d.DUONGDUNG_ID, d.TINHTIEN_PTTT,        ten.TENDUOC, ten.TENDUOC_EN, ten.MAQUOCTE, ten.MAQUOCTEBT,        '' as BHYT_TEXT        , ld.LOAIVATTU_ID        , d.BENHVIEN_ID,        999999999 as SOLUONG, d.VTYT_PHANLOAI, d.PHAMVI, d.SUASOLUONGTONGHOP, d.MADUOCBV, d.DANGTRINHBAY        , TAMNGUNG = CASE WHEN d.TAMNGUNG = '1' THEN '1' ELSE '0' END        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        where d.DUOC_ID in (1)        union all        select  distinct tk.DUOC_KEY, LTRIM(tk.PHAMVI_ID) as PHAMVI_ID, tk.NGUONDUOC_ID, nh.TENNGUONDUOC, nh.TINHTIEN, d.DUOC_ID, ld.MALOAIDUOC,        d.SOVISA,d.TYLE_VAT,d.COTOA, d.MADUOC, d.TENHANG, d.TENDUOCDAYDU, dvt.TENDONVITINH as DONVITINH, d.BHYT,        d.TENHOATCHAT, d.HAMLUONG, d.HANGSANXUAT, d.QUOCGIA, d.LOAIDUOC_ID, d.DUONGDUNG_ID, d.TINHTIEN_PTTT,        ten.TENDUOC, ten.TENDUOC_EN, ten.MAQUOCTE, ten.MAQUOCTEBT,        CASE WHEN d.BHYT = '1' THEN 'BHYT' ELSE '' END as BHYT_TEXT        , ld.LOAIVATTU_ID        , d.BENHVIEN_ID,        tk.SOLUONG, d.VTYT_PHANLOAI, d.PHAMVI, d.SUASOLUONGTONGHOP, d.MADUOCBV, d.DANGTRINHBAY        , TAMNGUNG = CASE WHEN d.TAMNGUNG = '1' OR nh.TAMNGUNG = '1' OR kd.TAMNGUNG = '1' THEN '1' ELSE '0' END        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        inner join        (        select  LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')) DUOC_KEY, (SUM(dtk.SOLUONG) - isnull(sum(A.SOLUONG),0) - isnull(sum(B.SOLUONG),0)) SOLUONG, pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        from (select sum(soluong) soluong,duoc_id,nguonduoc_id,khoduoc_id,benhvien_id from TT_DUOC_TONKHO  group by duoc_id,nguonduoc_id,khoduoc_id,benhvien_id) dtk        inner join TM_DUOC_PHAMVISD_MAPPING pvsd on dtk.KHODUOC_ID = pvsd.KHODUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NOITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) B on B.DUOC_ID = dtk.DUOC_ID and B.SOLUONG > 0 and B.PHAMVI_ID = pvsd.PHAMVI_ID and B.NGUONHANG_ID = dtk.NGUONDUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NGOAITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) A on A.DUOC_ID = dtk.DUOC_ID and A.SOLUONG > 0 and A.PHAMVI_ID = pvsd.PHAMVI_ID and A.NGUONHANG_ID = dtk.NGUONDUOC_ID        where dtk.SOLUONG > 0 and dtk.BENHVIEN_ID = 'HLU01'        group by LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')), pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        ) tk on tk.DUOC_ID = d.DUOC_ID        left join TM_DUOC_PHAMVISUDUNG kd on kd.PHAMVI_ID = tk.PHAMVI_ID and kd.BENHVIEN_ID = 'HLU01'        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = tk.NGUONDUOC_ID and nh.BENHVIEN_ID = 'HLU01'        where  d.BENHVIEN_ID = 'HLU01' and d.DUOC_ID in (1)        end        else        begin        select  distinct tk.DUOC_KEY, LTRIM(tk.PHAMVI_ID) as PHAMVI_ID, tk.NGUONDUOC_ID, nh.TENNGUONDUOC, nh.TINHTIEN, d.DUOC_ID, ld.MALOAIDUOC,        d.SOVISA,d.TYLE_VAT,d.COTOA, d.MADUOC, d.TENHANG, d.TENDUOCDAYDU, dvt.TENDONVITINH as DONVITINH, d.BHYT,        d.TENHOATCHAT, d.HAMLUONG, d.HANGSANXUAT, d.QUOCGIA, d.LOAIDUOC_ID, d.DUONGDUNG_ID, d.TINHTIEN_PTTT,        ten.TENDUOC, ten.TENDUOC_EN, ten.MAQUOCTE, ten.MAQUOCTEBT,        CASE WHEN d.BHYT = '1' THEN 'BHYT' ELSE '' END as BHYT_TEXT        , ld.LOAIVATTU_ID        , d.BENHVIEN_ID,        tk.SOLUONG, d.VTYT_PHANLOAI, d.PHAMVI, d.SUASOLUONGTONGHOP, d.MADUOCBV, d.DANGTRINHBAY        , TAMNGUNG = CASE WHEN d.TAMNGUNG = '1' OR nh.TAMNGUNG = '1' OR kd.TAMNGUNG = '1' THEN '1' ELSE '0' END        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        inner join        (        select  LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')) DUOC_KEY, (SUM(dtk.SOLUONG) - isnull(sum(A.SOLUONG),0) - isnull(sum(B.SOLUONG),0)) SOLUONG, pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        from (select sum(soluong) soluong,duoc_id,nguonduoc_id,khoduoc_id,benhvien_id from TT_DUOC_TONKHO  group by duoc_id,nguonduoc_id,khoduoc_id,benhvien_id) dtk        inner join TM_DUOC_PHAMVISD_MAPPING pvsd on dtk.KHODUOC_ID = pvsd.KHODUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NOITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) B on B.DUOC_ID = dtk.DUOC_ID and B.SOLUONG > 0 and B.PHAMVI_ID = pvsd.PHAMVI_ID and B.NGUONHANG_ID = dtk.NGUONDUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NGOAITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) A on A.DUOC_ID = dtk.DUOC_ID and A.SOLUONG > 0 and A.PHAMVI_ID = pvsd.PHAMVI_ID and A.NGUONHANG_ID = dtk.NGUONDUOC_ID        where dtk.SOLUONG > 0 and dtk.BENHVIEN_ID = 'HLU01'        group by LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')), pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        ) tk on tk.DUOC_ID = d.DUOC_ID        left join TM_DUOC_PHAMVISUDUNG kd on kd.PHAMVI_ID = tk.PHAMVI_ID and kd.BENHVIEN_ID = 'HLU01'        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = tk.NGUONDUOC_ID and nh.BENHVIEN_ID = 'HLU01'        where  d.BENHVIEN_ID = 'HLU01' and d.DUOC_ID in (1)        end]
2019-09-20 17:43:16,346 [1] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoCOM18UpdateRedis] PreparedStatement : [select distinct TT_TONKHO.DUOC_KEY, LTRIM(TT_TONKHO.KHODUOC_ID) as KHODUOC_ID, TM_DUOC.DUOC_ID, TM_LOAIDUOC.MALOAIDUOC,TM_DUOC.SOVISA,TM_DUOC.TYLE_VAT,TM_DUOC.COTOA,        TM_DUOC.MADUOC, TM_DUOC.TENHANG, TM_DUOC.TENDUOCDAYDU, dvt.TENDONVITINH as DONVITINH,  TM_DUOC.DONVITINH_ID,TM_DUOC.BHYT,        TM_DUOC.TENHOATCHAT,        TM_DUOC.HAMLUONG, TM_DUOC.HANGSANXUAT, TM_DUOC.QUOCGIA, TM_DUOC.LOAIDUOC_ID, TM_DUOC.DUONGDUNG_ID,        TM_TENDUOC.TENDUOC, TM_TENDUOC.TENDUOC_EN, TM_TENDUOC.MAQUOCTE, TM_TENDUOC.MAQUOCTEBT,        TM_LOAIDUOC.LOAIVATTU_ID, TM_DUOC.BENHVIEN_ID,        TT_TONKHO.SOLUONG, TM_DUOC.VTYT_PHANLOAI, TM_DUOC.PHAMVI, TT_TONKHO.NGUONDUOC_ID, NG.TENNGUONDUOC AS TENNGUONDUOC        , TAMNGUNG = CASE WHEN TM_DUOC.TAMNGUNG = '1' OR NG.TAMNGUNG = '1' OR KD.TAMNGUNG = '1' THEN '1' ELSE '0' END        , TM_DUOC.DANGTRINHBAY        from TM_DUOC        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = TM_DUOC.DONVITINH_ID        left join TM_TENDUOC on TM_DUOC.TENDUOC_ID = TM_TENDUOC.TENDUOC_ID and TM_DUOC.BENHVIEN_ID = 'HLU01' and TM_DUOC.TAMNGUNG = '0'        left join TM_LOAIDUOC on TM_LOAIDUOC.LOAIDUOC_ID = TM_DUOC.LOAIDUOC_ID and TM_LOAIDUOC.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG on (TM_LOAIDUOC.LOAIVATTU_ID = TM_DUOC_HANDUNG.LOAIDUOC and TM_DUOC_HANDUNG.BENHVIEN_ID = 'HLU01')        inner join        (select LTRIM(A.KHODUOC_ID) + '_' + LTRIM(A.DUOC_ID) + '_' + LTRIM(ISNULL(A.NGUONDUOC_ID,'')) as DUOC_KEY, A.KHODUOC_ID, A.DUOC_ID, A.NGUONDUOC_ID,        SUM(isnull(A.SOLUONG,0)) as SOLUONG        from        (select SUM(SOLUONG) as SOLUONG, KHODUOC_ID, DUOC_ID, NGUONDUOC_ID from TT_DUOC_TONKHO        where BENHVIEN_ID = 'HLU01' group by KHODUOC_ID, DUOC_ID, NGUONDUOC_ID) A        group by LTRIM(A.KHODUOC_ID) + '_' + LTRIM(A.DUOC_ID) + '_' + LTRIM(ISNULL(A.NGUONDUOC_ID,'')), A.KHODUOC_ID, A.DUOC_ID, NGUONDUOC_ID        ) TT_TONKHO on TT_TONKHO.DUOC_ID = TM_DUOC.DUOC_ID        LEFT JOIN TM_NGUONHANG NG ON NG.NGUONDUOC_ID = TT_TONKHO.NGUONDUOC_ID        LEFT JOIN TM_KHODUOC KD ON KD.KHODUOC_ID = TT_TONKHO.KHODUOC_ID        where TM_DUOC.BENHVIEN_ID = 'HLU01' and TT_TONKHO.SOLUONG >= 0        and TM_DUOC.DUOC_ID in (1)]
2019-09-20 17:43:16,404 [1] DEBUG - Statement Id: [DAO00030_DUOCTONKHO_Tang] PreparedStatement : [IF EXISTS            (              SELECT DUOCTONKHO_ID              FROM TT_DUOC_TONKHO              WHERE              KHODUOC_ID =  @param0               AND DUOC_ID =  @param1               AND  SOLONHAP_ID =  @param2             )            BEGIN              update TT_DUOC_TONKHO set              SOLUONG = SOLUONG +   @param3               , NGAYCAPNHAT =  @param4               , NGUOICAPNHAT_ID =  @param5               where              KHODUOC_ID =  @param0               AND DUOC_ID =  @param1               AND  SOLONHAP_ID =  @param2             END            ELSE            BEGIN              insert into TT_DUOC_TONKHO (              KHODUOC_ID              , DUOC_ID              , NGUONDUOC_ID              , SOLONHAP_ID              , DONGIAMUA              , SOLUONG              , BENHVIEN_ID              , NGAYTAO              , NGUOITAO_ID                     ) values (               @param0               ,  @param1               ,  @param6               ,  @param2               ,  @param7               ,  @param3               ,  @param8               ,  @param9               ,  @param10                        )            END]
2019-09-20 17:43:16,404 [1] DEBUG - Statement Id: [DAO00030_DUOCTONKHO_Tang] Parameters: [@param0=[KHODUOC_ID,32], @param1=[DUOC_ID,1], @param2=[SOLONHAP_ID,7541], @param3=[SOLUONGTHAYDOI,2], @param4=[NGAYCAPNHAT,9/20/2019 5:43:16 PM], @param5=[NGUOICAPNHAT_ID,0], @param6=[NGUONDUOC_ID,1], @param7=[DONGIAMUA,945], @param8=[BENHVIEN_ID,HLU01], @param9=[NGAYTAO,9/20/2019 5:03:37 PM], @param10=[NGUOITAO_ID,0]]
2019-09-20 17:43:16,404 [1] DEBUG - Statement Id: [DAO00030_DUOCTONKHO_Tang] Types: [@param0=[Int64, System.Int64], @param1=[Int64, System.Int64], @param2=[Int64, System.Int64], @param3=[Double, System.Double], @param4=[DateTime, System.DateTime], @param5=[Int64, System.Int64], @param6=[Int64, System.Int64], @param7=[Double, System.Double], @param8=[String, System.String], @param9=[DateTime, System.DateTime], @param10=[Int64, System.Int64]]
2019-09-20 17:43:16,439 [1] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoCOM18] PreparedStatement : [select  distinct TT_TONKHO.DUOC_KEY, LTRIM(TT_TONKHO.KHODUOC_ID) as KHODUOC_ID, TM_DUOC.DUOC_ID, TM_LOAIDUOC.MALOAIDUOC,TM_DUOC.SOVISA,TM_DUOC.TYLE_VAT,TM_DUOC.COTOA,        TM_DUOC.MADUOC, TM_DUOC.TENHANG, TM_DUOC.TENDUOCDAYDU, dvt.TENDONVITINH as DONVITINH, TM_DUOC.DONVITINH_ID, TM_DUOC.BHYT,        TM_DUOC.TENHOATCHAT, TM_DUOC.HAMLUONG, TM_DUOC.HANGSANXUAT, TM_DUOC.QUOCGIA, TM_DUOC.LOAIDUOC_ID, TM_DUOC.DUONGDUNG_ID,        TM_TENDUOC.TENDUOC, TM_TENDUOC.TENDUOC_EN, TM_TENDUOC.MAQUOCTE, TM_TENDUOC.MAQUOCTEBT,        TM_LOAIDUOC.LOAIVATTU_ID, TM_DUOC.BENHVIEN_ID,        TT_TONKHO.SOLUONG, TM_DUOC.VTYT_PHANLOAI, TM_DUOC.PHAMVI, TT_TONKHO.NGUONDUOC_ID, NG.TENNGUONDUOC        , TAMNGUNG = CASE WHEN TM_DUOC.TAMNGUNG = '1' OR NG.TAMNGUNG = '1' OR KD.TAMNGUNG = '1' THEN '1' ELSE '0' END        , TM_DUOC.DANGTRINHBAY        from TM_DUOC        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = TM_DUOC.DONVITINH_ID        left join TM_TENDUOC on TM_DUOC.TENDUOC_ID = TM_TENDUOC.TENDUOC_ID and TM_DUOC.BENHVIEN_ID = 'HLU01'  and TM_DUOC.TAMNGUNG = '0'        left join TM_LOAIDUOC on TM_LOAIDUOC.LOAIDUOC_ID = TM_DUOC.LOAIDUOC_ID and TM_LOAIDUOC.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG on (TM_LOAIDUOC.LOAIVATTU_ID = TM_DUOC_HANDUNG.LOAIDUOC and TM_DUOC_HANDUNG.BENHVIEN_ID = 'HLU01')        inner join        (select LTRIM(A.KHODUOC_ID) + '_' + LTRIM(A.DUOC_ID) + '_' + LTRIM(ISNULL(A.NGUONDUOC_ID,'')) as DUOC_KEY, A.KHODUOC_ID, A.DUOC_ID ,a.NGUONDUOC_ID,        SUM(isnull(A.SOLUONG,0)) as SOLUONG        from        (select SUM(SOLUONG) as SOLUONG, KHODUOC_ID, DUOC_ID, NGUONDUOC_ID from TT_DUOC_TONKHO        where KHODUOC_ID in (32) and DUOC_ID in (1) group by KHODUOC_ID, DUOC_ID, NGUONDUOC_ID        ) A        where A.KHODUOC_ID in (32) and A.DUOC_ID in (1)        group by LTRIM(A.KHODUOC_ID) + '_' + LTRIM(A.DUOC_ID) + '_' + LTRIM(A.NGUONDUOC_ID), A.KHODUOC_ID, A.DUOC_ID, A.NGUONDUOC_ID)        TT_TONKHO on TT_TONKHO.DUOC_ID = TM_DUOC.DUOC_ID        LEFT JOIN TM_NGUONHANG NG ON NG.NGUONDUOC_ID = TT_TONKHO.NGUONDUOC_ID        LEFT JOIN TM_KHODUOC KD ON KD.KHODUOC_ID = TT_TONKHO.KHODUOC_ID        where TM_DUOC.BENHVIEN_ID = 'HLU01' and TM_DUOC.DUOC_ID in (1)]
2019-09-20 17:43:16,474 [1] DEBUG - Statement Id: [DAO00030_GetListPhamViByKhoDuoc] PreparedStatement : [SELECT DISTINCT PHAMVI_ID          FROM TM_DUOC_PHAMVISD_MAPPING          WHERE          KHODUOC_ID IN (32)          AND BENHVIEN_ID ='HLU01'          AND TAMNGUNG = '0']
2019-09-20 17:43:16,505 [1] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoVaBookingCOM23] PreparedStatement : [declare @NGUONDUOC_MACDINH varchar(5) = '0';        declare @TOAMUANGOAI int = 0;        select @NGUONDUOC_MACDINH = isnull(VALUE,0) from TM_SYS_APPSETTINGS where CODE = 'PHA_NGUONDUOC'        select @TOAMUANGOAI = isnull(VALUE,0) from TM_SYS_APPSETTINGS where CODE = 'OPD_TOAMUANGOAI_DUNGDANHMUC_DUOC'                if @TOAMUANGOAI = 1        begin        select  distinct '0' + '_' + LTRIM(d.DUOC_ID) + '_' + @NGUONDUOC_MACDINH as DUOC_KEY, 0 as PHAMVI_ID, @NGUONDUOC_MACDINH as NGUONDUOC_ID, null as TENNGUONDUOC, null as TINHTIEN, d.DUOC_ID, ld.MALOAIDUOC,        d.SOVISA,d.TYLE_VAT,d.COTOA, d.MADUOC, d.TENHANG, d.TENDUOCDAYDU, dvt.TENDONVITINH as DONVITINH, d.BHYT,        d.TENHOATCHAT, d.HAMLUONG, d.HANGSANXUAT, d.QUOCGIA, d.LOAIDUOC_ID, d.DUONGDUNG_ID, d.TINHTIEN_PTTT,        ten.TENDUOC, ten.TENDUOC_EN, ten.MAQUOCTE, ten.MAQUOCTEBT,        '' as BHYT_TEXT        , ld.LOAIVATTU_ID        , d.BENHVIEN_ID,        999999999 as SOLUONG, d.VTYT_PHANLOAI, d.PHAMVI, d.SUASOLUONGTONGHOP, d.MADUOCBV, d.DANGTRINHBAY        , TAMNGUNG = CASE WHEN d.TAMNGUNG = '1' THEN '1' ELSE '0' END        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        where d.DUOC_ID in (1)        union all        select  distinct tk.DUOC_KEY, LTRIM(tk.PHAMVI_ID) as PHAMVI_ID, tk.NGUONDUOC_ID, nh.TENNGUONDUOC, nh.TINHTIEN, d.DUOC_ID, ld.MALOAIDUOC,        d.SOVISA,d.TYLE_VAT,d.COTOA, d.MADUOC, d.TENHANG, d.TENDUOCDAYDU, dvt.TENDONVITINH as DONVITINH, d.BHYT,        d.TENHOATCHAT, d.HAMLUONG, d.HANGSANXUAT, d.QUOCGIA, d.LOAIDUOC_ID, d.DUONGDUNG_ID, d.TINHTIEN_PTTT,        ten.TENDUOC, ten.TENDUOC_EN, ten.MAQUOCTE, ten.MAQUOCTEBT,        CASE WHEN d.BHYT = '1' THEN 'BHYT' ELSE '' END as BHYT_TEXT        , ld.LOAIVATTU_ID        , d.BENHVIEN_ID,        tk.SOLUONG, d.VTYT_PHANLOAI, d.PHAMVI, d.SUASOLUONGTONGHOP, d.MADUOCBV, d.DANGTRINHBAY        , TAMNGUNG = CASE WHEN d.TAMNGUNG = '1' OR nh.TAMNGUNG = '1' OR kd.TAMNGUNG = '1' THEN '1' ELSE '0' END        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        inner join        (        select  LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')) DUOC_KEY, (SUM(dtk.SOLUONG) - isnull(sum(A.SOLUONG),0) - isnull(sum(B.SOLUONG),0)) SOLUONG, pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        from (select sum(soluong) soluong,duoc_id,nguonduoc_id,khoduoc_id,benhvien_id from TT_DUOC_TONKHO  group by duoc_id,nguonduoc_id,khoduoc_id,benhvien_id) dtk        inner join TM_DUOC_PHAMVISD_MAPPING pvsd on dtk.KHODUOC_ID = pvsd.KHODUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NOITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) B on B.DUOC_ID = dtk.DUOC_ID and B.SOLUONG > 0 and B.PHAMVI_ID = pvsd.PHAMVI_ID and B.NGUONHANG_ID = dtk.NGUONDUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NGOAITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) A on A.DUOC_ID = dtk.DUOC_ID and A.SOLUONG > 0 and A.PHAMVI_ID = pvsd.PHAMVI_ID and A.NGUONHANG_ID = dtk.NGUONDUOC_ID        where dtk.SOLUONG > 0 and dtk.BENHVIEN_ID = 'HLU01'        group by LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')), pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        ) tk on tk.DUOC_ID = d.DUOC_ID        left join TM_DUOC_PHAMVISUDUNG kd on kd.PHAMVI_ID = tk.PHAMVI_ID and kd.BENHVIEN_ID = 'HLU01'        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = tk.NGUONDUOC_ID and nh.BENHVIEN_ID = 'HLU01'        where  d.BENHVIEN_ID = 'HLU01' and d.DUOC_ID in (1) and TK.PHAMVI_ID in (1055)        and tk.NGUONDUOC_ID in (1)         end        else        begin                select  distinct tk.DUOC_KEY, LTRIM(tk.PHAMVI_ID) as PHAMVI_ID, tk.NGUONDUOC_ID, nh.TENNGUONDUOC, nh.TINHTIEN, d.DUOC_ID, ld.MALOAIDUOC,        d.SOVISA,d.TYLE_VAT,d.COTOA, d.MADUOC, d.TENHANG, d.TENDUOCDAYDU, dvt.TENDONVITINH as DONVITINH, d.BHYT,        d.TENHOATCHAT, d.HAMLUONG, d.HANGSANXUAT, d.QUOCGIA, d.LOAIDUOC_ID, d.DUONGDUNG_ID, d.TINHTIEN_PTTT,        ten.TENDUOC, ten.TENDUOC_EN, ten.MAQUOCTE, ten.MAQUOCTEBT,        CASE WHEN d.BHYT = '1' THEN 'BHYT' ELSE '' END as BHYT_TEXT        , ld.LOAIVATTU_ID        , d.BENHVIEN_ID,        tk.SOLUONG, d.VTYT_PHANLOAI, d.PHAMVI, d.SUASOLUONGTONGHOP, d.MADUOCBV, d.DANGTRINHBAY        , TAMNGUNG = CASE WHEN d.TAMNGUNG = '1' OR nh.TAMNGUNG = '1' OR kd.TAMNGUNG = '1' THEN '1' ELSE '0' END        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        inner join        (        select  LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')) DUOC_KEY, (SUM(dtk.SOLUONG) - isnull(sum(A.SOLUONG),0) - isnull(sum(B.SOLUONG),0)) SOLUONG, pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        from (select sum(soluong) soluong,duoc_id,nguonduoc_id,khoduoc_id,benhvien_id from TT_DUOC_TONKHO  group by duoc_id,nguonduoc_id,khoduoc_id,benhvien_id) dtk        inner join TM_DUOC_PHAMVISD_MAPPING pvsd on dtk.KHODUOC_ID = pvsd.KHODUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NOITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) B on B.DUOC_ID = dtk.DUOC_ID and B.SOLUONG > 0 and B.PHAMVI_ID = pvsd.PHAMVI_ID and B.NGUONHANG_ID = dtk.NGUONDUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NGOAITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) A on A.DUOC_ID = dtk.DUOC_ID and A.SOLUONG > 0 and A.PHAMVI_ID = pvsd.PHAMVI_ID and A.NGUONHANG_ID = dtk.NGUONDUOC_ID        where dtk.SOLUONG > 0 and dtk.BENHVIEN_ID = 'HLU01'        group by LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')), pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        ) tk on tk.DUOC_ID = d.DUOC_ID        left join TM_DUOC_PHAMVISUDUNG kd on kd.PHAMVI_ID = tk.PHAMVI_ID and kd.BENHVIEN_ID = 'HLU01'        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = tk.NGUONDUOC_ID and nh.BENHVIEN_ID = 'HLU01'        where  d.BENHVIEN_ID = 'HLU01' and d.DUOC_ID in (1) and TK.PHAMVI_ID in (1055)        and tk.NGUONDUOC_ID in (1)         end]
2019-09-20 17:43:16,677 [1] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoCOM18UpdateRedis] PreparedStatement : [select distinct TT_TONKHO.DUOC_KEY, LTRIM(TT_TONKHO.KHODUOC_ID) as KHODUOC_ID, TM_DUOC.DUOC_ID, TM_LOAIDUOC.MALOAIDUOC,TM_DUOC.SOVISA,TM_DUOC.TYLE_VAT,TM_DUOC.COTOA,        TM_DUOC.MADUOC, TM_DUOC.TENHANG, TM_DUOC.TENDUOCDAYDU, dvt.TENDONVITINH as DONVITINH,  TM_DUOC.DONVITINH_ID,TM_DUOC.BHYT,        TM_DUOC.TENHOATCHAT,        TM_DUOC.HAMLUONG, TM_DUOC.HANGSANXUAT, TM_DUOC.QUOCGIA, TM_DUOC.LOAIDUOC_ID, TM_DUOC.DUONGDUNG_ID,        TM_TENDUOC.TENDUOC, TM_TENDUOC.TENDUOC_EN, TM_TENDUOC.MAQUOCTE, TM_TENDUOC.MAQUOCTEBT,        TM_LOAIDUOC.LOAIVATTU_ID, TM_DUOC.BENHVIEN_ID,        TT_TONKHO.SOLUONG, TM_DUOC.VTYT_PHANLOAI, TM_DUOC.PHAMVI, TT_TONKHO.NGUONDUOC_ID, NG.TENNGUONDUOC AS TENNGUONDUOC        , TAMNGUNG = CASE WHEN TM_DUOC.TAMNGUNG = '1' OR NG.TAMNGUNG = '1' OR KD.TAMNGUNG = '1' THEN '1' ELSE '0' END        , TM_DUOC.DANGTRINHBAY        from TM_DUOC        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = TM_DUOC.DONVITINH_ID        left join TM_TENDUOC on TM_DUOC.TENDUOC_ID = TM_TENDUOC.TENDUOC_ID and TM_DUOC.BENHVIEN_ID = 'HLU01' and TM_DUOC.TAMNGUNG = '0'        left join TM_LOAIDUOC on TM_LOAIDUOC.LOAIDUOC_ID = TM_DUOC.LOAIDUOC_ID and TM_LOAIDUOC.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG on (TM_LOAIDUOC.LOAIVATTU_ID = TM_DUOC_HANDUNG.LOAIDUOC and TM_DUOC_HANDUNG.BENHVIEN_ID = 'HLU01')        inner join        (select LTRIM(A.KHODUOC_ID) + '_' + LTRIM(A.DUOC_ID) + '_' + LTRIM(ISNULL(A.NGUONDUOC_ID,'')) as DUOC_KEY, A.KHODUOC_ID, A.DUOC_ID, A.NGUONDUOC_ID,        SUM(isnull(A.SOLUONG,0)) as SOLUONG        from        (select SUM(SOLUONG) as SOLUONG, KHODUOC_ID, DUOC_ID, NGUONDUOC_ID from TT_DUOC_TONKHO        where BENHVIEN_ID = 'HLU01' group by KHODUOC_ID, DUOC_ID, NGUONDUOC_ID) A        group by LTRIM(A.KHODUOC_ID) + '_' + LTRIM(A.DUOC_ID) + '_' + LTRIM(ISNULL(A.NGUONDUOC_ID,'')), A.KHODUOC_ID, A.DUOC_ID, NGUONDUOC_ID        ) TT_TONKHO on TT_TONKHO.DUOC_ID = TM_DUOC.DUOC_ID        LEFT JOIN TM_NGUONHANG NG ON NG.NGUONDUOC_ID = TT_TONKHO.NGUONDUOC_ID        LEFT JOIN TM_KHODUOC KD ON KD.KHODUOC_ID = TT_TONKHO.KHODUOC_ID        where TM_DUOC.BENHVIEN_ID = 'HLU01' and TT_TONKHO.SOLUONG >= 0        and TM_DUOC.DUOC_ID in (1)]
2019-09-20 17:43:16,726 [1] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoVaBookingCOM23UpdateRedis] PreparedStatement : [declare @NGUONDUOC_MACDINH varchar(5) = '0';        declare @TOAMUANGOAI int = 0;        select @NGUONDUOC_MACDINH = isnull(VALUE,0) from TM_SYS_APPSETTINGS where CODE = 'PHA_NGUONDUOC'        select @TOAMUANGOAI = isnull(VALUE,0) from TM_SYS_APPSETTINGS where CODE = 'OPD_TOAMUANGOAI_DUNGDANHMUC_DUOC'                if @TOAMUANGOAI = 1        begin        select  distinct '0' + '_' + LTRIM(d.DUOC_ID) + '_' + @NGUONDUOC_MACDINH as DUOC_KEY, 0 as PHAMVI_ID, @NGUONDUOC_MACDINH as NGUONDUOC_ID, null as TENNGUONDUOC, null as TINHTIEN, d.DUOC_ID, ld.MALOAIDUOC,        d.SOVISA,d.TYLE_VAT,d.COTOA, d.MADUOC, d.TENHANG, d.TENDUOCDAYDU, dvt.TENDONVITINH as DONVITINH, d.BHYT,        d.TENHOATCHAT, d.HAMLUONG, d.HANGSANXUAT, d.QUOCGIA, d.LOAIDUOC_ID, d.DUONGDUNG_ID, d.TINHTIEN_PTTT,        ten.TENDUOC, ten.TENDUOC_EN, ten.MAQUOCTE, ten.MAQUOCTEBT,        '' as BHYT_TEXT        , ld.LOAIVATTU_ID        , d.BENHVIEN_ID,        999999999 as SOLUONG, d.VTYT_PHANLOAI, d.PHAMVI, d.SUASOLUONGTONGHOP, d.MADUOCBV, d.DANGTRINHBAY        , TAMNGUNG = CASE WHEN d.TAMNGUNG = '1' THEN '1' ELSE '0' END        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        where d.DUOC_ID in (1)        union all        select  distinct tk.DUOC_KEY, LTRIM(tk.PHAMVI_ID) as PHAMVI_ID, tk.NGUONDUOC_ID, nh.TENNGUONDUOC, nh.TINHTIEN, d.DUOC_ID, ld.MALOAIDUOC,        d.SOVISA,d.TYLE_VAT,d.COTOA, d.MADUOC, d.TENHANG, d.TENDUOCDAYDU, dvt.TENDONVITINH as DONVITINH, d.BHYT,        d.TENHOATCHAT, d.HAMLUONG, d.HANGSANXUAT, d.QUOCGIA, d.LOAIDUOC_ID, d.DUONGDUNG_ID, d.TINHTIEN_PTTT,        ten.TENDUOC, ten.TENDUOC_EN, ten.MAQUOCTE, ten.MAQUOCTEBT,        CASE WHEN d.BHYT = '1' THEN 'BHYT' ELSE '' END as BHYT_TEXT        , ld.LOAIVATTU_ID        , d.BENHVIEN_ID,        tk.SOLUONG, d.VTYT_PHANLOAI, d.PHAMVI, d.SUASOLUONGTONGHOP, d.MADUOCBV, d.DANGTRINHBAY        , TAMNGUNG = CASE WHEN d.TAMNGUNG = '1' OR nh.TAMNGUNG = '1' OR kd.TAMNGUNG = '1' THEN '1' ELSE '0' END        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        inner join        (        select  LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')) DUOC_KEY, (SUM(dtk.SOLUONG) - isnull(sum(A.SOLUONG),0) - isnull(sum(B.SOLUONG),0)) SOLUONG, pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        from (select sum(soluong) soluong,duoc_id,nguonduoc_id,khoduoc_id,benhvien_id from TT_DUOC_TONKHO  group by duoc_id,nguonduoc_id,khoduoc_id,benhvien_id) dtk        inner join TM_DUOC_PHAMVISD_MAPPING pvsd on dtk.KHODUOC_ID = pvsd.KHODUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NOITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) B on B.DUOC_ID = dtk.DUOC_ID and B.SOLUONG > 0 and B.PHAMVI_ID = pvsd.PHAMVI_ID and B.NGUONHANG_ID = dtk.NGUONDUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NGOAITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) A on A.DUOC_ID = dtk.DUOC_ID and A.SOLUONG > 0 and A.PHAMVI_ID = pvsd.PHAMVI_ID and A.NGUONHANG_ID = dtk.NGUONDUOC_ID        where dtk.SOLUONG > 0 and dtk.BENHVIEN_ID = 'HLU01'        group by LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')), pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        ) tk on tk.DUOC_ID = d.DUOC_ID        left join TM_DUOC_PHAMVISUDUNG kd on kd.PHAMVI_ID = tk.PHAMVI_ID and kd.BENHVIEN_ID = 'HLU01'        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = tk.NGUONDUOC_ID and nh.BENHVIEN_ID = 'HLU01'        where  d.BENHVIEN_ID = 'HLU01' and d.DUOC_ID in (1)        end        else        begin        select  distinct tk.DUOC_KEY, LTRIM(tk.PHAMVI_ID) as PHAMVI_ID, tk.NGUONDUOC_ID, nh.TENNGUONDUOC, nh.TINHTIEN, d.DUOC_ID, ld.MALOAIDUOC,        d.SOVISA,d.TYLE_VAT,d.COTOA, d.MADUOC, d.TENHANG, d.TENDUOCDAYDU, dvt.TENDONVITINH as DONVITINH, d.BHYT,        d.TENHOATCHAT, d.HAMLUONG, d.HANGSANXUAT, d.QUOCGIA, d.LOAIDUOC_ID, d.DUONGDUNG_ID, d.TINHTIEN_PTTT,        ten.TENDUOC, ten.TENDUOC_EN, ten.MAQUOCTE, ten.MAQUOCTEBT,        CASE WHEN d.BHYT = '1' THEN 'BHYT' ELSE '' END as BHYT_TEXT        , ld.LOAIVATTU_ID        , d.BENHVIEN_ID,        tk.SOLUONG, d.VTYT_PHANLOAI, d.PHAMVI, d.SUASOLUONGTONGHOP, d.MADUOCBV, d.DANGTRINHBAY        , TAMNGUNG = CASE WHEN d.TAMNGUNG = '1' OR nh.TAMNGUNG = '1' OR kd.TAMNGUNG = '1' THEN '1' ELSE '0' END        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        inner join        (        select  LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')) DUOC_KEY, (SUM(dtk.SOLUONG) - isnull(sum(A.SOLUONG),0) - isnull(sum(B.SOLUONG),0)) SOLUONG, pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        from (select sum(soluong) soluong,duoc_id,nguonduoc_id,khoduoc_id,benhvien_id from TT_DUOC_TONKHO  group by duoc_id,nguonduoc_id,khoduoc_id,benhvien_id) dtk        inner join TM_DUOC_PHAMVISD_MAPPING pvsd on dtk.KHODUOC_ID = pvsd.KHODUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NOITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) B on B.DUOC_ID = dtk.DUOC_ID and B.SOLUONG > 0 and B.PHAMVI_ID = pvsd.PHAMVI_ID and B.NGUONHANG_ID = dtk.NGUONDUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NGOAITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) A on A.DUOC_ID = dtk.DUOC_ID and A.SOLUONG > 0 and A.PHAMVI_ID = pvsd.PHAMVI_ID and A.NGUONHANG_ID = dtk.NGUONDUOC_ID        where dtk.SOLUONG > 0 and dtk.BENHVIEN_ID = 'HLU01'        group by LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')), pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        ) tk on tk.DUOC_ID = d.DUOC_ID        left join TM_DUOC_PHAMVISUDUNG kd on kd.PHAMVI_ID = tk.PHAMVI_ID and kd.BENHVIEN_ID = 'HLU01'        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = tk.NGUONDUOC_ID and nh.BENHVIEN_ID = 'HLU01'        where  d.BENHVIEN_ID = 'HLU01' and d.DUOC_ID in (1)        end]
2019-09-20 17:43:29,496 [1] DEBUG - Statement Id: [DAO00030_RemoveChungTuVTYTNgoaiTru] PreparedStatement : [update TT_NGOAITRU_KHAMBENH_VTYT set            CHUNGTU_ID = null,            TRANGTHAI = null            where            CHUNGTU_ID =   @param0               update TT_VIENPHI set            DUYET = '0',            DATHUCHIEN = '0'            where            REF_TABLE = 'TT_NGOAITRU_KHAMBENH_VTYT'            AND REF_ID IN (10593)]
2019-09-20 17:43:29,496 [1] DEBUG - Statement Id: [DAO00030_RemoveChungTuVTYTNgoaiTru] Parameters: [@param0=[CHUNGTU_ID,137704]]
2019-09-20 17:43:29,496 [1] DEBUG - Statement Id: [DAO00030_RemoveChungTuVTYTNgoaiTru] Types: [@param0=[Int64, System.Int64]]
2019-09-20 17:43:49,509 [1] DEBUG - Statement Id: [DAO00030_CHUNGTUCT_Add] PreparedStatement : [insert into TT_DUOC_CHUNGTU_CHITIET (            CHUNGTU_ID            , DUOC_ID            , SOLONHAP_ID            , SOKIEMSOAT            , SOVISA            , HANDUNG            , DONVITINH_ID            , SOLUONGYEUCAU            , SOLUONGTHUCTE            , SOLUONGDAXUAT            , TIENTE_ID            , TYGIA            , DONGIAMUA            , DONGIA_BHYT            , DONGIABAN            , DONGIABAN_VAT            , DONGIAVON            , DONGIATHANHTOAN            , SOQUYEN            , SOHOADONVAT            , TYLEVAT            , GIATRIVAT            , TYLECHIETKHAU            , GIATRICHIETKHAU            , MIENPHI            , LYDOMIENPHI_ID            , SOCHUNGTUKETOAN            , SOCHUNGTUTIENMAT            , TRANGTHAI            , DAPHATSINHPHIEUXUAT            , DAPHATSINHPHIEUHOANTRA            , KHUYENMAI            , PHUONGPHAPXUAT            , DONDATHANG_ID            , GHICHUCHITIET            , NGUONHANG_ID            , DONGIAVONVAT            , THANHTIENMUA            , THANHTIENVON            , THANHTIENHOPDONG            , ISTACHLO            , DONVITINHBANDAU_ID            , SOLUONGBANDAU            , GOITHAU_ID            , DONGIATHAU            , DONGIAPO            , TYLEQUIDOI            , TOATHUOCNOITRU_ID            , KHAMBENH_VTYT_ID            , PHAUTHUAT_VTYT_ID            , CLSKETQUA_VTYT_ID            , TOATHUOCNGOAITRU_ID            , MASTER_ID            , BENHNHAN            , YLENH                                   , BENHVIEN_ID            , NGAYTAO            , NGUOITAO_ID            , NGAYCAPNHAT            , NGUOICAPNHAT_ID            , THANHTIENMUABANDAU            , SOLUONGQUIDOI            ) values (             @param0             ,  @param1             ,  @param2             ,  @param3             ,  @param4             ,  @param5             ,  @param6             ,  @param7             ,  @param8             ,  @param9             ,  @param10             ,  @param11             ,  @param12             ,  @param13             ,  @param14             ,  @param15             ,  @param16             ,  @param17             ,  @param18             ,  @param19             ,  @param20             ,  @param21             ,  @param22             ,  @param23             ,  @param24             ,  @param25             ,  @param26             ,  @param27             ,  @param28             ,  @param29             ,  @param30             ,  @param31             ,  @param32             ,  @param33             ,  @param34             ,  @param35             ,  @param36             ,  @param37             ,  @param38             ,  @param39             ,  @param40             ,  @param41             ,  @param42             ,  @param43             ,  @param44             ,  @param45             ,  @param46             ,  @param47             ,  @param48             ,  @param49             ,  @param50             ,  @param51             ,  @param52             ,  @param53             ,  @param54                          ,  @param55             ,  @param56             ,  @param57             ,  @param58             ,  @param59             ,  @param60             ,  @param61             )            select SCOPE_identity() as value]
2019-09-20 17:43:49,510 [1] DEBUG - Statement Id: [DAO00030_CHUNGTUCT_Add] Parameters: [@param0=[CHUNGTU_ID,137704], @param1=[DUOC_ID,1], @param2=[SOLONHAP_ID,7541], @param3=[SOKIEMSOAT,null], @param4=[SOVISA,1], @param5=[HANDUNG,12/12/2026 12:00:00 AM], @param6=[DONVITINH_ID,17], @param7=[SOLUONGYEUCAU,2], @param8=[SOLUONGTHUCTE,null], @param9=[SOLUONGDAXUAT,2], @param10=[TIENTE_ID,null], @param11=[TYGIA,null], @param12=[DONGIAMUA,945], @param13=[DONGIA_BHYT,null], @param14=[DONGIABAN,1030], @param15=[DONGIABAN_VAT,1030], @param16=[DONGIAVON,945], @param17=[DONGIATHANHTOAN,null], @param18=[SOQUYEN,null], @param19=[SOHOADONVAT,null], @param20=[TYLEVAT,0], @param21=[GIATRIVAT,null], @param22=[TYLECHIETKHAU,null], @param23=[GIATRICHIETKHAU,null], @param24=[MIENPHI,null], @param25=[LYDOMIENPHI_ID,null], @param26=[SOCHUNGTUKETOAN,null], @param27=[SOCHUNGTUTIENMAT,null], @param28=[TRANGTHAI,null], @param29=[DAPHATSINHPHIEUXUAT,null], @param30=[DAPHATSINHPHIEUHOANTRA,null], @param31=[KHUYENMAI,null], @param32=[PHUONGPHAPXUAT,null], @param33=[DONDATHANG_ID,null], @param34=[GHICHUCHITIET,null], @param35=[NGUONHANG_ID,1], @param36=[DONGIAVONVAT,945], @param37=[THANHTIENMUA,1890], @param38=[THANHTIENVON,1890], @param39=[THANHTIENHOPDONG,null], @param40=[ISTACHLO,null], @param41=[DONVITINHBANDAU_ID,null], @param42=[SOLUONGBANDAU,null], @param43=[GOITHAU_ID,null], @param44=[DONGIATHAU,1030], @param45=[DONGIAPO,null], @param46=[TYLEQUIDOI,null], @param47=[TOATHUOCNOITRU_ID,null], @param48=[KHAMBENH_VTYT_ID,10593], @param49=[PHAUTHUAT_VTYT_ID,null], @param50=[CLSKETQUA_VTYT_ID,null], @param51=[TOATHUOCNGOAITRU_ID,null], @param52=[MASTER_ID,0], @param53=[BENHNHAN,Người bệnh: 190043304 - Test Xn1 - 20/09/2019 - 16:50], @param54=[YLENH,null], @param55=[BENHVIEN_ID,HLU01], @param56=[NGAYTAO,9/20/2019 5:43:49 PM], @param57=[NGUOITAO_ID,0], @param58=[NGAYCAPNHAT,9/20/2019 5:43:49 PM], @param59=[NGUOICAPNHAT_ID,0], @param60=[THANHTIENMUABANDAU,null], @param61=[SOLUONGQUIDOI,null]]
2019-09-20 17:43:49,510 [1] DEBUG - Statement Id: [DAO00030_CHUNGTUCT_Add] Types: [@param0=[Int64, System.Int64], @param1=[Int64, System.Int64], @param2=[Int64, System.Int64], @param3=[System.DBNull, null], @param4=[String, System.String], @param5=[DateTime, System.DateTime], @param6=[Int64, System.Int64], @param7=[Double, System.Double], @param8=[System.DBNull, null], @param9=[Double, System.Double], @param10=[System.DBNull, null], @param11=[System.DBNull, null], @param12=[Double, System.Double], @param13=[System.DBNull, null], @param14=[Double, System.Double], @param15=[Double, System.Double], @param16=[Double, System.Double], @param17=[System.DBNull, null], @param18=[System.DBNull, null], @param19=[System.DBNull, null], @param20=[Double, System.Double], @param21=[System.DBNull, null], @param22=[System.DBNull, null], @param23=[System.DBNull, null], @param24=[System.DBNull, null], @param25=[System.DBNull, null], @param26=[System.DBNull, null], @param27=[System.DBNull, null], @param28=[System.DBNull, null], @param29=[System.DBNull, null], @param30=[System.DBNull, null], @param31=[System.DBNull, null], @param32=[System.DBNull, null], @param33=[System.DBNull, null], @param34=[System.DBNull, null], @param35=[Int64, System.Int64], @param36=[Double, System.Double], @param37=[Double, System.Double], @param38=[Double, System.Double], @param39=[System.DBNull, null], @param40=[System.DBNull, null], @param41=[System.DBNull, null], @param42=[System.DBNull, null], @param43=[System.DBNull, null], @param44=[Double, System.Double], @param45=[System.DBNull, null], @param46=[System.DBNull, null], @param47=[System.DBNull, null], @param48=[Int64, System.Int64], @param49=[System.DBNull, null], @param50=[System.DBNull, null], @param51=[System.DBNull, null], @param52=[Int64, System.Int64], @param53=[String, System.String], @param54=[System.DBNull, null], @param55=[String, System.String], @param56=[DateTime, System.DateTime], @param57=[Int64, System.Int64], @param58=[DateTime, System.DateTime], @param59=[Int64, System.Int64], @param60=[System.DBNull, null], @param61=[System.DBNull, null]]
2019-09-20 17:43:50,059 [1] DEBUG - Statement Id: [DAO00030_TT_DUOC_TONKHO_LOG_Add] PreparedStatement : [DECLARE @KHODUOC_ID int               DECLARE @TONTRUOC numeric(18, 4)               DECLARE @TONSAU numeric(18, 4)               DECLARE @SOLUONGNHAP numeric(18, 4)               DECLARE @SOLUONGXUAT numeric(18, 4)                              IF( @param0  = 'N')               BEGIN                SET @KHODUOC_ID =  @param1                END               ELSE               BEGIN                 SET @KHODUOC_ID =  @param2                END                              SELECT @TONTRUOC = SOLUONG FROM TT_DUOC_TONKHO WHERE KHODUOC_ID = @KHODUOC_ID  AND DUOC_ID =  @param3  AND SOLONHAP_ID =  @param4  AND NGUONDUOC_ID =  @param5                               IF( @param0  = 'N' AND  @param6  = 'ADD')               BEGIN                SET @TONSAU = ISNULL(@TONTRUOC,0) +  @param7                 SET @SOLUONGNHAP =  @param7                 SET @SOLUONGXUAT = 0               END               IF( @param0  = 'N' AND  @param6  = 'DEL')               BEGIN                SET @TONSAU = ISNULL(@TONTRUOC,0) -  @param7                 SET @SOLUONGXUAT =  @param7                 SET @SOLUONGNHAP = 0               END                                         IF( @param0  = 'X' AND  @param6  = 'ADD')               BEGIN                SET @TONSAU = ISNULL(@TONTRUOC,0) -  @param8                 SET @SOLUONGXUAT =  @param8                 SET @SOLUONGNHAP = 0               END               IF( @param0  = 'X' AND  @param6  = 'DEL')               BEGIN                SET @TONSAU = ISNULL(@TONTRUOC,0) +  @param8                 SET @SOLUONGNHAP =  @param8                 SET @SOLUONGXUAT = 0                             END                        insert into TT_DUOC_TONKHO_LOG (                           CHUNGTUCHITIET_ID              ,CHUNGTU_ID              ,MACHUNGTU              ,LOAICHUNGTU              ,MUCDICHCHUNGTU_CODE              ,KHONHAP_ID              ,KHOXUAT_ID              ,DUOC_ID              ,SOLONHAP_ID              ,NGUONDUOC_ID              ,SOLUONGNHAP              ,SOLUONGXUAT              ,DONGIAMUA              ,DONGIAVON              ,TYLE_VAT              ,DONGIAVONVAT              ,TONTRUOC              ,TONSAU              ,ACTION              ,BENHVIEN_ID              ,NGAYTAO              ,NGUOITAO_ID                          ) values (              @param9               , @param10               , @param11               , @param0               , @param12               , @param1               , @param2               , @param3               , @param4               , @param5               ,@SOLUONGNHAP              ,@SOLUONGXUAT              , @param13               , @param14               , @param15               , @param16               ,@TONTRUOC              ,@TONSAU              , @param6               , @param17               , @param18               , @param19               )]
2019-09-20 17:43:50,059 [1] DEBUG - Statement Id: [DAO00030_TT_DUOC_TONKHO_LOG_Add] Parameters: [@param0=[LOAICHUNGTU,X], @param1=[KHONHAP_ID,null], @param2=[KHOXUAT_ID,32], @param3=[DUOC_ID,1], @param4=[SOLONHAP_ID,7541], @param5=[NGUONDUOC_ID,1], @param6=[ACTION,ADD], @param7=[SOLUONGNHAP,null], @param8=[SOLUONGXUAT,2], @param9=[CHUNGTUCHITIET_ID,1299051], @param10=[CHUNGTU_ID,137704], @param11=[MACHUNGTU,CS_KBX1319003092], @param12=[MUCDICHCHUNGTU_CODE,X13], @param13=[DONGIAMUA,945], @param14=[DONGIAVON,945], @param15=[TYLE_VAT,0], @param16=[DONGIAVONVAT,945], @param17=[BENHVIEN_ID,HLU01], @param18=[NGAYTAO,9/20/2019 5:43:50 PM], @param19=[NGUOITAO_ID,0]]
2019-09-20 17:43:50,059 [1] DEBUG - Statement Id: [DAO00030_TT_DUOC_TONKHO_LOG_Add] Types: [@param0=[String, System.String], @param1=[System.DBNull, null], @param2=[Int64, System.Int64], @param3=[Int64, System.Int64], @param4=[Int64, System.Int64], @param5=[Int64, System.Int64], @param6=[String, System.String], @param7=[System.DBNull, null], @param8=[Decimal, System.Decimal], @param9=[Int64, System.Int64], @param10=[Int64, System.Int64], @param11=[String, System.String], @param12=[String, System.String], @param13=[Decimal, System.Decimal], @param14=[Decimal, System.Decimal], @param15=[Double, System.Double], @param16=[Double, System.Double], @param17=[String, System.String], @param18=[DateTime, System.DateTime], @param19=[Int64, System.Int64]]
2019-09-20 17:43:56,083 [1] DEBUG - Statement Id: [DAO00030_DUOC_TONKHO_BOOKING_NGOAITRU_Giam] PreparedStatement : [update TT_DUOC_TONKHO_BOOK_NGOAITRU            set            SOLUONG = 0                     ,NGAYCAPNHAT = getdate()            where            REF_TABLE = 'TT_NGOAITRU_KHAMBENH_VTYT'            AND REF_ID = '10593'                AND BENHVIEN_ID = 'HLU01']
2019-09-20 17:43:56,139 [1] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoVaBookingCOM23UpdateRedis] PreparedStatement : [declare @NGUONDUOC_MACDINH varchar(5) = '0';        declare @TOAMUANGOAI int = 0;        select @NGUONDUOC_MACDINH = isnull(VALUE,0) from TM_SYS_APPSETTINGS where CODE = 'PHA_NGUONDUOC'        select @TOAMUANGOAI = isnull(VALUE,0) from TM_SYS_APPSETTINGS where CODE = 'OPD_TOAMUANGOAI_DUNGDANHMUC_DUOC'                if @TOAMUANGOAI = 1        begin        select  distinct '0' + '_' + LTRIM(d.DUOC_ID) + '_' + @NGUONDUOC_MACDINH as DUOC_KEY, 0 as PHAMVI_ID, @NGUONDUOC_MACDINH as NGUONDUOC_ID, null as TENNGUONDUOC, null as TINHTIEN, d.DUOC_ID, ld.MALOAIDUOC,        d.SOVISA,d.TYLE_VAT,d.COTOA, d.MADUOC, d.TENHANG, d.TENDUOCDAYDU, dvt.TENDONVITINH as DONVITINH, d.BHYT,        d.TENHOATCHAT, d.HAMLUONG, d.HANGSANXUAT, d.QUOCGIA, d.LOAIDUOC_ID, d.DUONGDUNG_ID, d.TINHTIEN_PTTT,        ten.TENDUOC, ten.TENDUOC_EN, ten.MAQUOCTE, ten.MAQUOCTEBT,        '' as BHYT_TEXT        , ld.LOAIVATTU_ID        , d.BENHVIEN_ID,        999999999 as SOLUONG, d.VTYT_PHANLOAI, d.PHAMVI, d.SUASOLUONGTONGHOP, d.MADUOCBV, d.DANGTRINHBAY        , TAMNGUNG = CASE WHEN d.TAMNGUNG = '1' THEN '1' ELSE '0' END        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        where d.DUOC_ID in (1)        union all        select  distinct tk.DUOC_KEY, LTRIM(tk.PHAMVI_ID) as PHAMVI_ID, tk.NGUONDUOC_ID, nh.TENNGUONDUOC, nh.TINHTIEN, d.DUOC_ID, ld.MALOAIDUOC,        d.SOVISA,d.TYLE_VAT,d.COTOA, d.MADUOC, d.TENHANG, d.TENDUOCDAYDU, dvt.TENDONVITINH as DONVITINH, d.BHYT,        d.TENHOATCHAT, d.HAMLUONG, d.HANGSANXUAT, d.QUOCGIA, d.LOAIDUOC_ID, d.DUONGDUNG_ID, d.TINHTIEN_PTTT,        ten.TENDUOC, ten.TENDUOC_EN, ten.MAQUOCTE, ten.MAQUOCTEBT,        CASE WHEN d.BHYT = '1' THEN 'BHYT' ELSE '' END as BHYT_TEXT        , ld.LOAIVATTU_ID        , d.BENHVIEN_ID,        tk.SOLUONG, d.VTYT_PHANLOAI, d.PHAMVI, d.SUASOLUONGTONGHOP, d.MADUOCBV, d.DANGTRINHBAY        , TAMNGUNG = CASE WHEN d.TAMNGUNG = '1' OR nh.TAMNGUNG = '1' OR kd.TAMNGUNG = '1' THEN '1' ELSE '0' END        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        inner join        (        select  LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')) DUOC_KEY, (SUM(dtk.SOLUONG) - isnull(sum(A.SOLUONG),0) - isnull(sum(B.SOLUONG),0)) SOLUONG, pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        from (select sum(soluong) soluong,duoc_id,nguonduoc_id,khoduoc_id,benhvien_id from TT_DUOC_TONKHO  group by duoc_id,nguonduoc_id,khoduoc_id,benhvien_id) dtk        inner join TM_DUOC_PHAMVISD_MAPPING pvsd on dtk.KHODUOC_ID = pvsd.KHODUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NOITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) B on B.DUOC_ID = dtk.DUOC_ID and B.SOLUONG > 0 and B.PHAMVI_ID = pvsd.PHAMVI_ID and B.NGUONHANG_ID = dtk.NGUONDUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NGOAITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) A on A.DUOC_ID = dtk.DUOC_ID and A.SOLUONG > 0 and A.PHAMVI_ID = pvsd.PHAMVI_ID and A.NGUONHANG_ID = dtk.NGUONDUOC_ID        where dtk.SOLUONG > 0 and dtk.BENHVIEN_ID = 'HLU01'        group by LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')), pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        ) tk on tk.DUOC_ID = d.DUOC_ID        left join TM_DUOC_PHAMVISUDUNG kd on kd.PHAMVI_ID = tk.PHAMVI_ID and kd.BENHVIEN_ID = 'HLU01'        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = tk.NGUONDUOC_ID and nh.BENHVIEN_ID = 'HLU01'        where  d.BENHVIEN_ID = 'HLU01' and d.DUOC_ID in (1)        end        else        begin        select  distinct tk.DUOC_KEY, LTRIM(tk.PHAMVI_ID) as PHAMVI_ID, tk.NGUONDUOC_ID, nh.TENNGUONDUOC, nh.TINHTIEN, d.DUOC_ID, ld.MALOAIDUOC,        d.SOVISA,d.TYLE_VAT,d.COTOA, d.MADUOC, d.TENHANG, d.TENDUOCDAYDU, dvt.TENDONVITINH as DONVITINH, d.BHYT,        d.TENHOATCHAT, d.HAMLUONG, d.HANGSANXUAT, d.QUOCGIA, d.LOAIDUOC_ID, d.DUONGDUNG_ID, d.TINHTIEN_PTTT,        ten.TENDUOC, ten.TENDUOC_EN, ten.MAQUOCTE, ten.MAQUOCTEBT,        CASE WHEN d.BHYT = '1' THEN 'BHYT' ELSE '' END as BHYT_TEXT        , ld.LOAIVATTU_ID        , d.BENHVIEN_ID,        tk.SOLUONG, d.VTYT_PHANLOAI, d.PHAMVI, d.SUASOLUONGTONGHOP, d.MADUOCBV, d.DANGTRINHBAY        , TAMNGUNG = CASE WHEN d.TAMNGUNG = '1' OR nh.TAMNGUNG = '1' OR kd.TAMNGUNG = '1' THEN '1' ELSE '0' END        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        inner join        (        select  LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')) DUOC_KEY, (SUM(dtk.SOLUONG) - isnull(sum(A.SOLUONG),0) - isnull(sum(B.SOLUONG),0)) SOLUONG, pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        from (select sum(soluong) soluong,duoc_id,nguonduoc_id,khoduoc_id,benhvien_id from TT_DUOC_TONKHO  group by duoc_id,nguonduoc_id,khoduoc_id,benhvien_id) dtk        inner join TM_DUOC_PHAMVISD_MAPPING pvsd on dtk.KHODUOC_ID = pvsd.KHODUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NOITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) B on B.DUOC_ID = dtk.DUOC_ID and B.SOLUONG > 0 and B.PHAMVI_ID = pvsd.PHAMVI_ID and B.NGUONHANG_ID = dtk.NGUONDUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NGOAITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) A on A.DUOC_ID = dtk.DUOC_ID and A.SOLUONG > 0 and A.PHAMVI_ID = pvsd.PHAMVI_ID and A.NGUONHANG_ID = dtk.NGUONDUOC_ID        where dtk.SOLUONG > 0 and dtk.BENHVIEN_ID = 'HLU01'        group by LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')), pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        ) tk on tk.DUOC_ID = d.DUOC_ID        left join TM_DUOC_PHAMVISUDUNG kd on kd.PHAMVI_ID = tk.PHAMVI_ID and kd.BENHVIEN_ID = 'HLU01'        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = tk.NGUONDUOC_ID and nh.BENHVIEN_ID = 'HLU01'        where  d.BENHVIEN_ID = 'HLU01' and d.DUOC_ID in (1)        end]
2019-09-20 17:43:56,342 [1] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoCOM18UpdateRedis] PreparedStatement : [select distinct TT_TONKHO.DUOC_KEY, LTRIM(TT_TONKHO.KHODUOC_ID) as KHODUOC_ID, TM_DUOC.DUOC_ID, TM_LOAIDUOC.MALOAIDUOC,TM_DUOC.SOVISA,TM_DUOC.TYLE_VAT,TM_DUOC.COTOA,        TM_DUOC.MADUOC, TM_DUOC.TENHANG, TM_DUOC.TENDUOCDAYDU, dvt.TENDONVITINH as DONVITINH,  TM_DUOC.DONVITINH_ID,TM_DUOC.BHYT,        TM_DUOC.TENHOATCHAT,        TM_DUOC.HAMLUONG, TM_DUOC.HANGSANXUAT, TM_DUOC.QUOCGIA, TM_DUOC.LOAIDUOC_ID, TM_DUOC.DUONGDUNG_ID,        TM_TENDUOC.TENDUOC, TM_TENDUOC.TENDUOC_EN, TM_TENDUOC.MAQUOCTE, TM_TENDUOC.MAQUOCTEBT,        TM_LOAIDUOC.LOAIVATTU_ID, TM_DUOC.BENHVIEN_ID,        TT_TONKHO.SOLUONG, TM_DUOC.VTYT_PHANLOAI, TM_DUOC.PHAMVI, TT_TONKHO.NGUONDUOC_ID, NG.TENNGUONDUOC AS TENNGUONDUOC        , TAMNGUNG = CASE WHEN TM_DUOC.TAMNGUNG = '1' OR NG.TAMNGUNG = '1' OR KD.TAMNGUNG = '1' THEN '1' ELSE '0' END        , TM_DUOC.DANGTRINHBAY        from TM_DUOC        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = TM_DUOC.DONVITINH_ID        left join TM_TENDUOC on TM_DUOC.TENDUOC_ID = TM_TENDUOC.TENDUOC_ID and TM_DUOC.BENHVIEN_ID = 'HLU01' and TM_DUOC.TAMNGUNG = '0'        left join TM_LOAIDUOC on TM_LOAIDUOC.LOAIDUOC_ID = TM_DUOC.LOAIDUOC_ID and TM_LOAIDUOC.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG on (TM_LOAIDUOC.LOAIVATTU_ID = TM_DUOC_HANDUNG.LOAIDUOC and TM_DUOC_HANDUNG.BENHVIEN_ID = 'HLU01')        inner join        (select LTRIM(A.KHODUOC_ID) + '_' + LTRIM(A.DUOC_ID) + '_' + LTRIM(ISNULL(A.NGUONDUOC_ID,'')) as DUOC_KEY, A.KHODUOC_ID, A.DUOC_ID, A.NGUONDUOC_ID,        SUM(isnull(A.SOLUONG,0)) as SOLUONG        from        (select SUM(SOLUONG) as SOLUONG, KHODUOC_ID, DUOC_ID, NGUONDUOC_ID from TT_DUOC_TONKHO        where BENHVIEN_ID = 'HLU01' group by KHODUOC_ID, DUOC_ID, NGUONDUOC_ID) A        group by LTRIM(A.KHODUOC_ID) + '_' + LTRIM(A.DUOC_ID) + '_' + LTRIM(ISNULL(A.NGUONDUOC_ID,'')), A.KHODUOC_ID, A.DUOC_ID, NGUONDUOC_ID        ) TT_TONKHO on TT_TONKHO.DUOC_ID = TM_DUOC.DUOC_ID        LEFT JOIN TM_NGUONHANG NG ON NG.NGUONDUOC_ID = TT_TONKHO.NGUONDUOC_ID        LEFT JOIN TM_KHODUOC KD ON KD.KHODUOC_ID = TT_TONKHO.KHODUOC_ID        where TM_DUOC.BENHVIEN_ID = 'HLU01' and TT_TONKHO.SOLUONG >= 0        and TM_DUOC.DUOC_ID in (1)]
2019-09-20 17:44:33,815 [1] DEBUG - Statement Id: [DAO00030_DUOCTONKHO_Giam] PreparedStatement : [update TT_DUOC_TONKHO set            SOLUONG = SOLUONG -  @param0             , NGAYCAPNHAT =  getdate()            , NGUOICAPNHAT_ID =  @param1             where            KHODUOC_ID =  @param2             and DUOC_ID =  @param3             and SOLONHAP_ID =  @param4]
2019-09-20 17:44:33,815 [1] DEBUG - Statement Id: [DAO00030_DUOCTONKHO_Giam] Parameters: [@param0=[SOLUONGTHAYDOI,2], @param1=[NGUOICAPNHAT_ID,0], @param2=[KHODUOC_ID,32], @param3=[DUOC_ID,1], @param4=[SOLONHAP_ID,7541]]
2019-09-20 17:44:33,816 [1] DEBUG - Statement Id: [DAO00030_DUOCTONKHO_Giam] Types: [@param0=[Double, System.Double], @param1=[Int64, System.Int64], @param2=[Int64, System.Int64], @param3=[Int64, System.Int64], @param4=[Int64, System.Int64]]
2019-09-20 17:44:33,848 [1] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoCOM18] PreparedStatement : [select  distinct TT_TONKHO.DUOC_KEY, LTRIM(TT_TONKHO.KHODUOC_ID) as KHODUOC_ID, TM_DUOC.DUOC_ID, TM_LOAIDUOC.MALOAIDUOC,TM_DUOC.SOVISA,TM_DUOC.TYLE_VAT,TM_DUOC.COTOA,        TM_DUOC.MADUOC, TM_DUOC.TENHANG, TM_DUOC.TENDUOCDAYDU, dvt.TENDONVITINH as DONVITINH, TM_DUOC.DONVITINH_ID, TM_DUOC.BHYT,        TM_DUOC.TENHOATCHAT, TM_DUOC.HAMLUONG, TM_DUOC.HANGSANXUAT, TM_DUOC.QUOCGIA, TM_DUOC.LOAIDUOC_ID, TM_DUOC.DUONGDUNG_ID,        TM_TENDUOC.TENDUOC, TM_TENDUOC.TENDUOC_EN, TM_TENDUOC.MAQUOCTE, TM_TENDUOC.MAQUOCTEBT,        TM_LOAIDUOC.LOAIVATTU_ID, TM_DUOC.BENHVIEN_ID,        TT_TONKHO.SOLUONG, TM_DUOC.VTYT_PHANLOAI, TM_DUOC.PHAMVI, TT_TONKHO.NGUONDUOC_ID, NG.TENNGUONDUOC        , TAMNGUNG = CASE WHEN TM_DUOC.TAMNGUNG = '1' OR NG.TAMNGUNG = '1' OR KD.TAMNGUNG = '1' THEN '1' ELSE '0' END        , TM_DUOC.DANGTRINHBAY        from TM_DUOC        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = TM_DUOC.DONVITINH_ID        left join TM_TENDUOC on TM_DUOC.TENDUOC_ID = TM_TENDUOC.TENDUOC_ID and TM_DUOC.BENHVIEN_ID = 'HLU01'  and TM_DUOC.TAMNGUNG = '0'        left join TM_LOAIDUOC on TM_LOAIDUOC.LOAIDUOC_ID = TM_DUOC.LOAIDUOC_ID and TM_LOAIDUOC.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG on (TM_LOAIDUOC.LOAIVATTU_ID = TM_DUOC_HANDUNG.LOAIDUOC and TM_DUOC_HANDUNG.BENHVIEN_ID = 'HLU01')        inner join        (select LTRIM(A.KHODUOC_ID) + '_' + LTRIM(A.DUOC_ID) + '_' + LTRIM(ISNULL(A.NGUONDUOC_ID,'')) as DUOC_KEY, A.KHODUOC_ID, A.DUOC_ID ,a.NGUONDUOC_ID,        SUM(isnull(A.SOLUONG,0)) as SOLUONG        from        (select SUM(SOLUONG) as SOLUONG, KHODUOC_ID, DUOC_ID, NGUONDUOC_ID from TT_DUOC_TONKHO        where KHODUOC_ID in (32) and DUOC_ID in (1) group by KHODUOC_ID, DUOC_ID, NGUONDUOC_ID        ) A        where A.KHODUOC_ID in (32) and A.DUOC_ID in (1)        group by LTRIM(A.KHODUOC_ID) + '_' + LTRIM(A.DUOC_ID) + '_' + LTRIM(A.NGUONDUOC_ID), A.KHODUOC_ID, A.DUOC_ID, A.NGUONDUOC_ID)        TT_TONKHO on TT_TONKHO.DUOC_ID = TM_DUOC.DUOC_ID        LEFT JOIN TM_NGUONHANG NG ON NG.NGUONDUOC_ID = TT_TONKHO.NGUONDUOC_ID        LEFT JOIN TM_KHODUOC KD ON KD.KHODUOC_ID = TT_TONKHO.KHODUOC_ID        where TM_DUOC.BENHVIEN_ID = 'HLU01' and TM_DUOC.DUOC_ID in (1)]
2019-09-20 17:44:33,884 [1] DEBUG - Statement Id: [DAO00030_GetListPhamViByKhoDuoc] PreparedStatement : [SELECT DISTINCT PHAMVI_ID          FROM TM_DUOC_PHAMVISD_MAPPING          WHERE          KHODUOC_ID IN (32)          AND BENHVIEN_ID ='HLU01'          AND TAMNGUNG = '0']
2019-09-20 17:44:33,915 [1] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoVaBookingCOM23] PreparedStatement : [declare @NGUONDUOC_MACDINH varchar(5) = '0';        declare @TOAMUANGOAI int = 0;        select @NGUONDUOC_MACDINH = isnull(VALUE,0) from TM_SYS_APPSETTINGS where CODE = 'PHA_NGUONDUOC'        select @TOAMUANGOAI = isnull(VALUE,0) from TM_SYS_APPSETTINGS where CODE = 'OPD_TOAMUANGOAI_DUNGDANHMUC_DUOC'                if @TOAMUANGOAI = 1        begin        select  distinct '0' + '_' + LTRIM(d.DUOC_ID) + '_' + @NGUONDUOC_MACDINH as DUOC_KEY, 0 as PHAMVI_ID, @NGUONDUOC_MACDINH as NGUONDUOC_ID, null as TENNGUONDUOC, null as TINHTIEN, d.DUOC_ID, ld.MALOAIDUOC,        d.SOVISA,d.TYLE_VAT,d.COTOA, d.MADUOC, d.TENHANG, d.TENDUOCDAYDU, dvt.TENDONVITINH as DONVITINH, d.BHYT,        d.TENHOATCHAT, d.HAMLUONG, d.HANGSANXUAT, d.QUOCGIA, d.LOAIDUOC_ID, d.DUONGDUNG_ID, d.TINHTIEN_PTTT,        ten.TENDUOC, ten.TENDUOC_EN, ten.MAQUOCTE, ten.MAQUOCTEBT,        '' as BHYT_TEXT        , ld.LOAIVATTU_ID        , d.BENHVIEN_ID,        999999999 as SOLUONG, d.VTYT_PHANLOAI, d.PHAMVI, d.SUASOLUONGTONGHOP, d.MADUOCBV, d.DANGTRINHBAY        , TAMNGUNG = CASE WHEN d.TAMNGUNG = '1' THEN '1' ELSE '0' END        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        where d.DUOC_ID in (1)        union all        select  distinct tk.DUOC_KEY, LTRIM(tk.PHAMVI_ID) as PHAMVI_ID, tk.NGUONDUOC_ID, nh.TENNGUONDUOC, nh.TINHTIEN, d.DUOC_ID, ld.MALOAIDUOC,        d.SOVISA,d.TYLE_VAT,d.COTOA, d.MADUOC, d.TENHANG, d.TENDUOCDAYDU, dvt.TENDONVITINH as DONVITINH, d.BHYT,        d.TENHOATCHAT, d.HAMLUONG, d.HANGSANXUAT, d.QUOCGIA, d.LOAIDUOC_ID, d.DUONGDUNG_ID, d.TINHTIEN_PTTT,        ten.TENDUOC, ten.TENDUOC_EN, ten.MAQUOCTE, ten.MAQUOCTEBT,        CASE WHEN d.BHYT = '1' THEN 'BHYT' ELSE '' END as BHYT_TEXT        , ld.LOAIVATTU_ID        , d.BENHVIEN_ID,        tk.SOLUONG, d.VTYT_PHANLOAI, d.PHAMVI, d.SUASOLUONGTONGHOP, d.MADUOCBV, d.DANGTRINHBAY        , TAMNGUNG = CASE WHEN d.TAMNGUNG = '1' OR nh.TAMNGUNG = '1' OR kd.TAMNGUNG = '1' THEN '1' ELSE '0' END        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        inner join        (        select  LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')) DUOC_KEY, (SUM(dtk.SOLUONG) - isnull(sum(A.SOLUONG),0) - isnull(sum(B.SOLUONG),0)) SOLUONG, pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        from (select sum(soluong) soluong,duoc_id,nguonduoc_id,khoduoc_id,benhvien_id from TT_DUOC_TONKHO  group by duoc_id,nguonduoc_id,khoduoc_id,benhvien_id) dtk        inner join TM_DUOC_PHAMVISD_MAPPING pvsd on dtk.KHODUOC_ID = pvsd.KHODUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NOITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) B on B.DUOC_ID = dtk.DUOC_ID and B.SOLUONG > 0 and B.PHAMVI_ID = pvsd.PHAMVI_ID and B.NGUONHANG_ID = dtk.NGUONDUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NGOAITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) A on A.DUOC_ID = dtk.DUOC_ID and A.SOLUONG > 0 and A.PHAMVI_ID = pvsd.PHAMVI_ID and A.NGUONHANG_ID = dtk.NGUONDUOC_ID        where dtk.SOLUONG > 0 and dtk.BENHVIEN_ID = 'HLU01'        group by LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')), pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        ) tk on tk.DUOC_ID = d.DUOC_ID        left join TM_DUOC_PHAMVISUDUNG kd on kd.PHAMVI_ID = tk.PHAMVI_ID and kd.BENHVIEN_ID = 'HLU01'        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = tk.NGUONDUOC_ID and nh.BENHVIEN_ID = 'HLU01'        where  d.BENHVIEN_ID = 'HLU01' and d.DUOC_ID in (1) and TK.PHAMVI_ID in (1055)        and tk.NGUONDUOC_ID in (1)         end        else        begin                select  distinct tk.DUOC_KEY, LTRIM(tk.PHAMVI_ID) as PHAMVI_ID, tk.NGUONDUOC_ID, nh.TENNGUONDUOC, nh.TINHTIEN, d.DUOC_ID, ld.MALOAIDUOC,        d.SOVISA,d.TYLE_VAT,d.COTOA, d.MADUOC, d.TENHANG, d.TENDUOCDAYDU, dvt.TENDONVITINH as DONVITINH, d.BHYT,        d.TENHOATCHAT, d.HAMLUONG, d.HANGSANXUAT, d.QUOCGIA, d.LOAIDUOC_ID, d.DUONGDUNG_ID, d.TINHTIEN_PTTT,        ten.TENDUOC, ten.TENDUOC_EN, ten.MAQUOCTE, ten.MAQUOCTEBT,        CASE WHEN d.BHYT = '1' THEN 'BHYT' ELSE '' END as BHYT_TEXT        , ld.LOAIVATTU_ID        , d.BENHVIEN_ID,        tk.SOLUONG, d.VTYT_PHANLOAI, d.PHAMVI, d.SUASOLUONGTONGHOP, d.MADUOCBV, d.DANGTRINHBAY        , TAMNGUNG = CASE WHEN d.TAMNGUNG = '1' OR nh.TAMNGUNG = '1' OR kd.TAMNGUNG = '1' THEN '1' ELSE '0' END        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        inner join        (        select  LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')) DUOC_KEY, (SUM(dtk.SOLUONG) - isnull(sum(A.SOLUONG),0) - isnull(sum(B.SOLUONG),0)) SOLUONG, pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        from (select sum(soluong) soluong,duoc_id,nguonduoc_id,khoduoc_id,benhvien_id from TT_DUOC_TONKHO  group by duoc_id,nguonduoc_id,khoduoc_id,benhvien_id) dtk        inner join TM_DUOC_PHAMVISD_MAPPING pvsd on dtk.KHODUOC_ID = pvsd.KHODUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NOITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) B on B.DUOC_ID = dtk.DUOC_ID and B.SOLUONG > 0 and B.PHAMVI_ID = pvsd.PHAMVI_ID and B.NGUONHANG_ID = dtk.NGUONDUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NGOAITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) A on A.DUOC_ID = dtk.DUOC_ID and A.SOLUONG > 0 and A.PHAMVI_ID = pvsd.PHAMVI_ID and A.NGUONHANG_ID = dtk.NGUONDUOC_ID        where dtk.SOLUONG > 0 and dtk.BENHVIEN_ID = 'HLU01'        group by LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')), pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        ) tk on tk.DUOC_ID = d.DUOC_ID        left join TM_DUOC_PHAMVISUDUNG kd on kd.PHAMVI_ID = tk.PHAMVI_ID and kd.BENHVIEN_ID = 'HLU01'        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = tk.NGUONDUOC_ID and nh.BENHVIEN_ID = 'HLU01'        where  d.BENHVIEN_ID = 'HLU01' and d.DUOC_ID in (1) and TK.PHAMVI_ID in (1055)        and tk.NGUONDUOC_ID in (1)         end]
2019-09-20 17:44:34,144 [1] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoCOM18UpdateRedis] PreparedStatement : [select distinct TT_TONKHO.DUOC_KEY, LTRIM(TT_TONKHO.KHODUOC_ID) as KHODUOC_ID, TM_DUOC.DUOC_ID, TM_LOAIDUOC.MALOAIDUOC,TM_DUOC.SOVISA,TM_DUOC.TYLE_VAT,TM_DUOC.COTOA,        TM_DUOC.MADUOC, TM_DUOC.TENHANG, TM_DUOC.TENDUOCDAYDU, dvt.TENDONVITINH as DONVITINH,  TM_DUOC.DONVITINH_ID,TM_DUOC.BHYT,        TM_DUOC.TENHOATCHAT,        TM_DUOC.HAMLUONG, TM_DUOC.HANGSANXUAT, TM_DUOC.QUOCGIA, TM_DUOC.LOAIDUOC_ID, TM_DUOC.DUONGDUNG_ID,        TM_TENDUOC.TENDUOC, TM_TENDUOC.TENDUOC_EN, TM_TENDUOC.MAQUOCTE, TM_TENDUOC.MAQUOCTEBT,        TM_LOAIDUOC.LOAIVATTU_ID, TM_DUOC.BENHVIEN_ID,        TT_TONKHO.SOLUONG, TM_DUOC.VTYT_PHANLOAI, TM_DUOC.PHAMVI, TT_TONKHO.NGUONDUOC_ID, NG.TENNGUONDUOC AS TENNGUONDUOC        , TAMNGUNG = CASE WHEN TM_DUOC.TAMNGUNG = '1' OR NG.TAMNGUNG = '1' OR KD.TAMNGUNG = '1' THEN '1' ELSE '0' END        , TM_DUOC.DANGTRINHBAY        from TM_DUOC        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = TM_DUOC.DONVITINH_ID        left join TM_TENDUOC on TM_DUOC.TENDUOC_ID = TM_TENDUOC.TENDUOC_ID and TM_DUOC.BENHVIEN_ID = 'HLU01' and TM_DUOC.TAMNGUNG = '0'        left join TM_LOAIDUOC on TM_LOAIDUOC.LOAIDUOC_ID = TM_DUOC.LOAIDUOC_ID and TM_LOAIDUOC.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG on (TM_LOAIDUOC.LOAIVATTU_ID = TM_DUOC_HANDUNG.LOAIDUOC and TM_DUOC_HANDUNG.BENHVIEN_ID = 'HLU01')        inner join        (select LTRIM(A.KHODUOC_ID) + '_' + LTRIM(A.DUOC_ID) + '_' + LTRIM(ISNULL(A.NGUONDUOC_ID,'')) as DUOC_KEY, A.KHODUOC_ID, A.DUOC_ID, A.NGUONDUOC_ID,        SUM(isnull(A.SOLUONG,0)) as SOLUONG        from        (select SUM(SOLUONG) as SOLUONG, KHODUOC_ID, DUOC_ID, NGUONDUOC_ID from TT_DUOC_TONKHO        where BENHVIEN_ID = 'HLU01' group by KHODUOC_ID, DUOC_ID, NGUONDUOC_ID) A        group by LTRIM(A.KHODUOC_ID) + '_' + LTRIM(A.DUOC_ID) + '_' + LTRIM(ISNULL(A.NGUONDUOC_ID,'')), A.KHODUOC_ID, A.DUOC_ID, NGUONDUOC_ID        ) TT_TONKHO on TT_TONKHO.DUOC_ID = TM_DUOC.DUOC_ID        LEFT JOIN TM_NGUONHANG NG ON NG.NGUONDUOC_ID = TT_TONKHO.NGUONDUOC_ID        LEFT JOIN TM_KHODUOC KD ON KD.KHODUOC_ID = TT_TONKHO.KHODUOC_ID        where TM_DUOC.BENHVIEN_ID = 'HLU01' and TT_TONKHO.SOLUONG >= 0        and TM_DUOC.DUOC_ID in (1)]
2019-09-20 17:44:34,192 [1] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoVaBookingCOM23UpdateRedis] PreparedStatement : [declare @NGUONDUOC_MACDINH varchar(5) = '0';        declare @TOAMUANGOAI int = 0;        select @NGUONDUOC_MACDINH = isnull(VALUE,0) from TM_SYS_APPSETTINGS where CODE = 'PHA_NGUONDUOC'        select @TOAMUANGOAI = isnull(VALUE,0) from TM_SYS_APPSETTINGS where CODE = 'OPD_TOAMUANGOAI_DUNGDANHMUC_DUOC'                if @TOAMUANGOAI = 1        begin        select  distinct '0' + '_' + LTRIM(d.DUOC_ID) + '_' + @NGUONDUOC_MACDINH as DUOC_KEY, 0 as PHAMVI_ID, @NGUONDUOC_MACDINH as NGUONDUOC_ID, null as TENNGUONDUOC, null as TINHTIEN, d.DUOC_ID, ld.MALOAIDUOC,        d.SOVISA,d.TYLE_VAT,d.COTOA, d.MADUOC, d.TENHANG, d.TENDUOCDAYDU, dvt.TENDONVITINH as DONVITINH, d.BHYT,        d.TENHOATCHAT, d.HAMLUONG, d.HANGSANXUAT, d.QUOCGIA, d.LOAIDUOC_ID, d.DUONGDUNG_ID, d.TINHTIEN_PTTT,        ten.TENDUOC, ten.TENDUOC_EN, ten.MAQUOCTE, ten.MAQUOCTEBT,        '' as BHYT_TEXT        , ld.LOAIVATTU_ID        , d.BENHVIEN_ID,        999999999 as SOLUONG, d.VTYT_PHANLOAI, d.PHAMVI, d.SUASOLUONGTONGHOP, d.MADUOCBV, d.DANGTRINHBAY        , TAMNGUNG = CASE WHEN d.TAMNGUNG = '1' THEN '1' ELSE '0' END        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        where d.DUOC_ID in (1)        union all        select  distinct tk.DUOC_KEY, LTRIM(tk.PHAMVI_ID) as PHAMVI_ID, tk.NGUONDUOC_ID, nh.TENNGUONDUOC, nh.TINHTIEN, d.DUOC_ID, ld.MALOAIDUOC,        d.SOVISA,d.TYLE_VAT,d.COTOA, d.MADUOC, d.TENHANG, d.TENDUOCDAYDU, dvt.TENDONVITINH as DONVITINH, d.BHYT,        d.TENHOATCHAT, d.HAMLUONG, d.HANGSANXUAT, d.QUOCGIA, d.LOAIDUOC_ID, d.DUONGDUNG_ID, d.TINHTIEN_PTTT,        ten.TENDUOC, ten.TENDUOC_EN, ten.MAQUOCTE, ten.MAQUOCTEBT,        CASE WHEN d.BHYT = '1' THEN 'BHYT' ELSE '' END as BHYT_TEXT        , ld.LOAIVATTU_ID        , d.BENHVIEN_ID,        tk.SOLUONG, d.VTYT_PHANLOAI, d.PHAMVI, d.SUASOLUONGTONGHOP, d.MADUOCBV, d.DANGTRINHBAY        , TAMNGUNG = CASE WHEN d.TAMNGUNG = '1' OR nh.TAMNGUNG = '1' OR kd.TAMNGUNG = '1' THEN '1' ELSE '0' END        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        inner join        (        select  LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')) DUOC_KEY, (SUM(dtk.SOLUONG) - isnull(sum(A.SOLUONG),0) - isnull(sum(B.SOLUONG),0)) SOLUONG, pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        from (select sum(soluong) soluong,duoc_id,nguonduoc_id,khoduoc_id,benhvien_id from TT_DUOC_TONKHO  group by duoc_id,nguonduoc_id,khoduoc_id,benhvien_id) dtk        inner join TM_DUOC_PHAMVISD_MAPPING pvsd on dtk.KHODUOC_ID = pvsd.KHODUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NOITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) B on B.DUOC_ID = dtk.DUOC_ID and B.SOLUONG > 0 and B.PHAMVI_ID = pvsd.PHAMVI_ID and B.NGUONHANG_ID = dtk.NGUONDUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NGOAITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) A on A.DUOC_ID = dtk.DUOC_ID and A.SOLUONG > 0 and A.PHAMVI_ID = pvsd.PHAMVI_ID and A.NGUONHANG_ID = dtk.NGUONDUOC_ID        where dtk.SOLUONG > 0 and dtk.BENHVIEN_ID = 'HLU01'        group by LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')), pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        ) tk on tk.DUOC_ID = d.DUOC_ID        left join TM_DUOC_PHAMVISUDUNG kd on kd.PHAMVI_ID = tk.PHAMVI_ID and kd.BENHVIEN_ID = 'HLU01'        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = tk.NGUONDUOC_ID and nh.BENHVIEN_ID = 'HLU01'        where  d.BENHVIEN_ID = 'HLU01' and d.DUOC_ID in (1)        end        else        begin        select  distinct tk.DUOC_KEY, LTRIM(tk.PHAMVI_ID) as PHAMVI_ID, tk.NGUONDUOC_ID, nh.TENNGUONDUOC, nh.TINHTIEN, d.DUOC_ID, ld.MALOAIDUOC,        d.SOVISA,d.TYLE_VAT,d.COTOA, d.MADUOC, d.TENHANG, d.TENDUOCDAYDU, dvt.TENDONVITINH as DONVITINH, d.BHYT,        d.TENHOATCHAT, d.HAMLUONG, d.HANGSANXUAT, d.QUOCGIA, d.LOAIDUOC_ID, d.DUONGDUNG_ID, d.TINHTIEN_PTTT,        ten.TENDUOC, ten.TENDUOC_EN, ten.MAQUOCTE, ten.MAQUOCTEBT,        CASE WHEN d.BHYT = '1' THEN 'BHYT' ELSE '' END as BHYT_TEXT        , ld.LOAIVATTU_ID        , d.BENHVIEN_ID,        tk.SOLUONG, d.VTYT_PHANLOAI, d.PHAMVI, d.SUASOLUONGTONGHOP, d.MADUOCBV, d.DANGTRINHBAY        , TAMNGUNG = CASE WHEN d.TAMNGUNG = '1' OR nh.TAMNGUNG = '1' OR kd.TAMNGUNG = '1' THEN '1' ELSE '0' END        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        inner join        (        select  LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')) DUOC_KEY, (SUM(dtk.SOLUONG) - isnull(sum(A.SOLUONG),0) - isnull(sum(B.SOLUONG),0)) SOLUONG, pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        from (select sum(soluong) soluong,duoc_id,nguonduoc_id,khoduoc_id,benhvien_id from TT_DUOC_TONKHO  group by duoc_id,nguonduoc_id,khoduoc_id,benhvien_id) dtk        inner join TM_DUOC_PHAMVISD_MAPPING pvsd on dtk.KHODUOC_ID = pvsd.KHODUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NOITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) B on B.DUOC_ID = dtk.DUOC_ID and B.SOLUONG > 0 and B.PHAMVI_ID = pvsd.PHAMVI_ID and B.NGUONHANG_ID = dtk.NGUONDUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NGOAITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) A on A.DUOC_ID = dtk.DUOC_ID and A.SOLUONG > 0 and A.PHAMVI_ID = pvsd.PHAMVI_ID and A.NGUONHANG_ID = dtk.NGUONDUOC_ID        where dtk.SOLUONG > 0 and dtk.BENHVIEN_ID = 'HLU01'        group by LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')), pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        ) tk on tk.DUOC_ID = d.DUOC_ID        left join TM_DUOC_PHAMVISUDUNG kd on kd.PHAMVI_ID = tk.PHAMVI_ID and kd.BENHVIEN_ID = 'HLU01'        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = tk.NGUONDUOC_ID and nh.BENHVIEN_ID = 'HLU01'        where  d.BENHVIEN_ID = 'HLU01' and d.DUOC_ID in (1)        end]
2019-09-20 17:44:34,476 [1] DEBUG - Statement Id: [DAO00030_GetList] PreparedStatement : [select *              from TT_DUOC_CHUNGTU              where BENHVIEN_ID = 'HLU01'                and                   TT_DUOC_CHUNGTU.CHUNGTU_ID = '137704'                               order by CHUNGTU_ID]
2019-09-20 17:44:34,706 [1] DEBUG - Statement Id: [DAO00030_CHUNGTUXUAT_CHITIET_GetList] PreparedStatement : [SELECT            ctct.*,            d.MADUOC, d.TENHANG, d.TENDUOCDAYDU, dvt.TENDONVITINH as DONVITINH,n.TENNGUONDUOC as NGUONHANG,            sln.SOLONHAP, sln.SOLOSANPHAM, sln.NGAYNHAP as NGAYNHAPLO, sln.HANDUNG as HANSUDUNG,            isnull(tk.SOLUONG,0) as SOLUONGTON,            LTRIM(ct.KHOXUAT_ID) + '_' + LTRIM(sln.DUOC_ID) + '_' + LTRIM(sln.NGUONDUOC_ID) as DUOC_KEY            , NLD.MANHOMLOAIDUOC, ld.MALOAIDUOC, D.SO_QDTT            FROM            TT_DUOC_CHUNGTU_CHITIET ctct            INNER JOIN TT_DUOC_CHUNGTU ct ON (ct.CHUNGTU_ID = ctct.CHUNGTU_ID)            INNER JOIN TT_DUOC_CHUNGTU_SOLONHAP sln ON (sln.SOLONHAP_ID = ctct.SOLONHAP_ID)            LEFT JOIN (            select xx.DUOCTONKHO_ID, xx.KHODUOC_ID, xx.DUOC_ID, xx.SOLONHAP_ID, xx.SOLUONG, xx.NGUONDUOC_ID, xx.BENHVIEN_ID from TT_DUOC_TONKHO xx            join ( select max(DUOCTONKHO_ID) as DUOCTONKHO_ID, KHODUOC_ID, DUOC_ID, SOLONHAP_ID, NGUONDUOC_ID            from TT_DUOC_TONKHO group by KHODUOC_ID, DUOC_ID, SOLONHAP_ID, NGUONDUOC_ID) yy on xx.DUOCTONKHO_ID=yy.DUOCTONKHO_ID            ) tk ON (tk.SOLONHAP_ID = sln.SOLONHAP_ID AND tk.DUOC_ID = sln.DUOC_ID and tk.KHODUOC_ID = ct.KHOXUAT_ID)            INNER JOIN TM_DUOC d ON (d.DUOC_ID = ctct.DUOC_ID)            INNER JOIN TM_NGUONHANG n ON (n.NGUONDUOC_ID = ctct.NGUONHANG_ID)            LEFT JOIN TM_DONVITINH dvt ON (dvt.DONVITINH_ID = ctct.DONVITINH_ID)            left join TM_LOAIDUOC LD on LD.LOAIDUOC_ID = D.LOAIDUOC_ID            LEFT JOIN TM_NHOMLOAIDUOC NLD on NLD.NHOMLOAIDUOC_ID = LD.NHOMLOAIDUOC_ID             where                             ct.CHUNGTU_ID = '137704'                       and                           ct.BENHVIEN_ID = 'HLU01'                                     order by CHUNGTUCHITIET_ID]
2019-09-20 17:44:34,836 [1] DEBUG - Statement Id: [DAO00030_KiemTraChungTuKhoaSo] PreparedStatement : [SELECT CHUNGTU_ID              FROM TT_DUOC_CHUNGTU              WHERE              MACHUNGTU = 'CS_KBX1319003092'              and BENHVIEN_ID = 'HLU01'              and              convert(date, NGAYCHUNGTU) <=              (              SELECT TOP 1 convert(date, KHOADENNGAY)              FROM TT_DUOC_KHOASOCHUNGTU              WHERE              KHODUOC_ID = '32'              and BENHVIEN_ID = 'HLU01'              AND KHOASO = '1'              ORDER BY KHOADENNGAY DESC              )]
2019-09-20 17:44:34,866 [1] DEBUG - Statement Id: [DAO00030_KiemTraChungTuDaChuyenKeToan] PreparedStatement : [SELECT CHUNGTU_ID            FROM TT_DUOC_CHUNGTU            WHERE            CHUNGTU_ID = '137704'            and IDCHUYEN IS NOT NULL            and BENHVIEN_ID = 'HLU01']
2019-09-20 17:44:34,895 [1] DEBUG - Statement Id: [DAO00030_KiemTraBenhNhanXuatVien] PreparedStatement : [select              TT.TOATHUOC_ID              from              TT_NOITRU_TOATHUOC TT              inner join TT_NOITRU_KHAMBENH KB on TT.KHAMBENH_ID = KB.KHAMBENH_ID              inner join TT_NOITRU_BENHAN BA on BA.BENHAN_ID = KB.BENHAN_ID              WHERE              BA.TRANGTHAI = 'DAXUATVIEN'              AND TT.CHUNGTU_ID =  137704              and TT.BENHVIEN_ID = 'HLU01']
2019-09-20 17:44:35,076 [1] DEBUG - Statement Id: [DAO00030_DUOCTONKHO_GetSoTonTheoDuoc] PreparedStatement : [SELECT              DUOC_ID,              SUM(SOLUONG) AS TONGTON              FROM              TT_DUOC_TONKHO              WHERE              KHODUOC_ID = '32'              and BENHVIEN_ID = 'HLU01'              and DUOC_ID IN (1)              GROUP BY DUOC_ID]
2019-09-20 17:44:35,109 [1] DEBUG - Statement Id: [DAO00030_DUOCTONKHO_GetSoTonTheoDuocTheoLo] PreparedStatement : [SELECT              DUOC_ID,SOLONHAP_ID,              SUM(SOLUONG) AS SOLUONGTONLO              FROM              TT_DUOC_TONKHO              WHERE              KHODUOC_ID = '32'              and BENHVIEN_ID = 'HLU01'              and DUOC_ID IN (1)              and SOLONHAP_ID IN (7541)              GROUP BY DUOC_ID, SOLONHAP_ID]
2019-09-20 17:44:35,138 [1] DEBUG - Statement Id: [DAO00030_DUOCTONKHO_GetSoTonTheoDuoc] PreparedStatement : [SELECT              DUOC_ID,              SUM(SOLUONG) AS TONGTON              FROM              TT_DUOC_TONKHO              WHERE              KHODUOC_ID = '32'              and BENHVIEN_ID = 'HLU01'              and DUOC_ID IN (1)              GROUP BY DUOC_ID]
2019-09-20 17:45:34,156 [1] DEBUG - Statement Id: [DAO00030_Search_PhieuXuatSD] PreparedStatement : [SELECT DISTINCT phieuxuat.* FROM          (          select DISTINCT          CT.CHUNGTU_ID,          CT.SOCHUNGTU,          CT.MACHUNGTU,          CT.NGAYCHUNGTU,          CT.NGAYTAO,          CT.KHOXUAT_ID,          CT.NGUOIGIAO_ID,          CT.KHONHAP_ID,          CT.NGUOINHAN_ID,          PL.MACHUNGTU as MAPHIEULINH,          PL.NGAYCHUNGTU as NGAYPHIEULINH,          bn.MAYTE,          bn.TENBENHNHAN,          CONVERT(VARCHAR(10), KB.THOIGIANKHAM, 103) + ' - ' + CONVERT(VARCHAR(5), KB.THOIGIANKHAM, 108) as THOIGIANKHAM,          nl.TENNHANVIEN as NGUOILAP,          CT.DIENGIAI          from TT_DUOC_CHUNGTU CT          inner join TT_DUOC_CHUNGTU_CHITIET ctct on ct.CHUNGTU_ID = ctct.CHUNGTU_ID          inner join TT_NOITRU_TOATHUOC TT on ctct.TOATHUOCNOITRU_ID = TT.TOATHUOC_ID          inner join TT_NOITRU_KHAMBENH KB on kb.KHAMBENH_ID = TT.KHAMBENH_ID          inner join TT_BENHNHAN BN on TT.BENHNHAN_ID = BN.BENHNHAN_ID          left join TT_DUOC_PHIEULINH PL on PL.CHUNGTU_ID = CT.PHIEULINH_ID          left join TM_NHANVIEN nl on nl.NHANVIEN_ID = TT.NGUOITAO_ID           where                   CT.MUCDICHCHUNGTU_ID = '1060'               and                 CT.KHOXUAT_ID = '32'               and                 CONVERT(date, CT.NGAYCHUNGTU) BETWEEN CONVERT(date, '9/20/2019 12:00:00 AM')  and  CONVERT(date, '9/20/2019 12:00:00 AM')               and                 CT.BENHVIEN_ID = 'HLU01'                           UNION            select DISTINCT          CT.CHUNGTU_ID,          CT.SOCHUNGTU,          CT.MACHUNGTU,          CT.NGAYCHUNGTU,          CT.NGAYTAO,          CT.KHOXUAT_ID,          CT.NGUOIGIAO_ID,          CT.KHONHAP_ID,          CT.NGUOINHAN_ID,          PL.MACHUNGTU as MAPHIEULINH,          PL.NGAYCHUNGTU as NGAYPHIEULINH,          bn.MAYTE,          bn.TENBENHNHAN,          CONVERT(VARCHAR(10), KB.THOIGIANKHAM, 103) + ' - ' + CONVERT(VARCHAR(5), KB.THOIGIANKHAM, 108) as THOIGIANKHAM,          nl.TENNHANVIEN as NGUOILAP,          CT.DIENGIAI          from TT_DUOC_CHUNGTU CT          inner join TT_DUOC_CHUNGTU_CHITIET ctct on ct.CHUNGTU_ID = ctct.CHUNGTU_ID          inner join TT_NGOAITRU_KHAMBENH_VTYT vt on ctct.KHAMBENH_VTYT_ID = vt.KHAMBENH_VTYT_ID          inner join TT_NGOAITRU_KHAMBENH kb on kb.KHAMBENH_ID = vt.KHAMBENH_ID          inner join TT_BENHNHAN BN on bn.BENHNHAN_ID = kb.BENHNHAN_ID          left join TT_DUOC_PHIEULINH PL on PL.CHUNGTU_ID = CT.PHIEULINH_ID          left join TM_NHANVIEN nl on nl.NHANVIEN_ID = vt.NGUOITAO_ID           where                   CT.MUCDICHCHUNGTU_ID = '1060'               and                 CT.KHOXUAT_ID = '32'               and                 CONVERT(date, CT.NGAYCHUNGTU) BETWEEN CONVERT(date, '9/20/2019 12:00:00 AM')  and  CONVERT(date, '9/20/2019 12:00:00 AM')               and                 CT.BENHVIEN_ID = 'HLU01'                           UNION            select DISTINCT          CT.CHUNGTU_ID,          CT.SOCHUNGTU,          CT.MACHUNGTU,          CT.NGAYCHUNGTU,          CT.NGAYTAO,          CT.KHOXUAT_ID,          CT.NGUOIGIAO_ID,          CT.KHONHAP_ID,          CT.NGUOINHAN_ID,          PL.MACHUNGTU as MAPHIEULINH,          PL.NGAYCHUNGTU as NGAYPHIEULINH,          bn.MAYTE,          bn.TENBENHNHAN,          CONVERT(VARCHAR(10), pt.NGAYTHUCHIEN, 103) + ' - ' + CONVERT(VARCHAR(5), pt.NGAYTHUCHIEN, 108) as THOIGIANKHAM,          nl.TENNHANVIEN as NGUOILAP,          CT.DIENGIAI          from TT_DUOC_CHUNGTU CT          inner join TT_DUOC_CHUNGTU_CHITIET ctct on ct.CHUNGTU_ID = ctct.CHUNGTU_ID          inner join TT_PHAUTHUAT_VTYT vt on ctct.PHAUTHUAT_VTYT_ID = vt.PHAUTHUAT_VTYT_ID          inner join TT_PHAUTHUAT pt on pt.PHAUTHUAT_ID = vt.PHAUTHUAT_ID          inner join TT_TIEPNHAN tn on tn.TIEPNHAN_ID = pt.TIEPNHAN_ID          inner join TT_BENHNHAN bn on bn.BENHNHAN_ID = tn.BENHNHAN_ID          left join TT_DUOC_PHIEULINH PL on PL.CHUNGTU_ID = CT.PHIEULINH_ID          left join TM_NHANVIEN nl on nl.NHANVIEN_ID = pt.NGUOITAO_ID           where                   CT.MUCDICHCHUNGTU_ID = '1060'               and                 CT.KHOXUAT_ID = '32'               and                 CONVERT(date, CT.NGAYCHUNGTU) BETWEEN CONVERT(date, '9/20/2019 12:00:00 AM')  and  CONVERT(date, '9/20/2019 12:00:00 AM')               and                 CT.BENHVIEN_ID = 'HLU01'                           UNION            select DISTINCT          CT.CHUNGTU_ID,          CT.SOCHUNGTU,          CT.MACHUNGTU,          CT.NGAYCHUNGTU,          CT.NGAYTAO,          CT.KHOXUAT_ID,          CT.NGUOIGIAO_ID,          CT.KHONHAP_ID,          CT.NGUOINHAN_ID,          PL.MACHUNGTU as MAPHIEULINH,          PL.NGAYCHUNGTU as NGAYPHIEULINH,          bn.MAYTE,          bn.TENBENHNHAN,          CONVERT(VARCHAR(10), cls.NGAYTAO, 103) + ' - ' + CONVERT(VARCHAR(5), cls.NGAYTAO, 108) as THOIGIANKHAM,          nl.TENNHANVIEN as NGUOILAP,          CT.DIENGIAI          from TT_DUOC_CHUNGTU CT          inner join TT_DUOC_CHUNGTU_CHITIET ctct on ct.CHUNGTU_ID = ctct.CHUNGTU_ID          inner join TT_CLSKETQUA_VTYT cls on ctct.CLSKETQUA_VTYT_ID = cls.CLSKETQUA_VTYT_ID          inner join TT_DVYEUCAU DV on DV.DVYEUCAU_ID = CLS.DVYEUCAU_ID          inner join TT_BENHNHAN bn on bn.BENHNHAN_ID = DV.BENHNHAN_ID          left join TT_DUOC_PHIEULINH PL on PL.CHUNGTU_ID = CT.PHIEULINH_ID          left join TM_NHANVIEN nl on nl.NHANVIEN_ID = cls.NGUOITAO_ID           where                   CT.MUCDICHCHUNGTU_ID = '1060'               and                 CT.KHOXUAT_ID = '32'               and                 CONVERT(date, CT.NGAYCHUNGTU) BETWEEN CONVERT(date, '9/20/2019 12:00:00 AM')  and  CONVERT(date, '9/20/2019 12:00:00 AM')               and                 CT.BENHVIEN_ID = 'HLU01'                           UNION            select DISTINCT          CT.CHUNGTU_ID,          CT.SOCHUNGTU,          CT.MACHUNGTU,          CT.NGAYCHUNGTU,          CT.NGAYTAO,          CT.KHOXUAT_ID,          CT.NGUOIGIAO_ID,          CT.KHONHAP_ID,          CT.NGUOINHAN_ID,          PL.MACHUNGTU as MAPHIEULINH,          PL.NGAYCHUNGTU as NGAYPHIEULINH,          null as MAYTE,          null as TENBENHNHAN,          null as THOIGIANKHAM,          nl.TENNHANVIEN as NGUOILAP,          CT.DIENGIAI          from TT_DUOC_CHUNGTU CT          inner join TT_DUOC_CHUNGTU_CHITIET ctct on ct.CHUNGTU_ID = ctct.CHUNGTU_ID          left join TT_DUOC_PHIEULINH PL on PL.CHUNGTU_ID = CT.PHIEULINH_ID          left join TM_NHANVIEN nl on nl.NHANVIEN_ID = ct.NGUOITAO_ID          WHERE (ctct.TOATHUOCNOITRU_ID IS NULL AND ctct.KHAMBENH_VTYT_ID IS NULL AND ctct.PHAUTHUAT_VTYT_ID IS NULL AND ctct.CLSKETQUA_VTYT_ID IS NULL)             and                 CT.MUCDICHCHUNGTU_ID = '1060'               and                 CT.KHOXUAT_ID = '32'               and                 CONVERT(date, CT.NGAYCHUNGTU) BETWEEN CONVERT(date, '9/20/2019 12:00:00 AM')  and  CONVERT(date, '9/20/2019 12:00:00 AM')               and                 CT.BENHVIEN_ID = 'HLU01'                         )PhieuXuat          ORDER BY PhieuXuat.CHUNGTU_ID desc]
2019-09-20 17:45:36,579 [1] DEBUG - Statement Id: [DAO00030_GetList] PreparedStatement : [select *              from TT_DUOC_CHUNGTU              where BENHVIEN_ID = 'HLU01'                and                   TT_DUOC_CHUNGTU.CHUNGTU_ID = '137704'                               order by CHUNGTU_ID]
--------------------------------------------------------------------------------
2019-09-20 17:46:05,140 [1] DEBUG - Statement Id: [DAO00001_DBList] PreparedStatement : [select *              from TM_SYS_SERVER              where HOSPITAL_ID = '_SYSTEM_' and TYPE = 'D']
2019-09-20 17:46:08,411 [1] DEBUG - Statement Id: [DAO00001_DaoList] PreparedStatement : [select              TM_SYS_SERVICEMAP.ID,              TM_SYS_SERVICEMAP.HOSPITAL_ID,              TM_SYS_SERVICEMAP.DB_NAME,              TM_SYS_SERVICEMAP.TYPE,              TM_SYS_SERVICEMAP.NAME,              TM_SYS_SERVICEMAP.CLASS,              (TM_SYS_DIC.VALUE + '.' + TM_SYS_SERVICEMAP.CLASS) as CLASSFULL,              TM_SYS_SERVICEMAP.ASSEMBLY              from TM_SYS_SERVICEMAP              inner join TM_SYS_DIC              on TM_SYS_SERVICEMAP.NAMESPACE = TM_SYS_DIC.ID              where HOSPITAL_ID = '_SYSTEM_' AND TYPE = 'D' AND ACTIVE = '1'              order by DB_NAME]
2019-09-20 17:46:08,455 [1] DEBUG - Statement Id: [DAO00001_ServiceList] PreparedStatement : [select              TM_SYS_SERVICEMAP.ID,              TM_SYS_SERVICEMAP.HOSPITAL_ID,              TM_SYS_SERVICEMAP.DB_NAME,              TM_SYS_SERVICEMAP.TYPE,              TM_SYS_SERVICEMAP.NAME,              TM_SYS_SERVICEMAP.CLASS,              (TM_SYS_DIC.VALUE + '.' + TM_SYS_SERVICEMAP.CLASS) as CLASSFULL,              TM_SYS_SERVICEMAP.ASSEMBLY,              TM_SYS_SERVER.URL              from TM_SYS_SERVICEMAP              inner join TM_SYS_DIC on TM_SYS_SERVICEMAP.NAMESPACE = TM_SYS_DIC.ID              inner join TM_SYS_SERVER on (TM_SYS_SERVICEMAP.DB_NAME = TM_SYS_SERVER.NAME) and (TM_SYS_SERVER.HOSPITAL_ID = '_SYSTEM_')              where TM_SYS_SERVICEMAP.HOSPITAL_ID = '_SYSTEM_' AND TM_SYS_SERVICEMAP.TYPE = 'S'  AND ACTIVE = '1'              order by URL]
2019-09-20 17:46:08,824 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = '_SYSTEM_'               AND                   TM_SYS_SCREEN.PAGE = 'LOGIN'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2019-09-20 17:46:09,025 [1] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = '_SYSTEM_'               AND                   TM_SYS_CACHE.ACTIVE = '1']
2019-09-20 17:46:15,510 [1] DEBUG - Statement Id: [DAO00001_DBList] PreparedStatement : [select *              from TM_SYS_SERVER              where HOSPITAL_ID = 'HLU01' and TYPE = 'D']
2019-09-20 17:46:15,540 [1] DEBUG - Statement Id: [DAO00001_DaoList] PreparedStatement : [select              TM_SYS_SERVICEMAP.ID,              TM_SYS_SERVICEMAP.HOSPITAL_ID,              TM_SYS_SERVICEMAP.DB_NAME,              TM_SYS_SERVICEMAP.TYPE,              TM_SYS_SERVICEMAP.NAME,              TM_SYS_SERVICEMAP.CLASS,              (TM_SYS_DIC.VALUE + '.' + TM_SYS_SERVICEMAP.CLASS) as CLASSFULL,              TM_SYS_SERVICEMAP.ASSEMBLY              from TM_SYS_SERVICEMAP              inner join TM_SYS_DIC              on TM_SYS_SERVICEMAP.NAMESPACE = TM_SYS_DIC.ID              where HOSPITAL_ID = 'HLU01' AND TYPE = 'D' AND ACTIVE = '1'              order by DB_NAME]
2019-09-20 17:46:16,952 [1] DEBUG - Statement Id: [DAO00001_ServiceList] PreparedStatement : [select              TM_SYS_SERVICEMAP.ID,              TM_SYS_SERVICEMAP.HOSPITAL_ID,              TM_SYS_SERVICEMAP.DB_NAME,              TM_SYS_SERVICEMAP.TYPE,              TM_SYS_SERVICEMAP.NAME,              TM_SYS_SERVICEMAP.CLASS,              (TM_SYS_DIC.VALUE + '.' + TM_SYS_SERVICEMAP.CLASS) as CLASSFULL,              TM_SYS_SERVICEMAP.ASSEMBLY,              TM_SYS_SERVER.URL              from TM_SYS_SERVICEMAP              inner join TM_SYS_DIC on TM_SYS_SERVICEMAP.NAMESPACE = TM_SYS_DIC.ID              inner join TM_SYS_SERVER on (TM_SYS_SERVICEMAP.DB_NAME = TM_SYS_SERVER.NAME) and (TM_SYS_SERVER.HOSPITAL_ID = 'HLU01')              where TM_SYS_SERVICEMAP.HOSPITAL_ID = 'HLU01' AND TM_SYS_SERVICEMAP.TYPE = 'S'  AND ACTIVE = '1'              order by URL]
2019-09-20 17:46:17,039 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1']
2019-09-20 17:46:18,175 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM005']
2019-09-20 17:46:18,339 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM015']
2019-09-20 17:46:18,446 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM067']
2019-09-20 17:46:18,548 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM008']
2019-09-20 17:46:18,659 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM068']
2019-09-20 17:46:18,742 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM006']
2019-09-20 17:46:18,818 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM030']
2019-09-20 17:46:18,892 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM025']
2019-09-20 17:46:18,969 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM024']
2019-09-20 17:46:19,476 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM033']
2019-09-20 17:46:19,516 [5] DEBUG - Statement Id: [DAO00027_GetListDuocKyGuiTonKho] PreparedStatement : [select  distinct TT_TONKHO.DUOC_KEY, LTRIM(TT_TONKHO.KHODUOC_ID) as KHODUOC_ID, TM_DUOC.DUOC_ID, TM_LOAIDUOC.MALOAIDUOC,TM_DUOC.SOVISA,TM_DUOC.TYLE_VAT,TM_DUOC.COTOA,        TM_DUOC.MADUOC, TM_DUOC.TENHANG, TM_DUOC.TENDUOCDAYDU, dvt.TENDONVITINH as DONVITINH,  TM_DUOC.DONVITINH_ID,TM_DUOC.BHYT,TM_DUOC.PHAMVI,        TM_DUOC.TENHOATCHAT, TM_DUOC.HAMLUONG, TM_DUOC.HANGSANXUAT, TM_DUOC.QUOCGIA, TM_DUOC.LOAIDUOC_ID, TM_DUOC.DUONGDUNG_ID,        TM_TENDUOC.TENDUOC, TM_TENDUOC.TENDUOC_EN, TM_TENDUOC.MAQUOCTE, TM_TENDUOC.MAQUOCTEBT,        TM_LOAIDUOC.LOAIVATTU_ID, TM_DUOC.BENHVIEN_ID,TT_TONKHO.SOLUONG, TT_TONKHO.NGUONDUOC_ID, NH.TENNGUONDUOC        , TAMNGUNG = CASE WHEN TM_DUOC.TAMNGUNG = '1' OR nh.TAMNGUNG = '1' OR KD.TAMNGUNG = '1' THEN '1' ELSE '0' END        , TM_DUOC.DANGTRINHBAY        from TM_DUOC        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = TM_DUOC.DONVITINH_ID        left join TM_TENDUOC on TM_DUOC.TENDUOC_ID = TM_TENDUOC.TENDUOC_ID and TM_DUOC.BENHVIEN_ID = 'HLU01' and TM_DUOC.TAMNGUNG = '0'        left join TM_LOAIDUOC on TM_LOAIDUOC.LOAIDUOC_ID = TM_DUOC.LOAIDUOC_ID and TM_LOAIDUOC.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG on (TM_LOAIDUOC.LOAIVATTU_ID = TM_DUOC_HANDUNG.LOAIDUOC and TM_DUOC_HANDUNG.BENHVIEN_ID = 'HLU01')        inner join        (select LTRIM(A.KHODUOC_ID) + '_' + LTRIM(A.DUOC_ID) + '_' + LTRIM(ISNULL(A.NGUONDUOC_ID,'')) as DUOC_KEY, A.KHODUOC_ID, A.DUOC_ID,A.NGUONDUOC_ID,        SUM(isnull(A.SOLUONG,0)) as SOLUONG        from        (select SUM(SOLUONG) as SOLUONG, KHODUOC_ID, DUOC_ID, NGUONDUOC_ID from TT_DUOC_KYGUI_TONKHO        where BENHVIEN_ID = 'HLU01' group by KHODUOC_ID, DUOC_ID, NGUONDUOC_ID) A        group by LTRIM(A.KHODUOC_ID) + '_' + LTRIM(A.DUOC_ID) + '_' + LTRIM(A.NGUONDUOC_ID), A.KHODUOC_ID, A.DUOC_ID, A.NGUONDUOC_ID)        TT_TONKHO on TT_TONKHO.DUOC_ID = TM_DUOC.DUOC_ID        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = TT_TONKHO.NGUONDUOC_ID and nh.BENHVIEN_ID = 'HLU01'        LEFT JOIN TM_KHODUOC KD ON KD.KHODUOC_ID = TT_TONKHO.KHODUOC_ID        where TM_DUOC.BENHVIEN_ID = 'HLU01' AND TT_TONKHO.SOLUONG >= 0]
2019-09-20 17:46:19,590 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM018']
2019-09-20 17:46:19,626 [5] DEBUG - Statement Id: [DAO00027_GetListDuocTonKho] PreparedStatement : [select distinct TT_TONKHO.DUOC_KEY, LTRIM(TT_TONKHO.KHODUOC_ID) as KHODUOC_ID, TM_DUOC.DUOC_ID, TM_LOAIDUOC.MALOAIDUOC,TM_DUOC.SOVISA,TM_DUOC.TYLE_VAT,TM_DUOC.COTOA,        TM_DUOC.MADUOC, TM_DUOC.TENHANG, TM_DUOC.TENDUOCDAYDU, dvt.TENDONVITINH as DONVITINH,  TM_DUOC.DONVITINH_ID,TM_DUOC.BHYT,                TM_DUOC.TENHOATCHAT,          TM_DUOC.HAMLUONG, TM_DUOC.HANGSANXUAT, TM_DUOC.QUOCGIA, TM_DUOC.LOAIDUOC_ID, TM_DUOC.DUONGDUNG_ID,        TM_TENDUOC.TENDUOC, TM_TENDUOC.TENDUOC_EN, TM_TENDUOC.MAQUOCTE, TM_TENDUOC.MAQUOCTEBT,        TM_LOAIDUOC.LOAIVATTU_ID, TM_DUOC.BENHVIEN_ID,        TT_TONKHO.SOLUONG, TM_DUOC.VTYT_PHANLOAI, TM_DUOC.PHAMVI, TT_TONKHO.NGUONDUOC_ID, NG.TENNGUONDUOC AS TENNGUONDUOC        , TAMNGUNG = CASE WHEN TM_DUOC.TAMNGUNG = '1' OR NG.TAMNGUNG = '1' OR KD.TAMNGUNG = '1' THEN '1' ELSE '0' END        , TM_DUOC.DANGTRINHBAY        from TM_DUOC        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = TM_DUOC.DONVITINH_ID        left join TM_TENDUOC on TM_DUOC.TENDUOC_ID = TM_TENDUOC.TENDUOC_ID and TM_DUOC.BENHVIEN_ID = 'HLU01' and TM_DUOC.TAMNGUNG = '0'        left join TM_LOAIDUOC on TM_LOAIDUOC.LOAIDUOC_ID = TM_DUOC.LOAIDUOC_ID and TM_LOAIDUOC.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG on (TM_LOAIDUOC.LOAIVATTU_ID = TM_DUOC_HANDUNG.LOAIDUOC and TM_DUOC_HANDUNG.BENHVIEN_ID = 'HLU01')        inner join        (select LTRIM(A.KHODUOC_ID) + '_' + LTRIM(A.DUOC_ID) + '_' + LTRIM(ISNULL(A.NGUONDUOC_ID,'')) as DUOC_KEY, A.KHODUOC_ID, A.DUOC_ID, A.NGUONDUOC_ID,        SUM(isnull(A.SOLUONG,0)) as SOLUONG        from        (select SUM(SOLUONG) as SOLUONG, KHODUOC_ID, DUOC_ID, NGUONDUOC_ID from TT_DUOC_TONKHO        where BENHVIEN_ID = 'HLU01' group by KHODUOC_ID, DUOC_ID, NGUONDUOC_ID) A        group by LTRIM(A.KHODUOC_ID) + '_' + LTRIM(A.DUOC_ID) + '_' + LTRIM(ISNULL(A.NGUONDUOC_ID,'')), A.KHODUOC_ID, A.DUOC_ID, NGUONDUOC_ID        ) TT_TONKHO on TT_TONKHO.DUOC_ID = TM_DUOC.DUOC_ID        LEFT JOIN TM_NGUONHANG NG ON NG.NGUONDUOC_ID = TT_TONKHO.NGUONDUOC_ID        LEFT JOIN TM_KHODUOC KD ON KD.KHODUOC_ID = TT_TONKHO.KHODUOC_ID        where TM_DUOC.BENHVIEN_ID = 'HLU01' and TT_TONKHO.SOLUONG >= 0]
2019-09-20 17:46:20,383 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM023']
2019-09-20 17:46:20,419 [5] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoVaBooking] PreparedStatement : [declare @NGUONDUOC_MACDINH varchar(5) = '0';        declare @TOAMUANGOAI int = 0;        select @NGUONDUOC_MACDINH = isnull(VALUE,0) from TM_SYS_APPSETTINGS where CODE = 'PHA_NGUONDUOC'        select @TOAMUANGOAI = isnull(VALUE,0) from TM_SYS_APPSETTINGS where CODE = 'OPD_TOAMUANGOAI_DUNGDANHMUC_DUOC'                if @TOAMUANGOAI = 1        begin        select  distinct '0' + '_' + LTRIM(d.DUOC_ID) + '_' + @NGUONDUOC_MACDINH as DUOC_KEY, 0 as PHAMVI_ID, @NGUONDUOC_MACDINH as NGUONDUOC_ID, null as TENNGUONDUOC, null as TINHTIEN, d.DUOC_ID, ld.MALOAIDUOC,        d.SOVISA,d.TYLE_VAT,d.COTOA, d.MADUOC, d.TENHANG, d.TENDUOCDAYDU, d.DONVITINH as DONVITINH, d.BHYT,        d.TENHOATCHAT, d.HAMLUONG, d.HANGSANXUAT, d.QUOCGIA, d.LOAIDUOC_ID, d.DUONGDUNG_ID, d.TINHTIEN_PTTT,        ten.TENDUOC, ten.TENDUOC_EN, ten.MAQUOCTE, ten.MAQUOCTEBT,        '' as BHYT_TEXT        , ld.LOAIVATTU_ID        , d.BENHVIEN_ID,        999999999 as SOLUONG, d.VTYT_PHANLOAI, d.PHAMVI, d.SUASOLUONGTONGHOP, d.MADUOCBV, d.DANGTRINHBAY        , TAMNGUNG = CASE WHEN d.TAMNGUNG = '1' THEN '1' ELSE '0' END        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        union all        select  distinct tk.DUOC_KEY, LTRIM(tk.PHAMVI_ID) as PHAMVI_ID, tk.NGUONDUOC_ID, nh.TENNGUONDUOC, nh.TINHTIEN, d.DUOC_ID, ld.MALOAIDUOC,        d.SOVISA,d.TYLE_VAT,d.COTOA, d.MADUOC, d.TENHANG, d.TENDUOCDAYDU, d.DONVITINH as DONVITINH, d.BHYT,        d.TENHOATCHAT, d.HAMLUONG, d.HANGSANXUAT, d.QUOCGIA, d.LOAIDUOC_ID, d.DUONGDUNG_ID, d.TINHTIEN_PTTT,        ten.TENDUOC, ten.TENDUOC_EN, ten.MAQUOCTE, ten.MAQUOCTEBT,        CASE WHEN d.BHYT = '1' THEN 'BHYT' ELSE '' END as BHYT_TEXT        , ld.LOAIVATTU_ID        , d.BENHVIEN_ID,        tk.SOLUONG, d.VTYT_PHANLOAI, d.PHAMVI, d.SUASOLUONGTONGHOP, d.MADUOCBV, d.DANGTRINHBAY        , TAMNGUNG = CASE WHEN d.TAMNGUNG = '1' OR nh.TAMNGUNG = '1' OR kd.TAMNGUNG = '1' THEN '1' ELSE '0' END        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        inner join        (        select  LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')) DUOC_KEY, (SUM(dtk.SOLUONG) - isnull(sum(A.SOLUONG),0) - isnull(sum(B.SOLUONG),0)) SOLUONG, pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        from (select sum(soluong) soluong,duoc_id,nguonduoc_id,khoduoc_id,benhvien_id from TT_DUOC_TONKHO  group by duoc_id,nguonduoc_id,khoduoc_id,benhvien_id) dtk        inner join TM_DUOC_PHAMVISD_MAPPING pvsd on dtk.KHODUOC_ID = pvsd.KHODUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NOITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) B on B.DUOC_ID = dtk.DUOC_ID and B.SOLUONG > 0 and B.PHAMVI_ID = pvsd.PHAMVI_ID and B.NGUONHANG_ID = dtk.NGUONDUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NGOAITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) A on A.DUOC_ID = dtk.DUOC_ID and A.SOLUONG > 0 and A.PHAMVI_ID = pvsd.PHAMVI_ID and A.NGUONHANG_ID = dtk.NGUONDUOC_ID        where dtk.SOLUONG > 0 and dtk.BENHVIEN_ID = 'HLU01'        group by LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')), pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        ) tk on tk.DUOC_ID = d.DUOC_ID        left join TM_DUOC_PHAMVISUDUNG kd on kd.PHAMVI_ID = tk.PHAMVI_ID and kd.BENHVIEN_ID = 'HLU01'        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = tk.NGUONDUOC_ID and nh.BENHVIEN_ID = 'HLU01'        where d.BENHVIEN_ID = 'HLU01'  and tk.SOLUONG >= 0        end        else        begin                  select  distinct tk.DUOC_KEY, LTRIM(tk.PHAMVI_ID) as PHAMVI_ID, tk.NGUONDUOC_ID, nh.TENNGUONDUOC, nh.TINHTIEN, d.DUOC_ID, ld.MALOAIDUOC,        d.SOVISA,d.TYLE_VAT,d.COTOA, d.MADUOC, d.TENHANG, d.TENDUOCDAYDU, d.DONVITINH as DONVITINH, d.BHYT,        d.TENHOATCHAT, d.HAMLUONG, d.HANGSANXUAT, d.QUOCGIA, d.LOAIDUOC_ID, d.DUONGDUNG_ID, d.TINHTIEN_PTTT,        ten.TENDUOC, ten.TENDUOC_EN, ten.MAQUOCTE, ten.MAQUOCTEBT,        CASE WHEN d.BHYT = '1' THEN 'BHYT' ELSE '' END as BHYT_TEXT        , ld.LOAIVATTU_ID        , d.BENHVIEN_ID,        tk.SOLUONG, d.VTYT_PHANLOAI, d.PHAMVI, d.SUASOLUONGTONGHOP, d.MADUOCBV, d.DANGTRINHBAY        , TAMNGUNG = CASE WHEN d.TAMNGUNG = '1' OR nh.TAMNGUNG = '1' OR kd.TAMNGUNG = '1' THEN '1' ELSE '0' END        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        inner join        (        select  LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')) DUOC_KEY, (SUM(dtk.SOLUONG) - isnull(sum(A.SOLUONG),0) - isnull(sum(B.SOLUONG),0)) SOLUONG, pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        from (select sum(soluong) soluong,duoc_id,nguonduoc_id,khoduoc_id,benhvien_id from TT_DUOC_TONKHO  group by duoc_id,nguonduoc_id,khoduoc_id,benhvien_id) dtk        inner join TM_DUOC_PHAMVISD_MAPPING pvsd on dtk.KHODUOC_ID = pvsd.KHODUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NOITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) B on B.DUOC_ID = dtk.DUOC_ID and B.SOLUONG > 0 and B.PHAMVI_ID = pvsd.PHAMVI_ID and B.NGUONHANG_ID = dtk.NGUONDUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NGOAITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) A on A.DUOC_ID = dtk.DUOC_ID and A.SOLUONG > 0 and A.PHAMVI_ID = pvsd.PHAMVI_ID and A.NGUONHANG_ID = dtk.NGUONDUOC_ID        where dtk.SOLUONG > 0 and dtk.BENHVIEN_ID = 'HLU01'        group by LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')), pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        ) tk on tk.DUOC_ID = d.DUOC_ID        left join TM_DUOC_PHAMVISUDUNG kd on kd.PHAMVI_ID = tk.PHAMVI_ID and kd.BENHVIEN_ID = 'HLU01'        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = tk.NGUONDUOC_ID and nh.BENHVIEN_ID = 'HLU01'        where d.BENHVIEN_ID = 'HLU01'  and tk.SOLUONG >= 0        end]
2019-09-20 17:46:23,999 [5] DEBUG - Statement Id: [DAO00320_GetList] PreparedStatement : [select M.*            from TM_MAU M            LEFT JOIN TM_MAU_DONVITINH DVT on M.DONVITINH_ID=DVT.DONVITINH_ID            where            M.TAMNGUNG = '0'            and M.BENHVIEN_ID = 'HLU01'            order by M.TENMAU]
2019-09-20 17:46:24,064 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM071']
2019-09-20 17:46:24,143 [5] DEBUG - Statement Id: [DAO00322_GetListMauTonKhoForCreateCached] PreparedStatement : [SELECT DISTINCT          TK.MAU_KEY, TK.KHOMAU_ID, M.MAU_ID, M.MAMAU, M.TENMAU, M.NHOM_ABO, M.NHOM_RH, M.LOAIMAU_ID,          TK.SOLONHAP_ID, SLN.SOLONHAP, SLN.SOKIEMSOAT, TK.NGUONHANG_ID, NG.TENNGUONMAU, M.BENHVIEN_ID, M.DONVITINH_ID,          SUM(tk.SOLUONG) AS SOLUONG,K.TENKHO,DVT.TENDONVITINH          FROM TT_MAU_TONKHO TK          JOIN TM_KHO K ON TK.KHOMAU_ID = K.KHO_ID          JOIN TT_MAU_CHUNGTU_SOLONHAP SLN ON TK.SOLONHAP_ID = SLN.SOLONHAP_ID          JOIN TM_MAU M on TK.MAU_ID = M.MAU_ID and M.TAMNGUNG = '0'          LEFT JOIN TM_MAU_DONVITINH DVT on M.DONVITINH_ID=DVT.DONVITINH_ID          LEFT JOIN TM_NGUONMAU NG ON NG.NGUONMAU_ID = TK.NGUONHANG_ID          WHERE TK.SOLUONG > 0          GROUP BY TK.MAU_KEY, TK.KHOMAU_ID, M.MAU_ID, M.MAMAU, M.TENMAU, M.NHOM_ABO, M.NHOM_RH, M.LOAIMAU_ID,          TK.SOLONHAP_ID, SLN.SOLONHAP, SLN.SOKIEMSOAT,TK.NGUONHANG_ID, NG.TENNGUONMAU, M.BENHVIEN_ID, M.DONVITINH_ID,K.TENKHO,DVT.TENDONVITINH]
2019-09-20 17:46:24,234 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM073']
2019-09-20 17:46:24,279 [5] DEBUG - Statement Id: [DAO00322_GetListMauTonKhoTruBooking] PreparedStatement : [select distinct          TK.MAU_KEY, TK.KHOMAU_ID, M.MAU_ID, M.MAMAU, M.TENMAU, M.NHOM_ABO, M.NHOM_RH, M.LOAIMAU_ID, M.DONVITINH_ID,          TK.SOLONHAP_ID, TK.SOLONHAP, TK.SOKIEMSOAT,M.PHAMVI, TK.NGUONHANG_ID, NG.TENNGUONMAU, M.BENHVIEN_ID,          TK.SOLUONG,TK.TENKHO,DVT.TENDONVITINH          from TM_MAU M          JOIN          (          select          A.MAU_KEY, A.KHOMAU_ID, A.MAU_ID ,a.NGUONHANG_ID, A.SOLONHAP_ID, A.SOLONHAP, A.SOKIEMSOAT, A.SOLUONG,A.TENKHO          from          (          select KHOMAU_ID, TK.MAU_ID, TK.NGUONHANG_ID, TK.MAU_KEY, SLN.SOLONHAP_ID, SLN.SOLONHAP, SLN.SOKIEMSOAT, ISNULL(TK.SOLUONG,0) - ISNULL(book.SOLUONG,0) as SOLUONG,K.TENKHO          from TT_MAU_TONKHO TK          JOIN TM_KHO K ON TK.KHOMAU_ID = K.KHO_ID          inner join TT_MAU_CHUNGTU_SOLONHAP SLN ON TK.SOLONHAP_ID = SLN.SOLONHAP_ID          left join dbo.TT_MAU_TONKHO_BOOK book ON book.MAU_KEY = TK.MAU_KEY AND book.TRANGTHAI = 'HIEULUC'          where ISNULL(TK.SOLUONG,0) - ISNULL(book.SOLUONG,0) > 0          ) A          )TK on TK.MAU_ID = M.MAU_ID and M.TAMNGUNG = '0'          LEFT JOIN TM_MAU_DONVITINH DVT on M.DONVITINH_ID=DVT.DONVITINH_ID          LEFT JOIN TM_NGUONMAU NG ON NG.NGUONMAU_ID = TK.NGUONHANG_ID]
2019-09-20 17:46:24,367 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM072']
2019-09-20 17:46:25,290 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'MAIN'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2019-09-20 17:46:26,005 [1] DEBUG - Statement Id: [DAO00002_FormList] PreparedStatement : [select              TM_SYS_FORM.HOSPITAL_ID,              TM_SYS_FORM.NAME,              TM_SYS_FORM.CLASS,              TM_SYS_FORM.ASSEMBLY,              TM_SYS_FORM.TITLE_VI as TITLE              from TM_SYS_FORM              where HOSPITAL_ID = 'HLU01']
2019-09-20 17:46:30,479 [1] DEBUG - Statement Id: [DAO00300_GetShortcutListByUserID] PreparedStatement : [SELECT S.SHORTCUT_CODE, S.SHORTCUT_VALUE              FROM TM_SHORTCUT AS S              WHERE S.BENHVIEN_ID = 'HLU01' AND S.USER_ID = '1' AND TAMNGUNG = '0']
2019-09-20 17:46:30,512 [1] DEBUG - Statement Id: [DAO00087_GetList] PreparedStatement : [select CODE, VALUE, BENHVIEN_ID              from TM_SYS_APPSETTINGS              where LOCKED = '0' and BENHVIEN_ID = 'HLU01'              order by SETTING_ID]
2019-09-20 17:46:30,618 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'MSG01'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2019-09-20 17:46:30,732 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'MSG02'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2019-09-20 17:46:30,864 [1] DEBUG - Statement Id: [DAO00008_GetUserSettings] PreparedStatement : [select A.*, B.TENKHO , C.TENPHONGBAN, B.MAKHO, C.MAPHONGBAN          from TM_SYS_USERS A          left join TM_KHODUOC B on B.KHODUOC_ID = A.INVENTORY_ID          left join TM_PHONGBAN C on (C.PHONGBAN_ID = A.WORKING_DEPT_ID and C.BENHVIEN_ID =  @param0 )          left join TM_SYS_USERKHO D on (D.ACCOUNT_ID = A.ACCOUNT_ID and D.HOSPITAL_ID =  @param0 )          where          A.HOSPITAL_ID =  @param0            and                 A.ACCOUNT_ID =  @param1]
2019-09-20 17:46:30,866 [1] DEBUG - Statement Id: [DAO00008_GetUserSettings] Parameters: [@param0=[HOSPITAL_ID,HLU01], @param1=[ACCOUNT_ID,113]]
2019-09-20 17:46:30,866 [1] DEBUG - Statement Id: [DAO00008_GetUserSettings] Types: [@param0=[String, System.String], @param1=[String, System.String]]
2019-09-20 17:46:30,897 [1] DEBUG - Statement Id: [DAO00008_GetUserInvSettings] PreparedStatement : [select A.*, B.TENKHO, B.MAKHO, B.LOAIKHO_ID, B.KHOQUANLY_ID          from TM_SYS_USERKHO A          left join TM_KHO B on B.MODULE_ID = A.MODULE_ID and B.KHO_ID = A.KHO_ID          where A.HOSPITAL_ID =  @param0  and A.ACCOUNT_ID =  @param1           order by B.TENKHO]
2019-09-20 17:46:30,897 [1] DEBUG - Statement Id: [DAO00008_GetUserInvSettings] Parameters: [@param0=[HOSPITAL_ID,HLU01], @param1=[ACCOUNT_ID,113]]
2019-09-20 17:46:30,897 [1] DEBUG - Statement Id: [DAO00008_GetUserInvSettings] Types: [@param0=[String, System.String], @param1=[String, System.String]]
2019-09-20 17:46:31,025 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'COM30'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2019-09-20 17:46:31,174 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'RIS04'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2019-09-20 17:46:38,061 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'MENU1'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2019-09-20 17:46:38,150 [1] DEBUG - Statement Id: [DAO00011_GetList] PreparedStatement : [select              TM_SYS_MENU.ID,              TM_SYS_MENU.PARENTID,              TM_SYS_MENU.SCREEN,              TM_SYS_MENU.SMALLIMAGE,              TM_SYS_MENU.LARGEIMAGE,              TM_SYS_MENU.DESCRIPTION,              TM_SYS_MENU.TYPE,              TM_SYS_MENU.TITLE_VI as TITLE              from TM_SYS_MENU              where TM_SYS_MENU.HOSPITAL_ID = 'HLU01' and TM_SYS_MENU.ACTIVE = '1'               AND                   (TM_SYS_MENU.TYPE & '8' = '8')                             order by TM_SYS_MENU.ORDERNUM]
2019-09-20 17:46:38,412 [1] DEBUG - Statement Id: [DAO00011_usermenu_list] PreparedStatement : [select              TM_SYS_HOMEMENU.MENUID as ID,              TM_SYS_MENU.TITLE_VI as TITLE,              TM_SYS_MENU.SCREEN,              TM_SYS_MENU.SMALLIMAGE,              TM_SYS_MENU.LARGEIMAGE,              TM_SYS_MENU.TYPE              from TM_SYS_HOMEMENU              left join TM_SYS_MENU on TM_SYS_MENU.ID = TM_SYS_HOMEMENU.MENUID and TM_SYS_MENU.HOSPITAL_ID = TM_SYS_HOMEMENU.HOSPITAL_ID              where TM_SYS_HOMEMENU.HOSPITAL_ID = 'HLU01' and TM_SYS_HOMEMENU.USERID = '113' and TM_SYS_MENU.ACTIVE = '1'               AND                   (TM_SYS_MENU.TYPE & '8' = '8')                             ORDER BY TM_SYS_HOMEMENU.ORDERNUM]
2019-09-20 17:46:47,128 [1] DEBUG - Statement Id: [DAO00087_GetServiceParams] PreparedStatement : [select CODE, VALUE              from TM_SYS_APPSETTINGS              where LOCKED = '0' and BENHVIEN_ID = 'HLU01']
2019-09-20 17:46:47,561 [1] DEBUG - Statement Id: [DAO00030_GetMucDichChungTuID] PreparedStatement : [SELECT DICTIONARY_ID              FROM              LST_DICTIONARY              WHERE              DICTIONARY_TYPE_CODE = 'MucDichChungTu'              and DICTIONARY_CODE = 'X13']
2019-09-20 17:46:47,723 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'PHA22'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2019-09-20 17:46:48,391 [1] DEBUG - Statement Id: [DAO00030_GET_SOLONHAP] PreparedStatement : [SELECT DISTINCT            SLN.SOLONHAP_ID, SLN.SOLONHAP, SLN.SOLOSANPHAM, SLN.SOKIEMSOAT, SLN.SOVISA, CONVERT(varchar(20), SLN.SOLOSANPHAM) + '/' + CONVERT(varchar(20), TK.SOLUONG) AS SOLOSOTON,            SLN.NGAYNHAP AS NGAYNHAPLO, SLN.HANDUNG AS HANSUDUNG,  SLN.HANDUNG, SLN.NGUONDUOC_ID, SLN.NGUONDUOC_ID as NGUONHANG_ID,            SLNGB.DONGIAMUA, SLNGB.DONGIAVON, SLNGB.TYLEVAT_DAUVAO as TYLEVAT, d.TYLE_VAT, SLNGB.DONGIAVONVAT, SLNGB.DONGIABAN, SLNGB.DONGIABANVAT_DAUVAO as DONGIABAN_VAT,            TK.DUOCTONKHO_ID, TK.KHODUOC_ID, TK.DUOC_ID, TK.SOLUONG, TK.SOLUONG AS SOLUONGTON,            D.TENDUOCDAYDU,D.DONVITINH_ID, D.DONVITINH, D.BHYT, NH.TENNGUONDUOC AS NGUONHANG,            LTRIM(TK.KHODUOC_ID) + '_' + LTRIM(TK.DUOC_ID) + '_' + LTRIM(TK.NGUONDUOC_ID) as DUOC_KEY, D.SO_QDTT            FROM            TT_DUOC_CHUNGTU_SOLONHAP SLN,            TT_DUOC_TONKHO TK,            TT_DUOC_SOLONHAP_GIABAN SLNGB,            TM_DUOC D,            TM_NGUONHANG NH            WHERE            SLN.SOLONHAP_ID = TK.SOLONHAP_ID            AND SLN.SOLONHAP_ID = SLNGB.SOLONHAP_ID            AND SLN.NGUONDUOC_ID = NH.NGUONDUOC_ID            AND SLN.DUOC_ID = D.DUOC_ID            AND TK.DUOC_ID = ''            AND TK.KHODUOC_ID = ''            AND SLN.BENHVIEN_ID = 'HLU01'            AND TK.SOLUONG > 0                 and                     SLN.NGUONDUOC_ID = '1'                                      ORDER BY NGAYNHAP]
2019-09-20 17:46:48,432 [1] DEBUG - Statement Id: [DAO00030_GetMucDichChungTuID] PreparedStatement : [SELECT DICTIONARY_ID              FROM              LST_DICTIONARY              WHERE              DICTIONARY_TYPE_CODE = 'MucDichChungTu'              and DICTIONARY_CODE = 'X13']
2019-09-20 17:46:48,533 [1] DEBUG - Statement Id: [DAO00030_GetMucDichChungTuID] PreparedStatement : [SELECT DICTIONARY_ID              FROM              LST_DICTIONARY              WHERE              DICTIONARY_TYPE_CODE = 'MucDichChungTu'              and DICTIONARY_CODE = 'X13']
2019-09-20 17:46:49,566 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'PHA74'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2019-09-20 17:46:55,334 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'COM98'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2019-09-20 17:46:55,767 [1] DEBUG - Statement Id: [DAO00030_Search_PhieuXuatSD] PreparedStatement : [SELECT DISTINCT phieuxuat.* FROM          (          select DISTINCT          CT.CHUNGTU_ID,          CT.SOCHUNGTU,          CT.MACHUNGTU,          CT.NGAYCHUNGTU,          CT.NGAYTAO,          CT.KHOXUAT_ID,          CT.NGUOIGIAO_ID,          CT.KHONHAP_ID,          CT.NGUOINHAN_ID,          PL.MACHUNGTU as MAPHIEULINH,          PL.NGAYCHUNGTU as NGAYPHIEULINH,          bn.MAYTE,          bn.TENBENHNHAN,          CONVERT(VARCHAR(10), KB.THOIGIANKHAM, 103) + ' - ' + CONVERT(VARCHAR(5), KB.THOIGIANKHAM, 108) as THOIGIANKHAM,          nl.TENNHANVIEN as NGUOILAP,          CT.DIENGIAI          from TT_DUOC_CHUNGTU CT          inner join TT_DUOC_CHUNGTU_CHITIET ctct on ct.CHUNGTU_ID = ctct.CHUNGTU_ID          inner join TT_NOITRU_TOATHUOC TT on ctct.TOATHUOCNOITRU_ID = TT.TOATHUOC_ID          inner join TT_NOITRU_KHAMBENH KB on kb.KHAMBENH_ID = TT.KHAMBENH_ID          inner join TT_BENHNHAN BN on TT.BENHNHAN_ID = BN.BENHNHAN_ID          left join TT_DUOC_PHIEULINH PL on PL.CHUNGTU_ID = CT.PHIEULINH_ID          left join TM_NHANVIEN nl on nl.NHANVIEN_ID = TT.NGUOITAO_ID           where                   CT.MUCDICHCHUNGTU_ID = '1060'               and                 CT.KHOXUAT_ID = '32'               and                 CONVERT(date, CT.NGAYCHUNGTU) BETWEEN CONVERT(date, '9/20/2019 12:00:00 AM')  and  CONVERT(date, '9/20/2019 12:00:00 AM')               and                 CT.BENHVIEN_ID = 'HLU01'                           UNION            select DISTINCT          CT.CHUNGTU_ID,          CT.SOCHUNGTU,          CT.MACHUNGTU,          CT.NGAYCHUNGTU,          CT.NGAYTAO,          CT.KHOXUAT_ID,          CT.NGUOIGIAO_ID,          CT.KHONHAP_ID,          CT.NGUOINHAN_ID,          PL.MACHUNGTU as MAPHIEULINH,          PL.NGAYCHUNGTU as NGAYPHIEULINH,          bn.MAYTE,          bn.TENBENHNHAN,          CONVERT(VARCHAR(10), KB.THOIGIANKHAM, 103) + ' - ' + CONVERT(VARCHAR(5), KB.THOIGIANKHAM, 108) as THOIGIANKHAM,          nl.TENNHANVIEN as NGUOILAP,          CT.DIENGIAI          from TT_DUOC_CHUNGTU CT          inner join TT_DUOC_CHUNGTU_CHITIET ctct on ct.CHUNGTU_ID = ctct.CHUNGTU_ID          inner join TT_NGOAITRU_KHAMBENH_VTYT vt on ctct.KHAMBENH_VTYT_ID = vt.KHAMBENH_VTYT_ID          inner join TT_NGOAITRU_KHAMBENH kb on kb.KHAMBENH_ID = vt.KHAMBENH_ID          inner join TT_BENHNHAN BN on bn.BENHNHAN_ID = kb.BENHNHAN_ID          left join TT_DUOC_PHIEULINH PL on PL.CHUNGTU_ID = CT.PHIEULINH_ID          left join TM_NHANVIEN nl on nl.NHANVIEN_ID = vt.NGUOITAO_ID           where                   CT.MUCDICHCHUNGTU_ID = '1060'               and                 CT.KHOXUAT_ID = '32'               and                 CONVERT(date, CT.NGAYCHUNGTU) BETWEEN CONVERT(date, '9/20/2019 12:00:00 AM')  and  CONVERT(date, '9/20/2019 12:00:00 AM')               and                 CT.BENHVIEN_ID = 'HLU01'                           UNION            select DISTINCT          CT.CHUNGTU_ID,          CT.SOCHUNGTU,          CT.MACHUNGTU,          CT.NGAYCHUNGTU,          CT.NGAYTAO,          CT.KHOXUAT_ID,          CT.NGUOIGIAO_ID,          CT.KHONHAP_ID,          CT.NGUOINHAN_ID,          PL.MACHUNGTU as MAPHIEULINH,          PL.NGAYCHUNGTU as NGAYPHIEULINH,          bn.MAYTE,          bn.TENBENHNHAN,          CONVERT(VARCHAR(10), pt.NGAYTHUCHIEN, 103) + ' - ' + CONVERT(VARCHAR(5), pt.NGAYTHUCHIEN, 108) as THOIGIANKHAM,          nl.TENNHANVIEN as NGUOILAP,          CT.DIENGIAI          from TT_DUOC_CHUNGTU CT          inner join TT_DUOC_CHUNGTU_CHITIET ctct on ct.CHUNGTU_ID = ctct.CHUNGTU_ID          inner join TT_PHAUTHUAT_VTYT vt on ctct.PHAUTHUAT_VTYT_ID = vt.PHAUTHUAT_VTYT_ID          inner join TT_PHAUTHUAT pt on pt.PHAUTHUAT_ID = vt.PHAUTHUAT_ID          inner join TT_TIEPNHAN tn on tn.TIEPNHAN_ID = pt.TIEPNHAN_ID          inner join TT_BENHNHAN bn on bn.BENHNHAN_ID = tn.BENHNHAN_ID          left join TT_DUOC_PHIEULINH PL on PL.CHUNGTU_ID = CT.PHIEULINH_ID          left join TM_NHANVIEN nl on nl.NHANVIEN_ID = pt.NGUOITAO_ID           where                   CT.MUCDICHCHUNGTU_ID = '1060'               and                 CT.KHOXUAT_ID = '32'               and                 CONVERT(date, CT.NGAYCHUNGTU) BETWEEN CONVERT(date, '9/20/2019 12:00:00 AM')  and  CONVERT(date, '9/20/2019 12:00:00 AM')               and                 CT.BENHVIEN_ID = 'HLU01'                           UNION            select DISTINCT          CT.CHUNGTU_ID,          CT.SOCHUNGTU,          CT.MACHUNGTU,          CT.NGAYCHUNGTU,          CT.NGAYTAO,          CT.KHOXUAT_ID,          CT.NGUOIGIAO_ID,          CT.KHONHAP_ID,          CT.NGUOINHAN_ID,          PL.MACHUNGTU as MAPHIEULINH,          PL.NGAYCHUNGTU as NGAYPHIEULINH,          bn.MAYTE,          bn.TENBENHNHAN,          CONVERT(VARCHAR(10), cls.NGAYTAO, 103) + ' - ' + CONVERT(VARCHAR(5), cls.NGAYTAO, 108) as THOIGIANKHAM,          nl.TENNHANVIEN as NGUOILAP,          CT.DIENGIAI          from TT_DUOC_CHUNGTU CT          inner join TT_DUOC_CHUNGTU_CHITIET ctct on ct.CHUNGTU_ID = ctct.CHUNGTU_ID          inner join TT_CLSKETQUA_VTYT cls on ctct.CLSKETQUA_VTYT_ID = cls.CLSKETQUA_VTYT_ID          inner join TT_DVYEUCAU DV on DV.DVYEUCAU_ID = CLS.DVYEUCAU_ID          inner join TT_BENHNHAN bn on bn.BENHNHAN_ID = DV.BENHNHAN_ID          left join TT_DUOC_PHIEULINH PL on PL.CHUNGTU_ID = CT.PHIEULINH_ID          left join TM_NHANVIEN nl on nl.NHANVIEN_ID = cls.NGUOITAO_ID           where                   CT.MUCDICHCHUNGTU_ID = '1060'               and                 CT.KHOXUAT_ID = '32'               and                 CONVERT(date, CT.NGAYCHUNGTU) BETWEEN CONVERT(date, '9/20/2019 12:00:00 AM')  and  CONVERT(date, '9/20/2019 12:00:00 AM')               and                 CT.BENHVIEN_ID = 'HLU01'                           UNION            select DISTINCT          CT.CHUNGTU_ID,          CT.SOCHUNGTU,          CT.MACHUNGTU,          CT.NGAYCHUNGTU,          CT.NGAYTAO,          CT.KHOXUAT_ID,          CT.NGUOIGIAO_ID,          CT.KHONHAP_ID,          CT.NGUOINHAN_ID,          PL.MACHUNGTU as MAPHIEULINH,          PL.NGAYCHUNGTU as NGAYPHIEULINH,          null as MAYTE,          null as TENBENHNHAN,          null as THOIGIANKHAM,          nl.TENNHANVIEN as NGUOILAP,          CT.DIENGIAI          from TT_DUOC_CHUNGTU CT          inner join TT_DUOC_CHUNGTU_CHITIET ctct on ct.CHUNGTU_ID = ctct.CHUNGTU_ID          left join TT_DUOC_PHIEULINH PL on PL.CHUNGTU_ID = CT.PHIEULINH_ID          left join TM_NHANVIEN nl on nl.NHANVIEN_ID = ct.NGUOITAO_ID          WHERE (ctct.TOATHUOCNOITRU_ID IS NULL AND ctct.KHAMBENH_VTYT_ID IS NULL AND ctct.PHAUTHUAT_VTYT_ID IS NULL AND ctct.CLSKETQUA_VTYT_ID IS NULL)             and                 CT.MUCDICHCHUNGTU_ID = '1060'               and                 CT.KHOXUAT_ID = '32'               and                 CONVERT(date, CT.NGAYCHUNGTU) BETWEEN CONVERT(date, '9/20/2019 12:00:00 AM')  and  CONVERT(date, '9/20/2019 12:00:00 AM')               and                 CT.BENHVIEN_ID = 'HLU01'                         )PhieuXuat          ORDER BY PhieuXuat.CHUNGTU_ID desc]
2019-09-20 17:47:05,200 [1] DEBUG - Statement Id: [DAO00030_GetList] PreparedStatement : [select *              from TT_DUOC_CHUNGTU              where BENHVIEN_ID = 'HLU01'                and                   TT_DUOC_CHUNGTU.CHUNGTU_ID = '137704'                               order by CHUNGTU_ID]
2019-09-20 17:47:13,692 [1] DEBUG - Statement Id: [DAO00030_CHUNGTUXUAT_CHITIET_GetList] PreparedStatement : [SELECT            ctct.*,            d.MADUOC, d.TENHANG, d.TENDUOCDAYDU, dvt.TENDONVITINH as DONVITINH,n.TENNGUONDUOC as NGUONHANG,            sln.SOLONHAP, sln.SOLOSANPHAM, sln.NGAYNHAP as NGAYNHAPLO, sln.HANDUNG as HANSUDUNG,            isnull(tk.SOLUONG,0) as SOLUONGTON,            LTRIM(ct.KHOXUAT_ID) + '_' + LTRIM(sln.DUOC_ID) + '_' + LTRIM(sln.NGUONDUOC_ID) as DUOC_KEY            , NLD.MANHOMLOAIDUOC, ld.MALOAIDUOC, D.SO_QDTT            FROM            TT_DUOC_CHUNGTU_CHITIET ctct            INNER JOIN TT_DUOC_CHUNGTU ct ON (ct.CHUNGTU_ID = ctct.CHUNGTU_ID)            INNER JOIN TT_DUOC_CHUNGTU_SOLONHAP sln ON (sln.SOLONHAP_ID = ctct.SOLONHAP_ID)            LEFT JOIN (            select xx.DUOCTONKHO_ID, xx.KHODUOC_ID, xx.DUOC_ID, xx.SOLONHAP_ID, xx.SOLUONG, xx.NGUONDUOC_ID, xx.BENHVIEN_ID from TT_DUOC_TONKHO xx            join ( select max(DUOCTONKHO_ID) as DUOCTONKHO_ID, KHODUOC_ID, DUOC_ID, SOLONHAP_ID, NGUONDUOC_ID            from TT_DUOC_TONKHO group by KHODUOC_ID, DUOC_ID, SOLONHAP_ID, NGUONDUOC_ID) yy on xx.DUOCTONKHO_ID=yy.DUOCTONKHO_ID            ) tk ON (tk.SOLONHAP_ID = sln.SOLONHAP_ID AND tk.DUOC_ID = sln.DUOC_ID and tk.KHODUOC_ID = ct.KHOXUAT_ID)            INNER JOIN TM_DUOC d ON (d.DUOC_ID = ctct.DUOC_ID)            INNER JOIN TM_NGUONHANG n ON (n.NGUONDUOC_ID = ctct.NGUONHANG_ID)            LEFT JOIN TM_DONVITINH dvt ON (dvt.DONVITINH_ID = ctct.DONVITINH_ID)            left join TM_LOAIDUOC LD on LD.LOAIDUOC_ID = D.LOAIDUOC_ID            LEFT JOIN TM_NHOMLOAIDUOC NLD on NLD.NHOMLOAIDUOC_ID = LD.NHOMLOAIDUOC_ID             where                             ct.CHUNGTU_ID = '137704'                       and                           ct.BENHVIEN_ID = 'HLU01'                                     order by CHUNGTUCHITIET_ID]
2019-09-20 17:47:58,415 [1] DEBUG - Statement Id: [DAO00030_KiemTraChungTuKhoaSo] PreparedStatement : [SELECT CHUNGTU_ID              FROM TT_DUOC_CHUNGTU              WHERE              MACHUNGTU = 'CS_KBX1319003092'              and BENHVIEN_ID = 'HLU01'              and              convert(date, NGAYCHUNGTU) <=              (              SELECT TOP 1 convert(date, KHOADENNGAY)              FROM TT_DUOC_KHOASOCHUNGTU              WHERE              KHODUOC_ID = '32'              and BENHVIEN_ID = 'HLU01'              AND KHOASO = '1'              ORDER BY KHOADENNGAY DESC              )]
2019-09-20 17:47:58,450 [1] DEBUG - Statement Id: [DAO00030_KiemTraChungTuDaChuyenKeToan] PreparedStatement : [SELECT CHUNGTU_ID            FROM TT_DUOC_CHUNGTU            WHERE            CHUNGTU_ID = '137704'            and IDCHUYEN IS NOT NULL            and BENHVIEN_ID = 'HLU01']
2019-09-20 17:47:58,481 [1] DEBUG - Statement Id: [DAO00030_KiemTraBenhNhanXuatVien] PreparedStatement : [select              TT.TOATHUOC_ID              from              TT_NOITRU_TOATHUOC TT              inner join TT_NOITRU_KHAMBENH KB on TT.KHAMBENH_ID = KB.KHAMBENH_ID              inner join TT_NOITRU_BENHAN BA on BA.BENHAN_ID = KB.BENHAN_ID              WHERE              BA.TRANGTHAI = 'DAXUATVIEN'              AND TT.CHUNGTU_ID =  137704              and TT.BENHVIEN_ID = 'HLU01']
2019-09-20 17:47:58,677 [1] DEBUG - Statement Id: [DAO00030_DUOCTONKHO_GetSoTonTheoDuoc] PreparedStatement : [SELECT              DUOC_ID,              SUM(SOLUONG) AS TONGTON              FROM              TT_DUOC_TONKHO              WHERE              KHODUOC_ID = '32'              and BENHVIEN_ID = 'HLU01'              and DUOC_ID IN (1)              GROUP BY DUOC_ID]
2019-09-20 17:47:58,726 [1] DEBUG - Statement Id: [DAO00030_DUOCTONKHO_GetSoTonTheoDuocTheoLo] PreparedStatement : [SELECT              DUOC_ID,SOLONHAP_ID,              SUM(SOLUONG) AS SOLUONGTONLO              FROM              TT_DUOC_TONKHO              WHERE              KHODUOC_ID = '32'              and BENHVIEN_ID = 'HLU01'              and DUOC_ID IN (1)              and SOLONHAP_ID IN (7541)              GROUP BY DUOC_ID, SOLONHAP_ID]
2019-09-20 17:47:58,837 [1] DEBUG - Statement Id: [DAO00030_DUOCTONKHO_GetSoTonTheoDuoc] PreparedStatement : [SELECT              DUOC_ID,              SUM(SOLUONG) AS TONGTON              FROM              TT_DUOC_TONKHO              WHERE              KHODUOC_ID = '32'              and BENHVIEN_ID = 'HLU01'              and DUOC_ID IN (1)              GROUP BY DUOC_ID]
2019-09-20 17:47:58,925 [1] DEBUG - Statement Id: [DAO00030_KTDaPhatSinhBienLai] PreparedStatement : [SELECT CHUNGTU_ID            FROM TT_NOITRU_TOATHUOC tt            INNER JOIN TT_VIENPHI vp on (tt.TOATHUOC_ID = vp.REF_ID and REF_TABLE = 'TT_NOITRU_TOATHUOC')            WHERE            CHUNGTU_ID = '137704'            AND tt.BENHVIEN_ID = 'HLU01'            AND HOADON_ID is not NULL            AND vp.HUY = '0'              union all            SELECT  kbtt.CHUNGTUPHATTHUOC_ID as CHUNGTU_ID            FROM TT_NGOAITRU_TOATHUOC tt            INNER JOIN TT_NGOAITRU_KHAMBENH_TOATHUOC kbtt on (kbtt.KHAMBENH_TOATHUOC_ID = tt.KHAMBENH_TOATHUOC_ID)            INNER JOIN TT_VIENPHI vp on (tt.TOATHUOC_ID = vp.REF_ID and REF_TABLE = 'TT_NGOAITRU_TOATHUOC')            WHERE            kbtt.CHUNGTUPHATTHUOC_ID = '137704'            AND tt.BENHVIEN_ID = 'HLU01'            AND HOADON_ID is not NULL            AND vp.HUY = '0'              union all            SELECT ctct.CHUNGTU_ID from            TT_DUOC_CHUNGTU_CHITIET ctct            INNER JOIN TT_HOADON_CHITIET_NGOAITRU hdct on (hdct.REF_ID = ctct.CHUNGTUCHITIET_ID and hdct.REF_TABLE = 'TT_DUOC_CHUNGTU_CHITIET')            INNER JOIN TT_HOADON hd on hd.HOADON_ID = hdct.HOADON_ID            WHERE            ctct.CHUNGTU_ID = '137704'                            AND hd.HUYHOADON = '0'              AND hd.HOANTRA = '0'                                  AND ctct.BENHVIEN_ID = 'HLU01'                        union all            SELECT CHUNGTU_ID            FROM TT_NGOAITRU_KHAMBENH_VTYT tt            INNER JOIN TT_VIENPHI vp on (tt.KHAMBENH_VTYT_ID = vp.REF_ID and REF_TABLE = 'TT_NGOAITRU_KHAMBENH_VTYT')            WHERE            CHUNGTU_ID = '137704'            AND tt.BENHVIEN_ID = 'HLU01'            AND HOADON_ID is not NULL            AND vp.HUY = '0'                        union all            SELECT CHUNGTU_ID            FROM TT_PHAUTHUAT_VTYT tt            INNER JOIN TT_VIENPHI vp on (tt.PHAUTHUAT_VTYT_ID = vp.REF_ID and REF_TABLE = 'TT_PHAUTHUAT_VTYT')            WHERE            CHUNGTU_ID = '137704'            AND tt.BENHVIEN_ID = 'HLU01'            AND HOADON_ID is not NULL            AND vp.HUY = '0'                        union all            SELECT CHUNGTU_ID            FROM TT_CLSKETQUA_VTYT tt            INNER JOIN TT_VIENPHI vp on (tt.CLSKETQUA_VTYT_ID = vp.REF_ID and REF_TABLE = 'TT_CLSKETQUA_VTYT')            WHERE            CHUNGTU_ID = '137704'            AND tt.BENHVIEN_ID = 'HLU01'            AND HOADON_ID is not NULL            AND vp.HUY = '0']
2019-09-20 17:48:01,635 [1] DEBUG - Statement Id: [DAO00030_KTDaPhatSinhBienLai] PreparedStatement : [SELECT CHUNGTU_ID            FROM TT_NOITRU_TOATHUOC tt            INNER JOIN TT_VIENPHI vp on (tt.TOATHUOC_ID = vp.REF_ID and REF_TABLE = 'TT_NOITRU_TOATHUOC')            WHERE            CHUNGTU_ID = '137704'            AND tt.BENHVIEN_ID = 'HLU01'            AND HOADON_ID is not NULL            AND vp.HUY = '0'              union all            SELECT  kbtt.CHUNGTUPHATTHUOC_ID as CHUNGTU_ID            FROM TT_NGOAITRU_TOATHUOC tt            INNER JOIN TT_NGOAITRU_KHAMBENH_TOATHUOC kbtt on (kbtt.KHAMBENH_TOATHUOC_ID = tt.KHAMBENH_TOATHUOC_ID)            INNER JOIN TT_VIENPHI vp on (tt.TOATHUOC_ID = vp.REF_ID and REF_TABLE = 'TT_NGOAITRU_TOATHUOC')            WHERE            kbtt.CHUNGTUPHATTHUOC_ID = '137704'            AND tt.BENHVIEN_ID = 'HLU01'            AND HOADON_ID is not NULL            AND vp.HUY = '0'              union all            SELECT ctct.CHUNGTU_ID from            TT_DUOC_CHUNGTU_CHITIET ctct            INNER JOIN TT_HOADON_CHITIET_NGOAITRU hdct on (hdct.REF_ID = ctct.CHUNGTUCHITIET_ID and hdct.REF_TABLE = 'TT_DUOC_CHUNGTU_CHITIET')            INNER JOIN TT_HOADON hd on hd.HOADON_ID = hdct.HOADON_ID            WHERE            ctct.CHUNGTU_ID = '137704'                            AND hd.HUYHOADON = '0'              AND hd.HOANTRA = '0'                                  AND ctct.BENHVIEN_ID = 'HLU01'                        union all            SELECT CHUNGTU_ID            FROM TT_NGOAITRU_KHAMBENH_VTYT tt            INNER JOIN TT_VIENPHI vp on (tt.KHAMBENH_VTYT_ID = vp.REF_ID and REF_TABLE = 'TT_NGOAITRU_KHAMBENH_VTYT')            WHERE            CHUNGTU_ID = '137704'            AND tt.BENHVIEN_ID = 'HLU01'            AND HOADON_ID is not NULL            AND vp.HUY = '0'                        union all            SELECT CHUNGTU_ID            FROM TT_PHAUTHUAT_VTYT tt            INNER JOIN TT_VIENPHI vp on (tt.PHAUTHUAT_VTYT_ID = vp.REF_ID and REF_TABLE = 'TT_PHAUTHUAT_VTYT')            WHERE            CHUNGTU_ID = '137704'            AND tt.BENHVIEN_ID = 'HLU01'            AND HOADON_ID is not NULL            AND vp.HUY = '0'                        union all            SELECT CHUNGTU_ID            FROM TT_CLSKETQUA_VTYT tt            INNER JOIN TT_VIENPHI vp on (tt.CLSKETQUA_VTYT_ID = vp.REF_ID and REF_TABLE = 'TT_CLSKETQUA_VTYT')            WHERE            CHUNGTU_ID = '137704'            AND tt.BENHVIEN_ID = 'HLU01'            AND HOADON_ID is not NULL            AND vp.HUY = '0']
2019-09-20 17:48:02,449 [1] DEBUG - Statement Id: [DAO00030_KTDaPhatSinhPhieuBHTN] PreparedStatement : [SELECT vp.VIENPHI_ID              FROM TT_VIENPHI vp              INNER JOIN TT_MIENGIAM_CHITIET  mgct on mgct.VIENPHI_ID = vp.VIENPHI_ID              INNER JOIN TT_DUOC_CHUNGTU ct on ct.TIEPNHAN_ID = vp.TIEPNHAN_ID              WHERE              ct.CHUNGTU_ID = '137704'              AND vp.DUOC_ID is not null              AND vp.BENHVIEN_ID = 'HLU01']
2019-09-20 17:48:02,533 [1] DEBUG - Statement Id: [DAO00030_KiemTraBenhNhanXuatVien] PreparedStatement : [select              TT.TOATHUOC_ID              from              TT_NOITRU_TOATHUOC TT              inner join TT_NOITRU_KHAMBENH KB on TT.KHAMBENH_ID = KB.KHAMBENH_ID              inner join TT_NOITRU_BENHAN BA on BA.BENHAN_ID = KB.BENHAN_ID              WHERE              BA.TRANGTHAI = 'DAXUATVIEN'              AND TT.CHUNGTU_ID =  137704              and TT.BENHVIEN_ID = 'HLU01']
2019-09-20 17:48:02,736 [1] DEBUG - Statement Id: [DAO00030_KiemTraChungTuKhoaSo] PreparedStatement : [SELECT CHUNGTU_ID              FROM TT_DUOC_CHUNGTU              WHERE              MACHUNGTU = 'CS_KBX1319003092'              and BENHVIEN_ID = 'HLU01'              and              convert(date, NGAYCHUNGTU) <=              (              SELECT TOP 1 convert(date, KHOADENNGAY)              FROM TT_DUOC_KHOASOCHUNGTU              WHERE              KHODUOC_ID = '32'              and BENHVIEN_ID = 'HLU01'              AND KHOASO = '1'              ORDER BY KHOADENNGAY DESC              )]
2019-09-20 17:48:10,104 [1] DEBUG - Statement Id: [DAO00030_KiemTraChungTuKhoaSo] PreparedStatement : [SELECT CHUNGTU_ID              FROM TT_DUOC_CHUNGTU              WHERE              MACHUNGTU = 'CS_KBX1319003092'              and BENHVIEN_ID = 'HLU01'              and              convert(date, NGAYCHUNGTU) <=              (              SELECT TOP 1 convert(date, KHOADENNGAY)              FROM TT_DUOC_KHOASOCHUNGTU              WHERE              KHODUOC_ID = '32'              and BENHVIEN_ID = 'HLU01'              AND KHOASO = '1'              ORDER BY KHOADENNGAY DESC              )]
2019-09-20 17:48:10,135 [1] DEBUG - Statement Id: [DAO00030_KiemTraChungTuDaChuyenKeToan] PreparedStatement : [SELECT CHUNGTU_ID            FROM TT_DUOC_CHUNGTU            WHERE            CHUNGTU_ID = '137704'            and IDCHUYEN IS NOT NULL            and BENHVIEN_ID = 'HLU01']
2019-09-20 17:48:10,165 [1] DEBUG - Statement Id: [DAO00030_KTDaPhatSinhBienLai] PreparedStatement : [SELECT CHUNGTU_ID            FROM TT_NOITRU_TOATHUOC tt            INNER JOIN TT_VIENPHI vp on (tt.TOATHUOC_ID = vp.REF_ID and REF_TABLE = 'TT_NOITRU_TOATHUOC')            WHERE            CHUNGTU_ID = '137704'            AND tt.BENHVIEN_ID = 'HLU01'            AND HOADON_ID is not NULL            AND vp.HUY = '0'              union all            SELECT  kbtt.CHUNGTUPHATTHUOC_ID as CHUNGTU_ID            FROM TT_NGOAITRU_TOATHUOC tt            INNER JOIN TT_NGOAITRU_KHAMBENH_TOATHUOC kbtt on (kbtt.KHAMBENH_TOATHUOC_ID = tt.KHAMBENH_TOATHUOC_ID)            INNER JOIN TT_VIENPHI vp on (tt.TOATHUOC_ID = vp.REF_ID and REF_TABLE = 'TT_NGOAITRU_TOATHUOC')            WHERE            kbtt.CHUNGTUPHATTHUOC_ID = '137704'            AND tt.BENHVIEN_ID = 'HLU01'            AND HOADON_ID is not NULL            AND vp.HUY = '0'              union all            SELECT ctct.CHUNGTU_ID from            TT_DUOC_CHUNGTU_CHITIET ctct            INNER JOIN TT_HOADON_CHITIET_NGOAITRU hdct on (hdct.REF_ID = ctct.CHUNGTUCHITIET_ID and hdct.REF_TABLE = 'TT_DUOC_CHUNGTU_CHITIET')            INNER JOIN TT_HOADON hd on hd.HOADON_ID = hdct.HOADON_ID            WHERE            ctct.CHUNGTU_ID = '137704'                            AND hd.HUYHOADON = '0'              AND hd.HOANTRA = '0'                                  AND ctct.BENHVIEN_ID = 'HLU01'                        union all            SELECT CHUNGTU_ID            FROM TT_NGOAITRU_KHAMBENH_VTYT tt            INNER JOIN TT_VIENPHI vp on (tt.KHAMBENH_VTYT_ID = vp.REF_ID and REF_TABLE = 'TT_NGOAITRU_KHAMBENH_VTYT')            WHERE            CHUNGTU_ID = '137704'            AND tt.BENHVIEN_ID = 'HLU01'            AND HOADON_ID is not NULL            AND vp.HUY = '0'                        union all            SELECT CHUNGTU_ID            FROM TT_PHAUTHUAT_VTYT tt            INNER JOIN TT_VIENPHI vp on (tt.PHAUTHUAT_VTYT_ID = vp.REF_ID and REF_TABLE = 'TT_PHAUTHUAT_VTYT')            WHERE            CHUNGTU_ID = '137704'            AND tt.BENHVIEN_ID = 'HLU01'            AND HOADON_ID is not NULL            AND vp.HUY = '0'                        union all            SELECT CHUNGTU_ID            FROM TT_CLSKETQUA_VTYT tt            INNER JOIN TT_VIENPHI vp on (tt.CLSKETQUA_VTYT_ID = vp.REF_ID and REF_TABLE = 'TT_CLSKETQUA_VTYT')            WHERE            CHUNGTU_ID = '137704'            AND tt.BENHVIEN_ID = 'HLU01'            AND HOADON_ID is not NULL            AND vp.HUY = '0']
2019-09-20 17:48:10,421 [1] DEBUG - Statement Id: [DAO00030_KiemTraBenhNhanXuatVien] PreparedStatement : [select              TT.TOATHUOC_ID              from              TT_NOITRU_TOATHUOC TT              inner join TT_NOITRU_KHAMBENH KB on TT.KHAMBENH_ID = KB.KHAMBENH_ID              inner join TT_NOITRU_BENHAN BA on BA.BENHAN_ID = KB.BENHAN_ID              WHERE              BA.TRANGTHAI = 'DAXUATVIEN'              AND TT.CHUNGTU_ID =  137704              and TT.BENHVIEN_ID = 'HLU01']
2019-09-20 17:48:10,586 [1] DEBUG - Statement Id: [DAO00030_DUOCTONKHO_GetSoTonTheoDuocTheoLo] PreparedStatement : [SELECT              DUOC_ID,SOLONHAP_ID,              SUM(SOLUONG) AS SOLUONGTONLO              FROM              TT_DUOC_TONKHO              WHERE              KHODUOC_ID = '32'              and BENHVIEN_ID = 'HLU01'              and DUOC_ID IN (1)              and SOLONHAP_ID IN (7541)              GROUP BY DUOC_ID, SOLONHAP_ID]
2019-09-20 17:48:10,619 [1] DEBUG - Statement Id: [DAO00030_LayNgayKhoaSoCuoi] PreparedStatement : [SELECT TOP 1 KHOADENNGAY              FROM TT_DUOC_KHOASOCHUNGTU              WHERE              KHODUOC_ID = '32'              and BENHVIEN_ID = 'HLU01'              and KHOASO = '1'              ORDER BY KHOADENNGAY DESC]
2019-09-20 17:48:10,724 [1] DEBUG - Statement Id: [DAO00030_GetList] PreparedStatement : [select *              from TT_DUOC_CHUNGTU              where BENHVIEN_ID = 'HLU01'                and                   TT_DUOC_CHUNGTU.MACHUNGTU = 'CS_KBX1319003092'                               order by CHUNGTU_ID]
2019-09-20 17:48:10,889 [1] DEBUG - Statement Id: [DAO00030_KiemTraBenhNhanXuatVien] PreparedStatement : [select              TT.TOATHUOC_ID              from              TT_NOITRU_TOATHUOC TT              inner join TT_NOITRU_KHAMBENH KB on TT.KHAMBENH_ID = KB.KHAMBENH_ID              inner join TT_NOITRU_BENHAN BA on BA.BENHAN_ID = KB.BENHAN_ID              WHERE              BA.TRANGTHAI = 'DAXUATVIEN'              AND TT.CHUNGTU_ID =  137704              and TT.BENHVIEN_ID = 'HLU01']
2019-09-20 17:48:14,627 [1] DEBUG - Statement Id: [DAO00030_Update] PreparedStatement : [update TT_DUOC_CHUNGTU set              NGAYCHUNGTU =  @param0               , LOAICHUNGTU =  @param1               , MUCDICHCHUNGTU_ID =  @param2               , MUCDICHCHUNGTU_CODE =  @param3               , KHOXUAT_ID =  @param4               , NGUOIGIAO_ID =  @param5               , NGUOIGIAO =  @param6               , KHONHAP_ID =  @param7               , NGUOINHAN_ID =  @param8               , NGUOINHAN =  @param9               , NGUOIKIEMTRA_ID =  @param10               , NGUOIKIEMTRA =  @param11               , NGUOIDUYET_ID =  @param12               , NGUOIDUYET =  @param13               , PHUONGPHAPXUAT =  @param14               , KETOANTRUONG_ID =  @param15               , KETOANTRUONG =  @param16               , THUKHO_ID =  @param17               , THUKHO =  @param18               , MAUHOADON =  @param19               , SOHOADON =  @param20               , SOSERI =  @param21               , NGAYHOADON =  @param22               , DIENGIAI =  @param23               , GIATRI =  @param24               , GIATRITHANHTOAN =  @param25               , TYLEVAT =  @param26               , GIATRIVAT =  @param27               , THUESUAT =  @param28               , GIATRITHUE =  @param29               , TYLECHIETKHAU =  @param30               , GIATRICHIETKHAU =  @param31               , TIENTE_ID =  @param32               , TYGIA =  @param33               , SOCHUNGTUGOC =  @param34               , NGAYCHUNGTUGOC =  @param35               , NHACUNGCAP_ID =  @param36               , HINHTHUCTHANHTOAN_ID =  @param37               , NGUONDUOC_ID =  @param38               , CHUNGTULIENQUAN_ID =  @param39               , KHAMBENH_ID =  @param40               , TOATHUOCNOITRU_ID =  @param41               , TIEPNHAN_ID =  @param42               , BENHAN_ID =  @param43               , DANHANTHUOC =  @param44               , NGUOINHAP_ID =  @param45               , NGAYNHAP =  @param46               , TRANGTHAI =  @param47               , PHIEULINH_ID =  @param48               , LOAITOATHUOC =  @param49               , DIENGIAINGHIEPVUPHATSINH =  @param50               , DONVIGIAO_ID =  @param51               , KHOSUDUNG_ID =  @param52               , LOAIVATTU_ID =  @param53               , BENHNHAN_ID =  @param54               , TENBENHNHAN =  @param55               , BACSIGIOITHIEU_ID =  @param56               , DOITUONG_ID =  @param57               , IDCHUYEN =  @param58               , CHUNGTUKETOAN =  @param59               , STATUS =  @param60               , TRANSFER_VIENPHI_ID =  @param61               , PHONGBAN_ID =  @param62               , BACSI_ID =  @param63               , TKNO =  @param64               , TKCO =  @param65               , MACHUNGTUREF =  @param66               , LOAICHUNGTUREF =  @param67               , PHIEULINHCANTRU_ID =  @param68               , KHOTHUCHIEN_ID =  @param69               , KHODOIUNG_ID =  @param70               , MENU_LOAIDUOC_ID =  @param71               , NGUOISUDUNGMAY_ID =  @param72               , GOITHAU_ID =  @param73               , XUATTHUOCBANGOAITRU =  @param74               , NGAYGIOCHUNGTU =  @param75               , NOIDAKHAM =  @param76               , HOIDONGKIEMNHAP_ID =  @param77               , HOIDONGTHANHLY_ID =  @param78               , CHUYENCHUNGTUID =  @param79               , CHUYENDOANHTHUID =  @param80               , LYDOXUATSUDUNG_ID =  @param81                         , NGAYCAPNHAT =  @param82               , NGUOICAPNHAT_ID =  @param83               where              CHUNGTU_ID = '137704']
2019-09-20 17:48:14,627 [1] DEBUG - Statement Id: [DAO00030_Update] Parameters: [@param0=[NGAYCHUNGTU,9/20/2019 5:03:37 PM], @param1=[LOAICHUNGTU,X], @param2=[MUCDICHCHUNGTU_ID,1060], @param3=[MUCDICHCHUNGTU_CODE,X13], @param4=[KHOXUAT_ID,32], @param5=[NGUOIGIAO_ID,0], @param6=[NGUOIGIAO,null], @param7=[KHONHAP_ID,null], @param8=[NGUOINHAN_ID,null], @param9=[NGUOINHAN,null], @param10=[NGUOIKIEMTRA_ID,null], @param11=[NGUOIKIEMTRA,null], @param12=[NGUOIDUYET_ID,null], @param13=[NGUOIDUYET,null], @param14=[PHUONGPHAPXUAT,0], @param15=[KETOANTRUONG_ID,null], @param16=[KETOANTRUONG,null], @param17=[THUKHO_ID,null], @param18=[THUKHO,null], @param19=[MAUHOADON,null], @param20=[SOHOADON,null], @param21=[SOSERI,null], @param22=[NGAYHOADON,null], @param23=[DIENGIAI,null], @param24=[GIATRI,null], @param25=[GIATRITHANHTOAN,null], @param26=[TYLEVAT,5], @param27=[GIATRIVAT,0], @param28=[THUESUAT,null], @param29=[GIATRITHUE,null], @param30=[TYLECHIETKHAU,null], @param31=[GIATRICHIETKHAU,null], @param32=[TIENTE_ID,null], @param33=[TYGIA,null], @param34=[SOCHUNGTUGOC,null], @param35=[NGAYCHUNGTUGOC,null], @param36=[NHACUNGCAP_ID,null], @param37=[HINHTHUCTHANHTOAN_ID,null], @param38=[NGUONDUOC_ID,null], @param39=[CHUNGTULIENQUAN_ID,null], @param40=[KHAMBENH_ID,null], @param41=[TOATHUOCNOITRU_ID,null], @param42=[TIEPNHAN_ID,null], @param43=[BENHAN_ID,null], @param44=[DANHANTHUOC, ], @param45=[NGUOINHAP_ID,null], @param46=[NGAYNHAP,null], @param47=[TRANGTHAI,DAXUAT], @param48=[PHIEULINH_ID,null], @param49=[LOAITOATHUOC,null], @param50=[DIENGIAINGHIEPVUPHATSINH,null], @param51=[DONVIGIAO_ID,null], @param52=[KHOSUDUNG_ID,null], @param53=[LOAIVATTU_ID,null], @param54=[BENHNHAN_ID,null], @param55=[TENBENHNHAN,null], @param56=[BACSIGIOITHIEU_ID,null], @param57=[DOITUONG_ID,null], @param58=[IDCHUYEN,null], @param59=[CHUNGTUKETOAN,null], @param60=[STATUS,null], @param61=[TRANSFER_VIENPHI_ID,null], @param62=[PHONGBAN_ID,62], @param63=[BACSI_ID,null], @param64=[TKNO,null], @param65=[TKCO,null], @param66=[MACHUNGTUREF,null], @param67=[LOAICHUNGTUREF,null], @param68=[PHIEULINHCANTRU_ID,null], @param69=[KHOTHUCHIEN_ID,null], @param70=[KHODOIUNG_ID,null], @param71=[MENU_LOAIDUOC_ID,null], @param72=[NGUOISUDUNGMAY_ID,null], @param73=[GOITHAU_ID,null], @param74=[XUATTHUOCBANGOAITRU,null], @param75=[NGAYGIOCHUNGTU,null], @param76=[NOIDAKHAM,null], @param77=[HOIDONGKIEMNHAP_ID,null], @param78=[HOIDONGTHANHLY_ID,null], @param79=[CHUYENCHUNGTUID,null], @param80=[CHUYENDOANHTHUID,null], @param81=[LYDOXUATSUDUNG_ID,8294], @param82=[NGAYCAPNHAT,9/20/2019 5:48:14 PM], @param83=[NGUOICAPNHAT_ID,0]]
2019-09-20 17:48:14,627 [1] DEBUG - Statement Id: [DAO00030_Update] Types: [@param0=[DateTime, System.DateTime], @param1=[String, System.String], @param2=[Int64, System.Int64], @param3=[String, System.String], @param4=[Int64, System.Int64], @param5=[Int64, System.Int64], @param6=[System.DBNull, null], @param7=[System.DBNull, null], @param8=[System.DBNull, null], @param9=[System.DBNull, null], @param10=[System.DBNull, null], @param11=[System.DBNull, null], @param12=[System.DBNull, null], @param13=[System.DBNull, null], @param14=[Int64, System.Int64], @param15=[System.DBNull, null], @param16=[System.DBNull, null], @param17=[System.DBNull, null], @param18=[System.DBNull, null], @param19=[System.DBNull, null], @param20=[System.DBNull, null], @param21=[System.DBNull, null], @param22=[System.DBNull, null], @param23=[System.DBNull, null], @param24=[System.DBNull, null], @param25=[System.DBNull, null], @param26=[Double, System.Double], @param27=[Double, System.Double], @param28=[System.DBNull, null], @param29=[System.DBNull, null], @param30=[System.DBNull, null], @param31=[System.DBNull, null], @param32=[System.DBNull, null], @param33=[System.DBNull, null], @param34=[System.DBNull, null], @param35=[System.DBNull, null], @param36=[System.DBNull, null], @param37=[System.DBNull, null], @param38=[System.DBNull, null], @param39=[System.DBNull, null], @param40=[System.DBNull, null], @param41=[System.DBNull, null], @param42=[System.DBNull, null], @param43=[System.DBNull, null], @param44=[String, System.String], @param45=[System.DBNull, null], @param46=[System.DBNull, null], @param47=[String, System.String], @param48=[System.DBNull, null], @param49=[System.DBNull, null], @param50=[System.DBNull, null], @param51=[System.DBNull, null], @param52=[System.DBNull, null], @param53=[System.DBNull, null], @param54=[System.DBNull, null], @param55=[System.DBNull, null], @param56=[System.DBNull, null], @param57=[System.DBNull, null], @param58=[System.DBNull, null], @param59=[System.DBNull, null], @param60=[System.DBNull, null], @param61=[System.DBNull, null], @param62=[Int64, System.Int64], @param63=[System.DBNull, null], @param64=[System.DBNull, null], @param65=[System.DBNull, null], @param66=[System.DBNull, null], @param67=[System.DBNull, null], @param68=[System.DBNull, null], @param69=[System.DBNull, null], @param70=[System.DBNull, null], @param71=[System.DBNull, null], @param72=[System.DBNull, null], @param73=[System.DBNull, null], @param74=[System.DBNull, null], @param75=[System.DBNull, null], @param76=[System.DBNull, null], @param77=[System.DBNull, null], @param78=[System.DBNull, null], @param79=[System.DBNull, null], @param80=[System.DBNull, null], @param81=[Int64, System.Int64], @param82=[DateTime, System.DateTime], @param83=[Int64, System.Int64]]
2019-09-20 17:48:14,696 [1] DEBUG - Statement Id: [DAO00030_CHUNGTUCT_DeleteP] PreparedStatement : [delete from TT_DUOC_CHUNGTU_CHITIET               where                             TT_DUOC_CHUNGTU_CHITIET.CHUNGTU_ID = '137704']
2019-09-20 17:48:14,733 [1] DEBUG - Statement Id: [DAO00030_TT_DUOC_TONKHO_LOG_Add] PreparedStatement : [DECLARE @KHODUOC_ID int               DECLARE @TONTRUOC numeric(18, 4)               DECLARE @TONSAU numeric(18, 4)               DECLARE @SOLUONGNHAP numeric(18, 4)               DECLARE @SOLUONGXUAT numeric(18, 4)                              IF( @param0  = 'N')               BEGIN                SET @KHODUOC_ID =  @param1                END               ELSE               BEGIN                 SET @KHODUOC_ID =  @param2                END                              SELECT @TONTRUOC = SOLUONG FROM TT_DUOC_TONKHO WHERE KHODUOC_ID = @KHODUOC_ID  AND DUOC_ID =  @param3  AND SOLONHAP_ID =  @param4  AND NGUONDUOC_ID =  @param5                               IF( @param0  = 'N' AND  @param6  = 'ADD')               BEGIN                SET @TONSAU = ISNULL(@TONTRUOC,0) +  @param7                 SET @SOLUONGNHAP =  @param7                 SET @SOLUONGXUAT = 0               END               IF( @param0  = 'N' AND  @param6  = 'DEL')               BEGIN                SET @TONSAU = ISNULL(@TONTRUOC,0) -  @param7                 SET @SOLUONGXUAT =  @param7                 SET @SOLUONGNHAP = 0               END                                         IF( @param0  = 'X' AND  @param6  = 'ADD')               BEGIN                SET @TONSAU = ISNULL(@TONTRUOC,0) -  @param8                 SET @SOLUONGXUAT =  @param8                 SET @SOLUONGNHAP = 0               END               IF( @param0  = 'X' AND  @param6  = 'DEL')               BEGIN                SET @TONSAU = ISNULL(@TONTRUOC,0) +  @param8                 SET @SOLUONGNHAP =  @param8                 SET @SOLUONGXUAT = 0                             END                        insert into TT_DUOC_TONKHO_LOG (                           CHUNGTUCHITIET_ID              ,CHUNGTU_ID              ,MACHUNGTU              ,LOAICHUNGTU              ,MUCDICHCHUNGTU_CODE              ,KHONHAP_ID              ,KHOXUAT_ID              ,DUOC_ID              ,SOLONHAP_ID              ,NGUONDUOC_ID              ,SOLUONGNHAP              ,SOLUONGXUAT              ,DONGIAMUA              ,DONGIAVON              ,TYLE_VAT              ,DONGIAVONVAT              ,TONTRUOC              ,TONSAU              ,ACTION              ,BENHVIEN_ID              ,NGAYTAO              ,NGUOITAO_ID                          ) values (              @param9               , @param10               , @param11               , @param0               , @param12               , @param1               , @param2               , @param3               , @param4               , @param5               ,@SOLUONGNHAP              ,@SOLUONGXUAT              , @param13               , @param14               , @param15               , @param16               ,@TONTRUOC              ,@TONSAU              , @param6               , @param17               , @param18               , @param19               )]
2019-09-20 17:48:14,734 [1] DEBUG - Statement Id: [DAO00030_TT_DUOC_TONKHO_LOG_Add] Parameters: [@param0=[LOAICHUNGTU,X], @param1=[KHONHAP_ID,null], @param2=[KHOXUAT_ID,32], @param3=[DUOC_ID,1], @param4=[SOLONHAP_ID,7541], @param5=[NGUONDUOC_ID,1], @param6=[ACTION,DEL], @param7=[SOLUONGNHAP,0], @param8=[SOLUONGXUAT,2], @param9=[CHUNGTUCHITIET_ID,1299051], @param10=[CHUNGTU_ID,137704], @param11=[MACHUNGTU,CS_KBX1319003092], @param12=[MUCDICHCHUNGTU_CODE,X13], @param13=[DONGIAMUA,945], @param14=[DONGIAVON,945], @param15=[TYLE_VAT,0], @param16=[DONGIAVONVAT,945], @param17=[BENHVIEN_ID,HLU01], @param18=[NGAYTAO,9/20/2019 5:48:14 PM], @param19=[NGUOITAO_ID,0]]
2019-09-20 17:48:14,734 [1] DEBUG - Statement Id: [DAO00030_TT_DUOC_TONKHO_LOG_Add] Types: [@param0=[String, System.String], @param1=[System.DBNull, null], @param2=[Int64, System.Int64], @param3=[Int64, System.Int64], @param4=[Int64, System.Int64], @param5=[Int64, System.Int64], @param6=[String, System.String], @param7=[Decimal, System.Decimal], @param8=[Decimal, System.Decimal], @param9=[Int64, System.Int64], @param10=[Int64, System.Int64], @param11=[String, System.String], @param12=[String, System.String], @param13=[Decimal, System.Decimal], @param14=[Decimal, System.Decimal], @param15=[Double, System.Double], @param16=[Double, System.Double], @param17=[String, System.String], @param18=[DateTime, System.DateTime], @param19=[Int64, System.Int64]]
2019-09-20 17:48:14,767 [1] DEBUG - Statement Id: [DAO00030_DUOC_TONKHO_BOOKING_NGOAITRU_Tang] PreparedStatement : [update TT_DUOC_TONKHO_BOOK_NGOAITRU            set            SOLUONG = SOLUONG +  @param0             , NGUOICAPNHAT_ID =  @param1             , NGAYCAPNHAT = getdate()            where            REF_TABLE =  @param2             AND REF_ID =  @param3             AND KHODUOC_ID =  @param4             AND DUOC_ID =  @param5             AND SOLUONG = 0            AND BENHVIEN_ID = 'HLU01']
2019-09-20 17:48:14,767 [1] DEBUG - Statement Id: [DAO00030_DUOC_TONKHO_BOOKING_NGOAITRU_Tang] Parameters: [@param0=[SOLUONGTHAYDOI,2], @param1=[NGUOICAPNHAT_ID,0], @param2=[REF_TABLE,TT_NGOAITRU_KHAMBENH_VTYT], @param3=[REF_ID,10593], @param4=[KHODUOC_ID,32], @param5=[DUOC_ID,1]]
2019-09-20 17:48:14,767 [1] DEBUG - Statement Id: [DAO00030_DUOC_TONKHO_BOOKING_NGOAITRU_Tang] Types: [@param0=[Double, System.Double], @param1=[Int64, System.Int64], @param2=[String, System.String], @param3=[Int64, System.Int64], @param4=[Int64, System.Int64], @param5=[Int64, System.Int64]]
2019-09-20 17:48:14,832 [1] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoVaBookingCOM23UpdateRedis] PreparedStatement : [declare @NGUONDUOC_MACDINH varchar(5) = '0';        declare @TOAMUANGOAI int = 0;        select @NGUONDUOC_MACDINH = isnull(VALUE,0) from TM_SYS_APPSETTINGS where CODE = 'PHA_NGUONDUOC'        select @TOAMUANGOAI = isnull(VALUE,0) from TM_SYS_APPSETTINGS where CODE = 'OPD_TOAMUANGOAI_DUNGDANHMUC_DUOC'                if @TOAMUANGOAI = 1        begin        select  distinct '0' + '_' + LTRIM(d.DUOC_ID) + '_' + @NGUONDUOC_MACDINH as DUOC_KEY, 0 as PHAMVI_ID, @NGUONDUOC_MACDINH as NGUONDUOC_ID, null as TENNGUONDUOC, null as TINHTIEN, d.DUOC_ID, ld.MALOAIDUOC,        d.SOVISA,d.TYLE_VAT,d.COTOA, d.MADUOC, d.TENHANG, d.TENDUOCDAYDU, dvt.TENDONVITINH as DONVITINH, d.BHYT,        d.TENHOATCHAT, d.HAMLUONG, d.HANGSANXUAT, d.QUOCGIA, d.LOAIDUOC_ID, d.DUONGDUNG_ID, d.TINHTIEN_PTTT,        ten.TENDUOC, ten.TENDUOC_EN, ten.MAQUOCTE, ten.MAQUOCTEBT,        '' as BHYT_TEXT        , ld.LOAIVATTU_ID        , d.BENHVIEN_ID,        999999999 as SOLUONG, d.VTYT_PHANLOAI, d.PHAMVI, d.SUASOLUONGTONGHOP, d.MADUOCBV, d.DANGTRINHBAY        , TAMNGUNG = CASE WHEN d.TAMNGUNG = '1' THEN '1' ELSE '0' END        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        where d.DUOC_ID in (1)        union all        select  distinct tk.DUOC_KEY, LTRIM(tk.PHAMVI_ID) as PHAMVI_ID, tk.NGUONDUOC_ID, nh.TENNGUONDUOC, nh.TINHTIEN, d.DUOC_ID, ld.MALOAIDUOC,        d.SOVISA,d.TYLE_VAT,d.COTOA, d.MADUOC, d.TENHANG, d.TENDUOCDAYDU, dvt.TENDONVITINH as DONVITINH, d.BHYT,        d.TENHOATCHAT, d.HAMLUONG, d.HANGSANXUAT, d.QUOCGIA, d.LOAIDUOC_ID, d.DUONGDUNG_ID, d.TINHTIEN_PTTT,        ten.TENDUOC, ten.TENDUOC_EN, ten.MAQUOCTE, ten.MAQUOCTEBT,        CASE WHEN d.BHYT = '1' THEN 'BHYT' ELSE '' END as BHYT_TEXT        , ld.LOAIVATTU_ID        , d.BENHVIEN_ID,        tk.SOLUONG, d.VTYT_PHANLOAI, d.PHAMVI, d.SUASOLUONGTONGHOP, d.MADUOCBV, d.DANGTRINHBAY        , TAMNGUNG = CASE WHEN d.TAMNGUNG = '1' OR nh.TAMNGUNG = '1' OR kd.TAMNGUNG = '1' THEN '1' ELSE '0' END        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        inner join        (        select  LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')) DUOC_KEY, (SUM(dtk.SOLUONG) - isnull(sum(A.SOLUONG),0) - isnull(sum(B.SOLUONG),0)) SOLUONG, pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        from (select sum(soluong) soluong,duoc_id,nguonduoc_id,khoduoc_id,benhvien_id from TT_DUOC_TONKHO  group by duoc_id,nguonduoc_id,khoduoc_id,benhvien_id) dtk        inner join TM_DUOC_PHAMVISD_MAPPING pvsd on dtk.KHODUOC_ID = pvsd.KHODUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NOITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) B on B.DUOC_ID = dtk.DUOC_ID and B.SOLUONG > 0 and B.PHAMVI_ID = pvsd.PHAMVI_ID and B.NGUONHANG_ID = dtk.NGUONDUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NGOAITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) A on A.DUOC_ID = dtk.DUOC_ID and A.SOLUONG > 0 and A.PHAMVI_ID = pvsd.PHAMVI_ID and A.NGUONHANG_ID = dtk.NGUONDUOC_ID        where dtk.SOLUONG > 0 and dtk.BENHVIEN_ID = 'HLU01'        group by LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')), pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        ) tk on tk.DUOC_ID = d.DUOC_ID        left join TM_DUOC_PHAMVISUDUNG kd on kd.PHAMVI_ID = tk.PHAMVI_ID and kd.BENHVIEN_ID = 'HLU01'        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = tk.NGUONDUOC_ID and nh.BENHVIEN_ID = 'HLU01'        where  d.BENHVIEN_ID = 'HLU01' and d.DUOC_ID in (1)        end        else        begin        select  distinct tk.DUOC_KEY, LTRIM(tk.PHAMVI_ID) as PHAMVI_ID, tk.NGUONDUOC_ID, nh.TENNGUONDUOC, nh.TINHTIEN, d.DUOC_ID, ld.MALOAIDUOC,        d.SOVISA,d.TYLE_VAT,d.COTOA, d.MADUOC, d.TENHANG, d.TENDUOCDAYDU, dvt.TENDONVITINH as DONVITINH, d.BHYT,        d.TENHOATCHAT, d.HAMLUONG, d.HANGSANXUAT, d.QUOCGIA, d.LOAIDUOC_ID, d.DUONGDUNG_ID, d.TINHTIEN_PTTT,        ten.TENDUOC, ten.TENDUOC_EN, ten.MAQUOCTE, ten.MAQUOCTEBT,        CASE WHEN d.BHYT = '1' THEN 'BHYT' ELSE '' END as BHYT_TEXT        , ld.LOAIVATTU_ID        , d.BENHVIEN_ID,        tk.SOLUONG, d.VTYT_PHANLOAI, d.PHAMVI, d.SUASOLUONGTONGHOP, d.MADUOCBV, d.DANGTRINHBAY        , TAMNGUNG = CASE WHEN d.TAMNGUNG = '1' OR nh.TAMNGUNG = '1' OR kd.TAMNGUNG = '1' THEN '1' ELSE '0' END        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        inner join        (        select  LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')) DUOC_KEY, (SUM(dtk.SOLUONG) - isnull(sum(A.SOLUONG),0) - isnull(sum(B.SOLUONG),0)) SOLUONG, pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        from (select sum(soluong) soluong,duoc_id,nguonduoc_id,khoduoc_id,benhvien_id from TT_DUOC_TONKHO  group by duoc_id,nguonduoc_id,khoduoc_id,benhvien_id) dtk        inner join TM_DUOC_PHAMVISD_MAPPING pvsd on dtk.KHODUOC_ID = pvsd.KHODUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NOITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) B on B.DUOC_ID = dtk.DUOC_ID and B.SOLUONG > 0 and B.PHAMVI_ID = pvsd.PHAMVI_ID and B.NGUONHANG_ID = dtk.NGUONDUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NGOAITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) A on A.DUOC_ID = dtk.DUOC_ID and A.SOLUONG > 0 and A.PHAMVI_ID = pvsd.PHAMVI_ID and A.NGUONHANG_ID = dtk.NGUONDUOC_ID        where dtk.SOLUONG > 0 and dtk.BENHVIEN_ID = 'HLU01'        group by LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')), pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        ) tk on tk.DUOC_ID = d.DUOC_ID        left join TM_DUOC_PHAMVISUDUNG kd on kd.PHAMVI_ID = tk.PHAMVI_ID and kd.BENHVIEN_ID = 'HLU01'        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = tk.NGUONDUOC_ID and nh.BENHVIEN_ID = 'HLU01'        where  d.BENHVIEN_ID = 'HLU01' and d.DUOC_ID in (1)        end]
2019-09-20 17:48:15,094 [1] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoCOM18UpdateRedis] PreparedStatement : [select distinct TT_TONKHO.DUOC_KEY, LTRIM(TT_TONKHO.KHODUOC_ID) as KHODUOC_ID, TM_DUOC.DUOC_ID, TM_LOAIDUOC.MALOAIDUOC,TM_DUOC.SOVISA,TM_DUOC.TYLE_VAT,TM_DUOC.COTOA,        TM_DUOC.MADUOC, TM_DUOC.TENHANG, TM_DUOC.TENDUOCDAYDU, dvt.TENDONVITINH as DONVITINH,  TM_DUOC.DONVITINH_ID,TM_DUOC.BHYT,        TM_DUOC.TENHOATCHAT,        TM_DUOC.HAMLUONG, TM_DUOC.HANGSANXUAT, TM_DUOC.QUOCGIA, TM_DUOC.LOAIDUOC_ID, TM_DUOC.DUONGDUNG_ID,        TM_TENDUOC.TENDUOC, TM_TENDUOC.TENDUOC_EN, TM_TENDUOC.MAQUOCTE, TM_TENDUOC.MAQUOCTEBT,        TM_LOAIDUOC.LOAIVATTU_ID, TM_DUOC.BENHVIEN_ID,        TT_TONKHO.SOLUONG, TM_DUOC.VTYT_PHANLOAI, TM_DUOC.PHAMVI, TT_TONKHO.NGUONDUOC_ID, NG.TENNGUONDUOC AS TENNGUONDUOC        , TAMNGUNG = CASE WHEN TM_DUOC.TAMNGUNG = '1' OR NG.TAMNGUNG = '1' OR KD.TAMNGUNG = '1' THEN '1' ELSE '0' END        , TM_DUOC.DANGTRINHBAY        from TM_DUOC        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = TM_DUOC.DONVITINH_ID        left join TM_TENDUOC on TM_DUOC.TENDUOC_ID = TM_TENDUOC.TENDUOC_ID and TM_DUOC.BENHVIEN_ID = 'HLU01' and TM_DUOC.TAMNGUNG = '0'        left join TM_LOAIDUOC on TM_LOAIDUOC.LOAIDUOC_ID = TM_DUOC.LOAIDUOC_ID and TM_LOAIDUOC.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG on (TM_LOAIDUOC.LOAIVATTU_ID = TM_DUOC_HANDUNG.LOAIDUOC and TM_DUOC_HANDUNG.BENHVIEN_ID = 'HLU01')        inner join        (select LTRIM(A.KHODUOC_ID) + '_' + LTRIM(A.DUOC_ID) + '_' + LTRIM(ISNULL(A.NGUONDUOC_ID,'')) as DUOC_KEY, A.KHODUOC_ID, A.DUOC_ID, A.NGUONDUOC_ID,        SUM(isnull(A.SOLUONG,0)) as SOLUONG        from        (select SUM(SOLUONG) as SOLUONG, KHODUOC_ID, DUOC_ID, NGUONDUOC_ID from TT_DUOC_TONKHO        where BENHVIEN_ID = 'HLU01' group by KHODUOC_ID, DUOC_ID, NGUONDUOC_ID) A        group by LTRIM(A.KHODUOC_ID) + '_' + LTRIM(A.DUOC_ID) + '_' + LTRIM(ISNULL(A.NGUONDUOC_ID,'')), A.KHODUOC_ID, A.DUOC_ID, NGUONDUOC_ID        ) TT_TONKHO on TT_TONKHO.DUOC_ID = TM_DUOC.DUOC_ID        LEFT JOIN TM_NGUONHANG NG ON NG.NGUONDUOC_ID = TT_TONKHO.NGUONDUOC_ID        LEFT JOIN TM_KHODUOC KD ON KD.KHODUOC_ID = TT_TONKHO.KHODUOC_ID        where TM_DUOC.BENHVIEN_ID = 'HLU01' and TT_TONKHO.SOLUONG >= 0        and TM_DUOC.DUOC_ID in (1)]
2019-09-20 17:48:15,202 [1] DEBUG - Statement Id: [DAO00030_DUOCTONKHO_Tang] PreparedStatement : [IF EXISTS            (              SELECT DUOCTONKHO_ID              FROM TT_DUOC_TONKHO              WHERE              KHODUOC_ID =  @param0               AND DUOC_ID =  @param1               AND  SOLONHAP_ID =  @param2             )            BEGIN              update TT_DUOC_TONKHO set              SOLUONG = SOLUONG +   @param3               , NGAYCAPNHAT =  @param4               , NGUOICAPNHAT_ID =  @param5               where              KHODUOC_ID =  @param0               AND DUOC_ID =  @param1               AND  SOLONHAP_ID =  @param2             END            ELSE            BEGIN              insert into TT_DUOC_TONKHO (              KHODUOC_ID              , DUOC_ID              , NGUONDUOC_ID              , SOLONHAP_ID              , DONGIAMUA              , SOLUONG              , BENHVIEN_ID              , NGAYTAO              , NGUOITAO_ID                     ) values (               @param0               ,  @param1               ,  @param6               ,  @param2               ,  @param7               ,  @param3               ,  @param8               ,  @param9               ,  @param10                        )            END]
2019-09-20 17:48:15,203 [1] DEBUG - Statement Id: [DAO00030_DUOCTONKHO_Tang] Parameters: [@param0=[KHODUOC_ID,32], @param1=[DUOC_ID,1], @param2=[SOLONHAP_ID,7541], @param3=[SOLUONGTHAYDOI,2], @param4=[NGAYCAPNHAT,9/20/2019 5:48:15 PM], @param5=[NGUOICAPNHAT_ID,0], @param6=[NGUONDUOC_ID,1], @param7=[DONGIAMUA,945], @param8=[BENHVIEN_ID,HLU01], @param9=[NGAYTAO,9/20/2019 5:03:37 PM], @param10=[NGUOITAO_ID,0]]
2019-09-20 17:48:15,203 [1] DEBUG - Statement Id: [DAO00030_DUOCTONKHO_Tang] Types: [@param0=[Int64, System.Int64], @param1=[Int64, System.Int64], @param2=[Int64, System.Int64], @param3=[Double, System.Double], @param4=[DateTime, System.DateTime], @param5=[Int64, System.Int64], @param6=[Int64, System.Int64], @param7=[Double, System.Double], @param8=[String, System.String], @param9=[DateTime, System.DateTime], @param10=[Int64, System.Int64]]
2019-09-20 17:48:15,239 [1] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoCOM18] PreparedStatement : [select  distinct TT_TONKHO.DUOC_KEY, LTRIM(TT_TONKHO.KHODUOC_ID) as KHODUOC_ID, TM_DUOC.DUOC_ID, TM_LOAIDUOC.MALOAIDUOC,TM_DUOC.SOVISA,TM_DUOC.TYLE_VAT,TM_DUOC.COTOA,        TM_DUOC.MADUOC, TM_DUOC.TENHANG, TM_DUOC.TENDUOCDAYDU, dvt.TENDONVITINH as DONVITINH, TM_DUOC.DONVITINH_ID, TM_DUOC.BHYT,        TM_DUOC.TENHOATCHAT, TM_DUOC.HAMLUONG, TM_DUOC.HANGSANXUAT, TM_DUOC.QUOCGIA, TM_DUOC.LOAIDUOC_ID, TM_DUOC.DUONGDUNG_ID,        TM_TENDUOC.TENDUOC, TM_TENDUOC.TENDUOC_EN, TM_TENDUOC.MAQUOCTE, TM_TENDUOC.MAQUOCTEBT,        TM_LOAIDUOC.LOAIVATTU_ID, TM_DUOC.BENHVIEN_ID,        TT_TONKHO.SOLUONG, TM_DUOC.VTYT_PHANLOAI, TM_DUOC.PHAMVI, TT_TONKHO.NGUONDUOC_ID, NG.TENNGUONDUOC        , TAMNGUNG = CASE WHEN TM_DUOC.TAMNGUNG = '1' OR NG.TAMNGUNG = '1' OR KD.TAMNGUNG = '1' THEN '1' ELSE '0' END        , TM_DUOC.DANGTRINHBAY        from TM_DUOC        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = TM_DUOC.DONVITINH_ID        left join TM_TENDUOC on TM_DUOC.TENDUOC_ID = TM_TENDUOC.TENDUOC_ID and TM_DUOC.BENHVIEN_ID = 'HLU01'  and TM_DUOC.TAMNGUNG = '0'        left join TM_LOAIDUOC on TM_LOAIDUOC.LOAIDUOC_ID = TM_DUOC.LOAIDUOC_ID and TM_LOAIDUOC.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG on (TM_LOAIDUOC.LOAIVATTU_ID = TM_DUOC_HANDUNG.LOAIDUOC and TM_DUOC_HANDUNG.BENHVIEN_ID = 'HLU01')        inner join        (select LTRIM(A.KHODUOC_ID) + '_' + LTRIM(A.DUOC_ID) + '_' + LTRIM(ISNULL(A.NGUONDUOC_ID,'')) as DUOC_KEY, A.KHODUOC_ID, A.DUOC_ID ,a.NGUONDUOC_ID,        SUM(isnull(A.SOLUONG,0)) as SOLUONG        from        (select SUM(SOLUONG) as SOLUONG, KHODUOC_ID, DUOC_ID, NGUONDUOC_ID from TT_DUOC_TONKHO        where KHODUOC_ID in (32) and DUOC_ID in (1) group by KHODUOC_ID, DUOC_ID, NGUONDUOC_ID        ) A        where A.KHODUOC_ID in (32) and A.DUOC_ID in (1)        group by LTRIM(A.KHODUOC_ID) + '_' + LTRIM(A.DUOC_ID) + '_' + LTRIM(A.NGUONDUOC_ID), A.KHODUOC_ID, A.DUOC_ID, A.NGUONDUOC_ID)        TT_TONKHO on TT_TONKHO.DUOC_ID = TM_DUOC.DUOC_ID        LEFT JOIN TM_NGUONHANG NG ON NG.NGUONDUOC_ID = TT_TONKHO.NGUONDUOC_ID        LEFT JOIN TM_KHODUOC KD ON KD.KHODUOC_ID = TT_TONKHO.KHODUOC_ID        where TM_DUOC.BENHVIEN_ID = 'HLU01' and TM_DUOC.DUOC_ID in (1)]
2019-09-20 17:48:15,274 [1] DEBUG - Statement Id: [DAO00030_GetListPhamViByKhoDuoc] PreparedStatement : [SELECT DISTINCT PHAMVI_ID          FROM TM_DUOC_PHAMVISD_MAPPING          WHERE          KHODUOC_ID IN (32)          AND BENHVIEN_ID ='HLU01'          AND TAMNGUNG = '0']
2019-09-20 17:48:15,305 [1] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoVaBookingCOM23] PreparedStatement : [declare @NGUONDUOC_MACDINH varchar(5) = '0';        declare @TOAMUANGOAI int = 0;        select @NGUONDUOC_MACDINH = isnull(VALUE,0) from TM_SYS_APPSETTINGS where CODE = 'PHA_NGUONDUOC'        select @TOAMUANGOAI = isnull(VALUE,0) from TM_SYS_APPSETTINGS where CODE = 'OPD_TOAMUANGOAI_DUNGDANHMUC_DUOC'                if @TOAMUANGOAI = 1        begin        select  distinct '0' + '_' + LTRIM(d.DUOC_ID) + '_' + @NGUONDUOC_MACDINH as DUOC_KEY, 0 as PHAMVI_ID, @NGUONDUOC_MACDINH as NGUONDUOC_ID, null as TENNGUONDUOC, null as TINHTIEN, d.DUOC_ID, ld.MALOAIDUOC,        d.SOVISA,d.TYLE_VAT,d.COTOA, d.MADUOC, d.TENHANG, d.TENDUOCDAYDU, dvt.TENDONVITINH as DONVITINH, d.BHYT,        d.TENHOATCHAT, d.HAMLUONG, d.HANGSANXUAT, d.QUOCGIA, d.LOAIDUOC_ID, d.DUONGDUNG_ID, d.TINHTIEN_PTTT,        ten.TENDUOC, ten.TENDUOC_EN, ten.MAQUOCTE, ten.MAQUOCTEBT,        '' as BHYT_TEXT        , ld.LOAIVATTU_ID        , d.BENHVIEN_ID,        999999999 as SOLUONG, d.VTYT_PHANLOAI, d.PHAMVI, d.SUASOLUONGTONGHOP, d.MADUOCBV, d.DANGTRINHBAY        , TAMNGUNG = CASE WHEN d.TAMNGUNG = '1' THEN '1' ELSE '0' END        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        where d.DUOC_ID in (1)        union all        select  distinct tk.DUOC_KEY, LTRIM(tk.PHAMVI_ID) as PHAMVI_ID, tk.NGUONDUOC_ID, nh.TENNGUONDUOC, nh.TINHTIEN, d.DUOC_ID, ld.MALOAIDUOC,        d.SOVISA,d.TYLE_VAT,d.COTOA, d.MADUOC, d.TENHANG, d.TENDUOCDAYDU, dvt.TENDONVITINH as DONVITINH, d.BHYT,        d.TENHOATCHAT, d.HAMLUONG, d.HANGSANXUAT, d.QUOCGIA, d.LOAIDUOC_ID, d.DUONGDUNG_ID, d.TINHTIEN_PTTT,        ten.TENDUOC, ten.TENDUOC_EN, ten.MAQUOCTE, ten.MAQUOCTEBT,        CASE WHEN d.BHYT = '1' THEN 'BHYT' ELSE '' END as BHYT_TEXT        , ld.LOAIVATTU_ID        , d.BENHVIEN_ID,        tk.SOLUONG, d.VTYT_PHANLOAI, d.PHAMVI, d.SUASOLUONGTONGHOP, d.MADUOCBV, d.DANGTRINHBAY        , TAMNGUNG = CASE WHEN d.TAMNGUNG = '1' OR nh.TAMNGUNG = '1' OR kd.TAMNGUNG = '1' THEN '1' ELSE '0' END        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        inner join        (        select  LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')) DUOC_KEY, (SUM(dtk.SOLUONG) - isnull(sum(A.SOLUONG),0) - isnull(sum(B.SOLUONG),0)) SOLUONG, pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        from (select sum(soluong) soluong,duoc_id,nguonduoc_id,khoduoc_id,benhvien_id from TT_DUOC_TONKHO  group by duoc_id,nguonduoc_id,khoduoc_id,benhvien_id) dtk        inner join TM_DUOC_PHAMVISD_MAPPING pvsd on dtk.KHODUOC_ID = pvsd.KHODUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NOITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) B on B.DUOC_ID = dtk.DUOC_ID and B.SOLUONG > 0 and B.PHAMVI_ID = pvsd.PHAMVI_ID and B.NGUONHANG_ID = dtk.NGUONDUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NGOAITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) A on A.DUOC_ID = dtk.DUOC_ID and A.SOLUONG > 0 and A.PHAMVI_ID = pvsd.PHAMVI_ID and A.NGUONHANG_ID = dtk.NGUONDUOC_ID        where dtk.SOLUONG > 0 and dtk.BENHVIEN_ID = 'HLU01'        group by LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')), pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        ) tk on tk.DUOC_ID = d.DUOC_ID        left join TM_DUOC_PHAMVISUDUNG kd on kd.PHAMVI_ID = tk.PHAMVI_ID and kd.BENHVIEN_ID = 'HLU01'        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = tk.NGUONDUOC_ID and nh.BENHVIEN_ID = 'HLU01'        where  d.BENHVIEN_ID = 'HLU01' and d.DUOC_ID in (1) and TK.PHAMVI_ID in (1055)        and tk.NGUONDUOC_ID in (1)         end        else        begin                select  distinct tk.DUOC_KEY, LTRIM(tk.PHAMVI_ID) as PHAMVI_ID, tk.NGUONDUOC_ID, nh.TENNGUONDUOC, nh.TINHTIEN, d.DUOC_ID, ld.MALOAIDUOC,        d.SOVISA,d.TYLE_VAT,d.COTOA, d.MADUOC, d.TENHANG, d.TENDUOCDAYDU, dvt.TENDONVITINH as DONVITINH, d.BHYT,        d.TENHOATCHAT, d.HAMLUONG, d.HANGSANXUAT, d.QUOCGIA, d.LOAIDUOC_ID, d.DUONGDUNG_ID, d.TINHTIEN_PTTT,        ten.TENDUOC, ten.TENDUOC_EN, ten.MAQUOCTE, ten.MAQUOCTEBT,        CASE WHEN d.BHYT = '1' THEN 'BHYT' ELSE '' END as BHYT_TEXT        , ld.LOAIVATTU_ID        , d.BENHVIEN_ID,        tk.SOLUONG, d.VTYT_PHANLOAI, d.PHAMVI, d.SUASOLUONGTONGHOP, d.MADUOCBV, d.DANGTRINHBAY        , TAMNGUNG = CASE WHEN d.TAMNGUNG = '1' OR nh.TAMNGUNG = '1' OR kd.TAMNGUNG = '1' THEN '1' ELSE '0' END        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        inner join        (        select  LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')) DUOC_KEY, (SUM(dtk.SOLUONG) - isnull(sum(A.SOLUONG),0) - isnull(sum(B.SOLUONG),0)) SOLUONG, pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        from (select sum(soluong) soluong,duoc_id,nguonduoc_id,khoduoc_id,benhvien_id from TT_DUOC_TONKHO  group by duoc_id,nguonduoc_id,khoduoc_id,benhvien_id) dtk        inner join TM_DUOC_PHAMVISD_MAPPING pvsd on dtk.KHODUOC_ID = pvsd.KHODUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NOITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) B on B.DUOC_ID = dtk.DUOC_ID and B.SOLUONG > 0 and B.PHAMVI_ID = pvsd.PHAMVI_ID and B.NGUONHANG_ID = dtk.NGUONDUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NGOAITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) A on A.DUOC_ID = dtk.DUOC_ID and A.SOLUONG > 0 and A.PHAMVI_ID = pvsd.PHAMVI_ID and A.NGUONHANG_ID = dtk.NGUONDUOC_ID        where dtk.SOLUONG > 0 and dtk.BENHVIEN_ID = 'HLU01'        group by LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')), pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        ) tk on tk.DUOC_ID = d.DUOC_ID        left join TM_DUOC_PHAMVISUDUNG kd on kd.PHAMVI_ID = tk.PHAMVI_ID and kd.BENHVIEN_ID = 'HLU01'        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = tk.NGUONDUOC_ID and nh.BENHVIEN_ID = 'HLU01'        where  d.BENHVIEN_ID = 'HLU01' and d.DUOC_ID in (1) and TK.PHAMVI_ID in (1055)        and tk.NGUONDUOC_ID in (1)         end]
2019-09-20 17:48:15,509 [1] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoCOM18UpdateRedis] PreparedStatement : [select distinct TT_TONKHO.DUOC_KEY, LTRIM(TT_TONKHO.KHODUOC_ID) as KHODUOC_ID, TM_DUOC.DUOC_ID, TM_LOAIDUOC.MALOAIDUOC,TM_DUOC.SOVISA,TM_DUOC.TYLE_VAT,TM_DUOC.COTOA,        TM_DUOC.MADUOC, TM_DUOC.TENHANG, TM_DUOC.TENDUOCDAYDU, dvt.TENDONVITINH as DONVITINH,  TM_DUOC.DONVITINH_ID,TM_DUOC.BHYT,        TM_DUOC.TENHOATCHAT,        TM_DUOC.HAMLUONG, TM_DUOC.HANGSANXUAT, TM_DUOC.QUOCGIA, TM_DUOC.LOAIDUOC_ID, TM_DUOC.DUONGDUNG_ID,        TM_TENDUOC.TENDUOC, TM_TENDUOC.TENDUOC_EN, TM_TENDUOC.MAQUOCTE, TM_TENDUOC.MAQUOCTEBT,        TM_LOAIDUOC.LOAIVATTU_ID, TM_DUOC.BENHVIEN_ID,        TT_TONKHO.SOLUONG, TM_DUOC.VTYT_PHANLOAI, TM_DUOC.PHAMVI, TT_TONKHO.NGUONDUOC_ID, NG.TENNGUONDUOC AS TENNGUONDUOC        , TAMNGUNG = CASE WHEN TM_DUOC.TAMNGUNG = '1' OR NG.TAMNGUNG = '1' OR KD.TAMNGUNG = '1' THEN '1' ELSE '0' END        , TM_DUOC.DANGTRINHBAY        from TM_DUOC        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = TM_DUOC.DONVITINH_ID        left join TM_TENDUOC on TM_DUOC.TENDUOC_ID = TM_TENDUOC.TENDUOC_ID and TM_DUOC.BENHVIEN_ID = 'HLU01' and TM_DUOC.TAMNGUNG = '0'        left join TM_LOAIDUOC on TM_LOAIDUOC.LOAIDUOC_ID = TM_DUOC.LOAIDUOC_ID and TM_LOAIDUOC.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG on (TM_LOAIDUOC.LOAIVATTU_ID = TM_DUOC_HANDUNG.LOAIDUOC and TM_DUOC_HANDUNG.BENHVIEN_ID = 'HLU01')        inner join        (select LTRIM(A.KHODUOC_ID) + '_' + LTRIM(A.DUOC_ID) + '_' + LTRIM(ISNULL(A.NGUONDUOC_ID,'')) as DUOC_KEY, A.KHODUOC_ID, A.DUOC_ID, A.NGUONDUOC_ID,        SUM(isnull(A.SOLUONG,0)) as SOLUONG        from        (select SUM(SOLUONG) as SOLUONG, KHODUOC_ID, DUOC_ID, NGUONDUOC_ID from TT_DUOC_TONKHO        where BENHVIEN_ID = 'HLU01' group by KHODUOC_ID, DUOC_ID, NGUONDUOC_ID) A        group by LTRIM(A.KHODUOC_ID) + '_' + LTRIM(A.DUOC_ID) + '_' + LTRIM(ISNULL(A.NGUONDUOC_ID,'')), A.KHODUOC_ID, A.DUOC_ID, NGUONDUOC_ID        ) TT_TONKHO on TT_TONKHO.DUOC_ID = TM_DUOC.DUOC_ID        LEFT JOIN TM_NGUONHANG NG ON NG.NGUONDUOC_ID = TT_TONKHO.NGUONDUOC_ID        LEFT JOIN TM_KHODUOC KD ON KD.KHODUOC_ID = TT_TONKHO.KHODUOC_ID        where TM_DUOC.BENHVIEN_ID = 'HLU01' and TT_TONKHO.SOLUONG >= 0        and TM_DUOC.DUOC_ID in (1)]
2019-09-20 17:48:15,588 [1] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoVaBookingCOM23UpdateRedis] PreparedStatement : [declare @NGUONDUOC_MACDINH varchar(5) = '0';        declare @TOAMUANGOAI int = 0;        select @NGUONDUOC_MACDINH = isnull(VALUE,0) from TM_SYS_APPSETTINGS where CODE = 'PHA_NGUONDUOC'        select @TOAMUANGOAI = isnull(VALUE,0) from TM_SYS_APPSETTINGS where CODE = 'OPD_TOAMUANGOAI_DUNGDANHMUC_DUOC'                if @TOAMUANGOAI = 1        begin        select  distinct '0' + '_' + LTRIM(d.DUOC_ID) + '_' + @NGUONDUOC_MACDINH as DUOC_KEY, 0 as PHAMVI_ID, @NGUONDUOC_MACDINH as NGUONDUOC_ID, null as TENNGUONDUOC, null as TINHTIEN, d.DUOC_ID, ld.MALOAIDUOC,        d.SOVISA,d.TYLE_VAT,d.COTOA, d.MADUOC, d.TENHANG, d.TENDUOCDAYDU, dvt.TENDONVITINH as DONVITINH, d.BHYT,        d.TENHOATCHAT, d.HAMLUONG, d.HANGSANXUAT, d.QUOCGIA, d.LOAIDUOC_ID, d.DUONGDUNG_ID, d.TINHTIEN_PTTT,        ten.TENDUOC, ten.TENDUOC_EN, ten.MAQUOCTE, ten.MAQUOCTEBT,        '' as BHYT_TEXT        , ld.LOAIVATTU_ID        , d.BENHVIEN_ID,        999999999 as SOLUONG, d.VTYT_PHANLOAI, d.PHAMVI, d.SUASOLUONGTONGHOP, d.MADUOCBV, d.DANGTRINHBAY        , TAMNGUNG = CASE WHEN d.TAMNGUNG = '1' THEN '1' ELSE '0' END        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        where d.DUOC_ID in (1)        union all        select  distinct tk.DUOC_KEY, LTRIM(tk.PHAMVI_ID) as PHAMVI_ID, tk.NGUONDUOC_ID, nh.TENNGUONDUOC, nh.TINHTIEN, d.DUOC_ID, ld.MALOAIDUOC,        d.SOVISA,d.TYLE_VAT,d.COTOA, d.MADUOC, d.TENHANG, d.TENDUOCDAYDU, dvt.TENDONVITINH as DONVITINH, d.BHYT,        d.TENHOATCHAT, d.HAMLUONG, d.HANGSANXUAT, d.QUOCGIA, d.LOAIDUOC_ID, d.DUONGDUNG_ID, d.TINHTIEN_PTTT,        ten.TENDUOC, ten.TENDUOC_EN, ten.MAQUOCTE, ten.MAQUOCTEBT,        CASE WHEN d.BHYT = '1' THEN 'BHYT' ELSE '' END as BHYT_TEXT        , ld.LOAIVATTU_ID        , d.BENHVIEN_ID,        tk.SOLUONG, d.VTYT_PHANLOAI, d.PHAMVI, d.SUASOLUONGTONGHOP, d.MADUOCBV, d.DANGTRINHBAY        , TAMNGUNG = CASE WHEN d.TAMNGUNG = '1' OR nh.TAMNGUNG = '1' OR kd.TAMNGUNG = '1' THEN '1' ELSE '0' END        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        inner join        (        select  LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')) DUOC_KEY, (SUM(dtk.SOLUONG) - isnull(sum(A.SOLUONG),0) - isnull(sum(B.SOLUONG),0)) SOLUONG, pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        from (select sum(soluong) soluong,duoc_id,nguonduoc_id,khoduoc_id,benhvien_id from TT_DUOC_TONKHO  group by duoc_id,nguonduoc_id,khoduoc_id,benhvien_id) dtk        inner join TM_DUOC_PHAMVISD_MAPPING pvsd on dtk.KHODUOC_ID = pvsd.KHODUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NOITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) B on B.DUOC_ID = dtk.DUOC_ID and B.SOLUONG > 0 and B.PHAMVI_ID = pvsd.PHAMVI_ID and B.NGUONHANG_ID = dtk.NGUONDUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NGOAITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) A on A.DUOC_ID = dtk.DUOC_ID and A.SOLUONG > 0 and A.PHAMVI_ID = pvsd.PHAMVI_ID and A.NGUONHANG_ID = dtk.NGUONDUOC_ID        where dtk.SOLUONG > 0 and dtk.BENHVIEN_ID = 'HLU01'        group by LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')), pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        ) tk on tk.DUOC_ID = d.DUOC_ID        left join TM_DUOC_PHAMVISUDUNG kd on kd.PHAMVI_ID = tk.PHAMVI_ID and kd.BENHVIEN_ID = 'HLU01'        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = tk.NGUONDUOC_ID and nh.BENHVIEN_ID = 'HLU01'        where  d.BENHVIEN_ID = 'HLU01' and d.DUOC_ID in (1)        end        else        begin        select  distinct tk.DUOC_KEY, LTRIM(tk.PHAMVI_ID) as PHAMVI_ID, tk.NGUONDUOC_ID, nh.TENNGUONDUOC, nh.TINHTIEN, d.DUOC_ID, ld.MALOAIDUOC,        d.SOVISA,d.TYLE_VAT,d.COTOA, d.MADUOC, d.TENHANG, d.TENDUOCDAYDU, dvt.TENDONVITINH as DONVITINH, d.BHYT,        d.TENHOATCHAT, d.HAMLUONG, d.HANGSANXUAT, d.QUOCGIA, d.LOAIDUOC_ID, d.DUONGDUNG_ID, d.TINHTIEN_PTTT,        ten.TENDUOC, ten.TENDUOC_EN, ten.MAQUOCTE, ten.MAQUOCTEBT,        CASE WHEN d.BHYT = '1' THEN 'BHYT' ELSE '' END as BHYT_TEXT        , ld.LOAIVATTU_ID        , d.BENHVIEN_ID,        tk.SOLUONG, d.VTYT_PHANLOAI, d.PHAMVI, d.SUASOLUONGTONGHOP, d.MADUOCBV, d.DANGTRINHBAY        , TAMNGUNG = CASE WHEN d.TAMNGUNG = '1' OR nh.TAMNGUNG = '1' OR kd.TAMNGUNG = '1' THEN '1' ELSE '0' END        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        inner join        (        select  LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')) DUOC_KEY, (SUM(dtk.SOLUONG) - isnull(sum(A.SOLUONG),0) - isnull(sum(B.SOLUONG),0)) SOLUONG, pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        from (select sum(soluong) soluong,duoc_id,nguonduoc_id,khoduoc_id,benhvien_id from TT_DUOC_TONKHO  group by duoc_id,nguonduoc_id,khoduoc_id,benhvien_id) dtk        inner join TM_DUOC_PHAMVISD_MAPPING pvsd on dtk.KHODUOC_ID = pvsd.KHODUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NOITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) B on B.DUOC_ID = dtk.DUOC_ID and B.SOLUONG > 0 and B.PHAMVI_ID = pvsd.PHAMVI_ID and B.NGUONHANG_ID = dtk.NGUONDUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NGOAITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) A on A.DUOC_ID = dtk.DUOC_ID and A.SOLUONG > 0 and A.PHAMVI_ID = pvsd.PHAMVI_ID and A.NGUONHANG_ID = dtk.NGUONDUOC_ID        where dtk.SOLUONG > 0 and dtk.BENHVIEN_ID = 'HLU01'        group by LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')), pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        ) tk on tk.DUOC_ID = d.DUOC_ID        left join TM_DUOC_PHAMVISUDUNG kd on kd.PHAMVI_ID = tk.PHAMVI_ID and kd.BENHVIEN_ID = 'HLU01'        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = tk.NGUONDUOC_ID and nh.BENHVIEN_ID = 'HLU01'        where  d.BENHVIEN_ID = 'HLU01' and d.DUOC_ID in (1)        end]
2019-09-20 17:48:18,079 [1] DEBUG - Statement Id: [DAO00030_RemoveChungTuVTYTNgoaiTru] PreparedStatement : [update TT_NGOAITRU_KHAMBENH_VTYT set            CHUNGTU_ID = null,            TRANGTHAI = null            where            CHUNGTU_ID =   @param0               update TT_VIENPHI set            DUYET = '0',            DATHUCHIEN = '0'            where            REF_TABLE = 'TT_NGOAITRU_KHAMBENH_VTYT'            AND REF_ID IN (10593)]
2019-09-20 17:48:18,079 [1] DEBUG - Statement Id: [DAO00030_RemoveChungTuVTYTNgoaiTru] Parameters: [@param0=[CHUNGTU_ID,137704]]
2019-09-20 17:48:18,079 [1] DEBUG - Statement Id: [DAO00030_RemoveChungTuVTYTNgoaiTru] Types: [@param0=[Int64, System.Int64]]
2019-09-20 17:48:18,127 [1] DEBUG - Statement Id: [DAO00030_CHUNGTUCT_Add] PreparedStatement : [insert into TT_DUOC_CHUNGTU_CHITIET (            CHUNGTU_ID            , DUOC_ID            , SOLONHAP_ID            , SOKIEMSOAT            , SOVISA            , HANDUNG            , DONVITINH_ID            , SOLUONGYEUCAU            , SOLUONGTHUCTE            , SOLUONGDAXUAT            , TIENTE_ID            , TYGIA            , DONGIAMUA            , DONGIA_BHYT            , DONGIABAN            , DONGIABAN_VAT            , DONGIAVON            , DONGIATHANHTOAN            , SOQUYEN            , SOHOADONVAT            , TYLEVAT            , GIATRIVAT            , TYLECHIETKHAU            , GIATRICHIETKHAU            , MIENPHI            , LYDOMIENPHI_ID            , SOCHUNGTUKETOAN            , SOCHUNGTUTIENMAT            , TRANGTHAI            , DAPHATSINHPHIEUXUAT            , DAPHATSINHPHIEUHOANTRA            , KHUYENMAI            , PHUONGPHAPXUAT            , DONDATHANG_ID            , GHICHUCHITIET            , NGUONHANG_ID            , DONGIAVONVAT            , THANHTIENMUA            , THANHTIENVON            , THANHTIENHOPDONG            , ISTACHLO            , DONVITINHBANDAU_ID            , SOLUONGBANDAU            , GOITHAU_ID            , DONGIATHAU            , DONGIAPO            , TYLEQUIDOI            , TOATHUOCNOITRU_ID            , KHAMBENH_VTYT_ID            , PHAUTHUAT_VTYT_ID            , CLSKETQUA_VTYT_ID            , TOATHUOCNGOAITRU_ID            , MASTER_ID            , BENHNHAN            , YLENH                                   , BENHVIEN_ID            , NGAYTAO            , NGUOITAO_ID            , NGAYCAPNHAT            , NGUOICAPNHAT_ID            , THANHTIENMUABANDAU            , SOLUONGQUIDOI            ) values (             @param0             ,  @param1             ,  @param2             ,  @param3             ,  @param4             ,  @param5             ,  @param6             ,  @param7             ,  @param8             ,  @param9             ,  @param10             ,  @param11             ,  @param12             ,  @param13             ,  @param14             ,  @param15             ,  @param16             ,  @param17             ,  @param18             ,  @param19             ,  @param20             ,  @param21             ,  @param22             ,  @param23             ,  @param24             ,  @param25             ,  @param26             ,  @param27             ,  @param28             ,  @param29             ,  @param30             ,  @param31             ,  @param32             ,  @param33             ,  @param34             ,  @param35             ,  @param36             ,  @param37             ,  @param38             ,  @param39             ,  @param40             ,  @param41             ,  @param42             ,  @param43             ,  @param44             ,  @param45             ,  @param46             ,  @param47             ,  @param48             ,  @param49             ,  @param50             ,  @param51             ,  @param52             ,  @param53             ,  @param54                          ,  @param55             ,  @param56             ,  @param57             ,  @param58             ,  @param59             ,  @param60             ,  @param61             )            select SCOPE_identity() as value]
2019-09-20 17:48:18,128 [1] DEBUG - Statement Id: [DAO00030_CHUNGTUCT_Add] Parameters: [@param0=[CHUNGTU_ID,137704], @param1=[DUOC_ID,1], @param2=[SOLONHAP_ID,7541], @param3=[SOKIEMSOAT,null], @param4=[SOVISA,1], @param5=[HANDUNG,12/12/2026 12:00:00 AM], @param6=[DONVITINH_ID,17], @param7=[SOLUONGYEUCAU,2], @param8=[SOLUONGTHUCTE,null], @param9=[SOLUONGDAXUAT,2], @param10=[TIENTE_ID,null], @param11=[TYGIA,null], @param12=[DONGIAMUA,945], @param13=[DONGIA_BHYT,null], @param14=[DONGIABAN,1030], @param15=[DONGIABAN_VAT,1030], @param16=[DONGIAVON,945], @param17=[DONGIATHANHTOAN,null], @param18=[SOQUYEN,null], @param19=[SOHOADONVAT,null], @param20=[TYLEVAT,0], @param21=[GIATRIVAT,null], @param22=[TYLECHIETKHAU,null], @param23=[GIATRICHIETKHAU,null], @param24=[MIENPHI,null], @param25=[LYDOMIENPHI_ID,null], @param26=[SOCHUNGTUKETOAN,null], @param27=[SOCHUNGTUTIENMAT,null], @param28=[TRANGTHAI,null], @param29=[DAPHATSINHPHIEUXUAT,null], @param30=[DAPHATSINHPHIEUHOANTRA,null], @param31=[KHUYENMAI,null], @param32=[PHUONGPHAPXUAT,null], @param33=[DONDATHANG_ID,null], @param34=[GHICHUCHITIET,null], @param35=[NGUONHANG_ID,1], @param36=[DONGIAVONVAT,945], @param37=[THANHTIENMUA,1890], @param38=[THANHTIENVON,1890], @param39=[THANHTIENHOPDONG,null], @param40=[ISTACHLO,null], @param41=[DONVITINHBANDAU_ID,null], @param42=[SOLUONGBANDAU,null], @param43=[GOITHAU_ID,null], @param44=[DONGIATHAU,1030], @param45=[DONGIAPO,null], @param46=[TYLEQUIDOI,null], @param47=[TOATHUOCNOITRU_ID,null], @param48=[KHAMBENH_VTYT_ID,10593], @param49=[PHAUTHUAT_VTYT_ID,null], @param50=[CLSKETQUA_VTYT_ID,null], @param51=[TOATHUOCNGOAITRU_ID,null], @param52=[MASTER_ID,0], @param53=[BENHNHAN,Người bệnh: 190043304 - Test Xn1 - 20/09/2019 - 16:50], @param54=[YLENH,null], @param55=[BENHVIEN_ID,HLU01], @param56=[NGAYTAO,9/20/2019 5:48:18 PM], @param57=[NGUOITAO_ID,0], @param58=[NGAYCAPNHAT,9/20/2019 5:48:18 PM], @param59=[NGUOICAPNHAT_ID,0], @param60=[THANHTIENMUABANDAU,null], @param61=[SOLUONGQUIDOI,null]]
2019-09-20 17:48:18,128 [1] DEBUG - Statement Id: [DAO00030_CHUNGTUCT_Add] Types: [@param0=[Int64, System.Int64], @param1=[Int64, System.Int64], @param2=[Int64, System.Int64], @param3=[System.DBNull, null], @param4=[String, System.String], @param5=[DateTime, System.DateTime], @param6=[Int64, System.Int64], @param7=[Double, System.Double], @param8=[System.DBNull, null], @param9=[Double, System.Double], @param10=[System.DBNull, null], @param11=[System.DBNull, null], @param12=[Double, System.Double], @param13=[System.DBNull, null], @param14=[Double, System.Double], @param15=[Double, System.Double], @param16=[Double, System.Double], @param17=[System.DBNull, null], @param18=[System.DBNull, null], @param19=[System.DBNull, null], @param20=[Double, System.Double], @param21=[System.DBNull, null], @param22=[System.DBNull, null], @param23=[System.DBNull, null], @param24=[System.DBNull, null], @param25=[System.DBNull, null], @param26=[System.DBNull, null], @param27=[System.DBNull, null], @param28=[System.DBNull, null], @param29=[System.DBNull, null], @param30=[System.DBNull, null], @param31=[System.DBNull, null], @param32=[System.DBNull, null], @param33=[System.DBNull, null], @param34=[System.DBNull, null], @param35=[Int64, System.Int64], @param36=[Double, System.Double], @param37=[Double, System.Double], @param38=[Double, System.Double], @param39=[System.DBNull, null], @param40=[System.DBNull, null], @param41=[System.DBNull, null], @param42=[System.DBNull, null], @param43=[System.DBNull, null], @param44=[Double, System.Double], @param45=[System.DBNull, null], @param46=[System.DBNull, null], @param47=[System.DBNull, null], @param48=[Int64, System.Int64], @param49=[System.DBNull, null], @param50=[System.DBNull, null], @param51=[System.DBNull, null], @param52=[Int64, System.Int64], @param53=[String, System.String], @param54=[System.DBNull, null], @param55=[String, System.String], @param56=[DateTime, System.DateTime], @param57=[Int64, System.Int64], @param58=[DateTime, System.DateTime], @param59=[Int64, System.Int64], @param60=[System.DBNull, null], @param61=[System.DBNull, null]]
2019-09-20 17:48:18,162 [1] DEBUG - Statement Id: [DAO00030_TT_DUOC_TONKHO_LOG_Add] PreparedStatement : [DECLARE @KHODUOC_ID int               DECLARE @TONTRUOC numeric(18, 4)               DECLARE @TONSAU numeric(18, 4)               DECLARE @SOLUONGNHAP numeric(18, 4)               DECLARE @SOLUONGXUAT numeric(18, 4)                              IF( @param0  = 'N')               BEGIN                SET @KHODUOC_ID =  @param1                END               ELSE               BEGIN                 SET @KHODUOC_ID =  @param2                END                              SELECT @TONTRUOC = SOLUONG FROM TT_DUOC_TONKHO WHERE KHODUOC_ID = @KHODUOC_ID  AND DUOC_ID =  @param3  AND SOLONHAP_ID =  @param4  AND NGUONDUOC_ID =  @param5                               IF( @param0  = 'N' AND  @param6  = 'ADD')               BEGIN                SET @TONSAU = ISNULL(@TONTRUOC,0) +  @param7                 SET @SOLUONGNHAP =  @param7                 SET @SOLUONGXUAT = 0               END               IF( @param0  = 'N' AND  @param6  = 'DEL')               BEGIN                SET @TONSAU = ISNULL(@TONTRUOC,0) -  @param7                 SET @SOLUONGXUAT =  @param7                 SET @SOLUONGNHAP = 0               END                                         IF( @param0  = 'X' AND  @param6  = 'ADD')               BEGIN                SET @TONSAU = ISNULL(@TONTRUOC,0) -  @param8                 SET @SOLUONGXUAT =  @param8                 SET @SOLUONGNHAP = 0               END               IF( @param0  = 'X' AND  @param6  = 'DEL')               BEGIN                SET @TONSAU = ISNULL(@TONTRUOC,0) +  @param8                 SET @SOLUONGNHAP =  @param8                 SET @SOLUONGXUAT = 0                             END                        insert into TT_DUOC_TONKHO_LOG (                           CHUNGTUCHITIET_ID              ,CHUNGTU_ID              ,MACHUNGTU              ,LOAICHUNGTU              ,MUCDICHCHUNGTU_CODE              ,KHONHAP_ID              ,KHOXUAT_ID              ,DUOC_ID              ,SOLONHAP_ID              ,NGUONDUOC_ID              ,SOLUONGNHAP              ,SOLUONGXUAT              ,DONGIAMUA              ,DONGIAVON              ,TYLE_VAT              ,DONGIAVONVAT              ,TONTRUOC              ,TONSAU              ,ACTION              ,BENHVIEN_ID              ,NGAYTAO              ,NGUOITAO_ID                          ) values (              @param9               , @param10               , @param11               , @param0               , @param12               , @param1               , @param2               , @param3               , @param4               , @param5               ,@SOLUONGNHAP              ,@SOLUONGXUAT              , @param13               , @param14               , @param15               , @param16               ,@TONTRUOC              ,@TONSAU              , @param6               , @param17               , @param18               , @param19               )]
2019-09-20 17:48:18,162 [1] DEBUG - Statement Id: [DAO00030_TT_DUOC_TONKHO_LOG_Add] Parameters: [@param0=[LOAICHUNGTU,X], @param1=[KHONHAP_ID,null], @param2=[KHOXUAT_ID,32], @param3=[DUOC_ID,1], @param4=[SOLONHAP_ID,7541], @param5=[NGUONDUOC_ID,1], @param6=[ACTION,ADD], @param7=[SOLUONGNHAP,null], @param8=[SOLUONGXUAT,2], @param9=[CHUNGTUCHITIET_ID,1299052], @param10=[CHUNGTU_ID,137704], @param11=[MACHUNGTU,CS_KBX1319003092], @param12=[MUCDICHCHUNGTU_CODE,X13], @param13=[DONGIAMUA,945], @param14=[DONGIAVON,945], @param15=[TYLE_VAT,0], @param16=[DONGIAVONVAT,945], @param17=[BENHVIEN_ID,HLU01], @param18=[NGAYTAO,9/20/2019 5:48:18 PM], @param19=[NGUOITAO_ID,0]]
2019-09-20 17:48:18,163 [1] DEBUG - Statement Id: [DAO00030_TT_DUOC_TONKHO_LOG_Add] Types: [@param0=[String, System.String], @param1=[System.DBNull, null], @param2=[Int64, System.Int64], @param3=[Int64, System.Int64], @param4=[Int64, System.Int64], @param5=[Int64, System.Int64], @param6=[String, System.String], @param7=[System.DBNull, null], @param8=[Decimal, System.Decimal], @param9=[Int64, System.Int64], @param10=[Int64, System.Int64], @param11=[String, System.String], @param12=[String, System.String], @param13=[Decimal, System.Decimal], @param14=[Decimal, System.Decimal], @param15=[Double, System.Double], @param16=[Double, System.Double], @param17=[String, System.String], @param18=[DateTime, System.DateTime], @param19=[Int64, System.Int64]]
2019-09-20 17:48:18,197 [1] DEBUG - Statement Id: [DAO00030_DUOC_TONKHO_BOOKING_NGOAITRU_Giam] PreparedStatement : [update TT_DUOC_TONKHO_BOOK_NGOAITRU            set            SOLUONG = 0                     ,NGAYCAPNHAT = getdate()            where            REF_TABLE = 'TT_NGOAITRU_KHAMBENH_VTYT'            AND REF_ID = '10593'                AND BENHVIEN_ID = 'HLU01']
2019-09-20 17:48:18,251 [1] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoVaBookingCOM23UpdateRedis] PreparedStatement : [declare @NGUONDUOC_MACDINH varchar(5) = '0';        declare @TOAMUANGOAI int = 0;        select @NGUONDUOC_MACDINH = isnull(VALUE,0) from TM_SYS_APPSETTINGS where CODE = 'PHA_NGUONDUOC'        select @TOAMUANGOAI = isnull(VALUE,0) from TM_SYS_APPSETTINGS where CODE = 'OPD_TOAMUANGOAI_DUNGDANHMUC_DUOC'                if @TOAMUANGOAI = 1        begin        select  distinct '0' + '_' + LTRIM(d.DUOC_ID) + '_' + @NGUONDUOC_MACDINH as DUOC_KEY, 0 as PHAMVI_ID, @NGUONDUOC_MACDINH as NGUONDUOC_ID, null as TENNGUONDUOC, null as TINHTIEN, d.DUOC_ID, ld.MALOAIDUOC,        d.SOVISA,d.TYLE_VAT,d.COTOA, d.MADUOC, d.TENHANG, d.TENDUOCDAYDU, dvt.TENDONVITINH as DONVITINH, d.BHYT,        d.TENHOATCHAT, d.HAMLUONG, d.HANGSANXUAT, d.QUOCGIA, d.LOAIDUOC_ID, d.DUONGDUNG_ID, d.TINHTIEN_PTTT,        ten.TENDUOC, ten.TENDUOC_EN, ten.MAQUOCTE, ten.MAQUOCTEBT,        '' as BHYT_TEXT        , ld.LOAIVATTU_ID        , d.BENHVIEN_ID,        999999999 as SOLUONG, d.VTYT_PHANLOAI, d.PHAMVI, d.SUASOLUONGTONGHOP, d.MADUOCBV, d.DANGTRINHBAY        , TAMNGUNG = CASE WHEN d.TAMNGUNG = '1' THEN '1' ELSE '0' END        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        where d.DUOC_ID in (1)        union all        select  distinct tk.DUOC_KEY, LTRIM(tk.PHAMVI_ID) as PHAMVI_ID, tk.NGUONDUOC_ID, nh.TENNGUONDUOC, nh.TINHTIEN, d.DUOC_ID, ld.MALOAIDUOC,        d.SOVISA,d.TYLE_VAT,d.COTOA, d.MADUOC, d.TENHANG, d.TENDUOCDAYDU, dvt.TENDONVITINH as DONVITINH, d.BHYT,        d.TENHOATCHAT, d.HAMLUONG, d.HANGSANXUAT, d.QUOCGIA, d.LOAIDUOC_ID, d.DUONGDUNG_ID, d.TINHTIEN_PTTT,        ten.TENDUOC, ten.TENDUOC_EN, ten.MAQUOCTE, ten.MAQUOCTEBT,        CASE WHEN d.BHYT = '1' THEN 'BHYT' ELSE '' END as BHYT_TEXT        , ld.LOAIVATTU_ID        , d.BENHVIEN_ID,        tk.SOLUONG, d.VTYT_PHANLOAI, d.PHAMVI, d.SUASOLUONGTONGHOP, d.MADUOCBV, d.DANGTRINHBAY        , TAMNGUNG = CASE WHEN d.TAMNGUNG = '1' OR nh.TAMNGUNG = '1' OR kd.TAMNGUNG = '1' THEN '1' ELSE '0' END        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        inner join        (        select  LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')) DUOC_KEY, (SUM(dtk.SOLUONG) - isnull(sum(A.SOLUONG),0) - isnull(sum(B.SOLUONG),0)) SOLUONG, pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        from (select sum(soluong) soluong,duoc_id,nguonduoc_id,khoduoc_id,benhvien_id from TT_DUOC_TONKHO  group by duoc_id,nguonduoc_id,khoduoc_id,benhvien_id) dtk        inner join TM_DUOC_PHAMVISD_MAPPING pvsd on dtk.KHODUOC_ID = pvsd.KHODUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NOITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) B on B.DUOC_ID = dtk.DUOC_ID and B.SOLUONG > 0 and B.PHAMVI_ID = pvsd.PHAMVI_ID and B.NGUONHANG_ID = dtk.NGUONDUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NGOAITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) A on A.DUOC_ID = dtk.DUOC_ID and A.SOLUONG > 0 and A.PHAMVI_ID = pvsd.PHAMVI_ID and A.NGUONHANG_ID = dtk.NGUONDUOC_ID        where dtk.SOLUONG > 0 and dtk.BENHVIEN_ID = 'HLU01'        group by LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')), pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        ) tk on tk.DUOC_ID = d.DUOC_ID        left join TM_DUOC_PHAMVISUDUNG kd on kd.PHAMVI_ID = tk.PHAMVI_ID and kd.BENHVIEN_ID = 'HLU01'        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = tk.NGUONDUOC_ID and nh.BENHVIEN_ID = 'HLU01'        where  d.BENHVIEN_ID = 'HLU01' and d.DUOC_ID in (1)        end        else        begin        select  distinct tk.DUOC_KEY, LTRIM(tk.PHAMVI_ID) as PHAMVI_ID, tk.NGUONDUOC_ID, nh.TENNGUONDUOC, nh.TINHTIEN, d.DUOC_ID, ld.MALOAIDUOC,        d.SOVISA,d.TYLE_VAT,d.COTOA, d.MADUOC, d.TENHANG, d.TENDUOCDAYDU, dvt.TENDONVITINH as DONVITINH, d.BHYT,        d.TENHOATCHAT, d.HAMLUONG, d.HANGSANXUAT, d.QUOCGIA, d.LOAIDUOC_ID, d.DUONGDUNG_ID, d.TINHTIEN_PTTT,        ten.TENDUOC, ten.TENDUOC_EN, ten.MAQUOCTE, ten.MAQUOCTEBT,        CASE WHEN d.BHYT = '1' THEN 'BHYT' ELSE '' END as BHYT_TEXT        , ld.LOAIVATTU_ID        , d.BENHVIEN_ID,        tk.SOLUONG, d.VTYT_PHANLOAI, d.PHAMVI, d.SUASOLUONGTONGHOP, d.MADUOCBV, d.DANGTRINHBAY        , TAMNGUNG = CASE WHEN d.TAMNGUNG = '1' OR nh.TAMNGUNG = '1' OR kd.TAMNGUNG = '1' THEN '1' ELSE '0' END        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        inner join        (        select  LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')) DUOC_KEY, (SUM(dtk.SOLUONG) - isnull(sum(A.SOLUONG),0) - isnull(sum(B.SOLUONG),0)) SOLUONG, pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        from (select sum(soluong) soluong,duoc_id,nguonduoc_id,khoduoc_id,benhvien_id from TT_DUOC_TONKHO  group by duoc_id,nguonduoc_id,khoduoc_id,benhvien_id) dtk        inner join TM_DUOC_PHAMVISD_MAPPING pvsd on dtk.KHODUOC_ID = pvsd.KHODUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NOITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) B on B.DUOC_ID = dtk.DUOC_ID and B.SOLUONG > 0 and B.PHAMVI_ID = pvsd.PHAMVI_ID and B.NGUONHANG_ID = dtk.NGUONDUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NGOAITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) A on A.DUOC_ID = dtk.DUOC_ID and A.SOLUONG > 0 and A.PHAMVI_ID = pvsd.PHAMVI_ID and A.NGUONHANG_ID = dtk.NGUONDUOC_ID        where dtk.SOLUONG > 0 and dtk.BENHVIEN_ID = 'HLU01'        group by LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')), pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        ) tk on tk.DUOC_ID = d.DUOC_ID        left join TM_DUOC_PHAMVISUDUNG kd on kd.PHAMVI_ID = tk.PHAMVI_ID and kd.BENHVIEN_ID = 'HLU01'        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = tk.NGUONDUOC_ID and nh.BENHVIEN_ID = 'HLU01'        where  d.BENHVIEN_ID = 'HLU01' and d.DUOC_ID in (1)        end]
2019-09-20 17:48:18,430 [1] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoCOM18UpdateRedis] PreparedStatement : [select distinct TT_TONKHO.DUOC_KEY, LTRIM(TT_TONKHO.KHODUOC_ID) as KHODUOC_ID, TM_DUOC.DUOC_ID, TM_LOAIDUOC.MALOAIDUOC,TM_DUOC.SOVISA,TM_DUOC.TYLE_VAT,TM_DUOC.COTOA,        TM_DUOC.MADUOC, TM_DUOC.TENHANG, TM_DUOC.TENDUOCDAYDU, dvt.TENDONVITINH as DONVITINH,  TM_DUOC.DONVITINH_ID,TM_DUOC.BHYT,        TM_DUOC.TENHOATCHAT,        TM_DUOC.HAMLUONG, TM_DUOC.HANGSANXUAT, TM_DUOC.QUOCGIA, TM_DUOC.LOAIDUOC_ID, TM_DUOC.DUONGDUNG_ID,        TM_TENDUOC.TENDUOC, TM_TENDUOC.TENDUOC_EN, TM_TENDUOC.MAQUOCTE, TM_TENDUOC.MAQUOCTEBT,        TM_LOAIDUOC.LOAIVATTU_ID, TM_DUOC.BENHVIEN_ID,        TT_TONKHO.SOLUONG, TM_DUOC.VTYT_PHANLOAI, TM_DUOC.PHAMVI, TT_TONKHO.NGUONDUOC_ID, NG.TENNGUONDUOC AS TENNGUONDUOC        , TAMNGUNG = CASE WHEN TM_DUOC.TAMNGUNG = '1' OR NG.TAMNGUNG = '1' OR KD.TAMNGUNG = '1' THEN '1' ELSE '0' END        , TM_DUOC.DANGTRINHBAY        from TM_DUOC        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = TM_DUOC.DONVITINH_ID        left join TM_TENDUOC on TM_DUOC.TENDUOC_ID = TM_TENDUOC.TENDUOC_ID and TM_DUOC.BENHVIEN_ID = 'HLU01' and TM_DUOC.TAMNGUNG = '0'        left join TM_LOAIDUOC on TM_LOAIDUOC.LOAIDUOC_ID = TM_DUOC.LOAIDUOC_ID and TM_LOAIDUOC.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG on (TM_LOAIDUOC.LOAIVATTU_ID = TM_DUOC_HANDUNG.LOAIDUOC and TM_DUOC_HANDUNG.BENHVIEN_ID = 'HLU01')        inner join        (select LTRIM(A.KHODUOC_ID) + '_' + LTRIM(A.DUOC_ID) + '_' + LTRIM(ISNULL(A.NGUONDUOC_ID,'')) as DUOC_KEY, A.KHODUOC_ID, A.DUOC_ID, A.NGUONDUOC_ID,        SUM(isnull(A.SOLUONG,0)) as SOLUONG        from        (select SUM(SOLUONG) as SOLUONG, KHODUOC_ID, DUOC_ID, NGUONDUOC_ID from TT_DUOC_TONKHO        where BENHVIEN_ID = 'HLU01' group by KHODUOC_ID, DUOC_ID, NGUONDUOC_ID) A        group by LTRIM(A.KHODUOC_ID) + '_' + LTRIM(A.DUOC_ID) + '_' + LTRIM(ISNULL(A.NGUONDUOC_ID,'')), A.KHODUOC_ID, A.DUOC_ID, NGUONDUOC_ID        ) TT_TONKHO on TT_TONKHO.DUOC_ID = TM_DUOC.DUOC_ID        LEFT JOIN TM_NGUONHANG NG ON NG.NGUONDUOC_ID = TT_TONKHO.NGUONDUOC_ID        LEFT JOIN TM_KHODUOC KD ON KD.KHODUOC_ID = TT_TONKHO.KHODUOC_ID        where TM_DUOC.BENHVIEN_ID = 'HLU01' and TT_TONKHO.SOLUONG >= 0        and TM_DUOC.DUOC_ID in (1)]
2019-09-20 17:50:32,587 [1] DEBUG - Statement Id: [DAO00030_DUOCTONKHO_Giam] PreparedStatement : [update TT_DUOC_TONKHO set            SOLUONG = SOLUONG -  @param0             , NGAYCAPNHAT =  getdate()            , NGUOICAPNHAT_ID =  @param1             where            KHODUOC_ID =  @param2             and DUOC_ID =  @param3             and SOLONHAP_ID =  @param4]
2019-09-20 17:50:32,587 [1] DEBUG - Statement Id: [DAO00030_DUOCTONKHO_Giam] Parameters: [@param0=[SOLUONGTHAYDOI,2], @param1=[NGUOICAPNHAT_ID,0], @param2=[KHODUOC_ID,32], @param3=[DUOC_ID,1], @param4=[SOLONHAP_ID,7541]]
2019-09-20 17:50:32,587 [1] DEBUG - Statement Id: [DAO00030_DUOCTONKHO_Giam] Types: [@param0=[Double, System.Double], @param1=[Int64, System.Int64], @param2=[Int64, System.Int64], @param3=[Int64, System.Int64], @param4=[Int64, System.Int64]]
2019-09-20 17:50:32,633 [1] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoCOM18] PreparedStatement : [select  distinct TT_TONKHO.DUOC_KEY, LTRIM(TT_TONKHO.KHODUOC_ID) as KHODUOC_ID, TM_DUOC.DUOC_ID, TM_LOAIDUOC.MALOAIDUOC,TM_DUOC.SOVISA,TM_DUOC.TYLE_VAT,TM_DUOC.COTOA,        TM_DUOC.MADUOC, TM_DUOC.TENHANG, TM_DUOC.TENDUOCDAYDU, dvt.TENDONVITINH as DONVITINH, TM_DUOC.DONVITINH_ID, TM_DUOC.BHYT,        TM_DUOC.TENHOATCHAT, TM_DUOC.HAMLUONG, TM_DUOC.HANGSANXUAT, TM_DUOC.QUOCGIA, TM_DUOC.LOAIDUOC_ID, TM_DUOC.DUONGDUNG_ID,        TM_TENDUOC.TENDUOC, TM_TENDUOC.TENDUOC_EN, TM_TENDUOC.MAQUOCTE, TM_TENDUOC.MAQUOCTEBT,        TM_LOAIDUOC.LOAIVATTU_ID, TM_DUOC.BENHVIEN_ID,        TT_TONKHO.SOLUONG, TM_DUOC.VTYT_PHANLOAI, TM_DUOC.PHAMVI, TT_TONKHO.NGUONDUOC_ID, NG.TENNGUONDUOC        , TAMNGUNG = CASE WHEN TM_DUOC.TAMNGUNG = '1' OR NG.TAMNGUNG = '1' OR KD.TAMNGUNG = '1' THEN '1' ELSE '0' END        , TM_DUOC.DANGTRINHBAY        from TM_DUOC        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = TM_DUOC.DONVITINH_ID        left join TM_TENDUOC on TM_DUOC.TENDUOC_ID = TM_TENDUOC.TENDUOC_ID and TM_DUOC.BENHVIEN_ID = 'HLU01'  and TM_DUOC.TAMNGUNG = '0'        left join TM_LOAIDUOC on TM_LOAIDUOC.LOAIDUOC_ID = TM_DUOC.LOAIDUOC_ID and TM_LOAIDUOC.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG on (TM_LOAIDUOC.LOAIVATTU_ID = TM_DUOC_HANDUNG.LOAIDUOC and TM_DUOC_HANDUNG.BENHVIEN_ID = 'HLU01')        inner join        (select LTRIM(A.KHODUOC_ID) + '_' + LTRIM(A.DUOC_ID) + '_' + LTRIM(ISNULL(A.NGUONDUOC_ID,'')) as DUOC_KEY, A.KHODUOC_ID, A.DUOC_ID ,a.NGUONDUOC_ID,        SUM(isnull(A.SOLUONG,0)) as SOLUONG        from        (select SUM(SOLUONG) as SOLUONG, KHODUOC_ID, DUOC_ID, NGUONDUOC_ID from TT_DUOC_TONKHO        where KHODUOC_ID in (32) and DUOC_ID in (1) group by KHODUOC_ID, DUOC_ID, NGUONDUOC_ID        ) A        where A.KHODUOC_ID in (32) and A.DUOC_ID in (1)        group by LTRIM(A.KHODUOC_ID) + '_' + LTRIM(A.DUOC_ID) + '_' + LTRIM(A.NGUONDUOC_ID), A.KHODUOC_ID, A.DUOC_ID, A.NGUONDUOC_ID)        TT_TONKHO on TT_TONKHO.DUOC_ID = TM_DUOC.DUOC_ID        LEFT JOIN TM_NGUONHANG NG ON NG.NGUONDUOC_ID = TT_TONKHO.NGUONDUOC_ID        LEFT JOIN TM_KHODUOC KD ON KD.KHODUOC_ID = TT_TONKHO.KHODUOC_ID        where TM_DUOC.BENHVIEN_ID = 'HLU01' and TM_DUOC.DUOC_ID in (1)]
2019-09-20 17:50:32,669 [1] DEBUG - Statement Id: [DAO00030_GetListPhamViByKhoDuoc] PreparedStatement : [SELECT DISTINCT PHAMVI_ID          FROM TM_DUOC_PHAMVISD_MAPPING          WHERE          KHODUOC_ID IN (32)          AND BENHVIEN_ID ='HLU01'          AND TAMNGUNG = '0']
2019-09-20 17:50:32,698 [1] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoVaBookingCOM23] PreparedStatement : [declare @NGUONDUOC_MACDINH varchar(5) = '0';        declare @TOAMUANGOAI int = 0;        select @NGUONDUOC_MACDINH = isnull(VALUE,0) from TM_SYS_APPSETTINGS where CODE = 'PHA_NGUONDUOC'        select @TOAMUANGOAI = isnull(VALUE,0) from TM_SYS_APPSETTINGS where CODE = 'OPD_TOAMUANGOAI_DUNGDANHMUC_DUOC'                if @TOAMUANGOAI = 1        begin        select  distinct '0' + '_' + LTRIM(d.DUOC_ID) + '_' + @NGUONDUOC_MACDINH as DUOC_KEY, 0 as PHAMVI_ID, @NGUONDUOC_MACDINH as NGUONDUOC_ID, null as TENNGUONDUOC, null as TINHTIEN, d.DUOC_ID, ld.MALOAIDUOC,        d.SOVISA,d.TYLE_VAT,d.COTOA, d.MADUOC, d.TENHANG, d.TENDUOCDAYDU, dvt.TENDONVITINH as DONVITINH, d.BHYT,        d.TENHOATCHAT, d.HAMLUONG, d.HANGSANXUAT, d.QUOCGIA, d.LOAIDUOC_ID, d.DUONGDUNG_ID, d.TINHTIEN_PTTT,        ten.TENDUOC, ten.TENDUOC_EN, ten.MAQUOCTE, ten.MAQUOCTEBT,        '' as BHYT_TEXT        , ld.LOAIVATTU_ID        , d.BENHVIEN_ID,        999999999 as SOLUONG, d.VTYT_PHANLOAI, d.PHAMVI, d.SUASOLUONGTONGHOP, d.MADUOCBV, d.DANGTRINHBAY        , TAMNGUNG = CASE WHEN d.TAMNGUNG = '1' THEN '1' ELSE '0' END        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        where d.DUOC_ID in (1)        union all        select  distinct tk.DUOC_KEY, LTRIM(tk.PHAMVI_ID) as PHAMVI_ID, tk.NGUONDUOC_ID, nh.TENNGUONDUOC, nh.TINHTIEN, d.DUOC_ID, ld.MALOAIDUOC,        d.SOVISA,d.TYLE_VAT,d.COTOA, d.MADUOC, d.TENHANG, d.TENDUOCDAYDU, dvt.TENDONVITINH as DONVITINH, d.BHYT,        d.TENHOATCHAT, d.HAMLUONG, d.HANGSANXUAT, d.QUOCGIA, d.LOAIDUOC_ID, d.DUONGDUNG_ID, d.TINHTIEN_PTTT,        ten.TENDUOC, ten.TENDUOC_EN, ten.MAQUOCTE, ten.MAQUOCTEBT,        CASE WHEN d.BHYT = '1' THEN 'BHYT' ELSE '' END as BHYT_TEXT        , ld.LOAIVATTU_ID        , d.BENHVIEN_ID,        tk.SOLUONG, d.VTYT_PHANLOAI, d.PHAMVI, d.SUASOLUONGTONGHOP, d.MADUOCBV, d.DANGTRINHBAY        , TAMNGUNG = CASE WHEN d.TAMNGUNG = '1' OR nh.TAMNGUNG = '1' OR kd.TAMNGUNG = '1' THEN '1' ELSE '0' END        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        inner join        (        select  LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')) DUOC_KEY, (SUM(dtk.SOLUONG) - isnull(sum(A.SOLUONG),0) - isnull(sum(B.SOLUONG),0)) SOLUONG, pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        from (select sum(soluong) soluong,duoc_id,nguonduoc_id,khoduoc_id,benhvien_id from TT_DUOC_TONKHO  group by duoc_id,nguonduoc_id,khoduoc_id,benhvien_id) dtk        inner join TM_DUOC_PHAMVISD_MAPPING pvsd on dtk.KHODUOC_ID = pvsd.KHODUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NOITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) B on B.DUOC_ID = dtk.DUOC_ID and B.SOLUONG > 0 and B.PHAMVI_ID = pvsd.PHAMVI_ID and B.NGUONHANG_ID = dtk.NGUONDUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NGOAITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) A on A.DUOC_ID = dtk.DUOC_ID and A.SOLUONG > 0 and A.PHAMVI_ID = pvsd.PHAMVI_ID and A.NGUONHANG_ID = dtk.NGUONDUOC_ID        where dtk.SOLUONG > 0 and dtk.BENHVIEN_ID = 'HLU01'        group by LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')), pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        ) tk on tk.DUOC_ID = d.DUOC_ID        left join TM_DUOC_PHAMVISUDUNG kd on kd.PHAMVI_ID = tk.PHAMVI_ID and kd.BENHVIEN_ID = 'HLU01'        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = tk.NGUONDUOC_ID and nh.BENHVIEN_ID = 'HLU01'        where  d.BENHVIEN_ID = 'HLU01' and d.DUOC_ID in (1) and TK.PHAMVI_ID in (1055)        and tk.NGUONDUOC_ID in (1)         end        else        begin                select  distinct tk.DUOC_KEY, LTRIM(tk.PHAMVI_ID) as PHAMVI_ID, tk.NGUONDUOC_ID, nh.TENNGUONDUOC, nh.TINHTIEN, d.DUOC_ID, ld.MALOAIDUOC,        d.SOVISA,d.TYLE_VAT,d.COTOA, d.MADUOC, d.TENHANG, d.TENDUOCDAYDU, dvt.TENDONVITINH as DONVITINH, d.BHYT,        d.TENHOATCHAT, d.HAMLUONG, d.HANGSANXUAT, d.QUOCGIA, d.LOAIDUOC_ID, d.DUONGDUNG_ID, d.TINHTIEN_PTTT,        ten.TENDUOC, ten.TENDUOC_EN, ten.MAQUOCTE, ten.MAQUOCTEBT,        CASE WHEN d.BHYT = '1' THEN 'BHYT' ELSE '' END as BHYT_TEXT        , ld.LOAIVATTU_ID        , d.BENHVIEN_ID,        tk.SOLUONG, d.VTYT_PHANLOAI, d.PHAMVI, d.SUASOLUONGTONGHOP, d.MADUOCBV, d.DANGTRINHBAY        , TAMNGUNG = CASE WHEN d.TAMNGUNG = '1' OR nh.TAMNGUNG = '1' OR kd.TAMNGUNG = '1' THEN '1' ELSE '0' END        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        inner join        (        select  LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')) DUOC_KEY, (SUM(dtk.SOLUONG) - isnull(sum(A.SOLUONG),0) - isnull(sum(B.SOLUONG),0)) SOLUONG, pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        from (select sum(soluong) soluong,duoc_id,nguonduoc_id,khoduoc_id,benhvien_id from TT_DUOC_TONKHO  group by duoc_id,nguonduoc_id,khoduoc_id,benhvien_id) dtk        inner join TM_DUOC_PHAMVISD_MAPPING pvsd on dtk.KHODUOC_ID = pvsd.KHODUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NOITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) B on B.DUOC_ID = dtk.DUOC_ID and B.SOLUONG > 0 and B.PHAMVI_ID = pvsd.PHAMVI_ID and B.NGUONHANG_ID = dtk.NGUONDUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NGOAITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) A on A.DUOC_ID = dtk.DUOC_ID and A.SOLUONG > 0 and A.PHAMVI_ID = pvsd.PHAMVI_ID and A.NGUONHANG_ID = dtk.NGUONDUOC_ID        where dtk.SOLUONG > 0 and dtk.BENHVIEN_ID = 'HLU01'        group by LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')), pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        ) tk on tk.DUOC_ID = d.DUOC_ID        left join TM_DUOC_PHAMVISUDUNG kd on kd.PHAMVI_ID = tk.PHAMVI_ID and kd.BENHVIEN_ID = 'HLU01'        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = tk.NGUONDUOC_ID and nh.BENHVIEN_ID = 'HLU01'        where  d.BENHVIEN_ID = 'HLU01' and d.DUOC_ID in (1) and TK.PHAMVI_ID in (1055)        and tk.NGUONDUOC_ID in (1)         end]
2019-09-20 17:50:32,860 [1] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoCOM18UpdateRedis] PreparedStatement : [select distinct TT_TONKHO.DUOC_KEY, LTRIM(TT_TONKHO.KHODUOC_ID) as KHODUOC_ID, TM_DUOC.DUOC_ID, TM_LOAIDUOC.MALOAIDUOC,TM_DUOC.SOVISA,TM_DUOC.TYLE_VAT,TM_DUOC.COTOA,        TM_DUOC.MADUOC, TM_DUOC.TENHANG, TM_DUOC.TENDUOCDAYDU, dvt.TENDONVITINH as DONVITINH,  TM_DUOC.DONVITINH_ID,TM_DUOC.BHYT,        TM_DUOC.TENHOATCHAT,        TM_DUOC.HAMLUONG, TM_DUOC.HANGSANXUAT, TM_DUOC.QUOCGIA, TM_DUOC.LOAIDUOC_ID, TM_DUOC.DUONGDUNG_ID,        TM_TENDUOC.TENDUOC, TM_TENDUOC.TENDUOC_EN, TM_TENDUOC.MAQUOCTE, TM_TENDUOC.MAQUOCTEBT,        TM_LOAIDUOC.LOAIVATTU_ID, TM_DUOC.BENHVIEN_ID,        TT_TONKHO.SOLUONG, TM_DUOC.VTYT_PHANLOAI, TM_DUOC.PHAMVI, TT_TONKHO.NGUONDUOC_ID, NG.TENNGUONDUOC AS TENNGUONDUOC        , TAMNGUNG = CASE WHEN TM_DUOC.TAMNGUNG = '1' OR NG.TAMNGUNG = '1' OR KD.TAMNGUNG = '1' THEN '1' ELSE '0' END        , TM_DUOC.DANGTRINHBAY        from TM_DUOC        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = TM_DUOC.DONVITINH_ID        left join TM_TENDUOC on TM_DUOC.TENDUOC_ID = TM_TENDUOC.TENDUOC_ID and TM_DUOC.BENHVIEN_ID = 'HLU01' and TM_DUOC.TAMNGUNG = '0'        left join TM_LOAIDUOC on TM_LOAIDUOC.LOAIDUOC_ID = TM_DUOC.LOAIDUOC_ID and TM_LOAIDUOC.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG on (TM_LOAIDUOC.LOAIVATTU_ID = TM_DUOC_HANDUNG.LOAIDUOC and TM_DUOC_HANDUNG.BENHVIEN_ID = 'HLU01')        inner join        (select LTRIM(A.KHODUOC_ID) + '_' + LTRIM(A.DUOC_ID) + '_' + LTRIM(ISNULL(A.NGUONDUOC_ID,'')) as DUOC_KEY, A.KHODUOC_ID, A.DUOC_ID, A.NGUONDUOC_ID,        SUM(isnull(A.SOLUONG,0)) as SOLUONG        from        (select SUM(SOLUONG) as SOLUONG, KHODUOC_ID, DUOC_ID, NGUONDUOC_ID from TT_DUOC_TONKHO        where BENHVIEN_ID = 'HLU01' group by KHODUOC_ID, DUOC_ID, NGUONDUOC_ID) A        group by LTRIM(A.KHODUOC_ID) + '_' + LTRIM(A.DUOC_ID) + '_' + LTRIM(ISNULL(A.NGUONDUOC_ID,'')), A.KHODUOC_ID, A.DUOC_ID, NGUONDUOC_ID        ) TT_TONKHO on TT_TONKHO.DUOC_ID = TM_DUOC.DUOC_ID        LEFT JOIN TM_NGUONHANG NG ON NG.NGUONDUOC_ID = TT_TONKHO.NGUONDUOC_ID        LEFT JOIN TM_KHODUOC KD ON KD.KHODUOC_ID = TT_TONKHO.KHODUOC_ID        where TM_DUOC.BENHVIEN_ID = 'HLU01' and TT_TONKHO.SOLUONG >= 0        and TM_DUOC.DUOC_ID in (1)]
2019-09-20 17:50:32,916 [1] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoVaBookingCOM23UpdateRedis] PreparedStatement : [declare @NGUONDUOC_MACDINH varchar(5) = '0';        declare @TOAMUANGOAI int = 0;        select @NGUONDUOC_MACDINH = isnull(VALUE,0) from TM_SYS_APPSETTINGS where CODE = 'PHA_NGUONDUOC'        select @TOAMUANGOAI = isnull(VALUE,0) from TM_SYS_APPSETTINGS where CODE = 'OPD_TOAMUANGOAI_DUNGDANHMUC_DUOC'                if @TOAMUANGOAI = 1        begin        select  distinct '0' + '_' + LTRIM(d.DUOC_ID) + '_' + @NGUONDUOC_MACDINH as DUOC_KEY, 0 as PHAMVI_ID, @NGUONDUOC_MACDINH as NGUONDUOC_ID, null as TENNGUONDUOC, null as TINHTIEN, d.DUOC_ID, ld.MALOAIDUOC,        d.SOVISA,d.TYLE_VAT,d.COTOA, d.MADUOC, d.TENHANG, d.TENDUOCDAYDU, dvt.TENDONVITINH as DONVITINH, d.BHYT,        d.TENHOATCHAT, d.HAMLUONG, d.HANGSANXUAT, d.QUOCGIA, d.LOAIDUOC_ID, d.DUONGDUNG_ID, d.TINHTIEN_PTTT,        ten.TENDUOC, ten.TENDUOC_EN, ten.MAQUOCTE, ten.MAQUOCTEBT,        '' as BHYT_TEXT        , ld.LOAIVATTU_ID        , d.BENHVIEN_ID,        999999999 as SOLUONG, d.VTYT_PHANLOAI, d.PHAMVI, d.SUASOLUONGTONGHOP, d.MADUOCBV, d.DANGTRINHBAY        , TAMNGUNG = CASE WHEN d.TAMNGUNG = '1' THEN '1' ELSE '0' END        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        where d.DUOC_ID in (1)        union all        select  distinct tk.DUOC_KEY, LTRIM(tk.PHAMVI_ID) as PHAMVI_ID, tk.NGUONDUOC_ID, nh.TENNGUONDUOC, nh.TINHTIEN, d.DUOC_ID, ld.MALOAIDUOC,        d.SOVISA,d.TYLE_VAT,d.COTOA, d.MADUOC, d.TENHANG, d.TENDUOCDAYDU, dvt.TENDONVITINH as DONVITINH, d.BHYT,        d.TENHOATCHAT, d.HAMLUONG, d.HANGSANXUAT, d.QUOCGIA, d.LOAIDUOC_ID, d.DUONGDUNG_ID, d.TINHTIEN_PTTT,        ten.TENDUOC, ten.TENDUOC_EN, ten.MAQUOCTE, ten.MAQUOCTEBT,        CASE WHEN d.BHYT = '1' THEN 'BHYT' ELSE '' END as BHYT_TEXT        , ld.LOAIVATTU_ID        , d.BENHVIEN_ID,        tk.SOLUONG, d.VTYT_PHANLOAI, d.PHAMVI, d.SUASOLUONGTONGHOP, d.MADUOCBV, d.DANGTRINHBAY        , TAMNGUNG = CASE WHEN d.TAMNGUNG = '1' OR nh.TAMNGUNG = '1' OR kd.TAMNGUNG = '1' THEN '1' ELSE '0' END        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        inner join        (        select  LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')) DUOC_KEY, (SUM(dtk.SOLUONG) - isnull(sum(A.SOLUONG),0) - isnull(sum(B.SOLUONG),0)) SOLUONG, pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        from (select sum(soluong) soluong,duoc_id,nguonduoc_id,khoduoc_id,benhvien_id from TT_DUOC_TONKHO  group by duoc_id,nguonduoc_id,khoduoc_id,benhvien_id) dtk        inner join TM_DUOC_PHAMVISD_MAPPING pvsd on dtk.KHODUOC_ID = pvsd.KHODUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NOITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) B on B.DUOC_ID = dtk.DUOC_ID and B.SOLUONG > 0 and B.PHAMVI_ID = pvsd.PHAMVI_ID and B.NGUONHANG_ID = dtk.NGUONDUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NGOAITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) A on A.DUOC_ID = dtk.DUOC_ID and A.SOLUONG > 0 and A.PHAMVI_ID = pvsd.PHAMVI_ID and A.NGUONHANG_ID = dtk.NGUONDUOC_ID        where dtk.SOLUONG > 0 and dtk.BENHVIEN_ID = 'HLU01'        group by LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')), pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        ) tk on tk.DUOC_ID = d.DUOC_ID        left join TM_DUOC_PHAMVISUDUNG kd on kd.PHAMVI_ID = tk.PHAMVI_ID and kd.BENHVIEN_ID = 'HLU01'        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = tk.NGUONDUOC_ID and nh.BENHVIEN_ID = 'HLU01'        where  d.BENHVIEN_ID = 'HLU01' and d.DUOC_ID in (1)        end        else        begin        select  distinct tk.DUOC_KEY, LTRIM(tk.PHAMVI_ID) as PHAMVI_ID, tk.NGUONDUOC_ID, nh.TENNGUONDUOC, nh.TINHTIEN, d.DUOC_ID, ld.MALOAIDUOC,        d.SOVISA,d.TYLE_VAT,d.COTOA, d.MADUOC, d.TENHANG, d.TENDUOCDAYDU, dvt.TENDONVITINH as DONVITINH, d.BHYT,        d.TENHOATCHAT, d.HAMLUONG, d.HANGSANXUAT, d.QUOCGIA, d.LOAIDUOC_ID, d.DUONGDUNG_ID, d.TINHTIEN_PTTT,        ten.TENDUOC, ten.TENDUOC_EN, ten.MAQUOCTE, ten.MAQUOCTEBT,        CASE WHEN d.BHYT = '1' THEN 'BHYT' ELSE '' END as BHYT_TEXT        , ld.LOAIVATTU_ID        , d.BENHVIEN_ID,        tk.SOLUONG, d.VTYT_PHANLOAI, d.PHAMVI, d.SUASOLUONGTONGHOP, d.MADUOCBV, d.DANGTRINHBAY        , TAMNGUNG = CASE WHEN d.TAMNGUNG = '1' OR nh.TAMNGUNG = '1' OR kd.TAMNGUNG = '1' THEN '1' ELSE '0' END        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        inner join        (        select  LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')) DUOC_KEY, (SUM(dtk.SOLUONG) - isnull(sum(A.SOLUONG),0) - isnull(sum(B.SOLUONG),0)) SOLUONG, pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        from (select sum(soluong) soluong,duoc_id,nguonduoc_id,khoduoc_id,benhvien_id from TT_DUOC_TONKHO  group by duoc_id,nguonduoc_id,khoduoc_id,benhvien_id) dtk        inner join TM_DUOC_PHAMVISD_MAPPING pvsd on dtk.KHODUOC_ID = pvsd.KHODUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NOITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) B on B.DUOC_ID = dtk.DUOC_ID and B.SOLUONG > 0 and B.PHAMVI_ID = pvsd.PHAMVI_ID and B.NGUONHANG_ID = dtk.NGUONDUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NGOAITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) A on A.DUOC_ID = dtk.DUOC_ID and A.SOLUONG > 0 and A.PHAMVI_ID = pvsd.PHAMVI_ID and A.NGUONHANG_ID = dtk.NGUONDUOC_ID        where dtk.SOLUONG > 0 and dtk.BENHVIEN_ID = 'HLU01'        group by LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')), pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        ) tk on tk.DUOC_ID = d.DUOC_ID        left join TM_DUOC_PHAMVISUDUNG kd on kd.PHAMVI_ID = tk.PHAMVI_ID and kd.BENHVIEN_ID = 'HLU01'        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = tk.NGUONDUOC_ID and nh.BENHVIEN_ID = 'HLU01'        where  d.BENHVIEN_ID = 'HLU01' and d.DUOC_ID in (1)        end]
2019-09-20 17:51:02,484 [1] DEBUG - Statement Id: [DAO00030_GetList] PreparedStatement : [select *              from TT_DUOC_CHUNGTU              where BENHVIEN_ID = 'HLU01'                and                   TT_DUOC_CHUNGTU.CHUNGTU_ID = '137704'                               order by CHUNGTU_ID]
2019-09-20 17:51:02,586 [1] DEBUG - Statement Id: [DAO00030_CHUNGTUXUAT_CHITIET_GetList] PreparedStatement : [SELECT            ctct.*,            d.MADUOC, d.TENHANG, d.TENDUOCDAYDU, dvt.TENDONVITINH as DONVITINH,n.TENNGUONDUOC as NGUONHANG,            sln.SOLONHAP, sln.SOLOSANPHAM, sln.NGAYNHAP as NGAYNHAPLO, sln.HANDUNG as HANSUDUNG,            isnull(tk.SOLUONG,0) as SOLUONGTON,            LTRIM(ct.KHOXUAT_ID) + '_' + LTRIM(sln.DUOC_ID) + '_' + LTRIM(sln.NGUONDUOC_ID) as DUOC_KEY            , NLD.MANHOMLOAIDUOC, ld.MALOAIDUOC, D.SO_QDTT            FROM            TT_DUOC_CHUNGTU_CHITIET ctct            INNER JOIN TT_DUOC_CHUNGTU ct ON (ct.CHUNGTU_ID = ctct.CHUNGTU_ID)            INNER JOIN TT_DUOC_CHUNGTU_SOLONHAP sln ON (sln.SOLONHAP_ID = ctct.SOLONHAP_ID)            LEFT JOIN (            select xx.DUOCTONKHO_ID, xx.KHODUOC_ID, xx.DUOC_ID, xx.SOLONHAP_ID, xx.SOLUONG, xx.NGUONDUOC_ID, xx.BENHVIEN_ID from TT_DUOC_TONKHO xx            join ( select max(DUOCTONKHO_ID) as DUOCTONKHO_ID, KHODUOC_ID, DUOC_ID, SOLONHAP_ID, NGUONDUOC_ID            from TT_DUOC_TONKHO group by KHODUOC_ID, DUOC_ID, SOLONHAP_ID, NGUONDUOC_ID) yy on xx.DUOCTONKHO_ID=yy.DUOCTONKHO_ID            ) tk ON (tk.SOLONHAP_ID = sln.SOLONHAP_ID AND tk.DUOC_ID = sln.DUOC_ID and tk.KHODUOC_ID = ct.KHOXUAT_ID)            INNER JOIN TM_DUOC d ON (d.DUOC_ID = ctct.DUOC_ID)            INNER JOIN TM_NGUONHANG n ON (n.NGUONDUOC_ID = ctct.NGUONHANG_ID)            LEFT JOIN TM_DONVITINH dvt ON (dvt.DONVITINH_ID = ctct.DONVITINH_ID)            left join TM_LOAIDUOC LD on LD.LOAIDUOC_ID = D.LOAIDUOC_ID            LEFT JOIN TM_NHOMLOAIDUOC NLD on NLD.NHOMLOAIDUOC_ID = LD.NHOMLOAIDUOC_ID             where                             ct.CHUNGTU_ID = '137704'                       and                           ct.BENHVIEN_ID = 'HLU01'                                     order by CHUNGTUCHITIET_ID]
2019-09-20 17:51:02,861 [1] DEBUG - Statement Id: [DAO00030_KiemTraChungTuKhoaSo] PreparedStatement : [SELECT CHUNGTU_ID              FROM TT_DUOC_CHUNGTU              WHERE              MACHUNGTU = 'CS_KBX1319003092'              and BENHVIEN_ID = 'HLU01'              and              convert(date, NGAYCHUNGTU) <=              (              SELECT TOP 1 convert(date, KHOADENNGAY)              FROM TT_DUOC_KHOASOCHUNGTU              WHERE              KHODUOC_ID = '32'              and BENHVIEN_ID = 'HLU01'              AND KHOASO = '1'              ORDER BY KHOADENNGAY DESC              )]
2019-09-20 17:51:02,894 [1] DEBUG - Statement Id: [DAO00030_KiemTraChungTuDaChuyenKeToan] PreparedStatement : [SELECT CHUNGTU_ID            FROM TT_DUOC_CHUNGTU            WHERE            CHUNGTU_ID = '137704'            and IDCHUYEN IS NOT NULL            and BENHVIEN_ID = 'HLU01']
2019-09-20 17:51:02,923 [1] DEBUG - Statement Id: [DAO00030_KiemTraBenhNhanXuatVien] PreparedStatement : [select              TT.TOATHUOC_ID              from              TT_NOITRU_TOATHUOC TT              inner join TT_NOITRU_KHAMBENH KB on TT.KHAMBENH_ID = KB.KHAMBENH_ID              inner join TT_NOITRU_BENHAN BA on BA.BENHAN_ID = KB.BENHAN_ID              WHERE              BA.TRANGTHAI = 'DAXUATVIEN'              AND TT.CHUNGTU_ID =  137704              and TT.BENHVIEN_ID = 'HLU01']
2019-09-20 17:51:03,109 [1] DEBUG - Statement Id: [DAO00030_DUOCTONKHO_GetSoTonTheoDuoc] PreparedStatement : [SELECT              DUOC_ID,              SUM(SOLUONG) AS TONGTON              FROM              TT_DUOC_TONKHO              WHERE              KHODUOC_ID = '32'              and BENHVIEN_ID = 'HLU01'              and DUOC_ID IN (1)              GROUP BY DUOC_ID]
2019-09-20 17:51:03,189 [1] DEBUG - Statement Id: [DAO00030_DUOCTONKHO_GetSoTonTheoDuocTheoLo] PreparedStatement : [SELECT              DUOC_ID,SOLONHAP_ID,              SUM(SOLUONG) AS SOLUONGTONLO              FROM              TT_DUOC_TONKHO              WHERE              KHODUOC_ID = '32'              and BENHVIEN_ID = 'HLU01'              and DUOC_ID IN (1)              and SOLONHAP_ID IN (7541)              GROUP BY DUOC_ID, SOLONHAP_ID]
2019-09-20 17:51:03,218 [1] DEBUG - Statement Id: [DAO00030_DUOCTONKHO_GetSoTonTheoDuoc] PreparedStatement : [SELECT              DUOC_ID,              SUM(SOLUONG) AS TONGTON              FROM              TT_DUOC_TONKHO              WHERE              KHODUOC_ID = '32'              and BENHVIEN_ID = 'HLU01'              and DUOC_ID IN (1)              GROUP BY DUOC_ID]
--------------------------------------------------------------------------------
2019-09-20 18:15:51,330 [1] DEBUG - Statement Id: [DAO00001_DBList] PreparedStatement : [select *              from TM_SYS_SERVER              where HOSPITAL_ID = '_SYSTEM_' and TYPE = 'D']
2019-09-20 18:15:51,613 [1] DEBUG - Statement Id: [DAO00001_DaoList] PreparedStatement : [select              TM_SYS_SERVICEMAP.ID,              TM_SYS_SERVICEMAP.HOSPITAL_ID,              TM_SYS_SERVICEMAP.DB_NAME,              TM_SYS_SERVICEMAP.TYPE,              TM_SYS_SERVICEMAP.NAME,              TM_SYS_SERVICEMAP.CLASS,              (TM_SYS_DIC.VALUE + '.' + TM_SYS_SERVICEMAP.CLASS) as CLASSFULL,              TM_SYS_SERVICEMAP.ASSEMBLY              from TM_SYS_SERVICEMAP              inner join TM_SYS_DIC              on TM_SYS_SERVICEMAP.NAMESPACE = TM_SYS_DIC.ID              where HOSPITAL_ID = '_SYSTEM_' AND TYPE = 'D' AND ACTIVE = '1'              order by DB_NAME]
2019-09-20 18:15:51,650 [1] DEBUG - Statement Id: [DAO00001_ServiceList] PreparedStatement : [select              TM_SYS_SERVICEMAP.ID,              TM_SYS_SERVICEMAP.HOSPITAL_ID,              TM_SYS_SERVICEMAP.DB_NAME,              TM_SYS_SERVICEMAP.TYPE,              TM_SYS_SERVICEMAP.NAME,              TM_SYS_SERVICEMAP.CLASS,              (TM_SYS_DIC.VALUE + '.' + TM_SYS_SERVICEMAP.CLASS) as CLASSFULL,              TM_SYS_SERVICEMAP.ASSEMBLY,              TM_SYS_SERVER.URL              from TM_SYS_SERVICEMAP              inner join TM_SYS_DIC on TM_SYS_SERVICEMAP.NAMESPACE = TM_SYS_DIC.ID              inner join TM_SYS_SERVER on (TM_SYS_SERVICEMAP.DB_NAME = TM_SYS_SERVER.NAME) and (TM_SYS_SERVER.HOSPITAL_ID = '_SYSTEM_')              where TM_SYS_SERVICEMAP.HOSPITAL_ID = '_SYSTEM_' AND TM_SYS_SERVICEMAP.TYPE = 'S'  AND ACTIVE = '1'              order by URL]
2019-09-20 18:15:52,103 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = '_SYSTEM_'               AND                   TM_SYS_SCREEN.PAGE = 'LOGIN'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2019-09-20 18:15:52,398 [1] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = '_SYSTEM_'               AND                   TM_SYS_CACHE.ACTIVE = '1']
2019-09-20 18:16:00,214 [1] DEBUG - Statement Id: [DAO00001_DBList] PreparedStatement : [select *              from TM_SYS_SERVER              where HOSPITAL_ID = 'HLU01' and TYPE = 'D']
2019-09-20 18:16:00,315 [1] DEBUG - Statement Id: [DAO00001_DaoList] PreparedStatement : [select              TM_SYS_SERVICEMAP.ID,              TM_SYS_SERVICEMAP.HOSPITAL_ID,              TM_SYS_SERVICEMAP.DB_NAME,              TM_SYS_SERVICEMAP.TYPE,              TM_SYS_SERVICEMAP.NAME,              TM_SYS_SERVICEMAP.CLASS,              (TM_SYS_DIC.VALUE + '.' + TM_SYS_SERVICEMAP.CLASS) as CLASSFULL,              TM_SYS_SERVICEMAP.ASSEMBLY              from TM_SYS_SERVICEMAP              inner join TM_SYS_DIC              on TM_SYS_SERVICEMAP.NAMESPACE = TM_SYS_DIC.ID              where HOSPITAL_ID = 'HLU01' AND TYPE = 'D' AND ACTIVE = '1'              order by DB_NAME]
2019-09-20 18:16:03,223 [1] DEBUG - Statement Id: [DAO00001_ServiceList] PreparedStatement : [select              TM_SYS_SERVICEMAP.ID,              TM_SYS_SERVICEMAP.HOSPITAL_ID,              TM_SYS_SERVICEMAP.DB_NAME,              TM_SYS_SERVICEMAP.TYPE,              TM_SYS_SERVICEMAP.NAME,              TM_SYS_SERVICEMAP.CLASS,              (TM_SYS_DIC.VALUE + '.' + TM_SYS_SERVICEMAP.CLASS) as CLASSFULL,              TM_SYS_SERVICEMAP.ASSEMBLY,              TM_SYS_SERVER.URL              from TM_SYS_SERVICEMAP              inner join TM_SYS_DIC on TM_SYS_SERVICEMAP.NAMESPACE = TM_SYS_DIC.ID              inner join TM_SYS_SERVER on (TM_SYS_SERVICEMAP.DB_NAME = TM_SYS_SERVER.NAME) and (TM_SYS_SERVER.HOSPITAL_ID = 'HLU01')              where TM_SYS_SERVICEMAP.HOSPITAL_ID = 'HLU01' AND TM_SYS_SERVICEMAP.TYPE = 'S'  AND ACTIVE = '1'              order by URL]
2019-09-20 18:16:03,304 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1']
2019-09-20 18:16:04,241 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM005']
2019-09-20 18:16:04,434 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM015']
2019-09-20 18:16:04,508 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM067']
2019-09-20 18:16:04,578 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM008']
2019-09-20 18:16:04,652 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM068']
2019-09-20 18:16:04,735 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM006']
2019-09-20 18:16:04,809 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM030']
2019-09-20 18:16:04,882 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM025']
2019-09-20 18:16:04,962 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM024']
2019-09-20 18:16:05,473 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM033']
2019-09-20 18:16:05,513 [5] DEBUG - Statement Id: [DAO00027_GetListDuocKyGuiTonKho] PreparedStatement : [select  distinct TT_TONKHO.DUOC_KEY, LTRIM(TT_TONKHO.KHODUOC_ID) as KHODUOC_ID, TM_DUOC.DUOC_ID, TM_LOAIDUOC.MALOAIDUOC,TM_DUOC.SOVISA,TM_DUOC.TYLE_VAT,TM_DUOC.COTOA,        TM_DUOC.MADUOC, TM_DUOC.TENHANG, TM_DUOC.TENDUOCDAYDU, dvt.TENDONVITINH as DONVITINH,  TM_DUOC.DONVITINH_ID,TM_DUOC.BHYT,TM_DUOC.PHAMVI,        TM_DUOC.TENHOATCHAT, TM_DUOC.HAMLUONG, TM_DUOC.HANGSANXUAT, TM_DUOC.QUOCGIA, TM_DUOC.LOAIDUOC_ID, TM_DUOC.DUONGDUNG_ID,        TM_TENDUOC.TENDUOC, TM_TENDUOC.TENDUOC_EN, TM_TENDUOC.MAQUOCTE, TM_TENDUOC.MAQUOCTEBT,        TM_LOAIDUOC.LOAIVATTU_ID, TM_DUOC.BENHVIEN_ID,TT_TONKHO.SOLUONG, TT_TONKHO.NGUONDUOC_ID, NH.TENNGUONDUOC        , TAMNGUNG = CASE WHEN TM_DUOC.TAMNGUNG = '1' OR nh.TAMNGUNG = '1' OR KD.TAMNGUNG = '1' THEN '1' ELSE '0' END        , TM_DUOC.DANGTRINHBAY        from TM_DUOC        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = TM_DUOC.DONVITINH_ID        left join TM_TENDUOC on TM_DUOC.TENDUOC_ID = TM_TENDUOC.TENDUOC_ID and TM_DUOC.BENHVIEN_ID = 'HLU01' and TM_DUOC.TAMNGUNG = '0'        left join TM_LOAIDUOC on TM_LOAIDUOC.LOAIDUOC_ID = TM_DUOC.LOAIDUOC_ID and TM_LOAIDUOC.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG on (TM_LOAIDUOC.LOAIVATTU_ID = TM_DUOC_HANDUNG.LOAIDUOC and TM_DUOC_HANDUNG.BENHVIEN_ID = 'HLU01')        inner join        (select LTRIM(A.KHODUOC_ID) + '_' + LTRIM(A.DUOC_ID) + '_' + LTRIM(ISNULL(A.NGUONDUOC_ID,'')) as DUOC_KEY, A.KHODUOC_ID, A.DUOC_ID,A.NGUONDUOC_ID,        SUM(isnull(A.SOLUONG,0)) as SOLUONG        from        (select SUM(SOLUONG) as SOLUONG, KHODUOC_ID, DUOC_ID, NGUONDUOC_ID from TT_DUOC_KYGUI_TONKHO        where BENHVIEN_ID = 'HLU01' group by KHODUOC_ID, DUOC_ID, NGUONDUOC_ID) A        group by LTRIM(A.KHODUOC_ID) + '_' + LTRIM(A.DUOC_ID) + '_' + LTRIM(A.NGUONDUOC_ID), A.KHODUOC_ID, A.DUOC_ID, A.NGUONDUOC_ID)        TT_TONKHO on TT_TONKHO.DUOC_ID = TM_DUOC.DUOC_ID        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = TT_TONKHO.NGUONDUOC_ID and nh.BENHVIEN_ID = 'HLU01'        LEFT JOIN TM_KHODUOC KD ON KD.KHODUOC_ID = TT_TONKHO.KHODUOC_ID        where TM_DUOC.BENHVIEN_ID = 'HLU01' AND TT_TONKHO.SOLUONG >= 0]
2019-09-20 18:16:05,585 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM018']
2019-09-20 18:16:05,723 [5] DEBUG - Statement Id: [DAO00027_GetListDuocTonKho] PreparedStatement : [select distinct TT_TONKHO.DUOC_KEY, LTRIM(TT_TONKHO.KHODUOC_ID) as KHODUOC_ID, TM_DUOC.DUOC_ID, TM_LOAIDUOC.MALOAIDUOC,TM_DUOC.SOVISA,TM_DUOC.TYLE_VAT,TM_DUOC.COTOA,        TM_DUOC.MADUOC, TM_DUOC.TENHANG, TM_DUOC.TENDUOCDAYDU, dvt.TENDONVITINH as DONVITINH,  TM_DUOC.DONVITINH_ID,TM_DUOC.BHYT,                TM_DUOC.TENHOATCHAT,          TM_DUOC.HAMLUONG, TM_DUOC.HANGSANXUAT, TM_DUOC.QUOCGIA, TM_DUOC.LOAIDUOC_ID, TM_DUOC.DUONGDUNG_ID,        TM_TENDUOC.TENDUOC, TM_TENDUOC.TENDUOC_EN, TM_TENDUOC.MAQUOCTE, TM_TENDUOC.MAQUOCTEBT,        TM_LOAIDUOC.LOAIVATTU_ID, TM_DUOC.BENHVIEN_ID,        TT_TONKHO.SOLUONG, TM_DUOC.VTYT_PHANLOAI, TM_DUOC.PHAMVI, TT_TONKHO.NGUONDUOC_ID, NG.TENNGUONDUOC AS TENNGUONDUOC        , TAMNGUNG = CASE WHEN TM_DUOC.TAMNGUNG = '1' OR NG.TAMNGUNG = '1' OR KD.TAMNGUNG = '1' THEN '1' ELSE '0' END        , TM_DUOC.DANGTRINHBAY        from TM_DUOC        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = TM_DUOC.DONVITINH_ID        left join TM_TENDUOC on TM_DUOC.TENDUOC_ID = TM_TENDUOC.TENDUOC_ID and TM_DUOC.BENHVIEN_ID = 'HLU01' and TM_DUOC.TAMNGUNG = '0'        left join TM_LOAIDUOC on TM_LOAIDUOC.LOAIDUOC_ID = TM_DUOC.LOAIDUOC_ID and TM_LOAIDUOC.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG on (TM_LOAIDUOC.LOAIVATTU_ID = TM_DUOC_HANDUNG.LOAIDUOC and TM_DUOC_HANDUNG.BENHVIEN_ID = 'HLU01')        inner join        (select LTRIM(A.KHODUOC_ID) + '_' + LTRIM(A.DUOC_ID) + '_' + LTRIM(ISNULL(A.NGUONDUOC_ID,'')) as DUOC_KEY, A.KHODUOC_ID, A.DUOC_ID, A.NGUONDUOC_ID,        SUM(isnull(A.SOLUONG,0)) as SOLUONG        from        (select SUM(SOLUONG) as SOLUONG, KHODUOC_ID, DUOC_ID, NGUONDUOC_ID from TT_DUOC_TONKHO        where BENHVIEN_ID = 'HLU01' group by KHODUOC_ID, DUOC_ID, NGUONDUOC_ID) A        group by LTRIM(A.KHODUOC_ID) + '_' + LTRIM(A.DUOC_ID) + '_' + LTRIM(ISNULL(A.NGUONDUOC_ID,'')), A.KHODUOC_ID, A.DUOC_ID, NGUONDUOC_ID        ) TT_TONKHO on TT_TONKHO.DUOC_ID = TM_DUOC.DUOC_ID        LEFT JOIN TM_NGUONHANG NG ON NG.NGUONDUOC_ID = TT_TONKHO.NGUONDUOC_ID        LEFT JOIN TM_KHODUOC KD ON KD.KHODUOC_ID = TT_TONKHO.KHODUOC_ID        where TM_DUOC.BENHVIEN_ID = 'HLU01' and TT_TONKHO.SOLUONG >= 0]
2019-09-20 18:16:07,205 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM023']
2019-09-20 18:16:07,255 [5] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoVaBooking] PreparedStatement : [declare @NGUONDUOC_MACDINH varchar(5) = '0';        declare @TOAMUANGOAI int = 0;        select @NGUONDUOC_MACDINH = isnull(VALUE,0) from TM_SYS_APPSETTINGS where CODE = 'PHA_NGUONDUOC'        select @TOAMUANGOAI = isnull(VALUE,0) from TM_SYS_APPSETTINGS where CODE = 'OPD_TOAMUANGOAI_DUNGDANHMUC_DUOC'                if @TOAMUANGOAI = 1        begin        select  distinct '0' + '_' + LTRIM(d.DUOC_ID) + '_' + @NGUONDUOC_MACDINH as DUOC_KEY, 0 as PHAMVI_ID, @NGUONDUOC_MACDINH as NGUONDUOC_ID, null as TENNGUONDUOC, null as TINHTIEN, d.DUOC_ID, ld.MALOAIDUOC,        d.SOVISA,d.TYLE_VAT,d.COTOA, d.MADUOC, d.TENHANG, d.TENDUOCDAYDU, d.DONVITINH as DONVITINH, d.BHYT,        d.TENHOATCHAT, d.HAMLUONG, d.HANGSANXUAT, d.QUOCGIA, d.LOAIDUOC_ID, d.DUONGDUNG_ID, d.TINHTIEN_PTTT,        ten.TENDUOC, ten.TENDUOC_EN, ten.MAQUOCTE, ten.MAQUOCTEBT,        '' as BHYT_TEXT        , ld.LOAIVATTU_ID        , d.BENHVIEN_ID,        999999999 as SOLUONG, d.VTYT_PHANLOAI, d.PHAMVI, d.SUASOLUONGTONGHOP, d.MADUOCBV, d.DANGTRINHBAY        , TAMNGUNG = CASE WHEN d.TAMNGUNG = '1' THEN '1' ELSE '0' END        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        union all        select  distinct tk.DUOC_KEY, LTRIM(tk.PHAMVI_ID) as PHAMVI_ID, tk.NGUONDUOC_ID, nh.TENNGUONDUOC, nh.TINHTIEN, d.DUOC_ID, ld.MALOAIDUOC,        d.SOVISA,d.TYLE_VAT,d.COTOA, d.MADUOC, d.TENHANG, d.TENDUOCDAYDU, d.DONVITINH as DONVITINH, d.BHYT,        d.TENHOATCHAT, d.HAMLUONG, d.HANGSANXUAT, d.QUOCGIA, d.LOAIDUOC_ID, d.DUONGDUNG_ID, d.TINHTIEN_PTTT,        ten.TENDUOC, ten.TENDUOC_EN, ten.MAQUOCTE, ten.MAQUOCTEBT,        CASE WHEN d.BHYT = '1' THEN 'BHYT' ELSE '' END as BHYT_TEXT        , ld.LOAIVATTU_ID        , d.BENHVIEN_ID,        tk.SOLUONG, d.VTYT_PHANLOAI, d.PHAMVI, d.SUASOLUONGTONGHOP, d.MADUOCBV, d.DANGTRINHBAY        , TAMNGUNG = CASE WHEN d.TAMNGUNG = '1' OR nh.TAMNGUNG = '1' OR kd.TAMNGUNG = '1' THEN '1' ELSE '0' END        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        inner join        (        select  LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')) DUOC_KEY, (SUM(dtk.SOLUONG) - isnull(sum(A.SOLUONG),0) - isnull(sum(B.SOLUONG),0)) SOLUONG, pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        from (select sum(soluong) soluong,duoc_id,nguonduoc_id,khoduoc_id,benhvien_id from TT_DUOC_TONKHO  group by duoc_id,nguonduoc_id,khoduoc_id,benhvien_id) dtk        inner join TM_DUOC_PHAMVISD_MAPPING pvsd on dtk.KHODUOC_ID = pvsd.KHODUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NOITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) B on B.DUOC_ID = dtk.DUOC_ID and B.SOLUONG > 0 and B.PHAMVI_ID = pvsd.PHAMVI_ID and B.NGUONHANG_ID = dtk.NGUONDUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NGOAITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) A on A.DUOC_ID = dtk.DUOC_ID and A.SOLUONG > 0 and A.PHAMVI_ID = pvsd.PHAMVI_ID and A.NGUONHANG_ID = dtk.NGUONDUOC_ID        where dtk.SOLUONG > 0 and dtk.BENHVIEN_ID = 'HLU01'        group by LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')), pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        ) tk on tk.DUOC_ID = d.DUOC_ID        left join TM_DUOC_PHAMVISUDUNG kd on kd.PHAMVI_ID = tk.PHAMVI_ID and kd.BENHVIEN_ID = 'HLU01'        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = tk.NGUONDUOC_ID and nh.BENHVIEN_ID = 'HLU01'        where d.BENHVIEN_ID = 'HLU01'  and tk.SOLUONG >= 0        end        else        begin                  select  distinct tk.DUOC_KEY, LTRIM(tk.PHAMVI_ID) as PHAMVI_ID, tk.NGUONDUOC_ID, nh.TENNGUONDUOC, nh.TINHTIEN, d.DUOC_ID, ld.MALOAIDUOC,        d.SOVISA,d.TYLE_VAT,d.COTOA, d.MADUOC, d.TENHANG, d.TENDUOCDAYDU, d.DONVITINH as DONVITINH, d.BHYT,        d.TENHOATCHAT, d.HAMLUONG, d.HANGSANXUAT, d.QUOCGIA, d.LOAIDUOC_ID, d.DUONGDUNG_ID, d.TINHTIEN_PTTT,        ten.TENDUOC, ten.TENDUOC_EN, ten.MAQUOCTE, ten.MAQUOCTEBT,        CASE WHEN d.BHYT = '1' THEN 'BHYT' ELSE '' END as BHYT_TEXT        , ld.LOAIVATTU_ID        , d.BENHVIEN_ID,        tk.SOLUONG, d.VTYT_PHANLOAI, d.PHAMVI, d.SUASOLUONGTONGHOP, d.MADUOCBV, d.DANGTRINHBAY        , TAMNGUNG = CASE WHEN d.TAMNGUNG = '1' OR nh.TAMNGUNG = '1' OR kd.TAMNGUNG = '1' THEN '1' ELSE '0' END        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        inner join        (        select  LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')) DUOC_KEY, (SUM(dtk.SOLUONG) - isnull(sum(A.SOLUONG),0) - isnull(sum(B.SOLUONG),0)) SOLUONG, pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        from (select sum(soluong) soluong,duoc_id,nguonduoc_id,khoduoc_id,benhvien_id from TT_DUOC_TONKHO  group by duoc_id,nguonduoc_id,khoduoc_id,benhvien_id) dtk        inner join TM_DUOC_PHAMVISD_MAPPING pvsd on dtk.KHODUOC_ID = pvsd.KHODUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NOITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) B on B.DUOC_ID = dtk.DUOC_ID and B.SOLUONG > 0 and B.PHAMVI_ID = pvsd.PHAMVI_ID and B.NGUONHANG_ID = dtk.NGUONDUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NGOAITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) A on A.DUOC_ID = dtk.DUOC_ID and A.SOLUONG > 0 and A.PHAMVI_ID = pvsd.PHAMVI_ID and A.NGUONHANG_ID = dtk.NGUONDUOC_ID        where dtk.SOLUONG > 0 and dtk.BENHVIEN_ID = 'HLU01'        group by LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')), pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        ) tk on tk.DUOC_ID = d.DUOC_ID        left join TM_DUOC_PHAMVISUDUNG kd on kd.PHAMVI_ID = tk.PHAMVI_ID and kd.BENHVIEN_ID = 'HLU01'        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = tk.NGUONDUOC_ID and nh.BENHVIEN_ID = 'HLU01'        where d.BENHVIEN_ID = 'HLU01'  and tk.SOLUONG >= 0        end]
2019-09-20 18:16:09,166 [5] DEBUG - Statement Id: [DAO00320_GetList] PreparedStatement : [select M.*            from TM_MAU M            LEFT JOIN TM_MAU_DONVITINH DVT on M.DONVITINH_ID=DVT.DONVITINH_ID            where            M.TAMNGUNG = '0'            and M.BENHVIEN_ID = 'HLU01'            order by M.TENMAU]
2019-09-20 18:16:09,236 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM071']
2019-09-20 18:16:09,284 [5] DEBUG - Statement Id: [DAO00322_GetListMauTonKhoForCreateCached] PreparedStatement : [SELECT DISTINCT          TK.MAU_KEY, TK.KHOMAU_ID, M.MAU_ID, M.MAMAU, M.TENMAU, M.NHOM_ABO, M.NHOM_RH, M.LOAIMAU_ID,          TK.SOLONHAP_ID, SLN.SOLONHAP, SLN.SOKIEMSOAT, TK.NGUONHANG_ID, NG.TENNGUONMAU, M.BENHVIEN_ID, M.DONVITINH_ID,          SUM(tk.SOLUONG) AS SOLUONG,K.TENKHO,DVT.TENDONVITINH          FROM TT_MAU_TONKHO TK          JOIN TM_KHO K ON TK.KHOMAU_ID = K.KHO_ID          JOIN TT_MAU_CHUNGTU_SOLONHAP SLN ON TK.SOLONHAP_ID = SLN.SOLONHAP_ID          JOIN TM_MAU M on TK.MAU_ID = M.MAU_ID and M.TAMNGUNG = '0'          LEFT JOIN TM_MAU_DONVITINH DVT on M.DONVITINH_ID=DVT.DONVITINH_ID          LEFT JOIN TM_NGUONMAU NG ON NG.NGUONMAU_ID = TK.NGUONHANG_ID          WHERE TK.SOLUONG > 0          GROUP BY TK.MAU_KEY, TK.KHOMAU_ID, M.MAU_ID, M.MAMAU, M.TENMAU, M.NHOM_ABO, M.NHOM_RH, M.LOAIMAU_ID,          TK.SOLONHAP_ID, SLN.SOLONHAP, SLN.SOKIEMSOAT,TK.NGUONHANG_ID, NG.TENNGUONMAU, M.BENHVIEN_ID, M.DONVITINH_ID,K.TENKHO,DVT.TENDONVITINH]
2019-09-20 18:16:09,355 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM073']
2019-09-20 18:16:09,391 [5] DEBUG - Statement Id: [DAO00322_GetListMauTonKhoTruBooking] PreparedStatement : [select distinct          TK.MAU_KEY, TK.KHOMAU_ID, M.MAU_ID, M.MAMAU, M.TENMAU, M.NHOM_ABO, M.NHOM_RH, M.LOAIMAU_ID, M.DONVITINH_ID,          TK.SOLONHAP_ID, TK.SOLONHAP, TK.SOKIEMSOAT,M.PHAMVI, TK.NGUONHANG_ID, NG.TENNGUONMAU, M.BENHVIEN_ID,          TK.SOLUONG,TK.TENKHO,DVT.TENDONVITINH          from TM_MAU M          JOIN          (          select          A.MAU_KEY, A.KHOMAU_ID, A.MAU_ID ,a.NGUONHANG_ID, A.SOLONHAP_ID, A.SOLONHAP, A.SOKIEMSOAT, A.SOLUONG,A.TENKHO          from          (          select KHOMAU_ID, TK.MAU_ID, TK.NGUONHANG_ID, TK.MAU_KEY, SLN.SOLONHAP_ID, SLN.SOLONHAP, SLN.SOKIEMSOAT, ISNULL(TK.SOLUONG,0) - ISNULL(book.SOLUONG,0) as SOLUONG,K.TENKHO          from TT_MAU_TONKHO TK          JOIN TM_KHO K ON TK.KHOMAU_ID = K.KHO_ID          inner join TT_MAU_CHUNGTU_SOLONHAP SLN ON TK.SOLONHAP_ID = SLN.SOLONHAP_ID          left join dbo.TT_MAU_TONKHO_BOOK book ON book.MAU_KEY = TK.MAU_KEY AND book.TRANGTHAI = 'HIEULUC'          where ISNULL(TK.SOLUONG,0) - ISNULL(book.SOLUONG,0) > 0          ) A          )TK on TK.MAU_ID = M.MAU_ID and M.TAMNGUNG = '0'          LEFT JOIN TM_MAU_DONVITINH DVT on M.DONVITINH_ID=DVT.DONVITINH_ID          LEFT JOIN TM_NGUONMAU NG ON NG.NGUONMAU_ID = TK.NGUONHANG_ID]
2019-09-20 18:16:09,510 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM072']
2019-09-20 18:16:10,442 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'MAIN'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2019-09-20 18:16:11,678 [1] DEBUG - Statement Id: [DAO00002_FormList] PreparedStatement : [select              TM_SYS_FORM.HOSPITAL_ID,              TM_SYS_FORM.NAME,              TM_SYS_FORM.CLASS,              TM_SYS_FORM.ASSEMBLY,              TM_SYS_FORM.TITLE_VI as TITLE              from TM_SYS_FORM              where HOSPITAL_ID = 'HLU01']
2019-09-20 18:16:17,359 [1] DEBUG - Statement Id: [DAO00300_GetShortcutListByUserID] PreparedStatement : [SELECT S.SHORTCUT_CODE, S.SHORTCUT_VALUE              FROM TM_SHORTCUT AS S              WHERE S.BENHVIEN_ID = 'HLU01' AND S.USER_ID = '1' AND TAMNGUNG = '0']
2019-09-20 18:16:17,391 [1] DEBUG - Statement Id: [DAO00087_GetList] PreparedStatement : [select CODE, VALUE, BENHVIEN_ID              from TM_SYS_APPSETTINGS              where LOCKED = '0' and BENHVIEN_ID = 'HLU01'              order by SETTING_ID]
2019-09-20 18:16:17,461 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'MSG01'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2019-09-20 18:16:17,608 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'MSG02'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2019-09-20 18:16:17,806 [1] DEBUG - Statement Id: [DAO00008_GetUserSettings] PreparedStatement : [select A.*, B.TENKHO , C.TENPHONGBAN, B.MAKHO, C.MAPHONGBAN          from TM_SYS_USERS A          left join TM_KHODUOC B on B.KHODUOC_ID = A.INVENTORY_ID          left join TM_PHONGBAN C on (C.PHONGBAN_ID = A.WORKING_DEPT_ID and C.BENHVIEN_ID =  @param0 )          left join TM_SYS_USERKHO D on (D.ACCOUNT_ID = A.ACCOUNT_ID and D.HOSPITAL_ID =  @param0 )          where          A.HOSPITAL_ID =  @param0            and                 A.ACCOUNT_ID =  @param1]
2019-09-20 18:16:17,807 [1] DEBUG - Statement Id: [DAO00008_GetUserSettings] Parameters: [@param0=[HOSPITAL_ID,HLU01], @param1=[ACCOUNT_ID,113]]
2019-09-20 18:16:17,807 [1] DEBUG - Statement Id: [DAO00008_GetUserSettings] Types: [@param0=[String, System.String], @param1=[String, System.String]]
2019-09-20 18:16:17,838 [1] DEBUG - Statement Id: [DAO00008_GetUserInvSettings] PreparedStatement : [select A.*, B.TENKHO, B.MAKHO, B.LOAIKHO_ID, B.KHOQUANLY_ID          from TM_SYS_USERKHO A          left join TM_KHO B on B.MODULE_ID = A.MODULE_ID and B.KHO_ID = A.KHO_ID          where A.HOSPITAL_ID =  @param0  and A.ACCOUNT_ID =  @param1           order by B.TENKHO]
2019-09-20 18:16:17,839 [1] DEBUG - Statement Id: [DAO00008_GetUserInvSettings] Parameters: [@param0=[HOSPITAL_ID,HLU01], @param1=[ACCOUNT_ID,113]]
2019-09-20 18:16:17,839 [1] DEBUG - Statement Id: [DAO00008_GetUserInvSettings] Types: [@param0=[String, System.String], @param1=[String, System.String]]
2019-09-20 18:16:17,977 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'COM30'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2019-09-20 18:16:18,156 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'RIS04'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2019-09-20 18:16:27,962 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'MENU1'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2019-09-20 18:16:28,128 [1] DEBUG - Statement Id: [DAO00011_GetList] PreparedStatement : [select              TM_SYS_MENU.ID,              TM_SYS_MENU.PARENTID,              TM_SYS_MENU.SCREEN,              TM_SYS_MENU.SMALLIMAGE,              TM_SYS_MENU.LARGEIMAGE,              TM_SYS_MENU.DESCRIPTION,              TM_SYS_MENU.TYPE,              TM_SYS_MENU.TITLE_VI as TITLE              from TM_SYS_MENU              where TM_SYS_MENU.HOSPITAL_ID = 'HLU01' and TM_SYS_MENU.ACTIVE = '1'               AND                   (TM_SYS_MENU.TYPE & '8' = '8')                             order by TM_SYS_MENU.ORDERNUM]
2019-09-20 18:16:28,643 [1] DEBUG - Statement Id: [DAO00011_usermenu_list] PreparedStatement : [select              TM_SYS_HOMEMENU.MENUID as ID,              TM_SYS_MENU.TITLE_VI as TITLE,              TM_SYS_MENU.SCREEN,              TM_SYS_MENU.SMALLIMAGE,              TM_SYS_MENU.LARGEIMAGE,              TM_SYS_MENU.TYPE              from TM_SYS_HOMEMENU              left join TM_SYS_MENU on TM_SYS_MENU.ID = TM_SYS_HOMEMENU.MENUID and TM_SYS_MENU.HOSPITAL_ID = TM_SYS_HOMEMENU.HOSPITAL_ID              where TM_SYS_HOMEMENU.HOSPITAL_ID = 'HLU01' and TM_SYS_HOMEMENU.USERID = '113' and TM_SYS_MENU.ACTIVE = '1'               AND                   (TM_SYS_MENU.TYPE & '8' = '8')                             ORDER BY TM_SYS_HOMEMENU.ORDERNUM]
2019-09-20 18:16:55,210 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'OPD45'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2019-09-20 18:16:56,126 [1] DEBUG - Statement Id: [DAO00017_GetLoaiGiaByDoiTuongId] PreparedStatement : [select dtlg.DOUUTIEN, dtlg.DOITUONG_ID, lg.LOAIGIA_ID, lg.TENLOAIGIA, lg.MALOAIGIA              from TM_LOAIGIA lg              left join TM_DOITUONG_LOAIGIA dtlg              on lg.LOAIGIA_ID = dtlg.LOAIGIA_ID and dtlg.BENHVIEN_ID = 'HLU01'              where lg.TAMNGUNG = 0 and lg.BENHVIEN_ID = 'HLU01'                             order by dtlg.DOUUTIEN]
2019-09-20 18:16:56,297 [1] DEBUG - Statement Id: [DAO00087_GetServiceParams] PreparedStatement : [select CODE, VALUE              from TM_SYS_APPSETTINGS              where LOCKED = '0' and BENHVIEN_ID = 'HLU01']
2019-09-20 18:16:56,613 [1] DEBUG - Statement Id: [DAO00030_GetPhamViByKhoDuoc] PreparedStatement : [SELECT DISTINCT pv.PHAMVI_ID          FROM TM_DUOC_PHAMVISD_MAPPING mp          INNER JOIN TM_DUOC_PHAMVISUDUNG pv ON mp.PHAMVI_ID = pv.PHAMVI_ID          WHERE          mp.KHODUOC_ID IN (32)          AND mp.BENHVIEN_ID ='HLU01'          AND mp.TAMNGUNG = '0'          AND pv.TAMNGUNG = '0']
2019-09-20 18:17:00,571 [1] DEBUG - Statement Id: [DAO00009_TT_TIEPNHAN_GetProcess] PreparedStatement : [select PROCESS_ID from TT_TIEPNHAN where SOTIEPNHAN = 'TN190920.0000001']
2019-09-20 18:17:00,757 [1] DEBUG - Statement Id: [DAOWF004_laytrangthaiDV] PreparedStatement : [select top 1 A.CURR_STATE_CODE as STATE_CODE, isNull(C.SHORT_NAME,C.NAME) as TRANGTHAI, C.NAME as TRANGTHAI_CHITIET, C.STATUS_CODE, D.ISACTIVE as ACTIVE, E.STATUS_CODE  as OLD_STATUSCODE        from TT_REQUEST_SERVICE_DETAIL A                left join (select * from TT_REQUEST_SERVICE where PARA = '{"DICHVU_ID":"5492","DVYEUCAU_ID":"205443"}') D on D.ID = A.REQUEST_SERVICE_ID        left join TM_STATE C on A.CURR_STATE_CODE = C.STATE_CODE and C.PROCESS_CODE = D.PROCESS_CODE        left join TM_STATE E on A.OLD_STATE_CODE = E.STATE_CODE and E.PROCESS_CODE = D.PROCESS_CODE        where        A.REQUEST_SERVICE_ID = (select top 1 ID from TT_REQUEST_SERVICE where PARA = '{"DICHVU_ID":"5492","DVYEUCAU_ID":"205443"}' order by ID desc)        order by A.ID desc]
2019-09-20 18:17:00,935 [1] DEBUG - Statement Id: [DAO00000_GetDoiTuongIsBHYT] PreparedStatement : [select * from TM_DOITUONG Where DOITUONG_ID = 4 and MADOITUONG like '%BHYT%']
2019-09-20 18:17:01,039 [1] DEBUG - Statement Id: [DAO00030_GetPhamViByKhoDuoc] PreparedStatement : [SELECT DISTINCT pv.PHAMVI_ID          FROM TM_DUOC_PHAMVISD_MAPPING mp          INNER JOIN TM_DUOC_PHAMVISUDUNG pv ON mp.PHAMVI_ID = pv.PHAMVI_ID          WHERE          mp.KHODUOC_ID IN (32)          AND mp.BENHVIEN_ID ='HLU01'          AND mp.TAMNGUNG = '0'          AND pv.TAMNGUNG = '0']
2019-09-20 18:17:01,085 [1] DEBUG - Statement Id: [DAO00020_GetDSDichVuYC] PreparedStatement : [select dvyc.*,        dv.TENDICHVU, dv.MADICHVU, dv.NORESULT, ndv.MANHOMDICHVU, ndv.TENNHOMDICHVU, vp.KHONGTHUTIEN        from TT_DVYEUCAU dvyc        left join TM_DICHVU dv on dvyc.DICHVU_ID = dv.DICHVU_ID        left join TM_NHOMDICHVU ndv on ndv.NHOMDICHVU_ID = dv.NHOMDICHVU_ID        left join (select * from TT_VIENPHI where TIEPNHAN_ID = '27478') vp on dvyc.DVYEUCAU_ID = vp.REF_ID                 where        dvyc.TIEPNHAN_ID = 27478        and REF_TABLE = 'TT_DVYEUCAU'                 order by DVYEUCAU_ID desc]
2019-09-20 18:17:01,234 [1] DEBUG - Statement Id: [DAO00020_GetTTDVYeuCauByID] PreparedStatement : [select *        from TT_DVYEUCAU        where TT_DVYEUCAU.DVYEUCAU_ID  = 205443        order by DVYEUCAU_ID]
2019-09-20 18:17:01,325 [1] DEBUG - Statement Id: [DAO00083_GetList_PhieuGhiNhanVTYT] PreparedStatement : [select DICHVU_GHINHANVTYT_ID, SOPHIEU, KHAMBENH_ID, TIEPNHAN_ID, DVYEUCAU_ID        from TT_DICHVU_GHINHANVTYT        where TIEPNHAN_ID = '27478'        and BENHVIEN_ID = 'HLU01'         and           KHAMBENH_ID = '26173'         and           DVYEUCAU_ID = '205443'                 order by THOIGIANGHINHAN desc]
2019-09-20 18:17:01,374 [1] DEBUG - Statement Id: [DAO00083_GetDSVTYTGhiNhan] PreparedStatement : [select A.*, dc.TENDUOCDAYDU, dc.BHYT DUOC_BHYT, ld.LOAIVATTU_ID, dc.DONVITINH        from TT_NGOAITRU_KHAMBENH_VTYT A        left join TM_DUOC dc on A.DUOC_ID = dc.DUOC_ID        left join TM_LOAIDUOC ld on dc.LOAIDUOC_ID = ld.LOAIDUOC_ID        where A.DVYEUCAU_ID =  @param0          and           A.DICHVU_GHINHANVTYT_ID = '4918'                 order by A.KHAMBENH_VTYT_ID]
2019-09-20 18:17:01,375 [1] DEBUG - Statement Id: [DAO00083_GetDSVTYTGhiNhan] Parameters: [@param0=[DVYEUCAU_ID,205443]]
2019-09-20 18:17:01,375 [1] DEBUG - Statement Id: [DAO00083_GetDSVTYTGhiNhan] Types: [@param0=[Int64, System.Int64]]
2019-09-20 18:17:01,494 [1] DEBUG - Statement Id: [DAO00063_GetSoChungTuByChungTuID] PreparedStatement : [select MACHUNGTU as SOCHUNGTU        from TT_DUOC_CHUNGTU        where CHUNGTU_ID  = '137704']
2019-09-20 18:17:01,525 [1] DEBUG - Statement Id: [DAO00023_GetTTVienPhiThuoc] PreparedStatement : [select *        from TT_VIENPHI        where REF_ID = '10593'        and REF_TABLE = 'TT_NGOAITRU_KHAMBENH_VTYT']
2019-09-20 18:17:01,640 [1] DEBUG - Statement Id: [DAO00014_GetTrangThaiTiepNhan] PreparedStatement : [select tn.TIEPNHAN_ID, tn.KHOADULIEU, xncp.XACNHANCHIPHI_ID from TT_TIEPNHAN tn        left join TT_XACNHANCHIPHI xncp        on tn.TIEPNHAN_ID = xncp.TIEPNHAN_ID        where tn.TIEPNHAN_ID = '27478'        and tn.BENHVIEN_ID = 'HLU01']
2019-09-20 18:17:01,695 [1] DEBUG - Statement Id: [DAO00014_GetPatientStatus] PreparedStatement : [select        CASE        when tn.TRANGTHAI = 'HOANTHANH' Then tn.TRANGTHAI        WHEN xncp.XACNHANCHIPHI_ID is not null THEN 'XACNHANCHIPHI'        WHEN (tn.KHOADULIEU = '1') THEN 'KHOADULIEU'        ELSE tn.TRANGTHAI        END        as TRANGTHAI        from TT_TIEPNHAN tn        left join TT_XACNHANCHIPHI xncp on tn.TIEPNHAN_ID = xncp.TIEPNHAN_ID        where tn.TIEPNHAN_ID = '27478'        and tn.BENHVIEN_ID = 'HLU01']
2019-09-20 18:17:04,281 [1] DEBUG - Statement Id: [DAO00014_GetPatientStatus] PreparedStatement : [select        CASE        when tn.TRANGTHAI = 'HOANTHANH' Then tn.TRANGTHAI        WHEN xncp.XACNHANCHIPHI_ID is not null THEN 'XACNHANCHIPHI'        WHEN (tn.KHOADULIEU = '1') THEN 'KHOADULIEU'        ELSE tn.TRANGTHAI        END        as TRANGTHAI        from TT_TIEPNHAN tn        left join TT_XACNHANCHIPHI xncp on tn.TIEPNHAN_ID = xncp.TIEPNHAN_ID        where tn.TIEPNHAN_ID = '27478'        and tn.BENHVIEN_ID = 'HLU01']
2019-09-20 18:17:04,369 [1] DEBUG - Statement Id: [DAO00083_GetTrangThaiTruocKhiXoa_Update_KhamBenh_VTYT] PreparedStatement : [IF EXISTS (        SELECT KHAMBENH_VTYT_ID        FROM TT_NGOAITRU_KHAMBENH_VTYT        WHERE DVYEUCAU_ID ='205443'        AND BENHVIEN_ID ='HLU01'        AND (CHUNGTU_ID IS NOT NULL OR CHUNGTUTONGHOP_ID IS NOT NULL OR PHIEULINH_ID IS NOT NULL)         and           DICHVU_GHINHANVTYT_ID = '4918'                 )        BEGIN        SELECT -1 AS RESULT        END        ELSE        BEGIN        SELECT 1 AS RESULT        END]
2019-09-20 18:17:18,545 [1] DEBUG - Statement Id: [DAO00014_GetPatientStatus] PreparedStatement : [select        CASE        when tn.TRANGTHAI = 'HOANTHANH' Then tn.TRANGTHAI        WHEN xncp.XACNHANCHIPHI_ID is not null THEN 'XACNHANCHIPHI'        WHEN (tn.KHOADULIEU = '1') THEN 'KHOADULIEU'        ELSE tn.TRANGTHAI        END        as TRANGTHAI        from TT_TIEPNHAN tn        left join TT_XACNHANCHIPHI xncp on tn.TIEPNHAN_ID = xncp.TIEPNHAN_ID        where tn.TIEPNHAN_ID = '27478'        and tn.BENHVIEN_ID = 'HLU01']
2019-09-20 18:17:18,630 [1] DEBUG - Statement Id: [DAO00083_GetTrangThaiTruocKhiXoa_Update_KhamBenh_VTYT] PreparedStatement : [IF EXISTS (        SELECT KHAMBENH_VTYT_ID        FROM TT_NGOAITRU_KHAMBENH_VTYT        WHERE DVYEUCAU_ID ='205443'        AND BENHVIEN_ID ='HLU01'        AND (CHUNGTU_ID IS NOT NULL OR CHUNGTUTONGHOP_ID IS NOT NULL OR PHIEULINH_ID IS NOT NULL)         and           DICHVU_GHINHANVTYT_ID = '4918'                 )        BEGIN        SELECT -1 AS RESULT        END        ELSE        BEGIN        SELECT 1 AS RESULT        END]
2019-09-20 18:17:18,738 [1] DEBUG - Statement Id: [DAO00083_GetTrangThaiTruocKhiXoa_Update_KhamBenh_VTYT] PreparedStatement : [IF EXISTS (        SELECT KHAMBENH_VTYT_ID        FROM TT_NGOAITRU_KHAMBENH_VTYT        WHERE DVYEUCAU_ID ='205443'        AND BENHVIEN_ID ='HLU01'        AND (CHUNGTU_ID IS NOT NULL OR CHUNGTUTONGHOP_ID IS NOT NULL OR PHIEULINH_ID IS NOT NULL)         and           DICHVU_GHINHANVTYT_ID = '4918'                 )        BEGIN        SELECT -1 AS RESULT        END        ELSE        BEGIN        SELECT 1 AS RESULT        END]
2019-09-20 18:17:18,826 [1] DEBUG - Statement Id: [DAO00014_GetTrangThaiTiepNhan] PreparedStatement : [select tn.TIEPNHAN_ID, tn.KHOADULIEU, xncp.XACNHANCHIPHI_ID from TT_TIEPNHAN tn        left join TT_XACNHANCHIPHI xncp        on tn.TIEPNHAN_ID = xncp.TIEPNHAN_ID        where tn.TIEPNHAN_ID = '27478'        and tn.BENHVIEN_ID = 'HLU01']
2019-09-20 18:17:18,908 [1] DEBUG - Statement Id: [DAO00063_KiemtraSoluongDuocXuatNgoaitru] PreparedStatement : [select A.TONKHO, isnull(B.BOOK_NGOAI,0) BOOK_NGOAI, isnull(D.BOOK_NOI,0) BOOK_NOI,  (A.TONKHO - isnull(B.BOOK_NGOAI,0) - isnull(D.BOOK_NOI,0)) TONKHO_BOOK        from(        select SUM(tk.SOLUONG) TONKHO, tk.DUOC_ID, sd.PHAMVI_ID, tk.NGUONDUOC_ID from TT_DUOC_TONKHO tk        inner join TM_DUOC_PHAMVISD_MAPPING sd on sd.KHODUOC_ID = tk.KHODUOC_ID        where sd.PHAMVI_ID  = '1055' and tk.DUOC_ID = '1' and tk.NGUONDUOC_ID = '1'        group by tk.DUOC_ID, sd.PHAMVI_ID, tk.NGUONDUOC_ID) A        left join (        select SUM(SOLUONG) BOOK_NGOAI,DUOC_ID, PHAMVI_ID, NGUONHANG_ID from TT_DUOC_TONKHO_BOOK_NGOAITRU        where PHAMVI_ID  = '1055' and DUOC_ID = '1' and NGUONHANG_ID = '1' and TRANGTHAI = 'HIEULUC' and SOLUONG > 0        group by DUOC_ID, PHAMVI_ID, NGUONHANG_ID) B on A.DUOC_ID = B.DUOC_ID and A.PHAMVI_ID = B.PHAMVI_ID and A.NGUONDUOC_ID = B.NGUONHANG_ID        left join (        select SUM(SOLUONG) BOOK_NOI,DUOC_ID, PHAMVI_ID, NGUONHANG_ID from TT_DUOC_TONKHO_BOOK_NOITRU        where PHAMVI_ID  = '1055' and DUOC_ID = '1' and NGUONHANG_ID = '1' and TRANGTHAI = 'HIEULUC'  and SOLUONG > 0        group by DUOC_ID, PHAMVI_ID, NGUONHANG_ID) D on A.DUOC_ID = D.DUOC_ID and A.PHAMVI_ID = D.PHAMVI_ID and A.NGUONDUOC_ID = D.NGUONHANG_ID]
2019-09-20 18:17:19,011 [1] DEBUG - Statement Id: [DAO00014_KiemTraDVYCCoBHYT] PreparedStatement : [select *        from TT_VIENPHI        where REF_ID  = '205443' and REF_TABLE = 'TT_DVYEUCAU' and BHYT_DONGIA > 0]
2019-09-20 18:17:19,089 [1] DEBUG - Statement Id: [DAO00000_GetCHECK_DOITUONG_BHYT] PreparedStatement : [select count(*) as DOITUONG_BHYT FROM TM_DOITUONG A            WHERE A.DOITUONG_ID = '4' and A.BENHVIEN_ID = 'HLU01' and MADOITUONG like '%BHYT%']
2019-09-20 18:17:19,123 [1] DEBUG - Statement Id: [DAO00000_GetLOAIGIATHUOC_NOI_NGOAI_VIEN] PreparedStatement : [SELECT LOAIGIA_ID              FROM TM_LOAIGIA              WHERE MALOAIGIA = 'GiaThuoc_NoiVien' and BENHVIEN_ID = 'HLU01']
2019-09-20 18:17:19,152 [1] DEBUG - Statement Id: [DAO00000_GetDUOC_DONGIADOANHTHU_NOIVIEN] PreparedStatement : [declare @doanhthu numeric(24,2);          declare @hotro numeric(24,2);          declare @bhyt char(1);          select top 1 @doanhthu = dg.DONGIA           from TM_DUOC_DONGIA dg          left join TM_DOITUONG_LOAIGIA dtlg on dtlg.LOAIGIA_ID = dg.LOAIGIA_ID                     where dg.DUOC_ID = '1' and dtlg.DOITUONG_ID = '4' and dg.DONGIA is not null and dg.DONGIA > 0           order by dtlg.DOUUTIEN asc          select top 1 @hotro = dg.DONGIA          from TM_DUOC_DONGIA dg          left join TM_DOITUONG_LOAIGIA dtlg on dtlg.LOAIGIA_ID = dg.LOAIGIA_ID          where dg.DUOC_ID = '1' and dtlg.DOITUONG_ID = '4' and dg.DONGIA is not null and dg.DONGIA > 0  and GIAHOTRO = '1'          order by dtlg.DOUUTIEN asc          select top 1 @bhyt = BHYT from TM_DUOC where DUOC_ID = 1          select ISNULL(@doanhthu,0.0) DONGIA_DOANHTHU, ISNULL(@hotro, 0.0) DONGIA_KHAC, isnull(@bhyt, '0') BHYT]
2019-09-20 18:17:19,237 [1] DEBUG - Statement Id: [DAO00000_GetDuocBHYT] PreparedStatement : [select count(*) BHYT FROM TM_DUOC A WHERE A.DUOC_ID = '1' and BHYT = '1']
2019-09-20 18:17:19,302 [1] DEBUG - Statement Id: [DAO00023_GetSOBHYT_HUONG_ID] PreparedStatement : [select isnull(MAX(SOBHYT_HUONG_ID),0) SOBHYT_HUONG_ID        from TT_TIEPNHAN_SOTHEBHYT        where TIEPNHAN_ID = '27478']
2019-09-20 18:17:19,367 [1] DEBUG - Statement Id: [DAO00062_GetKhoThuocCosoKhongCoso] PreparedStatement : [select distinct kd.KHODUOC_ID, lst.DICTIONARY_CODE  LOAIKHO from TM_KHODUOC kd        left join TM_PHONGBAN_KHODUOC pbkd        on kd.KHODUOC_ID = pbkd.KHODUOC_ID        and kd.BENHVIEN_ID = pbkd.BENHVIEN_ID        left join LST_DICTIONARY lst on lst.DICTIONARY_ID = kd.LOAIKHO_ID        where lst.DICTIONARY_CODE = 'Coso']
2019-09-20 18:17:19,398 [1] DEBUG - Statement Id: [DAO00062_GetAllPhamviKhoDuoc] PreparedStatement : [select distinct dmap.*        from TM_DUOC_PHAMVISD_MAPPING dmap        left join TM_DUOC_PHAMVISUDUNG dpv on dpv.PHAMVI_ID = dmap.PHAMVI_ID]
2019-09-20 18:17:19,500 [1] DEBUG - Statement Id: [DAO00083_Update_PhieuGhiNhanVTYT] PreparedStatement : [update TT_DICHVU_GHINHANVTYT set        KHOXUAT_ID =  @param0 ,        THOIGIANCAPNHAT =  @param1 ,        NGUOICAPNHAT_ID =  @param2         where        DICHVU_GHINHANVTYT_ID = '4918']
2019-09-20 18:17:19,500 [1] DEBUG - Statement Id: [DAO00083_Update_PhieuGhiNhanVTYT] Parameters: [@param0=[KHOXUAT_ID,32], @param1=[THOIGIANCAPNHAT,9/20/2019 6:17:19 PM], @param2=[NGUOICAPNHAT_ID,1]]
2019-09-20 18:17:19,500 [1] DEBUG - Statement Id: [DAO00083_Update_PhieuGhiNhanVTYT] Types: [@param0=[String, System.String], @param1=[DateTime, System.DateTime], @param2=[Int64, System.Int64]]
2019-09-20 18:17:19,534 [1] DEBUG - Statement Id: [DAO00016_CheckThuocUngThu] PreparedStatement : [SELECT count(*)        from TM_DOITUONG_GIADUOC_TYLE        WHERE DOITUONG_ID = '4'        AND DUOC_ID = '1'        AND BENHVIEN_ID = 'HLU01']
2019-09-20 18:17:19,684 [1] DEBUG - Statement Id: [DAO00083_GetBookingInfo] PreparedStatement : [select *        from TT_DUOC_TONKHO_BOOK_NGOAITRU        where                 DUOC_ID = '1'        and NGUONHANG_ID = '1'        and REF_ID = '10593'        and REF_TABLE = 'TT_NGOAITRU_KHAMBENH_VTYT'         and           KHODUOC_ID =  @param0          and           PHAMVI_ID =  @param1]
2019-09-20 18:17:19,684 [1] DEBUG - Statement Id: [DAO00083_GetBookingInfo] Parameters: [@param0=[KHODUOC_ID,32], @param1=[PHAMVI_ID,1055]]
2019-09-20 18:17:19,684 [1] DEBUG - Statement Id: [DAO00083_GetBookingInfo] Types: [@param0=[Int32, System.Int32], @param1=[Int64, System.Int64]]
2019-09-20 18:17:19,743 [1] DEBUG - Statement Id: [DAO00083_Update_Booking] PreparedStatement : [update TT_DUOC_TONKHO_BOOK_NGOAITRU set        KHODUOC_ID =  @param0 ,        NGUONHANG_ID =  @param1 ,        DUOC_ID =  @param2 ,        SOLUONG =  @param3 ,        NGAYHIEULUC =  @param4 ,        NGUOICAPNHAT_ID =  @param5 ,        NGAYCAPNHAT =  @param6          ,           PHAMVI_ID =  @param7                  where        BOOKING_ID = '34589']
2019-09-20 18:17:19,743 [1] DEBUG - Statement Id: [DAO00083_Update_Booking] Parameters: [@param0=[KHODUOC_ID,32], @param1=[NGUONHANG_ID,1], @param2=[DUOC_ID,1], @param3=[SOLUONG,2], @param4=[NGAYHIEULUC,null], @param5=[NGUOICAPNHAT_ID,1], @param6=[NGAYCAPNHAT,9/20/2019 6:17:19 PM], @param7=[PHAMVI_ID,1055]]
2019-09-20 18:17:19,743 [1] DEBUG - Statement Id: [DAO00083_Update_Booking] Types: [@param0=[Int32, System.Int32], @param1=[Int64, System.Int64], @param2=[Int64, System.Int64], @param3=[Double, System.Double], @param4=[System.DBNull, null], @param5=[Int64, System.Int64], @param6=[DateTime, System.DateTime], @param7=[Int64, System.Int64]]
2019-09-20 18:17:19,773 [1] DEBUG - Statement Id: [DAO00083_UpdateTTGhiNhanVTYT] PreparedStatement : [update TT_DVYEUCAU        set GHINHANVTYT = '1',        NGUOICAPNHAT_ID = '1',        NGAYCAPNHAT = '9/20/2019 6:17:19 PM'        where DVYEUCAU_ID  = '205443']
2019-09-20 18:17:19,808 [1] DEBUG - Statement Id: [DAO00064_GetTopTT_TIEPNHAN_SOTHEBHYT] PreparedStatement : [select top 1 stbhyt.*, ba.SOBENHAN,         tn.SOTIEPNHAN, tn.LOAITHANHVIEN_ID, tn.THE_ID, tn.THANHVIEN_ID,        tn.SUDUNG_BHTN, tn.BAOLANH_VIENPHI, tn.VIP, tn.NGUOINUOCNGOAI        from TT_TIEPNHAN_SOTHEBHYT stbhyt        left join TT_TIEPNHAN tn on tn.TIEPNHAN_ID = stbhyt.TIEPNHAN_ID        left join TT_NOITRU_BENHAN ba on ba.TIEPNHAN_ID = stbhyt.TIEPNHAN_ID        where         stbhyt.TIEPNHAN_ID = '27478' and isnull(stbhyt.KHONGSUDUNG, '0') = '0'              order by SOBHYT_HUONG_ID desc]
2019-09-20 18:17:19,855 [1] DEBUG - Statement Id: [DAO00006_GetListDuocTyle] PreparedStatement : [select DUOC_ID, DOITUONG_ID, (TYLE/100) as TYLE, DONGIA MUCTRAN_THANHTOAN from TM_DOITUONG_GIADUOC_TYLE            where            BENHVIEN_ID = 'HLU01'            and DOITUONG_ID = '4']
2019-09-20 18:17:19,885 [1] DEBUG - Statement Id: [DAO00027_GetListTuongTrinhDichVuPhauThuatCuaTiepNhan] PreparedStatement : [declare @ManhomDSA varchar(10);        declare @PhanLoaiNhomDV varchar(20) = '05';        select top 1  @ManhomDSA = VALUE from TM_SYS_APPSETTINGS where CODE = 'MANHOM_DICHVU_DSA'        if (@ManhomDSA is not null) set @PhanLoaiNhomDV += ',' + @ManhomDSA        select distinct ptyc.*        from TT_PHAUTHUAT_YEUCAU ptyc        inner join TM_DICHVU dv on dv.DICHVU_ID = ptyc.DICHVU_ID        inner join TM_NHOMDICHVU ndv on ndv.NHOMDICHVU_ID = dv.NHOMDICHVU_ID        inner join TT_PHAUTHUAT pt on pt.PHAUTHUAT_ID = ptyc.PHAUTHUAT_ID        where        pt.TIEPNHAN_ID = 27478        and (left(ndv.MANHOMDICHVU, 2) in (select * from STRING_SPLIT(@PhanLoaiNhomDV,',')) or ndv.MANHOMDICHVU in (select * from STRING_SPLIT(@PhanLoaiNhomDV,',')))]
2019-09-20 18:17:19,931 [1] DEBUG - Statement Id: [DAO00006_GetList] PreparedStatement : [select dv.*, loaiDV.MALOAIDICHVU, captren.NHOMDICHVU_ID as NHOMDICHVU_CAPTREN_ID, captren.TENNHOMDICHVU as NHOMDICHVU_CAPTREN,              nhom_dv.TENNHOMDICHVU as TENNHOMDICHVU, nhom_dv.MANHOMDICHVU,              case when dv.ATTRIBUTE5 is null then 'TT' else 'KTC' end as LOAI_CHIPHI              from TM_DICHVU as dv              left join TM_NHOMDICHVU as nhom_dv on nhom_dv.NHOMDICHVU_ID = dv.NHOMDICHVU_ID and nhom_dv.BENHVIEN_ID = 'HLU01'              left join TM_NHOMDICHVU as captren on nhom_dv.CAPTREN_ID = captren.NHOMDICHVU_ID and captren.BENHVIEN_ID = 'HLU01'              left join TM_LOAIDICHVU loaiDV on nhom_dv.LOAIDICHVU_ID = loaiDV.LOAIDICHVU_ID and loaiDV.BENHVIEN_ID = 'HLU01'              where nhom_dv.TAMNGUNG = '0' and dv.BENHVIEN_ID = 'HLU01'              and dv.TAMNGUNG = '0'               AND                   loaiDV.MALOAIDICHVU = 'KhamBenh']
2019-09-20 18:17:19,997 [1] DEBUG - Statement Id: [DAO00023_GetVienPhiByDichVuID] PreparedStatement : [select *        from TT_VIENPHI        where TIEPNHAN_ID  = '27478'        and DUOC_ID  = '1'        and REF_ID = '10593'        and REF_TABLE = 'TT_NGOAITRU_KHAMBENH_VTYT'        and DATHANHTOAN = '0']
2019-09-20 18:17:20,029 [1] DEBUG - Statement Id: [DAO00023_UpdateDuocVienPhi] PreparedStatement : [update TT_VIENPHI set                 KHAMBENH_ID =  @param0         , LOAI_CHIPHI =  @param1         , LOAIGIA_ID =  @param2         , SOLUONG =  @param3         , DONGIA_DOANHTHU =  @param4         , THANHTIEN_DOANHTHU =  @param5         , BHYT_TL =  @param6         , BHYT_DONGIA =  @param7         , BHYT_THANHTIEN =  @param8         , BHYT_DONGIA_CHITRA =  @param9         , BHYT_THANHTIEN_CHITRA =  @param10         , BENHNHAN_PHAITHANHTOAN =  @param11         , GIATRI_HOADON =  @param12         , GIATRI_HOADON_DATHANHTOAN =  @param13         , GIATRI_BIENLAI =  @param14         , GIATRI_BIENLAI_DATHANHTOAN =  @param15         , GIATRI_BENHNHAN_DATHANHTOAN =  @param16         , GIATRI_THATTHU =  @param17         , MIENGIAM_TL =  @param18                  , NGANSACH_TL =  @param19         , NGANSACH_GIATRI =  @param20         , TAITRO_TL =  @param21         , TAITRO_GIATRI =  @param22         , BHTN_TL =  @param23         , BHTN_DONGIA =  @param24         , BHTN_THANHTIEN =  @param25         , BHTN_DONGIA_CHITRA =  @param26         , BHTN_THANHTIEN_CHITRA =  @param27         , DUOCPHEPTHUCHIEN =  @param28         , HUY =  @param29         , KHONGTHUTIEN =  @param30         , BHYTDONGTIEN =  @param31         , DATHANHTOAN =  @param32         , HOADON_ID =  @param33          ,           TYLE_VAT =  @param34                  , NGUOICAPNHAT_ID =  @param35         , NGAYCAPNHAT =  @param36         where        VIENPHI_ID = '674728']
2019-09-20 18:17:20,029 [1] DEBUG - Statement Id: [DAO00023_UpdateDuocVienPhi] Parameters: [@param0=[KHAMBENH_ID,null], @param1=[LOAI_CHIPHI,TT], @param2=[LOAIGIA_ID,null], @param3=[SOLUONG,2], @param4=[DONGIA_DOANHTHU,1030], @param5=[THANHTIEN_DOANHTHU,2060], @param6=[BHYT_TL,1], @param7=[BHYT_DONGIA,1030], @param8=[BHYT_THANHTIEN,2060], @param9=[BHYT_DONGIA_CHITRA,1030], @param10=[BHYT_THANHTIEN_CHITRA,2060], @param11=[BENHNHAN_PHAITHANHTOAN,0], @param12=[GIATRI_HOADON,0], @param13=[GIATRI_HOADON_DATHANHTOAN,0], @param14=[GIATRI_BIENLAI,0], @param15=[GIATRI_BIENLAI_DATHANHTOAN,0], @param16=[GIATRI_BENHNHAN_DATHANHTOAN,0], @param17=[GIATRI_THATTHU,0], @param18=[MIENGIAM_TL,0], @param19=[NGANSACH_TL,0], @param20=[NGANSACH_GIATRI,0], @param21=[TAITRO_TL,0], @param22=[TAITRO_GIATRI,0], @param23=[BHTN_TL,0], @param24=[BHTN_DONGIA,0], @param25=[BHTN_THANHTIEN,0], @param26=[BHTN_DONGIA_CHITRA,0], @param27=[BHTN_THANHTIEN_CHITRA,0], @param28=[DUOCPHEPTHUCHIEN,0], @param29=[HUY,0], @param30=[KHONGTHUTIEN,0], @param31=[BHYTDONGTIEN,0], @param32=[DATHANHTOAN,0], @param33=[HOADON_ID,null], @param34=[TYLE_VAT,null], @param35=[NGUOICAPNHAT_ID,1], @param36=[NGAYCAPNHAT,9/20/2019 6:17:20 PM]]
2019-09-20 18:17:20,029 [1] DEBUG - Statement Id: [DAO00023_UpdateDuocVienPhi] Types: [@param0=[System.DBNull, null], @param1=[String, System.String], @param2=[System.DBNull, null], @param3=[Decimal, System.Decimal], @param4=[Decimal, System.Decimal], @param5=[Decimal, System.Decimal], @param6=[Decimal, System.Decimal], @param7=[Decimal, System.Decimal], @param8=[Decimal, System.Decimal], @param9=[Decimal, System.Decimal], @param10=[Decimal, System.Decimal], @param11=[Decimal, System.Decimal], @param12=[Decimal, System.Decimal], @param13=[Decimal, System.Decimal], @param14=[Decimal, System.Decimal], @param15=[Decimal, System.Decimal], @param16=[Decimal, System.Decimal], @param17=[Decimal, System.Decimal], @param18=[Decimal, System.Decimal], @param19=[Decimal, System.Decimal], @param20=[Decimal, System.Decimal], @param21=[Decimal, System.Decimal], @param22=[Decimal, System.Decimal], @param23=[Decimal, System.Decimal], @param24=[Decimal, System.Decimal], @param25=[Decimal, System.Decimal], @param26=[Decimal, System.Decimal], @param27=[Decimal, System.Decimal], @param28=[String, System.String], @param29=[String, System.String], @param30=[Int32, System.Int32], @param31=[String, System.String], @param32=[String, System.String], @param33=[System.DBNull, null], @param34=[System.DBNull, null], @param35=[Int64, System.Int64], @param36=[DateTime, System.DateTime]]
2019-09-20 18:17:20,069 [1] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoVaBookingCOM23UpdateRedis] PreparedStatement : [declare @NGUONDUOC_MACDINH varchar(5) = '0';        declare @TOAMUANGOAI int = 0;        select @NGUONDUOC_MACDINH = isnull(VALUE,0) from TM_SYS_APPSETTINGS where CODE = 'PHA_NGUONDUOC'        select @TOAMUANGOAI = isnull(VALUE,0) from TM_SYS_APPSETTINGS where CODE = 'OPD_TOAMUANGOAI_DUNGDANHMUC_DUOC'                if @TOAMUANGOAI = 1        begin        select  distinct '0' + '_' + LTRIM(d.DUOC_ID) + '_' + @NGUONDUOC_MACDINH as DUOC_KEY, 0 as PHAMVI_ID, @NGUONDUOC_MACDINH as NGUONDUOC_ID, null as TENNGUONDUOC, null as TINHTIEN, d.DUOC_ID, ld.MALOAIDUOC,        d.SOVISA,d.TYLE_VAT,d.COTOA, d.MADUOC, d.TENHANG, d.TENDUOCDAYDU, dvt.TENDONVITINH as DONVITINH, d.BHYT,        d.TENHOATCHAT, d.HAMLUONG, d.HANGSANXUAT, d.QUOCGIA, d.LOAIDUOC_ID, d.DUONGDUNG_ID, d.TINHTIEN_PTTT,        ten.TENDUOC, ten.TENDUOC_EN, ten.MAQUOCTE, ten.MAQUOCTEBT,        '' as BHYT_TEXT        , ld.LOAIVATTU_ID        , d.BENHVIEN_ID,        999999999 as SOLUONG, d.VTYT_PHANLOAI, d.PHAMVI, d.SUASOLUONGTONGHOP, d.MADUOCBV, d.DANGTRINHBAY        , TAMNGUNG = CASE WHEN d.TAMNGUNG = '1' THEN '1' ELSE '0' END        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        where d.DUOC_ID in (1)        union all        select  distinct tk.DUOC_KEY, LTRIM(tk.PHAMVI_ID) as PHAMVI_ID, tk.NGUONDUOC_ID, nh.TENNGUONDUOC, nh.TINHTIEN, d.DUOC_ID, ld.MALOAIDUOC,        d.SOVISA,d.TYLE_VAT,d.COTOA, d.MADUOC, d.TENHANG, d.TENDUOCDAYDU, dvt.TENDONVITINH as DONVITINH, d.BHYT,        d.TENHOATCHAT, d.HAMLUONG, d.HANGSANXUAT, d.QUOCGIA, d.LOAIDUOC_ID, d.DUONGDUNG_ID, d.TINHTIEN_PTTT,        ten.TENDUOC, ten.TENDUOC_EN, ten.MAQUOCTE, ten.MAQUOCTEBT,        CASE WHEN d.BHYT = '1' THEN 'BHYT' ELSE '' END as BHYT_TEXT        , ld.LOAIVATTU_ID        , d.BENHVIEN_ID,        tk.SOLUONG, d.VTYT_PHANLOAI, d.PHAMVI, d.SUASOLUONGTONGHOP, d.MADUOCBV, d.DANGTRINHBAY        , TAMNGUNG = CASE WHEN d.TAMNGUNG = '1' OR nh.TAMNGUNG = '1' OR kd.TAMNGUNG = '1' THEN '1' ELSE '0' END        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        inner join        (        select  LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')) DUOC_KEY, (SUM(dtk.SOLUONG) - isnull(sum(A.SOLUONG),0) - isnull(sum(B.SOLUONG),0)) SOLUONG, pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        from (select sum(soluong) soluong,duoc_id,nguonduoc_id,khoduoc_id,benhvien_id from TT_DUOC_TONKHO  group by duoc_id,nguonduoc_id,khoduoc_id,benhvien_id) dtk        inner join TM_DUOC_PHAMVISD_MAPPING pvsd on dtk.KHODUOC_ID = pvsd.KHODUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NOITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) B on B.DUOC_ID = dtk.DUOC_ID and B.SOLUONG > 0 and B.PHAMVI_ID = pvsd.PHAMVI_ID and B.NGUONHANG_ID = dtk.NGUONDUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NGOAITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) A on A.DUOC_ID = dtk.DUOC_ID and A.SOLUONG > 0 and A.PHAMVI_ID = pvsd.PHAMVI_ID and A.NGUONHANG_ID = dtk.NGUONDUOC_ID        where dtk.SOLUONG > 0 and dtk.BENHVIEN_ID = 'HLU01'        group by LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')), pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        ) tk on tk.DUOC_ID = d.DUOC_ID        left join TM_DUOC_PHAMVISUDUNG kd on kd.PHAMVI_ID = tk.PHAMVI_ID and kd.BENHVIEN_ID = 'HLU01'        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = tk.NGUONDUOC_ID and nh.BENHVIEN_ID = 'HLU01'        where  d.BENHVIEN_ID = 'HLU01' and d.DUOC_ID in (1)        end        else        begin        select  distinct tk.DUOC_KEY, LTRIM(tk.PHAMVI_ID) as PHAMVI_ID, tk.NGUONDUOC_ID, nh.TENNGUONDUOC, nh.TINHTIEN, d.DUOC_ID, ld.MALOAIDUOC,        d.SOVISA,d.TYLE_VAT,d.COTOA, d.MADUOC, d.TENHANG, d.TENDUOCDAYDU, dvt.TENDONVITINH as DONVITINH, d.BHYT,        d.TENHOATCHAT, d.HAMLUONG, d.HANGSANXUAT, d.QUOCGIA, d.LOAIDUOC_ID, d.DUONGDUNG_ID, d.TINHTIEN_PTTT,        ten.TENDUOC, ten.TENDUOC_EN, ten.MAQUOCTE, ten.MAQUOCTEBT,        CASE WHEN d.BHYT = '1' THEN 'BHYT' ELSE '' END as BHYT_TEXT        , ld.LOAIVATTU_ID        , d.BENHVIEN_ID,        tk.SOLUONG, d.VTYT_PHANLOAI, d.PHAMVI, d.SUASOLUONGTONGHOP, d.MADUOCBV, d.DANGTRINHBAY        , TAMNGUNG = CASE WHEN d.TAMNGUNG = '1' OR nh.TAMNGUNG = '1' OR kd.TAMNGUNG = '1' THEN '1' ELSE '0' END        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        inner join        (        select  LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')) DUOC_KEY, (SUM(dtk.SOLUONG) - isnull(sum(A.SOLUONG),0) - isnull(sum(B.SOLUONG),0)) SOLUONG, pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        from (select sum(soluong) soluong,duoc_id,nguonduoc_id,khoduoc_id,benhvien_id from TT_DUOC_TONKHO  group by duoc_id,nguonduoc_id,khoduoc_id,benhvien_id) dtk        inner join TM_DUOC_PHAMVISD_MAPPING pvsd on dtk.KHODUOC_ID = pvsd.KHODUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NOITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) B on B.DUOC_ID = dtk.DUOC_ID and B.SOLUONG > 0 and B.PHAMVI_ID = pvsd.PHAMVI_ID and B.NGUONHANG_ID = dtk.NGUONDUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NGOAITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) A on A.DUOC_ID = dtk.DUOC_ID and A.SOLUONG > 0 and A.PHAMVI_ID = pvsd.PHAMVI_ID and A.NGUONHANG_ID = dtk.NGUONDUOC_ID        where dtk.SOLUONG > 0 and dtk.BENHVIEN_ID = 'HLU01'        group by LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')), pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        ) tk on tk.DUOC_ID = d.DUOC_ID        left join TM_DUOC_PHAMVISUDUNG kd on kd.PHAMVI_ID = tk.PHAMVI_ID and kd.BENHVIEN_ID = 'HLU01'        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = tk.NGUONDUOC_ID and nh.BENHVIEN_ID = 'HLU01'        where  d.BENHVIEN_ID = 'HLU01' and d.DUOC_ID in (1)        end]
2019-09-20 18:17:34,482 [1] DEBUG - Statement Id: [DAO00030_GetKhoDuoc] PreparedStatement : [SELECT *            FROM            TM_KHODUOC            WHERE            KHODUOC_ID= '32'            and BENHVIEN_ID= 'HLU01']
2019-09-20 18:17:34,520 [1] DEBUG - Statement Id: [DAO00030_GetMucDichChungTuID] PreparedStatement : [SELECT DICTIONARY_ID              FROM              LST_DICTIONARY              WHERE              DICTIONARY_TYPE_CODE = 'MucDichChungTu'              and DICTIONARY_CODE = 'X13']
2019-09-20 18:17:34,560 [1] DEBUG - Statement Id: [DAO00036_GetDetail] PreparedStatement : [select KEYTYPE, KEYYEAR, KEYMONTH, KEYDAY, SEGMENT_1, SEGMENT_2, SEGMENT_3, KEYVALUE              from LST_KEYDATA_DUOCPHAM as kd               WHERE                        kd.KEYTYPE = 'SOCHUNGTUNHAPXUATBENNGOAI'                   AND                       kd.KEYYEAR = '2019'                   AND                       kd.KEYMONTH = '0'                   AND                       kd.KEYDAY = '0'                   AND                       kd.SEGMENT_1 = 'CS_KB'                   AND                       kd.SEGMENT_2 = 'X13'                   AND                       kd.SEGMENT_3 = ' ']
2019-09-20 18:17:34,591 [1] DEBUG - Statement Id: [DAO00036_Update] PreparedStatement : [update LST_KEYDATA_DUOCPHAM set              KEYVALUE =  @param0               where              KEYTYPE = 'SOCHUNGTUNHAPXUATBENNGOAI'              AND KEYYEAR = '2019'              AND KEYMONTH = '0'              AND KEYDAY = '0'              AND SEGMENT_1 = 'CS_KB'              AND SEGMENT_2 = 'X13'              AND SEGMENT_3 = ' ']
2019-09-20 18:17:34,591 [1] DEBUG - Statement Id: [DAO00036_Update] Parameters: [@param0=[KEYVALUE,003093]]
2019-09-20 18:17:34,591 [1] DEBUG - Statement Id: [DAO00036_Update] Types: [@param0=[String, System.String]]
2019-09-20 18:17:41,866 [1] DEBUG - Statement Id: [DAO00030_GetGhiNhanVTYTKhamBenhByKhamBenhID] PreparedStatement : [SELECT            N'Người bệnh: ' + bn.MAYTE + ' - ' + bn.TENBENHNHAN + ' - ' +  CONVERT(VARCHAR(10), KB.THOIGIANKHAM, 103) + ' - ' + CONVERT(VARCHAR(5), KB.THOIGIANKHAM, 108) as BENHNHAN            ,tt.* , tt.NGUONHANG_ID AS NGUONDUOC_ID            FROM TT_NGOAITRU_KHAMBENH_VTYT tt            INNER JOIN TT_NGOAITRU_KHAMBENH KB on KB.KHAMBENH_ID = TT.KHAMBENH_ID AND KB.BENHVIEN_ID = TT.BENHVIEN_ID            INNER JOIN TT_BENHNHAN bn on bn.BENHNHAN_ID = KB.BENHNHAN_ID AND BN.BENHVIEN_ID = KB.BENHVIEN_ID            WHERE            tt.KHAMBENH_ID= 26173 and tt.COSO = '1' and tt.CHUNGTU_ID is null            AND TT.BENHVIEN_ID = 'HLU01'             and               tt.DICHVU_GHINHANVTYT_ID = 4918]
2019-09-20 18:17:58,636 [1] DEBUG - Statement Id: [DAO00030_GET_SOLONHAP_XUATSUDUNG] PreparedStatement : [SELECT DISTINCT            SLN.SOLONHAP_ID, SLN.SOLONHAP, SLN.SOLOSANPHAM, SLN.SOKIEMSOAT, SLN.SOVISA, CONVERT(varchar(20), SLN.SOLOSANPHAM) + '/' + CONVERT(varchar(20), TK.SOLUONG) AS SOLOSOTON,            SLN.NGAYNHAP AS NGAYNHAPLO, SLN.HANDUNG AS HANSUDUNG,  SLN.HANDUNG, SLN.NGUONDUOC_ID, SLN.NGUONDUOC_ID as NGUONHANG_ID,            SLNGB.DONGIAMUA, SLNGB.DONGIAVON, SLNGB.TYLEVAT_DAUVAO as TYLEVAT, d.TYLE_VAT, SLNGB.DONGIAVONVAT, SLNGB.DONGIABANVAT_DAUVAO,            dg.DONGIA AS DONGIATHAU, dg.DONGIA AS DONGIABAN, dg.DONGIA AS DONGIABAN_VAT,                      TK.KHODUOC_ID,TK.DUOC_ID, TK.SOLUONG, TK.SOLUONG AS SOLUONGTON,            D.TENDUOCDAYDU,D.DONVITINH_ID, D.DONVITINH, D.BHYT, NH.TENNGUONDUOC AS NGUONHANG,            LTRIM(TK.KHODUOC_ID) + '_' + LTRIM(TK.DUOC_ID) + '_' + LTRIM(TK.NGUONDUOC_ID) as DUOC_KEY            FROM            TT_DUOC_CHUNGTU_SOLONHAP SLN            INNER JOIN TT_DUOC_TONKHO TK on SLN.SOLONHAP_ID = TK.SOLONHAP_ID            INNER JOIN TT_DUOC_SOLONHAP_GIABAN SLNGB on SLN.SOLONHAP_ID = SLNGB.SOLONHAP_ID            INNER JOIN TM_NGUONHANG NH on SLN.NGUONDUOC_ID = NH.NGUONDUOC_ID            INNER JOIN TM_DUOC D on SLN.DUOC_ID = D.DUOC_ID            LEFT JOIN TM_DUOC_DONGIA dg on dg.DUOC_ID = SLN.DUOC_ID            LEFT JOIN TM_LOAIGIA lg on (lg.LOAIGIA_ID = dg.LOAIGIA_ID AND lg.MALOAIGIA = 'GiaduocBHYT')            WHERE            TK.DUOC_ID = '1'            AND TK.KHODUOC_ID = '32'            AND TK.BENHVIEN_ID = 'HLU01'            AND TK.SOLUONG > 0                 and                     SLN.NGUONDUOC_ID = '1'                                      ORDER BY NGAYNHAP]
2019-09-20 18:17:58,677 [1] DEBUG - Statement Id: [DAO00030_Add] PreparedStatement : [insert into TT_DUOC_CHUNGTU (              MACHUNGTU              , SOCHUNGTU              , NGAYCHUNGTU              , LOAICHUNGTU              , MUCDICHCHUNGTU_ID              , MUCDICHCHUNGTU_CODE              , KHOXUAT_ID              , NGUOIGIAO_ID              , NGUOIGIAO              , KHONHAP_ID              , NGUOINHAN_ID              , NGUOINHAN              , NGUOIKIEMTRA_ID              , NGUOIKIEMTRA              , NGUOIDUYET_ID              , NGUOIDUYET              , PHUONGPHAPXUAT              , KETOANTRUONG_ID              , KETOANTRUONG              , THUKHO_ID              , THUKHO              , MAUHOADON              , SOHOADON              , SOSERI              , NGAYHOADON              , DIENGIAI              , GIATRI              , GIATRITHANHTOAN              , TYLEVAT              , GIATRIVAT              , THUESUAT              , GIATRITHUE              , TYLECHIETKHAU              , GIATRICHIETKHAU              , TIENTE_ID              , TYGIA              , SOCHUNGTUGOC              , NGAYCHUNGTUGOC              , NHACUNGCAP_ID              , HINHTHUCTHANHTOAN_ID              , NGUONDUOC_ID              , CHUNGTULIENQUAN_ID              , KHAMBENH_ID              , TOATHUOCNOITRU_ID              , TIEPNHAN_ID              , BENHAN_ID              , DANHANTHUOC              , NGUOINHAP_ID              , NGAYNHAP              , TRANGTHAI              , LOAITOATHUOC              , PHIEULINH_ID              , DIENGIAINGHIEPVUPHATSINH              , DONVIGIAO_ID              , KHOSUDUNG_ID              , LOAIVATTU_ID              , BENHNHAN_ID              , NGOAITRU_TOATHUOC_NGUOIMUA_ID              , TENBENHNHAN              , BACSIGIOITHIEU_ID              , DOITUONG_ID              , IDCHUYEN              , CHUNGTUKETOAN              , STATUS              , TRANSFER_VIENPHI_ID              , PHONGBAN_ID              , BACSI_ID              , TKNO              , TKCO              , MACHUNGTUREF              , LOAICHUNGTUREF              , PHIEULINHCANTRU_ID              , KHOTHUCHIEN_ID              , KHODOIUNG_ID              , MENU_LOAIDUOC_ID              , NGUOISUDUNGMAY_ID              , GOITHAU_ID              , XUATTHUOCBANGOAITRU              , NGAYGIOCHUNGTU              , NOIDAKHAM              , HOIDONGKIEMNHAP_ID              , HOIDONGTHANHLY_ID              , CHUYENCHUNGTUID              , CHUYENDOANHTHUID              , LYDOXUATSUDUNG_ID              , BENHVIEN_ID              , NGAYTAO              , NGUOITAO_ID              , NGAYCAPNHAT              , NGUOICAPNHAT_ID              ) values (               @param0               ,  @param1               ,  @param2               ,  @param3               ,  @param4               ,  @param5               ,  @param6               ,  @param7               ,  @param8               ,  @param9               ,  @param10               ,  @param11               ,  @param12               ,  @param13               ,  @param14               ,  @param15               ,  @param16               ,  @param17               ,  @param18               ,  @param19               ,  @param20               ,  @param21               ,  @param22               ,  @param23               ,  @param24               ,  @param25               ,  @param26               ,  @param27               ,  @param28               ,  @param29               ,  @param30               ,  @param31               ,  @param32               ,  @param33               ,  @param34               ,  @param35               ,  @param36               ,  @param37               ,  @param38               ,  @param39               ,  @param40               ,  @param41               ,  @param42               ,  @param43               ,  @param44               ,  @param45               ,  @param46               ,  @param47               ,  @param48               ,  @param49               ,  @param50               ,  @param51               ,  @param52               ,  @param53               ,  @param54               ,  @param55               ,  @param56               ,  @param57               ,  @param58               ,  @param59               ,  @param60               ,  @param61               ,  @param62               ,  @param63               ,  @param64               ,  @param65               ,  @param66               ,  @param67               ,  @param68               ,  @param69               ,  @param70               ,  @param71               ,  @param72               ,  @param73               ,  @param74               ,  @param75               ,  @param76               ,  @param77               ,  @param78               ,  @param79               ,  @param80               ,  @param81               ,  @param82               ,  @param83               ,  @param84               ,  @param85               ,  @param2               ,  @param86               ,  @param87               ,  @param88               )              select SCOPE_identity() as value]
2019-09-20 18:17:58,677 [1] DEBUG - Statement Id: [DAO00030_Add] Parameters: [@param0=[MACHUNGTU,CS_KBX1319003093], @param1=[SOCHUNGTU,003093], @param2=[NGAYCHUNGTU,9/20/2019 6:17:34 PM], @param3=[LOAICHUNGTU,X], @param4=[MUCDICHCHUNGTU_ID,1060], @param5=[MUCDICHCHUNGTU_CODE,X13], @param6=[KHOXUAT_ID,32], @param7=[NGUOIGIAO_ID,0], @param8=[NGUOIGIAO,null], @param9=[KHONHAP_ID,null], @param10=[NGUOINHAN_ID,null], @param11=[NGUOINHAN,null], @param12=[NGUOIKIEMTRA_ID,null], @param13=[NGUOIKIEMTRA,null], @param14=[NGUOIDUYET_ID,null], @param15=[NGUOIDUYET,null], @param16=[PHUONGPHAPXUAT,0], @param17=[KETOANTRUONG_ID,null], @param18=[KETOANTRUONG,null], @param19=[THUKHO_ID,null], @param20=[THUKHO,null], @param21=[MAUHOADON,null], @param22=[SOHOADON,null], @param23=[SOSERI,null], @param24=[NGAYHOADON,null], @param25=[DIENGIAI,null], @param26=[GIATRI,null], @param27=[GIATRITHANHTOAN,null], @param28=[TYLEVAT,5], @param29=[GIATRIVAT,0], @param30=[THUESUAT,null], @param31=[GIATRITHUE,null], @param32=[TYLECHIETKHAU,null], @param33=[GIATRICHIETKHAU,null], @param34=[TIENTE_ID,null], @param35=[TYGIA,null], @param36=[SOCHUNGTUGOC,null], @param37=[NGAYCHUNGTUGOC,null], @param38=[NHACUNGCAP_ID,null], @param39=[HINHTHUCTHANHTOAN_ID,null], @param40=[NGUONDUOC_ID,null], @param41=[CHUNGTULIENQUAN_ID,null], @param42=[KHAMBENH_ID,null], @param43=[TOATHUOCNOITRU_ID,null], @param44=[TIEPNHAN_ID,null], @param45=[BENHAN_ID,null], @param46=[DANHANTHUOC,], @param47=[NGUOINHAP_ID,null], @param48=[NGAYNHAP,null], @param49=[TRANGTHAI,DAXUAT], @param50=[LOAITOATHUOC,null], @param51=[PHIEULINH_ID,null], @param52=[DIENGIAINGHIEPVUPHATSINH,null], @param53=[DONVIGIAO_ID,null], @param54=[KHOSUDUNG_ID,null], @param55=[LOAIVATTU_ID,null], @param56=[BENHNHAN_ID,null], @param57=[NGOAITRU_TOATHUOC_NGUOIMUA_ID,null], @param58=[TENBENHNHAN,null], @param59=[BACSIGIOITHIEU_ID,null], @param60=[DOITUONG_ID,null], @param61=[IDCHUYEN,null], @param62=[CHUNGTUKETOAN,null], @param63=[STATUS,null], @param64=[TRANSFER_VIENPHI_ID,null], @param65=[PHONGBAN_ID,62], @param66=[BACSI_ID,null], @param67=[TKNO,null], @param68=[TKCO,null], @param69=[MACHUNGTUREF,null], @param70=[LOAICHUNGTUREF,null], @param71=[PHIEULINHCANTRU_ID,null], @param72=[KHOTHUCHIEN_ID,null], @param73=[KHODOIUNG_ID,null], @param74=[MENU_LOAIDUOC_ID,null], @param75=[NGUOISUDUNGMAY_ID,50], @param76=[GOITHAU_ID,null], @param77=[XUATTHUOCBANGOAITRU,null], @param78=[NGAYGIOCHUNGTU,null], @param79=[NOIDAKHAM,null], @param80=[HOIDONGKIEMNHAP_ID,null], @param81=[HOIDONGTHANHLY_ID,null], @param82=[CHUYENCHUNGTUID,null], @param83=[CHUYENDOANHTHUID,null], @param84=[LYDOXUATSUDUNG_ID,8294], @param85=[BENHVIEN_ID,HLU01], @param86=[NGUOITAO_ID,0], @param87=[NGAYCAPNHAT,9/20/2019 6:17:58 PM], @param88=[NGUOICAPNHAT_ID,0]]
2019-09-20 18:17:58,677 [1] DEBUG - Statement Id: [DAO00030_Add] Types: [@param0=[String, System.String], @param1=[String, System.String], @param2=[DateTime, System.DateTime], @param3=[String, System.String], @param4=[Int32, System.Int32], @param5=[String, System.String], @param6=[Int32, System.Int32], @param7=[Int32, System.Int32], @param8=[System.DBNull, null], @param9=[System.DBNull, null], @param10=[System.DBNull, null], @param11=[System.DBNull, null], @param12=[System.DBNull, null], @param13=[System.DBNull, null], @param14=[System.DBNull, null], @param15=[System.DBNull, null], @param16=[Int32, System.Int32], @param17=[System.DBNull, null], @param18=[System.DBNull, null], @param19=[System.DBNull, null], @param20=[System.DBNull, null], @param21=[System.DBNull, null], @param22=[System.DBNull, null], @param23=[System.DBNull, null], @param24=[System.DBNull, null], @param25=[System.DBNull, null], @param26=[System.DBNull, null], @param27=[System.DBNull, null], @param28=[Decimal, System.Decimal], @param29=[Decimal, System.Decimal], @param30=[System.DBNull, null], @param31=[System.DBNull, null], @param32=[System.DBNull, null], @param33=[System.DBNull, null], @param34=[System.DBNull, null], @param35=[System.DBNull, null], @param36=[System.DBNull, null], @param37=[System.DBNull, null], @param38=[System.DBNull, null], @param39=[System.DBNull, null], @param40=[System.DBNull, null], @param41=[System.DBNull, null], @param42=[System.DBNull, null], @param43=[System.DBNull, null], @param44=[System.DBNull, null], @param45=[System.DBNull, null], @param46=[String, System.String], @param47=[System.DBNull, null], @param48=[System.DBNull, null], @param49=[String, System.String], @param50=[System.DBNull, null], @param51=[System.DBNull, null], @param52=[System.DBNull, null], @param53=[System.DBNull, null], @param54=[System.DBNull, null], @param55=[System.DBNull, null], @param56=[System.DBNull, null], @param57=[System.DBNull, null], @param58=[System.DBNull, null], @param59=[System.DBNull, null], @param60=[System.DBNull, null], @param61=[System.DBNull, null], @param62=[System.DBNull, null], @param63=[System.DBNull, null], @param64=[System.DBNull, null], @param65=[Int32, System.Int32], @param66=[System.DBNull, null], @param67=[System.DBNull, null], @param68=[System.DBNull, null], @param69=[System.DBNull, null], @param70=[System.DBNull, null], @param71=[System.DBNull, null], @param72=[System.DBNull, null], @param73=[System.DBNull, null], @param74=[System.DBNull, null], @param75=[Int32, System.Int32], @param76=[System.DBNull, null], @param77=[System.DBNull, null], @param78=[System.DBNull, null], @param79=[System.DBNull, null], @param80=[System.DBNull, null], @param81=[System.DBNull, null], @param82=[System.DBNull, null], @param83=[System.DBNull, null], @param84=[Int32, System.Int32], @param85=[String, System.String], @param86=[Int32, System.Int32], @param87=[DateTime, System.DateTime], @param88=[Int32, System.Int32]]
2019-09-20 18:17:58,730 [1] DEBUG - Statement Id: [DAO00030_CHUNGTUCT_AddMulti] PreparedStatement : [declare @json nvarchar(max) =  N'[{"SOLONHAP_ID":7541,"SOLONHAP":"190500624","SOLOSANPHAM":"a","SOKIEMSOAT":null,"SOVISA":"1","SOLOSOTON":"a/4.0000","NGAYNHAPLO":"2019-05-06T10:24:00","HANSUDUNG":"2026-12-12T00:00:00","HANDUNG":"2026-12-12T00:00:00","NGUONDUOC_ID":1,"NGUONHANG_ID":1,"DONGIAMUA":945.0000,"DONGIAVON":945.0000,"TYLEVAT":0.0000,"TYLE_VAT":0.00,"DONGIAVONVAT":945.0000,"DONGIABANVAT_DAUVAO":945.0000,"DONGIATHAU":1030.00,"DONGIABAN":1030.00,"DONGIABAN_VAT":1030.00,"KHODUOC_ID":32,"DUOC_ID":1,"SOLUONG":4.0000,"SOLUONGTON":4.0000,"TENDUOCDAYDU":null,"DONVITINH_ID":17,"DONVITINH":"Cái","BHYT":"1","NGUONHANG":"Nguồn Mua","DUOC_KEY":"32_1_1","CHUNGTUCHITIET_ID":0,"CHUNGTU_ID":137705,"SOLUONGTHUCTE":null,"TOATHUOC":"NGOAITRU_KHAMBENH_VTYT","TOATHUOCNOITRU_ID":null,"REF_TABLE":"TT_NGOAITRU_KHAMBENH_VTYT","REF_ID":10593,"KHAMBENH_VTYT_ID":10593,"BENHNHAN":"Người bệnh: 190043304 - Test Xn1 - 20/09/2019 - 16:50","SOLUONGYEUCAU":2,"PHAUTHUAT_VTYT_ID":null,"CLSKETQUA_VTYT_ID":null,"YLENH":"10593","SOLUONGDAXUAT":2.0,"THANHTIENVON":1890.0000,"NGAYTAO":"20/Sep/2019 18:17:58","NGUOITAO_ID":0,"BENHVIEN_ID":"HLU01"}]';             INSERT INTO TT_DUOC_CHUNGTU_CHITIET           (           CHUNGTU_ID           , DUOC_ID           , SOLONHAP_ID           , SOKIEMSOAT           , SOVISA           , HANDUNG           , DONVITINH_ID           , SOLUONGYEUCAU           , SOLUONGTHUCTE           , SOLUONGDAXUAT           , TIENTE_ID           , TYGIA           , DONGIAMUA           , DONGIA_BHYT           , DONGIABAN           , DONGIABAN_VAT           , DONGIAVON           , DONGIATHANHTOAN           , SOQUYEN           , SOHOADONVAT           , TYLEVAT           , GIATRIVAT           , TYLECHIETKHAU           , GIATRICHIETKHAU           , MIENPHI           , LYDOMIENPHI_ID           , SOCHUNGTUKETOAN           , SOCHUNGTUTIENMAT           , TRANGTHAI           , DAPHATSINHPHIEUXUAT           , DAPHATSINHPHIEUHOANTRA           , KHUYENMAI           , PHUONGPHAPXUAT           , DONDATHANG_ID           , GHICHUCHITIET           , NGUONHANG_ID           , DONGIAVONVAT           , THANHTIENMUA           , THANHTIENVON           , THANHTIENHOPDONG           , ISTACHLO           , DONVITINHBANDAU_ID           , SOLUONGBANDAU           , GOITHAU_ID           , DONGIATHAU           , DONGIAPO           , TYLEQUIDOI           , TOATHUOCNOITRU_ID           , KHAMBENH_VTYT_ID           , PHAUTHUAT_VTYT_ID           , CLSKETQUA_VTYT_ID           , TOATHUOCNGOAITRU_ID           , CHUNGTUCHITIET_LIENQUAN_ID           , MASTER_ID           , BENHNHAN           , YLENH           , BENHVIEN_ID           , NGAYTAO           , NGUOITAO_ID                    )                  SELECT * FROM OPENJSON(@json)           WITH (           CHUNGTU_ID int           , DUOC_ID int           , SOLONHAP_ID int           , SOKIEMSOAT varchar(20)           , SOVISA varchar(20)           , HANDUNG datetime           , DONVITINH_ID int           , SOLUONGYEUCAU numeric(25, 4)           , SOLUONGTHUCTE numeric(25, 4)           , SOLUONGDAXUAT numeric(25, 4)           , TIENTE_ID nchar(3)           , TYGIA numeric(25, 4)           , DONGIAMUA numeric(25, 4)           , DONGIA_BHYT numeric(25, 4)           , DONGIABAN numeric(25, 4)           , DONGIABAN_VAT numeric(25, 4)           , DONGIAVON numeric(25, 4)           , DONGIATHANHTOAN numeric(25, 4)           , SOQUYEN varchar(20)           , SOHOADONVAT varchar(20)           , TYLEVAT  numeric(25, 4)           , GIATRIVAT numeric(25, 4)           , TYLECHIETKHAU numeric(25, 4)           , GIATRICHIETKHAU numeric(25, 4)           , MIENPHI char(1)           , LYDOMIENPHI_ID int           , SOCHUNGTUKETOAN varchar(20)           , SOCHUNGTUTIENMAT varchar(20)           , TRANGTHAI varchar(10)           , DAPHATSINHPHIEUXUAT char(1)           , DAPHATSINHPHIEUHOANTRA char(1)           , KHUYENMAI char(1)           , PHUONGPHAPXUAT int           , DONDATHANG_ID int           , GHICHUCHITIET nvarchar(255)           , NGUONHANG_ID int           , DONGIAVONVAT numeric(25, 4)           , THANHTIENMUA numeric(25, 4)           , THANHTIENVON numeric(25, 4)           , THANHTIENHOPDONG numeric(25, 4)           , ISTACHLO char(1)           , DONVITINHBANDAU_ID int           , SOLUONGBANDAU numeric(25, 4)           , GOITHAU_ID int           , DONGIATHAU numeric(25, 4)           , DONGIAPO numeric(25, 4)           , TYLEQUIDOI numeric(25, 4)           , TOATHUOCNOITRU_ID int           , KHAMBENH_VTYT_ID int           , PHAUTHUAT_VTYT_ID int           , CLSKETQUA_VTYT_ID int           , TOATHUOCNGOAITRU_ID int           , CHUNGTUCHITIET_LIENQUAN_ID int           , MASTER_ID int           , BENHNHAN nvarchar(1000)           , YLENH nvarchar(MAX)           , BENHVIEN_ID varchar(10)           , NGAYTAO datetime           , NGUOITAO_ID int                  )                      IF('X13' = 'X13')           BEGIN                      UPDATE TT_NOITRU_TOATHUOC SET CHUNGTU_ID = json.CHUNGTU_ID, TRANGTHAI = 'DAXUAT', NGAYCAPNHAT = getdate()           FROM OPENJSON(@json)           WITH (CHUNGTU_ID int, TOATHUOCNOITRU_ID int) json           WHERE TT_NOITRU_TOATHUOC.TOATHUOC_ID = json.TOATHUOCNOITRU_ID and json.TOATHUOCNOITRU_ID is not NULL                  UPDATE TT_VIENPHI set DUYET = '1', DATHUCHIEN = '1', NGAYCAPNHAT = getdate()           FROM OPENJSON(@json)           WITH (TOATHUOCNOITRU_ID int) json           WHERE TT_VIENPHI.REF_TABLE = 'TT_NOITRU_TOATHUOC' and TT_VIENPHI.REF_ID = json.TOATHUOCNOITRU_ID and json.TOATHUOCNOITRU_ID is not NULL                                 UPDATE TT_NGOAITRU_KHAMBENH_VTYT SET CHUNGTU_ID = json.CHUNGTU_ID, TRANGTHAI = 'DAXUAT', NGAYCAPNHAT = getdate()           FROM OPENJSON(@json)           WITH (CHUNGTU_ID int, KHAMBENH_VTYT_ID int) json           WHERE TT_NGOAITRU_KHAMBENH_VTYT.KHAMBENH_VTYT_ID = json.KHAMBENH_VTYT_ID and json.KHAMBENH_VTYT_ID is not NULL                  UPDATE TT_VIENPHI set DUYET = '1', DATHUCHIEN = '1', NGAYCAPNHAT = getdate()           FROM OPENJSON(@json)           WITH (KHAMBENH_VTYT_ID int) json           WHERE TT_VIENPHI.REF_TABLE = 'TT_NGOAITRU_KHAMBENH_VTYT' and TT_VIENPHI.REF_ID = json.KHAMBENH_VTYT_ID and json.KHAMBENH_VTYT_ID is not NULL                                  UPDATE TT_PHAUTHUAT_VTYT SET CHUNGTU_ID = json.CHUNGTU_ID           FROM OPENJSON(@json)           WITH (CHUNGTU_ID int, PHAUTHUAT_VTYT_ID int) json           WHERE TT_PHAUTHUAT_VTYT.PHAUTHUAT_VTYT_ID = json.PHAUTHUAT_VTYT_ID and json.PHAUTHUAT_VTYT_ID is not NULL                  UPDATE TT_VIENPHI set DUYET = '1', DATHUCHIEN = '1', NGAYCAPNHAT = getdate()           FROM OPENJSON(@json)           WITH (PHAUTHUAT_VTYT_ID int) json           WHERE TT_VIENPHI.REF_TABLE = 'TT_PHAUTHUAT_VTYT' and TT_VIENPHI.REF_ID = json.PHAUTHUAT_VTYT_ID and json.PHAUTHUAT_VTYT_ID is not NULL                              UPDATE TT_CLSKETQUA_VTYT SET CHUNGTU_ID = json.CHUNGTU_ID, TRANGTHAI = 'DAXUAT', NGAYCAPNHAT = getdate()           FROM OPENJSON(@json)           WITH (CHUNGTU_ID int, CLSKETQUA_VTYT_ID int) json           WHERE TT_CLSKETQUA_VTYT.CLSKETQUA_VTYT_ID = json.CLSKETQUA_VTYT_ID and json.CLSKETQUA_VTYT_ID is not NULL                  UPDATE TT_VIENPHI set DUYET = '1', DATHUCHIEN = '1', NGAYCAPNHAT = getdate()           FROM OPENJSON(@json)           WITH (CLSKETQUA_VTYT_ID int) json           WHERE TT_VIENPHI.REF_TABLE = 'TT_CLSKETQUA_VTYT' and TT_VIENPHI.REF_ID = json.CLSKETQUA_VTYT_ID and json.CLSKETQUA_VTYT_ID is not NULL                      END]
2019-09-20 18:17:58,907 [1] DEBUG - Statement Id: [DAO00030_DUOC_TONKHO_BOOKING_NGOAITRU_Giam] PreparedStatement : [update TT_DUOC_TONKHO_BOOK_NGOAITRU            set            SOLUONG = 0                     ,NGAYCAPNHAT = getdate()            where            REF_TABLE = 'TT_NGOAITRU_KHAMBENH_VTYT'            AND REF_ID = '10593'                AND BENHVIEN_ID = 'HLU01']
2019-09-20 18:17:58,976 [1] DEBUG - Statement Id: [DAO00030_DUOCTONKHO_Giam] PreparedStatement : [update TT_DUOC_TONKHO set            SOLUONG = SOLUONG -  @param0             , NGAYCAPNHAT =  getdate()            , NGUOICAPNHAT_ID =  @param1             where            KHODUOC_ID =  @param2             and DUOC_ID =  @param3             and SOLONHAP_ID =  @param4]
2019-09-20 18:17:58,976 [1] DEBUG - Statement Id: [DAO00030_DUOCTONKHO_Giam] Parameters: [@param0=[SOLUONGTHAYDOI,2], @param1=[NGUOICAPNHAT_ID,null], @param2=[KHODUOC_ID,32], @param3=[DUOC_ID,1], @param4=[SOLONHAP_ID,7541]]
2019-09-20 18:17:58,976 [1] DEBUG - Statement Id: [DAO00030_DUOCTONKHO_Giam] Types: [@param0=[Decimal, System.Decimal], @param1=[System.DBNull, null], @param2=[Int32, System.Int32], @param3=[Int32, System.Int32], @param4=[Int32, System.Int32]]
2019-09-20 18:17:59,019 [1] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoCOM18] PreparedStatement : [select  distinct TT_TONKHO.DUOC_KEY, LTRIM(TT_TONKHO.KHODUOC_ID) as KHODUOC_ID, TM_DUOC.DUOC_ID, TM_LOAIDUOC.MALOAIDUOC,TM_DUOC.SOVISA,TM_DUOC.TYLE_VAT,TM_DUOC.COTOA,        TM_DUOC.MADUOC, TM_DUOC.TENHANG, TM_DUOC.TENDUOCDAYDU, dvt.TENDONVITINH as DONVITINH, TM_DUOC.DONVITINH_ID, TM_DUOC.BHYT,        TM_DUOC.TENHOATCHAT, TM_DUOC.HAMLUONG, TM_DUOC.HANGSANXUAT, TM_DUOC.QUOCGIA, TM_DUOC.LOAIDUOC_ID, TM_DUOC.DUONGDUNG_ID,        TM_TENDUOC.TENDUOC, TM_TENDUOC.TENDUOC_EN, TM_TENDUOC.MAQUOCTE, TM_TENDUOC.MAQUOCTEBT,        TM_LOAIDUOC.LOAIVATTU_ID, TM_DUOC.BENHVIEN_ID,        TT_TONKHO.SOLUONG, TM_DUOC.VTYT_PHANLOAI, TM_DUOC.PHAMVI, TT_TONKHO.NGUONDUOC_ID, NG.TENNGUONDUOC        , TAMNGUNG = CASE WHEN TM_DUOC.TAMNGUNG = '1' OR NG.TAMNGUNG = '1' OR KD.TAMNGUNG = '1' THEN '1' ELSE '0' END        , TM_DUOC.DANGTRINHBAY        from TM_DUOC        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = TM_DUOC.DONVITINH_ID        left join TM_TENDUOC on TM_DUOC.TENDUOC_ID = TM_TENDUOC.TENDUOC_ID and TM_DUOC.BENHVIEN_ID = 'HLU01'  and TM_DUOC.TAMNGUNG = '0'        left join TM_LOAIDUOC on TM_LOAIDUOC.LOAIDUOC_ID = TM_DUOC.LOAIDUOC_ID and TM_LOAIDUOC.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG on (TM_LOAIDUOC.LOAIVATTU_ID = TM_DUOC_HANDUNG.LOAIDUOC and TM_DUOC_HANDUNG.BENHVIEN_ID = 'HLU01')        inner join        (select LTRIM(A.KHODUOC_ID) + '_' + LTRIM(A.DUOC_ID) + '_' + LTRIM(ISNULL(A.NGUONDUOC_ID,'')) as DUOC_KEY, A.KHODUOC_ID, A.DUOC_ID ,a.NGUONDUOC_ID,        SUM(isnull(A.SOLUONG,0)) as SOLUONG        from        (select SUM(SOLUONG) as SOLUONG, KHODUOC_ID, DUOC_ID, NGUONDUOC_ID from TT_DUOC_TONKHO        where KHODUOC_ID in (32) and DUOC_ID in (1) group by KHODUOC_ID, DUOC_ID, NGUONDUOC_ID        ) A        where A.KHODUOC_ID in (32) and A.DUOC_ID in (1)        group by LTRIM(A.KHODUOC_ID) + '_' + LTRIM(A.DUOC_ID) + '_' + LTRIM(A.NGUONDUOC_ID), A.KHODUOC_ID, A.DUOC_ID, A.NGUONDUOC_ID)        TT_TONKHO on TT_TONKHO.DUOC_ID = TM_DUOC.DUOC_ID        LEFT JOIN TM_NGUONHANG NG ON NG.NGUONDUOC_ID = TT_TONKHO.NGUONDUOC_ID        LEFT JOIN TM_KHODUOC KD ON KD.KHODUOC_ID = TT_TONKHO.KHODUOC_ID        where TM_DUOC.BENHVIEN_ID = 'HLU01' and TM_DUOC.DUOC_ID in (1)]
2019-09-20 18:17:59,056 [1] DEBUG - Statement Id: [DAO00030_GetListPhamViByKhoDuoc] PreparedStatement : [SELECT DISTINCT PHAMVI_ID          FROM TM_DUOC_PHAMVISD_MAPPING          WHERE          KHODUOC_ID IN (32)          AND BENHVIEN_ID ='HLU01'          AND TAMNGUNG = '0']
2019-09-20 18:17:59,085 [1] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoVaBookingCOM23] PreparedStatement : [declare @NGUONDUOC_MACDINH varchar(5) = '0';        declare @TOAMUANGOAI int = 0;        select @NGUONDUOC_MACDINH = isnull(VALUE,0) from TM_SYS_APPSETTINGS where CODE = 'PHA_NGUONDUOC'        select @TOAMUANGOAI = isnull(VALUE,0) from TM_SYS_APPSETTINGS where CODE = 'OPD_TOAMUANGOAI_DUNGDANHMUC_DUOC'                if @TOAMUANGOAI = 1        begin        select  distinct '0' + '_' + LTRIM(d.DUOC_ID) + '_' + @NGUONDUOC_MACDINH as DUOC_KEY, 0 as PHAMVI_ID, @NGUONDUOC_MACDINH as NGUONDUOC_ID, null as TENNGUONDUOC, null as TINHTIEN, d.DUOC_ID, ld.MALOAIDUOC,        d.SOVISA,d.TYLE_VAT,d.COTOA, d.MADUOC, d.TENHANG, d.TENDUOCDAYDU, dvt.TENDONVITINH as DONVITINH, d.BHYT,        d.TENHOATCHAT, d.HAMLUONG, d.HANGSANXUAT, d.QUOCGIA, d.LOAIDUOC_ID, d.DUONGDUNG_ID, d.TINHTIEN_PTTT,        ten.TENDUOC, ten.TENDUOC_EN, ten.MAQUOCTE, ten.MAQUOCTEBT,        '' as BHYT_TEXT        , ld.LOAIVATTU_ID        , d.BENHVIEN_ID,        999999999 as SOLUONG, d.VTYT_PHANLOAI, d.PHAMVI, d.SUASOLUONGTONGHOP, d.MADUOCBV, d.DANGTRINHBAY        , TAMNGUNG = CASE WHEN d.TAMNGUNG = '1' THEN '1' ELSE '0' END        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        where d.DUOC_ID in (1)        union all        select  distinct tk.DUOC_KEY, LTRIM(tk.PHAMVI_ID) as PHAMVI_ID, tk.NGUONDUOC_ID, nh.TENNGUONDUOC, nh.TINHTIEN, d.DUOC_ID, ld.MALOAIDUOC,        d.SOVISA,d.TYLE_VAT,d.COTOA, d.MADUOC, d.TENHANG, d.TENDUOCDAYDU, dvt.TENDONVITINH as DONVITINH, d.BHYT,        d.TENHOATCHAT, d.HAMLUONG, d.HANGSANXUAT, d.QUOCGIA, d.LOAIDUOC_ID, d.DUONGDUNG_ID, d.TINHTIEN_PTTT,        ten.TENDUOC, ten.TENDUOC_EN, ten.MAQUOCTE, ten.MAQUOCTEBT,        CASE WHEN d.BHYT = '1' THEN 'BHYT' ELSE '' END as BHYT_TEXT        , ld.LOAIVATTU_ID        , d.BENHVIEN_ID,        tk.SOLUONG, d.VTYT_PHANLOAI, d.PHAMVI, d.SUASOLUONGTONGHOP, d.MADUOCBV, d.DANGTRINHBAY        , TAMNGUNG = CASE WHEN d.TAMNGUNG = '1' OR nh.TAMNGUNG = '1' OR kd.TAMNGUNG = '1' THEN '1' ELSE '0' END        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        inner join        (        select  LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')) DUOC_KEY, (SUM(dtk.SOLUONG) - isnull(sum(A.SOLUONG),0) - isnull(sum(B.SOLUONG),0)) SOLUONG, pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        from (select sum(soluong) soluong,duoc_id,nguonduoc_id,khoduoc_id,benhvien_id from TT_DUOC_TONKHO  group by duoc_id,nguonduoc_id,khoduoc_id,benhvien_id) dtk        inner join TM_DUOC_PHAMVISD_MAPPING pvsd on dtk.KHODUOC_ID = pvsd.KHODUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NOITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) B on B.DUOC_ID = dtk.DUOC_ID and B.SOLUONG > 0 and B.PHAMVI_ID = pvsd.PHAMVI_ID and B.NGUONHANG_ID = dtk.NGUONDUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NGOAITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) A on A.DUOC_ID = dtk.DUOC_ID and A.SOLUONG > 0 and A.PHAMVI_ID = pvsd.PHAMVI_ID and A.NGUONHANG_ID = dtk.NGUONDUOC_ID        where dtk.SOLUONG > 0 and dtk.BENHVIEN_ID = 'HLU01'        group by LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')), pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        ) tk on tk.DUOC_ID = d.DUOC_ID        left join TM_DUOC_PHAMVISUDUNG kd on kd.PHAMVI_ID = tk.PHAMVI_ID and kd.BENHVIEN_ID = 'HLU01'        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = tk.NGUONDUOC_ID and nh.BENHVIEN_ID = 'HLU01'        where  d.BENHVIEN_ID = 'HLU01' and d.DUOC_ID in (1) and TK.PHAMVI_ID in (1055)        and tk.NGUONDUOC_ID in (1)         end        else        begin                select  distinct tk.DUOC_KEY, LTRIM(tk.PHAMVI_ID) as PHAMVI_ID, tk.NGUONDUOC_ID, nh.TENNGUONDUOC, nh.TINHTIEN, d.DUOC_ID, ld.MALOAIDUOC,        d.SOVISA,d.TYLE_VAT,d.COTOA, d.MADUOC, d.TENHANG, d.TENDUOCDAYDU, dvt.TENDONVITINH as DONVITINH, d.BHYT,        d.TENHOATCHAT, d.HAMLUONG, d.HANGSANXUAT, d.QUOCGIA, d.LOAIDUOC_ID, d.DUONGDUNG_ID, d.TINHTIEN_PTTT,        ten.TENDUOC, ten.TENDUOC_EN, ten.MAQUOCTE, ten.MAQUOCTEBT,        CASE WHEN d.BHYT = '1' THEN 'BHYT' ELSE '' END as BHYT_TEXT        , ld.LOAIVATTU_ID        , d.BENHVIEN_ID,        tk.SOLUONG, d.VTYT_PHANLOAI, d.PHAMVI, d.SUASOLUONGTONGHOP, d.MADUOCBV, d.DANGTRINHBAY        , TAMNGUNG = CASE WHEN d.TAMNGUNG = '1' OR nh.TAMNGUNG = '1' OR kd.TAMNGUNG = '1' THEN '1' ELSE '0' END        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        inner join        (        select  LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')) DUOC_KEY, (SUM(dtk.SOLUONG) - isnull(sum(A.SOLUONG),0) - isnull(sum(B.SOLUONG),0)) SOLUONG, pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        from (select sum(soluong) soluong,duoc_id,nguonduoc_id,khoduoc_id,benhvien_id from TT_DUOC_TONKHO  group by duoc_id,nguonduoc_id,khoduoc_id,benhvien_id) dtk        inner join TM_DUOC_PHAMVISD_MAPPING pvsd on dtk.KHODUOC_ID = pvsd.KHODUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NOITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) B on B.DUOC_ID = dtk.DUOC_ID and B.SOLUONG > 0 and B.PHAMVI_ID = pvsd.PHAMVI_ID and B.NGUONHANG_ID = dtk.NGUONDUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NGOAITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) A on A.DUOC_ID = dtk.DUOC_ID and A.SOLUONG > 0 and A.PHAMVI_ID = pvsd.PHAMVI_ID and A.NGUONHANG_ID = dtk.NGUONDUOC_ID        where dtk.SOLUONG > 0 and dtk.BENHVIEN_ID = 'HLU01'        group by LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')), pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        ) tk on tk.DUOC_ID = d.DUOC_ID        left join TM_DUOC_PHAMVISUDUNG kd on kd.PHAMVI_ID = tk.PHAMVI_ID and kd.BENHVIEN_ID = 'HLU01'        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = tk.NGUONDUOC_ID and nh.BENHVIEN_ID = 'HLU01'        where  d.BENHVIEN_ID = 'HLU01' and d.DUOC_ID in (1) and TK.PHAMVI_ID in (1055)        and tk.NGUONDUOC_ID in (1)         end]
2019-09-20 18:17:59,246 [1] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoCOM18UpdateRedis] PreparedStatement : [select distinct TT_TONKHO.DUOC_KEY, LTRIM(TT_TONKHO.KHODUOC_ID) as KHODUOC_ID, TM_DUOC.DUOC_ID, TM_LOAIDUOC.MALOAIDUOC,TM_DUOC.SOVISA,TM_DUOC.TYLE_VAT,TM_DUOC.COTOA,        TM_DUOC.MADUOC, TM_DUOC.TENHANG, TM_DUOC.TENDUOCDAYDU, dvt.TENDONVITINH as DONVITINH,  TM_DUOC.DONVITINH_ID,TM_DUOC.BHYT,        TM_DUOC.TENHOATCHAT,        TM_DUOC.HAMLUONG, TM_DUOC.HANGSANXUAT, TM_DUOC.QUOCGIA, TM_DUOC.LOAIDUOC_ID, TM_DUOC.DUONGDUNG_ID,        TM_TENDUOC.TENDUOC, TM_TENDUOC.TENDUOC_EN, TM_TENDUOC.MAQUOCTE, TM_TENDUOC.MAQUOCTEBT,        TM_LOAIDUOC.LOAIVATTU_ID, TM_DUOC.BENHVIEN_ID,        TT_TONKHO.SOLUONG, TM_DUOC.VTYT_PHANLOAI, TM_DUOC.PHAMVI, TT_TONKHO.NGUONDUOC_ID, NG.TENNGUONDUOC AS TENNGUONDUOC        , TAMNGUNG = CASE WHEN TM_DUOC.TAMNGUNG = '1' OR NG.TAMNGUNG = '1' OR KD.TAMNGUNG = '1' THEN '1' ELSE '0' END        , TM_DUOC.DANGTRINHBAY        from TM_DUOC        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = TM_DUOC.DONVITINH_ID        left join TM_TENDUOC on TM_DUOC.TENDUOC_ID = TM_TENDUOC.TENDUOC_ID and TM_DUOC.BENHVIEN_ID = 'HLU01' and TM_DUOC.TAMNGUNG = '0'        left join TM_LOAIDUOC on TM_LOAIDUOC.LOAIDUOC_ID = TM_DUOC.LOAIDUOC_ID and TM_LOAIDUOC.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG on (TM_LOAIDUOC.LOAIVATTU_ID = TM_DUOC_HANDUNG.LOAIDUOC and TM_DUOC_HANDUNG.BENHVIEN_ID = 'HLU01')        inner join        (select LTRIM(A.KHODUOC_ID) + '_' + LTRIM(A.DUOC_ID) + '_' + LTRIM(ISNULL(A.NGUONDUOC_ID,'')) as DUOC_KEY, A.KHODUOC_ID, A.DUOC_ID, A.NGUONDUOC_ID,        SUM(isnull(A.SOLUONG,0)) as SOLUONG        from        (select SUM(SOLUONG) as SOLUONG, KHODUOC_ID, DUOC_ID, NGUONDUOC_ID from TT_DUOC_TONKHO        where BENHVIEN_ID = 'HLU01' group by KHODUOC_ID, DUOC_ID, NGUONDUOC_ID) A        group by LTRIM(A.KHODUOC_ID) + '_' + LTRIM(A.DUOC_ID) + '_' + LTRIM(ISNULL(A.NGUONDUOC_ID,'')), A.KHODUOC_ID, A.DUOC_ID, NGUONDUOC_ID        ) TT_TONKHO on TT_TONKHO.DUOC_ID = TM_DUOC.DUOC_ID        LEFT JOIN TM_NGUONHANG NG ON NG.NGUONDUOC_ID = TT_TONKHO.NGUONDUOC_ID        LEFT JOIN TM_KHODUOC KD ON KD.KHODUOC_ID = TT_TONKHO.KHODUOC_ID        where TM_DUOC.BENHVIEN_ID = 'HLU01' and TT_TONKHO.SOLUONG >= 0        and TM_DUOC.DUOC_ID in (1)]
2019-09-20 18:17:59,297 [1] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoVaBookingCOM23UpdateRedis] PreparedStatement : [declare @NGUONDUOC_MACDINH varchar(5) = '0';        declare @TOAMUANGOAI int = 0;        select @NGUONDUOC_MACDINH = isnull(VALUE,0) from TM_SYS_APPSETTINGS where CODE = 'PHA_NGUONDUOC'        select @TOAMUANGOAI = isnull(VALUE,0) from TM_SYS_APPSETTINGS where CODE = 'OPD_TOAMUANGOAI_DUNGDANHMUC_DUOC'                if @TOAMUANGOAI = 1        begin        select  distinct '0' + '_' + LTRIM(d.DUOC_ID) + '_' + @NGUONDUOC_MACDINH as DUOC_KEY, 0 as PHAMVI_ID, @NGUONDUOC_MACDINH as NGUONDUOC_ID, null as TENNGUONDUOC, null as TINHTIEN, d.DUOC_ID, ld.MALOAIDUOC,        d.SOVISA,d.TYLE_VAT,d.COTOA, d.MADUOC, d.TENHANG, d.TENDUOCDAYDU, dvt.TENDONVITINH as DONVITINH, d.BHYT,        d.TENHOATCHAT, d.HAMLUONG, d.HANGSANXUAT, d.QUOCGIA, d.LOAIDUOC_ID, d.DUONGDUNG_ID, d.TINHTIEN_PTTT,        ten.TENDUOC, ten.TENDUOC_EN, ten.MAQUOCTE, ten.MAQUOCTEBT,        '' as BHYT_TEXT        , ld.LOAIVATTU_ID        , d.BENHVIEN_ID,        999999999 as SOLUONG, d.VTYT_PHANLOAI, d.PHAMVI, d.SUASOLUONGTONGHOP, d.MADUOCBV, d.DANGTRINHBAY        , TAMNGUNG = CASE WHEN d.TAMNGUNG = '1' THEN '1' ELSE '0' END        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        where d.DUOC_ID in (1)        union all        select  distinct tk.DUOC_KEY, LTRIM(tk.PHAMVI_ID) as PHAMVI_ID, tk.NGUONDUOC_ID, nh.TENNGUONDUOC, nh.TINHTIEN, d.DUOC_ID, ld.MALOAIDUOC,        d.SOVISA,d.TYLE_VAT,d.COTOA, d.MADUOC, d.TENHANG, d.TENDUOCDAYDU, dvt.TENDONVITINH as DONVITINH, d.BHYT,        d.TENHOATCHAT, d.HAMLUONG, d.HANGSANXUAT, d.QUOCGIA, d.LOAIDUOC_ID, d.DUONGDUNG_ID, d.TINHTIEN_PTTT,        ten.TENDUOC, ten.TENDUOC_EN, ten.MAQUOCTE, ten.MAQUOCTEBT,        CASE WHEN d.BHYT = '1' THEN 'BHYT' ELSE '' END as BHYT_TEXT        , ld.LOAIVATTU_ID        , d.BENHVIEN_ID,        tk.SOLUONG, d.VTYT_PHANLOAI, d.PHAMVI, d.SUASOLUONGTONGHOP, d.MADUOCBV, d.DANGTRINHBAY        , TAMNGUNG = CASE WHEN d.TAMNGUNG = '1' OR nh.TAMNGUNG = '1' OR kd.TAMNGUNG = '1' THEN '1' ELSE '0' END        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        inner join        (        select  LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')) DUOC_KEY, (SUM(dtk.SOLUONG) - isnull(sum(A.SOLUONG),0) - isnull(sum(B.SOLUONG),0)) SOLUONG, pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        from (select sum(soluong) soluong,duoc_id,nguonduoc_id,khoduoc_id,benhvien_id from TT_DUOC_TONKHO  group by duoc_id,nguonduoc_id,khoduoc_id,benhvien_id) dtk        inner join TM_DUOC_PHAMVISD_MAPPING pvsd on dtk.KHODUOC_ID = pvsd.KHODUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NOITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) B on B.DUOC_ID = dtk.DUOC_ID and B.SOLUONG > 0 and B.PHAMVI_ID = pvsd.PHAMVI_ID and B.NGUONHANG_ID = dtk.NGUONDUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NGOAITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) A on A.DUOC_ID = dtk.DUOC_ID and A.SOLUONG > 0 and A.PHAMVI_ID = pvsd.PHAMVI_ID and A.NGUONHANG_ID = dtk.NGUONDUOC_ID        where dtk.SOLUONG > 0 and dtk.BENHVIEN_ID = 'HLU01'        group by LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')), pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        ) tk on tk.DUOC_ID = d.DUOC_ID        left join TM_DUOC_PHAMVISUDUNG kd on kd.PHAMVI_ID = tk.PHAMVI_ID and kd.BENHVIEN_ID = 'HLU01'        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = tk.NGUONDUOC_ID and nh.BENHVIEN_ID = 'HLU01'        where  d.BENHVIEN_ID = 'HLU01' and d.DUOC_ID in (1)        end        else        begin        select  distinct tk.DUOC_KEY, LTRIM(tk.PHAMVI_ID) as PHAMVI_ID, tk.NGUONDUOC_ID, nh.TENNGUONDUOC, nh.TINHTIEN, d.DUOC_ID, ld.MALOAIDUOC,        d.SOVISA,d.TYLE_VAT,d.COTOA, d.MADUOC, d.TENHANG, d.TENDUOCDAYDU, dvt.TENDONVITINH as DONVITINH, d.BHYT,        d.TENHOATCHAT, d.HAMLUONG, d.HANGSANXUAT, d.QUOCGIA, d.LOAIDUOC_ID, d.DUONGDUNG_ID, d.TINHTIEN_PTTT,        ten.TENDUOC, ten.TENDUOC_EN, ten.MAQUOCTE, ten.MAQUOCTEBT,        CASE WHEN d.BHYT = '1' THEN 'BHYT' ELSE '' END as BHYT_TEXT        , ld.LOAIVATTU_ID        , d.BENHVIEN_ID,        tk.SOLUONG, d.VTYT_PHANLOAI, d.PHAMVI, d.SUASOLUONGTONGHOP, d.MADUOCBV, d.DANGTRINHBAY        , TAMNGUNG = CASE WHEN d.TAMNGUNG = '1' OR nh.TAMNGUNG = '1' OR kd.TAMNGUNG = '1' THEN '1' ELSE '0' END        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        inner join        (        select  LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')) DUOC_KEY, (SUM(dtk.SOLUONG) - isnull(sum(A.SOLUONG),0) - isnull(sum(B.SOLUONG),0)) SOLUONG, pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        from (select sum(soluong) soluong,duoc_id,nguonduoc_id,khoduoc_id,benhvien_id from TT_DUOC_TONKHO  group by duoc_id,nguonduoc_id,khoduoc_id,benhvien_id) dtk        inner join TM_DUOC_PHAMVISD_MAPPING pvsd on dtk.KHODUOC_ID = pvsd.KHODUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NOITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) B on B.DUOC_ID = dtk.DUOC_ID and B.SOLUONG > 0 and B.PHAMVI_ID = pvsd.PHAMVI_ID and B.NGUONHANG_ID = dtk.NGUONDUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NGOAITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) A on A.DUOC_ID = dtk.DUOC_ID and A.SOLUONG > 0 and A.PHAMVI_ID = pvsd.PHAMVI_ID and A.NGUONHANG_ID = dtk.NGUONDUOC_ID        where dtk.SOLUONG > 0 and dtk.BENHVIEN_ID = 'HLU01'        group by LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')), pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        ) tk on tk.DUOC_ID = d.DUOC_ID        left join TM_DUOC_PHAMVISUDUNG kd on kd.PHAMVI_ID = tk.PHAMVI_ID and kd.BENHVIEN_ID = 'HLU01'        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = tk.NGUONDUOC_ID and nh.BENHVIEN_ID = 'HLU01'        where  d.BENHVIEN_ID = 'HLU01' and d.DUOC_ID in (1)        end]
2019-09-20 18:17:59,627 [1] DEBUG - Statement Id: [DAO00083_GetList_PhieuGhiNhanVTYT] PreparedStatement : [select DICHVU_GHINHANVTYT_ID, SOPHIEU, KHAMBENH_ID, TIEPNHAN_ID, DVYEUCAU_ID        from TT_DICHVU_GHINHANVTYT        where TIEPNHAN_ID = '27478'        and BENHVIEN_ID = 'HLU01'         and           KHAMBENH_ID = '26173'         and           DVYEUCAU_ID = '205443'                 order by THOIGIANGHINHAN desc]
2019-09-20 18:17:59,673 [1] DEBUG - Statement Id: [DAO00083_GetDSVTYTGhiNhan] PreparedStatement : [select A.*, dc.TENDUOCDAYDU, dc.BHYT DUOC_BHYT, ld.LOAIVATTU_ID, dc.DONVITINH        from TT_NGOAITRU_KHAMBENH_VTYT A        left join TM_DUOC dc on A.DUOC_ID = dc.DUOC_ID        left join TM_LOAIDUOC ld on dc.LOAIDUOC_ID = ld.LOAIDUOC_ID        where A.DVYEUCAU_ID =  @param0          and           A.DICHVU_GHINHANVTYT_ID = '4918'                 order by A.KHAMBENH_VTYT_ID]
2019-09-20 18:17:59,673 [1] DEBUG - Statement Id: [DAO00083_GetDSVTYTGhiNhan] Parameters: [@param0=[DVYEUCAU_ID,205443]]
2019-09-20 18:17:59,673 [1] DEBUG - Statement Id: [DAO00083_GetDSVTYTGhiNhan] Types: [@param0=[Int64, System.Int64]]
2019-09-20 18:17:59,705 [1] DEBUG - Statement Id: [DAO00063_GetSoChungTuByChungTuID] PreparedStatement : [select MACHUNGTU as SOCHUNGTU        from TT_DUOC_CHUNGTU        where CHUNGTU_ID  = '137705']
2019-09-20 18:17:59,735 [1] DEBUG - Statement Id: [DAO00023_GetTTVienPhiThuoc] PreparedStatement : [select *        from TT_VIENPHI        where REF_ID = '10593'        and REF_TABLE = 'TT_NGOAITRU_KHAMBENH_VTYT']
2019-09-20 18:17:59,921 [1] DEBUG - Statement Id: [DAO00066_GetBENHAN_TIEPNHAN] PreparedStatement : [select top 1 *        from TT_NOITRU_BENHAN        where TIEPNHAN_ID = '27478'  and BENHVIEN_ID = 'HLU01'        order by NGAYTAO desc]
2019-09-20 18:18:13,299 [1] DEBUG - Statement Id: [DAO00030_GetMucDichChungTuID] PreparedStatement : [SELECT DICTIONARY_ID              FROM              LST_DICTIONARY              WHERE              DICTIONARY_TYPE_CODE = 'MucDichChungTu'              and DICTIONARY_CODE = 'X13']
2019-09-20 18:18:13,465 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'PHA22'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2019-09-20 18:18:14,047 [1] DEBUG - Statement Id: [DAO00030_GET_SOLONHAP] PreparedStatement : [SELECT DISTINCT            SLN.SOLONHAP_ID, SLN.SOLONHAP, SLN.SOLOSANPHAM, SLN.SOKIEMSOAT, SLN.SOVISA, CONVERT(varchar(20), SLN.SOLOSANPHAM) + '/' + CONVERT(varchar(20), TK.SOLUONG) AS SOLOSOTON,            SLN.NGAYNHAP AS NGAYNHAPLO, SLN.HANDUNG AS HANSUDUNG,  SLN.HANDUNG, SLN.NGUONDUOC_ID, SLN.NGUONDUOC_ID as NGUONHANG_ID,            SLNGB.DONGIAMUA, SLNGB.DONGIAVON, SLNGB.TYLEVAT_DAUVAO as TYLEVAT, d.TYLE_VAT, SLNGB.DONGIAVONVAT, SLNGB.DONGIABAN, SLNGB.DONGIABANVAT_DAUVAO as DONGIABAN_VAT,            TK.DUOCTONKHO_ID, TK.KHODUOC_ID, TK.DUOC_ID, TK.SOLUONG, TK.SOLUONG AS SOLUONGTON,            D.TENDUOCDAYDU,D.DONVITINH_ID, D.DONVITINH, D.BHYT, NH.TENNGUONDUOC AS NGUONHANG,            LTRIM(TK.KHODUOC_ID) + '_' + LTRIM(TK.DUOC_ID) + '_' + LTRIM(TK.NGUONDUOC_ID) as DUOC_KEY, D.SO_QDTT            FROM            TT_DUOC_CHUNGTU_SOLONHAP SLN,            TT_DUOC_TONKHO TK,            TT_DUOC_SOLONHAP_GIABAN SLNGB,            TM_DUOC D,            TM_NGUONHANG NH            WHERE            SLN.SOLONHAP_ID = TK.SOLONHAP_ID            AND SLN.SOLONHAP_ID = SLNGB.SOLONHAP_ID            AND SLN.NGUONDUOC_ID = NH.NGUONDUOC_ID            AND SLN.DUOC_ID = D.DUOC_ID            AND TK.DUOC_ID = ''            AND TK.KHODUOC_ID = ''            AND SLN.BENHVIEN_ID = 'HLU01'            AND TK.SOLUONG > 0                 and                     SLN.NGUONDUOC_ID = '1'                                      ORDER BY NGAYNHAP]
2019-09-20 18:18:14,084 [1] DEBUG - Statement Id: [DAO00030_GetMucDichChungTuID] PreparedStatement : [SELECT DICTIONARY_ID              FROM              LST_DICTIONARY              WHERE              DICTIONARY_TYPE_CODE = 'MucDichChungTu'              and DICTIONARY_CODE = 'X13']
2019-09-20 18:18:14,199 [1] DEBUG - Statement Id: [DAO00030_GetMucDichChungTuID] PreparedStatement : [SELECT DICTIONARY_ID              FROM              LST_DICTIONARY              WHERE              DICTIONARY_TYPE_CODE = 'MucDichChungTu'              and DICTIONARY_CODE = 'X13']
2019-09-20 18:18:14,529 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'PHA74'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2019-09-20 18:18:16,585 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'COM98'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2019-09-20 18:18:16,979 [1] DEBUG - Statement Id: [DAO00030_Search_PhieuXuatSD] PreparedStatement : [SELECT DISTINCT phieuxuat.* FROM          (          select DISTINCT          CT.CHUNGTU_ID,          CT.SOCHUNGTU,          CT.MACHUNGTU,          CT.NGAYCHUNGTU,          CT.NGAYTAO,          CT.KHOXUAT_ID,          CT.NGUOIGIAO_ID,          CT.KHONHAP_ID,          CT.NGUOINHAN_ID,          PL.MACHUNGTU as MAPHIEULINH,          PL.NGAYCHUNGTU as NGAYPHIEULINH,          bn.MAYTE,          bn.TENBENHNHAN,          CONVERT(VARCHAR(10), KB.THOIGIANKHAM, 103) + ' - ' + CONVERT(VARCHAR(5), KB.THOIGIANKHAM, 108) as THOIGIANKHAM,          nl.TENNHANVIEN as NGUOILAP,          CT.DIENGIAI          from TT_DUOC_CHUNGTU CT          inner join TT_DUOC_CHUNGTU_CHITIET ctct on ct.CHUNGTU_ID = ctct.CHUNGTU_ID          inner join TT_NOITRU_TOATHUOC TT on ctct.TOATHUOCNOITRU_ID = TT.TOATHUOC_ID          inner join TT_NOITRU_KHAMBENH KB on kb.KHAMBENH_ID = TT.KHAMBENH_ID          inner join TT_BENHNHAN BN on TT.BENHNHAN_ID = BN.BENHNHAN_ID          left join TT_DUOC_PHIEULINH PL on PL.CHUNGTU_ID = CT.PHIEULINH_ID          left join TM_NHANVIEN nl on nl.NHANVIEN_ID = TT.NGUOITAO_ID           where                   CT.MUCDICHCHUNGTU_ID = '1060'               and                 CT.KHOXUAT_ID = '32'               and                 CONVERT(date, CT.NGAYCHUNGTU) BETWEEN CONVERT(date, '9/20/2019 12:00:00 AM')  and  CONVERT(date, '9/20/2019 12:00:00 AM')               and                 CT.BENHVIEN_ID = 'HLU01'                           UNION            select DISTINCT          CT.CHUNGTU_ID,          CT.SOCHUNGTU,          CT.MACHUNGTU,          CT.NGAYCHUNGTU,          CT.NGAYTAO,          CT.KHOXUAT_ID,          CT.NGUOIGIAO_ID,          CT.KHONHAP_ID,          CT.NGUOINHAN_ID,          PL.MACHUNGTU as MAPHIEULINH,          PL.NGAYCHUNGTU as NGAYPHIEULINH,          bn.MAYTE,          bn.TENBENHNHAN,          CONVERT(VARCHAR(10), KB.THOIGIANKHAM, 103) + ' - ' + CONVERT(VARCHAR(5), KB.THOIGIANKHAM, 108) as THOIGIANKHAM,          nl.TENNHANVIEN as NGUOILAP,          CT.DIENGIAI          from TT_DUOC_CHUNGTU CT          inner join TT_DUOC_CHUNGTU_CHITIET ctct on ct.CHUNGTU_ID = ctct.CHUNGTU_ID          inner join TT_NGOAITRU_KHAMBENH_VTYT vt on ctct.KHAMBENH_VTYT_ID = vt.KHAMBENH_VTYT_ID          inner join TT_NGOAITRU_KHAMBENH kb on kb.KHAMBENH_ID = vt.KHAMBENH_ID          inner join TT_BENHNHAN BN on bn.BENHNHAN_ID = kb.BENHNHAN_ID          left join TT_DUOC_PHIEULINH PL on PL.CHUNGTU_ID = CT.PHIEULINH_ID          left join TM_NHANVIEN nl on nl.NHANVIEN_ID = vt.NGUOITAO_ID           where                   CT.MUCDICHCHUNGTU_ID = '1060'               and                 CT.KHOXUAT_ID = '32'               and                 CONVERT(date, CT.NGAYCHUNGTU) BETWEEN CONVERT(date, '9/20/2019 12:00:00 AM')  and  CONVERT(date, '9/20/2019 12:00:00 AM')               and                 CT.BENHVIEN_ID = 'HLU01'                           UNION            select DISTINCT          CT.CHUNGTU_ID,          CT.SOCHUNGTU,          CT.MACHUNGTU,          CT.NGAYCHUNGTU,          CT.NGAYTAO,          CT.KHOXUAT_ID,          CT.NGUOIGIAO_ID,          CT.KHONHAP_ID,          CT.NGUOINHAN_ID,          PL.MACHUNGTU as MAPHIEULINH,          PL.NGAYCHUNGTU as NGAYPHIEULINH,          bn.MAYTE,          bn.TENBENHNHAN,          CONVERT(VARCHAR(10), pt.NGAYTHUCHIEN, 103) + ' - ' + CONVERT(VARCHAR(5), pt.NGAYTHUCHIEN, 108) as THOIGIANKHAM,          nl.TENNHANVIEN as NGUOILAP,          CT.DIENGIAI          from TT_DUOC_CHUNGTU CT          inner join TT_DUOC_CHUNGTU_CHITIET ctct on ct.CHUNGTU_ID = ctct.CHUNGTU_ID          inner join TT_PHAUTHUAT_VTYT vt on ctct.PHAUTHUAT_VTYT_ID = vt.PHAUTHUAT_VTYT_ID          inner join TT_PHAUTHUAT pt on pt.PHAUTHUAT_ID = vt.PHAUTHUAT_ID          inner join TT_TIEPNHAN tn on tn.TIEPNHAN_ID = pt.TIEPNHAN_ID          inner join TT_BENHNHAN bn on bn.BENHNHAN_ID = tn.BENHNHAN_ID          left join TT_DUOC_PHIEULINH PL on PL.CHUNGTU_ID = CT.PHIEULINH_ID          left join TM_NHANVIEN nl on nl.NHANVIEN_ID = pt.NGUOITAO_ID           where                   CT.MUCDICHCHUNGTU_ID = '1060'               and                 CT.KHOXUAT_ID = '32'               and                 CONVERT(date, CT.NGAYCHUNGTU) BETWEEN CONVERT(date, '9/20/2019 12:00:00 AM')  and  CONVERT(date, '9/20/2019 12:00:00 AM')               and                 CT.BENHVIEN_ID = 'HLU01'                           UNION            select DISTINCT          CT.CHUNGTU_ID,          CT.SOCHUNGTU,          CT.MACHUNGTU,          CT.NGAYCHUNGTU,          CT.NGAYTAO,          CT.KHOXUAT_ID,          CT.NGUOIGIAO_ID,          CT.KHONHAP_ID,          CT.NGUOINHAN_ID,          PL.MACHUNGTU as MAPHIEULINH,          PL.NGAYCHUNGTU as NGAYPHIEULINH,          bn.MAYTE,          bn.TENBENHNHAN,          CONVERT(VARCHAR(10), cls.NGAYTAO, 103) + ' - ' + CONVERT(VARCHAR(5), cls.NGAYTAO, 108) as THOIGIANKHAM,          nl.TENNHANVIEN as NGUOILAP,          CT.DIENGIAI          from TT_DUOC_CHUNGTU CT          inner join TT_DUOC_CHUNGTU_CHITIET ctct on ct.CHUNGTU_ID = ctct.CHUNGTU_ID          inner join TT_CLSKETQUA_VTYT cls on ctct.CLSKETQUA_VTYT_ID = cls.CLSKETQUA_VTYT_ID          inner join TT_DVYEUCAU DV on DV.DVYEUCAU_ID = CLS.DVYEUCAU_ID          inner join TT_BENHNHAN bn on bn.BENHNHAN_ID = DV.BENHNHAN_ID          left join TT_DUOC_PHIEULINH PL on PL.CHUNGTU_ID = CT.PHIEULINH_ID          left join TM_NHANVIEN nl on nl.NHANVIEN_ID = cls.NGUOITAO_ID           where                   CT.MUCDICHCHUNGTU_ID = '1060'               and                 CT.KHOXUAT_ID = '32'               and                 CONVERT(date, CT.NGAYCHUNGTU) BETWEEN CONVERT(date, '9/20/2019 12:00:00 AM')  and  CONVERT(date, '9/20/2019 12:00:00 AM')               and                 CT.BENHVIEN_ID = 'HLU01'                           UNION            select DISTINCT          CT.CHUNGTU_ID,          CT.SOCHUNGTU,          CT.MACHUNGTU,          CT.NGAYCHUNGTU,          CT.NGAYTAO,          CT.KHOXUAT_ID,          CT.NGUOIGIAO_ID,          CT.KHONHAP_ID,          CT.NGUOINHAN_ID,          PL.MACHUNGTU as MAPHIEULINH,          PL.NGAYCHUNGTU as NGAYPHIEULINH,          null as MAYTE,          null as TENBENHNHAN,          null as THOIGIANKHAM,          nl.TENNHANVIEN as NGUOILAP,          CT.DIENGIAI          from TT_DUOC_CHUNGTU CT          inner join TT_DUOC_CHUNGTU_CHITIET ctct on ct.CHUNGTU_ID = ctct.CHUNGTU_ID          left join TT_DUOC_PHIEULINH PL on PL.CHUNGTU_ID = CT.PHIEULINH_ID          left join TM_NHANVIEN nl on nl.NHANVIEN_ID = ct.NGUOITAO_ID          WHERE (ctct.TOATHUOCNOITRU_ID IS NULL AND ctct.KHAMBENH_VTYT_ID IS NULL AND ctct.PHAUTHUAT_VTYT_ID IS NULL AND ctct.CLSKETQUA_VTYT_ID IS NULL)             and                 CT.MUCDICHCHUNGTU_ID = '1060'               and                 CT.KHOXUAT_ID = '32'               and                 CONVERT(date, CT.NGAYCHUNGTU) BETWEEN CONVERT(date, '9/20/2019 12:00:00 AM')  and  CONVERT(date, '9/20/2019 12:00:00 AM')               and                 CT.BENHVIEN_ID = 'HLU01'                         )PhieuXuat          ORDER BY PhieuXuat.CHUNGTU_ID desc]
2019-09-20 18:18:32,608 [1] DEBUG - Statement Id: [DAO00030_GetList] PreparedStatement : [select *              from TT_DUOC_CHUNGTU              where BENHVIEN_ID = 'HLU01'                and                   TT_DUOC_CHUNGTU.CHUNGTU_ID = '137705'                               order by CHUNGTU_ID]
2019-09-20 18:18:37,890 [1] DEBUG - Statement Id: [DAO00030_CHUNGTUXUAT_CHITIET_GetList] PreparedStatement : [SELECT            ctct.*,            d.MADUOC, d.TENHANG, d.TENDUOCDAYDU, dvt.TENDONVITINH as DONVITINH,n.TENNGUONDUOC as NGUONHANG,            sln.SOLONHAP, sln.SOLOSANPHAM, sln.NGAYNHAP as NGAYNHAPLO, sln.HANDUNG as HANSUDUNG,            isnull(tk.SOLUONG,0) as SOLUONGTON,            LTRIM(ct.KHOXUAT_ID) + '_' + LTRIM(sln.DUOC_ID) + '_' + LTRIM(sln.NGUONDUOC_ID) as DUOC_KEY            , NLD.MANHOMLOAIDUOC, ld.MALOAIDUOC, D.SO_QDTT            FROM            TT_DUOC_CHUNGTU_CHITIET ctct            INNER JOIN TT_DUOC_CHUNGTU ct ON (ct.CHUNGTU_ID = ctct.CHUNGTU_ID)            INNER JOIN TT_DUOC_CHUNGTU_SOLONHAP sln ON (sln.SOLONHAP_ID = ctct.SOLONHAP_ID)            LEFT JOIN (            select xx.DUOCTONKHO_ID, xx.KHODUOC_ID, xx.DUOC_ID, xx.SOLONHAP_ID, xx.SOLUONG, xx.NGUONDUOC_ID, xx.BENHVIEN_ID from TT_DUOC_TONKHO xx            join ( select max(DUOCTONKHO_ID) as DUOCTONKHO_ID, KHODUOC_ID, DUOC_ID, SOLONHAP_ID, NGUONDUOC_ID            from TT_DUOC_TONKHO group by KHODUOC_ID, DUOC_ID, SOLONHAP_ID, NGUONDUOC_ID) yy on xx.DUOCTONKHO_ID=yy.DUOCTONKHO_ID            ) tk ON (tk.SOLONHAP_ID = sln.SOLONHAP_ID AND tk.DUOC_ID = sln.DUOC_ID and tk.KHODUOC_ID = ct.KHOXUAT_ID)            INNER JOIN TM_DUOC d ON (d.DUOC_ID = ctct.DUOC_ID)            INNER JOIN TM_NGUONHANG n ON (n.NGUONDUOC_ID = ctct.NGUONHANG_ID)            LEFT JOIN TM_DONVITINH dvt ON (dvt.DONVITINH_ID = ctct.DONVITINH_ID)            left join TM_LOAIDUOC LD on LD.LOAIDUOC_ID = D.LOAIDUOC_ID            LEFT JOIN TM_NHOMLOAIDUOC NLD on NLD.NHOMLOAIDUOC_ID = LD.NHOMLOAIDUOC_ID             where                             ct.CHUNGTU_ID = '137705'                       and                           ct.BENHVIEN_ID = 'HLU01'                                     order by CHUNGTUCHITIET_ID]
2019-09-20 18:19:11,881 [1] DEBUG - Statement Id: [DAO00030_KiemTraChungTuKhoaSo] PreparedStatement : [SELECT CHUNGTU_ID              FROM TT_DUOC_CHUNGTU              WHERE              MACHUNGTU = 'CS_KBX1319003093'              and BENHVIEN_ID = 'HLU01'              and              convert(date, NGAYCHUNGTU) <=              (              SELECT TOP 1 convert(date, KHOADENNGAY)              FROM TT_DUOC_KHOASOCHUNGTU              WHERE              KHODUOC_ID = '32'              and BENHVIEN_ID = 'HLU01'              AND KHOASO = '1'              ORDER BY KHOADENNGAY DESC              )]
2019-09-20 18:19:12,041 [1] DEBUG - Statement Id: [DAO00030_KiemTraChungTuDaChuyenKeToan] PreparedStatement : [SELECT CHUNGTU_ID            FROM TT_DUOC_CHUNGTU            WHERE            CHUNGTU_ID = '137705'            and IDCHUYEN IS NOT NULL            and BENHVIEN_ID = 'HLU01']
2019-09-20 18:19:12,136 [1] DEBUG - Statement Id: [DAO00030_KiemTraBenhNhanXuatVien] PreparedStatement : [select              TT.TOATHUOC_ID              from              TT_NOITRU_TOATHUOC TT              inner join TT_NOITRU_KHAMBENH KB on TT.KHAMBENH_ID = KB.KHAMBENH_ID              inner join TT_NOITRU_BENHAN BA on BA.BENHAN_ID = KB.BENHAN_ID              WHERE              BA.TRANGTHAI = 'DAXUATVIEN'              AND TT.CHUNGTU_ID =  137705              and TT.BENHVIEN_ID = 'HLU01']
2019-09-20 18:19:12,354 [1] DEBUG - Statement Id: [DAO00030_DUOCTONKHO_GetSoTonTheoDuoc] PreparedStatement : [SELECT              DUOC_ID,              SUM(SOLUONG) AS TONGTON              FROM              TT_DUOC_TONKHO              WHERE              KHODUOC_ID = '32'              and BENHVIEN_ID = 'HLU01'              and DUOC_ID IN (1)              GROUP BY DUOC_ID]
2019-09-20 18:19:12,394 [1] DEBUG - Statement Id: [DAO00030_DUOCTONKHO_GetSoTonTheoDuocTheoLo] PreparedStatement : [SELECT              DUOC_ID,SOLONHAP_ID,              SUM(SOLUONG) AS SOLUONGTONLO              FROM              TT_DUOC_TONKHO              WHERE              KHODUOC_ID = '32'              and BENHVIEN_ID = 'HLU01'              and DUOC_ID IN (1)              and SOLONHAP_ID IN (7541)              GROUP BY DUOC_ID, SOLONHAP_ID]
2019-09-20 18:19:12,427 [1] DEBUG - Statement Id: [DAO00030_DUOCTONKHO_GetSoTonTheoDuoc] PreparedStatement : [SELECT              DUOC_ID,              SUM(SOLUONG) AS TONGTON              FROM              TT_DUOC_TONKHO              WHERE              KHODUOC_ID = '32'              and BENHVIEN_ID = 'HLU01'              and DUOC_ID IN (1)              GROUP BY DUOC_ID]
2019-09-20 18:19:12,498 [1] DEBUG - Statement Id: [DAO00030_KTDaPhatSinhBienLai] PreparedStatement : [SELECT CHUNGTU_ID            FROM TT_NOITRU_TOATHUOC tt            INNER JOIN TT_VIENPHI vp on (tt.TOATHUOC_ID = vp.REF_ID and REF_TABLE = 'TT_NOITRU_TOATHUOC')            WHERE            CHUNGTU_ID = '137705'            AND tt.BENHVIEN_ID = 'HLU01'            AND HOADON_ID is not NULL            AND vp.HUY = '0'              union all            SELECT  kbtt.CHUNGTUPHATTHUOC_ID as CHUNGTU_ID            FROM TT_NGOAITRU_TOATHUOC tt            INNER JOIN TT_NGOAITRU_KHAMBENH_TOATHUOC kbtt on (kbtt.KHAMBENH_TOATHUOC_ID = tt.KHAMBENH_TOATHUOC_ID)            INNER JOIN TT_VIENPHI vp on (tt.TOATHUOC_ID = vp.REF_ID and REF_TABLE = 'TT_NGOAITRU_TOATHUOC')            WHERE            kbtt.CHUNGTUPHATTHUOC_ID = '137705'            AND tt.BENHVIEN_ID = 'HLU01'            AND HOADON_ID is not NULL            AND vp.HUY = '0'              union all            SELECT ctct.CHUNGTU_ID from            TT_DUOC_CHUNGTU_CHITIET ctct            INNER JOIN TT_HOADON_CHITIET_NGOAITRU hdct on (hdct.REF_ID = ctct.CHUNGTUCHITIET_ID and hdct.REF_TABLE = 'TT_DUOC_CHUNGTU_CHITIET')            INNER JOIN TT_HOADON hd on hd.HOADON_ID = hdct.HOADON_ID            WHERE            ctct.CHUNGTU_ID = '137705'                            AND hd.HUYHOADON = '0'              AND hd.HOANTRA = '0'                                  AND ctct.BENHVIEN_ID = 'HLU01'                        union all            SELECT CHUNGTU_ID            FROM TT_NGOAITRU_KHAMBENH_VTYT tt            INNER JOIN TT_VIENPHI vp on (tt.KHAMBENH_VTYT_ID = vp.REF_ID and REF_TABLE = 'TT_NGOAITRU_KHAMBENH_VTYT')            WHERE            CHUNGTU_ID = '137705'            AND tt.BENHVIEN_ID = 'HLU01'            AND HOADON_ID is not NULL            AND vp.HUY = '0'                        union all            SELECT CHUNGTU_ID            FROM TT_PHAUTHUAT_VTYT tt            INNER JOIN TT_VIENPHI vp on (tt.PHAUTHUAT_VTYT_ID = vp.REF_ID and REF_TABLE = 'TT_PHAUTHUAT_VTYT')            WHERE            CHUNGTU_ID = '137705'            AND tt.BENHVIEN_ID = 'HLU01'            AND HOADON_ID is not NULL            AND vp.HUY = '0'                        union all            SELECT CHUNGTU_ID            FROM TT_CLSKETQUA_VTYT tt            INNER JOIN TT_VIENPHI vp on (tt.CLSKETQUA_VTYT_ID = vp.REF_ID and REF_TABLE = 'TT_CLSKETQUA_VTYT')            WHERE            CHUNGTU_ID = '137705'            AND tt.BENHVIEN_ID = 'HLU01'            AND HOADON_ID is not NULL            AND vp.HUY = '0']
2019-09-20 18:19:16,484 [1] DEBUG - Statement Id: [DAO00030_KTDaPhatSinhBienLai] PreparedStatement : [SELECT CHUNGTU_ID            FROM TT_NOITRU_TOATHUOC tt            INNER JOIN TT_VIENPHI vp on (tt.TOATHUOC_ID = vp.REF_ID and REF_TABLE = 'TT_NOITRU_TOATHUOC')            WHERE            CHUNGTU_ID = '137705'            AND tt.BENHVIEN_ID = 'HLU01'            AND HOADON_ID is not NULL            AND vp.HUY = '0'              union all            SELECT  kbtt.CHUNGTUPHATTHUOC_ID as CHUNGTU_ID            FROM TT_NGOAITRU_TOATHUOC tt            INNER JOIN TT_NGOAITRU_KHAMBENH_TOATHUOC kbtt on (kbtt.KHAMBENH_TOATHUOC_ID = tt.KHAMBENH_TOATHUOC_ID)            INNER JOIN TT_VIENPHI vp on (tt.TOATHUOC_ID = vp.REF_ID and REF_TABLE = 'TT_NGOAITRU_TOATHUOC')            WHERE            kbtt.CHUNGTUPHATTHUOC_ID = '137705'            AND tt.BENHVIEN_ID = 'HLU01'            AND HOADON_ID is not NULL            AND vp.HUY = '0'              union all            SELECT ctct.CHUNGTU_ID from            TT_DUOC_CHUNGTU_CHITIET ctct            INNER JOIN TT_HOADON_CHITIET_NGOAITRU hdct on (hdct.REF_ID = ctct.CHUNGTUCHITIET_ID and hdct.REF_TABLE = 'TT_DUOC_CHUNGTU_CHITIET')            INNER JOIN TT_HOADON hd on hd.HOADON_ID = hdct.HOADON_ID            WHERE            ctct.CHUNGTU_ID = '137705'                            AND hd.HUYHOADON = '0'              AND hd.HOANTRA = '0'                                  AND ctct.BENHVIEN_ID = 'HLU01'                        union all            SELECT CHUNGTU_ID            FROM TT_NGOAITRU_KHAMBENH_VTYT tt            INNER JOIN TT_VIENPHI vp on (tt.KHAMBENH_VTYT_ID = vp.REF_ID and REF_TABLE = 'TT_NGOAITRU_KHAMBENH_VTYT')            WHERE            CHUNGTU_ID = '137705'            AND tt.BENHVIEN_ID = 'HLU01'            AND HOADON_ID is not NULL            AND vp.HUY = '0'                        union all            SELECT CHUNGTU_ID            FROM TT_PHAUTHUAT_VTYT tt            INNER JOIN TT_VIENPHI vp on (tt.PHAUTHUAT_VTYT_ID = vp.REF_ID and REF_TABLE = 'TT_PHAUTHUAT_VTYT')            WHERE            CHUNGTU_ID = '137705'            AND tt.BENHVIEN_ID = 'HLU01'            AND HOADON_ID is not NULL            AND vp.HUY = '0'                        union all            SELECT CHUNGTU_ID            FROM TT_CLSKETQUA_VTYT tt            INNER JOIN TT_VIENPHI vp on (tt.CLSKETQUA_VTYT_ID = vp.REF_ID and REF_TABLE = 'TT_CLSKETQUA_VTYT')            WHERE            CHUNGTU_ID = '137705'            AND tt.BENHVIEN_ID = 'HLU01'            AND HOADON_ID is not NULL            AND vp.HUY = '0']
2019-09-20 18:19:16,733 [1] DEBUG - Statement Id: [DAO00030_KTDaPhatSinhPhieuBHTN] PreparedStatement : [SELECT vp.VIENPHI_ID              FROM TT_VIENPHI vp              INNER JOIN TT_MIENGIAM_CHITIET  mgct on mgct.VIENPHI_ID = vp.VIENPHI_ID              INNER JOIN TT_DUOC_CHUNGTU ct on ct.TIEPNHAN_ID = vp.TIEPNHAN_ID              WHERE              ct.CHUNGTU_ID = '137705'              AND vp.DUOC_ID is not null              AND vp.BENHVIEN_ID = 'HLU01']
2019-09-20 18:19:16,837 [1] DEBUG - Statement Id: [DAO00030_KiemTraBenhNhanXuatVien] PreparedStatement : [select              TT.TOATHUOC_ID              from              TT_NOITRU_TOATHUOC TT              inner join TT_NOITRU_KHAMBENH KB on TT.KHAMBENH_ID = KB.KHAMBENH_ID              inner join TT_NOITRU_BENHAN BA on BA.BENHAN_ID = KB.BENHAN_ID              WHERE              BA.TRANGTHAI = 'DAXUATVIEN'              AND TT.CHUNGTU_ID =  137705              and TT.BENHVIEN_ID = 'HLU01']
2019-09-20 18:19:17,094 [1] DEBUG - Statement Id: [DAO00030_KiemTraChungTuKhoaSo] PreparedStatement : [SELECT CHUNGTU_ID              FROM TT_DUOC_CHUNGTU              WHERE              MACHUNGTU = 'CS_KBX1319003093'              and BENHVIEN_ID = 'HLU01'              and              convert(date, NGAYCHUNGTU) <=              (              SELECT TOP 1 convert(date, KHOADENNGAY)              FROM TT_DUOC_KHOASOCHUNGTU              WHERE              KHODUOC_ID = '32'              and BENHVIEN_ID = 'HLU01'              AND KHOASO = '1'              ORDER BY KHOADENNGAY DESC              )]
2019-09-20 18:19:20,310 [1] DEBUG - Statement Id: [DAO00030_KiemTraChungTuKhoaSo] PreparedStatement : [SELECT CHUNGTU_ID              FROM TT_DUOC_CHUNGTU              WHERE              MACHUNGTU = 'CS_KBX1319003093'              and BENHVIEN_ID = 'HLU01'              and              convert(date, NGAYCHUNGTU) <=              (              SELECT TOP 1 convert(date, KHOADENNGAY)              FROM TT_DUOC_KHOASOCHUNGTU              WHERE              KHODUOC_ID = '32'              and BENHVIEN_ID = 'HLU01'              AND KHOASO = '1'              ORDER BY KHOADENNGAY DESC              )]
2019-09-20 18:19:20,339 [1] DEBUG - Statement Id: [DAO00030_KiemTraChungTuDaChuyenKeToan] PreparedStatement : [SELECT CHUNGTU_ID            FROM TT_DUOC_CHUNGTU            WHERE            CHUNGTU_ID = '137705'            and IDCHUYEN IS NOT NULL            and BENHVIEN_ID = 'HLU01']
2019-09-20 18:19:20,368 [1] DEBUG - Statement Id: [DAO00030_KTDaPhatSinhBienLai] PreparedStatement : [SELECT CHUNGTU_ID            FROM TT_NOITRU_TOATHUOC tt            INNER JOIN TT_VIENPHI vp on (tt.TOATHUOC_ID = vp.REF_ID and REF_TABLE = 'TT_NOITRU_TOATHUOC')            WHERE            CHUNGTU_ID = '137705'            AND tt.BENHVIEN_ID = 'HLU01'            AND HOADON_ID is not NULL            AND vp.HUY = '0'              union all            SELECT  kbtt.CHUNGTUPHATTHUOC_ID as CHUNGTU_ID            FROM TT_NGOAITRU_TOATHUOC tt            INNER JOIN TT_NGOAITRU_KHAMBENH_TOATHUOC kbtt on (kbtt.KHAMBENH_TOATHUOC_ID = tt.KHAMBENH_TOATHUOC_ID)            INNER JOIN TT_VIENPHI vp on (tt.TOATHUOC_ID = vp.REF_ID and REF_TABLE = 'TT_NGOAITRU_TOATHUOC')            WHERE            kbtt.CHUNGTUPHATTHUOC_ID = '137705'            AND tt.BENHVIEN_ID = 'HLU01'            AND HOADON_ID is not NULL            AND vp.HUY = '0'              union all            SELECT ctct.CHUNGTU_ID from            TT_DUOC_CHUNGTU_CHITIET ctct            INNER JOIN TT_HOADON_CHITIET_NGOAITRU hdct on (hdct.REF_ID = ctct.CHUNGTUCHITIET_ID and hdct.REF_TABLE = 'TT_DUOC_CHUNGTU_CHITIET')            INNER JOIN TT_HOADON hd on hd.HOADON_ID = hdct.HOADON_ID            WHERE            ctct.CHUNGTU_ID = '137705'                            AND hd.HUYHOADON = '0'              AND hd.HOANTRA = '0'                                  AND ctct.BENHVIEN_ID = 'HLU01'                        union all            SELECT CHUNGTU_ID            FROM TT_NGOAITRU_KHAMBENH_VTYT tt            INNER JOIN TT_VIENPHI vp on (tt.KHAMBENH_VTYT_ID = vp.REF_ID and REF_TABLE = 'TT_NGOAITRU_KHAMBENH_VTYT')            WHERE            CHUNGTU_ID = '137705'            AND tt.BENHVIEN_ID = 'HLU01'            AND HOADON_ID is not NULL            AND vp.HUY = '0'                        union all            SELECT CHUNGTU_ID            FROM TT_PHAUTHUAT_VTYT tt            INNER JOIN TT_VIENPHI vp on (tt.PHAUTHUAT_VTYT_ID = vp.REF_ID and REF_TABLE = 'TT_PHAUTHUAT_VTYT')            WHERE            CHUNGTU_ID = '137705'            AND tt.BENHVIEN_ID = 'HLU01'            AND HOADON_ID is not NULL            AND vp.HUY = '0'                        union all            SELECT CHUNGTU_ID            FROM TT_CLSKETQUA_VTYT tt            INNER JOIN TT_VIENPHI vp on (tt.CLSKETQUA_VTYT_ID = vp.REF_ID and REF_TABLE = 'TT_CLSKETQUA_VTYT')            WHERE            CHUNGTU_ID = '137705'            AND tt.BENHVIEN_ID = 'HLU01'            AND HOADON_ID is not NULL            AND vp.HUY = '0']
2019-09-20 18:19:20,615 [1] DEBUG - Statement Id: [DAO00030_KiemTraBenhNhanXuatVien] PreparedStatement : [select              TT.TOATHUOC_ID              from              TT_NOITRU_TOATHUOC TT              inner join TT_NOITRU_KHAMBENH KB on TT.KHAMBENH_ID = KB.KHAMBENH_ID              inner join TT_NOITRU_BENHAN BA on BA.BENHAN_ID = KB.BENHAN_ID              WHERE              BA.TRANGTHAI = 'DAXUATVIEN'              AND TT.CHUNGTU_ID =  137705              and TT.BENHVIEN_ID = 'HLU01']
2019-09-20 18:19:20,778 [1] DEBUG - Statement Id: [DAO00030_DUOCTONKHO_GetSoTonTheoDuocTheoLo] PreparedStatement : [SELECT              DUOC_ID,SOLONHAP_ID,              SUM(SOLUONG) AS SOLUONGTONLO              FROM              TT_DUOC_TONKHO              WHERE              KHODUOC_ID = '32'              and BENHVIEN_ID = 'HLU01'              and DUOC_ID IN (1)              and SOLONHAP_ID IN (7541)              GROUP BY DUOC_ID, SOLONHAP_ID]
2019-09-20 18:19:20,808 [1] DEBUG - Statement Id: [DAO00030_LayNgayKhoaSoCuoi] PreparedStatement : [SELECT TOP 1 KHOADENNGAY              FROM TT_DUOC_KHOASOCHUNGTU              WHERE              KHODUOC_ID = '32'              and BENHVIEN_ID = 'HLU01'              and KHOASO = '1'              ORDER BY KHOADENNGAY DESC]
2019-09-20 18:19:20,897 [1] DEBUG - Statement Id: [DAO00030_GetList] PreparedStatement : [select *              from TT_DUOC_CHUNGTU              where BENHVIEN_ID = 'HLU01'                and                   TT_DUOC_CHUNGTU.MACHUNGTU = 'CS_KBX1319003093'                               order by CHUNGTU_ID]
2019-09-20 18:19:20,982 [1] DEBUG - Statement Id: [DAO00030_KiemTraBenhNhanXuatVien] PreparedStatement : [select              TT.TOATHUOC_ID              from              TT_NOITRU_TOATHUOC TT              inner join TT_NOITRU_KHAMBENH KB on TT.KHAMBENH_ID = KB.KHAMBENH_ID              inner join TT_NOITRU_BENHAN BA on BA.BENHAN_ID = KB.BENHAN_ID              WHERE              BA.TRANGTHAI = 'DAXUATVIEN'              AND TT.CHUNGTU_ID =  137705              and TT.BENHVIEN_ID = 'HLU01']
2019-09-20 18:19:25,994 [1] DEBUG - Statement Id: [DAO00030_Update] PreparedStatement : [update TT_DUOC_CHUNGTU set              NGAYCHUNGTU =  @param0               , LOAICHUNGTU =  @param1               , MUCDICHCHUNGTU_ID =  @param2               , MUCDICHCHUNGTU_CODE =  @param3               , KHOXUAT_ID =  @param4               , NGUOIGIAO_ID =  @param5               , NGUOIGIAO =  @param6               , KHONHAP_ID =  @param7               , NGUOINHAN_ID =  @param8               , NGUOINHAN =  @param9               , NGUOIKIEMTRA_ID =  @param10               , NGUOIKIEMTRA =  @param11               , NGUOIDUYET_ID =  @param12               , NGUOIDUYET =  @param13               , PHUONGPHAPXUAT =  @param14               , KETOANTRUONG_ID =  @param15               , KETOANTRUONG =  @param16               , THUKHO_ID =  @param17               , THUKHO =  @param18               , MAUHOADON =  @param19               , SOHOADON =  @param20               , SOSERI =  @param21               , NGAYHOADON =  @param22               , DIENGIAI =  @param23               , GIATRI =  @param24               , GIATRITHANHTOAN =  @param25               , TYLEVAT =  @param26               , GIATRIVAT =  @param27               , THUESUAT =  @param28               , GIATRITHUE =  @param29               , TYLECHIETKHAU =  @param30               , GIATRICHIETKHAU =  @param31               , TIENTE_ID =  @param32               , TYGIA =  @param33               , SOCHUNGTUGOC =  @param34               , NGAYCHUNGTUGOC =  @param35               , NHACUNGCAP_ID =  @param36               , HINHTHUCTHANHTOAN_ID =  @param37               , NGUONDUOC_ID =  @param38               , CHUNGTULIENQUAN_ID =  @param39               , KHAMBENH_ID =  @param40               , TOATHUOCNOITRU_ID =  @param41               , TIEPNHAN_ID =  @param42               , BENHAN_ID =  @param43               , DANHANTHUOC =  @param44               , NGUOINHAP_ID =  @param45               , NGAYNHAP =  @param46               , TRANGTHAI =  @param47               , PHIEULINH_ID =  @param48               , LOAITOATHUOC =  @param49               , DIENGIAINGHIEPVUPHATSINH =  @param50               , DONVIGIAO_ID =  @param51               , KHOSUDUNG_ID =  @param52               , LOAIVATTU_ID =  @param53               , BENHNHAN_ID =  @param54               , TENBENHNHAN =  @param55               , BACSIGIOITHIEU_ID =  @param56               , DOITUONG_ID =  @param57               , IDCHUYEN =  @param58               , CHUNGTUKETOAN =  @param59               , STATUS =  @param60               , TRANSFER_VIENPHI_ID =  @param61               , PHONGBAN_ID =  @param62               , BACSI_ID =  @param63               , TKNO =  @param64               , TKCO =  @param65               , MACHUNGTUREF =  @param66               , LOAICHUNGTUREF =  @param67               , PHIEULINHCANTRU_ID =  @param68               , KHOTHUCHIEN_ID =  @param69               , KHODOIUNG_ID =  @param70               , MENU_LOAIDUOC_ID =  @param71               , NGUOISUDUNGMAY_ID =  @param72               , GOITHAU_ID =  @param73               , XUATTHUOCBANGOAITRU =  @param74               , NGAYGIOCHUNGTU =  @param75               , NOIDAKHAM =  @param76               , HOIDONGKIEMNHAP_ID =  @param77               , HOIDONGTHANHLY_ID =  @param78               , CHUYENCHUNGTUID =  @param79               , CHUYENDOANHTHUID =  @param80               , LYDOXUATSUDUNG_ID =  @param81                         , NGAYCAPNHAT =  @param82               , NGUOICAPNHAT_ID =  @param83               where              CHUNGTU_ID = '137705']
2019-09-20 18:19:25,998 [1] DEBUG - Statement Id: [DAO00030_Update] Parameters: [@param0=[NGAYCHUNGTU,9/20/2019 6:17:34 PM], @param1=[LOAICHUNGTU,X], @param2=[MUCDICHCHUNGTU_ID,1060], @param3=[MUCDICHCHUNGTU_CODE,X13], @param4=[KHOXUAT_ID,32], @param5=[NGUOIGIAO_ID,0], @param6=[NGUOIGIAO,null], @param7=[KHONHAP_ID,null], @param8=[NGUOINHAN_ID,null], @param9=[NGUOINHAN,null], @param10=[NGUOIKIEMTRA_ID,null], @param11=[NGUOIKIEMTRA,null], @param12=[NGUOIDUYET_ID,null], @param13=[NGUOIDUYET,null], @param14=[PHUONGPHAPXUAT,0], @param15=[KETOANTRUONG_ID,null], @param16=[KETOANTRUONG,null], @param17=[THUKHO_ID,null], @param18=[THUKHO,null], @param19=[MAUHOADON,null], @param20=[SOHOADON,null], @param21=[SOSERI,null], @param22=[NGAYHOADON,null], @param23=[DIENGIAI,null], @param24=[GIATRI,null], @param25=[GIATRITHANHTOAN,null], @param26=[TYLEVAT,5], @param27=[GIATRIVAT,0], @param28=[THUESUAT,null], @param29=[GIATRITHUE,null], @param30=[TYLECHIETKHAU,null], @param31=[GIATRICHIETKHAU,null], @param32=[TIENTE_ID,null], @param33=[TYGIA,null], @param34=[SOCHUNGTUGOC,null], @param35=[NGAYCHUNGTUGOC,null], @param36=[NHACUNGCAP_ID,null], @param37=[HINHTHUCTHANHTOAN_ID,null], @param38=[NGUONDUOC_ID,null], @param39=[CHUNGTULIENQUAN_ID,null], @param40=[KHAMBENH_ID,null], @param41=[TOATHUOCNOITRU_ID,null], @param42=[TIEPNHAN_ID,null], @param43=[BENHAN_ID,null], @param44=[DANHANTHUOC, ], @param45=[NGUOINHAP_ID,null], @param46=[NGAYNHAP,null], @param47=[TRANGTHAI,DAXUAT], @param48=[PHIEULINH_ID,null], @param49=[LOAITOATHUOC,null], @param50=[DIENGIAINGHIEPVUPHATSINH,null], @param51=[DONVIGIAO_ID,null], @param52=[KHOSUDUNG_ID,null], @param53=[LOAIVATTU_ID,null], @param54=[BENHNHAN_ID,null], @param55=[TENBENHNHAN,null], @param56=[BACSIGIOITHIEU_ID,null], @param57=[DOITUONG_ID,null], @param58=[IDCHUYEN,null], @param59=[CHUNGTUKETOAN,null], @param60=[STATUS,null], @param61=[TRANSFER_VIENPHI_ID,null], @param62=[PHONGBAN_ID,62], @param63=[BACSI_ID,null], @param64=[TKNO,null], @param65=[TKCO,null], @param66=[MACHUNGTUREF,null], @param67=[LOAICHUNGTUREF,null], @param68=[PHIEULINHCANTRU_ID,null], @param69=[KHOTHUCHIEN_ID,null], @param70=[KHODOIUNG_ID,null], @param71=[MENU_LOAIDUOC_ID,null], @param72=[NGUOISUDUNGMAY_ID,50], @param73=[GOITHAU_ID,null], @param74=[XUATTHUOCBANGOAITRU,null], @param75=[NGAYGIOCHUNGTU,null], @param76=[NOIDAKHAM,null], @param77=[HOIDONGKIEMNHAP_ID,null], @param78=[HOIDONGTHANHLY_ID,null], @param79=[CHUYENCHUNGTUID,null], @param80=[CHUYENDOANHTHUID,null], @param81=[LYDOXUATSUDUNG_ID,8294], @param82=[NGAYCAPNHAT,9/20/2019 6:19:25 PM], @param83=[NGUOICAPNHAT_ID,0]]
2019-09-20 18:19:25,998 [1] DEBUG - Statement Id: [DAO00030_Update] Types: [@param0=[DateTime, System.DateTime], @param1=[String, System.String], @param2=[Int64, System.Int64], @param3=[String, System.String], @param4=[Int64, System.Int64], @param5=[Int64, System.Int64], @param6=[System.DBNull, null], @param7=[System.DBNull, null], @param8=[System.DBNull, null], @param9=[System.DBNull, null], @param10=[System.DBNull, null], @param11=[System.DBNull, null], @param12=[System.DBNull, null], @param13=[System.DBNull, null], @param14=[Int64, System.Int64], @param15=[System.DBNull, null], @param16=[System.DBNull, null], @param17=[System.DBNull, null], @param18=[System.DBNull, null], @param19=[System.DBNull, null], @param20=[System.DBNull, null], @param21=[System.DBNull, null], @param22=[System.DBNull, null], @param23=[System.DBNull, null], @param24=[System.DBNull, null], @param25=[System.DBNull, null], @param26=[Double, System.Double], @param27=[Double, System.Double], @param28=[System.DBNull, null], @param29=[System.DBNull, null], @param30=[System.DBNull, null], @param31=[System.DBNull, null], @param32=[System.DBNull, null], @param33=[System.DBNull, null], @param34=[System.DBNull, null], @param35=[System.DBNull, null], @param36=[System.DBNull, null], @param37=[System.DBNull, null], @param38=[System.DBNull, null], @param39=[System.DBNull, null], @param40=[System.DBNull, null], @param41=[System.DBNull, null], @param42=[System.DBNull, null], @param43=[System.DBNull, null], @param44=[String, System.String], @param45=[System.DBNull, null], @param46=[System.DBNull, null], @param47=[String, System.String], @param48=[System.DBNull, null], @param49=[System.DBNull, null], @param50=[System.DBNull, null], @param51=[System.DBNull, null], @param52=[System.DBNull, null], @param53=[System.DBNull, null], @param54=[System.DBNull, null], @param55=[System.DBNull, null], @param56=[System.DBNull, null], @param57=[System.DBNull, null], @param58=[System.DBNull, null], @param59=[System.DBNull, null], @param60=[System.DBNull, null], @param61=[System.DBNull, null], @param62=[Int64, System.Int64], @param63=[System.DBNull, null], @param64=[System.DBNull, null], @param65=[System.DBNull, null], @param66=[System.DBNull, null], @param67=[System.DBNull, null], @param68=[System.DBNull, null], @param69=[System.DBNull, null], @param70=[System.DBNull, null], @param71=[System.DBNull, null], @param72=[Int64, System.Int64], @param73=[System.DBNull, null], @param74=[System.DBNull, null], @param75=[System.DBNull, null], @param76=[System.DBNull, null], @param77=[System.DBNull, null], @param78=[System.DBNull, null], @param79=[System.DBNull, null], @param80=[System.DBNull, null], @param81=[Int64, System.Int64], @param82=[DateTime, System.DateTime], @param83=[Int64, System.Int64]]
2019-09-20 18:19:26,093 [1] DEBUG - Statement Id: [DAO00030_CHUNGTUCT_DeleteP] PreparedStatement : [delete from TT_DUOC_CHUNGTU_CHITIET               where                             TT_DUOC_CHUNGTU_CHITIET.CHUNGTU_ID = '137705']
2019-09-20 18:19:26,123 [1] DEBUG - Statement Id: [DAO00030_TT_DUOC_TONKHO_LOG_Add] PreparedStatement : [DECLARE @KHODUOC_ID int               DECLARE @TONTRUOC numeric(18, 4)               DECLARE @TONSAU numeric(18, 4)               DECLARE @SOLUONGNHAP numeric(18, 4)               DECLARE @SOLUONGXUAT numeric(18, 4)                              IF( @param0  = 'N')               BEGIN                SET @KHODUOC_ID =  @param1                END               ELSE               BEGIN                 SET @KHODUOC_ID =  @param2                END                              SELECT @TONTRUOC = SOLUONG FROM TT_DUOC_TONKHO WHERE KHODUOC_ID = @KHODUOC_ID  AND DUOC_ID =  @param3  AND SOLONHAP_ID =  @param4  AND NGUONDUOC_ID =  @param5                               IF( @param0  = 'N' AND  @param6  = 'ADD')               BEGIN                SET @TONSAU = ISNULL(@TONTRUOC,0) +  @param7                 SET @SOLUONGNHAP =  @param7                 SET @SOLUONGXUAT = 0               END               IF( @param0  = 'N' AND  @param6  = 'DEL')               BEGIN                SET @TONSAU = ISNULL(@TONTRUOC,0) -  @param7                 SET @SOLUONGXUAT =  @param7                 SET @SOLUONGNHAP = 0               END                                         IF( @param0  = 'X' AND  @param6  = 'ADD')               BEGIN                SET @TONSAU = ISNULL(@TONTRUOC,0) -  @param8                 SET @SOLUONGXUAT =  @param8                 SET @SOLUONGNHAP = 0               END               IF( @param0  = 'X' AND  @param6  = 'DEL')               BEGIN                SET @TONSAU = ISNULL(@TONTRUOC,0) +  @param8                 SET @SOLUONGNHAP =  @param8                 SET @SOLUONGXUAT = 0                             END                        insert into TT_DUOC_TONKHO_LOG (                           CHUNGTUCHITIET_ID              ,CHUNGTU_ID              ,MACHUNGTU              ,LOAICHUNGTU              ,MUCDICHCHUNGTU_CODE              ,KHONHAP_ID              ,KHOXUAT_ID              ,DUOC_ID              ,SOLONHAP_ID              ,NGUONDUOC_ID              ,SOLUONGNHAP              ,SOLUONGXUAT              ,DONGIAMUA              ,DONGIAVON              ,TYLE_VAT              ,DONGIAVONVAT              ,TONTRUOC              ,TONSAU              ,ACTION              ,BENHVIEN_ID              ,NGAYTAO              ,NGUOITAO_ID                          ) values (              @param9               , @param10               , @param11               , @param0               , @param12               , @param1               , @param2               , @param3               , @param4               , @param5               ,@SOLUONGNHAP              ,@SOLUONGXUAT              , @param13               , @param14               , @param15               , @param16               ,@TONTRUOC              ,@TONSAU              , @param6               , @param17               , @param18               , @param19               )]
2019-09-20 18:19:26,123 [1] DEBUG - Statement Id: [DAO00030_TT_DUOC_TONKHO_LOG_Add] Parameters: [@param0=[LOAICHUNGTU,X], @param1=[KHONHAP_ID,null], @param2=[KHOXUAT_ID,32], @param3=[DUOC_ID,1], @param4=[SOLONHAP_ID,7541], @param5=[NGUONDUOC_ID,1], @param6=[ACTION,DEL], @param7=[SOLUONGNHAP,0], @param8=[SOLUONGXUAT,2], @param9=[CHUNGTUCHITIET_ID,1299053], @param10=[CHUNGTU_ID,137705], @param11=[MACHUNGTU,CS_KBX1319003093], @param12=[MUCDICHCHUNGTU_CODE,X13], @param13=[DONGIAMUA,945], @param14=[DONGIAVON,945], @param15=[TYLE_VAT,0], @param16=[DONGIAVONVAT,945], @param17=[BENHVIEN_ID,HLU01], @param18=[NGAYTAO,9/20/2019 6:19:26 PM], @param19=[NGUOITAO_ID,0]]
2019-09-20 18:19:26,123 [1] DEBUG - Statement Id: [DAO00030_TT_DUOC_TONKHO_LOG_Add] Types: [@param0=[String, System.String], @param1=[System.DBNull, null], @param2=[Int64, System.Int64], @param3=[Int64, System.Int64], @param4=[Int64, System.Int64], @param5=[Int64, System.Int64], @param6=[String, System.String], @param7=[Decimal, System.Decimal], @param8=[Decimal, System.Decimal], @param9=[Int64, System.Int64], @param10=[Int64, System.Int64], @param11=[String, System.String], @param12=[String, System.String], @param13=[Decimal, System.Decimal], @param14=[Decimal, System.Decimal], @param15=[Double, System.Double], @param16=[Double, System.Double], @param17=[String, System.String], @param18=[DateTime, System.DateTime], @param19=[Int64, System.Int64]]
2019-09-20 18:19:26,154 [1] DEBUG - Statement Id: [DAO00030_DUOC_TONKHO_BOOKING_NGOAITRU_Tang] PreparedStatement : [update TT_DUOC_TONKHO_BOOK_NGOAITRU            set            SOLUONG = SOLUONG +  @param0             , NGUOICAPNHAT_ID =  @param1             , NGAYCAPNHAT = getdate()            where            REF_TABLE =  @param2             AND REF_ID =  @param3             AND KHODUOC_ID =  @param4             AND DUOC_ID =  @param5             AND SOLUONG = 0            AND BENHVIEN_ID = 'HLU01']
2019-09-20 18:19:26,154 [1] DEBUG - Statement Id: [DAO00030_DUOC_TONKHO_BOOKING_NGOAITRU_Tang] Parameters: [@param0=[SOLUONGTHAYDOI,2], @param1=[NGUOICAPNHAT_ID,0], @param2=[REF_TABLE,TT_NGOAITRU_KHAMBENH_VTYT], @param3=[REF_ID,10593], @param4=[KHODUOC_ID,32], @param5=[DUOC_ID,1]]
2019-09-20 18:19:26,154 [1] DEBUG - Statement Id: [DAO00030_DUOC_TONKHO_BOOKING_NGOAITRU_Tang] Types: [@param0=[Double, System.Double], @param1=[Int64, System.Int64], @param2=[String, System.String], @param3=[Int64, System.Int64], @param4=[Int64, System.Int64], @param5=[Int64, System.Int64]]
2019-09-20 18:19:26,213 [1] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoVaBookingCOM23UpdateRedis] PreparedStatement : [declare @NGUONDUOC_MACDINH varchar(5) = '0';        declare @TOAMUANGOAI int = 0;        select @NGUONDUOC_MACDINH = isnull(VALUE,0) from TM_SYS_APPSETTINGS where CODE = 'PHA_NGUONDUOC'        select @TOAMUANGOAI = isnull(VALUE,0) from TM_SYS_APPSETTINGS where CODE = 'OPD_TOAMUANGOAI_DUNGDANHMUC_DUOC'                if @TOAMUANGOAI = 1        begin        select  distinct '0' + '_' + LTRIM(d.DUOC_ID) + '_' + @NGUONDUOC_MACDINH as DUOC_KEY, 0 as PHAMVI_ID, @NGUONDUOC_MACDINH as NGUONDUOC_ID, null as TENNGUONDUOC, null as TINHTIEN, d.DUOC_ID, ld.MALOAIDUOC,        d.SOVISA,d.TYLE_VAT,d.COTOA, d.MADUOC, d.TENHANG, d.TENDUOCDAYDU, dvt.TENDONVITINH as DONVITINH, d.BHYT,        d.TENHOATCHAT, d.HAMLUONG, d.HANGSANXUAT, d.QUOCGIA, d.LOAIDUOC_ID, d.DUONGDUNG_ID, d.TINHTIEN_PTTT,        ten.TENDUOC, ten.TENDUOC_EN, ten.MAQUOCTE, ten.MAQUOCTEBT,        '' as BHYT_TEXT        , ld.LOAIVATTU_ID        , d.BENHVIEN_ID,        999999999 as SOLUONG, d.VTYT_PHANLOAI, d.PHAMVI, d.SUASOLUONGTONGHOP, d.MADUOCBV, d.DANGTRINHBAY        , TAMNGUNG = CASE WHEN d.TAMNGUNG = '1' THEN '1' ELSE '0' END        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        where d.DUOC_ID in (1)        union all        select  distinct tk.DUOC_KEY, LTRIM(tk.PHAMVI_ID) as PHAMVI_ID, tk.NGUONDUOC_ID, nh.TENNGUONDUOC, nh.TINHTIEN, d.DUOC_ID, ld.MALOAIDUOC,        d.SOVISA,d.TYLE_VAT,d.COTOA, d.MADUOC, d.TENHANG, d.TENDUOCDAYDU, dvt.TENDONVITINH as DONVITINH, d.BHYT,        d.TENHOATCHAT, d.HAMLUONG, d.HANGSANXUAT, d.QUOCGIA, d.LOAIDUOC_ID, d.DUONGDUNG_ID, d.TINHTIEN_PTTT,        ten.TENDUOC, ten.TENDUOC_EN, ten.MAQUOCTE, ten.MAQUOCTEBT,        CASE WHEN d.BHYT = '1' THEN 'BHYT' ELSE '' END as BHYT_TEXT        , ld.LOAIVATTU_ID        , d.BENHVIEN_ID,        tk.SOLUONG, d.VTYT_PHANLOAI, d.PHAMVI, d.SUASOLUONGTONGHOP, d.MADUOCBV, d.DANGTRINHBAY        , TAMNGUNG = CASE WHEN d.TAMNGUNG = '1' OR nh.TAMNGUNG = '1' OR kd.TAMNGUNG = '1' THEN '1' ELSE '0' END        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        inner join        (        select  LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')) DUOC_KEY, (SUM(dtk.SOLUONG) - isnull(sum(A.SOLUONG),0) - isnull(sum(B.SOLUONG),0)) SOLUONG, pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        from (select sum(soluong) soluong,duoc_id,nguonduoc_id,khoduoc_id,benhvien_id from TT_DUOC_TONKHO  group by duoc_id,nguonduoc_id,khoduoc_id,benhvien_id) dtk        inner join TM_DUOC_PHAMVISD_MAPPING pvsd on dtk.KHODUOC_ID = pvsd.KHODUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NOITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) B on B.DUOC_ID = dtk.DUOC_ID and B.SOLUONG > 0 and B.PHAMVI_ID = pvsd.PHAMVI_ID and B.NGUONHANG_ID = dtk.NGUONDUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NGOAITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) A on A.DUOC_ID = dtk.DUOC_ID and A.SOLUONG > 0 and A.PHAMVI_ID = pvsd.PHAMVI_ID and A.NGUONHANG_ID = dtk.NGUONDUOC_ID        where dtk.SOLUONG > 0 and dtk.BENHVIEN_ID = 'HLU01'        group by LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')), pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        ) tk on tk.DUOC_ID = d.DUOC_ID        left join TM_DUOC_PHAMVISUDUNG kd on kd.PHAMVI_ID = tk.PHAMVI_ID and kd.BENHVIEN_ID = 'HLU01'        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = tk.NGUONDUOC_ID and nh.BENHVIEN_ID = 'HLU01'        where  d.BENHVIEN_ID = 'HLU01' and d.DUOC_ID in (1)        end        else        begin        select  distinct tk.DUOC_KEY, LTRIM(tk.PHAMVI_ID) as PHAMVI_ID, tk.NGUONDUOC_ID, nh.TENNGUONDUOC, nh.TINHTIEN, d.DUOC_ID, ld.MALOAIDUOC,        d.SOVISA,d.TYLE_VAT,d.COTOA, d.MADUOC, d.TENHANG, d.TENDUOCDAYDU, dvt.TENDONVITINH as DONVITINH, d.BHYT,        d.TENHOATCHAT, d.HAMLUONG, d.HANGSANXUAT, d.QUOCGIA, d.LOAIDUOC_ID, d.DUONGDUNG_ID, d.TINHTIEN_PTTT,        ten.TENDUOC, ten.TENDUOC_EN, ten.MAQUOCTE, ten.MAQUOCTEBT,        CASE WHEN d.BHYT = '1' THEN 'BHYT' ELSE '' END as BHYT_TEXT        , ld.LOAIVATTU_ID        , d.BENHVIEN_ID,        tk.SOLUONG, d.VTYT_PHANLOAI, d.PHAMVI, d.SUASOLUONGTONGHOP, d.MADUOCBV, d.DANGTRINHBAY        , TAMNGUNG = CASE WHEN d.TAMNGUNG = '1' OR nh.TAMNGUNG = '1' OR kd.TAMNGUNG = '1' THEN '1' ELSE '0' END        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        inner join        (        select  LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')) DUOC_KEY, (SUM(dtk.SOLUONG) - isnull(sum(A.SOLUONG),0) - isnull(sum(B.SOLUONG),0)) SOLUONG, pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        from (select sum(soluong) soluong,duoc_id,nguonduoc_id,khoduoc_id,benhvien_id from TT_DUOC_TONKHO  group by duoc_id,nguonduoc_id,khoduoc_id,benhvien_id) dtk        inner join TM_DUOC_PHAMVISD_MAPPING pvsd on dtk.KHODUOC_ID = pvsd.KHODUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NOITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) B on B.DUOC_ID = dtk.DUOC_ID and B.SOLUONG > 0 and B.PHAMVI_ID = pvsd.PHAMVI_ID and B.NGUONHANG_ID = dtk.NGUONDUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NGOAITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) A on A.DUOC_ID = dtk.DUOC_ID and A.SOLUONG > 0 and A.PHAMVI_ID = pvsd.PHAMVI_ID and A.NGUONHANG_ID = dtk.NGUONDUOC_ID        where dtk.SOLUONG > 0 and dtk.BENHVIEN_ID = 'HLU01'        group by LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')), pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        ) tk on tk.DUOC_ID = d.DUOC_ID        left join TM_DUOC_PHAMVISUDUNG kd on kd.PHAMVI_ID = tk.PHAMVI_ID and kd.BENHVIEN_ID = 'HLU01'        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = tk.NGUONDUOC_ID and nh.BENHVIEN_ID = 'HLU01'        where  d.BENHVIEN_ID = 'HLU01' and d.DUOC_ID in (1)        end]
2019-09-20 18:19:26,430 [1] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoCOM18UpdateRedis] PreparedStatement : [select distinct TT_TONKHO.DUOC_KEY, LTRIM(TT_TONKHO.KHODUOC_ID) as KHODUOC_ID, TM_DUOC.DUOC_ID, TM_LOAIDUOC.MALOAIDUOC,TM_DUOC.SOVISA,TM_DUOC.TYLE_VAT,TM_DUOC.COTOA,        TM_DUOC.MADUOC, TM_DUOC.TENHANG, TM_DUOC.TENDUOCDAYDU, dvt.TENDONVITINH as DONVITINH,  TM_DUOC.DONVITINH_ID,TM_DUOC.BHYT,        TM_DUOC.TENHOATCHAT,        TM_DUOC.HAMLUONG, TM_DUOC.HANGSANXUAT, TM_DUOC.QUOCGIA, TM_DUOC.LOAIDUOC_ID, TM_DUOC.DUONGDUNG_ID,        TM_TENDUOC.TENDUOC, TM_TENDUOC.TENDUOC_EN, TM_TENDUOC.MAQUOCTE, TM_TENDUOC.MAQUOCTEBT,        TM_LOAIDUOC.LOAIVATTU_ID, TM_DUOC.BENHVIEN_ID,        TT_TONKHO.SOLUONG, TM_DUOC.VTYT_PHANLOAI, TM_DUOC.PHAMVI, TT_TONKHO.NGUONDUOC_ID, NG.TENNGUONDUOC AS TENNGUONDUOC        , TAMNGUNG = CASE WHEN TM_DUOC.TAMNGUNG = '1' OR NG.TAMNGUNG = '1' OR KD.TAMNGUNG = '1' THEN '1' ELSE '0' END        , TM_DUOC.DANGTRINHBAY        from TM_DUOC        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = TM_DUOC.DONVITINH_ID        left join TM_TENDUOC on TM_DUOC.TENDUOC_ID = TM_TENDUOC.TENDUOC_ID and TM_DUOC.BENHVIEN_ID = 'HLU01' and TM_DUOC.TAMNGUNG = '0'        left join TM_LOAIDUOC on TM_LOAIDUOC.LOAIDUOC_ID = TM_DUOC.LOAIDUOC_ID and TM_LOAIDUOC.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG on (TM_LOAIDUOC.LOAIVATTU_ID = TM_DUOC_HANDUNG.LOAIDUOC and TM_DUOC_HANDUNG.BENHVIEN_ID = 'HLU01')        inner join        (select LTRIM(A.KHODUOC_ID) + '_' + LTRIM(A.DUOC_ID) + '_' + LTRIM(ISNULL(A.NGUONDUOC_ID,'')) as DUOC_KEY, A.KHODUOC_ID, A.DUOC_ID, A.NGUONDUOC_ID,        SUM(isnull(A.SOLUONG,0)) as SOLUONG        from        (select SUM(SOLUONG) as SOLUONG, KHODUOC_ID, DUOC_ID, NGUONDUOC_ID from TT_DUOC_TONKHO        where BENHVIEN_ID = 'HLU01' group by KHODUOC_ID, DUOC_ID, NGUONDUOC_ID) A        group by LTRIM(A.KHODUOC_ID) + '_' + LTRIM(A.DUOC_ID) + '_' + LTRIM(ISNULL(A.NGUONDUOC_ID,'')), A.KHODUOC_ID, A.DUOC_ID, NGUONDUOC_ID        ) TT_TONKHO on TT_TONKHO.DUOC_ID = TM_DUOC.DUOC_ID        LEFT JOIN TM_NGUONHANG NG ON NG.NGUONDUOC_ID = TT_TONKHO.NGUONDUOC_ID        LEFT JOIN TM_KHODUOC KD ON KD.KHODUOC_ID = TT_TONKHO.KHODUOC_ID        where TM_DUOC.BENHVIEN_ID = 'HLU01' and TT_TONKHO.SOLUONG >= 0        and TM_DUOC.DUOC_ID in (1)]
2019-09-20 18:19:26,484 [1] DEBUG - Statement Id: [DAO00030_DUOCTONKHO_Tang] PreparedStatement : [IF EXISTS            (              SELECT DUOCTONKHO_ID              FROM TT_DUOC_TONKHO              WHERE              KHODUOC_ID =  @param0               AND DUOC_ID =  @param1               AND  SOLONHAP_ID =  @param2             )            BEGIN              update TT_DUOC_TONKHO set              SOLUONG = SOLUONG +   @param3               , NGAYCAPNHAT =  @param4               , NGUOICAPNHAT_ID =  @param5               where              KHODUOC_ID =  @param0               AND DUOC_ID =  @param1               AND  SOLONHAP_ID =  @param2             END            ELSE            BEGIN              insert into TT_DUOC_TONKHO (              KHODUOC_ID              , DUOC_ID              , NGUONDUOC_ID              , SOLONHAP_ID              , DONGIAMUA              , SOLUONG              , BENHVIEN_ID              , NGAYTAO              , NGUOITAO_ID                     ) values (               @param0               ,  @param1               ,  @param6               ,  @param2               ,  @param7               ,  @param3               ,  @param8               ,  @param9               ,  @param10                        )            END]
2019-09-20 18:19:26,485 [1] DEBUG - Statement Id: [DAO00030_DUOCTONKHO_Tang] Parameters: [@param0=[KHODUOC_ID,32], @param1=[DUOC_ID,1], @param2=[SOLONHAP_ID,7541], @param3=[SOLUONGTHAYDOI,2], @param4=[NGAYCAPNHAT,9/20/2019 6:19:26 PM], @param5=[NGUOICAPNHAT_ID,0], @param6=[NGUONDUOC_ID,1], @param7=[DONGIAMUA,945], @param8=[BENHVIEN_ID,HLU01], @param9=[NGAYTAO,9/20/2019 6:17:34 PM], @param10=[NGUOITAO_ID,0]]
2019-09-20 18:19:26,485 [1] DEBUG - Statement Id: [DAO00030_DUOCTONKHO_Tang] Types: [@param0=[Int64, System.Int64], @param1=[Int64, System.Int64], @param2=[Int64, System.Int64], @param3=[Double, System.Double], @param4=[DateTime, System.DateTime], @param5=[Int64, System.Int64], @param6=[Int64, System.Int64], @param7=[Double, System.Double], @param8=[String, System.String], @param9=[DateTime, System.DateTime], @param10=[Int64, System.Int64]]
2019-09-20 18:19:26,520 [1] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoCOM18] PreparedStatement : [select  distinct TT_TONKHO.DUOC_KEY, LTRIM(TT_TONKHO.KHODUOC_ID) as KHODUOC_ID, TM_DUOC.DUOC_ID, TM_LOAIDUOC.MALOAIDUOC,TM_DUOC.SOVISA,TM_DUOC.TYLE_VAT,TM_DUOC.COTOA,        TM_DUOC.MADUOC, TM_DUOC.TENHANG, TM_DUOC.TENDUOCDAYDU, dvt.TENDONVITINH as DONVITINH, TM_DUOC.DONVITINH_ID, TM_DUOC.BHYT,        TM_DUOC.TENHOATCHAT, TM_DUOC.HAMLUONG, TM_DUOC.HANGSANXUAT, TM_DUOC.QUOCGIA, TM_DUOC.LOAIDUOC_ID, TM_DUOC.DUONGDUNG_ID,        TM_TENDUOC.TENDUOC, TM_TENDUOC.TENDUOC_EN, TM_TENDUOC.MAQUOCTE, TM_TENDUOC.MAQUOCTEBT,        TM_LOAIDUOC.LOAIVATTU_ID, TM_DUOC.BENHVIEN_ID,        TT_TONKHO.SOLUONG, TM_DUOC.VTYT_PHANLOAI, TM_DUOC.PHAMVI, TT_TONKHO.NGUONDUOC_ID, NG.TENNGUONDUOC        , TAMNGUNG = CASE WHEN TM_DUOC.TAMNGUNG = '1' OR NG.TAMNGUNG = '1' OR KD.TAMNGUNG = '1' THEN '1' ELSE '0' END        , TM_DUOC.DANGTRINHBAY        from TM_DUOC        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = TM_DUOC.DONVITINH_ID        left join TM_TENDUOC on TM_DUOC.TENDUOC_ID = TM_TENDUOC.TENDUOC_ID and TM_DUOC.BENHVIEN_ID = 'HLU01'  and TM_DUOC.TAMNGUNG = '0'        left join TM_LOAIDUOC on TM_LOAIDUOC.LOAIDUOC_ID = TM_DUOC.LOAIDUOC_ID and TM_LOAIDUOC.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG on (TM_LOAIDUOC.LOAIVATTU_ID = TM_DUOC_HANDUNG.LOAIDUOC and TM_DUOC_HANDUNG.BENHVIEN_ID = 'HLU01')        inner join        (select LTRIM(A.KHODUOC_ID) + '_' + LTRIM(A.DUOC_ID) + '_' + LTRIM(ISNULL(A.NGUONDUOC_ID,'')) as DUOC_KEY, A.KHODUOC_ID, A.DUOC_ID ,a.NGUONDUOC_ID,        SUM(isnull(A.SOLUONG,0)) as SOLUONG        from        (select SUM(SOLUONG) as SOLUONG, KHODUOC_ID, DUOC_ID, NGUONDUOC_ID from TT_DUOC_TONKHO        where KHODUOC_ID in (32) and DUOC_ID in (1) group by KHODUOC_ID, DUOC_ID, NGUONDUOC_ID        ) A        where A.KHODUOC_ID in (32) and A.DUOC_ID in (1)        group by LTRIM(A.KHODUOC_ID) + '_' + LTRIM(A.DUOC_ID) + '_' + LTRIM(A.NGUONDUOC_ID), A.KHODUOC_ID, A.DUOC_ID, A.NGUONDUOC_ID)        TT_TONKHO on TT_TONKHO.DUOC_ID = TM_DUOC.DUOC_ID        LEFT JOIN TM_NGUONHANG NG ON NG.NGUONDUOC_ID = TT_TONKHO.NGUONDUOC_ID        LEFT JOIN TM_KHODUOC KD ON KD.KHODUOC_ID = TT_TONKHO.KHODUOC_ID        where TM_DUOC.BENHVIEN_ID = 'HLU01' and TM_DUOC.DUOC_ID in (1)]
2019-09-20 18:19:26,556 [1] DEBUG - Statement Id: [DAO00030_GetListPhamViByKhoDuoc] PreparedStatement : [SELECT DISTINCT PHAMVI_ID          FROM TM_DUOC_PHAMVISD_MAPPING          WHERE          KHODUOC_ID IN (32)          AND BENHVIEN_ID ='HLU01'          AND TAMNGUNG = '0']
2019-09-20 18:19:26,587 [1] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoVaBookingCOM23] PreparedStatement : [declare @NGUONDUOC_MACDINH varchar(5) = '0';        declare @TOAMUANGOAI int = 0;        select @NGUONDUOC_MACDINH = isnull(VALUE,0) from TM_SYS_APPSETTINGS where CODE = 'PHA_NGUONDUOC'        select @TOAMUANGOAI = isnull(VALUE,0) from TM_SYS_APPSETTINGS where CODE = 'OPD_TOAMUANGOAI_DUNGDANHMUC_DUOC'                if @TOAMUANGOAI = 1        begin        select  distinct '0' + '_' + LTRIM(d.DUOC_ID) + '_' + @NGUONDUOC_MACDINH as DUOC_KEY, 0 as PHAMVI_ID, @NGUONDUOC_MACDINH as NGUONDUOC_ID, null as TENNGUONDUOC, null as TINHTIEN, d.DUOC_ID, ld.MALOAIDUOC,        d.SOVISA,d.TYLE_VAT,d.COTOA, d.MADUOC, d.TENHANG, d.TENDUOCDAYDU, dvt.TENDONVITINH as DONVITINH, d.BHYT,        d.TENHOATCHAT, d.HAMLUONG, d.HANGSANXUAT, d.QUOCGIA, d.LOAIDUOC_ID, d.DUONGDUNG_ID, d.TINHTIEN_PTTT,        ten.TENDUOC, ten.TENDUOC_EN, ten.MAQUOCTE, ten.MAQUOCTEBT,        '' as BHYT_TEXT        , ld.LOAIVATTU_ID        , d.BENHVIEN_ID,        999999999 as SOLUONG, d.VTYT_PHANLOAI, d.PHAMVI, d.SUASOLUONGTONGHOP, d.MADUOCBV, d.DANGTRINHBAY        , TAMNGUNG = CASE WHEN d.TAMNGUNG = '1' THEN '1' ELSE '0' END        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        where d.DUOC_ID in (1)        union all        select  distinct tk.DUOC_KEY, LTRIM(tk.PHAMVI_ID) as PHAMVI_ID, tk.NGUONDUOC_ID, nh.TENNGUONDUOC, nh.TINHTIEN, d.DUOC_ID, ld.MALOAIDUOC,        d.SOVISA,d.TYLE_VAT,d.COTOA, d.MADUOC, d.TENHANG, d.TENDUOCDAYDU, dvt.TENDONVITINH as DONVITINH, d.BHYT,        d.TENHOATCHAT, d.HAMLUONG, d.HANGSANXUAT, d.QUOCGIA, d.LOAIDUOC_ID, d.DUONGDUNG_ID, d.TINHTIEN_PTTT,        ten.TENDUOC, ten.TENDUOC_EN, ten.MAQUOCTE, ten.MAQUOCTEBT,        CASE WHEN d.BHYT = '1' THEN 'BHYT' ELSE '' END as BHYT_TEXT        , ld.LOAIVATTU_ID        , d.BENHVIEN_ID,        tk.SOLUONG, d.VTYT_PHANLOAI, d.PHAMVI, d.SUASOLUONGTONGHOP, d.MADUOCBV, d.DANGTRINHBAY        , TAMNGUNG = CASE WHEN d.TAMNGUNG = '1' OR nh.TAMNGUNG = '1' OR kd.TAMNGUNG = '1' THEN '1' ELSE '0' END        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        inner join        (        select  LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')) DUOC_KEY, (SUM(dtk.SOLUONG) - isnull(sum(A.SOLUONG),0) - isnull(sum(B.SOLUONG),0)) SOLUONG, pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        from (select sum(soluong) soluong,duoc_id,nguonduoc_id,khoduoc_id,benhvien_id from TT_DUOC_TONKHO  group by duoc_id,nguonduoc_id,khoduoc_id,benhvien_id) dtk        inner join TM_DUOC_PHAMVISD_MAPPING pvsd on dtk.KHODUOC_ID = pvsd.KHODUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NOITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) B on B.DUOC_ID = dtk.DUOC_ID and B.SOLUONG > 0 and B.PHAMVI_ID = pvsd.PHAMVI_ID and B.NGUONHANG_ID = dtk.NGUONDUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NGOAITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) A on A.DUOC_ID = dtk.DUOC_ID and A.SOLUONG > 0 and A.PHAMVI_ID = pvsd.PHAMVI_ID and A.NGUONHANG_ID = dtk.NGUONDUOC_ID        where dtk.SOLUONG > 0 and dtk.BENHVIEN_ID = 'HLU01'        group by LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')), pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        ) tk on tk.DUOC_ID = d.DUOC_ID        left join TM_DUOC_PHAMVISUDUNG kd on kd.PHAMVI_ID = tk.PHAMVI_ID and kd.BENHVIEN_ID = 'HLU01'        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = tk.NGUONDUOC_ID and nh.BENHVIEN_ID = 'HLU01'        where  d.BENHVIEN_ID = 'HLU01' and d.DUOC_ID in (1) and TK.PHAMVI_ID in (1055)        and tk.NGUONDUOC_ID in (1)         end        else        begin                select  distinct tk.DUOC_KEY, LTRIM(tk.PHAMVI_ID) as PHAMVI_ID, tk.NGUONDUOC_ID, nh.TENNGUONDUOC, nh.TINHTIEN, d.DUOC_ID, ld.MALOAIDUOC,        d.SOVISA,d.TYLE_VAT,d.COTOA, d.MADUOC, d.TENHANG, d.TENDUOCDAYDU, dvt.TENDONVITINH as DONVITINH, d.BHYT,        d.TENHOATCHAT, d.HAMLUONG, d.HANGSANXUAT, d.QUOCGIA, d.LOAIDUOC_ID, d.DUONGDUNG_ID, d.TINHTIEN_PTTT,        ten.TENDUOC, ten.TENDUOC_EN, ten.MAQUOCTE, ten.MAQUOCTEBT,        CASE WHEN d.BHYT = '1' THEN 'BHYT' ELSE '' END as BHYT_TEXT        , ld.LOAIVATTU_ID        , d.BENHVIEN_ID,        tk.SOLUONG, d.VTYT_PHANLOAI, d.PHAMVI, d.SUASOLUONGTONGHOP, d.MADUOCBV, d.DANGTRINHBAY        , TAMNGUNG = CASE WHEN d.TAMNGUNG = '1' OR nh.TAMNGUNG = '1' OR kd.TAMNGUNG = '1' THEN '1' ELSE '0' END        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        inner join        (        select  LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')) DUOC_KEY, (SUM(dtk.SOLUONG) - isnull(sum(A.SOLUONG),0) - isnull(sum(B.SOLUONG),0)) SOLUONG, pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        from (select sum(soluong) soluong,duoc_id,nguonduoc_id,khoduoc_id,benhvien_id from TT_DUOC_TONKHO  group by duoc_id,nguonduoc_id,khoduoc_id,benhvien_id) dtk        inner join TM_DUOC_PHAMVISD_MAPPING pvsd on dtk.KHODUOC_ID = pvsd.KHODUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NOITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) B on B.DUOC_ID = dtk.DUOC_ID and B.SOLUONG > 0 and B.PHAMVI_ID = pvsd.PHAMVI_ID and B.NGUONHANG_ID = dtk.NGUONDUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NGOAITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) A on A.DUOC_ID = dtk.DUOC_ID and A.SOLUONG > 0 and A.PHAMVI_ID = pvsd.PHAMVI_ID and A.NGUONHANG_ID = dtk.NGUONDUOC_ID        where dtk.SOLUONG > 0 and dtk.BENHVIEN_ID = 'HLU01'        group by LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')), pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        ) tk on tk.DUOC_ID = d.DUOC_ID        left join TM_DUOC_PHAMVISUDUNG kd on kd.PHAMVI_ID = tk.PHAMVI_ID and kd.BENHVIEN_ID = 'HLU01'        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = tk.NGUONDUOC_ID and nh.BENHVIEN_ID = 'HLU01'        where  d.BENHVIEN_ID = 'HLU01' and d.DUOC_ID in (1) and TK.PHAMVI_ID in (1055)        and tk.NGUONDUOC_ID in (1)         end]
2019-09-20 18:19:26,765 [1] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoCOM18UpdateRedis] PreparedStatement : [select distinct TT_TONKHO.DUOC_KEY, LTRIM(TT_TONKHO.KHODUOC_ID) as KHODUOC_ID, TM_DUOC.DUOC_ID, TM_LOAIDUOC.MALOAIDUOC,TM_DUOC.SOVISA,TM_DUOC.TYLE_VAT,TM_DUOC.COTOA,        TM_DUOC.MADUOC, TM_DUOC.TENHANG, TM_DUOC.TENDUOCDAYDU, dvt.TENDONVITINH as DONVITINH,  TM_DUOC.DONVITINH_ID,TM_DUOC.BHYT,        TM_DUOC.TENHOATCHAT,        TM_DUOC.HAMLUONG, TM_DUOC.HANGSANXUAT, TM_DUOC.QUOCGIA, TM_DUOC.LOAIDUOC_ID, TM_DUOC.DUONGDUNG_ID,        TM_TENDUOC.TENDUOC, TM_TENDUOC.TENDUOC_EN, TM_TENDUOC.MAQUOCTE, TM_TENDUOC.MAQUOCTEBT,        TM_LOAIDUOC.LOAIVATTU_ID, TM_DUOC.BENHVIEN_ID,        TT_TONKHO.SOLUONG, TM_DUOC.VTYT_PHANLOAI, TM_DUOC.PHAMVI, TT_TONKHO.NGUONDUOC_ID, NG.TENNGUONDUOC AS TENNGUONDUOC        , TAMNGUNG = CASE WHEN TM_DUOC.TAMNGUNG = '1' OR NG.TAMNGUNG = '1' OR KD.TAMNGUNG = '1' THEN '1' ELSE '0' END        , TM_DUOC.DANGTRINHBAY        from TM_DUOC        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = TM_DUOC.DONVITINH_ID        left join TM_TENDUOC on TM_DUOC.TENDUOC_ID = TM_TENDUOC.TENDUOC_ID and TM_DUOC.BENHVIEN_ID = 'HLU01' and TM_DUOC.TAMNGUNG = '0'        left join TM_LOAIDUOC on TM_LOAIDUOC.LOAIDUOC_ID = TM_DUOC.LOAIDUOC_ID and TM_LOAIDUOC.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG on (TM_LOAIDUOC.LOAIVATTU_ID = TM_DUOC_HANDUNG.LOAIDUOC and TM_DUOC_HANDUNG.BENHVIEN_ID = 'HLU01')        inner join        (select LTRIM(A.KHODUOC_ID) + '_' + LTRIM(A.DUOC_ID) + '_' + LTRIM(ISNULL(A.NGUONDUOC_ID,'')) as DUOC_KEY, A.KHODUOC_ID, A.DUOC_ID, A.NGUONDUOC_ID,        SUM(isnull(A.SOLUONG,0)) as SOLUONG        from        (select SUM(SOLUONG) as SOLUONG, KHODUOC_ID, DUOC_ID, NGUONDUOC_ID from TT_DUOC_TONKHO        where BENHVIEN_ID = 'HLU01' group by KHODUOC_ID, DUOC_ID, NGUONDUOC_ID) A        group by LTRIM(A.KHODUOC_ID) + '_' + LTRIM(A.DUOC_ID) + '_' + LTRIM(ISNULL(A.NGUONDUOC_ID,'')), A.KHODUOC_ID, A.DUOC_ID, NGUONDUOC_ID        ) TT_TONKHO on TT_TONKHO.DUOC_ID = TM_DUOC.DUOC_ID        LEFT JOIN TM_NGUONHANG NG ON NG.NGUONDUOC_ID = TT_TONKHO.NGUONDUOC_ID        LEFT JOIN TM_KHODUOC KD ON KD.KHODUOC_ID = TT_TONKHO.KHODUOC_ID        where TM_DUOC.BENHVIEN_ID = 'HLU01' and TT_TONKHO.SOLUONG >= 0        and TM_DUOC.DUOC_ID in (1)]
2019-09-20 18:19:26,834 [1] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoVaBookingCOM23UpdateRedis] PreparedStatement : [declare @NGUONDUOC_MACDINH varchar(5) = '0';        declare @TOAMUANGOAI int = 0;        select @NGUONDUOC_MACDINH = isnull(VALUE,0) from TM_SYS_APPSETTINGS where CODE = 'PHA_NGUONDUOC'        select @TOAMUANGOAI = isnull(VALUE,0) from TM_SYS_APPSETTINGS where CODE = 'OPD_TOAMUANGOAI_DUNGDANHMUC_DUOC'                if @TOAMUANGOAI = 1        begin        select  distinct '0' + '_' + LTRIM(d.DUOC_ID) + '_' + @NGUONDUOC_MACDINH as DUOC_KEY, 0 as PHAMVI_ID, @NGUONDUOC_MACDINH as NGUONDUOC_ID, null as TENNGUONDUOC, null as TINHTIEN, d.DUOC_ID, ld.MALOAIDUOC,        d.SOVISA,d.TYLE_VAT,d.COTOA, d.MADUOC, d.TENHANG, d.TENDUOCDAYDU, dvt.TENDONVITINH as DONVITINH, d.BHYT,        d.TENHOATCHAT, d.HAMLUONG, d.HANGSANXUAT, d.QUOCGIA, d.LOAIDUOC_ID, d.DUONGDUNG_ID, d.TINHTIEN_PTTT,        ten.TENDUOC, ten.TENDUOC_EN, ten.MAQUOCTE, ten.MAQUOCTEBT,        '' as BHYT_TEXT        , ld.LOAIVATTU_ID        , d.BENHVIEN_ID,        999999999 as SOLUONG, d.VTYT_PHANLOAI, d.PHAMVI, d.SUASOLUONGTONGHOP, d.MADUOCBV, d.DANGTRINHBAY        , TAMNGUNG = CASE WHEN d.TAMNGUNG = '1' THEN '1' ELSE '0' END        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        where d.DUOC_ID in (1)        union all        select  distinct tk.DUOC_KEY, LTRIM(tk.PHAMVI_ID) as PHAMVI_ID, tk.NGUONDUOC_ID, nh.TENNGUONDUOC, nh.TINHTIEN, d.DUOC_ID, ld.MALOAIDUOC,        d.SOVISA,d.TYLE_VAT,d.COTOA, d.MADUOC, d.TENHANG, d.TENDUOCDAYDU, dvt.TENDONVITINH as DONVITINH, d.BHYT,        d.TENHOATCHAT, d.HAMLUONG, d.HANGSANXUAT, d.QUOCGIA, d.LOAIDUOC_ID, d.DUONGDUNG_ID, d.TINHTIEN_PTTT,        ten.TENDUOC, ten.TENDUOC_EN, ten.MAQUOCTE, ten.MAQUOCTEBT,        CASE WHEN d.BHYT = '1' THEN 'BHYT' ELSE '' END as BHYT_TEXT        , ld.LOAIVATTU_ID        , d.BENHVIEN_ID,        tk.SOLUONG, d.VTYT_PHANLOAI, d.PHAMVI, d.SUASOLUONGTONGHOP, d.MADUOCBV, d.DANGTRINHBAY        , TAMNGUNG = CASE WHEN d.TAMNGUNG = '1' OR nh.TAMNGUNG = '1' OR kd.TAMNGUNG = '1' THEN '1' ELSE '0' END        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        inner join        (        select  LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')) DUOC_KEY, (SUM(dtk.SOLUONG) - isnull(sum(A.SOLUONG),0) - isnull(sum(B.SOLUONG),0)) SOLUONG, pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        from (select sum(soluong) soluong,duoc_id,nguonduoc_id,khoduoc_id,benhvien_id from TT_DUOC_TONKHO  group by duoc_id,nguonduoc_id,khoduoc_id,benhvien_id) dtk        inner join TM_DUOC_PHAMVISD_MAPPING pvsd on dtk.KHODUOC_ID = pvsd.KHODUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NOITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) B on B.DUOC_ID = dtk.DUOC_ID and B.SOLUONG > 0 and B.PHAMVI_ID = pvsd.PHAMVI_ID and B.NGUONHANG_ID = dtk.NGUONDUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NGOAITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) A on A.DUOC_ID = dtk.DUOC_ID and A.SOLUONG > 0 and A.PHAMVI_ID = pvsd.PHAMVI_ID and A.NGUONHANG_ID = dtk.NGUONDUOC_ID        where dtk.SOLUONG > 0 and dtk.BENHVIEN_ID = 'HLU01'        group by LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')), pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        ) tk on tk.DUOC_ID = d.DUOC_ID        left join TM_DUOC_PHAMVISUDUNG kd on kd.PHAMVI_ID = tk.PHAMVI_ID and kd.BENHVIEN_ID = 'HLU01'        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = tk.NGUONDUOC_ID and nh.BENHVIEN_ID = 'HLU01'        where  d.BENHVIEN_ID = 'HLU01' and d.DUOC_ID in (1)        end        else        begin        select  distinct tk.DUOC_KEY, LTRIM(tk.PHAMVI_ID) as PHAMVI_ID, tk.NGUONDUOC_ID, nh.TENNGUONDUOC, nh.TINHTIEN, d.DUOC_ID, ld.MALOAIDUOC,        d.SOVISA,d.TYLE_VAT,d.COTOA, d.MADUOC, d.TENHANG, d.TENDUOCDAYDU, dvt.TENDONVITINH as DONVITINH, d.BHYT,        d.TENHOATCHAT, d.HAMLUONG, d.HANGSANXUAT, d.QUOCGIA, d.LOAIDUOC_ID, d.DUONGDUNG_ID, d.TINHTIEN_PTTT,        ten.TENDUOC, ten.TENDUOC_EN, ten.MAQUOCTE, ten.MAQUOCTEBT,        CASE WHEN d.BHYT = '1' THEN 'BHYT' ELSE '' END as BHYT_TEXT        , ld.LOAIVATTU_ID        , d.BENHVIEN_ID,        tk.SOLUONG, d.VTYT_PHANLOAI, d.PHAMVI, d.SUASOLUONGTONGHOP, d.MADUOCBV, d.DANGTRINHBAY        , TAMNGUNG = CASE WHEN d.TAMNGUNG = '1' OR nh.TAMNGUNG = '1' OR kd.TAMNGUNG = '1' THEN '1' ELSE '0' END        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        inner join        (        select  LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')) DUOC_KEY, (SUM(dtk.SOLUONG) - isnull(sum(A.SOLUONG),0) - isnull(sum(B.SOLUONG),0)) SOLUONG, pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        from (select sum(soluong) soluong,duoc_id,nguonduoc_id,khoduoc_id,benhvien_id from TT_DUOC_TONKHO  group by duoc_id,nguonduoc_id,khoduoc_id,benhvien_id) dtk        inner join TM_DUOC_PHAMVISD_MAPPING pvsd on dtk.KHODUOC_ID = pvsd.KHODUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NOITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) B on B.DUOC_ID = dtk.DUOC_ID and B.SOLUONG > 0 and B.PHAMVI_ID = pvsd.PHAMVI_ID and B.NGUONHANG_ID = dtk.NGUONDUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NGOAITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) A on A.DUOC_ID = dtk.DUOC_ID and A.SOLUONG > 0 and A.PHAMVI_ID = pvsd.PHAMVI_ID and A.NGUONHANG_ID = dtk.NGUONDUOC_ID        where dtk.SOLUONG > 0 and dtk.BENHVIEN_ID = 'HLU01'        group by LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')), pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        ) tk on tk.DUOC_ID = d.DUOC_ID        left join TM_DUOC_PHAMVISUDUNG kd on kd.PHAMVI_ID = tk.PHAMVI_ID and kd.BENHVIEN_ID = 'HLU01'        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = tk.NGUONDUOC_ID and nh.BENHVIEN_ID = 'HLU01'        where  d.BENHVIEN_ID = 'HLU01' and d.DUOC_ID in (1)        end]
2019-09-20 18:19:32,771 [1] DEBUG - Statement Id: [DAO00030_RemoveChungTuVTYTNgoaiTru] PreparedStatement : [update TT_NGOAITRU_KHAMBENH_VTYT set            CHUNGTU_ID = null,            TRANGTHAI = null            where            CHUNGTU_ID =   @param0               update TT_VIENPHI set            DUYET = '0',            DATHUCHIEN = '0'            where            REF_TABLE = 'TT_NGOAITRU_KHAMBENH_VTYT'            AND REF_ID IN (10593)]
2019-09-20 18:19:32,772 [1] DEBUG - Statement Id: [DAO00030_RemoveChungTuVTYTNgoaiTru] Parameters: [@param0=[CHUNGTU_ID,137705]]
2019-09-20 18:19:32,772 [1] DEBUG - Statement Id: [DAO00030_RemoveChungTuVTYTNgoaiTru] Types: [@param0=[Int64, System.Int64]]
2019-09-20 18:19:32,816 [1] DEBUG - Statement Id: [DAO00030_CHUNGTUCT_Add] PreparedStatement : [insert into TT_DUOC_CHUNGTU_CHITIET (            CHUNGTU_ID            , DUOC_ID            , SOLONHAP_ID            , SOKIEMSOAT            , SOVISA            , HANDUNG            , DONVITINH_ID            , SOLUONGYEUCAU            , SOLUONGTHUCTE            , SOLUONGDAXUAT            , TIENTE_ID            , TYGIA            , DONGIAMUA            , DONGIA_BHYT            , DONGIABAN            , DONGIABAN_VAT            , DONGIAVON            , DONGIATHANHTOAN            , SOQUYEN            , SOHOADONVAT            , TYLEVAT            , GIATRIVAT            , TYLECHIETKHAU            , GIATRICHIETKHAU            , MIENPHI            , LYDOMIENPHI_ID            , SOCHUNGTUKETOAN            , SOCHUNGTUTIENMAT            , TRANGTHAI            , DAPHATSINHPHIEUXUAT            , DAPHATSINHPHIEUHOANTRA            , KHUYENMAI            , PHUONGPHAPXUAT            , DONDATHANG_ID            , GHICHUCHITIET            , NGUONHANG_ID            , DONGIAVONVAT            , THANHTIENMUA            , THANHTIENVON            , THANHTIENHOPDONG            , ISTACHLO            , DONVITINHBANDAU_ID            , SOLUONGBANDAU            , GOITHAU_ID            , DONGIATHAU            , DONGIAPO            , TYLEQUIDOI            , TOATHUOCNOITRU_ID            , KHAMBENH_VTYT_ID            , PHAUTHUAT_VTYT_ID            , CLSKETQUA_VTYT_ID            , TOATHUOCNGOAITRU_ID            , MASTER_ID            , BENHNHAN            , YLENH                                   , BENHVIEN_ID            , NGAYTAO            , NGUOITAO_ID            , NGAYCAPNHAT            , NGUOICAPNHAT_ID            , THANHTIENMUABANDAU            , SOLUONGQUIDOI            ) values (             @param0             ,  @param1             ,  @param2             ,  @param3             ,  @param4             ,  @param5             ,  @param6             ,  @param7             ,  @param8             ,  @param9             ,  @param10             ,  @param11             ,  @param12             ,  @param13             ,  @param14             ,  @param15             ,  @param16             ,  @param17             ,  @param18             ,  @param19             ,  @param20             ,  @param21             ,  @param22             ,  @param23             ,  @param24             ,  @param25             ,  @param26             ,  @param27             ,  @param28             ,  @param29             ,  @param30             ,  @param31             ,  @param32             ,  @param33             ,  @param34             ,  @param35             ,  @param36             ,  @param37             ,  @param38             ,  @param39             ,  @param40             ,  @param41             ,  @param42             ,  @param43             ,  @param44             ,  @param45             ,  @param46             ,  @param47             ,  @param48             ,  @param49             ,  @param50             ,  @param51             ,  @param52             ,  @param53             ,  @param54                          ,  @param55             ,  @param56             ,  @param57             ,  @param58             ,  @param59             ,  @param60             ,  @param61             )            select SCOPE_identity() as value]
2019-09-20 18:19:32,816 [1] DEBUG - Statement Id: [DAO00030_CHUNGTUCT_Add] Parameters: [@param0=[CHUNGTU_ID,137705], @param1=[DUOC_ID,1], @param2=[SOLONHAP_ID,7541], @param3=[SOKIEMSOAT,null], @param4=[SOVISA,1], @param5=[HANDUNG,12/12/2026 12:00:00 AM], @param6=[DONVITINH_ID,17], @param7=[SOLUONGYEUCAU,2], @param8=[SOLUONGTHUCTE,null], @param9=[SOLUONGDAXUAT,2], @param10=[TIENTE_ID,null], @param11=[TYGIA,null], @param12=[DONGIAMUA,945], @param13=[DONGIA_BHYT,null], @param14=[DONGIABAN,1030], @param15=[DONGIABAN_VAT,1030], @param16=[DONGIAVON,945], @param17=[DONGIATHANHTOAN,null], @param18=[SOQUYEN,null], @param19=[SOHOADONVAT,null], @param20=[TYLEVAT,0], @param21=[GIATRIVAT,null], @param22=[TYLECHIETKHAU,null], @param23=[GIATRICHIETKHAU,null], @param24=[MIENPHI,null], @param25=[LYDOMIENPHI_ID,null], @param26=[SOCHUNGTUKETOAN,null], @param27=[SOCHUNGTUTIENMAT,null], @param28=[TRANGTHAI,null], @param29=[DAPHATSINHPHIEUXUAT,null], @param30=[DAPHATSINHPHIEUHOANTRA,null], @param31=[KHUYENMAI,null], @param32=[PHUONGPHAPXUAT,null], @param33=[DONDATHANG_ID,null], @param34=[GHICHUCHITIET,null], @param35=[NGUONHANG_ID,1], @param36=[DONGIAVONVAT,945], @param37=[THANHTIENMUA,1890], @param38=[THANHTIENVON,1890], @param39=[THANHTIENHOPDONG,null], @param40=[ISTACHLO,null], @param41=[DONVITINHBANDAU_ID,null], @param42=[SOLUONGBANDAU,null], @param43=[GOITHAU_ID,null], @param44=[DONGIATHAU,1030], @param45=[DONGIAPO,null], @param46=[TYLEQUIDOI,null], @param47=[TOATHUOCNOITRU_ID,null], @param48=[KHAMBENH_VTYT_ID,10593], @param49=[PHAUTHUAT_VTYT_ID,null], @param50=[CLSKETQUA_VTYT_ID,null], @param51=[TOATHUOCNGOAITRU_ID,null], @param52=[MASTER_ID,0], @param53=[BENHNHAN,Người bệnh: 190043304 - Test Xn1 - 20/09/2019 - 16:50], @param54=[YLENH,10593], @param55=[BENHVIEN_ID,HLU01], @param56=[NGAYTAO,9/20/2019 6:19:32 PM], @param57=[NGUOITAO_ID,0], @param58=[NGAYCAPNHAT,9/20/2019 6:19:32 PM], @param59=[NGUOICAPNHAT_ID,0], @param60=[THANHTIENMUABANDAU,null], @param61=[SOLUONGQUIDOI,null]]
2019-09-20 18:19:32,816 [1] DEBUG - Statement Id: [DAO00030_CHUNGTUCT_Add] Types: [@param0=[Int64, System.Int64], @param1=[Int64, System.Int64], @param2=[Int64, System.Int64], @param3=[System.DBNull, null], @param4=[String, System.String], @param5=[DateTime, System.DateTime], @param6=[Int64, System.Int64], @param7=[Double, System.Double], @param8=[System.DBNull, null], @param9=[Double, System.Double], @param10=[System.DBNull, null], @param11=[System.DBNull, null], @param12=[Double, System.Double], @param13=[System.DBNull, null], @param14=[Double, System.Double], @param15=[Double, System.Double], @param16=[Double, System.Double], @param17=[System.DBNull, null], @param18=[System.DBNull, null], @param19=[System.DBNull, null], @param20=[Double, System.Double], @param21=[System.DBNull, null], @param22=[System.DBNull, null], @param23=[System.DBNull, null], @param24=[System.DBNull, null], @param25=[System.DBNull, null], @param26=[System.DBNull, null], @param27=[System.DBNull, null], @param28=[System.DBNull, null], @param29=[System.DBNull, null], @param30=[System.DBNull, null], @param31=[System.DBNull, null], @param32=[System.DBNull, null], @param33=[System.DBNull, null], @param34=[System.DBNull, null], @param35=[Int64, System.Int64], @param36=[Double, System.Double], @param37=[Double, System.Double], @param38=[Double, System.Double], @param39=[System.DBNull, null], @param40=[System.DBNull, null], @param41=[System.DBNull, null], @param42=[System.DBNull, null], @param43=[System.DBNull, null], @param44=[Double, System.Double], @param45=[System.DBNull, null], @param46=[System.DBNull, null], @param47=[System.DBNull, null], @param48=[Int64, System.Int64], @param49=[System.DBNull, null], @param50=[System.DBNull, null], @param51=[System.DBNull, null], @param52=[Int64, System.Int64], @param53=[String, System.String], @param54=[String, System.String], @param55=[String, System.String], @param56=[DateTime, System.DateTime], @param57=[Int64, System.Int64], @param58=[DateTime, System.DateTime], @param59=[Int64, System.Int64], @param60=[System.DBNull, null], @param61=[System.DBNull, null]]
2019-09-20 18:19:32,862 [1] DEBUG - Statement Id: [DAO00030_TT_DUOC_TONKHO_LOG_Add] PreparedStatement : [DECLARE @KHODUOC_ID int               DECLARE @TONTRUOC numeric(18, 4)               DECLARE @TONSAU numeric(18, 4)               DECLARE @SOLUONGNHAP numeric(18, 4)               DECLARE @SOLUONGXUAT numeric(18, 4)                              IF( @param0  = 'N')               BEGIN                SET @KHODUOC_ID =  @param1                END               ELSE               BEGIN                 SET @KHODUOC_ID =  @param2                END                              SELECT @TONTRUOC = SOLUONG FROM TT_DUOC_TONKHO WHERE KHODUOC_ID = @KHODUOC_ID  AND DUOC_ID =  @param3  AND SOLONHAP_ID =  @param4  AND NGUONDUOC_ID =  @param5                               IF( @param0  = 'N' AND  @param6  = 'ADD')               BEGIN                SET @TONSAU = ISNULL(@TONTRUOC,0) +  @param7                 SET @SOLUONGNHAP =  @param7                 SET @SOLUONGXUAT = 0               END               IF( @param0  = 'N' AND  @param6  = 'DEL')               BEGIN                SET @TONSAU = ISNULL(@TONTRUOC,0) -  @param7                 SET @SOLUONGXUAT =  @param7                 SET @SOLUONGNHAP = 0               END                                         IF( @param0  = 'X' AND  @param6  = 'ADD')               BEGIN                SET @TONSAU = ISNULL(@TONTRUOC,0) -  @param8                 SET @SOLUONGXUAT =  @param8                 SET @SOLUONGNHAP = 0               END               IF( @param0  = 'X' AND  @param6  = 'DEL')               BEGIN                SET @TONSAU = ISNULL(@TONTRUOC,0) +  @param8                 SET @SOLUONGNHAP =  @param8                 SET @SOLUONGXUAT = 0                             END                        insert into TT_DUOC_TONKHO_LOG (                           CHUNGTUCHITIET_ID              ,CHUNGTU_ID              ,MACHUNGTU              ,LOAICHUNGTU              ,MUCDICHCHUNGTU_CODE              ,KHONHAP_ID              ,KHOXUAT_ID              ,DUOC_ID              ,SOLONHAP_ID              ,NGUONDUOC_ID              ,SOLUONGNHAP              ,SOLUONGXUAT              ,DONGIAMUA              ,DONGIAVON              ,TYLE_VAT              ,DONGIAVONVAT              ,TONTRUOC              ,TONSAU              ,ACTION              ,BENHVIEN_ID              ,NGAYTAO              ,NGUOITAO_ID                          ) values (              @param9               , @param10               , @param11               , @param0               , @param12               , @param1               , @param2               , @param3               , @param4               , @param5               ,@SOLUONGNHAP              ,@SOLUONGXUAT              , @param13               , @param14               , @param15               , @param16               ,@TONTRUOC              ,@TONSAU              , @param6               , @param17               , @param18               , @param19               )]
2019-09-20 18:19:32,862 [1] DEBUG - Statement Id: [DAO00030_TT_DUOC_TONKHO_LOG_Add] Parameters: [@param0=[LOAICHUNGTU,X], @param1=[KHONHAP_ID,null], @param2=[KHOXUAT_ID,32], @param3=[DUOC_ID,1], @param4=[SOLONHAP_ID,7541], @param5=[NGUONDUOC_ID,1], @param6=[ACTION,ADD], @param7=[SOLUONGNHAP,null], @param8=[SOLUONGXUAT,2], @param9=[CHUNGTUCHITIET_ID,1299054], @param10=[CHUNGTU_ID,137705], @param11=[MACHUNGTU,CS_KBX1319003093], @param12=[MUCDICHCHUNGTU_CODE,X13], @param13=[DONGIAMUA,945], @param14=[DONGIAVON,945], @param15=[TYLE_VAT,0], @param16=[DONGIAVONVAT,945], @param17=[BENHVIEN_ID,HLU01], @param18=[NGAYTAO,9/20/2019 6:19:32 PM], @param19=[NGUOITAO_ID,0]]
2019-09-20 18:19:32,862 [1] DEBUG - Statement Id: [DAO00030_TT_DUOC_TONKHO_LOG_Add] Types: [@param0=[String, System.String], @param1=[System.DBNull, null], @param2=[Int64, System.Int64], @param3=[Int64, System.Int64], @param4=[Int64, System.Int64], @param5=[Int64, System.Int64], @param6=[String, System.String], @param7=[System.DBNull, null], @param8=[Decimal, System.Decimal], @param9=[Int64, System.Int64], @param10=[Int64, System.Int64], @param11=[String, System.String], @param12=[String, System.String], @param13=[Decimal, System.Decimal], @param14=[Decimal, System.Decimal], @param15=[Double, System.Double], @param16=[Double, System.Double], @param17=[String, System.String], @param18=[DateTime, System.DateTime], @param19=[Int64, System.Int64]]
2019-09-20 18:19:32,897 [1] DEBUG - Statement Id: [DAO00030_DUOC_TONKHO_BOOKING_NGOAITRU_Giam] PreparedStatement : [update TT_DUOC_TONKHO_BOOK_NGOAITRU            set            SOLUONG = 0                     ,NGAYCAPNHAT = getdate()            where            REF_TABLE = 'TT_NGOAITRU_KHAMBENH_VTYT'            AND REF_ID = '10593'                AND BENHVIEN_ID = 'HLU01']
2019-09-20 18:19:32,952 [1] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoVaBookingCOM23UpdateRedis] PreparedStatement : [declare @NGUONDUOC_MACDINH varchar(5) = '0';        declare @TOAMUANGOAI int = 0;        select @NGUONDUOC_MACDINH = isnull(VALUE,0) from TM_SYS_APPSETTINGS where CODE = 'PHA_NGUONDUOC'        select @TOAMUANGOAI = isnull(VALUE,0) from TM_SYS_APPSETTINGS where CODE = 'OPD_TOAMUANGOAI_DUNGDANHMUC_DUOC'                if @TOAMUANGOAI = 1        begin        select  distinct '0' + '_' + LTRIM(d.DUOC_ID) + '_' + @NGUONDUOC_MACDINH as DUOC_KEY, 0 as PHAMVI_ID, @NGUONDUOC_MACDINH as NGUONDUOC_ID, null as TENNGUONDUOC, null as TINHTIEN, d.DUOC_ID, ld.MALOAIDUOC,        d.SOVISA,d.TYLE_VAT,d.COTOA, d.MADUOC, d.TENHANG, d.TENDUOCDAYDU, dvt.TENDONVITINH as DONVITINH, d.BHYT,        d.TENHOATCHAT, d.HAMLUONG, d.HANGSANXUAT, d.QUOCGIA, d.LOAIDUOC_ID, d.DUONGDUNG_ID, d.TINHTIEN_PTTT,        ten.TENDUOC, ten.TENDUOC_EN, ten.MAQUOCTE, ten.MAQUOCTEBT,        '' as BHYT_TEXT        , ld.LOAIVATTU_ID        , d.BENHVIEN_ID,        999999999 as SOLUONG, d.VTYT_PHANLOAI, d.PHAMVI, d.SUASOLUONGTONGHOP, d.MADUOCBV, d.DANGTRINHBAY        , TAMNGUNG = CASE WHEN d.TAMNGUNG = '1' THEN '1' ELSE '0' END        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        where d.DUOC_ID in (1)        union all        select  distinct tk.DUOC_KEY, LTRIM(tk.PHAMVI_ID) as PHAMVI_ID, tk.NGUONDUOC_ID, nh.TENNGUONDUOC, nh.TINHTIEN, d.DUOC_ID, ld.MALOAIDUOC,        d.SOVISA,d.TYLE_VAT,d.COTOA, d.MADUOC, d.TENHANG, d.TENDUOCDAYDU, dvt.TENDONVITINH as DONVITINH, d.BHYT,        d.TENHOATCHAT, d.HAMLUONG, d.HANGSANXUAT, d.QUOCGIA, d.LOAIDUOC_ID, d.DUONGDUNG_ID, d.TINHTIEN_PTTT,        ten.TENDUOC, ten.TENDUOC_EN, ten.MAQUOCTE, ten.MAQUOCTEBT,        CASE WHEN d.BHYT = '1' THEN 'BHYT' ELSE '' END as BHYT_TEXT        , ld.LOAIVATTU_ID        , d.BENHVIEN_ID,        tk.SOLUONG, d.VTYT_PHANLOAI, d.PHAMVI, d.SUASOLUONGTONGHOP, d.MADUOCBV, d.DANGTRINHBAY        , TAMNGUNG = CASE WHEN d.TAMNGUNG = '1' OR nh.TAMNGUNG = '1' OR kd.TAMNGUNG = '1' THEN '1' ELSE '0' END        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        inner join        (        select  LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')) DUOC_KEY, (SUM(dtk.SOLUONG) - isnull(sum(A.SOLUONG),0) - isnull(sum(B.SOLUONG),0)) SOLUONG, pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        from (select sum(soluong) soluong,duoc_id,nguonduoc_id,khoduoc_id,benhvien_id from TT_DUOC_TONKHO  group by duoc_id,nguonduoc_id,khoduoc_id,benhvien_id) dtk        inner join TM_DUOC_PHAMVISD_MAPPING pvsd on dtk.KHODUOC_ID = pvsd.KHODUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NOITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) B on B.DUOC_ID = dtk.DUOC_ID and B.SOLUONG > 0 and B.PHAMVI_ID = pvsd.PHAMVI_ID and B.NGUONHANG_ID = dtk.NGUONDUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NGOAITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) A on A.DUOC_ID = dtk.DUOC_ID and A.SOLUONG > 0 and A.PHAMVI_ID = pvsd.PHAMVI_ID and A.NGUONHANG_ID = dtk.NGUONDUOC_ID        where dtk.SOLUONG > 0 and dtk.BENHVIEN_ID = 'HLU01'        group by LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')), pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        ) tk on tk.DUOC_ID = d.DUOC_ID        left join TM_DUOC_PHAMVISUDUNG kd on kd.PHAMVI_ID = tk.PHAMVI_ID and kd.BENHVIEN_ID = 'HLU01'        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = tk.NGUONDUOC_ID and nh.BENHVIEN_ID = 'HLU01'        where  d.BENHVIEN_ID = 'HLU01' and d.DUOC_ID in (1)        end        else        begin        select  distinct tk.DUOC_KEY, LTRIM(tk.PHAMVI_ID) as PHAMVI_ID, tk.NGUONDUOC_ID, nh.TENNGUONDUOC, nh.TINHTIEN, d.DUOC_ID, ld.MALOAIDUOC,        d.SOVISA,d.TYLE_VAT,d.COTOA, d.MADUOC, d.TENHANG, d.TENDUOCDAYDU, dvt.TENDONVITINH as DONVITINH, d.BHYT,        d.TENHOATCHAT, d.HAMLUONG, d.HANGSANXUAT, d.QUOCGIA, d.LOAIDUOC_ID, d.DUONGDUNG_ID, d.TINHTIEN_PTTT,        ten.TENDUOC, ten.TENDUOC_EN, ten.MAQUOCTE, ten.MAQUOCTEBT,        CASE WHEN d.BHYT = '1' THEN 'BHYT' ELSE '' END as BHYT_TEXT        , ld.LOAIVATTU_ID        , d.BENHVIEN_ID,        tk.SOLUONG, d.VTYT_PHANLOAI, d.PHAMVI, d.SUASOLUONGTONGHOP, d.MADUOCBV, d.DANGTRINHBAY        , TAMNGUNG = CASE WHEN d.TAMNGUNG = '1' OR nh.TAMNGUNG = '1' OR kd.TAMNGUNG = '1' THEN '1' ELSE '0' END        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        inner join        (        select  LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')) DUOC_KEY, (SUM(dtk.SOLUONG) - isnull(sum(A.SOLUONG),0) - isnull(sum(B.SOLUONG),0)) SOLUONG, pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        from (select sum(soluong) soluong,duoc_id,nguonduoc_id,khoduoc_id,benhvien_id from TT_DUOC_TONKHO  group by duoc_id,nguonduoc_id,khoduoc_id,benhvien_id) dtk        inner join TM_DUOC_PHAMVISD_MAPPING pvsd on dtk.KHODUOC_ID = pvsd.KHODUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NOITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) B on B.DUOC_ID = dtk.DUOC_ID and B.SOLUONG > 0 and B.PHAMVI_ID = pvsd.PHAMVI_ID and B.NGUONHANG_ID = dtk.NGUONDUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NGOAITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) A on A.DUOC_ID = dtk.DUOC_ID and A.SOLUONG > 0 and A.PHAMVI_ID = pvsd.PHAMVI_ID and A.NGUONHANG_ID = dtk.NGUONDUOC_ID        where dtk.SOLUONG > 0 and dtk.BENHVIEN_ID = 'HLU01'        group by LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')), pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        ) tk on tk.DUOC_ID = d.DUOC_ID        left join TM_DUOC_PHAMVISUDUNG kd on kd.PHAMVI_ID = tk.PHAMVI_ID and kd.BENHVIEN_ID = 'HLU01'        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = tk.NGUONDUOC_ID and nh.BENHVIEN_ID = 'HLU01'        where  d.BENHVIEN_ID = 'HLU01' and d.DUOC_ID in (1)        end]
2019-09-20 18:19:33,133 [1] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoCOM18UpdateRedis] PreparedStatement : [select distinct TT_TONKHO.DUOC_KEY, LTRIM(TT_TONKHO.KHODUOC_ID) as KHODUOC_ID, TM_DUOC.DUOC_ID, TM_LOAIDUOC.MALOAIDUOC,TM_DUOC.SOVISA,TM_DUOC.TYLE_VAT,TM_DUOC.COTOA,        TM_DUOC.MADUOC, TM_DUOC.TENHANG, TM_DUOC.TENDUOCDAYDU, dvt.TENDONVITINH as DONVITINH,  TM_DUOC.DONVITINH_ID,TM_DUOC.BHYT,        TM_DUOC.TENHOATCHAT,        TM_DUOC.HAMLUONG, TM_DUOC.HANGSANXUAT, TM_DUOC.QUOCGIA, TM_DUOC.LOAIDUOC_ID, TM_DUOC.DUONGDUNG_ID,        TM_TENDUOC.TENDUOC, TM_TENDUOC.TENDUOC_EN, TM_TENDUOC.MAQUOCTE, TM_TENDUOC.MAQUOCTEBT,        TM_LOAIDUOC.LOAIVATTU_ID, TM_DUOC.BENHVIEN_ID,        TT_TONKHO.SOLUONG, TM_DUOC.VTYT_PHANLOAI, TM_DUOC.PHAMVI, TT_TONKHO.NGUONDUOC_ID, NG.TENNGUONDUOC AS TENNGUONDUOC        , TAMNGUNG = CASE WHEN TM_DUOC.TAMNGUNG = '1' OR NG.TAMNGUNG = '1' OR KD.TAMNGUNG = '1' THEN '1' ELSE '0' END        , TM_DUOC.DANGTRINHBAY        from TM_DUOC        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = TM_DUOC.DONVITINH_ID        left join TM_TENDUOC on TM_DUOC.TENDUOC_ID = TM_TENDUOC.TENDUOC_ID and TM_DUOC.BENHVIEN_ID = 'HLU01' and TM_DUOC.TAMNGUNG = '0'        left join TM_LOAIDUOC on TM_LOAIDUOC.LOAIDUOC_ID = TM_DUOC.LOAIDUOC_ID and TM_LOAIDUOC.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG on (TM_LOAIDUOC.LOAIVATTU_ID = TM_DUOC_HANDUNG.LOAIDUOC and TM_DUOC_HANDUNG.BENHVIEN_ID = 'HLU01')        inner join        (select LTRIM(A.KHODUOC_ID) + '_' + LTRIM(A.DUOC_ID) + '_' + LTRIM(ISNULL(A.NGUONDUOC_ID,'')) as DUOC_KEY, A.KHODUOC_ID, A.DUOC_ID, A.NGUONDUOC_ID,        SUM(isnull(A.SOLUONG,0)) as SOLUONG        from        (select SUM(SOLUONG) as SOLUONG, KHODUOC_ID, DUOC_ID, NGUONDUOC_ID from TT_DUOC_TONKHO        where BENHVIEN_ID = 'HLU01' group by KHODUOC_ID, DUOC_ID, NGUONDUOC_ID) A        group by LTRIM(A.KHODUOC_ID) + '_' + LTRIM(A.DUOC_ID) + '_' + LTRIM(ISNULL(A.NGUONDUOC_ID,'')), A.KHODUOC_ID, A.DUOC_ID, NGUONDUOC_ID        ) TT_TONKHO on TT_TONKHO.DUOC_ID = TM_DUOC.DUOC_ID        LEFT JOIN TM_NGUONHANG NG ON NG.NGUONDUOC_ID = TT_TONKHO.NGUONDUOC_ID        LEFT JOIN TM_KHODUOC KD ON KD.KHODUOC_ID = TT_TONKHO.KHODUOC_ID        where TM_DUOC.BENHVIEN_ID = 'HLU01' and TT_TONKHO.SOLUONG >= 0        and TM_DUOC.DUOC_ID in (1)]
2019-09-20 18:19:59,210 [1] DEBUG - Statement Id: [DAO00030_SetChungTuVTYTNgoaiTru] PreparedStatement : [update TT_NGOAITRU_KHAMBENH_VTYT set              CHUNGTU_ID =  @param0 ,              TRANGTHAI = 'DAXUAT',              NGAYCAPNHAT = GETDATE()              where              KHAMBENH_VTYT_ID IN (10593)                            update TT_VIENPHI set              DUYET = '1',              DATHUCHIEN = '1'              where              REF_TABLE = 'TT_NGOAITRU_KHAMBENH_VTYT'              AND REF_ID IN (10593)]
2019-09-20 18:19:59,210 [1] DEBUG - Statement Id: [DAO00030_SetChungTuVTYTNgoaiTru] Parameters: [@param0=[CHUNGTU_ID,137705]]
2019-09-20 18:19:59,210 [1] DEBUG - Statement Id: [DAO00030_SetChungTuVTYTNgoaiTru] Types: [@param0=[Int64, System.Int64]]
2019-09-20 18:19:59,286 [1] DEBUG - Statement Id: [DAO00030_DUOCTONKHO_Giam] PreparedStatement : [update TT_DUOC_TONKHO set            SOLUONG = SOLUONG -  @param0             , NGAYCAPNHAT =  getdate()            , NGUOICAPNHAT_ID =  @param1             where            KHODUOC_ID =  @param2             and DUOC_ID =  @param3             and SOLONHAP_ID =  @param4]
2019-09-20 18:19:59,288 [1] DEBUG - Statement Id: [DAO00030_DUOCTONKHO_Giam] Parameters: [@param0=[SOLUONGTHAYDOI,2], @param1=[NGUOICAPNHAT_ID,0], @param2=[KHODUOC_ID,32], @param3=[DUOC_ID,1], @param4=[SOLONHAP_ID,7541]]
2019-09-20 18:19:59,288 [1] DEBUG - Statement Id: [DAO00030_DUOCTONKHO_Giam] Types: [@param0=[Double, System.Double], @param1=[Int64, System.Int64], @param2=[Int64, System.Int64], @param3=[Int64, System.Int64], @param4=[Int64, System.Int64]]
2019-09-20 18:19:59,318 [1] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoCOM18] PreparedStatement : [select  distinct TT_TONKHO.DUOC_KEY, LTRIM(TT_TONKHO.KHODUOC_ID) as KHODUOC_ID, TM_DUOC.DUOC_ID, TM_LOAIDUOC.MALOAIDUOC,TM_DUOC.SOVISA,TM_DUOC.TYLE_VAT,TM_DUOC.COTOA,        TM_DUOC.MADUOC, TM_DUOC.TENHANG, TM_DUOC.TENDUOCDAYDU, dvt.TENDONVITINH as DONVITINH, TM_DUOC.DONVITINH_ID, TM_DUOC.BHYT,        TM_DUOC.TENHOATCHAT, TM_DUOC.HAMLUONG, TM_DUOC.HANGSANXUAT, TM_DUOC.QUOCGIA, TM_DUOC.LOAIDUOC_ID, TM_DUOC.DUONGDUNG_ID,        TM_TENDUOC.TENDUOC, TM_TENDUOC.TENDUOC_EN, TM_TENDUOC.MAQUOCTE, TM_TENDUOC.MAQUOCTEBT,        TM_LOAIDUOC.LOAIVATTU_ID, TM_DUOC.BENHVIEN_ID,        TT_TONKHO.SOLUONG, TM_DUOC.VTYT_PHANLOAI, TM_DUOC.PHAMVI, TT_TONKHO.NGUONDUOC_ID, NG.TENNGUONDUOC        , TAMNGUNG = CASE WHEN TM_DUOC.TAMNGUNG = '1' OR NG.TAMNGUNG = '1' OR KD.TAMNGUNG = '1' THEN '1' ELSE '0' END        , TM_DUOC.DANGTRINHBAY        from TM_DUOC        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = TM_DUOC.DONVITINH_ID        left join TM_TENDUOC on TM_DUOC.TENDUOC_ID = TM_TENDUOC.TENDUOC_ID and TM_DUOC.BENHVIEN_ID = 'HLU01'  and TM_DUOC.TAMNGUNG = '0'        left join TM_LOAIDUOC on TM_LOAIDUOC.LOAIDUOC_ID = TM_DUOC.LOAIDUOC_ID and TM_LOAIDUOC.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG on (TM_LOAIDUOC.LOAIVATTU_ID = TM_DUOC_HANDUNG.LOAIDUOC and TM_DUOC_HANDUNG.BENHVIEN_ID = 'HLU01')        inner join        (select LTRIM(A.KHODUOC_ID) + '_' + LTRIM(A.DUOC_ID) + '_' + LTRIM(ISNULL(A.NGUONDUOC_ID,'')) as DUOC_KEY, A.KHODUOC_ID, A.DUOC_ID ,a.NGUONDUOC_ID,        SUM(isnull(A.SOLUONG,0)) as SOLUONG        from        (select SUM(SOLUONG) as SOLUONG, KHODUOC_ID, DUOC_ID, NGUONDUOC_ID from TT_DUOC_TONKHO        where KHODUOC_ID in (32) and DUOC_ID in (1) group by KHODUOC_ID, DUOC_ID, NGUONDUOC_ID        ) A        where A.KHODUOC_ID in (32) and A.DUOC_ID in (1)        group by LTRIM(A.KHODUOC_ID) + '_' + LTRIM(A.DUOC_ID) + '_' + LTRIM(A.NGUONDUOC_ID), A.KHODUOC_ID, A.DUOC_ID, A.NGUONDUOC_ID)        TT_TONKHO on TT_TONKHO.DUOC_ID = TM_DUOC.DUOC_ID        LEFT JOIN TM_NGUONHANG NG ON NG.NGUONDUOC_ID = TT_TONKHO.NGUONDUOC_ID        LEFT JOIN TM_KHODUOC KD ON KD.KHODUOC_ID = TT_TONKHO.KHODUOC_ID        where TM_DUOC.BENHVIEN_ID = 'HLU01' and TM_DUOC.DUOC_ID in (1)]
2019-09-20 18:19:59,353 [1] DEBUG - Statement Id: [DAO00030_GetListPhamViByKhoDuoc] PreparedStatement : [SELECT DISTINCT PHAMVI_ID          FROM TM_DUOC_PHAMVISD_MAPPING          WHERE          KHODUOC_ID IN (32)          AND BENHVIEN_ID ='HLU01'          AND TAMNGUNG = '0']
2019-09-20 18:19:59,382 [1] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoVaBookingCOM23] PreparedStatement : [declare @NGUONDUOC_MACDINH varchar(5) = '0';        declare @TOAMUANGOAI int = 0;        select @NGUONDUOC_MACDINH = isnull(VALUE,0) from TM_SYS_APPSETTINGS where CODE = 'PHA_NGUONDUOC'        select @TOAMUANGOAI = isnull(VALUE,0) from TM_SYS_APPSETTINGS where CODE = 'OPD_TOAMUANGOAI_DUNGDANHMUC_DUOC'                if @TOAMUANGOAI = 1        begin        select  distinct '0' + '_' + LTRIM(d.DUOC_ID) + '_' + @NGUONDUOC_MACDINH as DUOC_KEY, 0 as PHAMVI_ID, @NGUONDUOC_MACDINH as NGUONDUOC_ID, null as TENNGUONDUOC, null as TINHTIEN, d.DUOC_ID, ld.MALOAIDUOC,        d.SOVISA,d.TYLE_VAT,d.COTOA, d.MADUOC, d.TENHANG, d.TENDUOCDAYDU, dvt.TENDONVITINH as DONVITINH, d.BHYT,        d.TENHOATCHAT, d.HAMLUONG, d.HANGSANXUAT, d.QUOCGIA, d.LOAIDUOC_ID, d.DUONGDUNG_ID, d.TINHTIEN_PTTT,        ten.TENDUOC, ten.TENDUOC_EN, ten.MAQUOCTE, ten.MAQUOCTEBT,        '' as BHYT_TEXT        , ld.LOAIVATTU_ID        , d.BENHVIEN_ID,        999999999 as SOLUONG, d.VTYT_PHANLOAI, d.PHAMVI, d.SUASOLUONGTONGHOP, d.MADUOCBV, d.DANGTRINHBAY        , TAMNGUNG = CASE WHEN d.TAMNGUNG = '1' THEN '1' ELSE '0' END        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        where d.DUOC_ID in (1)        union all        select  distinct tk.DUOC_KEY, LTRIM(tk.PHAMVI_ID) as PHAMVI_ID, tk.NGUONDUOC_ID, nh.TENNGUONDUOC, nh.TINHTIEN, d.DUOC_ID, ld.MALOAIDUOC,        d.SOVISA,d.TYLE_VAT,d.COTOA, d.MADUOC, d.TENHANG, d.TENDUOCDAYDU, dvt.TENDONVITINH as DONVITINH, d.BHYT,        d.TENHOATCHAT, d.HAMLUONG, d.HANGSANXUAT, d.QUOCGIA, d.LOAIDUOC_ID, d.DUONGDUNG_ID, d.TINHTIEN_PTTT,        ten.TENDUOC, ten.TENDUOC_EN, ten.MAQUOCTE, ten.MAQUOCTEBT,        CASE WHEN d.BHYT = '1' THEN 'BHYT' ELSE '' END as BHYT_TEXT        , ld.LOAIVATTU_ID        , d.BENHVIEN_ID,        tk.SOLUONG, d.VTYT_PHANLOAI, d.PHAMVI, d.SUASOLUONGTONGHOP, d.MADUOCBV, d.DANGTRINHBAY        , TAMNGUNG = CASE WHEN d.TAMNGUNG = '1' OR nh.TAMNGUNG = '1' OR kd.TAMNGUNG = '1' THEN '1' ELSE '0' END        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        inner join        (        select  LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')) DUOC_KEY, (SUM(dtk.SOLUONG) - isnull(sum(A.SOLUONG),0) - isnull(sum(B.SOLUONG),0)) SOLUONG, pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        from (select sum(soluong) soluong,duoc_id,nguonduoc_id,khoduoc_id,benhvien_id from TT_DUOC_TONKHO  group by duoc_id,nguonduoc_id,khoduoc_id,benhvien_id) dtk        inner join TM_DUOC_PHAMVISD_MAPPING pvsd on dtk.KHODUOC_ID = pvsd.KHODUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NOITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) B on B.DUOC_ID = dtk.DUOC_ID and B.SOLUONG > 0 and B.PHAMVI_ID = pvsd.PHAMVI_ID and B.NGUONHANG_ID = dtk.NGUONDUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NGOAITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) A on A.DUOC_ID = dtk.DUOC_ID and A.SOLUONG > 0 and A.PHAMVI_ID = pvsd.PHAMVI_ID and A.NGUONHANG_ID = dtk.NGUONDUOC_ID        where dtk.SOLUONG > 0 and dtk.BENHVIEN_ID = 'HLU01'        group by LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')), pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        ) tk on tk.DUOC_ID = d.DUOC_ID        left join TM_DUOC_PHAMVISUDUNG kd on kd.PHAMVI_ID = tk.PHAMVI_ID and kd.BENHVIEN_ID = 'HLU01'        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = tk.NGUONDUOC_ID and nh.BENHVIEN_ID = 'HLU01'        where  d.BENHVIEN_ID = 'HLU01' and d.DUOC_ID in (1) and TK.PHAMVI_ID in (1055)        and tk.NGUONDUOC_ID in (1)         end        else        begin                select  distinct tk.DUOC_KEY, LTRIM(tk.PHAMVI_ID) as PHAMVI_ID, tk.NGUONDUOC_ID, nh.TENNGUONDUOC, nh.TINHTIEN, d.DUOC_ID, ld.MALOAIDUOC,        d.SOVISA,d.TYLE_VAT,d.COTOA, d.MADUOC, d.TENHANG, d.TENDUOCDAYDU, dvt.TENDONVITINH as DONVITINH, d.BHYT,        d.TENHOATCHAT, d.HAMLUONG, d.HANGSANXUAT, d.QUOCGIA, d.LOAIDUOC_ID, d.DUONGDUNG_ID, d.TINHTIEN_PTTT,        ten.TENDUOC, ten.TENDUOC_EN, ten.MAQUOCTE, ten.MAQUOCTEBT,        CASE WHEN d.BHYT = '1' THEN 'BHYT' ELSE '' END as BHYT_TEXT        , ld.LOAIVATTU_ID        , d.BENHVIEN_ID,        tk.SOLUONG, d.VTYT_PHANLOAI, d.PHAMVI, d.SUASOLUONGTONGHOP, d.MADUOCBV, d.DANGTRINHBAY        , TAMNGUNG = CASE WHEN d.TAMNGUNG = '1' OR nh.TAMNGUNG = '1' OR kd.TAMNGUNG = '1' THEN '1' ELSE '0' END        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        inner join        (        select  LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')) DUOC_KEY, (SUM(dtk.SOLUONG) - isnull(sum(A.SOLUONG),0) - isnull(sum(B.SOLUONG),0)) SOLUONG, pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        from (select sum(soluong) soluong,duoc_id,nguonduoc_id,khoduoc_id,benhvien_id from TT_DUOC_TONKHO  group by duoc_id,nguonduoc_id,khoduoc_id,benhvien_id) dtk        inner join TM_DUOC_PHAMVISD_MAPPING pvsd on dtk.KHODUOC_ID = pvsd.KHODUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NOITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) B on B.DUOC_ID = dtk.DUOC_ID and B.SOLUONG > 0 and B.PHAMVI_ID = pvsd.PHAMVI_ID and B.NGUONHANG_ID = dtk.NGUONDUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NGOAITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) A on A.DUOC_ID = dtk.DUOC_ID and A.SOLUONG > 0 and A.PHAMVI_ID = pvsd.PHAMVI_ID and A.NGUONHANG_ID = dtk.NGUONDUOC_ID        where dtk.SOLUONG > 0 and dtk.BENHVIEN_ID = 'HLU01'        group by LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')), pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        ) tk on tk.DUOC_ID = d.DUOC_ID        left join TM_DUOC_PHAMVISUDUNG kd on kd.PHAMVI_ID = tk.PHAMVI_ID and kd.BENHVIEN_ID = 'HLU01'        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = tk.NGUONDUOC_ID and nh.BENHVIEN_ID = 'HLU01'        where  d.BENHVIEN_ID = 'HLU01' and d.DUOC_ID in (1) and TK.PHAMVI_ID in (1055)        and tk.NGUONDUOC_ID in (1)         end]
2019-09-20 18:19:59,597 [1] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoCOM18UpdateRedis] PreparedStatement : [select distinct TT_TONKHO.DUOC_KEY, LTRIM(TT_TONKHO.KHODUOC_ID) as KHODUOC_ID, TM_DUOC.DUOC_ID, TM_LOAIDUOC.MALOAIDUOC,TM_DUOC.SOVISA,TM_DUOC.TYLE_VAT,TM_DUOC.COTOA,        TM_DUOC.MADUOC, TM_DUOC.TENHANG, TM_DUOC.TENDUOCDAYDU, dvt.TENDONVITINH as DONVITINH,  TM_DUOC.DONVITINH_ID,TM_DUOC.BHYT,        TM_DUOC.TENHOATCHAT,        TM_DUOC.HAMLUONG, TM_DUOC.HANGSANXUAT, TM_DUOC.QUOCGIA, TM_DUOC.LOAIDUOC_ID, TM_DUOC.DUONGDUNG_ID,        TM_TENDUOC.TENDUOC, TM_TENDUOC.TENDUOC_EN, TM_TENDUOC.MAQUOCTE, TM_TENDUOC.MAQUOCTEBT,        TM_LOAIDUOC.LOAIVATTU_ID, TM_DUOC.BENHVIEN_ID,        TT_TONKHO.SOLUONG, TM_DUOC.VTYT_PHANLOAI, TM_DUOC.PHAMVI, TT_TONKHO.NGUONDUOC_ID, NG.TENNGUONDUOC AS TENNGUONDUOC        , TAMNGUNG = CASE WHEN TM_DUOC.TAMNGUNG = '1' OR NG.TAMNGUNG = '1' OR KD.TAMNGUNG = '1' THEN '1' ELSE '0' END        , TM_DUOC.DANGTRINHBAY        from TM_DUOC        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = TM_DUOC.DONVITINH_ID        left join TM_TENDUOC on TM_DUOC.TENDUOC_ID = TM_TENDUOC.TENDUOC_ID and TM_DUOC.BENHVIEN_ID = 'HLU01' and TM_DUOC.TAMNGUNG = '0'        left join TM_LOAIDUOC on TM_LOAIDUOC.LOAIDUOC_ID = TM_DUOC.LOAIDUOC_ID and TM_LOAIDUOC.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG on (TM_LOAIDUOC.LOAIVATTU_ID = TM_DUOC_HANDUNG.LOAIDUOC and TM_DUOC_HANDUNG.BENHVIEN_ID = 'HLU01')        inner join        (select LTRIM(A.KHODUOC_ID) + '_' + LTRIM(A.DUOC_ID) + '_' + LTRIM(ISNULL(A.NGUONDUOC_ID,'')) as DUOC_KEY, A.KHODUOC_ID, A.DUOC_ID, A.NGUONDUOC_ID,        SUM(isnull(A.SOLUONG,0)) as SOLUONG        from        (select SUM(SOLUONG) as SOLUONG, KHODUOC_ID, DUOC_ID, NGUONDUOC_ID from TT_DUOC_TONKHO        where BENHVIEN_ID = 'HLU01' group by KHODUOC_ID, DUOC_ID, NGUONDUOC_ID) A        group by LTRIM(A.KHODUOC_ID) + '_' + LTRIM(A.DUOC_ID) + '_' + LTRIM(ISNULL(A.NGUONDUOC_ID,'')), A.KHODUOC_ID, A.DUOC_ID, NGUONDUOC_ID        ) TT_TONKHO on TT_TONKHO.DUOC_ID = TM_DUOC.DUOC_ID        LEFT JOIN TM_NGUONHANG NG ON NG.NGUONDUOC_ID = TT_TONKHO.NGUONDUOC_ID        LEFT JOIN TM_KHODUOC KD ON KD.KHODUOC_ID = TT_TONKHO.KHODUOC_ID        where TM_DUOC.BENHVIEN_ID = 'HLU01' and TT_TONKHO.SOLUONG >= 0        and TM_DUOC.DUOC_ID in (1)]
2019-09-20 18:19:59,645 [1] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoVaBookingCOM23UpdateRedis] PreparedStatement : [declare @NGUONDUOC_MACDINH varchar(5) = '0';        declare @TOAMUANGOAI int = 0;        select @NGUONDUOC_MACDINH = isnull(VALUE,0) from TM_SYS_APPSETTINGS where CODE = 'PHA_NGUONDUOC'        select @TOAMUANGOAI = isnull(VALUE,0) from TM_SYS_APPSETTINGS where CODE = 'OPD_TOAMUANGOAI_DUNGDANHMUC_DUOC'                if @TOAMUANGOAI = 1        begin        select  distinct '0' + '_' + LTRIM(d.DUOC_ID) + '_' + @NGUONDUOC_MACDINH as DUOC_KEY, 0 as PHAMVI_ID, @NGUONDUOC_MACDINH as NGUONDUOC_ID, null as TENNGUONDUOC, null as TINHTIEN, d.DUOC_ID, ld.MALOAIDUOC,        d.SOVISA,d.TYLE_VAT,d.COTOA, d.MADUOC, d.TENHANG, d.TENDUOCDAYDU, dvt.TENDONVITINH as DONVITINH, d.BHYT,        d.TENHOATCHAT, d.HAMLUONG, d.HANGSANXUAT, d.QUOCGIA, d.LOAIDUOC_ID, d.DUONGDUNG_ID, d.TINHTIEN_PTTT,        ten.TENDUOC, ten.TENDUOC_EN, ten.MAQUOCTE, ten.MAQUOCTEBT,        '' as BHYT_TEXT        , ld.LOAIVATTU_ID        , d.BENHVIEN_ID,        999999999 as SOLUONG, d.VTYT_PHANLOAI, d.PHAMVI, d.SUASOLUONGTONGHOP, d.MADUOCBV, d.DANGTRINHBAY        , TAMNGUNG = CASE WHEN d.TAMNGUNG = '1' THEN '1' ELSE '0' END        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        where d.DUOC_ID in (1)        union all        select  distinct tk.DUOC_KEY, LTRIM(tk.PHAMVI_ID) as PHAMVI_ID, tk.NGUONDUOC_ID, nh.TENNGUONDUOC, nh.TINHTIEN, d.DUOC_ID, ld.MALOAIDUOC,        d.SOVISA,d.TYLE_VAT,d.COTOA, d.MADUOC, d.TENHANG, d.TENDUOCDAYDU, dvt.TENDONVITINH as DONVITINH, d.BHYT,        d.TENHOATCHAT, d.HAMLUONG, d.HANGSANXUAT, d.QUOCGIA, d.LOAIDUOC_ID, d.DUONGDUNG_ID, d.TINHTIEN_PTTT,        ten.TENDUOC, ten.TENDUOC_EN, ten.MAQUOCTE, ten.MAQUOCTEBT,        CASE WHEN d.BHYT = '1' THEN 'BHYT' ELSE '' END as BHYT_TEXT        , ld.LOAIVATTU_ID        , d.BENHVIEN_ID,        tk.SOLUONG, d.VTYT_PHANLOAI, d.PHAMVI, d.SUASOLUONGTONGHOP, d.MADUOCBV, d.DANGTRINHBAY        , TAMNGUNG = CASE WHEN d.TAMNGUNG = '1' OR nh.TAMNGUNG = '1' OR kd.TAMNGUNG = '1' THEN '1' ELSE '0' END        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        inner join        (        select  LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')) DUOC_KEY, (SUM(dtk.SOLUONG) - isnull(sum(A.SOLUONG),0) - isnull(sum(B.SOLUONG),0)) SOLUONG, pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        from (select sum(soluong) soluong,duoc_id,nguonduoc_id,khoduoc_id,benhvien_id from TT_DUOC_TONKHO  group by duoc_id,nguonduoc_id,khoduoc_id,benhvien_id) dtk        inner join TM_DUOC_PHAMVISD_MAPPING pvsd on dtk.KHODUOC_ID = pvsd.KHODUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NOITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) B on B.DUOC_ID = dtk.DUOC_ID and B.SOLUONG > 0 and B.PHAMVI_ID = pvsd.PHAMVI_ID and B.NGUONHANG_ID = dtk.NGUONDUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NGOAITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) A on A.DUOC_ID = dtk.DUOC_ID and A.SOLUONG > 0 and A.PHAMVI_ID = pvsd.PHAMVI_ID and A.NGUONHANG_ID = dtk.NGUONDUOC_ID        where dtk.SOLUONG > 0 and dtk.BENHVIEN_ID = 'HLU01'        group by LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')), pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        ) tk on tk.DUOC_ID = d.DUOC_ID        left join TM_DUOC_PHAMVISUDUNG kd on kd.PHAMVI_ID = tk.PHAMVI_ID and kd.BENHVIEN_ID = 'HLU01'        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = tk.NGUONDUOC_ID and nh.BENHVIEN_ID = 'HLU01'        where  d.BENHVIEN_ID = 'HLU01' and d.DUOC_ID in (1)        end        else        begin        select  distinct tk.DUOC_KEY, LTRIM(tk.PHAMVI_ID) as PHAMVI_ID, tk.NGUONDUOC_ID, nh.TENNGUONDUOC, nh.TINHTIEN, d.DUOC_ID, ld.MALOAIDUOC,        d.SOVISA,d.TYLE_VAT,d.COTOA, d.MADUOC, d.TENHANG, d.TENDUOCDAYDU, dvt.TENDONVITINH as DONVITINH, d.BHYT,        d.TENHOATCHAT, d.HAMLUONG, d.HANGSANXUAT, d.QUOCGIA, d.LOAIDUOC_ID, d.DUONGDUNG_ID, d.TINHTIEN_PTTT,        ten.TENDUOC, ten.TENDUOC_EN, ten.MAQUOCTE, ten.MAQUOCTEBT,        CASE WHEN d.BHYT = '1' THEN 'BHYT' ELSE '' END as BHYT_TEXT        , ld.LOAIVATTU_ID        , d.BENHVIEN_ID,        tk.SOLUONG, d.VTYT_PHANLOAI, d.PHAMVI, d.SUASOLUONGTONGHOP, d.MADUOCBV, d.DANGTRINHBAY        , TAMNGUNG = CASE WHEN d.TAMNGUNG = '1' OR nh.TAMNGUNG = '1' OR kd.TAMNGUNG = '1' THEN '1' ELSE '0' END        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        inner join        (        select  LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')) DUOC_KEY, (SUM(dtk.SOLUONG) - isnull(sum(A.SOLUONG),0) - isnull(sum(B.SOLUONG),0)) SOLUONG, pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        from (select sum(soluong) soluong,duoc_id,nguonduoc_id,khoduoc_id,benhvien_id from TT_DUOC_TONKHO  group by duoc_id,nguonduoc_id,khoduoc_id,benhvien_id) dtk        inner join TM_DUOC_PHAMVISD_MAPPING pvsd on dtk.KHODUOC_ID = pvsd.KHODUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NOITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) B on B.DUOC_ID = dtk.DUOC_ID and B.SOLUONG > 0 and B.PHAMVI_ID = pvsd.PHAMVI_ID and B.NGUONHANG_ID = dtk.NGUONDUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NGOAITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) A on A.DUOC_ID = dtk.DUOC_ID and A.SOLUONG > 0 and A.PHAMVI_ID = pvsd.PHAMVI_ID and A.NGUONHANG_ID = dtk.NGUONDUOC_ID        where dtk.SOLUONG > 0 and dtk.BENHVIEN_ID = 'HLU01'        group by LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')), pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        ) tk on tk.DUOC_ID = d.DUOC_ID        left join TM_DUOC_PHAMVISUDUNG kd on kd.PHAMVI_ID = tk.PHAMVI_ID and kd.BENHVIEN_ID = 'HLU01'        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = tk.NGUONDUOC_ID and nh.BENHVIEN_ID = 'HLU01'        where  d.BENHVIEN_ID = 'HLU01' and d.DUOC_ID in (1)        end]
2019-09-20 18:20:01,661 [1] DEBUG - Statement Id: [DAO00030_GetList] PreparedStatement : [select *              from TT_DUOC_CHUNGTU              where BENHVIEN_ID = 'HLU01'                and                   TT_DUOC_CHUNGTU.CHUNGTU_ID = '137705'                               order by CHUNGTU_ID]
2019-09-20 18:20:01,784 [1] DEBUG - Statement Id: [DAO00030_CHUNGTUXUAT_CHITIET_GetList] PreparedStatement : [SELECT            ctct.*,            d.MADUOC, d.TENHANG, d.TENDUOCDAYDU, dvt.TENDONVITINH as DONVITINH,n.TENNGUONDUOC as NGUONHANG,            sln.SOLONHAP, sln.SOLOSANPHAM, sln.NGAYNHAP as NGAYNHAPLO, sln.HANDUNG as HANSUDUNG,            isnull(tk.SOLUONG,0) as SOLUONGTON,            LTRIM(ct.KHOXUAT_ID) + '_' + LTRIM(sln.DUOC_ID) + '_' + LTRIM(sln.NGUONDUOC_ID) as DUOC_KEY            , NLD.MANHOMLOAIDUOC, ld.MALOAIDUOC, D.SO_QDTT            FROM            TT_DUOC_CHUNGTU_CHITIET ctct            INNER JOIN TT_DUOC_CHUNGTU ct ON (ct.CHUNGTU_ID = ctct.CHUNGTU_ID)            INNER JOIN TT_DUOC_CHUNGTU_SOLONHAP sln ON (sln.SOLONHAP_ID = ctct.SOLONHAP_ID)            LEFT JOIN (            select xx.DUOCTONKHO_ID, xx.KHODUOC_ID, xx.DUOC_ID, xx.SOLONHAP_ID, xx.SOLUONG, xx.NGUONDUOC_ID, xx.BENHVIEN_ID from TT_DUOC_TONKHO xx            join ( select max(DUOCTONKHO_ID) as DUOCTONKHO_ID, KHODUOC_ID, DUOC_ID, SOLONHAP_ID, NGUONDUOC_ID            from TT_DUOC_TONKHO group by KHODUOC_ID, DUOC_ID, SOLONHAP_ID, NGUONDUOC_ID) yy on xx.DUOCTONKHO_ID=yy.DUOCTONKHO_ID            ) tk ON (tk.SOLONHAP_ID = sln.SOLONHAP_ID AND tk.DUOC_ID = sln.DUOC_ID and tk.KHODUOC_ID = ct.KHOXUAT_ID)            INNER JOIN TM_DUOC d ON (d.DUOC_ID = ctct.DUOC_ID)            INNER JOIN TM_NGUONHANG n ON (n.NGUONDUOC_ID = ctct.NGUONHANG_ID)            LEFT JOIN TM_DONVITINH dvt ON (dvt.DONVITINH_ID = ctct.DONVITINH_ID)            left join TM_LOAIDUOC LD on LD.LOAIDUOC_ID = D.LOAIDUOC_ID            LEFT JOIN TM_NHOMLOAIDUOC NLD on NLD.NHOMLOAIDUOC_ID = LD.NHOMLOAIDUOC_ID             where                             ct.CHUNGTU_ID = '137705'                       and                           ct.BENHVIEN_ID = 'HLU01'                                     order by CHUNGTUCHITIET_ID]
2019-09-20 18:20:01,915 [1] DEBUG - Statement Id: [DAO00030_KiemTraChungTuKhoaSo] PreparedStatement : [SELECT CHUNGTU_ID              FROM TT_DUOC_CHUNGTU              WHERE              MACHUNGTU = 'CS_KBX1319003093'              and BENHVIEN_ID = 'HLU01'              and              convert(date, NGAYCHUNGTU) <=              (              SELECT TOP 1 convert(date, KHOADENNGAY)              FROM TT_DUOC_KHOASOCHUNGTU              WHERE              KHODUOC_ID = '32'              and BENHVIEN_ID = 'HLU01'              AND KHOASO = '1'              ORDER BY KHOADENNGAY DESC              )]
2019-09-20 18:20:01,959 [1] DEBUG - Statement Id: [DAO00030_KiemTraChungTuDaChuyenKeToan] PreparedStatement : [SELECT CHUNGTU_ID            FROM TT_DUOC_CHUNGTU            WHERE            CHUNGTU_ID = '137705'            and IDCHUYEN IS NOT NULL            and BENHVIEN_ID = 'HLU01']
2019-09-20 18:20:01,988 [1] DEBUG - Statement Id: [DAO00030_KiemTraBenhNhanXuatVien] PreparedStatement : [select              TT.TOATHUOC_ID              from              TT_NOITRU_TOATHUOC TT              inner join TT_NOITRU_KHAMBENH KB on TT.KHAMBENH_ID = KB.KHAMBENH_ID              inner join TT_NOITRU_BENHAN BA on BA.BENHAN_ID = KB.BENHAN_ID              WHERE              BA.TRANGTHAI = 'DAXUATVIEN'              AND TT.CHUNGTU_ID =  137705              and TT.BENHVIEN_ID = 'HLU01']
2019-09-20 18:20:02,200 [1] DEBUG - Statement Id: [DAO00030_DUOCTONKHO_GetSoTonTheoDuoc] PreparedStatement : [SELECT              DUOC_ID,              SUM(SOLUONG) AS TONGTON              FROM              TT_DUOC_TONKHO              WHERE              KHODUOC_ID = '32'              and BENHVIEN_ID = 'HLU01'              and DUOC_ID IN (1)              GROUP BY DUOC_ID]
2019-09-20 18:20:02,242 [1] DEBUG - Statement Id: [DAO00030_DUOCTONKHO_GetSoTonTheoDuocTheoLo] PreparedStatement : [SELECT              DUOC_ID,SOLONHAP_ID,              SUM(SOLUONG) AS SOLUONGTONLO              FROM              TT_DUOC_TONKHO              WHERE              KHODUOC_ID = '32'              and BENHVIEN_ID = 'HLU01'              and DUOC_ID IN (1)              and SOLONHAP_ID IN (7541)              GROUP BY DUOC_ID, SOLONHAP_ID]
2019-09-20 18:20:02,271 [1] DEBUG - Statement Id: [DAO00030_DUOCTONKHO_GetSoTonTheoDuoc] PreparedStatement : [SELECT              DUOC_ID,              SUM(SOLUONG) AS TONGTON              FROM              TT_DUOC_TONKHO              WHERE              KHODUOC_ID = '32'              and BENHVIEN_ID = 'HLU01'              and DUOC_ID IN (1)              GROUP BY DUOC_ID]
