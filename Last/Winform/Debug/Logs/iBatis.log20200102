--------------------------------------------------------------------------------
2020-01-02 09:46:12,646 [1] DEBUG - Statement Id: [DAO00001_DBList] PreparedStatement : [select *              from TM_SYS_SERVER              where HOSPITAL_ID = '_SYSTEM_' and TYPE = 'D']
2020-01-02 09:46:14,357 [1] DEBUG - Statement Id: [DAO00001_DaoList] PreparedStatement : [select              TM_SYS_SERVICEMAP.ID,              TM_SYS_SERVICEMAP.HOSPITAL_ID,              TM_SYS_SERVICEMAP.DB_NAME,              TM_SYS_SERVICEMAP.TYPE,              TM_SYS_SERVICEMAP.NAME,              TM_SYS_SERVICEMAP.CLASS,              (TM_SYS_DIC.VALUE + '.' + TM_SYS_SERVICEMAP.CLASS) as CLASSFULL,              TM_SYS_SERVICEMAP.ASSEMBLY              from TM_SYS_SERVICEMAP              inner join TM_SYS_DIC              on TM_SYS_SERVICEMAP.NAMESPACE = TM_SYS_DIC.ID              where HOSPITAL_ID = '_SYSTEM_' AND TYPE = 'D' AND ACTIVE = '1'              order by DB_NAME]
2020-01-02 09:46:14,410 [1] DEBUG - Statement Id: [DAO00001_ServiceList] PreparedStatement : [select              TM_SYS_SERVICEMAP.ID,              TM_SYS_SERVICEMAP.HOSPITAL_ID,              TM_SYS_SERVICEMAP.DB_NAME,              TM_SYS_SERVICEMAP.TYPE,              TM_SYS_SERVICEMAP.NAME,              TM_SYS_SERVICEMAP.CLASS,              (TM_SYS_DIC.VALUE + '.' + TM_SYS_SERVICEMAP.CLASS) as CLASSFULL,              TM_SYS_SERVICEMAP.ASSEMBLY,              TM_SYS_SERVER.URL              from TM_SYS_SERVICEMAP              inner join TM_SYS_DIC on TM_SYS_SERVICEMAP.NAMESPACE = TM_SYS_DIC.ID              inner join TM_SYS_SERVER on (TM_SYS_SERVICEMAP.DB_NAME = TM_SYS_SERVER.NAME) and (TM_SYS_SERVER.HOSPITAL_ID = '_SYSTEM_')              where TM_SYS_SERVICEMAP.HOSPITAL_ID = '_SYSTEM_' AND TM_SYS_SERVICEMAP.TYPE = 'S'  AND ACTIVE = '1'              order by URL]
2020-01-02 09:46:16,023 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = '_SYSTEM_'               AND                   TM_SYS_SCREEN.PAGE = 'LOGIN'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2020-01-02 09:46:17,795 [1] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = '_SYSTEM_'               AND                   TM_SYS_CACHE.ACTIVE = '1']
2020-01-02 09:50:21,215 [1] DEBUG - Statement Id: [DAO00001_DBList] PreparedStatement : [select *              from TM_SYS_SERVER              where HOSPITAL_ID = 'HLU01' and TYPE = 'D']
2020-01-02 09:50:21,241 [1] DEBUG - Statement Id: [DAO00001_DaoList] PreparedStatement : [select              TM_SYS_SERVICEMAP.ID,              TM_SYS_SERVICEMAP.HOSPITAL_ID,              TM_SYS_SERVICEMAP.DB_NAME,              TM_SYS_SERVICEMAP.TYPE,              TM_SYS_SERVICEMAP.NAME,              TM_SYS_SERVICEMAP.CLASS,              (TM_SYS_DIC.VALUE + '.' + TM_SYS_SERVICEMAP.CLASS) as CLASSFULL,              TM_SYS_SERVICEMAP.ASSEMBLY              from TM_SYS_SERVICEMAP              inner join TM_SYS_DIC              on TM_SYS_SERVICEMAP.NAMESPACE = TM_SYS_DIC.ID              where HOSPITAL_ID = 'HLU01' AND TYPE = 'D' AND ACTIVE = '1'              order by DB_NAME]
2020-01-02 09:50:29,605 [1] DEBUG - Statement Id: [DAO00001_ServiceList] PreparedStatement : [select              TM_SYS_SERVICEMAP.ID,              TM_SYS_SERVICEMAP.HOSPITAL_ID,              TM_SYS_SERVICEMAP.DB_NAME,              TM_SYS_SERVICEMAP.TYPE,              TM_SYS_SERVICEMAP.NAME,              TM_SYS_SERVICEMAP.CLASS,              (TM_SYS_DIC.VALUE + '.' + TM_SYS_SERVICEMAP.CLASS) as CLASSFULL,              TM_SYS_SERVICEMAP.ASSEMBLY,              TM_SYS_SERVER.URL              from TM_SYS_SERVICEMAP              inner join TM_SYS_DIC on TM_SYS_SERVICEMAP.NAMESPACE = TM_SYS_DIC.ID              inner join TM_SYS_SERVER on (TM_SYS_SERVICEMAP.DB_NAME = TM_SYS_SERVER.NAME) and (TM_SYS_SERVER.HOSPITAL_ID = 'HLU01')              where TM_SYS_SERVICEMAP.HOSPITAL_ID = 'HLU01' AND TM_SYS_SERVICEMAP.TYPE = 'S'  AND ACTIVE = '1'              order by URL]
2020-01-02 09:50:30,123 [6] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1']
2020-01-02 09:50:31,801 [6] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM005']
2020-01-02 09:50:33,574 [6] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM015']
2020-01-02 09:50:33,846 [6] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM067']
2020-01-02 09:50:33,961 [6] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM008']
2020-01-02 09:50:34,084 [6] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM068']
2020-01-02 09:50:34,236 [6] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM006']
2020-01-02 09:50:34,397 [6] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM030']
2020-01-02 09:50:34,545 [6] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM025']
2020-01-02 09:50:34,614 [6] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM024']
2020-01-02 09:50:35,631 [6] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM033']
2020-01-02 09:50:35,730 [6] DEBUG - Statement Id: [DAO00027_GetListDuocKyGuiTonKho] PreparedStatement : [select  distinct TT_TONKHO.DUOC_KEY, LTRIM(TT_TONKHO.KHODUOC_ID) as KHODUOC_ID, TM_DUOC.DUOC_ID, TM_LOAIDUOC.MALOAIDUOC,TM_DUOC.SOVISA,TM_DUOC.TYLE_VAT,TM_DUOC.COTOA,        TM_DUOC.MADUOC, TM_DUOC.TENHANG, TM_DUOC.TENDUOCDAYDU, dvt.TENDONVITINH as DONVITINH,  TM_DUOC.DONVITINH_ID,TM_DUOC.BHYT,TM_DUOC.PHAMVI,        TM_DUOC.TENHOATCHAT, TM_DUOC.HAMLUONG, TM_DUOC.HANGSANXUAT, TM_DUOC.QUOCGIA, TM_DUOC.LOAIDUOC_ID, TM_DUOC.DUONGDUNG_ID,        TM_TENDUOC.TENDUOC, TM_TENDUOC.TENDUOC_EN, TM_TENDUOC.MAQUOCTE, TM_TENDUOC.MAQUOCTEBT,        TM_LOAIDUOC.LOAIVATTU_ID, TM_DUOC.BENHVIEN_ID,TT_TONKHO.SOLUONG, TT_TONKHO.NGUONDUOC_ID, NH.TENNGUONDUOC        , TAMNGUNG = CASE WHEN TM_DUOC.TAMNGUNG = '1' OR nh.TAMNGUNG = '1' OR KD.TAMNGUNG = '1' THEN '1' ELSE '0' END        , TM_DUOC.DANGTRINHBAY        from TM_DUOC        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = TM_DUOC.DONVITINH_ID        left join TM_TENDUOC on TM_DUOC.TENDUOC_ID = TM_TENDUOC.TENDUOC_ID and TM_DUOC.BENHVIEN_ID = 'HLU01' and TM_DUOC.TAMNGUNG = '0'        left join TM_LOAIDUOC on TM_LOAIDUOC.LOAIDUOC_ID = TM_DUOC.LOAIDUOC_ID and TM_LOAIDUOC.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG on (TM_LOAIDUOC.LOAIVATTU_ID = TM_DUOC_HANDUNG.LOAIDUOC and TM_DUOC_HANDUNG.BENHVIEN_ID = 'HLU01')        inner join        (select LTRIM(A.KHODUOC_ID) + '_' + LTRIM(A.DUOC_ID) + '_' + LTRIM(ISNULL(A.NGUONDUOC_ID,'')) as DUOC_KEY, A.KHODUOC_ID, A.DUOC_ID,A.NGUONDUOC_ID,        SUM(isnull(A.SOLUONG,0)) as SOLUONG        from        (select SUM(SOLUONG) as SOLUONG, KHODUOC_ID, DUOC_ID, NGUONDUOC_ID from TT_DUOC_KYGUI_TONKHO        where BENHVIEN_ID = 'HLU01' group by KHODUOC_ID, DUOC_ID, NGUONDUOC_ID) A        group by LTRIM(A.KHODUOC_ID) + '_' + LTRIM(A.DUOC_ID) + '_' + LTRIM(A.NGUONDUOC_ID), A.KHODUOC_ID, A.DUOC_ID, A.NGUONDUOC_ID)        TT_TONKHO on TT_TONKHO.DUOC_ID = TM_DUOC.DUOC_ID        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = TT_TONKHO.NGUONDUOC_ID and nh.BENHVIEN_ID = 'HLU01'        LEFT JOIN TM_KHODUOC KD ON KD.KHODUOC_ID = TT_TONKHO.KHODUOC_ID        where TM_DUOC.BENHVIEN_ID = 'HLU01' AND TT_TONKHO.SOLUONG >= 0]
2020-01-02 09:50:35,800 [6] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM018']
2020-01-02 09:50:35,836 [6] DEBUG - Statement Id: [DAO00027_GetListDuocTonKho] PreparedStatement : [select distinct TT_TONKHO.DUOC_KEY, LTRIM(TT_TONKHO.KHODUOC_ID) as KHODUOC_ID, TM_DUOC.DUOC_ID, TM_LOAIDUOC.MALOAIDUOC,TM_DUOC.SOVISA,TM_DUOC.TYLE_VAT,TM_DUOC.COTOA,        TM_DUOC.MADUOC, TM_DUOC.TENHANG, TM_DUOC.TENDUOCDAYDU, dvt.TENDONVITINH as DONVITINH,  TM_DUOC.DONVITINH_ID,TM_DUOC.BHYT,                TM_DUOC.TENHOATCHAT,          TM_DUOC.HAMLUONG, TM_DUOC.HANGSANXUAT, TM_DUOC.QUOCGIA, TM_DUOC.LOAIDUOC_ID, TM_DUOC.DUONGDUNG_ID,        TM_TENDUOC.TENDUOC, TM_TENDUOC.TENDUOC_EN, TM_TENDUOC.MAQUOCTE, TM_TENDUOC.MAQUOCTEBT,        TM_LOAIDUOC.LOAIVATTU_ID, TM_DUOC.BENHVIEN_ID,        TT_TONKHO.SOLUONG, TM_DUOC.VTYT_PHANLOAI, TM_DUOC.PHAMVI, TT_TONKHO.NGUONDUOC_ID, NG.TENNGUONDUOC AS TENNGUONDUOC        , TAMNGUNG = CASE WHEN TM_DUOC.TAMNGUNG = '1' OR NG.TAMNGUNG = '1' OR KD.TAMNGUNG = '1' THEN '1' ELSE '0' END        , TM_DUOC.DANGTRINHBAY        from TM_DUOC        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = TM_DUOC.DONVITINH_ID        left join TM_TENDUOC on TM_DUOC.TENDUOC_ID = TM_TENDUOC.TENDUOC_ID and TM_DUOC.BENHVIEN_ID = 'HLU01' and TM_DUOC.TAMNGUNG = '0'        left join TM_LOAIDUOC on TM_LOAIDUOC.LOAIDUOC_ID = TM_DUOC.LOAIDUOC_ID and TM_LOAIDUOC.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG on (TM_LOAIDUOC.LOAIVATTU_ID = TM_DUOC_HANDUNG.LOAIDUOC and TM_DUOC_HANDUNG.BENHVIEN_ID = 'HLU01')        inner join        (select LTRIM(A.KHODUOC_ID) + '_' + LTRIM(A.DUOC_ID) + '_' + LTRIM(ISNULL(A.NGUONDUOC_ID,'')) as DUOC_KEY, A.KHODUOC_ID, A.DUOC_ID, A.NGUONDUOC_ID,        SUM(isnull(A.SOLUONG,0)) as SOLUONG        from        (select SUM(SOLUONG) as SOLUONG, KHODUOC_ID, DUOC_ID, NGUONDUOC_ID from TT_DUOC_TONKHO        where BENHVIEN_ID = 'HLU01' group by KHODUOC_ID, DUOC_ID, NGUONDUOC_ID) A        group by LTRIM(A.KHODUOC_ID) + '_' + LTRIM(A.DUOC_ID) + '_' + LTRIM(ISNULL(A.NGUONDUOC_ID,'')), A.KHODUOC_ID, A.DUOC_ID, NGUONDUOC_ID        ) TT_TONKHO on TT_TONKHO.DUOC_ID = TM_DUOC.DUOC_ID        LEFT JOIN TM_NGUONHANG NG ON NG.NGUONDUOC_ID = TT_TONKHO.NGUONDUOC_ID        LEFT JOIN TM_KHODUOC KD ON KD.KHODUOC_ID = TT_TONKHO.KHODUOC_ID        where TM_DUOC.BENHVIEN_ID = 'HLU01' and TT_TONKHO.SOLUONG >= 0]
2020-01-02 09:50:36,615 [6] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM023']
2020-01-02 09:50:36,704 [6] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoVaBooking] PreparedStatement : [declare @NGUONDUOC_MACDINH varchar(5) = '0';        declare @TOAMUANGOAI int = 0;        select @NGUONDUOC_MACDINH = isnull(VALUE,0) from TM_SYS_APPSETTINGS where CODE = 'PHA_NGUONDUOC'        select @TOAMUANGOAI = isnull(VALUE,0) from TM_SYS_APPSETTINGS where CODE = 'OPD_TOAMUANGOAI_DUNGDANHMUC_DUOC'                if @TOAMUANGOAI = 1        begin        select  distinct '0' + '_' + LTRIM(d.DUOC_ID) + '_' + @NGUONDUOC_MACDINH as DUOC_KEY, 0 as PHAMVI_ID, @NGUONDUOC_MACDINH as NGUONDUOC_ID, null as TENNGUONDUOC, null as TINHTIEN, d.DUOC_ID, ld.MALOAIDUOC,        d.SOVISA,d.TYLE_VAT,d.COTOA, d.MADUOC, d.TENHANG, d.TENDUOCDAYDU, d.DONVITINH as DONVITINH, d.BHYT,        d.TENHOATCHAT, d.HAMLUONG, d.HANGSANXUAT, d.QUOCGIA, d.LOAIDUOC_ID, d.DUONGDUNG_ID, d.TINHTIEN_PTTT,        ten.TENDUOC, ten.TENDUOC_EN, ten.MAQUOCTE, ten.MAQUOCTEBT,d.CONGDUNG,        '' as BHYT_TEXT        , ld.LOAIVATTU_ID        , d.BENHVIEN_ID,        999999999 as SOLUONG, d.VTYT_PHANLOAI, d.PHAMVI, d.SUASOLUONGTONGHOP, d.MADUOCBV, d.DANGTRINHBAY        , TAMNGUNG = CASE WHEN d.TAMNGUNG = '1' THEN '1' ELSE '0' END        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        union all        select  distinct tk.DUOC_KEY, LTRIM(tk.PHAMVI_ID) as PHAMVI_ID, tk.NGUONDUOC_ID, nh.TENNGUONDUOC, nh.TINHTIEN, d.DUOC_ID, ld.MALOAIDUOC,        d.SOVISA,d.TYLE_VAT,d.COTOA, d.MADUOC, d.TENHANG, d.TENDUOCDAYDU, d.DONVITINH as DONVITINH, d.BHYT,        d.TENHOATCHAT, d.HAMLUONG, d.HANGSANXUAT, d.QUOCGIA, d.LOAIDUOC_ID, d.DUONGDUNG_ID, d.TINHTIEN_PTTT,        ten.TENDUOC, ten.TENDUOC_EN, ten.MAQUOCTE, ten.MAQUOCTEBT,d.CONGDUNG,        CASE WHEN d.BHYT = '1' THEN 'BHYT' ELSE '' END as BHYT_TEXT        , ld.LOAIVATTU_ID        , d.BENHVIEN_ID,        tk.SOLUONG, d.VTYT_PHANLOAI, d.PHAMVI, d.SUASOLUONGTONGHOP, d.MADUOCBV, d.DANGTRINHBAY        , TAMNGUNG = CASE WHEN d.TAMNGUNG = '1' OR nh.TAMNGUNG = '1' OR kd.TAMNGUNG = '1' THEN '1' ELSE '0' END        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        inner join        (        select  LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')) DUOC_KEY, (SUM(dtk.SOLUONG) - isnull(sum(A.SOLUONG),0) - isnull(sum(B.SOLUONG),0)) SOLUONG, pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        from (select sum(soluong) soluong,duoc_id,nguonduoc_id,khoduoc_id,benhvien_id from TT_DUOC_TONKHO  group by duoc_id,nguonduoc_id,khoduoc_id,benhvien_id) dtk        inner join TM_DUOC_PHAMVISD_MAPPING pvsd on dtk.KHODUOC_ID = pvsd.KHODUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NOITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) B on B.DUOC_ID = dtk.DUOC_ID and B.SOLUONG > 0 and B.PHAMVI_ID = pvsd.PHAMVI_ID and B.NGUONHANG_ID = dtk.NGUONDUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NGOAITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) A on A.DUOC_ID = dtk.DUOC_ID and A.SOLUONG > 0 and A.PHAMVI_ID = pvsd.PHAMVI_ID and A.NGUONHANG_ID = dtk.NGUONDUOC_ID        where dtk.SOLUONG > 0 and dtk.BENHVIEN_ID = 'HLU01'        group by LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')), pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        ) tk on tk.DUOC_ID = d.DUOC_ID        left join TM_DUOC_PHAMVISUDUNG kd on kd.PHAMVI_ID = tk.PHAMVI_ID and kd.BENHVIEN_ID = 'HLU01'        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = tk.NGUONDUOC_ID and nh.BENHVIEN_ID = 'HLU01'        where d.BENHVIEN_ID = 'HLU01'  and tk.SOLUONG >= 0        end        else        begin                  select  distinct tk.DUOC_KEY, LTRIM(tk.PHAMVI_ID) as PHAMVI_ID, tk.NGUONDUOC_ID, nh.TENNGUONDUOC, nh.TINHTIEN, d.DUOC_ID, ld.MALOAIDUOC,        d.SOVISA,d.TYLE_VAT,d.COTOA, d.MADUOC, d.TENHANG, d.TENDUOCDAYDU, d.DONVITINH as DONVITINH, d.BHYT,        d.TENHOATCHAT, d.HAMLUONG, d.HANGSANXUAT, d.QUOCGIA, d.LOAIDUOC_ID, d.DUONGDUNG_ID, d.TINHTIEN_PTTT,        ten.TENDUOC, ten.TENDUOC_EN, ten.MAQUOCTE, ten.MAQUOCTEBT,d.CONGDUNG,        CASE WHEN d.BHYT = '1' THEN 'BHYT' ELSE '' END as BHYT_TEXT        , ld.LOAIVATTU_ID        , d.BENHVIEN_ID,        tk.SOLUONG, d.VTYT_PHANLOAI, d.PHAMVI, d.SUASOLUONGTONGHOP, d.MADUOCBV, d.DANGTRINHBAY        , TAMNGUNG = CASE WHEN d.TAMNGUNG = '1' OR nh.TAMNGUNG = '1' OR kd.TAMNGUNG = '1' THEN '1' ELSE '0' END        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        inner join        (        select  LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')) DUOC_KEY, (SUM(dtk.SOLUONG) - isnull(sum(A.SOLUONG),0) - isnull(sum(B.SOLUONG),0)) SOLUONG, pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        from (select sum(soluong) soluong,duoc_id,nguonduoc_id,khoduoc_id,benhvien_id from TT_DUOC_TONKHO  group by duoc_id,nguonduoc_id,khoduoc_id,benhvien_id) dtk        inner join TM_DUOC_PHAMVISD_MAPPING pvsd on dtk.KHODUOC_ID = pvsd.KHODUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NOITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) B on B.DUOC_ID = dtk.DUOC_ID and B.SOLUONG > 0 and B.PHAMVI_ID = pvsd.PHAMVI_ID and B.NGUONHANG_ID = dtk.NGUONDUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NGOAITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) A on A.DUOC_ID = dtk.DUOC_ID and A.SOLUONG > 0 and A.PHAMVI_ID = pvsd.PHAMVI_ID and A.NGUONHANG_ID = dtk.NGUONDUOC_ID        where dtk.SOLUONG > 0 and dtk.BENHVIEN_ID = 'HLU01'        group by LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')), pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        ) tk on tk.DUOC_ID = d.DUOC_ID        left join TM_DUOC_PHAMVISUDUNG kd on kd.PHAMVI_ID = tk.PHAMVI_ID and kd.BENHVIEN_ID = 'HLU01'        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = tk.NGUONDUOC_ID and nh.BENHVIEN_ID = 'HLU01'        where d.BENHVIEN_ID = 'HLU01'  and tk.SOLUONG >= 0        end]
2020-01-02 09:50:39,206 [6] DEBUG - Statement Id: [DAO00320_GetList] PreparedStatement : [select M.*            from TM_MAU M            LEFT JOIN TM_MAU_DONVITINH DVT on M.DONVITINH_ID=DVT.DONVITINH_ID            where            M.TAMNGUNG = '0'            and M.BENHVIEN_ID = 'HLU01'            order by M.TENMAU]
2020-01-02 09:50:39,282 [6] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM071']
2020-01-02 09:50:39,316 [6] DEBUG - Statement Id: [DAO00322_GetListMauTonKhoForCreateCached] PreparedStatement : [SELECT DISTINCT        TK.MAU_KEY, TK.KHOMAU_ID, M.MAU_ID, M.MAMAU, M.TENMAU, M.NHOM_ABO, M.NHOM_RH, M.LOAIMAU_ID,        TK.SOLONHAP_ID, SLN.SOLONHAP, SLN.SOKIEMSOAT, TK.NGUONHANG_ID, NG.TENNGUONMAU, M.BENHVIEN_ID, M.DONVITINH_ID,        SUM(tk.SOLUONG) AS SOLUONG,K.TENKHO,DVT.TENDONVITINH        FROM TT_MAU_TONKHO TK        JOIN TM_KHO K ON TK.KHOMAU_ID = K.KHO_ID        JOIN TT_MAU_CHUNGTU_SOLONHAP SLN ON TK.SOLONHAP_ID = SLN.SOLONHAP_ID        JOIN TM_MAU M on TK.MAU_ID = M.MAU_ID and M.TAMNGUNG = '0'        LEFT JOIN TM_MAU_DONVITINH DVT on M.DONVITINH_ID=DVT.DONVITINH_ID        LEFT JOIN TM_NGUONMAU NG ON NG.NGUONMAU_ID = TK.NGUONHANG_ID        WHERE TK.SOLUONG > 0        GROUP BY TK.MAU_KEY, TK.KHOMAU_ID, M.MAU_ID, M.MAMAU, M.TENMAU, M.NHOM_ABO, M.NHOM_RH, M.LOAIMAU_ID,        TK.SOLONHAP_ID, SLN.SOLONHAP, SLN.SOKIEMSOAT,TK.NGUONHANG_ID, NG.TENNGUONMAU, M.BENHVIEN_ID, M.DONVITINH_ID,K.TENKHO,DVT.TENDONVITINH]
2020-01-02 09:50:39,440 [6] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM073']
2020-01-02 09:50:39,472 [6] DEBUG - Statement Id: [DAO00322_GetListMauTonKhoTruBooking] PreparedStatement : [select distinct        TK.MAU_KEY, TK.KHOMAU_ID, M.MAU_ID, M.MAMAU, M.TENMAU, M.NHOM_ABO, M.NHOM_RH, M.LOAIMAU_ID, M.DONVITINH_ID,        TK.SOLONHAP_ID, TK.SOLONHAP, TK.SOKIEMSOAT,M.PHAMVI, TK.NGUONHANG_ID, NG.TENNGUONMAU, M.BENHVIEN_ID,        TK.SOLUONG,TK.TENKHO,DVT.TENDONVITINH        from TM_MAU M        JOIN        (        select        A.MAU_KEY, A.KHOMAU_ID, A.MAU_ID ,a.NGUONHANG_ID, A.SOLONHAP_ID, A.SOLONHAP, A.SOKIEMSOAT, A.SOLUONG,A.TENKHO        from        (        select KHOMAU_ID, TK.MAU_ID, TK.NGUONHANG_ID, TK.MAU_KEY, SLN.SOLONHAP_ID, SLN.SOLONHAP, SLN.SOKIEMSOAT, ISNULL(TK.SOLUONG,0) - ISNULL(book.SOLUONG,0) as SOLUONG,K.TENKHO        from TT_MAU_TONKHO TK        JOIN TM_KHO K ON TK.KHOMAU_ID = K.KHO_ID        inner join TT_MAU_CHUNGTU_SOLONHAP SLN ON TK.SOLONHAP_ID = SLN.SOLONHAP_ID        left join dbo.TT_MAU_TONKHO_BOOK book ON book.MAU_KEY = TK.MAU_KEY AND book.TRANGTHAI = 'HIEULUC'        where ISNULL(TK.SOLUONG,0) - ISNULL(book.SOLUONG,0) > 0        ) A        )TK on TK.MAU_ID = M.MAU_ID and M.TAMNGUNG = '0'        LEFT JOIN TM_MAU_DONVITINH DVT on M.DONVITINH_ID=DVT.DONVITINH_ID        LEFT JOIN TM_NGUONMAU NG ON NG.NGUONMAU_ID = TK.NGUONHANG_ID]
2020-01-02 09:50:39,706 [6] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM072']
2020-01-02 09:50:40,846 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'MAIN'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2020-01-02 09:50:47,146 [1] DEBUG - Statement Id: [DAO00002_FormList] PreparedStatement : [select              TM_SYS_FORM.HOSPITAL_ID,              TM_SYS_FORM.NAME,              TM_SYS_FORM.CLASS,              TM_SYS_FORM.ASSEMBLY,              TM_SYS_FORM.TITLE_VI as TITLE              from TM_SYS_FORM              where HOSPITAL_ID = 'HLU01']
2020-01-02 09:50:58,824 [1] DEBUG - Statement Id: [DAO00300_GetShortcutListByUserID] PreparedStatement : [SELECT S.SHORTCUT_CODE, S.SHORTCUT_VALUE              FROM TM_SHORTCUT AS S              WHERE S.BENHVIEN_ID = 'HLU01' AND S.USER_ID = '1' AND TAMNGUNG = '0']
2020-01-02 09:50:58,880 [1] DEBUG - Statement Id: [DAO00087_GetList] PreparedStatement : [select CODE, VALUE, BENHVIEN_ID              from TM_SYS_APPSETTINGS              where LOCKED = '0' and BENHVIEN_ID = 'HLU01'              order by SETTING_ID]
2020-01-02 09:50:58,990 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'MSG01'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2020-01-02 09:50:59,177 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'MSG02'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2020-01-02 09:50:59,793 [1] DEBUG - Statement Id: [DAO00008_GetUserSettings] PreparedStatement : [select A.*, B.TENKHO , C.TENPHONGBAN, B.MAKHO, C.MAPHONGBAN          from TM_SYS_USERS A          left join TM_KHODUOC B on B.KHODUOC_ID = A.INVENTORY_ID          left join TM_PHONGBAN C on (C.PHONGBAN_ID = A.WORKING_DEPT_ID and C.BENHVIEN_ID =  @param0 )          left join TM_SYS_USERKHO D on (D.ACCOUNT_ID = A.ACCOUNT_ID and D.HOSPITAL_ID =  @param0 )          where          A.HOSPITAL_ID =  @param0            and                 A.ACCOUNT_ID =  @param1]
2020-01-02 09:50:59,795 [1] DEBUG - Statement Id: [DAO00008_GetUserSettings] Parameters: [@param0=[HOSPITAL_ID,HLU01], @param1=[ACCOUNT_ID,113]]
2020-01-02 09:50:59,795 [1] DEBUG - Statement Id: [DAO00008_GetUserSettings] Types: [@param0=[String, System.String], @param1=[String, System.String]]
2020-01-02 09:50:59,824 [1] DEBUG - Statement Id: [DAO00008_GetUserInvSettings] PreparedStatement : [select A.*, B.TENKHO, B.MAKHO, B.LOAIKHO_ID, B.KHOQUANLY_ID          from TM_SYS_USERKHO A          left join TM_KHO B on B.MODULE_ID = A.MODULE_ID and B.KHO_ID = A.KHO_ID          where A.HOSPITAL_ID =  @param0  and A.ACCOUNT_ID =  @param1           order by B.TENKHO]
2020-01-02 09:50:59,825 [1] DEBUG - Statement Id: [DAO00008_GetUserInvSettings] Parameters: [@param0=[HOSPITAL_ID,HLU01], @param1=[ACCOUNT_ID,113]]
2020-01-02 09:50:59,825 [1] DEBUG - Statement Id: [DAO00008_GetUserInvSettings] Types: [@param0=[String, System.String], @param1=[String, System.String]]
2020-01-02 09:51:00,377 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'COM30'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2020-01-02 09:51:01,167 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'RIS04'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2020-01-02 09:51:28,463 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'MENU1'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2020-01-02 09:51:28,731 [1] DEBUG - Statement Id: [DAO00011_GetList] PreparedStatement : [select              TM_SYS_MENU.ID,              TM_SYS_MENU.PARENTID,              TM_SYS_MENU.SCREEN,              TM_SYS_MENU.SMALLIMAGE,              TM_SYS_MENU.LARGEIMAGE,              TM_SYS_MENU.DESCRIPTION,              TM_SYS_MENU.TYPE,              TM_SYS_MENU.TITLE_VI as TITLE              from TM_SYS_MENU              where TM_SYS_MENU.HOSPITAL_ID = 'HLU01' and TM_SYS_MENU.ACTIVE = '1'               AND                   (TM_SYS_MENU.TYPE & '8' = '8')                             order by TM_SYS_MENU.ORDERNUM]
2020-01-02 09:51:29,190 [1] DEBUG - Statement Id: [DAO00011_usermenu_list] PreparedStatement : [select              TM_SYS_HOMEMENU.MENUID as ID,              TM_SYS_MENU.TITLE_VI as TITLE,              TM_SYS_MENU.SCREEN,              TM_SYS_MENU.SMALLIMAGE,              TM_SYS_MENU.LARGEIMAGE,              TM_SYS_MENU.TYPE              from TM_SYS_HOMEMENU              left join TM_SYS_MENU on TM_SYS_MENU.ID = TM_SYS_HOMEMENU.MENUID and TM_SYS_MENU.HOSPITAL_ID = TM_SYS_HOMEMENU.HOSPITAL_ID              where TM_SYS_HOMEMENU.HOSPITAL_ID = 'HLU01' and TM_SYS_HOMEMENU.USERID = '113' and TM_SYS_MENU.ACTIVE = '1'               AND                   (TM_SYS_MENU.TYPE & '8' = '8')                             ORDER BY TM_SYS_HOMEMENU.ORDERNUM]
2020-01-02 09:52:22,602 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'REG14'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2020-01-02 09:52:25,667 [1] DEBUG - Statement Id: [DAO00012_GetList] PreparedStatement : [select        DICTIONARY_ID,        DICTIONARY_CODE,        DICTIONARY_NAME,        ATTRIBUTE1,        ATTRIBUTE2,        DICTIONARY_NAME_EN        from LST_DICTIONARY        where LST_DICTIONARY.Enabled = '1'         AND           LST_DICTIONARY.DICTIONARY_TYPE_CODE = 'PhanLoaiTiepNhan'                 order by LST_DICTIONARY.IDX]
2020-01-02 09:52:25,725 [1] DEBUG - Statement Id: [DAO00012_GetList] PreparedStatement : [select        DICTIONARY_ID,        DICTIONARY_CODE,        DICTIONARY_NAME,        ATTRIBUTE1,        ATTRIBUTE2,        DICTIONARY_NAME_EN        from LST_DICTIONARY        where LST_DICTIONARY.Enabled = '1'         AND           LST_DICTIONARY.DICTIONARY_TYPE_CODE = 'NguonBN'                 order by LST_DICTIONARY.IDX]
2020-01-02 09:52:25,753 [1] DEBUG - Statement Id: [DAO00019_GetListCongTyChiTra] PreparedStatement : [select *        from TM_CONGTYCHITRA        where        BENHVIEN_ID = 'HLU01' AND TAMNGUNG = '0']
2020-01-02 09:52:26,333 [1] DEBUG - Statement Id: [DAO00017_GetListPhongKham] PreparedStatement : [select pb.PHONGBAN_ID, pb.TENPHONGBAN, case when dv.ATTRIBUTE5 is null then 'TT' else 'KTC' end as LOAI_CHIPHI              from [TM_PHONGBAN_DICHVU] as pb_dv              inner join [TM_PHONGBAN] as pb on pb.PHONGBAN_ID = pb_dv.PHONGBAN_ID and pb.BENHVIEN_ID = 'HLU01'              inner join [TM_DICHVU] dv on dv.DICHVU_ID = pb_dv.DICHVU_ID and dv.MADICHVU = '' and dv.BENHVIEN_ID = 'HLU01'              where pb_dv.BENHVIEN_ID = 'HLU01']
2020-01-02 09:52:26,373 [1] DEBUG - Statement Id: [DAO00019_GetListPhongKham_REG13] PreparedStatement : [select pb.PHONGBAN_ID, pb.TENPHONGBAN, case when dv.ATTRIBUTE5 is null then 'TT' else 'KTC' end as LOAI_CHIPHI        from TM_PHONGBAN pb        left join TM_PHONGBAN_DICHVU pb_dv on pb_dv.PHONGBAN_ID = pb.PHONGBAN_ID and pb_dv.BENHVIEN_ID = pb.BENHVIEN_ID        left join TM_DICHVU dv on dv.DICHVU_ID = pb_dv.DICHVU_ID and dv.BENHVIEN_ID = pb_dv.BENHVIEN_ID        left join TM_NHOMDICHVU ndv on ndv.NHOMDICHVU_ID = dv.NHOMDICHVU_ID and ndv.BENHVIEN_ID = dv.BENHVIEN_ID        where pb.BENHVIEN_ID = 'HLU01' and ndv.MANHOMDICHVU = '04' and dv.DICHVU_ID IS NOT NULL]
2020-01-02 09:52:26,465 [1] DEBUG - Statement Id: [DAO00019_LayThongTinSoluongDichVuPhongKham_REG13] PreparedStatement : [select PHONGBAN_ID, TENPHONGBAN, NOITHUCHIEN_ID, SUM(CHUAKETQUA) AS CHUAKETQUA, SUM(HOANTAT) AS HOANTAT, SUM(DANGTHUCHIEN) AS DANGTHUCHIEN        from (        select B.PHONGBAN_ID, B.TENPHONGBAN, A.NOITHUCHIEN_ID,        case when A.TRANGTHAI = 'CHUAKETQUA' then 1 else 0 end AS CHUAKETQUA,        case when A.TRANGTHAI = 'HOANTAT' then 1 else 0 end AS HOANTAT,        case when A.TRANGTHAI = 'DANGTHUCHIEN' then 1 else 0 end AS DANGTHUCHIEN        from TM_PHONGBAN B        left join TT_DVYEUCAU A on A.NOITHUCHIEN_ID = B.PHONGBAN_ID and A.BENHVIEN_ID = B.BENHVIEN_ID and A.NGAYYEUCAU = CONVERT(date, getdate())        left join TM_DICHVU dv on A.DICHVU_ID = dv.DICHVU_ID        left join TM_NHOMDICHVU ndv on ndv.NHOMDICHVU_ID = dv.NHOMDICHVU_ID        where B.BENHVIEN_ID ='HLU01' and Left(ndv.MANHOMDICHVU,2) = '04'        and B.PHONGBAN_ID in (65,71,72,41,68,62,177,67,55,81,57,57,58,59,60,63,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,61,69,69,70,70)        ) tmp        group by tmp.NOITHUCHIEN_ID, tmp.TENPHONGBAN, tmp.PHONGBAN_ID]
2020-01-02 09:54:10,741 [1] DEBUG - Statement Id: [DAO00087_GetServiceParams] PreparedStatement : [select CODE, VALUE              from TM_SYS_APPSETTINGS              where LOCKED = '0' and BENHVIEN_ID = 'HLU01']
2020-01-02 09:54:10,868 [1] DEBUG - Statement Id: [DAO00095_GetDetailTrungBN] PreparedStatement : [select  TT_TIEPNHAN.NGAYTIEPNHAN AS NGAYTIEPNHAN ,TT_TIEPNHAN.SOBHYT AS SOTHE, TT_BENHNHAN.*, ISNULL(TT_BENHNHAN.NGAYSINH,TT_BENHNHAN.NAMSINH) AS NGAYNAMSINH          from TT_BENHNHAN          left join TT_TIEPNHAN  ON          TT_TIEPNHAN.TIEPNHAN_ID = (SELECT TOP 1 TIEPNHAN_ID FROM TT_TIEPNHAN WHERE BENHNHAN_ID = TT_BENHNHAN.BENHNHAN_ID ORDER BY THOIGIANTIEPNHAN DESC)           WHERE                TT_BENHNHAN.TENBENHNHAN = N'Vương Thị Xám'             AND               convert(varchar(10),TT_BENHNHAN.NGAYSINH, 103) = convert(varchar(10),'01/10/1984', 103)               AND               TT_BENHNHAN.GIOITINH = '2']
2020-01-02 09:55:17,544 [1] DEBUG - Statement Id: [DAO00000_GetKyHieuBHYT] PreparedStatement : [select * from TM_DOITUONG where NHOMTHE LIKE '%' +  @param0  + '%']
2020-01-02 09:55:17,544 [1] DEBUG - Statement Id: [DAO00000_GetKyHieuBHYT] Parameters: [@param0=[MATHEBHYT,DN4]]
2020-01-02 09:55:17,544 [1] DEBUG - Statement Id: [DAO00000_GetKyHieuBHYT] Types: [@param0=[String, System.String]]
2020-01-02 09:55:17,805 [1] DEBUG - Statement Id: [DAO00095_GetDetail] PreparedStatement : [select distinct TT_BENHNHAN.*, ISNULL(TT_BENHNHAN.NGAYSINH, TT_BENHNHAN.NAMSINH) AS NGAYNAMSINH, TN1.SOBHYT AS SOTHE, TN1.NGAYTIEPNHAN          from TT_BENHNHAN          left join (          select MAX(TIEPNHAN_ID) AS TIEPNHAN_ID, BENHNHAN_ID from TT_TIEPNHAN GROUP BY BENHNHAN_ID) TN ON TN.BENHNHAN_ID = TT_BENHNHAN.BENHNHAN_ID          left join TT_TIEPNHAN TN1 ON TN1.TIEPNHAN_ID = TN.TIEPNHAN_ID           WHERE                TN1.SOBHYT = 'DN438381202498038010']
2020-01-02 09:55:42,384 [1] DEBUG - Statement Id: [DAO00000_GetKyHieuBHYT] PreparedStatement : [select * from TM_DOITUONG where NHOMTHE LIKE '%' +  @param0  + '%']
2020-01-02 09:55:42,384 [1] DEBUG - Statement Id: [DAO00000_GetKyHieuBHYT] Parameters: [@param0=[MATHEBHYT,DN4]]
2020-01-02 09:55:42,384 [1] DEBUG - Statement Id: [DAO00000_GetKyHieuBHYT] Types: [@param0=[String, System.String]]
2020-01-02 09:56:17,457 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'REG13'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2020-01-02 09:56:17,643 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'COM98'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2020-01-02 09:56:32,861 [1] DEBUG - Statement Id: [DAO00095_GetDetailTrungBN] PreparedStatement : [select  TT_TIEPNHAN.NGAYTIEPNHAN AS NGAYTIEPNHAN ,TT_TIEPNHAN.SOBHYT AS SOTHE, TT_BENHNHAN.*, ISNULL(TT_BENHNHAN.NGAYSINH,TT_BENHNHAN.NAMSINH) AS NGAYNAMSINH          from TT_BENHNHAN          left join TT_TIEPNHAN  ON          TT_TIEPNHAN.TIEPNHAN_ID = (SELECT TOP 1 TIEPNHAN_ID FROM TT_TIEPNHAN WHERE BENHNHAN_ID = TT_BENHNHAN.BENHNHAN_ID ORDER BY THOIGIANTIEPNHAN DESC)           WHERE                TT_BENHNHAN.TENBENHNHAN = N'Vương Thị Xám'             AND               convert(varchar(10),TT_BENHNHAN.NGAYSINH, 103) = convert(varchar(10),'04/10/1984', 103)               AND               TT_BENHNHAN.GIOITINH = '2']
2020-01-02 09:56:33,782 [1] DEBUG - Statement Id: [DAO00000_GetKyHieuBHYT] PreparedStatement : [select * from TM_DOITUONG where NHOMTHE LIKE '%' +  @param0  + '%']
2020-01-02 09:56:33,782 [1] DEBUG - Statement Id: [DAO00000_GetKyHieuBHYT] Parameters: [@param0=[MATHEBHYT,DN4]]
2020-01-02 09:56:33,782 [1] DEBUG - Statement Id: [DAO00000_GetKyHieuBHYT] Types: [@param0=[String, System.String]]
2020-01-02 09:58:05,596 [1] DEBUG - Statement Id: [DAO00000_GetKyHieuBHYT] PreparedStatement : [select * from TM_DOITUONG where NHOMTHE LIKE '%' +  @param0  + '%']
2020-01-02 09:58:05,596 [1] DEBUG - Statement Id: [DAO00000_GetKyHieuBHYT] Parameters: [@param0=[MATHEBHYT,DN4]]
2020-01-02 09:58:05,596 [1] DEBUG - Statement Id: [DAO00000_GetKyHieuBHYT] Types: [@param0=[String, System.String]]
2020-01-02 09:58:27,016 [1] DEBUG - Statement Id: [DAO00000_GetKyHieuBHYT] PreparedStatement : [select * from TM_DOITUONG where NHOMTHE LIKE '%' +  @param0  + '%']
2020-01-02 09:58:27,016 [1] DEBUG - Statement Id: [DAO00000_GetKyHieuBHYT] Parameters: [@param0=[MATHEBHYT,DN4]]
2020-01-02 09:58:27,016 [1] DEBUG - Statement Id: [DAO00000_GetKyHieuBHYT] Types: [@param0=[String, System.String]]
--------------------------------------------------------------------------------
2020-01-02 10:37:42,388 [1] DEBUG - Statement Id: [DAO00001_DBList] PreparedStatement : [select *              from TM_SYS_SERVER              where HOSPITAL_ID = '_SYSTEM_' and TYPE = 'D']
2020-01-02 10:37:45,044 [1] DEBUG - Statement Id: [DAO00001_DaoList] PreparedStatement : [select              TM_SYS_SERVICEMAP.ID,              TM_SYS_SERVICEMAP.HOSPITAL_ID,              TM_SYS_SERVICEMAP.DB_NAME,              TM_SYS_SERVICEMAP.TYPE,              TM_SYS_SERVICEMAP.NAME,              TM_SYS_SERVICEMAP.CLASS,              (TM_SYS_DIC.VALUE + '.' + TM_SYS_SERVICEMAP.CLASS) as CLASSFULL,              TM_SYS_SERVICEMAP.ASSEMBLY              from TM_SYS_SERVICEMAP              inner join TM_SYS_DIC              on TM_SYS_SERVICEMAP.NAMESPACE = TM_SYS_DIC.ID              where HOSPITAL_ID = '_SYSTEM_' AND TYPE = 'D' AND ACTIVE = '1'              order by DB_NAME]
2020-01-02 10:37:45,326 [1] DEBUG - Statement Id: [DAO00001_ServiceList] PreparedStatement : [select              TM_SYS_SERVICEMAP.ID,              TM_SYS_SERVICEMAP.HOSPITAL_ID,              TM_SYS_SERVICEMAP.DB_NAME,              TM_SYS_SERVICEMAP.TYPE,              TM_SYS_SERVICEMAP.NAME,              TM_SYS_SERVICEMAP.CLASS,              (TM_SYS_DIC.VALUE + '.' + TM_SYS_SERVICEMAP.CLASS) as CLASSFULL,              TM_SYS_SERVICEMAP.ASSEMBLY,              TM_SYS_SERVER.URL              from TM_SYS_SERVICEMAP              inner join TM_SYS_DIC on TM_SYS_SERVICEMAP.NAMESPACE = TM_SYS_DIC.ID              inner join TM_SYS_SERVER on (TM_SYS_SERVICEMAP.DB_NAME = TM_SYS_SERVER.NAME) and (TM_SYS_SERVER.HOSPITAL_ID = '_SYSTEM_')              where TM_SYS_SERVICEMAP.HOSPITAL_ID = '_SYSTEM_' AND TM_SYS_SERVICEMAP.TYPE = 'S'  AND ACTIVE = '1'              order by URL]
2020-01-02 10:37:46,191 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = '_SYSTEM_'               AND                   TM_SYS_SCREEN.PAGE = 'LOGIN'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2020-01-02 10:37:46,817 [1] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = '_SYSTEM_'               AND                   TM_SYS_CACHE.ACTIVE = '1']
2020-01-02 10:38:29,154 [1] DEBUG - Statement Id: [DAO00001_DBList] PreparedStatement : [select *              from TM_SYS_SERVER              where HOSPITAL_ID = 'HLU01' and TYPE = 'D']
2020-01-02 10:38:29,181 [1] DEBUG - Statement Id: [DAO00001_DaoList] PreparedStatement : [select              TM_SYS_SERVICEMAP.ID,              TM_SYS_SERVICEMAP.HOSPITAL_ID,              TM_SYS_SERVICEMAP.DB_NAME,              TM_SYS_SERVICEMAP.TYPE,              TM_SYS_SERVICEMAP.NAME,              TM_SYS_SERVICEMAP.CLASS,              (TM_SYS_DIC.VALUE + '.' + TM_SYS_SERVICEMAP.CLASS) as CLASSFULL,              TM_SYS_SERVICEMAP.ASSEMBLY              from TM_SYS_SERVICEMAP              inner join TM_SYS_DIC              on TM_SYS_SERVICEMAP.NAMESPACE = TM_SYS_DIC.ID              where HOSPITAL_ID = 'HLU01' AND TYPE = 'D' AND ACTIVE = '1'              order by DB_NAME]
2020-01-02 10:38:31,030 [1] DEBUG - Statement Id: [DAO00001_ServiceList] PreparedStatement : [select              TM_SYS_SERVICEMAP.ID,              TM_SYS_SERVICEMAP.HOSPITAL_ID,              TM_SYS_SERVICEMAP.DB_NAME,              TM_SYS_SERVICEMAP.TYPE,              TM_SYS_SERVICEMAP.NAME,              TM_SYS_SERVICEMAP.CLASS,              (TM_SYS_DIC.VALUE + '.' + TM_SYS_SERVICEMAP.CLASS) as CLASSFULL,              TM_SYS_SERVICEMAP.ASSEMBLY,              TM_SYS_SERVER.URL              from TM_SYS_SERVICEMAP              inner join TM_SYS_DIC on TM_SYS_SERVICEMAP.NAMESPACE = TM_SYS_DIC.ID              inner join TM_SYS_SERVER on (TM_SYS_SERVICEMAP.DB_NAME = TM_SYS_SERVER.NAME) and (TM_SYS_SERVER.HOSPITAL_ID = 'HLU01')              where TM_SYS_SERVICEMAP.HOSPITAL_ID = 'HLU01' AND TM_SYS_SERVICEMAP.TYPE = 'S'  AND ACTIVE = '1'              order by URL]
2020-01-02 10:38:31,127 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1']
2020-01-02 10:38:31,960 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM005']
2020-01-02 10:38:32,390 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM015']
2020-01-02 10:38:32,468 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM067']
2020-01-02 10:38:32,585 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM008']
2020-01-02 10:38:32,694 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM068']
2020-01-02 10:38:32,779 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM006']
2020-01-02 10:38:33,032 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM030']
2020-01-02 10:38:33,110 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM025']
2020-01-02 10:38:33,193 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM024']
2020-01-02 10:38:33,724 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM033']
2020-01-02 10:38:33,766 [5] DEBUG - Statement Id: [DAO00027_GetListDuocKyGuiTonKho] PreparedStatement : [select  distinct TT_TONKHO.DUOC_KEY, LTRIM(TT_TONKHO.KHODUOC_ID) as KHODUOC_ID, TM_DUOC.DUOC_ID, TM_LOAIDUOC.MALOAIDUOC,TM_DUOC.SOVISA,TM_DUOC.TYLE_VAT,TM_DUOC.COTOA,        TM_DUOC.MADUOC, TM_DUOC.TENHANG, TM_DUOC.TENDUOCDAYDU, dvt.TENDONVITINH as DONVITINH,  TM_DUOC.DONVITINH_ID,TM_DUOC.BHYT,TM_DUOC.PHAMVI,        TM_DUOC.TENHOATCHAT, TM_DUOC.HAMLUONG, TM_DUOC.HANGSANXUAT, TM_DUOC.QUOCGIA, TM_DUOC.LOAIDUOC_ID, TM_DUOC.DUONGDUNG_ID,        TM_TENDUOC.TENDUOC, TM_TENDUOC.TENDUOC_EN, TM_TENDUOC.MAQUOCTE, TM_TENDUOC.MAQUOCTEBT,        TM_LOAIDUOC.LOAIVATTU_ID, TM_DUOC.BENHVIEN_ID,TT_TONKHO.SOLUONG, TT_TONKHO.NGUONDUOC_ID, NH.TENNGUONDUOC        , TAMNGUNG = CASE WHEN TM_DUOC.TAMNGUNG = '1' OR nh.TAMNGUNG = '1' OR KD.TAMNGUNG = '1' THEN '1' ELSE '0' END        , TM_DUOC.DANGTRINHBAY        from TM_DUOC        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = TM_DUOC.DONVITINH_ID        left join TM_TENDUOC on TM_DUOC.TENDUOC_ID = TM_TENDUOC.TENDUOC_ID and TM_DUOC.BENHVIEN_ID = 'HLU01' and TM_DUOC.TAMNGUNG = '0'        left join TM_LOAIDUOC on TM_LOAIDUOC.LOAIDUOC_ID = TM_DUOC.LOAIDUOC_ID and TM_LOAIDUOC.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG on (TM_LOAIDUOC.LOAIVATTU_ID = TM_DUOC_HANDUNG.LOAIDUOC and TM_DUOC_HANDUNG.BENHVIEN_ID = 'HLU01')        inner join        (select LTRIM(A.KHODUOC_ID) + '_' + LTRIM(A.DUOC_ID) + '_' + LTRIM(ISNULL(A.NGUONDUOC_ID,'')) as DUOC_KEY, A.KHODUOC_ID, A.DUOC_ID,A.NGUONDUOC_ID,        SUM(isnull(A.SOLUONG,0)) as SOLUONG        from        (select SUM(SOLUONG) as SOLUONG, KHODUOC_ID, DUOC_ID, NGUONDUOC_ID from TT_DUOC_KYGUI_TONKHO        where BENHVIEN_ID = 'HLU01' group by KHODUOC_ID, DUOC_ID, NGUONDUOC_ID) A        group by LTRIM(A.KHODUOC_ID) + '_' + LTRIM(A.DUOC_ID) + '_' + LTRIM(A.NGUONDUOC_ID), A.KHODUOC_ID, A.DUOC_ID, A.NGUONDUOC_ID)        TT_TONKHO on TT_TONKHO.DUOC_ID = TM_DUOC.DUOC_ID        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = TT_TONKHO.NGUONDUOC_ID and nh.BENHVIEN_ID = 'HLU01'        LEFT JOIN TM_KHODUOC KD ON KD.KHODUOC_ID = TT_TONKHO.KHODUOC_ID        where TM_DUOC.BENHVIEN_ID = 'HLU01' AND TT_TONKHO.SOLUONG >= 0]
2020-01-02 10:38:33,883 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM018']
2020-01-02 10:38:33,942 [5] DEBUG - Statement Id: [DAO00027_GetListDuocTonKho] PreparedStatement : [select distinct TT_TONKHO.DUOC_KEY, LTRIM(TT_TONKHO.KHODUOC_ID) as KHODUOC_ID, TM_DUOC.DUOC_ID, TM_LOAIDUOC.MALOAIDUOC,TM_DUOC.SOVISA,TM_DUOC.TYLE_VAT,TM_DUOC.COTOA,        TM_DUOC.MADUOC, TM_DUOC.TENHANG, TM_DUOC.TENDUOCDAYDU, dvt.TENDONVITINH as DONVITINH,  TM_DUOC.DONVITINH_ID,TM_DUOC.BHYT,                TM_DUOC.TENHOATCHAT,          TM_DUOC.HAMLUONG, TM_DUOC.HANGSANXUAT, TM_DUOC.QUOCGIA, TM_DUOC.LOAIDUOC_ID, TM_DUOC.DUONGDUNG_ID,        TM_TENDUOC.TENDUOC, TM_TENDUOC.TENDUOC_EN, TM_TENDUOC.MAQUOCTE, TM_TENDUOC.MAQUOCTEBT,        TM_LOAIDUOC.LOAIVATTU_ID, TM_DUOC.BENHVIEN_ID,        TT_TONKHO.SOLUONG, TM_DUOC.VTYT_PHANLOAI, TM_DUOC.PHAMVI, TT_TONKHO.NGUONDUOC_ID, NG.TENNGUONDUOC AS TENNGUONDUOC        , TAMNGUNG = CASE WHEN TM_DUOC.TAMNGUNG = '1' OR NG.TAMNGUNG = '1' OR KD.TAMNGUNG = '1' THEN '1' ELSE '0' END        , TM_DUOC.DANGTRINHBAY        from TM_DUOC        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = TM_DUOC.DONVITINH_ID        left join TM_TENDUOC on TM_DUOC.TENDUOC_ID = TM_TENDUOC.TENDUOC_ID and TM_DUOC.BENHVIEN_ID = 'HLU01' and TM_DUOC.TAMNGUNG = '0'        left join TM_LOAIDUOC on TM_LOAIDUOC.LOAIDUOC_ID = TM_DUOC.LOAIDUOC_ID and TM_LOAIDUOC.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG on (TM_LOAIDUOC.LOAIVATTU_ID = TM_DUOC_HANDUNG.LOAIDUOC and TM_DUOC_HANDUNG.BENHVIEN_ID = 'HLU01')        inner join        (select LTRIM(A.KHODUOC_ID) + '_' + LTRIM(A.DUOC_ID) + '_' + LTRIM(ISNULL(A.NGUONDUOC_ID,'')) as DUOC_KEY, A.KHODUOC_ID, A.DUOC_ID, A.NGUONDUOC_ID,        SUM(isnull(A.SOLUONG,0)) as SOLUONG        from        (select SUM(SOLUONG) as SOLUONG, KHODUOC_ID, DUOC_ID, NGUONDUOC_ID from TT_DUOC_TONKHO        where BENHVIEN_ID = 'HLU01' group by KHODUOC_ID, DUOC_ID, NGUONDUOC_ID) A        group by LTRIM(A.KHODUOC_ID) + '_' + LTRIM(A.DUOC_ID) + '_' + LTRIM(ISNULL(A.NGUONDUOC_ID,'')), A.KHODUOC_ID, A.DUOC_ID, NGUONDUOC_ID        ) TT_TONKHO on TT_TONKHO.DUOC_ID = TM_DUOC.DUOC_ID        LEFT JOIN TM_NGUONHANG NG ON NG.NGUONDUOC_ID = TT_TONKHO.NGUONDUOC_ID        LEFT JOIN TM_KHODUOC KD ON KD.KHODUOC_ID = TT_TONKHO.KHODUOC_ID        where TM_DUOC.BENHVIEN_ID = 'HLU01' and TT_TONKHO.SOLUONG >= 0]
2020-01-02 10:38:34,910 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM023']
2020-01-02 10:38:34,945 [5] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoVaBooking] PreparedStatement : [declare @NGUONDUOC_MACDINH varchar(5) = '0';        declare @TOAMUANGOAI int = 0;        select @NGUONDUOC_MACDINH = isnull(VALUE,0) from TM_SYS_APPSETTINGS where CODE = 'PHA_NGUONDUOC'        select @TOAMUANGOAI = isnull(VALUE,0) from TM_SYS_APPSETTINGS where CODE = 'OPD_TOAMUANGOAI_DUNGDANHMUC_DUOC'                if @TOAMUANGOAI = 1        begin        select  distinct '0' + '_' + LTRIM(d.DUOC_ID) + '_' + @NGUONDUOC_MACDINH as DUOC_KEY, 0 as PHAMVI_ID, @NGUONDUOC_MACDINH as NGUONDUOC_ID, null as TENNGUONDUOC, null as TINHTIEN, d.DUOC_ID, ld.MALOAIDUOC,        d.SOVISA,d.TYLE_VAT,d.COTOA, d.MADUOC, d.TENHANG, d.TENDUOCDAYDU, d.DONVITINH as DONVITINH, d.BHYT,        d.TENHOATCHAT, d.HAMLUONG, d.HANGSANXUAT, d.QUOCGIA, d.LOAIDUOC_ID, d.DUONGDUNG_ID, d.TINHTIEN_PTTT,        ten.TENDUOC, ten.TENDUOC_EN, ten.MAQUOCTE, ten.MAQUOCTEBT,d.CONGDUNG,        '' as BHYT_TEXT        , ld.LOAIVATTU_ID        , d.BENHVIEN_ID,        999999999 as SOLUONG, d.VTYT_PHANLOAI, d.PHAMVI, d.SUASOLUONGTONGHOP, d.MADUOCBV, d.DANGTRINHBAY        , TAMNGUNG = CASE WHEN d.TAMNGUNG = '1' THEN '1' ELSE '0' END        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        union all        select  distinct tk.DUOC_KEY, LTRIM(tk.PHAMVI_ID) as PHAMVI_ID, tk.NGUONDUOC_ID, nh.TENNGUONDUOC, nh.TINHTIEN, d.DUOC_ID, ld.MALOAIDUOC,        d.SOVISA,d.TYLE_VAT,d.COTOA, d.MADUOC, d.TENHANG, d.TENDUOCDAYDU, d.DONVITINH as DONVITINH, d.BHYT,        d.TENHOATCHAT, d.HAMLUONG, d.HANGSANXUAT, d.QUOCGIA, d.LOAIDUOC_ID, d.DUONGDUNG_ID, d.TINHTIEN_PTTT,        ten.TENDUOC, ten.TENDUOC_EN, ten.MAQUOCTE, ten.MAQUOCTEBT,d.CONGDUNG,        CASE WHEN d.BHYT = '1' THEN 'BHYT' ELSE '' END as BHYT_TEXT        , ld.LOAIVATTU_ID        , d.BENHVIEN_ID,        tk.SOLUONG, d.VTYT_PHANLOAI, d.PHAMVI, d.SUASOLUONGTONGHOP, d.MADUOCBV, d.DANGTRINHBAY        , TAMNGUNG = CASE WHEN d.TAMNGUNG = '1' OR nh.TAMNGUNG = '1' OR kd.TAMNGUNG = '1' THEN '1' ELSE '0' END        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        inner join        (        select  LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')) DUOC_KEY, (SUM(dtk.SOLUONG) - isnull(sum(A.SOLUONG),0) - isnull(sum(B.SOLUONG),0)) SOLUONG, pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        from (select sum(soluong) soluong,duoc_id,nguonduoc_id,khoduoc_id,benhvien_id from TT_DUOC_TONKHO  group by duoc_id,nguonduoc_id,khoduoc_id,benhvien_id) dtk        inner join TM_DUOC_PHAMVISD_MAPPING pvsd on dtk.KHODUOC_ID = pvsd.KHODUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NOITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) B on B.DUOC_ID = dtk.DUOC_ID and B.SOLUONG > 0 and B.PHAMVI_ID = pvsd.PHAMVI_ID and B.NGUONHANG_ID = dtk.NGUONDUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NGOAITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) A on A.DUOC_ID = dtk.DUOC_ID and A.SOLUONG > 0 and A.PHAMVI_ID = pvsd.PHAMVI_ID and A.NGUONHANG_ID = dtk.NGUONDUOC_ID        where dtk.SOLUONG > 0 and dtk.BENHVIEN_ID = 'HLU01'        group by LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')), pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        ) tk on tk.DUOC_ID = d.DUOC_ID        left join TM_DUOC_PHAMVISUDUNG kd on kd.PHAMVI_ID = tk.PHAMVI_ID and kd.BENHVIEN_ID = 'HLU01'        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = tk.NGUONDUOC_ID and nh.BENHVIEN_ID = 'HLU01'        where d.BENHVIEN_ID = 'HLU01'  and tk.SOLUONG >= 0        end        else        begin                  select  distinct tk.DUOC_KEY, LTRIM(tk.PHAMVI_ID) as PHAMVI_ID, tk.NGUONDUOC_ID, nh.TENNGUONDUOC, nh.TINHTIEN, d.DUOC_ID, ld.MALOAIDUOC,        d.SOVISA,d.TYLE_VAT,d.COTOA, d.MADUOC, d.TENHANG, d.TENDUOCDAYDU, d.DONVITINH as DONVITINH, d.BHYT,        d.TENHOATCHAT, d.HAMLUONG, d.HANGSANXUAT, d.QUOCGIA, d.LOAIDUOC_ID, d.DUONGDUNG_ID, d.TINHTIEN_PTTT,        ten.TENDUOC, ten.TENDUOC_EN, ten.MAQUOCTE, ten.MAQUOCTEBT,d.CONGDUNG,        CASE WHEN d.BHYT = '1' THEN 'BHYT' ELSE '' END as BHYT_TEXT        , ld.LOAIVATTU_ID        , d.BENHVIEN_ID,        tk.SOLUONG, d.VTYT_PHANLOAI, d.PHAMVI, d.SUASOLUONGTONGHOP, d.MADUOCBV, d.DANGTRINHBAY        , TAMNGUNG = CASE WHEN d.TAMNGUNG = '1' OR nh.TAMNGUNG = '1' OR kd.TAMNGUNG = '1' THEN '1' ELSE '0' END        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        inner join        (        select  LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')) DUOC_KEY, (SUM(dtk.SOLUONG) - isnull(sum(A.SOLUONG),0) - isnull(sum(B.SOLUONG),0)) SOLUONG, pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        from (select sum(soluong) soluong,duoc_id,nguonduoc_id,khoduoc_id,benhvien_id from TT_DUOC_TONKHO  group by duoc_id,nguonduoc_id,khoduoc_id,benhvien_id) dtk        inner join TM_DUOC_PHAMVISD_MAPPING pvsd on dtk.KHODUOC_ID = pvsd.KHODUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NOITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) B on B.DUOC_ID = dtk.DUOC_ID and B.SOLUONG > 0 and B.PHAMVI_ID = pvsd.PHAMVI_ID and B.NGUONHANG_ID = dtk.NGUONDUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NGOAITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) A on A.DUOC_ID = dtk.DUOC_ID and A.SOLUONG > 0 and A.PHAMVI_ID = pvsd.PHAMVI_ID and A.NGUONHANG_ID = dtk.NGUONDUOC_ID        where dtk.SOLUONG > 0 and dtk.BENHVIEN_ID = 'HLU01'        group by LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')), pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        ) tk on tk.DUOC_ID = d.DUOC_ID        left join TM_DUOC_PHAMVISUDUNG kd on kd.PHAMVI_ID = tk.PHAMVI_ID and kd.BENHVIEN_ID = 'HLU01'        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = tk.NGUONDUOC_ID and nh.BENHVIEN_ID = 'HLU01'        where d.BENHVIEN_ID = 'HLU01'  and tk.SOLUONG >= 0        end]
2020-01-02 10:38:37,442 [5] DEBUG - Statement Id: [DAO00320_GetList] PreparedStatement : [select M.*            from TM_MAU M            LEFT JOIN TM_MAU_DONVITINH DVT on M.DONVITINH_ID=DVT.DONVITINH_ID            where            M.TAMNGUNG = '0'            and M.BENHVIEN_ID = 'HLU01'            order by M.TENMAU]
2020-01-02 10:38:37,510 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM071']
2020-01-02 10:38:37,542 [5] DEBUG - Statement Id: [DAO00322_GetListMauTonKhoForCreateCached] PreparedStatement : [SELECT DISTINCT        TK.MAU_KEY, TK.KHOMAU_ID, M.MAU_ID, M.MAMAU, M.TENMAU, M.NHOM_ABO, M.NHOM_RH, M.LOAIMAU_ID,        TK.SOLONHAP_ID, SLN.SOLONHAP, SLN.SOKIEMSOAT, TK.NGUONHANG_ID, NG.TENNGUONMAU, M.BENHVIEN_ID, M.DONVITINH_ID,        SUM(tk.SOLUONG) AS SOLUONG,K.TENKHO,DVT.TENDONVITINH        FROM TT_MAU_TONKHO TK        JOIN TM_KHO K ON TK.KHOMAU_ID = K.KHO_ID        JOIN TT_MAU_CHUNGTU_SOLONHAP SLN ON TK.SOLONHAP_ID = SLN.SOLONHAP_ID        JOIN TM_MAU M on TK.MAU_ID = M.MAU_ID and M.TAMNGUNG = '0'        LEFT JOIN TM_MAU_DONVITINH DVT on M.DONVITINH_ID=DVT.DONVITINH_ID        LEFT JOIN TM_NGUONMAU NG ON NG.NGUONMAU_ID = TK.NGUONHANG_ID        WHERE TK.SOLUONG > 0        GROUP BY TK.MAU_KEY, TK.KHOMAU_ID, M.MAU_ID, M.MAMAU, M.TENMAU, M.NHOM_ABO, M.NHOM_RH, M.LOAIMAU_ID,        TK.SOLONHAP_ID, SLN.SOLONHAP, SLN.SOKIEMSOAT,TK.NGUONHANG_ID, NG.TENNGUONMAU, M.BENHVIEN_ID, M.DONVITINH_ID,K.TENKHO,DVT.TENDONVITINH]
2020-01-02 10:38:37,616 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM073']
2020-01-02 10:38:37,648 [5] DEBUG - Statement Id: [DAO00322_GetListMauTonKhoTruBooking] PreparedStatement : [select distinct        TK.MAU_KEY, TK.KHOMAU_ID, M.MAU_ID, M.MAMAU, M.TENMAU, M.NHOM_ABO, M.NHOM_RH, M.LOAIMAU_ID, M.DONVITINH_ID,        TK.SOLONHAP_ID, TK.SOLONHAP, TK.SOKIEMSOAT,M.PHAMVI, TK.NGUONHANG_ID, NG.TENNGUONMAU, M.BENHVIEN_ID,        TK.SOLUONG,TK.TENKHO,DVT.TENDONVITINH        from TM_MAU M        JOIN        (        select        A.MAU_KEY, A.KHOMAU_ID, A.MAU_ID ,a.NGUONHANG_ID, A.SOLONHAP_ID, A.SOLONHAP, A.SOKIEMSOAT, A.SOLUONG,A.TENKHO        from        (        select KHOMAU_ID, TK.MAU_ID, TK.NGUONHANG_ID, TK.MAU_KEY, SLN.SOLONHAP_ID, SLN.SOLONHAP, SLN.SOKIEMSOAT, ISNULL(TK.SOLUONG,0) - ISNULL(book.SOLUONG,0) as SOLUONG,K.TENKHO        from TT_MAU_TONKHO TK        JOIN TM_KHO K ON TK.KHOMAU_ID = K.KHO_ID        inner join TT_MAU_CHUNGTU_SOLONHAP SLN ON TK.SOLONHAP_ID = SLN.SOLONHAP_ID        left join dbo.TT_MAU_TONKHO_BOOK book ON book.MAU_KEY = TK.MAU_KEY AND book.TRANGTHAI = 'HIEULUC'        where ISNULL(TK.SOLUONG,0) - ISNULL(book.SOLUONG,0) > 0        ) A        )TK on TK.MAU_ID = M.MAU_ID and M.TAMNGUNG = '0'        LEFT JOIN TM_MAU_DONVITINH DVT on M.DONVITINH_ID=DVT.DONVITINH_ID        LEFT JOIN TM_NGUONMAU NG ON NG.NGUONMAU_ID = TK.NGUONHANG_ID]
2020-01-02 10:38:37,726 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM072']
2020-01-02 10:38:38,664 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'MAIN'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2020-01-02 10:38:39,734 [1] DEBUG - Statement Id: [DAO00002_FormList] PreparedStatement : [select              TM_SYS_FORM.HOSPITAL_ID,              TM_SYS_FORM.NAME,              TM_SYS_FORM.CLASS,              TM_SYS_FORM.ASSEMBLY,              TM_SYS_FORM.TITLE_VI as TITLE              from TM_SYS_FORM              where HOSPITAL_ID = 'HLU01']
2020-01-02 10:38:45,057 [1] DEBUG - Statement Id: [DAO00300_GetShortcutListByUserID] PreparedStatement : [SELECT S.SHORTCUT_CODE, S.SHORTCUT_VALUE              FROM TM_SHORTCUT AS S              WHERE S.BENHVIEN_ID = 'HLU01' AND S.USER_ID = '1' AND TAMNGUNG = '0']
2020-01-02 10:38:45,087 [1] DEBUG - Statement Id: [DAO00087_GetList] PreparedStatement : [select CODE, VALUE, BENHVIEN_ID              from TM_SYS_APPSETTINGS              where LOCKED = '0' and BENHVIEN_ID = 'HLU01'              order by SETTING_ID]
2020-01-02 10:38:45,172 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'MSG01'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2020-01-02 10:38:45,327 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'MSG02'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2020-01-02 10:38:45,624 [1] DEBUG - Statement Id: [DAO00008_GetUserSettings] PreparedStatement : [select A.*, B.TENKHO , C.TENPHONGBAN, B.MAKHO, C.MAPHONGBAN          from TM_SYS_USERS A          left join TM_KHODUOC B on B.KHODUOC_ID = A.INVENTORY_ID          left join TM_PHONGBAN C on (C.PHONGBAN_ID = A.WORKING_DEPT_ID and C.BENHVIEN_ID =  @param0 )          left join TM_SYS_USERKHO D on (D.ACCOUNT_ID = A.ACCOUNT_ID and D.HOSPITAL_ID =  @param0 )          where          A.HOSPITAL_ID =  @param0            and                 A.ACCOUNT_ID =  @param1]
2020-01-02 10:38:45,626 [1] DEBUG - Statement Id: [DAO00008_GetUserSettings] Parameters: [@param0=[HOSPITAL_ID,HLU01], @param1=[ACCOUNT_ID,113]]
2020-01-02 10:38:45,626 [1] DEBUG - Statement Id: [DAO00008_GetUserSettings] Types: [@param0=[String, System.String], @param1=[String, System.String]]
2020-01-02 10:38:45,656 [1] DEBUG - Statement Id: [DAO00008_GetUserInvSettings] PreparedStatement : [select A.*, B.TENKHO, B.MAKHO, B.LOAIKHO_ID, B.KHOQUANLY_ID          from TM_SYS_USERKHO A          left join TM_KHO B on B.MODULE_ID = A.MODULE_ID and B.KHO_ID = A.KHO_ID          where A.HOSPITAL_ID =  @param0  and A.ACCOUNT_ID =  @param1           order by B.TENKHO]
2020-01-02 10:38:45,657 [1] DEBUG - Statement Id: [DAO00008_GetUserInvSettings] Parameters: [@param0=[HOSPITAL_ID,HLU01], @param1=[ACCOUNT_ID,113]]
2020-01-02 10:38:45,657 [1] DEBUG - Statement Id: [DAO00008_GetUserInvSettings] Types: [@param0=[String, System.String], @param1=[String, System.String]]
2020-01-02 10:38:45,833 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'COM30'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2020-01-02 10:38:46,060 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'RIS04'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2020-01-02 10:39:03,200 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'MENU1'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2020-01-02 10:39:03,311 [1] DEBUG - Statement Id: [DAO00011_GetList] PreparedStatement : [select              TM_SYS_MENU.ID,              TM_SYS_MENU.PARENTID,              TM_SYS_MENU.SCREEN,              TM_SYS_MENU.SMALLIMAGE,              TM_SYS_MENU.LARGEIMAGE,              TM_SYS_MENU.DESCRIPTION,              TM_SYS_MENU.TYPE,              TM_SYS_MENU.TITLE_VI as TITLE              from TM_SYS_MENU              where TM_SYS_MENU.HOSPITAL_ID = 'HLU01' and TM_SYS_MENU.ACTIVE = '1'               AND                   (TM_SYS_MENU.TYPE & '8' = '8')                             order by TM_SYS_MENU.ORDERNUM]
2020-01-02 10:39:03,853 [1] DEBUG - Statement Id: [DAO00011_usermenu_list] PreparedStatement : [select              TM_SYS_HOMEMENU.MENUID as ID,              TM_SYS_MENU.TITLE_VI as TITLE,              TM_SYS_MENU.SCREEN,              TM_SYS_MENU.SMALLIMAGE,              TM_SYS_MENU.LARGEIMAGE,              TM_SYS_MENU.TYPE              from TM_SYS_HOMEMENU              left join TM_SYS_MENU on TM_SYS_MENU.ID = TM_SYS_HOMEMENU.MENUID and TM_SYS_MENU.HOSPITAL_ID = TM_SYS_HOMEMENU.HOSPITAL_ID              where TM_SYS_HOMEMENU.HOSPITAL_ID = 'HLU01' and TM_SYS_HOMEMENU.USERID = '113' and TM_SYS_MENU.ACTIVE = '1'               AND                   (TM_SYS_MENU.TYPE & '8' = '8')                             ORDER BY TM_SYS_HOMEMENU.ORDERNUM]
2020-01-02 10:44:55,462 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'REG14'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2020-01-02 10:44:56,847 [1] DEBUG - Statement Id: [DAO00012_GetList] PreparedStatement : [select        DICTIONARY_ID,        DICTIONARY_CODE,        DICTIONARY_NAME,        ATTRIBUTE1,        ATTRIBUTE2,        DICTIONARY_NAME_EN        from LST_DICTIONARY        where LST_DICTIONARY.Enabled = '1'         AND           LST_DICTIONARY.DICTIONARY_TYPE_CODE = 'PhanLoaiTiepNhan'                 order by LST_DICTIONARY.IDX]
2020-01-02 10:44:56,971 [1] DEBUG - Statement Id: [DAO00012_GetList] PreparedStatement : [select        DICTIONARY_ID,        DICTIONARY_CODE,        DICTIONARY_NAME,        ATTRIBUTE1,        ATTRIBUTE2,        DICTIONARY_NAME_EN        from LST_DICTIONARY        where LST_DICTIONARY.Enabled = '1'         AND           LST_DICTIONARY.DICTIONARY_TYPE_CODE = 'NguonBN'                 order by LST_DICTIONARY.IDX]
2020-01-02 10:44:56,999 [1] DEBUG - Statement Id: [DAO00019_GetListCongTyChiTra] PreparedStatement : [select *        from TM_CONGTYCHITRA        where        BENHVIEN_ID = 'HLU01' AND TAMNGUNG = '0']
2020-01-02 10:44:57,209 [1] DEBUG - Statement Id: [DAO00017_GetListPhongKham] PreparedStatement : [select pb.PHONGBAN_ID, pb.TENPHONGBAN, case when dv.ATTRIBUTE5 is null then 'TT' else 'KTC' end as LOAI_CHIPHI              from [TM_PHONGBAN_DICHVU] as pb_dv              inner join [TM_PHONGBAN] as pb on pb.PHONGBAN_ID = pb_dv.PHONGBAN_ID and pb.BENHVIEN_ID = 'HLU01'              inner join [TM_DICHVU] dv on dv.DICHVU_ID = pb_dv.DICHVU_ID and dv.MADICHVU = '' and dv.BENHVIEN_ID = 'HLU01'              where pb_dv.BENHVIEN_ID = 'HLU01']
2020-01-02 10:44:57,251 [1] DEBUG - Statement Id: [DAO00019_GetListPhongKham_REG13] PreparedStatement : [select pb.PHONGBAN_ID, pb.TENPHONGBAN, case when dv.ATTRIBUTE5 is null then 'TT' else 'KTC' end as LOAI_CHIPHI        from TM_PHONGBAN pb        left join TM_PHONGBAN_DICHVU pb_dv on pb_dv.PHONGBAN_ID = pb.PHONGBAN_ID and pb_dv.BENHVIEN_ID = pb.BENHVIEN_ID        left join TM_DICHVU dv on dv.DICHVU_ID = pb_dv.DICHVU_ID and dv.BENHVIEN_ID = pb_dv.BENHVIEN_ID        left join TM_NHOMDICHVU ndv on ndv.NHOMDICHVU_ID = dv.NHOMDICHVU_ID and ndv.BENHVIEN_ID = dv.BENHVIEN_ID        where pb.BENHVIEN_ID = 'HLU01' and ndv.MANHOMDICHVU = '04' and dv.DICHVU_ID IS NOT NULL]
2020-01-02 10:44:57,342 [1] DEBUG - Statement Id: [DAO00019_LayThongTinSoluongDichVuPhongKham_REG13] PreparedStatement : [select PHONGBAN_ID, TENPHONGBAN, NOITHUCHIEN_ID, SUM(CHUAKETQUA) AS CHUAKETQUA, SUM(HOANTAT) AS HOANTAT, SUM(DANGTHUCHIEN) AS DANGTHUCHIEN        from (        select B.PHONGBAN_ID, B.TENPHONGBAN, A.NOITHUCHIEN_ID,        case when A.TRANGTHAI = 'CHUAKETQUA' then 1 else 0 end AS CHUAKETQUA,        case when A.TRANGTHAI = 'HOANTAT' then 1 else 0 end AS HOANTAT,        case when A.TRANGTHAI = 'DANGTHUCHIEN' then 1 else 0 end AS DANGTHUCHIEN        from TM_PHONGBAN B        left join TT_DVYEUCAU A on A.NOITHUCHIEN_ID = B.PHONGBAN_ID and A.BENHVIEN_ID = B.BENHVIEN_ID and A.NGAYYEUCAU = CONVERT(date, getdate())        left join TM_DICHVU dv on A.DICHVU_ID = dv.DICHVU_ID        left join TM_NHOMDICHVU ndv on ndv.NHOMDICHVU_ID = dv.NHOMDICHVU_ID        where B.BENHVIEN_ID ='HLU01' and Left(ndv.MANHOMDICHVU,2) = '04'        and B.PHONGBAN_ID in (65,71,72,41,68,62,177,67,55,81,57,57,58,59,60,63,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,61,69,69,70,70)        ) tmp        group by tmp.NOITHUCHIEN_ID, tmp.TENPHONGBAN, tmp.PHONGBAN_ID]
2020-01-02 10:45:23,854 [1] DEBUG - Statement Id: [DAO00087_GetServiceParams] PreparedStatement : [select CODE, VALUE              from TM_SYS_APPSETTINGS              where LOCKED = '0' and BENHVIEN_ID = 'HLU01']
2020-01-02 10:45:23,940 [1] DEBUG - Statement Id: [DAO00095_GetDetailTrungBN] PreparedStatement : [select  TT_TIEPNHAN.NGAYTIEPNHAN AS NGAYTIEPNHAN ,TT_TIEPNHAN.SOBHYT AS SOTHE, TT_BENHNHAN.*, ISNULL(TT_BENHNHAN.NGAYSINH,TT_BENHNHAN.NAMSINH) AS NGAYNAMSINH          from TT_BENHNHAN          left join TT_TIEPNHAN  ON          TT_TIEPNHAN.TIEPNHAN_ID = (SELECT TOP 1 TIEPNHAN_ID FROM TT_TIEPNHAN WHERE BENHNHAN_ID = TT_BENHNHAN.BENHNHAN_ID ORDER BY THOIGIANTIEPNHAN DESC)           WHERE                TT_BENHNHAN.TENBENHNHAN = N'Vương Thị Xâm'             AND               convert(varchar(10),TT_BENHNHAN.NGAYSINH, 103) = convert(varchar(10),'04/10/1984', 103)               AND               TT_BENHNHAN.GIOITINH = '2']
2020-01-02 10:46:07,840 [1] DEBUG - Statement Id: [DAO00000_GetKyHieuBHYT] PreparedStatement : [select * from TM_DOITUONG where NHOMTHE LIKE '%' +  @param0  + '%']
2020-01-02 10:46:07,841 [1] DEBUG - Statement Id: [DAO00000_GetKyHieuBHYT] Parameters: [@param0=[MATHEBHYT,DN4]]
2020-01-02 10:46:07,841 [1] DEBUG - Statement Id: [DAO00000_GetKyHieuBHYT] Types: [@param0=[String, System.String]]
2020-01-02 10:46:07,956 [1] DEBUG - Statement Id: [DAO00095_GetDetail] PreparedStatement : [select distinct TT_BENHNHAN.*, ISNULL(TT_BENHNHAN.NGAYSINH, TT_BENHNHAN.NAMSINH) AS NGAYNAMSINH, TN1.SOBHYT AS SOTHE, TN1.NGAYTIEPNHAN          from TT_BENHNHAN          left join (          select MAX(TIEPNHAN_ID) AS TIEPNHAN_ID, BENHNHAN_ID from TT_TIEPNHAN GROUP BY BENHNHAN_ID) TN ON TN.BENHNHAN_ID = TT_BENHNHAN.BENHNHAN_ID          left join TT_TIEPNHAN TN1 ON TN1.TIEPNHAN_ID = TN.TIEPNHAN_ID           WHERE                TN1.SOBHYT = 'DN438381202498038010']
2020-01-02 10:46:13,264 [1] DEBUG - Statement Id: [DAO00000_GetKyHieuBHYT] PreparedStatement : [select * from TM_DOITUONG where NHOMTHE LIKE '%' +  @param0  + '%']
2020-01-02 10:46:13,265 [1] DEBUG - Statement Id: [DAO00000_GetKyHieuBHYT] Parameters: [@param0=[MATHEBHYT,DN4]]
2020-01-02 10:46:13,265 [1] DEBUG - Statement Id: [DAO00000_GetKyHieuBHYT] Types: [@param0=[String, System.String]]
2020-01-02 10:46:42,384 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'REG13'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2020-01-02 10:46:42,518 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'COM98'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
--------------------------------------------------------------------------------
2020-01-02 10:47:37,824 [1] DEBUG - Statement Id: [DAO00001_DBList] PreparedStatement : [select *              from TM_SYS_SERVER              where HOSPITAL_ID = '_SYSTEM_' and TYPE = 'D']
2020-01-02 10:47:38,196 [1] DEBUG - Statement Id: [DAO00001_DaoList] PreparedStatement : [select              TM_SYS_SERVICEMAP.ID,              TM_SYS_SERVICEMAP.HOSPITAL_ID,              TM_SYS_SERVICEMAP.DB_NAME,              TM_SYS_SERVICEMAP.TYPE,              TM_SYS_SERVICEMAP.NAME,              TM_SYS_SERVICEMAP.CLASS,              (TM_SYS_DIC.VALUE + '.' + TM_SYS_SERVICEMAP.CLASS) as CLASSFULL,              TM_SYS_SERVICEMAP.ASSEMBLY              from TM_SYS_SERVICEMAP              inner join TM_SYS_DIC              on TM_SYS_SERVICEMAP.NAMESPACE = TM_SYS_DIC.ID              where HOSPITAL_ID = '_SYSTEM_' AND TYPE = 'D' AND ACTIVE = '1'              order by DB_NAME]
2020-01-02 10:47:38,236 [1] DEBUG - Statement Id: [DAO00001_ServiceList] PreparedStatement : [select              TM_SYS_SERVICEMAP.ID,              TM_SYS_SERVICEMAP.HOSPITAL_ID,              TM_SYS_SERVICEMAP.DB_NAME,              TM_SYS_SERVICEMAP.TYPE,              TM_SYS_SERVICEMAP.NAME,              TM_SYS_SERVICEMAP.CLASS,              (TM_SYS_DIC.VALUE + '.' + TM_SYS_SERVICEMAP.CLASS) as CLASSFULL,              TM_SYS_SERVICEMAP.ASSEMBLY,              TM_SYS_SERVER.URL              from TM_SYS_SERVICEMAP              inner join TM_SYS_DIC on TM_SYS_SERVICEMAP.NAMESPACE = TM_SYS_DIC.ID              inner join TM_SYS_SERVER on (TM_SYS_SERVICEMAP.DB_NAME = TM_SYS_SERVER.NAME) and (TM_SYS_SERVER.HOSPITAL_ID = '_SYSTEM_')              where TM_SYS_SERVICEMAP.HOSPITAL_ID = '_SYSTEM_' AND TM_SYS_SERVICEMAP.TYPE = 'S'  AND ACTIVE = '1'              order by URL]
2020-01-02 10:47:38,879 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = '_SYSTEM_'               AND                   TM_SYS_SCREEN.PAGE = 'LOGIN'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2020-01-02 10:47:39,166 [1] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = '_SYSTEM_'               AND                   TM_SYS_CACHE.ACTIVE = '1']
2020-01-02 10:47:44,573 [1] DEBUG - Statement Id: [DAO00001_DBList] PreparedStatement : [select *              from TM_SYS_SERVER              where HOSPITAL_ID = 'HLU01' and TYPE = 'D']
2020-01-02 10:47:44,623 [1] DEBUG - Statement Id: [DAO00001_DaoList] PreparedStatement : [select              TM_SYS_SERVICEMAP.ID,              TM_SYS_SERVICEMAP.HOSPITAL_ID,              TM_SYS_SERVICEMAP.DB_NAME,              TM_SYS_SERVICEMAP.TYPE,              TM_SYS_SERVICEMAP.NAME,              TM_SYS_SERVICEMAP.CLASS,              (TM_SYS_DIC.VALUE + '.' + TM_SYS_SERVICEMAP.CLASS) as CLASSFULL,              TM_SYS_SERVICEMAP.ASSEMBLY              from TM_SYS_SERVICEMAP              inner join TM_SYS_DIC              on TM_SYS_SERVICEMAP.NAMESPACE = TM_SYS_DIC.ID              where HOSPITAL_ID = 'HLU01' AND TYPE = 'D' AND ACTIVE = '1'              order by DB_NAME]
2020-01-02 10:47:46,258 [1] DEBUG - Statement Id: [DAO00001_ServiceList] PreparedStatement : [select              TM_SYS_SERVICEMAP.ID,              TM_SYS_SERVICEMAP.HOSPITAL_ID,              TM_SYS_SERVICEMAP.DB_NAME,              TM_SYS_SERVICEMAP.TYPE,              TM_SYS_SERVICEMAP.NAME,              TM_SYS_SERVICEMAP.CLASS,              (TM_SYS_DIC.VALUE + '.' + TM_SYS_SERVICEMAP.CLASS) as CLASSFULL,              TM_SYS_SERVICEMAP.ASSEMBLY,              TM_SYS_SERVER.URL              from TM_SYS_SERVICEMAP              inner join TM_SYS_DIC on TM_SYS_SERVICEMAP.NAMESPACE = TM_SYS_DIC.ID              inner join TM_SYS_SERVER on (TM_SYS_SERVICEMAP.DB_NAME = TM_SYS_SERVER.NAME) and (TM_SYS_SERVER.HOSPITAL_ID = 'HLU01')              where TM_SYS_SERVICEMAP.HOSPITAL_ID = 'HLU01' AND TM_SYS_SERVICEMAP.TYPE = 'S'  AND ACTIVE = '1'              order by URL]
2020-01-02 10:47:46,350 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1']
2020-01-02 10:47:47,216 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM005']
2020-01-02 10:47:47,438 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM015']
2020-01-02 10:47:47,528 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM067']
2020-01-02 10:47:47,609 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM008']
2020-01-02 10:47:47,731 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM068']
2020-01-02 10:47:47,890 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM006']
2020-01-02 10:47:47,984 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM030']
2020-01-02 10:47:48,063 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM025']
2020-01-02 10:47:48,140 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM024']
2020-01-02 10:47:48,642 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM033']
2020-01-02 10:47:48,675 [5] DEBUG - Statement Id: [DAO00027_GetListDuocKyGuiTonKho] PreparedStatement : [select  distinct TT_TONKHO.DUOC_KEY, LTRIM(TT_TONKHO.KHODUOC_ID) as KHODUOC_ID, TM_DUOC.DUOC_ID, TM_LOAIDUOC.MALOAIDUOC,TM_DUOC.SOVISA,TM_DUOC.TYLE_VAT,TM_DUOC.COTOA,        TM_DUOC.MADUOC, TM_DUOC.TENHANG, TM_DUOC.TENDUOCDAYDU, dvt.TENDONVITINH as DONVITINH,  TM_DUOC.DONVITINH_ID,TM_DUOC.BHYT,TM_DUOC.PHAMVI,        TM_DUOC.TENHOATCHAT, TM_DUOC.HAMLUONG, TM_DUOC.HANGSANXUAT, TM_DUOC.QUOCGIA, TM_DUOC.LOAIDUOC_ID, TM_DUOC.DUONGDUNG_ID,        TM_TENDUOC.TENDUOC, TM_TENDUOC.TENDUOC_EN, TM_TENDUOC.MAQUOCTE, TM_TENDUOC.MAQUOCTEBT,        TM_LOAIDUOC.LOAIVATTU_ID, TM_DUOC.BENHVIEN_ID,TT_TONKHO.SOLUONG, TT_TONKHO.NGUONDUOC_ID, NH.TENNGUONDUOC        , TAMNGUNG = CASE WHEN TM_DUOC.TAMNGUNG = '1' OR nh.TAMNGUNG = '1' OR KD.TAMNGUNG = '1' THEN '1' ELSE '0' END        , TM_DUOC.DANGTRINHBAY        from TM_DUOC        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = TM_DUOC.DONVITINH_ID        left join TM_TENDUOC on TM_DUOC.TENDUOC_ID = TM_TENDUOC.TENDUOC_ID and TM_DUOC.BENHVIEN_ID = 'HLU01' and TM_DUOC.TAMNGUNG = '0'        left join TM_LOAIDUOC on TM_LOAIDUOC.LOAIDUOC_ID = TM_DUOC.LOAIDUOC_ID and TM_LOAIDUOC.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG on (TM_LOAIDUOC.LOAIVATTU_ID = TM_DUOC_HANDUNG.LOAIDUOC and TM_DUOC_HANDUNG.BENHVIEN_ID = 'HLU01')        inner join        (select LTRIM(A.KHODUOC_ID) + '_' + LTRIM(A.DUOC_ID) + '_' + LTRIM(ISNULL(A.NGUONDUOC_ID,'')) as DUOC_KEY, A.KHODUOC_ID, A.DUOC_ID,A.NGUONDUOC_ID,        SUM(isnull(A.SOLUONG,0)) as SOLUONG        from        (select SUM(SOLUONG) as SOLUONG, KHODUOC_ID, DUOC_ID, NGUONDUOC_ID from TT_DUOC_KYGUI_TONKHO        where BENHVIEN_ID = 'HLU01' group by KHODUOC_ID, DUOC_ID, NGUONDUOC_ID) A        group by LTRIM(A.KHODUOC_ID) + '_' + LTRIM(A.DUOC_ID) + '_' + LTRIM(A.NGUONDUOC_ID), A.KHODUOC_ID, A.DUOC_ID, A.NGUONDUOC_ID)        TT_TONKHO on TT_TONKHO.DUOC_ID = TM_DUOC.DUOC_ID        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = TT_TONKHO.NGUONDUOC_ID and nh.BENHVIEN_ID = 'HLU01'        LEFT JOIN TM_KHODUOC KD ON KD.KHODUOC_ID = TT_TONKHO.KHODUOC_ID        where TM_DUOC.BENHVIEN_ID = 'HLU01' AND TT_TONKHO.SOLUONG >= 0]
2020-01-02 10:47:48,767 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM018']
2020-01-02 10:47:48,799 [5] DEBUG - Statement Id: [DAO00027_GetListDuocTonKho] PreparedStatement : [select distinct TT_TONKHO.DUOC_KEY, LTRIM(TT_TONKHO.KHODUOC_ID) as KHODUOC_ID, TM_DUOC.DUOC_ID, TM_LOAIDUOC.MALOAIDUOC,TM_DUOC.SOVISA,TM_DUOC.TYLE_VAT,TM_DUOC.COTOA,        TM_DUOC.MADUOC, TM_DUOC.TENHANG, TM_DUOC.TENDUOCDAYDU, dvt.TENDONVITINH as DONVITINH,  TM_DUOC.DONVITINH_ID,TM_DUOC.BHYT,                TM_DUOC.TENHOATCHAT,          TM_DUOC.HAMLUONG, TM_DUOC.HANGSANXUAT, TM_DUOC.QUOCGIA, TM_DUOC.LOAIDUOC_ID, TM_DUOC.DUONGDUNG_ID,        TM_TENDUOC.TENDUOC, TM_TENDUOC.TENDUOC_EN, TM_TENDUOC.MAQUOCTE, TM_TENDUOC.MAQUOCTEBT,        TM_LOAIDUOC.LOAIVATTU_ID, TM_DUOC.BENHVIEN_ID,        TT_TONKHO.SOLUONG, TM_DUOC.VTYT_PHANLOAI, TM_DUOC.PHAMVI, TT_TONKHO.NGUONDUOC_ID, NG.TENNGUONDUOC AS TENNGUONDUOC        , TAMNGUNG = CASE WHEN TM_DUOC.TAMNGUNG = '1' OR NG.TAMNGUNG = '1' OR KD.TAMNGUNG = '1' THEN '1' ELSE '0' END        , TM_DUOC.DANGTRINHBAY        from TM_DUOC        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = TM_DUOC.DONVITINH_ID        left join TM_TENDUOC on TM_DUOC.TENDUOC_ID = TM_TENDUOC.TENDUOC_ID and TM_DUOC.BENHVIEN_ID = 'HLU01' and TM_DUOC.TAMNGUNG = '0'        left join TM_LOAIDUOC on TM_LOAIDUOC.LOAIDUOC_ID = TM_DUOC.LOAIDUOC_ID and TM_LOAIDUOC.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG on (TM_LOAIDUOC.LOAIVATTU_ID = TM_DUOC_HANDUNG.LOAIDUOC and TM_DUOC_HANDUNG.BENHVIEN_ID = 'HLU01')        inner join        (select LTRIM(A.KHODUOC_ID) + '_' + LTRIM(A.DUOC_ID) + '_' + LTRIM(ISNULL(A.NGUONDUOC_ID,'')) as DUOC_KEY, A.KHODUOC_ID, A.DUOC_ID, A.NGUONDUOC_ID,        SUM(isnull(A.SOLUONG,0)) as SOLUONG        from        (select SUM(SOLUONG) as SOLUONG, KHODUOC_ID, DUOC_ID, NGUONDUOC_ID from TT_DUOC_TONKHO        where BENHVIEN_ID = 'HLU01' group by KHODUOC_ID, DUOC_ID, NGUONDUOC_ID) A        group by LTRIM(A.KHODUOC_ID) + '_' + LTRIM(A.DUOC_ID) + '_' + LTRIM(ISNULL(A.NGUONDUOC_ID,'')), A.KHODUOC_ID, A.DUOC_ID, NGUONDUOC_ID        ) TT_TONKHO on TT_TONKHO.DUOC_ID = TM_DUOC.DUOC_ID        LEFT JOIN TM_NGUONHANG NG ON NG.NGUONDUOC_ID = TT_TONKHO.NGUONDUOC_ID        LEFT JOIN TM_KHODUOC KD ON KD.KHODUOC_ID = TT_TONKHO.KHODUOC_ID        where TM_DUOC.BENHVIEN_ID = 'HLU01' and TT_TONKHO.SOLUONG >= 0]
2020-01-02 10:47:49,856 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM023']
2020-01-02 10:47:49,890 [5] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoVaBooking] PreparedStatement : [declare @NGUONDUOC_MACDINH varchar(5) = '0';        declare @TOAMUANGOAI int = 0;        select @NGUONDUOC_MACDINH = isnull(VALUE,0) from TM_SYS_APPSETTINGS where CODE = 'PHA_NGUONDUOC'        select @TOAMUANGOAI = isnull(VALUE,0) from TM_SYS_APPSETTINGS where CODE = 'OPD_TOAMUANGOAI_DUNGDANHMUC_DUOC'                if @TOAMUANGOAI = 1        begin        select  distinct '0' + '_' + LTRIM(d.DUOC_ID) + '_' + @NGUONDUOC_MACDINH as DUOC_KEY, 0 as PHAMVI_ID, @NGUONDUOC_MACDINH as NGUONDUOC_ID, null as TENNGUONDUOC, null as TINHTIEN, d.DUOC_ID, ld.MALOAIDUOC,        d.SOVISA,d.TYLE_VAT,d.COTOA, d.MADUOC, d.TENHANG, d.TENDUOCDAYDU, d.DONVITINH as DONVITINH, d.BHYT,        d.TENHOATCHAT, d.HAMLUONG, d.HANGSANXUAT, d.QUOCGIA, d.LOAIDUOC_ID, d.DUONGDUNG_ID, d.TINHTIEN_PTTT,        ten.TENDUOC, ten.TENDUOC_EN, ten.MAQUOCTE, ten.MAQUOCTEBT,d.CONGDUNG,        '' as BHYT_TEXT        , ld.LOAIVATTU_ID        , d.BENHVIEN_ID,        999999999 as SOLUONG, d.VTYT_PHANLOAI, d.PHAMVI, d.SUASOLUONGTONGHOP, d.MADUOCBV, d.DANGTRINHBAY        , TAMNGUNG = CASE WHEN d.TAMNGUNG = '1' THEN '1' ELSE '0' END        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        union all        select  distinct tk.DUOC_KEY, LTRIM(tk.PHAMVI_ID) as PHAMVI_ID, tk.NGUONDUOC_ID, nh.TENNGUONDUOC, nh.TINHTIEN, d.DUOC_ID, ld.MALOAIDUOC,        d.SOVISA,d.TYLE_VAT,d.COTOA, d.MADUOC, d.TENHANG, d.TENDUOCDAYDU, d.DONVITINH as DONVITINH, d.BHYT,        d.TENHOATCHAT, d.HAMLUONG, d.HANGSANXUAT, d.QUOCGIA, d.LOAIDUOC_ID, d.DUONGDUNG_ID, d.TINHTIEN_PTTT,        ten.TENDUOC, ten.TENDUOC_EN, ten.MAQUOCTE, ten.MAQUOCTEBT,d.CONGDUNG,        CASE WHEN d.BHYT = '1' THEN 'BHYT' ELSE '' END as BHYT_TEXT        , ld.LOAIVATTU_ID        , d.BENHVIEN_ID,        tk.SOLUONG, d.VTYT_PHANLOAI, d.PHAMVI, d.SUASOLUONGTONGHOP, d.MADUOCBV, d.DANGTRINHBAY        , TAMNGUNG = CASE WHEN d.TAMNGUNG = '1' OR nh.TAMNGUNG = '1' OR kd.TAMNGUNG = '1' THEN '1' ELSE '0' END        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        inner join        (        select  LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')) DUOC_KEY, (SUM(dtk.SOLUONG) - isnull(sum(A.SOLUONG),0) - isnull(sum(B.SOLUONG),0)) SOLUONG, pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        from (select sum(soluong) soluong,duoc_id,nguonduoc_id,khoduoc_id,benhvien_id from TT_DUOC_TONKHO  group by duoc_id,nguonduoc_id,khoduoc_id,benhvien_id) dtk        inner join TM_DUOC_PHAMVISD_MAPPING pvsd on dtk.KHODUOC_ID = pvsd.KHODUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NOITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) B on B.DUOC_ID = dtk.DUOC_ID and B.SOLUONG > 0 and B.PHAMVI_ID = pvsd.PHAMVI_ID and B.NGUONHANG_ID = dtk.NGUONDUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NGOAITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) A on A.DUOC_ID = dtk.DUOC_ID and A.SOLUONG > 0 and A.PHAMVI_ID = pvsd.PHAMVI_ID and A.NGUONHANG_ID = dtk.NGUONDUOC_ID        where dtk.SOLUONG > 0 and dtk.BENHVIEN_ID = 'HLU01'        group by LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')), pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        ) tk on tk.DUOC_ID = d.DUOC_ID        left join TM_DUOC_PHAMVISUDUNG kd on kd.PHAMVI_ID = tk.PHAMVI_ID and kd.BENHVIEN_ID = 'HLU01'        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = tk.NGUONDUOC_ID and nh.BENHVIEN_ID = 'HLU01'        where d.BENHVIEN_ID = 'HLU01'  and tk.SOLUONG >= 0        end        else        begin                  select  distinct tk.DUOC_KEY, LTRIM(tk.PHAMVI_ID) as PHAMVI_ID, tk.NGUONDUOC_ID, nh.TENNGUONDUOC, nh.TINHTIEN, d.DUOC_ID, ld.MALOAIDUOC,        d.SOVISA,d.TYLE_VAT,d.COTOA, d.MADUOC, d.TENHANG, d.TENDUOCDAYDU, d.DONVITINH as DONVITINH, d.BHYT,        d.TENHOATCHAT, d.HAMLUONG, d.HANGSANXUAT, d.QUOCGIA, d.LOAIDUOC_ID, d.DUONGDUNG_ID, d.TINHTIEN_PTTT,        ten.TENDUOC, ten.TENDUOC_EN, ten.MAQUOCTE, ten.MAQUOCTEBT,d.CONGDUNG,        CASE WHEN d.BHYT = '1' THEN 'BHYT' ELSE '' END as BHYT_TEXT        , ld.LOAIVATTU_ID        , d.BENHVIEN_ID,        tk.SOLUONG, d.VTYT_PHANLOAI, d.PHAMVI, d.SUASOLUONGTONGHOP, d.MADUOCBV, d.DANGTRINHBAY        , TAMNGUNG = CASE WHEN d.TAMNGUNG = '1' OR nh.TAMNGUNG = '1' OR kd.TAMNGUNG = '1' THEN '1' ELSE '0' END        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        inner join        (        select  LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')) DUOC_KEY, (SUM(dtk.SOLUONG) - isnull(sum(A.SOLUONG),0) - isnull(sum(B.SOLUONG),0)) SOLUONG, pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        from (select sum(soluong) soluong,duoc_id,nguonduoc_id,khoduoc_id,benhvien_id from TT_DUOC_TONKHO  group by duoc_id,nguonduoc_id,khoduoc_id,benhvien_id) dtk        inner join TM_DUOC_PHAMVISD_MAPPING pvsd on dtk.KHODUOC_ID = pvsd.KHODUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NOITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) B on B.DUOC_ID = dtk.DUOC_ID and B.SOLUONG > 0 and B.PHAMVI_ID = pvsd.PHAMVI_ID and B.NGUONHANG_ID = dtk.NGUONDUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NGOAITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) A on A.DUOC_ID = dtk.DUOC_ID and A.SOLUONG > 0 and A.PHAMVI_ID = pvsd.PHAMVI_ID and A.NGUONHANG_ID = dtk.NGUONDUOC_ID        where dtk.SOLUONG > 0 and dtk.BENHVIEN_ID = 'HLU01'        group by LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')), pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        ) tk on tk.DUOC_ID = d.DUOC_ID        left join TM_DUOC_PHAMVISUDUNG kd on kd.PHAMVI_ID = tk.PHAMVI_ID and kd.BENHVIEN_ID = 'HLU01'        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = tk.NGUONDUOC_ID and nh.BENHVIEN_ID = 'HLU01'        where d.BENHVIEN_ID = 'HLU01'  and tk.SOLUONG >= 0        end]
2020-01-02 10:47:51,963 [5] DEBUG - Statement Id: [DAO00320_GetList] PreparedStatement : [select M.*            from TM_MAU M            LEFT JOIN TM_MAU_DONVITINH DVT on M.DONVITINH_ID=DVT.DONVITINH_ID            where            M.TAMNGUNG = '0'            and M.BENHVIEN_ID = 'HLU01'            order by M.TENMAU]
2020-01-02 10:47:52,030 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM071']
2020-01-02 10:47:52,062 [5] DEBUG - Statement Id: [DAO00322_GetListMauTonKhoForCreateCached] PreparedStatement : [SELECT DISTINCT        TK.MAU_KEY, TK.KHOMAU_ID, M.MAU_ID, M.MAMAU, M.TENMAU, M.NHOM_ABO, M.NHOM_RH, M.LOAIMAU_ID,        TK.SOLONHAP_ID, SLN.SOLONHAP, SLN.SOKIEMSOAT, TK.NGUONHANG_ID, NG.TENNGUONMAU, M.BENHVIEN_ID, M.DONVITINH_ID,        SUM(tk.SOLUONG) AS SOLUONG,K.TENKHO,DVT.TENDONVITINH        FROM TT_MAU_TONKHO TK        JOIN TM_KHO K ON TK.KHOMAU_ID = K.KHO_ID        JOIN TT_MAU_CHUNGTU_SOLONHAP SLN ON TK.SOLONHAP_ID = SLN.SOLONHAP_ID        JOIN TM_MAU M on TK.MAU_ID = M.MAU_ID and M.TAMNGUNG = '0'        LEFT JOIN TM_MAU_DONVITINH DVT on M.DONVITINH_ID=DVT.DONVITINH_ID        LEFT JOIN TM_NGUONMAU NG ON NG.NGUONMAU_ID = TK.NGUONHANG_ID        WHERE TK.SOLUONG > 0        GROUP BY TK.MAU_KEY, TK.KHOMAU_ID, M.MAU_ID, M.MAMAU, M.TENMAU, M.NHOM_ABO, M.NHOM_RH, M.LOAIMAU_ID,        TK.SOLONHAP_ID, SLN.SOLONHAP, SLN.SOKIEMSOAT,TK.NGUONHANG_ID, NG.TENNGUONMAU, M.BENHVIEN_ID, M.DONVITINH_ID,K.TENKHO,DVT.TENDONVITINH]
2020-01-02 10:47:52,190 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM073']
2020-01-02 10:47:52,223 [5] DEBUG - Statement Id: [DAO00322_GetListMauTonKhoTruBooking] PreparedStatement : [select distinct        TK.MAU_KEY, TK.KHOMAU_ID, M.MAU_ID, M.MAMAU, M.TENMAU, M.NHOM_ABO, M.NHOM_RH, M.LOAIMAU_ID, M.DONVITINH_ID,        TK.SOLONHAP_ID, TK.SOLONHAP, TK.SOKIEMSOAT,M.PHAMVI, TK.NGUONHANG_ID, NG.TENNGUONMAU, M.BENHVIEN_ID,        TK.SOLUONG,TK.TENKHO,DVT.TENDONVITINH        from TM_MAU M        JOIN        (        select        A.MAU_KEY, A.KHOMAU_ID, A.MAU_ID ,a.NGUONHANG_ID, A.SOLONHAP_ID, A.SOLONHAP, A.SOKIEMSOAT, A.SOLUONG,A.TENKHO        from        (        select KHOMAU_ID, TK.MAU_ID, TK.NGUONHANG_ID, TK.MAU_KEY, SLN.SOLONHAP_ID, SLN.SOLONHAP, SLN.SOKIEMSOAT, ISNULL(TK.SOLUONG,0) - ISNULL(book.SOLUONG,0) as SOLUONG,K.TENKHO        from TT_MAU_TONKHO TK        JOIN TM_KHO K ON TK.KHOMAU_ID = K.KHO_ID        inner join TT_MAU_CHUNGTU_SOLONHAP SLN ON TK.SOLONHAP_ID = SLN.SOLONHAP_ID        left join dbo.TT_MAU_TONKHO_BOOK book ON book.MAU_KEY = TK.MAU_KEY AND book.TRANGTHAI = 'HIEULUC'        where ISNULL(TK.SOLUONG,0) - ISNULL(book.SOLUONG,0) > 0        ) A        )TK on TK.MAU_ID = M.MAU_ID and M.TAMNGUNG = '0'        LEFT JOIN TM_MAU_DONVITINH DVT on M.DONVITINH_ID=DVT.DONVITINH_ID        LEFT JOIN TM_NGUONMAU NG ON NG.NGUONMAU_ID = TK.NGUONHANG_ID]
2020-01-02 10:47:52,325 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM072']
2020-01-02 10:47:53,252 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'MAIN'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2020-01-02 10:47:54,167 [1] DEBUG - Statement Id: [DAO00002_FormList] PreparedStatement : [select              TM_SYS_FORM.HOSPITAL_ID,              TM_SYS_FORM.NAME,              TM_SYS_FORM.CLASS,              TM_SYS_FORM.ASSEMBLY,              TM_SYS_FORM.TITLE_VI as TITLE              from TM_SYS_FORM              where HOSPITAL_ID = 'HLU01']
2020-01-02 10:47:58,899 [1] DEBUG - Statement Id: [DAO00300_GetShortcutListByUserID] PreparedStatement : [SELECT S.SHORTCUT_CODE, S.SHORTCUT_VALUE              FROM TM_SHORTCUT AS S              WHERE S.BENHVIEN_ID = 'HLU01' AND S.USER_ID = '1' AND TAMNGUNG = '0']
2020-01-02 10:47:58,928 [1] DEBUG - Statement Id: [DAO00087_GetList] PreparedStatement : [select CODE, VALUE, BENHVIEN_ID              from TM_SYS_APPSETTINGS              where LOCKED = '0' and BENHVIEN_ID = 'HLU01'              order by SETTING_ID]
2020-01-02 10:47:59,012 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'MSG01'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2020-01-02 10:47:59,135 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'MSG02'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2020-01-02 10:47:59,275 [1] DEBUG - Statement Id: [DAO00008_GetUserSettings] PreparedStatement : [select A.*, B.TENKHO , C.TENPHONGBAN, B.MAKHO, C.MAPHONGBAN          from TM_SYS_USERS A          left join TM_KHODUOC B on B.KHODUOC_ID = A.INVENTORY_ID          left join TM_PHONGBAN C on (C.PHONGBAN_ID = A.WORKING_DEPT_ID and C.BENHVIEN_ID =  @param0 )          left join TM_SYS_USERKHO D on (D.ACCOUNT_ID = A.ACCOUNT_ID and D.HOSPITAL_ID =  @param0 )          where          A.HOSPITAL_ID =  @param0            and                 A.ACCOUNT_ID =  @param1]
2020-01-02 10:47:59,277 [1] DEBUG - Statement Id: [DAO00008_GetUserSettings] Parameters: [@param0=[HOSPITAL_ID,HLU01], @param1=[ACCOUNT_ID,113]]
2020-01-02 10:47:59,278 [1] DEBUG - Statement Id: [DAO00008_GetUserSettings] Types: [@param0=[String, System.String], @param1=[String, System.String]]
2020-01-02 10:47:59,306 [1] DEBUG - Statement Id: [DAO00008_GetUserInvSettings] PreparedStatement : [select A.*, B.TENKHO, B.MAKHO, B.LOAIKHO_ID, B.KHOQUANLY_ID          from TM_SYS_USERKHO A          left join TM_KHO B on B.MODULE_ID = A.MODULE_ID and B.KHO_ID = A.KHO_ID          where A.HOSPITAL_ID =  @param0  and A.ACCOUNT_ID =  @param1           order by B.TENKHO]
2020-01-02 10:47:59,306 [1] DEBUG - Statement Id: [DAO00008_GetUserInvSettings] Parameters: [@param0=[HOSPITAL_ID,HLU01], @param1=[ACCOUNT_ID,113]]
2020-01-02 10:47:59,306 [1] DEBUG - Statement Id: [DAO00008_GetUserInvSettings] Types: [@param0=[String, System.String], @param1=[String, System.String]]
2020-01-02 10:47:59,450 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'COM30'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2020-01-02 10:47:59,618 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'RIS04'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2020-01-02 10:48:09,803 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'MENU1'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2020-01-02 10:48:09,898 [1] DEBUG - Statement Id: [DAO00011_GetList] PreparedStatement : [select              TM_SYS_MENU.ID,              TM_SYS_MENU.PARENTID,              TM_SYS_MENU.SCREEN,              TM_SYS_MENU.SMALLIMAGE,              TM_SYS_MENU.LARGEIMAGE,              TM_SYS_MENU.DESCRIPTION,              TM_SYS_MENU.TYPE,              TM_SYS_MENU.TITLE_VI as TITLE              from TM_SYS_MENU              where TM_SYS_MENU.HOSPITAL_ID = 'HLU01' and TM_SYS_MENU.ACTIVE = '1'               AND                   (TM_SYS_MENU.TYPE & '8' = '8')                             order by TM_SYS_MENU.ORDERNUM]
2020-01-02 10:48:10,257 [1] DEBUG - Statement Id: [DAO00011_usermenu_list] PreparedStatement : [select              TM_SYS_HOMEMENU.MENUID as ID,              TM_SYS_MENU.TITLE_VI as TITLE,              TM_SYS_MENU.SCREEN,              TM_SYS_MENU.SMALLIMAGE,              TM_SYS_MENU.LARGEIMAGE,              TM_SYS_MENU.TYPE              from TM_SYS_HOMEMENU              left join TM_SYS_MENU on TM_SYS_MENU.ID = TM_SYS_HOMEMENU.MENUID and TM_SYS_MENU.HOSPITAL_ID = TM_SYS_HOMEMENU.HOSPITAL_ID              where TM_SYS_HOMEMENU.HOSPITAL_ID = 'HLU01' and TM_SYS_HOMEMENU.USERID = '113' and TM_SYS_MENU.ACTIVE = '1'               AND                   (TM_SYS_MENU.TYPE & '8' = '8')                             ORDER BY TM_SYS_HOMEMENU.ORDERNUM]
2020-01-02 10:48:12,430 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'REG14'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2020-01-02 10:48:13,931 [1] DEBUG - Statement Id: [DAO00012_GetList] PreparedStatement : [select        DICTIONARY_ID,        DICTIONARY_CODE,        DICTIONARY_NAME,        ATTRIBUTE1,        ATTRIBUTE2,        DICTIONARY_NAME_EN        from LST_DICTIONARY        where LST_DICTIONARY.Enabled = '1'         AND           LST_DICTIONARY.DICTIONARY_TYPE_CODE = 'PhanLoaiTiepNhan'                 order by LST_DICTIONARY.IDX]
2020-01-02 10:48:13,963 [1] DEBUG - Statement Id: [DAO00012_GetList] PreparedStatement : [select        DICTIONARY_ID,        DICTIONARY_CODE,        DICTIONARY_NAME,        ATTRIBUTE1,        ATTRIBUTE2,        DICTIONARY_NAME_EN        from LST_DICTIONARY        where LST_DICTIONARY.Enabled = '1'         AND           LST_DICTIONARY.DICTIONARY_TYPE_CODE = 'NguonBN'                 order by LST_DICTIONARY.IDX]
2020-01-02 10:48:13,990 [1] DEBUG - Statement Id: [DAO00019_GetListCongTyChiTra] PreparedStatement : [select *        from TM_CONGTYCHITRA        where        BENHVIEN_ID = 'HLU01' AND TAMNGUNG = '0']
2020-01-02 10:48:14,203 [1] DEBUG - Statement Id: [DAO00017_GetListPhongKham] PreparedStatement : [select pb.PHONGBAN_ID, pb.TENPHONGBAN, case when dv.ATTRIBUTE5 is null then 'TT' else 'KTC' end as LOAI_CHIPHI              from [TM_PHONGBAN_DICHVU] as pb_dv              inner join [TM_PHONGBAN] as pb on pb.PHONGBAN_ID = pb_dv.PHONGBAN_ID and pb.BENHVIEN_ID = 'HLU01'              inner join [TM_DICHVU] dv on dv.DICHVU_ID = pb_dv.DICHVU_ID and dv.MADICHVU = '' and dv.BENHVIEN_ID = 'HLU01'              where pb_dv.BENHVIEN_ID = 'HLU01']
2020-01-02 10:48:14,243 [1] DEBUG - Statement Id: [DAO00019_GetListPhongKham_REG13] PreparedStatement : [select pb.PHONGBAN_ID, pb.TENPHONGBAN, case when dv.ATTRIBUTE5 is null then 'TT' else 'KTC' end as LOAI_CHIPHI        from TM_PHONGBAN pb        left join TM_PHONGBAN_DICHVU pb_dv on pb_dv.PHONGBAN_ID = pb.PHONGBAN_ID and pb_dv.BENHVIEN_ID = pb.BENHVIEN_ID        left join TM_DICHVU dv on dv.DICHVU_ID = pb_dv.DICHVU_ID and dv.BENHVIEN_ID = pb_dv.BENHVIEN_ID        left join TM_NHOMDICHVU ndv on ndv.NHOMDICHVU_ID = dv.NHOMDICHVU_ID and ndv.BENHVIEN_ID = dv.BENHVIEN_ID        where pb.BENHVIEN_ID = 'HLU01' and ndv.MANHOMDICHVU = '04' and dv.DICHVU_ID IS NOT NULL]
2020-01-02 10:48:14,338 [1] DEBUG - Statement Id: [DAO00019_LayThongTinSoluongDichVuPhongKham_REG13] PreparedStatement : [select PHONGBAN_ID, TENPHONGBAN, NOITHUCHIEN_ID, SUM(CHUAKETQUA) AS CHUAKETQUA, SUM(HOANTAT) AS HOANTAT, SUM(DANGTHUCHIEN) AS DANGTHUCHIEN        from (        select B.PHONGBAN_ID, B.TENPHONGBAN, A.NOITHUCHIEN_ID,        case when A.TRANGTHAI = 'CHUAKETQUA' then 1 else 0 end AS CHUAKETQUA,        case when A.TRANGTHAI = 'HOANTAT' then 1 else 0 end AS HOANTAT,        case when A.TRANGTHAI = 'DANGTHUCHIEN' then 1 else 0 end AS DANGTHUCHIEN        from TM_PHONGBAN B        left join TT_DVYEUCAU A on A.NOITHUCHIEN_ID = B.PHONGBAN_ID and A.BENHVIEN_ID = B.BENHVIEN_ID and A.NGAYYEUCAU = CONVERT(date, getdate())        left join TM_DICHVU dv on A.DICHVU_ID = dv.DICHVU_ID        left join TM_NHOMDICHVU ndv on ndv.NHOMDICHVU_ID = dv.NHOMDICHVU_ID        where B.BENHVIEN_ID ='HLU01' and Left(ndv.MANHOMDICHVU,2) = '04'        and B.PHONGBAN_ID in (65,71,72,41,68,62,177,67,55,81,57,57,58,59,60,63,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,61,69,69,70,70)        ) tmp        group by tmp.NOITHUCHIEN_ID, tmp.TENPHONGBAN, tmp.PHONGBAN_ID]
2020-01-02 10:48:31,826 [1] DEBUG - Statement Id: [DAO00087_GetServiceParams] PreparedStatement : [select CODE, VALUE              from TM_SYS_APPSETTINGS              where LOCKED = '0' and BENHVIEN_ID = 'HLU01']
2020-01-02 10:48:31,949 [1] DEBUG - Statement Id: [DAO00095_GetDetailTrungBN] PreparedStatement : [select  TT_TIEPNHAN.NGAYTIEPNHAN AS NGAYTIEPNHAN ,TT_TIEPNHAN.SOBHYT AS SOTHE, TT_BENHNHAN.*, ISNULL(TT_BENHNHAN.NGAYSINH,TT_BENHNHAN.NAMSINH) AS NGAYNAMSINH          from TT_BENHNHAN          left join TT_TIEPNHAN  ON          TT_TIEPNHAN.TIEPNHAN_ID = (SELECT TOP 1 TIEPNHAN_ID FROM TT_TIEPNHAN WHERE BENHNHAN_ID = TT_BENHNHAN.BENHNHAN_ID ORDER BY THOIGIANTIEPNHAN DESC)           WHERE                TT_BENHNHAN.TENBENHNHAN = N'Vương Thị Xâm'             AND               convert(varchar(10),TT_BENHNHAN.NGAYSINH, 103) = convert(varchar(10),'04/10/1984', 103)               AND               TT_BENHNHAN.GIOITINH = '2']
2020-01-02 10:49:39,279 [1] DEBUG - Statement Id: [DAO00000_GetKyHieuBHYT] PreparedStatement : [select * from TM_DOITUONG where NHOMTHE LIKE '%' +  @param0  + '%']
2020-01-02 10:49:39,279 [1] DEBUG - Statement Id: [DAO00000_GetKyHieuBHYT] Parameters: [@param0=[MATHEBHYT,DN4]]
2020-01-02 10:49:39,279 [1] DEBUG - Statement Id: [DAO00000_GetKyHieuBHYT] Types: [@param0=[String, System.String]]
2020-01-02 10:49:39,405 [1] DEBUG - Statement Id: [DAO00095_GetDetail] PreparedStatement : [select distinct TT_BENHNHAN.*, ISNULL(TT_BENHNHAN.NGAYSINH, TT_BENHNHAN.NAMSINH) AS NGAYNAMSINH, TN1.SOBHYT AS SOTHE, TN1.NGAYTIEPNHAN          from TT_BENHNHAN          left join (          select MAX(TIEPNHAN_ID) AS TIEPNHAN_ID, BENHNHAN_ID from TT_TIEPNHAN GROUP BY BENHNHAN_ID) TN ON TN.BENHNHAN_ID = TT_BENHNHAN.BENHNHAN_ID          left join TT_TIEPNHAN TN1 ON TN1.TIEPNHAN_ID = TN.TIEPNHAN_ID           WHERE                TN1.SOBHYT = 'DN438381202498038010']
2020-01-02 10:49:43,470 [1] DEBUG - Statement Id: [DAO00000_GetKyHieuBHYT] PreparedStatement : [select * from TM_DOITUONG where NHOMTHE LIKE '%' +  @param0  + '%']
2020-01-02 10:49:43,470 [1] DEBUG - Statement Id: [DAO00000_GetKyHieuBHYT] Parameters: [@param0=[MATHEBHYT,DN4]]
2020-01-02 10:49:43,470 [1] DEBUG - Statement Id: [DAO00000_GetKyHieuBHYT] Types: [@param0=[String, System.String]]
--------------------------------------------------------------------------------
2020-01-02 10:54:24,480 [1] DEBUG - Statement Id: [DAO00001_DBList] PreparedStatement : [select *              from TM_SYS_SERVER              where HOSPITAL_ID = '_SYSTEM_' and TYPE = 'D']
2020-01-02 10:54:24,744 [1] DEBUG - Statement Id: [DAO00001_DaoList] PreparedStatement : [select              TM_SYS_SERVICEMAP.ID,              TM_SYS_SERVICEMAP.HOSPITAL_ID,              TM_SYS_SERVICEMAP.DB_NAME,              TM_SYS_SERVICEMAP.TYPE,              TM_SYS_SERVICEMAP.NAME,              TM_SYS_SERVICEMAP.CLASS,              (TM_SYS_DIC.VALUE + '.' + TM_SYS_SERVICEMAP.CLASS) as CLASSFULL,              TM_SYS_SERVICEMAP.ASSEMBLY              from TM_SYS_SERVICEMAP              inner join TM_SYS_DIC              on TM_SYS_SERVICEMAP.NAMESPACE = TM_SYS_DIC.ID              where HOSPITAL_ID = '_SYSTEM_' AND TYPE = 'D' AND ACTIVE = '1'              order by DB_NAME]
2020-01-02 10:54:24,781 [1] DEBUG - Statement Id: [DAO00001_ServiceList] PreparedStatement : [select              TM_SYS_SERVICEMAP.ID,              TM_SYS_SERVICEMAP.HOSPITAL_ID,              TM_SYS_SERVICEMAP.DB_NAME,              TM_SYS_SERVICEMAP.TYPE,              TM_SYS_SERVICEMAP.NAME,              TM_SYS_SERVICEMAP.CLASS,              (TM_SYS_DIC.VALUE + '.' + TM_SYS_SERVICEMAP.CLASS) as CLASSFULL,              TM_SYS_SERVICEMAP.ASSEMBLY,              TM_SYS_SERVER.URL              from TM_SYS_SERVICEMAP              inner join TM_SYS_DIC on TM_SYS_SERVICEMAP.NAMESPACE = TM_SYS_DIC.ID              inner join TM_SYS_SERVER on (TM_SYS_SERVICEMAP.DB_NAME = TM_SYS_SERVER.NAME) and (TM_SYS_SERVER.HOSPITAL_ID = '_SYSTEM_')              where TM_SYS_SERVICEMAP.HOSPITAL_ID = '_SYSTEM_' AND TM_SYS_SERVICEMAP.TYPE = 'S'  AND ACTIVE = '1'              order by URL]
2020-01-02 10:54:25,244 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = '_SYSTEM_'               AND                   TM_SYS_SCREEN.PAGE = 'LOGIN'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2020-01-02 10:54:25,498 [1] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = '_SYSTEM_'               AND                   TM_SYS_CACHE.ACTIVE = '1']
2020-01-02 10:57:55,557 [1] DEBUG - Statement Id: [DAO00001_DBList] PreparedStatement : [select *              from TM_SYS_SERVER              where HOSPITAL_ID = 'HLU01' and TYPE = 'D']
2020-01-02 10:57:55,648 [1] DEBUG - Statement Id: [DAO00001_DaoList] PreparedStatement : [select              TM_SYS_SERVICEMAP.ID,              TM_SYS_SERVICEMAP.HOSPITAL_ID,              TM_SYS_SERVICEMAP.DB_NAME,              TM_SYS_SERVICEMAP.TYPE,              TM_SYS_SERVICEMAP.NAME,              TM_SYS_SERVICEMAP.CLASS,              (TM_SYS_DIC.VALUE + '.' + TM_SYS_SERVICEMAP.CLASS) as CLASSFULL,              TM_SYS_SERVICEMAP.ASSEMBLY              from TM_SYS_SERVICEMAP              inner join TM_SYS_DIC              on TM_SYS_SERVICEMAP.NAMESPACE = TM_SYS_DIC.ID              where HOSPITAL_ID = 'HLU01' AND TYPE = 'D' AND ACTIVE = '1'              order by DB_NAME]
2020-01-02 10:57:57,023 [1] DEBUG - Statement Id: [DAO00001_ServiceList] PreparedStatement : [select              TM_SYS_SERVICEMAP.ID,              TM_SYS_SERVICEMAP.HOSPITAL_ID,              TM_SYS_SERVICEMAP.DB_NAME,              TM_SYS_SERVICEMAP.TYPE,              TM_SYS_SERVICEMAP.NAME,              TM_SYS_SERVICEMAP.CLASS,              (TM_SYS_DIC.VALUE + '.' + TM_SYS_SERVICEMAP.CLASS) as CLASSFULL,              TM_SYS_SERVICEMAP.ASSEMBLY,              TM_SYS_SERVER.URL              from TM_SYS_SERVICEMAP              inner join TM_SYS_DIC on TM_SYS_SERVICEMAP.NAMESPACE = TM_SYS_DIC.ID              inner join TM_SYS_SERVER on (TM_SYS_SERVICEMAP.DB_NAME = TM_SYS_SERVER.NAME) and (TM_SYS_SERVER.HOSPITAL_ID = 'HLU01')              where TM_SYS_SERVICEMAP.HOSPITAL_ID = 'HLU01' AND TM_SYS_SERVICEMAP.TYPE = 'S'  AND ACTIVE = '1'              order by URL]
2020-01-02 10:57:57,106 [6] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1']
2020-01-02 10:57:57,881 [6] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM005']
2020-01-02 10:57:58,053 [6] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM015']
2020-01-02 10:57:58,130 [6] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM067']
2020-01-02 10:57:58,201 [6] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM008']
2020-01-02 10:57:58,270 [6] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM068']
2020-01-02 10:57:58,337 [6] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM006']
2020-01-02 10:57:58,409 [6] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM030']
2020-01-02 10:57:58,478 [6] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM025']
2020-01-02 10:57:58,545 [6] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM024']
2020-01-02 10:57:59,038 [6] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM033']
2020-01-02 10:57:59,074 [6] DEBUG - Statement Id: [DAO00027_GetListDuocKyGuiTonKho] PreparedStatement : [select  distinct TT_TONKHO.DUOC_KEY, LTRIM(TT_TONKHO.KHODUOC_ID) as KHODUOC_ID, TM_DUOC.DUOC_ID, TM_LOAIDUOC.MALOAIDUOC,TM_DUOC.SOVISA,TM_DUOC.TYLE_VAT,TM_DUOC.COTOA,        TM_DUOC.MADUOC, TM_DUOC.TENHANG, TM_DUOC.TENDUOCDAYDU, dvt.TENDONVITINH as DONVITINH,  TM_DUOC.DONVITINH_ID,TM_DUOC.BHYT,TM_DUOC.PHAMVI,        TM_DUOC.TENHOATCHAT, TM_DUOC.HAMLUONG, TM_DUOC.HANGSANXUAT, TM_DUOC.QUOCGIA, TM_DUOC.LOAIDUOC_ID, TM_DUOC.DUONGDUNG_ID,        TM_TENDUOC.TENDUOC, TM_TENDUOC.TENDUOC_EN, TM_TENDUOC.MAQUOCTE, TM_TENDUOC.MAQUOCTEBT,        TM_LOAIDUOC.LOAIVATTU_ID, TM_DUOC.BENHVIEN_ID,TT_TONKHO.SOLUONG, TT_TONKHO.NGUONDUOC_ID, NH.TENNGUONDUOC        , TAMNGUNG = CASE WHEN TM_DUOC.TAMNGUNG = '1' OR nh.TAMNGUNG = '1' OR KD.TAMNGUNG = '1' THEN '1' ELSE '0' END        , TM_DUOC.DANGTRINHBAY        from TM_DUOC        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = TM_DUOC.DONVITINH_ID        left join TM_TENDUOC on TM_DUOC.TENDUOC_ID = TM_TENDUOC.TENDUOC_ID and TM_DUOC.BENHVIEN_ID = 'HLU01' and TM_DUOC.TAMNGUNG = '0'        left join TM_LOAIDUOC on TM_LOAIDUOC.LOAIDUOC_ID = TM_DUOC.LOAIDUOC_ID and TM_LOAIDUOC.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG on (TM_LOAIDUOC.LOAIVATTU_ID = TM_DUOC_HANDUNG.LOAIDUOC and TM_DUOC_HANDUNG.BENHVIEN_ID = 'HLU01')        inner join        (select LTRIM(A.KHODUOC_ID) + '_' + LTRIM(A.DUOC_ID) + '_' + LTRIM(ISNULL(A.NGUONDUOC_ID,'')) as DUOC_KEY, A.KHODUOC_ID, A.DUOC_ID,A.NGUONDUOC_ID,        SUM(isnull(A.SOLUONG,0)) as SOLUONG        from        (select SUM(SOLUONG) as SOLUONG, KHODUOC_ID, DUOC_ID, NGUONDUOC_ID from TT_DUOC_KYGUI_TONKHO        where BENHVIEN_ID = 'HLU01' group by KHODUOC_ID, DUOC_ID, NGUONDUOC_ID) A        group by LTRIM(A.KHODUOC_ID) + '_' + LTRIM(A.DUOC_ID) + '_' + LTRIM(A.NGUONDUOC_ID), A.KHODUOC_ID, A.DUOC_ID, A.NGUONDUOC_ID)        TT_TONKHO on TT_TONKHO.DUOC_ID = TM_DUOC.DUOC_ID        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = TT_TONKHO.NGUONDUOC_ID and nh.BENHVIEN_ID = 'HLU01'        LEFT JOIN TM_KHODUOC KD ON KD.KHODUOC_ID = TT_TONKHO.KHODUOC_ID        where TM_DUOC.BENHVIEN_ID = 'HLU01' AND TT_TONKHO.SOLUONG >= 0]
2020-01-02 10:57:59,148 [6] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM018']
2020-01-02 10:57:59,179 [6] DEBUG - Statement Id: [DAO00027_GetListDuocTonKho] PreparedStatement : [select distinct TT_TONKHO.DUOC_KEY, LTRIM(TT_TONKHO.KHODUOC_ID) as KHODUOC_ID, TM_DUOC.DUOC_ID, TM_LOAIDUOC.MALOAIDUOC,TM_DUOC.SOVISA,TM_DUOC.TYLE_VAT,TM_DUOC.COTOA,        TM_DUOC.MADUOC, TM_DUOC.TENHANG, TM_DUOC.TENDUOCDAYDU, dvt.TENDONVITINH as DONVITINH,  TM_DUOC.DONVITINH_ID,TM_DUOC.BHYT,                TM_DUOC.TENHOATCHAT,          TM_DUOC.HAMLUONG, TM_DUOC.HANGSANXUAT, TM_DUOC.QUOCGIA, TM_DUOC.LOAIDUOC_ID, TM_DUOC.DUONGDUNG_ID,        TM_TENDUOC.TENDUOC, TM_TENDUOC.TENDUOC_EN, TM_TENDUOC.MAQUOCTE, TM_TENDUOC.MAQUOCTEBT,        TM_LOAIDUOC.LOAIVATTU_ID, TM_DUOC.BENHVIEN_ID,        TT_TONKHO.SOLUONG, TM_DUOC.VTYT_PHANLOAI, TM_DUOC.PHAMVI, TT_TONKHO.NGUONDUOC_ID, NG.TENNGUONDUOC AS TENNGUONDUOC        , TAMNGUNG = CASE WHEN TM_DUOC.TAMNGUNG = '1' OR NG.TAMNGUNG = '1' OR KD.TAMNGUNG = '1' THEN '1' ELSE '0' END        , TM_DUOC.DANGTRINHBAY        from TM_DUOC        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = TM_DUOC.DONVITINH_ID        left join TM_TENDUOC on TM_DUOC.TENDUOC_ID = TM_TENDUOC.TENDUOC_ID and TM_DUOC.BENHVIEN_ID = 'HLU01' and TM_DUOC.TAMNGUNG = '0'        left join TM_LOAIDUOC on TM_LOAIDUOC.LOAIDUOC_ID = TM_DUOC.LOAIDUOC_ID and TM_LOAIDUOC.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG on (TM_LOAIDUOC.LOAIVATTU_ID = TM_DUOC_HANDUNG.LOAIDUOC and TM_DUOC_HANDUNG.BENHVIEN_ID = 'HLU01')        inner join        (select LTRIM(A.KHODUOC_ID) + '_' + LTRIM(A.DUOC_ID) + '_' + LTRIM(ISNULL(A.NGUONDUOC_ID,'')) as DUOC_KEY, A.KHODUOC_ID, A.DUOC_ID, A.NGUONDUOC_ID,        SUM(isnull(A.SOLUONG,0)) as SOLUONG        from        (select SUM(SOLUONG) as SOLUONG, KHODUOC_ID, DUOC_ID, NGUONDUOC_ID from TT_DUOC_TONKHO        where BENHVIEN_ID = 'HLU01' group by KHODUOC_ID, DUOC_ID, NGUONDUOC_ID) A        group by LTRIM(A.KHODUOC_ID) + '_' + LTRIM(A.DUOC_ID) + '_' + LTRIM(ISNULL(A.NGUONDUOC_ID,'')), A.KHODUOC_ID, A.DUOC_ID, NGUONDUOC_ID        ) TT_TONKHO on TT_TONKHO.DUOC_ID = TM_DUOC.DUOC_ID        LEFT JOIN TM_NGUONHANG NG ON NG.NGUONDUOC_ID = TT_TONKHO.NGUONDUOC_ID        LEFT JOIN TM_KHODUOC KD ON KD.KHODUOC_ID = TT_TONKHO.KHODUOC_ID        where TM_DUOC.BENHVIEN_ID = 'HLU01' and TT_TONKHO.SOLUONG >= 0]
2020-01-02 10:58:00,299 [6] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM023']
2020-01-02 10:58:00,330 [6] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoVaBooking] PreparedStatement : [declare @NGUONDUOC_MACDINH varchar(5) = '0';        declare @TOAMUANGOAI int = 0;        select @NGUONDUOC_MACDINH = isnull(VALUE,0) from TM_SYS_APPSETTINGS where CODE = 'PHA_NGUONDUOC'        select @TOAMUANGOAI = isnull(VALUE,0) from TM_SYS_APPSETTINGS where CODE = 'OPD_TOAMUANGOAI_DUNGDANHMUC_DUOC'                if @TOAMUANGOAI = 1        begin        select  distinct '0' + '_' + LTRIM(d.DUOC_ID) + '_' + @NGUONDUOC_MACDINH as DUOC_KEY, 0 as PHAMVI_ID, @NGUONDUOC_MACDINH as NGUONDUOC_ID, null as TENNGUONDUOC, null as TINHTIEN, d.DUOC_ID, ld.MALOAIDUOC,        d.SOVISA,d.TYLE_VAT,d.COTOA, d.MADUOC, d.TENHANG, d.TENDUOCDAYDU, d.DONVITINH as DONVITINH, d.BHYT,        d.TENHOATCHAT, d.HAMLUONG, d.HANGSANXUAT, d.QUOCGIA, d.LOAIDUOC_ID, d.DUONGDUNG_ID, d.TINHTIEN_PTTT,        ten.TENDUOC, ten.TENDUOC_EN, ten.MAQUOCTE, ten.MAQUOCTEBT,d.CONGDUNG,        '' as BHYT_TEXT        , ld.LOAIVATTU_ID        , d.BENHVIEN_ID,        999999999 as SOLUONG, d.VTYT_PHANLOAI, d.PHAMVI, d.SUASOLUONGTONGHOP, d.MADUOCBV, d.DANGTRINHBAY        , TAMNGUNG = CASE WHEN d.TAMNGUNG = '1' THEN '1' ELSE '0' END        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        union all        select  distinct tk.DUOC_KEY, LTRIM(tk.PHAMVI_ID) as PHAMVI_ID, tk.NGUONDUOC_ID, nh.TENNGUONDUOC, nh.TINHTIEN, d.DUOC_ID, ld.MALOAIDUOC,        d.SOVISA,d.TYLE_VAT,d.COTOA, d.MADUOC, d.TENHANG, d.TENDUOCDAYDU, d.DONVITINH as DONVITINH, d.BHYT,        d.TENHOATCHAT, d.HAMLUONG, d.HANGSANXUAT, d.QUOCGIA, d.LOAIDUOC_ID, d.DUONGDUNG_ID, d.TINHTIEN_PTTT,        ten.TENDUOC, ten.TENDUOC_EN, ten.MAQUOCTE, ten.MAQUOCTEBT,d.CONGDUNG,        CASE WHEN d.BHYT = '1' THEN 'BHYT' ELSE '' END as BHYT_TEXT        , ld.LOAIVATTU_ID        , d.BENHVIEN_ID,        tk.SOLUONG, d.VTYT_PHANLOAI, d.PHAMVI, d.SUASOLUONGTONGHOP, d.MADUOCBV, d.DANGTRINHBAY        , TAMNGUNG = CASE WHEN d.TAMNGUNG = '1' OR nh.TAMNGUNG = '1' OR kd.TAMNGUNG = '1' THEN '1' ELSE '0' END        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        inner join        (        select  LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')) DUOC_KEY, (SUM(dtk.SOLUONG) - isnull(sum(A.SOLUONG),0) - isnull(sum(B.SOLUONG),0)) SOLUONG, pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        from (select sum(soluong) soluong,duoc_id,nguonduoc_id,khoduoc_id,benhvien_id from TT_DUOC_TONKHO  group by duoc_id,nguonduoc_id,khoduoc_id,benhvien_id) dtk        inner join TM_DUOC_PHAMVISD_MAPPING pvsd on dtk.KHODUOC_ID = pvsd.KHODUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NOITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) B on B.DUOC_ID = dtk.DUOC_ID and B.SOLUONG > 0 and B.PHAMVI_ID = pvsd.PHAMVI_ID and B.NGUONHANG_ID = dtk.NGUONDUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NGOAITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) A on A.DUOC_ID = dtk.DUOC_ID and A.SOLUONG > 0 and A.PHAMVI_ID = pvsd.PHAMVI_ID and A.NGUONHANG_ID = dtk.NGUONDUOC_ID        where dtk.SOLUONG > 0 and dtk.BENHVIEN_ID = 'HLU01'        group by LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')), pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        ) tk on tk.DUOC_ID = d.DUOC_ID        left join TM_DUOC_PHAMVISUDUNG kd on kd.PHAMVI_ID = tk.PHAMVI_ID and kd.BENHVIEN_ID = 'HLU01'        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = tk.NGUONDUOC_ID and nh.BENHVIEN_ID = 'HLU01'        where d.BENHVIEN_ID = 'HLU01'  and tk.SOLUONG >= 0        end        else        begin                  select  distinct tk.DUOC_KEY, LTRIM(tk.PHAMVI_ID) as PHAMVI_ID, tk.NGUONDUOC_ID, nh.TENNGUONDUOC, nh.TINHTIEN, d.DUOC_ID, ld.MALOAIDUOC,        d.SOVISA,d.TYLE_VAT,d.COTOA, d.MADUOC, d.TENHANG, d.TENDUOCDAYDU, d.DONVITINH as DONVITINH, d.BHYT,        d.TENHOATCHAT, d.HAMLUONG, d.HANGSANXUAT, d.QUOCGIA, d.LOAIDUOC_ID, d.DUONGDUNG_ID, d.TINHTIEN_PTTT,        ten.TENDUOC, ten.TENDUOC_EN, ten.MAQUOCTE, ten.MAQUOCTEBT,d.CONGDUNG,        CASE WHEN d.BHYT = '1' THEN 'BHYT' ELSE '' END as BHYT_TEXT        , ld.LOAIVATTU_ID        , d.BENHVIEN_ID,        tk.SOLUONG, d.VTYT_PHANLOAI, d.PHAMVI, d.SUASOLUONGTONGHOP, d.MADUOCBV, d.DANGTRINHBAY        , TAMNGUNG = CASE WHEN d.TAMNGUNG = '1' OR nh.TAMNGUNG = '1' OR kd.TAMNGUNG = '1' THEN '1' ELSE '0' END        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        inner join        (        select  LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')) DUOC_KEY, (SUM(dtk.SOLUONG) - isnull(sum(A.SOLUONG),0) - isnull(sum(B.SOLUONG),0)) SOLUONG, pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        from (select sum(soluong) soluong,duoc_id,nguonduoc_id,khoduoc_id,benhvien_id from TT_DUOC_TONKHO  group by duoc_id,nguonduoc_id,khoduoc_id,benhvien_id) dtk        inner join TM_DUOC_PHAMVISD_MAPPING pvsd on dtk.KHODUOC_ID = pvsd.KHODUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NOITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) B on B.DUOC_ID = dtk.DUOC_ID and B.SOLUONG > 0 and B.PHAMVI_ID = pvsd.PHAMVI_ID and B.NGUONHANG_ID = dtk.NGUONDUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NGOAITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) A on A.DUOC_ID = dtk.DUOC_ID and A.SOLUONG > 0 and A.PHAMVI_ID = pvsd.PHAMVI_ID and A.NGUONHANG_ID = dtk.NGUONDUOC_ID        where dtk.SOLUONG > 0 and dtk.BENHVIEN_ID = 'HLU01'        group by LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')), pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        ) tk on tk.DUOC_ID = d.DUOC_ID        left join TM_DUOC_PHAMVISUDUNG kd on kd.PHAMVI_ID = tk.PHAMVI_ID and kd.BENHVIEN_ID = 'HLU01'        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = tk.NGUONDUOC_ID and nh.BENHVIEN_ID = 'HLU01'        where d.BENHVIEN_ID = 'HLU01'  and tk.SOLUONG >= 0        end]
2020-01-02 10:58:02,172 [6] DEBUG - Statement Id: [DAO00320_GetList] PreparedStatement : [select M.*            from TM_MAU M            LEFT JOIN TM_MAU_DONVITINH DVT on M.DONVITINH_ID=DVT.DONVITINH_ID            where            M.TAMNGUNG = '0'            and M.BENHVIEN_ID = 'HLU01'            order by M.TENMAU]
2020-01-02 10:58:02,235 [6] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM071']
2020-01-02 10:58:02,268 [6] DEBUG - Statement Id: [DAO00322_GetListMauTonKhoForCreateCached] PreparedStatement : [SELECT DISTINCT        TK.MAU_KEY, TK.KHOMAU_ID, M.MAU_ID, M.MAMAU, M.TENMAU, M.NHOM_ABO, M.NHOM_RH, M.LOAIMAU_ID,        TK.SOLONHAP_ID, SLN.SOLONHAP, SLN.SOKIEMSOAT, TK.NGUONHANG_ID, NG.TENNGUONMAU, M.BENHVIEN_ID, M.DONVITINH_ID,        SUM(tk.SOLUONG) AS SOLUONG,K.TENKHO,DVT.TENDONVITINH        FROM TT_MAU_TONKHO TK        JOIN TM_KHO K ON TK.KHOMAU_ID = K.KHO_ID        JOIN TT_MAU_CHUNGTU_SOLONHAP SLN ON TK.SOLONHAP_ID = SLN.SOLONHAP_ID        JOIN TM_MAU M on TK.MAU_ID = M.MAU_ID and M.TAMNGUNG = '0'        LEFT JOIN TM_MAU_DONVITINH DVT on M.DONVITINH_ID=DVT.DONVITINH_ID        LEFT JOIN TM_NGUONMAU NG ON NG.NGUONMAU_ID = TK.NGUONHANG_ID        WHERE TK.SOLUONG > 0        GROUP BY TK.MAU_KEY, TK.KHOMAU_ID, M.MAU_ID, M.MAMAU, M.TENMAU, M.NHOM_ABO, M.NHOM_RH, M.LOAIMAU_ID,        TK.SOLONHAP_ID, SLN.SOLONHAP, SLN.SOKIEMSOAT,TK.NGUONHANG_ID, NG.TENNGUONMAU, M.BENHVIEN_ID, M.DONVITINH_ID,K.TENKHO,DVT.TENDONVITINH]
2020-01-02 10:58:02,378 [6] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM073']
2020-01-02 10:58:02,410 [6] DEBUG - Statement Id: [DAO00322_GetListMauTonKhoTruBooking] PreparedStatement : [select distinct        TK.MAU_KEY, TK.KHOMAU_ID, M.MAU_ID, M.MAMAU, M.TENMAU, M.NHOM_ABO, M.NHOM_RH, M.LOAIMAU_ID, M.DONVITINH_ID,        TK.SOLONHAP_ID, TK.SOLONHAP, TK.SOKIEMSOAT,M.PHAMVI, TK.NGUONHANG_ID, NG.TENNGUONMAU, M.BENHVIEN_ID,        TK.SOLUONG,TK.TENKHO,DVT.TENDONVITINH        from TM_MAU M        JOIN        (        select        A.MAU_KEY, A.KHOMAU_ID, A.MAU_ID ,a.NGUONHANG_ID, A.SOLONHAP_ID, A.SOLONHAP, A.SOKIEMSOAT, A.SOLUONG,A.TENKHO        from        (        select KHOMAU_ID, TK.MAU_ID, TK.NGUONHANG_ID, TK.MAU_KEY, SLN.SOLONHAP_ID, SLN.SOLONHAP, SLN.SOKIEMSOAT, ISNULL(TK.SOLUONG,0) - ISNULL(book.SOLUONG,0) as SOLUONG,K.TENKHO        from TT_MAU_TONKHO TK        JOIN TM_KHO K ON TK.KHOMAU_ID = K.KHO_ID        inner join TT_MAU_CHUNGTU_SOLONHAP SLN ON TK.SOLONHAP_ID = SLN.SOLONHAP_ID        left join dbo.TT_MAU_TONKHO_BOOK book ON book.MAU_KEY = TK.MAU_KEY AND book.TRANGTHAI = 'HIEULUC'        where ISNULL(TK.SOLUONG,0) - ISNULL(book.SOLUONG,0) > 0        ) A        )TK on TK.MAU_ID = M.MAU_ID and M.TAMNGUNG = '0'        LEFT JOIN TM_MAU_DONVITINH DVT on M.DONVITINH_ID=DVT.DONVITINH_ID        LEFT JOIN TM_NGUONMAU NG ON NG.NGUONMAU_ID = TK.NGUONHANG_ID]
2020-01-02 10:58:02,478 [6] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM072']
2020-01-02 10:58:03,386 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'MAIN'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2020-01-02 10:58:04,292 [1] DEBUG - Statement Id: [DAO00002_FormList] PreparedStatement : [select              TM_SYS_FORM.HOSPITAL_ID,              TM_SYS_FORM.NAME,              TM_SYS_FORM.CLASS,              TM_SYS_FORM.ASSEMBLY,              TM_SYS_FORM.TITLE_VI as TITLE              from TM_SYS_FORM              where HOSPITAL_ID = 'HLU01']
2020-01-02 10:58:09,057 [1] DEBUG - Statement Id: [DAO00300_GetShortcutListByUserID] PreparedStatement : [SELECT S.SHORTCUT_CODE, S.SHORTCUT_VALUE              FROM TM_SHORTCUT AS S              WHERE S.BENHVIEN_ID = 'HLU01' AND S.USER_ID = '1' AND TAMNGUNG = '0']
2020-01-02 10:58:09,085 [1] DEBUG - Statement Id: [DAO00087_GetList] PreparedStatement : [select CODE, VALUE, BENHVIEN_ID              from TM_SYS_APPSETTINGS              where LOCKED = '0' and BENHVIEN_ID = 'HLU01'              order by SETTING_ID]
2020-01-02 10:58:09,161 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'MSG01'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2020-01-02 10:58:09,279 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'MSG02'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2020-01-02 10:58:09,435 [1] DEBUG - Statement Id: [DAO00008_GetUserSettings] PreparedStatement : [select A.*, B.TENKHO , C.TENPHONGBAN, B.MAKHO, C.MAPHONGBAN          from TM_SYS_USERS A          left join TM_KHODUOC B on B.KHODUOC_ID = A.INVENTORY_ID          left join TM_PHONGBAN C on (C.PHONGBAN_ID = A.WORKING_DEPT_ID and C.BENHVIEN_ID =  @param0 )          left join TM_SYS_USERKHO D on (D.ACCOUNT_ID = A.ACCOUNT_ID and D.HOSPITAL_ID =  @param0 )          where          A.HOSPITAL_ID =  @param0            and                 A.ACCOUNT_ID =  @param1]
2020-01-02 10:58:09,441 [1] DEBUG - Statement Id: [DAO00008_GetUserSettings] Parameters: [@param0=[HOSPITAL_ID,HLU01], @param1=[ACCOUNT_ID,113]]
2020-01-02 10:58:09,441 [1] DEBUG - Statement Id: [DAO00008_GetUserSettings] Types: [@param0=[String, System.String], @param1=[String, System.String]]
2020-01-02 10:58:09,471 [1] DEBUG - Statement Id: [DAO00008_GetUserInvSettings] PreparedStatement : [select A.*, B.TENKHO, B.MAKHO, B.LOAIKHO_ID, B.KHOQUANLY_ID          from TM_SYS_USERKHO A          left join TM_KHO B on B.MODULE_ID = A.MODULE_ID and B.KHO_ID = A.KHO_ID          where A.HOSPITAL_ID =  @param0  and A.ACCOUNT_ID =  @param1           order by B.TENKHO]
2020-01-02 10:58:09,471 [1] DEBUG - Statement Id: [DAO00008_GetUserInvSettings] Parameters: [@param0=[HOSPITAL_ID,HLU01], @param1=[ACCOUNT_ID,113]]
2020-01-02 10:58:09,471 [1] DEBUG - Statement Id: [DAO00008_GetUserInvSettings] Types: [@param0=[String, System.String], @param1=[String, System.String]]
2020-01-02 10:58:09,705 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'COM30'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2020-01-02 10:58:09,916 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'RIS04'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2020-01-02 10:58:18,038 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'MENU1'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2020-01-02 10:58:18,139 [1] DEBUG - Statement Id: [DAO00011_GetList] PreparedStatement : [select              TM_SYS_MENU.ID,              TM_SYS_MENU.PARENTID,              TM_SYS_MENU.SCREEN,              TM_SYS_MENU.SMALLIMAGE,              TM_SYS_MENU.LARGEIMAGE,              TM_SYS_MENU.DESCRIPTION,              TM_SYS_MENU.TYPE,              TM_SYS_MENU.TITLE_VI as TITLE              from TM_SYS_MENU              where TM_SYS_MENU.HOSPITAL_ID = 'HLU01' and TM_SYS_MENU.ACTIVE = '1'               AND                   (TM_SYS_MENU.TYPE & '8' = '8')                             order by TM_SYS_MENU.ORDERNUM]
2020-01-02 10:58:18,440 [1] DEBUG - Statement Id: [DAO00011_usermenu_list] PreparedStatement : [select              TM_SYS_HOMEMENU.MENUID as ID,              TM_SYS_MENU.TITLE_VI as TITLE,              TM_SYS_MENU.SCREEN,              TM_SYS_MENU.SMALLIMAGE,              TM_SYS_MENU.LARGEIMAGE,              TM_SYS_MENU.TYPE              from TM_SYS_HOMEMENU              left join TM_SYS_MENU on TM_SYS_MENU.ID = TM_SYS_HOMEMENU.MENUID and TM_SYS_MENU.HOSPITAL_ID = TM_SYS_HOMEMENU.HOSPITAL_ID              where TM_SYS_HOMEMENU.HOSPITAL_ID = 'HLU01' and TM_SYS_HOMEMENU.USERID = '113' and TM_SYS_MENU.ACTIVE = '1'               AND                   (TM_SYS_MENU.TYPE & '8' = '8')                             ORDER BY TM_SYS_HOMEMENU.ORDERNUM]
2020-01-02 10:58:23,531 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'REG14'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2020-01-02 10:58:24,843 [1] DEBUG - Statement Id: [DAO00012_GetList] PreparedStatement : [select        DICTIONARY_ID,        DICTIONARY_CODE,        DICTIONARY_NAME,        ATTRIBUTE1,        ATTRIBUTE2,        DICTIONARY_NAME_EN        from LST_DICTIONARY        where LST_DICTIONARY.Enabled = '1'         AND           LST_DICTIONARY.DICTIONARY_TYPE_CODE = 'PhanLoaiTiepNhan'                 order by LST_DICTIONARY.IDX]
2020-01-02 10:58:24,875 [1] DEBUG - Statement Id: [DAO00012_GetList] PreparedStatement : [select        DICTIONARY_ID,        DICTIONARY_CODE,        DICTIONARY_NAME,        ATTRIBUTE1,        ATTRIBUTE2,        DICTIONARY_NAME_EN        from LST_DICTIONARY        where LST_DICTIONARY.Enabled = '1'         AND           LST_DICTIONARY.DICTIONARY_TYPE_CODE = 'NguonBN'                 order by LST_DICTIONARY.IDX]
2020-01-02 10:58:24,903 [1] DEBUG - Statement Id: [DAO00019_GetListCongTyChiTra] PreparedStatement : [select *        from TM_CONGTYCHITRA        where        BENHVIEN_ID = 'HLU01' AND TAMNGUNG = '0']
2020-01-02 10:58:25,113 [1] DEBUG - Statement Id: [DAO00017_GetListPhongKham] PreparedStatement : [select pb.PHONGBAN_ID, pb.TENPHONGBAN, case when dv.ATTRIBUTE5 is null then 'TT' else 'KTC' end as LOAI_CHIPHI              from [TM_PHONGBAN_DICHVU] as pb_dv              inner join [TM_PHONGBAN] as pb on pb.PHONGBAN_ID = pb_dv.PHONGBAN_ID and pb.BENHVIEN_ID = 'HLU01'              inner join [TM_DICHVU] dv on dv.DICHVU_ID = pb_dv.DICHVU_ID and dv.MADICHVU = '' and dv.BENHVIEN_ID = 'HLU01'              where pb_dv.BENHVIEN_ID = 'HLU01']
2020-01-02 10:58:25,152 [1] DEBUG - Statement Id: [DAO00019_GetListPhongKham_REG13] PreparedStatement : [select pb.PHONGBAN_ID, pb.TENPHONGBAN, case when dv.ATTRIBUTE5 is null then 'TT' else 'KTC' end as LOAI_CHIPHI        from TM_PHONGBAN pb        left join TM_PHONGBAN_DICHVU pb_dv on pb_dv.PHONGBAN_ID = pb.PHONGBAN_ID and pb_dv.BENHVIEN_ID = pb.BENHVIEN_ID        left join TM_DICHVU dv on dv.DICHVU_ID = pb_dv.DICHVU_ID and dv.BENHVIEN_ID = pb_dv.BENHVIEN_ID        left join TM_NHOMDICHVU ndv on ndv.NHOMDICHVU_ID = dv.NHOMDICHVU_ID and ndv.BENHVIEN_ID = dv.BENHVIEN_ID        where pb.BENHVIEN_ID = 'HLU01' and ndv.MANHOMDICHVU = '04' and dv.DICHVU_ID IS NOT NULL]
2020-01-02 10:58:25,244 [1] DEBUG - Statement Id: [DAO00019_LayThongTinSoluongDichVuPhongKham_REG13] PreparedStatement : [select PHONGBAN_ID, TENPHONGBAN, NOITHUCHIEN_ID, SUM(CHUAKETQUA) AS CHUAKETQUA, SUM(HOANTAT) AS HOANTAT, SUM(DANGTHUCHIEN) AS DANGTHUCHIEN        from (        select B.PHONGBAN_ID, B.TENPHONGBAN, A.NOITHUCHIEN_ID,        case when A.TRANGTHAI = 'CHUAKETQUA' then 1 else 0 end AS CHUAKETQUA,        case when A.TRANGTHAI = 'HOANTAT' then 1 else 0 end AS HOANTAT,        case when A.TRANGTHAI = 'DANGTHUCHIEN' then 1 else 0 end AS DANGTHUCHIEN        from TM_PHONGBAN B        left join TT_DVYEUCAU A on A.NOITHUCHIEN_ID = B.PHONGBAN_ID and A.BENHVIEN_ID = B.BENHVIEN_ID and A.NGAYYEUCAU = CONVERT(date, getdate())        left join TM_DICHVU dv on A.DICHVU_ID = dv.DICHVU_ID        left join TM_NHOMDICHVU ndv on ndv.NHOMDICHVU_ID = dv.NHOMDICHVU_ID        where B.BENHVIEN_ID ='HLU01' and Left(ndv.MANHOMDICHVU,2) = '04'        and B.PHONGBAN_ID in (65,71,72,41,68,62,177,67,55,81,57,57,58,59,60,63,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,61,69,69,70,70)        ) tmp        group by tmp.NOITHUCHIEN_ID, tmp.TENPHONGBAN, tmp.PHONGBAN_ID]
2020-01-02 10:58:41,121 [1] DEBUG - Statement Id: [DAO00087_GetServiceParams] PreparedStatement : [select CODE, VALUE              from TM_SYS_APPSETTINGS              where LOCKED = '0' and BENHVIEN_ID = 'HLU01']
2020-01-02 10:58:41,218 [1] DEBUG - Statement Id: [DAO00095_GetDetailTrungBN] PreparedStatement : [select  TT_TIEPNHAN.NGAYTIEPNHAN AS NGAYTIEPNHAN ,TT_TIEPNHAN.SOBHYT AS SOTHE, TT_BENHNHAN.*, ISNULL(TT_BENHNHAN.NGAYSINH,TT_BENHNHAN.NAMSINH) AS NGAYNAMSINH          from TT_BENHNHAN          left join TT_TIEPNHAN  ON          TT_TIEPNHAN.TIEPNHAN_ID = (SELECT TOP 1 TIEPNHAN_ID FROM TT_TIEPNHAN WHERE BENHNHAN_ID = TT_BENHNHAN.BENHNHAN_ID ORDER BY THOIGIANTIEPNHAN DESC)           WHERE                TT_BENHNHAN.TENBENHNHAN = N'Vương Thị Xâm'             AND               convert(varchar(10),TT_BENHNHAN.NGAYSINH, 103) = convert(varchar(10),'04/10/1984', 103)               AND               TT_BENHNHAN.GIOITINH = '2']
2020-01-02 10:59:06,525 [1] DEBUG - Statement Id: [DAO00000_GetKyHieuBHYT] PreparedStatement : [select * from TM_DOITUONG where NHOMTHE LIKE '%' +  @param0  + '%']
2020-01-02 10:59:06,525 [1] DEBUG - Statement Id: [DAO00000_GetKyHieuBHYT] Parameters: [@param0=[MATHEBHYT,DN4]]
2020-01-02 10:59:06,525 [1] DEBUG - Statement Id: [DAO00000_GetKyHieuBHYT] Types: [@param0=[String, System.String]]
2020-01-02 10:59:06,667 [1] DEBUG - Statement Id: [DAO00095_GetDetail] PreparedStatement : [select distinct TT_BENHNHAN.*, ISNULL(TT_BENHNHAN.NGAYSINH, TT_BENHNHAN.NAMSINH) AS NGAYNAMSINH, TN1.SOBHYT AS SOTHE, TN1.NGAYTIEPNHAN          from TT_BENHNHAN          left join (          select MAX(TIEPNHAN_ID) AS TIEPNHAN_ID, BENHNHAN_ID from TT_TIEPNHAN GROUP BY BENHNHAN_ID) TN ON TN.BENHNHAN_ID = TT_BENHNHAN.BENHNHAN_ID          left join TT_TIEPNHAN TN1 ON TN1.TIEPNHAN_ID = TN.TIEPNHAN_ID           WHERE                TN1.SOBHYT = 'DN438381202498038289']
2020-01-02 10:59:11,325 [1] DEBUG - Statement Id: [DAO00000_GetKyHieuBHYT] PreparedStatement : [select * from TM_DOITUONG where NHOMTHE LIKE '%' +  @param0  + '%']
2020-01-02 10:59:11,325 [1] DEBUG - Statement Id: [DAO00000_GetKyHieuBHYT] Parameters: [@param0=[MATHEBHYT,DN4]]
2020-01-02 10:59:11,325 [1] DEBUG - Statement Id: [DAO00000_GetKyHieuBHYT] Types: [@param0=[String, System.String]]
--------------------------------------------------------------------------------
2020-01-02 11:17:48,300 [1] DEBUG - Statement Id: [DAO00001_DBList] PreparedStatement : [select *              from TM_SYS_SERVER              where HOSPITAL_ID = '_SYSTEM_' and TYPE = 'D']
2020-01-02 11:17:48,548 [1] DEBUG - Statement Id: [DAO00001_DaoList] PreparedStatement : [select              TM_SYS_SERVICEMAP.ID,              TM_SYS_SERVICEMAP.HOSPITAL_ID,              TM_SYS_SERVICEMAP.DB_NAME,              TM_SYS_SERVICEMAP.TYPE,              TM_SYS_SERVICEMAP.NAME,              TM_SYS_SERVICEMAP.CLASS,              (TM_SYS_DIC.VALUE + '.' + TM_SYS_SERVICEMAP.CLASS) as CLASSFULL,              TM_SYS_SERVICEMAP.ASSEMBLY              from TM_SYS_SERVICEMAP              inner join TM_SYS_DIC              on TM_SYS_SERVICEMAP.NAMESPACE = TM_SYS_DIC.ID              where HOSPITAL_ID = '_SYSTEM_' AND TYPE = 'D' AND ACTIVE = '1'              order by DB_NAME]
2020-01-02 11:17:48,586 [1] DEBUG - Statement Id: [DAO00001_ServiceList] PreparedStatement : [select              TM_SYS_SERVICEMAP.ID,              TM_SYS_SERVICEMAP.HOSPITAL_ID,              TM_SYS_SERVICEMAP.DB_NAME,              TM_SYS_SERVICEMAP.TYPE,              TM_SYS_SERVICEMAP.NAME,              TM_SYS_SERVICEMAP.CLASS,              (TM_SYS_DIC.VALUE + '.' + TM_SYS_SERVICEMAP.CLASS) as CLASSFULL,              TM_SYS_SERVICEMAP.ASSEMBLY,              TM_SYS_SERVER.URL              from TM_SYS_SERVICEMAP              inner join TM_SYS_DIC on TM_SYS_SERVICEMAP.NAMESPACE = TM_SYS_DIC.ID              inner join TM_SYS_SERVER on (TM_SYS_SERVICEMAP.DB_NAME = TM_SYS_SERVER.NAME) and (TM_SYS_SERVER.HOSPITAL_ID = '_SYSTEM_')              where TM_SYS_SERVICEMAP.HOSPITAL_ID = '_SYSTEM_' AND TM_SYS_SERVICEMAP.TYPE = 'S'  AND ACTIVE = '1'              order by URL]
2020-01-02 11:17:49,018 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = '_SYSTEM_'               AND                   TM_SYS_SCREEN.PAGE = 'LOGIN'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2020-01-02 11:17:49,272 [1] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = '_SYSTEM_'               AND                   TM_SYS_CACHE.ACTIVE = '1']
2020-01-02 11:18:02,671 [1] DEBUG - Statement Id: [DAO00001_DBList] PreparedStatement : [select *              from TM_SYS_SERVER              where HOSPITAL_ID = 'HLU01' and TYPE = 'D']
2020-01-02 11:18:02,698 [1] DEBUG - Statement Id: [DAO00001_DaoList] PreparedStatement : [select              TM_SYS_SERVICEMAP.ID,              TM_SYS_SERVICEMAP.HOSPITAL_ID,              TM_SYS_SERVICEMAP.DB_NAME,              TM_SYS_SERVICEMAP.TYPE,              TM_SYS_SERVICEMAP.NAME,              TM_SYS_SERVICEMAP.CLASS,              (TM_SYS_DIC.VALUE + '.' + TM_SYS_SERVICEMAP.CLASS) as CLASSFULL,              TM_SYS_SERVICEMAP.ASSEMBLY              from TM_SYS_SERVICEMAP              inner join TM_SYS_DIC              on TM_SYS_SERVICEMAP.NAMESPACE = TM_SYS_DIC.ID              where HOSPITAL_ID = 'HLU01' AND TYPE = 'D' AND ACTIVE = '1'              order by DB_NAME]
2020-01-02 11:18:04,457 [1] DEBUG - Statement Id: [DAO00001_ServiceList] PreparedStatement : [select              TM_SYS_SERVICEMAP.ID,              TM_SYS_SERVICEMAP.HOSPITAL_ID,              TM_SYS_SERVICEMAP.DB_NAME,              TM_SYS_SERVICEMAP.TYPE,              TM_SYS_SERVICEMAP.NAME,              TM_SYS_SERVICEMAP.CLASS,              (TM_SYS_DIC.VALUE + '.' + TM_SYS_SERVICEMAP.CLASS) as CLASSFULL,              TM_SYS_SERVICEMAP.ASSEMBLY,              TM_SYS_SERVER.URL              from TM_SYS_SERVICEMAP              inner join TM_SYS_DIC on TM_SYS_SERVICEMAP.NAMESPACE = TM_SYS_DIC.ID              inner join TM_SYS_SERVER on (TM_SYS_SERVICEMAP.DB_NAME = TM_SYS_SERVER.NAME) and (TM_SYS_SERVER.HOSPITAL_ID = 'HLU01')              where TM_SYS_SERVICEMAP.HOSPITAL_ID = 'HLU01' AND TM_SYS_SERVICEMAP.TYPE = 'S'  AND ACTIVE = '1'              order by URL]
2020-01-02 11:18:04,545 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1']
2020-01-02 11:18:05,384 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM005']
2020-01-02 11:18:05,612 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM015']
2020-01-02 11:18:05,689 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM067']
2020-01-02 11:18:05,806 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM008']
2020-01-02 11:18:05,884 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM068']
2020-01-02 11:18:05,967 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM006']
2020-01-02 11:18:06,043 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM030']
2020-01-02 11:18:06,118 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM025']
2020-01-02 11:18:06,202 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM024']
2020-01-02 11:18:06,712 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM033']
2020-01-02 11:18:06,744 [5] DEBUG - Statement Id: [DAO00027_GetListDuocKyGuiTonKho] PreparedStatement : [select  distinct TT_TONKHO.DUOC_KEY, LTRIM(TT_TONKHO.KHODUOC_ID) as KHODUOC_ID, TM_DUOC.DUOC_ID, TM_LOAIDUOC.MALOAIDUOC,TM_DUOC.SOVISA,TM_DUOC.TYLE_VAT,TM_DUOC.COTOA,        TM_DUOC.MADUOC, TM_DUOC.TENHANG, TM_DUOC.TENDUOCDAYDU, dvt.TENDONVITINH as DONVITINH,  TM_DUOC.DONVITINH_ID,TM_DUOC.BHYT,TM_DUOC.PHAMVI,        TM_DUOC.TENHOATCHAT, TM_DUOC.HAMLUONG, TM_DUOC.HANGSANXUAT, TM_DUOC.QUOCGIA, TM_DUOC.LOAIDUOC_ID, TM_DUOC.DUONGDUNG_ID,        TM_TENDUOC.TENDUOC, TM_TENDUOC.TENDUOC_EN, TM_TENDUOC.MAQUOCTE, TM_TENDUOC.MAQUOCTEBT,        TM_LOAIDUOC.LOAIVATTU_ID, TM_DUOC.BENHVIEN_ID,TT_TONKHO.SOLUONG, TT_TONKHO.NGUONDUOC_ID, NH.TENNGUONDUOC        , TAMNGUNG = CASE WHEN TM_DUOC.TAMNGUNG = '1' OR nh.TAMNGUNG = '1' OR KD.TAMNGUNG = '1' THEN '1' ELSE '0' END        , TM_DUOC.DANGTRINHBAY        from TM_DUOC        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = TM_DUOC.DONVITINH_ID        left join TM_TENDUOC on TM_DUOC.TENDUOC_ID = TM_TENDUOC.TENDUOC_ID and TM_DUOC.BENHVIEN_ID = 'HLU01' and TM_DUOC.TAMNGUNG = '0'        left join TM_LOAIDUOC on TM_LOAIDUOC.LOAIDUOC_ID = TM_DUOC.LOAIDUOC_ID and TM_LOAIDUOC.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG on (TM_LOAIDUOC.LOAIVATTU_ID = TM_DUOC_HANDUNG.LOAIDUOC and TM_DUOC_HANDUNG.BENHVIEN_ID = 'HLU01')        inner join        (select LTRIM(A.KHODUOC_ID) + '_' + LTRIM(A.DUOC_ID) + '_' + LTRIM(ISNULL(A.NGUONDUOC_ID,'')) as DUOC_KEY, A.KHODUOC_ID, A.DUOC_ID,A.NGUONDUOC_ID,        SUM(isnull(A.SOLUONG,0)) as SOLUONG        from        (select SUM(SOLUONG) as SOLUONG, KHODUOC_ID, DUOC_ID, NGUONDUOC_ID from TT_DUOC_KYGUI_TONKHO        where BENHVIEN_ID = 'HLU01' group by KHODUOC_ID, DUOC_ID, NGUONDUOC_ID) A        group by LTRIM(A.KHODUOC_ID) + '_' + LTRIM(A.DUOC_ID) + '_' + LTRIM(A.NGUONDUOC_ID), A.KHODUOC_ID, A.DUOC_ID, A.NGUONDUOC_ID)        TT_TONKHO on TT_TONKHO.DUOC_ID = TM_DUOC.DUOC_ID        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = TT_TONKHO.NGUONDUOC_ID and nh.BENHVIEN_ID = 'HLU01'        LEFT JOIN TM_KHODUOC KD ON KD.KHODUOC_ID = TT_TONKHO.KHODUOC_ID        where TM_DUOC.BENHVIEN_ID = 'HLU01' AND TT_TONKHO.SOLUONG >= 0]
2020-01-02 11:18:06,835 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM018']
2020-01-02 11:18:06,869 [5] DEBUG - Statement Id: [DAO00027_GetListDuocTonKho] PreparedStatement : [select distinct TT_TONKHO.DUOC_KEY, LTRIM(TT_TONKHO.KHODUOC_ID) as KHODUOC_ID, TM_DUOC.DUOC_ID, TM_LOAIDUOC.MALOAIDUOC,TM_DUOC.SOVISA,TM_DUOC.TYLE_VAT,TM_DUOC.COTOA,        TM_DUOC.MADUOC, TM_DUOC.TENHANG, TM_DUOC.TENDUOCDAYDU, dvt.TENDONVITINH as DONVITINH,  TM_DUOC.DONVITINH_ID,TM_DUOC.BHYT,                TM_DUOC.TENHOATCHAT,          TM_DUOC.HAMLUONG, TM_DUOC.HANGSANXUAT, TM_DUOC.QUOCGIA, TM_DUOC.LOAIDUOC_ID, TM_DUOC.DUONGDUNG_ID,        TM_TENDUOC.TENDUOC, TM_TENDUOC.TENDUOC_EN, TM_TENDUOC.MAQUOCTE, TM_TENDUOC.MAQUOCTEBT,        TM_LOAIDUOC.LOAIVATTU_ID, TM_DUOC.BENHVIEN_ID,        TT_TONKHO.SOLUONG, TM_DUOC.VTYT_PHANLOAI, TM_DUOC.PHAMVI, TT_TONKHO.NGUONDUOC_ID, NG.TENNGUONDUOC AS TENNGUONDUOC        , TAMNGUNG = CASE WHEN TM_DUOC.TAMNGUNG = '1' OR NG.TAMNGUNG = '1' OR KD.TAMNGUNG = '1' THEN '1' ELSE '0' END        , TM_DUOC.DANGTRINHBAY        from TM_DUOC        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = TM_DUOC.DONVITINH_ID        left join TM_TENDUOC on TM_DUOC.TENDUOC_ID = TM_TENDUOC.TENDUOC_ID and TM_DUOC.BENHVIEN_ID = 'HLU01' and TM_DUOC.TAMNGUNG = '0'        left join TM_LOAIDUOC on TM_LOAIDUOC.LOAIDUOC_ID = TM_DUOC.LOAIDUOC_ID and TM_LOAIDUOC.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG on (TM_LOAIDUOC.LOAIVATTU_ID = TM_DUOC_HANDUNG.LOAIDUOC and TM_DUOC_HANDUNG.BENHVIEN_ID = 'HLU01')        inner join        (select LTRIM(A.KHODUOC_ID) + '_' + LTRIM(A.DUOC_ID) + '_' + LTRIM(ISNULL(A.NGUONDUOC_ID,'')) as DUOC_KEY, A.KHODUOC_ID, A.DUOC_ID, A.NGUONDUOC_ID,        SUM(isnull(A.SOLUONG,0)) as SOLUONG        from        (select SUM(SOLUONG) as SOLUONG, KHODUOC_ID, DUOC_ID, NGUONDUOC_ID from TT_DUOC_TONKHO        where BENHVIEN_ID = 'HLU01' group by KHODUOC_ID, DUOC_ID, NGUONDUOC_ID) A        group by LTRIM(A.KHODUOC_ID) + '_' + LTRIM(A.DUOC_ID) + '_' + LTRIM(ISNULL(A.NGUONDUOC_ID,'')), A.KHODUOC_ID, A.DUOC_ID, NGUONDUOC_ID        ) TT_TONKHO on TT_TONKHO.DUOC_ID = TM_DUOC.DUOC_ID        LEFT JOIN TM_NGUONHANG NG ON NG.NGUONDUOC_ID = TT_TONKHO.NGUONDUOC_ID        LEFT JOIN TM_KHODUOC KD ON KD.KHODUOC_ID = TT_TONKHO.KHODUOC_ID        where TM_DUOC.BENHVIEN_ID = 'HLU01' and TT_TONKHO.SOLUONG >= 0]
2020-01-02 11:18:08,009 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM023']
2020-01-02 11:18:08,042 [5] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoVaBooking] PreparedStatement : [declare @NGUONDUOC_MACDINH varchar(5) = '0';        declare @TOAMUANGOAI int = 0;        select @NGUONDUOC_MACDINH = isnull(VALUE,0) from TM_SYS_APPSETTINGS where CODE = 'PHA_NGUONDUOC'        select @TOAMUANGOAI = isnull(VALUE,0) from TM_SYS_APPSETTINGS where CODE = 'OPD_TOAMUANGOAI_DUNGDANHMUC_DUOC'                if @TOAMUANGOAI = 1        begin        select  distinct '0' + '_' + LTRIM(d.DUOC_ID) + '_' + @NGUONDUOC_MACDINH as DUOC_KEY, 0 as PHAMVI_ID, @NGUONDUOC_MACDINH as NGUONDUOC_ID, null as TENNGUONDUOC, null as TINHTIEN, d.DUOC_ID, ld.MALOAIDUOC,        d.SOVISA,d.TYLE_VAT,d.COTOA, d.MADUOC, d.TENHANG, d.TENDUOCDAYDU, d.DONVITINH as DONVITINH, d.BHYT,        d.TENHOATCHAT, d.HAMLUONG, d.HANGSANXUAT, d.QUOCGIA, d.LOAIDUOC_ID, d.DUONGDUNG_ID, d.TINHTIEN_PTTT,        ten.TENDUOC, ten.TENDUOC_EN, ten.MAQUOCTE, ten.MAQUOCTEBT,d.CONGDUNG,        '' as BHYT_TEXT        , ld.LOAIVATTU_ID        , d.BENHVIEN_ID,        999999999 as SOLUONG, d.VTYT_PHANLOAI, d.PHAMVI, d.SUASOLUONGTONGHOP, d.MADUOCBV, d.DANGTRINHBAY        , TAMNGUNG = CASE WHEN d.TAMNGUNG = '1' THEN '1' ELSE '0' END        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        union all        select  distinct tk.DUOC_KEY, LTRIM(tk.PHAMVI_ID) as PHAMVI_ID, tk.NGUONDUOC_ID, nh.TENNGUONDUOC, nh.TINHTIEN, d.DUOC_ID, ld.MALOAIDUOC,        d.SOVISA,d.TYLE_VAT,d.COTOA, d.MADUOC, d.TENHANG, d.TENDUOCDAYDU, d.DONVITINH as DONVITINH, d.BHYT,        d.TENHOATCHAT, d.HAMLUONG, d.HANGSANXUAT, d.QUOCGIA, d.LOAIDUOC_ID, d.DUONGDUNG_ID, d.TINHTIEN_PTTT,        ten.TENDUOC, ten.TENDUOC_EN, ten.MAQUOCTE, ten.MAQUOCTEBT,d.CONGDUNG,        CASE WHEN d.BHYT = '1' THEN 'BHYT' ELSE '' END as BHYT_TEXT        , ld.LOAIVATTU_ID        , d.BENHVIEN_ID,        tk.SOLUONG, d.VTYT_PHANLOAI, d.PHAMVI, d.SUASOLUONGTONGHOP, d.MADUOCBV, d.DANGTRINHBAY        , TAMNGUNG = CASE WHEN d.TAMNGUNG = '1' OR nh.TAMNGUNG = '1' OR kd.TAMNGUNG = '1' THEN '1' ELSE '0' END        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        inner join        (        select  LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')) DUOC_KEY, (SUM(dtk.SOLUONG) - isnull(sum(A.SOLUONG),0) - isnull(sum(B.SOLUONG),0)) SOLUONG, pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        from (select sum(soluong) soluong,duoc_id,nguonduoc_id,khoduoc_id,benhvien_id from TT_DUOC_TONKHO  group by duoc_id,nguonduoc_id,khoduoc_id,benhvien_id) dtk        inner join TM_DUOC_PHAMVISD_MAPPING pvsd on dtk.KHODUOC_ID = pvsd.KHODUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NOITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) B on B.DUOC_ID = dtk.DUOC_ID and B.SOLUONG > 0 and B.PHAMVI_ID = pvsd.PHAMVI_ID and B.NGUONHANG_ID = dtk.NGUONDUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NGOAITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) A on A.DUOC_ID = dtk.DUOC_ID and A.SOLUONG > 0 and A.PHAMVI_ID = pvsd.PHAMVI_ID and A.NGUONHANG_ID = dtk.NGUONDUOC_ID        where dtk.SOLUONG > 0 and dtk.BENHVIEN_ID = 'HLU01'        group by LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')), pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        ) tk on tk.DUOC_ID = d.DUOC_ID        left join TM_DUOC_PHAMVISUDUNG kd on kd.PHAMVI_ID = tk.PHAMVI_ID and kd.BENHVIEN_ID = 'HLU01'        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = tk.NGUONDUOC_ID and nh.BENHVIEN_ID = 'HLU01'        where d.BENHVIEN_ID = 'HLU01'  and tk.SOLUONG >= 0        end        else        begin                  select  distinct tk.DUOC_KEY, LTRIM(tk.PHAMVI_ID) as PHAMVI_ID, tk.NGUONDUOC_ID, nh.TENNGUONDUOC, nh.TINHTIEN, d.DUOC_ID, ld.MALOAIDUOC,        d.SOVISA,d.TYLE_VAT,d.COTOA, d.MADUOC, d.TENHANG, d.TENDUOCDAYDU, d.DONVITINH as DONVITINH, d.BHYT,        d.TENHOATCHAT, d.HAMLUONG, d.HANGSANXUAT, d.QUOCGIA, d.LOAIDUOC_ID, d.DUONGDUNG_ID, d.TINHTIEN_PTTT,        ten.TENDUOC, ten.TENDUOC_EN, ten.MAQUOCTE, ten.MAQUOCTEBT,d.CONGDUNG,        CASE WHEN d.BHYT = '1' THEN 'BHYT' ELSE '' END as BHYT_TEXT        , ld.LOAIVATTU_ID        , d.BENHVIEN_ID,        tk.SOLUONG, d.VTYT_PHANLOAI, d.PHAMVI, d.SUASOLUONGTONGHOP, d.MADUOCBV, d.DANGTRINHBAY        , TAMNGUNG = CASE WHEN d.TAMNGUNG = '1' OR nh.TAMNGUNG = '1' OR kd.TAMNGUNG = '1' THEN '1' ELSE '0' END        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        inner join        (        select  LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')) DUOC_KEY, (SUM(dtk.SOLUONG) - isnull(sum(A.SOLUONG),0) - isnull(sum(B.SOLUONG),0)) SOLUONG, pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        from (select sum(soluong) soluong,duoc_id,nguonduoc_id,khoduoc_id,benhvien_id from TT_DUOC_TONKHO  group by duoc_id,nguonduoc_id,khoduoc_id,benhvien_id) dtk        inner join TM_DUOC_PHAMVISD_MAPPING pvsd on dtk.KHODUOC_ID = pvsd.KHODUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NOITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) B on B.DUOC_ID = dtk.DUOC_ID and B.SOLUONG > 0 and B.PHAMVI_ID = pvsd.PHAMVI_ID and B.NGUONHANG_ID = dtk.NGUONDUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NGOAITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) A on A.DUOC_ID = dtk.DUOC_ID and A.SOLUONG > 0 and A.PHAMVI_ID = pvsd.PHAMVI_ID and A.NGUONHANG_ID = dtk.NGUONDUOC_ID        where dtk.SOLUONG > 0 and dtk.BENHVIEN_ID = 'HLU01'        group by LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')), pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        ) tk on tk.DUOC_ID = d.DUOC_ID        left join TM_DUOC_PHAMVISUDUNG kd on kd.PHAMVI_ID = tk.PHAMVI_ID and kd.BENHVIEN_ID = 'HLU01'        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = tk.NGUONDUOC_ID and nh.BENHVIEN_ID = 'HLU01'        where d.BENHVIEN_ID = 'HLU01'  and tk.SOLUONG >= 0        end]
2020-01-02 11:18:10,232 [5] DEBUG - Statement Id: [DAO00320_GetList] PreparedStatement : [select M.*            from TM_MAU M            LEFT JOIN TM_MAU_DONVITINH DVT on M.DONVITINH_ID=DVT.DONVITINH_ID            where            M.TAMNGUNG = '0'            and M.BENHVIEN_ID = 'HLU01'            order by M.TENMAU]
2020-01-02 11:18:10,300 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM071']
2020-01-02 11:18:10,332 [5] DEBUG - Statement Id: [DAO00322_GetListMauTonKhoForCreateCached] PreparedStatement : [SELECT DISTINCT        TK.MAU_KEY, TK.KHOMAU_ID, M.MAU_ID, M.MAMAU, M.TENMAU, M.NHOM_ABO, M.NHOM_RH, M.LOAIMAU_ID,        TK.SOLONHAP_ID, SLN.SOLONHAP, SLN.SOKIEMSOAT, TK.NGUONHANG_ID, NG.TENNGUONMAU, M.BENHVIEN_ID, M.DONVITINH_ID,        SUM(tk.SOLUONG) AS SOLUONG,K.TENKHO,DVT.TENDONVITINH        FROM TT_MAU_TONKHO TK        JOIN TM_KHO K ON TK.KHOMAU_ID = K.KHO_ID        JOIN TT_MAU_CHUNGTU_SOLONHAP SLN ON TK.SOLONHAP_ID = SLN.SOLONHAP_ID        JOIN TM_MAU M on TK.MAU_ID = M.MAU_ID and M.TAMNGUNG = '0'        LEFT JOIN TM_MAU_DONVITINH DVT on M.DONVITINH_ID=DVT.DONVITINH_ID        LEFT JOIN TM_NGUONMAU NG ON NG.NGUONMAU_ID = TK.NGUONHANG_ID        WHERE TK.SOLUONG > 0        GROUP BY TK.MAU_KEY, TK.KHOMAU_ID, M.MAU_ID, M.MAMAU, M.TENMAU, M.NHOM_ABO, M.NHOM_RH, M.LOAIMAU_ID,        TK.SOLONHAP_ID, SLN.SOLONHAP, SLN.SOKIEMSOAT,TK.NGUONHANG_ID, NG.TENNGUONMAU, M.BENHVIEN_ID, M.DONVITINH_ID,K.TENKHO,DVT.TENDONVITINH]
2020-01-02 11:18:10,405 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM073']
2020-01-02 11:18:10,441 [5] DEBUG - Statement Id: [DAO00322_GetListMauTonKhoTruBooking] PreparedStatement : [select distinct        TK.MAU_KEY, TK.KHOMAU_ID, M.MAU_ID, M.MAMAU, M.TENMAU, M.NHOM_ABO, M.NHOM_RH, M.LOAIMAU_ID, M.DONVITINH_ID,        TK.SOLONHAP_ID, TK.SOLONHAP, TK.SOKIEMSOAT,M.PHAMVI, TK.NGUONHANG_ID, NG.TENNGUONMAU, M.BENHVIEN_ID,        TK.SOLUONG,TK.TENKHO,DVT.TENDONVITINH        from TM_MAU M        JOIN        (        select        A.MAU_KEY, A.KHOMAU_ID, A.MAU_ID ,a.NGUONHANG_ID, A.SOLONHAP_ID, A.SOLONHAP, A.SOKIEMSOAT, A.SOLUONG,A.TENKHO        from        (        select KHOMAU_ID, TK.MAU_ID, TK.NGUONHANG_ID, TK.MAU_KEY, SLN.SOLONHAP_ID, SLN.SOLONHAP, SLN.SOKIEMSOAT, ISNULL(TK.SOLUONG,0) - ISNULL(book.SOLUONG,0) as SOLUONG,K.TENKHO        from TT_MAU_TONKHO TK        JOIN TM_KHO K ON TK.KHOMAU_ID = K.KHO_ID        inner join TT_MAU_CHUNGTU_SOLONHAP SLN ON TK.SOLONHAP_ID = SLN.SOLONHAP_ID        left join dbo.TT_MAU_TONKHO_BOOK book ON book.MAU_KEY = TK.MAU_KEY AND book.TRANGTHAI = 'HIEULUC'        where ISNULL(TK.SOLUONG,0) - ISNULL(book.SOLUONG,0) > 0        ) A        )TK on TK.MAU_ID = M.MAU_ID and M.TAMNGUNG = '0'        LEFT JOIN TM_MAU_DONVITINH DVT on M.DONVITINH_ID=DVT.DONVITINH_ID        LEFT JOIN TM_NGUONMAU NG ON NG.NGUONMAU_ID = TK.NGUONHANG_ID]
2020-01-02 11:18:10,513 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM072']
2020-01-02 11:18:11,440 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'MAIN'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2020-01-02 11:18:12,368 [1] DEBUG - Statement Id: [DAO00002_FormList] PreparedStatement : [select              TM_SYS_FORM.HOSPITAL_ID,              TM_SYS_FORM.NAME,              TM_SYS_FORM.CLASS,              TM_SYS_FORM.ASSEMBLY,              TM_SYS_FORM.TITLE_VI as TITLE              from TM_SYS_FORM              where HOSPITAL_ID = 'HLU01']
2020-01-02 11:18:18,278 [1] DEBUG - Statement Id: [DAO00300_GetShortcutListByUserID] PreparedStatement : [SELECT S.SHORTCUT_CODE, S.SHORTCUT_VALUE              FROM TM_SHORTCUT AS S              WHERE S.BENHVIEN_ID = 'HLU01' AND S.USER_ID = '1' AND TAMNGUNG = '0']
2020-01-02 11:18:18,307 [1] DEBUG - Statement Id: [DAO00087_GetList] PreparedStatement : [select CODE, VALUE, BENHVIEN_ID              from TM_SYS_APPSETTINGS              where LOCKED = '0' and BENHVIEN_ID = 'HLU01'              order by SETTING_ID]
2020-01-02 11:18:18,412 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'MSG01'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2020-01-02 11:18:18,542 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'MSG02'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2020-01-02 11:18:18,704 [1] DEBUG - Statement Id: [DAO00008_GetUserSettings] PreparedStatement : [select A.*, B.TENKHO , C.TENPHONGBAN, B.MAKHO, C.MAPHONGBAN          from TM_SYS_USERS A          left join TM_KHODUOC B on B.KHODUOC_ID = A.INVENTORY_ID          left join TM_PHONGBAN C on (C.PHONGBAN_ID = A.WORKING_DEPT_ID and C.BENHVIEN_ID =  @param0 )          left join TM_SYS_USERKHO D on (D.ACCOUNT_ID = A.ACCOUNT_ID and D.HOSPITAL_ID =  @param0 )          where          A.HOSPITAL_ID =  @param0            and                 A.ACCOUNT_ID =  @param1]
2020-01-02 11:18:18,706 [1] DEBUG - Statement Id: [DAO00008_GetUserSettings] Parameters: [@param0=[HOSPITAL_ID,HLU01], @param1=[ACCOUNT_ID,113]]
2020-01-02 11:18:18,706 [1] DEBUG - Statement Id: [DAO00008_GetUserSettings] Types: [@param0=[String, System.String], @param1=[String, System.String]]
2020-01-02 11:18:18,734 [1] DEBUG - Statement Id: [DAO00008_GetUserInvSettings] PreparedStatement : [select A.*, B.TENKHO, B.MAKHO, B.LOAIKHO_ID, B.KHOQUANLY_ID          from TM_SYS_USERKHO A          left join TM_KHO B on B.MODULE_ID = A.MODULE_ID and B.KHO_ID = A.KHO_ID          where A.HOSPITAL_ID =  @param0  and A.ACCOUNT_ID =  @param1           order by B.TENKHO]
2020-01-02 11:18:18,734 [1] DEBUG - Statement Id: [DAO00008_GetUserInvSettings] Parameters: [@param0=[HOSPITAL_ID,HLU01], @param1=[ACCOUNT_ID,113]]
2020-01-02 11:18:18,735 [1] DEBUG - Statement Id: [DAO00008_GetUserInvSettings] Types: [@param0=[String, System.String], @param1=[String, System.String]]
2020-01-02 11:18:18,884 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'COM30'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2020-01-02 11:18:19,058 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'RIS04'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2020-01-02 11:18:30,302 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'MENU1'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2020-01-02 11:18:30,396 [1] DEBUG - Statement Id: [DAO00011_GetList] PreparedStatement : [select              TM_SYS_MENU.ID,              TM_SYS_MENU.PARENTID,              TM_SYS_MENU.SCREEN,              TM_SYS_MENU.SMALLIMAGE,              TM_SYS_MENU.LARGEIMAGE,              TM_SYS_MENU.DESCRIPTION,              TM_SYS_MENU.TYPE,              TM_SYS_MENU.TITLE_VI as TITLE              from TM_SYS_MENU              where TM_SYS_MENU.HOSPITAL_ID = 'HLU01' and TM_SYS_MENU.ACTIVE = '1'               AND                   (TM_SYS_MENU.TYPE & '8' = '8')                             order by TM_SYS_MENU.ORDERNUM]
2020-01-02 11:18:30,685 [1] DEBUG - Statement Id: [DAO00011_usermenu_list] PreparedStatement : [select              TM_SYS_HOMEMENU.MENUID as ID,              TM_SYS_MENU.TITLE_VI as TITLE,              TM_SYS_MENU.SCREEN,              TM_SYS_MENU.SMALLIMAGE,              TM_SYS_MENU.LARGEIMAGE,              TM_SYS_MENU.TYPE              from TM_SYS_HOMEMENU              left join TM_SYS_MENU on TM_SYS_MENU.ID = TM_SYS_HOMEMENU.MENUID and TM_SYS_MENU.HOSPITAL_ID = TM_SYS_HOMEMENU.HOSPITAL_ID              where TM_SYS_HOMEMENU.HOSPITAL_ID = 'HLU01' and TM_SYS_HOMEMENU.USERID = '113' and TM_SYS_MENU.ACTIVE = '1'               AND                   (TM_SYS_MENU.TYPE & '8' = '8')                             ORDER BY TM_SYS_HOMEMENU.ORDERNUM]
2020-01-02 11:18:34,503 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'REG14'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2020-01-02 11:18:35,982 [1] DEBUG - Statement Id: [DAO00012_GetList] PreparedStatement : [select        DICTIONARY_ID,        DICTIONARY_CODE,        DICTIONARY_NAME,        ATTRIBUTE1,        ATTRIBUTE2,        DICTIONARY_NAME_EN        from LST_DICTIONARY        where LST_DICTIONARY.Enabled = '1'         AND           LST_DICTIONARY.DICTIONARY_TYPE_CODE = 'PhanLoaiTiepNhan'                 order by LST_DICTIONARY.IDX]
2020-01-02 11:18:36,015 [1] DEBUG - Statement Id: [DAO00012_GetList] PreparedStatement : [select        DICTIONARY_ID,        DICTIONARY_CODE,        DICTIONARY_NAME,        ATTRIBUTE1,        ATTRIBUTE2,        DICTIONARY_NAME_EN        from LST_DICTIONARY        where LST_DICTIONARY.Enabled = '1'         AND           LST_DICTIONARY.DICTIONARY_TYPE_CODE = 'NguonBN'                 order by LST_DICTIONARY.IDX]
2020-01-02 11:18:36,042 [1] DEBUG - Statement Id: [DAO00019_GetListCongTyChiTra] PreparedStatement : [select *        from TM_CONGTYCHITRA        where        BENHVIEN_ID = 'HLU01' AND TAMNGUNG = '0']
2020-01-02 11:18:36,265 [1] DEBUG - Statement Id: [DAO00017_GetListPhongKham] PreparedStatement : [select pb.PHONGBAN_ID, pb.TENPHONGBAN, case when dv.ATTRIBUTE5 is null then 'TT' else 'KTC' end as LOAI_CHIPHI              from [TM_PHONGBAN_DICHVU] as pb_dv              inner join [TM_PHONGBAN] as pb on pb.PHONGBAN_ID = pb_dv.PHONGBAN_ID and pb.BENHVIEN_ID = 'HLU01'              inner join [TM_DICHVU] dv on dv.DICHVU_ID = pb_dv.DICHVU_ID and dv.MADICHVU = '' and dv.BENHVIEN_ID = 'HLU01'              where pb_dv.BENHVIEN_ID = 'HLU01']
2020-01-02 11:18:36,302 [1] DEBUG - Statement Id: [DAO00019_GetListPhongKham_REG13] PreparedStatement : [select pb.PHONGBAN_ID, pb.TENPHONGBAN, case when dv.ATTRIBUTE5 is null then 'TT' else 'KTC' end as LOAI_CHIPHI        from TM_PHONGBAN pb        left join TM_PHONGBAN_DICHVU pb_dv on pb_dv.PHONGBAN_ID = pb.PHONGBAN_ID and pb_dv.BENHVIEN_ID = pb.BENHVIEN_ID        left join TM_DICHVU dv on dv.DICHVU_ID = pb_dv.DICHVU_ID and dv.BENHVIEN_ID = pb_dv.BENHVIEN_ID        left join TM_NHOMDICHVU ndv on ndv.NHOMDICHVU_ID = dv.NHOMDICHVU_ID and ndv.BENHVIEN_ID = dv.BENHVIEN_ID        where pb.BENHVIEN_ID = 'HLU01' and ndv.MANHOMDICHVU = '04' and dv.DICHVU_ID IS NOT NULL]
2020-01-02 11:18:36,392 [1] DEBUG - Statement Id: [DAO00019_LayThongTinSoluongDichVuPhongKham_REG13] PreparedStatement : [select PHONGBAN_ID, TENPHONGBAN, NOITHUCHIEN_ID, SUM(CHUAKETQUA) AS CHUAKETQUA, SUM(HOANTAT) AS HOANTAT, SUM(DANGTHUCHIEN) AS DANGTHUCHIEN        from (        select B.PHONGBAN_ID, B.TENPHONGBAN, A.NOITHUCHIEN_ID,        case when A.TRANGTHAI = 'CHUAKETQUA' then 1 else 0 end AS CHUAKETQUA,        case when A.TRANGTHAI = 'HOANTAT' then 1 else 0 end AS HOANTAT,        case when A.TRANGTHAI = 'DANGTHUCHIEN' then 1 else 0 end AS DANGTHUCHIEN        from TM_PHONGBAN B        left join TT_DVYEUCAU A on A.NOITHUCHIEN_ID = B.PHONGBAN_ID and A.BENHVIEN_ID = B.BENHVIEN_ID and A.NGAYYEUCAU = CONVERT(date, getdate())        left join TM_DICHVU dv on A.DICHVU_ID = dv.DICHVU_ID        left join TM_NHOMDICHVU ndv on ndv.NHOMDICHVU_ID = dv.NHOMDICHVU_ID        where B.BENHVIEN_ID ='HLU01' and Left(ndv.MANHOMDICHVU,2) = '04'        and B.PHONGBAN_ID in (65,71,72,41,68,62,177,67,55,81,57,57,58,59,60,63,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,61,69,69,70,70)        ) tmp        group by tmp.NOITHUCHIEN_ID, tmp.TENPHONGBAN, tmp.PHONGBAN_ID]
2020-01-02 11:18:58,318 [1] DEBUG - Statement Id: [DAO00087_GetServiceParams] PreparedStatement : [select CODE, VALUE              from TM_SYS_APPSETTINGS              where LOCKED = '0' and BENHVIEN_ID = 'HLU01']
2020-01-02 11:18:58,409 [1] DEBUG - Statement Id: [DAO00095_GetDetailTrungBN] PreparedStatement : [select  TT_TIEPNHAN.NGAYTIEPNHAN AS NGAYTIEPNHAN ,TT_TIEPNHAN.SOBHYT AS SOTHE, TT_BENHNHAN.*, ISNULL(TT_BENHNHAN.NGAYSINH,TT_BENHNHAN.NAMSINH) AS NGAYNAMSINH          from TT_BENHNHAN          left join TT_TIEPNHAN  ON          TT_TIEPNHAN.TIEPNHAN_ID = (SELECT TOP 1 TIEPNHAN_ID FROM TT_TIEPNHAN WHERE BENHNHAN_ID = TT_BENHNHAN.BENHNHAN_ID ORDER BY THOIGIANTIEPNHAN DESC)           WHERE                TT_BENHNHAN.TENBENHNHAN = N'Vương Thị Xâm'             AND               convert(varchar(10),TT_BENHNHAN.NGAYSINH, 103) = convert(varchar(10),'04/10/1984', 103)               AND               TT_BENHNHAN.GIOITINH = '2']
2020-01-02 11:19:24,885 [1] DEBUG - Statement Id: [DAO00000_GetKyHieuBHYT] PreparedStatement : [select * from TM_DOITUONG where NHOMTHE LIKE '%' +  @param0  + '%']
2020-01-02 11:19:24,885 [1] DEBUG - Statement Id: [DAO00000_GetKyHieuBHYT] Parameters: [@param0=[MATHEBHYT,DN4]]
2020-01-02 11:19:24,885 [1] DEBUG - Statement Id: [DAO00000_GetKyHieuBHYT] Types: [@param0=[String, System.String]]
2020-01-02 11:19:24,999 [1] DEBUG - Statement Id: [DAO00095_GetDetail] PreparedStatement : [select distinct TT_BENHNHAN.*, ISNULL(TT_BENHNHAN.NGAYSINH, TT_BENHNHAN.NAMSINH) AS NGAYNAMSINH, TN1.SOBHYT AS SOTHE, TN1.NGAYTIEPNHAN          from TT_BENHNHAN          left join (          select MAX(TIEPNHAN_ID) AS TIEPNHAN_ID, BENHNHAN_ID from TT_TIEPNHAN GROUP BY BENHNHAN_ID) TN ON TN.BENHNHAN_ID = TT_BENHNHAN.BENHNHAN_ID          left join TT_TIEPNHAN TN1 ON TN1.TIEPNHAN_ID = TN.TIEPNHAN_ID           WHERE                TN1.SOBHYT = 'DN438381202498038289']
2020-01-02 11:19:46,692 [1] DEBUG - Statement Id: [DAO00000_GetKyHieuBHYT] PreparedStatement : [select * from TM_DOITUONG where NHOMTHE LIKE '%' +  @param0  + '%']
2020-01-02 11:19:46,692 [1] DEBUG - Statement Id: [DAO00000_GetKyHieuBHYT] Parameters: [@param0=[MATHEBHYT,DN4]]
2020-01-02 11:19:46,692 [1] DEBUG - Statement Id: [DAO00000_GetKyHieuBHYT] Types: [@param0=[String, System.String]]
2020-01-02 11:20:28,729 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'REG13'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2020-01-02 11:20:28,880 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'COM98'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2020-01-02 11:21:31,592 [1] DEBUG - Statement Id: [DAO00000_GetKyHieuBHYT] PreparedStatement : [select * from TM_DOITUONG where NHOMTHE LIKE '%' +  @param0  + '%']
2020-01-02 11:21:31,593 [1] DEBUG - Statement Id: [DAO00000_GetKyHieuBHYT] Parameters: [@param0=[MATHEBHYT,DN4]]
2020-01-02 11:21:31,593 [1] DEBUG - Statement Id: [DAO00000_GetKyHieuBHYT] Types: [@param0=[String, System.String]]
2020-01-02 11:27:54,398 [1] DEBUG - Statement Id: [DAO00000_GetKyHieuBHYT] PreparedStatement : [select * from TM_DOITUONG where NHOMTHE LIKE '%' +  @param0  + '%']
2020-01-02 11:27:54,398 [1] DEBUG - Statement Id: [DAO00000_GetKyHieuBHYT] Parameters: [@param0=[MATHEBHYT,DN4]]
2020-01-02 11:27:54,398 [1] DEBUG - Statement Id: [DAO00000_GetKyHieuBHYT] Types: [@param0=[String, System.String]]
2020-01-02 11:29:34,407 [1] DEBUG - Statement Id: [DAO00000_GetKyHieuBHYT] PreparedStatement : [select * from TM_DOITUONG where NHOMTHE LIKE '%' +  @param0  + '%']
2020-01-02 11:29:34,407 [1] DEBUG - Statement Id: [DAO00000_GetKyHieuBHYT] Parameters: [@param0=[MATHEBHYT,DN4]]
2020-01-02 11:29:34,407 [1] DEBUG - Statement Id: [DAO00000_GetKyHieuBHYT] Types: [@param0=[String, System.String]]
2020-01-02 11:29:34,509 [1] DEBUG - Statement Id: [DAO00095_GetDetail] PreparedStatement : [select distinct TT_BENHNHAN.*, ISNULL(TT_BENHNHAN.NGAYSINH, TT_BENHNHAN.NAMSINH) AS NGAYNAMSINH, TN1.SOBHYT AS SOTHE, TN1.NGAYTIEPNHAN          from TT_BENHNHAN          left join (          select MAX(TIEPNHAN_ID) AS TIEPNHAN_ID, BENHNHAN_ID from TT_TIEPNHAN GROUP BY BENHNHAN_ID) TN ON TN.BENHNHAN_ID = TT_BENHNHAN.BENHNHAN_ID          left join TT_TIEPNHAN TN1 ON TN1.TIEPNHAN_ID = TN.TIEPNHAN_ID           WHERE                TN1.SOBHYT = 'DN438381202498038010']
2020-01-02 11:29:35,238 [1] DEBUG - Statement Id: [DAO00000_GetKyHieuBHYT] PreparedStatement : [select * from TM_DOITUONG where NHOMTHE LIKE '%' +  @param0  + '%']
2020-01-02 11:29:35,238 [1] DEBUG - Statement Id: [DAO00000_GetKyHieuBHYT] Parameters: [@param0=[MATHEBHYT,DN4]]
2020-01-02 11:29:35,238 [1] DEBUG - Statement Id: [DAO00000_GetKyHieuBHYT] Types: [@param0=[String, System.String]]
2020-01-02 11:30:04,024 [1] DEBUG - Statement Id: [DAO00000_GetKyHieuBHYT] PreparedStatement : [select * from TM_DOITUONG where NHOMTHE LIKE '%' +  @param0  + '%']
2020-01-02 11:30:04,024 [1] DEBUG - Statement Id: [DAO00000_GetKyHieuBHYT] Parameters: [@param0=[MATHEBHYT,DN4]]
2020-01-02 11:30:04,024 [1] DEBUG - Statement Id: [DAO00000_GetKyHieuBHYT] Types: [@param0=[String, System.String]]
2020-01-02 11:30:32,544 [1] DEBUG - Statement Id: [DAO00000_GetKyHieuBHYT] PreparedStatement : [select * from TM_DOITUONG where NHOMTHE LIKE '%' +  @param0  + '%']
2020-01-02 11:30:32,544 [1] DEBUG - Statement Id: [DAO00000_GetKyHieuBHYT] Parameters: [@param0=[MATHEBHYT,DN4]]
2020-01-02 11:30:32,544 [1] DEBUG - Statement Id: [DAO00000_GetKyHieuBHYT] Types: [@param0=[String, System.String]]
2020-01-02 11:30:32,642 [1] DEBUG - Statement Id: [DAO00095_GetDetail] PreparedStatement : [select distinct TT_BENHNHAN.*, ISNULL(TT_BENHNHAN.NGAYSINH, TT_BENHNHAN.NAMSINH) AS NGAYNAMSINH, TN1.SOBHYT AS SOTHE, TN1.NGAYTIEPNHAN          from TT_BENHNHAN          left join (          select MAX(TIEPNHAN_ID) AS TIEPNHAN_ID, BENHNHAN_ID from TT_TIEPNHAN GROUP BY BENHNHAN_ID) TN ON TN.BENHNHAN_ID = TT_BENHNHAN.BENHNHAN_ID          left join TT_TIEPNHAN TN1 ON TN1.TIEPNHAN_ID = TN.TIEPNHAN_ID           WHERE                TN1.SOBHYT = 'DN438381202498038289']
2020-01-02 11:30:33,782 [1] DEBUG - Statement Id: [DAO00000_GetKyHieuBHYT] PreparedStatement : [select * from TM_DOITUONG where NHOMTHE LIKE '%' +  @param0  + '%']
2020-01-02 11:30:33,782 [1] DEBUG - Statement Id: [DAO00000_GetKyHieuBHYT] Parameters: [@param0=[MATHEBHYT,DN4]]
2020-01-02 11:30:33,782 [1] DEBUG - Statement Id: [DAO00000_GetKyHieuBHYT] Types: [@param0=[String, System.String]]
2020-01-02 11:33:13,773 [1] DEBUG - Statement Id: [DAO00095_GetDetailTrungBN] PreparedStatement : [select  TT_TIEPNHAN.NGAYTIEPNHAN AS NGAYTIEPNHAN ,TT_TIEPNHAN.SOBHYT AS SOTHE, TT_BENHNHAN.*, ISNULL(TT_BENHNHAN.NGAYSINH,TT_BENHNHAN.NAMSINH) AS NGAYNAMSINH          from TT_BENHNHAN          left join TT_TIEPNHAN  ON          TT_TIEPNHAN.TIEPNHAN_ID = (SELECT TOP 1 TIEPNHAN_ID FROM TT_TIEPNHAN WHERE BENHNHAN_ID = TT_BENHNHAN.BENHNHAN_ID ORDER BY THOIGIANTIEPNHAN DESC)           WHERE                TT_BENHNHAN.TENBENHNHAN = N'Vương Thị Xám'             AND               convert(varchar(10),TT_BENHNHAN.NGAYSINH, 103) = convert(varchar(10),'04/10/1984', 103)               AND               TT_BENHNHAN.GIOITINH = '2']
2020-01-02 11:33:13,879 [1] DEBUG - Statement Id: [DAO00000_GetKyHieuBHYT] PreparedStatement : [select * from TM_DOITUONG where NHOMTHE LIKE '%' +  @param0  + '%']
2020-01-02 11:33:13,879 [1] DEBUG - Statement Id: [DAO00000_GetKyHieuBHYT] Parameters: [@param0=[MATHEBHYT,DN4]]
2020-01-02 11:33:13,879 [1] DEBUG - Statement Id: [DAO00000_GetKyHieuBHYT] Types: [@param0=[String, System.String]]
2020-01-02 11:33:34,958 [1] DEBUG - Statement Id: [DAO00000_GetKyHieuBHYT] PreparedStatement : [select * from TM_DOITUONG where NHOMTHE LIKE '%' +  @param0  + '%']
2020-01-02 11:33:34,958 [1] DEBUG - Statement Id: [DAO00000_GetKyHieuBHYT] Parameters: [@param0=[MATHEBHYT,DN4]]
2020-01-02 11:33:34,958 [1] DEBUG - Statement Id: [DAO00000_GetKyHieuBHYT] Types: [@param0=[String, System.String]]
2020-01-02 11:40:22,581 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'MTR01'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2020-01-02 11:40:23,499 [1] DEBUG - Statement Id: [DAO00209_ADM17] PreparedStatement : [SELECT *              FROM TM_SYS_APPSETTINGS              WHERE BENHVIEN_ID = 'HLU01' AND LOCKED = '0' AND TYPE = '0']
2020-01-02 11:40:40,587 [1] DEBUG - Statement Id: [DAO00209_ADM17] PreparedStatement : [SELECT *              FROM TM_SYS_APPSETTINGS              WHERE BENHVIEN_ID = 'HLU01' AND LOCKED = '0' AND TYPE = '2']
2020-01-02 11:40:40,905 [1] DEBUG - Statement Id: [DAO00209_ADM17] PreparedStatement : [SELECT *              FROM TM_SYS_APPSETTINGS              WHERE BENHVIEN_ID = 'HLU01' AND LOCKED = '0' AND TYPE = '2']
2020-01-02 11:44:57,861 [1] DEBUG - Statement Id: [DAO00095_GetDetailTrungBN] PreparedStatement : [select  TT_TIEPNHAN.NGAYTIEPNHAN AS NGAYTIEPNHAN ,TT_TIEPNHAN.SOBHYT AS SOTHE, TT_BENHNHAN.*, ISNULL(TT_BENHNHAN.NGAYSINH,TT_BENHNHAN.NAMSINH) AS NGAYNAMSINH          from TT_BENHNHAN          left join TT_TIEPNHAN  ON          TT_TIEPNHAN.TIEPNHAN_ID = (SELECT TOP 1 TIEPNHAN_ID FROM TT_TIEPNHAN WHERE BENHNHAN_ID = TT_BENHNHAN.BENHNHAN_ID ORDER BY THOIGIANTIEPNHAN DESC)           WHERE                TT_BENHNHAN.TENBENHNHAN = N'Tc3484820994845'             AND               convert(varchar(10),TT_BENHNHAN.NGAYSINH, 103) = convert(varchar(10),'04/10/1984', 103)               AND               TT_BENHNHAN.GIOITINH = '2']
2020-01-02 11:45:08,437 [1] DEBUG - Statement Id: [DAO00000_GetKyHieuBHYT] PreparedStatement : [select * from TM_DOITUONG where NHOMTHE LIKE '%' +  @param0  + '%']
2020-01-02 11:45:08,437 [1] DEBUG - Statement Id: [DAO00000_GetKyHieuBHYT] Parameters: [@param0=[MATHEBHYT,TC3]]
2020-01-02 11:45:08,437 [1] DEBUG - Statement Id: [DAO00000_GetKyHieuBHYT] Types: [@param0=[String, System.String]]
2020-01-02 11:45:08,587 [1] DEBUG - Statement Id: [DAO00095_GetDetail] PreparedStatement : [select distinct TT_BENHNHAN.*, ISNULL(TT_BENHNHAN.NGAYSINH, TT_BENHNHAN.NAMSINH) AS NGAYNAMSINH, TN1.SOBHYT AS SOTHE, TN1.NGAYTIEPNHAN          from TT_BENHNHAN          left join (          select MAX(TIEPNHAN_ID) AS TIEPNHAN_ID, BENHNHAN_ID from TT_TIEPNHAN GROUP BY BENHNHAN_ID) TN ON TN.BENHNHAN_ID = TT_BENHNHAN.BENHNHAN_ID          left join TT_TIEPNHAN TN1 ON TN1.TIEPNHAN_ID = TN.TIEPNHAN_ID           WHERE                TN1.SOBHYT = 'TC348482099484548027']
2020-01-02 11:45:16,916 [1] DEBUG - Statement Id: [DAO00095_GetDetailTrungBN] PreparedStatement : [select  TT_TIEPNHAN.NGAYTIEPNHAN AS NGAYTIEPNHAN ,TT_TIEPNHAN.SOBHYT AS SOTHE, TT_BENHNHAN.*, ISNULL(TT_BENHNHAN.NGAYSINH,TT_BENHNHAN.NAMSINH) AS NGAYNAMSINH          from TT_BENHNHAN          left join TT_TIEPNHAN  ON          TT_TIEPNHAN.TIEPNHAN_ID = (SELECT TOP 1 TIEPNHAN_ID FROM TT_TIEPNHAN WHERE BENHNHAN_ID = TT_BENHNHAN.BENHNHAN_ID ORDER BY THOIGIANTIEPNHAN DESC)           WHERE                TT_BENHNHAN.TENBENHNHAN = N'Hà Thị Mai'             AND               convert(varchar(10),TT_BENHNHAN.NGAYSINH, 103) = convert(varchar(10),'04/10/1984', 103)               AND               TT_BENHNHAN.GIOITINH = '2']
2020-01-02 11:45:26,739 [1] DEBUG - Statement Id: [DAO00095_GetDetailTrungBN] PreparedStatement : [select  TT_TIEPNHAN.NGAYTIEPNHAN AS NGAYTIEPNHAN ,TT_TIEPNHAN.SOBHYT AS SOTHE, TT_BENHNHAN.*, ISNULL(TT_BENHNHAN.NGAYSINH,TT_BENHNHAN.NAMSINH) AS NGAYNAMSINH          from TT_BENHNHAN          left join TT_TIEPNHAN  ON          TT_TIEPNHAN.TIEPNHAN_ID = (SELECT TOP 1 TIEPNHAN_ID FROM TT_TIEPNHAN WHERE BENHNHAN_ID = TT_BENHNHAN.BENHNHAN_ID ORDER BY THOIGIANTIEPNHAN DESC)           WHERE                TT_BENHNHAN.TENBENHNHAN = N'Hà Thị Mai'             AND               convert(varchar(10),TT_BENHNHAN.NGAYSINH, 103) = convert(varchar(10),'20/04/1950', 103)               AND               TT_BENHNHAN.GIOITINH = '2']
2020-01-02 11:45:39,917 [1] DEBUG - Statement Id: [DAO00000_GetKyHieuBHYT] PreparedStatement : [select * from TM_DOITUONG where NHOMTHE LIKE '%' +  @param0  + '%']
2020-01-02 11:45:39,917 [1] DEBUG - Statement Id: [DAO00000_GetKyHieuBHYT] Parameters: [@param0=[MATHEBHYT,TC3]]
2020-01-02 11:45:39,917 [1] DEBUG - Statement Id: [DAO00000_GetKyHieuBHYT] Types: [@param0=[String, System.String]]
2020-01-02 11:46:03,055 [1] DEBUG - Statement Id: [DAO00000_GetKyHieuBHYT] PreparedStatement : [select * from TM_DOITUONG where NHOMTHE LIKE '%' +  @param0  + '%']
2020-01-02 11:46:03,055 [1] DEBUG - Statement Id: [DAO00000_GetKyHieuBHYT] Parameters: [@param0=[MATHEBHYT,TC3]]
2020-01-02 11:46:03,055 [1] DEBUG - Statement Id: [DAO00000_GetKyHieuBHYT] Types: [@param0=[String, System.String]]
2020-01-02 15:36:08,452 [1] DEBUG - Statement Id: [DAO00000_GetKyHieuBHYT] PreparedStatement : [select * from TM_DOITUONG where NHOMTHE LIKE '%' +  @param0  + '%']
2020-01-02 15:36:08,494 [1] DEBUG - Statement Id: [DAO00000_GetKyHieuBHYT] Parameters: [@param0=[MATHEBHYT,TC3]]
2020-01-02 15:36:08,494 [1] DEBUG - Statement Id: [DAO00000_GetKyHieuBHYT] Types: [@param0=[String, System.String]]
2020-01-02 15:37:01,886 [1] DEBUG - Statement Id: [DAO00095_GetDetailTrungBN] PreparedStatement : [select  TT_TIEPNHAN.NGAYTIEPNHAN AS NGAYTIEPNHAN ,TT_TIEPNHAN.SOBHYT AS SOTHE, TT_BENHNHAN.*, ISNULL(TT_BENHNHAN.NGAYSINH,TT_BENHNHAN.NAMSINH) AS NGAYNAMSINH          from TT_BENHNHAN          left join TT_TIEPNHAN  ON          TT_TIEPNHAN.TIEPNHAN_ID = (SELECT TOP 1 TIEPNHAN_ID FROM TT_TIEPNHAN WHERE BENHNHAN_ID = TT_BENHNHAN.BENHNHAN_ID ORDER BY THOIGIANTIEPNHAN DESC)           WHERE                TT_BENHNHAN.TENBENHNHAN = N'Vương Thị Xâm'             AND               convert(varchar(10),TT_BENHNHAN.NGAYSINH, 103) = convert(varchar(10),'20/04/1950', 103)               AND               TT_BENHNHAN.GIOITINH = '2']
2020-01-02 15:37:09,455 [1] DEBUG - Statement Id: [DAO00095_GetDetailTrungBN] PreparedStatement : [select  TT_TIEPNHAN.NGAYTIEPNHAN AS NGAYTIEPNHAN ,TT_TIEPNHAN.SOBHYT AS SOTHE, TT_BENHNHAN.*, ISNULL(TT_BENHNHAN.NGAYSINH,TT_BENHNHAN.NAMSINH) AS NGAYNAMSINH          from TT_BENHNHAN          left join TT_TIEPNHAN  ON          TT_TIEPNHAN.TIEPNHAN_ID = (SELECT TOP 1 TIEPNHAN_ID FROM TT_TIEPNHAN WHERE BENHNHAN_ID = TT_BENHNHAN.BENHNHAN_ID ORDER BY THOIGIANTIEPNHAN DESC)           WHERE                TT_BENHNHAN.TENBENHNHAN = N'Vương Thị Xâm'             AND               convert(varchar(10),TT_BENHNHAN.NGAYSINH, 103) = convert(varchar(10),'04/10/1984', 103)               AND               TT_BENHNHAN.GIOITINH = '2']
2020-01-02 15:37:45,615 [1] DEBUG - Statement Id: [DAO00000_GetKyHieuBHYT] PreparedStatement : [select * from TM_DOITUONG where NHOMTHE LIKE '%' +  @param0  + '%']
2020-01-02 15:37:45,615 [1] DEBUG - Statement Id: [DAO00000_GetKyHieuBHYT] Parameters: [@param0=[MATHEBHYT,DN4]]
2020-01-02 15:37:45,616 [1] DEBUG - Statement Id: [DAO00000_GetKyHieuBHYT] Types: [@param0=[String, System.String]]
2020-01-02 15:37:45,867 [1] DEBUG - Statement Id: [DAO00095_GetDetail] PreparedStatement : [select distinct TT_BENHNHAN.*, ISNULL(TT_BENHNHAN.NGAYSINH, TT_BENHNHAN.NAMSINH) AS NGAYNAMSINH, TN1.SOBHYT AS SOTHE, TN1.NGAYTIEPNHAN          from TT_BENHNHAN          left join (          select MAX(TIEPNHAN_ID) AS TIEPNHAN_ID, BENHNHAN_ID from TT_TIEPNHAN GROUP BY BENHNHAN_ID) TN ON TN.BENHNHAN_ID = TT_BENHNHAN.BENHNHAN_ID          left join TT_TIEPNHAN TN1 ON TN1.TIEPNHAN_ID = TN.TIEPNHAN_ID           WHERE                TN1.SOBHYT = 'DN438381202498038289']
2020-01-02 15:37:50,114 [1] DEBUG - Statement Id: [DAO00000_GetKyHieuBHYT] PreparedStatement : [select * from TM_DOITUONG where NHOMTHE LIKE '%' +  @param0  + '%']
2020-01-02 15:37:50,114 [1] DEBUG - Statement Id: [DAO00000_GetKyHieuBHYT] Parameters: [@param0=[MATHEBHYT,DN4]]
2020-01-02 15:37:50,114 [1] DEBUG - Statement Id: [DAO00000_GetKyHieuBHYT] Types: [@param0=[String, System.String]]
--------------------------------------------------------------------------------
2020-01-02 15:43:26,316 [1] DEBUG - Statement Id: [DAO00001_DBList] PreparedStatement : [select *              from TM_SYS_SERVER              where HOSPITAL_ID = '_SYSTEM_' and TYPE = 'D']
2020-01-02 15:43:26,639 [1] DEBUG - Statement Id: [DAO00001_DaoList] PreparedStatement : [select              TM_SYS_SERVICEMAP.ID,              TM_SYS_SERVICEMAP.HOSPITAL_ID,              TM_SYS_SERVICEMAP.DB_NAME,              TM_SYS_SERVICEMAP.TYPE,              TM_SYS_SERVICEMAP.NAME,              TM_SYS_SERVICEMAP.CLASS,              (TM_SYS_DIC.VALUE + '.' + TM_SYS_SERVICEMAP.CLASS) as CLASSFULL,              TM_SYS_SERVICEMAP.ASSEMBLY              from TM_SYS_SERVICEMAP              inner join TM_SYS_DIC              on TM_SYS_SERVICEMAP.NAMESPACE = TM_SYS_DIC.ID              where HOSPITAL_ID = '_SYSTEM_' AND TYPE = 'D' AND ACTIVE = '1'              order by DB_NAME]
2020-01-02 15:43:26,676 [1] DEBUG - Statement Id: [DAO00001_ServiceList] PreparedStatement : [select              TM_SYS_SERVICEMAP.ID,              TM_SYS_SERVICEMAP.HOSPITAL_ID,              TM_SYS_SERVICEMAP.DB_NAME,              TM_SYS_SERVICEMAP.TYPE,              TM_SYS_SERVICEMAP.NAME,              TM_SYS_SERVICEMAP.CLASS,              (TM_SYS_DIC.VALUE + '.' + TM_SYS_SERVICEMAP.CLASS) as CLASSFULL,              TM_SYS_SERVICEMAP.ASSEMBLY,              TM_SYS_SERVER.URL              from TM_SYS_SERVICEMAP              inner join TM_SYS_DIC on TM_SYS_SERVICEMAP.NAMESPACE = TM_SYS_DIC.ID              inner join TM_SYS_SERVER on (TM_SYS_SERVICEMAP.DB_NAME = TM_SYS_SERVER.NAME) and (TM_SYS_SERVER.HOSPITAL_ID = '_SYSTEM_')              where TM_SYS_SERVICEMAP.HOSPITAL_ID = '_SYSTEM_' AND TM_SYS_SERVICEMAP.TYPE = 'S'  AND ACTIVE = '1'              order by URL]
2020-01-02 15:43:27,367 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = '_SYSTEM_'               AND                   TM_SYS_SCREEN.PAGE = 'LOGIN'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2020-01-02 15:43:27,787 [1] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = '_SYSTEM_'               AND                   TM_SYS_CACHE.ACTIVE = '1']
2020-01-02 15:43:35,239 [1] DEBUG - Statement Id: [DAO00001_DBList] PreparedStatement : [select *              from TM_SYS_SERVER              where HOSPITAL_ID = 'HLU01' and TYPE = 'D']
2020-01-02 15:43:35,266 [1] DEBUG - Statement Id: [DAO00001_DaoList] PreparedStatement : [select              TM_SYS_SERVICEMAP.ID,              TM_SYS_SERVICEMAP.HOSPITAL_ID,              TM_SYS_SERVICEMAP.DB_NAME,              TM_SYS_SERVICEMAP.TYPE,              TM_SYS_SERVICEMAP.NAME,              TM_SYS_SERVICEMAP.CLASS,              (TM_SYS_DIC.VALUE + '.' + TM_SYS_SERVICEMAP.CLASS) as CLASSFULL,              TM_SYS_SERVICEMAP.ASSEMBLY              from TM_SYS_SERVICEMAP              inner join TM_SYS_DIC              on TM_SYS_SERVICEMAP.NAMESPACE = TM_SYS_DIC.ID              where HOSPITAL_ID = 'HLU01' AND TYPE = 'D' AND ACTIVE = '1'              order by DB_NAME]
2020-01-02 15:43:41,983 [1] DEBUG - Statement Id: [DAO00001_ServiceList] PreparedStatement : [select              TM_SYS_SERVICEMAP.ID,              TM_SYS_SERVICEMAP.HOSPITAL_ID,              TM_SYS_SERVICEMAP.DB_NAME,              TM_SYS_SERVICEMAP.TYPE,              TM_SYS_SERVICEMAP.NAME,              TM_SYS_SERVICEMAP.CLASS,              (TM_SYS_DIC.VALUE + '.' + TM_SYS_SERVICEMAP.CLASS) as CLASSFULL,              TM_SYS_SERVICEMAP.ASSEMBLY,              TM_SYS_SERVER.URL              from TM_SYS_SERVICEMAP              inner join TM_SYS_DIC on TM_SYS_SERVICEMAP.NAMESPACE = TM_SYS_DIC.ID              inner join TM_SYS_SERVER on (TM_SYS_SERVICEMAP.DB_NAME = TM_SYS_SERVER.NAME) and (TM_SYS_SERVER.HOSPITAL_ID = 'HLU01')              where TM_SYS_SERVICEMAP.HOSPITAL_ID = 'HLU01' AND TM_SYS_SERVICEMAP.TYPE = 'S'  AND ACTIVE = '1'              order by URL]
2020-01-02 15:43:42,083 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1']
2020-01-02 15:43:43,372 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM005']
2020-01-02 15:43:46,897 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM015']
2020-01-02 15:43:47,157 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM067']
2020-01-02 15:43:47,370 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM008']
2020-01-02 15:43:47,565 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM068']
2020-01-02 15:43:47,889 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM006']
2020-01-02 15:43:48,156 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM030']
2020-01-02 15:43:48,287 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM025']
2020-01-02 15:43:48,360 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM024']
2020-01-02 15:43:49,091 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM033']
2020-01-02 15:43:49,178 [5] DEBUG - Statement Id: [DAO00027_GetListDuocKyGuiTonKho] PreparedStatement : [select  distinct TT_TONKHO.DUOC_KEY, LTRIM(TT_TONKHO.KHODUOC_ID) as KHODUOC_ID, TM_DUOC.DUOC_ID, TM_LOAIDUOC.MALOAIDUOC,TM_DUOC.SOVISA,TM_DUOC.TYLE_VAT,TM_DUOC.COTOA,        TM_DUOC.MADUOC, TM_DUOC.TENHANG, TM_DUOC.TENDUOCDAYDU, dvt.TENDONVITINH as DONVITINH,  TM_DUOC.DONVITINH_ID,TM_DUOC.BHYT,TM_DUOC.PHAMVI,        TM_DUOC.TENHOATCHAT, TM_DUOC.HAMLUONG, TM_DUOC.HANGSANXUAT, TM_DUOC.QUOCGIA, TM_DUOC.LOAIDUOC_ID, TM_DUOC.DUONGDUNG_ID,        TM_TENDUOC.TENDUOC, TM_TENDUOC.TENDUOC_EN, TM_TENDUOC.MAQUOCTE, TM_TENDUOC.MAQUOCTEBT,        TM_LOAIDUOC.LOAIVATTU_ID, TM_DUOC.BENHVIEN_ID,TT_TONKHO.SOLUONG, TT_TONKHO.NGUONDUOC_ID, NH.TENNGUONDUOC        , TAMNGUNG = CASE WHEN TM_DUOC.TAMNGUNG = '1' OR nh.TAMNGUNG = '1' OR KD.TAMNGUNG = '1' THEN '1' ELSE '0' END        , TM_DUOC.DANGTRINHBAY        from TM_DUOC        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = TM_DUOC.DONVITINH_ID        left join TM_TENDUOC on TM_DUOC.TENDUOC_ID = TM_TENDUOC.TENDUOC_ID and TM_DUOC.BENHVIEN_ID = 'HLU01' and TM_DUOC.TAMNGUNG = '0'        left join TM_LOAIDUOC on TM_LOAIDUOC.LOAIDUOC_ID = TM_DUOC.LOAIDUOC_ID and TM_LOAIDUOC.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG on (TM_LOAIDUOC.LOAIVATTU_ID = TM_DUOC_HANDUNG.LOAIDUOC and TM_DUOC_HANDUNG.BENHVIEN_ID = 'HLU01')        inner join        (select LTRIM(A.KHODUOC_ID) + '_' + LTRIM(A.DUOC_ID) + '_' + LTRIM(ISNULL(A.NGUONDUOC_ID,'')) as DUOC_KEY, A.KHODUOC_ID, A.DUOC_ID,A.NGUONDUOC_ID,        SUM(isnull(A.SOLUONG,0)) as SOLUONG        from        (select SUM(SOLUONG) as SOLUONG, KHODUOC_ID, DUOC_ID, NGUONDUOC_ID from TT_DUOC_KYGUI_TONKHO        where BENHVIEN_ID = 'HLU01' group by KHODUOC_ID, DUOC_ID, NGUONDUOC_ID) A        group by LTRIM(A.KHODUOC_ID) + '_' + LTRIM(A.DUOC_ID) + '_' + LTRIM(A.NGUONDUOC_ID), A.KHODUOC_ID, A.DUOC_ID, A.NGUONDUOC_ID)        TT_TONKHO on TT_TONKHO.DUOC_ID = TM_DUOC.DUOC_ID        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = TT_TONKHO.NGUONDUOC_ID and nh.BENHVIEN_ID = 'HLU01'        LEFT JOIN TM_KHODUOC KD ON KD.KHODUOC_ID = TT_TONKHO.KHODUOC_ID        where TM_DUOC.BENHVIEN_ID = 'HLU01' AND TT_TONKHO.SOLUONG >= 0]
2020-01-02 15:43:49,264 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM018']
2020-01-02 15:43:50,113 [5] DEBUG - Statement Id: [DAO00027_GetListDuocTonKho] PreparedStatement : [select distinct TT_TONKHO.DUOC_KEY, LTRIM(TT_TONKHO.KHODUOC_ID) as KHODUOC_ID, TM_DUOC.DUOC_ID, TM_LOAIDUOC.MALOAIDUOC,TM_DUOC.SOVISA,TM_DUOC.TYLE_VAT,TM_DUOC.COTOA,        TM_DUOC.MADUOC, TM_DUOC.TENHANG, TM_DUOC.TENDUOCDAYDU, dvt.TENDONVITINH as DONVITINH,  TM_DUOC.DONVITINH_ID,TM_DUOC.BHYT,                TM_DUOC.TENHOATCHAT,          TM_DUOC.HAMLUONG, TM_DUOC.HANGSANXUAT, TM_DUOC.QUOCGIA, TM_DUOC.LOAIDUOC_ID, TM_DUOC.DUONGDUNG_ID,        TM_TENDUOC.TENDUOC, TM_TENDUOC.TENDUOC_EN, TM_TENDUOC.MAQUOCTE, TM_TENDUOC.MAQUOCTEBT,        TM_LOAIDUOC.LOAIVATTU_ID, TM_DUOC.BENHVIEN_ID,        TT_TONKHO.SOLUONG, TM_DUOC.VTYT_PHANLOAI, TM_DUOC.PHAMVI, TT_TONKHO.NGUONDUOC_ID, NG.TENNGUONDUOC AS TENNGUONDUOC        , TAMNGUNG = CASE WHEN TM_DUOC.TAMNGUNG = '1' OR NG.TAMNGUNG = '1' OR KD.TAMNGUNG = '1' THEN '1' ELSE '0' END        , TM_DUOC.DANGTRINHBAY        from TM_DUOC        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = TM_DUOC.DONVITINH_ID        left join TM_TENDUOC on TM_DUOC.TENDUOC_ID = TM_TENDUOC.TENDUOC_ID and TM_DUOC.BENHVIEN_ID = 'HLU01' and TM_DUOC.TAMNGUNG = '0'        left join TM_LOAIDUOC on TM_LOAIDUOC.LOAIDUOC_ID = TM_DUOC.LOAIDUOC_ID and TM_LOAIDUOC.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG on (TM_LOAIDUOC.LOAIVATTU_ID = TM_DUOC_HANDUNG.LOAIDUOC and TM_DUOC_HANDUNG.BENHVIEN_ID = 'HLU01')        inner join        (select LTRIM(A.KHODUOC_ID) + '_' + LTRIM(A.DUOC_ID) + '_' + LTRIM(ISNULL(A.NGUONDUOC_ID,'')) as DUOC_KEY, A.KHODUOC_ID, A.DUOC_ID, A.NGUONDUOC_ID,        SUM(isnull(A.SOLUONG,0)) as SOLUONG        from        (select SUM(SOLUONG) as SOLUONG, KHODUOC_ID, DUOC_ID, NGUONDUOC_ID from TT_DUOC_TONKHO        where BENHVIEN_ID = 'HLU01' group by KHODUOC_ID, DUOC_ID, NGUONDUOC_ID) A        group by LTRIM(A.KHODUOC_ID) + '_' + LTRIM(A.DUOC_ID) + '_' + LTRIM(ISNULL(A.NGUONDUOC_ID,'')), A.KHODUOC_ID, A.DUOC_ID, NGUONDUOC_ID        ) TT_TONKHO on TT_TONKHO.DUOC_ID = TM_DUOC.DUOC_ID        LEFT JOIN TM_NGUONHANG NG ON NG.NGUONDUOC_ID = TT_TONKHO.NGUONDUOC_ID        LEFT JOIN TM_KHODUOC KD ON KD.KHODUOC_ID = TT_TONKHO.KHODUOC_ID        where TM_DUOC.BENHVIEN_ID = 'HLU01' and TT_TONKHO.SOLUONG >= 0]
2020-01-02 15:43:51,634 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM023']
2020-01-02 15:43:51,726 [5] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoVaBooking] PreparedStatement : [declare @NGUONDUOC_MACDINH varchar(5) = '0';        declare @TOAMUANGOAI int = 0;        select @NGUONDUOC_MACDINH = isnull(VALUE,0) from TM_SYS_APPSETTINGS where CODE = 'PHA_NGUONDUOC'        select @TOAMUANGOAI = isnull(VALUE,0) from TM_SYS_APPSETTINGS where CODE = 'OPD_TOAMUANGOAI_DUNGDANHMUC_DUOC'                if @TOAMUANGOAI = 1        begin        select  distinct '0' + '_' + LTRIM(d.DUOC_ID) + '_' + @NGUONDUOC_MACDINH as DUOC_KEY, 0 as PHAMVI_ID, @NGUONDUOC_MACDINH as NGUONDUOC_ID, null as TENNGUONDUOC, null as TINHTIEN, d.DUOC_ID, ld.MALOAIDUOC,        d.SOVISA,d.TYLE_VAT,d.COTOA, d.MADUOC, d.TENHANG, d.TENDUOCDAYDU, d.DONVITINH as DONVITINH, d.BHYT,        d.TENHOATCHAT, d.HAMLUONG, d.HANGSANXUAT, d.QUOCGIA, d.LOAIDUOC_ID, d.DUONGDUNG_ID, d.TINHTIEN_PTTT,        ten.TENDUOC, ten.TENDUOC_EN, ten.MAQUOCTE, ten.MAQUOCTEBT,d.CONGDUNG,        '' as BHYT_TEXT        , ld.LOAIVATTU_ID        , d.BENHVIEN_ID,        999999999 as SOLUONG, d.VTYT_PHANLOAI, d.PHAMVI, d.SUASOLUONGTONGHOP, d.MADUOCBV, d.DANGTRINHBAY        , TAMNGUNG = CASE WHEN d.TAMNGUNG = '1' THEN '1' ELSE '0' END        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        union all        select  distinct tk.DUOC_KEY, LTRIM(tk.PHAMVI_ID) as PHAMVI_ID, tk.NGUONDUOC_ID, nh.TENNGUONDUOC, nh.TINHTIEN, d.DUOC_ID, ld.MALOAIDUOC,        d.SOVISA,d.TYLE_VAT,d.COTOA, d.MADUOC, d.TENHANG, d.TENDUOCDAYDU, d.DONVITINH as DONVITINH, d.BHYT,        d.TENHOATCHAT, d.HAMLUONG, d.HANGSANXUAT, d.QUOCGIA, d.LOAIDUOC_ID, d.DUONGDUNG_ID, d.TINHTIEN_PTTT,        ten.TENDUOC, ten.TENDUOC_EN, ten.MAQUOCTE, ten.MAQUOCTEBT,d.CONGDUNG,        CASE WHEN d.BHYT = '1' THEN 'BHYT' ELSE '' END as BHYT_TEXT        , ld.LOAIVATTU_ID        , d.BENHVIEN_ID,        tk.SOLUONG, d.VTYT_PHANLOAI, d.PHAMVI, d.SUASOLUONGTONGHOP, d.MADUOCBV, d.DANGTRINHBAY        , TAMNGUNG = CASE WHEN d.TAMNGUNG = '1' OR nh.TAMNGUNG = '1' OR kd.TAMNGUNG = '1' THEN '1' ELSE '0' END        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        inner join        (        select  LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')) DUOC_KEY, (SUM(dtk.SOLUONG) - isnull(sum(A.SOLUONG),0) - isnull(sum(B.SOLUONG),0)) SOLUONG, pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        from (select sum(soluong) soluong,duoc_id,nguonduoc_id,khoduoc_id,benhvien_id from TT_DUOC_TONKHO  group by duoc_id,nguonduoc_id,khoduoc_id,benhvien_id) dtk        inner join TM_DUOC_PHAMVISD_MAPPING pvsd on dtk.KHODUOC_ID = pvsd.KHODUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NOITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) B on B.DUOC_ID = dtk.DUOC_ID and B.SOLUONG > 0 and B.PHAMVI_ID = pvsd.PHAMVI_ID and B.NGUONHANG_ID = dtk.NGUONDUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NGOAITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) A on A.DUOC_ID = dtk.DUOC_ID and A.SOLUONG > 0 and A.PHAMVI_ID = pvsd.PHAMVI_ID and A.NGUONHANG_ID = dtk.NGUONDUOC_ID        where dtk.SOLUONG > 0 and dtk.BENHVIEN_ID = 'HLU01'        group by LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')), pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        ) tk on tk.DUOC_ID = d.DUOC_ID        left join TM_DUOC_PHAMVISUDUNG kd on kd.PHAMVI_ID = tk.PHAMVI_ID and kd.BENHVIEN_ID = 'HLU01'        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = tk.NGUONDUOC_ID and nh.BENHVIEN_ID = 'HLU01'        where d.BENHVIEN_ID = 'HLU01'  and tk.SOLUONG >= 0        end        else        begin                  select  distinct tk.DUOC_KEY, LTRIM(tk.PHAMVI_ID) as PHAMVI_ID, tk.NGUONDUOC_ID, nh.TENNGUONDUOC, nh.TINHTIEN, d.DUOC_ID, ld.MALOAIDUOC,        d.SOVISA,d.TYLE_VAT,d.COTOA, d.MADUOC, d.TENHANG, d.TENDUOCDAYDU, d.DONVITINH as DONVITINH, d.BHYT,        d.TENHOATCHAT, d.HAMLUONG, d.HANGSANXUAT, d.QUOCGIA, d.LOAIDUOC_ID, d.DUONGDUNG_ID, d.TINHTIEN_PTTT,        ten.TENDUOC, ten.TENDUOC_EN, ten.MAQUOCTE, ten.MAQUOCTEBT,d.CONGDUNG,        CASE WHEN d.BHYT = '1' THEN 'BHYT' ELSE '' END as BHYT_TEXT        , ld.LOAIVATTU_ID        , d.BENHVIEN_ID,        tk.SOLUONG, d.VTYT_PHANLOAI, d.PHAMVI, d.SUASOLUONGTONGHOP, d.MADUOCBV, d.DANGTRINHBAY        , TAMNGUNG = CASE WHEN d.TAMNGUNG = '1' OR nh.TAMNGUNG = '1' OR kd.TAMNGUNG = '1' THEN '1' ELSE '0' END        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        inner join        (        select  LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')) DUOC_KEY, (SUM(dtk.SOLUONG) - isnull(sum(A.SOLUONG),0) - isnull(sum(B.SOLUONG),0)) SOLUONG, pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        from (select sum(soluong) soluong,duoc_id,nguonduoc_id,khoduoc_id,benhvien_id from TT_DUOC_TONKHO  group by duoc_id,nguonduoc_id,khoduoc_id,benhvien_id) dtk        inner join TM_DUOC_PHAMVISD_MAPPING pvsd on dtk.KHODUOC_ID = pvsd.KHODUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NOITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) B on B.DUOC_ID = dtk.DUOC_ID and B.SOLUONG > 0 and B.PHAMVI_ID = pvsd.PHAMVI_ID and B.NGUONHANG_ID = dtk.NGUONDUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NGOAITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) A on A.DUOC_ID = dtk.DUOC_ID and A.SOLUONG > 0 and A.PHAMVI_ID = pvsd.PHAMVI_ID and A.NGUONHANG_ID = dtk.NGUONDUOC_ID        where dtk.SOLUONG > 0 and dtk.BENHVIEN_ID = 'HLU01'        group by LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')), pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        ) tk on tk.DUOC_ID = d.DUOC_ID        left join TM_DUOC_PHAMVISUDUNG kd on kd.PHAMVI_ID = tk.PHAMVI_ID and kd.BENHVIEN_ID = 'HLU01'        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = tk.NGUONDUOC_ID and nh.BENHVIEN_ID = 'HLU01'        where d.BENHVIEN_ID = 'HLU01'  and tk.SOLUONG >= 0        end]
2020-01-02 15:43:53,830 [5] DEBUG - Statement Id: [DAO00320_GetList] PreparedStatement : [select M.*            from TM_MAU M            LEFT JOIN TM_MAU_DONVITINH DVT on M.DONVITINH_ID=DVT.DONVITINH_ID            where            M.TAMNGUNG = '0'            and M.BENHVIEN_ID = 'HLU01'            order by M.TENMAU]
2020-01-02 15:43:53,899 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM071']
2020-01-02 15:43:54,054 [5] DEBUG - Statement Id: [DAO00322_GetListMauTonKhoForCreateCached] PreparedStatement : [SELECT DISTINCT        TK.MAU_KEY, TK.KHOMAU_ID, M.MAU_ID, M.MAMAU, M.TENMAU, M.NHOM_ABO, M.NHOM_RH, M.LOAIMAU_ID,        TK.SOLONHAP_ID, SLN.SOLONHAP, SLN.SOKIEMSOAT, TK.NGUONHANG_ID, NG.TENNGUONMAU, M.BENHVIEN_ID, M.DONVITINH_ID,        SUM(tk.SOLUONG) AS SOLUONG,K.TENKHO,DVT.TENDONVITINH        FROM TT_MAU_TONKHO TK        JOIN TM_KHO K ON TK.KHOMAU_ID = K.KHO_ID        JOIN TT_MAU_CHUNGTU_SOLONHAP SLN ON TK.SOLONHAP_ID = SLN.SOLONHAP_ID        JOIN TM_MAU M on TK.MAU_ID = M.MAU_ID and M.TAMNGUNG = '0'        LEFT JOIN TM_MAU_DONVITINH DVT on M.DONVITINH_ID=DVT.DONVITINH_ID        LEFT JOIN TM_NGUONMAU NG ON NG.NGUONMAU_ID = TK.NGUONHANG_ID        WHERE TK.SOLUONG > 0        GROUP BY TK.MAU_KEY, TK.KHOMAU_ID, M.MAU_ID, M.MAMAU, M.TENMAU, M.NHOM_ABO, M.NHOM_RH, M.LOAIMAU_ID,        TK.SOLONHAP_ID, SLN.SOLONHAP, SLN.SOKIEMSOAT,TK.NGUONHANG_ID, NG.TENNGUONMAU, M.BENHVIEN_ID, M.DONVITINH_ID,K.TENKHO,DVT.TENDONVITINH]
2020-01-02 15:43:54,176 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM073']
2020-01-02 15:43:54,211 [5] DEBUG - Statement Id: [DAO00322_GetListMauTonKhoTruBooking] PreparedStatement : [select distinct        TK.MAU_KEY, TK.KHOMAU_ID, M.MAU_ID, M.MAMAU, M.TENMAU, M.NHOM_ABO, M.NHOM_RH, M.LOAIMAU_ID, M.DONVITINH_ID,        TK.SOLONHAP_ID, TK.SOLONHAP, TK.SOKIEMSOAT,M.PHAMVI, TK.NGUONHANG_ID, NG.TENNGUONMAU, M.BENHVIEN_ID,        TK.SOLUONG,TK.TENKHO,DVT.TENDONVITINH        from TM_MAU M        JOIN        (        select        A.MAU_KEY, A.KHOMAU_ID, A.MAU_ID ,a.NGUONHANG_ID, A.SOLONHAP_ID, A.SOLONHAP, A.SOKIEMSOAT, A.SOLUONG,A.TENKHO        from        (        select KHOMAU_ID, TK.MAU_ID, TK.NGUONHANG_ID, TK.MAU_KEY, SLN.SOLONHAP_ID, SLN.SOLONHAP, SLN.SOKIEMSOAT, ISNULL(TK.SOLUONG,0) - ISNULL(book.SOLUONG,0) as SOLUONG,K.TENKHO        from TT_MAU_TONKHO TK        JOIN TM_KHO K ON TK.KHOMAU_ID = K.KHO_ID        inner join TT_MAU_CHUNGTU_SOLONHAP SLN ON TK.SOLONHAP_ID = SLN.SOLONHAP_ID        left join dbo.TT_MAU_TONKHO_BOOK book ON book.MAU_KEY = TK.MAU_KEY AND book.TRANGTHAI = 'HIEULUC'        where ISNULL(TK.SOLUONG,0) - ISNULL(book.SOLUONG,0) > 0        ) A        )TK on TK.MAU_ID = M.MAU_ID and M.TAMNGUNG = '0'        LEFT JOIN TM_MAU_DONVITINH DVT on M.DONVITINH_ID=DVT.DONVITINH_ID        LEFT JOIN TM_NGUONMAU NG ON NG.NGUONMAU_ID = TK.NGUONHANG_ID]
2020-01-02 15:43:54,313 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM072']
2020-01-02 15:43:55,278 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'MAIN'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2020-01-02 15:43:56,657 [1] DEBUG - Statement Id: [DAO00002_FormList] PreparedStatement : [select              TM_SYS_FORM.HOSPITAL_ID,              TM_SYS_FORM.NAME,              TM_SYS_FORM.CLASS,              TM_SYS_FORM.ASSEMBLY,              TM_SYS_FORM.TITLE_VI as TITLE              from TM_SYS_FORM              where HOSPITAL_ID = 'HLU01']
2020-01-02 15:44:05,160 [1] DEBUG - Statement Id: [DAO00300_GetShortcutListByUserID] PreparedStatement : [SELECT S.SHORTCUT_CODE, S.SHORTCUT_VALUE              FROM TM_SHORTCUT AS S              WHERE S.BENHVIEN_ID = 'HLU01' AND S.USER_ID = '1' AND TAMNGUNG = '0']
2020-01-02 15:44:05,188 [1] DEBUG - Statement Id: [DAO00087_GetList] PreparedStatement : [select CODE, VALUE, BENHVIEN_ID              from TM_SYS_APPSETTINGS              where LOCKED = '0' and BENHVIEN_ID = 'HLU01'              order by SETTING_ID]
2020-01-02 15:44:05,274 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'MSG01'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2020-01-02 15:44:05,421 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'MSG02'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2020-01-02 15:44:05,673 [1] DEBUG - Statement Id: [DAO00008_GetUserSettings] PreparedStatement : [select A.*, B.TENKHO , C.TENPHONGBAN, B.MAKHO, C.MAPHONGBAN          from TM_SYS_USERS A          left join TM_KHODUOC B on B.KHODUOC_ID = A.INVENTORY_ID          left join TM_PHONGBAN C on (C.PHONGBAN_ID = A.WORKING_DEPT_ID and C.BENHVIEN_ID =  @param0 )          left join TM_SYS_USERKHO D on (D.ACCOUNT_ID = A.ACCOUNT_ID and D.HOSPITAL_ID =  @param0 )          where          A.HOSPITAL_ID =  @param0            and                 A.ACCOUNT_ID =  @param1]
2020-01-02 15:44:05,709 [1] DEBUG - Statement Id: [DAO00008_GetUserSettings] Parameters: [@param0=[HOSPITAL_ID,HLU01], @param1=[ACCOUNT_ID,113]]
2020-01-02 15:44:05,709 [1] DEBUG - Statement Id: [DAO00008_GetUserSettings] Types: [@param0=[String, System.String], @param1=[String, System.String]]
2020-01-02 15:44:05,742 [1] DEBUG - Statement Id: [DAO00008_GetUserInvSettings] PreparedStatement : [select A.*, B.TENKHO, B.MAKHO, B.LOAIKHO_ID, B.KHOQUANLY_ID          from TM_SYS_USERKHO A          left join TM_KHO B on B.MODULE_ID = A.MODULE_ID and B.KHO_ID = A.KHO_ID          where A.HOSPITAL_ID =  @param0  and A.ACCOUNT_ID =  @param1           order by B.TENKHO]
2020-01-02 15:44:05,742 [1] DEBUG - Statement Id: [DAO00008_GetUserInvSettings] Parameters: [@param0=[HOSPITAL_ID,HLU01], @param1=[ACCOUNT_ID,113]]
2020-01-02 15:44:05,742 [1] DEBUG - Statement Id: [DAO00008_GetUserInvSettings] Types: [@param0=[String, System.String], @param1=[String, System.String]]
2020-01-02 15:44:06,020 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'COM30'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2020-01-02 15:44:06,392 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'RIS04'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2020-01-02 15:44:31,769 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'MENU1'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2020-01-02 15:44:31,870 [1] DEBUG - Statement Id: [DAO00011_GetList] PreparedStatement : [select              TM_SYS_MENU.ID,              TM_SYS_MENU.PARENTID,              TM_SYS_MENU.SCREEN,              TM_SYS_MENU.SMALLIMAGE,              TM_SYS_MENU.LARGEIMAGE,              TM_SYS_MENU.DESCRIPTION,              TM_SYS_MENU.TYPE,              TM_SYS_MENU.TITLE_VI as TITLE              from TM_SYS_MENU              where TM_SYS_MENU.HOSPITAL_ID = 'HLU01' and TM_SYS_MENU.ACTIVE = '1'               AND                   (TM_SYS_MENU.TYPE & '8' = '8')                             order by TM_SYS_MENU.ORDERNUM]
2020-01-02 15:44:32,257 [1] DEBUG - Statement Id: [DAO00011_usermenu_list] PreparedStatement : [select              TM_SYS_HOMEMENU.MENUID as ID,              TM_SYS_MENU.TITLE_VI as TITLE,              TM_SYS_MENU.SCREEN,              TM_SYS_MENU.SMALLIMAGE,              TM_SYS_MENU.LARGEIMAGE,              TM_SYS_MENU.TYPE              from TM_SYS_HOMEMENU              left join TM_SYS_MENU on TM_SYS_MENU.ID = TM_SYS_HOMEMENU.MENUID and TM_SYS_MENU.HOSPITAL_ID = TM_SYS_HOMEMENU.HOSPITAL_ID              where TM_SYS_HOMEMENU.HOSPITAL_ID = 'HLU01' and TM_SYS_HOMEMENU.USERID = '113' and TM_SYS_MENU.ACTIVE = '1'               AND                   (TM_SYS_MENU.TYPE & '8' = '8')                             ORDER BY TM_SYS_HOMEMENU.ORDERNUM]
2020-01-02 16:04:33,775 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'REG14'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2020-01-02 16:04:35,830 [1] DEBUG - Statement Id: [DAO00012_GetList] PreparedStatement : [select        DICTIONARY_ID,        DICTIONARY_CODE,        DICTIONARY_NAME,        ATTRIBUTE1,        ATTRIBUTE2,        DICTIONARY_NAME_EN        from LST_DICTIONARY        where LST_DICTIONARY.Enabled = '1'         AND           LST_DICTIONARY.DICTIONARY_TYPE_CODE = 'PhanLoaiTiepNhan'                 order by LST_DICTIONARY.IDX]
2020-01-02 16:04:35,863 [1] DEBUG - Statement Id: [DAO00012_GetList] PreparedStatement : [select        DICTIONARY_ID,        DICTIONARY_CODE,        DICTIONARY_NAME,        ATTRIBUTE1,        ATTRIBUTE2,        DICTIONARY_NAME_EN        from LST_DICTIONARY        where LST_DICTIONARY.Enabled = '1'         AND           LST_DICTIONARY.DICTIONARY_TYPE_CODE = 'NguonBN'                 order by LST_DICTIONARY.IDX]
2020-01-02 16:04:35,889 [1] DEBUG - Statement Id: [DAO00019_GetListCongTyChiTra] PreparedStatement : [select *        from TM_CONGTYCHITRA        where        BENHVIEN_ID = 'HLU01' AND TAMNGUNG = '0']
2020-01-02 16:04:36,201 [1] DEBUG - Statement Id: [DAO00017_GetListPhongKham] PreparedStatement : [select pb.PHONGBAN_ID, pb.TENPHONGBAN, case when dv.ATTRIBUTE5 is null then 'TT' else 'KTC' end as LOAI_CHIPHI              from [TM_PHONGBAN_DICHVU] as pb_dv              inner join [TM_PHONGBAN] as pb on pb.PHONGBAN_ID = pb_dv.PHONGBAN_ID and pb.BENHVIEN_ID = 'HLU01'              inner join [TM_DICHVU] dv on dv.DICHVU_ID = pb_dv.DICHVU_ID and dv.MADICHVU = '' and dv.BENHVIEN_ID = 'HLU01'              where pb_dv.BENHVIEN_ID = 'HLU01']
2020-01-02 16:04:36,238 [1] DEBUG - Statement Id: [DAO00019_GetListPhongKham_REG13] PreparedStatement : [select pb.PHONGBAN_ID, pb.TENPHONGBAN, case when dv.ATTRIBUTE5 is null then 'TT' else 'KTC' end as LOAI_CHIPHI        from TM_PHONGBAN pb        left join TM_PHONGBAN_DICHVU pb_dv on pb_dv.PHONGBAN_ID = pb.PHONGBAN_ID and pb_dv.BENHVIEN_ID = pb.BENHVIEN_ID        left join TM_DICHVU dv on dv.DICHVU_ID = pb_dv.DICHVU_ID and dv.BENHVIEN_ID = pb_dv.BENHVIEN_ID        left join TM_NHOMDICHVU ndv on ndv.NHOMDICHVU_ID = dv.NHOMDICHVU_ID and ndv.BENHVIEN_ID = dv.BENHVIEN_ID        where pb.BENHVIEN_ID = 'HLU01' and ndv.MANHOMDICHVU = '04' and dv.DICHVU_ID IS NOT NULL]
2020-01-02 16:04:36,327 [1] DEBUG - Statement Id: [DAO00019_LayThongTinSoluongDichVuPhongKham_REG13] PreparedStatement : [select PHONGBAN_ID, TENPHONGBAN, NOITHUCHIEN_ID, SUM(CHUAKETQUA) AS CHUAKETQUA, SUM(HOANTAT) AS HOANTAT, SUM(DANGTHUCHIEN) AS DANGTHUCHIEN        from (        select B.PHONGBAN_ID, B.TENPHONGBAN, A.NOITHUCHIEN_ID,        case when A.TRANGTHAI = 'CHUAKETQUA' then 1 else 0 end AS CHUAKETQUA,        case when A.TRANGTHAI = 'HOANTAT' then 1 else 0 end AS HOANTAT,        case when A.TRANGTHAI = 'DANGTHUCHIEN' then 1 else 0 end AS DANGTHUCHIEN        from TM_PHONGBAN B        left join TT_DVYEUCAU A on A.NOITHUCHIEN_ID = B.PHONGBAN_ID and A.BENHVIEN_ID = B.BENHVIEN_ID and A.NGAYYEUCAU = CONVERT(date, getdate())        left join TM_DICHVU dv on A.DICHVU_ID = dv.DICHVU_ID        left join TM_NHOMDICHVU ndv on ndv.NHOMDICHVU_ID = dv.NHOMDICHVU_ID        where B.BENHVIEN_ID ='HLU01' and Left(ndv.MANHOMDICHVU,2) = '04'        and B.PHONGBAN_ID in (65,71,72,41,68,62,177,67,55,81,57,57,58,59,60,63,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,61,69,69,70,70)        ) tmp        group by tmp.NOITHUCHIEN_ID, tmp.TENPHONGBAN, tmp.PHONGBAN_ID]
2020-01-02 16:04:56,858 [1] DEBUG - Statement Id: [DAO00087_GetServiceParams] PreparedStatement : [select CODE, VALUE              from TM_SYS_APPSETTINGS              where LOCKED = '0' and BENHVIEN_ID = 'HLU01']
2020-01-02 16:04:56,980 [1] DEBUG - Statement Id: [DAO00095_GetDetailTrungBN] PreparedStatement : [select  TT_TIEPNHAN.NGAYTIEPNHAN AS NGAYTIEPNHAN ,TT_TIEPNHAN.SOBHYT AS SOTHE, TT_BENHNHAN.*, ISNULL(TT_BENHNHAN.NGAYSINH,TT_BENHNHAN.NAMSINH) AS NGAYNAMSINH          from TT_BENHNHAN          left join TT_TIEPNHAN  ON          TT_TIEPNHAN.TIEPNHAN_ID = (SELECT TOP 1 TIEPNHAN_ID FROM TT_TIEPNHAN WHERE BENHNHAN_ID = TT_BENHNHAN.BENHNHAN_ID ORDER BY THOIGIANTIEPNHAN DESC)           WHERE                TT_BENHNHAN.TENBENHNHAN = N'Vương Thị Xâm'             AND               convert(varchar(10),TT_BENHNHAN.NGAYSINH, 103) = convert(varchar(10),'04/10/1984', 103)               AND               TT_BENHNHAN.GIOITINH = '2']
2020-01-02 16:05:18,774 [1] DEBUG - Statement Id: [DAO00000_GetKyHieuBHYT] PreparedStatement : [select * from TM_DOITUONG where NHOMTHE LIKE '%' +  @param0  + '%']
2020-01-02 16:05:18,774 [1] DEBUG - Statement Id: [DAO00000_GetKyHieuBHYT] Parameters: [@param0=[MATHEBHYT,DN4]]
2020-01-02 16:05:18,774 [1] DEBUG - Statement Id: [DAO00000_GetKyHieuBHYT] Types: [@param0=[String, System.String]]
2020-01-02 16:05:18,913 [1] DEBUG - Statement Id: [DAO00095_GetDetail] PreparedStatement : [select distinct TT_BENHNHAN.*, ISNULL(TT_BENHNHAN.NGAYSINH, TT_BENHNHAN.NAMSINH) AS NGAYNAMSINH, TN1.SOBHYT AS SOTHE, TN1.NGAYTIEPNHAN          from TT_BENHNHAN          left join (          select MAX(TIEPNHAN_ID) AS TIEPNHAN_ID, BENHNHAN_ID from TT_TIEPNHAN GROUP BY BENHNHAN_ID) TN ON TN.BENHNHAN_ID = TT_BENHNHAN.BENHNHAN_ID          left join TT_TIEPNHAN TN1 ON TN1.TIEPNHAN_ID = TN.TIEPNHAN_ID           WHERE                TN1.SOBHYT = 'DN438381202498038010']
2020-01-02 16:05:23,639 [1] DEBUG - Statement Id: [DAO00000_GetKyHieuBHYT] PreparedStatement : [select * from TM_DOITUONG where NHOMTHE LIKE '%' +  @param0  + '%']
2020-01-02 16:05:23,639 [1] DEBUG - Statement Id: [DAO00000_GetKyHieuBHYT] Parameters: [@param0=[MATHEBHYT,DN4]]
2020-01-02 16:05:23,639 [1] DEBUG - Statement Id: [DAO00000_GetKyHieuBHYT] Types: [@param0=[String, System.String]]
2020-01-02 16:06:13,190 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'REG13'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2020-01-02 16:06:13,400 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'COM98'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2020-01-02 16:06:40,872 [1] DEBUG - Statement Id: [DAO00000_GetKyHieuBHYT] PreparedStatement : [select * from TM_DOITUONG where NHOMTHE LIKE '%' +  @param0  + '%']
2020-01-02 16:06:40,872 [1] DEBUG - Statement Id: [DAO00000_GetKyHieuBHYT] Parameters: [@param0=[MATHEBHYT,DN4]]
2020-01-02 16:06:40,872 [1] DEBUG - Statement Id: [DAO00000_GetKyHieuBHYT] Types: [@param0=[String, System.String]]
2020-01-02 16:17:03,789 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'MTR01'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2020-01-02 16:17:04,768 [1] DEBUG - Statement Id: [DAO00209_ADM17] PreparedStatement : [SELECT *              FROM TM_SYS_APPSETTINGS              WHERE BENHVIEN_ID = 'HLU01' AND LOCKED = '0' AND TYPE = '0']
2020-01-02 16:17:16,071 [1] DEBUG - Statement Id: [DAO00209_ADM17] PreparedStatement : [SELECT *              FROM TM_SYS_APPSETTINGS              WHERE BENHVIEN_ID = 'HLU01' AND LOCKED = '0' AND TYPE = '2']
2020-01-02 16:17:16,349 [1] DEBUG - Statement Id: [DAO00209_ADM17] PreparedStatement : [SELECT *              FROM TM_SYS_APPSETTINGS              WHERE BENHVIEN_ID = 'HLU01' AND LOCKED = '0' AND TYPE = '2']
2020-01-02 16:18:11,767 [1] DEBUG - Statement Id: [DAO00000_GetKyHieuBHYT] PreparedStatement : [select * from TM_DOITUONG where NHOMTHE LIKE '%' +  @param0  + '%']
2020-01-02 16:18:11,767 [1] DEBUG - Statement Id: [DAO00000_GetKyHieuBHYT] Parameters: [@param0=[MATHEBHYT,DN4]]
2020-01-02 16:18:11,767 [1] DEBUG - Statement Id: [DAO00000_GetKyHieuBHYT] Types: [@param0=[String, System.String]]
2020-01-02 16:19:15,530 [1] DEBUG - Statement Id: [DAO00000_GetKyHieuBHYT] PreparedStatement : [select * from TM_DOITUONG where NHOMTHE LIKE '%' +  @param0  + '%']
2020-01-02 16:19:15,530 [1] DEBUG - Statement Id: [DAO00000_GetKyHieuBHYT] Parameters: [@param0=[MATHEBHYT,DN4]]
2020-01-02 16:19:15,530 [1] DEBUG - Statement Id: [DAO00000_GetKyHieuBHYT] Types: [@param0=[String, System.String]]
2020-01-02 16:19:15,644 [1] DEBUG - Statement Id: [DAO00095_GetDetail] PreparedStatement : [select distinct TT_BENHNHAN.*, ISNULL(TT_BENHNHAN.NGAYSINH, TT_BENHNHAN.NAMSINH) AS NGAYNAMSINH, TN1.SOBHYT AS SOTHE, TN1.NGAYTIEPNHAN          from TT_BENHNHAN          left join (          select MAX(TIEPNHAN_ID) AS TIEPNHAN_ID, BENHNHAN_ID from TT_TIEPNHAN GROUP BY BENHNHAN_ID) TN ON TN.BENHNHAN_ID = TT_BENHNHAN.BENHNHAN_ID          left join TT_TIEPNHAN TN1 ON TN1.TIEPNHAN_ID = TN.TIEPNHAN_ID           WHERE                TN1.SOBHYT = 'DN438381202498001001']
2020-01-02 16:19:19,233 [1] DEBUG - Statement Id: [DAO00000_GetKyHieuBHYT] PreparedStatement : [select * from TM_DOITUONG where NHOMTHE LIKE '%' +  @param0  + '%']
2020-01-02 16:19:19,233 [1] DEBUG - Statement Id: [DAO00000_GetKyHieuBHYT] Parameters: [@param0=[MATHEBHYT,DN4]]
2020-01-02 16:19:19,233 [1] DEBUG - Statement Id: [DAO00000_GetKyHieuBHYT] Types: [@param0=[String, System.String]]
2020-01-02 16:19:45,937 [1] DEBUG - Statement Id: [DAO00095_GetDetailTrungBN] PreparedStatement : [select  TT_TIEPNHAN.NGAYTIEPNHAN AS NGAYTIEPNHAN ,TT_TIEPNHAN.SOBHYT AS SOTHE, TT_BENHNHAN.*, ISNULL(TT_BENHNHAN.NGAYSINH,TT_BENHNHAN.NAMSINH) AS NGAYNAMSINH          from TT_BENHNHAN          left join TT_TIEPNHAN  ON          TT_TIEPNHAN.TIEPNHAN_ID = (SELECT TOP 1 TIEPNHAN_ID FROM TT_TIEPNHAN WHERE BENHNHAN_ID = TT_BENHNHAN.BENHNHAN_ID ORDER BY THOIGIANTIEPNHAN DESC)           WHERE                TT_BENHNHAN.TENBENHNHAN = N'Vương Thị Xám'             AND               convert(varchar(10),TT_BENHNHAN.NGAYSINH, 103) = convert(varchar(10),'04/10/1984', 103)               AND               TT_BENHNHAN.GIOITINH = '2']
2020-01-02 16:19:46,048 [1] DEBUG - Statement Id: [DAO00000_GetKyHieuBHYT] PreparedStatement : [select * from TM_DOITUONG where NHOMTHE LIKE '%' +  @param0  + '%']
2020-01-02 16:19:46,048 [1] DEBUG - Statement Id: [DAO00000_GetKyHieuBHYT] Parameters: [@param0=[MATHEBHYT,DN4]]
2020-01-02 16:19:46,048 [1] DEBUG - Statement Id: [DAO00000_GetKyHieuBHYT] Types: [@param0=[String, System.String]]
--------------------------------------------------------------------------------
2020-01-02 17:17:15,288 [1] DEBUG - Statement Id: [DAO00001_DBList] PreparedStatement : [select *              from TM_SYS_SERVER              where HOSPITAL_ID = '_SYSTEM_' and TYPE = 'D']
2020-01-02 17:17:15,588 [1] DEBUG - Statement Id: [DAO00001_DaoList] PreparedStatement : [select              TM_SYS_SERVICEMAP.ID,              TM_SYS_SERVICEMAP.HOSPITAL_ID,              TM_SYS_SERVICEMAP.DB_NAME,              TM_SYS_SERVICEMAP.TYPE,              TM_SYS_SERVICEMAP.NAME,              TM_SYS_SERVICEMAP.CLASS,              (TM_SYS_DIC.VALUE + '.' + TM_SYS_SERVICEMAP.CLASS) as CLASSFULL,              TM_SYS_SERVICEMAP.ASSEMBLY              from TM_SYS_SERVICEMAP              inner join TM_SYS_DIC              on TM_SYS_SERVICEMAP.NAMESPACE = TM_SYS_DIC.ID              where HOSPITAL_ID = '_SYSTEM_' AND TYPE = 'D' AND ACTIVE = '1'              order by DB_NAME]
2020-01-02 17:17:15,623 [1] DEBUG - Statement Id: [DAO00001_ServiceList] PreparedStatement : [select              TM_SYS_SERVICEMAP.ID,              TM_SYS_SERVICEMAP.HOSPITAL_ID,              TM_SYS_SERVICEMAP.DB_NAME,              TM_SYS_SERVICEMAP.TYPE,              TM_SYS_SERVICEMAP.NAME,              TM_SYS_SERVICEMAP.CLASS,              (TM_SYS_DIC.VALUE + '.' + TM_SYS_SERVICEMAP.CLASS) as CLASSFULL,              TM_SYS_SERVICEMAP.ASSEMBLY,              TM_SYS_SERVER.URL              from TM_SYS_SERVICEMAP              inner join TM_SYS_DIC on TM_SYS_SERVICEMAP.NAMESPACE = TM_SYS_DIC.ID              inner join TM_SYS_SERVER on (TM_SYS_SERVICEMAP.DB_NAME = TM_SYS_SERVER.NAME) and (TM_SYS_SERVER.HOSPITAL_ID = '_SYSTEM_')              where TM_SYS_SERVICEMAP.HOSPITAL_ID = '_SYSTEM_' AND TM_SYS_SERVICEMAP.TYPE = 'S'  AND ACTIVE = '1'              order by URL]
2020-01-02 17:17:16,055 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = '_SYSTEM_'               AND                   TM_SYS_SCREEN.PAGE = 'LOGIN'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2020-01-02 17:17:16,347 [1] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = '_SYSTEM_'               AND                   TM_SYS_CACHE.ACTIVE = '1']
2020-01-02 17:17:53,529 [1] DEBUG - Statement Id: [DAO00001_DBList] PreparedStatement : [select *              from TM_SYS_SERVER              where HOSPITAL_ID = 'HLU01' and TYPE = 'D']
2020-01-02 17:17:53,555 [1] DEBUG - Statement Id: [DAO00001_DaoList] PreparedStatement : [select              TM_SYS_SERVICEMAP.ID,              TM_SYS_SERVICEMAP.HOSPITAL_ID,              TM_SYS_SERVICEMAP.DB_NAME,              TM_SYS_SERVICEMAP.TYPE,              TM_SYS_SERVICEMAP.NAME,              TM_SYS_SERVICEMAP.CLASS,              (TM_SYS_DIC.VALUE + '.' + TM_SYS_SERVICEMAP.CLASS) as CLASSFULL,              TM_SYS_SERVICEMAP.ASSEMBLY              from TM_SYS_SERVICEMAP              inner join TM_SYS_DIC              on TM_SYS_SERVICEMAP.NAMESPACE = TM_SYS_DIC.ID              where HOSPITAL_ID = 'HLU01' AND TYPE = 'D' AND ACTIVE = '1'              order by DB_NAME]
2020-01-02 17:17:55,180 [1] DEBUG - Statement Id: [DAO00001_ServiceList] PreparedStatement : [select              TM_SYS_SERVICEMAP.ID,              TM_SYS_SERVICEMAP.HOSPITAL_ID,              TM_SYS_SERVICEMAP.DB_NAME,              TM_SYS_SERVICEMAP.TYPE,              TM_SYS_SERVICEMAP.NAME,              TM_SYS_SERVICEMAP.CLASS,              (TM_SYS_DIC.VALUE + '.' + TM_SYS_SERVICEMAP.CLASS) as CLASSFULL,              TM_SYS_SERVICEMAP.ASSEMBLY,              TM_SYS_SERVER.URL              from TM_SYS_SERVICEMAP              inner join TM_SYS_DIC on TM_SYS_SERVICEMAP.NAMESPACE = TM_SYS_DIC.ID              inner join TM_SYS_SERVER on (TM_SYS_SERVICEMAP.DB_NAME = TM_SYS_SERVER.NAME) and (TM_SYS_SERVER.HOSPITAL_ID = 'HLU01')              where TM_SYS_SERVICEMAP.HOSPITAL_ID = 'HLU01' AND TM_SYS_SERVICEMAP.TYPE = 'S'  AND ACTIVE = '1'              order by URL]
2020-01-02 17:17:55,261 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1']
2020-01-02 17:17:56,059 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM005']
2020-01-02 17:17:56,279 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM015']
2020-01-02 17:17:56,352 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM067']
2020-01-02 17:17:56,447 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM008']
2020-01-02 17:17:56,518 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM068']
2020-01-02 17:17:56,629 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM006']
2020-01-02 17:17:56,699 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM030']
2020-01-02 17:17:56,834 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM025']
2020-01-02 17:17:57,063 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM024']
2020-01-02 17:17:57,561 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM033']
2020-01-02 17:17:57,601 [5] DEBUG - Statement Id: [DAO00027_GetListDuocKyGuiTonKho] PreparedStatement : [select  distinct TT_TONKHO.DUOC_KEY, LTRIM(TT_TONKHO.KHODUOC_ID) as KHODUOC_ID, TM_DUOC.DUOC_ID, TM_LOAIDUOC.MALOAIDUOC,TM_DUOC.SOVISA,TM_DUOC.TYLE_VAT,TM_DUOC.COTOA,        TM_DUOC.MADUOC, TM_DUOC.TENHANG, TM_DUOC.TENDUOCDAYDU, dvt.TENDONVITINH as DONVITINH,  TM_DUOC.DONVITINH_ID,TM_DUOC.BHYT,TM_DUOC.PHAMVI,        TM_DUOC.TENHOATCHAT, TM_DUOC.HAMLUONG, TM_DUOC.HANGSANXUAT, TM_DUOC.QUOCGIA, TM_DUOC.LOAIDUOC_ID, TM_DUOC.DUONGDUNG_ID,        TM_TENDUOC.TENDUOC, TM_TENDUOC.TENDUOC_EN, TM_TENDUOC.MAQUOCTE, TM_TENDUOC.MAQUOCTEBT,        TM_LOAIDUOC.LOAIVATTU_ID, TM_DUOC.BENHVIEN_ID,TT_TONKHO.SOLUONG, TT_TONKHO.NGUONDUOC_ID, NH.TENNGUONDUOC        , TAMNGUNG = CASE WHEN TM_DUOC.TAMNGUNG = '1' OR nh.TAMNGUNG = '1' OR KD.TAMNGUNG = '1' THEN '1' ELSE '0' END        , TM_DUOC.DANGTRINHBAY        from TM_DUOC        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = TM_DUOC.DONVITINH_ID        left join TM_TENDUOC on TM_DUOC.TENDUOC_ID = TM_TENDUOC.TENDUOC_ID and TM_DUOC.BENHVIEN_ID = 'HLU01' and TM_DUOC.TAMNGUNG = '0'        left join TM_LOAIDUOC on TM_LOAIDUOC.LOAIDUOC_ID = TM_DUOC.LOAIDUOC_ID and TM_LOAIDUOC.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG on (TM_LOAIDUOC.LOAIVATTU_ID = TM_DUOC_HANDUNG.LOAIDUOC and TM_DUOC_HANDUNG.BENHVIEN_ID = 'HLU01')        inner join        (select LTRIM(A.KHODUOC_ID) + '_' + LTRIM(A.DUOC_ID) + '_' + LTRIM(ISNULL(A.NGUONDUOC_ID,'')) as DUOC_KEY, A.KHODUOC_ID, A.DUOC_ID,A.NGUONDUOC_ID,        SUM(isnull(A.SOLUONG,0)) as SOLUONG        from        (select SUM(SOLUONG) as SOLUONG, KHODUOC_ID, DUOC_ID, NGUONDUOC_ID from TT_DUOC_KYGUI_TONKHO        where BENHVIEN_ID = 'HLU01' group by KHODUOC_ID, DUOC_ID, NGUONDUOC_ID) A        group by LTRIM(A.KHODUOC_ID) + '_' + LTRIM(A.DUOC_ID) + '_' + LTRIM(A.NGUONDUOC_ID), A.KHODUOC_ID, A.DUOC_ID, A.NGUONDUOC_ID)        TT_TONKHO on TT_TONKHO.DUOC_ID = TM_DUOC.DUOC_ID        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = TT_TONKHO.NGUONDUOC_ID and nh.BENHVIEN_ID = 'HLU01'        LEFT JOIN TM_KHODUOC KD ON KD.KHODUOC_ID = TT_TONKHO.KHODUOC_ID        where TM_DUOC.BENHVIEN_ID = 'HLU01' AND TT_TONKHO.SOLUONG >= 0]
2020-01-02 17:17:57,688 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM018']
2020-01-02 17:17:57,720 [5] DEBUG - Statement Id: [DAO00027_GetListDuocTonKho] PreparedStatement : [select distinct TT_TONKHO.DUOC_KEY, LTRIM(TT_TONKHO.KHODUOC_ID) as KHODUOC_ID, TM_DUOC.DUOC_ID, TM_LOAIDUOC.MALOAIDUOC,TM_DUOC.SOVISA,TM_DUOC.TYLE_VAT,TM_DUOC.COTOA,        TM_DUOC.MADUOC, TM_DUOC.TENHANG, TM_DUOC.TENDUOCDAYDU, dvt.TENDONVITINH as DONVITINH,  TM_DUOC.DONVITINH_ID,TM_DUOC.BHYT,                TM_DUOC.TENHOATCHAT,          TM_DUOC.HAMLUONG, TM_DUOC.HANGSANXUAT, TM_DUOC.QUOCGIA, TM_DUOC.LOAIDUOC_ID, TM_DUOC.DUONGDUNG_ID,        TM_TENDUOC.TENDUOC, TM_TENDUOC.TENDUOC_EN, TM_TENDUOC.MAQUOCTE, TM_TENDUOC.MAQUOCTEBT,        TM_LOAIDUOC.LOAIVATTU_ID, TM_DUOC.BENHVIEN_ID,        TT_TONKHO.SOLUONG, TM_DUOC.VTYT_PHANLOAI, TM_DUOC.PHAMVI, TT_TONKHO.NGUONDUOC_ID, NG.TENNGUONDUOC AS TENNGUONDUOC        , TAMNGUNG = CASE WHEN TM_DUOC.TAMNGUNG = '1' OR NG.TAMNGUNG = '1' OR KD.TAMNGUNG = '1' THEN '1' ELSE '0' END        , TM_DUOC.DANGTRINHBAY        from TM_DUOC        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = TM_DUOC.DONVITINH_ID        left join TM_TENDUOC on TM_DUOC.TENDUOC_ID = TM_TENDUOC.TENDUOC_ID and TM_DUOC.BENHVIEN_ID = 'HLU01' and TM_DUOC.TAMNGUNG = '0'        left join TM_LOAIDUOC on TM_LOAIDUOC.LOAIDUOC_ID = TM_DUOC.LOAIDUOC_ID and TM_LOAIDUOC.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG on (TM_LOAIDUOC.LOAIVATTU_ID = TM_DUOC_HANDUNG.LOAIDUOC and TM_DUOC_HANDUNG.BENHVIEN_ID = 'HLU01')        inner join        (select LTRIM(A.KHODUOC_ID) + '_' + LTRIM(A.DUOC_ID) + '_' + LTRIM(ISNULL(A.NGUONDUOC_ID,'')) as DUOC_KEY, A.KHODUOC_ID, A.DUOC_ID, A.NGUONDUOC_ID,        SUM(isnull(A.SOLUONG,0)) as SOLUONG        from        (select SUM(SOLUONG) as SOLUONG, KHODUOC_ID, DUOC_ID, NGUONDUOC_ID from TT_DUOC_TONKHO        where BENHVIEN_ID = 'HLU01' group by KHODUOC_ID, DUOC_ID, NGUONDUOC_ID) A        group by LTRIM(A.KHODUOC_ID) + '_' + LTRIM(A.DUOC_ID) + '_' + LTRIM(ISNULL(A.NGUONDUOC_ID,'')), A.KHODUOC_ID, A.DUOC_ID, NGUONDUOC_ID        ) TT_TONKHO on TT_TONKHO.DUOC_ID = TM_DUOC.DUOC_ID        LEFT JOIN TM_NGUONHANG NG ON NG.NGUONDUOC_ID = TT_TONKHO.NGUONDUOC_ID        LEFT JOIN TM_KHODUOC KD ON KD.KHODUOC_ID = TT_TONKHO.KHODUOC_ID        where TM_DUOC.BENHVIEN_ID = 'HLU01' and TT_TONKHO.SOLUONG >= 0]
2020-01-02 17:17:58,889 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM023']
2020-01-02 17:17:58,925 [5] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoVaBooking] PreparedStatement : [declare @NGUONDUOC_MACDINH varchar(5) = '0';        declare @TOAMUANGOAI int = 0;        select @NGUONDUOC_MACDINH = isnull(VALUE,0) from TM_SYS_APPSETTINGS where CODE = 'PHA_NGUONDUOC'        select @TOAMUANGOAI = isnull(VALUE,0) from TM_SYS_APPSETTINGS where CODE = 'OPD_TOAMUANGOAI_DUNGDANHMUC_DUOC'                if @TOAMUANGOAI = 1        begin        select  distinct '0' + '_' + LTRIM(d.DUOC_ID) + '_' + @NGUONDUOC_MACDINH as DUOC_KEY, 0 as PHAMVI_ID, @NGUONDUOC_MACDINH as NGUONDUOC_ID, null as TENNGUONDUOC, null as TINHTIEN, d.DUOC_ID, ld.MALOAIDUOC,        d.SOVISA,d.TYLE_VAT,d.COTOA, d.MADUOC, d.TENHANG, d.TENDUOCDAYDU, d.DONVITINH as DONVITINH, d.BHYT,        d.TENHOATCHAT, d.HAMLUONG, d.HANGSANXUAT, d.QUOCGIA, d.LOAIDUOC_ID, d.DUONGDUNG_ID, d.TINHTIEN_PTTT,        ten.TENDUOC, ten.TENDUOC_EN, ten.MAQUOCTE, ten.MAQUOCTEBT,d.CONGDUNG,        '' as BHYT_TEXT        , ld.LOAIVATTU_ID        , d.BENHVIEN_ID,        999999999 as SOLUONG, d.VTYT_PHANLOAI, d.PHAMVI, d.SUASOLUONGTONGHOP, d.MADUOCBV, d.DANGTRINHBAY        , TAMNGUNG = CASE WHEN d.TAMNGUNG = '1' THEN '1' ELSE '0' END        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        union all        select  distinct tk.DUOC_KEY, LTRIM(tk.PHAMVI_ID) as PHAMVI_ID, tk.NGUONDUOC_ID, nh.TENNGUONDUOC, nh.TINHTIEN, d.DUOC_ID, ld.MALOAIDUOC,        d.SOVISA,d.TYLE_VAT,d.COTOA, d.MADUOC, d.TENHANG, d.TENDUOCDAYDU, d.DONVITINH as DONVITINH, d.BHYT,        d.TENHOATCHAT, d.HAMLUONG, d.HANGSANXUAT, d.QUOCGIA, d.LOAIDUOC_ID, d.DUONGDUNG_ID, d.TINHTIEN_PTTT,        ten.TENDUOC, ten.TENDUOC_EN, ten.MAQUOCTE, ten.MAQUOCTEBT,d.CONGDUNG,        CASE WHEN d.BHYT = '1' THEN 'BHYT' ELSE '' END as BHYT_TEXT        , ld.LOAIVATTU_ID        , d.BENHVIEN_ID,        tk.SOLUONG, d.VTYT_PHANLOAI, d.PHAMVI, d.SUASOLUONGTONGHOP, d.MADUOCBV, d.DANGTRINHBAY        , TAMNGUNG = CASE WHEN d.TAMNGUNG = '1' OR nh.TAMNGUNG = '1' OR kd.TAMNGUNG = '1' THEN '1' ELSE '0' END        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        inner join        (        select  LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')) DUOC_KEY, (SUM(dtk.SOLUONG) - isnull(sum(A.SOLUONG),0) - isnull(sum(B.SOLUONG),0)) SOLUONG, pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        from (select sum(soluong) soluong,duoc_id,nguonduoc_id,khoduoc_id,benhvien_id from TT_DUOC_TONKHO  group by duoc_id,nguonduoc_id,khoduoc_id,benhvien_id) dtk        inner join TM_DUOC_PHAMVISD_MAPPING pvsd on dtk.KHODUOC_ID = pvsd.KHODUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NOITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) B on B.DUOC_ID = dtk.DUOC_ID and B.SOLUONG > 0 and B.PHAMVI_ID = pvsd.PHAMVI_ID and B.NGUONHANG_ID = dtk.NGUONDUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NGOAITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) A on A.DUOC_ID = dtk.DUOC_ID and A.SOLUONG > 0 and A.PHAMVI_ID = pvsd.PHAMVI_ID and A.NGUONHANG_ID = dtk.NGUONDUOC_ID        where dtk.SOLUONG > 0 and dtk.BENHVIEN_ID = 'HLU01'        group by LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')), pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        ) tk on tk.DUOC_ID = d.DUOC_ID        left join TM_DUOC_PHAMVISUDUNG kd on kd.PHAMVI_ID = tk.PHAMVI_ID and kd.BENHVIEN_ID = 'HLU01'        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = tk.NGUONDUOC_ID and nh.BENHVIEN_ID = 'HLU01'        where d.BENHVIEN_ID = 'HLU01'  and tk.SOLUONG >= 0        end        else        begin                  select  distinct tk.DUOC_KEY, LTRIM(tk.PHAMVI_ID) as PHAMVI_ID, tk.NGUONDUOC_ID, nh.TENNGUONDUOC, nh.TINHTIEN, d.DUOC_ID, ld.MALOAIDUOC,        d.SOVISA,d.TYLE_VAT,d.COTOA, d.MADUOC, d.TENHANG, d.TENDUOCDAYDU, d.DONVITINH as DONVITINH, d.BHYT,        d.TENHOATCHAT, d.HAMLUONG, d.HANGSANXUAT, d.QUOCGIA, d.LOAIDUOC_ID, d.DUONGDUNG_ID, d.TINHTIEN_PTTT,        ten.TENDUOC, ten.TENDUOC_EN, ten.MAQUOCTE, ten.MAQUOCTEBT,d.CONGDUNG,        CASE WHEN d.BHYT = '1' THEN 'BHYT' ELSE '' END as BHYT_TEXT        , ld.LOAIVATTU_ID        , d.BENHVIEN_ID,        tk.SOLUONG, d.VTYT_PHANLOAI, d.PHAMVI, d.SUASOLUONGTONGHOP, d.MADUOCBV, d.DANGTRINHBAY        , TAMNGUNG = CASE WHEN d.TAMNGUNG = '1' OR nh.TAMNGUNG = '1' OR kd.TAMNGUNG = '1' THEN '1' ELSE '0' END        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        inner join        (        select  LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')) DUOC_KEY, (SUM(dtk.SOLUONG) - isnull(sum(A.SOLUONG),0) - isnull(sum(B.SOLUONG),0)) SOLUONG, pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        from (select sum(soluong) soluong,duoc_id,nguonduoc_id,khoduoc_id,benhvien_id from TT_DUOC_TONKHO  group by duoc_id,nguonduoc_id,khoduoc_id,benhvien_id) dtk        inner join TM_DUOC_PHAMVISD_MAPPING pvsd on dtk.KHODUOC_ID = pvsd.KHODUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NOITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) B on B.DUOC_ID = dtk.DUOC_ID and B.SOLUONG > 0 and B.PHAMVI_ID = pvsd.PHAMVI_ID and B.NGUONHANG_ID = dtk.NGUONDUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NGOAITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) A on A.DUOC_ID = dtk.DUOC_ID and A.SOLUONG > 0 and A.PHAMVI_ID = pvsd.PHAMVI_ID and A.NGUONHANG_ID = dtk.NGUONDUOC_ID        where dtk.SOLUONG > 0 and dtk.BENHVIEN_ID = 'HLU01'        group by LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')), pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        ) tk on tk.DUOC_ID = d.DUOC_ID        left join TM_DUOC_PHAMVISUDUNG kd on kd.PHAMVI_ID = tk.PHAMVI_ID and kd.BENHVIEN_ID = 'HLU01'        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = tk.NGUONDUOC_ID and nh.BENHVIEN_ID = 'HLU01'        where d.BENHVIEN_ID = 'HLU01'  and tk.SOLUONG >= 0        end]
2020-01-02 17:18:01,024 [5] DEBUG - Statement Id: [DAO00320_GetList] PreparedStatement : [select M.*            from TM_MAU M            LEFT JOIN TM_MAU_DONVITINH DVT on M.DONVITINH_ID=DVT.DONVITINH_ID            where            M.TAMNGUNG = '0'            and M.BENHVIEN_ID = 'HLU01'            order by M.TENMAU]
2020-01-02 17:18:01,089 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM071']
2020-01-02 17:18:01,147 [5] DEBUG - Statement Id: [DAO00322_GetListMauTonKhoForCreateCached] PreparedStatement : [SELECT DISTINCT        TK.MAU_KEY, TK.KHOMAU_ID, M.MAU_ID, M.MAMAU, M.TENMAU, M.NHOM_ABO, M.NHOM_RH, M.LOAIMAU_ID,        TK.SOLONHAP_ID, SLN.SOLONHAP, SLN.SOKIEMSOAT, TK.NGUONHANG_ID, NG.TENNGUONMAU, M.BENHVIEN_ID, M.DONVITINH_ID,        SUM(tk.SOLUONG) AS SOLUONG,K.TENKHO,DVT.TENDONVITINH        FROM TT_MAU_TONKHO TK        JOIN TM_KHO K ON TK.KHOMAU_ID = K.KHO_ID        JOIN TT_MAU_CHUNGTU_SOLONHAP SLN ON TK.SOLONHAP_ID = SLN.SOLONHAP_ID        JOIN TM_MAU M on TK.MAU_ID = M.MAU_ID and M.TAMNGUNG = '0'        LEFT JOIN TM_MAU_DONVITINH DVT on M.DONVITINH_ID=DVT.DONVITINH_ID        LEFT JOIN TM_NGUONMAU NG ON NG.NGUONMAU_ID = TK.NGUONHANG_ID        WHERE TK.SOLUONG > 0        GROUP BY TK.MAU_KEY, TK.KHOMAU_ID, M.MAU_ID, M.MAMAU, M.TENMAU, M.NHOM_ABO, M.NHOM_RH, M.LOAIMAU_ID,        TK.SOLONHAP_ID, SLN.SOLONHAP, SLN.SOKIEMSOAT,TK.NGUONHANG_ID, NG.TENNGUONMAU, M.BENHVIEN_ID, M.DONVITINH_ID,K.TENKHO,DVT.TENDONVITINH]
2020-01-02 17:18:01,286 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM073']
2020-01-02 17:18:01,317 [5] DEBUG - Statement Id: [DAO00322_GetListMauTonKhoTruBooking] PreparedStatement : [select distinct        TK.MAU_KEY, TK.KHOMAU_ID, M.MAU_ID, M.MAMAU, M.TENMAU, M.NHOM_ABO, M.NHOM_RH, M.LOAIMAU_ID, M.DONVITINH_ID,        TK.SOLONHAP_ID, TK.SOLONHAP, TK.SOKIEMSOAT,M.PHAMVI, TK.NGUONHANG_ID, NG.TENNGUONMAU, M.BENHVIEN_ID,        TK.SOLUONG,TK.TENKHO,DVT.TENDONVITINH        from TM_MAU M        JOIN        (        select        A.MAU_KEY, A.KHOMAU_ID, A.MAU_ID ,a.NGUONHANG_ID, A.SOLONHAP_ID, A.SOLONHAP, A.SOKIEMSOAT, A.SOLUONG,A.TENKHO        from        (        select KHOMAU_ID, TK.MAU_ID, TK.NGUONHANG_ID, TK.MAU_KEY, SLN.SOLONHAP_ID, SLN.SOLONHAP, SLN.SOKIEMSOAT, ISNULL(TK.SOLUONG,0) - ISNULL(book.SOLUONG,0) as SOLUONG,K.TENKHO        from TT_MAU_TONKHO TK        JOIN TM_KHO K ON TK.KHOMAU_ID = K.KHO_ID        inner join TT_MAU_CHUNGTU_SOLONHAP SLN ON TK.SOLONHAP_ID = SLN.SOLONHAP_ID        left join dbo.TT_MAU_TONKHO_BOOK book ON book.MAU_KEY = TK.MAU_KEY AND book.TRANGTHAI = 'HIEULUC'        where ISNULL(TK.SOLUONG,0) - ISNULL(book.SOLUONG,0) > 0        ) A        )TK on TK.MAU_ID = M.MAU_ID and M.TAMNGUNG = '0'        LEFT JOIN TM_MAU_DONVITINH DVT on M.DONVITINH_ID=DVT.DONVITINH_ID        LEFT JOIN TM_NGUONMAU NG ON NG.NGUONMAU_ID = TK.NGUONHANG_ID]
2020-01-02 17:18:01,381 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM072']
2020-01-02 17:18:02,302 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'MAIN'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2020-01-02 17:18:03,224 [1] DEBUG - Statement Id: [DAO00002_FormList] PreparedStatement : [select              TM_SYS_FORM.HOSPITAL_ID,              TM_SYS_FORM.NAME,              TM_SYS_FORM.CLASS,              TM_SYS_FORM.ASSEMBLY,              TM_SYS_FORM.TITLE_VI as TITLE              from TM_SYS_FORM              where HOSPITAL_ID = 'HLU01']
2020-01-02 17:18:08,117 [1] DEBUG - Statement Id: [DAO00300_GetShortcutListByUserID] PreparedStatement : [SELECT S.SHORTCUT_CODE, S.SHORTCUT_VALUE              FROM TM_SHORTCUT AS S              WHERE S.BENHVIEN_ID = 'HLU01' AND S.USER_ID = '1' AND TAMNGUNG = '0']
2020-01-02 17:18:08,144 [1] DEBUG - Statement Id: [DAO00087_GetList] PreparedStatement : [select CODE, VALUE, BENHVIEN_ID              from TM_SYS_APPSETTINGS              where LOCKED = '0' and BENHVIEN_ID = 'HLU01'              order by SETTING_ID]
2020-01-02 17:18:08,253 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'MSG01'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2020-01-02 17:18:08,373 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'MSG02'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2020-01-02 17:18:08,545 [1] DEBUG - Statement Id: [DAO00008_GetUserSettings] PreparedStatement : [select A.*, B.TENKHO , C.TENPHONGBAN, B.MAKHO, C.MAPHONGBAN          from TM_SYS_USERS A          left join TM_KHODUOC B on B.KHODUOC_ID = A.INVENTORY_ID          left join TM_PHONGBAN C on (C.PHONGBAN_ID = A.WORKING_DEPT_ID and C.BENHVIEN_ID =  @param0 )          left join TM_SYS_USERKHO D on (D.ACCOUNT_ID = A.ACCOUNT_ID and D.HOSPITAL_ID =  @param0 )          where          A.HOSPITAL_ID =  @param0            and                 A.ACCOUNT_ID =  @param1]
2020-01-02 17:18:08,547 [1] DEBUG - Statement Id: [DAO00008_GetUserSettings] Parameters: [@param0=[HOSPITAL_ID,HLU01], @param1=[ACCOUNT_ID,113]]
2020-01-02 17:18:08,547 [1] DEBUG - Statement Id: [DAO00008_GetUserSettings] Types: [@param0=[String, System.String], @param1=[String, System.String]]
2020-01-02 17:18:08,574 [1] DEBUG - Statement Id: [DAO00008_GetUserInvSettings] PreparedStatement : [select A.*, B.TENKHO, B.MAKHO, B.LOAIKHO_ID, B.KHOQUANLY_ID          from TM_SYS_USERKHO A          left join TM_KHO B on B.MODULE_ID = A.MODULE_ID and B.KHO_ID = A.KHO_ID          where A.HOSPITAL_ID =  @param0  and A.ACCOUNT_ID =  @param1           order by B.TENKHO]
2020-01-02 17:18:08,574 [1] DEBUG - Statement Id: [DAO00008_GetUserInvSettings] Parameters: [@param0=[HOSPITAL_ID,HLU01], @param1=[ACCOUNT_ID,113]]
2020-01-02 17:18:08,574 [1] DEBUG - Statement Id: [DAO00008_GetUserInvSettings] Types: [@param0=[String, System.String], @param1=[String, System.String]]
2020-01-02 17:18:08,718 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'COM30'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2020-01-02 17:18:08,901 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'RIS04'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2020-01-02 17:18:21,903 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'MENU1'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2020-01-02 17:18:21,995 [1] DEBUG - Statement Id: [DAO00011_GetList] PreparedStatement : [select              TM_SYS_MENU.ID,              TM_SYS_MENU.PARENTID,              TM_SYS_MENU.SCREEN,              TM_SYS_MENU.SMALLIMAGE,              TM_SYS_MENU.LARGEIMAGE,              TM_SYS_MENU.DESCRIPTION,              TM_SYS_MENU.TYPE,              TM_SYS_MENU.TITLE_VI as TITLE              from TM_SYS_MENU              where TM_SYS_MENU.HOSPITAL_ID = 'HLU01' and TM_SYS_MENU.ACTIVE = '1'               AND                   (TM_SYS_MENU.TYPE & '8' = '8')                             order by TM_SYS_MENU.ORDERNUM]
2020-01-02 17:18:22,264 [1] DEBUG - Statement Id: [DAO00011_usermenu_list] PreparedStatement : [select              TM_SYS_HOMEMENU.MENUID as ID,              TM_SYS_MENU.TITLE_VI as TITLE,              TM_SYS_MENU.SCREEN,              TM_SYS_MENU.SMALLIMAGE,              TM_SYS_MENU.LARGEIMAGE,              TM_SYS_MENU.TYPE              from TM_SYS_HOMEMENU              left join TM_SYS_MENU on TM_SYS_MENU.ID = TM_SYS_HOMEMENU.MENUID and TM_SYS_MENU.HOSPITAL_ID = TM_SYS_HOMEMENU.HOSPITAL_ID              where TM_SYS_HOMEMENU.HOSPITAL_ID = 'HLU01' and TM_SYS_HOMEMENU.USERID = '113' and TM_SYS_MENU.ACTIVE = '1'               AND                   (TM_SYS_MENU.TYPE & '8' = '8')                             ORDER BY TM_SYS_HOMEMENU.ORDERNUM]
2020-01-02 17:24:21,707 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'COM98'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2020-01-02 17:24:22,873 [1] DEBUG - Statement Id: [DAO00020_ListKhoDuocOfPhongBan] PreparedStatement : [select B.* from TM_PHONGBAN_KHODUOC A        inner join TM_KHODUOC B on B.KHODUOC_ID = A.KHODUOC_ID        where        A.PHONGBAN_ID = '25'        and A.BENHVIEN_ID = 'HLU01']
2020-01-02 17:24:28,145 [1] DEBUG - Statement Id: [DAO00020_ListKhoDuocOfPhongBan] PreparedStatement : [select B.* from TM_PHONGBAN_KHODUOC A        inner join TM_KHODUOC B on B.KHODUOC_ID = A.KHODUOC_ID        where        A.PHONGBAN_ID = '62'        and A.BENHVIEN_ID = 'HLU01']
2020-01-02 17:24:28,364 [1] DEBUG - Statement Id: [DAO00008_UpdateUserIdPhongBanKhoDuoc] PreparedStatement : [IF EXISTS            (SELECT ACCOUNT_ID FROM TM_SYS_USERS WHERE ACCOUNT_ID =  @param0  and HOSPITAL_ID =  @param1 )            BEGIN            update TM_SYS_USERS set INVENTORY_ID =  @param2 , WORKING_DEPT_ID =  @param3             WHERE ACCOUNT_ID =  @param0  and HOSPITAL_ID =  @param1             END            ELSE            BEGIN            insert into TM_SYS_USERS ([ACCOUNT_ID], [ACCOUNT_NAME], [INVENTORY_ID], [WORKING_DEPT_ID], [HOSPITAL_ID])            values ( @param0 ,  @param4 ,  @param2 ,  @param3 ,  @param1 )            END]
2020-01-02 17:24:28,364 [1] DEBUG - Statement Id: [DAO00008_UpdateUserIdPhongBanKhoDuoc] Parameters: [@param0=[ACCOUNT_ID,113], @param1=[HOSPITAL_ID,HLU01], @param2=[INVENTORY_ID,32], @param3=[WORKING_DEPT_ID,62], @param4=[ACCOUNT_NAME,admin]]
2020-01-02 17:24:28,364 [1] DEBUG - Statement Id: [DAO00008_UpdateUserIdPhongBanKhoDuoc] Types: [@param0=[String, System.String], @param1=[String, System.String], @param2=[String, System.String], @param3=[String, System.String], @param4=[String, System.String]]
2020-01-02 17:24:30,599 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'REG14'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2020-01-02 17:24:32,031 [1] DEBUG - Statement Id: [DAO00012_GetList] PreparedStatement : [select        DICTIONARY_ID,        DICTIONARY_CODE,        DICTIONARY_NAME,        ATTRIBUTE1,        ATTRIBUTE2,        DICTIONARY_NAME_EN        from LST_DICTIONARY        where LST_DICTIONARY.Enabled = '1'         AND           LST_DICTIONARY.DICTIONARY_TYPE_CODE = 'PhanLoaiTiepNhan'                 order by LST_DICTIONARY.IDX]
2020-01-02 17:24:32,109 [1] DEBUG - Statement Id: [DAO00012_GetList] PreparedStatement : [select        DICTIONARY_ID,        DICTIONARY_CODE,        DICTIONARY_NAME,        ATTRIBUTE1,        ATTRIBUTE2,        DICTIONARY_NAME_EN        from LST_DICTIONARY        where LST_DICTIONARY.Enabled = '1'         AND           LST_DICTIONARY.DICTIONARY_TYPE_CODE = 'NguonBN'                 order by LST_DICTIONARY.IDX]
2020-01-02 17:24:32,134 [1] DEBUG - Statement Id: [DAO00019_GetListCongTyChiTra] PreparedStatement : [select *        from TM_CONGTYCHITRA        where        BENHVIEN_ID = 'HLU01' AND TAMNGUNG = '0']
2020-01-02 17:24:32,356 [1] DEBUG - Statement Id: [DAO00017_GetListPhongKham] PreparedStatement : [select pb.PHONGBAN_ID, pb.TENPHONGBAN, case when dv.ATTRIBUTE5 is null then 'TT' else 'KTC' end as LOAI_CHIPHI              from [TM_PHONGBAN_DICHVU] as pb_dv              inner join [TM_PHONGBAN] as pb on pb.PHONGBAN_ID = pb_dv.PHONGBAN_ID and pb.BENHVIEN_ID = 'HLU01'              inner join [TM_DICHVU] dv on dv.DICHVU_ID = pb_dv.DICHVU_ID and dv.MADICHVU = '' and dv.BENHVIEN_ID = 'HLU01'              where pb_dv.BENHVIEN_ID = 'HLU01']
2020-01-02 17:24:32,395 [1] DEBUG - Statement Id: [DAO00019_GetListPhongKham_REG13] PreparedStatement : [select pb.PHONGBAN_ID, pb.TENPHONGBAN, case when dv.ATTRIBUTE5 is null then 'TT' else 'KTC' end as LOAI_CHIPHI        from TM_PHONGBAN pb        left join TM_PHONGBAN_DICHVU pb_dv on pb_dv.PHONGBAN_ID = pb.PHONGBAN_ID and pb_dv.BENHVIEN_ID = pb.BENHVIEN_ID        left join TM_DICHVU dv on dv.DICHVU_ID = pb_dv.DICHVU_ID and dv.BENHVIEN_ID = pb_dv.BENHVIEN_ID        left join TM_NHOMDICHVU ndv on ndv.NHOMDICHVU_ID = dv.NHOMDICHVU_ID and ndv.BENHVIEN_ID = dv.BENHVIEN_ID        where pb.BENHVIEN_ID = 'HLU01' and ndv.MANHOMDICHVU = '04' and dv.DICHVU_ID IS NOT NULL]
2020-01-02 17:24:32,489 [1] DEBUG - Statement Id: [DAO00019_LayThongTinSoluongDichVuPhongKham_REG13] PreparedStatement : [select PHONGBAN_ID, TENPHONGBAN, NOITHUCHIEN_ID, SUM(CHUAKETQUA) AS CHUAKETQUA, SUM(HOANTAT) AS HOANTAT, SUM(DANGTHUCHIEN) AS DANGTHUCHIEN        from (        select B.PHONGBAN_ID, B.TENPHONGBAN, A.NOITHUCHIEN_ID,        case when A.TRANGTHAI = 'CHUAKETQUA' then 1 else 0 end AS CHUAKETQUA,        case when A.TRANGTHAI = 'HOANTAT' then 1 else 0 end AS HOANTAT,        case when A.TRANGTHAI = 'DANGTHUCHIEN' then 1 else 0 end AS DANGTHUCHIEN        from TM_PHONGBAN B        left join TT_DVYEUCAU A on A.NOITHUCHIEN_ID = B.PHONGBAN_ID and A.BENHVIEN_ID = B.BENHVIEN_ID and A.NGAYYEUCAU = CONVERT(date, getdate())        left join TM_DICHVU dv on A.DICHVU_ID = dv.DICHVU_ID        left join TM_NHOMDICHVU ndv on ndv.NHOMDICHVU_ID = dv.NHOMDICHVU_ID        where B.BENHVIEN_ID ='HLU01' and Left(ndv.MANHOMDICHVU,2) = '04'        and B.PHONGBAN_ID in (65,71,72,41,68,62,177,67,55,81,57,57,58,59,60,63,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,61,69,69,70,70)        ) tmp        group by tmp.NOITHUCHIEN_ID, tmp.TENPHONGBAN, tmp.PHONGBAN_ID]
2020-01-02 17:30:28,674 [1] DEBUG - Statement Id: [DAO00087_GetServiceParams] PreparedStatement : [select CODE, VALUE              from TM_SYS_APPSETTINGS              where LOCKED = '0' and BENHVIEN_ID = 'HLU01']
2020-01-02 17:30:28,916 [1] DEBUG - Statement Id: [DAO00095_GetDetailTrungBN] PreparedStatement : [select  TT_TIEPNHAN.NGAYTIEPNHAN AS NGAYTIEPNHAN ,TT_TIEPNHAN.SOBHYT AS SOTHE, TT_BENHNHAN.*, ISNULL(TT_BENHNHAN.NGAYSINH,TT_BENHNHAN.NAMSINH) AS NGAYNAMSINH          from TT_BENHNHAN          left join TT_TIEPNHAN  ON          TT_TIEPNHAN.TIEPNHAN_ID = (SELECT TOP 1 TIEPNHAN_ID FROM TT_TIEPNHAN WHERE BENHNHAN_ID = TT_BENHNHAN.BENHNHAN_ID ORDER BY THOIGIANTIEPNHAN DESC)           WHERE                TT_BENHNHAN.TENBENHNHAN = N'Test 1'             AND               convert(varchar(10),TT_BENHNHAN.NGAYSINH, 103) = convert(varchar(10),'03/03/1997', 103)               AND               TT_BENHNHAN.GIOITINH = '2']
2020-01-02 17:30:44,025 [1] DEBUG - Statement Id: [DAO00000_GetKyHieuBHYT] PreparedStatement : [select * from TM_DOITUONG where NHOMTHE LIKE '%' +  @param0  + '%']
2020-01-02 17:30:44,025 [1] DEBUG - Statement Id: [DAO00000_GetKyHieuBHYT] Parameters: [@param0=[MATHEBHYT,DN4]]
2020-01-02 17:30:44,025 [1] DEBUG - Statement Id: [DAO00000_GetKyHieuBHYT] Types: [@param0=[String, System.String]]
2020-01-02 17:30:44,195 [1] DEBUG - Statement Id: [DAO00095_GetDetail] PreparedStatement : [select distinct TT_BENHNHAN.*, ISNULL(TT_BENHNHAN.NGAYSINH, TT_BENHNHAN.NAMSINH) AS NGAYNAMSINH, TN1.SOBHYT AS SOTHE, TN1.NGAYTIEPNHAN          from TT_BENHNHAN          left join (          select MAX(TIEPNHAN_ID) AS TIEPNHAN_ID, BENHNHAN_ID from TT_TIEPNHAN GROUP BY BENHNHAN_ID) TN ON TN.BENHNHAN_ID = TT_BENHNHAN.BENHNHAN_ID          left join TT_TIEPNHAN TN1 ON TN1.TIEPNHAN_ID = TN.TIEPNHAN_ID           WHERE                TN1.SOBHYT = 'DN452523534525238289']
2020-01-02 17:30:49,071 [1] DEBUG - Statement Id: [DAO00000_GetKyHieuBHYT] PreparedStatement : [select * from TM_DOITUONG where NHOMTHE LIKE '%' +  @param0  + '%']
2020-01-02 17:30:49,071 [1] DEBUG - Statement Id: [DAO00000_GetKyHieuBHYT] Parameters: [@param0=[MATHEBHYT,DN4]]
2020-01-02 17:30:49,071 [1] DEBUG - Statement Id: [DAO00000_GetKyHieuBHYT] Types: [@param0=[String, System.String]]
2020-01-02 17:30:57,366 [1] DEBUG - Statement Id: [DAO00019_GetLoaiGiaLoaiKhachHang] PreparedStatement : [select A.*, B.DICTIONARY_CODE MAKHACHHANG, C.TENLOAIGIA        from TM_NGUONKHACHHANG_LOAIGIA A        left join LST_DICTIONARY B on A.NGUONKHACHHANG_BENHNHAN_ID = B.DICTIONARY_ID        inner join TM_LOAIGIA C on C.LOAIGIA_ID = A.LOAIGIA_ID and CAPTREN_ID  = (select LOAIGIA_ID from TM_LOAIGIA where MALOAIGIA = 'GiaDichVu')        left join TM_DICHVU_DONGIA dvdg on dvdg.LOAIGIA_ID = A.LOAIGIA_ID        where B.DICTIONARY_TYPE_CODE = 'NguonKhachHang' and dvdg.DICHVU_ID  =  @param0]
2020-01-02 17:30:57,367 [1] DEBUG - Statement Id: [DAO00019_GetLoaiGiaLoaiKhachHang] Parameters: [@param0=[DICHVU_ID,5492]]
2020-01-02 17:30:57,367 [1] DEBUG - Statement Id: [DAO00019_GetLoaiGiaLoaiKhachHang] Types: [@param0=[Int64, System.Int64]]
2020-01-02 17:30:57,764 [1] DEBUG - Statement Id: [DAO00017_GetLoaiGiaDoiTuongDichVu] PreparedStatement : [select a.LOAIGIA_ID, a.TENLOAIGIA, a.MALOAIGIA, a.CAPTREN_ID, MIN(a.UUTIEN_NGUON) AS UUTIEN_NGUON          , MAX(a.DOUUTIEN) AS DOUUTIEN, MIN(ISNULL(a.GIAHOTRO,0)) AS GIAHOTRO          from(                        select distinct A.LOAIGIA_ID, C.TENLOAIGIA, C.MALOAIGIA, 0 as UUTIEN_NGUON, isnull(B.DOUUTIEN,0) as DOUUTIEN, B.GIAHOTRO, C.CAPTREN_ID            from TM_DOITUONG_GIADICHVU A            left join TM_DOITUONG_LOAIGIA B on A.LOAIGIA_ID = B.LOAIGIA_ID and A.DOITUONG_ID = B.DOITUONG_ID and B.BENHVIEN_ID = 'HLU01'            inner join TM_LOAIGIA C on A.LOAIGIA_ID = C.LOAIGIA_ID and C.BENHVIEN_ID = 'HLU01'            where A.DOITUONG_ID = '4'                            and A.DICHVU_ID = '5492'                         and A.BENHVIEN_ID = 'HLU01'                     ) a          where a.DOUUTIEN != 0 and a.DOUUTIEN is not null          group by a.LOAIGIA_ID, a.TENLOAIGIA, a.MALOAIGIA, a.CAPTREN_ID          order by MAX(a.UUTIEN_NGUON) desc ,MAX(a.DOUUTIEN) asc]
2020-01-02 17:30:57,951 [1] DEBUG - Statement Id: [DAO00017_GetListPhongKham] PreparedStatement : [select pb.PHONGBAN_ID, pb.TENPHONGBAN, case when dv.ATTRIBUTE5 is null then 'TT' else 'KTC' end as LOAI_CHIPHI              from [TM_PHONGBAN_DICHVU] as pb_dv              inner join [TM_PHONGBAN] as pb on pb.PHONGBAN_ID = pb_dv.PHONGBAN_ID and pb.BENHVIEN_ID = 'HLU01'              inner join [TM_DICHVU] dv on dv.DICHVU_ID = pb_dv.DICHVU_ID and dv.MADICHVU = '5492' and dv.BENHVIEN_ID = 'HLU01'              where pb_dv.BENHVIEN_ID = 'HLU01']
2020-01-02 17:30:58,005 [1] DEBUG - Statement Id: [DAO00019_GetListPhongKham_REG13] PreparedStatement : [select pb.PHONGBAN_ID, pb.TENPHONGBAN, case when dv.ATTRIBUTE5 is null then 'TT' else 'KTC' end as LOAI_CHIPHI        from TM_PHONGBAN pb        left join TM_PHONGBAN_DICHVU pb_dv on pb_dv.PHONGBAN_ID = pb.PHONGBAN_ID and pb_dv.BENHVIEN_ID = pb.BENHVIEN_ID        left join TM_DICHVU dv on dv.DICHVU_ID = pb_dv.DICHVU_ID and dv.BENHVIEN_ID = pb_dv.BENHVIEN_ID        left join TM_NHOMDICHVU ndv on ndv.NHOMDICHVU_ID = dv.NHOMDICHVU_ID and ndv.BENHVIEN_ID = dv.BENHVIEN_ID        where pb.BENHVIEN_ID = 'HLU01' and ndv.MANHOMDICHVU = '04' and dv.DICHVU_ID IS NOT NULL]
2020-01-02 17:30:58,097 [1] DEBUG - Statement Id: [DAO00019_LayThongTinSoluongDichVuPhongKham_REG13] PreparedStatement : [select PHONGBAN_ID, TENPHONGBAN, NOITHUCHIEN_ID, SUM(CHUAKETQUA) AS CHUAKETQUA, SUM(HOANTAT) AS HOANTAT, SUM(DANGTHUCHIEN) AS DANGTHUCHIEN        from (        select B.PHONGBAN_ID, B.TENPHONGBAN, A.NOITHUCHIEN_ID,        case when A.TRANGTHAI = 'CHUAKETQUA' then 1 else 0 end AS CHUAKETQUA,        case when A.TRANGTHAI = 'HOANTAT' then 1 else 0 end AS HOANTAT,        case when A.TRANGTHAI = 'DANGTHUCHIEN' then 1 else 0 end AS DANGTHUCHIEN        from TM_PHONGBAN B        left join TT_DVYEUCAU A on A.NOITHUCHIEN_ID = B.PHONGBAN_ID and A.BENHVIEN_ID = B.BENHVIEN_ID and A.NGAYYEUCAU = CONVERT(date, getdate())        left join TM_DICHVU dv on A.DICHVU_ID = dv.DICHVU_ID        left join TM_NHOMDICHVU ndv on ndv.NHOMDICHVU_ID = dv.NHOMDICHVU_ID        where B.BENHVIEN_ID ='HLU01' and Left(ndv.MANHOMDICHVU,2) = '04'        and B.PHONGBAN_ID in (65,71,72,41,68,62,177,67,55,81,57,57,58,59,60,63,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,61,69,69,70,70)        ) tmp        group by tmp.NOITHUCHIEN_ID, tmp.TENPHONGBAN, tmp.PHONGBAN_ID]
2020-01-02 17:30:58,233 [1] DEBUG - Statement Id: [DAO00000_GetDICHVU_DONGIA_LOAIGIA] PreparedStatement : [select A.LOAIGIA_ID, A.BANGGIA_ID, A.GIAVON, A.TYLEVAT  as TYLE_VAT, A.TYLE_LOINHUAN,            A.DONGIA as DONGIA_DOANHTHU, NULL as DONGIA_KHAC, isnull(D.MAPHANNHOMDICHVU, 'TT') as LOAI_CHIPHI            from TM_DICHVU_DONGIA A            inner join TM_BANGGIA B on B.LOAIGIA_ID = A.LOAIGIA_ID AND B.BENHVIEN_ID = 'HLU01'            left join (select B.MAPHANNHOMDICHVU, A.* from TM_DICHVU_PHANNHOMDICHVU A            inner join TM_PHANNHOMDICHVU B on  B.PHANNHOMDICHVU_ID = A.PHANNHOMDICHVU_ID            where A.DICHVU_ID = '5492' AND A.BENHVIEN_ID = 'HLU01') D on A.DICHVU_ID = D.DICHVU_ID            where A.LOAIGIA_ID = '2' and A.DICHVU_ID = '5492'            union            select A.LOAIGIA_ID, null as BANGGIA_ID, null as GIAVON, null as TYLE_VAT, null as TYLE_LOINHUAN,            null as DONGIA_DOANHTHU, C.DONGIA as DONGIA_KHAC, isnull(D.MAPHANNHOMDICHVU, 'TT') as LOAI_CHIPHI            from TM_DOITUONG_GIADICHVU A            inner join TM_BANGGIA B on B.LOAIGIA_ID = A.LOAIGIA_ID AND B.BENHVIEN_ID = 'HLU01'            left join TM_DICHVU_DONGIA C on C.LOAIGIA_ID = A.LOAIGIA_ID AND C.BENHVIEN_ID = 'HLU01'            and C.BANGGIA_ID = B.BANGGIA_ID and C.DICHVU_ID = A.DICHVU_ID            left join (select B.MAPHANNHOMDICHVU, A.* from TM_DICHVU_PHANNHOMDICHVU A            inner join TM_PHANNHOMDICHVU B on  B.PHANNHOMDICHVU_ID = A.PHANNHOMDICHVU_ID            where A.DICHVU_ID = '5492' AND A.BENHVIEN_ID = 'HLU01') D on A.DICHVU_ID = D.DICHVU_ID            where A.DOITUONG_ID = '4'  and A.DICHVU_ID = '5492' and A.LOAIGIA_ID            in (select top 1 LOAIGIA_ID from TM_DOITUONG_LOAIGIA            where DOITUONG_ID = '4' and GIAHOTRO = '1'  AND BENHVIEN_ID = 'HLU01'            and LOAIGIA_ID            in (select LOAIGIA_ID from TM_BANGGIA            where LOAIBANGGIA in            (select LOAIBANGGIA from TM_BANGGIA where LOAIGIA_ID = '2'  AND BENHVIEN_ID = 'HLU01')            and TAMNGUNG = '0')  AND BENHVIEN_ID = 'HLU01'            )]
2020-01-02 17:30:58,287 [1] DEBUG - Statement Id: [DAO00024_TM_TIEPNHAN_BANGGIA_DICHVU_getlist] PreparedStatement : [select * from TM_TIEPNHAN_BANGGIA_DICHVU where TAMNGUNG != '1' and BENHVIEN_ID = 'HLU01']
2020-01-02 17:30:59,562 [1] DEBUG - Statement Id: [DAO00000_GetKyHieuBHYT] PreparedStatement : [select * from TM_DOITUONG where NHOMTHE LIKE '%' +  @param0  + '%']
2020-01-02 17:30:59,562 [1] DEBUG - Statement Id: [DAO00000_GetKyHieuBHYT] Parameters: [@param0=[MATHEBHYT,DN4]]
2020-01-02 17:30:59,562 [1] DEBUG - Statement Id: [DAO00000_GetKyHieuBHYT] Types: [@param0=[String, System.String]]
2020-01-02 17:31:01,746 [1] DEBUG - Statement Id: [DAO00013_Add_BenhNhan] PreparedStatement : [declare @keyValue int, @BenhVienId varchar(10), @yearNow int, @Mayte varchar(20), @SoVaoVien varchar(20), @fid varchar(20),        @Bnid int, @Manoisinh varchar(10), @Namsinh int, @Ngaysinh smalldatetime, @Gioitinh int, @Thangsinh int, @Daysinh int, @beginpatient int        declare @InsertedRows TABLE (BENHNHAN_ID INT, MAYTE varchar(20), MANOISINH varchar(10), NAMSINH int, NGAYSINH smalldatetime, GIOITINH int )        set @keyValue = 0;        set @Thangsinh = 0;        set @Daysinh = 0;        set @beginpatient = 0;        set @fid = 'F';        set @BenhVienId = 'HLU01'        set @yearNow = YEAR(getdate())                select @beginpatient = isnull(VALUE, 0) from TM_SYS_APPSETTINGS where CODE = 'COM_FIRST_NUMBER_PATIENTCODE_INTHEYEAR'          select @keyValue = KEYVALUE from LST_KEYDATA        where KEYTYPE = 'MAYTE' and KEYYEAR = @yearNow                if @keyValue = 0        Insert into LST_KEYDATA values ('MAYTE', @yearNow, '0', '0', '0', '0', '0', @beginpatient, @BenhVienId);        Update LST_KEYDATA set KEYVALUE = KEYVALUE + 1, @keyValue = (KEYVALUE + 1) where KEYTYPE = 'MAYTE' and KEYYEAR = @yearNow                set @SoVaoVien = right('0000000'+convert(varchar(7), @keyValue), 7)        set @Mayte = RIGHT(@yearNow, 2) + @SoVaoVien                insert into TT_BENHNHAN (        MAYTE        , SOVAOVIEN        , TENBENHNHAN        , HO        , TEN        , GIOITINH        , NGAYSINH        , NAMSINH        , MANOISINH        , SONHA        , DIACHI        , SODIENTHOAI        , XAPHUONG_ID        , QUANHUYEN_ID        , TINHTHANH_ID        , DANTOC_ID        , QUOCTICH_ID        , SOLUUTRUNOITRU        , SOLUUTRUNGOAITRU        , NGHENGHIEP_ID        , CMND        , HOCHIEU        , VIETKIEU        , NGUOINUOCNGOAI        , DIACHITHUONGTRU        , DIACHILIENLAC        , DIACHICOQUAN        , EMAIL        , NHOMMAU_ID        , YEUTORH_ID        , TIENSUDIUNG        , TIENSUBENH        , TIENSUHUTTHUOCLA        , TUVONG        , NGAYTUVONG        , THOIGIANTUVONG        , NGUYENNHANTUVONG_ID        , NGUOIGHINHANTUVONG_ID        , THOIGIANGHINHANTUVONG        , NHANVIEN_ID        , DONVICONGTAC_ID        , DIENTHOAIBAN        , TINHTRANGHONNHAN_ID        , NGUOILIENHE_ID        , MOIQUANHE_ID        , NGUOILIENHE        , THONGTIN_NLH        , GHICHU        , HINHANH_DAIDIEN        , SITE_ID        , PID        , ACTIVE        , BENHVIEN_ID        , NGAYTAO        , NGUOITAO_ID        , NGAYGIOSINH        )                values (        @Mayte        , @SoVaoVien        ,  @param0         ,  @param1         ,  @param2         ,  @param3         ,  @param4         ,  @param5         ,  @param6         ,  @param7         ,  @param8         ,  @param9         ,  @param10         ,  @param11         ,  @param12         ,  @param13         ,  @param14         ,  @param15         ,  @param16         ,  @param17         ,  @param18         ,  @param19         ,  @param20         ,  @param21         ,  @param22         ,  @param23         ,  @param24         ,  @param25         ,  @param26         ,  @param27         ,  @param28         ,  @param29         ,  @param30         ,  @param31         ,  @param32         ,  @param33         ,  @param34         ,  @param35         ,  @param36         ,  @param37         ,  @param38         ,  @param39         ,  @param40         ,  @param41         ,  @param42         ,  @param43         ,  @param44         ,  @param45         ,  @param46         ,  @param47         ,  @param48         , '1'        ,  @param49         ,  @param50         ,  @param51         ,  @param52         );        set @Bnid = SCOPE_IDENTITY()                select @Manoisinh = MANOISINH, @Namsinh = NAMSINH, @Ngaysinh = NGAYSINH, @Gioitinh = GIOITINH from @InsertedRows;        IF (@Ngaysinh is not Null)        BEGIN        set @Thangsinh = MONTH(@Ngaysinh);        set @Daysinh = DAY(@Ngaysinh);        END        IF (@Manoisinh is Null) set @Manoisinh = '0'        set @fid = right('000'+convert(varchar(3), @Manoisinh), 3) + convert(varchar(1), @Gioitinh) + RIGHT(@Namsinh, 2) + right('00'+convert(varchar(2), @Thangsinh), 2) + right('00'+convert(varchar(2), @Daysinh), 2) + right('000000000'+convert(varchar(9), @Bnid), 9) + convert(varchar(1), 'F');                update TT_BENHNHAN set FID = @fid where BENHNHAN_ID = @Bnid;                select @Bnid]
2020-01-02 17:31:01,747 [1] DEBUG - Statement Id: [DAO00013_Add_BenhNhan] Parameters: [@param0=[TENBENHNHAN,Test 1], @param1=[HO,Test], @param2=[TEN,1], @param3=[GIOITINH,2], @param4=[NGAYSINH,3/3/1997 12:00:00 AM], @param5=[NAMSINH,1997], @param6=[MANOISINH,null], @param7=[SONHA,null], @param8=[DIACHI,null], @param9=[SODIENTHOAI,null], @param10=[XAPHUONG_ID,16435], @param11=[QUANHUYEN_ID,null], @param12=[TINHTHANH_ID,null], @param13=[DANTOC_ID,332], @param14=[QUOCTICH_ID,291], @param15=[SOLUUTRUNOITRU,null], @param16=[SOLUUTRUNGOAITRU,null], @param17=[NGHENGHIEP_ID,null], @param18=[CMND,null], @param19=[HOCHIEU,null], @param20=[VIETKIEU,null], @param21=[NGUOINUOCNGOAI,null], @param22=[DIACHITHUONGTRU,Xã Đông Hưng, Thành phố Thanh Hóa, Tỉnh Thanh Hóa], @param23=[DIACHILIENLAC,Xã Đông Hưng, Thành phố Thanh Hóa, Tỉnh Thanh Hóa], @param24=[DIACHICOQUAN,null], @param25=[EMAIL,null], @param26=[NHOMMAU_ID,null], @param27=[YEUTORH_ID,null], @param28=[TIENSUDIUNG,null], @param29=[TIENSUBENH,null], @param30=[TIENSUHUTTHUOCLA,null], @param31=[TUVONG,null], @param32=[NGAYTUVONG,null], @param33=[THOIGIANTUVONG,null], @param34=[NGUYENNHANTUVONG_ID,null], @param35=[NGUOIGHINHANTUVONG_ID,null], @param36=[THOIGIANGHINHANTUVONG,null], @param37=[NHANVIEN_ID,null], @param38=[DONVICONGTAC_ID,null], @param39=[DIENTHOAIBAN,null], @param40=[TINHTRANGHONNHAN_ID,null], @param41=[NGUOILIENHE_ID,null], @param42=[MOIQUANHE_ID,null], @param43=[NGUOILIENHE,null], @param44=[THONGTIN_NLH,null], @param45=[GHICHU,null], @param46=[HINHANH_DAIDIEN,imgFemale.png], @param47=[SITE_ID,HLU01], @param48=[PID,null], @param49=[BENHVIEN_ID,HLU01], @param50=[NGAYTAO,1/2/2020 5:31:01 PM], @param51=[NGUOITAO_ID,1], @param52=[NGAYGIOSINH,null]]
2020-01-02 17:31:01,747 [1] DEBUG - Statement Id: [DAO00013_Add_BenhNhan] Types: [@param0=[String, System.String], @param1=[String, System.String], @param2=[String, System.String], @param3=[Int64, System.Int64], @param4=[DateTime, System.DateTime], @param5=[Int64, System.Int64], @param6=[System.DBNull, null], @param7=[System.DBNull, null], @param8=[System.DBNull, null], @param9=[System.DBNull, null], @param10=[String, System.String], @param11=[System.DBNull, null], @param12=[System.DBNull, null], @param13=[Int64, System.Int64], @param14=[Int64, System.Int64], @param15=[System.DBNull, null], @param16=[System.DBNull, null], @param17=[System.DBNull, null], @param18=[System.DBNull, null], @param19=[System.DBNull, null], @param20=[System.DBNull, null], @param21=[System.DBNull, null], @param22=[String, System.String], @param23=[String, System.String], @param24=[System.DBNull, null], @param25=[System.DBNull, null], @param26=[System.DBNull, null], @param27=[System.DBNull, null], @param28=[System.DBNull, null], @param29=[System.DBNull, null], @param30=[System.DBNull, null], @param31=[System.DBNull, null], @param32=[System.DBNull, null], @param33=[System.DBNull, null], @param34=[System.DBNull, null], @param35=[System.DBNull, null], @param36=[System.DBNull, null], @param37=[System.DBNull, null], @param38=[System.DBNull, null], @param39=[System.DBNull, null], @param40=[System.DBNull, null], @param41=[System.DBNull, null], @param42=[System.DBNull, null], @param43=[System.DBNull, null], @param44=[System.DBNull, null], @param45=[System.DBNull, null], @param46=[String, System.String], @param47=[String, System.String], @param48=[System.DBNull, null], @param49=[String, System.String], @param50=[DateTime, System.DateTime], @param51=[String, System.String], @param52=[System.DBNull, null]]
2020-01-02 17:31:01,908 [1] DEBUG - Statement Id: [DAO00013_GetTTBenhNhan_byBenhNhanId] PreparedStatement : [select *        from TT_BENHNHAN        where BENHNHAN_ID = '24441'        order by BENHNHAN_ID]
2020-01-02 17:31:02,025 [1] DEBUG - Statement Id: [DAO00013_GetBenhNhanToDB] PreparedStatement : [select ROW_NUMBER() OVER(order by a.MAYTE) as ROWNUMBER, *,        CASE        WHEN A.GIOITINH = 1 THEN 'Nam'        WHEN A.GIOITINH = 2 THEN N'Nữ'        END as TENGIOITINH        from TT_BENHNHAN A        where  ACTIVE = '1' and MAYTE = '200000001']
2020-01-02 17:31:04,697 [1] DEBUG - Statement Id: [DAO00013_Add_Update_BHYT] PreparedStatement : [if not exists (select 1        from TT_BENHNHAN_BHYT        where SOTHE = 'DN452523534525238289' and BENHNHAN_ID = '24441')        insert into TT_BENHNHAN_BHYT (        BENHNHAN_ID        , LOAIBHYT        , SOTHE        , NGAYCAP        , NGAYHIEULUC        , NGAYHETHIEULUC        , TINHTHANH_CAPTHE_ID        , BENHVIEN_ID        , BENHVIEN_KCB_ID        , TREN3NAM        , TREN5NAM        , TREN6THANG        , NGAYMIENDONGCHITRA        , TAMNGUNG        , NGAYTAO        , NGUOITAO_ID        , KHUVUCSONG_ID        ) values (         @param0         ,  @param1         ,  @param2         ,  @param3         ,  @param4         ,  @param5         ,  @param6         ,  @param7         ,  @param8         ,  @param9         ,  @param10         ,  @param11         ,  @param12         ,  @param13         ,  @param14         ,  @param15         ,  @param16         )        else        update TT_BENHNHAN_BHYT set        LOAIBHYT =  @param1         , SOTHE =  @param2         , NGAYCAP =  @param3         , NGAYHIEULUC =  @param4         , NGAYHETHIEULUC =  @param5         , TINHTHANH_CAPTHE_ID =  @param6         , BENHVIEN_ID =  @param7         , BENHVIEN_KCB_ID =  @param8         , TREN3NAM =  @param9         , TREN5NAM =  @param10         , TREN6THANG =  @param11         , NGAYMIENDONGCHITRA =  @param12         , TAMNGUNG =  @param13         , NGAYCAPNHAT =  @param17         , NGUOICAPNHAT_ID =  @param18         , KHUVUCSONG_ID =  @param16         where        SOTHE = 'DN452523534525238289' and BENHNHAN_ID = '24441']
2020-01-02 17:31:04,697 [1] DEBUG - Statement Id: [DAO00013_Add_Update_BHYT] Parameters: [@param0=[BENHNHAN_ID,24441], @param1=[LOAIBHYT,null], @param2=[SOTHE,DN452523534525238289], @param3=[NGAYCAP,null], @param4=[NGAYHIEULUC,1/1/2020 12:00:00 AM], @param5=[NGAYHETHIEULUC,12/31/2020 12:00:00 AM], @param6=[TINHTHANH_CAPTHE_ID,null], @param7=[BENHVIEN_ID,HLU01], @param8=[BENHVIEN_KCB_ID,38289], @param9=[TREN3NAM,0], @param10=[TREN5NAM,0], @param11=[TREN6THANG,null], @param12=[NGAYMIENDONGCHITRA,null], @param13=[TAMNGUNG,null], @param14=[NGAYTAO,1/2/2020 5:31:04 PM], @param15=[NGUOITAO_ID,1], @param16=[KHUVUCSONG_ID,null], @param17=[NGAYCAPNHAT,1/2/2020 5:31:04 PM], @param18=[NGUOICAPNHAT_ID,1]]
2020-01-02 17:31:04,697 [1] DEBUG - Statement Id: [DAO00013_Add_Update_BHYT] Types: [@param0=[Int32, System.Int32], @param1=[System.DBNull, null], @param2=[String, System.String], @param3=[System.DBNull, null], @param4=[DateTime, System.DateTime], @param5=[DateTime, System.DateTime], @param6=[System.DBNull, null], @param7=[String, System.String], @param8=[String, System.String], @param9=[String, System.String], @param10=[String, System.String], @param11=[System.DBNull, null], @param12=[System.DBNull, null], @param13=[System.DBNull, null], @param14=[DateTime, System.DateTime], @param15=[String, System.String], @param16=[System.DBNull, null], @param17=[DateTime, System.DateTime], @param18=[String, System.String]]
2020-01-02 17:31:05,337 [1] DEBUG - Statement Id: [DAO00118_Add_BenhNhan] PreparedStatement : [if not exists (select 1 from TT_BENHNHAN where BENHNHAN_ID = '24441')              insert into TT_BENHNHAN (              BENHNHAN_ID              , MAYTE              , SOVAOVIEN              , TENBENHNHAN              , HO              , TEN              , GIOITINH              , NGAYSINH              , NAMSINH              , SONHA              , DIACHI              , SODIENTHOAI              , XAPHUONG_ID              , QUANHUYEN_ID              , TINHTHANH_ID              , DANTOC_ID              , QUOCTICH_ID              , SOLUUTRUNOITRU              , SOLUUTRUNGOAITRU              , NGHENGHIEP_ID              , CMND              , HOCHIEU              , VIETKIEU              , NGUOINUOCNGOAI              , DIACHITHUONGTRU              , DIACHILIENLAC              , DIACHICOQUAN              , EMAIL              , NHOMMAU_ID              , YEUTORH_ID              , TIENSUDIUNG              , TIENSUBENH              , TIENSUHUTTHUOCLA              , TUVONG              , NGAYTUVONG              , THOIGIANTUVONG              , NGUYENNHANTUVONG_ID              , NGUOIGHINHANTUVONG_ID              , THOIGIANGHINHANTUVONG              , NHANVIEN_ID              , DONVICONGTAC_ID              , DIENTHOAIBAN              , TINHTRANGHONNHAN_ID              , NGUOILIENHE_ID              , MOIQUANHE_ID              , NGUOILIENHE              , THONGTIN_NLH              , GHICHU              , HINHANH_DAIDIEN              , BENHVIEN_ID              , NGAYTAO              , NGUOITAO_ID              , NGAYGIOSINH              ) values (               @param0               ,  @param1               ,  @param2               ,  @param3               ,  @param4               ,  @param5               ,  @param6               ,  @param7               ,  @param8               ,  @param9               ,  @param10               ,  @param11               ,  @param12               ,  @param13               ,  @param14               ,  @param15               ,  @param16               ,  @param17               ,  @param18               ,  @param19               ,  @param20               ,  @param21               ,  @param22               ,  @param23               ,  @param24               ,  @param25               ,  @param26               ,  @param27               ,  @param28               ,  @param29               ,  @param30               ,  @param31               ,  @param32               ,  @param33               ,  @param34               ,  @param35               ,  @param36               ,  @param37               ,  @param38               ,  @param39               ,  @param40               ,  @param41               ,  @param42               ,  @param43               ,  @param44               ,  @param45               ,  @param46               ,  @param47               ,  @param48               ,  @param49               ,  @param50               ,  @param51               ,  @param52               )              else              update TT_BENHNHAN set              MAYTE =  @param1                ,                   SOVAOVIEN =  @param2                ,                   TENBENHNHAN =  @param3                ,                   HO =  @param4                ,                   TEN =  @param5                ,                   GIOITINH =  @param6                ,                   NGAYSINH =  @param7                ,                   NAMSINH =  @param8                ,                   SONHA =  @param9                ,                   SODIENTHOAI =  @param11                ,                   XAPHUONG_ID =  @param12                ,                   DANTOC_ID =  @param15                ,                   QUOCTICH_ID =  @param16                ,                   NGHENGHIEP_ID =  @param19                ,                   NGUOINUOCNGOAI =  @param23                ,                   DIACHITHUONGTRU =  @param24                ,                   DIACHILIENLAC =  @param25                ,                   NGUOILIENHE_ID =  @param43                ,                   MOIQUANHE_ID =  @param44                ,                   NGUOILIENHE =  @param45                ,                   THONGTIN_NLH =  @param46                ,                   GHICHU =  @param47                ,                   BENHVIEN_ID =  @param49                ,                   NGUOICAPNHAT_ID =  @param53                              where              BENHNHAN_ID = '24441']
2020-01-02 17:31:05,337 [1] DEBUG - Statement Id: [DAO00118_Add_BenhNhan] Parameters: [@param0=[BENHNHAN_ID,24441], @param1=[MAYTE,200000001], @param2=[SOVAOVIEN,0000001], @param3=[TENBENHNHAN,Test 1], @param4=[HO,Test], @param5=[TEN,1], @param6=[GIOITINH,2], @param7=[NGAYSINH,3/3/1997 12:00:00 AM], @param8=[NAMSINH,1997], @param9=[SONHA,null], @param10=[DIACHI,null], @param11=[SODIENTHOAI,null], @param12=[XAPHUONG_ID,16435], @param13=[QUANHUYEN_ID,null], @param14=[TINHTHANH_ID,null], @param15=[DANTOC_ID,332], @param16=[QUOCTICH_ID,291], @param17=[SOLUUTRUNOITRU,null], @param18=[SOLUUTRUNGOAITRU,null], @param19=[NGHENGHIEP_ID,null], @param20=[CMND,null], @param21=[HOCHIEU,null], @param22=[VIETKIEU,null], @param23=[NGUOINUOCNGOAI,null], @param24=[DIACHITHUONGTRU,Xã Đông Hưng, Thành phố Thanh Hóa, Tỉnh Thanh Hóa], @param25=[DIACHILIENLAC,Xã Đông Hưng, Thành phố Thanh Hóa, Tỉnh Thanh Hóa], @param26=[DIACHICOQUAN,null], @param27=[EMAIL,null], @param28=[NHOMMAU_ID,null], @param29=[YEUTORH_ID,null], @param30=[TIENSUDIUNG,null], @param31=[TIENSUBENH,null], @param32=[TIENSUHUTTHUOCLA,null], @param33=[TUVONG,null], @param34=[NGAYTUVONG,null], @param35=[THOIGIANTUVONG,null], @param36=[NGUYENNHANTUVONG_ID,null], @param37=[NGUOIGHINHANTUVONG_ID,null], @param38=[THOIGIANGHINHANTUVONG,null], @param39=[NHANVIEN_ID,null], @param40=[DONVICONGTAC_ID,null], @param41=[DIENTHOAIBAN,null], @param42=[TINHTRANGHONNHAN_ID,null], @param43=[NGUOILIENHE_ID,null], @param44=[MOIQUANHE_ID,null], @param45=[NGUOILIENHE,null], @param46=[THONGTIN_NLH,null], @param47=[GHICHU,null], @param48=[HINHANH_DAIDIEN,imgFemale.png], @param49=[BENHVIEN_ID,HLU01], @param50=[NGAYTAO,null], @param51=[NGUOITAO_ID,1], @param52=[NGAYGIOSINH,null], @param53=[NGUOICAPNHAT_ID,1]]
2020-01-02 17:31:05,337 [1] DEBUG - Statement Id: [DAO00118_Add_BenhNhan] Types: [@param0=[Int32, System.Int32], @param1=[String, System.String], @param2=[String, System.String], @param3=[String, System.String], @param4=[String, System.String], @param5=[String, System.String], @param6=[Int64, System.Int64], @param7=[DateTime, System.DateTime], @param8=[Int64, System.Int64], @param9=[System.DBNull, null], @param10=[System.DBNull, null], @param11=[System.DBNull, null], @param12=[String, System.String], @param13=[System.DBNull, null], @param14=[System.DBNull, null], @param15=[Int64, System.Int64], @param16=[Int64, System.Int64], @param17=[System.DBNull, null], @param18=[System.DBNull, null], @param19=[System.DBNull, null], @param20=[System.DBNull, null], @param21=[System.DBNull, null], @param22=[System.DBNull, null], @param23=[System.DBNull, null], @param24=[String, System.String], @param25=[String, System.String], @param26=[System.DBNull, null], @param27=[System.DBNull, null], @param28=[System.DBNull, null], @param29=[System.DBNull, null], @param30=[System.DBNull, null], @param31=[System.DBNull, null], @param32=[System.DBNull, null], @param33=[System.DBNull, null], @param34=[System.DBNull, null], @param35=[System.DBNull, null], @param36=[System.DBNull, null], @param37=[System.DBNull, null], @param38=[System.DBNull, null], @param39=[System.DBNull, null], @param40=[System.DBNull, null], @param41=[System.DBNull, null], @param42=[System.DBNull, null], @param43=[System.DBNull, null], @param44=[System.DBNull, null], @param45=[System.DBNull, null], @param46=[System.DBNull, null], @param47=[System.DBNull, null], @param48=[String, System.String], @param49=[String, System.String], @param50=[System.DBNull, null], @param51=[String, System.String], @param52=[System.DBNull, null], @param53=[String, System.String]]
2020-01-02 17:31:05,453 [1] DEBUG - Statement Id: [DAO00118_Add_Update_BHYT] PreparedStatement : [if not exists (select 1              from TT_BENHNHAN_BHYT              where SOTHE = 'DN452523534525238289' and BENHNHAN_ID = '24441')              insert into TT_BENHNHAN_BHYT (              BENHNHAN_ID              , LOAIBHYT              , SOTHE              , NGAYCAP              , NGAYHIEULUC              , NGAYHETHIEULUC              , TINHTHANH_CAPTHE_ID              , BENHVIEN_ID              , BENHVIEN_KCB_ID              , TREN3NAM              , TREN5NAM              , TREN6THANG              , NGAYMIENDONGCHITRA              , TAMNGUNG              , NGAYTAO              , NGUOITAO_ID              , KHUVUCSONG_ID              ) values (               @param0               ,  @param1               ,  @param2               ,  @param3               ,  @param4               ,  @param5               ,  @param6               ,  @param7               ,  @param8               ,  @param9               ,  @param10               ,  @param11               ,  @param12               ,  @param13               ,  @param14               ,  @param15               ,  @param16               )              else              update TT_BENHNHAN_BHYT set              LOAIBHYT =  @param1               , SOTHE =  @param2               , NGAYCAP =  @param3               , NGAYHIEULUC =  @param4               , NGAYHETHIEULUC =  @param5               , TINHTHANH_CAPTHE_ID =  @param6               , BENHVIEN_ID =  @param7               , BENHVIEN_KCB_ID =  @param8               , TREN3NAM =  @param9               , TREN5NAM =  @param10               , TREN6THANG =  @param11               , NGAYMIENDONGCHITRA =  @param12               , TAMNGUNG =  @param13               , NGAYCAPNHAT =  @param17               , NGUOICAPNHAT_ID =  @param18               , KHUVUCSONG_ID =  @param16               where              SOTHE = 'DN452523534525238289' and BENHNHAN_ID = '24441']
2020-01-02 17:31:05,454 [1] DEBUG - Statement Id: [DAO00118_Add_Update_BHYT] Parameters: [@param0=[BENHNHAN_ID,24441], @param1=[LOAIBHYT,null], @param2=[SOTHE,DN452523534525238289], @param3=[NGAYCAP,null], @param4=[NGAYHIEULUC,1/1/2020 12:00:00 AM], @param5=[NGAYHETHIEULUC,12/31/2020 12:00:00 AM], @param6=[TINHTHANH_CAPTHE_ID,null], @param7=[BENHVIEN_ID,HLU01], @param8=[BENHVIEN_KCB_ID,38289], @param9=[TREN3NAM,False], @param10=[TREN5NAM,False], @param11=[TREN6THANG,null], @param12=[NGAYMIENDONGCHITRA,null], @param13=[TAMNGUNG,null], @param14=[NGAYTAO,1/2/2020 5:31:05 PM], @param15=[NGUOITAO_ID,1], @param16=[KHUVUCSONG_ID,null], @param17=[NGAYCAPNHAT,1/2/2020 5:31:05 PM], @param18=[NGUOICAPNHAT_ID,1]]
2020-01-02 17:31:05,454 [1] DEBUG - Statement Id: [DAO00118_Add_Update_BHYT] Types: [@param0=[Int32, System.Int32], @param1=[System.DBNull, null], @param2=[String, System.String], @param3=[System.DBNull, null], @param4=[DateTime, System.DateTime], @param5=[DateTime, System.DateTime], @param6=[System.DBNull, null], @param7=[String, System.String], @param8=[String, System.String], @param9=[Boolean, System.Boolean], @param10=[Boolean, System.Boolean], @param11=[System.DBNull, null], @param12=[System.DBNull, null], @param13=[System.DBNull, null], @param14=[DateTime, System.DateTime], @param15=[String, System.String], @param16=[System.DBNull, null], @param17=[DateTime, System.DateTime], @param18=[String, System.String]]
2020-01-02 17:31:05,520 [1] DEBUG - Statement Id: [DAO00013_Add_Update_BHYT] PreparedStatement : [if not exists (select 1        from TT_BENHNHAN_BHYT        where SOTHE = 'DN452523534525238289' and BENHNHAN_ID = '24441')        insert into TT_BENHNHAN_BHYT (        BENHNHAN_ID        , LOAIBHYT        , SOTHE        , NGAYCAP        , NGAYHIEULUC        , NGAYHETHIEULUC        , TINHTHANH_CAPTHE_ID        , BENHVIEN_ID        , BENHVIEN_KCB_ID        , TREN3NAM        , TREN5NAM        , TREN6THANG        , NGAYMIENDONGCHITRA        , TAMNGUNG        , NGAYTAO        , NGUOITAO_ID        , KHUVUCSONG_ID        ) values (         @param0         ,  @param1         ,  @param2         ,  @param3         ,  @param4         ,  @param5         ,  @param6         ,  @param7         ,  @param8         ,  @param9         ,  @param10         ,  @param11         ,  @param12         ,  @param13         ,  @param14         ,  @param15         ,  @param16         )        else        update TT_BENHNHAN_BHYT set        LOAIBHYT =  @param1         , SOTHE =  @param2         , NGAYCAP =  @param3         , NGAYHIEULUC =  @param4         , NGAYHETHIEULUC =  @param5         , TINHTHANH_CAPTHE_ID =  @param6         , BENHVIEN_ID =  @param7         , BENHVIEN_KCB_ID =  @param8         , TREN3NAM =  @param9         , TREN5NAM =  @param10         , TREN6THANG =  @param11         , NGAYMIENDONGCHITRA =  @param12         , TAMNGUNG =  @param13         , NGAYCAPNHAT =  @param17         , NGUOICAPNHAT_ID =  @param18         , KHUVUCSONG_ID =  @param16         where        SOTHE = 'DN452523534525238289' and BENHNHAN_ID = '24441']
2020-01-02 17:31:05,521 [1] DEBUG - Statement Id: [DAO00013_Add_Update_BHYT] Parameters: [@param0=[BENHNHAN_ID,24441], @param1=[LOAIBHYT,4], @param2=[SOTHE,DN452523534525238289], @param3=[NGAYCAP,null], @param4=[NGAYHIEULUC,1/1/2020 12:00:00 AM], @param5=[NGAYHETHIEULUC,12/31/2020 12:00:00 AM], @param6=[TINHTHANH_CAPTHE_ID,null], @param7=[BENHVIEN_ID,HLU01], @param8=[BENHVIEN_KCB_ID,38289], @param9=[TREN3NAM,0], @param10=[TREN5NAM,0], @param11=[TREN6THANG,null], @param12=[NGAYMIENDONGCHITRA,null], @param13=[TAMNGUNG,null], @param14=[NGAYTAO,1/2/2020 5:31:05 PM], @param15=[NGUOITAO_ID,1], @param16=[KHUVUCSONG_ID,null], @param17=[NGAYCAPNHAT,1/2/2020 5:31:05 PM], @param18=[NGUOICAPNHAT_ID,1]]
2020-01-02 17:31:05,521 [1] DEBUG - Statement Id: [DAO00013_Add_Update_BHYT] Types: [@param0=[Int32, System.Int32], @param1=[String, System.String], @param2=[String, System.String], @param3=[System.DBNull, null], @param4=[DateTime, System.DateTime], @param5=[DateTime, System.DateTime], @param6=[System.DBNull, null], @param7=[String, System.String], @param8=[String, System.String], @param9=[String, System.String], @param10=[String, System.String], @param11=[System.DBNull, null], @param12=[System.DBNull, null], @param13=[System.DBNull, null], @param14=[DateTime, System.DateTime], @param15=[String, System.String], @param16=[System.DBNull, null], @param17=[DateTime, System.DateTime], @param18=[String, System.String]]
2020-01-02 17:31:05,791 [1] DEBUG - Statement Id: [DAOWF001_Laythongtingateways] PreparedStatement : [select * from TM_PROCESS_GATEWAYS]
2020-01-02 17:31:06,317 [1] DEBUG - Statement Id: [DAO00019_Add] PreparedStatement : [declare        @keyValue int, @BenhVienId varchar(10),        @yearNow int, @monthNow varchar(2), @dayNow varchar(2),        @Sotiepnhan varchar(20), @SoThuTu varchar(20)        set @keyValue = 0;        set @BenhVienId = 'HLU01'        set @yearNow = YEAR(getdate())        set @monthNow = RIGHT('00' + convert(varchar(2), MONTH(getdate())),2)        set @dayNow = RIGHT('00' + convert(varchar(2), DAY(getdate())),2)        BEGIN        select @keyValue = KEYVALUE from LST_KEYDATA        where KEYTYPE = 'SOTIEPNHAN' and KEYYEAR = @yearNow and KEYMONTH = @monthNow and KEYDAY = @dayNow        and BENHVIEN_ID = @BenhVienId        if @keyValue = 0        Insert into LST_KEYDATA values ('SOTIEPNHAN', @yearNow, @monthNow, @dayNow, '0', '0', '0', 0, @BenhVienId);        Update LST_KEYDATA set KEYVALUE = (KEYVALUE + 1), @keyValue = (KEYVALUE + 1) where KEYTYPE = 'SOTIEPNHAN' and KEYYEAR = @yearNow and KEYMONTH = @monthNow and KEYDAY = @dayNow and BENHVIEN_ID = @BenhVienId        set @SoThuTu = right('0000000'+convert(varchar(7), @keyValue), 7)        set @Sotiepnhan = 'TN' + RIGHT(@yearNow, 2) + @monthNow  + @dayNow + '.' + @SoThuTu                   insert into TT_TIEPNHAN (        SOTIEPNHAN        , UUTIEN        , BENHNHAN_ID        , BENHVIEN_ID        , TUYENKHAMBENH_ID        , NOITIEPNHAN_ID        , NGAYTIEPNHAN        , THOIGIANTIEPNHAN        , NAMTIEPNHAN        , THANGTIEPNHAN        , DOITUONG_ID        , LYDOTIEPNHAN_ID        , HINHTHUCDENKHAM_ID        , TINHTRANGHEN        , XACNHANCHIPHI_ID        , THUTIENTRUOC        , TAIKHAM        , SOBHYT        , BHYTTUNGAY        , BHYTDENNGAY        , BHYTNGAYCAP        , BHYTTREN3NAM        , BHYTTREN5NAM        , NGAYMIENDONGCHITRA        , LOAIBHYT        , NGAYBHYT2        , SOCHUYENVIEN        , HINHTHUCCHUYENVIEN_ID        , NOIGIOITHIEU_ID        , NGUOIGIOITHIEU_ID        , THOIGIANCHUYENTUYEN        , LYDOCHUYENVIEN_ID        , ICDNOIGIOITHIEU_ID        , CHANDOANNGT        , TRAITUYEN        , DIACHILIENHE        , XAPHUONG_ID        , QUANHUYEN_ID        , TINHTHANH_ID        , PROCESS_ID        , TRANGTHAI        , KHUVUCSONG_ID        , THANHVIEN_ID        , THE_ID        , LOAITHANHVIEN_ID        , SUDUNG_BHTN        , VIP        , GHICHU_TIEPNHAN        , BAOLANH_VIENPHI        , CONGTY_CHITRA_ID        , NGUON_BENHNHAN_ID        , LOAITIEPNHAN_ID        , THONGTIN_KCB_BHYT        , NGAYTAO        , NGUOITAO_ID        , LYDODENKHAM         ,           NGUOINUOCNGOAI         ,           ISTHONGTUYEN                 )        OUTPUT INSERTED.TIEPNHAN_ID, INSERTED.SOTIEPNHAN        values (        @Sotiepnhan        ,  @param0         ,  @param1         ,  @param2         ,  @param3         ,  @param4         ,  @param5         ,  @param6         ,  @param7         ,  @param8         ,  @param9         ,  @param10         ,  @param11         ,  @param12         ,  @param13         ,  @param14         ,  @param15         ,  @param16         ,  @param17         ,  @param18         ,  @param19         ,  @param20         ,  @param21         ,  @param22         ,  @param23         ,  @param24         ,  @param25         ,  @param26         ,  @param27         ,  @param28         ,  @param29         ,  @param30         ,  @param31         ,  @param32         ,  @param33         ,  @param34         ,  @param35         ,  @param36         ,  @param37         ,  @param38         ,  @param39         ,  @param40         ,  @param41         ,  @param42         ,  @param43         ,  @param44         ,  @param45         ,  @param46         ,  @param47         ,  @param48         ,  @param49         ,  @param50         ,  @param51         ,  @param52         ,  @param53         ,  @param54          ,            @param55          ,            @param56                  )        end]
2020-01-02 17:31:06,317 [1] DEBUG - Statement Id: [DAO00019_Add] Parameters: [@param0=[UUTIEN,0], @param1=[BENHNHAN_ID,24441], @param2=[BENHVIEN_ID,HLU01], @param3=[TUYENKHAMBENH_ID,null], @param4=[NOITIEPNHAN_ID,62], @param5=[NGAYTIEPNHAN,1/2/2020 12:00:00 AM], @param6=[THOIGIANTIEPNHAN,1/2/2020 5:24:32 PM], @param7=[NAMTIEPNHAN,2020], @param8=[THANGTIEPNHAN,1], @param9=[DOITUONG_ID,4], @param10=[LYDOTIEPNHAN_ID,null], @param11=[HINHTHUCDENKHAM_ID,461], @param12=[TINHTRANGHEN,null], @param13=[XACNHANCHIPHI_ID,null], @param14=[THUTIENTRUOC,null], @param15=[TAIKHAM,0], @param16=[SOBHYT,DN452523534525238289], @param17=[BHYTTUNGAY,1/1/2020 12:00:00 AM], @param18=[BHYTDENNGAY,12/31/2020 12:00:00 AM], @param19=[BHYTNGAYCAP,null], @param20=[BHYTTREN3NAM,0], @param21=[BHYTTREN5NAM,0], @param22=[NGAYMIENDONGCHITRA,null], @param23=[LOAIBHYT,null], @param24=[NGAYBHYT2,null], @param25=[SOCHUYENVIEN,], @param26=[HINHTHUCCHUYENVIEN_ID,null], @param27=[NOIGIOITHIEU_ID,null], @param28=[NGUOIGIOITHIEU_ID,null], @param29=[THOIGIANCHUYENTUYEN,null], @param30=[LYDOCHUYENVIEN_ID,null], @param31=[ICDNOIGIOITHIEU_ID,null], @param32=[CHANDOANNGT,], @param33=[TRAITUYEN,0], @param34=[DIACHILIENHE,null], @param35=[XAPHUONG_ID,16435], @param36=[QUANHUYEN_ID,null], @param37=[TINHTHANH_ID,null], @param38=[PROCESS_ID,P02], @param39=[TRANGTHAI,DATIEPNHAN], @param40=[KHUVUCSONG_ID,null], @param41=[THANHVIEN_ID,null], @param42=[THE_ID,null], @param43=[LOAITHANHVIEN_ID,null], @param44=[SUDUNG_BHTN,0], @param45=[VIP,0], @param46=[GHICHU_TIEPNHAN,null], @param47=[BAOLANH_VIENPHI,0], @param48=[CONGTY_CHITRA_ID,null], @param49=[NGUON_BENHNHAN_ID,null], @param50=[LOAITIEPNHAN_ID,8351], @param51=[THONGTIN_KCB_BHYT,null], @param52=[NGAYTAO,1/2/2020 5:31:06 PM], @param53=[NGUOITAO_ID,1], @param54=[LYDODENKHAM,null], @param55=[NGUOINUOCNGOAI,null], @param56=[ISTHONGTUYEN,0]]
2020-01-02 17:31:06,317 [1] DEBUG - Statement Id: [DAO00019_Add] Types: [@param0=[Int32, System.Int32], @param1=[Int32, System.Int32], @param2=[String, System.String], @param3=[System.DBNull, null], @param4=[String, System.String], @param5=[DateTime, System.DateTime], @param6=[DateTime, System.DateTime], @param7=[Int32, System.Int32], @param8=[Int32, System.Int32], @param9=[Int64, System.Int64], @param10=[System.DBNull, null], @param11=[Int64, System.Int64], @param12=[System.DBNull, null], @param13=[System.DBNull, null], @param14=[System.DBNull, null], @param15=[Int32, System.Int32], @param16=[String, System.String], @param17=[DateTime, System.DateTime], @param18=[DateTime, System.DateTime], @param19=[System.DBNull, null], @param20=[String, System.String], @param21=[String, System.String], @param22=[System.DBNull, null], @param23=[System.DBNull, null], @param24=[System.DBNull, null], @param25=[String, System.String], @param26=[System.DBNull, null], @param27=[System.DBNull, null], @param28=[System.DBNull, null], @param29=[System.DBNull, null], @param30=[System.DBNull, null], @param31=[System.DBNull, null], @param32=[String, System.String], @param33=[String, System.String], @param34=[System.DBNull, null], @param35=[String, System.String], @param36=[System.DBNull, null], @param37=[System.DBNull, null], @param38=[String, System.String], @param39=[String, System.String], @param40=[System.DBNull, null], @param41=[System.DBNull, null], @param42=[System.DBNull, null], @param43=[System.DBNull, null], @param44=[String, System.String], @param45=[String, System.String], @param46=[System.DBNull, null], @param47=[String, System.String], @param48=[System.DBNull, null], @param49=[System.DBNull, null], @param50=[Int64, System.Int64], @param51=[System.DBNull, null], @param52=[DateTime, System.DateTime], @param53=[String, System.String], @param54=[System.DBNull, null], @param55=[System.DBNull, null], @param56=[String, System.String]]
2020-01-02 17:31:06,344 [1] DEBUG - Statement Id: [DAO00019_GetTTTiepNhan_byTiepNhanId] PreparedStatement : [select *        from TT_TIEPNHAN        where TIEPNHAN_ID = '28493'        order by TIEPNHAN_ID]
2020-01-02 17:31:06,370 [1] DEBUG - Statement Id: [DAO00080_Add_KhamBenh_CapCuu] PreparedStatement : [insert into TT_KHAMBENH_VAOVIEN (        SOPHIEU        , TIEPNHAN_ID        , KHAMBENH_ID        , BENHNHAN_ID        , NGUOILIENHE        , DIENTHOAILIENHE        , NOILAMVIEC        , CHANDOANNOIGIOITHIEU        , NGAYKHAM        , THOIGIANKHAM        , LYDOVAOVIEN        , QUATRINHBENHLY        , TIENSUBANTHAN        , TIENSUGIADINH        , KHAMXETTOANTHAN        , KHAMXETCACBOPHAN        , KHAMXETKQLS        , CHANDOANVAO        , ICDKHAMXET_ID        , DAXULY        , NGAYRA        , THOIGIANRA        , NHAPKHOA_ID        , CHUYENVIEN_ID        , CHUY        , MACH        , NHIETDO        , HUYETAPCAO        , HUYETAPTHAP        , NHIPTHO        , CANNANG        , CHIEUCAO        , BACSI_ID        , XUTRUKHAMBENH_ID        , CAPCUU        , NGAYTAINAN        , THOIGIANTAINAN        , NOITAINAN_TINHTHANH_ID        , NOITAINAN_QUANHUYEN_ID        , NOITAINAN_PHUONGXA_ID        , NOITAINAN_DIACHI        , DIADIEMTAINAN_ID        , BOPHANBITHUONG_ID        , MUCDO_ID        , DIENBIENSAUTN_ID        , XUTRISAUTN_ID        , NGUYENNHAN_ID        , NGUYENNHANCHITIET_ID        , ICD_NGUYENNHAN        , NGAYTAO        , NGUOITAO_ID        , NGAYCAPNHAT        , NGUOICAPNHAT_ID        , BENHANCHUYENKHOA        , CHANDOANVAOVIEN        , CHANDOANRAVIEN        , DIEUTRITUNGAY        , DIEUTRIDENNGAY        , DIENBIENLS        , KQXETNGHIEM        , PHAUTHUAT        , THUTHUAT        , TINHTRANGNGUOIBENH        , HUONGDIEUTRI        , NGUOIGIAO_ID        , NGUOINHAN_ID        , XQUANG        , CTSCANNER        , SIEUAM        , XETNGHIEM        , KHAC        , TOANBOHS        , LOAICHUYENKHOA        , CONGANCANTHIEP        , CDRR_BENHCHINH        , CDRR_BENHKEM        , ICD_BENHCHINH        , ICD_BENHKEMTHEO        , PHUONGPHAPDIEUTRI        , FIELD_1        , FIELD_2        , FIELD_3        , FIELD_4        , FIELD_5        , FIELD_6        , FIELD_7        , FIELD_8        , FIELD_9        , FIELD_10        , FIELD_11        , FIELD_12        , FIELD_13        , FIELD_14        , FIELD_15        , FIELD_27        , FIELD_28        , FIELD_29        , FIELD_30        , FIELD_31        , FIELD_32        , FIELD_33        , FIELD_34        , FIELD_35        , FIELD_36        , FIELD_37        , FIELD_38        , FIELD_39        , FIELD_40        , FIELD_41        , FIELD_42        , FIELD_43        , FIELD_44        , FIELD_45        , FIELD_46        , FIELD_47        , FIELD_48        , FIELD_49        , FIELD_50        , FIELD_51        , FIELD_52        , FIELD_53        , FIELD_54        , FIELD_55        , FIELD_56        , BENHVIEN_ID        ) values (         @param0         ,  @param1         ,  @param2         ,  @param3         ,  @param4         ,  @param5         ,  @param6         ,  @param7         ,  @param8         ,  @param9         ,  @param10         ,  @param11         ,  @param12         ,  @param13         ,  @param14         ,  @param15         ,  @param16         ,  @param17         ,  @param18         ,  @param19         ,  @param20         ,  @param21         ,  @param22         ,  @param23         ,  @param24         ,  @param25         ,  @param26         ,  @param27         ,  @param28         ,  @param29         ,  @param30         ,  @param31         ,  @param32         ,  @param33         ,  @param34         ,  @param35         ,  @param36         ,  @param37         ,  @param38         ,  @param39         ,  @param40         ,  @param41         ,  @param42         ,  @param43         ,  @param44         ,  @param45         ,  @param46         ,  @param47         ,  @param48         ,  @param49         ,  @param50         ,  @param51         ,  @param52         ,  @param53         ,  @param54         ,  @param55         ,  @param56         ,  @param57         ,  @param58         ,  @param59         ,  @param60         ,  @param61         ,  @param62         ,  @param63         ,  @param64         ,  @param65         ,  @param66         ,  @param67         ,  @param68         ,  @param69         ,  @param70         ,  @param71         ,  @param72         ,  @param73         ,  @param74         ,  @param75         ,  @param76         ,  @param77         ,  @param78         ,  @param79         ,  @param80         ,  @param81         ,  @param82         ,  @param83         ,  @param84         ,  @param85         ,  @param86         ,  @param87         ,  @param88         ,  @param89         ,  @param90         ,  @param91         ,  @param92         ,  @param93         ,  @param94         ,  @param95         ,  @param96         ,  @param97         ,  @param98         ,  @param99         ,  @param100         ,  @param101         ,  @param102         ,  @param103         ,  @param104         ,  @param105         ,  @param106         ,  @param107         ,  @param108         ,  @param109         ,  @param110         ,  @param111         ,  @param112         ,  @param113         ,  @param114         ,  @param115         ,  @param116         ,  @param117         ,  @param118         ,  @param119         ,  @param120         ,  @param121         ,  @param122         ,  @param123         ,  @param124         )]
2020-01-02 17:31:06,370 [1] DEBUG - Statement Id: [DAO00080_Add_KhamBenh_CapCuu] Parameters: [@param0=[SOPHIEU,null], @param1=[TIEPNHAN_ID,28493], @param2=[KHAMBENH_ID,null], @param3=[BENHNHAN_ID,24441], @param4=[NGUOILIENHE,null], @param5=[DIENTHOAILIENHE,null], @param6=[NOILAMVIEC,null], @param7=[CHANDOANNOIGIOITHIEU,null], @param8=[NGAYKHAM,1/2/2020 12:00:00 AM], @param9=[THOIGIANKHAM,1/2/2020 5:24:32 PM], @param10=[LYDOVAOVIEN,null], @param11=[QUATRINHBENHLY,null], @param12=[TIENSUBANTHAN,null], @param13=[TIENSUGIADINH,null], @param14=[KHAMXETTOANTHAN,null], @param15=[KHAMXETCACBOPHAN,null], @param16=[KHAMXETKQLS,null], @param17=[CHANDOANVAO,null], @param18=[ICDKHAMXET_ID,null], @param19=[DAXULY,null], @param20=[NGAYRA,null], @param21=[THOIGIANRA,null], @param22=[NHAPKHOA_ID,62], @param23=[CHUYENVIEN_ID,null], @param24=[CHUY,null], @param25=[MACH,null], @param26=[NHIETDO,null], @param27=[HUYETAPCAO,null], @param28=[HUYETAPTHAP,null], @param29=[NHIPTHO,null], @param30=[CANNANG,null], @param31=[CHIEUCAO,null], @param32=[BACSI_ID,null], @param33=[XUTRUKHAMBENH_ID,null], @param34=[CAPCUU,null], @param35=[NGAYTAINAN,null], @param36=[THOIGIANTAINAN,null], @param37=[NOITAINAN_TINHTHANH_ID,null], @param38=[NOITAINAN_QUANHUYEN_ID,null], @param39=[NOITAINAN_PHUONGXA_ID,null], @param40=[NOITAINAN_DIACHI,null], @param41=[DIADIEMTAINAN_ID,null], @param42=[BOPHANBITHUONG_ID,null], @param43=[MUCDO_ID,null], @param44=[DIENBIENSAUTN_ID,null], @param45=[XUTRISAUTN_ID,null], @param46=[NGUYENNHAN_ID,null], @param47=[NGUYENNHANCHITIET_ID,null], @param48=[ICD_NGUYENNHAN,null], @param49=[NGAYTAO,1/2/2020 5:31:06 PM], @param50=[NGUOITAO_ID,1], @param51=[NGAYCAPNHAT,1/2/2020 5:31:06 PM], @param52=[NGUOICAPNHAT_ID,1], @param53=[BENHANCHUYENKHOA,null], @param54=[CHANDOANVAOVIEN,null], @param55=[CHANDOANRAVIEN,null], @param56=[DIEUTRITUNGAY,null], @param57=[DIEUTRIDENNGAY,null], @param58=[DIENBIENLS,null], @param59=[KQXETNGHIEM,null], @param60=[PHAUTHUAT,null], @param61=[THUTHUAT,null], @param62=[TINHTRANGNGUOIBENH,null], @param63=[HUONGDIEUTRI,null], @param64=[NGUOIGIAO_ID,null], @param65=[NGUOINHAN_ID,null], @param66=[XQUANG,null], @param67=[CTSCANNER,null], @param68=[SIEUAM,null], @param69=[XETNGHIEM,null], @param70=[KHAC,null], @param71=[TOANBOHS,null], @param72=[LOAICHUYENKHOA,null], @param73=[CONGANCANTHIEP,null], @param74=[CDRR_BENHCHINH,null], @param75=[CDRR_BENHKEM,null], @param76=[ICD_BENHCHINH,null], @param77=[ICD_BENHKEMTHEO,null], @param78=[PHUONGPHAPDIEUTRI,null], @param79=[FIELD_1,null], @param80=[FIELD_2,null], @param81=[FIELD_3,null], @param82=[FIELD_4,null], @param83=[FIELD_5,null], @param84=[FIELD_6,null], @param85=[FIELD_7,null], @param86=[FIELD_8,null], @param87=[FIELD_9,null], @param88=[FIELD_10,null], @param89=[FIELD_11,null], @param90=[FIELD_12,null], @param91=[FIELD_13,null], @param92=[FIELD_14,null], @param93=[FIELD_15,null], @param94=[FIELD_27,null], @param95=[FIELD_28,null], @param96=[FIELD_29,null], @param97=[FIELD_30,null], @param98=[FIELD_31,null], @param99=[FIELD_32,null], @param100=[FIELD_33,null], @param101=[FIELD_34,null], @param102=[FIELD_35,null], @param103=[FIELD_36,null], @param104=[FIELD_37,null], @param105=[FIELD_38,null], @param106=[FIELD_39,null], @param107=[FIELD_40,null], @param108=[FIELD_41,null], @param109=[FIELD_42,null], @param110=[FIELD_43,null], @param111=[FIELD_44,null], @param112=[FIELD_45,null], @param113=[FIELD_46,null], @param114=[FIELD_47,null], @param115=[FIELD_48,null], @param116=[FIELD_49,null], @param117=[FIELD_50,null], @param118=[FIELD_51,null], @param119=[FIELD_52,null], @param120=[FIELD_53,null], @param121=[FIELD_54,null], @param122=[FIELD_55,null], @param123=[FIELD_56,null], @param124=[BENHVIEN_ID,HLU01]]
2020-01-02 17:31:06,370 [1] DEBUG - Statement Id: [DAO00080_Add_KhamBenh_CapCuu] Types: [@param0=[System.DBNull, null], @param1=[Int32, System.Int32], @param2=[System.DBNull, null], @param3=[Int32, System.Int32], @param4=[System.DBNull, null], @param5=[System.DBNull, null], @param6=[System.DBNull, null], @param7=[System.DBNull, null], @param8=[DateTime, System.DateTime], @param9=[DateTime, System.DateTime], @param10=[System.DBNull, null], @param11=[System.DBNull, null], @param12=[System.DBNull, null], @param13=[System.DBNull, null], @param14=[System.DBNull, null], @param15=[System.DBNull, null], @param16=[System.DBNull, null], @param17=[System.DBNull, null], @param18=[System.DBNull, null], @param19=[System.DBNull, null], @param20=[System.DBNull, null], @param21=[System.DBNull, null], @param22=[String, System.String], @param23=[System.DBNull, null], @param24=[System.DBNull, null], @param25=[System.DBNull, null], @param26=[System.DBNull, null], @param27=[System.DBNull, null], @param28=[System.DBNull, null], @param29=[System.DBNull, null], @param30=[System.DBNull, null], @param31=[System.DBNull, null], @param32=[System.DBNull, null], @param33=[System.DBNull, null], @param34=[System.DBNull, null], @param35=[System.DBNull, null], @param36=[System.DBNull, null], @param37=[System.DBNull, null], @param38=[System.DBNull, null], @param39=[System.DBNull, null], @param40=[System.DBNull, null], @param41=[System.DBNull, null], @param42=[System.DBNull, null], @param43=[System.DBNull, null], @param44=[System.DBNull, null], @param45=[System.DBNull, null], @param46=[System.DBNull, null], @param47=[System.DBNull, null], @param48=[System.DBNull, null], @param49=[DateTime, System.DateTime], @param50=[String, System.String], @param51=[DateTime, System.DateTime], @param52=[String, System.String], @param53=[System.DBNull, null], @param54=[System.DBNull, null], @param55=[System.DBNull, null], @param56=[System.DBNull, null], @param57=[System.DBNull, null], @param58=[System.DBNull, null], @param59=[System.DBNull, null], @param60=[System.DBNull, null], @param61=[System.DBNull, null], @param62=[System.DBNull, null], @param63=[System.DBNull, null], @param64=[System.DBNull, null], @param65=[System.DBNull, null], @param66=[System.DBNull, null], @param67=[System.DBNull, null], @param68=[System.DBNull, null], @param69=[System.DBNull, null], @param70=[System.DBNull, null], @param71=[System.DBNull, null], @param72=[System.DBNull, null], @param73=[System.DBNull, null], @param74=[System.DBNull, null], @param75=[System.DBNull, null], @param76=[System.DBNull, null], @param77=[System.DBNull, null], @param78=[System.DBNull, null], @param79=[System.DBNull, null], @param80=[System.DBNull, null], @param81=[System.DBNull, null], @param82=[System.DBNull, null], @param83=[System.DBNull, null], @param84=[System.DBNull, null], @param85=[System.DBNull, null], @param86=[System.DBNull, null], @param87=[System.DBNull, null], @param88=[System.DBNull, null], @param89=[System.DBNull, null], @param90=[System.DBNull, null], @param91=[System.DBNull, null], @param92=[System.DBNull, null], @param93=[System.DBNull, null], @param94=[System.DBNull, null], @param95=[System.DBNull, null], @param96=[System.DBNull, null], @param97=[System.DBNull, null], @param98=[System.DBNull, null], @param99=[System.DBNull, null], @param100=[System.DBNull, null], @param101=[System.DBNull, null], @param102=[System.DBNull, null], @param103=[System.DBNull, null], @param104=[System.DBNull, null], @param105=[System.DBNull, null], @param106=[System.DBNull, null], @param107=[System.DBNull, null], @param108=[System.DBNull, null], @param109=[System.DBNull, null], @param110=[System.DBNull, null], @param111=[System.DBNull, null], @param112=[System.DBNull, null], @param113=[System.DBNull, null], @param114=[System.DBNull, null], @param115=[System.DBNull, null], @param116=[System.DBNull, null], @param117=[System.DBNull, null], @param118=[System.DBNull, null], @param119=[System.DBNull, null], @param120=[System.DBNull, null], @param121=[System.DBNull, null], @param122=[System.DBNull, null], @param123=[System.DBNull, null], @param124=[String, System.String]]
2020-01-02 17:31:06,511 [1] DEBUG - Statement Id: [DAO00000_GetMucHuongDOITUONGBHYT] PreparedStatement : [select * from TM_DOITUONG          where BENHVIEN_ID = 'HLU01'           and             NHOMTHE like '%' +  @param0  +'%']
2020-01-02 17:31:06,511 [1] DEBUG - Statement Id: [DAO00000_GetMucHuongDOITUONGBHYT] Parameters: [@param0=[NHOMTHE,DN4]]
2020-01-02 17:31:06,511 [1] DEBUG - Statement Id: [DAO00000_GetMucHuongDOITUONGBHYT] Types: [@param0=[String, System.String]]
2020-01-02 17:31:06,537 [1] DEBUG - Statement Id: [DAO00019_Add_TT_TIEPNHAN_SOTHEBHYT] PreparedStatement : [INSERT INTO TT_TIEPNHAN_SOTHEBHYT        (TIEPNHAN_ID        ,BENHNHAN_ID        ,BENHAN_ID        ,DOITUONG_ID        ,SOBHYT        ,BHYTTUNGAY        ,BHYTDENNGAY        ,BHYTNGAYCAP        ,BHYTTREN3NAM        ,BHYTTREN5NAM        ,NGAYMIENDONGCHITRA        ,TRAITUYEN        ,BENHVIEN_ID        ,NOITAO_ID        ,NGAYTAO        ,NGUOITAO_ID        ,NGAYCAPNHAT        ,NGUOICAPNHAT_ID        ,TYLE_VUOT_LCB        ,TYLE_TRAITUYEN        ,GIOIHAN_VUOT_LCB        ,LUONG_COSO        ,TYLE_THUOC_UT        ,MADOITUONG)        VALUES        ( @param0         , @param1         , @param2         , @param3         , @param4         , @param5         , @param6         , @param7         , @param8         , @param9         , @param10         , @param11         , @param12         , @param13         , @param14         , @param15         , @param16         , @param17         , @param18         , @param19         , @param20         , @param21         , @param22         , @param23 )]
2020-01-02 17:31:06,537 [1] DEBUG - Statement Id: [DAO00019_Add_TT_TIEPNHAN_SOTHEBHYT] Parameters: [@param0=[TIEPNHAN_ID,28493], @param1=[BENHNHAN_ID,24441], @param2=[BENHAN_ID,null], @param3=[DOITUONG_ID,4], @param4=[SOBHYT,DN452523534525238289], @param5=[BHYTTUNGAY,1/1/2020 12:00:00 AM], @param6=[BHYTDENNGAY,12/31/2020 12:00:00 AM], @param7=[BHYTNGAYCAP,null], @param8=[BHYTTREN3NAM,0], @param9=[BHYTTREN5NAM,0], @param10=[NGAYMIENDONGCHITRA,null], @param11=[TRAITUYEN,0], @param12=[BENHVIEN_ID,HLU01], @param13=[NOITAO_ID,62], @param14=[NGAYTAO,1/2/2020 5:31:06 PM], @param15=[NGUOITAO_ID,1], @param16=[NGAYCAPNHAT,1/2/2020 5:31:06 PM], @param17=[NGUOICAPNHAT_ID,1], @param18=[TYLE_VUOT_LCB,0.80], @param19=[TYLE_TRAITUYEN,0.60], @param20=[GIOIHAN_VUOT_LCB,208500.00], @param21=[LUONG_COSO,1300000.00], @param22=[TYLE_THUOC_UT,0.50], @param23=[MADOITUONG,BHYT4]]
2020-01-02 17:31:06,537 [1] DEBUG - Statement Id: [DAO00019_Add_TT_TIEPNHAN_SOTHEBHYT] Types: [@param0=[Int32, System.Int32], @param1=[Int32, System.Int32], @param2=[System.DBNull, null], @param3=[Int32, System.Int32], @param4=[String, System.String], @param5=[DateTime, System.DateTime], @param6=[DateTime, System.DateTime], @param7=[System.DBNull, null], @param8=[String, System.String], @param9=[String, System.String], @param10=[System.DBNull, null], @param11=[String, System.String], @param12=[String, System.String], @param13=[String, System.String], @param14=[DateTime, System.DateTime], @param15=[String, System.String], @param16=[DateTime, System.DateTime], @param17=[String, System.String], @param18=[Decimal, System.Decimal], @param19=[Decimal, System.Decimal], @param20=[Decimal, System.Decimal], @param21=[Decimal, System.Decimal], @param22=[Decimal, System.Decimal], @param23=[String, System.String]]
2020-01-02 17:31:07,485 [1] DEBUG - Statement Id: [DAO00027_GetListTiepNhanAllCOM30] PreparedStatement : [select distinct A.SOTIEPNHAN, A.TRAITUYEN, A.NGAYMIENDONGCHITRA, A.TIEPNHAN_ID, A.DOITUONG_ID, isnull(C.SOBENHAN,NULL) as SOBENHAN,        A.LOAITHANHVIEN_ID, A.SUDUNG_BHTN, A.THE_ID, A.THANHVIEN_ID, A.VIP, A.NGUON_BENHNHAN_ID, A.BAOLANH_VIENPHI, A.SOBHYT, CONVERT(VARCHAR(11),A.NGAYTIEPNHAN,103) as NGAYTIEPNHAN,        B.*        , A.UUTIEN        from TT_TIEPNHAN A        inner join (select * from TT_BENHNHAN where MAYTE = '200000001' and ACTIVE = '1') B on B.BENHNHAN_ID = A.BENHNHAN_ID  and B.ACTIVE = '1'        left join TT_NOITRU_BENHAN C on C.TIEPNHAN_ID = A.TIEPNHAN_ID        where A.TIEPNHAN_ID = '28493' and A.BENHVIEN_ID = 'HLU01' and (A.TRANGTHAI not in ('HUY','CAPCUU', 'NOITRU', 'NGOAITRU'))]
2020-01-02 17:31:07,583 [1] DEBUG - Statement Id: [DAOWF001_LaythongtinProcess] PreparedStatement : [select * from TM_PROCESS        where        PROCESS_CODE = 'P02']
2020-01-02 17:31:07,612 [1] DEBUG - Statement Id: [DAOWF001_Kiemtrathongtindayeucau] PreparedStatement : [select * from TT_REQUEST        where        PROCESS_CODE = 'P02'        AND PARA = '{"HOSPITAL_ID":"HLU01","SOTIEPNHAN":"TN200102.0000001"}'        AND CURR_STATE_CODE = '7'        AND ISACTIVE = '1']
2020-01-02 17:31:09,002 [1] DEBUG - Statement Id: [DAOWF002_Add] PreparedStatement : [DECLARE @IDRequestOld int        DECLARE @IDRequestNew int        select top 1 @IDRequestOld = ID from TT_REQUEST where PARA =  @param0  order by ID desc          insert into TT_REQUEST (        PROCESS_CODE        , PARA        , CURR_STATE_CODE        ) values (         @param1         ,  @param0         ,  @param2         )        SELECT @IDRequestNew = SCOPE_IDENTITY()        if (@IDRequestOld is not null)        begin        update TT_REQUEST_SERVICE set REQUEST_ID = @IDRequestNew, PROCESS_CODE =  @param1  where REQUEST_ID = @IDRequestOld        update TT_REQUEST set ISACTIVE = '0' where ID = @IDRequestOld        update TT_REQUEST_SERVICE_DETAIL set REQUEST_ID = @IDRequestNew where REQUEST_ID = @IDRequestOld        end          select @IDRequestNew]
2020-01-02 17:31:09,002 [1] DEBUG - Statement Id: [DAOWF002_Add] Parameters: [@param0=[PARA,{"HOSPITAL_ID":"HLU01","SOTIEPNHAN":"TN200102.0000001"}], @param1=[PROCESS_CODE,P02], @param2=[CURR_STATE_CODE,7]]
2020-01-02 17:31:09,002 [1] DEBUG - Statement Id: [DAOWF002_Add] Types: [@param0=[String, System.String], @param1=[String, System.String], @param2=[String, System.String]]
2020-01-02 17:31:09,132 [1] DEBUG - Statement Id: [DAO00020_GetNhomdichvuIDByManhom] PreparedStatement : [select NHOMDICHVU_ID from TM_NHOMDICHVU where MANHOMDICHVU = '04']
2020-01-02 17:31:09,162 [1] DEBUG - Statement Id: [DAO00020_Add] PreparedStatement : [declare        @keyValue int, @BenhVienId varchar(10), @yearNow int, @SoPhieuYeu varchar(20), @SoRender varchar(20), @MaNhomDichVu varchar(20)        set @keyValue = 0;        set @BenhVienId = 'HLU01'        set @yearNow = YEAR(getdate())        set @MaNhomDichVu = '5'                 select @keyValue = KEYVALUE from LST_KEYDATA        where KEYTYPE = 'SOPHIEUYEUCAU' and KEYYEAR = @yearNow and SEGMENT_1 = @MaNhomDichVu and BENHVIEN_ID = @BenhVienId        if @keyValue = 0        Insert into LST_KEYDATA values ('SOPHIEUYEUCAU', @yearNow, '0', '0', @MaNhomDichVu, '0', '0', 0, @BenhVienId);          Update LST_KEYDATA set KEYVALUE = KEYVALUE + 1, @keyValue = (KEYVALUE + 1) where KEYTYPE = 'SOPHIEUYEUCAU' and KEYYEAR = @yearNow and SEGMENT_1 = @MaNhomDichVu and BENHVIEN_ID = @BenhVienId        set @SoRender = right('000000'+convert(varchar(6), @keyValue), 6)        set @SoPhieuYeu = RIGHT(@yearNow, 2) + '.' + @MaNhomDichVu + '.' + @SoRender                 insert into TT_DVYEUCAU (        TIEPNHAN_ID        , BENHAN_ID        , KHAMBENH_ID        , SODICHVUYEUCAU        , KHAMBENH_NGOAITRU_ID        , SOPHIEUYEUCAU        , BENHNHAN_ID        , DOITUONG_ID        , DICHVU_ID         ,           NGUOICHIDINH_ID                 , BACSICHIDINH_ID        , GIOYEUCAU        , NGAYYEUCAU        , THANGYEUCAU        , NAMYEUCAU        , NGAYGIOYEUCAU        , THUTUYEUCAU        , NOIYEUCAU_ID        , NOITHUCHIEN_ID        , TRANGTHAI_HANGDOI        , NOIDUNGCHITIET        , CHANDOAN        , LUUTRU_ID        , SODICHVUDONGTIEN        , DICHVU_KHAMBENH_ID        , DALAYMAU        , SINHTHIET        , CLOTEST        , TIEMCANQUANG        , TRIEUCHUNG        , DAITHE        , VITHE        , BENHPHAM        , DANHANBENHPHAM        , NGAYNHANBENHPHAM        , THOIGIANNHANBENHPHAM        , NGUOINHANBENHPHAM_ID        , MANGUOINHAPBENHPHAM        , TENNGUOINHAPBENHPHAM        , KETQUAXNKHAC        , YEUCAUBENNGOAI        , THUCHIENBENNGOAI        , DONVIBENNGOAI_ID        , BACSIBENNGOAI_ID        , TENBACSIBENNGOAI        , KHOABENNGOAI_ID        , KHOABENNGOAI                 , NOITHUCHIENTHAYDOI_ID        , LOAIKHACHHANG_ID        , THE_ID        , BARCODEID        , HOPDONG_ID        , HOPDONG_BENHNHAN_ID        , HINHTHUCTHANHTOAN_ID        , DANGKY_ID        , DANGKY_CHITIET_ID        , LICHHEN_ID        , THOIGIANLICHHEN        , BNKHONGDENBV        , GHICHU        , THANHTOANTRUOC        , KHAN        , DUOCPHEPTHUCHIEN        , HUYYEUCAU        , LYDOHUY        , TRANGTHAI        , KHOADULIEU        , NGAYKHOADULIEU        , THOIGIANKHOADULIEU        , NGUOIKHOA_ID        , MANGUOIKHOA        , TENNGUOIKHOA        , BENHVIEN_ID        , NGAYTAO        , NGUOITAO_ID        , NGAYHENCLS        , CREATININEMAU        , VUNGCANKHAOSAT        , BHYTDONGTIEN        , THUTIENSAU                 , DVKEMTHEO        , DVKEMTHEO_KHACEKIP        , LIENCHUYENKHOA                 )        OUTPUT INSERTED.DVYEUCAU_ID, INSERTED.SOPHIEUYEUCAU        values (         @param0         ,  @param1         ,  @param2         ,  @param3         ,  @param4         , @SoPhieuYeu        ,  @param5         ,  @param6         ,  @param7          ,            @param8                  ,  @param9         ,  @param10         ,  @param11         ,  @param12         ,  @param13         ,  @param14         ,  @param15         ,  @param16         ,  @param17         ,  @param18         ,  @param19         ,  @param20         ,  @param21         ,  @param22         ,  @param23         ,  @param24         ,  @param25         ,  @param26         ,  @param27         ,  @param28         ,  @param29         ,  @param30         ,  @param31         ,  @param32         ,  @param33         ,  @param34         ,  @param35         ,  @param36         ,  @param37         ,  @param38         ,  @param39         ,  @param40         ,  @param41         ,  @param42         ,  @param43         ,  @param44         ,  @param45                  ,  @param46         ,  @param47         ,  @param48         ,  @param49         ,  @param50         ,  @param51         ,  @param52         ,  @param53         ,  @param54         ,  @param55         ,  @param56         ,  @param57         ,  @param58         ,  @param59         ,  @param60         ,  @param61         ,  @param62         ,  @param63         ,  @param64         ,  @param65         ,  @param66         ,  @param67         ,  @param68         ,  @param69         ,  @param70         ,  @param71         ,  @param72         ,  @param73         ,  @param74         ,  @param75         ,  @param76         ,  @param77         ,  @param78                  ,  @param79         ,  @param80         ,  @param81                  );]
2020-01-02 17:31:09,162 [1] DEBUG - Statement Id: [DAO00020_Add] Parameters: [@param0=[TIEPNHAN_ID,28493], @param1=[BENHAN_ID,null], @param2=[KHAMBENH_ID,null], @param3=[SODICHVUYEUCAU,1], @param4=[KHAMBENH_NGOAITRU_ID,null], @param5=[BENHNHAN_ID,24441], @param6=[DOITUONG_ID,4], @param7=[DICHVU_ID,5492], @param8=[NGUOICHIDINH_ID,1], @param9=[BACSICHIDINH_ID,1], @param10=[GIOYEUCAU,17], @param11=[NGAYYEUCAU,1/2/2020 12:00:00 AM], @param12=[THANGYEUCAU,1], @param13=[NAMYEUCAU,2020], @param14=[NGAYGIOYEUCAU,1/2/2020 5:24:32 PM], @param15=[THUTUYEUCAU,1], @param16=[NOIYEUCAU_ID,62], @param17=[NOITHUCHIEN_ID,62], @param18=[TRANGTHAI_HANGDOI,null], @param19=[NOIDUNGCHITIET,null], @param20=[CHANDOAN,null], @param21=[LUUTRU_ID,null], @param22=[SODICHVUDONGTIEN,0], @param23=[DICHVU_KHAMBENH_ID,null], @param24=[DALAYMAU,null], @param25=[SINHTHIET,0], @param26=[CLOTEST,0], @param27=[TIEMCANQUANG,0], @param28=[TRIEUCHUNG,null], @param29=[DAITHE,null], @param30=[VITHE,null], @param31=[BENHPHAM,null], @param32=[DANHANBENHPHAM,0], @param33=[NGAYNHANBENHPHAM,null], @param34=[THOIGIANNHANBENHPHAM,null], @param35=[NGUOINHANBENHPHAM_ID,null], @param36=[MANGUOINHAPBENHPHAM,null], @param37=[TENNGUOINHAPBENHPHAM,null], @param38=[KETQUAXNKHAC,null], @param39=[YEUCAUBENNGOAI,0], @param40=[THUCHIENBENNGOAI,0], @param41=[DONVIBENNGOAI_ID,null], @param42=[BACSIBENNGOAI_ID,null], @param43=[TENBACSIBENNGOAI,null], @param44=[KHOABENNGOAI_ID,null], @param45=[KHOABENNGOAI,null], @param46=[NOITHUCHIENTHAYDOI_ID,null], @param47=[LOAIKHACHHANG_ID,null], @param48=[THE_ID,null], @param49=[BARCODEID,null], @param50=[HOPDONG_ID,null], @param51=[HOPDONG_BENHNHAN_ID,null], @param52=[HINHTHUCTHANHTOAN_ID,null], @param53=[DANGKY_ID,null], @param54=[DANGKY_CHITIET_ID,null], @param55=[LICHHEN_ID,null], @param56=[THOIGIANLICHHEN,null], @param57=[BNKHONGDENBV,null], @param58=[GHICHU,null], @param59=[THANHTOANTRUOC,1], @param60=[KHAN,0], @param61=[DUOCPHEPTHUCHIEN,0], @param62=[HUYYEUCAU,0], @param63=[LYDOHUY,null], @param64=[TRANGTHAI,CHUAKETQUA], @param65=[KHOADULIEU,null], @param66=[NGAYKHOADULIEU,null], @param67=[THOIGIANKHOADULIEU,null], @param68=[NGUOIKHOA_ID,null], @param69=[MANGUOIKHOA,null], @param70=[TENNGUOIKHOA,null], @param71=[BENHVIEN_ID,HLU01], @param72=[NGAYTAO,1/2/2020 5:31:09 PM], @param73=[NGUOITAO_ID,1], @param74=[NGAYHENCLS,null], @param75=[CREATININEMAU,null], @param76=[VUNGCANKHAOSAT,null], @param77=[BHYTDONGTIEN,null], @param78=[THUTIENSAU,0], @param79=[DVKEMTHEO,0], @param80=[DVKEMTHEO_KHACEKIP,null], @param81=[LIENCHUYENKHOA,null]]
2020-01-02 17:31:09,162 [1] DEBUG - Statement Id: [DAO00020_Add] Types: [@param0=[String, System.String], @param1=[System.DBNull, null], @param2=[System.DBNull, null], @param3=[Int32, System.Int32], @param4=[System.DBNull, null], @param5=[Int32, System.Int32], @param6=[Int64, System.Int64], @param7=[Int64, System.Int64], @param8=[Int64, System.Int64], @param9=[Int64, System.Int64], @param10=[Int32, System.Int32], @param11=[DateTime, System.DateTime], @param12=[Int32, System.Int32], @param13=[Int32, System.Int32], @param14=[DateTime, System.DateTime], @param15=[Int32, System.Int32], @param16=[String, System.String], @param17=[Int64, System.Int64], @param18=[System.DBNull, null], @param19=[System.DBNull, null], @param20=[System.DBNull, null], @param21=[System.DBNull, null], @param22=[Int32, System.Int32], @param23=[System.DBNull, null], @param24=[System.DBNull, null], @param25=[Int32, System.Int32], @param26=[Int32, System.Int32], @param27=[Int32, System.Int32], @param28=[System.DBNull, null], @param29=[System.DBNull, null], @param30=[System.DBNull, null], @param31=[System.DBNull, null], @param32=[Int32, System.Int32], @param33=[System.DBNull, null], @param34=[System.DBNull, null], @param35=[System.DBNull, null], @param36=[System.DBNull, null], @param37=[System.DBNull, null], @param38=[System.DBNull, null], @param39=[Int32, System.Int32], @param40=[Int32, System.Int32], @param41=[System.DBNull, null], @param42=[System.DBNull, null], @param43=[System.DBNull, null], @param44=[System.DBNull, null], @param45=[System.DBNull, null], @param46=[System.DBNull, null], @param47=[System.DBNull, null], @param48=[System.DBNull, null], @param49=[System.DBNull, null], @param50=[System.DBNull, null], @param51=[System.DBNull, null], @param52=[System.DBNull, null], @param53=[System.DBNull, null], @param54=[System.DBNull, null], @param55=[System.DBNull, null], @param56=[System.DBNull, null], @param57=[System.DBNull, null], @param58=[System.DBNull, null], @param59=[Int32, System.Int32], @param60=[Int32, System.Int32], @param61=[Int32, System.Int32], @param62=[Int32, System.Int32], @param63=[System.DBNull, null], @param64=[String, System.String], @param65=[System.DBNull, null], @param66=[System.DBNull, null], @param67=[System.DBNull, null], @param68=[System.DBNull, null], @param69=[System.DBNull, null], @param70=[System.DBNull, null], @param71=[String, System.String], @param72=[DateTime, System.DateTime], @param73=[String, System.String], @param74=[System.DBNull, null], @param75=[System.DBNull, null], @param76=[System.DBNull, null], @param77=[System.DBNull, null], @param78=[String, System.String], @param79=[Int32, System.Int32], @param80=[System.DBNull, null], @param81=[System.DBNull, null]]
2020-01-02 17:31:10,751 [1] DEBUG - Statement Id: [DAO00027_ThongTinTiepNhanCOM006] PreparedStatement : [select distinct CONVERT(VARCHAR(11),A.NGAYTIEPNHAN,103) as NGAYYEUCAU, C.DICHVU_ID, C.DVYEUCAU_ID, D.TENDICHVU, C.NOITHUCHIEN_ID,        A.SOTIEPNHAN, A.TRAITUYEN, A.NGAYMIENDONGCHITRA, A.TIEPNHAN_ID, A.DOITUONG_ID, A.TRANGTHAI,        A.LOAITHANHVIEN_ID, A.SUDUNG_BHTN, A.THE_ID, A.THANHVIEN_ID, A.VIP, A.NGUON_BENHNHAN_ID, A.BAOLANH_VIENPHI,        CASE WHEN (A.TRANGTHAI = 'NOITRU' OR A.TRANGTHAI = 'CAPCUU'   or A.TRANGTHAI = 'NGOAITRU') THEN 'IN' ELSE 'OUT' END AS LOAIBENHAN,        CASE WHEN (C.TRANGTHAI = 'CHUAKETQUA') THEN 'CHUAKETQUA' ELSE 'HOANTAT' END AS TRANGTHAIDICHVU, A.SOBHYT,        B.*,        CASE WHEN Left(E.MANHOMDICHVU,2) = '03' THEN '02' ELSE Left(E.MANHOMDICHVU,2) END AS MANHOMDICHVU        , A.UUTIEN        from TT_TIEPNHAN A        inner join TT_BENHNHAN B on B.BENHNHAN_ID = A.BENHNHAN_ID and (A.TRANGTHAI = 'DATIEPNHAN' or A.TRANGTHAI = 'NOITRU' or A.TRANGTHAI = 'CAPCUU'  or A.TRANGTHAI = 'NGOAITRU') and B.ACTIVE = '1'        inner join TT_DVYEUCAU C on C.TIEPNHAN_ID = A.TIEPNHAN_ID        left join TM_DICHVU D on D.DICHVU_ID = C.DICHVU_ID        left join TM_NHOMDICHVU E on E.NHOMDICHVU_ID = D.NHOMDICHVU_ID        where C.NGAYHENCLS is NULL and A.TIEPNHAN_ID = '28493' and C.DICHVU_ID = '5492' and A.BENHVIEN_ID = 'HLU01'         and           C.DVYEUCAU_ID = '206519']
2020-01-02 17:31:10,819 [1] DEBUG - Statement Id: [DAO00027_ThongTinTiepNhanCOM015] PreparedStatement : [declare @ManhomDSA varchar(10);        select top 1  @ManhomDSA = VALUE from TM_SYS_APPSETTINGS where CODE = 'MANHOM_DICHVU_DSA'        SELECT * FROM        (        SELECT        (A.SOTIEPNHAN + (CASE WHEN Left(E.MANHOMDICHVU,2) = '03' THEN '02' ELSE Left(E.MANHOMDICHVU,2) END) + LTRIM(C.NOITHUCHIEN_ID)) AS acss_lookupID,        ROW_NUMBER() OVER        (PARTITION BY (A.SOTIEPNHAN + (CASE WHEN Left(E.MANHOMDICHVU,2) = '03' THEN '02' ELSE Left(E.MANHOMDICHVU,2) END) + LTRIM(C.NOITHUCHIEN_ID))        ORDER BY (A.SOTIEPNHAN + (CASE WHEN Left(E.MANHOMDICHVU,2) = '03' THEN '02' ELSE Left(E.MANHOMDICHVU,2) END) + LTRIM(C.NOITHUCHIEN_ID)))        as num,        A.SOTIEPNHAN + (CASE WHEN Left(E.MANHOMDICHVU,2) = '03' THEN '02' ELSE Left(E.MANHOMDICHVU,2) END) + LTRIM(C.NOITHUCHIEN_ID) as KEYCOM15,        C.NOITHUCHIEN_ID, A.SOTIEPNHAN, A.TRAITUYEN, A.NGAYMIENDONGCHITRA, A.TIEPNHAN_ID, A.DOITUONG_ID, A.TRANGTHAI,        CASE WHEN (A.TRANGTHAI = 'NOITRU' OR A.TRANGTHAI = 'CAPCUU' or A.TRANGTHAI = 'NGOAITRU') THEN 'IN' ELSE 'OUT' END AS LOAIBENHAN,        CASE WHEN (C.TRANGTHAI = 'CHUAKETQUA') THEN 'CHUAKETQUA' ELSE 'HOANTAT' END AS TRANGTHAIDICHVU, A.SOBHYT,        B.*, F.TRANGTHAI as TRANGTHAI_BENHAN_NOITRU,        A.LOAITHANHVIEN_ID, A.SUDUNG_BHTN, A.THE_ID, A.THANHVIEN_ID, A.VIP, A.NGUON_BENHNHAN_ID, A.BAOLANH_VIENPHI,        CASE        WHEN @ManhomDSA is not null and E.MANHOMDICHVU in (@ManhomDSA) THEN E.MANHOMDICHVU        WHEN Left(E.MANHOMDICHVU,2) = '03' THEN '02' ELSE Left(E.MANHOMDICHVU,2) END AS MANHOMDICHVU        , A.UUTIEN        from TT_TIEPNHAN A        inner join TT_BENHNHAN B on B.BENHNHAN_ID = A.BENHNHAN_ID and (A.TRANGTHAI = 'DATIEPNHAN' or A.TRANGTHAI = 'NOITRU' or A.TRANGTHAI = 'CAPCUU' or A.TRANGTHAI = 'NGOAITRU') and B.ACTIVE = '1'        inner join TT_DVYEUCAU C on C.TIEPNHAN_ID = A.TIEPNHAN_ID        left join TM_DICHVU D on D.DICHVU_ID = C.DICHVU_ID        left join TM_NHOMDICHVU E on E.NHOMDICHVU_ID = D.NHOMDICHVU_ID        left join TT_NOITRU_BENHAN F on F.TIEPNHAN_ID = A.TIEPNHAN_ID        where C.NGAYHENCLS is NULL and A.TIEPNHAN_ID = '28493' and A.BENHVIEN_ID = 'HLU01'        ) a where a.num = 1]
2020-01-02 17:31:11,647 [1] DEBUG - Statement Id: [DAO00009_TT_TIEPNHAN_GetProcess] PreparedStatement : [select PROCESS_ID from TT_TIEPNHAN where SOTIEPNHAN = 'TN200102.0000001']
2020-01-02 17:31:11,691 [1] DEBUG - Statement Id: [DAOWF001_Kiemtrathongtindayeucaudacochua] PreparedStatement : [select * from TT_REQUEST        where        PARA = '{"HOSPITAL_ID":"HLU01","SOTIEPNHAN":"TN200102.0000001"}'        AND ISACTIVE = '1']
2020-01-02 17:31:11,739 [1] DEBUG - Statement Id: [DAOWF001_Kiemtrathongtindichvudayeucau] PreparedStatement : [select top 1 * from TT_REQUEST_SERVICE        where        PARA = '{"DICHVU_ID":"5492","DVYEUCAU_ID":"206519"}'                AND ISACTIVE = '1' order by ID desc]
2020-01-02 17:31:14,419 [1] DEBUG - Statement Id: [DAOWF001_KiemtrathongtinchitietDichvuYeucau] PreparedStatement : [select * from TT_REQUEST_SERVICE_DETAIL        where        REQUEST_SERVICE_ID = '']
2020-01-02 17:31:16,872 [1] DEBUG - Statement Id: [DAOWF001_GetStartStateOfProcess] PreparedStatement : [select STATE_CODE from TM_STATE where TYPE_CODE = 'S' and PROCESS_CODE = 'P02']
2020-01-02 17:31:16,928 [1] DEBUG - Statement Id: [DAOWF001_Laythongtinwithstatecode] PreparedStatement : [select A.*, B.STATUS_CODE from        TM_STATE_ACTION A        left join TM_STATE B on B.STATE_CODE = A.NEXT_STATE_CODE and A.PROCESS_CODE = B.PROCESS_CODE        where        A.CURR_STATE_CODE = '7'        AND A.PROCESS_CODE = 'P02'        Order By ORDER_ID ASC]
2020-01-02 17:31:16,962 [1] DEBUG - Statement Id: [DAOWF003_Add] PreparedStatement : [insert into TT_REQUEST_SERVICE (        REQUEST_ID        , PARA        , CURR_STATE_CODE        , PROCESS_CODE        ) values (         @param0         ,  @param1         ,  @param2         ,  @param3         )        SELECT SCOPE_IDENTITY()]
2020-01-02 17:31:16,962 [1] DEBUG - Statement Id: [DAOWF003_Add] Parameters: [@param0=[REQUEST_ID,32793], @param1=[SERVICEPARA,{"DICHVU_ID":"5492","DVYEUCAU_ID":"206519"}], @param2=[CURR_STATE_CODE,0], @param3=[PROCESS_CODE,P02]]
2020-01-02 17:31:16,962 [1] DEBUG - Statement Id: [DAOWF003_Add] Types: [@param0=[Int32, System.Int32], @param1=[String, System.String], @param2=[String, System.String], @param3=[String, System.String]]
2020-01-02 17:31:17,001 [1] DEBUG - Statement Id: [DAOWF005_Add] PreparedStatement : [insert into TT_REQUEST_SERVICE_DETAIL (        REQUEST_ID        ,REQUEST_SERVICE_ID        , OLD_STATE_CODE        , CURR_STATE_CODE        ) values (         @param0         , @param1         ,  @param2         ,  @param3         )        SELECT SCOPE_IDENTITY()]
2020-01-02 17:31:17,002 [1] DEBUG - Statement Id: [DAOWF005_Add] Parameters: [@param0=[REQUEST_ID,32793], @param1=[REQUEST_SERVICE_ID,148395], @param2=[OLD_STATE_CODE,null], @param3=[CURR_STATE_CODE,0]]
2020-01-02 17:31:17,002 [1] DEBUG - Statement Id: [DAOWF005_Add] Types: [@param0=[String, System.String], @param1=[Int64, System.Int64], @param2=[System.DBNull, null], @param3=[String, System.String]]
2020-01-02 17:31:17,033 [1] DEBUG - Statement Id: [DAOWF005_Add_History] PreparedStatement : [insert into TT_REQUEST_SERVICE_HISTORY (        REQUEST_ID        ,REQUEST_SERVICE_ID        , OLD_STATE_CODE        , CURR_STATE_CODE        ) values (         @param0         , @param1         ,  @param2         ,  @param3         )]
2020-01-02 17:31:17,033 [1] DEBUG - Statement Id: [DAOWF005_Add_History] Parameters: [@param0=[REQUEST_ID,32793], @param1=[REQUEST_SERVICE_ID,148395], @param2=[OLD_STATE_CODE,null], @param3=[CURR_STATE_CODE,0]]
2020-01-02 17:31:17,033 [1] DEBUG - Statement Id: [DAOWF005_Add_History] Types: [@param0=[String, System.String], @param1=[Int64, System.Int64], @param2=[System.DBNull, null], @param3=[String, System.String]]
2020-01-02 17:31:17,246 [1] DEBUG - Statement Id: [DAO00009_TT_DVYEUCAU_Update] PreparedStatement : [Update TT_DVYEUCAU set TRANGTHAI_WFL = 'CHUAKETQUA' where DVYEUCAU_ID = '206519']
2020-01-02 17:31:17,296 [1] DEBUG - Statement Id: [DAO00026_GetListDanhSachDichVuGhiNhanVTYT_COM25_WithTN] PreparedStatement : [select distinct CONVERT(VARCHAR(11),C.NGAYYEUCAU,103) as NGAYYEUCAU, C.DICHVU_ID, C.DVYEUCAU_ID, D.TENDICHVU, C.NOITHUCHIEN_ID, A.SOTIEPNHAN, A.TRAITUYEN, A.NGAYMIENDONGCHITRA, A.TIEPNHAN_ID, A.DOITUONG_ID, A.TRANGTHAI,            A.LOAITHANHVIEN_ID, A.SUDUNG_BHTN, A.THE_ID, A.THANHVIEN_ID, A.VIP, A.NGUON_BENHNHAN_ID, A.BAOLANH_VIENPHI,            CASE WHEN (A.TRANGTHAI = 'NOITRU' OR A.TRANGTHAI = 'CAPCUU') THEN 'IN' ELSE 'OUT' END AS LOAIBENHAN,            CASE WHEN (C.TRANGTHAI = 'CHUAKETQUA') THEN 'CHUAKETQUA' ELSE 'HOANTAT' END AS TRANGTHAIDICHVU,            B.*, isnull(ntba.SOBENHAN, '') SOBENHAN, isnull(ntba.BENHAN_ID, 0) BENHAN_ID,            CASE WHEN Left(E.MANHOMDICHVU,2) = '03' THEN '02' ELSE Left(E.MANHOMDICHVU,2) END AS MANHOMDICHVU            from TT_TIEPNHAN A            inner join TT_BENHNHAN B on B.BENHNHAN_ID = A.BENHNHAN_ID and B.ACTIVE = '1'            inner join TT_DVYEUCAU C on C.TIEPNHAN_ID = A.TIEPNHAN_ID                        left join TM_DICHVU D on D.DICHVU_ID = C.DICHVU_ID            left join TM_NHOMDICHVU E on E.NHOMDICHVU_ID = D.NHOMDICHVU_ID            left join TT_NOITRU_BENHAN ntba on ntba.BENHAN_ID = C.BENHAN_ID              where            C.NGAYHENCLS is NULL and A.BENHVIEN_ID = 'HLU01'            and (A.TRANGTHAI = 'DATIEPNHAN' or A.TRANGTHAI = 'NOITRU' or A.TRANGTHAI = 'CAPCUU' or A.TRANGTHAI = 'NGOAITRU')            and (CASE WHEN Left(E.MANHOMDICHVU,2) = '03' THEN '02' ELSE Left(E.MANHOMDICHVU,2) END in ('02', '04'))            and A.TIEPNHAN_ID = '28493']
2020-01-02 17:31:17,977 [1] DEBUG - Statement Id: [DAO00023_GetSOBHYT_HUONG_ID] PreparedStatement : [select isnull(MAX(SOBHYT_HUONG_ID),0) SOBHYT_HUONG_ID        from TT_TIEPNHAN_SOTHEBHYT        where TIEPNHAN_ID = '28493']
2020-01-02 17:31:18,030 [1] DEBUG - Statement Id: [DAO00064_GetTopTT_TIEPNHAN_SOTHEBHYT] PreparedStatement : [select top 1 stbhyt.*, ba.SOBENHAN,        tn.SOTIEPNHAN, tn.LOAITHANHVIEN_ID, tn.THE_ID, tn.THANHVIEN_ID,        tn.SUDUNG_BHTN, tn.BAOLANH_VIENPHI, tn.VIP, tn.NGUOINUOCNGOAI        from TT_TIEPNHAN_SOTHEBHYT stbhyt        left join TT_TIEPNHAN tn on tn.TIEPNHAN_ID = stbhyt.TIEPNHAN_ID        left join TT_NOITRU_BENHAN ba on ba.TIEPNHAN_ID = stbhyt.TIEPNHAN_ID        where        stbhyt.TIEPNHAN_ID = '28493' and isnull(stbhyt.KHONGSUDUNG, '0') = '0'        order by SOBHYT_HUONG_ID desc]
2020-01-02 17:31:18,102 [1] DEBUG - Statement Id: [DAO00006_GetListDuocTyle] PreparedStatement : [select DUOC_ID, DOITUONG_ID, (TYLE/100) as TYLE, DONGIA MUCTRAN_THANHTOAN from TM_DOITUONG_GIADUOC_TYLE            where            BENHVIEN_ID = 'HLU01'            and DOITUONG_ID = '4']
2020-01-02 17:31:18,127 [1] DEBUG - Statement Id: [DAO00027_GetListTuongTrinhDichVuPhauThuatCuaTiepNhan] PreparedStatement : [declare @ManhomDSA varchar(10);        declare @PhanLoaiNhomDV varchar(20) = '05';        select top 1  @ManhomDSA = VALUE from TM_SYS_APPSETTINGS where CODE = 'MANHOM_DICHVU_DSA'        if (@ManhomDSA is not null) set @PhanLoaiNhomDV += ',' + @ManhomDSA        select distinct ptyc.*        from TT_PHAUTHUAT_YEUCAU ptyc        inner join TM_DICHVU dv on dv.DICHVU_ID = ptyc.DICHVU_ID        inner join TM_NHOMDICHVU ndv on ndv.NHOMDICHVU_ID = dv.NHOMDICHVU_ID        inner join TT_PHAUTHUAT pt on pt.PHAUTHUAT_ID = ptyc.PHAUTHUAT_ID        where        pt.TIEPNHAN_ID = 28493        and (left(ndv.MANHOMDICHVU, 2) in (select * from STRING_SPLIT(@PhanLoaiNhomDV,',')) or ndv.MANHOMDICHVU in (select * from STRING_SPLIT(@PhanLoaiNhomDV,',')))]
2020-01-02 17:31:18,272 [1] DEBUG - Statement Id: [DAO00006_GetList] PreparedStatement : [select dv.*, loaiDV.MALOAIDICHVU, captren.NHOMDICHVU_ID as NHOMDICHVU_CAPTREN_ID, captren.TENNHOMDICHVU as NHOMDICHVU_CAPTREN,              nhom_dv.TENNHOMDICHVU as TENNHOMDICHVU, nhom_dv.MANHOMDICHVU,              case when dv.ATTRIBUTE5 is null then 'TT' else 'KTC' end as LOAI_CHIPHI              from TM_DICHVU as dv              left join TM_NHOMDICHVU as nhom_dv on nhom_dv.NHOMDICHVU_ID = dv.NHOMDICHVU_ID and nhom_dv.BENHVIEN_ID = 'HLU01'              left join TM_NHOMDICHVU as captren on nhom_dv.CAPTREN_ID = captren.NHOMDICHVU_ID and captren.BENHVIEN_ID = 'HLU01'              left join TM_LOAIDICHVU loaiDV on nhom_dv.LOAIDICHVU_ID = loaiDV.LOAIDICHVU_ID and loaiDV.BENHVIEN_ID = 'HLU01'              where nhom_dv.TAMNGUNG = '0' and dv.BENHVIEN_ID = 'HLU01'              and dv.TAMNGUNG = '0'               AND                   loaiDV.MALOAIDICHVU = 'KhamBenh']
2020-01-02 17:31:18,303 [1] DEBUG - Statement Id: [DAO00027_GetDichvuYCBHYTTyle] PreparedStatement : [select DVYEUCAU_ID from TT_DVYEUCAU        where TIEPNHAN_ID = 28493 and isnull(BHYT_TYLETHANHTOAN_ID, 0) > 0]
2020-01-02 17:31:18,369 [1] DEBUG - Statement Id: [DAO00023_Add] PreparedStatement : [insert into TT_VIENPHI (        TIEPNHAN_ID        , BENHAN_ID         ,           BENHNHAN_ID         ,           DOTDIEUTRI_ID                 , KHAMBENH_ID        , REF_ID        , REF_TABLE        , DICHVU_ID        , DUOC_ID        , LOAI_CHIPHI        , LOAIGIA_ID        , SOLUONG        , DONGIA_DOANHTHU        , THANHTIEN_DOANHTHU        , BHYT_TL        , BHYT_DONGIA        , BHYT_THANHTIEN        , BHYT_DONGIA_CHITRA        , BHYT_THANHTIEN_CHITRA        , BENHNHAN_PHAITHANHTOAN        , GIATRI_HOADON        , GIATRI_HOADON_DATHANHTOAN        , GIATRI_BIENLAI        , GIATRI_BIENLAI_DATHANHTOAN        , GIATRI_BENHNHAN_DATHANHTOAN        , GIATRI_THATTHU        , MIENGIAM_TL        , MIENGIAM_GIATRI        , NGANSACH_TL        , NGANSACH_GIATRI        , TAITRO_TL        , TAITRO_GIATRI        , BHTN_TL        , BHTN_DONGIA        , BHTN_THANHTIEN        , BHTN_DONGIA_CHITRA        , BHTN_THANHTIEN_CHITRA         ,           DUOCPHEPTHUCHIEN         ,           HUY         ,           DATHANHTOAN         ,           DATHUCHIEN         ,           KHONGTHUTIEN         ,           BHYTDONGTIEN                 , DUYET        , HOADON_ID         ,           ACTIVE         ,           TYLE_VAT         ,           GIAVON         ,           BANGGIA_ID                 , BENHVIEN_ID        , NGUOITAO_ID        , NGAYTAO        , NGUOICAPNHAT_ID        , NGAYCAPNHAT        , DONGIA_BHYT_BANDAU        , DONGIADOANHTHU_BANDAU         ,           YEUCAUVP         ,           DOITUONG_HUONG_ID         ,           SOBHYT_HUONG_ID         ,           DICHVU_TL                 ) values (         @param0         ,  @param1          ,            @param2          ,            @param3                  ,  @param4         ,  @param5         ,  @param6         ,  @param7         ,  @param8         ,  @param9         ,  @param10         ,  @param11         ,  @param12         ,  @param13         ,  @param14         ,  @param15         ,  @param16         ,  @param17         ,  @param18         ,  @param19         ,  @param20         ,  @param21         ,  @param22         ,  @param23         ,  @param24         ,  @param25         ,  @param26         ,  @param27         ,  @param28         ,  @param29         ,  @param30         ,  @param31         ,  @param32         ,  @param33         ,  @param34         ,  @param35         ,  @param36          ,            @param37          ,            @param38          ,            @param39          ,            @param40          ,            @param41          ,            @param42                  ,  @param43         ,  @param44          ,            @param45          ,            @param46          ,            @param47          ,            @param48                  ,  @param49         ,  @param50         ,  @param51         ,  @param52         ,  @param53         ,  @param54         ,  @param55          ,            @param56          ,            @param57          ,            @param58          ,            @param59                  )        SELECT SCOPE_IDENTITY()]
2020-01-02 17:31:18,370 [1] DEBUG - Statement Id: [DAO00023_Add] Parameters: [@param0=[TIEPNHAN_ID,28493], @param1=[BENHAN_ID,null], @param2=[BENHNHAN_ID,24441], @param3=[DOTDIEUTRI_ID,0], @param4=[KHAMBENH_ID,null], @param5=[REF_ID,206519], @param6=[REF_TABLE,TT_DVYEUCAU], @param7=[DICHVU_ID,5492], @param8=[DUOC_ID,null], @param9=[LOAI_CHIPHI,TT], @param10=[LOAIGIA_ID,2], @param11=[SOLUONG,1], @param12=[DONGIA_DOANHTHU,33000], @param13=[THANHTIEN_DOANHTHU,33000], @param14=[BHYT_TL,1], @param15=[BHYT_DONGIA,33000], @param16=[BHYT_THANHTIEN,33000], @param17=[BHYT_DONGIA_CHITRA,33000], @param18=[BHYT_THANHTIEN_CHITRA,33000], @param19=[BENHNHAN_PHAITHANHTOAN,0], @param20=[GIATRI_HOADON,0], @param21=[GIATRI_HOADON_DATHANHTOAN,0], @param22=[GIATRI_BIENLAI,0], @param23=[GIATRI_BIENLAI_DATHANHTOAN,0], @param24=[GIATRI_BENHNHAN_DATHANHTOAN,0], @param25=[GIATRI_THATTHU,0], @param26=[MIENGIAM_TL,0], @param27=[MIENGIAM_GIATRI,0], @param28=[NGANSACH_TL,0], @param29=[NGANSACH_GIATRI,0], @param30=[TAITRO_TL,0], @param31=[TAITRO_GIATRI,0], @param32=[BHTN_TL,0], @param33=[BHTN_DONGIA,0], @param34=[BHTN_THANHTIEN,0], @param35=[BHTN_DONGIA_CHITRA,0], @param36=[BHTN_THANHTIEN_CHITRA,0], @param37=[DUOCPHEPTHUCHIEN,0], @param38=[HUY,0], @param39=[DATHANHTOAN,0], @param40=[DATHUCHIEN,0], @param41=[KHONGTHUTIEN,0], @param42=[BHYTDONGTIEN,0], @param43=[DUYET,null], @param44=[HOADON_ID,null], @param45=[ACTIVE,1], @param46=[TYLE_VAT,0], @param47=[GIAVON,0], @param48=[BANGGIA_ID,996], @param49=[BENHVIEN_ID,HLU01], @param50=[NGUOITAO_ID,1], @param51=[NGAYTAO,1/2/2020 5:31:18 PM], @param52=[NGUOICAPNHAT_ID,1], @param53=[NGAYCAPNHAT,1/2/2020 5:31:18 PM], @param54=[DONGIA_BHYT_BANDAU,33000], @param55=[DONGIADOANHTHU_BANDAU,33000], @param56=[YEUCAUVP,0], @param57=[DOITUONG_HUONG_ID,4], @param58=[SOBHYT_HUONG_ID,29516], @param59=[DICHVU_TL,1]]
2020-01-02 17:31:18,370 [1] DEBUG - Statement Id: [DAO00023_Add] Types: [@param0=[Int32, System.Int32], @param1=[System.DBNull, null], @param2=[Int32, System.Int32], @param3=[Int32, System.Int32], @param4=[System.DBNull, null], @param5=[Int32, System.Int32], @param6=[String, System.String], @param7=[Int32, System.Int32], @param8=[System.DBNull, null], @param9=[String, System.String], @param10=[Int32, System.Int32], @param11=[Decimal, System.Decimal], @param12=[Decimal, System.Decimal], @param13=[Decimal, System.Decimal], @param14=[Decimal, System.Decimal], @param15=[Decimal, System.Decimal], @param16=[Decimal, System.Decimal], @param17=[Decimal, System.Decimal], @param18=[Decimal, System.Decimal], @param19=[Decimal, System.Decimal], @param20=[Decimal, System.Decimal], @param21=[Decimal, System.Decimal], @param22=[Decimal, System.Decimal], @param23=[Decimal, System.Decimal], @param24=[Decimal, System.Decimal], @param25=[Decimal, System.Decimal], @param26=[Decimal, System.Decimal], @param27=[Decimal, System.Decimal], @param28=[Decimal, System.Decimal], @param29=[Decimal, System.Decimal], @param30=[Decimal, System.Decimal], @param31=[Decimal, System.Decimal], @param32=[Decimal, System.Decimal], @param33=[Decimal, System.Decimal], @param34=[Decimal, System.Decimal], @param35=[Decimal, System.Decimal], @param36=[Decimal, System.Decimal], @param37=[Int32, System.Int32], @param38=[Int32, System.Int32], @param39=[Int32, System.Int32], @param40=[Int32, System.Int32], @param41=[String, System.String], @param42=[String, System.String], @param43=[System.DBNull, null], @param44=[System.DBNull, null], @param45=[Int32, System.Int32], @param46=[Int32, System.Int32], @param47=[Decimal, System.Decimal], @param48=[Int32, System.Int32], @param49=[String, System.String], @param50=[String, System.String], @param51=[DateTime, System.DateTime], @param52=[String, System.String], @param53=[DateTime, System.DateTime], @param54=[Decimal, System.Decimal], @param55=[Decimal, System.Decimal], @param56=[String, System.String], @param57=[Int32, System.Int32], @param58=[Int32, System.Int32], @param59=[Decimal, System.Decimal]]
2020-01-02 17:31:18,906 [1] DEBUG - Statement Id: [DAO00064_GetREGListVienphiTiepNhan] PreparedStatement : [select A.*, B.THUTIENSAU        from TT_VIENPHI A        left join TT_DVYEUCAU B on A.REF_ID =  B.DVYEUCAU_ID and A.REF_TABLE = 'TT_DVYEUCAU' and B.HUYYEUCAU = '0'        where        A.TIEPNHAN_ID = '28493' and A.BENHVIEN_ID = 'HLU01' and (A.BENHAN_ID is NULL or A.BENHAN_ID = '')        and A.HUY = '0'        ORDER BY A.VIENPHI_ID]
2020-01-02 17:31:19,019 [1] DEBUG - Statement Id: [DAO00064_GetTopTT_TIEPNHAN_SOTHEBHYT] PreparedStatement : [select top 1 stbhyt.*, ba.SOBENHAN,        tn.SOTIEPNHAN, tn.LOAITHANHVIEN_ID, tn.THE_ID, tn.THANHVIEN_ID,        tn.SUDUNG_BHTN, tn.BAOLANH_VIENPHI, tn.VIP, tn.NGUOINUOCNGOAI        from TT_TIEPNHAN_SOTHEBHYT stbhyt        left join TT_TIEPNHAN tn on tn.TIEPNHAN_ID = stbhyt.TIEPNHAN_ID        left join TT_NOITRU_BENHAN ba on ba.TIEPNHAN_ID = stbhyt.TIEPNHAN_ID        where        stbhyt.TIEPNHAN_ID = '28493' and isnull(stbhyt.KHONGSUDUNG, '0') = '0'        order by SOBHYT_HUONG_ID desc]
2020-01-02 17:31:19,045 [1] DEBUG - Statement Id: [DAO00006_GetListDuocTyle] PreparedStatement : [select DUOC_ID, DOITUONG_ID, (TYLE/100) as TYLE, DONGIA MUCTRAN_THANHTOAN from TM_DOITUONG_GIADUOC_TYLE            where            BENHVIEN_ID = 'HLU01'            and DOITUONG_ID = '4']
2020-01-02 17:31:19,070 [1] DEBUG - Statement Id: [DAO00027_GetListTuongTrinhDichVuPhauThuatCuaTiepNhan] PreparedStatement : [declare @ManhomDSA varchar(10);        declare @PhanLoaiNhomDV varchar(20) = '05';        select top 1  @ManhomDSA = VALUE from TM_SYS_APPSETTINGS where CODE = 'MANHOM_DICHVU_DSA'        if (@ManhomDSA is not null) set @PhanLoaiNhomDV += ',' + @ManhomDSA        select distinct ptyc.*        from TT_PHAUTHUAT_YEUCAU ptyc        inner join TM_DICHVU dv on dv.DICHVU_ID = ptyc.DICHVU_ID        inner join TM_NHOMDICHVU ndv on ndv.NHOMDICHVU_ID = dv.NHOMDICHVU_ID        inner join TT_PHAUTHUAT pt on pt.PHAUTHUAT_ID = ptyc.PHAUTHUAT_ID        where        pt.TIEPNHAN_ID = 28493        and (left(ndv.MANHOMDICHVU, 2) in (select * from STRING_SPLIT(@PhanLoaiNhomDV,',')) or ndv.MANHOMDICHVU in (select * from STRING_SPLIT(@PhanLoaiNhomDV,',')))]
2020-01-02 17:31:19,103 [1] DEBUG - Statement Id: [DAO00006_GetList] PreparedStatement : [select dv.*, loaiDV.MALOAIDICHVU, captren.NHOMDICHVU_ID as NHOMDICHVU_CAPTREN_ID, captren.TENNHOMDICHVU as NHOMDICHVU_CAPTREN,              nhom_dv.TENNHOMDICHVU as TENNHOMDICHVU, nhom_dv.MANHOMDICHVU,              case when dv.ATTRIBUTE5 is null then 'TT' else 'KTC' end as LOAI_CHIPHI              from TM_DICHVU as dv              left join TM_NHOMDICHVU as nhom_dv on nhom_dv.NHOMDICHVU_ID = dv.NHOMDICHVU_ID and nhom_dv.BENHVIEN_ID = 'HLU01'              left join TM_NHOMDICHVU as captren on nhom_dv.CAPTREN_ID = captren.NHOMDICHVU_ID and captren.BENHVIEN_ID = 'HLU01'              left join TM_LOAIDICHVU loaiDV on nhom_dv.LOAIDICHVU_ID = loaiDV.LOAIDICHVU_ID and loaiDV.BENHVIEN_ID = 'HLU01'              where nhom_dv.TAMNGUNG = '0' and dv.BENHVIEN_ID = 'HLU01'              and dv.TAMNGUNG = '0'               AND                   loaiDV.MALOAIDICHVU = 'KhamBenh']
2020-01-02 17:31:19,132 [1] DEBUG - Statement Id: [DAO00027_GetDichvuYCBHYTTyle] PreparedStatement : [select DVYEUCAU_ID from TT_DVYEUCAU        where TIEPNHAN_ID = 28493 and isnull(BHYT_TYLETHANHTOAN_ID, 0) > 0]
2020-01-02 17:31:19,165 [1] DEBUG - Statement Id: [DAO00023_Update_VPTiepnhan] PreparedStatement : [update TT_VIENPHI set        TIEPNHAN_ID =  @param0                ,           BENHNHAN_ID =  @param1          ,           REF_ID =  @param2                  , REF_TABLE =  @param3         , DICHVU_ID =  @param4         , DUOC_ID =  @param5         , LOAI_CHIPHI =  @param6         , LOAIGIA_ID =  @param7         , SOLUONG =  @param8         , DONGIA_DOANHTHU =  @param9         , THANHTIEN_DOANHTHU =  @param10         , BHYT_TL =  @param11         , BHYT_DONGIA =  @param12         , BHYT_THANHTIEN =  @param13         , BHYT_DONGIA_CHITRA =  @param14         , BHYT_THANHTIEN_CHITRA =  @param15         , BENHNHAN_PHAITHANHTOAN =  @param16         , GIATRI_HOADON =  @param17         , GIATRI_HOADON_DATHANHTOAN =  @param18         , GIATRI_BIENLAI =  @param19         , GIATRI_BIENLAI_DATHANHTOAN =  @param20         , GIATRI_BENHNHAN_DATHANHTOAN =  @param21         , GIATRI_THATTHU =  @param22         , MIENGIAM_TL =  @param23         , NGANSACH_TL =  @param24         , NGANSACH_GIATRI =  @param25         , TAITRO_TL =  @param26         , TAITRO_GIATRI =  @param27         , BHTN_TL =  @param28         , BHTN_DONGIA =  @param29         , BHTN_THANHTIEN =  @param30         , BHTN_DONGIA_CHITRA =  @param31         , BHTN_THANHTIEN_CHITRA =  @param32          ,           TYLE_VAT =  @param33          ,           GIAVON =  @param34          ,           BANGGIA_ID =  @param35          ,           BHYTDONGTIEN =  @param36          ,           BHYT_DONGIA_CONGKHAM_DAU =  @param37          ,           BHYT_CONGKHAM_DAU_TYLE =  @param38                  , BENHVIEN_ID =  @param39         , NGUOICAPNHAT_ID =  @param40         , NGAYCAPNHAT =  @param41          ,           DONGIA_BHYT_BANDAU =  @param42          ,           YEUCAUVP =  @param43                        where                    VIENPHI_ID = '675810' and DATHANHTOAN = '0']
2020-01-02 17:31:19,165 [1] DEBUG - Statement Id: [DAO00023_Update_VPTiepnhan] Parameters: [@param0=[TIEPNHAN_ID,28493], @param1=[BENHNHAN_ID,24441], @param2=[REF_ID,206519], @param3=[REF_TABLE,TT_DVYEUCAU], @param4=[DICHVU_ID,5492], @param5=[DUOC_ID,null], @param6=[LOAI_CHIPHI,TT], @param7=[LOAIGIA_ID,2], @param8=[SOLUONG,1.0000], @param9=[DONGIA_DOANHTHU,33000.0000], @param10=[THANHTIEN_DOANHTHU,33000.00], @param11=[BHYT_TL,1], @param12=[BHYT_DONGIA,33000.0000], @param13=[BHYT_THANHTIEN,33000.00], @param14=[BHYT_DONGIA_CHITRA,33000], @param15=[BHYT_THANHTIEN_CHITRA,33000.00], @param16=[BENHNHAN_PHAITHANHTOAN,0], @param17=[GIATRI_HOADON,0], @param18=[GIATRI_HOADON_DATHANHTOAN,0], @param19=[GIATRI_BIENLAI,0], @param20=[GIATRI_BIENLAI_DATHANHTOAN,0], @param21=[GIATRI_BENHNHAN_DATHANHTOAN,0], @param22=[GIATRI_THATTHU,0], @param23=[MIENGIAM_TL,0], @param24=[NGANSACH_TL,0], @param25=[NGANSACH_GIATRI,0], @param26=[TAITRO_TL,0], @param27=[TAITRO_GIATRI,0], @param28=[BHTN_TL,0], @param29=[BHTN_DONGIA,0], @param30=[BHTN_THANHTIEN,0], @param31=[BHTN_DONGIA_CHITRA,0], @param32=[BHTN_THANHTIEN_CHITRA,0], @param33=[TYLE_VAT,0], @param34=[GIAVON,0.0000], @param35=[BANGGIA_ID,996], @param36=[BHYTDONGTIEN,0], @param37=[BHYT_DONGIA_CONGKHAM_DAU,33000.0000], @param38=[BHYT_CONGKHAM_DAU_TYLE,1], @param39=[BENHVIEN_ID,HLU01], @param40=[NGUOICAPNHAT_ID,1], @param41=[NGAYCAPNHAT,1/2/2020 5:31:19 PM], @param42=[DONGIA_BHYT_BANDAU,33000.0000], @param43=[YEUCAUVP,0]]
2020-01-02 17:31:19,165 [1] DEBUG - Statement Id: [DAO00023_Update_VPTiepnhan] Types: [@param0=[Int32, System.Int32], @param1=[Int32, System.Int32], @param2=[Int32, System.Int32], @param3=[String, System.String], @param4=[Int32, System.Int32], @param5=[System.DBNull, null], @param6=[String, System.String], @param7=[Int32, System.Int32], @param8=[Decimal, System.Decimal], @param9=[Decimal, System.Decimal], @param10=[Decimal, System.Decimal], @param11=[Decimal, System.Decimal], @param12=[Decimal, System.Decimal], @param13=[Decimal, System.Decimal], @param14=[Decimal, System.Decimal], @param15=[Decimal, System.Decimal], @param16=[Decimal, System.Decimal], @param17=[Decimal, System.Decimal], @param18=[Decimal, System.Decimal], @param19=[Decimal, System.Decimal], @param20=[Decimal, System.Decimal], @param21=[Decimal, System.Decimal], @param22=[Decimal, System.Decimal], @param23=[Decimal, System.Decimal], @param24=[Decimal, System.Decimal], @param25=[Decimal, System.Decimal], @param26=[Decimal, System.Decimal], @param27=[Decimal, System.Decimal], @param28=[Decimal, System.Decimal], @param29=[Decimal, System.Decimal], @param30=[Decimal, System.Decimal], @param31=[Decimal, System.Decimal], @param32=[Decimal, System.Decimal], @param33=[Int32, System.Int32], @param34=[Decimal, System.Decimal], @param35=[Int32, System.Int32], @param36=[String, System.String], @param37=[Decimal, System.Decimal], @param38=[Decimal, System.Decimal], @param39=[String, System.String], @param40=[Int32, System.Int32], @param41=[DateTime, System.DateTime], @param42=[Decimal, System.Decimal], @param43=[String, System.String]]
2020-01-02 17:31:19,293 [1] DEBUG - Statement Id: [DAO00019_GetDetails_TiepNhan] PreparedStatement : [select tn.TIEPNHAN_ID, tn.SOTIEPNHAN, tn.SOBHYT as SOTHE, tn.BHYTTUNGAY as NGAYHIEULUC,        tn.BHYTDENNGAY as NGAYHETHIEULUC, tn.BHYTNGAYCAP as NGAYCAP, tn.BHYTTREN3NAM as TREN3NAM, tn.KHUVUCSONG_ID,        tn.BHYTTREN5NAM as TREN5NAM,tn.NGAYMIENDONGCHITRA,tn.NOIGIOITHIEU_ID, tn.NGUOIGIOITHIEU_ID, tn.CHANDOANNGT,        tn.NOITIEPNHAN_ID, tn.DOITUONG_ID, tn.TRAITUYEN, tn.HINHTHUCDENKHAM_ID, tn.THOIGIANTIEPNHAN,        dv.DVYEUCAU_ID, dv.DICHVU_ID, dv.NOITHUCHIEN_ID as PHONGBAN_ID,        dv.NGUOITAO_ID as DV_NGUOITAO_ID, dv.NGAYTAO as DV_NGAYTAO, dv.THUTIENSAU, dv.BACSICHIDINH_ID, dv.NGUOICHIDINH_ID,        dv.NGUOICAPNHAT_ID as DV_NGUOICAPNHAT_ID, dv.NGAYCAPNHAT as DV_NGAYCAPNHAT,        vp.VIENPHI_ID, vp.KHONGTHUTIEN, vp.LOAI_CHIPHI, vp.LOAIGIA_ID as LOAIGIA,        vp.DATHUCHIEN, vp.DATHANHTOAN, vp.DONGIA_DOANHTHU,        dv.NOITHUCHIEN_ID, dv.TRANGTHAI,        vp.NGUOITAO_ID as VP_NGUOITAO_ID, vp.BHYT_DONGIA, vp.TYLE_VAT, vp.BANGGIA_ID, vp.GIAVON,        tn.NGAYTAO as TN_NGAYTAO,        vp.NGAYTAO as VP_NGAYTAO, vp.NGUOICAPNHAT_ID as VP_NGUOICAPNHAT_ID, vp.NGAYCAPNHAT as VP_NGAYCAPNHAT,        tn.SOCHUYENVIEN, tn.THOIGIANCHUYENTUYEN, tn.HINHTHUCCHUYENVIEN_ID, tn.LYDOCHUYENVIEN_ID, tn.ICDNOIGIOITHIEU_ID,        tn.SUDUNG_BHTN, tn.THE_ID, tn.LOAITHANHVIEN_ID, tn.THANHVIEN_ID, tn.VIP, tn.GHICHU_TIEPNHAN, tn.BAOLANH_VIENPHI        , tn.CONGTY_CHITRA_ID, tn.TRANGTHAI as TRANGTHAI_TIEPNHAN, tn.NGUOITAO_ID as TN_NGUOITAO_ID, tn.TINHTRANGHEN        , tn.NGUON_BENHNHAN_ID, tn.THONGTIN_KCB_BHYT, tn.LOAITIEPNHAN_ID, tn.LYDODENKHAM, vp.YEUCAUVP        from (        select top 1 *        from TT_TIEPNHAN        where BENHVIEN_ID = 'HLU01'                 order by                 SOTIEPNHAN desc        ) as tn        left join TT_DVYEUCAU dv on dv.TIEPNHAN_ID = tn.TIEPNHAN_ID and dv.HUYYEUCAU = '0'        left join TT_VIENPHI vp on vp.TIEPNHAN_ID = tn.TIEPNHAN_ID and vp.DICHVU_ID = dv.DICHVU_ID  and dv.DVYEUCAU_ID = vp.REF_ID]
2020-01-02 17:31:36,120 [1] DEBUG - Statement Id: [DAO00012_GetList] PreparedStatement : [select        DICTIONARY_ID,        DICTIONARY_CODE,        DICTIONARY_NAME,        ATTRIBUTE1,        ATTRIBUTE2,        DICTIONARY_NAME_EN        from LST_DICTIONARY        where LST_DICTIONARY.Enabled = '1'         AND           LST_DICTIONARY.DICTIONARY_TYPE_CODE = 'PhanLoaiTiepNhan'                 order by LST_DICTIONARY.IDX]
2020-01-02 17:31:36,159 [1] DEBUG - Statement Id: [DAO00012_GetList] PreparedStatement : [select        DICTIONARY_ID,        DICTIONARY_CODE,        DICTIONARY_NAME,        ATTRIBUTE1,        ATTRIBUTE2,        DICTIONARY_NAME_EN        from LST_DICTIONARY        where LST_DICTIONARY.Enabled = '1'         AND           LST_DICTIONARY.DICTIONARY_TYPE_CODE = 'NguonBN'                 order by LST_DICTIONARY.IDX]
2020-01-02 17:31:36,185 [1] DEBUG - Statement Id: [DAO00019_GetListCongTyChiTra] PreparedStatement : [select *        from TM_CONGTYCHITRA        where        BENHVIEN_ID = 'HLU01' AND TAMNGUNG = '0']
2020-01-02 17:31:36,409 [1] DEBUG - Statement Id: [DAO00017_GetListPhongKham] PreparedStatement : [select pb.PHONGBAN_ID, pb.TENPHONGBAN, case when dv.ATTRIBUTE5 is null then 'TT' else 'KTC' end as LOAI_CHIPHI              from [TM_PHONGBAN_DICHVU] as pb_dv              inner join [TM_PHONGBAN] as pb on pb.PHONGBAN_ID = pb_dv.PHONGBAN_ID and pb.BENHVIEN_ID = 'HLU01'              inner join [TM_DICHVU] dv on dv.DICHVU_ID = pb_dv.DICHVU_ID and dv.MADICHVU = '' and dv.BENHVIEN_ID = 'HLU01'              where pb_dv.BENHVIEN_ID = 'HLU01']
2020-01-02 17:31:36,450 [1] DEBUG - Statement Id: [DAO00019_GetListPhongKham_REG13] PreparedStatement : [select pb.PHONGBAN_ID, pb.TENPHONGBAN, case when dv.ATTRIBUTE5 is null then 'TT' else 'KTC' end as LOAI_CHIPHI        from TM_PHONGBAN pb        left join TM_PHONGBAN_DICHVU pb_dv on pb_dv.PHONGBAN_ID = pb.PHONGBAN_ID and pb_dv.BENHVIEN_ID = pb.BENHVIEN_ID        left join TM_DICHVU dv on dv.DICHVU_ID = pb_dv.DICHVU_ID and dv.BENHVIEN_ID = pb_dv.BENHVIEN_ID        left join TM_NHOMDICHVU ndv on ndv.NHOMDICHVU_ID = dv.NHOMDICHVU_ID and ndv.BENHVIEN_ID = dv.BENHVIEN_ID        where pb.BENHVIEN_ID = 'HLU01' and ndv.MANHOMDICHVU = '04' and dv.DICHVU_ID IS NOT NULL]
2020-01-02 17:31:36,556 [1] DEBUG - Statement Id: [DAO00019_LayThongTinSoluongDichVuPhongKham_REG13] PreparedStatement : [select PHONGBAN_ID, TENPHONGBAN, NOITHUCHIEN_ID, SUM(CHUAKETQUA) AS CHUAKETQUA, SUM(HOANTAT) AS HOANTAT, SUM(DANGTHUCHIEN) AS DANGTHUCHIEN        from (        select B.PHONGBAN_ID, B.TENPHONGBAN, A.NOITHUCHIEN_ID,        case when A.TRANGTHAI = 'CHUAKETQUA' then 1 else 0 end AS CHUAKETQUA,        case when A.TRANGTHAI = 'HOANTAT' then 1 else 0 end AS HOANTAT,        case when A.TRANGTHAI = 'DANGTHUCHIEN' then 1 else 0 end AS DANGTHUCHIEN        from TM_PHONGBAN B        left join TT_DVYEUCAU A on A.NOITHUCHIEN_ID = B.PHONGBAN_ID and A.BENHVIEN_ID = B.BENHVIEN_ID and A.NGAYYEUCAU = CONVERT(date, getdate())        left join TM_DICHVU dv on A.DICHVU_ID = dv.DICHVU_ID        left join TM_NHOMDICHVU ndv on ndv.NHOMDICHVU_ID = dv.NHOMDICHVU_ID        where B.BENHVIEN_ID ='HLU01' and Left(ndv.MANHOMDICHVU,2) = '04'        and B.PHONGBAN_ID in (65,71,72,41,68,62,177,67,55,81,57,57,58,59,60,63,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,61,69,69,70,70)        ) tmp        group by tmp.NOITHUCHIEN_ID, tmp.TENPHONGBAN, tmp.PHONGBAN_ID]
2020-01-02 17:31:36,830 [1] DEBUG - Statement Id: [DAO00017_GetListPhongKham] PreparedStatement : [select pb.PHONGBAN_ID, pb.TENPHONGBAN, case when dv.ATTRIBUTE5 is null then 'TT' else 'KTC' end as LOAI_CHIPHI              from [TM_PHONGBAN_DICHVU] as pb_dv              inner join [TM_PHONGBAN] as pb on pb.PHONGBAN_ID = pb_dv.PHONGBAN_ID and pb.BENHVIEN_ID = 'HLU01'              inner join [TM_DICHVU] dv on dv.DICHVU_ID = pb_dv.DICHVU_ID and dv.MADICHVU = '' and dv.BENHVIEN_ID = 'HLU01'              where pb_dv.BENHVIEN_ID = 'HLU01']
2020-01-02 17:31:36,866 [1] DEBUG - Statement Id: [DAO00019_GetListPhongKham_REG13] PreparedStatement : [select pb.PHONGBAN_ID, pb.TENPHONGBAN, case when dv.ATTRIBUTE5 is null then 'TT' else 'KTC' end as LOAI_CHIPHI        from TM_PHONGBAN pb        left join TM_PHONGBAN_DICHVU pb_dv on pb_dv.PHONGBAN_ID = pb.PHONGBAN_ID and pb_dv.BENHVIEN_ID = pb.BENHVIEN_ID        left join TM_DICHVU dv on dv.DICHVU_ID = pb_dv.DICHVU_ID and dv.BENHVIEN_ID = pb_dv.BENHVIEN_ID        left join TM_NHOMDICHVU ndv on ndv.NHOMDICHVU_ID = dv.NHOMDICHVU_ID and ndv.BENHVIEN_ID = dv.BENHVIEN_ID        where pb.BENHVIEN_ID = 'HLU01' and ndv.MANHOMDICHVU = '04' and dv.DICHVU_ID IS NOT NULL]
2020-01-02 17:31:36,954 [1] DEBUG - Statement Id: [DAO00019_LayThongTinSoluongDichVuPhongKham_REG13] PreparedStatement : [select PHONGBAN_ID, TENPHONGBAN, NOITHUCHIEN_ID, SUM(CHUAKETQUA) AS CHUAKETQUA, SUM(HOANTAT) AS HOANTAT, SUM(DANGTHUCHIEN) AS DANGTHUCHIEN        from (        select B.PHONGBAN_ID, B.TENPHONGBAN, A.NOITHUCHIEN_ID,        case when A.TRANGTHAI = 'CHUAKETQUA' then 1 else 0 end AS CHUAKETQUA,        case when A.TRANGTHAI = 'HOANTAT' then 1 else 0 end AS HOANTAT,        case when A.TRANGTHAI = 'DANGTHUCHIEN' then 1 else 0 end AS DANGTHUCHIEN        from TM_PHONGBAN B        left join TT_DVYEUCAU A on A.NOITHUCHIEN_ID = B.PHONGBAN_ID and A.BENHVIEN_ID = B.BENHVIEN_ID and A.NGAYYEUCAU = CONVERT(date, getdate())        left join TM_DICHVU dv on A.DICHVU_ID = dv.DICHVU_ID        left join TM_NHOMDICHVU ndv on ndv.NHOMDICHVU_ID = dv.NHOMDICHVU_ID        where B.BENHVIEN_ID ='HLU01' and Left(ndv.MANHOMDICHVU,2) = '04'        and B.PHONGBAN_ID in (65,71,72,41,68,62,177,67,55,81,57,57,58,59,60,63,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,61,69,69,70,70)        ) tmp        group by tmp.NOITHUCHIEN_ID, tmp.TENPHONGBAN, tmp.PHONGBAN_ID]
2020-01-02 17:31:45,683 [1] DEBUG - Statement Id: [DAO00095_GetDetailTrungBN] PreparedStatement : [select  TT_TIEPNHAN.NGAYTIEPNHAN AS NGAYTIEPNHAN ,TT_TIEPNHAN.SOBHYT AS SOTHE, TT_BENHNHAN.*, ISNULL(TT_BENHNHAN.NGAYSINH,TT_BENHNHAN.NAMSINH) AS NGAYNAMSINH          from TT_BENHNHAN          left join TT_TIEPNHAN  ON          TT_TIEPNHAN.TIEPNHAN_ID = (SELECT TOP 1 TIEPNHAN_ID FROM TT_TIEPNHAN WHERE BENHNHAN_ID = TT_BENHNHAN.BENHNHAN_ID ORDER BY THOIGIANTIEPNHAN DESC)           WHERE                TT_BENHNHAN.TENBENHNHAN = N'Test 2'             AND               convert(varchar(10),TT_BENHNHAN.NGAYSINH, 103) = convert(varchar(10),'05/05/1998', 103)               AND               TT_BENHNHAN.GIOITINH = '1']
2020-01-02 17:32:02,648 [1] DEBUG - Statement Id: [DAO00000_GetKyHieuBHYT] PreparedStatement : [select * from TM_DOITUONG where NHOMTHE LIKE '%' +  @param0  + '%']
2020-01-02 17:32:02,648 [1] DEBUG - Statement Id: [DAO00000_GetKyHieuBHYT] Parameters: [@param0=[MATHEBHYT,DN4]]
2020-01-02 17:32:02,648 [1] DEBUG - Statement Id: [DAO00000_GetKyHieuBHYT] Types: [@param0=[String, System.String]]
2020-01-02 17:32:02,751 [1] DEBUG - Statement Id: [DAO00095_GetDetail] PreparedStatement : [select distinct TT_BENHNHAN.*, ISNULL(TT_BENHNHAN.NGAYSINH, TT_BENHNHAN.NAMSINH) AS NGAYNAMSINH, TN1.SOBHYT AS SOTHE, TN1.NGAYTIEPNHAN          from TT_BENHNHAN          left join (          select MAX(TIEPNHAN_ID) AS TIEPNHAN_ID, BENHNHAN_ID from TT_TIEPNHAN GROUP BY BENHNHAN_ID) TN ON TN.BENHNHAN_ID = TT_BENHNHAN.BENHNHAN_ID          left join TT_TIEPNHAN TN1 ON TN1.TIEPNHAN_ID = TN.TIEPNHAN_ID           WHERE                TN1.SOBHYT = 'DN466456425324438289']
2020-01-02 17:32:11,446 [1] DEBUG - Statement Id: [DAO00019_GetLoaiGiaLoaiKhachHang] PreparedStatement : [select A.*, B.DICTIONARY_CODE MAKHACHHANG, C.TENLOAIGIA        from TM_NGUONKHACHHANG_LOAIGIA A        left join LST_DICTIONARY B on A.NGUONKHACHHANG_BENHNHAN_ID = B.DICTIONARY_ID        inner join TM_LOAIGIA C on C.LOAIGIA_ID = A.LOAIGIA_ID and CAPTREN_ID  = (select LOAIGIA_ID from TM_LOAIGIA where MALOAIGIA = 'GiaDichVu')        left join TM_DICHVU_DONGIA dvdg on dvdg.LOAIGIA_ID = A.LOAIGIA_ID        where B.DICTIONARY_TYPE_CODE = 'NguonKhachHang' and dvdg.DICHVU_ID  =  @param0]
2020-01-02 17:32:11,446 [1] DEBUG - Statement Id: [DAO00019_GetLoaiGiaLoaiKhachHang] Parameters: [@param0=[DICHVU_ID,5492]]
2020-01-02 17:32:11,446 [1] DEBUG - Statement Id: [DAO00019_GetLoaiGiaLoaiKhachHang] Types: [@param0=[Int64, System.Int64]]
2020-01-02 17:32:11,475 [1] DEBUG - Statement Id: [DAO00017_GetLoaiGiaDoiTuongDichVu] PreparedStatement : [select a.LOAIGIA_ID, a.TENLOAIGIA, a.MALOAIGIA, a.CAPTREN_ID, MIN(a.UUTIEN_NGUON) AS UUTIEN_NGUON          , MAX(a.DOUUTIEN) AS DOUUTIEN, MIN(ISNULL(a.GIAHOTRO,0)) AS GIAHOTRO          from(                        select distinct A.LOAIGIA_ID, C.TENLOAIGIA, C.MALOAIGIA, 0 as UUTIEN_NGUON, isnull(B.DOUUTIEN,0) as DOUUTIEN, B.GIAHOTRO, C.CAPTREN_ID            from TM_DOITUONG_GIADICHVU A            left join TM_DOITUONG_LOAIGIA B on A.LOAIGIA_ID = B.LOAIGIA_ID and A.DOITUONG_ID = B.DOITUONG_ID and B.BENHVIEN_ID = 'HLU01'            inner join TM_LOAIGIA C on A.LOAIGIA_ID = C.LOAIGIA_ID and C.BENHVIEN_ID = 'HLU01'            where A.DOITUONG_ID = '4'                            and A.DICHVU_ID = '5492'                         and A.BENHVIEN_ID = 'HLU01'                     ) a          where a.DOUUTIEN != 0 and a.DOUUTIEN is not null          group by a.LOAIGIA_ID, a.TENLOAIGIA, a.MALOAIGIA, a.CAPTREN_ID          order by MAX(a.UUTIEN_NGUON) desc ,MAX(a.DOUUTIEN) asc]
2020-01-02 17:32:11,589 [1] DEBUG - Statement Id: [DAO00017_GetListPhongKham] PreparedStatement : [select pb.PHONGBAN_ID, pb.TENPHONGBAN, case when dv.ATTRIBUTE5 is null then 'TT' else 'KTC' end as LOAI_CHIPHI              from [TM_PHONGBAN_DICHVU] as pb_dv              inner join [TM_PHONGBAN] as pb on pb.PHONGBAN_ID = pb_dv.PHONGBAN_ID and pb.BENHVIEN_ID = 'HLU01'              inner join [TM_DICHVU] dv on dv.DICHVU_ID = pb_dv.DICHVU_ID and dv.MADICHVU = '5492' and dv.BENHVIEN_ID = 'HLU01'              where pb_dv.BENHVIEN_ID = 'HLU01']
2020-01-02 17:32:11,643 [1] DEBUG - Statement Id: [DAO00019_GetListPhongKham_REG13] PreparedStatement : [select pb.PHONGBAN_ID, pb.TENPHONGBAN, case when dv.ATTRIBUTE5 is null then 'TT' else 'KTC' end as LOAI_CHIPHI        from TM_PHONGBAN pb        left join TM_PHONGBAN_DICHVU pb_dv on pb_dv.PHONGBAN_ID = pb.PHONGBAN_ID and pb_dv.BENHVIEN_ID = pb.BENHVIEN_ID        left join TM_DICHVU dv on dv.DICHVU_ID = pb_dv.DICHVU_ID and dv.BENHVIEN_ID = pb_dv.BENHVIEN_ID        left join TM_NHOMDICHVU ndv on ndv.NHOMDICHVU_ID = dv.NHOMDICHVU_ID and ndv.BENHVIEN_ID = dv.BENHVIEN_ID        where pb.BENHVIEN_ID = 'HLU01' and ndv.MANHOMDICHVU = '04' and dv.DICHVU_ID IS NOT NULL]
2020-01-02 17:32:11,729 [1] DEBUG - Statement Id: [DAO00019_LayThongTinSoluongDichVuPhongKham_REG13] PreparedStatement : [select PHONGBAN_ID, TENPHONGBAN, NOITHUCHIEN_ID, SUM(CHUAKETQUA) AS CHUAKETQUA, SUM(HOANTAT) AS HOANTAT, SUM(DANGTHUCHIEN) AS DANGTHUCHIEN        from (        select B.PHONGBAN_ID, B.TENPHONGBAN, A.NOITHUCHIEN_ID,        case when A.TRANGTHAI = 'CHUAKETQUA' then 1 else 0 end AS CHUAKETQUA,        case when A.TRANGTHAI = 'HOANTAT' then 1 else 0 end AS HOANTAT,        case when A.TRANGTHAI = 'DANGTHUCHIEN' then 1 else 0 end AS DANGTHUCHIEN        from TM_PHONGBAN B        left join TT_DVYEUCAU A on A.NOITHUCHIEN_ID = B.PHONGBAN_ID and A.BENHVIEN_ID = B.BENHVIEN_ID and A.NGAYYEUCAU = CONVERT(date, getdate())        left join TM_DICHVU dv on A.DICHVU_ID = dv.DICHVU_ID        left join TM_NHOMDICHVU ndv on ndv.NHOMDICHVU_ID = dv.NHOMDICHVU_ID        where B.BENHVIEN_ID ='HLU01' and Left(ndv.MANHOMDICHVU,2) = '04'        and B.PHONGBAN_ID in (65,71,72,41,68,62,177,67,55,81,57,57,58,59,60,63,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,61,69,69,70,70)        ) tmp        group by tmp.NOITHUCHIEN_ID, tmp.TENPHONGBAN, tmp.PHONGBAN_ID]
2020-01-02 17:32:11,891 [1] DEBUG - Statement Id: [DAO00000_GetDICHVU_DONGIA_LOAIGIA] PreparedStatement : [select A.LOAIGIA_ID, A.BANGGIA_ID, A.GIAVON, A.TYLEVAT  as TYLE_VAT, A.TYLE_LOINHUAN,            A.DONGIA as DONGIA_DOANHTHU, NULL as DONGIA_KHAC, isnull(D.MAPHANNHOMDICHVU, 'TT') as LOAI_CHIPHI            from TM_DICHVU_DONGIA A            inner join TM_BANGGIA B on B.LOAIGIA_ID = A.LOAIGIA_ID AND B.BENHVIEN_ID = 'HLU01'            left join (select B.MAPHANNHOMDICHVU, A.* from TM_DICHVU_PHANNHOMDICHVU A            inner join TM_PHANNHOMDICHVU B on  B.PHANNHOMDICHVU_ID = A.PHANNHOMDICHVU_ID            where A.DICHVU_ID = '5492' AND A.BENHVIEN_ID = 'HLU01') D on A.DICHVU_ID = D.DICHVU_ID            where A.LOAIGIA_ID = '2' and A.DICHVU_ID = '5492'            union            select A.LOAIGIA_ID, null as BANGGIA_ID, null as GIAVON, null as TYLE_VAT, null as TYLE_LOINHUAN,            null as DONGIA_DOANHTHU, C.DONGIA as DONGIA_KHAC, isnull(D.MAPHANNHOMDICHVU, 'TT') as LOAI_CHIPHI            from TM_DOITUONG_GIADICHVU A            inner join TM_BANGGIA B on B.LOAIGIA_ID = A.LOAIGIA_ID AND B.BENHVIEN_ID = 'HLU01'            left join TM_DICHVU_DONGIA C on C.LOAIGIA_ID = A.LOAIGIA_ID AND C.BENHVIEN_ID = 'HLU01'            and C.BANGGIA_ID = B.BANGGIA_ID and C.DICHVU_ID = A.DICHVU_ID            left join (select B.MAPHANNHOMDICHVU, A.* from TM_DICHVU_PHANNHOMDICHVU A            inner join TM_PHANNHOMDICHVU B on  B.PHANNHOMDICHVU_ID = A.PHANNHOMDICHVU_ID            where A.DICHVU_ID = '5492' AND A.BENHVIEN_ID = 'HLU01') D on A.DICHVU_ID = D.DICHVU_ID            where A.DOITUONG_ID = '4'  and A.DICHVU_ID = '5492' and A.LOAIGIA_ID            in (select top 1 LOAIGIA_ID from TM_DOITUONG_LOAIGIA            where DOITUONG_ID = '4' and GIAHOTRO = '1'  AND BENHVIEN_ID = 'HLU01'            and LOAIGIA_ID            in (select LOAIGIA_ID from TM_BANGGIA            where LOAIBANGGIA in            (select LOAIBANGGIA from TM_BANGGIA where LOAIGIA_ID = '2'  AND BENHVIEN_ID = 'HLU01')            and TAMNGUNG = '0')  AND BENHVIEN_ID = 'HLU01'            )]
2020-01-02 17:32:11,936 [1] DEBUG - Statement Id: [DAO00024_TM_TIEPNHAN_BANGGIA_DICHVU_getlist] PreparedStatement : [select * from TM_TIEPNHAN_BANGGIA_DICHVU where TAMNGUNG != '1' and BENHVIEN_ID = 'HLU01']
2020-01-02 17:32:13,020 [1] DEBUG - Statement Id: [DAO00000_GetKyHieuBHYT] PreparedStatement : [select * from TM_DOITUONG where NHOMTHE LIKE '%' +  @param0  + '%']
2020-01-02 17:32:13,021 [1] DEBUG - Statement Id: [DAO00000_GetKyHieuBHYT] Parameters: [@param0=[MATHEBHYT,DN4]]
2020-01-02 17:32:13,021 [1] DEBUG - Statement Id: [DAO00000_GetKyHieuBHYT] Types: [@param0=[String, System.String]]
2020-01-02 17:32:14,822 [1] DEBUG - Statement Id: [DAO00013_Add_BenhNhan] PreparedStatement : [declare @keyValue int, @BenhVienId varchar(10), @yearNow int, @Mayte varchar(20), @SoVaoVien varchar(20), @fid varchar(20),        @Bnid int, @Manoisinh varchar(10), @Namsinh int, @Ngaysinh smalldatetime, @Gioitinh int, @Thangsinh int, @Daysinh int, @beginpatient int        declare @InsertedRows TABLE (BENHNHAN_ID INT, MAYTE varchar(20), MANOISINH varchar(10), NAMSINH int, NGAYSINH smalldatetime, GIOITINH int )        set @keyValue = 0;        set @Thangsinh = 0;        set @Daysinh = 0;        set @beginpatient = 0;        set @fid = 'F';        set @BenhVienId = 'HLU01'        set @yearNow = YEAR(getdate())                select @beginpatient = isnull(VALUE, 0) from TM_SYS_APPSETTINGS where CODE = 'COM_FIRST_NUMBER_PATIENTCODE_INTHEYEAR'          select @keyValue = KEYVALUE from LST_KEYDATA        where KEYTYPE = 'MAYTE' and KEYYEAR = @yearNow                if @keyValue = 0        Insert into LST_KEYDATA values ('MAYTE', @yearNow, '0', '0', '0', '0', '0', @beginpatient, @BenhVienId);        Update LST_KEYDATA set KEYVALUE = KEYVALUE + 1, @keyValue = (KEYVALUE + 1) where KEYTYPE = 'MAYTE' and KEYYEAR = @yearNow                set @SoVaoVien = right('0000000'+convert(varchar(7), @keyValue), 7)        set @Mayte = RIGHT(@yearNow, 2) + @SoVaoVien                insert into TT_BENHNHAN (        MAYTE        , SOVAOVIEN        , TENBENHNHAN        , HO        , TEN        , GIOITINH        , NGAYSINH        , NAMSINH        , MANOISINH        , SONHA        , DIACHI        , SODIENTHOAI        , XAPHUONG_ID        , QUANHUYEN_ID        , TINHTHANH_ID        , DANTOC_ID        , QUOCTICH_ID        , SOLUUTRUNOITRU        , SOLUUTRUNGOAITRU        , NGHENGHIEP_ID        , CMND        , HOCHIEU        , VIETKIEU        , NGUOINUOCNGOAI        , DIACHITHUONGTRU        , DIACHILIENLAC        , DIACHICOQUAN        , EMAIL        , NHOMMAU_ID        , YEUTORH_ID        , TIENSUDIUNG        , TIENSUBENH        , TIENSUHUTTHUOCLA        , TUVONG        , NGAYTUVONG        , THOIGIANTUVONG        , NGUYENNHANTUVONG_ID        , NGUOIGHINHANTUVONG_ID        , THOIGIANGHINHANTUVONG        , NHANVIEN_ID        , DONVICONGTAC_ID        , DIENTHOAIBAN        , TINHTRANGHONNHAN_ID        , NGUOILIENHE_ID        , MOIQUANHE_ID        , NGUOILIENHE        , THONGTIN_NLH        , GHICHU        , HINHANH_DAIDIEN        , SITE_ID        , PID        , ACTIVE        , BENHVIEN_ID        , NGAYTAO        , NGUOITAO_ID        , NGAYGIOSINH        )                values (        @Mayte        , @SoVaoVien        ,  @param0         ,  @param1         ,  @param2         ,  @param3         ,  @param4         ,  @param5         ,  @param6         ,  @param7         ,  @param8         ,  @param9         ,  @param10         ,  @param11         ,  @param12         ,  @param13         ,  @param14         ,  @param15         ,  @param16         ,  @param17         ,  @param18         ,  @param19         ,  @param20         ,  @param21         ,  @param22         ,  @param23         ,  @param24         ,  @param25         ,  @param26         ,  @param27         ,  @param28         ,  @param29         ,  @param30         ,  @param31         ,  @param32         ,  @param33         ,  @param34         ,  @param35         ,  @param36         ,  @param37         ,  @param38         ,  @param39         ,  @param40         ,  @param41         ,  @param42         ,  @param43         ,  @param44         ,  @param45         ,  @param46         ,  @param47         ,  @param48         , '1'        ,  @param49         ,  @param50         ,  @param51         ,  @param52         );        set @Bnid = SCOPE_IDENTITY()                select @Manoisinh = MANOISINH, @Namsinh = NAMSINH, @Ngaysinh = NGAYSINH, @Gioitinh = GIOITINH from @InsertedRows;        IF (@Ngaysinh is not Null)        BEGIN        set @Thangsinh = MONTH(@Ngaysinh);        set @Daysinh = DAY(@Ngaysinh);        END        IF (@Manoisinh is Null) set @Manoisinh = '0'        set @fid = right('000'+convert(varchar(3), @Manoisinh), 3) + convert(varchar(1), @Gioitinh) + RIGHT(@Namsinh, 2) + right('00'+convert(varchar(2), @Thangsinh), 2) + right('00'+convert(varchar(2), @Daysinh), 2) + right('000000000'+convert(varchar(9), @Bnid), 9) + convert(varchar(1), 'F');                update TT_BENHNHAN set FID = @fid where BENHNHAN_ID = @Bnid;                select @Bnid]
2020-01-02 17:32:14,822 [1] DEBUG - Statement Id: [DAO00013_Add_BenhNhan] Parameters: [@param0=[TENBENHNHAN,Test 2], @param1=[HO,Test], @param2=[TEN,2], @param3=[GIOITINH,1], @param4=[NGAYSINH,5/5/1998 12:00:00 AM], @param5=[NAMSINH,1998], @param6=[MANOISINH,null], @param7=[SONHA,null], @param8=[DIACHI,null], @param9=[SODIENTHOAI,null], @param10=[XAPHUONG_ID,14797], @param11=[QUANHUYEN_ID,null], @param12=[TINHTHANH_ID,null], @param13=[DANTOC_ID,332], @param14=[QUOCTICH_ID,291], @param15=[SOLUUTRUNOITRU,null], @param16=[SOLUUTRUNGOAITRU,null], @param17=[NGHENGHIEP_ID,null], @param18=[CMND,null], @param19=[HOCHIEU,null], @param20=[VIETKIEU,null], @param21=[NGUOINUOCNGOAI,null], @param22=[DIACHITHUONGTRU,Phường Đông Hải, Thành phố Thanh Hóa, Tỉnh Thanh Hóa], @param23=[DIACHILIENLAC,Phường Đông Hải, Thành phố Thanh Hóa, Tỉnh Thanh Hóa], @param24=[DIACHICOQUAN,null], @param25=[EMAIL,null], @param26=[NHOMMAU_ID,null], @param27=[YEUTORH_ID,null], @param28=[TIENSUDIUNG,null], @param29=[TIENSUBENH,null], @param30=[TIENSUHUTTHUOCLA,null], @param31=[TUVONG,null], @param32=[NGAYTUVONG,null], @param33=[THOIGIANTUVONG,null], @param34=[NGUYENNHANTUVONG_ID,null], @param35=[NGUOIGHINHANTUVONG_ID,null], @param36=[THOIGIANGHINHANTUVONG,null], @param37=[NHANVIEN_ID,null], @param38=[DONVICONGTAC_ID,null], @param39=[DIENTHOAIBAN,null], @param40=[TINHTRANGHONNHAN_ID,null], @param41=[NGUOILIENHE_ID,null], @param42=[MOIQUANHE_ID,null], @param43=[NGUOILIENHE,null], @param44=[THONGTIN_NLH,null], @param45=[GHICHU,null], @param46=[HINHANH_DAIDIEN,imgMale.png], @param47=[SITE_ID,HLU01], @param48=[PID,null], @param49=[BENHVIEN_ID,HLU01], @param50=[NGAYTAO,1/2/2020 5:32:14 PM], @param51=[NGUOITAO_ID,1], @param52=[NGAYGIOSINH,null]]
2020-01-02 17:32:14,822 [1] DEBUG - Statement Id: [DAO00013_Add_BenhNhan] Types: [@param0=[String, System.String], @param1=[String, System.String], @param2=[String, System.String], @param3=[Int64, System.Int64], @param4=[DateTime, System.DateTime], @param5=[Int64, System.Int64], @param6=[System.DBNull, null], @param7=[System.DBNull, null], @param8=[System.DBNull, null], @param9=[System.DBNull, null], @param10=[String, System.String], @param11=[System.DBNull, null], @param12=[System.DBNull, null], @param13=[Int64, System.Int64], @param14=[Int64, System.Int64], @param15=[System.DBNull, null], @param16=[System.DBNull, null], @param17=[System.DBNull, null], @param18=[System.DBNull, null], @param19=[System.DBNull, null], @param20=[System.DBNull, null], @param21=[System.DBNull, null], @param22=[String, System.String], @param23=[String, System.String], @param24=[System.DBNull, null], @param25=[System.DBNull, null], @param26=[System.DBNull, null], @param27=[System.DBNull, null], @param28=[System.DBNull, null], @param29=[System.DBNull, null], @param30=[System.DBNull, null], @param31=[System.DBNull, null], @param32=[System.DBNull, null], @param33=[System.DBNull, null], @param34=[System.DBNull, null], @param35=[System.DBNull, null], @param36=[System.DBNull, null], @param37=[System.DBNull, null], @param38=[System.DBNull, null], @param39=[System.DBNull, null], @param40=[System.DBNull, null], @param41=[System.DBNull, null], @param42=[System.DBNull, null], @param43=[System.DBNull, null], @param44=[System.DBNull, null], @param45=[System.DBNull, null], @param46=[String, System.String], @param47=[String, System.String], @param48=[System.DBNull, null], @param49=[String, System.String], @param50=[DateTime, System.DateTime], @param51=[String, System.String], @param52=[System.DBNull, null]]
2020-01-02 17:32:14,906 [1] DEBUG - Statement Id: [DAO00013_GetTTBenhNhan_byBenhNhanId] PreparedStatement : [select *        from TT_BENHNHAN        where BENHNHAN_ID = '24442'        order by BENHNHAN_ID]
2020-01-02 17:32:14,932 [1] DEBUG - Statement Id: [DAO00013_GetBenhNhanToDB] PreparedStatement : [select ROW_NUMBER() OVER(order by a.MAYTE) as ROWNUMBER, *,        CASE        WHEN A.GIOITINH = 1 THEN 'Nam'        WHEN A.GIOITINH = 2 THEN N'Nữ'        END as TENGIOITINH        from TT_BENHNHAN A        where  ACTIVE = '1' and MAYTE = '200000002']
2020-01-02 17:32:14,993 [1] DEBUG - Statement Id: [DAO00013_Add_Update_BHYT] PreparedStatement : [if not exists (select 1        from TT_BENHNHAN_BHYT        where SOTHE = 'DN466456425324438289' and BENHNHAN_ID = '24442')        insert into TT_BENHNHAN_BHYT (        BENHNHAN_ID        , LOAIBHYT        , SOTHE        , NGAYCAP        , NGAYHIEULUC        , NGAYHETHIEULUC        , TINHTHANH_CAPTHE_ID        , BENHVIEN_ID        , BENHVIEN_KCB_ID        , TREN3NAM        , TREN5NAM        , TREN6THANG        , NGAYMIENDONGCHITRA        , TAMNGUNG        , NGAYTAO        , NGUOITAO_ID        , KHUVUCSONG_ID        ) values (         @param0         ,  @param1         ,  @param2         ,  @param3         ,  @param4         ,  @param5         ,  @param6         ,  @param7         ,  @param8         ,  @param9         ,  @param10         ,  @param11         ,  @param12         ,  @param13         ,  @param14         ,  @param15         ,  @param16         )        else        update TT_BENHNHAN_BHYT set        LOAIBHYT =  @param1         , SOTHE =  @param2         , NGAYCAP =  @param3         , NGAYHIEULUC =  @param4         , NGAYHETHIEULUC =  @param5         , TINHTHANH_CAPTHE_ID =  @param6         , BENHVIEN_ID =  @param7         , BENHVIEN_KCB_ID =  @param8         , TREN3NAM =  @param9         , TREN5NAM =  @param10         , TREN6THANG =  @param11         , NGAYMIENDONGCHITRA =  @param12         , TAMNGUNG =  @param13         , NGAYCAPNHAT =  @param17         , NGUOICAPNHAT_ID =  @param18         , KHUVUCSONG_ID =  @param16         where        SOTHE = 'DN466456425324438289' and BENHNHAN_ID = '24442']
2020-01-02 17:32:14,994 [1] DEBUG - Statement Id: [DAO00013_Add_Update_BHYT] Parameters: [@param0=[BENHNHAN_ID,24442], @param1=[LOAIBHYT,null], @param2=[SOTHE,DN466456425324438289], @param3=[NGAYCAP,null], @param4=[NGAYHIEULUC,1/1/2020 12:00:00 AM], @param5=[NGAYHETHIEULUC,12/31/2020 12:00:00 AM], @param6=[TINHTHANH_CAPTHE_ID,null], @param7=[BENHVIEN_ID,HLU01], @param8=[BENHVIEN_KCB_ID,38289], @param9=[TREN3NAM,0], @param10=[TREN5NAM,0], @param11=[TREN6THANG,null], @param12=[NGAYMIENDONGCHITRA,null], @param13=[TAMNGUNG,null], @param14=[NGAYTAO,1/2/2020 5:32:14 PM], @param15=[NGUOITAO_ID,1], @param16=[KHUVUCSONG_ID,null], @param17=[NGAYCAPNHAT,1/2/2020 5:32:14 PM], @param18=[NGUOICAPNHAT_ID,1]]
2020-01-02 17:32:14,994 [1] DEBUG - Statement Id: [DAO00013_Add_Update_BHYT] Types: [@param0=[Int32, System.Int32], @param1=[System.DBNull, null], @param2=[String, System.String], @param3=[System.DBNull, null], @param4=[DateTime, System.DateTime], @param5=[DateTime, System.DateTime], @param6=[System.DBNull, null], @param7=[String, System.String], @param8=[String, System.String], @param9=[String, System.String], @param10=[String, System.String], @param11=[System.DBNull, null], @param12=[System.DBNull, null], @param13=[System.DBNull, null], @param14=[DateTime, System.DateTime], @param15=[String, System.String], @param16=[System.DBNull, null], @param17=[DateTime, System.DateTime], @param18=[String, System.String]]
2020-01-02 17:32:15,036 [1] DEBUG - Statement Id: [DAO00118_Add_BenhNhan] PreparedStatement : [if not exists (select 1 from TT_BENHNHAN where BENHNHAN_ID = '24442')              insert into TT_BENHNHAN (              BENHNHAN_ID              , MAYTE              , SOVAOVIEN              , TENBENHNHAN              , HO              , TEN              , GIOITINH              , NGAYSINH              , NAMSINH              , SONHA              , DIACHI              , SODIENTHOAI              , XAPHUONG_ID              , QUANHUYEN_ID              , TINHTHANH_ID              , DANTOC_ID              , QUOCTICH_ID              , SOLUUTRUNOITRU              , SOLUUTRUNGOAITRU              , NGHENGHIEP_ID              , CMND              , HOCHIEU              , VIETKIEU              , NGUOINUOCNGOAI              , DIACHITHUONGTRU              , DIACHILIENLAC              , DIACHICOQUAN              , EMAIL              , NHOMMAU_ID              , YEUTORH_ID              , TIENSUDIUNG              , TIENSUBENH              , TIENSUHUTTHUOCLA              , TUVONG              , NGAYTUVONG              , THOIGIANTUVONG              , NGUYENNHANTUVONG_ID              , NGUOIGHINHANTUVONG_ID              , THOIGIANGHINHANTUVONG              , NHANVIEN_ID              , DONVICONGTAC_ID              , DIENTHOAIBAN              , TINHTRANGHONNHAN_ID              , NGUOILIENHE_ID              , MOIQUANHE_ID              , NGUOILIENHE              , THONGTIN_NLH              , GHICHU              , HINHANH_DAIDIEN              , BENHVIEN_ID              , NGAYTAO              , NGUOITAO_ID              , NGAYGIOSINH              ) values (               @param0               ,  @param1               ,  @param2               ,  @param3               ,  @param4               ,  @param5               ,  @param6               ,  @param7               ,  @param8               ,  @param9               ,  @param10               ,  @param11               ,  @param12               ,  @param13               ,  @param14               ,  @param15               ,  @param16               ,  @param17               ,  @param18               ,  @param19               ,  @param20               ,  @param21               ,  @param22               ,  @param23               ,  @param24               ,  @param25               ,  @param26               ,  @param27               ,  @param28               ,  @param29               ,  @param30               ,  @param31               ,  @param32               ,  @param33               ,  @param34               ,  @param35               ,  @param36               ,  @param37               ,  @param38               ,  @param39               ,  @param40               ,  @param41               ,  @param42               ,  @param43               ,  @param44               ,  @param45               ,  @param46               ,  @param47               ,  @param48               ,  @param49               ,  @param50               ,  @param51               ,  @param52               )              else              update TT_BENHNHAN set              MAYTE =  @param1                ,                   SOVAOVIEN =  @param2                ,                   TENBENHNHAN =  @param3                ,                   HO =  @param4                ,                   TEN =  @param5                ,                   GIOITINH =  @param6                ,                   NGAYSINH =  @param7                ,                   NAMSINH =  @param8                ,                   SONHA =  @param9                ,                   SODIENTHOAI =  @param11                ,                   XAPHUONG_ID =  @param12                ,                   DANTOC_ID =  @param15                ,                   QUOCTICH_ID =  @param16                ,                   NGHENGHIEP_ID =  @param19                ,                   NGUOINUOCNGOAI =  @param23                ,                   DIACHITHUONGTRU =  @param24                ,                   DIACHILIENLAC =  @param25                ,                   NGUOILIENHE_ID =  @param43                ,                   MOIQUANHE_ID =  @param44                ,                   NGUOILIENHE =  @param45                ,                   THONGTIN_NLH =  @param46                ,                   GHICHU =  @param47                ,                   BENHVIEN_ID =  @param49                ,                   NGUOICAPNHAT_ID =  @param53                              where              BENHNHAN_ID = '24442']
2020-01-02 17:32:15,036 [1] DEBUG - Statement Id: [DAO00118_Add_BenhNhan] Parameters: [@param0=[BENHNHAN_ID,24442], @param1=[MAYTE,200000002], @param2=[SOVAOVIEN,0000002], @param3=[TENBENHNHAN,Test 2], @param4=[HO,Test], @param5=[TEN,2], @param6=[GIOITINH,1], @param7=[NGAYSINH,5/5/1998 12:00:00 AM], @param8=[NAMSINH,1998], @param9=[SONHA,null], @param10=[DIACHI,null], @param11=[SODIENTHOAI,null], @param12=[XAPHUONG_ID,14797], @param13=[QUANHUYEN_ID,null], @param14=[TINHTHANH_ID,null], @param15=[DANTOC_ID,332], @param16=[QUOCTICH_ID,291], @param17=[SOLUUTRUNOITRU,null], @param18=[SOLUUTRUNGOAITRU,null], @param19=[NGHENGHIEP_ID,null], @param20=[CMND,null], @param21=[HOCHIEU,null], @param22=[VIETKIEU,null], @param23=[NGUOINUOCNGOAI,null], @param24=[DIACHITHUONGTRU,Phường Đông Hải, Thành phố Thanh Hóa, Tỉnh Thanh Hóa], @param25=[DIACHILIENLAC,Phường Đông Hải, Thành phố Thanh Hóa, Tỉnh Thanh Hóa], @param26=[DIACHICOQUAN,null], @param27=[EMAIL,null], @param28=[NHOMMAU_ID,null], @param29=[YEUTORH_ID,null], @param30=[TIENSUDIUNG,null], @param31=[TIENSUBENH,null], @param32=[TIENSUHUTTHUOCLA,null], @param33=[TUVONG,null], @param34=[NGAYTUVONG,null], @param35=[THOIGIANTUVONG,null], @param36=[NGUYENNHANTUVONG_ID,null], @param37=[NGUOIGHINHANTUVONG_ID,null], @param38=[THOIGIANGHINHANTUVONG,null], @param39=[NHANVIEN_ID,null], @param40=[DONVICONGTAC_ID,null], @param41=[DIENTHOAIBAN,null], @param42=[TINHTRANGHONNHAN_ID,null], @param43=[NGUOILIENHE_ID,null], @param44=[MOIQUANHE_ID,null], @param45=[NGUOILIENHE,null], @param46=[THONGTIN_NLH,null], @param47=[GHICHU,null], @param48=[HINHANH_DAIDIEN,imgMale.png], @param49=[BENHVIEN_ID,HLU01], @param50=[NGAYTAO,null], @param51=[NGUOITAO_ID,1], @param52=[NGAYGIOSINH,null], @param53=[NGUOICAPNHAT_ID,1]]
2020-01-02 17:32:15,036 [1] DEBUG - Statement Id: [DAO00118_Add_BenhNhan] Types: [@param0=[Int32, System.Int32], @param1=[String, System.String], @param2=[String, System.String], @param3=[String, System.String], @param4=[String, System.String], @param5=[String, System.String], @param6=[Int64, System.Int64], @param7=[DateTime, System.DateTime], @param8=[Int64, System.Int64], @param9=[System.DBNull, null], @param10=[System.DBNull, null], @param11=[System.DBNull, null], @param12=[String, System.String], @param13=[System.DBNull, null], @param14=[System.DBNull, null], @param15=[Int64, System.Int64], @param16=[Int64, System.Int64], @param17=[System.DBNull, null], @param18=[System.DBNull, null], @param19=[System.DBNull, null], @param20=[System.DBNull, null], @param21=[System.DBNull, null], @param22=[System.DBNull, null], @param23=[System.DBNull, null], @param24=[String, System.String], @param25=[String, System.String], @param26=[System.DBNull, null], @param27=[System.DBNull, null], @param28=[System.DBNull, null], @param29=[System.DBNull, null], @param30=[System.DBNull, null], @param31=[System.DBNull, null], @param32=[System.DBNull, null], @param33=[System.DBNull, null], @param34=[System.DBNull, null], @param35=[System.DBNull, null], @param36=[System.DBNull, null], @param37=[System.DBNull, null], @param38=[System.DBNull, null], @param39=[System.DBNull, null], @param40=[System.DBNull, null], @param41=[System.DBNull, null], @param42=[System.DBNull, null], @param43=[System.DBNull, null], @param44=[System.DBNull, null], @param45=[System.DBNull, null], @param46=[System.DBNull, null], @param47=[System.DBNull, null], @param48=[String, System.String], @param49=[String, System.String], @param50=[System.DBNull, null], @param51=[String, System.String], @param52=[System.DBNull, null], @param53=[String, System.String]]
2020-01-02 17:32:15,083 [1] DEBUG - Statement Id: [DAO00118_Add_Update_BHYT] PreparedStatement : [if not exists (select 1              from TT_BENHNHAN_BHYT              where SOTHE = 'DN466456425324438289' and BENHNHAN_ID = '24442')              insert into TT_BENHNHAN_BHYT (              BENHNHAN_ID              , LOAIBHYT              , SOTHE              , NGAYCAP              , NGAYHIEULUC              , NGAYHETHIEULUC              , TINHTHANH_CAPTHE_ID              , BENHVIEN_ID              , BENHVIEN_KCB_ID              , TREN3NAM              , TREN5NAM              , TREN6THANG              , NGAYMIENDONGCHITRA              , TAMNGUNG              , NGAYTAO              , NGUOITAO_ID              , KHUVUCSONG_ID              ) values (               @param0               ,  @param1               ,  @param2               ,  @param3               ,  @param4               ,  @param5               ,  @param6               ,  @param7               ,  @param8               ,  @param9               ,  @param10               ,  @param11               ,  @param12               ,  @param13               ,  @param14               ,  @param15               ,  @param16               )              else              update TT_BENHNHAN_BHYT set              LOAIBHYT =  @param1               , SOTHE =  @param2               , NGAYCAP =  @param3               , NGAYHIEULUC =  @param4               , NGAYHETHIEULUC =  @param5               , TINHTHANH_CAPTHE_ID =  @param6               , BENHVIEN_ID =  @param7               , BENHVIEN_KCB_ID =  @param8               , TREN3NAM =  @param9               , TREN5NAM =  @param10               , TREN6THANG =  @param11               , NGAYMIENDONGCHITRA =  @param12               , TAMNGUNG =  @param13               , NGAYCAPNHAT =  @param17               , NGUOICAPNHAT_ID =  @param18               , KHUVUCSONG_ID =  @param16               where              SOTHE = 'DN466456425324438289' and BENHNHAN_ID = '24442']
2020-01-02 17:32:15,084 [1] DEBUG - Statement Id: [DAO00118_Add_Update_BHYT] Parameters: [@param0=[BENHNHAN_ID,24442], @param1=[LOAIBHYT,null], @param2=[SOTHE,DN466456425324438289], @param3=[NGAYCAP,null], @param4=[NGAYHIEULUC,1/1/2020 12:00:00 AM], @param5=[NGAYHETHIEULUC,12/31/2020 12:00:00 AM], @param6=[TINHTHANH_CAPTHE_ID,null], @param7=[BENHVIEN_ID,HLU01], @param8=[BENHVIEN_KCB_ID,38289], @param9=[TREN3NAM,False], @param10=[TREN5NAM,False], @param11=[TREN6THANG,null], @param12=[NGAYMIENDONGCHITRA,null], @param13=[TAMNGUNG,null], @param14=[NGAYTAO,1/2/2020 5:32:15 PM], @param15=[NGUOITAO_ID,1], @param16=[KHUVUCSONG_ID,null], @param17=[NGAYCAPNHAT,1/2/2020 5:32:15 PM], @param18=[NGUOICAPNHAT_ID,1]]
2020-01-02 17:32:15,084 [1] DEBUG - Statement Id: [DAO00118_Add_Update_BHYT] Types: [@param0=[Int32, System.Int32], @param1=[System.DBNull, null], @param2=[String, System.String], @param3=[System.DBNull, null], @param4=[DateTime, System.DateTime], @param5=[DateTime, System.DateTime], @param6=[System.DBNull, null], @param7=[String, System.String], @param8=[String, System.String], @param9=[Boolean, System.Boolean], @param10=[Boolean, System.Boolean], @param11=[System.DBNull, null], @param12=[System.DBNull, null], @param13=[System.DBNull, null], @param14=[DateTime, System.DateTime], @param15=[String, System.String], @param16=[System.DBNull, null], @param17=[DateTime, System.DateTime], @param18=[String, System.String]]
2020-01-02 17:32:15,136 [1] DEBUG - Statement Id: [DAO00013_Add_Update_BHYT] PreparedStatement : [if not exists (select 1        from TT_BENHNHAN_BHYT        where SOTHE = 'DN466456425324438289' and BENHNHAN_ID = '24442')        insert into TT_BENHNHAN_BHYT (        BENHNHAN_ID        , LOAIBHYT        , SOTHE        , NGAYCAP        , NGAYHIEULUC        , NGAYHETHIEULUC        , TINHTHANH_CAPTHE_ID        , BENHVIEN_ID        , BENHVIEN_KCB_ID        , TREN3NAM        , TREN5NAM        , TREN6THANG        , NGAYMIENDONGCHITRA        , TAMNGUNG        , NGAYTAO        , NGUOITAO_ID        , KHUVUCSONG_ID        ) values (         @param0         ,  @param1         ,  @param2         ,  @param3         ,  @param4         ,  @param5         ,  @param6         ,  @param7         ,  @param8         ,  @param9         ,  @param10         ,  @param11         ,  @param12         ,  @param13         ,  @param14         ,  @param15         ,  @param16         )        else        update TT_BENHNHAN_BHYT set        LOAIBHYT =  @param1         , SOTHE =  @param2         , NGAYCAP =  @param3         , NGAYHIEULUC =  @param4         , NGAYHETHIEULUC =  @param5         , TINHTHANH_CAPTHE_ID =  @param6         , BENHVIEN_ID =  @param7         , BENHVIEN_KCB_ID =  @param8         , TREN3NAM =  @param9         , TREN5NAM =  @param10         , TREN6THANG =  @param11         , NGAYMIENDONGCHITRA =  @param12         , TAMNGUNG =  @param13         , NGAYCAPNHAT =  @param17         , NGUOICAPNHAT_ID =  @param18         , KHUVUCSONG_ID =  @param16         where        SOTHE = 'DN466456425324438289' and BENHNHAN_ID = '24442']
2020-01-02 17:32:15,136 [1] DEBUG - Statement Id: [DAO00013_Add_Update_BHYT] Parameters: [@param0=[BENHNHAN_ID,24442], @param1=[LOAIBHYT,4], @param2=[SOTHE,DN466456425324438289], @param3=[NGAYCAP,null], @param4=[NGAYHIEULUC,1/1/2020 12:00:00 AM], @param5=[NGAYHETHIEULUC,12/31/2020 12:00:00 AM], @param6=[TINHTHANH_CAPTHE_ID,null], @param7=[BENHVIEN_ID,HLU01], @param8=[BENHVIEN_KCB_ID,38289], @param9=[TREN3NAM,0], @param10=[TREN5NAM,0], @param11=[TREN6THANG,null], @param12=[NGAYMIENDONGCHITRA,null], @param13=[TAMNGUNG,null], @param14=[NGAYTAO,1/2/2020 5:32:15 PM], @param15=[NGUOITAO_ID,1], @param16=[KHUVUCSONG_ID,null], @param17=[NGAYCAPNHAT,1/2/2020 5:32:15 PM], @param18=[NGUOICAPNHAT_ID,1]]
2020-01-02 17:32:15,136 [1] DEBUG - Statement Id: [DAO00013_Add_Update_BHYT] Types: [@param0=[Int32, System.Int32], @param1=[String, System.String], @param2=[String, System.String], @param3=[System.DBNull, null], @param4=[DateTime, System.DateTime], @param5=[DateTime, System.DateTime], @param6=[System.DBNull, null], @param7=[String, System.String], @param8=[String, System.String], @param9=[String, System.String], @param10=[String, System.String], @param11=[System.DBNull, null], @param12=[System.DBNull, null], @param13=[System.DBNull, null], @param14=[DateTime, System.DateTime], @param15=[String, System.String], @param16=[System.DBNull, null], @param17=[DateTime, System.DateTime], @param18=[String, System.String]]
2020-01-02 17:32:15,187 [1] DEBUG - Statement Id: [DAOWF001_Laythongtingateways] PreparedStatement : [select * from TM_PROCESS_GATEWAYS]
2020-01-02 17:32:15,212 [1] DEBUG - Statement Id: [DAO00019_Add] PreparedStatement : [declare        @keyValue int, @BenhVienId varchar(10),        @yearNow int, @monthNow varchar(2), @dayNow varchar(2),        @Sotiepnhan varchar(20), @SoThuTu varchar(20)        set @keyValue = 0;        set @BenhVienId = 'HLU01'        set @yearNow = YEAR(getdate())        set @monthNow = RIGHT('00' + convert(varchar(2), MONTH(getdate())),2)        set @dayNow = RIGHT('00' + convert(varchar(2), DAY(getdate())),2)        BEGIN        select @keyValue = KEYVALUE from LST_KEYDATA        where KEYTYPE = 'SOTIEPNHAN' and KEYYEAR = @yearNow and KEYMONTH = @monthNow and KEYDAY = @dayNow        and BENHVIEN_ID = @BenhVienId        if @keyValue = 0        Insert into LST_KEYDATA values ('SOTIEPNHAN', @yearNow, @monthNow, @dayNow, '0', '0', '0', 0, @BenhVienId);        Update LST_KEYDATA set KEYVALUE = (KEYVALUE + 1), @keyValue = (KEYVALUE + 1) where KEYTYPE = 'SOTIEPNHAN' and KEYYEAR = @yearNow and KEYMONTH = @monthNow and KEYDAY = @dayNow and BENHVIEN_ID = @BenhVienId        set @SoThuTu = right('0000000'+convert(varchar(7), @keyValue), 7)        set @Sotiepnhan = 'TN' + RIGHT(@yearNow, 2) + @monthNow  + @dayNow + '.' + @SoThuTu                   insert into TT_TIEPNHAN (        SOTIEPNHAN        , UUTIEN        , BENHNHAN_ID        , BENHVIEN_ID        , TUYENKHAMBENH_ID        , NOITIEPNHAN_ID        , NGAYTIEPNHAN        , THOIGIANTIEPNHAN        , NAMTIEPNHAN        , THANGTIEPNHAN        , DOITUONG_ID        , LYDOTIEPNHAN_ID        , HINHTHUCDENKHAM_ID        , TINHTRANGHEN        , XACNHANCHIPHI_ID        , THUTIENTRUOC        , TAIKHAM        , SOBHYT        , BHYTTUNGAY        , BHYTDENNGAY        , BHYTNGAYCAP        , BHYTTREN3NAM        , BHYTTREN5NAM        , NGAYMIENDONGCHITRA        , LOAIBHYT        , NGAYBHYT2        , SOCHUYENVIEN        , HINHTHUCCHUYENVIEN_ID        , NOIGIOITHIEU_ID        , NGUOIGIOITHIEU_ID        , THOIGIANCHUYENTUYEN        , LYDOCHUYENVIEN_ID        , ICDNOIGIOITHIEU_ID        , CHANDOANNGT        , TRAITUYEN        , DIACHILIENHE        , XAPHUONG_ID        , QUANHUYEN_ID        , TINHTHANH_ID        , PROCESS_ID        , TRANGTHAI        , KHUVUCSONG_ID        , THANHVIEN_ID        , THE_ID        , LOAITHANHVIEN_ID        , SUDUNG_BHTN        , VIP        , GHICHU_TIEPNHAN        , BAOLANH_VIENPHI        , CONGTY_CHITRA_ID        , NGUON_BENHNHAN_ID        , LOAITIEPNHAN_ID        , THONGTIN_KCB_BHYT        , NGAYTAO        , NGUOITAO_ID        , LYDODENKHAM         ,           NGUOINUOCNGOAI         ,           ISTHONGTUYEN                 )        OUTPUT INSERTED.TIEPNHAN_ID, INSERTED.SOTIEPNHAN        values (        @Sotiepnhan        ,  @param0         ,  @param1         ,  @param2         ,  @param3         ,  @param4         ,  @param5         ,  @param6         ,  @param7         ,  @param8         ,  @param9         ,  @param10         ,  @param11         ,  @param12         ,  @param13         ,  @param14         ,  @param15         ,  @param16         ,  @param17         ,  @param18         ,  @param19         ,  @param20         ,  @param21         ,  @param22         ,  @param23         ,  @param24         ,  @param25         ,  @param26         ,  @param27         ,  @param28         ,  @param29         ,  @param30         ,  @param31         ,  @param32         ,  @param33         ,  @param34         ,  @param35         ,  @param36         ,  @param37         ,  @param38         ,  @param39         ,  @param40         ,  @param41         ,  @param42         ,  @param43         ,  @param44         ,  @param45         ,  @param46         ,  @param47         ,  @param48         ,  @param49         ,  @param50         ,  @param51         ,  @param52         ,  @param53         ,  @param54          ,            @param55          ,            @param56                  )        end]
2020-01-02 17:32:15,212 [1] DEBUG - Statement Id: [DAO00019_Add] Parameters: [@param0=[UUTIEN,0], @param1=[BENHNHAN_ID,24442], @param2=[BENHVIEN_ID,HLU01], @param3=[TUYENKHAMBENH_ID,null], @param4=[NOITIEPNHAN_ID,62], @param5=[NGAYTIEPNHAN,1/2/2020 12:00:00 AM], @param6=[THOIGIANTIEPNHAN,1/2/2020 5:31:36 PM], @param7=[NAMTIEPNHAN,2020], @param8=[THANGTIEPNHAN,1], @param9=[DOITUONG_ID,4], @param10=[LYDOTIEPNHAN_ID,null], @param11=[HINHTHUCDENKHAM_ID,461], @param12=[TINHTRANGHEN,null], @param13=[XACNHANCHIPHI_ID,null], @param14=[THUTIENTRUOC,null], @param15=[TAIKHAM,0], @param16=[SOBHYT,DN466456425324438289], @param17=[BHYTTUNGAY,1/1/2020 12:00:00 AM], @param18=[BHYTDENNGAY,12/31/2020 12:00:00 AM], @param19=[BHYTNGAYCAP,null], @param20=[BHYTTREN3NAM,0], @param21=[BHYTTREN5NAM,0], @param22=[NGAYMIENDONGCHITRA,null], @param23=[LOAIBHYT,null], @param24=[NGAYBHYT2,null], @param25=[SOCHUYENVIEN,null], @param26=[HINHTHUCCHUYENVIEN_ID,null], @param27=[NOIGIOITHIEU_ID,null], @param28=[NGUOIGIOITHIEU_ID,null], @param29=[THOIGIANCHUYENTUYEN,null], @param30=[LYDOCHUYENVIEN_ID,null], @param31=[ICDNOIGIOITHIEU_ID,null], @param32=[CHANDOANNGT,null], @param33=[TRAITUYEN,0], @param34=[DIACHILIENHE,null], @param35=[XAPHUONG_ID,14797], @param36=[QUANHUYEN_ID,null], @param37=[TINHTHANH_ID,null], @param38=[PROCESS_ID,P02], @param39=[TRANGTHAI,DATIEPNHAN], @param40=[KHUVUCSONG_ID,null], @param41=[THANHVIEN_ID,null], @param42=[THE_ID,null], @param43=[LOAITHANHVIEN_ID,null], @param44=[SUDUNG_BHTN,0], @param45=[VIP,0], @param46=[GHICHU_TIEPNHAN,null], @param47=[BAOLANH_VIENPHI,0], @param48=[CONGTY_CHITRA_ID,null], @param49=[NGUON_BENHNHAN_ID,null], @param50=[LOAITIEPNHAN_ID,8351], @param51=[THONGTIN_KCB_BHYT,null], @param52=[NGAYTAO,1/2/2020 5:32:15 PM], @param53=[NGUOITAO_ID,1], @param54=[LYDODENKHAM,null], @param55=[NGUOINUOCNGOAI,null], @param56=[ISTHONGTUYEN,0]]
2020-01-02 17:32:15,212 [1] DEBUG - Statement Id: [DAO00019_Add] Types: [@param0=[Int32, System.Int32], @param1=[Int32, System.Int32], @param2=[String, System.String], @param3=[System.DBNull, null], @param4=[String, System.String], @param5=[DateTime, System.DateTime], @param6=[DateTime, System.DateTime], @param7=[Int32, System.Int32], @param8=[Int32, System.Int32], @param9=[Int64, System.Int64], @param10=[System.DBNull, null], @param11=[Int64, System.Int64], @param12=[System.DBNull, null], @param13=[System.DBNull, null], @param14=[System.DBNull, null], @param15=[Int32, System.Int32], @param16=[String, System.String], @param17=[DateTime, System.DateTime], @param18=[DateTime, System.DateTime], @param19=[System.DBNull, null], @param20=[String, System.String], @param21=[String, System.String], @param22=[System.DBNull, null], @param23=[System.DBNull, null], @param24=[System.DBNull, null], @param25=[System.DBNull, null], @param26=[System.DBNull, null], @param27=[System.DBNull, null], @param28=[System.DBNull, null], @param29=[System.DBNull, null], @param30=[System.DBNull, null], @param31=[System.DBNull, null], @param32=[System.DBNull, null], @param33=[String, System.String], @param34=[System.DBNull, null], @param35=[String, System.String], @param36=[System.DBNull, null], @param37=[System.DBNull, null], @param38=[String, System.String], @param39=[String, System.String], @param40=[System.DBNull, null], @param41=[System.DBNull, null], @param42=[System.DBNull, null], @param43=[System.DBNull, null], @param44=[String, System.String], @param45=[String, System.String], @param46=[System.DBNull, null], @param47=[String, System.String], @param48=[System.DBNull, null], @param49=[System.DBNull, null], @param50=[Int64, System.Int64], @param51=[System.DBNull, null], @param52=[DateTime, System.DateTime], @param53=[String, System.String], @param54=[System.DBNull, null], @param55=[System.DBNull, null], @param56=[String, System.String]]
2020-01-02 17:32:15,238 [1] DEBUG - Statement Id: [DAO00019_GetTTTiepNhan_byTiepNhanId] PreparedStatement : [select *        from TT_TIEPNHAN        where TIEPNHAN_ID = '28494'        order by TIEPNHAN_ID]
2020-01-02 17:32:15,264 [1] DEBUG - Statement Id: [DAO00080_Add_KhamBenh_CapCuu] PreparedStatement : [insert into TT_KHAMBENH_VAOVIEN (        SOPHIEU        , TIEPNHAN_ID        , KHAMBENH_ID        , BENHNHAN_ID        , NGUOILIENHE        , DIENTHOAILIENHE        , NOILAMVIEC        , CHANDOANNOIGIOITHIEU        , NGAYKHAM        , THOIGIANKHAM        , LYDOVAOVIEN        , QUATRINHBENHLY        , TIENSUBANTHAN        , TIENSUGIADINH        , KHAMXETTOANTHAN        , KHAMXETCACBOPHAN        , KHAMXETKQLS        , CHANDOANVAO        , ICDKHAMXET_ID        , DAXULY        , NGAYRA        , THOIGIANRA        , NHAPKHOA_ID        , CHUYENVIEN_ID        , CHUY        , MACH        , NHIETDO        , HUYETAPCAO        , HUYETAPTHAP        , NHIPTHO        , CANNANG        , CHIEUCAO        , BACSI_ID        , XUTRUKHAMBENH_ID        , CAPCUU        , NGAYTAINAN        , THOIGIANTAINAN        , NOITAINAN_TINHTHANH_ID        , NOITAINAN_QUANHUYEN_ID        , NOITAINAN_PHUONGXA_ID        , NOITAINAN_DIACHI        , DIADIEMTAINAN_ID        , BOPHANBITHUONG_ID        , MUCDO_ID        , DIENBIENSAUTN_ID        , XUTRISAUTN_ID        , NGUYENNHAN_ID        , NGUYENNHANCHITIET_ID        , ICD_NGUYENNHAN        , NGAYTAO        , NGUOITAO_ID        , NGAYCAPNHAT        , NGUOICAPNHAT_ID        , BENHANCHUYENKHOA        , CHANDOANVAOVIEN        , CHANDOANRAVIEN        , DIEUTRITUNGAY        , DIEUTRIDENNGAY        , DIENBIENLS        , KQXETNGHIEM        , PHAUTHUAT        , THUTHUAT        , TINHTRANGNGUOIBENH        , HUONGDIEUTRI        , NGUOIGIAO_ID        , NGUOINHAN_ID        , XQUANG        , CTSCANNER        , SIEUAM        , XETNGHIEM        , KHAC        , TOANBOHS        , LOAICHUYENKHOA        , CONGANCANTHIEP        , CDRR_BENHCHINH        , CDRR_BENHKEM        , ICD_BENHCHINH        , ICD_BENHKEMTHEO        , PHUONGPHAPDIEUTRI        , FIELD_1        , FIELD_2        , FIELD_3        , FIELD_4        , FIELD_5        , FIELD_6        , FIELD_7        , FIELD_8        , FIELD_9        , FIELD_10        , FIELD_11        , FIELD_12        , FIELD_13        , FIELD_14        , FIELD_15        , FIELD_27        , FIELD_28        , FIELD_29        , FIELD_30        , FIELD_31        , FIELD_32        , FIELD_33        , FIELD_34        , FIELD_35        , FIELD_36        , FIELD_37        , FIELD_38        , FIELD_39        , FIELD_40        , FIELD_41        , FIELD_42        , FIELD_43        , FIELD_44        , FIELD_45        , FIELD_46        , FIELD_47        , FIELD_48        , FIELD_49        , FIELD_50        , FIELD_51        , FIELD_52        , FIELD_53        , FIELD_54        , FIELD_55        , FIELD_56        , BENHVIEN_ID        ) values (         @param0         ,  @param1         ,  @param2         ,  @param3         ,  @param4         ,  @param5         ,  @param6         ,  @param7         ,  @param8         ,  @param9         ,  @param10         ,  @param11         ,  @param12         ,  @param13         ,  @param14         ,  @param15         ,  @param16         ,  @param17         ,  @param18         ,  @param19         ,  @param20         ,  @param21         ,  @param22         ,  @param23         ,  @param24         ,  @param25         ,  @param26         ,  @param27         ,  @param28         ,  @param29         ,  @param30         ,  @param31         ,  @param32         ,  @param33         ,  @param34         ,  @param35         ,  @param36         ,  @param37         ,  @param38         ,  @param39         ,  @param40         ,  @param41         ,  @param42         ,  @param43         ,  @param44         ,  @param45         ,  @param46         ,  @param47         ,  @param48         ,  @param49         ,  @param50         ,  @param51         ,  @param52         ,  @param53         ,  @param54         ,  @param55         ,  @param56         ,  @param57         ,  @param58         ,  @param59         ,  @param60         ,  @param61         ,  @param62         ,  @param63         ,  @param64         ,  @param65         ,  @param66         ,  @param67         ,  @param68         ,  @param69         ,  @param70         ,  @param71         ,  @param72         ,  @param73         ,  @param74         ,  @param75         ,  @param76         ,  @param77         ,  @param78         ,  @param79         ,  @param80         ,  @param81         ,  @param82         ,  @param83         ,  @param84         ,  @param85         ,  @param86         ,  @param87         ,  @param88         ,  @param89         ,  @param90         ,  @param91         ,  @param92         ,  @param93         ,  @param94         ,  @param95         ,  @param96         ,  @param97         ,  @param98         ,  @param99         ,  @param100         ,  @param101         ,  @param102         ,  @param103         ,  @param104         ,  @param105         ,  @param106         ,  @param107         ,  @param108         ,  @param109         ,  @param110         ,  @param111         ,  @param112         ,  @param113         ,  @param114         ,  @param115         ,  @param116         ,  @param117         ,  @param118         ,  @param119         ,  @param120         ,  @param121         ,  @param122         ,  @param123         ,  @param124         )]
2020-01-02 17:32:15,265 [1] DEBUG - Statement Id: [DAO00080_Add_KhamBenh_CapCuu] Parameters: [@param0=[SOPHIEU,null], @param1=[TIEPNHAN_ID,28494], @param2=[KHAMBENH_ID,null], @param3=[BENHNHAN_ID,24442], @param4=[NGUOILIENHE,null], @param5=[DIENTHOAILIENHE,null], @param6=[NOILAMVIEC,null], @param7=[CHANDOANNOIGIOITHIEU,null], @param8=[NGAYKHAM,1/2/2020 12:00:00 AM], @param9=[THOIGIANKHAM,1/2/2020 5:31:36 PM], @param10=[LYDOVAOVIEN,null], @param11=[QUATRINHBENHLY,null], @param12=[TIENSUBANTHAN,null], @param13=[TIENSUGIADINH,null], @param14=[KHAMXETTOANTHAN,null], @param15=[KHAMXETCACBOPHAN,null], @param16=[KHAMXETKQLS,null], @param17=[CHANDOANVAO,null], @param18=[ICDKHAMXET_ID,null], @param19=[DAXULY,null], @param20=[NGAYRA,null], @param21=[THOIGIANRA,null], @param22=[NHAPKHOA_ID,62], @param23=[CHUYENVIEN_ID,null], @param24=[CHUY,null], @param25=[MACH,null], @param26=[NHIETDO,null], @param27=[HUYETAPCAO,null], @param28=[HUYETAPTHAP,null], @param29=[NHIPTHO,null], @param30=[CANNANG,null], @param31=[CHIEUCAO,null], @param32=[BACSI_ID,null], @param33=[XUTRUKHAMBENH_ID,null], @param34=[CAPCUU,null], @param35=[NGAYTAINAN,null], @param36=[THOIGIANTAINAN,null], @param37=[NOITAINAN_TINHTHANH_ID,null], @param38=[NOITAINAN_QUANHUYEN_ID,null], @param39=[NOITAINAN_PHUONGXA_ID,null], @param40=[NOITAINAN_DIACHI,null], @param41=[DIADIEMTAINAN_ID,null], @param42=[BOPHANBITHUONG_ID,null], @param43=[MUCDO_ID,null], @param44=[DIENBIENSAUTN_ID,null], @param45=[XUTRISAUTN_ID,null], @param46=[NGUYENNHAN_ID,null], @param47=[NGUYENNHANCHITIET_ID,null], @param48=[ICD_NGUYENNHAN,null], @param49=[NGAYTAO,1/2/2020 5:32:15 PM], @param50=[NGUOITAO_ID,1], @param51=[NGAYCAPNHAT,1/2/2020 5:32:15 PM], @param52=[NGUOICAPNHAT_ID,1], @param53=[BENHANCHUYENKHOA,null], @param54=[CHANDOANVAOVIEN,null], @param55=[CHANDOANRAVIEN,null], @param56=[DIEUTRITUNGAY,null], @param57=[DIEUTRIDENNGAY,null], @param58=[DIENBIENLS,null], @param59=[KQXETNGHIEM,null], @param60=[PHAUTHUAT,null], @param61=[THUTHUAT,null], @param62=[TINHTRANGNGUOIBENH,null], @param63=[HUONGDIEUTRI,null], @param64=[NGUOIGIAO_ID,null], @param65=[NGUOINHAN_ID,null], @param66=[XQUANG,null], @param67=[CTSCANNER,null], @param68=[SIEUAM,null], @param69=[XETNGHIEM,null], @param70=[KHAC,null], @param71=[TOANBOHS,null], @param72=[LOAICHUYENKHOA,null], @param73=[CONGANCANTHIEP,null], @param74=[CDRR_BENHCHINH,null], @param75=[CDRR_BENHKEM,null], @param76=[ICD_BENHCHINH,null], @param77=[ICD_BENHKEMTHEO,null], @param78=[PHUONGPHAPDIEUTRI,null], @param79=[FIELD_1,null], @param80=[FIELD_2,null], @param81=[FIELD_3,null], @param82=[FIELD_4,null], @param83=[FIELD_5,null], @param84=[FIELD_6,null], @param85=[FIELD_7,null], @param86=[FIELD_8,null], @param87=[FIELD_9,null], @param88=[FIELD_10,null], @param89=[FIELD_11,null], @param90=[FIELD_12,null], @param91=[FIELD_13,null], @param92=[FIELD_14,null], @param93=[FIELD_15,null], @param94=[FIELD_27,null], @param95=[FIELD_28,null], @param96=[FIELD_29,null], @param97=[FIELD_30,null], @param98=[FIELD_31,null], @param99=[FIELD_32,null], @param100=[FIELD_33,null], @param101=[FIELD_34,null], @param102=[FIELD_35,null], @param103=[FIELD_36,null], @param104=[FIELD_37,null], @param105=[FIELD_38,null], @param106=[FIELD_39,null], @param107=[FIELD_40,null], @param108=[FIELD_41,null], @param109=[FIELD_42,null], @param110=[FIELD_43,null], @param111=[FIELD_44,null], @param112=[FIELD_45,null], @param113=[FIELD_46,null], @param114=[FIELD_47,null], @param115=[FIELD_48,null], @param116=[FIELD_49,null], @param117=[FIELD_50,null], @param118=[FIELD_51,null], @param119=[FIELD_52,null], @param120=[FIELD_53,null], @param121=[FIELD_54,null], @param122=[FIELD_55,null], @param123=[FIELD_56,null], @param124=[BENHVIEN_ID,HLU01]]
2020-01-02 17:32:15,265 [1] DEBUG - Statement Id: [DAO00080_Add_KhamBenh_CapCuu] Types: [@param0=[System.DBNull, null], @param1=[Int32, System.Int32], @param2=[System.DBNull, null], @param3=[Int32, System.Int32], @param4=[System.DBNull, null], @param5=[System.DBNull, null], @param6=[System.DBNull, null], @param7=[System.DBNull, null], @param8=[DateTime, System.DateTime], @param9=[DateTime, System.DateTime], @param10=[System.DBNull, null], @param11=[System.DBNull, null], @param12=[System.DBNull, null], @param13=[System.DBNull, null], @param14=[System.DBNull, null], @param15=[System.DBNull, null], @param16=[System.DBNull, null], @param17=[System.DBNull, null], @param18=[System.DBNull, null], @param19=[System.DBNull, null], @param20=[System.DBNull, null], @param21=[System.DBNull, null], @param22=[String, System.String], @param23=[System.DBNull, null], @param24=[System.DBNull, null], @param25=[System.DBNull, null], @param26=[System.DBNull, null], @param27=[System.DBNull, null], @param28=[System.DBNull, null], @param29=[System.DBNull, null], @param30=[System.DBNull, null], @param31=[System.DBNull, null], @param32=[System.DBNull, null], @param33=[System.DBNull, null], @param34=[System.DBNull, null], @param35=[System.DBNull, null], @param36=[System.DBNull, null], @param37=[System.DBNull, null], @param38=[System.DBNull, null], @param39=[System.DBNull, null], @param40=[System.DBNull, null], @param41=[System.DBNull, null], @param42=[System.DBNull, null], @param43=[System.DBNull, null], @param44=[System.DBNull, null], @param45=[System.DBNull, null], @param46=[System.DBNull, null], @param47=[System.DBNull, null], @param48=[System.DBNull, null], @param49=[DateTime, System.DateTime], @param50=[String, System.String], @param51=[DateTime, System.DateTime], @param52=[String, System.String], @param53=[System.DBNull, null], @param54=[System.DBNull, null], @param55=[System.DBNull, null], @param56=[System.DBNull, null], @param57=[System.DBNull, null], @param58=[System.DBNull, null], @param59=[System.DBNull, null], @param60=[System.DBNull, null], @param61=[System.DBNull, null], @param62=[System.DBNull, null], @param63=[System.DBNull, null], @param64=[System.DBNull, null], @param65=[System.DBNull, null], @param66=[System.DBNull, null], @param67=[System.DBNull, null], @param68=[System.DBNull, null], @param69=[System.DBNull, null], @param70=[System.DBNull, null], @param71=[System.DBNull, null], @param72=[System.DBNull, null], @param73=[System.DBNull, null], @param74=[System.DBNull, null], @param75=[System.DBNull, null], @param76=[System.DBNull, null], @param77=[System.DBNull, null], @param78=[System.DBNull, null], @param79=[System.DBNull, null], @param80=[System.DBNull, null], @param81=[System.DBNull, null], @param82=[System.DBNull, null], @param83=[System.DBNull, null], @param84=[System.DBNull, null], @param85=[System.DBNull, null], @param86=[System.DBNull, null], @param87=[System.DBNull, null], @param88=[System.DBNull, null], @param89=[System.DBNull, null], @param90=[System.DBNull, null], @param91=[System.DBNull, null], @param92=[System.DBNull, null], @param93=[System.DBNull, null], @param94=[System.DBNull, null], @param95=[System.DBNull, null], @param96=[System.DBNull, null], @param97=[System.DBNull, null], @param98=[System.DBNull, null], @param99=[System.DBNull, null], @param100=[System.DBNull, null], @param101=[System.DBNull, null], @param102=[System.DBNull, null], @param103=[System.DBNull, null], @param104=[System.DBNull, null], @param105=[System.DBNull, null], @param106=[System.DBNull, null], @param107=[System.DBNull, null], @param108=[System.DBNull, null], @param109=[System.DBNull, null], @param110=[System.DBNull, null], @param111=[System.DBNull, null], @param112=[System.DBNull, null], @param113=[System.DBNull, null], @param114=[System.DBNull, null], @param115=[System.DBNull, null], @param116=[System.DBNull, null], @param117=[System.DBNull, null], @param118=[System.DBNull, null], @param119=[System.DBNull, null], @param120=[System.DBNull, null], @param121=[System.DBNull, null], @param122=[System.DBNull, null], @param123=[System.DBNull, null], @param124=[String, System.String]]
2020-01-02 17:32:15,294 [1] DEBUG - Statement Id: [DAO00000_GetMucHuongDOITUONGBHYT] PreparedStatement : [select * from TM_DOITUONG          where BENHVIEN_ID = 'HLU01'           and             NHOMTHE like '%' +  @param0  +'%']
2020-01-02 17:32:15,294 [1] DEBUG - Statement Id: [DAO00000_GetMucHuongDOITUONGBHYT] Parameters: [@param0=[NHOMTHE,DN4]]
2020-01-02 17:32:15,294 [1] DEBUG - Statement Id: [DAO00000_GetMucHuongDOITUONGBHYT] Types: [@param0=[String, System.String]]
2020-01-02 17:32:15,318 [1] DEBUG - Statement Id: [DAO00019_Add_TT_TIEPNHAN_SOTHEBHYT] PreparedStatement : [INSERT INTO TT_TIEPNHAN_SOTHEBHYT        (TIEPNHAN_ID        ,BENHNHAN_ID        ,BENHAN_ID        ,DOITUONG_ID        ,SOBHYT        ,BHYTTUNGAY        ,BHYTDENNGAY        ,BHYTNGAYCAP        ,BHYTTREN3NAM        ,BHYTTREN5NAM        ,NGAYMIENDONGCHITRA        ,TRAITUYEN        ,BENHVIEN_ID        ,NOITAO_ID        ,NGAYTAO        ,NGUOITAO_ID        ,NGAYCAPNHAT        ,NGUOICAPNHAT_ID        ,TYLE_VUOT_LCB        ,TYLE_TRAITUYEN        ,GIOIHAN_VUOT_LCB        ,LUONG_COSO        ,TYLE_THUOC_UT        ,MADOITUONG)        VALUES        ( @param0         , @param1         , @param2         , @param3         , @param4         , @param5         , @param6         , @param7         , @param8         , @param9         , @param10         , @param11         , @param12         , @param13         , @param14         , @param15         , @param16         , @param17         , @param18         , @param19         , @param20         , @param21         , @param22         , @param23 )]
2020-01-02 17:32:15,318 [1] DEBUG - Statement Id: [DAO00019_Add_TT_TIEPNHAN_SOTHEBHYT] Parameters: [@param0=[TIEPNHAN_ID,28494], @param1=[BENHNHAN_ID,24442], @param2=[BENHAN_ID,null], @param3=[DOITUONG_ID,4], @param4=[SOBHYT,DN466456425324438289], @param5=[BHYTTUNGAY,1/1/2020 12:00:00 AM], @param6=[BHYTDENNGAY,12/31/2020 12:00:00 AM], @param7=[BHYTNGAYCAP,null], @param8=[BHYTTREN3NAM,0], @param9=[BHYTTREN5NAM,0], @param10=[NGAYMIENDONGCHITRA,null], @param11=[TRAITUYEN,0], @param12=[BENHVIEN_ID,HLU01], @param13=[NOITAO_ID,62], @param14=[NGAYTAO,1/2/2020 5:32:15 PM], @param15=[NGUOITAO_ID,1], @param16=[NGAYCAPNHAT,1/2/2020 5:32:15 PM], @param17=[NGUOICAPNHAT_ID,1], @param18=[TYLE_VUOT_LCB,0.80], @param19=[TYLE_TRAITUYEN,0.60], @param20=[GIOIHAN_VUOT_LCB,208500.00], @param21=[LUONG_COSO,1300000.00], @param22=[TYLE_THUOC_UT,0.50], @param23=[MADOITUONG,BHYT4]]
2020-01-02 17:32:15,318 [1] DEBUG - Statement Id: [DAO00019_Add_TT_TIEPNHAN_SOTHEBHYT] Types: [@param0=[Int32, System.Int32], @param1=[Int32, System.Int32], @param2=[System.DBNull, null], @param3=[Int32, System.Int32], @param4=[String, System.String], @param5=[DateTime, System.DateTime], @param6=[DateTime, System.DateTime], @param7=[System.DBNull, null], @param8=[String, System.String], @param9=[String, System.String], @param10=[System.DBNull, null], @param11=[String, System.String], @param12=[String, System.String], @param13=[String, System.String], @param14=[DateTime, System.DateTime], @param15=[String, System.String], @param16=[DateTime, System.DateTime], @param17=[String, System.String], @param18=[Decimal, System.Decimal], @param19=[Decimal, System.Decimal], @param20=[Decimal, System.Decimal], @param21=[Decimal, System.Decimal], @param22=[Decimal, System.Decimal], @param23=[String, System.String]]
2020-01-02 17:32:15,354 [1] DEBUG - Statement Id: [DAO00027_GetListTiepNhanAllCOM30] PreparedStatement : [select distinct A.SOTIEPNHAN, A.TRAITUYEN, A.NGAYMIENDONGCHITRA, A.TIEPNHAN_ID, A.DOITUONG_ID, isnull(C.SOBENHAN,NULL) as SOBENHAN,        A.LOAITHANHVIEN_ID, A.SUDUNG_BHTN, A.THE_ID, A.THANHVIEN_ID, A.VIP, A.NGUON_BENHNHAN_ID, A.BAOLANH_VIENPHI, A.SOBHYT, CONVERT(VARCHAR(11),A.NGAYTIEPNHAN,103) as NGAYTIEPNHAN,        B.*        , A.UUTIEN        from TT_TIEPNHAN A        inner join (select * from TT_BENHNHAN where MAYTE = '200000002' and ACTIVE = '1') B on B.BENHNHAN_ID = A.BENHNHAN_ID  and B.ACTIVE = '1'        left join TT_NOITRU_BENHAN C on C.TIEPNHAN_ID = A.TIEPNHAN_ID        where A.TIEPNHAN_ID = '28494' and A.BENHVIEN_ID = 'HLU01' and (A.TRANGTHAI not in ('HUY','CAPCUU', 'NOITRU', 'NGOAITRU'))]
2020-01-02 17:32:15,413 [1] DEBUG - Statement Id: [DAOWF001_LaythongtinProcess] PreparedStatement : [select * from TM_PROCESS        where        PROCESS_CODE = 'P02']
2020-01-02 17:32:15,438 [1] DEBUG - Statement Id: [DAOWF001_Kiemtrathongtindayeucau] PreparedStatement : [select * from TT_REQUEST        where        PROCESS_CODE = 'P02'        AND PARA = '{"HOSPITAL_ID":"HLU01","SOTIEPNHAN":"TN200102.0000002"}'        AND CURR_STATE_CODE = '7'        AND ISACTIVE = '1']
2020-01-02 17:32:15,478 [1] DEBUG - Statement Id: [DAOWF002_Add] PreparedStatement : [DECLARE @IDRequestOld int        DECLARE @IDRequestNew int        select top 1 @IDRequestOld = ID from TT_REQUEST where PARA =  @param0  order by ID desc          insert into TT_REQUEST (        PROCESS_CODE        , PARA        , CURR_STATE_CODE        ) values (         @param1         ,  @param0         ,  @param2         )        SELECT @IDRequestNew = SCOPE_IDENTITY()        if (@IDRequestOld is not null)        begin        update TT_REQUEST_SERVICE set REQUEST_ID = @IDRequestNew, PROCESS_CODE =  @param1  where REQUEST_ID = @IDRequestOld        update TT_REQUEST set ISACTIVE = '0' where ID = @IDRequestOld        update TT_REQUEST_SERVICE_DETAIL set REQUEST_ID = @IDRequestNew where REQUEST_ID = @IDRequestOld        end          select @IDRequestNew]
2020-01-02 17:32:15,478 [1] DEBUG - Statement Id: [DAOWF002_Add] Parameters: [@param0=[PARA,{"HOSPITAL_ID":"HLU01","SOTIEPNHAN":"TN200102.0000002"}], @param1=[PROCESS_CODE,P02], @param2=[CURR_STATE_CODE,7]]
2020-01-02 17:32:15,478 [1] DEBUG - Statement Id: [DAOWF002_Add] Types: [@param0=[String, System.String], @param1=[String, System.String], @param2=[String, System.String]]
2020-01-02 17:32:15,575 [1] DEBUG - Statement Id: [DAO00020_GetNhomdichvuIDByManhom] PreparedStatement : [select NHOMDICHVU_ID from TM_NHOMDICHVU where MANHOMDICHVU = '04']
2020-01-02 17:32:15,599 [1] DEBUG - Statement Id: [DAO00020_Add] PreparedStatement : [declare        @keyValue int, @BenhVienId varchar(10), @yearNow int, @SoPhieuYeu varchar(20), @SoRender varchar(20), @MaNhomDichVu varchar(20)        set @keyValue = 0;        set @BenhVienId = 'HLU01'        set @yearNow = YEAR(getdate())        set @MaNhomDichVu = '5'                 select @keyValue = KEYVALUE from LST_KEYDATA        where KEYTYPE = 'SOPHIEUYEUCAU' and KEYYEAR = @yearNow and SEGMENT_1 = @MaNhomDichVu and BENHVIEN_ID = @BenhVienId        if @keyValue = 0        Insert into LST_KEYDATA values ('SOPHIEUYEUCAU', @yearNow, '0', '0', @MaNhomDichVu, '0', '0', 0, @BenhVienId);          Update LST_KEYDATA set KEYVALUE = KEYVALUE + 1, @keyValue = (KEYVALUE + 1) where KEYTYPE = 'SOPHIEUYEUCAU' and KEYYEAR = @yearNow and SEGMENT_1 = @MaNhomDichVu and BENHVIEN_ID = @BenhVienId        set @SoRender = right('000000'+convert(varchar(6), @keyValue), 6)        set @SoPhieuYeu = RIGHT(@yearNow, 2) + '.' + @MaNhomDichVu + '.' + @SoRender                 insert into TT_DVYEUCAU (        TIEPNHAN_ID        , BENHAN_ID        , KHAMBENH_ID        , SODICHVUYEUCAU        , KHAMBENH_NGOAITRU_ID        , SOPHIEUYEUCAU        , BENHNHAN_ID        , DOITUONG_ID        , DICHVU_ID         ,           NGUOICHIDINH_ID                 , BACSICHIDINH_ID        , GIOYEUCAU        , NGAYYEUCAU        , THANGYEUCAU        , NAMYEUCAU        , NGAYGIOYEUCAU        , THUTUYEUCAU        , NOIYEUCAU_ID        , NOITHUCHIEN_ID        , TRANGTHAI_HANGDOI        , NOIDUNGCHITIET        , CHANDOAN        , LUUTRU_ID        , SODICHVUDONGTIEN        , DICHVU_KHAMBENH_ID        , DALAYMAU        , SINHTHIET        , CLOTEST        , TIEMCANQUANG        , TRIEUCHUNG        , DAITHE        , VITHE        , BENHPHAM        , DANHANBENHPHAM        , NGAYNHANBENHPHAM        , THOIGIANNHANBENHPHAM        , NGUOINHANBENHPHAM_ID        , MANGUOINHAPBENHPHAM        , TENNGUOINHAPBENHPHAM        , KETQUAXNKHAC        , YEUCAUBENNGOAI        , THUCHIENBENNGOAI        , DONVIBENNGOAI_ID        , BACSIBENNGOAI_ID        , TENBACSIBENNGOAI        , KHOABENNGOAI_ID        , KHOABENNGOAI                 , NOITHUCHIENTHAYDOI_ID        , LOAIKHACHHANG_ID        , THE_ID        , BARCODEID        , HOPDONG_ID        , HOPDONG_BENHNHAN_ID        , HINHTHUCTHANHTOAN_ID        , DANGKY_ID        , DANGKY_CHITIET_ID        , LICHHEN_ID        , THOIGIANLICHHEN        , BNKHONGDENBV        , GHICHU        , THANHTOANTRUOC        , KHAN        , DUOCPHEPTHUCHIEN        , HUYYEUCAU        , LYDOHUY        , TRANGTHAI        , KHOADULIEU        , NGAYKHOADULIEU        , THOIGIANKHOADULIEU        , NGUOIKHOA_ID        , MANGUOIKHOA        , TENNGUOIKHOA        , BENHVIEN_ID        , NGAYTAO        , NGUOITAO_ID        , NGAYHENCLS        , CREATININEMAU        , VUNGCANKHAOSAT        , BHYTDONGTIEN        , THUTIENSAU                 , DVKEMTHEO        , DVKEMTHEO_KHACEKIP        , LIENCHUYENKHOA                 )        OUTPUT INSERTED.DVYEUCAU_ID, INSERTED.SOPHIEUYEUCAU        values (         @param0         ,  @param1         ,  @param2         ,  @param3         ,  @param4         , @SoPhieuYeu        ,  @param5         ,  @param6         ,  @param7          ,            @param8                  ,  @param9         ,  @param10         ,  @param11         ,  @param12         ,  @param13         ,  @param14         ,  @param15         ,  @param16         ,  @param17         ,  @param18         ,  @param19         ,  @param20         ,  @param21         ,  @param22         ,  @param23         ,  @param24         ,  @param25         ,  @param26         ,  @param27         ,  @param28         ,  @param29         ,  @param30         ,  @param31         ,  @param32         ,  @param33         ,  @param34         ,  @param35         ,  @param36         ,  @param37         ,  @param38         ,  @param39         ,  @param40         ,  @param41         ,  @param42         ,  @param43         ,  @param44         ,  @param45                  ,  @param46         ,  @param47         ,  @param48         ,  @param49         ,  @param50         ,  @param51         ,  @param52         ,  @param53         ,  @param54         ,  @param55         ,  @param56         ,  @param57         ,  @param58         ,  @param59         ,  @param60         ,  @param61         ,  @param62         ,  @param63         ,  @param64         ,  @param65         ,  @param66         ,  @param67         ,  @param68         ,  @param69         ,  @param70         ,  @param71         ,  @param72         ,  @param73         ,  @param74         ,  @param75         ,  @param76         ,  @param77         ,  @param78                  ,  @param79         ,  @param80         ,  @param81                  );]
2020-01-02 17:32:15,599 [1] DEBUG - Statement Id: [DAO00020_Add] Parameters: [@param0=[TIEPNHAN_ID,28494], @param1=[BENHAN_ID,null], @param2=[KHAMBENH_ID,null], @param3=[SODICHVUYEUCAU,1], @param4=[KHAMBENH_NGOAITRU_ID,null], @param5=[BENHNHAN_ID,24442], @param6=[DOITUONG_ID,4], @param7=[DICHVU_ID,5492], @param8=[NGUOICHIDINH_ID,1], @param9=[BACSICHIDINH_ID,1], @param10=[GIOYEUCAU,17], @param11=[NGAYYEUCAU,1/2/2020 12:00:00 AM], @param12=[THANGYEUCAU,1], @param13=[NAMYEUCAU,2020], @param14=[NGAYGIOYEUCAU,1/2/2020 5:31:36 PM], @param15=[THUTUYEUCAU,1], @param16=[NOIYEUCAU_ID,62], @param17=[NOITHUCHIEN_ID,62], @param18=[TRANGTHAI_HANGDOI,null], @param19=[NOIDUNGCHITIET,null], @param20=[CHANDOAN,null], @param21=[LUUTRU_ID,null], @param22=[SODICHVUDONGTIEN,0], @param23=[DICHVU_KHAMBENH_ID,null], @param24=[DALAYMAU,null], @param25=[SINHTHIET,0], @param26=[CLOTEST,0], @param27=[TIEMCANQUANG,0], @param28=[TRIEUCHUNG,null], @param29=[DAITHE,null], @param30=[VITHE,null], @param31=[BENHPHAM,null], @param32=[DANHANBENHPHAM,0], @param33=[NGAYNHANBENHPHAM,null], @param34=[THOIGIANNHANBENHPHAM,null], @param35=[NGUOINHANBENHPHAM_ID,null], @param36=[MANGUOINHAPBENHPHAM,null], @param37=[TENNGUOINHAPBENHPHAM,null], @param38=[KETQUAXNKHAC,null], @param39=[YEUCAUBENNGOAI,0], @param40=[THUCHIENBENNGOAI,0], @param41=[DONVIBENNGOAI_ID,null], @param42=[BACSIBENNGOAI_ID,null], @param43=[TENBACSIBENNGOAI,null], @param44=[KHOABENNGOAI_ID,null], @param45=[KHOABENNGOAI,null], @param46=[NOITHUCHIENTHAYDOI_ID,null], @param47=[LOAIKHACHHANG_ID,null], @param48=[THE_ID,null], @param49=[BARCODEID,null], @param50=[HOPDONG_ID,null], @param51=[HOPDONG_BENHNHAN_ID,null], @param52=[HINHTHUCTHANHTOAN_ID,null], @param53=[DANGKY_ID,null], @param54=[DANGKY_CHITIET_ID,null], @param55=[LICHHEN_ID,null], @param56=[THOIGIANLICHHEN,null], @param57=[BNKHONGDENBV,null], @param58=[GHICHU,null], @param59=[THANHTOANTRUOC,1], @param60=[KHAN,0], @param61=[DUOCPHEPTHUCHIEN,0], @param62=[HUYYEUCAU,0], @param63=[LYDOHUY,null], @param64=[TRANGTHAI,CHUAKETQUA], @param65=[KHOADULIEU,null], @param66=[NGAYKHOADULIEU,null], @param67=[THOIGIANKHOADULIEU,null], @param68=[NGUOIKHOA_ID,null], @param69=[MANGUOIKHOA,null], @param70=[TENNGUOIKHOA,null], @param71=[BENHVIEN_ID,HLU01], @param72=[NGAYTAO,1/2/2020 5:32:15 PM], @param73=[NGUOITAO_ID,1], @param74=[NGAYHENCLS,null], @param75=[CREATININEMAU,null], @param76=[VUNGCANKHAOSAT,null], @param77=[BHYTDONGTIEN,null], @param78=[THUTIENSAU,0], @param79=[DVKEMTHEO,0], @param80=[DVKEMTHEO_KHACEKIP,null], @param81=[LIENCHUYENKHOA,null]]
2020-01-02 17:32:15,599 [1] DEBUG - Statement Id: [DAO00020_Add] Types: [@param0=[String, System.String], @param1=[System.DBNull, null], @param2=[System.DBNull, null], @param3=[Int32, System.Int32], @param4=[System.DBNull, null], @param5=[Int32, System.Int32], @param6=[Int64, System.Int64], @param7=[Int64, System.Int64], @param8=[Int64, System.Int64], @param9=[Int64, System.Int64], @param10=[Int32, System.Int32], @param11=[DateTime, System.DateTime], @param12=[Int32, System.Int32], @param13=[Int32, System.Int32], @param14=[DateTime, System.DateTime], @param15=[Int32, System.Int32], @param16=[String, System.String], @param17=[Int64, System.Int64], @param18=[System.DBNull, null], @param19=[System.DBNull, null], @param20=[System.DBNull, null], @param21=[System.DBNull, null], @param22=[Int32, System.Int32], @param23=[System.DBNull, null], @param24=[System.DBNull, null], @param25=[Int32, System.Int32], @param26=[Int32, System.Int32], @param27=[Int32, System.Int32], @param28=[System.DBNull, null], @param29=[System.DBNull, null], @param30=[System.DBNull, null], @param31=[System.DBNull, null], @param32=[Int32, System.Int32], @param33=[System.DBNull, null], @param34=[System.DBNull, null], @param35=[System.DBNull, null], @param36=[System.DBNull, null], @param37=[System.DBNull, null], @param38=[System.DBNull, null], @param39=[Int32, System.Int32], @param40=[Int32, System.Int32], @param41=[System.DBNull, null], @param42=[System.DBNull, null], @param43=[System.DBNull, null], @param44=[System.DBNull, null], @param45=[System.DBNull, null], @param46=[System.DBNull, null], @param47=[System.DBNull, null], @param48=[System.DBNull, null], @param49=[System.DBNull, null], @param50=[System.DBNull, null], @param51=[System.DBNull, null], @param52=[System.DBNull, null], @param53=[System.DBNull, null], @param54=[System.DBNull, null], @param55=[System.DBNull, null], @param56=[System.DBNull, null], @param57=[System.DBNull, null], @param58=[System.DBNull, null], @param59=[Int32, System.Int32], @param60=[Int32, System.Int32], @param61=[Int32, System.Int32], @param62=[Int32, System.Int32], @param63=[System.DBNull, null], @param64=[String, System.String], @param65=[System.DBNull, null], @param66=[System.DBNull, null], @param67=[System.DBNull, null], @param68=[System.DBNull, null], @param69=[System.DBNull, null], @param70=[System.DBNull, null], @param71=[String, System.String], @param72=[DateTime, System.DateTime], @param73=[String, System.String], @param74=[System.DBNull, null], @param75=[System.DBNull, null], @param76=[System.DBNull, null], @param77=[System.DBNull, null], @param78=[String, System.String], @param79=[Int32, System.Int32], @param80=[System.DBNull, null], @param81=[System.DBNull, null]]
2020-01-02 17:32:15,635 [1] DEBUG - Statement Id: [DAO00027_ThongTinTiepNhanCOM006] PreparedStatement : [select distinct CONVERT(VARCHAR(11),A.NGAYTIEPNHAN,103) as NGAYYEUCAU, C.DICHVU_ID, C.DVYEUCAU_ID, D.TENDICHVU, C.NOITHUCHIEN_ID,        A.SOTIEPNHAN, A.TRAITUYEN, A.NGAYMIENDONGCHITRA, A.TIEPNHAN_ID, A.DOITUONG_ID, A.TRANGTHAI,        A.LOAITHANHVIEN_ID, A.SUDUNG_BHTN, A.THE_ID, A.THANHVIEN_ID, A.VIP, A.NGUON_BENHNHAN_ID, A.BAOLANH_VIENPHI,        CASE WHEN (A.TRANGTHAI = 'NOITRU' OR A.TRANGTHAI = 'CAPCUU'   or A.TRANGTHAI = 'NGOAITRU') THEN 'IN' ELSE 'OUT' END AS LOAIBENHAN,        CASE WHEN (C.TRANGTHAI = 'CHUAKETQUA') THEN 'CHUAKETQUA' ELSE 'HOANTAT' END AS TRANGTHAIDICHVU, A.SOBHYT,        B.*,        CASE WHEN Left(E.MANHOMDICHVU,2) = '03' THEN '02' ELSE Left(E.MANHOMDICHVU,2) END AS MANHOMDICHVU        , A.UUTIEN        from TT_TIEPNHAN A        inner join TT_BENHNHAN B on B.BENHNHAN_ID = A.BENHNHAN_ID and (A.TRANGTHAI = 'DATIEPNHAN' or A.TRANGTHAI = 'NOITRU' or A.TRANGTHAI = 'CAPCUU'  or A.TRANGTHAI = 'NGOAITRU') and B.ACTIVE = '1'        inner join TT_DVYEUCAU C on C.TIEPNHAN_ID = A.TIEPNHAN_ID        left join TM_DICHVU D on D.DICHVU_ID = C.DICHVU_ID        left join TM_NHOMDICHVU E on E.NHOMDICHVU_ID = D.NHOMDICHVU_ID        where C.NGAYHENCLS is NULL and A.TIEPNHAN_ID = '28494' and C.DICHVU_ID = '5492' and A.BENHVIEN_ID = 'HLU01'         and           C.DVYEUCAU_ID = '206520']
2020-01-02 17:32:15,695 [1] DEBUG - Statement Id: [DAO00027_ThongTinTiepNhanCOM015] PreparedStatement : [declare @ManhomDSA varchar(10);        select top 1  @ManhomDSA = VALUE from TM_SYS_APPSETTINGS where CODE = 'MANHOM_DICHVU_DSA'        SELECT * FROM        (        SELECT        (A.SOTIEPNHAN + (CASE WHEN Left(E.MANHOMDICHVU,2) = '03' THEN '02' ELSE Left(E.MANHOMDICHVU,2) END) + LTRIM(C.NOITHUCHIEN_ID)) AS acss_lookupID,        ROW_NUMBER() OVER        (PARTITION BY (A.SOTIEPNHAN + (CASE WHEN Left(E.MANHOMDICHVU,2) = '03' THEN '02' ELSE Left(E.MANHOMDICHVU,2) END) + LTRIM(C.NOITHUCHIEN_ID))        ORDER BY (A.SOTIEPNHAN + (CASE WHEN Left(E.MANHOMDICHVU,2) = '03' THEN '02' ELSE Left(E.MANHOMDICHVU,2) END) + LTRIM(C.NOITHUCHIEN_ID)))        as num,        A.SOTIEPNHAN + (CASE WHEN Left(E.MANHOMDICHVU,2) = '03' THEN '02' ELSE Left(E.MANHOMDICHVU,2) END) + LTRIM(C.NOITHUCHIEN_ID) as KEYCOM15,        C.NOITHUCHIEN_ID, A.SOTIEPNHAN, A.TRAITUYEN, A.NGAYMIENDONGCHITRA, A.TIEPNHAN_ID, A.DOITUONG_ID, A.TRANGTHAI,        CASE WHEN (A.TRANGTHAI = 'NOITRU' OR A.TRANGTHAI = 'CAPCUU' or A.TRANGTHAI = 'NGOAITRU') THEN 'IN' ELSE 'OUT' END AS LOAIBENHAN,        CASE WHEN (C.TRANGTHAI = 'CHUAKETQUA') THEN 'CHUAKETQUA' ELSE 'HOANTAT' END AS TRANGTHAIDICHVU, A.SOBHYT,        B.*, F.TRANGTHAI as TRANGTHAI_BENHAN_NOITRU,        A.LOAITHANHVIEN_ID, A.SUDUNG_BHTN, A.THE_ID, A.THANHVIEN_ID, A.VIP, A.NGUON_BENHNHAN_ID, A.BAOLANH_VIENPHI,        CASE        WHEN @ManhomDSA is not null and E.MANHOMDICHVU in (@ManhomDSA) THEN E.MANHOMDICHVU        WHEN Left(E.MANHOMDICHVU,2) = '03' THEN '02' ELSE Left(E.MANHOMDICHVU,2) END AS MANHOMDICHVU        , A.UUTIEN        from TT_TIEPNHAN A        inner join TT_BENHNHAN B on B.BENHNHAN_ID = A.BENHNHAN_ID and (A.TRANGTHAI = 'DATIEPNHAN' or A.TRANGTHAI = 'NOITRU' or A.TRANGTHAI = 'CAPCUU' or A.TRANGTHAI = 'NGOAITRU') and B.ACTIVE = '1'        inner join TT_DVYEUCAU C on C.TIEPNHAN_ID = A.TIEPNHAN_ID        left join TM_DICHVU D on D.DICHVU_ID = C.DICHVU_ID        left join TM_NHOMDICHVU E on E.NHOMDICHVU_ID = D.NHOMDICHVU_ID        left join TT_NOITRU_BENHAN F on F.TIEPNHAN_ID = A.TIEPNHAN_ID        where C.NGAYHENCLS is NULL and A.TIEPNHAN_ID = '28494' and A.BENHVIEN_ID = 'HLU01'        ) a where a.num = 1]
2020-01-02 17:32:15,774 [1] DEBUG - Statement Id: [DAO00009_TT_TIEPNHAN_GetProcess] PreparedStatement : [select PROCESS_ID from TT_TIEPNHAN where SOTIEPNHAN = 'TN200102.0000002']
2020-01-02 17:32:15,814 [1] DEBUG - Statement Id: [DAOWF001_Kiemtrathongtindayeucaudacochua] PreparedStatement : [select * from TT_REQUEST        where        PARA = '{"HOSPITAL_ID":"HLU01","SOTIEPNHAN":"TN200102.0000002"}'        AND ISACTIVE = '1']
2020-01-02 17:32:15,858 [1] DEBUG - Statement Id: [DAOWF001_Kiemtrathongtindichvudayeucau] PreparedStatement : [select top 1 * from TT_REQUEST_SERVICE        where        PARA = '{"DICHVU_ID":"5492","DVYEUCAU_ID":"206520"}'                AND ISACTIVE = '1' order by ID desc]
2020-01-02 17:32:15,941 [1] DEBUG - Statement Id: [DAOWF001_KiemtrathongtinchitietDichvuYeucau] PreparedStatement : [select * from TT_REQUEST_SERVICE_DETAIL        where        REQUEST_SERVICE_ID = '']
2020-01-02 17:32:15,999 [1] DEBUG - Statement Id: [DAOWF001_GetStartStateOfProcess] PreparedStatement : [select STATE_CODE from TM_STATE where TYPE_CODE = 'S' and PROCESS_CODE = 'P02']
2020-01-02 17:32:16,022 [1] DEBUG - Statement Id: [DAOWF001_Laythongtinwithstatecode] PreparedStatement : [select A.*, B.STATUS_CODE from        TM_STATE_ACTION A        left join TM_STATE B on B.STATE_CODE = A.NEXT_STATE_CODE and A.PROCESS_CODE = B.PROCESS_CODE        where        A.CURR_STATE_CODE = '7'        AND A.PROCESS_CODE = 'P02'        Order By ORDER_ID ASC]
2020-01-02 17:32:16,047 [1] DEBUG - Statement Id: [DAOWF003_Add] PreparedStatement : [insert into TT_REQUEST_SERVICE (        REQUEST_ID        , PARA        , CURR_STATE_CODE        , PROCESS_CODE        ) values (         @param0         ,  @param1         ,  @param2         ,  @param3         )        SELECT SCOPE_IDENTITY()]
2020-01-02 17:32:16,047 [1] DEBUG - Statement Id: [DAOWF003_Add] Parameters: [@param0=[REQUEST_ID,32794], @param1=[SERVICEPARA,{"DICHVU_ID":"5492","DVYEUCAU_ID":"206520"}], @param2=[CURR_STATE_CODE,0], @param3=[PROCESS_CODE,P02]]
2020-01-02 17:32:16,047 [1] DEBUG - Statement Id: [DAOWF003_Add] Types: [@param0=[Int32, System.Int32], @param1=[String, System.String], @param2=[String, System.String], @param3=[String, System.String]]
2020-01-02 17:32:16,074 [1] DEBUG - Statement Id: [DAOWF005_Add] PreparedStatement : [insert into TT_REQUEST_SERVICE_DETAIL (        REQUEST_ID        ,REQUEST_SERVICE_ID        , OLD_STATE_CODE        , CURR_STATE_CODE        ) values (         @param0         , @param1         ,  @param2         ,  @param3         )        SELECT SCOPE_IDENTITY()]
2020-01-02 17:32:16,074 [1] DEBUG - Statement Id: [DAOWF005_Add] Parameters: [@param0=[REQUEST_ID,32794], @param1=[REQUEST_SERVICE_ID,148396], @param2=[OLD_STATE_CODE,null], @param3=[CURR_STATE_CODE,0]]
2020-01-02 17:32:16,074 [1] DEBUG - Statement Id: [DAOWF005_Add] Types: [@param0=[String, System.String], @param1=[Int64, System.Int64], @param2=[System.DBNull, null], @param3=[String, System.String]]
2020-01-02 17:32:16,099 [1] DEBUG - Statement Id: [DAOWF005_Add_History] PreparedStatement : [insert into TT_REQUEST_SERVICE_HISTORY (        REQUEST_ID        ,REQUEST_SERVICE_ID        , OLD_STATE_CODE        , CURR_STATE_CODE        ) values (         @param0         , @param1         ,  @param2         ,  @param3         )]
2020-01-02 17:32:16,099 [1] DEBUG - Statement Id: [DAOWF005_Add_History] Parameters: [@param0=[REQUEST_ID,32794], @param1=[REQUEST_SERVICE_ID,148396], @param2=[OLD_STATE_CODE,null], @param3=[CURR_STATE_CODE,0]]
2020-01-02 17:32:16,099 [1] DEBUG - Statement Id: [DAOWF005_Add_History] Types: [@param0=[String, System.String], @param1=[Int64, System.Int64], @param2=[System.DBNull, null], @param3=[String, System.String]]
2020-01-02 17:32:16,124 [1] DEBUG - Statement Id: [DAO00009_TT_DVYEUCAU_Update] PreparedStatement : [Update TT_DVYEUCAU set TRANGTHAI_WFL = 'CHUAKETQUA' where DVYEUCAU_ID = '206520']
2020-01-02 17:32:16,148 [1] DEBUG - Statement Id: [DAO00026_GetListDanhSachDichVuGhiNhanVTYT_COM25_WithTN] PreparedStatement : [select distinct CONVERT(VARCHAR(11),C.NGAYYEUCAU,103) as NGAYYEUCAU, C.DICHVU_ID, C.DVYEUCAU_ID, D.TENDICHVU, C.NOITHUCHIEN_ID, A.SOTIEPNHAN, A.TRAITUYEN, A.NGAYMIENDONGCHITRA, A.TIEPNHAN_ID, A.DOITUONG_ID, A.TRANGTHAI,            A.LOAITHANHVIEN_ID, A.SUDUNG_BHTN, A.THE_ID, A.THANHVIEN_ID, A.VIP, A.NGUON_BENHNHAN_ID, A.BAOLANH_VIENPHI,            CASE WHEN (A.TRANGTHAI = 'NOITRU' OR A.TRANGTHAI = 'CAPCUU') THEN 'IN' ELSE 'OUT' END AS LOAIBENHAN,            CASE WHEN (C.TRANGTHAI = 'CHUAKETQUA') THEN 'CHUAKETQUA' ELSE 'HOANTAT' END AS TRANGTHAIDICHVU,            B.*, isnull(ntba.SOBENHAN, '') SOBENHAN, isnull(ntba.BENHAN_ID, 0) BENHAN_ID,            CASE WHEN Left(E.MANHOMDICHVU,2) = '03' THEN '02' ELSE Left(E.MANHOMDICHVU,2) END AS MANHOMDICHVU            from TT_TIEPNHAN A            inner join TT_BENHNHAN B on B.BENHNHAN_ID = A.BENHNHAN_ID and B.ACTIVE = '1'            inner join TT_DVYEUCAU C on C.TIEPNHAN_ID = A.TIEPNHAN_ID                        left join TM_DICHVU D on D.DICHVU_ID = C.DICHVU_ID            left join TM_NHOMDICHVU E on E.NHOMDICHVU_ID = D.NHOMDICHVU_ID            left join TT_NOITRU_BENHAN ntba on ntba.BENHAN_ID = C.BENHAN_ID              where            C.NGAYHENCLS is NULL and A.BENHVIEN_ID = 'HLU01'            and (A.TRANGTHAI = 'DATIEPNHAN' or A.TRANGTHAI = 'NOITRU' or A.TRANGTHAI = 'CAPCUU' or A.TRANGTHAI = 'NGOAITRU')            and (CASE WHEN Left(E.MANHOMDICHVU,2) = '03' THEN '02' ELSE Left(E.MANHOMDICHVU,2) END in ('02', '04'))            and A.TIEPNHAN_ID = '28494']
2020-01-02 17:32:16,221 [1] DEBUG - Statement Id: [DAO00023_GetSOBHYT_HUONG_ID] PreparedStatement : [select isnull(MAX(SOBHYT_HUONG_ID),0) SOBHYT_HUONG_ID        from TT_TIEPNHAN_SOTHEBHYT        where TIEPNHAN_ID = '28494']
2020-01-02 17:32:16,248 [1] DEBUG - Statement Id: [DAO00064_GetTopTT_TIEPNHAN_SOTHEBHYT] PreparedStatement : [select top 1 stbhyt.*, ba.SOBENHAN,        tn.SOTIEPNHAN, tn.LOAITHANHVIEN_ID, tn.THE_ID, tn.THANHVIEN_ID,        tn.SUDUNG_BHTN, tn.BAOLANH_VIENPHI, tn.VIP, tn.NGUOINUOCNGOAI        from TT_TIEPNHAN_SOTHEBHYT stbhyt        left join TT_TIEPNHAN tn on tn.TIEPNHAN_ID = stbhyt.TIEPNHAN_ID        left join TT_NOITRU_BENHAN ba on ba.TIEPNHAN_ID = stbhyt.TIEPNHAN_ID        where        stbhyt.TIEPNHAN_ID = '28494' and isnull(stbhyt.KHONGSUDUNG, '0') = '0'        order by SOBHYT_HUONG_ID desc]
2020-01-02 17:32:16,286 [1] DEBUG - Statement Id: [DAO00006_GetListDuocTyle] PreparedStatement : [select DUOC_ID, DOITUONG_ID, (TYLE/100) as TYLE, DONGIA MUCTRAN_THANHTOAN from TM_DOITUONG_GIADUOC_TYLE            where            BENHVIEN_ID = 'HLU01'            and DOITUONG_ID = '4']
2020-01-02 17:32:16,311 [1] DEBUG - Statement Id: [DAO00027_GetListTuongTrinhDichVuPhauThuatCuaTiepNhan] PreparedStatement : [declare @ManhomDSA varchar(10);        declare @PhanLoaiNhomDV varchar(20) = '05';        select top 1  @ManhomDSA = VALUE from TM_SYS_APPSETTINGS where CODE = 'MANHOM_DICHVU_DSA'        if (@ManhomDSA is not null) set @PhanLoaiNhomDV += ',' + @ManhomDSA        select distinct ptyc.*        from TT_PHAUTHUAT_YEUCAU ptyc        inner join TM_DICHVU dv on dv.DICHVU_ID = ptyc.DICHVU_ID        inner join TM_NHOMDICHVU ndv on ndv.NHOMDICHVU_ID = dv.NHOMDICHVU_ID        inner join TT_PHAUTHUAT pt on pt.PHAUTHUAT_ID = ptyc.PHAUTHUAT_ID        where        pt.TIEPNHAN_ID = 28494        and (left(ndv.MANHOMDICHVU, 2) in (select * from STRING_SPLIT(@PhanLoaiNhomDV,',')) or ndv.MANHOMDICHVU in (select * from STRING_SPLIT(@PhanLoaiNhomDV,',')))]
2020-01-02 17:32:16,388 [1] DEBUG - Statement Id: [DAO00006_GetList] PreparedStatement : [select dv.*, loaiDV.MALOAIDICHVU, captren.NHOMDICHVU_ID as NHOMDICHVU_CAPTREN_ID, captren.TENNHOMDICHVU as NHOMDICHVU_CAPTREN,              nhom_dv.TENNHOMDICHVU as TENNHOMDICHVU, nhom_dv.MANHOMDICHVU,              case when dv.ATTRIBUTE5 is null then 'TT' else 'KTC' end as LOAI_CHIPHI              from TM_DICHVU as dv              left join TM_NHOMDICHVU as nhom_dv on nhom_dv.NHOMDICHVU_ID = dv.NHOMDICHVU_ID and nhom_dv.BENHVIEN_ID = 'HLU01'              left join TM_NHOMDICHVU as captren on nhom_dv.CAPTREN_ID = captren.NHOMDICHVU_ID and captren.BENHVIEN_ID = 'HLU01'              left join TM_LOAIDICHVU loaiDV on nhom_dv.LOAIDICHVU_ID = loaiDV.LOAIDICHVU_ID and loaiDV.BENHVIEN_ID = 'HLU01'              where nhom_dv.TAMNGUNG = '0' and dv.BENHVIEN_ID = 'HLU01'              and dv.TAMNGUNG = '0'               AND                   loaiDV.MALOAIDICHVU = 'KhamBenh']
2020-01-02 17:32:16,418 [1] DEBUG - Statement Id: [DAO00027_GetDichvuYCBHYTTyle] PreparedStatement : [select DVYEUCAU_ID from TT_DVYEUCAU        where TIEPNHAN_ID = 28494 and isnull(BHYT_TYLETHANHTOAN_ID, 0) > 0]
2020-01-02 17:32:16,450 [1] DEBUG - Statement Id: [DAO00023_Add] PreparedStatement : [insert into TT_VIENPHI (        TIEPNHAN_ID        , BENHAN_ID         ,           BENHNHAN_ID         ,           DOTDIEUTRI_ID                 , KHAMBENH_ID        , REF_ID        , REF_TABLE        , DICHVU_ID        , DUOC_ID        , LOAI_CHIPHI        , LOAIGIA_ID        , SOLUONG        , DONGIA_DOANHTHU        , THANHTIEN_DOANHTHU        , BHYT_TL        , BHYT_DONGIA        , BHYT_THANHTIEN        , BHYT_DONGIA_CHITRA        , BHYT_THANHTIEN_CHITRA        , BENHNHAN_PHAITHANHTOAN        , GIATRI_HOADON        , GIATRI_HOADON_DATHANHTOAN        , GIATRI_BIENLAI        , GIATRI_BIENLAI_DATHANHTOAN        , GIATRI_BENHNHAN_DATHANHTOAN        , GIATRI_THATTHU        , MIENGIAM_TL        , MIENGIAM_GIATRI        , NGANSACH_TL        , NGANSACH_GIATRI        , TAITRO_TL        , TAITRO_GIATRI        , BHTN_TL        , BHTN_DONGIA        , BHTN_THANHTIEN        , BHTN_DONGIA_CHITRA        , BHTN_THANHTIEN_CHITRA         ,           DUOCPHEPTHUCHIEN         ,           HUY         ,           DATHANHTOAN         ,           DATHUCHIEN         ,           KHONGTHUTIEN         ,           BHYTDONGTIEN                 , DUYET        , HOADON_ID         ,           ACTIVE         ,           TYLE_VAT         ,           GIAVON         ,           BANGGIA_ID                 , BENHVIEN_ID        , NGUOITAO_ID        , NGAYTAO        , NGUOICAPNHAT_ID        , NGAYCAPNHAT        , DONGIA_BHYT_BANDAU        , DONGIADOANHTHU_BANDAU         ,           YEUCAUVP         ,           DOITUONG_HUONG_ID         ,           SOBHYT_HUONG_ID         ,           DICHVU_TL                 ) values (         @param0         ,  @param1          ,            @param2          ,            @param3                  ,  @param4         ,  @param5         ,  @param6         ,  @param7         ,  @param8         ,  @param9         ,  @param10         ,  @param11         ,  @param12         ,  @param13         ,  @param14         ,  @param15         ,  @param16         ,  @param17         ,  @param18         ,  @param19         ,  @param20         ,  @param21         ,  @param22         ,  @param23         ,  @param24         ,  @param25         ,  @param26         ,  @param27         ,  @param28         ,  @param29         ,  @param30         ,  @param31         ,  @param32         ,  @param33         ,  @param34         ,  @param35         ,  @param36          ,            @param37          ,            @param38          ,            @param39          ,            @param40          ,            @param41          ,            @param42                  ,  @param43         ,  @param44          ,            @param45          ,            @param46          ,            @param47          ,            @param48                  ,  @param49         ,  @param50         ,  @param51         ,  @param52         ,  @param53         ,  @param54         ,  @param55          ,            @param56          ,            @param57          ,            @param58          ,            @param59                  )        SELECT SCOPE_IDENTITY()]
2020-01-02 17:32:16,451 [1] DEBUG - Statement Id: [DAO00023_Add] Parameters: [@param0=[TIEPNHAN_ID,28494], @param1=[BENHAN_ID,null], @param2=[BENHNHAN_ID,24442], @param3=[DOTDIEUTRI_ID,0], @param4=[KHAMBENH_ID,null], @param5=[REF_ID,206520], @param6=[REF_TABLE,TT_DVYEUCAU], @param7=[DICHVU_ID,5492], @param8=[DUOC_ID,null], @param9=[LOAI_CHIPHI,TT], @param10=[LOAIGIA_ID,2], @param11=[SOLUONG,1], @param12=[DONGIA_DOANHTHU,33000], @param13=[THANHTIEN_DOANHTHU,33000], @param14=[BHYT_TL,1], @param15=[BHYT_DONGIA,33000], @param16=[BHYT_THANHTIEN,33000], @param17=[BHYT_DONGIA_CHITRA,33000], @param18=[BHYT_THANHTIEN_CHITRA,33000], @param19=[BENHNHAN_PHAITHANHTOAN,0], @param20=[GIATRI_HOADON,0], @param21=[GIATRI_HOADON_DATHANHTOAN,0], @param22=[GIATRI_BIENLAI,0], @param23=[GIATRI_BIENLAI_DATHANHTOAN,0], @param24=[GIATRI_BENHNHAN_DATHANHTOAN,0], @param25=[GIATRI_THATTHU,0], @param26=[MIENGIAM_TL,0], @param27=[MIENGIAM_GIATRI,0], @param28=[NGANSACH_TL,0], @param29=[NGANSACH_GIATRI,0], @param30=[TAITRO_TL,0], @param31=[TAITRO_GIATRI,0], @param32=[BHTN_TL,0], @param33=[BHTN_DONGIA,0], @param34=[BHTN_THANHTIEN,0], @param35=[BHTN_DONGIA_CHITRA,0], @param36=[BHTN_THANHTIEN_CHITRA,0], @param37=[DUOCPHEPTHUCHIEN,0], @param38=[HUY,0], @param39=[DATHANHTOAN,0], @param40=[DATHUCHIEN,0], @param41=[KHONGTHUTIEN,0], @param42=[BHYTDONGTIEN,0], @param43=[DUYET,null], @param44=[HOADON_ID,null], @param45=[ACTIVE,1], @param46=[TYLE_VAT,0], @param47=[GIAVON,0], @param48=[BANGGIA_ID,996], @param49=[BENHVIEN_ID,HLU01], @param50=[NGUOITAO_ID,1], @param51=[NGAYTAO,1/2/2020 5:32:16 PM], @param52=[NGUOICAPNHAT_ID,1], @param53=[NGAYCAPNHAT,1/2/2020 5:32:16 PM], @param54=[DONGIA_BHYT_BANDAU,33000], @param55=[DONGIADOANHTHU_BANDAU,33000], @param56=[YEUCAUVP,0], @param57=[DOITUONG_HUONG_ID,4], @param58=[SOBHYT_HUONG_ID,29517], @param59=[DICHVU_TL,1]]
2020-01-02 17:32:16,451 [1] DEBUG - Statement Id: [DAO00023_Add] Types: [@param0=[Int32, System.Int32], @param1=[System.DBNull, null], @param2=[Int32, System.Int32], @param3=[Int32, System.Int32], @param4=[System.DBNull, null], @param5=[Int32, System.Int32], @param6=[String, System.String], @param7=[Int32, System.Int32], @param8=[System.DBNull, null], @param9=[String, System.String], @param10=[Int32, System.Int32], @param11=[Decimal, System.Decimal], @param12=[Decimal, System.Decimal], @param13=[Decimal, System.Decimal], @param14=[Decimal, System.Decimal], @param15=[Decimal, System.Decimal], @param16=[Decimal, System.Decimal], @param17=[Decimal, System.Decimal], @param18=[Decimal, System.Decimal], @param19=[Decimal, System.Decimal], @param20=[Decimal, System.Decimal], @param21=[Decimal, System.Decimal], @param22=[Decimal, System.Decimal], @param23=[Decimal, System.Decimal], @param24=[Decimal, System.Decimal], @param25=[Decimal, System.Decimal], @param26=[Decimal, System.Decimal], @param27=[Decimal, System.Decimal], @param28=[Decimal, System.Decimal], @param29=[Decimal, System.Decimal], @param30=[Decimal, System.Decimal], @param31=[Decimal, System.Decimal], @param32=[Decimal, System.Decimal], @param33=[Decimal, System.Decimal], @param34=[Decimal, System.Decimal], @param35=[Decimal, System.Decimal], @param36=[Decimal, System.Decimal], @param37=[Int32, System.Int32], @param38=[Int32, System.Int32], @param39=[Int32, System.Int32], @param40=[Int32, System.Int32], @param41=[String, System.String], @param42=[String, System.String], @param43=[System.DBNull, null], @param44=[System.DBNull, null], @param45=[Int32, System.Int32], @param46=[Int32, System.Int32], @param47=[Decimal, System.Decimal], @param48=[Int32, System.Int32], @param49=[String, System.String], @param50=[String, System.String], @param51=[DateTime, System.DateTime], @param52=[String, System.String], @param53=[DateTime, System.DateTime], @param54=[Decimal, System.Decimal], @param55=[Decimal, System.Decimal], @param56=[String, System.String], @param57=[Int32, System.Int32], @param58=[Int32, System.Int32], @param59=[Decimal, System.Decimal]]
2020-01-02 17:32:16,477 [1] DEBUG - Statement Id: [DAO00064_GetREGListVienphiTiepNhan] PreparedStatement : [select A.*, B.THUTIENSAU        from TT_VIENPHI A        left join TT_DVYEUCAU B on A.REF_ID =  B.DVYEUCAU_ID and A.REF_TABLE = 'TT_DVYEUCAU' and B.HUYYEUCAU = '0'        where        A.TIEPNHAN_ID = '28494' and A.BENHVIEN_ID = 'HLU01' and (A.BENHAN_ID is NULL or A.BENHAN_ID = '')        and A.HUY = '0'        ORDER BY A.VIENPHI_ID]
2020-01-02 17:32:16,524 [1] DEBUG - Statement Id: [DAO00064_GetTopTT_TIEPNHAN_SOTHEBHYT] PreparedStatement : [select top 1 stbhyt.*, ba.SOBENHAN,        tn.SOTIEPNHAN, tn.LOAITHANHVIEN_ID, tn.THE_ID, tn.THANHVIEN_ID,        tn.SUDUNG_BHTN, tn.BAOLANH_VIENPHI, tn.VIP, tn.NGUOINUOCNGOAI        from TT_TIEPNHAN_SOTHEBHYT stbhyt        left join TT_TIEPNHAN tn on tn.TIEPNHAN_ID = stbhyt.TIEPNHAN_ID        left join TT_NOITRU_BENHAN ba on ba.TIEPNHAN_ID = stbhyt.TIEPNHAN_ID        where        stbhyt.TIEPNHAN_ID = '28494' and isnull(stbhyt.KHONGSUDUNG, '0') = '0'        order by SOBHYT_HUONG_ID desc]
2020-01-02 17:32:16,550 [1] DEBUG - Statement Id: [DAO00006_GetListDuocTyle] PreparedStatement : [select DUOC_ID, DOITUONG_ID, (TYLE/100) as TYLE, DONGIA MUCTRAN_THANHTOAN from TM_DOITUONG_GIADUOC_TYLE            where            BENHVIEN_ID = 'HLU01'            and DOITUONG_ID = '4']
2020-01-02 17:32:16,573 [1] DEBUG - Statement Id: [DAO00027_GetListTuongTrinhDichVuPhauThuatCuaTiepNhan] PreparedStatement : [declare @ManhomDSA varchar(10);        declare @PhanLoaiNhomDV varchar(20) = '05';        select top 1  @ManhomDSA = VALUE from TM_SYS_APPSETTINGS where CODE = 'MANHOM_DICHVU_DSA'        if (@ManhomDSA is not null) set @PhanLoaiNhomDV += ',' + @ManhomDSA        select distinct ptyc.*        from TT_PHAUTHUAT_YEUCAU ptyc        inner join TM_DICHVU dv on dv.DICHVU_ID = ptyc.DICHVU_ID        inner join TM_NHOMDICHVU ndv on ndv.NHOMDICHVU_ID = dv.NHOMDICHVU_ID        inner join TT_PHAUTHUAT pt on pt.PHAUTHUAT_ID = ptyc.PHAUTHUAT_ID        where        pt.TIEPNHAN_ID = 28494        and (left(ndv.MANHOMDICHVU, 2) in (select * from STRING_SPLIT(@PhanLoaiNhomDV,',')) or ndv.MANHOMDICHVU in (select * from STRING_SPLIT(@PhanLoaiNhomDV,',')))]
2020-01-02 17:32:16,605 [1] DEBUG - Statement Id: [DAO00006_GetList] PreparedStatement : [select dv.*, loaiDV.MALOAIDICHVU, captren.NHOMDICHVU_ID as NHOMDICHVU_CAPTREN_ID, captren.TENNHOMDICHVU as NHOMDICHVU_CAPTREN,              nhom_dv.TENNHOMDICHVU as TENNHOMDICHVU, nhom_dv.MANHOMDICHVU,              case when dv.ATTRIBUTE5 is null then 'TT' else 'KTC' end as LOAI_CHIPHI              from TM_DICHVU as dv              left join TM_NHOMDICHVU as nhom_dv on nhom_dv.NHOMDICHVU_ID = dv.NHOMDICHVU_ID and nhom_dv.BENHVIEN_ID = 'HLU01'              left join TM_NHOMDICHVU as captren on nhom_dv.CAPTREN_ID = captren.NHOMDICHVU_ID and captren.BENHVIEN_ID = 'HLU01'              left join TM_LOAIDICHVU loaiDV on nhom_dv.LOAIDICHVU_ID = loaiDV.LOAIDICHVU_ID and loaiDV.BENHVIEN_ID = 'HLU01'              where nhom_dv.TAMNGUNG = '0' and dv.BENHVIEN_ID = 'HLU01'              and dv.TAMNGUNG = '0'               AND                   loaiDV.MALOAIDICHVU = 'KhamBenh']
2020-01-02 17:32:16,634 [1] DEBUG - Statement Id: [DAO00027_GetDichvuYCBHYTTyle] PreparedStatement : [select DVYEUCAU_ID from TT_DVYEUCAU        where TIEPNHAN_ID = 28494 and isnull(BHYT_TYLETHANHTOAN_ID, 0) > 0]
2020-01-02 17:32:16,658 [1] DEBUG - Statement Id: [DAO00023_Update_VPTiepnhan] PreparedStatement : [update TT_VIENPHI set        TIEPNHAN_ID =  @param0                ,           BENHNHAN_ID =  @param1          ,           REF_ID =  @param2                  , REF_TABLE =  @param3         , DICHVU_ID =  @param4         , DUOC_ID =  @param5         , LOAI_CHIPHI =  @param6         , LOAIGIA_ID =  @param7         , SOLUONG =  @param8         , DONGIA_DOANHTHU =  @param9         , THANHTIEN_DOANHTHU =  @param10         , BHYT_TL =  @param11         , BHYT_DONGIA =  @param12         , BHYT_THANHTIEN =  @param13         , BHYT_DONGIA_CHITRA =  @param14         , BHYT_THANHTIEN_CHITRA =  @param15         , BENHNHAN_PHAITHANHTOAN =  @param16         , GIATRI_HOADON =  @param17         , GIATRI_HOADON_DATHANHTOAN =  @param18         , GIATRI_BIENLAI =  @param19         , GIATRI_BIENLAI_DATHANHTOAN =  @param20         , GIATRI_BENHNHAN_DATHANHTOAN =  @param21         , GIATRI_THATTHU =  @param22         , MIENGIAM_TL =  @param23         , NGANSACH_TL =  @param24         , NGANSACH_GIATRI =  @param25         , TAITRO_TL =  @param26         , TAITRO_GIATRI =  @param27         , BHTN_TL =  @param28         , BHTN_DONGIA =  @param29         , BHTN_THANHTIEN =  @param30         , BHTN_DONGIA_CHITRA =  @param31         , BHTN_THANHTIEN_CHITRA =  @param32          ,           TYLE_VAT =  @param33          ,           GIAVON =  @param34          ,           BANGGIA_ID =  @param35          ,           BHYTDONGTIEN =  @param36          ,           BHYT_DONGIA_CONGKHAM_DAU =  @param37          ,           BHYT_CONGKHAM_DAU_TYLE =  @param38                  , BENHVIEN_ID =  @param39         , NGUOICAPNHAT_ID =  @param40         , NGAYCAPNHAT =  @param41          ,           DONGIA_BHYT_BANDAU =  @param42          ,           YEUCAUVP =  @param43                        where                    VIENPHI_ID = '675811' and DATHANHTOAN = '0']
2020-01-02 17:32:16,658 [1] DEBUG - Statement Id: [DAO00023_Update_VPTiepnhan] Parameters: [@param0=[TIEPNHAN_ID,28494], @param1=[BENHNHAN_ID,24442], @param2=[REF_ID,206520], @param3=[REF_TABLE,TT_DVYEUCAU], @param4=[DICHVU_ID,5492], @param5=[DUOC_ID,null], @param6=[LOAI_CHIPHI,TT], @param7=[LOAIGIA_ID,2], @param8=[SOLUONG,1.0000], @param9=[DONGIA_DOANHTHU,33000.0000], @param10=[THANHTIEN_DOANHTHU,33000.00], @param11=[BHYT_TL,1], @param12=[BHYT_DONGIA,33000.0000], @param13=[BHYT_THANHTIEN,33000.00], @param14=[BHYT_DONGIA_CHITRA,33000], @param15=[BHYT_THANHTIEN_CHITRA,33000.00], @param16=[BENHNHAN_PHAITHANHTOAN,0], @param17=[GIATRI_HOADON,0], @param18=[GIATRI_HOADON_DATHANHTOAN,0], @param19=[GIATRI_BIENLAI,0], @param20=[GIATRI_BIENLAI_DATHANHTOAN,0], @param21=[GIATRI_BENHNHAN_DATHANHTOAN,0], @param22=[GIATRI_THATTHU,0], @param23=[MIENGIAM_TL,0], @param24=[NGANSACH_TL,0], @param25=[NGANSACH_GIATRI,0], @param26=[TAITRO_TL,0], @param27=[TAITRO_GIATRI,0], @param28=[BHTN_TL,0], @param29=[BHTN_DONGIA,0], @param30=[BHTN_THANHTIEN,0], @param31=[BHTN_DONGIA_CHITRA,0], @param32=[BHTN_THANHTIEN_CHITRA,0], @param33=[TYLE_VAT,0], @param34=[GIAVON,0.0000], @param35=[BANGGIA_ID,996], @param36=[BHYTDONGTIEN,0], @param37=[BHYT_DONGIA_CONGKHAM_DAU,33000.0000], @param38=[BHYT_CONGKHAM_DAU_TYLE,1], @param39=[BENHVIEN_ID,HLU01], @param40=[NGUOICAPNHAT_ID,1], @param41=[NGAYCAPNHAT,1/2/2020 5:32:16 PM], @param42=[DONGIA_BHYT_BANDAU,33000.0000], @param43=[YEUCAUVP,0]]
2020-01-02 17:32:16,658 [1] DEBUG - Statement Id: [DAO00023_Update_VPTiepnhan] Types: [@param0=[Int32, System.Int32], @param1=[Int32, System.Int32], @param2=[Int32, System.Int32], @param3=[String, System.String], @param4=[Int32, System.Int32], @param5=[System.DBNull, null], @param6=[String, System.String], @param7=[Int32, System.Int32], @param8=[Decimal, System.Decimal], @param9=[Decimal, System.Decimal], @param10=[Decimal, System.Decimal], @param11=[Decimal, System.Decimal], @param12=[Decimal, System.Decimal], @param13=[Decimal, System.Decimal], @param14=[Decimal, System.Decimal], @param15=[Decimal, System.Decimal], @param16=[Decimal, System.Decimal], @param17=[Decimal, System.Decimal], @param18=[Decimal, System.Decimal], @param19=[Decimal, System.Decimal], @param20=[Decimal, System.Decimal], @param21=[Decimal, System.Decimal], @param22=[Decimal, System.Decimal], @param23=[Decimal, System.Decimal], @param24=[Decimal, System.Decimal], @param25=[Decimal, System.Decimal], @param26=[Decimal, System.Decimal], @param27=[Decimal, System.Decimal], @param28=[Decimal, System.Decimal], @param29=[Decimal, System.Decimal], @param30=[Decimal, System.Decimal], @param31=[Decimal, System.Decimal], @param32=[Decimal, System.Decimal], @param33=[Int32, System.Int32], @param34=[Decimal, System.Decimal], @param35=[Int32, System.Int32], @param36=[String, System.String], @param37=[Decimal, System.Decimal], @param38=[Decimal, System.Decimal], @param39=[String, System.String], @param40=[Int32, System.Int32], @param41=[DateTime, System.DateTime], @param42=[Decimal, System.Decimal], @param43=[String, System.String]]
2020-01-02 17:32:16,733 [1] DEBUG - Statement Id: [DAO00019_GetDetails_TiepNhan] PreparedStatement : [select tn.TIEPNHAN_ID, tn.SOTIEPNHAN, tn.SOBHYT as SOTHE, tn.BHYTTUNGAY as NGAYHIEULUC,        tn.BHYTDENNGAY as NGAYHETHIEULUC, tn.BHYTNGAYCAP as NGAYCAP, tn.BHYTTREN3NAM as TREN3NAM, tn.KHUVUCSONG_ID,        tn.BHYTTREN5NAM as TREN5NAM,tn.NGAYMIENDONGCHITRA,tn.NOIGIOITHIEU_ID, tn.NGUOIGIOITHIEU_ID, tn.CHANDOANNGT,        tn.NOITIEPNHAN_ID, tn.DOITUONG_ID, tn.TRAITUYEN, tn.HINHTHUCDENKHAM_ID, tn.THOIGIANTIEPNHAN,        dv.DVYEUCAU_ID, dv.DICHVU_ID, dv.NOITHUCHIEN_ID as PHONGBAN_ID,        dv.NGUOITAO_ID as DV_NGUOITAO_ID, dv.NGAYTAO as DV_NGAYTAO, dv.THUTIENSAU, dv.BACSICHIDINH_ID, dv.NGUOICHIDINH_ID,        dv.NGUOICAPNHAT_ID as DV_NGUOICAPNHAT_ID, dv.NGAYCAPNHAT as DV_NGAYCAPNHAT,        vp.VIENPHI_ID, vp.KHONGTHUTIEN, vp.LOAI_CHIPHI, vp.LOAIGIA_ID as LOAIGIA,        vp.DATHUCHIEN, vp.DATHANHTOAN, vp.DONGIA_DOANHTHU,        dv.NOITHUCHIEN_ID, dv.TRANGTHAI,        vp.NGUOITAO_ID as VP_NGUOITAO_ID, vp.BHYT_DONGIA, vp.TYLE_VAT, vp.BANGGIA_ID, vp.GIAVON,        tn.NGAYTAO as TN_NGAYTAO,        vp.NGAYTAO as VP_NGAYTAO, vp.NGUOICAPNHAT_ID as VP_NGUOICAPNHAT_ID, vp.NGAYCAPNHAT as VP_NGAYCAPNHAT,        tn.SOCHUYENVIEN, tn.THOIGIANCHUYENTUYEN, tn.HINHTHUCCHUYENVIEN_ID, tn.LYDOCHUYENVIEN_ID, tn.ICDNOIGIOITHIEU_ID,        tn.SUDUNG_BHTN, tn.THE_ID, tn.LOAITHANHVIEN_ID, tn.THANHVIEN_ID, tn.VIP, tn.GHICHU_TIEPNHAN, tn.BAOLANH_VIENPHI        , tn.CONGTY_CHITRA_ID, tn.TRANGTHAI as TRANGTHAI_TIEPNHAN, tn.NGUOITAO_ID as TN_NGUOITAO_ID, tn.TINHTRANGHEN        , tn.NGUON_BENHNHAN_ID, tn.THONGTIN_KCB_BHYT, tn.LOAITIEPNHAN_ID, tn.LYDODENKHAM, vp.YEUCAUVP        from (        select top 1 *        from TT_TIEPNHAN        where BENHVIEN_ID = 'HLU01'                 order by                 SOTIEPNHAN desc        ) as tn        left join TT_DVYEUCAU dv on dv.TIEPNHAN_ID = tn.TIEPNHAN_ID and dv.HUYYEUCAU = '0'        left join TT_VIENPHI vp on vp.TIEPNHAN_ID = tn.TIEPNHAN_ID and vp.DICHVU_ID = dv.DICHVU_ID  and dv.DVYEUCAU_ID = vp.REF_ID]
2020-01-02 17:32:38,168 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'OPD22'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2020-01-02 17:32:39,257 [1] DEBUG - Statement Id: [DAO00019_GetDanhsachKhambenh] PreparedStatement : [select *        from        (SELECT COUNT(*) OVER() as TOTALROWS, ROW_NUMBER() OVER(order by isnull(dv.SOTHUTU,'999999999'), dv.NGAYGIOYEUCAU) as ROWNUMBER,        bn.MAYTE, bn.TENBENHNHAN, bn.NAMSINH, bn.NGAYSINH as TUOI, ISNULL(CONVERT(VARCHAR(10), bn.NGAYSINH, 103),CAST(bn.NAMSINH AS varchar)) as NGAYSINH, bn.DIACHILIENLAC as DIACHI, bn.GIOITINH, GD.DESCRIPTION as TENGIOITINH,        tn.DOITUONG_ID, tn.THOIGIANTIEPNHAN, tn.BENHNHAN_ID, tn.TIEPNHAN_ID, tn.TRAITUYEN, tn.SOTIEPNHAN,        dv.DICHVU_ID, dv.NOITHUCHIEN_ID, isnull(dv.NGAYTAO, dv.NGAYCAPNHAT) as THOIGIANDKDICHVU,        dv.KHAN, dv.NOIYEUCAU_ID, dv.NGAYGIOYEUCAU, dv.BACSICHIDINH_ID, dv.DONVIGIOITHIEU_ID, dv.NGUOIGIOITHIEU_ID,        tn.NOIGIOITHIEU_ID, kbnt.HUONGGIAIQUYET_ID,        dv.DVYEUCAU_ID, dv.MARIS, dv.TRANGTHAI as TRANGTHAICODE, B.TENNHOMDICHVU, dv.SOPHIEUYEUCAU, dv.KHAMBENH_NGOAITRU_ID, dv.NGUOICAPNHAT_ID, dv.NGAYCAPNHAT,        CASE WHEN Left(B.MANHOMDICHVU,2) = '03' THEN '02' ELSE Left(B.MANHOMDICHVU,2) END AS MANHOMDICHVU, B.MANHOMDICHVU as MANHOMDICHVUCHITIET, tn.TRANGTHAI as TRANGTHAI_TIEPNHAN,        'False' as DAKHAM, isnull(dv.SOTHUTU,'999999999') as SOHANGDOI,        vp.DATHANHTOAN, dv.TRANGTHAI_WFL,        BA.SOBENHAN, dv.CHANDOAN, dt.TENDOITUONG, isnull(kbnt.THOIGIANKHAM, dv.NGAYCAPNHAT) as THOIGIANKHAM,        tn.SOBHYT        FROM TT_DVYEUCAU (NOLOCK) dv        inner join TT_TIEPNHAN (NOLOCK) tn on dv.TIEPNHAN_ID = tn.TIEPNHAN_ID        inner join TT_BENHNHAN (NOLOCK) bn on tn.BENHNHAN_ID = bn.BENHNHAN_ID        inner join TM_DICHVU A on A.DICHVU_ID = dv.DICHVU_ID        inner join TM_NHOMDICHVU B on B.NHOMDICHVU_ID = A.NHOMDICHVU_ID        inner join TT_VIENPHI(NOLOCK) VP on VP.TIEPNHAN_ID = tn.TIEPNHAN_ID and VP.DICHVU_ID = dv.DICHVU_ID and VP.REF_ID = dv.DVYEUCAU_ID        left join TT_NOITRU_BENHAN (NOLOCK) BA on BA.TIEPNHAN_ID = tn.TIEPNHAN_ID AND dv.BENHAN_ID = BA.BENHAN_ID        inner join TM_GENDER GD on GD.ID = bn.GIOITINH        left join TT_NGOAITRU_KHAMBENH (NOLOCK) kbnt on kbnt.KHAMBENH_ID = dv.KHAMBENH_NGOAITRU_ID        inner join TM_DOITUONG dt on dt.DOITUONG_ID = tn.DOITUONG_ID        where        dv.DICHVU_ID IS NOT NULL        and tn.BENHVIEN_ID = 'HLU01'        and HUYYEUCAU = 0        and dv.NGAYHENCLS is NULL         and           dv.NGAYYEUCAU >= '1/2/2020 12:00:00 AM'         and           dv.NGAYYEUCAU <= '1/2/2020 12:00:00 AM'         and           dv.NOITHUCHIEN_ID = 62          AND             (                         ((dv.TRANGTHAI_WFL = 'CHUAKETQUA' or (dv.TRANGTHAI = 'CHUAKETQUA' and dv.TRANGTHAI_WFL = 'HOANTHANH')) and (isnull(kbnt.HUONGGIAIQUYET_ID, 0) = 0)))            and (tn.TRANGTHAI != 'HOANTHANH')           and           (CASE WHEN Left(B.MANHOMDICHVU,2) = '03' THEN '02' ELSE Left(B.MANHOMDICHVU,2) END) = '04'                 ) lst                    where          lst.ROWNUMBER between 1 and 5                 order by SOHANGDOI, NGAYGIOYEUCAU asc]
2020-01-02 17:36:50,108 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'OPD02'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2020-01-02 17:36:52,839 [1] DEBUG - Statement Id: [DAO00017_GetLoaiGiaByDoiTuongId] PreparedStatement : [select dtlg.DOUUTIEN, dtlg.DOITUONG_ID, lg.LOAIGIA_ID, lg.TENLOAIGIA, lg.MALOAIGIA              from TM_LOAIGIA lg              left join TM_DOITUONG_LOAIGIA dtlg              on lg.LOAIGIA_ID = dtlg.LOAIGIA_ID and dtlg.BENHVIEN_ID = 'HLU01'              where lg.TAMNGUNG = 0 and lg.BENHVIEN_ID = 'HLU01'                             order by dtlg.DOUUTIEN]
2020-01-02 17:36:53,274 [1] DEBUG - Statement Id: [DAO00092_GetList_ToathuocNgoaitru] PreparedStatement : [select A.*, B.PHAMVI_ID, C.KHODUOC_ID from TM_TOATHUOC_NGOAITRU A        left join TM_DUOC_PHAMVISUDUNG B on B.MAPHAMVI = A.MAPHAMVI        left join (select distinct PHAMVI_ID, KHODUOC_ID from TM_DUOC_PHAMVISD_MAPPING) C on C.PHAMVI_ID = B.PHAMVI_ID        where A.TAMNGUNG != '1' and A.BENHVIEN_ID = 'HLU01'        ORDER BY A.SAPXEP ASC]
2020-01-02 17:36:53,381 [1] DEBUG - Statement Id: [DAO00012_GetLoaiTCLS] PreparedStatement : [select DICTIONARY_ID, DICTIONARY_CODE, DICTIONARY_NAME, cast('0' as Bit) CHON        from LST_DICTIONARY              where DICTIONARY_TYPE_CODE = 'KHAMBENH_LOAI_TRIEUCHUNGLS'        order by LST_DICTIONARY.IDX]
2020-01-02 17:36:53,498 [1] DEBUG - Statement Id: [DAO00012_GetAllTCLS] PreparedStatement : [select MALOAITRIEUCHUNG DICTIONARY_TYPE_CODE, MALOAITRIEUCHUNG DICTIONARY_CODE,        TENTRIEUCHUNG DICTIONARY_NAME from TM_TRIEUCHUNGLS]
2020-01-02 17:37:11,657 [1] DEBUG - Statement Id: [DAO00017_GetLoaiGiaByDoiTuongId] PreparedStatement : [select dtlg.DOUUTIEN, dtlg.DOITUONG_ID, lg.LOAIGIA_ID, lg.TENLOAIGIA, lg.MALOAIGIA              from TM_LOAIGIA lg              left join TM_DOITUONG_LOAIGIA dtlg              on lg.LOAIGIA_ID = dtlg.LOAIGIA_ID and dtlg.BENHVIEN_ID = 'HLU01'              where lg.TAMNGUNG = 0 and lg.BENHVIEN_ID = 'HLU01'                             order by dtlg.DOUUTIEN]
2020-01-02 17:37:11,810 [1] DEBUG - Statement Id: [DAO00012_GetLoaiTCLS] PreparedStatement : [select DICTIONARY_ID, DICTIONARY_CODE, DICTIONARY_NAME, cast('0' as Bit) CHON        from LST_DICTIONARY              where DICTIONARY_TYPE_CODE = 'KHAMBENH_LOAI_TRIEUCHUNGLS'        order by LST_DICTIONARY.IDX]
2020-01-02 17:37:11,836 [1] DEBUG - Statement Id: [DAO00012_GetAllTCLS] PreparedStatement : [select MALOAITRIEUCHUNG DICTIONARY_TYPE_CODE, MALOAITRIEUCHUNG DICTIONARY_CODE,        TENTRIEUCHUNG DICTIONARY_NAME from TM_TRIEUCHUNGLS]
2020-01-02 17:39:22,339 [1] DEBUG - Statement Id: [DAO00017_GetLoaiGiaByDoiTuongId] PreparedStatement : [select dtlg.DOUUTIEN, dtlg.DOITUONG_ID, lg.LOAIGIA_ID, lg.TENLOAIGIA, lg.MALOAIGIA              from TM_LOAIGIA lg              left join TM_DOITUONG_LOAIGIA dtlg              on lg.LOAIGIA_ID = dtlg.LOAIGIA_ID and dtlg.BENHVIEN_ID = 'HLU01'              where lg.TAMNGUNG = 0 and lg.BENHVIEN_ID = 'HLU01'                             order by dtlg.DOUUTIEN]
2020-01-02 17:39:22,492 [1] DEBUG - Statement Id: [DAO00012_GetLoaiTCLS] PreparedStatement : [select DICTIONARY_ID, DICTIONARY_CODE, DICTIONARY_NAME, cast('0' as Bit) CHON        from LST_DICTIONARY              where DICTIONARY_TYPE_CODE = 'KHAMBENH_LOAI_TRIEUCHUNGLS'        order by LST_DICTIONARY.IDX]
2020-01-02 17:39:22,517 [1] DEBUG - Statement Id: [DAO00012_GetAllTCLS] PreparedStatement : [select MALOAITRIEUCHUNG DICTIONARY_TYPE_CODE, MALOAITRIEUCHUNG DICTIONARY_CODE,        TENTRIEUCHUNG DICTIONARY_NAME from TM_TRIEUCHUNGLS]
2020-01-02 17:39:22,549 [1] DEBUG - Statement Id: [DAO00019_ThongTinBenhNhanDvYeuCau] PreparedStatement : [select distinct A.SOTIEPNHAN, A.TIEPNHAN_ID, A.DOITUONG_ID, A.TRANGTHAI,        A.LOAITHANHVIEN_ID, A.SUDUNG_BHTN, A.THE_ID, A.THANHVIEN_ID, A.VIP, A.NGUON_BENHNHAN_ID, A.BAOLANH_VIENPHI, A.NGAYMIENDONGCHITRA,        B.*,  C.DICHVU_ID, C.DVYEUCAU_ID, C.NOITHUCHIEN_ID, A.SOBHYT        from TT_TIEPNHAN A        inner join TT_DVYEUCAU C on C.TIEPNHAN_ID = A.TIEPNHAN_ID        inner join TT_BENHNHAN B on B.BENHNHAN_ID = A.BENHNHAN_ID and B.ACTIVE = '1'        where                    C.DVYEUCAU_ID = '206519'                 and A.BENHVIEN_ID = 'HLU01']
2020-01-02 17:39:22,672 [1] DEBUG - Statement Id: [DAO00017_GetLoaiGiaByDoiTuongId] PreparedStatement : [select dtlg.DOUUTIEN, dtlg.DOITUONG_ID, lg.LOAIGIA_ID, lg.TENLOAIGIA, lg.MALOAIGIA              from TM_LOAIGIA lg              left join TM_DOITUONG_LOAIGIA dtlg              on lg.LOAIGIA_ID = dtlg.LOAIGIA_ID and dtlg.BENHVIEN_ID = 'HLU01'              where lg.TAMNGUNG = 0 and lg.BENHVIEN_ID = 'HLU01'                             order by dtlg.DOUUTIEN]
2020-01-02 17:39:22,772 [1] DEBUG - Statement Id: [DAO00014_KiemTraDVYCCoGiaBHYT] PreparedStatement : [select *        from TT_VIENPHI        where REF_ID  = '206519' and REF_TABLE = 'TT_DVYEUCAU' and BHYT_DONGIA > 0]
2020-01-02 17:39:22,845 [1] DEBUG - Statement Id: [DAO00040_LayListToaMau] PreparedStatement : [select A.*, dc.TENDUOCDAYDU, dc.BHYT DUOC_BHYT, ld.LOAIVATTU_ID, ld.MALOAIDUOC, dd.DICTIONARY_NAME DUONGDUNG, dc.TAMNGUNG            from TT_TOATHUOCMAU A            left join TM_DUOC dc on A.DUOC_ID = dc.DUOC_ID            left join TM_LOAIDUOC ld on dc.LOAIDUOC_ID = ld.LOAIDUOC_ID            left join (select * from LST_DICTIONARY where DICTIONARY_TYPE_CODE like 'DuongDung') dd on dd.DICTIONARY_ID = dc.DUONGDUNG_ID            where (1=1)             and               A.BACSI_ID  = 1              and A.LOAITOATHUOC in  (                        @param0                   ,                           @param1                   ,                           @param2                   ,                           @param3                   )]
2020-01-02 17:39:22,846 [1] DEBUG - Statement Id: [DAO00040_LayListToaMau] Parameters: [@param0=[LSTLOAITOATHUOC[0],BV], @param1=[LSTLOAITOATHUOC[1],MN], @param2=[LSTLOAITOATHUOC[2],MP], @param3=[LSTLOAITOATHUOC[3],TV]]
2020-01-02 17:39:22,846 [1] DEBUG - Statement Id: [DAO00040_LayListToaMau] Types: [@param0=[String, System.String], @param1=[String, System.String], @param2=[String, System.String], @param3=[String, System.String]]
2020-01-02 17:39:23,130 [1] DEBUG - Statement Id: [DAO00040_LayListToaMau] PreparedStatement : [select A.*, dc.TENDUOCDAYDU, dc.BHYT DUOC_BHYT, ld.LOAIVATTU_ID, ld.MALOAIDUOC, dd.DICTIONARY_NAME DUONGDUNG, dc.TAMNGUNG            from TT_TOATHUOCMAU A            left join TM_DUOC dc on A.DUOC_ID = dc.DUOC_ID            left join TM_LOAIDUOC ld on dc.LOAIDUOC_ID = ld.LOAIDUOC_ID            left join (select * from LST_DICTIONARY where DICTIONARY_TYPE_CODE like 'DuongDung') dd on dd.DICTIONARY_ID = dc.DUONGDUNG_ID            where (1=1)             and               A.BACSI_ID  = 1              and A.LOAITOATHUOC in  (                        @param0                   ,                           @param1                   ,                           @param2                   ,                           @param3                   )]
2020-01-02 17:39:23,130 [1] DEBUG - Statement Id: [DAO00040_LayListToaMau] Parameters: [@param0=[LSTLOAITOATHUOC[0],BV], @param1=[LSTLOAITOATHUOC[1],MN], @param2=[LSTLOAITOATHUOC[2],MP], @param3=[LSTLOAITOATHUOC[3],TV]]
2020-01-02 17:39:23,130 [1] DEBUG - Statement Id: [DAO00040_LayListToaMau] Types: [@param0=[String, System.String], @param1=[String, System.String], @param2=[String, System.String], @param3=[String, System.String]]
2020-01-02 17:39:23,291 [1] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoVaBookingCOM23UpdateRedis_TheoPhamvi] PreparedStatement : [declare @TOAMUANGOAI int = 0;        select @TOAMUANGOAI = isnull(VALUE,0) from TM_SYS_APPSETTINGS where CODE = 'OPD_TOAMUANGOAI_DUNGDANHMUC_DUOC'                if @TOAMUANGOAI = 1        begin        select  distinct '0' + '_' + LTRIM(d.DUOC_ID) + '_' + '0' as DUOC_KEY, 999999999 as SOLUONG        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        where  @param0  = 0        union all        select distinct tk.DUOC_KEY, tk.SOLUONG        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        inner join        (        select  LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')) DUOC_KEY, (SUM(dtk.SOLUONG) - isnull(sum(A.SOLUONG),0) - isnull(sum(B.SOLUONG),0)) SOLUONG, pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        from (select sum(soluong) soluong,duoc_id,nguonduoc_id,khoduoc_id,benhvien_id from TT_DUOC_TONKHO  group by duoc_id,nguonduoc_id,khoduoc_id,benhvien_id) dtk        inner join TM_DUOC_PHAMVISD_MAPPING pvsd on dtk.KHODUOC_ID = pvsd.KHODUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NOITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) B on B.DUOC_ID = dtk.DUOC_ID and B.PHAMVI_ID = pvsd.PHAMVI_ID and B.NGUONHANG_ID = dtk.NGUONDUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NGOAITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) A on A.DUOC_ID = dtk.DUOC_ID and A.PHAMVI_ID = pvsd.PHAMVI_ID and A.NGUONHANG_ID = dtk.NGUONDUOC_ID        where dtk.BENHVIEN_ID = 'HLU01'        group by LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')), pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        ) tk on tk.DUOC_ID = d.DUOC_ID        left join TM_DUOC_PHAMVISUDUNG kd on kd.PHAMVI_ID = tk.PHAMVI_ID and kd.BENHVIEN_ID = 'HLU01'        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = tk.NGUONDUOC_ID and nh.BENHVIEN_ID = 'HLU01'        where d.BENHVIEN_ID = 'HLU01' and tk.PHAMVI_ID =  @param0         end        else        begin        select distinct tk.DUOC_KEY, tk.SOLUONG        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        inner join        (        select  LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')) DUOC_KEY, (SUM(dtk.SOLUONG) - isnull(sum(A.SOLUONG),0) - isnull(sum(B.SOLUONG),0)) SOLUONG, pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        from (select sum(soluong) soluong,duoc_id,nguonduoc_id,khoduoc_id,benhvien_id from TT_DUOC_TONKHO  group by duoc_id,nguonduoc_id,khoduoc_id,benhvien_id) dtk        inner join TM_DUOC_PHAMVISD_MAPPING pvsd on dtk.KHODUOC_ID = pvsd.KHODUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NOITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) B on B.DUOC_ID = dtk.DUOC_ID and B.PHAMVI_ID = pvsd.PHAMVI_ID and B.NGUONHANG_ID = dtk.NGUONDUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NGOAITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) A on A.DUOC_ID = dtk.DUOC_ID and A.PHAMVI_ID = pvsd.PHAMVI_ID and A.NGUONHANG_ID = dtk.NGUONDUOC_ID        where dtk.BENHVIEN_ID = 'HLU01'        group by LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')), pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        ) tk on tk.DUOC_ID = d.DUOC_ID        left join TM_DUOC_PHAMVISUDUNG kd on kd.PHAMVI_ID = tk.PHAMVI_ID and kd.BENHVIEN_ID = 'HLU01'        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = tk.NGUONDUOC_ID and nh.BENHVIEN_ID = 'HLU01'        where d.BENHVIEN_ID = 'HLU01' and tk.PHAMVI_ID =  @param0         end]
2020-01-02 17:39:23,291 [1] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoVaBookingCOM23UpdateRedis_TheoPhamvi] Parameters: [@param0=[PHAMVI_ID,1028]]
2020-01-02 17:39:23,291 [1] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoVaBookingCOM23UpdateRedis_TheoPhamvi] Types: [@param0=[Int64, System.Int64]]
2020-01-02 17:39:23,617 [1] DEBUG - Statement Id: [DAO00013_GetTienSuBenh] PreparedStatement : [select TIENSUBENH, TIENSUDIUNG        from TT_BENHNHAN        where TT_BENHNHAN.BENHNHAN_ID  = '24441']
2020-01-02 17:39:24,037 [1] DEBUG - Statement Id: [DAO00095_GetTTDiUngThuoc] PreparedStatement : [select *              from TT_BENHNHAN_DIUNG_THUOC              where BENHNHAN_ID = '24441'              and BENHVIEN_ID = 'HLU01']
2020-01-02 17:39:24,062 [1] DEBUG - Statement Id: [DAO00014_GetTotalChiPhiDVByTiepNhan] PreparedStatement : [select sum(THANHTIEN_DOANHTHU) as THANHTIEN_DOANHTHU from TT_VIENPHI        where ACTIVE = '1'        and TIEPNHAN_ID = '28493'        and REF_TABLE = 'TT_DVYEUCAU'        and exists (select DVYEUCAU_ID from TT_DVYEUCAU where HUYYEUCAU = '0' and TIEPNHAN_ID = '28493' and TT_VIENPHI.REF_ID = DVYEUCAU_ID)]
2020-01-02 17:39:24,151 [1] DEBUG - Statement Id: [DAO00014_GetKhamBenhInfo] PreparedStatement : [select * from TT_NGOAITRU_KHAMBENH where KHAMBENH_ID =        (select KHAMBENH_NGOAITRU_ID from TT_DVYEUCAU where DVYEUCAU_ID = '206519')]
2020-01-02 17:39:24,184 [1] DEBUG - Statement Id: [DAO00014_GetSoCaKhamTrongNgay] PreparedStatement : [select Count(KB.KHAMBENH_ID) as SOCAKHAMTRONGNGAY        from TT_NGOAITRU_KHAMBENH KB        inner join TT_TIEPNHAN TN on TN.TIEPNHAN_ID = KB.TIEPNHAN_ID        where KB.NGAYKHAM = convert(date, GETDATE())        and KB.BACSIKHAM_ID = '1'        and KB.BENHVIEN_ID = 'HLU01'        and TN.SOBHYT IS NOT NULL and TN.SOBHYT != '']
2020-01-02 17:39:24,375 [1] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoVaBookingCOM23UpdateRedis_TheoPhamvi] PreparedStatement : [declare @TOAMUANGOAI int = 0;        select @TOAMUANGOAI = isnull(VALUE,0) from TM_SYS_APPSETTINGS where CODE = 'OPD_TOAMUANGOAI_DUNGDANHMUC_DUOC'                if @TOAMUANGOAI = 1        begin        select  distinct '0' + '_' + LTRIM(d.DUOC_ID) + '_' + '0' as DUOC_KEY, 999999999 as SOLUONG        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        where  @param0  = 0        union all        select distinct tk.DUOC_KEY, tk.SOLUONG        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        inner join        (        select  LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')) DUOC_KEY, (SUM(dtk.SOLUONG) - isnull(sum(A.SOLUONG),0) - isnull(sum(B.SOLUONG),0)) SOLUONG, pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        from (select sum(soluong) soluong,duoc_id,nguonduoc_id,khoduoc_id,benhvien_id from TT_DUOC_TONKHO  group by duoc_id,nguonduoc_id,khoduoc_id,benhvien_id) dtk        inner join TM_DUOC_PHAMVISD_MAPPING pvsd on dtk.KHODUOC_ID = pvsd.KHODUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NOITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) B on B.DUOC_ID = dtk.DUOC_ID and B.PHAMVI_ID = pvsd.PHAMVI_ID and B.NGUONHANG_ID = dtk.NGUONDUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NGOAITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) A on A.DUOC_ID = dtk.DUOC_ID and A.PHAMVI_ID = pvsd.PHAMVI_ID and A.NGUONHANG_ID = dtk.NGUONDUOC_ID        where dtk.BENHVIEN_ID = 'HLU01'        group by LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')), pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        ) tk on tk.DUOC_ID = d.DUOC_ID        left join TM_DUOC_PHAMVISUDUNG kd on kd.PHAMVI_ID = tk.PHAMVI_ID and kd.BENHVIEN_ID = 'HLU01'        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = tk.NGUONDUOC_ID and nh.BENHVIEN_ID = 'HLU01'        where d.BENHVIEN_ID = 'HLU01' and tk.PHAMVI_ID =  @param0         end        else        begin        select distinct tk.DUOC_KEY, tk.SOLUONG        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        inner join        (        select  LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')) DUOC_KEY, (SUM(dtk.SOLUONG) - isnull(sum(A.SOLUONG),0) - isnull(sum(B.SOLUONG),0)) SOLUONG, pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        from (select sum(soluong) soluong,duoc_id,nguonduoc_id,khoduoc_id,benhvien_id from TT_DUOC_TONKHO  group by duoc_id,nguonduoc_id,khoduoc_id,benhvien_id) dtk        inner join TM_DUOC_PHAMVISD_MAPPING pvsd on dtk.KHODUOC_ID = pvsd.KHODUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NOITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) B on B.DUOC_ID = dtk.DUOC_ID and B.PHAMVI_ID = pvsd.PHAMVI_ID and B.NGUONHANG_ID = dtk.NGUONDUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NGOAITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) A on A.DUOC_ID = dtk.DUOC_ID and A.PHAMVI_ID = pvsd.PHAMVI_ID and A.NGUONHANG_ID = dtk.NGUONDUOC_ID        where dtk.BENHVIEN_ID = 'HLU01'        group by LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')), pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        ) tk on tk.DUOC_ID = d.DUOC_ID        left join TM_DUOC_PHAMVISUDUNG kd on kd.PHAMVI_ID = tk.PHAMVI_ID and kd.BENHVIEN_ID = 'HLU01'        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = tk.NGUONDUOC_ID and nh.BENHVIEN_ID = 'HLU01'        where d.BENHVIEN_ID = 'HLU01' and tk.PHAMVI_ID =  @param0         end]
2020-01-02 17:39:24,375 [1] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoVaBookingCOM23UpdateRedis_TheoPhamvi] Parameters: [@param0=[PHAMVI_ID,1028]]
2020-01-02 17:39:24,375 [1] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoVaBookingCOM23UpdateRedis_TheoPhamvi] Types: [@param0=[Int64, System.Int64]]
2020-01-02 17:39:25,027 [1] DEBUG - Statement Id: [DAO00068_GetLastedSinhHieuInfo] PreparedStatement : [select top (1) *, CHISOBMI as BMI              from TT_NGOAITRU_KHAMBENH_SINHHIEU              where BENHNHAN_ID = '24441'              order by KHAMBENH_SINHHIEU_ID desc]
2020-01-02 17:40:06,523 [1] DEBUG - Statement Id: [DAO00014_GetPatientStatus] PreparedStatement : [select        CASE        when tn.TRANGTHAI = 'HOANTHANH' Then tn.TRANGTHAI        WHEN xncp.XACNHANCHIPHI_ID is not null THEN 'XACNHANCHIPHI'        WHEN (tn.KHOADULIEU = '1') THEN 'KHOADULIEU'        ELSE tn.TRANGTHAI        END        as TRANGTHAI        from TT_TIEPNHAN tn        left join TT_XACNHANCHIPHI xncp on tn.TIEPNHAN_ID = xncp.TIEPNHAN_ID        where tn.TIEPNHAN_ID = '28493'        and tn.BENHVIEN_ID = 'HLU01']
2020-01-02 17:40:06,605 [1] DEBUG - Statement Id: [DAO00014_GetTTDVYeucauOPD] PreparedStatement : [select A.KHAMBENH_NGOAITRU_ID, B.KHAMBENH_ID        from TT_DVYEUCAU A        left join TT_NGOAITRU_KHAMBENH B on A.KHAMBENH_NGOAITRU_ID = B.KHAMBENH_ID        where A.DVYEUCAU_ID = '206519' and A.TIEPNHAN_ID =  @param0]
2020-01-02 17:40:06,605 [1] DEBUG - Statement Id: [DAO00014_GetTTDVYeucauOPD] Parameters: [@param0=[TIEPNHAN_ID,28493]]
2020-01-02 17:40:06,605 [1] DEBUG - Statement Id: [DAO00014_GetTTDVYeucauOPD] Types: [@param0=[Int64, System.Int64]]
2020-01-02 17:40:06,689 [1] DEBUG - Statement Id: [DAO00014_GetThongtinKhamsuckhoeTheoDVyc] PreparedStatement : [select HOPDONG_ID, HOPDONG_BENHNHAN_ID from TT_DVYEUCAU where DVYEUCAU_ID =  @param0]
2020-01-02 17:40:06,690 [1] DEBUG - Statement Id: [DAO00014_GetThongtinKhamsuckhoeTheoDVyc] Parameters: [@param0=[DVYEUCAU_ID,206519]]
2020-01-02 17:40:06,690 [1] DEBUG - Statement Id: [DAO00014_GetThongtinKhamsuckhoeTheoDVyc] Types: [@param0=[Int64, System.Int64]]
2020-01-02 17:40:06,725 [1] DEBUG - Statement Id: [DAO00009_TT_TIEPNHAN_GetProcess] PreparedStatement : [select PROCESS_ID from TT_TIEPNHAN where SOTIEPNHAN = 'TN200102.0000001']
2020-01-02 17:40:06,766 [1] DEBUG - Statement Id: [DAOWF004_laytrangthaiDV] PreparedStatement : [select top 1 A.CURR_STATE_CODE as STATE_CODE, isNull(C.SHORT_NAME,C.NAME) as TRANGTHAI, C.NAME as TRANGTHAI_CHITIET, C.STATUS_CODE, D.ISACTIVE as ACTIVE, E.STATUS_CODE  as OLD_STATUSCODE        from TT_REQUEST_SERVICE_DETAIL A                left join (select * from TT_REQUEST_SERVICE where PARA = '{"DICHVU_ID":"5492","DVYEUCAU_ID":"206519"}') D on D.ID = A.REQUEST_SERVICE_ID        left join TM_STATE C on A.CURR_STATE_CODE = C.STATE_CODE and C.PROCESS_CODE = D.PROCESS_CODE        left join TM_STATE E on A.OLD_STATE_CODE = E.STATE_CODE and E.PROCESS_CODE = D.PROCESS_CODE        where        A.REQUEST_SERVICE_ID = (select top 1 ID from TT_REQUEST_SERVICE where PARA = '{"DICHVU_ID":"5492","DVYEUCAU_ID":"206519"}' order by ID desc)        order by A.ID desc]
2020-01-02 17:40:07,531 [1] DEBUG - Statement Id: [DAO00014_CheckExistNhapVien] PreparedStatement : [select NHAPVIEN_ID        from TT_NOITRU_NHAPVIEN        where TIEPNHAN_ID  = '28493'        and TRANGTHAI != 'CHOXACNHAN']
2020-01-02 17:40:07,561 [1] DEBUG - Statement Id: [DAO00014_CheckExistCapCuu] PreparedStatement : [select THONGTINCAPCUU_ID        from TT_TIEPNHAN_THONGTINCAPCUU        where TIEPNHAN_ID  = '28493' and BENHVIEN_ID = 'HLU01']
2020-01-02 17:40:07,648 [1] DEBUG - Statement Id: [DAO00014_CheckExistChuyenVien] PreparedStatement : [select CHUYENVIEN_ID        from TT_CHUYENVIEN        where TIEPNHAN_ID  = '28493']
2020-01-02 17:40:07,920 [1] DEBUG - Statement Id: [DAO00014_GetTrangThaiTiepNhan] PreparedStatement : [select tn.TIEPNHAN_ID, tn.KHOADULIEU, xncp.XACNHANCHIPHI_ID from TT_TIEPNHAN tn        left join TT_XACNHANCHIPHI xncp        on tn.TIEPNHAN_ID = xncp.TIEPNHAN_ID        where tn.TIEPNHAN_ID = '28493'        and tn.BENHVIEN_ID = 'HLU01']
2020-01-02 17:40:07,960 [1] DEBUG - Statement Id: [DAO00014_CheckExistsToaThuoc_ByTiepNhan_ID] PreparedStatement : [select count(KHAMBENH_TOATHUOC_ID)        from TT_NGOAITRU_KHAMBENH_TOATHUOC        where        TIEPNHAN_ID = '28493' and LOAITOATHUOC = 'BV']
2020-01-02 17:40:08,047 [1] DEBUG - Statement Id: [DAO00014_CheckBenhNhanChuaXSDVTYT] PreparedStatement : [IF EXISTS (        select vt.KHAMBENH_VTYT_ID        from TT_NGOAITRU_KHAMBENH_VTYT vt        inner join TT_NGOAITRU_KHAMBENH kb on kb.KHAMBENH_ID = vt.KHAMBENH_ID        where kb.TIEPNHAN_ID = 28493        and kb.BENHVIEN_ID = 'HLU01'        and vt.CHUNGTU_ID is null          union all          select vt.CLSKETQUA_VTYT_ID        from TT_CLSKETQUA_VTYT vt        inner join TT_DVYEUCAU yc on yc.DVYEUCAU_ID = vt.DVYEUCAU_ID and yc.BENHVIEN_ID = vt.BENHVIEN_ID        where yc.TIEPNHAN_ID = 28493        and yc.BENHVIEN_ID = 'HLU01'        and vt.CHUNGTU_ID is null        )        BEGIN        SELECT -1 AS RESULT        END        ELSE        BEGIN        SELECT 1 AS RESULT        END]
2020-01-02 17:40:08,228 [1] DEBUG - Statement Id: [DAOLOG01_LockBegin] PreparedStatement : [INSERT into TT_LOG_UPDATE ( REF_TABLE , REF_ID , BENHVIEN_ID )         values ( @param0 ,  @param1 ,  @param2 );]
2020-01-02 17:40:08,228 [1] DEBUG - Statement Id: [DAOLOG01_LockBegin] Parameters: [@param0=[REF_TABLE,TT_NGOAITRU_KHAMBENH], @param1=[REF_ID,28493], @param2=[BENHVIEN_ID,HLU01]]
2020-01-02 17:40:08,228 [1] DEBUG - Statement Id: [DAOLOG01_LockBegin] Types: [@param0=[String, System.String], @param1=[Int64, System.Int64], @param2=[String, System.String]]
2020-01-02 17:40:08,294 [1] DEBUG - Statement Id: [DAO00014_GetTTNhapVien] PreparedStatement : [select *        from TT_NOITRU_NHAPVIEN        where TIEPNHAN_ID  = '28493']
2020-01-02 17:40:08,346 [1] DEBUG - Statement Id: [DAO00014_GetTTDVYeucauOPD] PreparedStatement : [select A.KHAMBENH_NGOAITRU_ID, B.KHAMBENH_ID        from TT_DVYEUCAU A        left join TT_NGOAITRU_KHAMBENH B on A.KHAMBENH_NGOAITRU_ID = B.KHAMBENH_ID        where A.DVYEUCAU_ID = '206519' and A.TIEPNHAN_ID =  @param0]
2020-01-02 17:40:08,346 [1] DEBUG - Statement Id: [DAO00014_GetTTDVYeucauOPD] Parameters: [@param0=[TIEPNHAN_ID,28493]]
2020-01-02 17:40:08,346 [1] DEBUG - Statement Id: [DAO00014_GetTTDVYeucauOPD] Types: [@param0=[String, System.String]]
2020-01-02 17:40:08,377 [1] DEBUG - Statement Id: [DAO00014_Add] PreparedStatement : [insert into TT_NGOAITRU_KHAMBENH (        BENHNHAN_ID        , TIEPNHAN_ID        , BENHAN_ID        , DICHVU_ID        , PHONGBAN_ID        , NGAYKHAM        , THOIGIANKHAM        , BACSIKHAM_ID        , DIEUDUONG_ID        , DOITUONG_ID        , CHANDOANICD_ID        , CHANDOANPHUICD_ID        , CHANDOANICD        , BENHMANTINH_ID        , HUONGGIAIQUYET_ID        , YEUCAUCHITIET_ID        , CHANDOANKHOAKHAM        , TLDG_MT        , TLDG_MP        , TKLT_MP        , TKLT_MT        , TLDG_MT_TEXT        , TLDG_MP_TEXT        , TKLT_MP_TEXT        , TKLT_MT_TEXT        , NHANAP_MT        , NHANAP_MP        , MACH        , CANNANG        , CHIEUCAO        , HUYETAPTHAP        , HUYETAPCAO        , NHIPTHO        , NHIETDO        , BMI        , TYLEMO        , VONGBUNG        , SIEUHIENVI        , SOIDAYMAT        , TRIEUCHUNGLAMSANG        , CHANDOANSOBOICD_ID        , CHANDOANSOBO        , CHUYENDENBENHVIEN_ID        , LYDONHAPVIEN_ID        , THOIGIANNHAPVIENDUKIEN        , KHAMBENHLANDAU_ID        , KHAMBENH_CHUYENKHOA_ID        , NHAPKHOA_ID        , CHUYENKHOA_ID        , NGHIOM_TUNGAY        , NGHIOM_DENNGAY        , HUONGDIEUTRI_ID        , CHEDOANUONG_ID        , CHEDOCHAMSOC_ID        , DIEUTRIDUPHONG        , SONGAYDIEUTRI        , GIAIDOANBENH        , TOATHUOCMUANGOAI        , TACDUNGPHU        , TUANTHUCUABN        , SONGAYHENTAIKHAM        , SOBENHANNGOAITRU_ID        , KHAMCAPCUU        , GHICHU        , KHOADULIEU        , NGUOIKHOA_ID        , NGAYKHOA        , THOIGIANKHOA        , BENHVIEN_ID        , NGAYTAO        , NGUOITAO_ID        , NGAYCAPNHAT        , NGUOICAPNHAT_ID        , KHAMBENH_SINHHIEU_ID        ) values (         @param0         ,  @param1         ,  @param2         ,  @param3         ,  @param4         ,  @param5         ,  @param6         ,  @param7         ,  @param8         ,  @param9         ,  @param10         ,  @param11         ,  @param12         ,  @param13         ,  @param14         ,  @param15         ,  @param16         ,  @param17         ,  @param18         ,  @param19         ,  @param20         ,  @param21         ,  @param22         ,  @param23         ,  @param24         ,  @param25         ,  @param26         ,  @param27         ,  @param28         ,  @param29         ,  @param30         ,  @param31         ,  @param32         ,  @param33         ,  @param34         ,  @param35         ,  @param36         ,  @param37         ,  @param38         ,  @param39         ,  @param40         ,  @param41         ,  @param42         ,  @param43         ,  @param44         ,  @param45         ,  @param46         ,  @param47         ,  @param48         ,  @param49         ,  @param50         ,  @param51         ,  @param52         ,  @param53         ,  @param54         ,  @param55         ,  @param56         ,  @param57         ,  @param58         ,  @param59         ,  @param60         ,  @param61         ,  @param62         ,  @param63         ,  @param64         ,  @param65         ,  @param66         ,  @param67         ,  @param68         ,  @param69         ,  @param70         ,  @param71         ,  @param72         ,  @param73         )        SELECT SCOPE_IDENTITY()]
2020-01-02 17:40:08,378 [1] DEBUG - Statement Id: [DAO00014_Add] Parameters: [@param0=[BENHNHAN_ID,24441], @param1=[TIEPNHAN_ID,28493], @param2=[BENHAN_ID,null], @param3=[DICHVU_ID,5492], @param4=[PHONGBAN_ID,62], @param5=[NGAYKHAM,1/2/2020 12:00:00 AM], @param6=[THOIGIANKHAM,1/2/2020 5:39:22 PM], @param7=[BACSIKHAM_ID,1], @param8=[DIEUDUONG_ID,null], @param9=[DOITUONG_ID,4], @param10=[CHANDOANICD_ID,3990], @param11=[CHANDOANPHUICD_ID,null], @param12=[CHANDOANICD,null], @param13=[BENHMANTINH_ID,null], @param14=[HUONGGIAIQUYET_ID,458], @param15=[YEUCAUCHITIET_ID,null], @param16=[CHANDOANKHOAKHAM,Viêm phế quản cấp(J20)], @param17=[TLDG_MT,null], @param18=[TLDG_MP,null], @param19=[TKLT_MP,null], @param20=[TKLT_MT,null], @param21=[TLDG_MT_TEXT,], @param22=[TLDG_MP_TEXT,], @param23=[TKLT_MP_TEXT,], @param24=[TKLT_MT_TEXT,], @param25=[NHANAP_MT,null], @param26=[NHANAP_MP,null], @param27=[MACH,null], @param28=[CANNANG,null], @param29=[CHIEUCAO,null], @param30=[HUYETAPTHAP,null], @param31=[HUYETAPCAO,null], @param32=[NHIPTHO,null], @param33=[NHIETDO,null], @param34=[BMI,null], @param35=[TYLEMO,null], @param36=[VONGBUNG,null], @param37=[SIEUHIENVI,], @param38=[SOIDAYMAT,], @param39=[TRIEUCHUNGLAMSANG,test], @param40=[CHANDOANSOBOICD_ID,null], @param41=[CHANDOANSOBO,], @param42=[CHUYENDENBENHVIEN_ID,7179], @param43=[LYDONHAPVIEN_ID,null], @param44=[THOIGIANNHAPVIENDUKIEN,null], @param45=[KHAMBENHLANDAU_ID,null], @param46=[KHAMBENH_CHUYENKHOA_ID,null], @param47=[NHAPKHOA_ID,null], @param48=[CHUYENKHOA_ID,null], @param49=[NGHIOM_TUNGAY,null], @param50=[NGHIOM_DENNGAY,null], @param51=[HUONGDIEUTRI_ID,null], @param52=[CHEDOANUONG_ID,null], @param53=[CHEDOCHAMSOC_ID,null], @param54=[DIEUTRIDUPHONG,null], @param55=[SONGAYDIEUTRI,null], @param56=[GIAIDOANBENH,null], @param57=[TOATHUOCMUANGOAI,null], @param58=[TACDUNGPHU,null], @param59=[TUANTHUCUABN,null], @param60=[SONGAYHENTAIKHAM,null], @param61=[SOBENHANNGOAITRU_ID,null], @param62=[KHAMCAPCUU,null], @param63=[GHICHU,], @param64=[KHOADULIEU,0], @param65=[NGUOIKHOA_ID,null], @param66=[NGAYKHOA,null], @param67=[THOIGIANKHOA,null], @param68=[BENHVIEN_ID,HLU01], @param69=[NGAYTAO,1/2/2020 5:40:08 PM], @param70=[NGUOITAO_ID,1], @param71=[NGAYCAPNHAT,1/2/2020 5:40:08 PM], @param72=[NGUOICAPNHAT_ID,1], @param73=[KHAMBENH_SINHHIEU_ID,0]]
2020-01-02 17:40:08,378 [1] DEBUG - Statement Id: [DAO00014_Add] Types: [@param0=[Int64, System.Int64], @param1=[String, System.String], @param2=[System.DBNull, null], @param3=[Int64, System.Int64], @param4=[String, System.String], @param5=[DateTime, System.DateTime], @param6=[DateTime, System.DateTime], @param7=[Int64, System.Int64], @param8=[System.DBNull, null], @param9=[Int64, System.Int64], @param10=[String, System.String], @param11=[System.DBNull, null], @param12=[System.DBNull, null], @param13=[System.DBNull, null], @param14=[String, System.String], @param15=[System.DBNull, null], @param16=[String, System.String], @param17=[System.DBNull, null], @param18=[System.DBNull, null], @param19=[System.DBNull, null], @param20=[System.DBNull, null], @param21=[String, System.String], @param22=[String, System.String], @param23=[String, System.String], @param24=[String, System.String], @param25=[System.DBNull, null], @param26=[System.DBNull, null], @param27=[System.DBNull, null], @param28=[System.DBNull, null], @param29=[System.DBNull, null], @param30=[System.DBNull, null], @param31=[System.DBNull, null], @param32=[System.DBNull, null], @param33=[System.DBNull, null], @param34=[System.DBNull, null], @param35=[System.DBNull, null], @param36=[System.DBNull, null], @param37=[String, System.String], @param38=[String, System.String], @param39=[String, System.String], @param40=[System.DBNull, null], @param41=[String, System.String], @param42=[Int64, System.Int64], @param43=[System.DBNull, null], @param44=[System.DBNull, null], @param45=[System.DBNull, null], @param46=[System.DBNull, null], @param47=[System.DBNull, null], @param48=[System.DBNull, null], @param49=[System.DBNull, null], @param50=[System.DBNull, null], @param51=[System.DBNull, null], @param52=[System.DBNull, null], @param53=[System.DBNull, null], @param54=[System.DBNull, null], @param55=[System.DBNull, null], @param56=[System.DBNull, null], @param57=[System.DBNull, null], @param58=[System.DBNull, null], @param59=[System.DBNull, null], @param60=[System.DBNull, null], @param61=[System.DBNull, null], @param62=[System.DBNull, null], @param63=[String, System.String], @param64=[String, System.String], @param65=[System.DBNull, null], @param66=[System.DBNull, null], @param67=[System.DBNull, null], @param68=[String, System.String], @param69=[DateTime, System.DateTime], @param70=[String, System.String], @param71=[DateTime, System.DateTime], @param72=[String, System.String], @param73=[Int64, System.Int64]]
2020-01-02 17:40:08,467 [1] DEBUG - Statement Id: [DAO00014_CheckExistHenTaiKHam] PreparedStatement : [select KHAMBENH_HENTAIKHAM        from TT_NGOAITRU_KHAMBENH_HENTK        where KHAMBENH_ID  = '27176']
2020-01-02 17:40:08,535 [1] DEBUG - Statement Id: [DAO00020_UpdateKhamBenhIDInDVYC] PreparedStatement : [update TT_DVYEUCAU        set KHAMBENH_NGOAITRU_ID =  @param0                 , TRANGTHAI =  @param1         , NGUOICAPNHAT_ID =  @param2         , NGAYCAPNHAT =  @param3         where TIEPNHAN_ID = 28493        and DVYEUCAU_ID = 206519                update TT_VIENPHI        set DATHUCHIEN =  @param4         , NGUOICAPNHAT_ID =  @param2         , NGAYCAPNHAT =  @param3         where REF_ID = 206519        and REF_TABLE = 'TT_DVYEUCAU']
2020-01-02 17:40:08,535 [1] DEBUG - Statement Id: [DAO00020_UpdateKhamBenhIDInDVYC] Parameters: [@param0=[KHAMBENH_ID,27176], @param1=[TRANGTHAI,DACHUYENTUYEN], @param2=[NGUOICAPNHAT_ID,1], @param3=[NGAYCAPNHAT,1/2/2020 5:40:08 PM], @param4=[DATHUCHIEN,1]]
2020-01-02 17:40:08,535 [1] DEBUG - Statement Id: [DAO00020_UpdateKhamBenhIDInDVYC] Types: [@param0=[Int64, System.Int64], @param1=[String, System.String], @param2=[Int64, System.Int64], @param3=[DateTime, System.DateTime], @param4=[Int32, System.Int32]]
2020-01-02 17:40:08,580 [1] DEBUG - Statement Id: [DAO00023_GetSOBHYT_HUONG_ID] PreparedStatement : [select isnull(MAX(SOBHYT_HUONG_ID),0) SOBHYT_HUONG_ID        from TT_TIEPNHAN_SOTHEBHYT        where TIEPNHAN_ID = '28493']
2020-01-02 17:40:08,606 [1] DEBUG - Statement Id: [DAO00062_GetAllPhamviKhoDuoc] PreparedStatement : [select distinct dmap.*        from TM_DUOC_PHAMVISD_MAPPING dmap        left join TM_DUOC_PHAMVISUDUNG dpv on dpv.PHAMVI_ID = dmap.PHAMVI_ID]
2020-01-02 17:40:08,632 [1] DEBUG - Statement Id: [DAO00062_GetKhoDuocNhaThuoc] PreparedStatement : [select * from TM_KHODUOC where MAKHO = 'KHO_NT']
2020-01-02 17:40:08,661 [1] DEBUG - Statement Id: [DAO00049_KiemtraloaiDV] PreparedStatement : [select DICHVU_ID AS HA, '' AS XN, '' as TDCN, '' as TT, '' as KB from TM_DICHVU            left join TM_NHOMDICHVU ndv on ndv.NHOMDICHVU_ID = TM_DICHVU.NHOMDICHVU_ID            where DICHVU_ID = '5492' and left(ndv.MANHOMDICHVU, 2) = '02'            union            select  '' as HA, DICHVU_ID AS XN, '' as TDCN, '' as TT, '' as KB from TM_DICHVU            left join TM_NHOMDICHVU ndv on ndv.NHOMDICHVU_ID = TM_DICHVU.NHOMDICHVU_ID            where DICHVU_ID = '5492' and left(ndv.MANHOMDICHVU, 2) = '01'            union            select  '' as HA, '' AS XN, DICHVU_ID as TDCN, '' as TT, '' as KB from TM_DICHVU            left join TM_NHOMDICHVU ndv on ndv.NHOMDICHVU_ID = TM_DICHVU.NHOMDICHVU_ID            where DICHVU_ID = '5492' and left(ndv.MANHOMDICHVU, 2) = '03'            union            select  '' as HA, '' AS XN, '' as TDCN, DICHVU_ID as TT, '' as KB from TM_DICHVU            left join TM_NHOMDICHVU ndv on ndv.NHOMDICHVU_ID = TM_DICHVU.NHOMDICHVU_ID            where DICHVU_ID = '5492' and left(ndv.MANHOMDICHVU, 2) = '05'            union            select  '' as HA, '' AS XN, '' as TDCN, DICHVU_ID as TT, '' as KB from TM_DICHVU            left join TM_NHOMDICHVU ndv on ndv.NHOMDICHVU_ID = TM_DICHVU.NHOMDICHVU_ID            where DICHVU_ID = '5492' and left(ndv.MANHOMDICHVU, 2) = '06'            union            select  '' as HA, '' AS XN, '' as TDCN, '' as TT, DICHVU_ID as KB from TM_DICHVU            left join TM_NHOMDICHVU ndv on ndv.NHOMDICHVU_ID = TM_DICHVU.NHOMDICHVU_ID            where DICHVU_ID = '5492' and left(ndv.MANHOMDICHVU, 2) = '04']
2020-01-02 17:40:08,687 [1] DEBUG - Statement Id: [DAO00009_GetThutiensauDVThuthuat] PreparedStatement : [select A.THUTIENSAU, B.SOTIEPNHAN, A.DICHVU_ID, A.DVYEUCAU_ID        from TT_DVYEUCAU A        inner join TT_TIEPNHAN B on B.TIEPNHAN_ID = A.TIEPNHAN_ID        where        A.DVYEUCAU_ID = '206519']
2020-01-02 17:40:08,718 [1] DEBUG - Statement Id: [DAO00009_TT_TIEPNHAN_GetProcess] PreparedStatement : [select PROCESS_ID from TT_TIEPNHAN where SOTIEPNHAN = 'TN200102.0000001']
2020-01-02 17:40:08,755 [1] DEBUG - Statement Id: [DAOWF001_Kiemtrathongtindayeucaudacochua] PreparedStatement : [select * from TT_REQUEST        where        PARA = '{"HOSPITAL_ID":"HLU01","SOTIEPNHAN":"TN200102.0000001"}'        AND ISACTIVE = '1']
2020-01-02 17:40:08,801 [1] DEBUG - Statement Id: [DAOWF001_Kiemtrathongtindichvudayeucau] PreparedStatement : [select top 1 * from TT_REQUEST_SERVICE        where        PARA = '{"DICHVU_ID":"5492","DVYEUCAU_ID":"206519"}'                AND ISACTIVE = '1' order by ID desc]
2020-01-02 17:40:08,827 [1] DEBUG - Statement Id: [DAOWF001_KiemtrathongtinchitietDichvuYeucau] PreparedStatement : [select * from TT_REQUEST_SERVICE_DETAIL        where        REQUEST_SERVICE_ID = '148395']
2020-01-02 17:40:08,884 [1] DEBUG - Statement Id: [DAOWF001_Laythongtinwithstatecode] PreparedStatement : [select A.*, B.STATUS_CODE from        TM_STATE_ACTION A        left join TM_STATE B on B.STATE_CODE = A.NEXT_STATE_CODE and A.PROCESS_CODE = B.PROCESS_CODE        where        A.CURR_STATE_CODE = '0     '        AND A.PROCESS_CODE = 'P02'        Order By ORDER_ID ASC]
2020-01-02 17:40:08,916 [1] DEBUG - Statement Id: [DAOWF003_Update] PreparedStatement : [update TT_REQUEST_SERVICE set        CURR_STATE_CODE =  @param0                   , ISACTIVE =  @param1                     , ISCOMPLETE =  @param2                        where        ID = '148395']
2020-01-02 17:40:08,916 [1] DEBUG - Statement Id: [DAOWF003_Update] Parameters: [@param0=[CURR_STATE_CODE,8], @param1=[ISACTIVE,1], @param2=[ISCOMPLETE,0]]
2020-01-02 17:40:08,916 [1] DEBUG - Statement Id: [DAOWF003_Update] Types: [@param0=[String, System.String], @param1=[String, System.String], @param2=[String, System.String]]
2020-01-02 17:40:08,945 [1] DEBUG - Statement Id: [DAOWF005_Add] PreparedStatement : [insert into TT_REQUEST_SERVICE_DETAIL (        REQUEST_ID        ,REQUEST_SERVICE_ID        , OLD_STATE_CODE        , CURR_STATE_CODE        ) values (         @param0         , @param1         ,  @param2         ,  @param3         )        SELECT SCOPE_IDENTITY()]
2020-01-02 17:40:08,945 [1] DEBUG - Statement Id: [DAOWF005_Add] Parameters: [@param0=[REQUEST_ID,32793], @param1=[REQUEST_SERVICE_ID,148395], @param2=[OLD_STATE_CODE,0     ], @param3=[CURR_STATE_CODE,8]]
2020-01-02 17:40:08,945 [1] DEBUG - Statement Id: [DAOWF005_Add] Types: [@param0=[String, System.String], @param1=[Int32, System.Int32], @param2=[String, System.String], @param3=[String, System.String]]
2020-01-02 17:40:08,977 [1] DEBUG - Statement Id: [DAOWF005_Add_History] PreparedStatement : [insert into TT_REQUEST_SERVICE_HISTORY (        REQUEST_ID        ,REQUEST_SERVICE_ID        , OLD_STATE_CODE        , CURR_STATE_CODE        ) values (         @param0         , @param1         ,  @param2         ,  @param3         )]
2020-01-02 17:40:08,977 [1] DEBUG - Statement Id: [DAOWF005_Add_History] Parameters: [@param0=[REQUEST_ID,32793], @param1=[REQUEST_SERVICE_ID,148395], @param2=[OLD_STATE_CODE,0     ], @param3=[CURR_STATE_CODE,8]]
2020-01-02 17:40:08,977 [1] DEBUG - Statement Id: [DAOWF005_Add_History] Types: [@param0=[String, System.String], @param1=[Int32, System.Int32], @param2=[String, System.String], @param3=[String, System.String]]
2020-01-02 17:40:09,007 [1] DEBUG - Statement Id: [DAO00009_TT_DVYEUCAU_Update] PreparedStatement : [Update TT_DVYEUCAU set TRANGTHAI_WFL = 'HOANTAT' where DVYEUCAU_ID = '206519']
2020-01-02 17:40:09,033 [1] DEBUG - Statement Id: [DAO00026_GetListDanhSachDichVuGhiNhanVTYT_COM25_WithTN] PreparedStatement : [select distinct CONVERT(VARCHAR(11),C.NGAYYEUCAU,103) as NGAYYEUCAU, C.DICHVU_ID, C.DVYEUCAU_ID, D.TENDICHVU, C.NOITHUCHIEN_ID, A.SOTIEPNHAN, A.TRAITUYEN, A.NGAYMIENDONGCHITRA, A.TIEPNHAN_ID, A.DOITUONG_ID, A.TRANGTHAI,            A.LOAITHANHVIEN_ID, A.SUDUNG_BHTN, A.THE_ID, A.THANHVIEN_ID, A.VIP, A.NGUON_BENHNHAN_ID, A.BAOLANH_VIENPHI,            CASE WHEN (A.TRANGTHAI = 'NOITRU' OR A.TRANGTHAI = 'CAPCUU') THEN 'IN' ELSE 'OUT' END AS LOAIBENHAN,            CASE WHEN (C.TRANGTHAI = 'CHUAKETQUA') THEN 'CHUAKETQUA' ELSE 'HOANTAT' END AS TRANGTHAIDICHVU,            B.*, isnull(ntba.SOBENHAN, '') SOBENHAN, isnull(ntba.BENHAN_ID, 0) BENHAN_ID,            CASE WHEN Left(E.MANHOMDICHVU,2) = '03' THEN '02' ELSE Left(E.MANHOMDICHVU,2) END AS MANHOMDICHVU            from TT_TIEPNHAN A            inner join TT_BENHNHAN B on B.BENHNHAN_ID = A.BENHNHAN_ID and B.ACTIVE = '1'            inner join TT_DVYEUCAU C on C.TIEPNHAN_ID = A.TIEPNHAN_ID                        left join TM_DICHVU D on D.DICHVU_ID = C.DICHVU_ID            left join TM_NHOMDICHVU E on E.NHOMDICHVU_ID = D.NHOMDICHVU_ID            left join TT_NOITRU_BENHAN ntba on ntba.BENHAN_ID = C.BENHAN_ID              where            C.NGAYHENCLS is NULL and A.BENHVIEN_ID = 'HLU01'            and (A.TRANGTHAI = 'DATIEPNHAN' or A.TRANGTHAI = 'NOITRU' or A.TRANGTHAI = 'CAPCUU' or A.TRANGTHAI = 'NGOAITRU')            and (CASE WHEN Left(E.MANHOMDICHVU,2) = '03' THEN '02' ELSE Left(E.MANHOMDICHVU,2) END in ('02', '04'))            and A.TIEPNHAN_ID = '28493']
2020-01-02 17:40:09,188 [1] DEBUG - Statement Id: [DAOLOG01_LockEnd] PreparedStatement : [DELETE TT_LOG_UPDATE        where REF_TABLE = 'TT_NGOAITRU_KHAMBENH' and REF_ID = '28493' and BENHVIEN_ID = 'HLU01']
2020-01-02 17:40:09,215 [1] DEBUG - Statement Id: [DAO00014_Clear_1ToaThuocKhambenh] PreparedStatement : [DELETE FROM TT_DUOC_TONKHO_BOOK_NGOAITRU where REF_TABLE = 'TT_NGOAITRU_TOATHUOC'        and REF_ID in (        select TOATHUOC_ID from TT_NGOAITRU_TOATHUOC        where             KHAMBENH_TOATHUOC_ID in (select KHAMBENH_TOATHUOC_ID from TT_NGOAITRU_KHAMBENH_TOATHUOC        where TIEPNHAN_ID = '28493' and                   KHAMBENH_ID not in (select KHAMBENH_ID from TT_NGOAITRU_KHAMBENH where  TIEPNHAN_ID = '28493'))        and TIEPNHAN_ID = '28493')          DELETE FROM TT_VIENPHI where REF_TABLE = 'TT_NGOAITRU_TOATHUOC'        and REF_ID in (        select TOATHUOC_ID from TT_NGOAITRU_TOATHUOC        where KHAMBENH_TOATHUOC_ID in (select KHAMBENH_TOATHUOC_ID from TT_NGOAITRU_KHAMBENH_TOATHUOC        where TIEPNHAN_ID = '28493' and KHAMBENH_ID not in (select KHAMBENH_ID from TT_NGOAITRU_KHAMBENH where TIEPNHAN_ID = '28493'))        and TIEPNHAN_ID = '28493')          delete from TT_NGOAITRU_TOATHUOC        where KHAMBENH_TOATHUOC_ID in (select KHAMBENH_TOATHUOC_ID from TT_NGOAITRU_KHAMBENH_TOATHUOC        where TIEPNHAN_ID = '28493' and KHAMBENH_ID not in (select KHAMBENH_ID from TT_NGOAITRU_KHAMBENH where TIEPNHAN_ID = '28493')        and TIEPNHAN_ID = '28493')          delete from TT_NGOAITRU_KHAMBENH_TOATHUOC where TIEPNHAN_ID = '28493'        and KHAMBENH_ID not in (select KHAMBENH_ID from TT_NGOAITRU_KHAMBENH where TIEPNHAN_ID = '28493') and TIEPNHAN_ID = '28493']
2020-01-02 17:40:10,808 [1] DEBUG - Statement Id: [DAO00014_GetKhamBenhInfo] PreparedStatement : [select * from TT_NGOAITRU_KHAMBENH where KHAMBENH_ID =        (select KHAMBENH_NGOAITRU_ID from TT_DVYEUCAU where DVYEUCAU_ID = '206519')]
2020-01-02 17:40:10,839 [1] DEBUG - Statement Id: [DAO00068_GetSinhHieuBySinhHieuID] PreparedStatement : [select top (1) *            from TT_NGOAITRU_KHAMBENH_SINHHIEU            where KHAMBENH_SINHHIEU_ID = '0'            and BENHVIEN_ID = 'HLU01'             and               BENHNHAN_ID = '24441'                           order by KHAMBENH_SINHHIEU_ID]
2020-01-02 17:40:10,878 [1] DEBUG - Statement Id: [DAO00014_GetKhamBenhICDInfo] PreparedStatement : [select *        from TT_NGOAITRU_KHAMBENH_ICD        where KHAMBENH_ID  = '27176']
2020-01-02 17:40:10,946 [1] DEBUG - Statement Id: [DAO00014_GetListToaThuoc] PreparedStatement : [select A.*        from TT_NGOAITRU_KHAMBENH_TOATHUOC A        where A.KHAMBENH_ID = '27176']
2020-01-02 17:40:11,026 [1] DEBUG - Statement Id: [DAO00014_KiemTraDVYCCoGiaBHYT] PreparedStatement : [select *        from TT_VIENPHI        where REF_ID  = '206519' and REF_TABLE = 'TT_DVYEUCAU' and BHYT_DONGIA > 0]
2020-01-02 17:40:11,066 [1] DEBUG - Statement Id: [DAO00040_LayListToaMau] PreparedStatement : [select A.*, dc.TENDUOCDAYDU, dc.BHYT DUOC_BHYT, ld.LOAIVATTU_ID, ld.MALOAIDUOC, dd.DICTIONARY_NAME DUONGDUNG, dc.TAMNGUNG            from TT_TOATHUOCMAU A            left join TM_DUOC dc on A.DUOC_ID = dc.DUOC_ID            left join TM_LOAIDUOC ld on dc.LOAIDUOC_ID = ld.LOAIDUOC_ID            left join (select * from LST_DICTIONARY where DICTIONARY_TYPE_CODE like 'DuongDung') dd on dd.DICTIONARY_ID = dc.DUONGDUNG_ID            where (1=1)             and               A.BACSI_ID  = 1              and A.LOAITOATHUOC in  (                        @param0                   ,                           @param1                   ,                           @param2                   ,                           @param3                   )]
2020-01-02 17:40:11,066 [1] DEBUG - Statement Id: [DAO00040_LayListToaMau] Parameters: [@param0=[LSTLOAITOATHUOC[0],BV], @param1=[LSTLOAITOATHUOC[1],MN], @param2=[LSTLOAITOATHUOC[2],MP], @param3=[LSTLOAITOATHUOC[3],TV]]
2020-01-02 17:40:11,066 [1] DEBUG - Statement Id: [DAO00040_LayListToaMau] Types: [@param0=[String, System.String], @param1=[String, System.String], @param2=[String, System.String], @param3=[String, System.String]]
2020-01-02 17:40:11,208 [1] DEBUG - Statement Id: [DAO00040_LayListToaMau] PreparedStatement : [select A.*, dc.TENDUOCDAYDU, dc.BHYT DUOC_BHYT, ld.LOAIVATTU_ID, ld.MALOAIDUOC, dd.DICTIONARY_NAME DUONGDUNG, dc.TAMNGUNG            from TT_TOATHUOCMAU A            left join TM_DUOC dc on A.DUOC_ID = dc.DUOC_ID            left join TM_LOAIDUOC ld on dc.LOAIDUOC_ID = ld.LOAIDUOC_ID            left join (select * from LST_DICTIONARY where DICTIONARY_TYPE_CODE like 'DuongDung') dd on dd.DICTIONARY_ID = dc.DUONGDUNG_ID            where (1=1)             and               A.BACSI_ID  = 1              and A.LOAITOATHUOC in  (                        @param0                   ,                           @param1                   ,                           @param2                   ,                           @param3                   )]
2020-01-02 17:40:11,208 [1] DEBUG - Statement Id: [DAO00040_LayListToaMau] Parameters: [@param0=[LSTLOAITOATHUOC[0],BV], @param1=[LSTLOAITOATHUOC[1],MN], @param2=[LSTLOAITOATHUOC[2],MP], @param3=[LSTLOAITOATHUOC[3],TV]]
2020-01-02 17:40:11,208 [1] DEBUG - Statement Id: [DAO00040_LayListToaMau] Types: [@param0=[String, System.String], @param1=[String, System.String], @param2=[String, System.String], @param3=[String, System.String]]
2020-01-02 17:40:11,303 [1] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoVaBookingCOM23UpdateRedis_TheoPhamvi] PreparedStatement : [declare @TOAMUANGOAI int = 0;        select @TOAMUANGOAI = isnull(VALUE,0) from TM_SYS_APPSETTINGS where CODE = 'OPD_TOAMUANGOAI_DUNGDANHMUC_DUOC'                if @TOAMUANGOAI = 1        begin        select  distinct '0' + '_' + LTRIM(d.DUOC_ID) + '_' + '0' as DUOC_KEY, 999999999 as SOLUONG        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        where  @param0  = 0        union all        select distinct tk.DUOC_KEY, tk.SOLUONG        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        inner join        (        select  LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')) DUOC_KEY, (SUM(dtk.SOLUONG) - isnull(sum(A.SOLUONG),0) - isnull(sum(B.SOLUONG),0)) SOLUONG, pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        from (select sum(soluong) soluong,duoc_id,nguonduoc_id,khoduoc_id,benhvien_id from TT_DUOC_TONKHO  group by duoc_id,nguonduoc_id,khoduoc_id,benhvien_id) dtk        inner join TM_DUOC_PHAMVISD_MAPPING pvsd on dtk.KHODUOC_ID = pvsd.KHODUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NOITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) B on B.DUOC_ID = dtk.DUOC_ID and B.PHAMVI_ID = pvsd.PHAMVI_ID and B.NGUONHANG_ID = dtk.NGUONDUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NGOAITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) A on A.DUOC_ID = dtk.DUOC_ID and A.PHAMVI_ID = pvsd.PHAMVI_ID and A.NGUONHANG_ID = dtk.NGUONDUOC_ID        where dtk.BENHVIEN_ID = 'HLU01'        group by LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')), pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        ) tk on tk.DUOC_ID = d.DUOC_ID        left join TM_DUOC_PHAMVISUDUNG kd on kd.PHAMVI_ID = tk.PHAMVI_ID and kd.BENHVIEN_ID = 'HLU01'        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = tk.NGUONDUOC_ID and nh.BENHVIEN_ID = 'HLU01'        where d.BENHVIEN_ID = 'HLU01' and tk.PHAMVI_ID =  @param0         end        else        begin        select distinct tk.DUOC_KEY, tk.SOLUONG        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        inner join        (        select  LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')) DUOC_KEY, (SUM(dtk.SOLUONG) - isnull(sum(A.SOLUONG),0) - isnull(sum(B.SOLUONG),0)) SOLUONG, pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        from (select sum(soluong) soluong,duoc_id,nguonduoc_id,khoduoc_id,benhvien_id from TT_DUOC_TONKHO  group by duoc_id,nguonduoc_id,khoduoc_id,benhvien_id) dtk        inner join TM_DUOC_PHAMVISD_MAPPING pvsd on dtk.KHODUOC_ID = pvsd.KHODUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NOITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) B on B.DUOC_ID = dtk.DUOC_ID and B.PHAMVI_ID = pvsd.PHAMVI_ID and B.NGUONHANG_ID = dtk.NGUONDUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NGOAITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) A on A.DUOC_ID = dtk.DUOC_ID and A.PHAMVI_ID = pvsd.PHAMVI_ID and A.NGUONHANG_ID = dtk.NGUONDUOC_ID        where dtk.BENHVIEN_ID = 'HLU01'        group by LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')), pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        ) tk on tk.DUOC_ID = d.DUOC_ID        left join TM_DUOC_PHAMVISUDUNG kd on kd.PHAMVI_ID = tk.PHAMVI_ID and kd.BENHVIEN_ID = 'HLU01'        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = tk.NGUONDUOC_ID and nh.BENHVIEN_ID = 'HLU01'        where d.BENHVIEN_ID = 'HLU01' and tk.PHAMVI_ID =  @param0         end]
2020-01-02 17:40:11,304 [1] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoVaBookingCOM23UpdateRedis_TheoPhamvi] Parameters: [@param0=[PHAMVI_ID,1028]]
2020-01-02 17:40:11,304 [1] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoVaBookingCOM23UpdateRedis_TheoPhamvi] Types: [@param0=[Int64, System.Int64]]
2020-01-02 17:40:11,691 [1] DEBUG - Statement Id: [DAO00064_GetlistTT_TIEPNHAN_SOTHEBHYT] PreparedStatement : [select stbhyt.*, ba.SOBENHAN,        tn.SOTIEPNHAN, tn.LOAITHANHVIEN_ID, tn.THE_ID, tn.THANHVIEN_ID,        tn.SUDUNG_BHTN, tn.BAOLANH_VIENPHI, tn.VIP, tn.NGUOINUOCNGOAI        from TT_TIEPNHAN_SOTHEBHYT stbhyt        left join TT_TIEPNHAN tn on tn.TIEPNHAN_ID = stbhyt.TIEPNHAN_ID        left join TT_NOITRU_BENHAN ba on ba.TIEPNHAN_ID = stbhyt.TIEPNHAN_ID        where        stbhyt.TIEPNHAN_ID = '28493' and isnull(stbhyt.KHONGSUDUNG, '0') = '0']
2020-01-02 17:40:11,738 [1] DEBUG - Statement Id: [DAO00064_GetListVienPhiByTiepNnan] PreparedStatement : [select distinct        B.DOITUONG_ID, B.NGAYMIENDONGCHITRA, B.BENHNHAN_ID as TIEPNHAN_BENHNHAN_ID, B.TRAITUYEN,        B.BHYTTREN3NAM as TREN3NAM, B.BHYTTREN5NAM as TREN5NAM, B.SOTIEPNHAN, B.SOBENHAN,        B.LOAITHANHVIEN_ID, B.SUDUNG_BHTN, B.THE_ID, B.THANHVIEN_ID, B.BAOLANH_VIENPHI, B.VIP, B.NGUOINUOCNGOAI,        C.GIATRIMIENGIAM as GIATRIMIENGIAM, D.GIATRIMIENGIAM as GIATRIMIENGIAM_BHTN, E.GIATRIMIENGIAM as GIATRIMIENGIAM_THANHVIEN,        F.GIATRIMIENGIAM as GIATRIMIENGIAM_CONGTY, DVYC.THE_ID as DVDUNGTHE, DVYC.TRANGTHAI as TRANGTHAIDICHVU, ndv.MANHOMDICHVU,        A.* from TT_VIENPHI A        left join        (select B.*, C.SOBENHAN, C.BENHAN_ID        from TT_TIEPNHAN B        left join TT_NOITRU_BENHAN C on B.TIEPNHAN_ID = C.TIEPNHAN_ID                 where B.TIEPNHAN_ID = '28493') B on B.TIEPNHAN_ID = A.TIEPNHAN_ID        left join (select sum(GIATRIMIENGIAM) as GIATRIMIENGIAM, VIENPHI_ID, REF_TABLE        from TT_MIENGIAM_CHITIET        where REF_TABLE = 'TT_MIENGIAM'        and exists (select MIENGIAM_ID from TT_MIENGIAM where TT_MIENGIAM_CHITIET.MIENGIAM_ID = MIENGIAM_ID and TINHTRANG = 1 and TIEPNHAN_ID = '28493')        group by VIENPHI_ID, REF_TABLE) C on C.REF_TABLE = 'TT_MIENGIAM' and C.VIENPHI_ID = A.VIENPHI_ID        left join (select sum(GIATRIMIENGIAM) as GIATRIMIENGIAM, VIENPHI_ID, REF_TABLE        from TT_MIENGIAM_CHITIET        where REF_TABLE = 'TT_MIENGIAM_BHTN'        and exists (select MIENGIAM_BHTN_ID from TT_MIENGIAM_BHTN where TT_MIENGIAM_CHITIET.MIENGIAM_ID = MIENGIAM_BHTN_ID and  TINHTRANG = 1 and TIEPNHAN_ID = '28493')        group by VIENPHI_ID, REF_TABLE) D on D.REF_TABLE = 'TT_MIENGIAM_BHTN' and D.VIENPHI_ID = A.VIENPHI_ID        left join (select sum(GIATRIMIENGIAM) as GIATRIMIENGIAM, VIENPHI_ID, REF_TABLE        from TT_MIENGIAM_CHITIET        where REF_TABLE = 'TT_MIENGIAM_THANHVIEN'        and exists (select MIENGIAM_THANHVIEN_ID from TT_MIENGIAM_THANHVIEN where TT_MIENGIAM_CHITIET.MIENGIAM_ID = MIENGIAM_THANHVIEN_ID and TINHTRANG = 1 and TIEPNHAN_ID = '28493')        group by VIENPHI_ID, REF_TABLE) E on E.REF_TABLE = 'TT_MIENGIAM_THANHVIEN' and E.VIENPHI_ID = A.VIENPHI_ID        left join (select sum(GIATRIMIENGIAM) as GIATRIMIENGIAM, VIENPHI_ID, REF_TABLE        from TT_MIENGIAM_CHITIET        where REF_TABLE = 'TT_MIENGIAM_CONGTY'        and exists (select MIENGIAM_CONGTY_ID from TT_MIENGIAM_CONGTY where TT_MIENGIAM_CHITIET.MIENGIAM_ID = MIENGIAM_CONGTY_ID and TINHTRANG = 1 and TIEPNHAN_ID = '28493')        group by VIENPHI_ID, REF_TABLE) F on F.REF_TABLE = 'TT_MIENGIAM_CONGTY' and F.VIENPHI_ID = A.VIENPHI_ID        left join TT_DVYEUCAU DVYC on DVYC.DVYEUCAU_ID = A.REF_ID and A.REF_TABLE = 'TT_DVYEUCAU'        left join TM_DICHVU DV on DVYC.DICHVU_ID = DV.DICHVU_ID and A.REF_TABLE = 'TT_DVYEUCAU'        left join TM_NHOMDICHVU ndv on ndv.NHOMDICHVU_ID = DV.NHOMDICHVU_ID and A.REF_TABLE = 'TT_DVYEUCAU'        where        A.TIEPNHAN_ID = '28493' and ((DVYC.HUYYEUCAU = '0' and A.DICHVU_ID is not null)        or A.DUOC_ID is not null or A.REF_TABLE = 'TT_NUT_XACNHANSUATAN_CHITIET')        and A.ACTIVE = '1'                 and A.BENHVIEN_ID = 'HLU01'        order by A.VIENPHI_ID]
2020-01-02 17:40:11,988 [1] DEBUG - Statement Id: [DAO00006_GetListDuocTyle] PreparedStatement : [select DUOC_ID, DOITUONG_ID, (TYLE/100) as TYLE, DONGIA MUCTRAN_THANHTOAN from TM_DOITUONG_GIADUOC_TYLE            where            BENHVIEN_ID = 'HLU01'            and DOITUONG_ID = '4']
2020-01-02 17:40:12,013 [1] DEBUG - Statement Id: [DAO00027_GetListTuongTrinhDichVuPhauThuatCuaTiepNhan] PreparedStatement : [declare @ManhomDSA varchar(10);        declare @PhanLoaiNhomDV varchar(20) = '05';        select top 1  @ManhomDSA = VALUE from TM_SYS_APPSETTINGS where CODE = 'MANHOM_DICHVU_DSA'        if (@ManhomDSA is not null) set @PhanLoaiNhomDV += ',' + @ManhomDSA        select distinct ptyc.*        from TT_PHAUTHUAT_YEUCAU ptyc        inner join TM_DICHVU dv on dv.DICHVU_ID = ptyc.DICHVU_ID        inner join TM_NHOMDICHVU ndv on ndv.NHOMDICHVU_ID = dv.NHOMDICHVU_ID        inner join TT_PHAUTHUAT pt on pt.PHAUTHUAT_ID = ptyc.PHAUTHUAT_ID        where        pt.TIEPNHAN_ID = 28493        and (left(ndv.MANHOMDICHVU, 2) in (select * from STRING_SPLIT(@PhanLoaiNhomDV,',')) or ndv.MANHOMDICHVU in (select * from STRING_SPLIT(@PhanLoaiNhomDV,',')))]
2020-01-02 17:40:12,046 [1] DEBUG - Statement Id: [DAO00006_GetList] PreparedStatement : [select dv.*, loaiDV.MALOAIDICHVU, captren.NHOMDICHVU_ID as NHOMDICHVU_CAPTREN_ID, captren.TENNHOMDICHVU as NHOMDICHVU_CAPTREN,              nhom_dv.TENNHOMDICHVU as TENNHOMDICHVU, nhom_dv.MANHOMDICHVU,              case when dv.ATTRIBUTE5 is null then 'TT' else 'KTC' end as LOAI_CHIPHI              from TM_DICHVU as dv              left join TM_NHOMDICHVU as nhom_dv on nhom_dv.NHOMDICHVU_ID = dv.NHOMDICHVU_ID and nhom_dv.BENHVIEN_ID = 'HLU01'              left join TM_NHOMDICHVU as captren on nhom_dv.CAPTREN_ID = captren.NHOMDICHVU_ID and captren.BENHVIEN_ID = 'HLU01'              left join TM_LOAIDICHVU loaiDV on nhom_dv.LOAIDICHVU_ID = loaiDV.LOAIDICHVU_ID and loaiDV.BENHVIEN_ID = 'HLU01'              where nhom_dv.TAMNGUNG = '0' and dv.BENHVIEN_ID = 'HLU01'              and dv.TAMNGUNG = '0'               AND                   loaiDV.MALOAIDICHVU = 'KhamBenh']
2020-01-02 17:40:12,132 [1] DEBUG - Statement Id: [DAO00027_GetDichvuYCBHYTTyle] PreparedStatement : [select DVYEUCAU_ID from TT_DVYEUCAU        where TIEPNHAN_ID = 28493 and isnull(BHYT_TYLETHANHTOAN_ID, 0) > 0]
2020-01-02 17:40:12,186 [1] DEBUG - Statement Id: [DAO00023_UpdateNhieuVP] PreparedStatement : [declare @jsonVienPhi nvarchar(max) = N'[{"VIENPHI_ID":675810,"TIEPNHAN_ID":28493,"DICHVU_ID":5492,"BENHAN_ID":0,"SOLUONG":1.0000,"DONGIA_DOANHTHU":33000.0000,"THANHTIEN_DOANHTHU":33000.00,"BHYT_TL":1.0,"BHYT_DONGIA":33000.0000,"BHYT_THANHTIEN":33000.00,"BHYT_DONGIA_CONGKHAM_DAU":33000.0000,"BHYT_CONGKHAM_DAU_TYLE":1.0,"BHYT_DONGIA_CHITRA":33000.0,"BHYT_THANHTIEN_CHITRA":33000.00,"BENHNHAN_PHAITHANHTOAN":0.00,"GIATRI_HOADON":0.0,"GIATRI_HOADON_DATHANHTOAN":0.0,"GIATRI_BIENLAI":0.0,"GIATRI_BIENLAI_DATHANHTOAN":0.0,"GIATRI_BENHNHAN_DATHANHTOAN":0.0,"DATHUCHIEN":"1","KHONGTHUTIEN":"0","BHYTDONGTIEN":"0","DICHVU_TL":1.0,"BHYT_DONGIA_DONGCT_DAU":0.0,"SOBHYT":"DN452523534525238289","SOBHYT_HUONG_ID":29516,"GIATRIMIENGIAM":0.0,"GIATRIMIENGIAM_BHTN":0.0,"GIATRIMIENGIAM_THANHVIEN":0.0,"GIATRIMIENGIAM_CONGTY":0.0,"BHYT_CK2_KHONGTHANHTOAN":false}]';        begin        UPDATE TT_VIENPHI        SET        SOLUONG = json.SOLUONG,        DONGIA_DOANHTHU = json.DONGIA_DOANHTHU,        THANHTIEN_DOANHTHU = json.THANHTIEN_DOANHTHU,        BHYT_TL = json.BHYT_TL,        BHYT_DONGIA = json.BHYT_DONGIA,        BHYT_THANHTIEN = json.BHYT_THANHTIEN,        BHYT_DONGIA_CONGKHAM_DAU = json.BHYT_DONGIA_CONGKHAM_DAU,        BHYT_CONGKHAM_DAU_TYLE = json.BHYT_CONGKHAM_DAU_TYLE,        BHYT_DONGIA_CHITRA = json.BHYT_DONGIA_CHITRA,        BHYT_THANHTIEN_CHITRA = json.BHYT_THANHTIEN_CHITRA,        BENHNHAN_PHAITHANHTOAN = json.BENHNHAN_PHAITHANHTOAN,        GIATRI_HOADON = json.GIATRI_HOADON,                GIATRI_BIENLAI = json.GIATRI_BIENLAI,                DATHUCHIEN = json.DATHUCHIEN,                DICHVU_TL = json.DICHVU_TL,        BHYT_DONGIA_DONGCT_DAU = json.BHYT_DONGIA_DONGCT_DAU,        NGAYCAPNHAT = GETDATE()        FROM OPENJSON (@jsonVienPhi)        WITH (        VIENPHI_ID int,        SOLUONG numeric(25, 4),        DONGIA_DOANHTHU numeric(25, 4),        THANHTIEN_DOANHTHU numeric(25, 4),        BHYT_TL numeric(25, 4),        BHYT_DONGIA numeric(25, 4),        BHYT_THANHTIEN numeric(25, 4),        BHYT_DONGIA_CONGKHAM_DAU numeric(25, 4),        BHYT_CONGKHAM_DAU_TYLE numeric(25, 4),        BHYT_DONGIA_CHITRA numeric(25, 4),        BHYT_THANHTIEN_CHITRA numeric(25, 4),        BENHNHAN_PHAITHANHTOAN numeric(25, 4),        GIATRI_HOADON numeric(25, 4),                GIATRI_BIENLAI numeric(25, 4),                DATHUCHIEN char(1),        KHONGTHUTIEN char(1),        BHYTDONGTIEN char(1),        DICHVU_TL numeric(25, 4),        BHYT_DONGIA_DONGCT_DAU numeric(25, 4))  json        WHERE TT_VIENPHI.VIENPHI_ID = json.VIENPHI_ID and json.DONGIA_DOANHTHU > 0                  insert into TT_TINH_VIENPHI_LOG        SELECT json.VIENPHI_ID, json.TIEPNHAN_ID, json.BENHAN_ID, json.SOLUONG, json.BHYT_TL, json.DONGIA_DOANHTHU,        json.THANHTIEN_DOANHTHU, json.BHYT_DONGIA, json.BHYT_THANHTIEN, json.BHYT_DONGIA_CHITRA, json.BHYT_THANHTIEN_CHITRA, json.BENHNHAN_PHAITHANHTOAN,        json.SOBHYT_HUONG_ID, json.SOBHYT, GETDATE(), -1, 'HLU01'        FROM OPENJSON(@jsonVienPhi)        WITH (        VIENPHI_ID int,        TIEPNHAN_ID int,        BENHAN_ID int,        SOLUONG numeric(25, 4),        DONGIA_DOANHTHU numeric(25, 4),        THANHTIEN_DOANHTHU numeric(25, 4),        BHYT_TL numeric(25, 4),        BHYT_DONGIA numeric(25, 4),        BHYT_THANHTIEN numeric(25, 4),        BHYT_DONGIA_CHITRA numeric(25, 4),        BHYT_THANHTIEN_CHITRA numeric(25, 4),        BENHNHAN_PHAITHANHTOAN numeric(25, 4),        SOBHYT_HUONG_ID int,        SOBHYT nvarchar(30)) json        end]
2020-01-02 17:40:12,333 [1] DEBUG - Statement Id: [DAO00067_UpdateDataVienPhiDongiaBHYT] PreparedStatement : [update TT_VIENPHI          set BHYT_DONGIA_CHITRA = 0, BHYT_THANHTIEN = 0, BHYT_THANHTIEN_CHITRA = 0          where          TIEPNHAN_ID = 28493 and BHYT_DONGIA = 0          and (BHYT_DONGIA_CHITRA > 0 or BHYT_THANHTIEN > 0 or BHYT_THANHTIEN_CHITRA > 0)]
2020-01-02 17:40:12,378 [1] DEBUG - Statement Id: [DAO00067_CapnhatDataVienphiKhiHuyThanhtoanHoadon] PreparedStatement : [update TT_VIENPHI        set TT_VIENPHI.HOADON_ID = hdct.HOADON_ID, TT_VIENPHI.GIATRI_BENHNHAN_DATHANHTOAN = TT_VIENPHI.GIATRI_BENHNHAN_DATHANHTOAN + hdct.GIATRI_BENHNHAN_DATHANHTOAN        from (select CT.HOADON_ID, CT.VIENPHI_ID, CT.GIATRI_BENHNHAN_DATHANHTOAN        from TT_HOADON_CHITIET_NGOAITRU CT        join TT_HOADON HD on HD.HOADON_ID = CT.HOADON_ID        join TT_VIENPHI vp on vp.VIENPHI_ID = ct.VIENPHI_ID        where HD.DATHANHTOAN = 1 and HD.HUYHOADON = 0 and HD.HOANTRA = 0 and vp.TIEPNHAN_ID =  @param0 ) hdct        where        TT_VIENPHI.VIENPHI_ID = hdct.VIENPHI_ID and TT_VIENPHI.HOADON_ID is null and isnull(TT_VIENPHI.GIATRI_BENHNHAN_DATHANHTOAN,0) = 0        and TT_VIENPHI.TIEPNHAN_ID =  @param0           update TT_VIENPHI        set TT_VIENPHI.HOADON_ID = null, TT_VIENPHI.GIATRI_BENHNHAN_DATHANHTOAN = TT_VIENPHI.GIATRI_BENHNHAN_DATHANHTOAN - hdct.GIATRI_BENHNHAN_DATHANHTOAN,        TT_VIENPHI.DATHANHTOAN = '0'        from (select CT.HOADON_ID, CT.VIENPHI_ID, CT.GIATRI_BENHNHAN_DATHANHTOAN        from TT_HOADON_CHITIET_NGOAITRU CT        join TT_HOADON HD on HD.HOADON_ID = CT.HOADON_ID        join TT_VIENPHI vp on vp.VIENPHI_ID = ct.VIENPHI_ID and vp.HOADON_ID = ct.HOADON_ID        where HD.DATHANHTOAN = 0 and (HD.HUYHOADON = 1 or HD.HOANTRA = 1) and vp.TIEPNHAN_ID =  @param0 ) hdct        where        TT_VIENPHI.VIENPHI_ID = hdct.VIENPHI_ID and TT_VIENPHI.HOADON_ID = hdct.HOADON_ID        and TT_VIENPHI.TIEPNHAN_ID =  @param0]
2020-01-02 17:40:12,378 [1] DEBUG - Statement Id: [DAO00067_CapnhatDataVienphiKhiHuyThanhtoanHoadon] Parameters: [@param0=[TIEPNHAN_ID,28493]]
2020-01-02 17:40:12,378 [1] DEBUG - Statement Id: [DAO00067_CapnhatDataVienphiKhiHuyThanhtoanHoadon] Types: [@param0=[Int64, System.Int64]]
2020-01-02 17:40:12,689 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'COM16'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2020-01-02 17:40:12,759 [1] DEBUG - Statement Id: [DAO00067_GetList] PreparedStatement : [select PB.*        from TM_PHONGBAN AS PB        inner join LST_DICTIONARY AS D on PB.LOAIPHONGBAN_ID = D.DICTIONARY_ID        and D.DICTIONARY_TYPE_CODE = 'LoaiPhongBan'        and D.DICTIONARY_CODE IN ('PhongBenh','KhamBenh','KhoaNoi','PhongMo','KhoaCLS')        where PB.BENHVIEN_ID = 'HLU01' order by PB.TENPHONGBAN asc]
2020-01-02 17:40:13,548 [1] DEBUG - Statement Id: [DAO00012_GetList] PreparedStatement : [select        DICTIONARY_ID,        DICTIONARY_CODE,        DICTIONARY_NAME,        ATTRIBUTE1,        ATTRIBUTE2,        DICTIONARY_NAME_EN        from LST_DICTIONARY        where LST_DICTIONARY.Enabled = '1'         AND           LST_DICTIONARY.DICTIONARY_TYPE_CODE = 'PhuongTienVanChuyen'                 order by LST_DICTIONARY.IDX]
2020-01-02 17:40:13,648 [1] DEBUG - Statement Id: [DAO00018_GetList] PreparedStatement : [select A.*, B.DICTIONARY_NAME, B.DICTIONARY_CODE, B.DICTIONARY_NAME_EN CHUCDANH, (B.DICTIONARY_NAME_EN + '. ' + A.TENNHANVIEN) TENHOCVIHOCHAM            from TM_NHANVIEN A            left join (select * from LST_DICTIONARY where DICTIONARY_TYPE_CODE = 'chucdanh' and DICTIONARY_NAME_EN is not null) B on A.CHUCDANH_ID = B.DICTIONARY_ID            where A.BENHVIEN_ID = 'HLU01' and A.TAMNGUNG = '0']
2020-01-02 17:40:14,208 [1] DEBUG - Statement Id: [DAO00012_GetList] PreparedStatement : [select        DICTIONARY_ID,        DICTIONARY_CODE,        DICTIONARY_NAME,        ATTRIBUTE1,        ATTRIBUTE2,        DICTIONARY_NAME_EN        from LST_DICTIONARY        where LST_DICTIONARY.Enabled = '1'         AND           LST_DICTIONARY.DICTIONARY_TYPE_CODE = 'LyDoChuyenVien'                 order by LST_DICTIONARY.IDX]
2020-01-02 17:40:14,724 [1] DEBUG - Statement Id: [DAO00067_GET_CHUYENVIENINFO_FROM_BENHNHANID] PreparedStatement : [select *        from TT_CHUYENVIEN        where BENHNHAN_ID  = '0' and BENHVIEN_ID = 'HLU01'        and TIEPNHAN_ID = '28493'         and           KHAMBENH_ID = '27176']
2020-01-02 17:40:14,757 [1] DEBUG - Statement Id: [DAO00014_GetChanDoan] PreparedStatement : [DECLARE @VAL1 NVARCHAR(1000) = ''        DECLARE @VAL2 NVARCHAR(1000) = ''        SELECT @VAL1 = (SELECT ICD.TENICD +'('+ICD.MAICD+'); '+ KB.CHANDOANKHOAKHAM FROM TT_NGOAITRU_KHAMBENH KB        INNER JOIN TM_ICD ICD ON ICD.ICD_ID = KB.CHANDOANICD_ID        WHERE KHAMBENH_ID =  @param0 )        SELECT @VAl2 = @VAL2 + ICD.TENICD +'('+ICD.MAICD +'); ' FROM        TT_NGOAITRU_KHAMBENH_ICD KBI        INNER JOIN TM_ICD ICD ON KBI.ICD_ID = ICD.ICD_ID        WHERE KBI.KHAMBENH_ID =  @param0         SELECT @VAL1 + '; '+ ISNULL(@VAL2,'')]
2020-01-02 17:40:14,757 [1] DEBUG - Statement Id: [DAO00014_GetChanDoan] Parameters: [@param0=[KHAMBENH_ID,27176]]
2020-01-02 17:40:14,757 [1] DEBUG - Statement Id: [DAO00014_GetChanDoan] Types: [@param0=[Int64, System.Int64]]
2020-01-02 17:40:14,941 [1] DEBUG - Statement Id: [DAO00016_GetDSThuocDaDungByTiepNhan] PreparedStatement : [select A.*, dc.TENDUOCDAYDU        from TT_NGOAITRU_TOATHUOC A        left join TM_DUOC dc on A.DUOC_ID = dc.DUOC_ID        where exists (select KHAMBENH_ID from TT_NGOAITRU_KHAMBENH where A.KHAMBENH_ID = KHAMBENH_ID and  TIEPNHAN_ID = '28493')        and exists (select KHAMBENH_TOATHUOC_ID from TT_NGOAITRU_KHAMBENH_TOATHUOC where A.KHAMBENH_TOATHUOC_ID = KHAMBENH_TOATHUOC_ID and CHUNGTUPHATTHUOC_ID is not null)        and A.BENHVIEN_ID = 'HLU01']
2020-01-02 17:40:15,053 [1] DEBUG - Statement Id: [DAO00067_GetDanhsachDichvuDungChoChuyentuyen] PreparedStatement : [select A.DICHVU_ID, B.TENDICHVU, A.DVYEUCAU_ID        from TT_DVYEUCAU A        left join TM_DICHVU B on A.DICHVU_ID = B.DICHVU_ID        left join TM_NHOMDICHVU C on C.NHOMDICHVU_ID = B.NHOMDICHVU_ID        where        ( @param0  IS NOT NULL OR  @param1  IS NOT NULL) AND        LEFT(C.MANHOMDICHVU,2) in ('01', '02', '05', '06') and A.HUYYEUCAU = '0'         and           A.TIEPNHAN_ID = '28493']
2020-01-02 17:40:15,053 [1] DEBUG - Statement Id: [DAO00067_GetDanhsachDichvuDungChoChuyentuyen] Parameters: [@param0=[BENHAN_ID,null], @param1=[TIEPNHAN_ID,28493]]
2020-01-02 17:40:15,053 [1] DEBUG - Statement Id: [DAO00067_GetDanhsachDichvuDungChoChuyentuyen] Types: [@param0=[System.DBNull, null], @param1=[Int64, System.Int64]]
2020-01-02 17:40:15,092 [1] DEBUG - Statement Id: [DAO00067_GetDanhsachxetnghiemkq] PreparedStatement : [select distinct C.CLSKETQUACHITIET_ID, B.TENDICHVU, C.KETQUA, C.DICHVU_ID, A.DVYEUCAU_ID        from TT_DVYEUCAU A        inner join TT_CLSKETQUACHITIET C on C.DVYEUCAU_ID = A.DVYEUCAU_ID        left join TM_DICHVU B on C.DICHVU_ID = B.DICHVU_ID        where A.HUYYEUCAU = '0' and A.BENHAN_ID is not null                 AND ( @param0  IS NOT NULL OR  @param1  IS NOT NULL)         and           A.TIEPNHAN_ID = '28493'                 order by C.CLSKETQUACHITIET_ID]
2020-01-02 17:40:15,092 [1] DEBUG - Statement Id: [DAO00067_GetDanhsachxetnghiemkq] Parameters: [@param0=[BENHAN_ID,null], @param1=[TIEPNHAN_ID,28493]]
2020-01-02 17:40:15,092 [1] DEBUG - Statement Id: [DAO00067_GetDanhsachxetnghiemkq] Types: [@param0=[System.DBNull, null], @param1=[Int64, System.Int64]]
2020-01-02 17:40:15,135 [1] DEBUG - Statement Id: [DAO00067_GetDanhsachsieuamkq] PreparedStatement : [select C.DVYEUCAU_ID, B.TENDICHVU,C.KETLUAN        from TT_DVYEUCAU A        inner join TT_CLSKETQUA C on C.DVYEUCAU_ID = A.DVYEUCAU_ID        left join TM_DICHVU B on C.DICHVU_ID = B.DICHVU_ID        where        ( @param0  IS NOT NULL OR  @param1  IS NOT NULL) AND                 A.DVYEUCAU_ID not in        (select DVYEUCAU_ID from TT_CLSKETQUACHITIET        where exists (        select DVYEUCAU_ID from TT_DVYEUCAU where TT_CLSKETQUACHITIET.DVYEUCAU_ID = DVYEUCAU_ID                 ))         and           A.TIEPNHAN_ID = 28493]
2020-01-02 17:40:15,135 [1] DEBUG - Statement Id: [DAO00067_GetDanhsachsieuamkq] Parameters: [@param0=[BENHAN_ID,null], @param1=[TIEPNHAN_ID,28493]]
2020-01-02 17:40:15,135 [1] DEBUG - Statement Id: [DAO00067_GetDanhsachsieuamkq] Types: [@param0=[System.DBNull, null], @param1=[Int64, System.Int64]]
2020-01-02 17:40:36,833 [1] DEBUG - Statement Id: [DAO00067_GET_CHUYENVIENINFO_FROM_BENHNHANID] PreparedStatement : [select *        from TT_CHUYENVIEN        where BENHNHAN_ID  = '24441' and BENHVIEN_ID = 'HLU01'        and TIEPNHAN_ID = '28493'         and           KHAMBENH_ID = '27176']
2020-01-02 17:40:36,890 [1] DEBUG - Statement Id: [DAO00022_GetDetail] PreparedStatement : [select KEYTYPE, KEYYEAR, KEYMONTH, KEYDAY, SEGMENT_1, SEGMENT_2, SEGMENT_3, KEYVALUE              from [LST_KEYDATA] as kd               WHERE                        kd.KEYTYPE = N'SOPHIEUCHUYENVIEN'                   AND                       kd.KEYYEAR = '2020'                   AND                       kd.KEYMONTH = '0'                   AND                       kd.KEYDAY = '0']
2020-01-02 17:40:36,945 [1] DEBUG - Statement Id: [DAO00022_Add] PreparedStatement : [insert into LST_KEYDATA (              KEYTYPE, KEYYEAR, KEYMONTH, KEYDAY, SEGMENT_1, SEGMENT_2, SEGMENT_3, KEYVALUE, BENHVIEN_ID              ) values (               @param0 ,  @param1 ,  @param2 ,  @param3 ,  @param4 ,  @param5 ,  @param6 ,  @param7 ,  @param8               )]
2020-01-02 17:40:36,949 [1] DEBUG - Statement Id: [DAO00022_Add] Parameters: [@param0=[KEYTYPE,SOPHIEUCHUYENVIEN], @param1=[KEYYEAR,2020], @param2=[KEYMONTH,0], @param3=[KEYDAY,0], @param4=[SEGMENT_1,0], @param5=[SEGMENT_2,0], @param6=[SEGMENT_3,0], @param7=[KEYVALUE,0001], @param8=[BENHVIEN_ID,HLU01]]
2020-01-02 17:40:36,949 [1] DEBUG - Statement Id: [DAO00022_Add] Types: [@param0=[String, System.String], @param1=[Int32, System.Int32], @param2=[Int32, System.Int32], @param3=[Int32, System.Int32], @param4=[String, System.String], @param5=[String, System.String], @param6=[String, System.String], @param7=[String, System.String], @param8=[String, System.String]]
2020-01-02 17:40:37,064 [1] DEBUG - Statement Id: [DAO00067_AddChuyenVienInfo] PreparedStatement : [insert into TT_CHUYENVIEN (        SOPHIEU        , BENHNHAN_ID        , TIEPNHAN_ID        , KHAMBENH_ID        , BENHANNOITRU_ID        , BENHANNGOAITRU_ID        , BACSIYEUCAU_ID        , BACSITRUONGKHOA_ID        , BENHVIEN_CHUYENDEN_ID        , LYDOCHUYENVIEN_ID        , CHANDOANICD_ID        , CHANDOAN        , NGAYCHUYEN        , GHICHU        , DAUHIEULAMSANG        , TINHTRANG        , NGUOIDUADI        , PHUONGTIEN        , CHUYENVIENBANGGIAYKHAISINH        , THUOCDADUNG        , HINHTHUCCHUYENVIEN_ID        , HUONGDIEUTRI        , TIEPNHAN_NOIGIOITHIEU_ID        , TIEPNHAN_SOCHUYENTUYEN        , TIEPNHAN_NGAYCHUYENDEN        , TIEPNHAN_TUYENCHUYEN_ID        , TIEPNHAN_LYDOCHUYENDEN_ID        , TIEPNHAN_CHANDOAN_NGT        , PHUONGTIEN_ID        , BENHVIEN_ID        , NGAYTAO        , NGUOITAO_ID        , NGAYCAPNHAT        , NGUOICAPNHAT_ID        ) values (         @param0         ,  @param1         ,  @param2         ,  @param3         ,  @param4         ,  @param5         ,  @param6         ,  @param7         ,  @param8         ,  @param9         ,  @param10         ,  @param11         ,  @param12         ,  @param13         ,  @param14         ,  @param15         ,  @param16         ,  @param17         ,  @param18         ,  @param19         ,  @param20         ,  @param21         ,  @param22         ,  @param23         ,  @param24         ,  @param25         ,  @param26         ,  @param27         ,  @param28         ,  @param29         ,  @param30         ,  @param31         ,  @param32         ,  @param33         )        SELECT SCOPE_IDENTITY()]
2020-01-02 17:40:37,064 [1] DEBUG - Statement Id: [DAO00067_AddChuyenVienInfo] Parameters: [@param0=[SOPHIEU,20200001], @param1=[BENHNHAN_ID,24441], @param2=[TIEPNHAN_ID,28493], @param3=[KHAMBENH_ID,27176], @param4=[BENHANNOITRU_ID,null], @param5=[BENHANNGOAITRU_ID,null], @param6=[BACSIYEUCAU_ID,1], @param7=[BACSITRUONGKHOA_ID,null], @param8=[BENHVIEN_CHUYENDEN_ID,7179], @param9=[LYDOCHUYENVIEN_ID,1021], @param10=[CHANDOANICD_ID,3990], @param11=[CHANDOAN,Viêm phế quản cấp(J20); Viêm phế quản cấp(J20); ], @param12=[NGAYCHUYEN,1/2/2020 5:40:14 PM], @param13=[GHICHU,không], @param14=[DAUHIEULAMSANG,test], @param15=[TINHTRANG,test 1], @param16=[NGUOIDUADI,test], @param17=[PHUONGTIEN,null], @param18=[CHUYENVIENBANGGIAYKHAISINH,False], @param19=[THUOCDADUNG,không], @param20=[HINHTHUCCHUYENVIEN_ID,null], @param21=[HUONGDIEUTRI,test], @param22=[TIEPNHAN_NOIGIOITHIEU_ID,62], @param23=[TIEPNHAN_SOCHUYENTUYEN,null], @param24=[TIEPNHAN_NGAYCHUYENDEN,null], @param25=[TIEPNHAN_TUYENCHUYEN_ID,null], @param26=[TIEPNHAN_LYDOCHUYENDEN_ID,null], @param27=[TIEPNHAN_CHANDOAN_NGT,null], @param28=[PHUONGTIEN_ID,null], @param29=[BENHVIEN_ID,HLU01], @param30=[NGAYTAO,1/2/2020 5:40:37 PM], @param31=[NGUOITAO_ID,1], @param32=[NGAYCAPNHAT,1/2/2020 5:40:37 PM], @param33=[NGUOICAPNHAT_ID,1]]
2020-01-02 17:40:37,064 [1] DEBUG - Statement Id: [DAO00067_AddChuyenVienInfo] Types: [@param0=[String, System.String], @param1=[Int64, System.Int64], @param2=[Int64, System.Int64], @param3=[Int64, System.Int64], @param4=[System.DBNull, null], @param5=[System.DBNull, null], @param6=[Int64, System.Int64], @param7=[System.DBNull, null], @param8=[Int64, System.Int64], @param9=[String, System.String], @param10=[Int64, System.Int64], @param11=[String, System.String], @param12=[DateTime, System.DateTime], @param13=[String, System.String], @param14=[String, System.String], @param15=[String, System.String], @param16=[String, System.String], @param17=[System.DBNull, null], @param18=[Boolean, System.Boolean], @param19=[String, System.String], @param20=[System.DBNull, null], @param21=[String, System.String], @param22=[Int64, System.Int64], @param23=[System.DBNull, null], @param24=[System.DBNull, null], @param25=[System.DBNull, null], @param26=[System.DBNull, null], @param27=[System.DBNull, null], @param28=[System.DBNull, null], @param29=[String, System.String], @param30=[DateTime, System.DateTime], @param31=[Int64, System.Int64], @param32=[DateTime, System.DateTime], @param33=[Int64, System.Int64]]
2020-01-02 17:40:41,544 [1] DEBUG - Statement Id: [DAO00017_GetLoaiGiaByDoiTuongId] PreparedStatement : [select dtlg.DOUUTIEN, dtlg.DOITUONG_ID, lg.LOAIGIA_ID, lg.TENLOAIGIA, lg.MALOAIGIA              from TM_LOAIGIA lg              left join TM_DOITUONG_LOAIGIA dtlg              on lg.LOAIGIA_ID = dtlg.LOAIGIA_ID and dtlg.BENHVIEN_ID = 'HLU01'              where lg.TAMNGUNG = 0 and lg.BENHVIEN_ID = 'HLU01'                             order by dtlg.DOUUTIEN]
2020-01-02 17:40:41,693 [1] DEBUG - Statement Id: [DAO00014_KiemTraDVYCCoGiaBHYT] PreparedStatement : [select *        from TT_VIENPHI        where REF_ID  = '' and REF_TABLE = 'TT_DVYEUCAU' and BHYT_DONGIA > 0]
2020-01-02 17:40:41,746 [1] DEBUG - Statement Id: [DAO00040_LayListToaMau] PreparedStatement : [select A.*, dc.TENDUOCDAYDU, dc.BHYT DUOC_BHYT, ld.LOAIVATTU_ID, ld.MALOAIDUOC, dd.DICTIONARY_NAME DUONGDUNG, dc.TAMNGUNG            from TT_TOATHUOCMAU A            left join TM_DUOC dc on A.DUOC_ID = dc.DUOC_ID            left join TM_LOAIDUOC ld on dc.LOAIDUOC_ID = ld.LOAIDUOC_ID            left join (select * from LST_DICTIONARY where DICTIONARY_TYPE_CODE like 'DuongDung') dd on dd.DICTIONARY_ID = dc.DUONGDUNG_ID            where (1=1)             and               A.BACSI_ID  = 1              and A.LOAITOATHUOC in  (                        @param0                   ,                           @param1                   ,                           @param2                   ,                           @param3                   )]
2020-01-02 17:40:41,746 [1] DEBUG - Statement Id: [DAO00040_LayListToaMau] Parameters: [@param0=[LSTLOAITOATHUOC[0],BV], @param1=[LSTLOAITOATHUOC[1],MN], @param2=[LSTLOAITOATHUOC[2],MP], @param3=[LSTLOAITOATHUOC[3],TV]]
2020-01-02 17:40:41,746 [1] DEBUG - Statement Id: [DAO00040_LayListToaMau] Types: [@param0=[String, System.String], @param1=[String, System.String], @param2=[String, System.String], @param3=[String, System.String]]
2020-01-02 17:40:41,824 [1] DEBUG - Statement Id: [DAO00040_LayListToaMau] PreparedStatement : [select A.*, dc.TENDUOCDAYDU, dc.BHYT DUOC_BHYT, ld.LOAIVATTU_ID, ld.MALOAIDUOC, dd.DICTIONARY_NAME DUONGDUNG, dc.TAMNGUNG            from TT_TOATHUOCMAU A            left join TM_DUOC dc on A.DUOC_ID = dc.DUOC_ID            left join TM_LOAIDUOC ld on dc.LOAIDUOC_ID = ld.LOAIDUOC_ID            left join (select * from LST_DICTIONARY where DICTIONARY_TYPE_CODE like 'DuongDung') dd on dd.DICTIONARY_ID = dc.DUONGDUNG_ID            where (1=1)             and               A.BACSI_ID  = 1              and A.LOAITOATHUOC in  (                        @param0                   ,                           @param1                   ,                           @param2                   ,                           @param3                   )]
2020-01-02 17:40:41,825 [1] DEBUG - Statement Id: [DAO00040_LayListToaMau] Parameters: [@param0=[LSTLOAITOATHUOC[0],BV], @param1=[LSTLOAITOATHUOC[1],MN], @param2=[LSTLOAITOATHUOC[2],MP], @param3=[LSTLOAITOATHUOC[3],TV]]
2020-01-02 17:40:41,825 [1] DEBUG - Statement Id: [DAO00040_LayListToaMau] Types: [@param0=[String, System.String], @param1=[String, System.String], @param2=[String, System.String], @param3=[String, System.String]]
2020-01-02 17:40:41,857 [1] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoVaBookingCOM23UpdateRedis_TheoPhamvi] PreparedStatement : [declare @TOAMUANGOAI int = 0;        select @TOAMUANGOAI = isnull(VALUE,0) from TM_SYS_APPSETTINGS where CODE = 'OPD_TOAMUANGOAI_DUNGDANHMUC_DUOC'                if @TOAMUANGOAI = 1        begin        select  distinct '0' + '_' + LTRIM(d.DUOC_ID) + '_' + '0' as DUOC_KEY, 999999999 as SOLUONG        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        where  @param0  = 0        union all        select distinct tk.DUOC_KEY, tk.SOLUONG        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        inner join        (        select  LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')) DUOC_KEY, (SUM(dtk.SOLUONG) - isnull(sum(A.SOLUONG),0) - isnull(sum(B.SOLUONG),0)) SOLUONG, pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        from (select sum(soluong) soluong,duoc_id,nguonduoc_id,khoduoc_id,benhvien_id from TT_DUOC_TONKHO  group by duoc_id,nguonduoc_id,khoduoc_id,benhvien_id) dtk        inner join TM_DUOC_PHAMVISD_MAPPING pvsd on dtk.KHODUOC_ID = pvsd.KHODUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NOITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) B on B.DUOC_ID = dtk.DUOC_ID and B.PHAMVI_ID = pvsd.PHAMVI_ID and B.NGUONHANG_ID = dtk.NGUONDUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NGOAITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) A on A.DUOC_ID = dtk.DUOC_ID and A.PHAMVI_ID = pvsd.PHAMVI_ID and A.NGUONHANG_ID = dtk.NGUONDUOC_ID        where dtk.BENHVIEN_ID = 'HLU01'        group by LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')), pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        ) tk on tk.DUOC_ID = d.DUOC_ID        left join TM_DUOC_PHAMVISUDUNG kd on kd.PHAMVI_ID = tk.PHAMVI_ID and kd.BENHVIEN_ID = 'HLU01'        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = tk.NGUONDUOC_ID and nh.BENHVIEN_ID = 'HLU01'        where d.BENHVIEN_ID = 'HLU01' and tk.PHAMVI_ID =  @param0         end        else        begin        select distinct tk.DUOC_KEY, tk.SOLUONG        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        inner join        (        select  LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')) DUOC_KEY, (SUM(dtk.SOLUONG) - isnull(sum(A.SOLUONG),0) - isnull(sum(B.SOLUONG),0)) SOLUONG, pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        from (select sum(soluong) soluong,duoc_id,nguonduoc_id,khoduoc_id,benhvien_id from TT_DUOC_TONKHO  group by duoc_id,nguonduoc_id,khoduoc_id,benhvien_id) dtk        inner join TM_DUOC_PHAMVISD_MAPPING pvsd on dtk.KHODUOC_ID = pvsd.KHODUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NOITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) B on B.DUOC_ID = dtk.DUOC_ID and B.PHAMVI_ID = pvsd.PHAMVI_ID and B.NGUONHANG_ID = dtk.NGUONDUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NGOAITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) A on A.DUOC_ID = dtk.DUOC_ID and A.PHAMVI_ID = pvsd.PHAMVI_ID and A.NGUONHANG_ID = dtk.NGUONDUOC_ID        where dtk.BENHVIEN_ID = 'HLU01'        group by LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')), pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        ) tk on tk.DUOC_ID = d.DUOC_ID        left join TM_DUOC_PHAMVISUDUNG kd on kd.PHAMVI_ID = tk.PHAMVI_ID and kd.BENHVIEN_ID = 'HLU01'        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = tk.NGUONDUOC_ID and nh.BENHVIEN_ID = 'HLU01'        where d.BENHVIEN_ID = 'HLU01' and tk.PHAMVI_ID =  @param0         end]
2020-01-02 17:40:41,858 [1] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoVaBookingCOM23UpdateRedis_TheoPhamvi] Parameters: [@param0=[PHAMVI_ID,1033]]
2020-01-02 17:40:41,858 [1] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoVaBookingCOM23UpdateRedis_TheoPhamvi] Types: [@param0=[Int64, System.Int64]]
2020-01-02 17:40:42,051 [1] DEBUG - Statement Id: [DAO00012_GetLoaiTCLS] PreparedStatement : [select DICTIONARY_ID, DICTIONARY_CODE, DICTIONARY_NAME, cast('0' as Bit) CHON        from LST_DICTIONARY              where DICTIONARY_TYPE_CODE = 'KHAMBENH_LOAI_TRIEUCHUNGLS'        order by LST_DICTIONARY.IDX]
2020-01-02 17:40:42,078 [1] DEBUG - Statement Id: [DAO00012_GetAllTCLS] PreparedStatement : [select MALOAITRIEUCHUNG DICTIONARY_TYPE_CODE, MALOAITRIEUCHUNG DICTIONARY_CODE,        TENTRIEUCHUNG DICTIONARY_NAME from TM_TRIEUCHUNGLS]
2020-01-02 17:40:42,104 [1] DEBUG - Statement Id: [DAO00019_ThongTinBenhNhanDvYeuCau] PreparedStatement : [select distinct A.SOTIEPNHAN, A.TIEPNHAN_ID, A.DOITUONG_ID, A.TRANGTHAI,        A.LOAITHANHVIEN_ID, A.SUDUNG_BHTN, A.THE_ID, A.THANHVIEN_ID, A.VIP, A.NGUON_BENHNHAN_ID, A.BAOLANH_VIENPHI, A.NGAYMIENDONGCHITRA,        B.*,  C.DICHVU_ID, C.DVYEUCAU_ID, C.NOITHUCHIEN_ID, A.SOBHYT        from TT_TIEPNHAN A        inner join TT_DVYEUCAU C on C.TIEPNHAN_ID = A.TIEPNHAN_ID        inner join TT_BENHNHAN B on B.BENHNHAN_ID = A.BENHNHAN_ID and B.ACTIVE = '1'        where                    C.DVYEUCAU_ID = '206520'                 and A.BENHVIEN_ID = 'HLU01']
2020-01-02 17:40:42,220 [1] DEBUG - Statement Id: [DAO00017_GetLoaiGiaByDoiTuongId] PreparedStatement : [select dtlg.DOUUTIEN, dtlg.DOITUONG_ID, lg.LOAIGIA_ID, lg.TENLOAIGIA, lg.MALOAIGIA              from TM_LOAIGIA lg              left join TM_DOITUONG_LOAIGIA dtlg              on lg.LOAIGIA_ID = dtlg.LOAIGIA_ID and dtlg.BENHVIEN_ID = 'HLU01'              where lg.TAMNGUNG = 0 and lg.BENHVIEN_ID = 'HLU01'                             order by dtlg.DOUUTIEN]
2020-01-02 17:40:42,276 [1] DEBUG - Statement Id: [DAO00014_KiemTraDVYCCoGiaBHYT] PreparedStatement : [select *        from TT_VIENPHI        where REF_ID  = '206520' and REF_TABLE = 'TT_DVYEUCAU' and BHYT_DONGIA > 0]
2020-01-02 17:40:42,318 [1] DEBUG - Statement Id: [DAO00040_LayListToaMau] PreparedStatement : [select A.*, dc.TENDUOCDAYDU, dc.BHYT DUOC_BHYT, ld.LOAIVATTU_ID, ld.MALOAIDUOC, dd.DICTIONARY_NAME DUONGDUNG, dc.TAMNGUNG            from TT_TOATHUOCMAU A            left join TM_DUOC dc on A.DUOC_ID = dc.DUOC_ID            left join TM_LOAIDUOC ld on dc.LOAIDUOC_ID = ld.LOAIDUOC_ID            left join (select * from LST_DICTIONARY where DICTIONARY_TYPE_CODE like 'DuongDung') dd on dd.DICTIONARY_ID = dc.DUONGDUNG_ID            where (1=1)             and               A.BACSI_ID  = 1              and A.LOAITOATHUOC in  (                        @param0                   ,                           @param1                   ,                           @param2                   ,                           @param3                   )]
2020-01-02 17:40:42,318 [1] DEBUG - Statement Id: [DAO00040_LayListToaMau] Parameters: [@param0=[LSTLOAITOATHUOC[0],BV], @param1=[LSTLOAITOATHUOC[1],MN], @param2=[LSTLOAITOATHUOC[2],MP], @param3=[LSTLOAITOATHUOC[3],TV]]
2020-01-02 17:40:42,318 [1] DEBUG - Statement Id: [DAO00040_LayListToaMau] Types: [@param0=[String, System.String], @param1=[String, System.String], @param2=[String, System.String], @param3=[String, System.String]]
2020-01-02 17:40:42,401 [1] DEBUG - Statement Id: [DAO00040_LayListToaMau] PreparedStatement : [select A.*, dc.TENDUOCDAYDU, dc.BHYT DUOC_BHYT, ld.LOAIVATTU_ID, ld.MALOAIDUOC, dd.DICTIONARY_NAME DUONGDUNG, dc.TAMNGUNG            from TT_TOATHUOCMAU A            left join TM_DUOC dc on A.DUOC_ID = dc.DUOC_ID            left join TM_LOAIDUOC ld on dc.LOAIDUOC_ID = ld.LOAIDUOC_ID            left join (select * from LST_DICTIONARY where DICTIONARY_TYPE_CODE like 'DuongDung') dd on dd.DICTIONARY_ID = dc.DUONGDUNG_ID            where (1=1)             and               A.BACSI_ID  = 1              and A.LOAITOATHUOC in  (                        @param0                   ,                           @param1                   ,                           @param2                   ,                           @param3                   )]
2020-01-02 17:40:42,401 [1] DEBUG - Statement Id: [DAO00040_LayListToaMau] Parameters: [@param0=[LSTLOAITOATHUOC[0],BV], @param1=[LSTLOAITOATHUOC[1],MN], @param2=[LSTLOAITOATHUOC[2],MP], @param3=[LSTLOAITOATHUOC[3],TV]]
2020-01-02 17:40:42,401 [1] DEBUG - Statement Id: [DAO00040_LayListToaMau] Types: [@param0=[String, System.String], @param1=[String, System.String], @param2=[String, System.String], @param3=[String, System.String]]
2020-01-02 17:40:42,437 [1] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoVaBookingCOM23UpdateRedis_TheoPhamvi] PreparedStatement : [declare @TOAMUANGOAI int = 0;        select @TOAMUANGOAI = isnull(VALUE,0) from TM_SYS_APPSETTINGS where CODE = 'OPD_TOAMUANGOAI_DUNGDANHMUC_DUOC'                if @TOAMUANGOAI = 1        begin        select  distinct '0' + '_' + LTRIM(d.DUOC_ID) + '_' + '0' as DUOC_KEY, 999999999 as SOLUONG        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        where  @param0  = 0        union all        select distinct tk.DUOC_KEY, tk.SOLUONG        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        inner join        (        select  LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')) DUOC_KEY, (SUM(dtk.SOLUONG) - isnull(sum(A.SOLUONG),0) - isnull(sum(B.SOLUONG),0)) SOLUONG, pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        from (select sum(soluong) soluong,duoc_id,nguonduoc_id,khoduoc_id,benhvien_id from TT_DUOC_TONKHO  group by duoc_id,nguonduoc_id,khoduoc_id,benhvien_id) dtk        inner join TM_DUOC_PHAMVISD_MAPPING pvsd on dtk.KHODUOC_ID = pvsd.KHODUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NOITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) B on B.DUOC_ID = dtk.DUOC_ID and B.PHAMVI_ID = pvsd.PHAMVI_ID and B.NGUONHANG_ID = dtk.NGUONDUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NGOAITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) A on A.DUOC_ID = dtk.DUOC_ID and A.PHAMVI_ID = pvsd.PHAMVI_ID and A.NGUONHANG_ID = dtk.NGUONDUOC_ID        where dtk.BENHVIEN_ID = 'HLU01'        group by LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')), pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        ) tk on tk.DUOC_ID = d.DUOC_ID        left join TM_DUOC_PHAMVISUDUNG kd on kd.PHAMVI_ID = tk.PHAMVI_ID and kd.BENHVIEN_ID = 'HLU01'        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = tk.NGUONDUOC_ID and nh.BENHVIEN_ID = 'HLU01'        where d.BENHVIEN_ID = 'HLU01' and tk.PHAMVI_ID =  @param0         end        else        begin        select distinct tk.DUOC_KEY, tk.SOLUONG        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        inner join        (        select  LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')) DUOC_KEY, (SUM(dtk.SOLUONG) - isnull(sum(A.SOLUONG),0) - isnull(sum(B.SOLUONG),0)) SOLUONG, pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        from (select sum(soluong) soluong,duoc_id,nguonduoc_id,khoduoc_id,benhvien_id from TT_DUOC_TONKHO  group by duoc_id,nguonduoc_id,khoduoc_id,benhvien_id) dtk        inner join TM_DUOC_PHAMVISD_MAPPING pvsd on dtk.KHODUOC_ID = pvsd.KHODUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NOITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) B on B.DUOC_ID = dtk.DUOC_ID and B.PHAMVI_ID = pvsd.PHAMVI_ID and B.NGUONHANG_ID = dtk.NGUONDUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NGOAITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) A on A.DUOC_ID = dtk.DUOC_ID and A.PHAMVI_ID = pvsd.PHAMVI_ID and A.NGUONHANG_ID = dtk.NGUONDUOC_ID        where dtk.BENHVIEN_ID = 'HLU01'        group by LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')), pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        ) tk on tk.DUOC_ID = d.DUOC_ID        left join TM_DUOC_PHAMVISUDUNG kd on kd.PHAMVI_ID = tk.PHAMVI_ID and kd.BENHVIEN_ID = 'HLU01'        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = tk.NGUONDUOC_ID and nh.BENHVIEN_ID = 'HLU01'        where d.BENHVIEN_ID = 'HLU01' and tk.PHAMVI_ID =  @param0         end]
2020-01-02 17:40:42,437 [1] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoVaBookingCOM23UpdateRedis_TheoPhamvi] Parameters: [@param0=[PHAMVI_ID,1028]]
2020-01-02 17:40:42,437 [1] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoVaBookingCOM23UpdateRedis_TheoPhamvi] Types: [@param0=[Int64, System.Int64]]
2020-01-02 17:40:42,606 [1] DEBUG - Statement Id: [DAO00013_GetTienSuBenh] PreparedStatement : [select TIENSUBENH, TIENSUDIUNG        from TT_BENHNHAN        where TT_BENHNHAN.BENHNHAN_ID  = '24442']
2020-01-02 17:40:42,632 [1] DEBUG - Statement Id: [DAO00095_GetTTDiUngThuoc] PreparedStatement : [select *              from TT_BENHNHAN_DIUNG_THUOC              where BENHNHAN_ID = '24442'              and BENHVIEN_ID = 'HLU01']
2020-01-02 17:40:42,658 [1] DEBUG - Statement Id: [DAO00014_GetTotalChiPhiDVByTiepNhan] PreparedStatement : [select sum(THANHTIEN_DOANHTHU) as THANHTIEN_DOANHTHU from TT_VIENPHI        where ACTIVE = '1'        and TIEPNHAN_ID = '28494'        and REF_TABLE = 'TT_DVYEUCAU'        and exists (select DVYEUCAU_ID from TT_DVYEUCAU where HUYYEUCAU = '0' and TIEPNHAN_ID = '28494' and TT_VIENPHI.REF_ID = DVYEUCAU_ID)]
2020-01-02 17:40:42,720 [1] DEBUG - Statement Id: [DAO00014_GetKhamBenhInfo] PreparedStatement : [select * from TT_NGOAITRU_KHAMBENH where KHAMBENH_ID =        (select KHAMBENH_NGOAITRU_ID from TT_DVYEUCAU where DVYEUCAU_ID = '206520')]
2020-01-02 17:40:42,753 [1] DEBUG - Statement Id: [DAO00014_GetSoCaKhamTrongNgay] PreparedStatement : [select Count(KB.KHAMBENH_ID) as SOCAKHAMTRONGNGAY        from TT_NGOAITRU_KHAMBENH KB        inner join TT_TIEPNHAN TN on TN.TIEPNHAN_ID = KB.TIEPNHAN_ID        where KB.NGAYKHAM = convert(date, GETDATE())        and KB.BACSIKHAM_ID = '1'        and KB.BENHVIEN_ID = 'HLU01'        and TN.SOBHYT IS NOT NULL and TN.SOBHYT != '']
2020-01-02 17:40:42,879 [1] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoVaBookingCOM23UpdateRedis_TheoPhamvi] PreparedStatement : [declare @TOAMUANGOAI int = 0;        select @TOAMUANGOAI = isnull(VALUE,0) from TM_SYS_APPSETTINGS where CODE = 'OPD_TOAMUANGOAI_DUNGDANHMUC_DUOC'                if @TOAMUANGOAI = 1        begin        select  distinct '0' + '_' + LTRIM(d.DUOC_ID) + '_' + '0' as DUOC_KEY, 999999999 as SOLUONG        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        where  @param0  = 0        union all        select distinct tk.DUOC_KEY, tk.SOLUONG        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        inner join        (        select  LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')) DUOC_KEY, (SUM(dtk.SOLUONG) - isnull(sum(A.SOLUONG),0) - isnull(sum(B.SOLUONG),0)) SOLUONG, pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        from (select sum(soluong) soluong,duoc_id,nguonduoc_id,khoduoc_id,benhvien_id from TT_DUOC_TONKHO  group by duoc_id,nguonduoc_id,khoduoc_id,benhvien_id) dtk        inner join TM_DUOC_PHAMVISD_MAPPING pvsd on dtk.KHODUOC_ID = pvsd.KHODUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NOITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) B on B.DUOC_ID = dtk.DUOC_ID and B.PHAMVI_ID = pvsd.PHAMVI_ID and B.NGUONHANG_ID = dtk.NGUONDUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NGOAITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) A on A.DUOC_ID = dtk.DUOC_ID and A.PHAMVI_ID = pvsd.PHAMVI_ID and A.NGUONHANG_ID = dtk.NGUONDUOC_ID        where dtk.BENHVIEN_ID = 'HLU01'        group by LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')), pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        ) tk on tk.DUOC_ID = d.DUOC_ID        left join TM_DUOC_PHAMVISUDUNG kd on kd.PHAMVI_ID = tk.PHAMVI_ID and kd.BENHVIEN_ID = 'HLU01'        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = tk.NGUONDUOC_ID and nh.BENHVIEN_ID = 'HLU01'        where d.BENHVIEN_ID = 'HLU01' and tk.PHAMVI_ID =  @param0         end        else        begin        select distinct tk.DUOC_KEY, tk.SOLUONG        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        inner join        (        select  LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')) DUOC_KEY, (SUM(dtk.SOLUONG) - isnull(sum(A.SOLUONG),0) - isnull(sum(B.SOLUONG),0)) SOLUONG, pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        from (select sum(soluong) soluong,duoc_id,nguonduoc_id,khoduoc_id,benhvien_id from TT_DUOC_TONKHO  group by duoc_id,nguonduoc_id,khoduoc_id,benhvien_id) dtk        inner join TM_DUOC_PHAMVISD_MAPPING pvsd on dtk.KHODUOC_ID = pvsd.KHODUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NOITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) B on B.DUOC_ID = dtk.DUOC_ID and B.PHAMVI_ID = pvsd.PHAMVI_ID and B.NGUONHANG_ID = dtk.NGUONDUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NGOAITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) A on A.DUOC_ID = dtk.DUOC_ID and A.PHAMVI_ID = pvsd.PHAMVI_ID and A.NGUONHANG_ID = dtk.NGUONDUOC_ID        where dtk.BENHVIEN_ID = 'HLU01'        group by LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')), pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        ) tk on tk.DUOC_ID = d.DUOC_ID        left join TM_DUOC_PHAMVISUDUNG kd on kd.PHAMVI_ID = tk.PHAMVI_ID and kd.BENHVIEN_ID = 'HLU01'        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = tk.NGUONDUOC_ID and nh.BENHVIEN_ID = 'HLU01'        where d.BENHVIEN_ID = 'HLU01' and tk.PHAMVI_ID =  @param0         end]
2020-01-02 17:40:42,879 [1] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoVaBookingCOM23UpdateRedis_TheoPhamvi] Parameters: [@param0=[PHAMVI_ID,1028]]
2020-01-02 17:40:42,879 [1] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoVaBookingCOM23UpdateRedis_TheoPhamvi] Types: [@param0=[Int64, System.Int64]]
2020-01-02 17:40:43,155 [1] DEBUG - Statement Id: [DAO00068_GetLastedSinhHieuInfo] PreparedStatement : [select top (1) *, CHISOBMI as BMI              from TT_NGOAITRU_KHAMBENH_SINHHIEU              where BENHNHAN_ID = '24442'              order by KHAMBENH_SINHHIEU_ID desc]
2020-01-02 17:41:01,294 [1] DEBUG - Statement Id: [DAO00014_GetPatientStatus] PreparedStatement : [select        CASE        when tn.TRANGTHAI = 'HOANTHANH' Then tn.TRANGTHAI        WHEN xncp.XACNHANCHIPHI_ID is not null THEN 'XACNHANCHIPHI'        WHEN (tn.KHOADULIEU = '1') THEN 'KHOADULIEU'        ELSE tn.TRANGTHAI        END        as TRANGTHAI        from TT_TIEPNHAN tn        left join TT_XACNHANCHIPHI xncp on tn.TIEPNHAN_ID = xncp.TIEPNHAN_ID        where tn.TIEPNHAN_ID = '28494'        and tn.BENHVIEN_ID = 'HLU01']
2020-01-02 17:41:01,378 [1] DEBUG - Statement Id: [DAO00014_GetTTDVYeucauOPD] PreparedStatement : [select A.KHAMBENH_NGOAITRU_ID, B.KHAMBENH_ID        from TT_DVYEUCAU A        left join TT_NGOAITRU_KHAMBENH B on A.KHAMBENH_NGOAITRU_ID = B.KHAMBENH_ID        where A.DVYEUCAU_ID = '206520' and A.TIEPNHAN_ID =  @param0]
2020-01-02 17:41:01,378 [1] DEBUG - Statement Id: [DAO00014_GetTTDVYeucauOPD] Parameters: [@param0=[TIEPNHAN_ID,28494]]
2020-01-02 17:41:01,378 [1] DEBUG - Statement Id: [DAO00014_GetTTDVYeucauOPD] Types: [@param0=[Int64, System.Int64]]
2020-01-02 17:41:01,462 [1] DEBUG - Statement Id: [DAO00014_GetThongtinKhamsuckhoeTheoDVyc] PreparedStatement : [select HOPDONG_ID, HOPDONG_BENHNHAN_ID from TT_DVYEUCAU where DVYEUCAU_ID =  @param0]
2020-01-02 17:41:01,462 [1] DEBUG - Statement Id: [DAO00014_GetThongtinKhamsuckhoeTheoDVyc] Parameters: [@param0=[DVYEUCAU_ID,206520]]
2020-01-02 17:41:01,462 [1] DEBUG - Statement Id: [DAO00014_GetThongtinKhamsuckhoeTheoDVyc] Types: [@param0=[Int64, System.Int64]]
2020-01-02 17:41:01,487 [1] DEBUG - Statement Id: [DAO00009_TT_TIEPNHAN_GetProcess] PreparedStatement : [select PROCESS_ID from TT_TIEPNHAN where SOTIEPNHAN = 'TN200102.0000002']
2020-01-02 17:41:01,525 [1] DEBUG - Statement Id: [DAOWF004_laytrangthaiDV] PreparedStatement : [select top 1 A.CURR_STATE_CODE as STATE_CODE, isNull(C.SHORT_NAME,C.NAME) as TRANGTHAI, C.NAME as TRANGTHAI_CHITIET, C.STATUS_CODE, D.ISACTIVE as ACTIVE, E.STATUS_CODE  as OLD_STATUSCODE        from TT_REQUEST_SERVICE_DETAIL A                left join (select * from TT_REQUEST_SERVICE where PARA = '{"DICHVU_ID":"5492","DVYEUCAU_ID":"206520"}') D on D.ID = A.REQUEST_SERVICE_ID        left join TM_STATE C on A.CURR_STATE_CODE = C.STATE_CODE and C.PROCESS_CODE = D.PROCESS_CODE        left join TM_STATE E on A.OLD_STATE_CODE = E.STATE_CODE and E.PROCESS_CODE = D.PROCESS_CODE        where        A.REQUEST_SERVICE_ID = (select top 1 ID from TT_REQUEST_SERVICE where PARA = '{"DICHVU_ID":"5492","DVYEUCAU_ID":"206520"}' order by ID desc)        order by A.ID desc]
2020-01-02 17:41:01,587 [1] DEBUG - Statement Id: [DAO00014_CheckExistNhapVien] PreparedStatement : [select NHAPVIEN_ID        from TT_NOITRU_NHAPVIEN        where TIEPNHAN_ID  = '28494'        and TRANGTHAI != 'CHOXACNHAN']
2020-01-02 17:41:01,618 [1] DEBUG - Statement Id: [DAO00014_CheckExistCapCuu] PreparedStatement : [select THONGTINCAPCUU_ID        from TT_TIEPNHAN_THONGTINCAPCUU        where TIEPNHAN_ID  = '28494' and BENHVIEN_ID = 'HLU01']
2020-01-02 17:41:01,643 [1] DEBUG - Statement Id: [DAO00014_CheckExistChuyenVien] PreparedStatement : [select CHUYENVIEN_ID        from TT_CHUYENVIEN        where TIEPNHAN_ID  = '28494']
2020-01-02 17:41:01,674 [1] DEBUG - Statement Id: [DAO00014_GetTrangThaiTiepNhan] PreparedStatement : [select tn.TIEPNHAN_ID, tn.KHOADULIEU, xncp.XACNHANCHIPHI_ID from TT_TIEPNHAN tn        left join TT_XACNHANCHIPHI xncp        on tn.TIEPNHAN_ID = xncp.TIEPNHAN_ID        where tn.TIEPNHAN_ID = '28494'        and tn.BENHVIEN_ID = 'HLU01']
2020-01-02 17:41:01,705 [1] DEBUG - Statement Id: [DAO00014_CheckExistsToaThuoc_ByTiepNhan_ID] PreparedStatement : [select count(KHAMBENH_TOATHUOC_ID)        from TT_NGOAITRU_KHAMBENH_TOATHUOC        where        TIEPNHAN_ID = '28494' and LOAITOATHUOC = 'BV']
2020-01-02 17:41:01,737 [1] DEBUG - Statement Id: [DAO00014_CheckBenhNhanChuaXSDVTYT] PreparedStatement : [IF EXISTS (        select vt.KHAMBENH_VTYT_ID        from TT_NGOAITRU_KHAMBENH_VTYT vt        inner join TT_NGOAITRU_KHAMBENH kb on kb.KHAMBENH_ID = vt.KHAMBENH_ID        where kb.TIEPNHAN_ID = 28494        and kb.BENHVIEN_ID = 'HLU01'        and vt.CHUNGTU_ID is null          union all          select vt.CLSKETQUA_VTYT_ID        from TT_CLSKETQUA_VTYT vt        inner join TT_DVYEUCAU yc on yc.DVYEUCAU_ID = vt.DVYEUCAU_ID and yc.BENHVIEN_ID = vt.BENHVIEN_ID        where yc.TIEPNHAN_ID = 28494        and yc.BENHVIEN_ID = 'HLU01'        and vt.CHUNGTU_ID is null        )        BEGIN        SELECT -1 AS RESULT        END        ELSE        BEGIN        SELECT 1 AS RESULT        END]
2020-01-02 17:41:01,791 [1] DEBUG - Statement Id: [DAOLOG01_LockBegin] PreparedStatement : [INSERT into TT_LOG_UPDATE ( REF_TABLE , REF_ID , BENHVIEN_ID )         values ( @param0 ,  @param1 ,  @param2 );]
2020-01-02 17:41:01,791 [1] DEBUG - Statement Id: [DAOLOG01_LockBegin] Parameters: [@param0=[REF_TABLE,TT_NGOAITRU_KHAMBENH], @param1=[REF_ID,28494], @param2=[BENHVIEN_ID,HLU01]]
2020-01-02 17:41:01,791 [1] DEBUG - Statement Id: [DAOLOG01_LockBegin] Types: [@param0=[String, System.String], @param1=[Int64, System.Int64], @param2=[String, System.String]]
2020-01-02 17:41:01,824 [1] DEBUG - Statement Id: [DAO00014_GetTTNhapVien] PreparedStatement : [select *        from TT_NOITRU_NHAPVIEN        where TIEPNHAN_ID  = '28494']
2020-01-02 17:41:01,876 [1] DEBUG - Statement Id: [DAO00014_GetTTDVYeucauOPD] PreparedStatement : [select A.KHAMBENH_NGOAITRU_ID, B.KHAMBENH_ID        from TT_DVYEUCAU A        left join TT_NGOAITRU_KHAMBENH B on A.KHAMBENH_NGOAITRU_ID = B.KHAMBENH_ID        where A.DVYEUCAU_ID = '206520' and A.TIEPNHAN_ID =  @param0]
2020-01-02 17:41:01,876 [1] DEBUG - Statement Id: [DAO00014_GetTTDVYeucauOPD] Parameters: [@param0=[TIEPNHAN_ID,28494]]
2020-01-02 17:41:01,876 [1] DEBUG - Statement Id: [DAO00014_GetTTDVYeucauOPD] Types: [@param0=[String, System.String]]
2020-01-02 17:41:01,909 [1] DEBUG - Statement Id: [DAO00014_Add] PreparedStatement : [insert into TT_NGOAITRU_KHAMBENH (        BENHNHAN_ID        , TIEPNHAN_ID        , BENHAN_ID        , DICHVU_ID        , PHONGBAN_ID        , NGAYKHAM        , THOIGIANKHAM        , BACSIKHAM_ID        , DIEUDUONG_ID        , DOITUONG_ID        , CHANDOANICD_ID        , CHANDOANPHUICD_ID        , CHANDOANICD        , BENHMANTINH_ID        , HUONGGIAIQUYET_ID        , YEUCAUCHITIET_ID        , CHANDOANKHOAKHAM        , TLDG_MT        , TLDG_MP        , TKLT_MP        , TKLT_MT        , TLDG_MT_TEXT        , TLDG_MP_TEXT        , TKLT_MP_TEXT        , TKLT_MT_TEXT        , NHANAP_MT        , NHANAP_MP        , MACH        , CANNANG        , CHIEUCAO        , HUYETAPTHAP        , HUYETAPCAO        , NHIPTHO        , NHIETDO        , BMI        , TYLEMO        , VONGBUNG        , SIEUHIENVI        , SOIDAYMAT        , TRIEUCHUNGLAMSANG        , CHANDOANSOBOICD_ID        , CHANDOANSOBO        , CHUYENDENBENHVIEN_ID        , LYDONHAPVIEN_ID        , THOIGIANNHAPVIENDUKIEN        , KHAMBENHLANDAU_ID        , KHAMBENH_CHUYENKHOA_ID        , NHAPKHOA_ID        , CHUYENKHOA_ID        , NGHIOM_TUNGAY        , NGHIOM_DENNGAY        , HUONGDIEUTRI_ID        , CHEDOANUONG_ID        , CHEDOCHAMSOC_ID        , DIEUTRIDUPHONG        , SONGAYDIEUTRI        , GIAIDOANBENH        , TOATHUOCMUANGOAI        , TACDUNGPHU        , TUANTHUCUABN        , SONGAYHENTAIKHAM        , SOBENHANNGOAITRU_ID        , KHAMCAPCUU        , GHICHU        , KHOADULIEU        , NGUOIKHOA_ID        , NGAYKHOA        , THOIGIANKHOA        , BENHVIEN_ID        , NGAYTAO        , NGUOITAO_ID        , NGAYCAPNHAT        , NGUOICAPNHAT_ID        , KHAMBENH_SINHHIEU_ID        ) values (         @param0         ,  @param1         ,  @param2         ,  @param3         ,  @param4         ,  @param5         ,  @param6         ,  @param7         ,  @param8         ,  @param9         ,  @param10         ,  @param11         ,  @param12         ,  @param13         ,  @param14         ,  @param15         ,  @param16         ,  @param17         ,  @param18         ,  @param19         ,  @param20         ,  @param21         ,  @param22         ,  @param23         ,  @param24         ,  @param25         ,  @param26         ,  @param27         ,  @param28         ,  @param29         ,  @param30         ,  @param31         ,  @param32         ,  @param33         ,  @param34         ,  @param35         ,  @param36         ,  @param37         ,  @param38         ,  @param39         ,  @param40         ,  @param41         ,  @param42         ,  @param43         ,  @param44         ,  @param45         ,  @param46         ,  @param47         ,  @param48         ,  @param49         ,  @param50         ,  @param51         ,  @param52         ,  @param53         ,  @param54         ,  @param55         ,  @param56         ,  @param57         ,  @param58         ,  @param59         ,  @param60         ,  @param61         ,  @param62         ,  @param63         ,  @param64         ,  @param65         ,  @param66         ,  @param67         ,  @param68         ,  @param69         ,  @param70         ,  @param71         ,  @param72         ,  @param73         )        SELECT SCOPE_IDENTITY()]
2020-01-02 17:41:01,909 [1] DEBUG - Statement Id: [DAO00014_Add] Parameters: [@param0=[BENHNHAN_ID,24442], @param1=[TIEPNHAN_ID,28494], @param2=[BENHAN_ID,null], @param3=[DICHVU_ID,5492], @param4=[PHONGBAN_ID,62], @param5=[NGAYKHAM,1/2/2020 12:00:00 AM], @param6=[THOIGIANKHAM,1/2/2020 5:40:42 PM], @param7=[BACSIKHAM_ID,1], @param8=[DIEUDUONG_ID,null], @param9=[DOITUONG_ID,4], @param10=[CHANDOANICD_ID,3990], @param11=[CHANDOANPHUICD_ID,null], @param12=[CHANDOANICD,null], @param13=[BENHMANTINH_ID,null], @param14=[HUONGGIAIQUYET_ID,458], @param15=[YEUCAUCHITIET_ID,null], @param16=[CHANDOANKHOAKHAM,Viêm phế quản cấp(J20)], @param17=[TLDG_MT,null], @param18=[TLDG_MP,null], @param19=[TKLT_MP,null], @param20=[TKLT_MT,null], @param21=[TLDG_MT_TEXT,], @param22=[TLDG_MP_TEXT,], @param23=[TKLT_MP_TEXT,], @param24=[TKLT_MT_TEXT,], @param25=[NHANAP_MT,null], @param26=[NHANAP_MP,null], @param27=[MACH,null], @param28=[CANNANG,null], @param29=[CHIEUCAO,null], @param30=[HUYETAPTHAP,null], @param31=[HUYETAPCAO,null], @param32=[NHIPTHO,null], @param33=[NHIETDO,null], @param34=[BMI,null], @param35=[TYLEMO,null], @param36=[VONGBUNG,null], @param37=[SIEUHIENVI,], @param38=[SOIDAYMAT,], @param39=[TRIEUCHUNGLAMSANG,test 2], @param40=[CHANDOANSOBOICD_ID,null], @param41=[CHANDOANSOBO,], @param42=[CHUYENDENBENHVIEN_ID,7179], @param43=[LYDONHAPVIEN_ID,null], @param44=[THOIGIANNHAPVIENDUKIEN,null], @param45=[KHAMBENHLANDAU_ID,null], @param46=[KHAMBENH_CHUYENKHOA_ID,null], @param47=[NHAPKHOA_ID,null], @param48=[CHUYENKHOA_ID,null], @param49=[NGHIOM_TUNGAY,null], @param50=[NGHIOM_DENNGAY,null], @param51=[HUONGDIEUTRI_ID,null], @param52=[CHEDOANUONG_ID,null], @param53=[CHEDOCHAMSOC_ID,null], @param54=[DIEUTRIDUPHONG,null], @param55=[SONGAYDIEUTRI,null], @param56=[GIAIDOANBENH,null], @param57=[TOATHUOCMUANGOAI,null], @param58=[TACDUNGPHU,null], @param59=[TUANTHUCUABN,null], @param60=[SONGAYHENTAIKHAM,null], @param61=[SOBENHANNGOAITRU_ID,null], @param62=[KHAMCAPCUU,null], @param63=[GHICHU,], @param64=[KHOADULIEU,0], @param65=[NGUOIKHOA_ID,null], @param66=[NGAYKHOA,null], @param67=[THOIGIANKHOA,null], @param68=[BENHVIEN_ID,HLU01], @param69=[NGAYTAO,1/2/2020 5:41:01 PM], @param70=[NGUOITAO_ID,1], @param71=[NGAYCAPNHAT,1/2/2020 5:41:01 PM], @param72=[NGUOICAPNHAT_ID,1], @param73=[KHAMBENH_SINHHIEU_ID,0]]
2020-01-02 17:41:01,909 [1] DEBUG - Statement Id: [DAO00014_Add] Types: [@param0=[Int64, System.Int64], @param1=[String, System.String], @param2=[System.DBNull, null], @param3=[Int64, System.Int64], @param4=[String, System.String], @param5=[DateTime, System.DateTime], @param6=[DateTime, System.DateTime], @param7=[Int64, System.Int64], @param8=[System.DBNull, null], @param9=[Int64, System.Int64], @param10=[String, System.String], @param11=[System.DBNull, null], @param12=[System.DBNull, null], @param13=[System.DBNull, null], @param14=[String, System.String], @param15=[System.DBNull, null], @param16=[String, System.String], @param17=[System.DBNull, null], @param18=[System.DBNull, null], @param19=[System.DBNull, null], @param20=[System.DBNull, null], @param21=[String, System.String], @param22=[String, System.String], @param23=[String, System.String], @param24=[String, System.String], @param25=[System.DBNull, null], @param26=[System.DBNull, null], @param27=[System.DBNull, null], @param28=[System.DBNull, null], @param29=[System.DBNull, null], @param30=[System.DBNull, null], @param31=[System.DBNull, null], @param32=[System.DBNull, null], @param33=[System.DBNull, null], @param34=[System.DBNull, null], @param35=[System.DBNull, null], @param36=[System.DBNull, null], @param37=[String, System.String], @param38=[String, System.String], @param39=[String, System.String], @param40=[System.DBNull, null], @param41=[String, System.String], @param42=[Int64, System.Int64], @param43=[System.DBNull, null], @param44=[System.DBNull, null], @param45=[System.DBNull, null], @param46=[System.DBNull, null], @param47=[System.DBNull, null], @param48=[System.DBNull, null], @param49=[System.DBNull, null], @param50=[System.DBNull, null], @param51=[System.DBNull, null], @param52=[System.DBNull, null], @param53=[System.DBNull, null], @param54=[System.DBNull, null], @param55=[System.DBNull, null], @param56=[System.DBNull, null], @param57=[System.DBNull, null], @param58=[System.DBNull, null], @param59=[System.DBNull, null], @param60=[System.DBNull, null], @param61=[System.DBNull, null], @param62=[System.DBNull, null], @param63=[String, System.String], @param64=[String, System.String], @param65=[System.DBNull, null], @param66=[System.DBNull, null], @param67=[System.DBNull, null], @param68=[String, System.String], @param69=[DateTime, System.DateTime], @param70=[String, System.String], @param71=[DateTime, System.DateTime], @param72=[String, System.String], @param73=[Int64, System.Int64]]
2020-01-02 17:41:01,948 [1] DEBUG - Statement Id: [DAO00014_CheckExistHenTaiKHam] PreparedStatement : [select KHAMBENH_HENTAIKHAM        from TT_NGOAITRU_KHAMBENH_HENTK        where KHAMBENH_ID  = '27177']
2020-01-02 17:41:01,973 [1] DEBUG - Statement Id: [DAO00020_UpdateKhamBenhIDInDVYC] PreparedStatement : [update TT_DVYEUCAU        set KHAMBENH_NGOAITRU_ID =  @param0                 , TRANGTHAI =  @param1         , NGUOICAPNHAT_ID =  @param2         , NGAYCAPNHAT =  @param3         where TIEPNHAN_ID = 28494        and DVYEUCAU_ID = 206520                update TT_VIENPHI        set DATHUCHIEN =  @param4         , NGUOICAPNHAT_ID =  @param2         , NGAYCAPNHAT =  @param3         where REF_ID = 206520        and REF_TABLE = 'TT_DVYEUCAU']
2020-01-02 17:41:01,973 [1] DEBUG - Statement Id: [DAO00020_UpdateKhamBenhIDInDVYC] Parameters: [@param0=[KHAMBENH_ID,27177], @param1=[TRANGTHAI,DACHUYENTUYEN], @param2=[NGUOICAPNHAT_ID,1], @param3=[NGAYCAPNHAT,1/2/2020 5:41:01 PM], @param4=[DATHUCHIEN,1]]
2020-01-02 17:41:01,973 [1] DEBUG - Statement Id: [DAO00020_UpdateKhamBenhIDInDVYC] Types: [@param0=[Int64, System.Int64], @param1=[String, System.String], @param2=[Int64, System.Int64], @param3=[DateTime, System.DateTime], @param4=[Int32, System.Int32]]
2020-01-02 17:41:02,014 [1] DEBUG - Statement Id: [DAO00023_GetSOBHYT_HUONG_ID] PreparedStatement : [select isnull(MAX(SOBHYT_HUONG_ID),0) SOBHYT_HUONG_ID        from TT_TIEPNHAN_SOTHEBHYT        where TIEPNHAN_ID = '28494']
2020-01-02 17:41:02,040 [1] DEBUG - Statement Id: [DAO00062_GetAllPhamviKhoDuoc] PreparedStatement : [select distinct dmap.*        from TM_DUOC_PHAMVISD_MAPPING dmap        left join TM_DUOC_PHAMVISUDUNG dpv on dpv.PHAMVI_ID = dmap.PHAMVI_ID]
2020-01-02 17:41:02,066 [1] DEBUG - Statement Id: [DAO00062_GetKhoDuocNhaThuoc] PreparedStatement : [select * from TM_KHODUOC where MAKHO = 'KHO_NT']
2020-01-02 17:41:02,092 [1] DEBUG - Statement Id: [DAO00049_KiemtraloaiDV] PreparedStatement : [select DICHVU_ID AS HA, '' AS XN, '' as TDCN, '' as TT, '' as KB from TM_DICHVU            left join TM_NHOMDICHVU ndv on ndv.NHOMDICHVU_ID = TM_DICHVU.NHOMDICHVU_ID            where DICHVU_ID = '5492' and left(ndv.MANHOMDICHVU, 2) = '02'            union            select  '' as HA, DICHVU_ID AS XN, '' as TDCN, '' as TT, '' as KB from TM_DICHVU            left join TM_NHOMDICHVU ndv on ndv.NHOMDICHVU_ID = TM_DICHVU.NHOMDICHVU_ID            where DICHVU_ID = '5492' and left(ndv.MANHOMDICHVU, 2) = '01'            union            select  '' as HA, '' AS XN, DICHVU_ID as TDCN, '' as TT, '' as KB from TM_DICHVU            left join TM_NHOMDICHVU ndv on ndv.NHOMDICHVU_ID = TM_DICHVU.NHOMDICHVU_ID            where DICHVU_ID = '5492' and left(ndv.MANHOMDICHVU, 2) = '03'            union            select  '' as HA, '' AS XN, '' as TDCN, DICHVU_ID as TT, '' as KB from TM_DICHVU            left join TM_NHOMDICHVU ndv on ndv.NHOMDICHVU_ID = TM_DICHVU.NHOMDICHVU_ID            where DICHVU_ID = '5492' and left(ndv.MANHOMDICHVU, 2) = '05'            union            select  '' as HA, '' AS XN, '' as TDCN, DICHVU_ID as TT, '' as KB from TM_DICHVU            left join TM_NHOMDICHVU ndv on ndv.NHOMDICHVU_ID = TM_DICHVU.NHOMDICHVU_ID            where DICHVU_ID = '5492' and left(ndv.MANHOMDICHVU, 2) = '06'            union            select  '' as HA, '' AS XN, '' as TDCN, '' as TT, DICHVU_ID as KB from TM_DICHVU            left join TM_NHOMDICHVU ndv on ndv.NHOMDICHVU_ID = TM_DICHVU.NHOMDICHVU_ID            where DICHVU_ID = '5492' and left(ndv.MANHOMDICHVU, 2) = '04']
2020-01-02 17:41:02,119 [1] DEBUG - Statement Id: [DAO00009_GetThutiensauDVThuthuat] PreparedStatement : [select A.THUTIENSAU, B.SOTIEPNHAN, A.DICHVU_ID, A.DVYEUCAU_ID        from TT_DVYEUCAU A        inner join TT_TIEPNHAN B on B.TIEPNHAN_ID = A.TIEPNHAN_ID        where        A.DVYEUCAU_ID = '206520']
2020-01-02 17:41:02,152 [1] DEBUG - Statement Id: [DAO00009_TT_TIEPNHAN_GetProcess] PreparedStatement : [select PROCESS_ID from TT_TIEPNHAN where SOTIEPNHAN = 'TN200102.0000002']
2020-01-02 17:41:02,191 [1] DEBUG - Statement Id: [DAOWF001_Kiemtrathongtindayeucaudacochua] PreparedStatement : [select * from TT_REQUEST        where        PARA = '{"HOSPITAL_ID":"HLU01","SOTIEPNHAN":"TN200102.0000002"}'        AND ISACTIVE = '1']
2020-01-02 17:41:02,242 [1] DEBUG - Statement Id: [DAOWF001_Kiemtrathongtindichvudayeucau] PreparedStatement : [select top 1 * from TT_REQUEST_SERVICE        where        PARA = '{"DICHVU_ID":"5492","DVYEUCAU_ID":"206520"}'                AND ISACTIVE = '1' order by ID desc]
2020-01-02 17:41:02,270 [1] DEBUG - Statement Id: [DAOWF001_KiemtrathongtinchitietDichvuYeucau] PreparedStatement : [select * from TT_REQUEST_SERVICE_DETAIL        where        REQUEST_SERVICE_ID = '148396']
2020-01-02 17:41:02,328 [1] DEBUG - Statement Id: [DAOWF001_Laythongtinwithstatecode] PreparedStatement : [select A.*, B.STATUS_CODE from        TM_STATE_ACTION A        left join TM_STATE B on B.STATE_CODE = A.NEXT_STATE_CODE and A.PROCESS_CODE = B.PROCESS_CODE        where        A.CURR_STATE_CODE = '0     '        AND A.PROCESS_CODE = 'P02'        Order By ORDER_ID ASC]
2020-01-02 17:41:02,356 [1] DEBUG - Statement Id: [DAOWF003_Update] PreparedStatement : [update TT_REQUEST_SERVICE set        CURR_STATE_CODE =  @param0                   , ISACTIVE =  @param1                     , ISCOMPLETE =  @param2                        where        ID = '148396']
2020-01-02 17:41:02,356 [1] DEBUG - Statement Id: [DAOWF003_Update] Parameters: [@param0=[CURR_STATE_CODE,8], @param1=[ISACTIVE,1], @param2=[ISCOMPLETE,0]]
2020-01-02 17:41:02,356 [1] DEBUG - Statement Id: [DAOWF003_Update] Types: [@param0=[String, System.String], @param1=[String, System.String], @param2=[String, System.String]]
2020-01-02 17:41:02,467 [1] DEBUG - Statement Id: [DAOWF005_Add] PreparedStatement : [insert into TT_REQUEST_SERVICE_DETAIL (        REQUEST_ID        ,REQUEST_SERVICE_ID        , OLD_STATE_CODE        , CURR_STATE_CODE        ) values (         @param0         , @param1         ,  @param2         ,  @param3         )        SELECT SCOPE_IDENTITY()]
2020-01-02 17:41:02,467 [1] DEBUG - Statement Id: [DAOWF005_Add] Parameters: [@param0=[REQUEST_ID,32794], @param1=[REQUEST_SERVICE_ID,148396], @param2=[OLD_STATE_CODE,0     ], @param3=[CURR_STATE_CODE,8]]
2020-01-02 17:41:02,467 [1] DEBUG - Statement Id: [DAOWF005_Add] Types: [@param0=[String, System.String], @param1=[Int32, System.Int32], @param2=[String, System.String], @param3=[String, System.String]]
2020-01-02 17:41:02,940 [1] DEBUG - Statement Id: [DAOWF005_Add_History] PreparedStatement : [insert into TT_REQUEST_SERVICE_HISTORY (        REQUEST_ID        ,REQUEST_SERVICE_ID        , OLD_STATE_CODE        , CURR_STATE_CODE        ) values (         @param0         , @param1         ,  @param2         ,  @param3         )]
2020-01-02 17:41:02,940 [1] DEBUG - Statement Id: [DAOWF005_Add_History] Parameters: [@param0=[REQUEST_ID,32794], @param1=[REQUEST_SERVICE_ID,148396], @param2=[OLD_STATE_CODE,0     ], @param3=[CURR_STATE_CODE,8]]
2020-01-02 17:41:02,940 [1] DEBUG - Statement Id: [DAOWF005_Add_History] Types: [@param0=[String, System.String], @param1=[Int32, System.Int32], @param2=[String, System.String], @param3=[String, System.String]]
2020-01-02 17:41:02,967 [1] DEBUG - Statement Id: [DAO00009_TT_DVYEUCAU_Update] PreparedStatement : [Update TT_DVYEUCAU set TRANGTHAI_WFL = 'HOANTAT' where DVYEUCAU_ID = '206520']
2020-01-02 17:41:02,991 [1] DEBUG - Statement Id: [DAO00026_GetListDanhSachDichVuGhiNhanVTYT_COM25_WithTN] PreparedStatement : [select distinct CONVERT(VARCHAR(11),C.NGAYYEUCAU,103) as NGAYYEUCAU, C.DICHVU_ID, C.DVYEUCAU_ID, D.TENDICHVU, C.NOITHUCHIEN_ID, A.SOTIEPNHAN, A.TRAITUYEN, A.NGAYMIENDONGCHITRA, A.TIEPNHAN_ID, A.DOITUONG_ID, A.TRANGTHAI,            A.LOAITHANHVIEN_ID, A.SUDUNG_BHTN, A.THE_ID, A.THANHVIEN_ID, A.VIP, A.NGUON_BENHNHAN_ID, A.BAOLANH_VIENPHI,            CASE WHEN (A.TRANGTHAI = 'NOITRU' OR A.TRANGTHAI = 'CAPCUU') THEN 'IN' ELSE 'OUT' END AS LOAIBENHAN,            CASE WHEN (C.TRANGTHAI = 'CHUAKETQUA') THEN 'CHUAKETQUA' ELSE 'HOANTAT' END AS TRANGTHAIDICHVU,            B.*, isnull(ntba.SOBENHAN, '') SOBENHAN, isnull(ntba.BENHAN_ID, 0) BENHAN_ID,            CASE WHEN Left(E.MANHOMDICHVU,2) = '03' THEN '02' ELSE Left(E.MANHOMDICHVU,2) END AS MANHOMDICHVU            from TT_TIEPNHAN A            inner join TT_BENHNHAN B on B.BENHNHAN_ID = A.BENHNHAN_ID and B.ACTIVE = '1'            inner join TT_DVYEUCAU C on C.TIEPNHAN_ID = A.TIEPNHAN_ID                        left join TM_DICHVU D on D.DICHVU_ID = C.DICHVU_ID            left join TM_NHOMDICHVU E on E.NHOMDICHVU_ID = D.NHOMDICHVU_ID            left join TT_NOITRU_BENHAN ntba on ntba.BENHAN_ID = C.BENHAN_ID              where            C.NGAYHENCLS is NULL and A.BENHVIEN_ID = 'HLU01'            and (A.TRANGTHAI = 'DATIEPNHAN' or A.TRANGTHAI = 'NOITRU' or A.TRANGTHAI = 'CAPCUU' or A.TRANGTHAI = 'NGOAITRU')            and (CASE WHEN Left(E.MANHOMDICHVU,2) = '03' THEN '02' ELSE Left(E.MANHOMDICHVU,2) END in ('02', '04'))            and A.TIEPNHAN_ID = '28494']
2020-01-02 17:41:03,057 [1] DEBUG - Statement Id: [DAOLOG01_LockEnd] PreparedStatement : [DELETE TT_LOG_UPDATE        where REF_TABLE = 'TT_NGOAITRU_KHAMBENH' and REF_ID = '28494' and BENHVIEN_ID = 'HLU01']
2020-01-02 17:41:03,082 [1] DEBUG - Statement Id: [DAO00014_Clear_1ToaThuocKhambenh] PreparedStatement : [DELETE FROM TT_DUOC_TONKHO_BOOK_NGOAITRU where REF_TABLE = 'TT_NGOAITRU_TOATHUOC'        and REF_ID in (        select TOATHUOC_ID from TT_NGOAITRU_TOATHUOC        where             KHAMBENH_TOATHUOC_ID in (select KHAMBENH_TOATHUOC_ID from TT_NGOAITRU_KHAMBENH_TOATHUOC        where TIEPNHAN_ID = '28494' and                   KHAMBENH_ID not in (select KHAMBENH_ID from TT_NGOAITRU_KHAMBENH where  TIEPNHAN_ID = '28494'))        and TIEPNHAN_ID = '28494')          DELETE FROM TT_VIENPHI where REF_TABLE = 'TT_NGOAITRU_TOATHUOC'        and REF_ID in (        select TOATHUOC_ID from TT_NGOAITRU_TOATHUOC        where KHAMBENH_TOATHUOC_ID in (select KHAMBENH_TOATHUOC_ID from TT_NGOAITRU_KHAMBENH_TOATHUOC        where TIEPNHAN_ID = '28494' and KHAMBENH_ID not in (select KHAMBENH_ID from TT_NGOAITRU_KHAMBENH where TIEPNHAN_ID = '28494'))        and TIEPNHAN_ID = '28494')          delete from TT_NGOAITRU_TOATHUOC        where KHAMBENH_TOATHUOC_ID in (select KHAMBENH_TOATHUOC_ID from TT_NGOAITRU_KHAMBENH_TOATHUOC        where TIEPNHAN_ID = '28494' and KHAMBENH_ID not in (select KHAMBENH_ID from TT_NGOAITRU_KHAMBENH where TIEPNHAN_ID = '28494')        and TIEPNHAN_ID = '28494')          delete from TT_NGOAITRU_KHAMBENH_TOATHUOC where TIEPNHAN_ID = '28494'        and KHAMBENH_ID not in (select KHAMBENH_ID from TT_NGOAITRU_KHAMBENH where TIEPNHAN_ID = '28494') and TIEPNHAN_ID = '28494']
2020-01-02 17:41:03,298 [1] DEBUG - Statement Id: [DAO00014_GetKhamBenhInfo] PreparedStatement : [select * from TT_NGOAITRU_KHAMBENH where KHAMBENH_ID =        (select KHAMBENH_NGOAITRU_ID from TT_DVYEUCAU where DVYEUCAU_ID = '206520')]
2020-01-02 17:41:03,334 [1] DEBUG - Statement Id: [DAO00068_GetSinhHieuBySinhHieuID] PreparedStatement : [select top (1) *            from TT_NGOAITRU_KHAMBENH_SINHHIEU            where KHAMBENH_SINHHIEU_ID = '0'            and BENHVIEN_ID = 'HLU01'             and               BENHNHAN_ID = '24442'                           order by KHAMBENH_SINHHIEU_ID]
2020-01-02 17:41:03,368 [1] DEBUG - Statement Id: [DAO00014_GetKhamBenhICDInfo] PreparedStatement : [select *        from TT_NGOAITRU_KHAMBENH_ICD        where KHAMBENH_ID  = '27177']
2020-01-02 17:41:03,400 [1] DEBUG - Statement Id: [DAO00014_GetListToaThuoc] PreparedStatement : [select A.*        from TT_NGOAITRU_KHAMBENH_TOATHUOC A        where A.KHAMBENH_ID = '27177']
2020-01-02 17:41:03,440 [1] DEBUG - Statement Id: [DAO00014_KiemTraDVYCCoGiaBHYT] PreparedStatement : [select *        from TT_VIENPHI        where REF_ID  = '206520' and REF_TABLE = 'TT_DVYEUCAU' and BHYT_DONGIA > 0]
2020-01-02 17:41:03,479 [1] DEBUG - Statement Id: [DAO00040_LayListToaMau] PreparedStatement : [select A.*, dc.TENDUOCDAYDU, dc.BHYT DUOC_BHYT, ld.LOAIVATTU_ID, ld.MALOAIDUOC, dd.DICTIONARY_NAME DUONGDUNG, dc.TAMNGUNG            from TT_TOATHUOCMAU A            left join TM_DUOC dc on A.DUOC_ID = dc.DUOC_ID            left join TM_LOAIDUOC ld on dc.LOAIDUOC_ID = ld.LOAIDUOC_ID            left join (select * from LST_DICTIONARY where DICTIONARY_TYPE_CODE like 'DuongDung') dd on dd.DICTIONARY_ID = dc.DUONGDUNG_ID            where (1=1)             and               A.BACSI_ID  = 1              and A.LOAITOATHUOC in  (                        @param0                   ,                           @param1                   ,                           @param2                   ,                           @param3                   )]
2020-01-02 17:41:03,479 [1] DEBUG - Statement Id: [DAO00040_LayListToaMau] Parameters: [@param0=[LSTLOAITOATHUOC[0],BV], @param1=[LSTLOAITOATHUOC[1],MN], @param2=[LSTLOAITOATHUOC[2],MP], @param3=[LSTLOAITOATHUOC[3],TV]]
2020-01-02 17:41:03,479 [1] DEBUG - Statement Id: [DAO00040_LayListToaMau] Types: [@param0=[String, System.String], @param1=[String, System.String], @param2=[String, System.String], @param3=[String, System.String]]
2020-01-02 17:41:03,616 [1] DEBUG - Statement Id: [DAO00040_LayListToaMau] PreparedStatement : [select A.*, dc.TENDUOCDAYDU, dc.BHYT DUOC_BHYT, ld.LOAIVATTU_ID, ld.MALOAIDUOC, dd.DICTIONARY_NAME DUONGDUNG, dc.TAMNGUNG            from TT_TOATHUOCMAU A            left join TM_DUOC dc on A.DUOC_ID = dc.DUOC_ID            left join TM_LOAIDUOC ld on dc.LOAIDUOC_ID = ld.LOAIDUOC_ID            left join (select * from LST_DICTIONARY where DICTIONARY_TYPE_CODE like 'DuongDung') dd on dd.DICTIONARY_ID = dc.DUONGDUNG_ID            where (1=1)             and               A.BACSI_ID  = 1              and A.LOAITOATHUOC in  (                        @param0                   ,                           @param1                   ,                           @param2                   ,                           @param3                   )]
2020-01-02 17:41:03,616 [1] DEBUG - Statement Id: [DAO00040_LayListToaMau] Parameters: [@param0=[LSTLOAITOATHUOC[0],BV], @param1=[LSTLOAITOATHUOC[1],MN], @param2=[LSTLOAITOATHUOC[2],MP], @param3=[LSTLOAITOATHUOC[3],TV]]
2020-01-02 17:41:03,616 [1] DEBUG - Statement Id: [DAO00040_LayListToaMau] Types: [@param0=[String, System.String], @param1=[String, System.String], @param2=[String, System.String], @param3=[String, System.String]]
2020-01-02 17:41:03,671 [1] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoVaBookingCOM23UpdateRedis_TheoPhamvi] PreparedStatement : [declare @TOAMUANGOAI int = 0;        select @TOAMUANGOAI = isnull(VALUE,0) from TM_SYS_APPSETTINGS where CODE = 'OPD_TOAMUANGOAI_DUNGDANHMUC_DUOC'                if @TOAMUANGOAI = 1        begin        select  distinct '0' + '_' + LTRIM(d.DUOC_ID) + '_' + '0' as DUOC_KEY, 999999999 as SOLUONG        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        where  @param0  = 0        union all        select distinct tk.DUOC_KEY, tk.SOLUONG        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        inner join        (        select  LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')) DUOC_KEY, (SUM(dtk.SOLUONG) - isnull(sum(A.SOLUONG),0) - isnull(sum(B.SOLUONG),0)) SOLUONG, pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        from (select sum(soluong) soluong,duoc_id,nguonduoc_id,khoduoc_id,benhvien_id from TT_DUOC_TONKHO  group by duoc_id,nguonduoc_id,khoduoc_id,benhvien_id) dtk        inner join TM_DUOC_PHAMVISD_MAPPING pvsd on dtk.KHODUOC_ID = pvsd.KHODUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NOITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) B on B.DUOC_ID = dtk.DUOC_ID and B.PHAMVI_ID = pvsd.PHAMVI_ID and B.NGUONHANG_ID = dtk.NGUONDUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NGOAITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) A on A.DUOC_ID = dtk.DUOC_ID and A.PHAMVI_ID = pvsd.PHAMVI_ID and A.NGUONHANG_ID = dtk.NGUONDUOC_ID        where dtk.BENHVIEN_ID = 'HLU01'        group by LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')), pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        ) tk on tk.DUOC_ID = d.DUOC_ID        left join TM_DUOC_PHAMVISUDUNG kd on kd.PHAMVI_ID = tk.PHAMVI_ID and kd.BENHVIEN_ID = 'HLU01'        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = tk.NGUONDUOC_ID and nh.BENHVIEN_ID = 'HLU01'        where d.BENHVIEN_ID = 'HLU01' and tk.PHAMVI_ID =  @param0         end        else        begin        select distinct tk.DUOC_KEY, tk.SOLUONG        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        inner join        (        select  LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')) DUOC_KEY, (SUM(dtk.SOLUONG) - isnull(sum(A.SOLUONG),0) - isnull(sum(B.SOLUONG),0)) SOLUONG, pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        from (select sum(soluong) soluong,duoc_id,nguonduoc_id,khoduoc_id,benhvien_id from TT_DUOC_TONKHO  group by duoc_id,nguonduoc_id,khoduoc_id,benhvien_id) dtk        inner join TM_DUOC_PHAMVISD_MAPPING pvsd on dtk.KHODUOC_ID = pvsd.KHODUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NOITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) B on B.DUOC_ID = dtk.DUOC_ID and B.PHAMVI_ID = pvsd.PHAMVI_ID and B.NGUONHANG_ID = dtk.NGUONDUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NGOAITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) A on A.DUOC_ID = dtk.DUOC_ID and A.PHAMVI_ID = pvsd.PHAMVI_ID and A.NGUONHANG_ID = dtk.NGUONDUOC_ID        where dtk.BENHVIEN_ID = 'HLU01'        group by LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')), pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        ) tk on tk.DUOC_ID = d.DUOC_ID        left join TM_DUOC_PHAMVISUDUNG kd on kd.PHAMVI_ID = tk.PHAMVI_ID and kd.BENHVIEN_ID = 'HLU01'        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = tk.NGUONDUOC_ID and nh.BENHVIEN_ID = 'HLU01'        where d.BENHVIEN_ID = 'HLU01' and tk.PHAMVI_ID =  @param0         end]
2020-01-02 17:41:03,671 [1] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoVaBookingCOM23UpdateRedis_TheoPhamvi] Parameters: [@param0=[PHAMVI_ID,1028]]
2020-01-02 17:41:03,671 [1] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoVaBookingCOM23UpdateRedis_TheoPhamvi] Types: [@param0=[Int64, System.Int64]]
2020-01-02 17:41:04,078 [1] DEBUG - Statement Id: [DAO00064_GetlistTT_TIEPNHAN_SOTHEBHYT] PreparedStatement : [select stbhyt.*, ba.SOBENHAN,        tn.SOTIEPNHAN, tn.LOAITHANHVIEN_ID, tn.THE_ID, tn.THANHVIEN_ID,        tn.SUDUNG_BHTN, tn.BAOLANH_VIENPHI, tn.VIP, tn.NGUOINUOCNGOAI        from TT_TIEPNHAN_SOTHEBHYT stbhyt        left join TT_TIEPNHAN tn on tn.TIEPNHAN_ID = stbhyt.TIEPNHAN_ID        left join TT_NOITRU_BENHAN ba on ba.TIEPNHAN_ID = stbhyt.TIEPNHAN_ID        where        stbhyt.TIEPNHAN_ID = '28494' and isnull(stbhyt.KHONGSUDUNG, '0') = '0']
2020-01-02 17:41:04,122 [1] DEBUG - Statement Id: [DAO00064_GetListVienPhiByTiepNnan] PreparedStatement : [select distinct        B.DOITUONG_ID, B.NGAYMIENDONGCHITRA, B.BENHNHAN_ID as TIEPNHAN_BENHNHAN_ID, B.TRAITUYEN,        B.BHYTTREN3NAM as TREN3NAM, B.BHYTTREN5NAM as TREN5NAM, B.SOTIEPNHAN, B.SOBENHAN,        B.LOAITHANHVIEN_ID, B.SUDUNG_BHTN, B.THE_ID, B.THANHVIEN_ID, B.BAOLANH_VIENPHI, B.VIP, B.NGUOINUOCNGOAI,        C.GIATRIMIENGIAM as GIATRIMIENGIAM, D.GIATRIMIENGIAM as GIATRIMIENGIAM_BHTN, E.GIATRIMIENGIAM as GIATRIMIENGIAM_THANHVIEN,        F.GIATRIMIENGIAM as GIATRIMIENGIAM_CONGTY, DVYC.THE_ID as DVDUNGTHE, DVYC.TRANGTHAI as TRANGTHAIDICHVU, ndv.MANHOMDICHVU,        A.* from TT_VIENPHI A        left join        (select B.*, C.SOBENHAN, C.BENHAN_ID        from TT_TIEPNHAN B        left join TT_NOITRU_BENHAN C on B.TIEPNHAN_ID = C.TIEPNHAN_ID                 where B.TIEPNHAN_ID = '28494') B on B.TIEPNHAN_ID = A.TIEPNHAN_ID        left join (select sum(GIATRIMIENGIAM) as GIATRIMIENGIAM, VIENPHI_ID, REF_TABLE        from TT_MIENGIAM_CHITIET        where REF_TABLE = 'TT_MIENGIAM'        and exists (select MIENGIAM_ID from TT_MIENGIAM where TT_MIENGIAM_CHITIET.MIENGIAM_ID = MIENGIAM_ID and TINHTRANG = 1 and TIEPNHAN_ID = '28494')        group by VIENPHI_ID, REF_TABLE) C on C.REF_TABLE = 'TT_MIENGIAM' and C.VIENPHI_ID = A.VIENPHI_ID        left join (select sum(GIATRIMIENGIAM) as GIATRIMIENGIAM, VIENPHI_ID, REF_TABLE        from TT_MIENGIAM_CHITIET        where REF_TABLE = 'TT_MIENGIAM_BHTN'        and exists (select MIENGIAM_BHTN_ID from TT_MIENGIAM_BHTN where TT_MIENGIAM_CHITIET.MIENGIAM_ID = MIENGIAM_BHTN_ID and  TINHTRANG = 1 and TIEPNHAN_ID = '28494')        group by VIENPHI_ID, REF_TABLE) D on D.REF_TABLE = 'TT_MIENGIAM_BHTN' and D.VIENPHI_ID = A.VIENPHI_ID        left join (select sum(GIATRIMIENGIAM) as GIATRIMIENGIAM, VIENPHI_ID, REF_TABLE        from TT_MIENGIAM_CHITIET        where REF_TABLE = 'TT_MIENGIAM_THANHVIEN'        and exists (select MIENGIAM_THANHVIEN_ID from TT_MIENGIAM_THANHVIEN where TT_MIENGIAM_CHITIET.MIENGIAM_ID = MIENGIAM_THANHVIEN_ID and TINHTRANG = 1 and TIEPNHAN_ID = '28494')        group by VIENPHI_ID, REF_TABLE) E on E.REF_TABLE = 'TT_MIENGIAM_THANHVIEN' and E.VIENPHI_ID = A.VIENPHI_ID        left join (select sum(GIATRIMIENGIAM) as GIATRIMIENGIAM, VIENPHI_ID, REF_TABLE        from TT_MIENGIAM_CHITIET        where REF_TABLE = 'TT_MIENGIAM_CONGTY'        and exists (select MIENGIAM_CONGTY_ID from TT_MIENGIAM_CONGTY where TT_MIENGIAM_CHITIET.MIENGIAM_ID = MIENGIAM_CONGTY_ID and TINHTRANG = 1 and TIEPNHAN_ID = '28494')        group by VIENPHI_ID, REF_TABLE) F on F.REF_TABLE = 'TT_MIENGIAM_CONGTY' and F.VIENPHI_ID = A.VIENPHI_ID        left join TT_DVYEUCAU DVYC on DVYC.DVYEUCAU_ID = A.REF_ID and A.REF_TABLE = 'TT_DVYEUCAU'        left join TM_DICHVU DV on DVYC.DICHVU_ID = DV.DICHVU_ID and A.REF_TABLE = 'TT_DVYEUCAU'        left join TM_NHOMDICHVU ndv on ndv.NHOMDICHVU_ID = DV.NHOMDICHVU_ID and A.REF_TABLE = 'TT_DVYEUCAU'        where        A.TIEPNHAN_ID = '28494' and ((DVYC.HUYYEUCAU = '0' and A.DICHVU_ID is not null)        or A.DUOC_ID is not null or A.REF_TABLE = 'TT_NUT_XACNHANSUATAN_CHITIET')        and A.ACTIVE = '1'                 and A.BENHVIEN_ID = 'HLU01'        order by A.VIENPHI_ID]
2020-01-02 17:41:04,328 [1] DEBUG - Statement Id: [DAO00006_GetListDuocTyle] PreparedStatement : [select DUOC_ID, DOITUONG_ID, (TYLE/100) as TYLE, DONGIA MUCTRAN_THANHTOAN from TM_DOITUONG_GIADUOC_TYLE            where            BENHVIEN_ID = 'HLU01'            and DOITUONG_ID = '4']
2020-01-02 17:41:04,354 [1] DEBUG - Statement Id: [DAO00027_GetListTuongTrinhDichVuPhauThuatCuaTiepNhan] PreparedStatement : [declare @ManhomDSA varchar(10);        declare @PhanLoaiNhomDV varchar(20) = '05';        select top 1  @ManhomDSA = VALUE from TM_SYS_APPSETTINGS where CODE = 'MANHOM_DICHVU_DSA'        if (@ManhomDSA is not null) set @PhanLoaiNhomDV += ',' + @ManhomDSA        select distinct ptyc.*        from TT_PHAUTHUAT_YEUCAU ptyc        inner join TM_DICHVU dv on dv.DICHVU_ID = ptyc.DICHVU_ID        inner join TM_NHOMDICHVU ndv on ndv.NHOMDICHVU_ID = dv.NHOMDICHVU_ID        inner join TT_PHAUTHUAT pt on pt.PHAUTHUAT_ID = ptyc.PHAUTHUAT_ID        where        pt.TIEPNHAN_ID = 28494        and (left(ndv.MANHOMDICHVU, 2) in (select * from STRING_SPLIT(@PhanLoaiNhomDV,',')) or ndv.MANHOMDICHVU in (select * from STRING_SPLIT(@PhanLoaiNhomDV,',')))]
2020-01-02 17:41:04,386 [1] DEBUG - Statement Id: [DAO00006_GetList] PreparedStatement : [select dv.*, loaiDV.MALOAIDICHVU, captren.NHOMDICHVU_ID as NHOMDICHVU_CAPTREN_ID, captren.TENNHOMDICHVU as NHOMDICHVU_CAPTREN,              nhom_dv.TENNHOMDICHVU as TENNHOMDICHVU, nhom_dv.MANHOMDICHVU,              case when dv.ATTRIBUTE5 is null then 'TT' else 'KTC' end as LOAI_CHIPHI              from TM_DICHVU as dv              left join TM_NHOMDICHVU as nhom_dv on nhom_dv.NHOMDICHVU_ID = dv.NHOMDICHVU_ID and nhom_dv.BENHVIEN_ID = 'HLU01'              left join TM_NHOMDICHVU as captren on nhom_dv.CAPTREN_ID = captren.NHOMDICHVU_ID and captren.BENHVIEN_ID = 'HLU01'              left join TM_LOAIDICHVU loaiDV on nhom_dv.LOAIDICHVU_ID = loaiDV.LOAIDICHVU_ID and loaiDV.BENHVIEN_ID = 'HLU01'              where nhom_dv.TAMNGUNG = '0' and dv.BENHVIEN_ID = 'HLU01'              and dv.TAMNGUNG = '0'               AND                   loaiDV.MALOAIDICHVU = 'KhamBenh']
2020-01-02 17:41:04,422 [1] DEBUG - Statement Id: [DAO00027_GetDichvuYCBHYTTyle] PreparedStatement : [select DVYEUCAU_ID from TT_DVYEUCAU        where TIEPNHAN_ID = 28494 and isnull(BHYT_TYLETHANHTOAN_ID, 0) > 0]
2020-01-02 17:41:04,447 [1] DEBUG - Statement Id: [DAO00023_UpdateNhieuVP] PreparedStatement : [declare @jsonVienPhi nvarchar(max) = N'[{"VIENPHI_ID":675811,"TIEPNHAN_ID":28494,"DICHVU_ID":5492,"BENHAN_ID":0,"SOLUONG":1.0000,"DONGIA_DOANHTHU":33000.0000,"THANHTIEN_DOANHTHU":33000.00,"BHYT_TL":1.0,"BHYT_DONGIA":33000.0000,"BHYT_THANHTIEN":33000.00,"BHYT_DONGIA_CONGKHAM_DAU":33000.0000,"BHYT_CONGKHAM_DAU_TYLE":1.0,"BHYT_DONGIA_CHITRA":33000.0,"BHYT_THANHTIEN_CHITRA":33000.00,"BENHNHAN_PHAITHANHTOAN":0.00,"GIATRI_HOADON":0.0,"GIATRI_HOADON_DATHANHTOAN":0.0,"GIATRI_BIENLAI":0.0,"GIATRI_BIENLAI_DATHANHTOAN":0.0,"GIATRI_BENHNHAN_DATHANHTOAN":0.0,"DATHUCHIEN":"1","KHONGTHUTIEN":"0","BHYTDONGTIEN":"0","DICHVU_TL":1.0,"BHYT_DONGIA_DONGCT_DAU":0.0,"SOBHYT":"DN466456425324438289","SOBHYT_HUONG_ID":29517,"GIATRIMIENGIAM":0.0,"GIATRIMIENGIAM_BHTN":0.0,"GIATRIMIENGIAM_THANHVIEN":0.0,"GIATRIMIENGIAM_CONGTY":0.0,"BHYT_CK2_KHONGTHANHTOAN":false}]';        begin        UPDATE TT_VIENPHI        SET        SOLUONG = json.SOLUONG,        DONGIA_DOANHTHU = json.DONGIA_DOANHTHU,        THANHTIEN_DOANHTHU = json.THANHTIEN_DOANHTHU,        BHYT_TL = json.BHYT_TL,        BHYT_DONGIA = json.BHYT_DONGIA,        BHYT_THANHTIEN = json.BHYT_THANHTIEN,        BHYT_DONGIA_CONGKHAM_DAU = json.BHYT_DONGIA_CONGKHAM_DAU,        BHYT_CONGKHAM_DAU_TYLE = json.BHYT_CONGKHAM_DAU_TYLE,        BHYT_DONGIA_CHITRA = json.BHYT_DONGIA_CHITRA,        BHYT_THANHTIEN_CHITRA = json.BHYT_THANHTIEN_CHITRA,        BENHNHAN_PHAITHANHTOAN = json.BENHNHAN_PHAITHANHTOAN,        GIATRI_HOADON = json.GIATRI_HOADON,                GIATRI_BIENLAI = json.GIATRI_BIENLAI,                DATHUCHIEN = json.DATHUCHIEN,                DICHVU_TL = json.DICHVU_TL,        BHYT_DONGIA_DONGCT_DAU = json.BHYT_DONGIA_DONGCT_DAU,        NGAYCAPNHAT = GETDATE()        FROM OPENJSON (@jsonVienPhi)        WITH (        VIENPHI_ID int,        SOLUONG numeric(25, 4),        DONGIA_DOANHTHU numeric(25, 4),        THANHTIEN_DOANHTHU numeric(25, 4),        BHYT_TL numeric(25, 4),        BHYT_DONGIA numeric(25, 4),        BHYT_THANHTIEN numeric(25, 4),        BHYT_DONGIA_CONGKHAM_DAU numeric(25, 4),        BHYT_CONGKHAM_DAU_TYLE numeric(25, 4),        BHYT_DONGIA_CHITRA numeric(25, 4),        BHYT_THANHTIEN_CHITRA numeric(25, 4),        BENHNHAN_PHAITHANHTOAN numeric(25, 4),        GIATRI_HOADON numeric(25, 4),                GIATRI_BIENLAI numeric(25, 4),                DATHUCHIEN char(1),        KHONGTHUTIEN char(1),        BHYTDONGTIEN char(1),        DICHVU_TL numeric(25, 4),        BHYT_DONGIA_DONGCT_DAU numeric(25, 4))  json        WHERE TT_VIENPHI.VIENPHI_ID = json.VIENPHI_ID and json.DONGIA_DOANHTHU > 0                  insert into TT_TINH_VIENPHI_LOG        SELECT json.VIENPHI_ID, json.TIEPNHAN_ID, json.BENHAN_ID, json.SOLUONG, json.BHYT_TL, json.DONGIA_DOANHTHU,        json.THANHTIEN_DOANHTHU, json.BHYT_DONGIA, json.BHYT_THANHTIEN, json.BHYT_DONGIA_CHITRA, json.BHYT_THANHTIEN_CHITRA, json.BENHNHAN_PHAITHANHTOAN,        json.SOBHYT_HUONG_ID, json.SOBHYT, GETDATE(), -1, 'HLU01'        FROM OPENJSON(@jsonVienPhi)        WITH (        VIENPHI_ID int,        TIEPNHAN_ID int,        BENHAN_ID int,        SOLUONG numeric(25, 4),        DONGIA_DOANHTHU numeric(25, 4),        THANHTIEN_DOANHTHU numeric(25, 4),        BHYT_TL numeric(25, 4),        BHYT_DONGIA numeric(25, 4),        BHYT_THANHTIEN numeric(25, 4),        BHYT_DONGIA_CHITRA numeric(25, 4),        BHYT_THANHTIEN_CHITRA numeric(25, 4),        BENHNHAN_PHAITHANHTOAN numeric(25, 4),        SOBHYT_HUONG_ID int,        SOBHYT nvarchar(30)) json        end]
2020-01-02 17:41:04,532 [1] DEBUG - Statement Id: [DAO00067_UpdateDataVienPhiDongiaBHYT] PreparedStatement : [update TT_VIENPHI          set BHYT_DONGIA_CHITRA = 0, BHYT_THANHTIEN = 0, BHYT_THANHTIEN_CHITRA = 0          where          TIEPNHAN_ID = 28494 and BHYT_DONGIA = 0          and (BHYT_DONGIA_CHITRA > 0 or BHYT_THANHTIEN > 0 or BHYT_THANHTIEN_CHITRA > 0)]
2020-01-02 17:41:04,587 [1] DEBUG - Statement Id: [DAO00067_CapnhatDataVienphiKhiHuyThanhtoanHoadon] PreparedStatement : [update TT_VIENPHI        set TT_VIENPHI.HOADON_ID = hdct.HOADON_ID, TT_VIENPHI.GIATRI_BENHNHAN_DATHANHTOAN = TT_VIENPHI.GIATRI_BENHNHAN_DATHANHTOAN + hdct.GIATRI_BENHNHAN_DATHANHTOAN        from (select CT.HOADON_ID, CT.VIENPHI_ID, CT.GIATRI_BENHNHAN_DATHANHTOAN        from TT_HOADON_CHITIET_NGOAITRU CT        join TT_HOADON HD on HD.HOADON_ID = CT.HOADON_ID        join TT_VIENPHI vp on vp.VIENPHI_ID = ct.VIENPHI_ID        where HD.DATHANHTOAN = 1 and HD.HUYHOADON = 0 and HD.HOANTRA = 0 and vp.TIEPNHAN_ID =  @param0 ) hdct        where        TT_VIENPHI.VIENPHI_ID = hdct.VIENPHI_ID and TT_VIENPHI.HOADON_ID is null and isnull(TT_VIENPHI.GIATRI_BENHNHAN_DATHANHTOAN,0) = 0        and TT_VIENPHI.TIEPNHAN_ID =  @param0           update TT_VIENPHI        set TT_VIENPHI.HOADON_ID = null, TT_VIENPHI.GIATRI_BENHNHAN_DATHANHTOAN = TT_VIENPHI.GIATRI_BENHNHAN_DATHANHTOAN - hdct.GIATRI_BENHNHAN_DATHANHTOAN,        TT_VIENPHI.DATHANHTOAN = '0'        from (select CT.HOADON_ID, CT.VIENPHI_ID, CT.GIATRI_BENHNHAN_DATHANHTOAN        from TT_HOADON_CHITIET_NGOAITRU CT        join TT_HOADON HD on HD.HOADON_ID = CT.HOADON_ID        join TT_VIENPHI vp on vp.VIENPHI_ID = ct.VIENPHI_ID and vp.HOADON_ID = ct.HOADON_ID        where HD.DATHANHTOAN = 0 and (HD.HUYHOADON = 1 or HD.HOANTRA = 1) and vp.TIEPNHAN_ID =  @param0 ) hdct        where        TT_VIENPHI.VIENPHI_ID = hdct.VIENPHI_ID and TT_VIENPHI.HOADON_ID = hdct.HOADON_ID        and TT_VIENPHI.TIEPNHAN_ID =  @param0]
2020-01-02 17:41:04,587 [1] DEBUG - Statement Id: [DAO00067_CapnhatDataVienphiKhiHuyThanhtoanHoadon] Parameters: [@param0=[TIEPNHAN_ID,28494]]
2020-01-02 17:41:04,587 [1] DEBUG - Statement Id: [DAO00067_CapnhatDataVienphiKhiHuyThanhtoanHoadon] Types: [@param0=[Int64, System.Int64]]
2020-01-02 17:41:04,846 [1] DEBUG - Statement Id: [DAO00067_GET_CHUYENVIENINFO_FROM_BENHNHANID] PreparedStatement : [select *        from TT_CHUYENVIEN        where BENHNHAN_ID  = '0' and BENHVIEN_ID = 'HLU01'        and TIEPNHAN_ID = '28494'         and           KHAMBENH_ID = '27177']
2020-01-02 17:41:04,874 [1] DEBUG - Statement Id: [DAO00014_GetChanDoan] PreparedStatement : [DECLARE @VAL1 NVARCHAR(1000) = ''        DECLARE @VAL2 NVARCHAR(1000) = ''        SELECT @VAL1 = (SELECT ICD.TENICD +'('+ICD.MAICD+'); '+ KB.CHANDOANKHOAKHAM FROM TT_NGOAITRU_KHAMBENH KB        INNER JOIN TM_ICD ICD ON ICD.ICD_ID = KB.CHANDOANICD_ID        WHERE KHAMBENH_ID =  @param0 )        SELECT @VAl2 = @VAL2 + ICD.TENICD +'('+ICD.MAICD +'); ' FROM        TT_NGOAITRU_KHAMBENH_ICD KBI        INNER JOIN TM_ICD ICD ON KBI.ICD_ID = ICD.ICD_ID        WHERE KBI.KHAMBENH_ID =  @param0         SELECT @VAL1 + '; '+ ISNULL(@VAL2,'')]
2020-01-02 17:41:04,874 [1] DEBUG - Statement Id: [DAO00014_GetChanDoan] Parameters: [@param0=[KHAMBENH_ID,27177]]
2020-01-02 17:41:04,874 [1] DEBUG - Statement Id: [DAO00014_GetChanDoan] Types: [@param0=[Int64, System.Int64]]
2020-01-02 17:41:04,906 [1] DEBUG - Statement Id: [DAO00016_GetDSThuocDaDungByTiepNhan] PreparedStatement : [select A.*, dc.TENDUOCDAYDU        from TT_NGOAITRU_TOATHUOC A        left join TM_DUOC dc on A.DUOC_ID = dc.DUOC_ID        where exists (select KHAMBENH_ID from TT_NGOAITRU_KHAMBENH where A.KHAMBENH_ID = KHAMBENH_ID and  TIEPNHAN_ID = '28494')        and exists (select KHAMBENH_TOATHUOC_ID from TT_NGOAITRU_KHAMBENH_TOATHUOC where A.KHAMBENH_TOATHUOC_ID = KHAMBENH_TOATHUOC_ID and CHUNGTUPHATTHUOC_ID is not null)        and A.BENHVIEN_ID = 'HLU01']
2020-01-02 17:41:04,957 [1] DEBUG - Statement Id: [DAO00067_GetDanhsachDichvuDungChoChuyentuyen] PreparedStatement : [select A.DICHVU_ID, B.TENDICHVU, A.DVYEUCAU_ID        from TT_DVYEUCAU A        left join TM_DICHVU B on A.DICHVU_ID = B.DICHVU_ID        left join TM_NHOMDICHVU C on C.NHOMDICHVU_ID = B.NHOMDICHVU_ID        where        ( @param0  IS NOT NULL OR  @param1  IS NOT NULL) AND        LEFT(C.MANHOMDICHVU,2) in ('01', '02', '05', '06') and A.HUYYEUCAU = '0'         and           A.TIEPNHAN_ID = '28494']
2020-01-02 17:41:04,957 [1] DEBUG - Statement Id: [DAO00067_GetDanhsachDichvuDungChoChuyentuyen] Parameters: [@param0=[BENHAN_ID,null], @param1=[TIEPNHAN_ID,28494]]
2020-01-02 17:41:04,957 [1] DEBUG - Statement Id: [DAO00067_GetDanhsachDichvuDungChoChuyentuyen] Types: [@param0=[System.DBNull, null], @param1=[Int64, System.Int64]]
2020-01-02 17:41:04,995 [1] DEBUG - Statement Id: [DAO00067_GetDanhsachxetnghiemkq] PreparedStatement : [select distinct C.CLSKETQUACHITIET_ID, B.TENDICHVU, C.KETQUA, C.DICHVU_ID, A.DVYEUCAU_ID        from TT_DVYEUCAU A        inner join TT_CLSKETQUACHITIET C on C.DVYEUCAU_ID = A.DVYEUCAU_ID        left join TM_DICHVU B on C.DICHVU_ID = B.DICHVU_ID        where A.HUYYEUCAU = '0' and A.BENHAN_ID is not null                 AND ( @param0  IS NOT NULL OR  @param1  IS NOT NULL)         and           A.TIEPNHAN_ID = '28494'                 order by C.CLSKETQUACHITIET_ID]
2020-01-02 17:41:04,995 [1] DEBUG - Statement Id: [DAO00067_GetDanhsachxetnghiemkq] Parameters: [@param0=[BENHAN_ID,null], @param1=[TIEPNHAN_ID,28494]]
2020-01-02 17:41:04,995 [1] DEBUG - Statement Id: [DAO00067_GetDanhsachxetnghiemkq] Types: [@param0=[System.DBNull, null], @param1=[Int64, System.Int64]]
2020-01-02 17:41:05,037 [1] DEBUG - Statement Id: [DAO00067_GetDanhsachsieuamkq] PreparedStatement : [select C.DVYEUCAU_ID, B.TENDICHVU,C.KETLUAN        from TT_DVYEUCAU A        inner join TT_CLSKETQUA C on C.DVYEUCAU_ID = A.DVYEUCAU_ID        left join TM_DICHVU B on C.DICHVU_ID = B.DICHVU_ID        where        ( @param0  IS NOT NULL OR  @param1  IS NOT NULL) AND                 A.DVYEUCAU_ID not in        (select DVYEUCAU_ID from TT_CLSKETQUACHITIET        where exists (        select DVYEUCAU_ID from TT_DVYEUCAU where TT_CLSKETQUACHITIET.DVYEUCAU_ID = DVYEUCAU_ID                 ))         and           A.TIEPNHAN_ID = 28494]
2020-01-02 17:41:05,037 [1] DEBUG - Statement Id: [DAO00067_GetDanhsachsieuamkq] Parameters: [@param0=[BENHAN_ID,null], @param1=[TIEPNHAN_ID,28494]]
2020-01-02 17:41:05,037 [1] DEBUG - Statement Id: [DAO00067_GetDanhsachsieuamkq] Types: [@param0=[System.DBNull, null], @param1=[Int64, System.Int64]]
--------------------------------------------------------------------------------
2020-01-02 17:46:25,473 [1] DEBUG - Statement Id: [DAO00001_DBList] PreparedStatement : [select *              from TM_SYS_SERVER              where HOSPITAL_ID = '_SYSTEM_' and TYPE = 'D']
2020-01-02 17:46:25,757 [1] DEBUG - Statement Id: [DAO00001_DaoList] PreparedStatement : [select              TM_SYS_SERVICEMAP.ID,              TM_SYS_SERVICEMAP.HOSPITAL_ID,              TM_SYS_SERVICEMAP.DB_NAME,              TM_SYS_SERVICEMAP.TYPE,              TM_SYS_SERVICEMAP.NAME,              TM_SYS_SERVICEMAP.CLASS,              (TM_SYS_DIC.VALUE + '.' + TM_SYS_SERVICEMAP.CLASS) as CLASSFULL,              TM_SYS_SERVICEMAP.ASSEMBLY              from TM_SYS_SERVICEMAP              inner join TM_SYS_DIC              on TM_SYS_SERVICEMAP.NAMESPACE = TM_SYS_DIC.ID              where HOSPITAL_ID = '_SYSTEM_' AND TYPE = 'D' AND ACTIVE = '1'              order by DB_NAME]
2020-01-02 17:46:25,795 [1] DEBUG - Statement Id: [DAO00001_ServiceList] PreparedStatement : [select              TM_SYS_SERVICEMAP.ID,              TM_SYS_SERVICEMAP.HOSPITAL_ID,              TM_SYS_SERVICEMAP.DB_NAME,              TM_SYS_SERVICEMAP.TYPE,              TM_SYS_SERVICEMAP.NAME,              TM_SYS_SERVICEMAP.CLASS,              (TM_SYS_DIC.VALUE + '.' + TM_SYS_SERVICEMAP.CLASS) as CLASSFULL,              TM_SYS_SERVICEMAP.ASSEMBLY,              TM_SYS_SERVER.URL              from TM_SYS_SERVICEMAP              inner join TM_SYS_DIC on TM_SYS_SERVICEMAP.NAMESPACE = TM_SYS_DIC.ID              inner join TM_SYS_SERVER on (TM_SYS_SERVICEMAP.DB_NAME = TM_SYS_SERVER.NAME) and (TM_SYS_SERVER.HOSPITAL_ID = '_SYSTEM_')              where TM_SYS_SERVICEMAP.HOSPITAL_ID = '_SYSTEM_' AND TM_SYS_SERVICEMAP.TYPE = 'S'  AND ACTIVE = '1'              order by URL]
2020-01-02 17:46:26,375 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = '_SYSTEM_'               AND                   TM_SYS_SCREEN.PAGE = 'LOGIN'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2020-01-02 17:46:26,668 [1] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = '_SYSTEM_'               AND                   TM_SYS_CACHE.ACTIVE = '1']
2020-01-02 17:46:33,260 [1] DEBUG - Statement Id: [DAO00001_DBList] PreparedStatement : [select *              from TM_SYS_SERVER              where HOSPITAL_ID = 'HLU01' and TYPE = 'D']
2020-01-02 17:46:33,285 [1] DEBUG - Statement Id: [DAO00001_DaoList] PreparedStatement : [select              TM_SYS_SERVICEMAP.ID,              TM_SYS_SERVICEMAP.HOSPITAL_ID,              TM_SYS_SERVICEMAP.DB_NAME,              TM_SYS_SERVICEMAP.TYPE,              TM_SYS_SERVICEMAP.NAME,              TM_SYS_SERVICEMAP.CLASS,              (TM_SYS_DIC.VALUE + '.' + TM_SYS_SERVICEMAP.CLASS) as CLASSFULL,              TM_SYS_SERVICEMAP.ASSEMBLY              from TM_SYS_SERVICEMAP              inner join TM_SYS_DIC              on TM_SYS_SERVICEMAP.NAMESPACE = TM_SYS_DIC.ID              where HOSPITAL_ID = 'HLU01' AND TYPE = 'D' AND ACTIVE = '1'              order by DB_NAME]
2020-01-02 17:46:35,054 [1] DEBUG - Statement Id: [DAO00001_ServiceList] PreparedStatement : [select              TM_SYS_SERVICEMAP.ID,              TM_SYS_SERVICEMAP.HOSPITAL_ID,              TM_SYS_SERVICEMAP.DB_NAME,              TM_SYS_SERVICEMAP.TYPE,              TM_SYS_SERVICEMAP.NAME,              TM_SYS_SERVICEMAP.CLASS,              (TM_SYS_DIC.VALUE + '.' + TM_SYS_SERVICEMAP.CLASS) as CLASSFULL,              TM_SYS_SERVICEMAP.ASSEMBLY,              TM_SYS_SERVER.URL              from TM_SYS_SERVICEMAP              inner join TM_SYS_DIC on TM_SYS_SERVICEMAP.NAMESPACE = TM_SYS_DIC.ID              inner join TM_SYS_SERVER on (TM_SYS_SERVICEMAP.DB_NAME = TM_SYS_SERVER.NAME) and (TM_SYS_SERVER.HOSPITAL_ID = 'HLU01')              where TM_SYS_SERVICEMAP.HOSPITAL_ID = 'HLU01' AND TM_SYS_SERVICEMAP.TYPE = 'S'  AND ACTIVE = '1'              order by URL]
2020-01-02 17:46:35,156 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1']
2020-01-02 17:46:35,945 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM005']
2020-01-02 17:46:36,107 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM015']
2020-01-02 17:46:36,182 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM067']
2020-01-02 17:46:36,256 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM008']
2020-01-02 17:46:36,330 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM068']
2020-01-02 17:46:36,407 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM006']
2020-01-02 17:46:36,519 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM030']
2020-01-02 17:46:36,628 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM025']
2020-01-02 17:46:36,739 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM024']
2020-01-02 17:46:37,242 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM033']
2020-01-02 17:46:37,281 [5] DEBUG - Statement Id: [DAO00027_GetListDuocKyGuiTonKho] PreparedStatement : [select  distinct TT_TONKHO.DUOC_KEY, LTRIM(TT_TONKHO.KHODUOC_ID) as KHODUOC_ID, TM_DUOC.DUOC_ID, TM_LOAIDUOC.MALOAIDUOC,TM_DUOC.SOVISA,TM_DUOC.TYLE_VAT,TM_DUOC.COTOA,        TM_DUOC.MADUOC, TM_DUOC.TENHANG, TM_DUOC.TENDUOCDAYDU, dvt.TENDONVITINH as DONVITINH,  TM_DUOC.DONVITINH_ID,TM_DUOC.BHYT,TM_DUOC.PHAMVI,        TM_DUOC.TENHOATCHAT, TM_DUOC.HAMLUONG, TM_DUOC.HANGSANXUAT, TM_DUOC.QUOCGIA, TM_DUOC.LOAIDUOC_ID, TM_DUOC.DUONGDUNG_ID,        TM_TENDUOC.TENDUOC, TM_TENDUOC.TENDUOC_EN, TM_TENDUOC.MAQUOCTE, TM_TENDUOC.MAQUOCTEBT,        TM_LOAIDUOC.LOAIVATTU_ID, TM_DUOC.BENHVIEN_ID,TT_TONKHO.SOLUONG, TT_TONKHO.NGUONDUOC_ID, NH.TENNGUONDUOC        , TAMNGUNG = CASE WHEN TM_DUOC.TAMNGUNG = '1' OR nh.TAMNGUNG = '1' OR KD.TAMNGUNG = '1' THEN '1' ELSE '0' END        , TM_DUOC.DANGTRINHBAY        from TM_DUOC        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = TM_DUOC.DONVITINH_ID        left join TM_TENDUOC on TM_DUOC.TENDUOC_ID = TM_TENDUOC.TENDUOC_ID and TM_DUOC.BENHVIEN_ID = 'HLU01' and TM_DUOC.TAMNGUNG = '0'        left join TM_LOAIDUOC on TM_LOAIDUOC.LOAIDUOC_ID = TM_DUOC.LOAIDUOC_ID and TM_LOAIDUOC.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG on (TM_LOAIDUOC.LOAIVATTU_ID = TM_DUOC_HANDUNG.LOAIDUOC and TM_DUOC_HANDUNG.BENHVIEN_ID = 'HLU01')        inner join        (select LTRIM(A.KHODUOC_ID) + '_' + LTRIM(A.DUOC_ID) + '_' + LTRIM(ISNULL(A.NGUONDUOC_ID,'')) as DUOC_KEY, A.KHODUOC_ID, A.DUOC_ID,A.NGUONDUOC_ID,        SUM(isnull(A.SOLUONG,0)) as SOLUONG        from        (select SUM(SOLUONG) as SOLUONG, KHODUOC_ID, DUOC_ID, NGUONDUOC_ID from TT_DUOC_KYGUI_TONKHO        where BENHVIEN_ID = 'HLU01' group by KHODUOC_ID, DUOC_ID, NGUONDUOC_ID) A        group by LTRIM(A.KHODUOC_ID) + '_' + LTRIM(A.DUOC_ID) + '_' + LTRIM(A.NGUONDUOC_ID), A.KHODUOC_ID, A.DUOC_ID, A.NGUONDUOC_ID)        TT_TONKHO on TT_TONKHO.DUOC_ID = TM_DUOC.DUOC_ID        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = TT_TONKHO.NGUONDUOC_ID and nh.BENHVIEN_ID = 'HLU01'        LEFT JOIN TM_KHODUOC KD ON KD.KHODUOC_ID = TT_TONKHO.KHODUOC_ID        where TM_DUOC.BENHVIEN_ID = 'HLU01' AND TT_TONKHO.SOLUONG >= 0]
2020-01-02 17:46:37,356 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM018']
2020-01-02 17:46:37,394 [5] DEBUG - Statement Id: [DAO00027_GetListDuocTonKho] PreparedStatement : [select distinct TT_TONKHO.DUOC_KEY, LTRIM(TT_TONKHO.KHODUOC_ID) as KHODUOC_ID, TM_DUOC.DUOC_ID, TM_LOAIDUOC.MALOAIDUOC,TM_DUOC.SOVISA,TM_DUOC.TYLE_VAT,TM_DUOC.COTOA,        TM_DUOC.MADUOC, TM_DUOC.TENHANG, TM_DUOC.TENDUOCDAYDU, dvt.TENDONVITINH as DONVITINH,  TM_DUOC.DONVITINH_ID,TM_DUOC.BHYT,                TM_DUOC.TENHOATCHAT,          TM_DUOC.HAMLUONG, TM_DUOC.HANGSANXUAT, TM_DUOC.QUOCGIA, TM_DUOC.LOAIDUOC_ID, TM_DUOC.DUONGDUNG_ID,        TM_TENDUOC.TENDUOC, TM_TENDUOC.TENDUOC_EN, TM_TENDUOC.MAQUOCTE, TM_TENDUOC.MAQUOCTEBT,        TM_LOAIDUOC.LOAIVATTU_ID, TM_DUOC.BENHVIEN_ID,        TT_TONKHO.SOLUONG, TM_DUOC.VTYT_PHANLOAI, TM_DUOC.PHAMVI, TT_TONKHO.NGUONDUOC_ID, NG.TENNGUONDUOC AS TENNGUONDUOC        , TAMNGUNG = CASE WHEN TM_DUOC.TAMNGUNG = '1' OR NG.TAMNGUNG = '1' OR KD.TAMNGUNG = '1' THEN '1' ELSE '0' END        , TM_DUOC.DANGTRINHBAY        from TM_DUOC        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = TM_DUOC.DONVITINH_ID        left join TM_TENDUOC on TM_DUOC.TENDUOC_ID = TM_TENDUOC.TENDUOC_ID and TM_DUOC.BENHVIEN_ID = 'HLU01' and TM_DUOC.TAMNGUNG = '0'        left join TM_LOAIDUOC on TM_LOAIDUOC.LOAIDUOC_ID = TM_DUOC.LOAIDUOC_ID and TM_LOAIDUOC.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG on (TM_LOAIDUOC.LOAIVATTU_ID = TM_DUOC_HANDUNG.LOAIDUOC and TM_DUOC_HANDUNG.BENHVIEN_ID = 'HLU01')        inner join        (select LTRIM(A.KHODUOC_ID) + '_' + LTRIM(A.DUOC_ID) + '_' + LTRIM(ISNULL(A.NGUONDUOC_ID,'')) as DUOC_KEY, A.KHODUOC_ID, A.DUOC_ID, A.NGUONDUOC_ID,        SUM(isnull(A.SOLUONG,0)) as SOLUONG        from        (select SUM(SOLUONG) as SOLUONG, KHODUOC_ID, DUOC_ID, NGUONDUOC_ID from TT_DUOC_TONKHO        where BENHVIEN_ID = 'HLU01' group by KHODUOC_ID, DUOC_ID, NGUONDUOC_ID) A        group by LTRIM(A.KHODUOC_ID) + '_' + LTRIM(A.DUOC_ID) + '_' + LTRIM(ISNULL(A.NGUONDUOC_ID,'')), A.KHODUOC_ID, A.DUOC_ID, NGUONDUOC_ID        ) TT_TONKHO on TT_TONKHO.DUOC_ID = TM_DUOC.DUOC_ID        LEFT JOIN TM_NGUONHANG NG ON NG.NGUONDUOC_ID = TT_TONKHO.NGUONDUOC_ID        LEFT JOIN TM_KHODUOC KD ON KD.KHODUOC_ID = TT_TONKHO.KHODUOC_ID        where TM_DUOC.BENHVIEN_ID = 'HLU01' and TT_TONKHO.SOLUONG >= 0]
2020-01-02 17:46:38,348 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM023']
2020-01-02 17:46:38,380 [5] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoVaBooking] PreparedStatement : [declare @NGUONDUOC_MACDINH varchar(5) = '0';        declare @TOAMUANGOAI int = 0;        select @NGUONDUOC_MACDINH = isnull(VALUE,0) from TM_SYS_APPSETTINGS where CODE = 'PHA_NGUONDUOC'        select @TOAMUANGOAI = isnull(VALUE,0) from TM_SYS_APPSETTINGS where CODE = 'OPD_TOAMUANGOAI_DUNGDANHMUC_DUOC'                if @TOAMUANGOAI = 1        begin        select  distinct '0' + '_' + LTRIM(d.DUOC_ID) + '_' + @NGUONDUOC_MACDINH as DUOC_KEY, 0 as PHAMVI_ID, @NGUONDUOC_MACDINH as NGUONDUOC_ID, null as TENNGUONDUOC, null as TINHTIEN, d.DUOC_ID, ld.MALOAIDUOC,        d.SOVISA,d.TYLE_VAT,d.COTOA, d.MADUOC, d.TENHANG, d.TENDUOCDAYDU, d.DONVITINH as DONVITINH, d.BHYT,        d.TENHOATCHAT, d.HAMLUONG, d.HANGSANXUAT, d.QUOCGIA, d.LOAIDUOC_ID, d.DUONGDUNG_ID, d.TINHTIEN_PTTT,        ten.TENDUOC, ten.TENDUOC_EN, ten.MAQUOCTE, ten.MAQUOCTEBT,d.CONGDUNG,        '' as BHYT_TEXT        , ld.LOAIVATTU_ID        , d.BENHVIEN_ID,        999999999 as SOLUONG, d.VTYT_PHANLOAI, d.PHAMVI, d.SUASOLUONGTONGHOP, d.MADUOCBV, d.DANGTRINHBAY        , TAMNGUNG = CASE WHEN d.TAMNGUNG = '1' THEN '1' ELSE '0' END        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        union all        select  distinct tk.DUOC_KEY, LTRIM(tk.PHAMVI_ID) as PHAMVI_ID, tk.NGUONDUOC_ID, nh.TENNGUONDUOC, nh.TINHTIEN, d.DUOC_ID, ld.MALOAIDUOC,        d.SOVISA,d.TYLE_VAT,d.COTOA, d.MADUOC, d.TENHANG, d.TENDUOCDAYDU, d.DONVITINH as DONVITINH, d.BHYT,        d.TENHOATCHAT, d.HAMLUONG, d.HANGSANXUAT, d.QUOCGIA, d.LOAIDUOC_ID, d.DUONGDUNG_ID, d.TINHTIEN_PTTT,        ten.TENDUOC, ten.TENDUOC_EN, ten.MAQUOCTE, ten.MAQUOCTEBT,d.CONGDUNG,        CASE WHEN d.BHYT = '1' THEN 'BHYT' ELSE '' END as BHYT_TEXT        , ld.LOAIVATTU_ID        , d.BENHVIEN_ID,        tk.SOLUONG, d.VTYT_PHANLOAI, d.PHAMVI, d.SUASOLUONGTONGHOP, d.MADUOCBV, d.DANGTRINHBAY        , TAMNGUNG = CASE WHEN d.TAMNGUNG = '1' OR nh.TAMNGUNG = '1' OR kd.TAMNGUNG = '1' THEN '1' ELSE '0' END        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        inner join        (        select  LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')) DUOC_KEY, (SUM(dtk.SOLUONG) - isnull(sum(A.SOLUONG),0) - isnull(sum(B.SOLUONG),0)) SOLUONG, pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        from (select sum(soluong) soluong,duoc_id,nguonduoc_id,khoduoc_id,benhvien_id from TT_DUOC_TONKHO  group by duoc_id,nguonduoc_id,khoduoc_id,benhvien_id) dtk        inner join TM_DUOC_PHAMVISD_MAPPING pvsd on dtk.KHODUOC_ID = pvsd.KHODUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NOITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) B on B.DUOC_ID = dtk.DUOC_ID and B.SOLUONG > 0 and B.PHAMVI_ID = pvsd.PHAMVI_ID and B.NGUONHANG_ID = dtk.NGUONDUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NGOAITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) A on A.DUOC_ID = dtk.DUOC_ID and A.SOLUONG > 0 and A.PHAMVI_ID = pvsd.PHAMVI_ID and A.NGUONHANG_ID = dtk.NGUONDUOC_ID        where dtk.SOLUONG > 0 and dtk.BENHVIEN_ID = 'HLU01'        group by LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')), pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        ) tk on tk.DUOC_ID = d.DUOC_ID        left join TM_DUOC_PHAMVISUDUNG kd on kd.PHAMVI_ID = tk.PHAMVI_ID and kd.BENHVIEN_ID = 'HLU01'        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = tk.NGUONDUOC_ID and nh.BENHVIEN_ID = 'HLU01'        where d.BENHVIEN_ID = 'HLU01'  and tk.SOLUONG >= 0        end        else        begin                  select  distinct tk.DUOC_KEY, LTRIM(tk.PHAMVI_ID) as PHAMVI_ID, tk.NGUONDUOC_ID, nh.TENNGUONDUOC, nh.TINHTIEN, d.DUOC_ID, ld.MALOAIDUOC,        d.SOVISA,d.TYLE_VAT,d.COTOA, d.MADUOC, d.TENHANG, d.TENDUOCDAYDU, d.DONVITINH as DONVITINH, d.BHYT,        d.TENHOATCHAT, d.HAMLUONG, d.HANGSANXUAT, d.QUOCGIA, d.LOAIDUOC_ID, d.DUONGDUNG_ID, d.TINHTIEN_PTTT,        ten.TENDUOC, ten.TENDUOC_EN, ten.MAQUOCTE, ten.MAQUOCTEBT,d.CONGDUNG,        CASE WHEN d.BHYT = '1' THEN 'BHYT' ELSE '' END as BHYT_TEXT        , ld.LOAIVATTU_ID        , d.BENHVIEN_ID,        tk.SOLUONG, d.VTYT_PHANLOAI, d.PHAMVI, d.SUASOLUONGTONGHOP, d.MADUOCBV, d.DANGTRINHBAY        , TAMNGUNG = CASE WHEN d.TAMNGUNG = '1' OR nh.TAMNGUNG = '1' OR kd.TAMNGUNG = '1' THEN '1' ELSE '0' END        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        inner join        (        select  LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')) DUOC_KEY, (SUM(dtk.SOLUONG) - isnull(sum(A.SOLUONG),0) - isnull(sum(B.SOLUONG),0)) SOLUONG, pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        from (select sum(soluong) soluong,duoc_id,nguonduoc_id,khoduoc_id,benhvien_id from TT_DUOC_TONKHO  group by duoc_id,nguonduoc_id,khoduoc_id,benhvien_id) dtk        inner join TM_DUOC_PHAMVISD_MAPPING pvsd on dtk.KHODUOC_ID = pvsd.KHODUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NOITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) B on B.DUOC_ID = dtk.DUOC_ID and B.SOLUONG > 0 and B.PHAMVI_ID = pvsd.PHAMVI_ID and B.NGUONHANG_ID = dtk.NGUONDUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NGOAITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) A on A.DUOC_ID = dtk.DUOC_ID and A.SOLUONG > 0 and A.PHAMVI_ID = pvsd.PHAMVI_ID and A.NGUONHANG_ID = dtk.NGUONDUOC_ID        where dtk.SOLUONG > 0 and dtk.BENHVIEN_ID = 'HLU01'        group by LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')), pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        ) tk on tk.DUOC_ID = d.DUOC_ID        left join TM_DUOC_PHAMVISUDUNG kd on kd.PHAMVI_ID = tk.PHAMVI_ID and kd.BENHVIEN_ID = 'HLU01'        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = tk.NGUONDUOC_ID and nh.BENHVIEN_ID = 'HLU01'        where d.BENHVIEN_ID = 'HLU01'  and tk.SOLUONG >= 0        end]
2020-01-02 17:46:40,815 [5] DEBUG - Statement Id: [DAO00320_GetList] PreparedStatement : [select M.*            from TM_MAU M            LEFT JOIN TM_MAU_DONVITINH DVT on M.DONVITINH_ID=DVT.DONVITINH_ID            where            M.TAMNGUNG = '0'            and M.BENHVIEN_ID = 'HLU01'            order by M.TENMAU]
2020-01-02 17:46:40,879 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM071']
2020-01-02 17:46:40,912 [5] DEBUG - Statement Id: [DAO00322_GetListMauTonKhoForCreateCached] PreparedStatement : [SELECT DISTINCT        TK.MAU_KEY, TK.KHOMAU_ID, M.MAU_ID, M.MAMAU, M.TENMAU, M.NHOM_ABO, M.NHOM_RH, M.LOAIMAU_ID,        TK.SOLONHAP_ID, SLN.SOLONHAP, SLN.SOKIEMSOAT, TK.NGUONHANG_ID, NG.TENNGUONMAU, M.BENHVIEN_ID, M.DONVITINH_ID,        SUM(tk.SOLUONG) AS SOLUONG,K.TENKHO,DVT.TENDONVITINH        FROM TT_MAU_TONKHO TK        JOIN TM_KHO K ON TK.KHOMAU_ID = K.KHO_ID        JOIN TT_MAU_CHUNGTU_SOLONHAP SLN ON TK.SOLONHAP_ID = SLN.SOLONHAP_ID        JOIN TM_MAU M on TK.MAU_ID = M.MAU_ID and M.TAMNGUNG = '0'        LEFT JOIN TM_MAU_DONVITINH DVT on M.DONVITINH_ID=DVT.DONVITINH_ID        LEFT JOIN TM_NGUONMAU NG ON NG.NGUONMAU_ID = TK.NGUONHANG_ID        WHERE TK.SOLUONG > 0        GROUP BY TK.MAU_KEY, TK.KHOMAU_ID, M.MAU_ID, M.MAMAU, M.TENMAU, M.NHOM_ABO, M.NHOM_RH, M.LOAIMAU_ID,        TK.SOLONHAP_ID, SLN.SOLONHAP, SLN.SOKIEMSOAT,TK.NGUONHANG_ID, NG.TENNGUONMAU, M.BENHVIEN_ID, M.DONVITINH_ID,K.TENKHO,DVT.TENDONVITINH]
2020-01-02 17:46:40,990 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM073']
2020-01-02 17:46:41,021 [5] DEBUG - Statement Id: [DAO00322_GetListMauTonKhoTruBooking] PreparedStatement : [select distinct        TK.MAU_KEY, TK.KHOMAU_ID, M.MAU_ID, M.MAMAU, M.TENMAU, M.NHOM_ABO, M.NHOM_RH, M.LOAIMAU_ID, M.DONVITINH_ID,        TK.SOLONHAP_ID, TK.SOLONHAP, TK.SOKIEMSOAT,M.PHAMVI, TK.NGUONHANG_ID, NG.TENNGUONMAU, M.BENHVIEN_ID,        TK.SOLUONG,TK.TENKHO,DVT.TENDONVITINH        from TM_MAU M        JOIN        (        select        A.MAU_KEY, A.KHOMAU_ID, A.MAU_ID ,a.NGUONHANG_ID, A.SOLONHAP_ID, A.SOLONHAP, A.SOKIEMSOAT, A.SOLUONG,A.TENKHO        from        (        select KHOMAU_ID, TK.MAU_ID, TK.NGUONHANG_ID, TK.MAU_KEY, SLN.SOLONHAP_ID, SLN.SOLONHAP, SLN.SOKIEMSOAT, ISNULL(TK.SOLUONG,0) - ISNULL(book.SOLUONG,0) as SOLUONG,K.TENKHO        from TT_MAU_TONKHO TK        JOIN TM_KHO K ON TK.KHOMAU_ID = K.KHO_ID        inner join TT_MAU_CHUNGTU_SOLONHAP SLN ON TK.SOLONHAP_ID = SLN.SOLONHAP_ID        left join dbo.TT_MAU_TONKHO_BOOK book ON book.MAU_KEY = TK.MAU_KEY AND book.TRANGTHAI = 'HIEULUC'        where ISNULL(TK.SOLUONG,0) - ISNULL(book.SOLUONG,0) > 0        ) A        )TK on TK.MAU_ID = M.MAU_ID and M.TAMNGUNG = '0'        LEFT JOIN TM_MAU_DONVITINH DVT on M.DONVITINH_ID=DVT.DONVITINH_ID        LEFT JOIN TM_NGUONMAU NG ON NG.NGUONMAU_ID = TK.NGUONHANG_ID]
2020-01-02 17:46:41,103 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM072']
2020-01-02 17:46:42,032 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'MAIN'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2020-01-02 17:46:42,985 [1] DEBUG - Statement Id: [DAO00002_FormList] PreparedStatement : [select              TM_SYS_FORM.HOSPITAL_ID,              TM_SYS_FORM.NAME,              TM_SYS_FORM.CLASS,              TM_SYS_FORM.ASSEMBLY,              TM_SYS_FORM.TITLE_VI as TITLE              from TM_SYS_FORM              where HOSPITAL_ID = 'HLU01']
2020-01-02 17:46:49,047 [1] DEBUG - Statement Id: [DAO00300_GetShortcutListByUserID] PreparedStatement : [SELECT S.SHORTCUT_CODE, S.SHORTCUT_VALUE              FROM TM_SHORTCUT AS S              WHERE S.BENHVIEN_ID = 'HLU01' AND S.USER_ID = '1' AND TAMNGUNG = '0']
2020-01-02 17:46:49,075 [1] DEBUG - Statement Id: [DAO00087_GetList] PreparedStatement : [select CODE, VALUE, BENHVIEN_ID              from TM_SYS_APPSETTINGS              where LOCKED = '0' and BENHVIEN_ID = 'HLU01'              order by SETTING_ID]
2020-01-02 17:46:49,155 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'MSG01'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2020-01-02 17:46:49,298 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'MSG02'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2020-01-02 17:46:49,441 [1] DEBUG - Statement Id: [DAO00008_GetUserSettings] PreparedStatement : [select A.*, B.TENKHO , C.TENPHONGBAN, B.MAKHO, C.MAPHONGBAN          from TM_SYS_USERS A          left join TM_KHODUOC B on B.KHODUOC_ID = A.INVENTORY_ID          left join TM_PHONGBAN C on (C.PHONGBAN_ID = A.WORKING_DEPT_ID and C.BENHVIEN_ID =  @param0 )          left join TM_SYS_USERKHO D on (D.ACCOUNT_ID = A.ACCOUNT_ID and D.HOSPITAL_ID =  @param0 )          where          A.HOSPITAL_ID =  @param0            and                 A.ACCOUNT_ID =  @param1]
2020-01-02 17:46:49,443 [1] DEBUG - Statement Id: [DAO00008_GetUserSettings] Parameters: [@param0=[HOSPITAL_ID,HLU01], @param1=[ACCOUNT_ID,113]]
2020-01-02 17:46:49,443 [1] DEBUG - Statement Id: [DAO00008_GetUserSettings] Types: [@param0=[String, System.String], @param1=[String, System.String]]
2020-01-02 17:46:49,471 [1] DEBUG - Statement Id: [DAO00008_GetUserInvSettings] PreparedStatement : [select A.*, B.TENKHO, B.MAKHO, B.LOAIKHO_ID, B.KHOQUANLY_ID          from TM_SYS_USERKHO A          left join TM_KHO B on B.MODULE_ID = A.MODULE_ID and B.KHO_ID = A.KHO_ID          where A.HOSPITAL_ID =  @param0  and A.ACCOUNT_ID =  @param1           order by B.TENKHO]
2020-01-02 17:46:49,471 [1] DEBUG - Statement Id: [DAO00008_GetUserInvSettings] Parameters: [@param0=[HOSPITAL_ID,HLU01], @param1=[ACCOUNT_ID,113]]
2020-01-02 17:46:49,471 [1] DEBUG - Statement Id: [DAO00008_GetUserInvSettings] Types: [@param0=[String, System.String], @param1=[String, System.String]]
2020-01-02 17:46:49,624 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'COM30'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2020-01-02 17:46:49,813 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'RIS04'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2020-01-02 17:47:07,161 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'MENU1'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2020-01-02 17:47:07,267 [1] DEBUG - Statement Id: [DAO00011_GetList] PreparedStatement : [select              TM_SYS_MENU.ID,              TM_SYS_MENU.PARENTID,              TM_SYS_MENU.SCREEN,              TM_SYS_MENU.SMALLIMAGE,              TM_SYS_MENU.LARGEIMAGE,              TM_SYS_MENU.DESCRIPTION,              TM_SYS_MENU.TYPE,              TM_SYS_MENU.TITLE_VI as TITLE              from TM_SYS_MENU              where TM_SYS_MENU.HOSPITAL_ID = 'HLU01' and TM_SYS_MENU.ACTIVE = '1'               AND                   (TM_SYS_MENU.TYPE & '8' = '8')                             order by TM_SYS_MENU.ORDERNUM]
2020-01-02 17:47:07,526 [1] DEBUG - Statement Id: [DAO00011_usermenu_list] PreparedStatement : [select              TM_SYS_HOMEMENU.MENUID as ID,              TM_SYS_MENU.TITLE_VI as TITLE,              TM_SYS_MENU.SCREEN,              TM_SYS_MENU.SMALLIMAGE,              TM_SYS_MENU.LARGEIMAGE,              TM_SYS_MENU.TYPE              from TM_SYS_HOMEMENU              left join TM_SYS_MENU on TM_SYS_MENU.ID = TM_SYS_HOMEMENU.MENUID and TM_SYS_MENU.HOSPITAL_ID = TM_SYS_HOMEMENU.HOSPITAL_ID              where TM_SYS_HOMEMENU.HOSPITAL_ID = 'HLU01' and TM_SYS_HOMEMENU.USERID = '113' and TM_SYS_MENU.ACTIVE = '1'               AND                   (TM_SYS_MENU.TYPE & '8' = '8')                             ORDER BY TM_SYS_HOMEMENU.ORDERNUM]
2020-01-02 17:47:12,521 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'OPD22'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2020-01-02 17:47:14,007 [1] DEBUG - Statement Id: [DAO00019_GetDanhsachKhambenh] PreparedStatement : [select *        from        (SELECT COUNT(*) OVER() as TOTALROWS, ROW_NUMBER() OVER(order by isnull(dv.SOTHUTU,'999999999'), dv.NGAYGIOYEUCAU) as ROWNUMBER,        bn.MAYTE, bn.TENBENHNHAN, bn.NAMSINH, bn.NGAYSINH as TUOI, ISNULL(CONVERT(VARCHAR(10), bn.NGAYSINH, 103),CAST(bn.NAMSINH AS varchar)) as NGAYSINH, bn.DIACHILIENLAC as DIACHI, bn.GIOITINH, GD.DESCRIPTION as TENGIOITINH,        tn.DOITUONG_ID, tn.THOIGIANTIEPNHAN, tn.BENHNHAN_ID, tn.TIEPNHAN_ID, tn.TRAITUYEN, tn.SOTIEPNHAN,        dv.DICHVU_ID, dv.NOITHUCHIEN_ID, isnull(dv.NGAYTAO, dv.NGAYCAPNHAT) as THOIGIANDKDICHVU,        dv.KHAN, dv.NOIYEUCAU_ID, dv.NGAYGIOYEUCAU, dv.BACSICHIDINH_ID, dv.DONVIGIOITHIEU_ID, dv.NGUOIGIOITHIEU_ID,        tn.NOIGIOITHIEU_ID, kbnt.HUONGGIAIQUYET_ID,        dv.DVYEUCAU_ID, dv.MARIS, dv.TRANGTHAI as TRANGTHAICODE, B.TENNHOMDICHVU, dv.SOPHIEUYEUCAU, dv.KHAMBENH_NGOAITRU_ID, dv.NGUOICAPNHAT_ID, dv.NGAYCAPNHAT,        CASE WHEN Left(B.MANHOMDICHVU,2) = '03' THEN '02' ELSE Left(B.MANHOMDICHVU,2) END AS MANHOMDICHVU, B.MANHOMDICHVU as MANHOMDICHVUCHITIET, tn.TRANGTHAI as TRANGTHAI_TIEPNHAN,        'False' as DAKHAM, isnull(dv.SOTHUTU,'999999999') as SOHANGDOI,        vp.DATHANHTOAN, dv.TRANGTHAI_WFL,        BA.SOBENHAN, dv.CHANDOAN, dt.TENDOITUONG, isnull(kbnt.THOIGIANKHAM, dv.NGAYCAPNHAT) as THOIGIANKHAM,        tn.SOBHYT        FROM TT_DVYEUCAU (NOLOCK) dv        inner join TT_TIEPNHAN (NOLOCK) tn on dv.TIEPNHAN_ID = tn.TIEPNHAN_ID        inner join TT_BENHNHAN (NOLOCK) bn on tn.BENHNHAN_ID = bn.BENHNHAN_ID        inner join TM_DICHVU A on A.DICHVU_ID = dv.DICHVU_ID        inner join TM_NHOMDICHVU B on B.NHOMDICHVU_ID = A.NHOMDICHVU_ID        inner join TT_VIENPHI(NOLOCK) VP on VP.TIEPNHAN_ID = tn.TIEPNHAN_ID and VP.DICHVU_ID = dv.DICHVU_ID and VP.REF_ID = dv.DVYEUCAU_ID        left join TT_NOITRU_BENHAN (NOLOCK) BA on BA.TIEPNHAN_ID = tn.TIEPNHAN_ID AND dv.BENHAN_ID = BA.BENHAN_ID        inner join TM_GENDER GD on GD.ID = bn.GIOITINH        left join TT_NGOAITRU_KHAMBENH (NOLOCK) kbnt on kbnt.KHAMBENH_ID = dv.KHAMBENH_NGOAITRU_ID        inner join TM_DOITUONG dt on dt.DOITUONG_ID = tn.DOITUONG_ID        where        dv.DICHVU_ID IS NOT NULL        and tn.BENHVIEN_ID = 'HLU01'        and HUYYEUCAU = 0        and dv.NGAYHENCLS is NULL         and           dv.NGAYYEUCAU >= '1/2/2020 12:00:00 AM'         and           dv.NGAYYEUCAU <= '1/2/2020 12:00:00 AM'         and           dv.NOITHUCHIEN_ID = 62          AND             (                         ((dv.TRANGTHAI_WFL = 'CHUAKETQUA' or (dv.TRANGTHAI = 'CHUAKETQUA' and dv.TRANGTHAI_WFL = 'HOANTHANH')) and (isnull(kbnt.HUONGGIAIQUYET_ID, 0) = 0)))            and (tn.TRANGTHAI != 'HOANTHANH')           and           (CASE WHEN Left(B.MANHOMDICHVU,2) = '03' THEN '02' ELSE Left(B.MANHOMDICHVU,2) END) = '04'                 ) lst                    where          lst.ROWNUMBER between 1 and 5                 order by SOHANGDOI, NGAYGIOYEUCAU asc]
2020-01-02 17:47:16,027 [1] DEBUG - Statement Id: [DAO00019_GetDanhsachKhambenh] PreparedStatement : [select *        from        (SELECT COUNT(*) OVER() as TOTALROWS, ROW_NUMBER() OVER(order by isnull(dv.SOTHUTU,'999999999'), dv.NGAYGIOYEUCAU) as ROWNUMBER,        bn.MAYTE, bn.TENBENHNHAN, bn.NAMSINH, bn.NGAYSINH as TUOI, ISNULL(CONVERT(VARCHAR(10), bn.NGAYSINH, 103),CAST(bn.NAMSINH AS varchar)) as NGAYSINH, bn.DIACHILIENLAC as DIACHI, bn.GIOITINH, GD.DESCRIPTION as TENGIOITINH,        tn.DOITUONG_ID, tn.THOIGIANTIEPNHAN, tn.BENHNHAN_ID, tn.TIEPNHAN_ID, tn.TRAITUYEN, tn.SOTIEPNHAN,        dv.DICHVU_ID, dv.NOITHUCHIEN_ID, isnull(dv.NGAYTAO, dv.NGAYCAPNHAT) as THOIGIANDKDICHVU,        dv.KHAN, dv.NOIYEUCAU_ID, dv.NGAYGIOYEUCAU, dv.BACSICHIDINH_ID, dv.DONVIGIOITHIEU_ID, dv.NGUOIGIOITHIEU_ID,        tn.NOIGIOITHIEU_ID, kbnt.HUONGGIAIQUYET_ID,        dv.DVYEUCAU_ID, dv.MARIS, dv.TRANGTHAI as TRANGTHAICODE, B.TENNHOMDICHVU, dv.SOPHIEUYEUCAU, dv.KHAMBENH_NGOAITRU_ID, dv.NGUOICAPNHAT_ID, dv.NGAYCAPNHAT,        CASE WHEN Left(B.MANHOMDICHVU,2) = '03' THEN '02' ELSE Left(B.MANHOMDICHVU,2) END AS MANHOMDICHVU, B.MANHOMDICHVU as MANHOMDICHVUCHITIET, tn.TRANGTHAI as TRANGTHAI_TIEPNHAN,        'True' as DAKHAM, isnull(dv.SOTHUTU,'999999999') as SOHANGDOI,        vp.DATHANHTOAN, dv.TRANGTHAI_WFL,        BA.SOBENHAN, dv.CHANDOAN, dt.TENDOITUONG, isnull(kbnt.THOIGIANKHAM, dv.NGAYCAPNHAT) as THOIGIANKHAM,        tn.SOBHYT        FROM TT_DVYEUCAU (NOLOCK) dv        inner join TT_TIEPNHAN (NOLOCK) tn on dv.TIEPNHAN_ID = tn.TIEPNHAN_ID        inner join TT_BENHNHAN (NOLOCK) bn on tn.BENHNHAN_ID = bn.BENHNHAN_ID        inner join TM_DICHVU A on A.DICHVU_ID = dv.DICHVU_ID        inner join TM_NHOMDICHVU B on B.NHOMDICHVU_ID = A.NHOMDICHVU_ID        inner join TT_VIENPHI(NOLOCK) VP on VP.TIEPNHAN_ID = tn.TIEPNHAN_ID and VP.DICHVU_ID = dv.DICHVU_ID and VP.REF_ID = dv.DVYEUCAU_ID        left join TT_NOITRU_BENHAN (NOLOCK) BA on BA.TIEPNHAN_ID = tn.TIEPNHAN_ID AND dv.BENHAN_ID = BA.BENHAN_ID        inner join TM_GENDER GD on GD.ID = bn.GIOITINH        left join TT_NGOAITRU_KHAMBENH (NOLOCK) kbnt on kbnt.KHAMBENH_ID = dv.KHAMBENH_NGOAITRU_ID        inner join TM_DOITUONG dt on dt.DOITUONG_ID = tn.DOITUONG_ID        where        dv.DICHVU_ID IS NOT NULL        and tn.BENHVIEN_ID = 'HLU01'        and HUYYEUCAU = 0        and dv.NGAYHENCLS is NULL         and           dv.NGAYYEUCAU >= '1/2/2020 12:00:00 AM'         and           dv.NGAYYEUCAU <= '1/2/2020 12:00:00 AM'         and           dv.NOITHUCHIEN_ID = 62          AND             (dv.TRANGTHAI != 'CHUAKETQUA' or isnull(kbnt.HUONGGIAIQUYET_ID, 0) > 0)           and           (CASE WHEN Left(B.MANHOMDICHVU,2) = '03' THEN '02' ELSE Left(B.MANHOMDICHVU,2) END) = '04'                 ) lst                    where          lst.ROWNUMBER between 1 and 5                 order by SOHANGDOI, NGAYGIOYEUCAU asc]
2020-01-02 17:47:18,044 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'OPD02'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2020-01-02 17:47:19,321 [1] DEBUG - Statement Id: [DAO00017_GetLoaiGiaByDoiTuongId] PreparedStatement : [select dtlg.DOUUTIEN, dtlg.DOITUONG_ID, lg.LOAIGIA_ID, lg.TENLOAIGIA, lg.MALOAIGIA              from TM_LOAIGIA lg              left join TM_DOITUONG_LOAIGIA dtlg              on lg.LOAIGIA_ID = dtlg.LOAIGIA_ID and dtlg.BENHVIEN_ID = 'HLU01'              where lg.TAMNGUNG = 0 and lg.BENHVIEN_ID = 'HLU01'                             order by dtlg.DOUUTIEN]
2020-01-02 17:47:19,525 [1] DEBUG - Statement Id: [DAO00092_GetList_ToathuocNgoaitru] PreparedStatement : [select A.*, B.PHAMVI_ID, C.KHODUOC_ID from TM_TOATHUOC_NGOAITRU A        left join TM_DUOC_PHAMVISUDUNG B on B.MAPHAMVI = A.MAPHAMVI        left join (select distinct PHAMVI_ID, KHODUOC_ID from TM_DUOC_PHAMVISD_MAPPING) C on C.PHAMVI_ID = B.PHAMVI_ID        where A.TAMNGUNG != '1' and A.BENHVIEN_ID = 'HLU01'        ORDER BY A.SAPXEP ASC]
2020-01-02 17:47:19,574 [1] DEBUG - Statement Id: [DAO00012_GetLoaiTCLS] PreparedStatement : [select DICTIONARY_ID, DICTIONARY_CODE, DICTIONARY_NAME, cast('0' as Bit) CHON        from LST_DICTIONARY              where DICTIONARY_TYPE_CODE = 'KHAMBENH_LOAI_TRIEUCHUNGLS'        order by LST_DICTIONARY.IDX]
2020-01-02 17:47:19,675 [1] DEBUG - Statement Id: [DAO00012_GetAllTCLS] PreparedStatement : [select MALOAITRIEUCHUNG DICTIONARY_TYPE_CODE, MALOAITRIEUCHUNG DICTIONARY_CODE,        TENTRIEUCHUNG DICTIONARY_NAME from TM_TRIEUCHUNGLS]
2020-01-02 17:47:19,705 [1] DEBUG - Statement Id: [DAO00019_ThongTinBenhNhanDvYeuCau] PreparedStatement : [select distinct A.SOTIEPNHAN, A.TIEPNHAN_ID, A.DOITUONG_ID, A.TRANGTHAI,        A.LOAITHANHVIEN_ID, A.SUDUNG_BHTN, A.THE_ID, A.THANHVIEN_ID, A.VIP, A.NGUON_BENHNHAN_ID, A.BAOLANH_VIENPHI, A.NGAYMIENDONGCHITRA,        B.*,  C.DICHVU_ID, C.DVYEUCAU_ID, C.NOITHUCHIEN_ID, A.SOBHYT        from TT_TIEPNHAN A        inner join TT_DVYEUCAU C on C.TIEPNHAN_ID = A.TIEPNHAN_ID        inner join TT_BENHNHAN B on B.BENHNHAN_ID = A.BENHNHAN_ID and B.ACTIVE = '1'        where                    C.DVYEUCAU_ID = '206519'                 and A.BENHVIEN_ID = 'HLU01']
2020-01-02 17:47:19,804 [1] DEBUG - Statement Id: [DAO00017_GetLoaiGiaByDoiTuongId] PreparedStatement : [select dtlg.DOUUTIEN, dtlg.DOITUONG_ID, lg.LOAIGIA_ID, lg.TENLOAIGIA, lg.MALOAIGIA              from TM_LOAIGIA lg              left join TM_DOITUONG_LOAIGIA dtlg              on lg.LOAIGIA_ID = dtlg.LOAIGIA_ID and dtlg.BENHVIEN_ID = 'HLU01'              where lg.TAMNGUNG = 0 and lg.BENHVIEN_ID = 'HLU01'                             order by dtlg.DOUUTIEN]
2020-01-02 17:47:19,867 [1] DEBUG - Statement Id: [DAO00087_GetServiceParams] PreparedStatement : [select CODE, VALUE              from TM_SYS_APPSETTINGS              where LOCKED = '0' and BENHVIEN_ID = 'HLU01']
2020-01-02 17:47:19,974 [1] DEBUG - Statement Id: [DAO00014_KiemTraDVYCCoGiaBHYT] PreparedStatement : [select *        from TT_VIENPHI        where REF_ID  = '206519' and REF_TABLE = 'TT_DVYEUCAU' and BHYT_DONGIA > 0]
2020-01-02 17:47:20,020 [1] DEBUG - Statement Id: [DAO00040_LayListToaMau] PreparedStatement : [select A.*, dc.TENDUOCDAYDU, dc.BHYT DUOC_BHYT, ld.LOAIVATTU_ID, ld.MALOAIDUOC, dd.DICTIONARY_NAME DUONGDUNG, dc.TAMNGUNG            from TT_TOATHUOCMAU A            left join TM_DUOC dc on A.DUOC_ID = dc.DUOC_ID            left join TM_LOAIDUOC ld on dc.LOAIDUOC_ID = ld.LOAIDUOC_ID            left join (select * from LST_DICTIONARY where DICTIONARY_TYPE_CODE like 'DuongDung') dd on dd.DICTIONARY_ID = dc.DUONGDUNG_ID            where (1=1)             and               A.BACSI_ID  = 1              and A.LOAITOATHUOC in  (                        @param0                   ,                           @param1                   ,                           @param2                   ,                           @param3                   )]
2020-01-02 17:47:20,021 [1] DEBUG - Statement Id: [DAO00040_LayListToaMau] Parameters: [@param0=[LSTLOAITOATHUOC[0],BV], @param1=[LSTLOAITOATHUOC[1],MN], @param2=[LSTLOAITOATHUOC[2],MP], @param3=[LSTLOAITOATHUOC[3],TV]]
2020-01-02 17:47:20,022 [1] DEBUG - Statement Id: [DAO00040_LayListToaMau] Types: [@param0=[String, System.String], @param1=[String, System.String], @param2=[String, System.String], @param3=[String, System.String]]
2020-01-02 17:47:20,120 [1] DEBUG - Statement Id: [DAO00040_LayListToaMau] PreparedStatement : [select A.*, dc.TENDUOCDAYDU, dc.BHYT DUOC_BHYT, ld.LOAIVATTU_ID, ld.MALOAIDUOC, dd.DICTIONARY_NAME DUONGDUNG, dc.TAMNGUNG            from TT_TOATHUOCMAU A            left join TM_DUOC dc on A.DUOC_ID = dc.DUOC_ID            left join TM_LOAIDUOC ld on dc.LOAIDUOC_ID = ld.LOAIDUOC_ID            left join (select * from LST_DICTIONARY where DICTIONARY_TYPE_CODE like 'DuongDung') dd on dd.DICTIONARY_ID = dc.DUONGDUNG_ID            where (1=1)             and               A.BACSI_ID  = 1              and A.LOAITOATHUOC in  (                        @param0                   ,                           @param1                   ,                           @param2                   ,                           @param3                   )]
2020-01-02 17:47:20,120 [1] DEBUG - Statement Id: [DAO00040_LayListToaMau] Parameters: [@param0=[LSTLOAITOATHUOC[0],BV], @param1=[LSTLOAITOATHUOC[1],MN], @param2=[LSTLOAITOATHUOC[2],MP], @param3=[LSTLOAITOATHUOC[3],TV]]
2020-01-02 17:47:20,120 [1] DEBUG - Statement Id: [DAO00040_LayListToaMau] Types: [@param0=[String, System.String], @param1=[String, System.String], @param2=[String, System.String], @param3=[String, System.String]]
2020-01-02 17:47:20,166 [1] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoVaBookingCOM23UpdateRedis_TheoPhamvi] PreparedStatement : [declare @TOAMUANGOAI int = 0;        select @TOAMUANGOAI = isnull(VALUE,0) from TM_SYS_APPSETTINGS where CODE = 'OPD_TOAMUANGOAI_DUNGDANHMUC_DUOC'                if @TOAMUANGOAI = 1        begin        select  distinct '0' + '_' + LTRIM(d.DUOC_ID) + '_' + '0' as DUOC_KEY, 999999999 as SOLUONG        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        where  @param0  = 0        union all        select distinct tk.DUOC_KEY, tk.SOLUONG        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        inner join        (        select  LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')) DUOC_KEY, (SUM(dtk.SOLUONG) - isnull(sum(A.SOLUONG),0) - isnull(sum(B.SOLUONG),0)) SOLUONG, pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        from (select sum(soluong) soluong,duoc_id,nguonduoc_id,khoduoc_id,benhvien_id from TT_DUOC_TONKHO  group by duoc_id,nguonduoc_id,khoduoc_id,benhvien_id) dtk        inner join TM_DUOC_PHAMVISD_MAPPING pvsd on dtk.KHODUOC_ID = pvsd.KHODUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NOITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) B on B.DUOC_ID = dtk.DUOC_ID and B.PHAMVI_ID = pvsd.PHAMVI_ID and B.NGUONHANG_ID = dtk.NGUONDUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NGOAITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) A on A.DUOC_ID = dtk.DUOC_ID and A.PHAMVI_ID = pvsd.PHAMVI_ID and A.NGUONHANG_ID = dtk.NGUONDUOC_ID        where dtk.BENHVIEN_ID = 'HLU01'        group by LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')), pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        ) tk on tk.DUOC_ID = d.DUOC_ID        left join TM_DUOC_PHAMVISUDUNG kd on kd.PHAMVI_ID = tk.PHAMVI_ID and kd.BENHVIEN_ID = 'HLU01'        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = tk.NGUONDUOC_ID and nh.BENHVIEN_ID = 'HLU01'        where d.BENHVIEN_ID = 'HLU01' and tk.PHAMVI_ID =  @param0         end        else        begin        select distinct tk.DUOC_KEY, tk.SOLUONG        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        inner join        (        select  LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')) DUOC_KEY, (SUM(dtk.SOLUONG) - isnull(sum(A.SOLUONG),0) - isnull(sum(B.SOLUONG),0)) SOLUONG, pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        from (select sum(soluong) soluong,duoc_id,nguonduoc_id,khoduoc_id,benhvien_id from TT_DUOC_TONKHO  group by duoc_id,nguonduoc_id,khoduoc_id,benhvien_id) dtk        inner join TM_DUOC_PHAMVISD_MAPPING pvsd on dtk.KHODUOC_ID = pvsd.KHODUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NOITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) B on B.DUOC_ID = dtk.DUOC_ID and B.PHAMVI_ID = pvsd.PHAMVI_ID and B.NGUONHANG_ID = dtk.NGUONDUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NGOAITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) A on A.DUOC_ID = dtk.DUOC_ID and A.PHAMVI_ID = pvsd.PHAMVI_ID and A.NGUONHANG_ID = dtk.NGUONDUOC_ID        where dtk.BENHVIEN_ID = 'HLU01'        group by LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')), pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        ) tk on tk.DUOC_ID = d.DUOC_ID        left join TM_DUOC_PHAMVISUDUNG kd on kd.PHAMVI_ID = tk.PHAMVI_ID and kd.BENHVIEN_ID = 'HLU01'        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = tk.NGUONDUOC_ID and nh.BENHVIEN_ID = 'HLU01'        where d.BENHVIEN_ID = 'HLU01' and tk.PHAMVI_ID =  @param0         end]
2020-01-02 17:47:20,167 [1] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoVaBookingCOM23UpdateRedis_TheoPhamvi] Parameters: [@param0=[PHAMVI_ID,1028]]
2020-01-02 17:47:20,167 [1] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoVaBookingCOM23UpdateRedis_TheoPhamvi] Types: [@param0=[Int64, System.Int64]]
2020-01-02 17:47:20,382 [1] DEBUG - Statement Id: [DAO00013_GetTienSuBenh] PreparedStatement : [select TIENSUBENH, TIENSUDIUNG        from TT_BENHNHAN        where TT_BENHNHAN.BENHNHAN_ID  = '24441']
2020-01-02 17:47:20,489 [1] DEBUG - Statement Id: [DAO00095_GetTTDiUngThuoc] PreparedStatement : [select *              from TT_BENHNHAN_DIUNG_THUOC              where BENHNHAN_ID = '24441'              and BENHVIEN_ID = 'HLU01']
2020-01-02 17:47:20,514 [1] DEBUG - Statement Id: [DAO00014_GetTotalChiPhiDVByTiepNhan] PreparedStatement : [select sum(THANHTIEN_DOANHTHU) as THANHTIEN_DOANHTHU from TT_VIENPHI        where ACTIVE = '1'        and TIEPNHAN_ID = '28493'        and REF_TABLE = 'TT_DVYEUCAU'        and exists (select DVYEUCAU_ID from TT_DVYEUCAU where HUYYEUCAU = '0' and TIEPNHAN_ID = '28493' and TT_VIENPHI.REF_ID = DVYEUCAU_ID)]
2020-01-02 17:47:20,551 [1] DEBUG - Statement Id: [DAO00014_GetKhamBenhInfo] PreparedStatement : [select * from TT_NGOAITRU_KHAMBENH where KHAMBENH_ID =        (select KHAMBENH_NGOAITRU_ID from TT_DVYEUCAU where DVYEUCAU_ID = '206519')]
2020-01-02 17:47:20,946 [1] DEBUG - Statement Id: [DAO00068_GetSinhHieuBySinhHieuID] PreparedStatement : [select top (1) *            from TT_NGOAITRU_KHAMBENH_SINHHIEU            where KHAMBENH_SINHHIEU_ID = '0'            and BENHVIEN_ID = 'HLU01'             and               BENHNHAN_ID = '24441'                           order by KHAMBENH_SINHHIEU_ID]
2020-01-02 17:47:21,115 [1] DEBUG - Statement Id: [DAO00014_GetKhamBenhICDInfo] PreparedStatement : [select *        from TT_NGOAITRU_KHAMBENH_ICD        where KHAMBENH_ID  = '27176']
2020-01-02 17:47:21,145 [1] DEBUG - Statement Id: [DAO00014_GetListToaThuoc] PreparedStatement : [select A.*        from TT_NGOAITRU_KHAMBENH_TOATHUOC A        where A.KHAMBENH_ID = '27176']
2020-01-02 17:47:21,174 [1] DEBUG - Statement Id: [DAO00014_KiemTraDVYCCoGiaBHYT] PreparedStatement : [select *        from TT_VIENPHI        where REF_ID  = '206519' and REF_TABLE = 'TT_DVYEUCAU' and BHYT_DONGIA > 0]
2020-01-02 17:47:21,209 [1] DEBUG - Statement Id: [DAO00040_LayListToaMau] PreparedStatement : [select A.*, dc.TENDUOCDAYDU, dc.BHYT DUOC_BHYT, ld.LOAIVATTU_ID, ld.MALOAIDUOC, dd.DICTIONARY_NAME DUONGDUNG, dc.TAMNGUNG            from TT_TOATHUOCMAU A            left join TM_DUOC dc on A.DUOC_ID = dc.DUOC_ID            left join TM_LOAIDUOC ld on dc.LOAIDUOC_ID = ld.LOAIDUOC_ID            left join (select * from LST_DICTIONARY where DICTIONARY_TYPE_CODE like 'DuongDung') dd on dd.DICTIONARY_ID = dc.DUONGDUNG_ID            where (1=1)             and               A.BACSI_ID  = 1              and A.LOAITOATHUOC in  (                        @param0                   ,                           @param1                   ,                           @param2                   ,                           @param3                   )]
2020-01-02 17:47:21,209 [1] DEBUG - Statement Id: [DAO00040_LayListToaMau] Parameters: [@param0=[LSTLOAITOATHUOC[0],BV], @param1=[LSTLOAITOATHUOC[1],MN], @param2=[LSTLOAITOATHUOC[2],MP], @param3=[LSTLOAITOATHUOC[3],TV]]
2020-01-02 17:47:21,210 [1] DEBUG - Statement Id: [DAO00040_LayListToaMau] Types: [@param0=[String, System.String], @param1=[String, System.String], @param2=[String, System.String], @param3=[String, System.String]]
2020-01-02 17:47:21,288 [1] DEBUG - Statement Id: [DAO00040_LayListToaMau] PreparedStatement : [select A.*, dc.TENDUOCDAYDU, dc.BHYT DUOC_BHYT, ld.LOAIVATTU_ID, ld.MALOAIDUOC, dd.DICTIONARY_NAME DUONGDUNG, dc.TAMNGUNG            from TT_TOATHUOCMAU A            left join TM_DUOC dc on A.DUOC_ID = dc.DUOC_ID            left join TM_LOAIDUOC ld on dc.LOAIDUOC_ID = ld.LOAIDUOC_ID            left join (select * from LST_DICTIONARY where DICTIONARY_TYPE_CODE like 'DuongDung') dd on dd.DICTIONARY_ID = dc.DUONGDUNG_ID            where (1=1)             and               A.BACSI_ID  = 1              and A.LOAITOATHUOC in  (                        @param0                   ,                           @param1                   ,                           @param2                   ,                           @param3                   )]
2020-01-02 17:47:21,289 [1] DEBUG - Statement Id: [DAO00040_LayListToaMau] Parameters: [@param0=[LSTLOAITOATHUOC[0],BV], @param1=[LSTLOAITOATHUOC[1],MN], @param2=[LSTLOAITOATHUOC[2],MP], @param3=[LSTLOAITOATHUOC[3],TV]]
2020-01-02 17:47:21,289 [1] DEBUG - Statement Id: [DAO00040_LayListToaMau] Types: [@param0=[String, System.String], @param1=[String, System.String], @param2=[String, System.String], @param3=[String, System.String]]
2020-01-02 17:47:21,324 [1] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoVaBookingCOM23UpdateRedis_TheoPhamvi] PreparedStatement : [declare @TOAMUANGOAI int = 0;        select @TOAMUANGOAI = isnull(VALUE,0) from TM_SYS_APPSETTINGS where CODE = 'OPD_TOAMUANGOAI_DUNGDANHMUC_DUOC'                if @TOAMUANGOAI = 1        begin        select  distinct '0' + '_' + LTRIM(d.DUOC_ID) + '_' + '0' as DUOC_KEY, 999999999 as SOLUONG        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        where  @param0  = 0        union all        select distinct tk.DUOC_KEY, tk.SOLUONG        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        inner join        (        select  LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')) DUOC_KEY, (SUM(dtk.SOLUONG) - isnull(sum(A.SOLUONG),0) - isnull(sum(B.SOLUONG),0)) SOLUONG, pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        from (select sum(soluong) soluong,duoc_id,nguonduoc_id,khoduoc_id,benhvien_id from TT_DUOC_TONKHO  group by duoc_id,nguonduoc_id,khoduoc_id,benhvien_id) dtk        inner join TM_DUOC_PHAMVISD_MAPPING pvsd on dtk.KHODUOC_ID = pvsd.KHODUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NOITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) B on B.DUOC_ID = dtk.DUOC_ID and B.PHAMVI_ID = pvsd.PHAMVI_ID and B.NGUONHANG_ID = dtk.NGUONDUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NGOAITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) A on A.DUOC_ID = dtk.DUOC_ID and A.PHAMVI_ID = pvsd.PHAMVI_ID and A.NGUONHANG_ID = dtk.NGUONDUOC_ID        where dtk.BENHVIEN_ID = 'HLU01'        group by LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')), pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        ) tk on tk.DUOC_ID = d.DUOC_ID        left join TM_DUOC_PHAMVISUDUNG kd on kd.PHAMVI_ID = tk.PHAMVI_ID and kd.BENHVIEN_ID = 'HLU01'        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = tk.NGUONDUOC_ID and nh.BENHVIEN_ID = 'HLU01'        where d.BENHVIEN_ID = 'HLU01' and tk.PHAMVI_ID =  @param0         end        else        begin        select distinct tk.DUOC_KEY, tk.SOLUONG        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        inner join        (        select  LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')) DUOC_KEY, (SUM(dtk.SOLUONG) - isnull(sum(A.SOLUONG),0) - isnull(sum(B.SOLUONG),0)) SOLUONG, pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        from (select sum(soluong) soluong,duoc_id,nguonduoc_id,khoduoc_id,benhvien_id from TT_DUOC_TONKHO  group by duoc_id,nguonduoc_id,khoduoc_id,benhvien_id) dtk        inner join TM_DUOC_PHAMVISD_MAPPING pvsd on dtk.KHODUOC_ID = pvsd.KHODUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NOITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) B on B.DUOC_ID = dtk.DUOC_ID and B.PHAMVI_ID = pvsd.PHAMVI_ID and B.NGUONHANG_ID = dtk.NGUONDUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NGOAITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) A on A.DUOC_ID = dtk.DUOC_ID and A.PHAMVI_ID = pvsd.PHAMVI_ID and A.NGUONHANG_ID = dtk.NGUONDUOC_ID        where dtk.BENHVIEN_ID = 'HLU01'        group by LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')), pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        ) tk on tk.DUOC_ID = d.DUOC_ID        left join TM_DUOC_PHAMVISUDUNG kd on kd.PHAMVI_ID = tk.PHAMVI_ID and kd.BENHVIEN_ID = 'HLU01'        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = tk.NGUONDUOC_ID and nh.BENHVIEN_ID = 'HLU01'        where d.BENHVIEN_ID = 'HLU01' and tk.PHAMVI_ID =  @param0         end]
2020-01-02 17:47:21,324 [1] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoVaBookingCOM23UpdateRedis_TheoPhamvi] Parameters: [@param0=[PHAMVI_ID,1028]]
2020-01-02 17:47:21,324 [1] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoVaBookingCOM23UpdateRedis_TheoPhamvi] Types: [@param0=[Int64, System.Int64]]
2020-01-02 17:47:21,567 [1] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoVaBookingCOM23UpdateRedis_TheoPhamvi] PreparedStatement : [declare @TOAMUANGOAI int = 0;        select @TOAMUANGOAI = isnull(VALUE,0) from TM_SYS_APPSETTINGS where CODE = 'OPD_TOAMUANGOAI_DUNGDANHMUC_DUOC'                if @TOAMUANGOAI = 1        begin        select  distinct '0' + '_' + LTRIM(d.DUOC_ID) + '_' + '0' as DUOC_KEY, 999999999 as SOLUONG        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        where  @param0  = 0        union all        select distinct tk.DUOC_KEY, tk.SOLUONG        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        inner join        (        select  LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')) DUOC_KEY, (SUM(dtk.SOLUONG) - isnull(sum(A.SOLUONG),0) - isnull(sum(B.SOLUONG),0)) SOLUONG, pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        from (select sum(soluong) soluong,duoc_id,nguonduoc_id,khoduoc_id,benhvien_id from TT_DUOC_TONKHO  group by duoc_id,nguonduoc_id,khoduoc_id,benhvien_id) dtk        inner join TM_DUOC_PHAMVISD_MAPPING pvsd on dtk.KHODUOC_ID = pvsd.KHODUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NOITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) B on B.DUOC_ID = dtk.DUOC_ID and B.PHAMVI_ID = pvsd.PHAMVI_ID and B.NGUONHANG_ID = dtk.NGUONDUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NGOAITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) A on A.DUOC_ID = dtk.DUOC_ID and A.PHAMVI_ID = pvsd.PHAMVI_ID and A.NGUONHANG_ID = dtk.NGUONDUOC_ID        where dtk.BENHVIEN_ID = 'HLU01'        group by LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')), pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        ) tk on tk.DUOC_ID = d.DUOC_ID        left join TM_DUOC_PHAMVISUDUNG kd on kd.PHAMVI_ID = tk.PHAMVI_ID and kd.BENHVIEN_ID = 'HLU01'        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = tk.NGUONDUOC_ID and nh.BENHVIEN_ID = 'HLU01'        where d.BENHVIEN_ID = 'HLU01' and tk.PHAMVI_ID =  @param0         end        else        begin        select distinct tk.DUOC_KEY, tk.SOLUONG        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        inner join        (        select  LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')) DUOC_KEY, (SUM(dtk.SOLUONG) - isnull(sum(A.SOLUONG),0) - isnull(sum(B.SOLUONG),0)) SOLUONG, pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        from (select sum(soluong) soluong,duoc_id,nguonduoc_id,khoduoc_id,benhvien_id from TT_DUOC_TONKHO  group by duoc_id,nguonduoc_id,khoduoc_id,benhvien_id) dtk        inner join TM_DUOC_PHAMVISD_MAPPING pvsd on dtk.KHODUOC_ID = pvsd.KHODUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NOITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) B on B.DUOC_ID = dtk.DUOC_ID and B.PHAMVI_ID = pvsd.PHAMVI_ID and B.NGUONHANG_ID = dtk.NGUONDUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NGOAITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) A on A.DUOC_ID = dtk.DUOC_ID and A.PHAMVI_ID = pvsd.PHAMVI_ID and A.NGUONHANG_ID = dtk.NGUONDUOC_ID        where dtk.BENHVIEN_ID = 'HLU01'        group by LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')), pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        ) tk on tk.DUOC_ID = d.DUOC_ID        left join TM_DUOC_PHAMVISUDUNG kd on kd.PHAMVI_ID = tk.PHAMVI_ID and kd.BENHVIEN_ID = 'HLU01'        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = tk.NGUONDUOC_ID and nh.BENHVIEN_ID = 'HLU01'        where d.BENHVIEN_ID = 'HLU01' and tk.PHAMVI_ID =  @param0         end]
2020-01-02 17:47:21,567 [1] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoVaBookingCOM23UpdateRedis_TheoPhamvi] Parameters: [@param0=[PHAMVI_ID,1028]]
2020-01-02 17:47:21,567 [1] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoVaBookingCOM23UpdateRedis_TheoPhamvi] Types: [@param0=[Int64, System.Int64]]
2020-01-02 17:47:22,219 [1] DEBUG - Statement Id: [DAO00068_GetLastedSinhHieuInfo] PreparedStatement : [select top (1) *, CHISOBMI as BMI              from TT_NGOAITRU_KHAMBENH_SINHHIEU              where BENHNHAN_ID = '24441'              order by KHAMBENH_SINHHIEU_ID desc]
2020-01-02 17:47:24,886 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'COM16'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2020-01-02 17:47:25,741 [1] DEBUG - Statement Id: [DAO00067_GET_CHUYENVIENINFO_FROM_BENHNHANID] PreparedStatement : [select *        from TT_CHUYENVIEN        where BENHNHAN_ID  = '0' and BENHVIEN_ID = 'HLU01'        and TIEPNHAN_ID = '28493'         and           KHAMBENH_ID = '27176']
2020-01-02 17:47:25,771 [1] DEBUG - Statement Id: [DAO00014_GetChanDoan] PreparedStatement : [DECLARE @VAL1 NVARCHAR(1000) = ''        DECLARE @VAL2 NVARCHAR(1000) = ''        SELECT @VAL1 = (SELECT ICD.TENICD +'('+ICD.MAICD+'); '+ KB.CHANDOANKHOAKHAM FROM TT_NGOAITRU_KHAMBENH KB        INNER JOIN TM_ICD ICD ON ICD.ICD_ID = KB.CHANDOANICD_ID        WHERE KHAMBENH_ID =  @param0 )        SELECT @VAl2 = @VAL2 + ICD.TENICD +'('+ICD.MAICD +'); ' FROM        TT_NGOAITRU_KHAMBENH_ICD KBI        INNER JOIN TM_ICD ICD ON KBI.ICD_ID = ICD.ICD_ID        WHERE KBI.KHAMBENH_ID =  @param0         SELECT @VAL1 + '; '+ ISNULL(@VAL2,'')]
2020-01-02 17:47:25,772 [1] DEBUG - Statement Id: [DAO00014_GetChanDoan] Parameters: [@param0=[KHAMBENH_ID,27176]]
2020-01-02 17:47:25,772 [1] DEBUG - Statement Id: [DAO00014_GetChanDoan] Types: [@param0=[Int64, System.Int64]]
2020-01-02 17:47:25,806 [1] DEBUG - Statement Id: [DAO00016_GetDSThuocDaDungByTiepNhan] PreparedStatement : [select A.*, dc.TENDUOCDAYDU        from TT_NGOAITRU_TOATHUOC A        left join TM_DUOC dc on A.DUOC_ID = dc.DUOC_ID        where exists (select KHAMBENH_ID from TT_NGOAITRU_KHAMBENH where A.KHAMBENH_ID = KHAMBENH_ID and  TIEPNHAN_ID = '28493')        and exists (select KHAMBENH_TOATHUOC_ID from TT_NGOAITRU_KHAMBENH_TOATHUOC where A.KHAMBENH_TOATHUOC_ID = KHAMBENH_TOATHUOC_ID and CHUNGTUPHATTHUOC_ID is not null)        and A.BENHVIEN_ID = 'HLU01']
2020-01-02 17:47:25,836 [1] DEBUG - Statement Id: [DAO00067_GetDanhsachDichvuDungChoChuyentuyen] PreparedStatement : [select A.DICHVU_ID, B.TENDICHVU, A.DVYEUCAU_ID        from TT_DVYEUCAU A        left join TM_DICHVU B on A.DICHVU_ID = B.DICHVU_ID        left join TM_NHOMDICHVU C on C.NHOMDICHVU_ID = B.NHOMDICHVU_ID        where        ( @param0  IS NOT NULL OR  @param1  IS NOT NULL) AND        LEFT(C.MANHOMDICHVU,2) in ('01', '02', '05', '06') and A.HUYYEUCAU = '0'         and           A.TIEPNHAN_ID = '28493']
2020-01-02 17:47:25,836 [1] DEBUG - Statement Id: [DAO00067_GetDanhsachDichvuDungChoChuyentuyen] Parameters: [@param0=[BENHAN_ID,null], @param1=[TIEPNHAN_ID,28493]]
2020-01-02 17:47:25,836 [1] DEBUG - Statement Id: [DAO00067_GetDanhsachDichvuDungChoChuyentuyen] Types: [@param0=[System.DBNull, null], @param1=[Int64, System.Int64]]
2020-01-02 17:47:25,862 [1] DEBUG - Statement Id: [DAO00067_GetDanhsachxetnghiemkq] PreparedStatement : [select distinct C.CLSKETQUACHITIET_ID, B.TENDICHVU, C.KETQUA, C.DICHVU_ID, A.DVYEUCAU_ID        from TT_DVYEUCAU A        inner join TT_CLSKETQUACHITIET C on C.DVYEUCAU_ID = A.DVYEUCAU_ID        left join TM_DICHVU B on C.DICHVU_ID = B.DICHVU_ID        where A.HUYYEUCAU = '0' and A.BENHAN_ID is not null                 AND ( @param0  IS NOT NULL OR  @param1  IS NOT NULL)         and           A.TIEPNHAN_ID = '28493'                 order by C.CLSKETQUACHITIET_ID]
2020-01-02 17:47:25,862 [1] DEBUG - Statement Id: [DAO00067_GetDanhsachxetnghiemkq] Parameters: [@param0=[BENHAN_ID,null], @param1=[TIEPNHAN_ID,28493]]
2020-01-02 17:47:25,862 [1] DEBUG - Statement Id: [DAO00067_GetDanhsachxetnghiemkq] Types: [@param0=[System.DBNull, null], @param1=[Int64, System.Int64]]
2020-01-02 17:47:25,887 [1] DEBUG - Statement Id: [DAO00067_GetDanhsachsieuamkq] PreparedStatement : [select C.DVYEUCAU_ID, B.TENDICHVU,C.KETLUAN        from TT_DVYEUCAU A        inner join TT_CLSKETQUA C on C.DVYEUCAU_ID = A.DVYEUCAU_ID        left join TM_DICHVU B on C.DICHVU_ID = B.DICHVU_ID        where        ( @param0  IS NOT NULL OR  @param1  IS NOT NULL) AND                 A.DVYEUCAU_ID not in        (select DVYEUCAU_ID from TT_CLSKETQUACHITIET        where exists (        select DVYEUCAU_ID from TT_DVYEUCAU where TT_CLSKETQUACHITIET.DVYEUCAU_ID = DVYEUCAU_ID                 ))         and           A.TIEPNHAN_ID = 28493]
2020-01-02 17:47:25,892 [1] DEBUG - Statement Id: [DAO00067_GetDanhsachsieuamkq] Parameters: [@param0=[BENHAN_ID,null], @param1=[TIEPNHAN_ID,28493]]
2020-01-02 17:47:25,892 [1] DEBUG - Statement Id: [DAO00067_GetDanhsachsieuamkq] Types: [@param0=[System.DBNull, null], @param1=[Int64, System.Int64]]
--------------------------------------------------------------------------------
2020-01-02 17:48:32,583 [1] DEBUG - Statement Id: [DAO00001_DBList] PreparedStatement : [select *              from TM_SYS_SERVER              where HOSPITAL_ID = '_SYSTEM_' and TYPE = 'D']
2020-01-02 17:48:32,862 [1] DEBUG - Statement Id: [DAO00001_DaoList] PreparedStatement : [select              TM_SYS_SERVICEMAP.ID,              TM_SYS_SERVICEMAP.HOSPITAL_ID,              TM_SYS_SERVICEMAP.DB_NAME,              TM_SYS_SERVICEMAP.TYPE,              TM_SYS_SERVICEMAP.NAME,              TM_SYS_SERVICEMAP.CLASS,              (TM_SYS_DIC.VALUE + '.' + TM_SYS_SERVICEMAP.CLASS) as CLASSFULL,              TM_SYS_SERVICEMAP.ASSEMBLY              from TM_SYS_SERVICEMAP              inner join TM_SYS_DIC              on TM_SYS_SERVICEMAP.NAMESPACE = TM_SYS_DIC.ID              where HOSPITAL_ID = '_SYSTEM_' AND TYPE = 'D' AND ACTIVE = '1'              order by DB_NAME]
2020-01-02 17:48:32,899 [1] DEBUG - Statement Id: [DAO00001_ServiceList] PreparedStatement : [select              TM_SYS_SERVICEMAP.ID,              TM_SYS_SERVICEMAP.HOSPITAL_ID,              TM_SYS_SERVICEMAP.DB_NAME,              TM_SYS_SERVICEMAP.TYPE,              TM_SYS_SERVICEMAP.NAME,              TM_SYS_SERVICEMAP.CLASS,              (TM_SYS_DIC.VALUE + '.' + TM_SYS_SERVICEMAP.CLASS) as CLASSFULL,              TM_SYS_SERVICEMAP.ASSEMBLY,              TM_SYS_SERVER.URL              from TM_SYS_SERVICEMAP              inner join TM_SYS_DIC on TM_SYS_SERVICEMAP.NAMESPACE = TM_SYS_DIC.ID              inner join TM_SYS_SERVER on (TM_SYS_SERVICEMAP.DB_NAME = TM_SYS_SERVER.NAME) and (TM_SYS_SERVER.HOSPITAL_ID = '_SYSTEM_')              where TM_SYS_SERVICEMAP.HOSPITAL_ID = '_SYSTEM_' AND TM_SYS_SERVICEMAP.TYPE = 'S'  AND ACTIVE = '1'              order by URL]
2020-01-02 17:48:33,524 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = '_SYSTEM_'               AND                   TM_SYS_SCREEN.PAGE = 'LOGIN'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2020-01-02 17:48:33,954 [1] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = '_SYSTEM_'               AND                   TM_SYS_CACHE.ACTIVE = '1']
2020-01-02 17:48:40,220 [1] DEBUG - Statement Id: [DAO00001_DBList] PreparedStatement : [select *              from TM_SYS_SERVER              where HOSPITAL_ID = 'HLU01' and TYPE = 'D']
2020-01-02 17:48:40,248 [1] DEBUG - Statement Id: [DAO00001_DaoList] PreparedStatement : [select              TM_SYS_SERVICEMAP.ID,              TM_SYS_SERVICEMAP.HOSPITAL_ID,              TM_SYS_SERVICEMAP.DB_NAME,              TM_SYS_SERVICEMAP.TYPE,              TM_SYS_SERVICEMAP.NAME,              TM_SYS_SERVICEMAP.CLASS,              (TM_SYS_DIC.VALUE + '.' + TM_SYS_SERVICEMAP.CLASS) as CLASSFULL,              TM_SYS_SERVICEMAP.ASSEMBLY              from TM_SYS_SERVICEMAP              inner join TM_SYS_DIC              on TM_SYS_SERVICEMAP.NAMESPACE = TM_SYS_DIC.ID              where HOSPITAL_ID = 'HLU01' AND TYPE = 'D' AND ACTIVE = '1'              order by DB_NAME]
2020-01-02 17:48:41,852 [1] DEBUG - Statement Id: [DAO00001_ServiceList] PreparedStatement : [select              TM_SYS_SERVICEMAP.ID,              TM_SYS_SERVICEMAP.HOSPITAL_ID,              TM_SYS_SERVICEMAP.DB_NAME,              TM_SYS_SERVICEMAP.TYPE,              TM_SYS_SERVICEMAP.NAME,              TM_SYS_SERVICEMAP.CLASS,              (TM_SYS_DIC.VALUE + '.' + TM_SYS_SERVICEMAP.CLASS) as CLASSFULL,              TM_SYS_SERVICEMAP.ASSEMBLY,              TM_SYS_SERVER.URL              from TM_SYS_SERVICEMAP              inner join TM_SYS_DIC on TM_SYS_SERVICEMAP.NAMESPACE = TM_SYS_DIC.ID              inner join TM_SYS_SERVER on (TM_SYS_SERVICEMAP.DB_NAME = TM_SYS_SERVER.NAME) and (TM_SYS_SERVER.HOSPITAL_ID = 'HLU01')              where TM_SYS_SERVICEMAP.HOSPITAL_ID = 'HLU01' AND TM_SYS_SERVICEMAP.TYPE = 'S'  AND ACTIVE = '1'              order by URL]
2020-01-02 17:48:41,937 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1']
2020-01-02 17:48:42,758 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM005']
2020-01-02 17:48:42,930 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM015']
2020-01-02 17:48:43,012 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM067']
2020-01-02 17:48:43,086 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM008']
2020-01-02 17:48:43,165 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM068']
2020-01-02 17:48:43,232 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM006']
2020-01-02 17:48:43,301 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM030']
2020-01-02 17:48:43,373 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM025']
2020-01-02 17:48:43,451 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM024']
2020-01-02 17:48:43,949 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM033']
2020-01-02 17:48:43,984 [5] DEBUG - Statement Id: [DAO00027_GetListDuocKyGuiTonKho] PreparedStatement : [select  distinct TT_TONKHO.DUOC_KEY, LTRIM(TT_TONKHO.KHODUOC_ID) as KHODUOC_ID, TM_DUOC.DUOC_ID, TM_LOAIDUOC.MALOAIDUOC,TM_DUOC.SOVISA,TM_DUOC.TYLE_VAT,TM_DUOC.COTOA,        TM_DUOC.MADUOC, TM_DUOC.TENHANG, TM_DUOC.TENDUOCDAYDU, dvt.TENDONVITINH as DONVITINH,  TM_DUOC.DONVITINH_ID,TM_DUOC.BHYT,TM_DUOC.PHAMVI,        TM_DUOC.TENHOATCHAT, TM_DUOC.HAMLUONG, TM_DUOC.HANGSANXUAT, TM_DUOC.QUOCGIA, TM_DUOC.LOAIDUOC_ID, TM_DUOC.DUONGDUNG_ID,        TM_TENDUOC.TENDUOC, TM_TENDUOC.TENDUOC_EN, TM_TENDUOC.MAQUOCTE, TM_TENDUOC.MAQUOCTEBT,        TM_LOAIDUOC.LOAIVATTU_ID, TM_DUOC.BENHVIEN_ID,TT_TONKHO.SOLUONG, TT_TONKHO.NGUONDUOC_ID, NH.TENNGUONDUOC        , TAMNGUNG = CASE WHEN TM_DUOC.TAMNGUNG = '1' OR nh.TAMNGUNG = '1' OR KD.TAMNGUNG = '1' THEN '1' ELSE '0' END        , TM_DUOC.DANGTRINHBAY        from TM_DUOC        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = TM_DUOC.DONVITINH_ID        left join TM_TENDUOC on TM_DUOC.TENDUOC_ID = TM_TENDUOC.TENDUOC_ID and TM_DUOC.BENHVIEN_ID = 'HLU01' and TM_DUOC.TAMNGUNG = '0'        left join TM_LOAIDUOC on TM_LOAIDUOC.LOAIDUOC_ID = TM_DUOC.LOAIDUOC_ID and TM_LOAIDUOC.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG on (TM_LOAIDUOC.LOAIVATTU_ID = TM_DUOC_HANDUNG.LOAIDUOC and TM_DUOC_HANDUNG.BENHVIEN_ID = 'HLU01')        inner join        (select LTRIM(A.KHODUOC_ID) + '_' + LTRIM(A.DUOC_ID) + '_' + LTRIM(ISNULL(A.NGUONDUOC_ID,'')) as DUOC_KEY, A.KHODUOC_ID, A.DUOC_ID,A.NGUONDUOC_ID,        SUM(isnull(A.SOLUONG,0)) as SOLUONG        from        (select SUM(SOLUONG) as SOLUONG, KHODUOC_ID, DUOC_ID, NGUONDUOC_ID from TT_DUOC_KYGUI_TONKHO        where BENHVIEN_ID = 'HLU01' group by KHODUOC_ID, DUOC_ID, NGUONDUOC_ID) A        group by LTRIM(A.KHODUOC_ID) + '_' + LTRIM(A.DUOC_ID) + '_' + LTRIM(A.NGUONDUOC_ID), A.KHODUOC_ID, A.DUOC_ID, A.NGUONDUOC_ID)        TT_TONKHO on TT_TONKHO.DUOC_ID = TM_DUOC.DUOC_ID        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = TT_TONKHO.NGUONDUOC_ID and nh.BENHVIEN_ID = 'HLU01'        LEFT JOIN TM_KHODUOC KD ON KD.KHODUOC_ID = TT_TONKHO.KHODUOC_ID        where TM_DUOC.BENHVIEN_ID = 'HLU01' AND TT_TONKHO.SOLUONG >= 0]
2020-01-02 17:48:44,064 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM018']
2020-01-02 17:48:44,096 [5] DEBUG - Statement Id: [DAO00027_GetListDuocTonKho] PreparedStatement : [select distinct TT_TONKHO.DUOC_KEY, LTRIM(TT_TONKHO.KHODUOC_ID) as KHODUOC_ID, TM_DUOC.DUOC_ID, TM_LOAIDUOC.MALOAIDUOC,TM_DUOC.SOVISA,TM_DUOC.TYLE_VAT,TM_DUOC.COTOA,        TM_DUOC.MADUOC, TM_DUOC.TENHANG, TM_DUOC.TENDUOCDAYDU, dvt.TENDONVITINH as DONVITINH,  TM_DUOC.DONVITINH_ID,TM_DUOC.BHYT,                TM_DUOC.TENHOATCHAT,          TM_DUOC.HAMLUONG, TM_DUOC.HANGSANXUAT, TM_DUOC.QUOCGIA, TM_DUOC.LOAIDUOC_ID, TM_DUOC.DUONGDUNG_ID,        TM_TENDUOC.TENDUOC, TM_TENDUOC.TENDUOC_EN, TM_TENDUOC.MAQUOCTE, TM_TENDUOC.MAQUOCTEBT,        TM_LOAIDUOC.LOAIVATTU_ID, TM_DUOC.BENHVIEN_ID,        TT_TONKHO.SOLUONG, TM_DUOC.VTYT_PHANLOAI, TM_DUOC.PHAMVI, TT_TONKHO.NGUONDUOC_ID, NG.TENNGUONDUOC AS TENNGUONDUOC        , TAMNGUNG = CASE WHEN TM_DUOC.TAMNGUNG = '1' OR NG.TAMNGUNG = '1' OR KD.TAMNGUNG = '1' THEN '1' ELSE '0' END        , TM_DUOC.DANGTRINHBAY        from TM_DUOC        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = TM_DUOC.DONVITINH_ID        left join TM_TENDUOC on TM_DUOC.TENDUOC_ID = TM_TENDUOC.TENDUOC_ID and TM_DUOC.BENHVIEN_ID = 'HLU01' and TM_DUOC.TAMNGUNG = '0'        left join TM_LOAIDUOC on TM_LOAIDUOC.LOAIDUOC_ID = TM_DUOC.LOAIDUOC_ID and TM_LOAIDUOC.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG on (TM_LOAIDUOC.LOAIVATTU_ID = TM_DUOC_HANDUNG.LOAIDUOC and TM_DUOC_HANDUNG.BENHVIEN_ID = 'HLU01')        inner join        (select LTRIM(A.KHODUOC_ID) + '_' + LTRIM(A.DUOC_ID) + '_' + LTRIM(ISNULL(A.NGUONDUOC_ID,'')) as DUOC_KEY, A.KHODUOC_ID, A.DUOC_ID, A.NGUONDUOC_ID,        SUM(isnull(A.SOLUONG,0)) as SOLUONG        from        (select SUM(SOLUONG) as SOLUONG, KHODUOC_ID, DUOC_ID, NGUONDUOC_ID from TT_DUOC_TONKHO        where BENHVIEN_ID = 'HLU01' group by KHODUOC_ID, DUOC_ID, NGUONDUOC_ID) A        group by LTRIM(A.KHODUOC_ID) + '_' + LTRIM(A.DUOC_ID) + '_' + LTRIM(ISNULL(A.NGUONDUOC_ID,'')), A.KHODUOC_ID, A.DUOC_ID, NGUONDUOC_ID        ) TT_TONKHO on TT_TONKHO.DUOC_ID = TM_DUOC.DUOC_ID        LEFT JOIN TM_NGUONHANG NG ON NG.NGUONDUOC_ID = TT_TONKHO.NGUONDUOC_ID        LEFT JOIN TM_KHODUOC KD ON KD.KHODUOC_ID = TT_TONKHO.KHODUOC_ID        where TM_DUOC.BENHVIEN_ID = 'HLU01' and TT_TONKHO.SOLUONG >= 0]
2020-01-02 17:48:44,839 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM023']
2020-01-02 17:48:44,929 [5] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoVaBooking] PreparedStatement : [declare @NGUONDUOC_MACDINH varchar(5) = '0';        declare @TOAMUANGOAI int = 0;        select @NGUONDUOC_MACDINH = isnull(VALUE,0) from TM_SYS_APPSETTINGS where CODE = 'PHA_NGUONDUOC'        select @TOAMUANGOAI = isnull(VALUE,0) from TM_SYS_APPSETTINGS where CODE = 'OPD_TOAMUANGOAI_DUNGDANHMUC_DUOC'                if @TOAMUANGOAI = 1        begin        select  distinct '0' + '_' + LTRIM(d.DUOC_ID) + '_' + @NGUONDUOC_MACDINH as DUOC_KEY, 0 as PHAMVI_ID, @NGUONDUOC_MACDINH as NGUONDUOC_ID, null as TENNGUONDUOC, null as TINHTIEN, d.DUOC_ID, ld.MALOAIDUOC,        d.SOVISA,d.TYLE_VAT,d.COTOA, d.MADUOC, d.TENHANG, d.TENDUOCDAYDU, d.DONVITINH as DONVITINH, d.BHYT,        d.TENHOATCHAT, d.HAMLUONG, d.HANGSANXUAT, d.QUOCGIA, d.LOAIDUOC_ID, d.DUONGDUNG_ID, d.TINHTIEN_PTTT,        ten.TENDUOC, ten.TENDUOC_EN, ten.MAQUOCTE, ten.MAQUOCTEBT,d.CONGDUNG,        '' as BHYT_TEXT        , ld.LOAIVATTU_ID        , d.BENHVIEN_ID,        999999999 as SOLUONG, d.VTYT_PHANLOAI, d.PHAMVI, d.SUASOLUONGTONGHOP, d.MADUOCBV, d.DANGTRINHBAY        , TAMNGUNG = CASE WHEN d.TAMNGUNG = '1' THEN '1' ELSE '0' END        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        union all        select  distinct tk.DUOC_KEY, LTRIM(tk.PHAMVI_ID) as PHAMVI_ID, tk.NGUONDUOC_ID, nh.TENNGUONDUOC, nh.TINHTIEN, d.DUOC_ID, ld.MALOAIDUOC,        d.SOVISA,d.TYLE_VAT,d.COTOA, d.MADUOC, d.TENHANG, d.TENDUOCDAYDU, d.DONVITINH as DONVITINH, d.BHYT,        d.TENHOATCHAT, d.HAMLUONG, d.HANGSANXUAT, d.QUOCGIA, d.LOAIDUOC_ID, d.DUONGDUNG_ID, d.TINHTIEN_PTTT,        ten.TENDUOC, ten.TENDUOC_EN, ten.MAQUOCTE, ten.MAQUOCTEBT,d.CONGDUNG,        CASE WHEN d.BHYT = '1' THEN 'BHYT' ELSE '' END as BHYT_TEXT        , ld.LOAIVATTU_ID        , d.BENHVIEN_ID,        tk.SOLUONG, d.VTYT_PHANLOAI, d.PHAMVI, d.SUASOLUONGTONGHOP, d.MADUOCBV, d.DANGTRINHBAY        , TAMNGUNG = CASE WHEN d.TAMNGUNG = '1' OR nh.TAMNGUNG = '1' OR kd.TAMNGUNG = '1' THEN '1' ELSE '0' END        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        inner join        (        select  LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')) DUOC_KEY, (SUM(dtk.SOLUONG) - isnull(sum(A.SOLUONG),0) - isnull(sum(B.SOLUONG),0)) SOLUONG, pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        from (select sum(soluong) soluong,duoc_id,nguonduoc_id,khoduoc_id,benhvien_id from TT_DUOC_TONKHO  group by duoc_id,nguonduoc_id,khoduoc_id,benhvien_id) dtk        inner join TM_DUOC_PHAMVISD_MAPPING pvsd on dtk.KHODUOC_ID = pvsd.KHODUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NOITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) B on B.DUOC_ID = dtk.DUOC_ID and B.SOLUONG > 0 and B.PHAMVI_ID = pvsd.PHAMVI_ID and B.NGUONHANG_ID = dtk.NGUONDUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NGOAITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) A on A.DUOC_ID = dtk.DUOC_ID and A.SOLUONG > 0 and A.PHAMVI_ID = pvsd.PHAMVI_ID and A.NGUONHANG_ID = dtk.NGUONDUOC_ID        where dtk.SOLUONG > 0 and dtk.BENHVIEN_ID = 'HLU01'        group by LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')), pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        ) tk on tk.DUOC_ID = d.DUOC_ID        left join TM_DUOC_PHAMVISUDUNG kd on kd.PHAMVI_ID = tk.PHAMVI_ID and kd.BENHVIEN_ID = 'HLU01'        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = tk.NGUONDUOC_ID and nh.BENHVIEN_ID = 'HLU01'        where d.BENHVIEN_ID = 'HLU01'  and tk.SOLUONG >= 0        end        else        begin                  select  distinct tk.DUOC_KEY, LTRIM(tk.PHAMVI_ID) as PHAMVI_ID, tk.NGUONDUOC_ID, nh.TENNGUONDUOC, nh.TINHTIEN, d.DUOC_ID, ld.MALOAIDUOC,        d.SOVISA,d.TYLE_VAT,d.COTOA, d.MADUOC, d.TENHANG, d.TENDUOCDAYDU, d.DONVITINH as DONVITINH, d.BHYT,        d.TENHOATCHAT, d.HAMLUONG, d.HANGSANXUAT, d.QUOCGIA, d.LOAIDUOC_ID, d.DUONGDUNG_ID, d.TINHTIEN_PTTT,        ten.TENDUOC, ten.TENDUOC_EN, ten.MAQUOCTE, ten.MAQUOCTEBT,d.CONGDUNG,        CASE WHEN d.BHYT = '1' THEN 'BHYT' ELSE '' END as BHYT_TEXT        , ld.LOAIVATTU_ID        , d.BENHVIEN_ID,        tk.SOLUONG, d.VTYT_PHANLOAI, d.PHAMVI, d.SUASOLUONGTONGHOP, d.MADUOCBV, d.DANGTRINHBAY        , TAMNGUNG = CASE WHEN d.TAMNGUNG = '1' OR nh.TAMNGUNG = '1' OR kd.TAMNGUNG = '1' THEN '1' ELSE '0' END        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        inner join        (        select  LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')) DUOC_KEY, (SUM(dtk.SOLUONG) - isnull(sum(A.SOLUONG),0) - isnull(sum(B.SOLUONG),0)) SOLUONG, pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        from (select sum(soluong) soluong,duoc_id,nguonduoc_id,khoduoc_id,benhvien_id from TT_DUOC_TONKHO  group by duoc_id,nguonduoc_id,khoduoc_id,benhvien_id) dtk        inner join TM_DUOC_PHAMVISD_MAPPING pvsd on dtk.KHODUOC_ID = pvsd.KHODUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NOITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) B on B.DUOC_ID = dtk.DUOC_ID and B.SOLUONG > 0 and B.PHAMVI_ID = pvsd.PHAMVI_ID and B.NGUONHANG_ID = dtk.NGUONDUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NGOAITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) A on A.DUOC_ID = dtk.DUOC_ID and A.SOLUONG > 0 and A.PHAMVI_ID = pvsd.PHAMVI_ID and A.NGUONHANG_ID = dtk.NGUONDUOC_ID        where dtk.SOLUONG > 0 and dtk.BENHVIEN_ID = 'HLU01'        group by LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')), pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        ) tk on tk.DUOC_ID = d.DUOC_ID        left join TM_DUOC_PHAMVISUDUNG kd on kd.PHAMVI_ID = tk.PHAMVI_ID and kd.BENHVIEN_ID = 'HLU01'        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = tk.NGUONDUOC_ID and nh.BENHVIEN_ID = 'HLU01'        where d.BENHVIEN_ID = 'HLU01'  and tk.SOLUONG >= 0        end]
2020-01-02 17:48:47,496 [5] DEBUG - Statement Id: [DAO00320_GetList] PreparedStatement : [select M.*            from TM_MAU M            LEFT JOIN TM_MAU_DONVITINH DVT on M.DONVITINH_ID=DVT.DONVITINH_ID            where            M.TAMNGUNG = '0'            and M.BENHVIEN_ID = 'HLU01'            order by M.TENMAU]
2020-01-02 17:48:47,562 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM071']
2020-01-02 17:48:47,593 [5] DEBUG - Statement Id: [DAO00322_GetListMauTonKhoForCreateCached] PreparedStatement : [SELECT DISTINCT        TK.MAU_KEY, TK.KHOMAU_ID, M.MAU_ID, M.MAMAU, M.TENMAU, M.NHOM_ABO, M.NHOM_RH, M.LOAIMAU_ID,        TK.SOLONHAP_ID, SLN.SOLONHAP, SLN.SOKIEMSOAT, TK.NGUONHANG_ID, NG.TENNGUONMAU, M.BENHVIEN_ID, M.DONVITINH_ID,        SUM(tk.SOLUONG) AS SOLUONG,K.TENKHO,DVT.TENDONVITINH        FROM TT_MAU_TONKHO TK        JOIN TM_KHO K ON TK.KHOMAU_ID = K.KHO_ID        JOIN TT_MAU_CHUNGTU_SOLONHAP SLN ON TK.SOLONHAP_ID = SLN.SOLONHAP_ID        JOIN TM_MAU M on TK.MAU_ID = M.MAU_ID and M.TAMNGUNG = '0'        LEFT JOIN TM_MAU_DONVITINH DVT on M.DONVITINH_ID=DVT.DONVITINH_ID        LEFT JOIN TM_NGUONMAU NG ON NG.NGUONMAU_ID = TK.NGUONHANG_ID        WHERE TK.SOLUONG > 0        GROUP BY TK.MAU_KEY, TK.KHOMAU_ID, M.MAU_ID, M.MAMAU, M.TENMAU, M.NHOM_ABO, M.NHOM_RH, M.LOAIMAU_ID,        TK.SOLONHAP_ID, SLN.SOLONHAP, SLN.SOKIEMSOAT,TK.NGUONHANG_ID, NG.TENNGUONMAU, M.BENHVIEN_ID, M.DONVITINH_ID,K.TENKHO,DVT.TENDONVITINH]
2020-01-02 17:48:47,670 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM073']
2020-01-02 17:48:47,703 [5] DEBUG - Statement Id: [DAO00322_GetListMauTonKhoTruBooking] PreparedStatement : [select distinct        TK.MAU_KEY, TK.KHOMAU_ID, M.MAU_ID, M.MAMAU, M.TENMAU, M.NHOM_ABO, M.NHOM_RH, M.LOAIMAU_ID, M.DONVITINH_ID,        TK.SOLONHAP_ID, TK.SOLONHAP, TK.SOKIEMSOAT,M.PHAMVI, TK.NGUONHANG_ID, NG.TENNGUONMAU, M.BENHVIEN_ID,        TK.SOLUONG,TK.TENKHO,DVT.TENDONVITINH        from TM_MAU M        JOIN        (        select        A.MAU_KEY, A.KHOMAU_ID, A.MAU_ID ,a.NGUONHANG_ID, A.SOLONHAP_ID, A.SOLONHAP, A.SOKIEMSOAT, A.SOLUONG,A.TENKHO        from        (        select KHOMAU_ID, TK.MAU_ID, TK.NGUONHANG_ID, TK.MAU_KEY, SLN.SOLONHAP_ID, SLN.SOLONHAP, SLN.SOKIEMSOAT, ISNULL(TK.SOLUONG,0) - ISNULL(book.SOLUONG,0) as SOLUONG,K.TENKHO        from TT_MAU_TONKHO TK        JOIN TM_KHO K ON TK.KHOMAU_ID = K.KHO_ID        inner join TT_MAU_CHUNGTU_SOLONHAP SLN ON TK.SOLONHAP_ID = SLN.SOLONHAP_ID        left join dbo.TT_MAU_TONKHO_BOOK book ON book.MAU_KEY = TK.MAU_KEY AND book.TRANGTHAI = 'HIEULUC'        where ISNULL(TK.SOLUONG,0) - ISNULL(book.SOLUONG,0) > 0        ) A        )TK on TK.MAU_ID = M.MAU_ID and M.TAMNGUNG = '0'        LEFT JOIN TM_MAU_DONVITINH DVT on M.DONVITINH_ID=DVT.DONVITINH_ID        LEFT JOIN TM_NGUONMAU NG ON NG.NGUONMAU_ID = TK.NGUONHANG_ID]
2020-01-02 17:48:47,766 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM072']
2020-01-02 17:48:48,680 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'MAIN'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2020-01-02 17:48:49,484 [1] DEBUG - Statement Id: [DAO00002_FormList] PreparedStatement : [select              TM_SYS_FORM.HOSPITAL_ID,              TM_SYS_FORM.NAME,              TM_SYS_FORM.CLASS,              TM_SYS_FORM.ASSEMBLY,              TM_SYS_FORM.TITLE_VI as TITLE              from TM_SYS_FORM              where HOSPITAL_ID = 'HLU01']
2020-01-02 17:48:54,594 [1] DEBUG - Statement Id: [DAO00300_GetShortcutListByUserID] PreparedStatement : [SELECT S.SHORTCUT_CODE, S.SHORTCUT_VALUE              FROM TM_SHORTCUT AS S              WHERE S.BENHVIEN_ID = 'HLU01' AND S.USER_ID = '1' AND TAMNGUNG = '0']
2020-01-02 17:48:54,627 [1] DEBUG - Statement Id: [DAO00087_GetList] PreparedStatement : [select CODE, VALUE, BENHVIEN_ID              from TM_SYS_APPSETTINGS              where LOCKED = '0' and BENHVIEN_ID = 'HLU01'              order by SETTING_ID]
2020-01-02 17:48:54,717 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'MSG01'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2020-01-02 17:48:54,851 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'MSG02'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2020-01-02 17:48:55,014 [1] DEBUG - Statement Id: [DAO00008_GetUserSettings] PreparedStatement : [select A.*, B.TENKHO , C.TENPHONGBAN, B.MAKHO, C.MAPHONGBAN          from TM_SYS_USERS A          left join TM_KHODUOC B on B.KHODUOC_ID = A.INVENTORY_ID          left join TM_PHONGBAN C on (C.PHONGBAN_ID = A.WORKING_DEPT_ID and C.BENHVIEN_ID =  @param0 )          left join TM_SYS_USERKHO D on (D.ACCOUNT_ID = A.ACCOUNT_ID and D.HOSPITAL_ID =  @param0 )          where          A.HOSPITAL_ID =  @param0            and                 A.ACCOUNT_ID =  @param1]
2020-01-02 17:48:55,016 [1] DEBUG - Statement Id: [DAO00008_GetUserSettings] Parameters: [@param0=[HOSPITAL_ID,HLU01], @param1=[ACCOUNT_ID,113]]
2020-01-02 17:48:55,016 [1] DEBUG - Statement Id: [DAO00008_GetUserSettings] Types: [@param0=[String, System.String], @param1=[String, System.String]]
2020-01-02 17:48:55,045 [1] DEBUG - Statement Id: [DAO00008_GetUserInvSettings] PreparedStatement : [select A.*, B.TENKHO, B.MAKHO, B.LOAIKHO_ID, B.KHOQUANLY_ID          from TM_SYS_USERKHO A          left join TM_KHO B on B.MODULE_ID = A.MODULE_ID and B.KHO_ID = A.KHO_ID          where A.HOSPITAL_ID =  @param0  and A.ACCOUNT_ID =  @param1           order by B.TENKHO]
2020-01-02 17:48:55,046 [1] DEBUG - Statement Id: [DAO00008_GetUserInvSettings] Parameters: [@param0=[HOSPITAL_ID,HLU01], @param1=[ACCOUNT_ID,113]]
2020-01-02 17:48:55,046 [1] DEBUG - Statement Id: [DAO00008_GetUserInvSettings] Types: [@param0=[String, System.String], @param1=[String, System.String]]
2020-01-02 17:48:55,177 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'COM30'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2020-01-02 17:48:55,400 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'RIS04'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2020-01-02 17:49:09,263 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'MENU1'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2020-01-02 17:49:09,361 [1] DEBUG - Statement Id: [DAO00011_GetList] PreparedStatement : [select              TM_SYS_MENU.ID,              TM_SYS_MENU.PARENTID,              TM_SYS_MENU.SCREEN,              TM_SYS_MENU.SMALLIMAGE,              TM_SYS_MENU.LARGEIMAGE,              TM_SYS_MENU.DESCRIPTION,              TM_SYS_MENU.TYPE,              TM_SYS_MENU.TITLE_VI as TITLE              from TM_SYS_MENU              where TM_SYS_MENU.HOSPITAL_ID = 'HLU01' and TM_SYS_MENU.ACTIVE = '1'               AND                   (TM_SYS_MENU.TYPE & '8' = '8')                             order by TM_SYS_MENU.ORDERNUM]
2020-01-02 17:49:09,632 [1] DEBUG - Statement Id: [DAO00011_usermenu_list] PreparedStatement : [select              TM_SYS_HOMEMENU.MENUID as ID,              TM_SYS_MENU.TITLE_VI as TITLE,              TM_SYS_MENU.SCREEN,              TM_SYS_MENU.SMALLIMAGE,              TM_SYS_MENU.LARGEIMAGE,              TM_SYS_MENU.TYPE              from TM_SYS_HOMEMENU              left join TM_SYS_MENU on TM_SYS_MENU.ID = TM_SYS_HOMEMENU.MENUID and TM_SYS_MENU.HOSPITAL_ID = TM_SYS_HOMEMENU.HOSPITAL_ID              where TM_SYS_HOMEMENU.HOSPITAL_ID = 'HLU01' and TM_SYS_HOMEMENU.USERID = '113' and TM_SYS_MENU.ACTIVE = '1'               AND                   (TM_SYS_MENU.TYPE & '8' = '8')                             ORDER BY TM_SYS_HOMEMENU.ORDERNUM]
2020-01-02 17:49:13,102 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'OPD22'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2020-01-02 17:49:14,497 [1] DEBUG - Statement Id: [DAO00019_GetDanhsachKhambenh] PreparedStatement : [select *        from        (SELECT COUNT(*) OVER() as TOTALROWS, ROW_NUMBER() OVER(order by isnull(dv.SOTHUTU,'999999999'), dv.NGAYGIOYEUCAU) as ROWNUMBER,        bn.MAYTE, bn.TENBENHNHAN, bn.NAMSINH, bn.NGAYSINH as TUOI, ISNULL(CONVERT(VARCHAR(10), bn.NGAYSINH, 103),CAST(bn.NAMSINH AS varchar)) as NGAYSINH, bn.DIACHILIENLAC as DIACHI, bn.GIOITINH, GD.DESCRIPTION as TENGIOITINH,        tn.DOITUONG_ID, tn.THOIGIANTIEPNHAN, tn.BENHNHAN_ID, tn.TIEPNHAN_ID, tn.TRAITUYEN, tn.SOTIEPNHAN,        dv.DICHVU_ID, dv.NOITHUCHIEN_ID, isnull(dv.NGAYTAO, dv.NGAYCAPNHAT) as THOIGIANDKDICHVU,        dv.KHAN, dv.NOIYEUCAU_ID, dv.NGAYGIOYEUCAU, dv.BACSICHIDINH_ID, dv.DONVIGIOITHIEU_ID, dv.NGUOIGIOITHIEU_ID,        tn.NOIGIOITHIEU_ID, kbnt.HUONGGIAIQUYET_ID,        dv.DVYEUCAU_ID, dv.MARIS, dv.TRANGTHAI as TRANGTHAICODE, B.TENNHOMDICHVU, dv.SOPHIEUYEUCAU, dv.KHAMBENH_NGOAITRU_ID, dv.NGUOICAPNHAT_ID, dv.NGAYCAPNHAT,        CASE WHEN Left(B.MANHOMDICHVU,2) = '03' THEN '02' ELSE Left(B.MANHOMDICHVU,2) END AS MANHOMDICHVU, B.MANHOMDICHVU as MANHOMDICHVUCHITIET, tn.TRANGTHAI as TRANGTHAI_TIEPNHAN,        'False' as DAKHAM, isnull(dv.SOTHUTU,'999999999') as SOHANGDOI,        vp.DATHANHTOAN, dv.TRANGTHAI_WFL,        BA.SOBENHAN, dv.CHANDOAN, dt.TENDOITUONG, isnull(kbnt.THOIGIANKHAM, dv.NGAYCAPNHAT) as THOIGIANKHAM,        tn.SOBHYT        FROM TT_DVYEUCAU (NOLOCK) dv        inner join TT_TIEPNHAN (NOLOCK) tn on dv.TIEPNHAN_ID = tn.TIEPNHAN_ID        inner join TT_BENHNHAN (NOLOCK) bn on tn.BENHNHAN_ID = bn.BENHNHAN_ID        inner join TM_DICHVU A on A.DICHVU_ID = dv.DICHVU_ID        inner join TM_NHOMDICHVU B on B.NHOMDICHVU_ID = A.NHOMDICHVU_ID        inner join TT_VIENPHI(NOLOCK) VP on VP.TIEPNHAN_ID = tn.TIEPNHAN_ID and VP.DICHVU_ID = dv.DICHVU_ID and VP.REF_ID = dv.DVYEUCAU_ID        left join TT_NOITRU_BENHAN (NOLOCK) BA on BA.TIEPNHAN_ID = tn.TIEPNHAN_ID AND dv.BENHAN_ID = BA.BENHAN_ID        inner join TM_GENDER GD on GD.ID = bn.GIOITINH        left join TT_NGOAITRU_KHAMBENH (NOLOCK) kbnt on kbnt.KHAMBENH_ID = dv.KHAMBENH_NGOAITRU_ID        inner join TM_DOITUONG dt on dt.DOITUONG_ID = tn.DOITUONG_ID        where        dv.DICHVU_ID IS NOT NULL        and tn.BENHVIEN_ID = 'HLU01'        and HUYYEUCAU = 0        and dv.NGAYHENCLS is NULL         and           dv.NGAYYEUCAU >= '1/2/2020 12:00:00 AM'         and           dv.NGAYYEUCAU <= '1/2/2020 12:00:00 AM'         and           dv.NOITHUCHIEN_ID = 62          AND             (                         ((dv.TRANGTHAI_WFL = 'CHUAKETQUA' or (dv.TRANGTHAI = 'CHUAKETQUA' and dv.TRANGTHAI_WFL = 'HOANTHANH')) and (isnull(kbnt.HUONGGIAIQUYET_ID, 0) = 0)))            and (tn.TRANGTHAI != 'HOANTHANH')           and           (CASE WHEN Left(B.MANHOMDICHVU,2) = '03' THEN '02' ELSE Left(B.MANHOMDICHVU,2) END) = '04'                 ) lst                    where          lst.ROWNUMBER between 1 and 5                 order by SOHANGDOI, NGAYGIOYEUCAU asc]
2020-01-02 17:49:15,997 [1] DEBUG - Statement Id: [DAO00019_GetDanhsachKhambenh] PreparedStatement : [select *        from        (SELECT COUNT(*) OVER() as TOTALROWS, ROW_NUMBER() OVER(order by isnull(dv.SOTHUTU,'999999999'), dv.NGAYGIOYEUCAU) as ROWNUMBER,        bn.MAYTE, bn.TENBENHNHAN, bn.NAMSINH, bn.NGAYSINH as TUOI, ISNULL(CONVERT(VARCHAR(10), bn.NGAYSINH, 103),CAST(bn.NAMSINH AS varchar)) as NGAYSINH, bn.DIACHILIENLAC as DIACHI, bn.GIOITINH, GD.DESCRIPTION as TENGIOITINH,        tn.DOITUONG_ID, tn.THOIGIANTIEPNHAN, tn.BENHNHAN_ID, tn.TIEPNHAN_ID, tn.TRAITUYEN, tn.SOTIEPNHAN,        dv.DICHVU_ID, dv.NOITHUCHIEN_ID, isnull(dv.NGAYTAO, dv.NGAYCAPNHAT) as THOIGIANDKDICHVU,        dv.KHAN, dv.NOIYEUCAU_ID, dv.NGAYGIOYEUCAU, dv.BACSICHIDINH_ID, dv.DONVIGIOITHIEU_ID, dv.NGUOIGIOITHIEU_ID,        tn.NOIGIOITHIEU_ID, kbnt.HUONGGIAIQUYET_ID,        dv.DVYEUCAU_ID, dv.MARIS, dv.TRANGTHAI as TRANGTHAICODE, B.TENNHOMDICHVU, dv.SOPHIEUYEUCAU, dv.KHAMBENH_NGOAITRU_ID, dv.NGUOICAPNHAT_ID, dv.NGAYCAPNHAT,        CASE WHEN Left(B.MANHOMDICHVU,2) = '03' THEN '02' ELSE Left(B.MANHOMDICHVU,2) END AS MANHOMDICHVU, B.MANHOMDICHVU as MANHOMDICHVUCHITIET, tn.TRANGTHAI as TRANGTHAI_TIEPNHAN,        'True' as DAKHAM, isnull(dv.SOTHUTU,'999999999') as SOHANGDOI,        vp.DATHANHTOAN, dv.TRANGTHAI_WFL,        BA.SOBENHAN, dv.CHANDOAN, dt.TENDOITUONG, isnull(kbnt.THOIGIANKHAM, dv.NGAYCAPNHAT) as THOIGIANKHAM,        tn.SOBHYT        FROM TT_DVYEUCAU (NOLOCK) dv        inner join TT_TIEPNHAN (NOLOCK) tn on dv.TIEPNHAN_ID = tn.TIEPNHAN_ID        inner join TT_BENHNHAN (NOLOCK) bn on tn.BENHNHAN_ID = bn.BENHNHAN_ID        inner join TM_DICHVU A on A.DICHVU_ID = dv.DICHVU_ID        inner join TM_NHOMDICHVU B on B.NHOMDICHVU_ID = A.NHOMDICHVU_ID        inner join TT_VIENPHI(NOLOCK) VP on VP.TIEPNHAN_ID = tn.TIEPNHAN_ID and VP.DICHVU_ID = dv.DICHVU_ID and VP.REF_ID = dv.DVYEUCAU_ID        left join TT_NOITRU_BENHAN (NOLOCK) BA on BA.TIEPNHAN_ID = tn.TIEPNHAN_ID AND dv.BENHAN_ID = BA.BENHAN_ID        inner join TM_GENDER GD on GD.ID = bn.GIOITINH        left join TT_NGOAITRU_KHAMBENH (NOLOCK) kbnt on kbnt.KHAMBENH_ID = dv.KHAMBENH_NGOAITRU_ID        inner join TM_DOITUONG dt on dt.DOITUONG_ID = tn.DOITUONG_ID        where        dv.DICHVU_ID IS NOT NULL        and tn.BENHVIEN_ID = 'HLU01'        and HUYYEUCAU = 0        and dv.NGAYHENCLS is NULL         and           dv.NGAYYEUCAU >= '1/2/2020 12:00:00 AM'         and           dv.NGAYYEUCAU <= '1/2/2020 12:00:00 AM'         and           dv.NOITHUCHIEN_ID = 62          AND             (dv.TRANGTHAI != 'CHUAKETQUA' or isnull(kbnt.HUONGGIAIQUYET_ID, 0) > 0)           and           (CASE WHEN Left(B.MANHOMDICHVU,2) = '03' THEN '02' ELSE Left(B.MANHOMDICHVU,2) END) = '04'                 ) lst                    where          lst.ROWNUMBER between 1 and 5                 order by SOHANGDOI, NGAYGIOYEUCAU asc]
2020-01-02 17:49:18,821 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'OPD02'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2020-01-02 17:49:19,919 [1] DEBUG - Statement Id: [DAO00017_GetLoaiGiaByDoiTuongId] PreparedStatement : [select dtlg.DOUUTIEN, dtlg.DOITUONG_ID, lg.LOAIGIA_ID, lg.TENLOAIGIA, lg.MALOAIGIA              from TM_LOAIGIA lg              left join TM_DOITUONG_LOAIGIA dtlg              on lg.LOAIGIA_ID = dtlg.LOAIGIA_ID and dtlg.BENHVIEN_ID = 'HLU01'              where lg.TAMNGUNG = 0 and lg.BENHVIEN_ID = 'HLU01'                             order by dtlg.DOUUTIEN]
2020-01-02 17:49:20,123 [1] DEBUG - Statement Id: [DAO00092_GetList_ToathuocNgoaitru] PreparedStatement : [select A.*, B.PHAMVI_ID, C.KHODUOC_ID from TM_TOATHUOC_NGOAITRU A        left join TM_DUOC_PHAMVISUDUNG B on B.MAPHAMVI = A.MAPHAMVI        left join (select distinct PHAMVI_ID, KHODUOC_ID from TM_DUOC_PHAMVISD_MAPPING) C on C.PHAMVI_ID = B.PHAMVI_ID        where A.TAMNGUNG != '1' and A.BENHVIEN_ID = 'HLU01'        ORDER BY A.SAPXEP ASC]
2020-01-02 17:49:20,179 [1] DEBUG - Statement Id: [DAO00012_GetLoaiTCLS] PreparedStatement : [select DICTIONARY_ID, DICTIONARY_CODE, DICTIONARY_NAME, cast('0' as Bit) CHON        from LST_DICTIONARY              where DICTIONARY_TYPE_CODE = 'KHAMBENH_LOAI_TRIEUCHUNGLS'        order by LST_DICTIONARY.IDX]
2020-01-02 17:49:20,267 [1] DEBUG - Statement Id: [DAO00012_GetAllTCLS] PreparedStatement : [select MALOAITRIEUCHUNG DICTIONARY_TYPE_CODE, MALOAITRIEUCHUNG DICTIONARY_CODE,        TENTRIEUCHUNG DICTIONARY_NAME from TM_TRIEUCHUNGLS]
2020-01-02 17:49:20,301 [1] DEBUG - Statement Id: [DAO00019_ThongTinBenhNhanDvYeuCau] PreparedStatement : [select distinct A.SOTIEPNHAN, A.TIEPNHAN_ID, A.DOITUONG_ID, A.TRANGTHAI,        A.LOAITHANHVIEN_ID, A.SUDUNG_BHTN, A.THE_ID, A.THANHVIEN_ID, A.VIP, A.NGUON_BENHNHAN_ID, A.BAOLANH_VIENPHI, A.NGAYMIENDONGCHITRA,        B.*,  C.DICHVU_ID, C.DVYEUCAU_ID, C.NOITHUCHIEN_ID, A.SOBHYT        from TT_TIEPNHAN A        inner join TT_DVYEUCAU C on C.TIEPNHAN_ID = A.TIEPNHAN_ID        inner join TT_BENHNHAN B on B.BENHNHAN_ID = A.BENHNHAN_ID and B.ACTIVE = '1'        where                    C.DVYEUCAU_ID = '206519'                 and A.BENHVIEN_ID = 'HLU01']
2020-01-02 17:49:20,421 [1] DEBUG - Statement Id: [DAO00017_GetLoaiGiaByDoiTuongId] PreparedStatement : [select dtlg.DOUUTIEN, dtlg.DOITUONG_ID, lg.LOAIGIA_ID, lg.TENLOAIGIA, lg.MALOAIGIA              from TM_LOAIGIA lg              left join TM_DOITUONG_LOAIGIA dtlg              on lg.LOAIGIA_ID = dtlg.LOAIGIA_ID and dtlg.BENHVIEN_ID = 'HLU01'              where lg.TAMNGUNG = 0 and lg.BENHVIEN_ID = 'HLU01'                             order by dtlg.DOUUTIEN]
2020-01-02 17:49:20,476 [1] DEBUG - Statement Id: [DAO00087_GetServiceParams] PreparedStatement : [select CODE, VALUE              from TM_SYS_APPSETTINGS              where LOCKED = '0' and BENHVIEN_ID = 'HLU01']
2020-01-02 17:49:20,585 [1] DEBUG - Statement Id: [DAO00014_KiemTraDVYCCoGiaBHYT] PreparedStatement : [select *        from TT_VIENPHI        where REF_ID  = '206519' and REF_TABLE = 'TT_DVYEUCAU' and BHYT_DONGIA > 0]
2020-01-02 17:49:20,633 [1] DEBUG - Statement Id: [DAO00040_LayListToaMau] PreparedStatement : [select A.*, dc.TENDUOCDAYDU, dc.BHYT DUOC_BHYT, ld.LOAIVATTU_ID, ld.MALOAIDUOC, dd.DICTIONARY_NAME DUONGDUNG, dc.TAMNGUNG            from TT_TOATHUOCMAU A            left join TM_DUOC dc on A.DUOC_ID = dc.DUOC_ID            left join TM_LOAIDUOC ld on dc.LOAIDUOC_ID = ld.LOAIDUOC_ID            left join (select * from LST_DICTIONARY where DICTIONARY_TYPE_CODE like 'DuongDung') dd on dd.DICTIONARY_ID = dc.DUONGDUNG_ID            where (1=1)             and               A.BACSI_ID  = 1              and A.LOAITOATHUOC in  (                        @param0                   ,                           @param1                   ,                           @param2                   ,                           @param3                   )]
2020-01-02 17:49:20,634 [1] DEBUG - Statement Id: [DAO00040_LayListToaMau] Parameters: [@param0=[LSTLOAITOATHUOC[0],BV], @param1=[LSTLOAITOATHUOC[1],MN], @param2=[LSTLOAITOATHUOC[2],MP], @param3=[LSTLOAITOATHUOC[3],TV]]
2020-01-02 17:49:20,634 [1] DEBUG - Statement Id: [DAO00040_LayListToaMau] Types: [@param0=[String, System.String], @param1=[String, System.String], @param2=[String, System.String], @param3=[String, System.String]]
2020-01-02 17:49:20,729 [1] DEBUG - Statement Id: [DAO00040_LayListToaMau] PreparedStatement : [select A.*, dc.TENDUOCDAYDU, dc.BHYT DUOC_BHYT, ld.LOAIVATTU_ID, ld.MALOAIDUOC, dd.DICTIONARY_NAME DUONGDUNG, dc.TAMNGUNG            from TT_TOATHUOCMAU A            left join TM_DUOC dc on A.DUOC_ID = dc.DUOC_ID            left join TM_LOAIDUOC ld on dc.LOAIDUOC_ID = ld.LOAIDUOC_ID            left join (select * from LST_DICTIONARY where DICTIONARY_TYPE_CODE like 'DuongDung') dd on dd.DICTIONARY_ID = dc.DUONGDUNG_ID            where (1=1)             and               A.BACSI_ID  = 1              and A.LOAITOATHUOC in  (                        @param0                   ,                           @param1                   ,                           @param2                   ,                           @param3                   )]
2020-01-02 17:49:20,729 [1] DEBUG - Statement Id: [DAO00040_LayListToaMau] Parameters: [@param0=[LSTLOAITOATHUOC[0],BV], @param1=[LSTLOAITOATHUOC[1],MN], @param2=[LSTLOAITOATHUOC[2],MP], @param3=[LSTLOAITOATHUOC[3],TV]]
2020-01-02 17:49:20,729 [1] DEBUG - Statement Id: [DAO00040_LayListToaMau] Types: [@param0=[String, System.String], @param1=[String, System.String], @param2=[String, System.String], @param3=[String, System.String]]
2020-01-02 17:49:20,784 [1] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoVaBookingCOM23UpdateRedis_TheoPhamvi] PreparedStatement : [declare @TOAMUANGOAI int = 0;        select @TOAMUANGOAI = isnull(VALUE,0) from TM_SYS_APPSETTINGS where CODE = 'OPD_TOAMUANGOAI_DUNGDANHMUC_DUOC'                if @TOAMUANGOAI = 1        begin        select  distinct '0' + '_' + LTRIM(d.DUOC_ID) + '_' + '0' as DUOC_KEY, 999999999 as SOLUONG        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        where  @param0  = 0        union all        select distinct tk.DUOC_KEY, tk.SOLUONG        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        inner join        (        select  LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')) DUOC_KEY, (SUM(dtk.SOLUONG) - isnull(sum(A.SOLUONG),0) - isnull(sum(B.SOLUONG),0)) SOLUONG, pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        from (select sum(soluong) soluong,duoc_id,nguonduoc_id,khoduoc_id,benhvien_id from TT_DUOC_TONKHO  group by duoc_id,nguonduoc_id,khoduoc_id,benhvien_id) dtk        inner join TM_DUOC_PHAMVISD_MAPPING pvsd on dtk.KHODUOC_ID = pvsd.KHODUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NOITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) B on B.DUOC_ID = dtk.DUOC_ID and B.PHAMVI_ID = pvsd.PHAMVI_ID and B.NGUONHANG_ID = dtk.NGUONDUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NGOAITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) A on A.DUOC_ID = dtk.DUOC_ID and A.PHAMVI_ID = pvsd.PHAMVI_ID and A.NGUONHANG_ID = dtk.NGUONDUOC_ID        where dtk.BENHVIEN_ID = 'HLU01'        group by LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')), pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        ) tk on tk.DUOC_ID = d.DUOC_ID        left join TM_DUOC_PHAMVISUDUNG kd on kd.PHAMVI_ID = tk.PHAMVI_ID and kd.BENHVIEN_ID = 'HLU01'        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = tk.NGUONDUOC_ID and nh.BENHVIEN_ID = 'HLU01'        where d.BENHVIEN_ID = 'HLU01' and tk.PHAMVI_ID =  @param0         end        else        begin        select distinct tk.DUOC_KEY, tk.SOLUONG        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        inner join        (        select  LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')) DUOC_KEY, (SUM(dtk.SOLUONG) - isnull(sum(A.SOLUONG),0) - isnull(sum(B.SOLUONG),0)) SOLUONG, pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        from (select sum(soluong) soluong,duoc_id,nguonduoc_id,khoduoc_id,benhvien_id from TT_DUOC_TONKHO  group by duoc_id,nguonduoc_id,khoduoc_id,benhvien_id) dtk        inner join TM_DUOC_PHAMVISD_MAPPING pvsd on dtk.KHODUOC_ID = pvsd.KHODUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NOITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) B on B.DUOC_ID = dtk.DUOC_ID and B.PHAMVI_ID = pvsd.PHAMVI_ID and B.NGUONHANG_ID = dtk.NGUONDUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NGOAITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) A on A.DUOC_ID = dtk.DUOC_ID and A.PHAMVI_ID = pvsd.PHAMVI_ID and A.NGUONHANG_ID = dtk.NGUONDUOC_ID        where dtk.BENHVIEN_ID = 'HLU01'        group by LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')), pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        ) tk on tk.DUOC_ID = d.DUOC_ID        left join TM_DUOC_PHAMVISUDUNG kd on kd.PHAMVI_ID = tk.PHAMVI_ID and kd.BENHVIEN_ID = 'HLU01'        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = tk.NGUONDUOC_ID and nh.BENHVIEN_ID = 'HLU01'        where d.BENHVIEN_ID = 'HLU01' and tk.PHAMVI_ID =  @param0         end]
2020-01-02 17:49:20,784 [1] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoVaBookingCOM23UpdateRedis_TheoPhamvi] Parameters: [@param0=[PHAMVI_ID,1028]]
2020-01-02 17:49:20,784 [1] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoVaBookingCOM23UpdateRedis_TheoPhamvi] Types: [@param0=[Int64, System.Int64]]
2020-01-02 17:49:20,957 [1] DEBUG - Statement Id: [DAO00013_GetTienSuBenh] PreparedStatement : [select TIENSUBENH, TIENSUDIUNG        from TT_BENHNHAN        where TT_BENHNHAN.BENHNHAN_ID  = '24441']
2020-01-02 17:49:21,052 [1] DEBUG - Statement Id: [DAO00095_GetTTDiUngThuoc] PreparedStatement : [select *              from TT_BENHNHAN_DIUNG_THUOC              where BENHNHAN_ID = '24441'              and BENHVIEN_ID = 'HLU01']
2020-01-02 17:49:21,078 [1] DEBUG - Statement Id: [DAO00014_GetTotalChiPhiDVByTiepNhan] PreparedStatement : [select sum(THANHTIEN_DOANHTHU) as THANHTIEN_DOANHTHU from TT_VIENPHI        where ACTIVE = '1'        and TIEPNHAN_ID = '28493'        and REF_TABLE = 'TT_DVYEUCAU'        and exists (select DVYEUCAU_ID from TT_DVYEUCAU where HUYYEUCAU = '0' and TIEPNHAN_ID = '28493' and TT_VIENPHI.REF_ID = DVYEUCAU_ID)]
2020-01-02 17:49:21,124 [1] DEBUG - Statement Id: [DAO00014_GetKhamBenhInfo] PreparedStatement : [select * from TT_NGOAITRU_KHAMBENH where KHAMBENH_ID =        (select KHAMBENH_NGOAITRU_ID from TT_DVYEUCAU where DVYEUCAU_ID = '206519')]
2020-01-02 17:49:21,158 [1] DEBUG - Statement Id: [DAO00068_GetSinhHieuBySinhHieuID] PreparedStatement : [select top (1) *            from TT_NGOAITRU_KHAMBENH_SINHHIEU            where KHAMBENH_SINHHIEU_ID = '0'            and BENHVIEN_ID = 'HLU01'             and               BENHNHAN_ID = '24441'                           order by KHAMBENH_SINHHIEU_ID]
2020-01-02 17:49:21,292 [1] DEBUG - Statement Id: [DAO00014_GetKhamBenhICDInfo] PreparedStatement : [select *        from TT_NGOAITRU_KHAMBENH_ICD        where KHAMBENH_ID  = '27176']
2020-01-02 17:49:21,320 [1] DEBUG - Statement Id: [DAO00014_GetListToaThuoc] PreparedStatement : [select A.*        from TT_NGOAITRU_KHAMBENH_TOATHUOC A        where A.KHAMBENH_ID = '27176']
2020-01-02 17:49:21,348 [1] DEBUG - Statement Id: [DAO00014_KiemTraDVYCCoGiaBHYT] PreparedStatement : [select *        from TT_VIENPHI        where REF_ID  = '206519' and REF_TABLE = 'TT_DVYEUCAU' and BHYT_DONGIA > 0]
2020-01-02 17:49:21,383 [1] DEBUG - Statement Id: [DAO00040_LayListToaMau] PreparedStatement : [select A.*, dc.TENDUOCDAYDU, dc.BHYT DUOC_BHYT, ld.LOAIVATTU_ID, ld.MALOAIDUOC, dd.DICTIONARY_NAME DUONGDUNG, dc.TAMNGUNG            from TT_TOATHUOCMAU A            left join TM_DUOC dc on A.DUOC_ID = dc.DUOC_ID            left join TM_LOAIDUOC ld on dc.LOAIDUOC_ID = ld.LOAIDUOC_ID            left join (select * from LST_DICTIONARY where DICTIONARY_TYPE_CODE like 'DuongDung') dd on dd.DICTIONARY_ID = dc.DUONGDUNG_ID            where (1=1)             and               A.BACSI_ID  = 1              and A.LOAITOATHUOC in  (                        @param0                   ,                           @param1                   ,                           @param2                   ,                           @param3                   )]
2020-01-02 17:49:21,383 [1] DEBUG - Statement Id: [DAO00040_LayListToaMau] Parameters: [@param0=[LSTLOAITOATHUOC[0],BV], @param1=[LSTLOAITOATHUOC[1],MN], @param2=[LSTLOAITOATHUOC[2],MP], @param3=[LSTLOAITOATHUOC[3],TV]]
2020-01-02 17:49:21,383 [1] DEBUG - Statement Id: [DAO00040_LayListToaMau] Types: [@param0=[String, System.String], @param1=[String, System.String], @param2=[String, System.String], @param3=[String, System.String]]
2020-01-02 17:49:21,466 [1] DEBUG - Statement Id: [DAO00040_LayListToaMau] PreparedStatement : [select A.*, dc.TENDUOCDAYDU, dc.BHYT DUOC_BHYT, ld.LOAIVATTU_ID, ld.MALOAIDUOC, dd.DICTIONARY_NAME DUONGDUNG, dc.TAMNGUNG            from TT_TOATHUOCMAU A            left join TM_DUOC dc on A.DUOC_ID = dc.DUOC_ID            left join TM_LOAIDUOC ld on dc.LOAIDUOC_ID = ld.LOAIDUOC_ID            left join (select * from LST_DICTIONARY where DICTIONARY_TYPE_CODE like 'DuongDung') dd on dd.DICTIONARY_ID = dc.DUONGDUNG_ID            where (1=1)             and               A.BACSI_ID  = 1              and A.LOAITOATHUOC in  (                        @param0                   ,                           @param1                   ,                           @param2                   ,                           @param3                   )]
2020-01-02 17:49:21,467 [1] DEBUG - Statement Id: [DAO00040_LayListToaMau] Parameters: [@param0=[LSTLOAITOATHUOC[0],BV], @param1=[LSTLOAITOATHUOC[1],MN], @param2=[LSTLOAITOATHUOC[2],MP], @param3=[LSTLOAITOATHUOC[3],TV]]
2020-01-02 17:49:21,467 [1] DEBUG - Statement Id: [DAO00040_LayListToaMau] Types: [@param0=[String, System.String], @param1=[String, System.String], @param2=[String, System.String], @param3=[String, System.String]]
2020-01-02 17:49:21,498 [1] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoVaBookingCOM23UpdateRedis_TheoPhamvi] PreparedStatement : [declare @TOAMUANGOAI int = 0;        select @TOAMUANGOAI = isnull(VALUE,0) from TM_SYS_APPSETTINGS where CODE = 'OPD_TOAMUANGOAI_DUNGDANHMUC_DUOC'                if @TOAMUANGOAI = 1        begin        select  distinct '0' + '_' + LTRIM(d.DUOC_ID) + '_' + '0' as DUOC_KEY, 999999999 as SOLUONG        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        where  @param0  = 0        union all        select distinct tk.DUOC_KEY, tk.SOLUONG        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        inner join        (        select  LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')) DUOC_KEY, (SUM(dtk.SOLUONG) - isnull(sum(A.SOLUONG),0) - isnull(sum(B.SOLUONG),0)) SOLUONG, pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        from (select sum(soluong) soluong,duoc_id,nguonduoc_id,khoduoc_id,benhvien_id from TT_DUOC_TONKHO  group by duoc_id,nguonduoc_id,khoduoc_id,benhvien_id) dtk        inner join TM_DUOC_PHAMVISD_MAPPING pvsd on dtk.KHODUOC_ID = pvsd.KHODUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NOITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) B on B.DUOC_ID = dtk.DUOC_ID and B.PHAMVI_ID = pvsd.PHAMVI_ID and B.NGUONHANG_ID = dtk.NGUONDUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NGOAITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) A on A.DUOC_ID = dtk.DUOC_ID and A.PHAMVI_ID = pvsd.PHAMVI_ID and A.NGUONHANG_ID = dtk.NGUONDUOC_ID        where dtk.BENHVIEN_ID = 'HLU01'        group by LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')), pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        ) tk on tk.DUOC_ID = d.DUOC_ID        left join TM_DUOC_PHAMVISUDUNG kd on kd.PHAMVI_ID = tk.PHAMVI_ID and kd.BENHVIEN_ID = 'HLU01'        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = tk.NGUONDUOC_ID and nh.BENHVIEN_ID = 'HLU01'        where d.BENHVIEN_ID = 'HLU01' and tk.PHAMVI_ID =  @param0         end        else        begin        select distinct tk.DUOC_KEY, tk.SOLUONG        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        inner join        (        select  LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')) DUOC_KEY, (SUM(dtk.SOLUONG) - isnull(sum(A.SOLUONG),0) - isnull(sum(B.SOLUONG),0)) SOLUONG, pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        from (select sum(soluong) soluong,duoc_id,nguonduoc_id,khoduoc_id,benhvien_id from TT_DUOC_TONKHO  group by duoc_id,nguonduoc_id,khoduoc_id,benhvien_id) dtk        inner join TM_DUOC_PHAMVISD_MAPPING pvsd on dtk.KHODUOC_ID = pvsd.KHODUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NOITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) B on B.DUOC_ID = dtk.DUOC_ID and B.PHAMVI_ID = pvsd.PHAMVI_ID and B.NGUONHANG_ID = dtk.NGUONDUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NGOAITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) A on A.DUOC_ID = dtk.DUOC_ID and A.PHAMVI_ID = pvsd.PHAMVI_ID and A.NGUONHANG_ID = dtk.NGUONDUOC_ID        where dtk.BENHVIEN_ID = 'HLU01'        group by LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')), pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        ) tk on tk.DUOC_ID = d.DUOC_ID        left join TM_DUOC_PHAMVISUDUNG kd on kd.PHAMVI_ID = tk.PHAMVI_ID and kd.BENHVIEN_ID = 'HLU01'        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = tk.NGUONDUOC_ID and nh.BENHVIEN_ID = 'HLU01'        where d.BENHVIEN_ID = 'HLU01' and tk.PHAMVI_ID =  @param0         end]
2020-01-02 17:49:21,498 [1] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoVaBookingCOM23UpdateRedis_TheoPhamvi] Parameters: [@param0=[PHAMVI_ID,1028]]
2020-01-02 17:49:21,498 [1] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoVaBookingCOM23UpdateRedis_TheoPhamvi] Types: [@param0=[Int64, System.Int64]]
2020-01-02 17:49:21,829 [1] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoVaBookingCOM23UpdateRedis_TheoPhamvi] PreparedStatement : [declare @TOAMUANGOAI int = 0;        select @TOAMUANGOAI = isnull(VALUE,0) from TM_SYS_APPSETTINGS where CODE = 'OPD_TOAMUANGOAI_DUNGDANHMUC_DUOC'                if @TOAMUANGOAI = 1        begin        select  distinct '0' + '_' + LTRIM(d.DUOC_ID) + '_' + '0' as DUOC_KEY, 999999999 as SOLUONG        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        where  @param0  = 0        union all        select distinct tk.DUOC_KEY, tk.SOLUONG        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        inner join        (        select  LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')) DUOC_KEY, (SUM(dtk.SOLUONG) - isnull(sum(A.SOLUONG),0) - isnull(sum(B.SOLUONG),0)) SOLUONG, pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        from (select sum(soluong) soluong,duoc_id,nguonduoc_id,khoduoc_id,benhvien_id from TT_DUOC_TONKHO  group by duoc_id,nguonduoc_id,khoduoc_id,benhvien_id) dtk        inner join TM_DUOC_PHAMVISD_MAPPING pvsd on dtk.KHODUOC_ID = pvsd.KHODUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NOITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) B on B.DUOC_ID = dtk.DUOC_ID and B.PHAMVI_ID = pvsd.PHAMVI_ID and B.NGUONHANG_ID = dtk.NGUONDUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NGOAITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) A on A.DUOC_ID = dtk.DUOC_ID and A.PHAMVI_ID = pvsd.PHAMVI_ID and A.NGUONHANG_ID = dtk.NGUONDUOC_ID        where dtk.BENHVIEN_ID = 'HLU01'        group by LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')), pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        ) tk on tk.DUOC_ID = d.DUOC_ID        left join TM_DUOC_PHAMVISUDUNG kd on kd.PHAMVI_ID = tk.PHAMVI_ID and kd.BENHVIEN_ID = 'HLU01'        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = tk.NGUONDUOC_ID and nh.BENHVIEN_ID = 'HLU01'        where d.BENHVIEN_ID = 'HLU01' and tk.PHAMVI_ID =  @param0         end        else        begin        select distinct tk.DUOC_KEY, tk.SOLUONG        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        inner join        (        select  LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')) DUOC_KEY, (SUM(dtk.SOLUONG) - isnull(sum(A.SOLUONG),0) - isnull(sum(B.SOLUONG),0)) SOLUONG, pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        from (select sum(soluong) soluong,duoc_id,nguonduoc_id,khoduoc_id,benhvien_id from TT_DUOC_TONKHO  group by duoc_id,nguonduoc_id,khoduoc_id,benhvien_id) dtk        inner join TM_DUOC_PHAMVISD_MAPPING pvsd on dtk.KHODUOC_ID = pvsd.KHODUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NOITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) B on B.DUOC_ID = dtk.DUOC_ID and B.PHAMVI_ID = pvsd.PHAMVI_ID and B.NGUONHANG_ID = dtk.NGUONDUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NGOAITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) A on A.DUOC_ID = dtk.DUOC_ID and A.PHAMVI_ID = pvsd.PHAMVI_ID and A.NGUONHANG_ID = dtk.NGUONDUOC_ID        where dtk.BENHVIEN_ID = 'HLU01'        group by LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')), pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        ) tk on tk.DUOC_ID = d.DUOC_ID        left join TM_DUOC_PHAMVISUDUNG kd on kd.PHAMVI_ID = tk.PHAMVI_ID and kd.BENHVIEN_ID = 'HLU01'        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = tk.NGUONDUOC_ID and nh.BENHVIEN_ID = 'HLU01'        where d.BENHVIEN_ID = 'HLU01' and tk.PHAMVI_ID =  @param0         end]
2020-01-02 17:49:21,829 [1] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoVaBookingCOM23UpdateRedis_TheoPhamvi] Parameters: [@param0=[PHAMVI_ID,1028]]
2020-01-02 17:49:21,829 [1] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoVaBookingCOM23UpdateRedis_TheoPhamvi] Types: [@param0=[Int64, System.Int64]]
2020-01-02 17:49:22,421 [1] DEBUG - Statement Id: [DAO00068_GetLastedSinhHieuInfo] PreparedStatement : [select top (1) *, CHISOBMI as BMI              from TT_NGOAITRU_KHAMBENH_SINHHIEU              where BENHNHAN_ID = '24441'              order by KHAMBENH_SINHHIEU_ID desc]
2020-01-02 17:49:24,345 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'COM16'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2020-01-02 17:50:02,419 [1] DEBUG - Statement Id: [DAO00067_GET_CHUYENVIENINFO_FROM_BENHNHANID] PreparedStatement : [select *        from TT_CHUYENVIEN        where BENHNHAN_ID  = '0' and BENHVIEN_ID = 'HLU01'        and TIEPNHAN_ID = '28493'         and           KHAMBENH_ID = '27176']
2020-01-02 17:50:28,114 [1] DEBUG - Statement Id: [DAO00014_GetChanDoan] PreparedStatement : [DECLARE @VAL1 NVARCHAR(1000) = ''        DECLARE @VAL2 NVARCHAR(1000) = ''        SELECT @VAL1 = (SELECT ICD.TENICD +'('+ICD.MAICD+'); '+ KB.CHANDOANKHOAKHAM FROM TT_NGOAITRU_KHAMBENH KB        INNER JOIN TM_ICD ICD ON ICD.ICD_ID = KB.CHANDOANICD_ID        WHERE KHAMBENH_ID =  @param0 )        SELECT @VAl2 = @VAL2 + ICD.TENICD +'('+ICD.MAICD +'); ' FROM        TT_NGOAITRU_KHAMBENH_ICD KBI        INNER JOIN TM_ICD ICD ON KBI.ICD_ID = ICD.ICD_ID        WHERE KBI.KHAMBENH_ID =  @param0         SELECT @VAL1 + '; '+ ISNULL(@VAL2,'')]
2020-01-02 17:50:28,114 [1] DEBUG - Statement Id: [DAO00014_GetChanDoan] Parameters: [@param0=[KHAMBENH_ID,27176]]
2020-01-02 17:50:28,114 [1] DEBUG - Statement Id: [DAO00014_GetChanDoan] Types: [@param0=[Int64, System.Int64]]
2020-01-02 17:50:28,158 [1] DEBUG - Statement Id: [DAO00016_GetDSThuocDaDungByTiepNhan] PreparedStatement : [select A.*, dc.TENDUOCDAYDU        from TT_NGOAITRU_TOATHUOC A        left join TM_DUOC dc on A.DUOC_ID = dc.DUOC_ID        where exists (select KHAMBENH_ID from TT_NGOAITRU_KHAMBENH where A.KHAMBENH_ID = KHAMBENH_ID and  TIEPNHAN_ID = '28493')        and exists (select KHAMBENH_TOATHUOC_ID from TT_NGOAITRU_KHAMBENH_TOATHUOC where A.KHAMBENH_TOATHUOC_ID = KHAMBENH_TOATHUOC_ID and CHUNGTUPHATTHUOC_ID is not null)        and A.BENHVIEN_ID = 'HLU01']
2020-01-02 17:50:28,193 [1] DEBUG - Statement Id: [DAO00067_GetDanhsachDichvuDungChoChuyentuyen] PreparedStatement : [select A.DICHVU_ID, B.TENDICHVU, A.DVYEUCAU_ID        from TT_DVYEUCAU A        left join TM_DICHVU B on A.DICHVU_ID = B.DICHVU_ID        left join TM_NHOMDICHVU C on C.NHOMDICHVU_ID = B.NHOMDICHVU_ID        where        ( @param0  IS NOT NULL OR  @param1  IS NOT NULL) AND        LEFT(C.MANHOMDICHVU,2) in ('01', '02', '05', '06') and A.HUYYEUCAU = '0'         and           A.TIEPNHAN_ID = '28493']
2020-01-02 17:50:28,193 [1] DEBUG - Statement Id: [DAO00067_GetDanhsachDichvuDungChoChuyentuyen] Parameters: [@param0=[BENHAN_ID,null], @param1=[TIEPNHAN_ID,28493]]
2020-01-02 17:50:28,193 [1] DEBUG - Statement Id: [DAO00067_GetDanhsachDichvuDungChoChuyentuyen] Types: [@param0=[System.DBNull, null], @param1=[Int64, System.Int64]]
2020-01-02 17:50:28,226 [1] DEBUG - Statement Id: [DAO00067_GetDanhsachxetnghiemkq] PreparedStatement : [select distinct C.CLSKETQUACHITIET_ID, B.TENDICHVU, C.KETQUA, C.DICHVU_ID, A.DVYEUCAU_ID        from TT_DVYEUCAU A        inner join TT_CLSKETQUACHITIET C on C.DVYEUCAU_ID = A.DVYEUCAU_ID        left join TM_DICHVU B on C.DICHVU_ID = B.DICHVU_ID        where A.HUYYEUCAU = '0' and A.BENHAN_ID is not null                 AND ( @param0  IS NOT NULL OR  @param1  IS NOT NULL)         and           A.TIEPNHAN_ID = '28493'                 order by C.CLSKETQUACHITIET_ID]
2020-01-02 17:50:28,226 [1] DEBUG - Statement Id: [DAO00067_GetDanhsachxetnghiemkq] Parameters: [@param0=[BENHAN_ID,null], @param1=[TIEPNHAN_ID,28493]]
2020-01-02 17:50:28,226 [1] DEBUG - Statement Id: [DAO00067_GetDanhsachxetnghiemkq] Types: [@param0=[System.DBNull, null], @param1=[Int64, System.Int64]]
2020-01-02 17:50:28,252 [1] DEBUG - Statement Id: [DAO00067_GetDanhsachsieuamkq] PreparedStatement : [select C.DVYEUCAU_ID, B.TENDICHVU,C.KETLUAN        from TT_DVYEUCAU A        inner join TT_CLSKETQUA C on C.DVYEUCAU_ID = A.DVYEUCAU_ID        left join TM_DICHVU B on C.DICHVU_ID = B.DICHVU_ID        where        ( @param0  IS NOT NULL OR  @param1  IS NOT NULL) AND                 A.DVYEUCAU_ID not in        (select DVYEUCAU_ID from TT_CLSKETQUACHITIET        where exists (        select DVYEUCAU_ID from TT_DVYEUCAU where TT_CLSKETQUACHITIET.DVYEUCAU_ID = DVYEUCAU_ID                 ))         and           A.TIEPNHAN_ID = 28493]
2020-01-02 17:50:28,252 [1] DEBUG - Statement Id: [DAO00067_GetDanhsachsieuamkq] Parameters: [@param0=[BENHAN_ID,null], @param1=[TIEPNHAN_ID,28493]]
2020-01-02 17:50:28,252 [1] DEBUG - Statement Id: [DAO00067_GetDanhsachsieuamkq] Types: [@param0=[System.DBNull, null], @param1=[Int64, System.Int64]]
2020-01-02 17:50:49,288 [1] DEBUG - Statement Id: [DAO00017_GetLoaiGiaByDoiTuongId] PreparedStatement : [select dtlg.DOUUTIEN, dtlg.DOITUONG_ID, lg.LOAIGIA_ID, lg.TENLOAIGIA, lg.MALOAIGIA              from TM_LOAIGIA lg              left join TM_DOITUONG_LOAIGIA dtlg              on lg.LOAIGIA_ID = dtlg.LOAIGIA_ID and dtlg.BENHVIEN_ID = 'HLU01'              where lg.TAMNGUNG = 0 and lg.BENHVIEN_ID = 'HLU01'                             order by dtlg.DOUUTIEN]
2020-01-02 17:50:49,447 [1] DEBUG - Statement Id: [DAO00014_KiemTraDVYCCoGiaBHYT] PreparedStatement : [select *        from TT_VIENPHI        where REF_ID  = '' and REF_TABLE = 'TT_DVYEUCAU' and BHYT_DONGIA > 0]
2020-01-02 17:50:49,482 [1] DEBUG - Statement Id: [DAO00040_LayListToaMau] PreparedStatement : [select A.*, dc.TENDUOCDAYDU, dc.BHYT DUOC_BHYT, ld.LOAIVATTU_ID, ld.MALOAIDUOC, dd.DICTIONARY_NAME DUONGDUNG, dc.TAMNGUNG            from TT_TOATHUOCMAU A            left join TM_DUOC dc on A.DUOC_ID = dc.DUOC_ID            left join TM_LOAIDUOC ld on dc.LOAIDUOC_ID = ld.LOAIDUOC_ID            left join (select * from LST_DICTIONARY where DICTIONARY_TYPE_CODE like 'DuongDung') dd on dd.DICTIONARY_ID = dc.DUONGDUNG_ID            where (1=1)             and               A.BACSI_ID  = 1              and A.LOAITOATHUOC in  (                        @param0                   ,                           @param1                   ,                           @param2                   ,                           @param3                   )]
2020-01-02 17:50:49,482 [1] DEBUG - Statement Id: [DAO00040_LayListToaMau] Parameters: [@param0=[LSTLOAITOATHUOC[0],BV], @param1=[LSTLOAITOATHUOC[1],MN], @param2=[LSTLOAITOATHUOC[2],MP], @param3=[LSTLOAITOATHUOC[3],TV]]
2020-01-02 17:50:49,482 [1] DEBUG - Statement Id: [DAO00040_LayListToaMau] Types: [@param0=[String, System.String], @param1=[String, System.String], @param2=[String, System.String], @param3=[String, System.String]]
2020-01-02 17:50:49,568 [1] DEBUG - Statement Id: [DAO00040_LayListToaMau] PreparedStatement : [select A.*, dc.TENDUOCDAYDU, dc.BHYT DUOC_BHYT, ld.LOAIVATTU_ID, ld.MALOAIDUOC, dd.DICTIONARY_NAME DUONGDUNG, dc.TAMNGUNG            from TT_TOATHUOCMAU A            left join TM_DUOC dc on A.DUOC_ID = dc.DUOC_ID            left join TM_LOAIDUOC ld on dc.LOAIDUOC_ID = ld.LOAIDUOC_ID            left join (select * from LST_DICTIONARY where DICTIONARY_TYPE_CODE like 'DuongDung') dd on dd.DICTIONARY_ID = dc.DUONGDUNG_ID            where (1=1)             and               A.BACSI_ID  = 1              and A.LOAITOATHUOC in  (                        @param0                   ,                           @param1                   ,                           @param2                   ,                           @param3                   )]
2020-01-02 17:50:49,568 [1] DEBUG - Statement Id: [DAO00040_LayListToaMau] Parameters: [@param0=[LSTLOAITOATHUOC[0],BV], @param1=[LSTLOAITOATHUOC[1],MN], @param2=[LSTLOAITOATHUOC[2],MP], @param3=[LSTLOAITOATHUOC[3],TV]]
2020-01-02 17:50:49,568 [1] DEBUG - Statement Id: [DAO00040_LayListToaMau] Types: [@param0=[String, System.String], @param1=[String, System.String], @param2=[String, System.String], @param3=[String, System.String]]
2020-01-02 17:50:49,601 [1] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoVaBookingCOM23UpdateRedis_TheoPhamvi] PreparedStatement : [declare @TOAMUANGOAI int = 0;        select @TOAMUANGOAI = isnull(VALUE,0) from TM_SYS_APPSETTINGS where CODE = 'OPD_TOAMUANGOAI_DUNGDANHMUC_DUOC'                if @TOAMUANGOAI = 1        begin        select  distinct '0' + '_' + LTRIM(d.DUOC_ID) + '_' + '0' as DUOC_KEY, 999999999 as SOLUONG        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        where  @param0  = 0        union all        select distinct tk.DUOC_KEY, tk.SOLUONG        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        inner join        (        select  LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')) DUOC_KEY, (SUM(dtk.SOLUONG) - isnull(sum(A.SOLUONG),0) - isnull(sum(B.SOLUONG),0)) SOLUONG, pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        from (select sum(soluong) soluong,duoc_id,nguonduoc_id,khoduoc_id,benhvien_id from TT_DUOC_TONKHO  group by duoc_id,nguonduoc_id,khoduoc_id,benhvien_id) dtk        inner join TM_DUOC_PHAMVISD_MAPPING pvsd on dtk.KHODUOC_ID = pvsd.KHODUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NOITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) B on B.DUOC_ID = dtk.DUOC_ID and B.PHAMVI_ID = pvsd.PHAMVI_ID and B.NGUONHANG_ID = dtk.NGUONDUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NGOAITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) A on A.DUOC_ID = dtk.DUOC_ID and A.PHAMVI_ID = pvsd.PHAMVI_ID and A.NGUONHANG_ID = dtk.NGUONDUOC_ID        where dtk.BENHVIEN_ID = 'HLU01'        group by LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')), pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        ) tk on tk.DUOC_ID = d.DUOC_ID        left join TM_DUOC_PHAMVISUDUNG kd on kd.PHAMVI_ID = tk.PHAMVI_ID and kd.BENHVIEN_ID = 'HLU01'        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = tk.NGUONDUOC_ID and nh.BENHVIEN_ID = 'HLU01'        where d.BENHVIEN_ID = 'HLU01' and tk.PHAMVI_ID =  @param0         end        else        begin        select distinct tk.DUOC_KEY, tk.SOLUONG        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        inner join        (        select  LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')) DUOC_KEY, (SUM(dtk.SOLUONG) - isnull(sum(A.SOLUONG),0) - isnull(sum(B.SOLUONG),0)) SOLUONG, pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        from (select sum(soluong) soluong,duoc_id,nguonduoc_id,khoduoc_id,benhvien_id from TT_DUOC_TONKHO  group by duoc_id,nguonduoc_id,khoduoc_id,benhvien_id) dtk        inner join TM_DUOC_PHAMVISD_MAPPING pvsd on dtk.KHODUOC_ID = pvsd.KHODUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NOITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) B on B.DUOC_ID = dtk.DUOC_ID and B.PHAMVI_ID = pvsd.PHAMVI_ID and B.NGUONHANG_ID = dtk.NGUONDUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NGOAITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) A on A.DUOC_ID = dtk.DUOC_ID and A.PHAMVI_ID = pvsd.PHAMVI_ID and A.NGUONHANG_ID = dtk.NGUONDUOC_ID        where dtk.BENHVIEN_ID = 'HLU01'        group by LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')), pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        ) tk on tk.DUOC_ID = d.DUOC_ID        left join TM_DUOC_PHAMVISUDUNG kd on kd.PHAMVI_ID = tk.PHAMVI_ID and kd.BENHVIEN_ID = 'HLU01'        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = tk.NGUONDUOC_ID and nh.BENHVIEN_ID = 'HLU01'        where d.BENHVIEN_ID = 'HLU01' and tk.PHAMVI_ID =  @param0         end]
2020-01-02 17:50:49,601 [1] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoVaBookingCOM23UpdateRedis_TheoPhamvi] Parameters: [@param0=[PHAMVI_ID,1033]]
2020-01-02 17:50:49,601 [1] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoVaBookingCOM23UpdateRedis_TheoPhamvi] Types: [@param0=[Int64, System.Int64]]
2020-01-02 17:50:49,800 [1] DEBUG - Statement Id: [DAO00012_GetLoaiTCLS] PreparedStatement : [select DICTIONARY_ID, DICTIONARY_CODE, DICTIONARY_NAME, cast('0' as Bit) CHON        from LST_DICTIONARY              where DICTIONARY_TYPE_CODE = 'KHAMBENH_LOAI_TRIEUCHUNGLS'        order by LST_DICTIONARY.IDX]
2020-01-02 17:50:49,835 [1] DEBUG - Statement Id: [DAO00012_GetAllTCLS] PreparedStatement : [select MALOAITRIEUCHUNG DICTIONARY_TYPE_CODE, MALOAITRIEUCHUNG DICTIONARY_CODE,        TENTRIEUCHUNG DICTIONARY_NAME from TM_TRIEUCHUNGLS]
2020-01-02 17:50:49,868 [1] DEBUG - Statement Id: [DAO00019_ThongTinBenhNhanDvYeuCau] PreparedStatement : [select distinct A.SOTIEPNHAN, A.TIEPNHAN_ID, A.DOITUONG_ID, A.TRANGTHAI,        A.LOAITHANHVIEN_ID, A.SUDUNG_BHTN, A.THE_ID, A.THANHVIEN_ID, A.VIP, A.NGUON_BENHNHAN_ID, A.BAOLANH_VIENPHI, A.NGAYMIENDONGCHITRA,        B.*,  C.DICHVU_ID, C.DVYEUCAU_ID, C.NOITHUCHIEN_ID, A.SOBHYT        from TT_TIEPNHAN A        inner join TT_DVYEUCAU C on C.TIEPNHAN_ID = A.TIEPNHAN_ID        inner join TT_BENHNHAN B on B.BENHNHAN_ID = A.BENHNHAN_ID and B.ACTIVE = '1'        where                    C.DVYEUCAU_ID = '206520'                 and A.BENHVIEN_ID = 'HLU01']
2020-01-02 17:50:49,972 [1] DEBUG - Statement Id: [DAO00017_GetLoaiGiaByDoiTuongId] PreparedStatement : [select dtlg.DOUUTIEN, dtlg.DOITUONG_ID, lg.LOAIGIA_ID, lg.TENLOAIGIA, lg.MALOAIGIA              from TM_LOAIGIA lg              left join TM_DOITUONG_LOAIGIA dtlg              on lg.LOAIGIA_ID = dtlg.LOAIGIA_ID and dtlg.BENHVIEN_ID = 'HLU01'              where lg.TAMNGUNG = 0 and lg.BENHVIEN_ID = 'HLU01'                             order by dtlg.DOUUTIEN]
2020-01-02 17:50:50,030 [1] DEBUG - Statement Id: [DAO00014_KiemTraDVYCCoGiaBHYT] PreparedStatement : [select *        from TT_VIENPHI        where REF_ID  = '206520' and REF_TABLE = 'TT_DVYEUCAU' and BHYT_DONGIA > 0]
2020-01-02 17:50:50,065 [1] DEBUG - Statement Id: [DAO00040_LayListToaMau] PreparedStatement : [select A.*, dc.TENDUOCDAYDU, dc.BHYT DUOC_BHYT, ld.LOAIVATTU_ID, ld.MALOAIDUOC, dd.DICTIONARY_NAME DUONGDUNG, dc.TAMNGUNG            from TT_TOATHUOCMAU A            left join TM_DUOC dc on A.DUOC_ID = dc.DUOC_ID            left join TM_LOAIDUOC ld on dc.LOAIDUOC_ID = ld.LOAIDUOC_ID            left join (select * from LST_DICTIONARY where DICTIONARY_TYPE_CODE like 'DuongDung') dd on dd.DICTIONARY_ID = dc.DUONGDUNG_ID            where (1=1)             and               A.BACSI_ID  = 1              and A.LOAITOATHUOC in  (                        @param0                   ,                           @param1                   ,                           @param2                   ,                           @param3                   )]
2020-01-02 17:50:50,065 [1] DEBUG - Statement Id: [DAO00040_LayListToaMau] Parameters: [@param0=[LSTLOAITOATHUOC[0],BV], @param1=[LSTLOAITOATHUOC[1],MN], @param2=[LSTLOAITOATHUOC[2],MP], @param3=[LSTLOAITOATHUOC[3],TV]]
2020-01-02 17:50:50,065 [1] DEBUG - Statement Id: [DAO00040_LayListToaMau] Types: [@param0=[String, System.String], @param1=[String, System.String], @param2=[String, System.String], @param3=[String, System.String]]
2020-01-02 17:50:50,150 [1] DEBUG - Statement Id: [DAO00040_LayListToaMau] PreparedStatement : [select A.*, dc.TENDUOCDAYDU, dc.BHYT DUOC_BHYT, ld.LOAIVATTU_ID, ld.MALOAIDUOC, dd.DICTIONARY_NAME DUONGDUNG, dc.TAMNGUNG            from TT_TOATHUOCMAU A            left join TM_DUOC dc on A.DUOC_ID = dc.DUOC_ID            left join TM_LOAIDUOC ld on dc.LOAIDUOC_ID = ld.LOAIDUOC_ID            left join (select * from LST_DICTIONARY where DICTIONARY_TYPE_CODE like 'DuongDung') dd on dd.DICTIONARY_ID = dc.DUONGDUNG_ID            where (1=1)             and               A.BACSI_ID  = 1              and A.LOAITOATHUOC in  (                        @param0                   ,                           @param1                   ,                           @param2                   ,                           @param3                   )]
2020-01-02 17:50:50,150 [1] DEBUG - Statement Id: [DAO00040_LayListToaMau] Parameters: [@param0=[LSTLOAITOATHUOC[0],BV], @param1=[LSTLOAITOATHUOC[1],MN], @param2=[LSTLOAITOATHUOC[2],MP], @param3=[LSTLOAITOATHUOC[3],TV]]
2020-01-02 17:50:50,150 [1] DEBUG - Statement Id: [DAO00040_LayListToaMau] Types: [@param0=[String, System.String], @param1=[String, System.String], @param2=[String, System.String], @param3=[String, System.String]]
2020-01-02 17:50:50,182 [1] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoVaBookingCOM23UpdateRedis_TheoPhamvi] PreparedStatement : [declare @TOAMUANGOAI int = 0;        select @TOAMUANGOAI = isnull(VALUE,0) from TM_SYS_APPSETTINGS where CODE = 'OPD_TOAMUANGOAI_DUNGDANHMUC_DUOC'                if @TOAMUANGOAI = 1        begin        select  distinct '0' + '_' + LTRIM(d.DUOC_ID) + '_' + '0' as DUOC_KEY, 999999999 as SOLUONG        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        where  @param0  = 0        union all        select distinct tk.DUOC_KEY, tk.SOLUONG        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        inner join        (        select  LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')) DUOC_KEY, (SUM(dtk.SOLUONG) - isnull(sum(A.SOLUONG),0) - isnull(sum(B.SOLUONG),0)) SOLUONG, pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        from (select sum(soluong) soluong,duoc_id,nguonduoc_id,khoduoc_id,benhvien_id from TT_DUOC_TONKHO  group by duoc_id,nguonduoc_id,khoduoc_id,benhvien_id) dtk        inner join TM_DUOC_PHAMVISD_MAPPING pvsd on dtk.KHODUOC_ID = pvsd.KHODUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NOITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) B on B.DUOC_ID = dtk.DUOC_ID and B.PHAMVI_ID = pvsd.PHAMVI_ID and B.NGUONHANG_ID = dtk.NGUONDUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NGOAITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) A on A.DUOC_ID = dtk.DUOC_ID and A.PHAMVI_ID = pvsd.PHAMVI_ID and A.NGUONHANG_ID = dtk.NGUONDUOC_ID        where dtk.BENHVIEN_ID = 'HLU01'        group by LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')), pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        ) tk on tk.DUOC_ID = d.DUOC_ID        left join TM_DUOC_PHAMVISUDUNG kd on kd.PHAMVI_ID = tk.PHAMVI_ID and kd.BENHVIEN_ID = 'HLU01'        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = tk.NGUONDUOC_ID and nh.BENHVIEN_ID = 'HLU01'        where d.BENHVIEN_ID = 'HLU01' and tk.PHAMVI_ID =  @param0         end        else        begin        select distinct tk.DUOC_KEY, tk.SOLUONG        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        inner join        (        select  LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')) DUOC_KEY, (SUM(dtk.SOLUONG) - isnull(sum(A.SOLUONG),0) - isnull(sum(B.SOLUONG),0)) SOLUONG, pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        from (select sum(soluong) soluong,duoc_id,nguonduoc_id,khoduoc_id,benhvien_id from TT_DUOC_TONKHO  group by duoc_id,nguonduoc_id,khoduoc_id,benhvien_id) dtk        inner join TM_DUOC_PHAMVISD_MAPPING pvsd on dtk.KHODUOC_ID = pvsd.KHODUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NOITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) B on B.DUOC_ID = dtk.DUOC_ID and B.PHAMVI_ID = pvsd.PHAMVI_ID and B.NGUONHANG_ID = dtk.NGUONDUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NGOAITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) A on A.DUOC_ID = dtk.DUOC_ID and A.PHAMVI_ID = pvsd.PHAMVI_ID and A.NGUONHANG_ID = dtk.NGUONDUOC_ID        where dtk.BENHVIEN_ID = 'HLU01'        group by LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')), pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        ) tk on tk.DUOC_ID = d.DUOC_ID        left join TM_DUOC_PHAMVISUDUNG kd on kd.PHAMVI_ID = tk.PHAMVI_ID and kd.BENHVIEN_ID = 'HLU01'        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = tk.NGUONDUOC_ID and nh.BENHVIEN_ID = 'HLU01'        where d.BENHVIEN_ID = 'HLU01' and tk.PHAMVI_ID =  @param0         end]
2020-01-02 17:50:50,182 [1] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoVaBookingCOM23UpdateRedis_TheoPhamvi] Parameters: [@param0=[PHAMVI_ID,1028]]
2020-01-02 17:50:50,182 [1] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoVaBookingCOM23UpdateRedis_TheoPhamvi] Types: [@param0=[Int64, System.Int64]]
2020-01-02 17:50:50,391 [1] DEBUG - Statement Id: [DAO00013_GetTienSuBenh] PreparedStatement : [select TIENSUBENH, TIENSUDIUNG        from TT_BENHNHAN        where TT_BENHNHAN.BENHNHAN_ID  = '24442']
2020-01-02 17:50:50,415 [1] DEBUG - Statement Id: [DAO00095_GetTTDiUngThuoc] PreparedStatement : [select *              from TT_BENHNHAN_DIUNG_THUOC              where BENHNHAN_ID = '24442'              and BENHVIEN_ID = 'HLU01']
2020-01-02 17:50:50,440 [1] DEBUG - Statement Id: [DAO00014_GetTotalChiPhiDVByTiepNhan] PreparedStatement : [select sum(THANHTIEN_DOANHTHU) as THANHTIEN_DOANHTHU from TT_VIENPHI        where ACTIVE = '1'        and TIEPNHAN_ID = '28494'        and REF_TABLE = 'TT_DVYEUCAU'        and exists (select DVYEUCAU_ID from TT_DVYEUCAU where HUYYEUCAU = '0' and TIEPNHAN_ID = '28494' and TT_VIENPHI.REF_ID = DVYEUCAU_ID)]
2020-01-02 17:50:50,472 [1] DEBUG - Statement Id: [DAO00014_GetKhamBenhInfo] PreparedStatement : [select * from TT_NGOAITRU_KHAMBENH where KHAMBENH_ID =        (select KHAMBENH_NGOAITRU_ID from TT_DVYEUCAU where DVYEUCAU_ID = '206520')]
2020-01-02 17:50:50,506 [1] DEBUG - Statement Id: [DAO00068_GetSinhHieuBySinhHieuID] PreparedStatement : [select top (1) *            from TT_NGOAITRU_KHAMBENH_SINHHIEU            where KHAMBENH_SINHHIEU_ID = '0'            and BENHVIEN_ID = 'HLU01'             and               BENHNHAN_ID = '24442'                           order by KHAMBENH_SINHHIEU_ID]
2020-01-02 17:50:50,631 [1] DEBUG - Statement Id: [DAO00014_GetKhamBenhICDInfo] PreparedStatement : [select *        from TT_NGOAITRU_KHAMBENH_ICD        where KHAMBENH_ID  = '27177']
2020-01-02 17:50:50,655 [1] DEBUG - Statement Id: [DAO00014_GetListToaThuoc] PreparedStatement : [select A.*        from TT_NGOAITRU_KHAMBENH_TOATHUOC A        where A.KHAMBENH_ID = '27177']
2020-01-02 17:50:50,690 [1] DEBUG - Statement Id: [DAO00014_KiemTraDVYCCoGiaBHYT] PreparedStatement : [select *        from TT_VIENPHI        where REF_ID  = '206520' and REF_TABLE = 'TT_DVYEUCAU' and BHYT_DONGIA > 0]
2020-01-02 17:50:50,726 [1] DEBUG - Statement Id: [DAO00040_LayListToaMau] PreparedStatement : [select A.*, dc.TENDUOCDAYDU, dc.BHYT DUOC_BHYT, ld.LOAIVATTU_ID, ld.MALOAIDUOC, dd.DICTIONARY_NAME DUONGDUNG, dc.TAMNGUNG            from TT_TOATHUOCMAU A            left join TM_DUOC dc on A.DUOC_ID = dc.DUOC_ID            left join TM_LOAIDUOC ld on dc.LOAIDUOC_ID = ld.LOAIDUOC_ID            left join (select * from LST_DICTIONARY where DICTIONARY_TYPE_CODE like 'DuongDung') dd on dd.DICTIONARY_ID = dc.DUONGDUNG_ID            where (1=1)             and               A.BACSI_ID  = 1              and A.LOAITOATHUOC in  (                        @param0                   ,                           @param1                   ,                           @param2                   ,                           @param3                   )]
2020-01-02 17:50:50,726 [1] DEBUG - Statement Id: [DAO00040_LayListToaMau] Parameters: [@param0=[LSTLOAITOATHUOC[0],BV], @param1=[LSTLOAITOATHUOC[1],MN], @param2=[LSTLOAITOATHUOC[2],MP], @param3=[LSTLOAITOATHUOC[3],TV]]
2020-01-02 17:50:50,726 [1] DEBUG - Statement Id: [DAO00040_LayListToaMau] Types: [@param0=[String, System.String], @param1=[String, System.String], @param2=[String, System.String], @param3=[String, System.String]]
2020-01-02 17:50:50,811 [1] DEBUG - Statement Id: [DAO00040_LayListToaMau] PreparedStatement : [select A.*, dc.TENDUOCDAYDU, dc.BHYT DUOC_BHYT, ld.LOAIVATTU_ID, ld.MALOAIDUOC, dd.DICTIONARY_NAME DUONGDUNG, dc.TAMNGUNG            from TT_TOATHUOCMAU A            left join TM_DUOC dc on A.DUOC_ID = dc.DUOC_ID            left join TM_LOAIDUOC ld on dc.LOAIDUOC_ID = ld.LOAIDUOC_ID            left join (select * from LST_DICTIONARY where DICTIONARY_TYPE_CODE like 'DuongDung') dd on dd.DICTIONARY_ID = dc.DUONGDUNG_ID            where (1=1)             and               A.BACSI_ID  = 1              and A.LOAITOATHUOC in  (                        @param0                   ,                           @param1                   ,                           @param2                   ,                           @param3                   )]
2020-01-02 17:50:50,811 [1] DEBUG - Statement Id: [DAO00040_LayListToaMau] Parameters: [@param0=[LSTLOAITOATHUOC[0],BV], @param1=[LSTLOAITOATHUOC[1],MN], @param2=[LSTLOAITOATHUOC[2],MP], @param3=[LSTLOAITOATHUOC[3],TV]]
2020-01-02 17:50:50,811 [1] DEBUG - Statement Id: [DAO00040_LayListToaMau] Types: [@param0=[String, System.String], @param1=[String, System.String], @param2=[String, System.String], @param3=[String, System.String]]
2020-01-02 17:50:50,840 [1] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoVaBookingCOM23UpdateRedis_TheoPhamvi] PreparedStatement : [declare @TOAMUANGOAI int = 0;        select @TOAMUANGOAI = isnull(VALUE,0) from TM_SYS_APPSETTINGS where CODE = 'OPD_TOAMUANGOAI_DUNGDANHMUC_DUOC'                if @TOAMUANGOAI = 1        begin        select  distinct '0' + '_' + LTRIM(d.DUOC_ID) + '_' + '0' as DUOC_KEY, 999999999 as SOLUONG        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        where  @param0  = 0        union all        select distinct tk.DUOC_KEY, tk.SOLUONG        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        inner join        (        select  LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')) DUOC_KEY, (SUM(dtk.SOLUONG) - isnull(sum(A.SOLUONG),0) - isnull(sum(B.SOLUONG),0)) SOLUONG, pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        from (select sum(soluong) soluong,duoc_id,nguonduoc_id,khoduoc_id,benhvien_id from TT_DUOC_TONKHO  group by duoc_id,nguonduoc_id,khoduoc_id,benhvien_id) dtk        inner join TM_DUOC_PHAMVISD_MAPPING pvsd on dtk.KHODUOC_ID = pvsd.KHODUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NOITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) B on B.DUOC_ID = dtk.DUOC_ID and B.PHAMVI_ID = pvsd.PHAMVI_ID and B.NGUONHANG_ID = dtk.NGUONDUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NGOAITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) A on A.DUOC_ID = dtk.DUOC_ID and A.PHAMVI_ID = pvsd.PHAMVI_ID and A.NGUONHANG_ID = dtk.NGUONDUOC_ID        where dtk.BENHVIEN_ID = 'HLU01'        group by LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')), pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        ) tk on tk.DUOC_ID = d.DUOC_ID        left join TM_DUOC_PHAMVISUDUNG kd on kd.PHAMVI_ID = tk.PHAMVI_ID and kd.BENHVIEN_ID = 'HLU01'        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = tk.NGUONDUOC_ID and nh.BENHVIEN_ID = 'HLU01'        where d.BENHVIEN_ID = 'HLU01' and tk.PHAMVI_ID =  @param0         end        else        begin        select distinct tk.DUOC_KEY, tk.SOLUONG        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        inner join        (        select  LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')) DUOC_KEY, (SUM(dtk.SOLUONG) - isnull(sum(A.SOLUONG),0) - isnull(sum(B.SOLUONG),0)) SOLUONG, pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        from (select sum(soluong) soluong,duoc_id,nguonduoc_id,khoduoc_id,benhvien_id from TT_DUOC_TONKHO  group by duoc_id,nguonduoc_id,khoduoc_id,benhvien_id) dtk        inner join TM_DUOC_PHAMVISD_MAPPING pvsd on dtk.KHODUOC_ID = pvsd.KHODUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NOITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) B on B.DUOC_ID = dtk.DUOC_ID and B.PHAMVI_ID = pvsd.PHAMVI_ID and B.NGUONHANG_ID = dtk.NGUONDUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NGOAITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) A on A.DUOC_ID = dtk.DUOC_ID and A.PHAMVI_ID = pvsd.PHAMVI_ID and A.NGUONHANG_ID = dtk.NGUONDUOC_ID        where dtk.BENHVIEN_ID = 'HLU01'        group by LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')), pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        ) tk on tk.DUOC_ID = d.DUOC_ID        left join TM_DUOC_PHAMVISUDUNG kd on kd.PHAMVI_ID = tk.PHAMVI_ID and kd.BENHVIEN_ID = 'HLU01'        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = tk.NGUONDUOC_ID and nh.BENHVIEN_ID = 'HLU01'        where d.BENHVIEN_ID = 'HLU01' and tk.PHAMVI_ID =  @param0         end]
2020-01-02 17:50:50,840 [1] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoVaBookingCOM23UpdateRedis_TheoPhamvi] Parameters: [@param0=[PHAMVI_ID,1028]]
2020-01-02 17:50:50,840 [1] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoVaBookingCOM23UpdateRedis_TheoPhamvi] Types: [@param0=[Int64, System.Int64]]
2020-01-02 17:50:51,048 [1] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoVaBookingCOM23UpdateRedis_TheoPhamvi] PreparedStatement : [declare @TOAMUANGOAI int = 0;        select @TOAMUANGOAI = isnull(VALUE,0) from TM_SYS_APPSETTINGS where CODE = 'OPD_TOAMUANGOAI_DUNGDANHMUC_DUOC'                if @TOAMUANGOAI = 1        begin        select  distinct '0' + '_' + LTRIM(d.DUOC_ID) + '_' + '0' as DUOC_KEY, 999999999 as SOLUONG        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        where  @param0  = 0        union all        select distinct tk.DUOC_KEY, tk.SOLUONG        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        inner join        (        select  LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')) DUOC_KEY, (SUM(dtk.SOLUONG) - isnull(sum(A.SOLUONG),0) - isnull(sum(B.SOLUONG),0)) SOLUONG, pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        from (select sum(soluong) soluong,duoc_id,nguonduoc_id,khoduoc_id,benhvien_id from TT_DUOC_TONKHO  group by duoc_id,nguonduoc_id,khoduoc_id,benhvien_id) dtk        inner join TM_DUOC_PHAMVISD_MAPPING pvsd on dtk.KHODUOC_ID = pvsd.KHODUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NOITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) B on B.DUOC_ID = dtk.DUOC_ID and B.PHAMVI_ID = pvsd.PHAMVI_ID and B.NGUONHANG_ID = dtk.NGUONDUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NGOAITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) A on A.DUOC_ID = dtk.DUOC_ID and A.PHAMVI_ID = pvsd.PHAMVI_ID and A.NGUONHANG_ID = dtk.NGUONDUOC_ID        where dtk.BENHVIEN_ID = 'HLU01'        group by LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')), pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        ) tk on tk.DUOC_ID = d.DUOC_ID        left join TM_DUOC_PHAMVISUDUNG kd on kd.PHAMVI_ID = tk.PHAMVI_ID and kd.BENHVIEN_ID = 'HLU01'        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = tk.NGUONDUOC_ID and nh.BENHVIEN_ID = 'HLU01'        where d.BENHVIEN_ID = 'HLU01' and tk.PHAMVI_ID =  @param0         end        else        begin        select distinct tk.DUOC_KEY, tk.SOLUONG        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        inner join        (        select  LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')) DUOC_KEY, (SUM(dtk.SOLUONG) - isnull(sum(A.SOLUONG),0) - isnull(sum(B.SOLUONG),0)) SOLUONG, pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        from (select sum(soluong) soluong,duoc_id,nguonduoc_id,khoduoc_id,benhvien_id from TT_DUOC_TONKHO  group by duoc_id,nguonduoc_id,khoduoc_id,benhvien_id) dtk        inner join TM_DUOC_PHAMVISD_MAPPING pvsd on dtk.KHODUOC_ID = pvsd.KHODUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NOITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) B on B.DUOC_ID = dtk.DUOC_ID and B.PHAMVI_ID = pvsd.PHAMVI_ID and B.NGUONHANG_ID = dtk.NGUONDUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NGOAITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) A on A.DUOC_ID = dtk.DUOC_ID and A.PHAMVI_ID = pvsd.PHAMVI_ID and A.NGUONHANG_ID = dtk.NGUONDUOC_ID        where dtk.BENHVIEN_ID = 'HLU01'        group by LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')), pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        ) tk on tk.DUOC_ID = d.DUOC_ID        left join TM_DUOC_PHAMVISUDUNG kd on kd.PHAMVI_ID = tk.PHAMVI_ID and kd.BENHVIEN_ID = 'HLU01'        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = tk.NGUONDUOC_ID and nh.BENHVIEN_ID = 'HLU01'        where d.BENHVIEN_ID = 'HLU01' and tk.PHAMVI_ID =  @param0         end]
2020-01-02 17:50:51,049 [1] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoVaBookingCOM23UpdateRedis_TheoPhamvi] Parameters: [@param0=[PHAMVI_ID,1028]]
2020-01-02 17:50:51,049 [1] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoVaBookingCOM23UpdateRedis_TheoPhamvi] Types: [@param0=[Int64, System.Int64]]
2020-01-02 17:50:51,336 [1] DEBUG - Statement Id: [DAO00068_GetLastedSinhHieuInfo] PreparedStatement : [select top (1) *, CHISOBMI as BMI              from TT_NGOAITRU_KHAMBENH_SINHHIEU              where BENHNHAN_ID = '24442'              order by KHAMBENH_SINHHIEU_ID desc]
2020-01-02 17:50:57,156 [1] DEBUG - Statement Id: [DAO00067_GET_CHUYENVIENINFO_FROM_BENHNHANID] PreparedStatement : [select *        from TT_CHUYENVIEN        where BENHNHAN_ID  = '0' and BENHVIEN_ID = 'HLU01'        and TIEPNHAN_ID = '28494'         and           KHAMBENH_ID = '27177']
2020-01-02 17:50:57,185 [1] DEBUG - Statement Id: [DAO00014_GetChanDoan] PreparedStatement : [DECLARE @VAL1 NVARCHAR(1000) = ''        DECLARE @VAL2 NVARCHAR(1000) = ''        SELECT @VAL1 = (SELECT ICD.TENICD +'('+ICD.MAICD+'); '+ KB.CHANDOANKHOAKHAM FROM TT_NGOAITRU_KHAMBENH KB        INNER JOIN TM_ICD ICD ON ICD.ICD_ID = KB.CHANDOANICD_ID        WHERE KHAMBENH_ID =  @param0 )        SELECT @VAl2 = @VAL2 + ICD.TENICD +'('+ICD.MAICD +'); ' FROM        TT_NGOAITRU_KHAMBENH_ICD KBI        INNER JOIN TM_ICD ICD ON KBI.ICD_ID = ICD.ICD_ID        WHERE KBI.KHAMBENH_ID =  @param0         SELECT @VAL1 + '; '+ ISNULL(@VAL2,'')]
2020-01-02 17:50:57,185 [1] DEBUG - Statement Id: [DAO00014_GetChanDoan] Parameters: [@param0=[KHAMBENH_ID,27177]]
2020-01-02 17:50:57,185 [1] DEBUG - Statement Id: [DAO00014_GetChanDoan] Types: [@param0=[Int64, System.Int64]]
2020-01-02 17:50:57,214 [1] DEBUG - Statement Id: [DAO00016_GetDSThuocDaDungByTiepNhan] PreparedStatement : [select A.*, dc.TENDUOCDAYDU        from TT_NGOAITRU_TOATHUOC A        left join TM_DUOC dc on A.DUOC_ID = dc.DUOC_ID        where exists (select KHAMBENH_ID from TT_NGOAITRU_KHAMBENH where A.KHAMBENH_ID = KHAMBENH_ID and  TIEPNHAN_ID = '28494')        and exists (select KHAMBENH_TOATHUOC_ID from TT_NGOAITRU_KHAMBENH_TOATHUOC where A.KHAMBENH_TOATHUOC_ID = KHAMBENH_TOATHUOC_ID and CHUNGTUPHATTHUOC_ID is not null)        and A.BENHVIEN_ID = 'HLU01']
2020-01-02 17:50:57,249 [1] DEBUG - Statement Id: [DAO00067_GetDanhsachDichvuDungChoChuyentuyen] PreparedStatement : [select A.DICHVU_ID, B.TENDICHVU, A.DVYEUCAU_ID        from TT_DVYEUCAU A        left join TM_DICHVU B on A.DICHVU_ID = B.DICHVU_ID        left join TM_NHOMDICHVU C on C.NHOMDICHVU_ID = B.NHOMDICHVU_ID        where        ( @param0  IS NOT NULL OR  @param1  IS NOT NULL) AND        LEFT(C.MANHOMDICHVU,2) in ('01', '02', '05', '06') and A.HUYYEUCAU = '0'         and           A.TIEPNHAN_ID = '28494']
2020-01-02 17:50:57,249 [1] DEBUG - Statement Id: [DAO00067_GetDanhsachDichvuDungChoChuyentuyen] Parameters: [@param0=[BENHAN_ID,null], @param1=[TIEPNHAN_ID,28494]]
2020-01-02 17:50:57,249 [1] DEBUG - Statement Id: [DAO00067_GetDanhsachDichvuDungChoChuyentuyen] Types: [@param0=[System.DBNull, null], @param1=[Int64, System.Int64]]
2020-01-02 17:50:57,276 [1] DEBUG - Statement Id: [DAO00067_GetDanhsachxetnghiemkq] PreparedStatement : [select distinct C.CLSKETQUACHITIET_ID, B.TENDICHVU, C.KETQUA, C.DICHVU_ID, A.DVYEUCAU_ID        from TT_DVYEUCAU A        inner join TT_CLSKETQUACHITIET C on C.DVYEUCAU_ID = A.DVYEUCAU_ID        left join TM_DICHVU B on C.DICHVU_ID = B.DICHVU_ID        where A.HUYYEUCAU = '0' and A.BENHAN_ID is not null                 AND ( @param0  IS NOT NULL OR  @param1  IS NOT NULL)         and           A.TIEPNHAN_ID = '28494'                 order by C.CLSKETQUACHITIET_ID]
2020-01-02 17:50:57,305 [1] DEBUG - Statement Id: [DAO00067_GetDanhsachxetnghiemkq] Parameters: [@param0=[BENHAN_ID,null], @param1=[TIEPNHAN_ID,28494]]
2020-01-02 17:50:57,306 [1] DEBUG - Statement Id: [DAO00067_GetDanhsachxetnghiemkq] Types: [@param0=[System.DBNull, null], @param1=[Int64, System.Int64]]
2020-01-02 17:50:57,331 [1] DEBUG - Statement Id: [DAO00067_GetDanhsachsieuamkq] PreparedStatement : [select C.DVYEUCAU_ID, B.TENDICHVU,C.KETLUAN        from TT_DVYEUCAU A        inner join TT_CLSKETQUA C on C.DVYEUCAU_ID = A.DVYEUCAU_ID        left join TM_DICHVU B on C.DICHVU_ID = B.DICHVU_ID        where        ( @param0  IS NOT NULL OR  @param1  IS NOT NULL) AND                 A.DVYEUCAU_ID not in        (select DVYEUCAU_ID from TT_CLSKETQUACHITIET        where exists (        select DVYEUCAU_ID from TT_DVYEUCAU where TT_CLSKETQUACHITIET.DVYEUCAU_ID = DVYEUCAU_ID                 ))         and           A.TIEPNHAN_ID = 28494]
2020-01-02 17:50:57,331 [1] DEBUG - Statement Id: [DAO00067_GetDanhsachsieuamkq] Parameters: [@param0=[BENHAN_ID,null], @param1=[TIEPNHAN_ID,28494]]
2020-01-02 17:50:57,332 [1] DEBUG - Statement Id: [DAO00067_GetDanhsachsieuamkq] Types: [@param0=[System.DBNull, null], @param1=[Int64, System.Int64]]
2020-01-02 17:52:22,096 [1] DEBUG - Statement Id: [DAO00014_GetChitietDVYeucauKhamBenh] PreparedStatement : [select *        from TT_DVYEUCAU        where DVYEUCAU_ID  = '206520']
2020-01-02 17:52:22,134 [1] DEBUG - Statement Id: [DAO00014_GetPatientStatus] PreparedStatement : [select        CASE        when tn.TRANGTHAI = 'HOANTHANH' Then tn.TRANGTHAI        WHEN xncp.XACNHANCHIPHI_ID is not null THEN 'XACNHANCHIPHI'        WHEN (tn.KHOADULIEU = '1') THEN 'KHOADULIEU'        ELSE tn.TRANGTHAI        END        as TRANGTHAI        from TT_TIEPNHAN tn        left join TT_XACNHANCHIPHI xncp on tn.TIEPNHAN_ID = xncp.TIEPNHAN_ID        where tn.TIEPNHAN_ID = '28494'        and tn.BENHVIEN_ID = 'HLU01']
2020-01-02 17:52:22,252 [1] DEBUG - Statement Id: [DAO00014_GetThongtinKhamsuckhoeTheoDVyc] PreparedStatement : [select HOPDONG_ID, HOPDONG_BENHNHAN_ID from TT_DVYEUCAU where DVYEUCAU_ID =  @param0]
2020-01-02 17:52:22,252 [1] DEBUG - Statement Id: [DAO00014_GetThongtinKhamsuckhoeTheoDVyc] Parameters: [@param0=[DVYEUCAU_ID,206520]]
2020-01-02 17:52:22,253 [1] DEBUG - Statement Id: [DAO00014_GetThongtinKhamsuckhoeTheoDVyc] Types: [@param0=[Int64, System.Int64]]
2020-01-02 17:52:22,364 [1] DEBUG - Statement Id: [DAO00009_TT_TIEPNHAN_GetProcess] PreparedStatement : [select PROCESS_ID from TT_TIEPNHAN where SOTIEPNHAN = 'TN200102.0000002']
2020-01-02 17:52:22,454 [1] DEBUG - Statement Id: [DAOWF004_laytrangthaiDV] PreparedStatement : [select top 1 A.CURR_STATE_CODE as STATE_CODE, isNull(C.SHORT_NAME,C.NAME) as TRANGTHAI, C.NAME as TRANGTHAI_CHITIET, C.STATUS_CODE, D.ISACTIVE as ACTIVE, E.STATUS_CODE  as OLD_STATUSCODE        from TT_REQUEST_SERVICE_DETAIL A                left join (select * from TT_REQUEST_SERVICE where PARA = '{"DICHVU_ID":"5492","DVYEUCAU_ID":"206520"}') D on D.ID = A.REQUEST_SERVICE_ID        left join TM_STATE C on A.CURR_STATE_CODE = C.STATE_CODE and C.PROCESS_CODE = D.PROCESS_CODE        left join TM_STATE E on A.OLD_STATE_CODE = E.STATE_CODE and E.PROCESS_CODE = D.PROCESS_CODE        where        A.REQUEST_SERVICE_ID = (select top 1 ID from TT_REQUEST_SERVICE where PARA = '{"DICHVU_ID":"5492","DVYEUCAU_ID":"206520"}' order by ID desc)        order by A.ID desc]
2020-01-02 17:52:22,619 [1] DEBUG - Statement Id: [DAO00014_CheckExistNhapVien] PreparedStatement : [select NHAPVIEN_ID        from TT_NOITRU_NHAPVIEN        where TIEPNHAN_ID  = '28494'        and TRANGTHAI != 'CHOXACNHAN']
2020-01-02 17:52:22,649 [1] DEBUG - Statement Id: [DAO00014_CheckExistCapCuu] PreparedStatement : [select THONGTINCAPCUU_ID        from TT_TIEPNHAN_THONGTINCAPCUU        where TIEPNHAN_ID  = '28494' and BENHVIEN_ID = 'HLU01']
2020-01-02 17:52:22,673 [1] DEBUG - Statement Id: [DAO00014_CheckExistChuyenVien] PreparedStatement : [select CHUYENVIEN_ID        from TT_CHUYENVIEN        where TIEPNHAN_ID  = '28494']
2020-01-02 17:52:22,699 [1] DEBUG - Statement Id: [DAO00014_GetTrangThaiTiepNhan] PreparedStatement : [select tn.TIEPNHAN_ID, tn.KHOADULIEU, xncp.XACNHANCHIPHI_ID from TT_TIEPNHAN tn        left join TT_XACNHANCHIPHI xncp        on tn.TIEPNHAN_ID = xncp.TIEPNHAN_ID        where tn.TIEPNHAN_ID = '28494'        and tn.BENHVIEN_ID = 'HLU01']
2020-01-02 17:52:22,743 [1] DEBUG - Statement Id: [DAO00014_GetListToaThuoc] PreparedStatement : [select A.*        from TT_NGOAITRU_KHAMBENH_TOATHUOC A        where A.KHAMBENH_ID = '27177']
2020-01-02 17:52:22,791 [1] DEBUG - Statement Id: [DAOLOG01_LockBegin] PreparedStatement : [INSERT into TT_LOG_UPDATE ( REF_TABLE , REF_ID , BENHVIEN_ID )         values ( @param0 ,  @param1 ,  @param2 );]
2020-01-02 17:52:22,793 [1] DEBUG - Statement Id: [DAOLOG01_LockBegin] Parameters: [@param0=[REF_TABLE,TT_NGOAITRU_KHAMBENH], @param1=[REF_ID,28494], @param2=[BENHVIEN_ID,HLU01]]
2020-01-02 17:52:22,793 [1] DEBUG - Statement Id: [DAOLOG01_LockBegin] Types: [@param0=[String, System.String], @param1=[Int64, System.Int64], @param2=[String, System.String]]
2020-01-02 17:52:22,840 [1] DEBUG - Statement Id: [DAO00014_GetTTNhapVien] PreparedStatement : [select *        from TT_NOITRU_NHAPVIEN        where TIEPNHAN_ID  = '28494']
2020-01-02 17:52:22,893 [1] DEBUG - Statement Id: [DAO00014_GetTTDVYeucauOPD] PreparedStatement : [select A.KHAMBENH_NGOAITRU_ID, B.KHAMBENH_ID        from TT_DVYEUCAU A        left join TT_NGOAITRU_KHAMBENH B on A.KHAMBENH_NGOAITRU_ID = B.KHAMBENH_ID        where A.DVYEUCAU_ID = '206520' and A.TIEPNHAN_ID =  @param0]
2020-01-02 17:52:22,893 [1] DEBUG - Statement Id: [DAO00014_GetTTDVYeucauOPD] Parameters: [@param0=[TIEPNHAN_ID,28494]]
2020-01-02 17:52:22,893 [1] DEBUG - Statement Id: [DAO00014_GetTTDVYeucauOPD] Types: [@param0=[String, System.String]]
2020-01-02 17:52:22,925 [1] DEBUG - Statement Id: [DAO00014_Update] PreparedStatement : [update TT_NGOAITRU_KHAMBENH set        BENHNHAN_ID =  @param0         , DICHVU_ID =  @param1                 , NGAYKHAM =  @param2         , CHANDOANICD_ID =  @param3         , HUONGGIAIQUYET_ID =  @param4                 , YEUCAUCHITIET_ID =  @param5         , CHANDOANKHOAKHAM =  @param6         , SONGAYHENTAIKHAM =  @param7         , NHANAP_MT =  @param8         , NHANAP_MP =  @param9         , CHANDOANPHUICD_ID =  @param10         , TRIEUCHUNGLAMSANG =  @param11         , HUYETAPTHAP =  @param12         , HUYETAPCAO =  @param13         , BENHMANTINH_ID =  @param14         , NHAPKHOA_ID =  @param15         , CHANDOANSOBOICD_ID =  @param16         , CHANDOANSOBO =  @param17         , CHUYENDENBENHVIEN_ID =  @param18         , LYDONHAPVIEN_ID =  @param19         , NGHIOM_TUNGAY =  @param20         , NGHIOM_DENNGAY =  @param21         , TLDG_MT_TEXT =  @param22         , TLDG_MP_TEXT =  @param23         , TKLT_MP_TEXT =  @param24         , TKLT_MT_TEXT =  @param25         , SIEUHIENVI =  @param26         , SOIDAYMAT =  @param27         , MACH =  @param28         , CANNANG =  @param29         , CHIEUCAO =  @param30         , BMI =  @param31         , NHIPTHO =  @param32         , NHIETDO =  @param33         , GHICHU =  @param34         , KHOADULIEU =  @param35         , NGUOIKHOA_ID =  @param36         , NGAYKHOA =  @param37         , THOIGIANKHOA =  @param38         , NGAYCAPNHAT =  @param39         , NGUOICAPNHAT_ID =  @param40         , KHAMBENH_SINHHIEU_ID =  @param41         where        KHAMBENH_ID =  @param42]
2020-01-02 17:52:22,925 [1] DEBUG - Statement Id: [DAO00014_Update] Parameters: [@param0=[BENHNHAN_ID,24442], @param1=[DICHVU_ID,5492], @param2=[NGAYKHAM,1/2/2020 12:00:00 AM], @param3=[CHANDOANICD_ID,3990], @param4=[HUONGGIAIQUYET_ID,8343], @param5=[YEUCAUCHITIET_ID,null], @param6=[CHANDOANKHOAKHAM,Viêm phế quản cấp(J20)], @param7=[SONGAYHENTAIKHAM,null], @param8=[NHANAP_MT,null], @param9=[NHANAP_MP,null], @param10=[CHANDOANPHUICD_ID,null], @param11=[TRIEUCHUNGLAMSANG,test 2], @param12=[HUYETAPTHAP,null], @param13=[HUYETAPCAO,null], @param14=[BENHMANTINH_ID,null], @param15=[NHAPKHOA_ID,null], @param16=[CHANDOANSOBOICD_ID,null], @param17=[CHANDOANSOBO,], @param18=[CHUYENDENBENHVIEN_ID,null], @param19=[LYDONHAPVIEN_ID,null], @param20=[NGHIOM_TUNGAY,null], @param21=[NGHIOM_DENNGAY,null], @param22=[TLDG_MT_TEXT,], @param23=[TLDG_MP_TEXT,], @param24=[TKLT_MP_TEXT,], @param25=[TKLT_MT_TEXT,], @param26=[SIEUHIENVI,], @param27=[SOIDAYMAT,], @param28=[MACH,null], @param29=[CANNANG,null], @param30=[CHIEUCAO,null], @param31=[BMI,null], @param32=[NHIPTHO,null], @param33=[NHIETDO,null], @param34=[GHICHU,], @param35=[KHOADULIEU,0], @param36=[NGUOIKHOA_ID,null], @param37=[NGAYKHOA,null], @param38=[THOIGIANKHOA,null], @param39=[NGAYCAPNHAT,1/2/2020 5:52:22 PM], @param40=[NGUOICAPNHAT_ID,1], @param41=[KHAMBENH_SINHHIEU_ID,0], @param42=[KHAMBENH_ID,27177]]
2020-01-02 17:52:22,925 [1] DEBUG - Statement Id: [DAO00014_Update] Types: [@param0=[Int64, System.Int64], @param1=[Int64, System.Int64], @param2=[DateTime, System.DateTime], @param3=[String, System.String], @param4=[String, System.String], @param5=[System.DBNull, null], @param6=[String, System.String], @param7=[System.DBNull, null], @param8=[System.DBNull, null], @param9=[System.DBNull, null], @param10=[System.DBNull, null], @param11=[String, System.String], @param12=[System.DBNull, null], @param13=[System.DBNull, null], @param14=[System.DBNull, null], @param15=[System.DBNull, null], @param16=[System.DBNull, null], @param17=[String, System.String], @param18=[System.DBNull, null], @param19=[System.DBNull, null], @param20=[System.DBNull, null], @param21=[System.DBNull, null], @param22=[String, System.String], @param23=[String, System.String], @param24=[String, System.String], @param25=[String, System.String], @param26=[String, System.String], @param27=[String, System.String], @param28=[System.DBNull, null], @param29=[System.DBNull, null], @param30=[System.DBNull, null], @param31=[System.DBNull, null], @param32=[System.DBNull, null], @param33=[System.DBNull, null], @param34=[String, System.String], @param35=[String, System.String], @param36=[System.DBNull, null], @param37=[System.DBNull, null], @param38=[System.DBNull, null], @param39=[DateTime, System.DateTime], @param40=[Int64, System.Int64], @param41=[Int64, System.Int64], @param42=[Int64, System.Int64]]
2020-01-02 17:52:22,973 [1] DEBUG - Statement Id: [DAO00014_CheckExistHenTaiKHam] PreparedStatement : [select KHAMBENH_HENTAIKHAM        from TT_NGOAITRU_KHAMBENH_HENTK        where KHAMBENH_ID  = '27177']
2020-01-02 17:52:22,997 [1] DEBUG - Statement Id: [DAO00020_UpdateKhamBenhIDInDVYC] PreparedStatement : [update TT_DVYEUCAU        set KHAMBENH_NGOAITRU_ID =  @param0                 , TRANGTHAI =  @param1         , NGUOICAPNHAT_ID =  @param2         , NGAYCAPNHAT =  @param3         where TIEPNHAN_ID = 28494        and DVYEUCAU_ID = 206520                update TT_VIENPHI        set DATHUCHIEN =  @param4         , NGUOICAPNHAT_ID =  @param2         , NGAYCAPNHAT =  @param3         where REF_ID = 206520        and REF_TABLE = 'TT_DVYEUCAU']
2020-01-02 17:52:22,997 [1] DEBUG - Statement Id: [DAO00020_UpdateKhamBenhIDInDVYC] Parameters: [@param0=[KHAMBENH_ID,27177], @param1=[TRANGTHAI,DANGTHUCHIEN], @param2=[NGUOICAPNHAT_ID,1], @param3=[NGAYCAPNHAT,1/2/2020 5:52:22 PM], @param4=[DATHUCHIEN,1]]
2020-01-02 17:52:22,997 [1] DEBUG - Statement Id: [DAO00020_UpdateKhamBenhIDInDVYC] Types: [@param0=[Int32, System.Int32], @param1=[String, System.String], @param2=[Int64, System.Int64], @param3=[DateTime, System.DateTime], @param4=[Int32, System.Int32]]
2020-01-02 17:52:23,045 [1] DEBUG - Statement Id: [DAO00023_GetSOBHYT_HUONG_ID] PreparedStatement : [select isnull(MAX(SOBHYT_HUONG_ID),0) SOBHYT_HUONG_ID        from TT_TIEPNHAN_SOTHEBHYT        where TIEPNHAN_ID = '28494']
2020-01-02 17:52:23,073 [1] DEBUG - Statement Id: [DAO00062_GetAllPhamviKhoDuoc] PreparedStatement : [select distinct dmap.*        from TM_DUOC_PHAMVISD_MAPPING dmap        left join TM_DUOC_PHAMVISUDUNG dpv on dpv.PHAMVI_ID = dmap.PHAMVI_ID]
2020-01-02 17:52:23,101 [1] DEBUG - Statement Id: [DAO00062_GetKhoDuocNhaThuoc] PreparedStatement : [select * from TM_KHODUOC where MAKHO = 'KHO_NT']
2020-01-02 17:52:23,127 [1] DEBUG - Statement Id: [DAO00049_KiemtraloaiDV] PreparedStatement : [select DICHVU_ID AS HA, '' AS XN, '' as TDCN, '' as TT, '' as KB from TM_DICHVU            left join TM_NHOMDICHVU ndv on ndv.NHOMDICHVU_ID = TM_DICHVU.NHOMDICHVU_ID            where DICHVU_ID = '5492' and left(ndv.MANHOMDICHVU, 2) = '02'            union            select  '' as HA, DICHVU_ID AS XN, '' as TDCN, '' as TT, '' as KB from TM_DICHVU            left join TM_NHOMDICHVU ndv on ndv.NHOMDICHVU_ID = TM_DICHVU.NHOMDICHVU_ID            where DICHVU_ID = '5492' and left(ndv.MANHOMDICHVU, 2) = '01'            union            select  '' as HA, '' AS XN, DICHVU_ID as TDCN, '' as TT, '' as KB from TM_DICHVU            left join TM_NHOMDICHVU ndv on ndv.NHOMDICHVU_ID = TM_DICHVU.NHOMDICHVU_ID            where DICHVU_ID = '5492' and left(ndv.MANHOMDICHVU, 2) = '03'            union            select  '' as HA, '' AS XN, '' as TDCN, DICHVU_ID as TT, '' as KB from TM_DICHVU            left join TM_NHOMDICHVU ndv on ndv.NHOMDICHVU_ID = TM_DICHVU.NHOMDICHVU_ID            where DICHVU_ID = '5492' and left(ndv.MANHOMDICHVU, 2) = '05'            union            select  '' as HA, '' AS XN, '' as TDCN, DICHVU_ID as TT, '' as KB from TM_DICHVU            left join TM_NHOMDICHVU ndv on ndv.NHOMDICHVU_ID = TM_DICHVU.NHOMDICHVU_ID            where DICHVU_ID = '5492' and left(ndv.MANHOMDICHVU, 2) = '06'            union            select  '' as HA, '' AS XN, '' as TDCN, '' as TT, DICHVU_ID as KB from TM_DICHVU            left join TM_NHOMDICHVU ndv on ndv.NHOMDICHVU_ID = TM_DICHVU.NHOMDICHVU_ID            where DICHVU_ID = '5492' and left(ndv.MANHOMDICHVU, 2) = '04']
2020-01-02 17:52:23,157 [1] DEBUG - Statement Id: [DAO00009_GetThutiensauDVThuthuatKhamBenh] PreparedStatement : [select A.THUTIENSAU, B.SOTIEPNHAN, A.DICHVU_ID, A.DVYEUCAU_ID        from TT_DVYEUCAU A        inner join TT_TIEPNHAN B on B.TIEPNHAN_ID = A.TIEPNHAN_ID        left join TT_NGOAITRU_KHAMBENH C on A.TIEPNHAN_ID = C.TIEPNHAN_ID and A.DICHVU_ID = C.DICHVU_ID        where        C.KHAMBENH_ID = '27177']
2020-01-02 17:52:23,199 [1] DEBUG - Statement Id: [DAO00009_TT_TIEPNHAN_GetProcess] PreparedStatement : [select PROCESS_ID from TT_TIEPNHAN where SOTIEPNHAN = 'TN200102.0000002']
2020-01-02 17:52:23,241 [1] DEBUG - Statement Id: [DAOWF001_Kiemtrathongtindayeucaureturn] PreparedStatement : [select * from TT_REQUEST        where        PARA = '{"HOSPITAL_ID":"HLU01","SOTIEPNHAN":"TN200102.0000002"}']
2020-01-02 17:52:23,320 [1] DEBUG - Statement Id: [DAOWF001_Kiemtrathongtindichvudayeucaureturn] PreparedStatement : [select top 1 * from TT_REQUEST_SERVICE        where        PARA = '{"DICHVU_ID":"5492","DVYEUCAU_ID":"206520"}'  order by ID desc]
2020-01-02 17:52:23,349 [1] DEBUG - Statement Id: [DAOWF005_ReturnStateCuaDichVuYeuCau] PreparedStatement : [declare        @Detail_Id int,        @CurentState char(8),        @OldState char(8)          select top 1 @Detail_Id = ID, @CurentState = OLD_STATE_CODE, @OldState = CURR_STATE_CODE from TT_REQUEST_SERVICE_DETAIL        where        REQUEST_ID = '32794'        AND REQUEST_SERVICE_ID = '148396'        order by ID desc;          update TT_REQUEST_SERVICE set CURR_STATE_CODE = @CurentState, ISACTIVE = 1, ISCOMPLETE = 0 where ID = '148396';        delete from TT_REQUEST_SERVICE_DETAIL where ID = @Detail_Id;        insert into TT_REQUEST_SERVICE_HISTORY        (REQUEST_ID,REQUEST_SERVICE_ID, OLD_STATE_CODE, CURR_STATE_CODE) values ('32794','148396',@OldState, @CurentState);        select top 1 A.*, B.STATUS_CODE from TT_REQUEST_SERVICE A        left join TM_STATE B on A.CURR_STATE_CODE = B.STATE_CODE and A.PROCESS_CODE = B.PROCESS_CODE        where A.ID = '148396';]
2020-01-02 17:52:23,439 [1] DEBUG - Statement Id: [DAO00009_TT_DVYEUCAU_Update] PreparedStatement : [Update TT_DVYEUCAU set TRANGTHAI_WFL = 'CHUAKETQUA' where DVYEUCAU_ID = '206520']
2020-01-02 17:52:23,475 [1] DEBUG - Statement Id: [DAO00049_KiemtraloaiDV] PreparedStatement : [select DICHVU_ID AS HA, '' AS XN, '' as TDCN, '' as TT, '' as KB from TM_DICHVU            left join TM_NHOMDICHVU ndv on ndv.NHOMDICHVU_ID = TM_DICHVU.NHOMDICHVU_ID            where DICHVU_ID = '5492' and left(ndv.MANHOMDICHVU, 2) = '02'            union            select  '' as HA, DICHVU_ID AS XN, '' as TDCN, '' as TT, '' as KB from TM_DICHVU            left join TM_NHOMDICHVU ndv on ndv.NHOMDICHVU_ID = TM_DICHVU.NHOMDICHVU_ID            where DICHVU_ID = '5492' and left(ndv.MANHOMDICHVU, 2) = '01'            union            select  '' as HA, '' AS XN, DICHVU_ID as TDCN, '' as TT, '' as KB from TM_DICHVU            left join TM_NHOMDICHVU ndv on ndv.NHOMDICHVU_ID = TM_DICHVU.NHOMDICHVU_ID            where DICHVU_ID = '5492' and left(ndv.MANHOMDICHVU, 2) = '03'            union            select  '' as HA, '' AS XN, '' as TDCN, DICHVU_ID as TT, '' as KB from TM_DICHVU            left join TM_NHOMDICHVU ndv on ndv.NHOMDICHVU_ID = TM_DICHVU.NHOMDICHVU_ID            where DICHVU_ID = '5492' and left(ndv.MANHOMDICHVU, 2) = '05'            union            select  '' as HA, '' AS XN, '' as TDCN, DICHVU_ID as TT, '' as KB from TM_DICHVU            left join TM_NHOMDICHVU ndv on ndv.NHOMDICHVU_ID = TM_DICHVU.NHOMDICHVU_ID            where DICHVU_ID = '5492' and left(ndv.MANHOMDICHVU, 2) = '06'            union            select  '' as HA, '' AS XN, '' as TDCN, '' as TT, DICHVU_ID as KB from TM_DICHVU            left join TM_NHOMDICHVU ndv on ndv.NHOMDICHVU_ID = TM_DICHVU.NHOMDICHVU_ID            where DICHVU_ID = '5492' and left(ndv.MANHOMDICHVU, 2) = '04']
2020-01-02 17:52:23,501 [1] DEBUG - Statement Id: [DAO00009_GetThutiensauDVThuthuat] PreparedStatement : [select A.THUTIENSAU, B.SOTIEPNHAN, A.DICHVU_ID, A.DVYEUCAU_ID        from TT_DVYEUCAU A        inner join TT_TIEPNHAN B on B.TIEPNHAN_ID = A.TIEPNHAN_ID        where        A.DVYEUCAU_ID = '206520']
2020-01-02 17:52:23,525 [1] DEBUG - Statement Id: [DAO00009_TT_TIEPNHAN_GetProcess] PreparedStatement : [select PROCESS_ID from TT_TIEPNHAN where SOTIEPNHAN = 'TN200102.0000002']
2020-01-02 17:52:23,562 [1] DEBUG - Statement Id: [DAOWF001_Kiemtrathongtindayeucaudacochua] PreparedStatement : [select * from TT_REQUEST        where        PARA = '{"HOSPITAL_ID":"HLU01","SOTIEPNHAN":"TN200102.0000002"}'        AND ISACTIVE = '1']
2020-01-02 17:52:23,607 [1] DEBUG - Statement Id: [DAOWF001_Kiemtrathongtindichvudayeucau] PreparedStatement : [select top 1 * from TT_REQUEST_SERVICE        where        PARA = '{"DICHVU_ID":"5492","DVYEUCAU_ID":"206520"}'                AND ISACTIVE = '1' order by ID desc]
2020-01-02 17:52:23,632 [1] DEBUG - Statement Id: [DAOWF001_KiemtrathongtinchitietDichvuYeucau] PreparedStatement : [select * from TT_REQUEST_SERVICE_DETAIL        where        REQUEST_SERVICE_ID = '148396']
2020-01-02 17:52:23,695 [1] DEBUG - Statement Id: [DAOWF001_Laythongtinwithstatecode] PreparedStatement : [select A.*, B.STATUS_CODE from        TM_STATE_ACTION A        left join TM_STATE B on B.STATE_CODE = A.NEXT_STATE_CODE and A.PROCESS_CODE = B.PROCESS_CODE        where        A.CURR_STATE_CODE = '0     '        AND A.PROCESS_CODE = 'P02'        Order By ORDER_ID ASC]
2020-01-02 17:52:23,727 [1] DEBUG - Statement Id: [DAOWF003_Update] PreparedStatement : [update TT_REQUEST_SERVICE set        CURR_STATE_CODE =  @param0                   , ISACTIVE =  @param1                     , ISCOMPLETE =  @param2                        where        ID = '148396']
2020-01-02 17:52:23,727 [1] DEBUG - Statement Id: [DAOWF003_Update] Parameters: [@param0=[CURR_STATE_CODE,3], @param1=[ISACTIVE,1], @param2=[ISCOMPLETE,0]]
2020-01-02 17:52:23,727 [1] DEBUG - Statement Id: [DAOWF003_Update] Types: [@param0=[String, System.String], @param1=[String, System.String], @param2=[String, System.String]]
2020-01-02 17:52:23,758 [1] DEBUG - Statement Id: [DAOWF005_Add] PreparedStatement : [insert into TT_REQUEST_SERVICE_DETAIL (        REQUEST_ID        ,REQUEST_SERVICE_ID        , OLD_STATE_CODE        , CURR_STATE_CODE        ) values (         @param0         , @param1         ,  @param2         ,  @param3         )        SELECT SCOPE_IDENTITY()]
2020-01-02 17:52:23,758 [1] DEBUG - Statement Id: [DAOWF005_Add] Parameters: [@param0=[REQUEST_ID,32794], @param1=[REQUEST_SERVICE_ID,148396], @param2=[OLD_STATE_CODE,0     ], @param3=[CURR_STATE_CODE,3]]
2020-01-02 17:52:23,758 [1] DEBUG - Statement Id: [DAOWF005_Add] Types: [@param0=[String, System.String], @param1=[Int32, System.Int32], @param2=[String, System.String], @param3=[String, System.String]]
2020-01-02 17:52:23,784 [1] DEBUG - Statement Id: [DAOWF005_Add_History] PreparedStatement : [insert into TT_REQUEST_SERVICE_HISTORY (        REQUEST_ID        ,REQUEST_SERVICE_ID        , OLD_STATE_CODE        , CURR_STATE_CODE        ) values (         @param0         , @param1         ,  @param2         ,  @param3         )]
2020-01-02 17:52:23,784 [1] DEBUG - Statement Id: [DAOWF005_Add_History] Parameters: [@param0=[REQUEST_ID,32794], @param1=[REQUEST_SERVICE_ID,148396], @param2=[OLD_STATE_CODE,0     ], @param3=[CURR_STATE_CODE,3]]
2020-01-02 17:52:23,784 [1] DEBUG - Statement Id: [DAOWF005_Add_History] Types: [@param0=[String, System.String], @param1=[Int32, System.Int32], @param2=[String, System.String], @param3=[String, System.String]]
2020-01-02 17:52:23,823 [1] DEBUG - Statement Id: [DAO00009_TT_DVYEUCAU_Update] PreparedStatement : [Update TT_DVYEUCAU set TRANGTHAI_WFL = 'DANGTHUCHIEN' where DVYEUCAU_ID = '206520']
2020-01-02 17:52:23,848 [1] DEBUG - Statement Id: [DAO00026_GetListDanhSachDichVuGhiNhanVTYT_COM25_WithTN] PreparedStatement : [select distinct CONVERT(VARCHAR(11),C.NGAYYEUCAU,103) as NGAYYEUCAU, C.DICHVU_ID, C.DVYEUCAU_ID, D.TENDICHVU, C.NOITHUCHIEN_ID, A.SOTIEPNHAN, A.TRAITUYEN, A.NGAYMIENDONGCHITRA, A.TIEPNHAN_ID, A.DOITUONG_ID, A.TRANGTHAI,            A.LOAITHANHVIEN_ID, A.SUDUNG_BHTN, A.THE_ID, A.THANHVIEN_ID, A.VIP, A.NGUON_BENHNHAN_ID, A.BAOLANH_VIENPHI,            CASE WHEN (A.TRANGTHAI = 'NOITRU' OR A.TRANGTHAI = 'CAPCUU') THEN 'IN' ELSE 'OUT' END AS LOAIBENHAN,            CASE WHEN (C.TRANGTHAI = 'CHUAKETQUA') THEN 'CHUAKETQUA' ELSE 'HOANTAT' END AS TRANGTHAIDICHVU,            B.*, isnull(ntba.SOBENHAN, '') SOBENHAN, isnull(ntba.BENHAN_ID, 0) BENHAN_ID,            CASE WHEN Left(E.MANHOMDICHVU,2) = '03' THEN '02' ELSE Left(E.MANHOMDICHVU,2) END AS MANHOMDICHVU            from TT_TIEPNHAN A            inner join TT_BENHNHAN B on B.BENHNHAN_ID = A.BENHNHAN_ID and B.ACTIVE = '1'            inner join TT_DVYEUCAU C on C.TIEPNHAN_ID = A.TIEPNHAN_ID                        left join TM_DICHVU D on D.DICHVU_ID = C.DICHVU_ID            left join TM_NHOMDICHVU E on E.NHOMDICHVU_ID = D.NHOMDICHVU_ID            left join TT_NOITRU_BENHAN ntba on ntba.BENHAN_ID = C.BENHAN_ID              where            C.NGAYHENCLS is NULL and A.BENHVIEN_ID = 'HLU01'            and (A.TRANGTHAI = 'DATIEPNHAN' or A.TRANGTHAI = 'NOITRU' or A.TRANGTHAI = 'CAPCUU' or A.TRANGTHAI = 'NGOAITRU')            and (CASE WHEN Left(E.MANHOMDICHVU,2) = '03' THEN '02' ELSE Left(E.MANHOMDICHVU,2) END in ('02', '04'))            and A.TIEPNHAN_ID = '28494']
2020-01-02 17:52:23,957 [1] DEBUG - Statement Id: [DAOLOG01_LockEnd] PreparedStatement : [DELETE TT_LOG_UPDATE        where REF_TABLE = 'TT_NGOAITRU_KHAMBENH' and REF_ID = '28494' and BENHVIEN_ID = 'HLU01']
2020-01-02 17:52:23,983 [1] DEBUG - Statement Id: [DAO00014_Clear_1ToaThuocKhambenh] PreparedStatement : [DELETE FROM TT_DUOC_TONKHO_BOOK_NGOAITRU where REF_TABLE = 'TT_NGOAITRU_TOATHUOC'        and REF_ID in (        select TOATHUOC_ID from TT_NGOAITRU_TOATHUOC        where             KHAMBENH_TOATHUOC_ID in (select KHAMBENH_TOATHUOC_ID from TT_NGOAITRU_KHAMBENH_TOATHUOC        where TIEPNHAN_ID = '28494' and                   KHAMBENH_ID not in (select KHAMBENH_ID from TT_NGOAITRU_KHAMBENH where  TIEPNHAN_ID = '28494'))        and TIEPNHAN_ID = '28494')          DELETE FROM TT_VIENPHI where REF_TABLE = 'TT_NGOAITRU_TOATHUOC'        and REF_ID in (        select TOATHUOC_ID from TT_NGOAITRU_TOATHUOC        where KHAMBENH_TOATHUOC_ID in (select KHAMBENH_TOATHUOC_ID from TT_NGOAITRU_KHAMBENH_TOATHUOC        where TIEPNHAN_ID = '28494' and KHAMBENH_ID not in (select KHAMBENH_ID from TT_NGOAITRU_KHAMBENH where TIEPNHAN_ID = '28494'))        and TIEPNHAN_ID = '28494')          delete from TT_NGOAITRU_TOATHUOC        where KHAMBENH_TOATHUOC_ID in (select KHAMBENH_TOATHUOC_ID from TT_NGOAITRU_KHAMBENH_TOATHUOC        where TIEPNHAN_ID = '28494' and KHAMBENH_ID not in (select KHAMBENH_ID from TT_NGOAITRU_KHAMBENH where TIEPNHAN_ID = '28494')        and TIEPNHAN_ID = '28494')          delete from TT_NGOAITRU_KHAMBENH_TOATHUOC where TIEPNHAN_ID = '28494'        and KHAMBENH_ID not in (select KHAMBENH_ID from TT_NGOAITRU_KHAMBENH where TIEPNHAN_ID = '28494') and TIEPNHAN_ID = '28494']
2020-01-02 17:52:24,022 [1] DEBUG - Statement Id: [DAO00014_GetKhamBenhInfo] PreparedStatement : [select * from TT_NGOAITRU_KHAMBENH where KHAMBENH_ID =        (select KHAMBENH_NGOAITRU_ID from TT_DVYEUCAU where DVYEUCAU_ID = '206520')]
2020-01-02 17:52:24,050 [1] DEBUG - Statement Id: [DAO00068_GetSinhHieuBySinhHieuID] PreparedStatement : [select top (1) *            from TT_NGOAITRU_KHAMBENH_SINHHIEU            where KHAMBENH_SINHHIEU_ID = '0'            and BENHVIEN_ID = 'HLU01'             and               BENHNHAN_ID = '24442'                           order by KHAMBENH_SINHHIEU_ID]
2020-01-02 17:52:24,075 [1] DEBUG - Statement Id: [DAO00014_GetKhamBenhICDInfo] PreparedStatement : [select *        from TT_NGOAITRU_KHAMBENH_ICD        where KHAMBENH_ID  = '27177']
2020-01-02 17:52:24,101 [1] DEBUG - Statement Id: [DAO00014_GetListToaThuoc] PreparedStatement : [select A.*        from TT_NGOAITRU_KHAMBENH_TOATHUOC A        where A.KHAMBENH_ID = '27177']
2020-01-02 17:52:24,131 [1] DEBUG - Statement Id: [DAO00014_KiemTraDVYCCoGiaBHYT] PreparedStatement : [select *        from TT_VIENPHI        where REF_ID  = '206520' and REF_TABLE = 'TT_DVYEUCAU' and BHYT_DONGIA > 0]
2020-01-02 17:52:24,176 [1] DEBUG - Statement Id: [DAO00040_LayListToaMau] PreparedStatement : [select A.*, dc.TENDUOCDAYDU, dc.BHYT DUOC_BHYT, ld.LOAIVATTU_ID, ld.MALOAIDUOC, dd.DICTIONARY_NAME DUONGDUNG, dc.TAMNGUNG            from TT_TOATHUOCMAU A            left join TM_DUOC dc on A.DUOC_ID = dc.DUOC_ID            left join TM_LOAIDUOC ld on dc.LOAIDUOC_ID = ld.LOAIDUOC_ID            left join (select * from LST_DICTIONARY where DICTIONARY_TYPE_CODE like 'DuongDung') dd on dd.DICTIONARY_ID = dc.DUONGDUNG_ID            where (1=1)             and               A.BACSI_ID  = 1              and A.LOAITOATHUOC in  (                        @param0                   ,                           @param1                   ,                           @param2                   ,                           @param3                   )]
2020-01-02 17:52:24,176 [1] DEBUG - Statement Id: [DAO00040_LayListToaMau] Parameters: [@param0=[LSTLOAITOATHUOC[0],BV], @param1=[LSTLOAITOATHUOC[1],MN], @param2=[LSTLOAITOATHUOC[2],MP], @param3=[LSTLOAITOATHUOC[3],TV]]
2020-01-02 17:52:24,176 [1] DEBUG - Statement Id: [DAO00040_LayListToaMau] Types: [@param0=[String, System.String], @param1=[String, System.String], @param2=[String, System.String], @param3=[String, System.String]]
2020-01-02 17:52:24,275 [1] DEBUG - Statement Id: [DAO00040_LayListToaMau] PreparedStatement : [select A.*, dc.TENDUOCDAYDU, dc.BHYT DUOC_BHYT, ld.LOAIVATTU_ID, ld.MALOAIDUOC, dd.DICTIONARY_NAME DUONGDUNG, dc.TAMNGUNG            from TT_TOATHUOCMAU A            left join TM_DUOC dc on A.DUOC_ID = dc.DUOC_ID            left join TM_LOAIDUOC ld on dc.LOAIDUOC_ID = ld.LOAIDUOC_ID            left join (select * from LST_DICTIONARY where DICTIONARY_TYPE_CODE like 'DuongDung') dd on dd.DICTIONARY_ID = dc.DUONGDUNG_ID            where (1=1)             and               A.BACSI_ID  = 1              and A.LOAITOATHUOC in  (                        @param0                   ,                           @param1                   ,                           @param2                   ,                           @param3                   )]
2020-01-02 17:52:24,275 [1] DEBUG - Statement Id: [DAO00040_LayListToaMau] Parameters: [@param0=[LSTLOAITOATHUOC[0],BV], @param1=[LSTLOAITOATHUOC[1],MN], @param2=[LSTLOAITOATHUOC[2],MP], @param3=[LSTLOAITOATHUOC[3],TV]]
2020-01-02 17:52:24,275 [1] DEBUG - Statement Id: [DAO00040_LayListToaMau] Types: [@param0=[String, System.String], @param1=[String, System.String], @param2=[String, System.String], @param3=[String, System.String]]
2020-01-02 17:52:24,322 [1] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoVaBookingCOM23UpdateRedis_TheoPhamvi] PreparedStatement : [declare @TOAMUANGOAI int = 0;        select @TOAMUANGOAI = isnull(VALUE,0) from TM_SYS_APPSETTINGS where CODE = 'OPD_TOAMUANGOAI_DUNGDANHMUC_DUOC'                if @TOAMUANGOAI = 1        begin        select  distinct '0' + '_' + LTRIM(d.DUOC_ID) + '_' + '0' as DUOC_KEY, 999999999 as SOLUONG        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        where  @param0  = 0        union all        select distinct tk.DUOC_KEY, tk.SOLUONG        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        inner join        (        select  LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')) DUOC_KEY, (SUM(dtk.SOLUONG) - isnull(sum(A.SOLUONG),0) - isnull(sum(B.SOLUONG),0)) SOLUONG, pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        from (select sum(soluong) soluong,duoc_id,nguonduoc_id,khoduoc_id,benhvien_id from TT_DUOC_TONKHO  group by duoc_id,nguonduoc_id,khoduoc_id,benhvien_id) dtk        inner join TM_DUOC_PHAMVISD_MAPPING pvsd on dtk.KHODUOC_ID = pvsd.KHODUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NOITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) B on B.DUOC_ID = dtk.DUOC_ID and B.PHAMVI_ID = pvsd.PHAMVI_ID and B.NGUONHANG_ID = dtk.NGUONDUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NGOAITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) A on A.DUOC_ID = dtk.DUOC_ID and A.PHAMVI_ID = pvsd.PHAMVI_ID and A.NGUONHANG_ID = dtk.NGUONDUOC_ID        where dtk.BENHVIEN_ID = 'HLU01'        group by LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')), pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        ) tk on tk.DUOC_ID = d.DUOC_ID        left join TM_DUOC_PHAMVISUDUNG kd on kd.PHAMVI_ID = tk.PHAMVI_ID and kd.BENHVIEN_ID = 'HLU01'        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = tk.NGUONDUOC_ID and nh.BENHVIEN_ID = 'HLU01'        where d.BENHVIEN_ID = 'HLU01' and tk.PHAMVI_ID =  @param0         end        else        begin        select distinct tk.DUOC_KEY, tk.SOLUONG        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        inner join        (        select  LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')) DUOC_KEY, (SUM(dtk.SOLUONG) - isnull(sum(A.SOLUONG),0) - isnull(sum(B.SOLUONG),0)) SOLUONG, pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        from (select sum(soluong) soluong,duoc_id,nguonduoc_id,khoduoc_id,benhvien_id from TT_DUOC_TONKHO  group by duoc_id,nguonduoc_id,khoduoc_id,benhvien_id) dtk        inner join TM_DUOC_PHAMVISD_MAPPING pvsd on dtk.KHODUOC_ID = pvsd.KHODUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NOITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) B on B.DUOC_ID = dtk.DUOC_ID and B.PHAMVI_ID = pvsd.PHAMVI_ID and B.NGUONHANG_ID = dtk.NGUONDUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NGOAITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) A on A.DUOC_ID = dtk.DUOC_ID and A.PHAMVI_ID = pvsd.PHAMVI_ID and A.NGUONHANG_ID = dtk.NGUONDUOC_ID        where dtk.BENHVIEN_ID = 'HLU01'        group by LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')), pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        ) tk on tk.DUOC_ID = d.DUOC_ID        left join TM_DUOC_PHAMVISUDUNG kd on kd.PHAMVI_ID = tk.PHAMVI_ID and kd.BENHVIEN_ID = 'HLU01'        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = tk.NGUONDUOC_ID and nh.BENHVIEN_ID = 'HLU01'        where d.BENHVIEN_ID = 'HLU01' and tk.PHAMVI_ID =  @param0         end]
2020-01-02 17:52:24,322 [1] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoVaBookingCOM23UpdateRedis_TheoPhamvi] Parameters: [@param0=[PHAMVI_ID,1028]]
2020-01-02 17:52:24,322 [1] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoVaBookingCOM23UpdateRedis_TheoPhamvi] Types: [@param0=[Int64, System.Int64]]
2020-01-02 17:52:24,771 [1] DEBUG - Statement Id: [DAO00064_GetlistTT_TIEPNHAN_SOTHEBHYT] PreparedStatement : [select stbhyt.*, ba.SOBENHAN,        tn.SOTIEPNHAN, tn.LOAITHANHVIEN_ID, tn.THE_ID, tn.THANHVIEN_ID,        tn.SUDUNG_BHTN, tn.BAOLANH_VIENPHI, tn.VIP, tn.NGUOINUOCNGOAI        from TT_TIEPNHAN_SOTHEBHYT stbhyt        left join TT_TIEPNHAN tn on tn.TIEPNHAN_ID = stbhyt.TIEPNHAN_ID        left join TT_NOITRU_BENHAN ba on ba.TIEPNHAN_ID = stbhyt.TIEPNHAN_ID        where        stbhyt.TIEPNHAN_ID = '28494' and isnull(stbhyt.KHONGSUDUNG, '0') = '0']
2020-01-02 17:52:24,806 [1] DEBUG - Statement Id: [DAO00064_GetListVienPhiByTiepNnan] PreparedStatement : [select distinct        B.DOITUONG_ID, B.NGAYMIENDONGCHITRA, B.BENHNHAN_ID as TIEPNHAN_BENHNHAN_ID, B.TRAITUYEN,        B.BHYTTREN3NAM as TREN3NAM, B.BHYTTREN5NAM as TREN5NAM, B.SOTIEPNHAN, B.SOBENHAN,        B.LOAITHANHVIEN_ID, B.SUDUNG_BHTN, B.THE_ID, B.THANHVIEN_ID, B.BAOLANH_VIENPHI, B.VIP, B.NGUOINUOCNGOAI,        C.GIATRIMIENGIAM as GIATRIMIENGIAM, D.GIATRIMIENGIAM as GIATRIMIENGIAM_BHTN, E.GIATRIMIENGIAM as GIATRIMIENGIAM_THANHVIEN,        F.GIATRIMIENGIAM as GIATRIMIENGIAM_CONGTY, DVYC.THE_ID as DVDUNGTHE, DVYC.TRANGTHAI as TRANGTHAIDICHVU, ndv.MANHOMDICHVU,        A.* from TT_VIENPHI A        left join        (select B.*, C.SOBENHAN, C.BENHAN_ID        from TT_TIEPNHAN B        left join TT_NOITRU_BENHAN C on B.TIEPNHAN_ID = C.TIEPNHAN_ID                 where B.TIEPNHAN_ID = '28494') B on B.TIEPNHAN_ID = A.TIEPNHAN_ID        left join (select sum(GIATRIMIENGIAM) as GIATRIMIENGIAM, VIENPHI_ID, REF_TABLE        from TT_MIENGIAM_CHITIET        where REF_TABLE = 'TT_MIENGIAM'        and exists (select MIENGIAM_ID from TT_MIENGIAM where TT_MIENGIAM_CHITIET.MIENGIAM_ID = MIENGIAM_ID and TINHTRANG = 1 and TIEPNHAN_ID = '28494')        group by VIENPHI_ID, REF_TABLE) C on C.REF_TABLE = 'TT_MIENGIAM' and C.VIENPHI_ID = A.VIENPHI_ID        left join (select sum(GIATRIMIENGIAM) as GIATRIMIENGIAM, VIENPHI_ID, REF_TABLE        from TT_MIENGIAM_CHITIET        where REF_TABLE = 'TT_MIENGIAM_BHTN'        and exists (select MIENGIAM_BHTN_ID from TT_MIENGIAM_BHTN where TT_MIENGIAM_CHITIET.MIENGIAM_ID = MIENGIAM_BHTN_ID and  TINHTRANG = 1 and TIEPNHAN_ID = '28494')        group by VIENPHI_ID, REF_TABLE) D on D.REF_TABLE = 'TT_MIENGIAM_BHTN' and D.VIENPHI_ID = A.VIENPHI_ID        left join (select sum(GIATRIMIENGIAM) as GIATRIMIENGIAM, VIENPHI_ID, REF_TABLE        from TT_MIENGIAM_CHITIET        where REF_TABLE = 'TT_MIENGIAM_THANHVIEN'        and exists (select MIENGIAM_THANHVIEN_ID from TT_MIENGIAM_THANHVIEN where TT_MIENGIAM_CHITIET.MIENGIAM_ID = MIENGIAM_THANHVIEN_ID and TINHTRANG = 1 and TIEPNHAN_ID = '28494')        group by VIENPHI_ID, REF_TABLE) E on E.REF_TABLE = 'TT_MIENGIAM_THANHVIEN' and E.VIENPHI_ID = A.VIENPHI_ID        left join (select sum(GIATRIMIENGIAM) as GIATRIMIENGIAM, VIENPHI_ID, REF_TABLE        from TT_MIENGIAM_CHITIET        where REF_TABLE = 'TT_MIENGIAM_CONGTY'        and exists (select MIENGIAM_CONGTY_ID from TT_MIENGIAM_CONGTY where TT_MIENGIAM_CHITIET.MIENGIAM_ID = MIENGIAM_CONGTY_ID and TINHTRANG = 1 and TIEPNHAN_ID = '28494')        group by VIENPHI_ID, REF_TABLE) F on F.REF_TABLE = 'TT_MIENGIAM_CONGTY' and F.VIENPHI_ID = A.VIENPHI_ID        left join TT_DVYEUCAU DVYC on DVYC.DVYEUCAU_ID = A.REF_ID and A.REF_TABLE = 'TT_DVYEUCAU'        left join TM_DICHVU DV on DVYC.DICHVU_ID = DV.DICHVU_ID and A.REF_TABLE = 'TT_DVYEUCAU'        left join TM_NHOMDICHVU ndv on ndv.NHOMDICHVU_ID = DV.NHOMDICHVU_ID and A.REF_TABLE = 'TT_DVYEUCAU'        where        A.TIEPNHAN_ID = '28494' and ((DVYC.HUYYEUCAU = '0' and A.DICHVU_ID is not null)        or A.DUOC_ID is not null or A.REF_TABLE = 'TT_NUT_XACNHANSUATAN_CHITIET')        and A.ACTIVE = '1'                 and A.BENHVIEN_ID = 'HLU01'        order by A.VIENPHI_ID]
2020-01-02 17:52:24,862 [1] DEBUG - Statement Id: [DAO00006_GetListDuocTyle] PreparedStatement : [select DUOC_ID, DOITUONG_ID, (TYLE/100) as TYLE, DONGIA MUCTRAN_THANHTOAN from TM_DOITUONG_GIADUOC_TYLE            where            BENHVIEN_ID = 'HLU01'            and DOITUONG_ID = '4']
2020-01-02 17:52:24,888 [1] DEBUG - Statement Id: [DAO00027_GetListTuongTrinhDichVuPhauThuatCuaTiepNhan] PreparedStatement : [declare @ManhomDSA varchar(10);        declare @PhanLoaiNhomDV varchar(20) = '05';        select top 1  @ManhomDSA = VALUE from TM_SYS_APPSETTINGS where CODE = 'MANHOM_DICHVU_DSA'        if (@ManhomDSA is not null) set @PhanLoaiNhomDV += ',' + @ManhomDSA        select distinct ptyc.*        from TT_PHAUTHUAT_YEUCAU ptyc        inner join TM_DICHVU dv on dv.DICHVU_ID = ptyc.DICHVU_ID        inner join TM_NHOMDICHVU ndv on ndv.NHOMDICHVU_ID = dv.NHOMDICHVU_ID        inner join TT_PHAUTHUAT pt on pt.PHAUTHUAT_ID = ptyc.PHAUTHUAT_ID        where        pt.TIEPNHAN_ID = 28494        and (left(ndv.MANHOMDICHVU, 2) in (select * from STRING_SPLIT(@PhanLoaiNhomDV,',')) or ndv.MANHOMDICHVU in (select * from STRING_SPLIT(@PhanLoaiNhomDV,',')))]
2020-01-02 17:52:24,929 [1] DEBUG - Statement Id: [DAO00006_GetList] PreparedStatement : [select dv.*, loaiDV.MALOAIDICHVU, captren.NHOMDICHVU_ID as NHOMDICHVU_CAPTREN_ID, captren.TENNHOMDICHVU as NHOMDICHVU_CAPTREN,              nhom_dv.TENNHOMDICHVU as TENNHOMDICHVU, nhom_dv.MANHOMDICHVU,              case when dv.ATTRIBUTE5 is null then 'TT' else 'KTC' end as LOAI_CHIPHI              from TM_DICHVU as dv              left join TM_NHOMDICHVU as nhom_dv on nhom_dv.NHOMDICHVU_ID = dv.NHOMDICHVU_ID and nhom_dv.BENHVIEN_ID = 'HLU01'              left join TM_NHOMDICHVU as captren on nhom_dv.CAPTREN_ID = captren.NHOMDICHVU_ID and captren.BENHVIEN_ID = 'HLU01'              left join TM_LOAIDICHVU loaiDV on nhom_dv.LOAIDICHVU_ID = loaiDV.LOAIDICHVU_ID and loaiDV.BENHVIEN_ID = 'HLU01'              where nhom_dv.TAMNGUNG = '0' and dv.BENHVIEN_ID = 'HLU01'              and dv.TAMNGUNG = '0'               AND                   loaiDV.MALOAIDICHVU = 'KhamBenh']
2020-01-02 17:52:24,961 [1] DEBUG - Statement Id: [DAO00027_GetDichvuYCBHYTTyle] PreparedStatement : [select DVYEUCAU_ID from TT_DVYEUCAU        where TIEPNHAN_ID = 28494 and isnull(BHYT_TYLETHANHTOAN_ID, 0) > 0]
2020-01-02 17:52:25,034 [1] DEBUG - Statement Id: [DAO00023_UpdateNhieuVP] PreparedStatement : [declare @jsonVienPhi nvarchar(max) = N'[{"VIENPHI_ID":675811,"TIEPNHAN_ID":28494,"DICHVU_ID":5492,"BENHAN_ID":0,"SOLUONG":1.0000,"DONGIA_DOANHTHU":33000.0000,"THANHTIEN_DOANHTHU":33000.00,"BHYT_TL":1.0,"BHYT_DONGIA":33000.0000,"BHYT_THANHTIEN":33000.00,"BHYT_DONGIA_CONGKHAM_DAU":33000.0000,"BHYT_CONGKHAM_DAU_TYLE":1.0,"BHYT_DONGIA_CHITRA":33000.0,"BHYT_THANHTIEN_CHITRA":33000.00,"BENHNHAN_PHAITHANHTOAN":0.00,"GIATRI_HOADON":0.0,"GIATRI_HOADON_DATHANHTOAN":0.0,"GIATRI_BIENLAI":0.0,"GIATRI_BIENLAI_DATHANHTOAN":0.0,"GIATRI_BENHNHAN_DATHANHTOAN":0.0,"DATHUCHIEN":"1","KHONGTHUTIEN":"0","BHYTDONGTIEN":"0","DICHVU_TL":1.0,"BHYT_DONGIA_DONGCT_DAU":0.0,"SOBHYT":"DN466456425324438289","SOBHYT_HUONG_ID":29517,"GIATRIMIENGIAM":0.0,"GIATRIMIENGIAM_BHTN":0.0,"GIATRIMIENGIAM_THANHVIEN":0.0,"GIATRIMIENGIAM_CONGTY":0.0,"BHYT_CK2_KHONGTHANHTOAN":false}]';        begin        UPDATE TT_VIENPHI        SET        SOLUONG = json.SOLUONG,        DONGIA_DOANHTHU = json.DONGIA_DOANHTHU,        THANHTIEN_DOANHTHU = json.THANHTIEN_DOANHTHU,        BHYT_TL = json.BHYT_TL,        BHYT_DONGIA = json.BHYT_DONGIA,        BHYT_THANHTIEN = json.BHYT_THANHTIEN,        BHYT_DONGIA_CONGKHAM_DAU = json.BHYT_DONGIA_CONGKHAM_DAU,        BHYT_CONGKHAM_DAU_TYLE = json.BHYT_CONGKHAM_DAU_TYLE,        BHYT_DONGIA_CHITRA = json.BHYT_DONGIA_CHITRA,        BHYT_THANHTIEN_CHITRA = json.BHYT_THANHTIEN_CHITRA,        BENHNHAN_PHAITHANHTOAN = json.BENHNHAN_PHAITHANHTOAN,        GIATRI_HOADON = json.GIATRI_HOADON,                GIATRI_BIENLAI = json.GIATRI_BIENLAI,                DATHUCHIEN = json.DATHUCHIEN,                DICHVU_TL = json.DICHVU_TL,        BHYT_DONGIA_DONGCT_DAU = json.BHYT_DONGIA_DONGCT_DAU,        NGAYCAPNHAT = GETDATE()        FROM OPENJSON (@jsonVienPhi)        WITH (        VIENPHI_ID int,        SOLUONG numeric(25, 4),        DONGIA_DOANHTHU numeric(25, 4),        THANHTIEN_DOANHTHU numeric(25, 4),        BHYT_TL numeric(25, 4),        BHYT_DONGIA numeric(25, 4),        BHYT_THANHTIEN numeric(25, 4),        BHYT_DONGIA_CONGKHAM_DAU numeric(25, 4),        BHYT_CONGKHAM_DAU_TYLE numeric(25, 4),        BHYT_DONGIA_CHITRA numeric(25, 4),        BHYT_THANHTIEN_CHITRA numeric(25, 4),        BENHNHAN_PHAITHANHTOAN numeric(25, 4),        GIATRI_HOADON numeric(25, 4),                GIATRI_BIENLAI numeric(25, 4),                DATHUCHIEN char(1),        KHONGTHUTIEN char(1),        BHYTDONGTIEN char(1),        DICHVU_TL numeric(25, 4),        BHYT_DONGIA_DONGCT_DAU numeric(25, 4))  json        WHERE TT_VIENPHI.VIENPHI_ID = json.VIENPHI_ID and json.DONGIA_DOANHTHU > 0                  insert into TT_TINH_VIENPHI_LOG        SELECT json.VIENPHI_ID, json.TIEPNHAN_ID, json.BENHAN_ID, json.SOLUONG, json.BHYT_TL, json.DONGIA_DOANHTHU,        json.THANHTIEN_DOANHTHU, json.BHYT_DONGIA, json.BHYT_THANHTIEN, json.BHYT_DONGIA_CHITRA, json.BHYT_THANHTIEN_CHITRA, json.BENHNHAN_PHAITHANHTOAN,        json.SOBHYT_HUONG_ID, json.SOBHYT, GETDATE(), -1, 'HLU01'        FROM OPENJSON(@jsonVienPhi)        WITH (        VIENPHI_ID int,        TIEPNHAN_ID int,        BENHAN_ID int,        SOLUONG numeric(25, 4),        DONGIA_DOANHTHU numeric(25, 4),        THANHTIEN_DOANHTHU numeric(25, 4),        BHYT_TL numeric(25, 4),        BHYT_DONGIA numeric(25, 4),        BHYT_THANHTIEN numeric(25, 4),        BHYT_DONGIA_CHITRA numeric(25, 4),        BHYT_THANHTIEN_CHITRA numeric(25, 4),        BENHNHAN_PHAITHANHTOAN numeric(25, 4),        SOBHYT_HUONG_ID int,        SOBHYT nvarchar(30)) json        end]
2020-01-02 17:52:25,064 [1] DEBUG - Statement Id: [DAO00067_UpdateDataVienPhiDongiaBHYT] PreparedStatement : [update TT_VIENPHI          set BHYT_DONGIA_CHITRA = 0, BHYT_THANHTIEN = 0, BHYT_THANHTIEN_CHITRA = 0          where          TIEPNHAN_ID = 28494 and BHYT_DONGIA = 0          and (BHYT_DONGIA_CHITRA > 0 or BHYT_THANHTIEN > 0 or BHYT_THANHTIEN_CHITRA > 0)]
2020-01-02 17:52:25,095 [1] DEBUG - Statement Id: [DAO00067_CapnhatDataVienphiKhiHuyThanhtoanHoadon] PreparedStatement : [update TT_VIENPHI        set TT_VIENPHI.HOADON_ID = hdct.HOADON_ID, TT_VIENPHI.GIATRI_BENHNHAN_DATHANHTOAN = TT_VIENPHI.GIATRI_BENHNHAN_DATHANHTOAN + hdct.GIATRI_BENHNHAN_DATHANHTOAN        from (select CT.HOADON_ID, CT.VIENPHI_ID, CT.GIATRI_BENHNHAN_DATHANHTOAN        from TT_HOADON_CHITIET_NGOAITRU CT        join TT_HOADON HD on HD.HOADON_ID = CT.HOADON_ID        join TT_VIENPHI vp on vp.VIENPHI_ID = ct.VIENPHI_ID        where HD.DATHANHTOAN = 1 and HD.HUYHOADON = 0 and HD.HOANTRA = 0 and vp.TIEPNHAN_ID =  @param0 ) hdct        where        TT_VIENPHI.VIENPHI_ID = hdct.VIENPHI_ID and TT_VIENPHI.HOADON_ID is null and isnull(TT_VIENPHI.GIATRI_BENHNHAN_DATHANHTOAN,0) = 0        and TT_VIENPHI.TIEPNHAN_ID =  @param0           update TT_VIENPHI        set TT_VIENPHI.HOADON_ID = null, TT_VIENPHI.GIATRI_BENHNHAN_DATHANHTOAN = TT_VIENPHI.GIATRI_BENHNHAN_DATHANHTOAN - hdct.GIATRI_BENHNHAN_DATHANHTOAN,        TT_VIENPHI.DATHANHTOAN = '0'        from (select CT.HOADON_ID, CT.VIENPHI_ID, CT.GIATRI_BENHNHAN_DATHANHTOAN        from TT_HOADON_CHITIET_NGOAITRU CT        join TT_HOADON HD on HD.HOADON_ID = CT.HOADON_ID        join TT_VIENPHI vp on vp.VIENPHI_ID = ct.VIENPHI_ID and vp.HOADON_ID = ct.HOADON_ID        where HD.DATHANHTOAN = 0 and (HD.HUYHOADON = 1 or HD.HOANTRA = 1) and vp.TIEPNHAN_ID =  @param0 ) hdct        where        TT_VIENPHI.VIENPHI_ID = hdct.VIENPHI_ID and TT_VIENPHI.HOADON_ID = hdct.HOADON_ID        and TT_VIENPHI.TIEPNHAN_ID =  @param0]
2020-01-02 17:52:25,095 [1] DEBUG - Statement Id: [DAO00067_CapnhatDataVienphiKhiHuyThanhtoanHoadon] Parameters: [@param0=[TIEPNHAN_ID,28494]]
2020-01-02 17:52:25,095 [1] DEBUG - Statement Id: [DAO00067_CapnhatDataVienphiKhiHuyThanhtoanHoadon] Types: [@param0=[Int64, System.Int64]]
2020-01-02 17:52:25,274 [1] DEBUG - Statement Id: [DAO00017_GetLoaiGiaByDoiTuongId] PreparedStatement : [select dtlg.DOUUTIEN, dtlg.DOITUONG_ID, lg.LOAIGIA_ID, lg.TENLOAIGIA, lg.MALOAIGIA              from TM_LOAIGIA lg              left join TM_DOITUONG_LOAIGIA dtlg              on lg.LOAIGIA_ID = dtlg.LOAIGIA_ID and dtlg.BENHVIEN_ID = 'HLU01'              where lg.TAMNGUNG = 0 and lg.BENHVIEN_ID = 'HLU01'                             order by dtlg.DOUUTIEN]
2020-01-02 17:52:25,316 [1] DEBUG - Statement Id: [DAO00014_KiemTraDVYCCoGiaBHYT] PreparedStatement : [select *        from TT_VIENPHI        where REF_ID  = '206520' and REF_TABLE = 'TT_DVYEUCAU' and BHYT_DONGIA > 0]
2020-01-02 17:52:25,357 [1] DEBUG - Statement Id: [DAO00040_LayListToaMau] PreparedStatement : [select A.*, dc.TENDUOCDAYDU, dc.BHYT DUOC_BHYT, ld.LOAIVATTU_ID, ld.MALOAIDUOC, dd.DICTIONARY_NAME DUONGDUNG, dc.TAMNGUNG            from TT_TOATHUOCMAU A            left join TM_DUOC dc on A.DUOC_ID = dc.DUOC_ID            left join TM_LOAIDUOC ld on dc.LOAIDUOC_ID = ld.LOAIDUOC_ID            left join (select * from LST_DICTIONARY where DICTIONARY_TYPE_CODE like 'DuongDung') dd on dd.DICTIONARY_ID = dc.DUONGDUNG_ID            where (1=1)             and               A.BACSI_ID  = 1              and A.LOAITOATHUOC in  (                        @param0                   ,                           @param1                   ,                           @param2                   ,                           @param3                   )]
2020-01-02 17:52:25,358 [1] DEBUG - Statement Id: [DAO00040_LayListToaMau] Parameters: [@param0=[LSTLOAITOATHUOC[0],BV], @param1=[LSTLOAITOATHUOC[1],MN], @param2=[LSTLOAITOATHUOC[2],MP], @param3=[LSTLOAITOATHUOC[3],TV]]
2020-01-02 17:52:25,358 [1] DEBUG - Statement Id: [DAO00040_LayListToaMau] Types: [@param0=[String, System.String], @param1=[String, System.String], @param2=[String, System.String], @param3=[String, System.String]]
2020-01-02 17:52:25,459 [1] DEBUG - Statement Id: [DAO00040_LayListToaMau] PreparedStatement : [select A.*, dc.TENDUOCDAYDU, dc.BHYT DUOC_BHYT, ld.LOAIVATTU_ID, ld.MALOAIDUOC, dd.DICTIONARY_NAME DUONGDUNG, dc.TAMNGUNG            from TT_TOATHUOCMAU A            left join TM_DUOC dc on A.DUOC_ID = dc.DUOC_ID            left join TM_LOAIDUOC ld on dc.LOAIDUOC_ID = ld.LOAIDUOC_ID            left join (select * from LST_DICTIONARY where DICTIONARY_TYPE_CODE like 'DuongDung') dd on dd.DICTIONARY_ID = dc.DUONGDUNG_ID            where (1=1)             and               A.BACSI_ID  = 1              and A.LOAITOATHUOC in  (                        @param0                   ,                           @param1                   ,                           @param2                   ,                           @param3                   )]
2020-01-02 17:52:25,459 [1] DEBUG - Statement Id: [DAO00040_LayListToaMau] Parameters: [@param0=[LSTLOAITOATHUOC[0],BV], @param1=[LSTLOAITOATHUOC[1],MN], @param2=[LSTLOAITOATHUOC[2],MP], @param3=[LSTLOAITOATHUOC[3],TV]]
2020-01-02 17:52:25,459 [1] DEBUG - Statement Id: [DAO00040_LayListToaMau] Types: [@param0=[String, System.String], @param1=[String, System.String], @param2=[String, System.String], @param3=[String, System.String]]
2020-01-02 17:52:25,491 [1] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoVaBookingCOM23UpdateRedis_TheoPhamvi] PreparedStatement : [declare @TOAMUANGOAI int = 0;        select @TOAMUANGOAI = isnull(VALUE,0) from TM_SYS_APPSETTINGS where CODE = 'OPD_TOAMUANGOAI_DUNGDANHMUC_DUOC'                if @TOAMUANGOAI = 1        begin        select  distinct '0' + '_' + LTRIM(d.DUOC_ID) + '_' + '0' as DUOC_KEY, 999999999 as SOLUONG        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        where  @param0  = 0        union all        select distinct tk.DUOC_KEY, tk.SOLUONG        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        inner join        (        select  LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')) DUOC_KEY, (SUM(dtk.SOLUONG) - isnull(sum(A.SOLUONG),0) - isnull(sum(B.SOLUONG),0)) SOLUONG, pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        from (select sum(soluong) soluong,duoc_id,nguonduoc_id,khoduoc_id,benhvien_id from TT_DUOC_TONKHO  group by duoc_id,nguonduoc_id,khoduoc_id,benhvien_id) dtk        inner join TM_DUOC_PHAMVISD_MAPPING pvsd on dtk.KHODUOC_ID = pvsd.KHODUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NOITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) B on B.DUOC_ID = dtk.DUOC_ID and B.PHAMVI_ID = pvsd.PHAMVI_ID and B.NGUONHANG_ID = dtk.NGUONDUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NGOAITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) A on A.DUOC_ID = dtk.DUOC_ID and A.PHAMVI_ID = pvsd.PHAMVI_ID and A.NGUONHANG_ID = dtk.NGUONDUOC_ID        where dtk.BENHVIEN_ID = 'HLU01'        group by LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')), pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        ) tk on tk.DUOC_ID = d.DUOC_ID        left join TM_DUOC_PHAMVISUDUNG kd on kd.PHAMVI_ID = tk.PHAMVI_ID and kd.BENHVIEN_ID = 'HLU01'        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = tk.NGUONDUOC_ID and nh.BENHVIEN_ID = 'HLU01'        where d.BENHVIEN_ID = 'HLU01' and tk.PHAMVI_ID =  @param0         end        else        begin        select distinct tk.DUOC_KEY, tk.SOLUONG        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        inner join        (        select  LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')) DUOC_KEY, (SUM(dtk.SOLUONG) - isnull(sum(A.SOLUONG),0) - isnull(sum(B.SOLUONG),0)) SOLUONG, pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        from (select sum(soluong) soluong,duoc_id,nguonduoc_id,khoduoc_id,benhvien_id from TT_DUOC_TONKHO  group by duoc_id,nguonduoc_id,khoduoc_id,benhvien_id) dtk        inner join TM_DUOC_PHAMVISD_MAPPING pvsd on dtk.KHODUOC_ID = pvsd.KHODUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NOITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) B on B.DUOC_ID = dtk.DUOC_ID and B.PHAMVI_ID = pvsd.PHAMVI_ID and B.NGUONHANG_ID = dtk.NGUONDUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NGOAITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) A on A.DUOC_ID = dtk.DUOC_ID and A.PHAMVI_ID = pvsd.PHAMVI_ID and A.NGUONHANG_ID = dtk.NGUONDUOC_ID        where dtk.BENHVIEN_ID = 'HLU01'        group by LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')), pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        ) tk on tk.DUOC_ID = d.DUOC_ID        left join TM_DUOC_PHAMVISUDUNG kd on kd.PHAMVI_ID = tk.PHAMVI_ID and kd.BENHVIEN_ID = 'HLU01'        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = tk.NGUONDUOC_ID and nh.BENHVIEN_ID = 'HLU01'        where d.BENHVIEN_ID = 'HLU01' and tk.PHAMVI_ID =  @param0         end]
2020-01-02 17:52:25,491 [1] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoVaBookingCOM23UpdateRedis_TheoPhamvi] Parameters: [@param0=[PHAMVI_ID,1028]]
2020-01-02 17:52:25,491 [1] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoVaBookingCOM23UpdateRedis_TheoPhamvi] Types: [@param0=[Int64, System.Int64]]
2020-01-02 17:52:25,670 [1] DEBUG - Statement Id: [DAO00013_GetTienSuBenh] PreparedStatement : [select TIENSUBENH, TIENSUDIUNG        from TT_BENHNHAN        where TT_BENHNHAN.BENHNHAN_ID  = '24442']
2020-01-02 17:52:25,724 [1] DEBUG - Statement Id: [DAO00095_GetTTDiUngThuoc] PreparedStatement : [select *              from TT_BENHNHAN_DIUNG_THUOC              where BENHNHAN_ID = '24442'              and BENHVIEN_ID = 'HLU01']
2020-01-02 17:52:25,768 [1] DEBUG - Statement Id: [DAO00014_GetTotalChiPhiDVByTiepNhan] PreparedStatement : [select sum(THANHTIEN_DOANHTHU) as THANHTIEN_DOANHTHU from TT_VIENPHI        where ACTIVE = '1'        and TIEPNHAN_ID = '28494'        and REF_TABLE = 'TT_DVYEUCAU'        and exists (select DVYEUCAU_ID from TT_DVYEUCAU where HUYYEUCAU = '0' and TIEPNHAN_ID = '28494' and TT_VIENPHI.REF_ID = DVYEUCAU_ID)]
2020-01-02 17:52:25,815 [1] DEBUG - Statement Id: [DAO00014_GetKhamBenhInfo] PreparedStatement : [select * from TT_NGOAITRU_KHAMBENH where KHAMBENH_ID =        (select KHAMBENH_NGOAITRU_ID from TT_DVYEUCAU where DVYEUCAU_ID = '206520')]
2020-01-02 17:52:25,846 [1] DEBUG - Statement Id: [DAO00068_GetSinhHieuBySinhHieuID] PreparedStatement : [select top (1) *            from TT_NGOAITRU_KHAMBENH_SINHHIEU            where KHAMBENH_SINHHIEU_ID = '0'            and BENHVIEN_ID = 'HLU01'             and               BENHNHAN_ID = '24442'                           order by KHAMBENH_SINHHIEU_ID]
2020-01-02 17:52:25,994 [1] DEBUG - Statement Id: [DAO00014_GetKhamBenhICDInfo] PreparedStatement : [select *        from TT_NGOAITRU_KHAMBENH_ICD        where KHAMBENH_ID  = '27177']
2020-01-02 17:52:26,028 [1] DEBUG - Statement Id: [DAO00014_GetListToaThuoc] PreparedStatement : [select A.*        from TT_NGOAITRU_KHAMBENH_TOATHUOC A        where A.KHAMBENH_ID = '27177']
2020-01-02 17:52:26,056 [1] DEBUG - Statement Id: [DAO00014_KiemTraDVYCCoGiaBHYT] PreparedStatement : [select *        from TT_VIENPHI        where REF_ID  = '206520' and REF_TABLE = 'TT_DVYEUCAU' and BHYT_DONGIA > 0]
2020-01-02 17:52:26,097 [1] DEBUG - Statement Id: [DAO00040_LayListToaMau] PreparedStatement : [select A.*, dc.TENDUOCDAYDU, dc.BHYT DUOC_BHYT, ld.LOAIVATTU_ID, ld.MALOAIDUOC, dd.DICTIONARY_NAME DUONGDUNG, dc.TAMNGUNG            from TT_TOATHUOCMAU A            left join TM_DUOC dc on A.DUOC_ID = dc.DUOC_ID            left join TM_LOAIDUOC ld on dc.LOAIDUOC_ID = ld.LOAIDUOC_ID            left join (select * from LST_DICTIONARY where DICTIONARY_TYPE_CODE like 'DuongDung') dd on dd.DICTIONARY_ID = dc.DUONGDUNG_ID            where (1=1)             and               A.BACSI_ID  = 1              and A.LOAITOATHUOC in  (                        @param0                   ,                           @param1                   ,                           @param2                   ,                           @param3                   )]
2020-01-02 17:52:26,097 [1] DEBUG - Statement Id: [DAO00040_LayListToaMau] Parameters: [@param0=[LSTLOAITOATHUOC[0],BV], @param1=[LSTLOAITOATHUOC[1],MN], @param2=[LSTLOAITOATHUOC[2],MP], @param3=[LSTLOAITOATHUOC[3],TV]]
2020-01-02 17:52:26,097 [1] DEBUG - Statement Id: [DAO00040_LayListToaMau] Types: [@param0=[String, System.String], @param1=[String, System.String], @param2=[String, System.String], @param3=[String, System.String]]
2020-01-02 17:52:26,199 [1] DEBUG - Statement Id: [DAO00040_LayListToaMau] PreparedStatement : [select A.*, dc.TENDUOCDAYDU, dc.BHYT DUOC_BHYT, ld.LOAIVATTU_ID, ld.MALOAIDUOC, dd.DICTIONARY_NAME DUONGDUNG, dc.TAMNGUNG            from TT_TOATHUOCMAU A            left join TM_DUOC dc on A.DUOC_ID = dc.DUOC_ID            left join TM_LOAIDUOC ld on dc.LOAIDUOC_ID = ld.LOAIDUOC_ID            left join (select * from LST_DICTIONARY where DICTIONARY_TYPE_CODE like 'DuongDung') dd on dd.DICTIONARY_ID = dc.DUONGDUNG_ID            where (1=1)             and               A.BACSI_ID  = 1              and A.LOAITOATHUOC in  (                        @param0                   ,                           @param1                   ,                           @param2                   ,                           @param3                   )]
2020-01-02 17:52:26,199 [1] DEBUG - Statement Id: [DAO00040_LayListToaMau] Parameters: [@param0=[LSTLOAITOATHUOC[0],BV], @param1=[LSTLOAITOATHUOC[1],MN], @param2=[LSTLOAITOATHUOC[2],MP], @param3=[LSTLOAITOATHUOC[3],TV]]
2020-01-02 17:52:26,199 [1] DEBUG - Statement Id: [DAO00040_LayListToaMau] Types: [@param0=[String, System.String], @param1=[String, System.String], @param2=[String, System.String], @param3=[String, System.String]]
2020-01-02 17:52:26,235 [1] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoVaBookingCOM23UpdateRedis_TheoPhamvi] PreparedStatement : [declare @TOAMUANGOAI int = 0;        select @TOAMUANGOAI = isnull(VALUE,0) from TM_SYS_APPSETTINGS where CODE = 'OPD_TOAMUANGOAI_DUNGDANHMUC_DUOC'                if @TOAMUANGOAI = 1        begin        select  distinct '0' + '_' + LTRIM(d.DUOC_ID) + '_' + '0' as DUOC_KEY, 999999999 as SOLUONG        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        where  @param0  = 0        union all        select distinct tk.DUOC_KEY, tk.SOLUONG        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        inner join        (        select  LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')) DUOC_KEY, (SUM(dtk.SOLUONG) - isnull(sum(A.SOLUONG),0) - isnull(sum(B.SOLUONG),0)) SOLUONG, pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        from (select sum(soluong) soluong,duoc_id,nguonduoc_id,khoduoc_id,benhvien_id from TT_DUOC_TONKHO  group by duoc_id,nguonduoc_id,khoduoc_id,benhvien_id) dtk        inner join TM_DUOC_PHAMVISD_MAPPING pvsd on dtk.KHODUOC_ID = pvsd.KHODUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NOITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) B on B.DUOC_ID = dtk.DUOC_ID and B.PHAMVI_ID = pvsd.PHAMVI_ID and B.NGUONHANG_ID = dtk.NGUONDUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NGOAITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) A on A.DUOC_ID = dtk.DUOC_ID and A.PHAMVI_ID = pvsd.PHAMVI_ID and A.NGUONHANG_ID = dtk.NGUONDUOC_ID        where dtk.BENHVIEN_ID = 'HLU01'        group by LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')), pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        ) tk on tk.DUOC_ID = d.DUOC_ID        left join TM_DUOC_PHAMVISUDUNG kd on kd.PHAMVI_ID = tk.PHAMVI_ID and kd.BENHVIEN_ID = 'HLU01'        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = tk.NGUONDUOC_ID and nh.BENHVIEN_ID = 'HLU01'        where d.BENHVIEN_ID = 'HLU01' and tk.PHAMVI_ID =  @param0         end        else        begin        select distinct tk.DUOC_KEY, tk.SOLUONG        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        inner join        (        select  LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')) DUOC_KEY, (SUM(dtk.SOLUONG) - isnull(sum(A.SOLUONG),0) - isnull(sum(B.SOLUONG),0)) SOLUONG, pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        from (select sum(soluong) soluong,duoc_id,nguonduoc_id,khoduoc_id,benhvien_id from TT_DUOC_TONKHO  group by duoc_id,nguonduoc_id,khoduoc_id,benhvien_id) dtk        inner join TM_DUOC_PHAMVISD_MAPPING pvsd on dtk.KHODUOC_ID = pvsd.KHODUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NOITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) B on B.DUOC_ID = dtk.DUOC_ID and B.PHAMVI_ID = pvsd.PHAMVI_ID and B.NGUONHANG_ID = dtk.NGUONDUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NGOAITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) A on A.DUOC_ID = dtk.DUOC_ID and A.PHAMVI_ID = pvsd.PHAMVI_ID and A.NGUONHANG_ID = dtk.NGUONDUOC_ID        where dtk.BENHVIEN_ID = 'HLU01'        group by LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')), pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        ) tk on tk.DUOC_ID = d.DUOC_ID        left join TM_DUOC_PHAMVISUDUNG kd on kd.PHAMVI_ID = tk.PHAMVI_ID and kd.BENHVIEN_ID = 'HLU01'        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = tk.NGUONDUOC_ID and nh.BENHVIEN_ID = 'HLU01'        where d.BENHVIEN_ID = 'HLU01' and tk.PHAMVI_ID =  @param0         end]
2020-01-02 17:52:26,235 [1] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoVaBookingCOM23UpdateRedis_TheoPhamvi] Parameters: [@param0=[PHAMVI_ID,1028]]
2020-01-02 17:52:26,235 [1] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoVaBookingCOM23UpdateRedis_TheoPhamvi] Types: [@param0=[Int64, System.Int64]]
2020-01-02 17:52:26,435 [1] DEBUG - Statement Id: [DAO00068_GetLastedSinhHieuInfo] PreparedStatement : [select top (1) *, CHISOBMI as BMI              from TT_NGOAITRU_KHAMBENH_SINHHIEU              where BENHNHAN_ID = '24442'              order by KHAMBENH_SINHHIEU_ID desc]
2020-01-02 17:52:26,561 [1] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoVaBookingCOM23UpdateRedis_TheoPhamvi] PreparedStatement : [declare @TOAMUANGOAI int = 0;        select @TOAMUANGOAI = isnull(VALUE,0) from TM_SYS_APPSETTINGS where CODE = 'OPD_TOAMUANGOAI_DUNGDANHMUC_DUOC'                if @TOAMUANGOAI = 1        begin        select  distinct '0' + '_' + LTRIM(d.DUOC_ID) + '_' + '0' as DUOC_KEY, 999999999 as SOLUONG        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        where  @param0  = 0        union all        select distinct tk.DUOC_KEY, tk.SOLUONG        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        inner join        (        select  LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')) DUOC_KEY, (SUM(dtk.SOLUONG) - isnull(sum(A.SOLUONG),0) - isnull(sum(B.SOLUONG),0)) SOLUONG, pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        from (select sum(soluong) soluong,duoc_id,nguonduoc_id,khoduoc_id,benhvien_id from TT_DUOC_TONKHO  group by duoc_id,nguonduoc_id,khoduoc_id,benhvien_id) dtk        inner join TM_DUOC_PHAMVISD_MAPPING pvsd on dtk.KHODUOC_ID = pvsd.KHODUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NOITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) B on B.DUOC_ID = dtk.DUOC_ID and B.PHAMVI_ID = pvsd.PHAMVI_ID and B.NGUONHANG_ID = dtk.NGUONDUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NGOAITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) A on A.DUOC_ID = dtk.DUOC_ID and A.PHAMVI_ID = pvsd.PHAMVI_ID and A.NGUONHANG_ID = dtk.NGUONDUOC_ID        where dtk.BENHVIEN_ID = 'HLU01'        group by LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')), pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        ) tk on tk.DUOC_ID = d.DUOC_ID        left join TM_DUOC_PHAMVISUDUNG kd on kd.PHAMVI_ID = tk.PHAMVI_ID and kd.BENHVIEN_ID = 'HLU01'        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = tk.NGUONDUOC_ID and nh.BENHVIEN_ID = 'HLU01'        where d.BENHVIEN_ID = 'HLU01' and tk.PHAMVI_ID =  @param0         end        else        begin        select distinct tk.DUOC_KEY, tk.SOLUONG        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        inner join        (        select  LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')) DUOC_KEY, (SUM(dtk.SOLUONG) - isnull(sum(A.SOLUONG),0) - isnull(sum(B.SOLUONG),0)) SOLUONG, pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        from (select sum(soluong) soluong,duoc_id,nguonduoc_id,khoduoc_id,benhvien_id from TT_DUOC_TONKHO  group by duoc_id,nguonduoc_id,khoduoc_id,benhvien_id) dtk        inner join TM_DUOC_PHAMVISD_MAPPING pvsd on dtk.KHODUOC_ID = pvsd.KHODUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NOITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) B on B.DUOC_ID = dtk.DUOC_ID and B.PHAMVI_ID = pvsd.PHAMVI_ID and B.NGUONHANG_ID = dtk.NGUONDUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NGOAITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) A on A.DUOC_ID = dtk.DUOC_ID and A.PHAMVI_ID = pvsd.PHAMVI_ID and A.NGUONHANG_ID = dtk.NGUONDUOC_ID        where dtk.BENHVIEN_ID = 'HLU01'        group by LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')), pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        ) tk on tk.DUOC_ID = d.DUOC_ID        left join TM_DUOC_PHAMVISUDUNG kd on kd.PHAMVI_ID = tk.PHAMVI_ID and kd.BENHVIEN_ID = 'HLU01'        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = tk.NGUONDUOC_ID and nh.BENHVIEN_ID = 'HLU01'        where d.BENHVIEN_ID = 'HLU01' and tk.PHAMVI_ID =  @param0         end]
2020-01-02 17:52:26,561 [1] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoVaBookingCOM23UpdateRedis_TheoPhamvi] Parameters: [@param0=[PHAMVI_ID,1028]]
2020-01-02 17:52:26,561 [1] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoVaBookingCOM23UpdateRedis_TheoPhamvi] Types: [@param0=[Int64, System.Int64]]
2020-01-02 17:52:47,754 [1] DEBUG - Statement Id: [DAO00017_GetLoaiGiaByDoiTuongId] PreparedStatement : [select dtlg.DOUUTIEN, dtlg.DOITUONG_ID, lg.LOAIGIA_ID, lg.TENLOAIGIA, lg.MALOAIGIA              from TM_LOAIGIA lg              left join TM_DOITUONG_LOAIGIA dtlg              on lg.LOAIGIA_ID = dtlg.LOAIGIA_ID and dtlg.BENHVIEN_ID = 'HLU01'              where lg.TAMNGUNG = 0 and lg.BENHVIEN_ID = 'HLU01'                             order by dtlg.DOUUTIEN]
2020-01-02 17:52:47,919 [1] DEBUG - Statement Id: [DAO00014_KiemTraDVYCCoGiaBHYT] PreparedStatement : [select *        from TT_VIENPHI        where REF_ID  = '' and REF_TABLE = 'TT_DVYEUCAU' and BHYT_DONGIA > 0]
2020-01-02 17:52:47,949 [1] DEBUG - Statement Id: [DAO00040_LayListToaMau] PreparedStatement : [select A.*, dc.TENDUOCDAYDU, dc.BHYT DUOC_BHYT, ld.LOAIVATTU_ID, ld.MALOAIDUOC, dd.DICTIONARY_NAME DUONGDUNG, dc.TAMNGUNG            from TT_TOATHUOCMAU A            left join TM_DUOC dc on A.DUOC_ID = dc.DUOC_ID            left join TM_LOAIDUOC ld on dc.LOAIDUOC_ID = ld.LOAIDUOC_ID            left join (select * from LST_DICTIONARY where DICTIONARY_TYPE_CODE like 'DuongDung') dd on dd.DICTIONARY_ID = dc.DUONGDUNG_ID            where (1=1)             and               A.BACSI_ID  = 1              and A.LOAITOATHUOC in  (                        @param0                   ,                           @param1                   ,                           @param2                   ,                           @param3                   )]
2020-01-02 17:52:47,950 [1] DEBUG - Statement Id: [DAO00040_LayListToaMau] Parameters: [@param0=[LSTLOAITOATHUOC[0],BV], @param1=[LSTLOAITOATHUOC[1],MN], @param2=[LSTLOAITOATHUOC[2],MP], @param3=[LSTLOAITOATHUOC[3],TV]]
2020-01-02 17:52:47,950 [1] DEBUG - Statement Id: [DAO00040_LayListToaMau] Types: [@param0=[String, System.String], @param1=[String, System.String], @param2=[String, System.String], @param3=[String, System.String]]
2020-01-02 17:52:48,042 [1] DEBUG - Statement Id: [DAO00040_LayListToaMau] PreparedStatement : [select A.*, dc.TENDUOCDAYDU, dc.BHYT DUOC_BHYT, ld.LOAIVATTU_ID, ld.MALOAIDUOC, dd.DICTIONARY_NAME DUONGDUNG, dc.TAMNGUNG            from TT_TOATHUOCMAU A            left join TM_DUOC dc on A.DUOC_ID = dc.DUOC_ID            left join TM_LOAIDUOC ld on dc.LOAIDUOC_ID = ld.LOAIDUOC_ID            left join (select * from LST_DICTIONARY where DICTIONARY_TYPE_CODE like 'DuongDung') dd on dd.DICTIONARY_ID = dc.DUONGDUNG_ID            where (1=1)             and               A.BACSI_ID  = 1              and A.LOAITOATHUOC in  (                        @param0                   ,                           @param1                   ,                           @param2                   ,                           @param3                   )]
2020-01-02 17:52:48,042 [1] DEBUG - Statement Id: [DAO00040_LayListToaMau] Parameters: [@param0=[LSTLOAITOATHUOC[0],BV], @param1=[LSTLOAITOATHUOC[1],MN], @param2=[LSTLOAITOATHUOC[2],MP], @param3=[LSTLOAITOATHUOC[3],TV]]
2020-01-02 17:52:48,042 [1] DEBUG - Statement Id: [DAO00040_LayListToaMau] Types: [@param0=[String, System.String], @param1=[String, System.String], @param2=[String, System.String], @param3=[String, System.String]]
2020-01-02 17:52:48,077 [1] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoVaBookingCOM23UpdateRedis_TheoPhamvi] PreparedStatement : [declare @TOAMUANGOAI int = 0;        select @TOAMUANGOAI = isnull(VALUE,0) from TM_SYS_APPSETTINGS where CODE = 'OPD_TOAMUANGOAI_DUNGDANHMUC_DUOC'                if @TOAMUANGOAI = 1        begin        select  distinct '0' + '_' + LTRIM(d.DUOC_ID) + '_' + '0' as DUOC_KEY, 999999999 as SOLUONG        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        where  @param0  = 0        union all        select distinct tk.DUOC_KEY, tk.SOLUONG        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        inner join        (        select  LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')) DUOC_KEY, (SUM(dtk.SOLUONG) - isnull(sum(A.SOLUONG),0) - isnull(sum(B.SOLUONG),0)) SOLUONG, pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        from (select sum(soluong) soluong,duoc_id,nguonduoc_id,khoduoc_id,benhvien_id from TT_DUOC_TONKHO  group by duoc_id,nguonduoc_id,khoduoc_id,benhvien_id) dtk        inner join TM_DUOC_PHAMVISD_MAPPING pvsd on dtk.KHODUOC_ID = pvsd.KHODUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NOITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) B on B.DUOC_ID = dtk.DUOC_ID and B.PHAMVI_ID = pvsd.PHAMVI_ID and B.NGUONHANG_ID = dtk.NGUONDUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NGOAITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) A on A.DUOC_ID = dtk.DUOC_ID and A.PHAMVI_ID = pvsd.PHAMVI_ID and A.NGUONHANG_ID = dtk.NGUONDUOC_ID        where dtk.BENHVIEN_ID = 'HLU01'        group by LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')), pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        ) tk on tk.DUOC_ID = d.DUOC_ID        left join TM_DUOC_PHAMVISUDUNG kd on kd.PHAMVI_ID = tk.PHAMVI_ID and kd.BENHVIEN_ID = 'HLU01'        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = tk.NGUONDUOC_ID and nh.BENHVIEN_ID = 'HLU01'        where d.BENHVIEN_ID = 'HLU01' and tk.PHAMVI_ID =  @param0         end        else        begin        select distinct tk.DUOC_KEY, tk.SOLUONG        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        inner join        (        select  LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')) DUOC_KEY, (SUM(dtk.SOLUONG) - isnull(sum(A.SOLUONG),0) - isnull(sum(B.SOLUONG),0)) SOLUONG, pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        from (select sum(soluong) soluong,duoc_id,nguonduoc_id,khoduoc_id,benhvien_id from TT_DUOC_TONKHO  group by duoc_id,nguonduoc_id,khoduoc_id,benhvien_id) dtk        inner join TM_DUOC_PHAMVISD_MAPPING pvsd on dtk.KHODUOC_ID = pvsd.KHODUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NOITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) B on B.DUOC_ID = dtk.DUOC_ID and B.PHAMVI_ID = pvsd.PHAMVI_ID and B.NGUONHANG_ID = dtk.NGUONDUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NGOAITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) A on A.DUOC_ID = dtk.DUOC_ID and A.PHAMVI_ID = pvsd.PHAMVI_ID and A.NGUONHANG_ID = dtk.NGUONDUOC_ID        where dtk.BENHVIEN_ID = 'HLU01'        group by LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')), pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        ) tk on tk.DUOC_ID = d.DUOC_ID        left join TM_DUOC_PHAMVISUDUNG kd on kd.PHAMVI_ID = tk.PHAMVI_ID and kd.BENHVIEN_ID = 'HLU01'        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = tk.NGUONDUOC_ID and nh.BENHVIEN_ID = 'HLU01'        where d.BENHVIEN_ID = 'HLU01' and tk.PHAMVI_ID =  @param0         end]
2020-01-02 17:52:48,077 [1] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoVaBookingCOM23UpdateRedis_TheoPhamvi] Parameters: [@param0=[PHAMVI_ID,1033]]
2020-01-02 17:52:48,077 [1] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoVaBookingCOM23UpdateRedis_TheoPhamvi] Types: [@param0=[Int64, System.Int64]]
2020-01-02 17:52:48,338 [1] DEBUG - Statement Id: [DAO00012_GetLoaiTCLS] PreparedStatement : [select DICTIONARY_ID, DICTIONARY_CODE, DICTIONARY_NAME, cast('0' as Bit) CHON        from LST_DICTIONARY              where DICTIONARY_TYPE_CODE = 'KHAMBENH_LOAI_TRIEUCHUNGLS'        order by LST_DICTIONARY.IDX]
2020-01-02 17:52:48,364 [1] DEBUG - Statement Id: [DAO00012_GetAllTCLS] PreparedStatement : [select MALOAITRIEUCHUNG DICTIONARY_TYPE_CODE, MALOAITRIEUCHUNG DICTIONARY_CODE,        TENTRIEUCHUNG DICTIONARY_NAME from TM_TRIEUCHUNGLS]
2020-01-02 17:52:48,394 [1] DEBUG - Statement Id: [DAO00019_ThongTinBenhNhanDvYeuCau] PreparedStatement : [select distinct A.SOTIEPNHAN, A.TIEPNHAN_ID, A.DOITUONG_ID, A.TRANGTHAI,        A.LOAITHANHVIEN_ID, A.SUDUNG_BHTN, A.THE_ID, A.THANHVIEN_ID, A.VIP, A.NGUON_BENHNHAN_ID, A.BAOLANH_VIENPHI, A.NGAYMIENDONGCHITRA,        B.*,  C.DICHVU_ID, C.DVYEUCAU_ID, C.NOITHUCHIEN_ID, A.SOBHYT        from TT_TIEPNHAN A        inner join TT_DVYEUCAU C on C.TIEPNHAN_ID = A.TIEPNHAN_ID        inner join TT_BENHNHAN B on B.BENHNHAN_ID = A.BENHNHAN_ID and B.ACTIVE = '1'        where                    C.DVYEUCAU_ID = '206519'                 and A.BENHVIEN_ID = 'HLU01']
2020-01-02 17:52:48,491 [1] DEBUG - Statement Id: [DAO00017_GetLoaiGiaByDoiTuongId] PreparedStatement : [select dtlg.DOUUTIEN, dtlg.DOITUONG_ID, lg.LOAIGIA_ID, lg.TENLOAIGIA, lg.MALOAIGIA              from TM_LOAIGIA lg              left join TM_DOITUONG_LOAIGIA dtlg              on lg.LOAIGIA_ID = dtlg.LOAIGIA_ID and dtlg.BENHVIEN_ID = 'HLU01'              where lg.TAMNGUNG = 0 and lg.BENHVIEN_ID = 'HLU01'                             order by dtlg.DOUUTIEN]
2020-01-02 17:52:48,556 [1] DEBUG - Statement Id: [DAO00014_KiemTraDVYCCoGiaBHYT] PreparedStatement : [select *        from TT_VIENPHI        where REF_ID  = '206519' and REF_TABLE = 'TT_DVYEUCAU' and BHYT_DONGIA > 0]
2020-01-02 17:52:48,588 [1] DEBUG - Statement Id: [DAO00040_LayListToaMau] PreparedStatement : [select A.*, dc.TENDUOCDAYDU, dc.BHYT DUOC_BHYT, ld.LOAIVATTU_ID, ld.MALOAIDUOC, dd.DICTIONARY_NAME DUONGDUNG, dc.TAMNGUNG            from TT_TOATHUOCMAU A            left join TM_DUOC dc on A.DUOC_ID = dc.DUOC_ID            left join TM_LOAIDUOC ld on dc.LOAIDUOC_ID = ld.LOAIDUOC_ID            left join (select * from LST_DICTIONARY where DICTIONARY_TYPE_CODE like 'DuongDung') dd on dd.DICTIONARY_ID = dc.DUONGDUNG_ID            where (1=1)             and               A.BACSI_ID  = 1              and A.LOAITOATHUOC in  (                        @param0                   ,                           @param1                   ,                           @param2                   ,                           @param3                   )]
2020-01-02 17:52:48,588 [1] DEBUG - Statement Id: [DAO00040_LayListToaMau] Parameters: [@param0=[LSTLOAITOATHUOC[0],BV], @param1=[LSTLOAITOATHUOC[1],MN], @param2=[LSTLOAITOATHUOC[2],MP], @param3=[LSTLOAITOATHUOC[3],TV]]
2020-01-02 17:52:48,588 [1] DEBUG - Statement Id: [DAO00040_LayListToaMau] Types: [@param0=[String, System.String], @param1=[String, System.String], @param2=[String, System.String], @param3=[String, System.String]]
2020-01-02 17:52:48,687 [1] DEBUG - Statement Id: [DAO00040_LayListToaMau] PreparedStatement : [select A.*, dc.TENDUOCDAYDU, dc.BHYT DUOC_BHYT, ld.LOAIVATTU_ID, ld.MALOAIDUOC, dd.DICTIONARY_NAME DUONGDUNG, dc.TAMNGUNG            from TT_TOATHUOCMAU A            left join TM_DUOC dc on A.DUOC_ID = dc.DUOC_ID            left join TM_LOAIDUOC ld on dc.LOAIDUOC_ID = ld.LOAIDUOC_ID            left join (select * from LST_DICTIONARY where DICTIONARY_TYPE_CODE like 'DuongDung') dd on dd.DICTIONARY_ID = dc.DUONGDUNG_ID            where (1=1)             and               A.BACSI_ID  = 1              and A.LOAITOATHUOC in  (                        @param0                   ,                           @param1                   ,                           @param2                   ,                           @param3                   )]
2020-01-02 17:52:48,687 [1] DEBUG - Statement Id: [DAO00040_LayListToaMau] Parameters: [@param0=[LSTLOAITOATHUOC[0],BV], @param1=[LSTLOAITOATHUOC[1],MN], @param2=[LSTLOAITOATHUOC[2],MP], @param3=[LSTLOAITOATHUOC[3],TV]]
2020-01-02 17:52:48,687 [1] DEBUG - Statement Id: [DAO00040_LayListToaMau] Types: [@param0=[String, System.String], @param1=[String, System.String], @param2=[String, System.String], @param3=[String, System.String]]
2020-01-02 17:52:48,723 [1] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoVaBookingCOM23UpdateRedis_TheoPhamvi] PreparedStatement : [declare @TOAMUANGOAI int = 0;        select @TOAMUANGOAI = isnull(VALUE,0) from TM_SYS_APPSETTINGS where CODE = 'OPD_TOAMUANGOAI_DUNGDANHMUC_DUOC'                if @TOAMUANGOAI = 1        begin        select  distinct '0' + '_' + LTRIM(d.DUOC_ID) + '_' + '0' as DUOC_KEY, 999999999 as SOLUONG        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        where  @param0  = 0        union all        select distinct tk.DUOC_KEY, tk.SOLUONG        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        inner join        (        select  LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')) DUOC_KEY, (SUM(dtk.SOLUONG) - isnull(sum(A.SOLUONG),0) - isnull(sum(B.SOLUONG),0)) SOLUONG, pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        from (select sum(soluong) soluong,duoc_id,nguonduoc_id,khoduoc_id,benhvien_id from TT_DUOC_TONKHO  group by duoc_id,nguonduoc_id,khoduoc_id,benhvien_id) dtk        inner join TM_DUOC_PHAMVISD_MAPPING pvsd on dtk.KHODUOC_ID = pvsd.KHODUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NOITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) B on B.DUOC_ID = dtk.DUOC_ID and B.PHAMVI_ID = pvsd.PHAMVI_ID and B.NGUONHANG_ID = dtk.NGUONDUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NGOAITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) A on A.DUOC_ID = dtk.DUOC_ID and A.PHAMVI_ID = pvsd.PHAMVI_ID and A.NGUONHANG_ID = dtk.NGUONDUOC_ID        where dtk.BENHVIEN_ID = 'HLU01'        group by LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')), pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        ) tk on tk.DUOC_ID = d.DUOC_ID        left join TM_DUOC_PHAMVISUDUNG kd on kd.PHAMVI_ID = tk.PHAMVI_ID and kd.BENHVIEN_ID = 'HLU01'        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = tk.NGUONDUOC_ID and nh.BENHVIEN_ID = 'HLU01'        where d.BENHVIEN_ID = 'HLU01' and tk.PHAMVI_ID =  @param0         end        else        begin        select distinct tk.DUOC_KEY, tk.SOLUONG        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        inner join        (        select  LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')) DUOC_KEY, (SUM(dtk.SOLUONG) - isnull(sum(A.SOLUONG),0) - isnull(sum(B.SOLUONG),0)) SOLUONG, pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        from (select sum(soluong) soluong,duoc_id,nguonduoc_id,khoduoc_id,benhvien_id from TT_DUOC_TONKHO  group by duoc_id,nguonduoc_id,khoduoc_id,benhvien_id) dtk        inner join TM_DUOC_PHAMVISD_MAPPING pvsd on dtk.KHODUOC_ID = pvsd.KHODUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NOITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) B on B.DUOC_ID = dtk.DUOC_ID and B.PHAMVI_ID = pvsd.PHAMVI_ID and B.NGUONHANG_ID = dtk.NGUONDUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NGOAITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) A on A.DUOC_ID = dtk.DUOC_ID and A.PHAMVI_ID = pvsd.PHAMVI_ID and A.NGUONHANG_ID = dtk.NGUONDUOC_ID        where dtk.BENHVIEN_ID = 'HLU01'        group by LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')), pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        ) tk on tk.DUOC_ID = d.DUOC_ID        left join TM_DUOC_PHAMVISUDUNG kd on kd.PHAMVI_ID = tk.PHAMVI_ID and kd.BENHVIEN_ID = 'HLU01'        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = tk.NGUONDUOC_ID and nh.BENHVIEN_ID = 'HLU01'        where d.BENHVIEN_ID = 'HLU01' and tk.PHAMVI_ID =  @param0         end]
2020-01-02 17:52:48,723 [1] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoVaBookingCOM23UpdateRedis_TheoPhamvi] Parameters: [@param0=[PHAMVI_ID,1028]]
2020-01-02 17:52:48,723 [1] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoVaBookingCOM23UpdateRedis_TheoPhamvi] Types: [@param0=[Int64, System.Int64]]
2020-01-02 17:52:48,900 [1] DEBUG - Statement Id: [DAO00013_GetTienSuBenh] PreparedStatement : [select TIENSUBENH, TIENSUDIUNG        from TT_BENHNHAN        where TT_BENHNHAN.BENHNHAN_ID  = '24441']
2020-01-02 17:52:48,925 [1] DEBUG - Statement Id: [DAO00095_GetTTDiUngThuoc] PreparedStatement : [select *              from TT_BENHNHAN_DIUNG_THUOC              where BENHNHAN_ID = '24441'              and BENHVIEN_ID = 'HLU01']
2020-01-02 17:52:48,950 [1] DEBUG - Statement Id: [DAO00014_GetTotalChiPhiDVByTiepNhan] PreparedStatement : [select sum(THANHTIEN_DOANHTHU) as THANHTIEN_DOANHTHU from TT_VIENPHI        where ACTIVE = '1'        and TIEPNHAN_ID = '28493'        and REF_TABLE = 'TT_DVYEUCAU'        and exists (select DVYEUCAU_ID from TT_DVYEUCAU where HUYYEUCAU = '0' and TIEPNHAN_ID = '28493' and TT_VIENPHI.REF_ID = DVYEUCAU_ID)]
2020-01-02 17:52:48,982 [1] DEBUG - Statement Id: [DAO00014_GetKhamBenhInfo] PreparedStatement : [select * from TT_NGOAITRU_KHAMBENH where KHAMBENH_ID =        (select KHAMBENH_NGOAITRU_ID from TT_DVYEUCAU where DVYEUCAU_ID = '206519')]
2020-01-02 17:52:49,013 [1] DEBUG - Statement Id: [DAO00068_GetSinhHieuBySinhHieuID] PreparedStatement : [select top (1) *            from TT_NGOAITRU_KHAMBENH_SINHHIEU            where KHAMBENH_SINHHIEU_ID = '0'            and BENHVIEN_ID = 'HLU01'             and               BENHNHAN_ID = '24441'                           order by KHAMBENH_SINHHIEU_ID]
2020-01-02 17:52:49,129 [1] DEBUG - Statement Id: [DAO00014_GetKhamBenhICDInfo] PreparedStatement : [select *        from TT_NGOAITRU_KHAMBENH_ICD        where KHAMBENH_ID  = '27176']
2020-01-02 17:52:49,156 [1] DEBUG - Statement Id: [DAO00014_GetListToaThuoc] PreparedStatement : [select A.*        from TT_NGOAITRU_KHAMBENH_TOATHUOC A        where A.KHAMBENH_ID = '27176']
2020-01-02 17:52:49,182 [1] DEBUG - Statement Id: [DAO00014_KiemTraDVYCCoGiaBHYT] PreparedStatement : [select *        from TT_VIENPHI        where REF_ID  = '206519' and REF_TABLE = 'TT_DVYEUCAU' and BHYT_DONGIA > 0]
2020-01-02 17:52:49,223 [1] DEBUG - Statement Id: [DAO00040_LayListToaMau] PreparedStatement : [select A.*, dc.TENDUOCDAYDU, dc.BHYT DUOC_BHYT, ld.LOAIVATTU_ID, ld.MALOAIDUOC, dd.DICTIONARY_NAME DUONGDUNG, dc.TAMNGUNG            from TT_TOATHUOCMAU A            left join TM_DUOC dc on A.DUOC_ID = dc.DUOC_ID            left join TM_LOAIDUOC ld on dc.LOAIDUOC_ID = ld.LOAIDUOC_ID            left join (select * from LST_DICTIONARY where DICTIONARY_TYPE_CODE like 'DuongDung') dd on dd.DICTIONARY_ID = dc.DUONGDUNG_ID            where (1=1)             and               A.BACSI_ID  = 1              and A.LOAITOATHUOC in  (                        @param0                   ,                           @param1                   ,                           @param2                   ,                           @param3                   )]
2020-01-02 17:52:49,223 [1] DEBUG - Statement Id: [DAO00040_LayListToaMau] Parameters: [@param0=[LSTLOAITOATHUOC[0],BV], @param1=[LSTLOAITOATHUOC[1],MN], @param2=[LSTLOAITOATHUOC[2],MP], @param3=[LSTLOAITOATHUOC[3],TV]]
2020-01-02 17:52:49,223 [1] DEBUG - Statement Id: [DAO00040_LayListToaMau] Types: [@param0=[String, System.String], @param1=[String, System.String], @param2=[String, System.String], @param3=[String, System.String]]
2020-01-02 17:52:49,304 [1] DEBUG - Statement Id: [DAO00040_LayListToaMau] PreparedStatement : [select A.*, dc.TENDUOCDAYDU, dc.BHYT DUOC_BHYT, ld.LOAIVATTU_ID, ld.MALOAIDUOC, dd.DICTIONARY_NAME DUONGDUNG, dc.TAMNGUNG            from TT_TOATHUOCMAU A            left join TM_DUOC dc on A.DUOC_ID = dc.DUOC_ID            left join TM_LOAIDUOC ld on dc.LOAIDUOC_ID = ld.LOAIDUOC_ID            left join (select * from LST_DICTIONARY where DICTIONARY_TYPE_CODE like 'DuongDung') dd on dd.DICTIONARY_ID = dc.DUONGDUNG_ID            where (1=1)             and               A.BACSI_ID  = 1              and A.LOAITOATHUOC in  (                        @param0                   ,                           @param1                   ,                           @param2                   ,                           @param3                   )]
2020-01-02 17:52:49,304 [1] DEBUG - Statement Id: [DAO00040_LayListToaMau] Parameters: [@param0=[LSTLOAITOATHUOC[0],BV], @param1=[LSTLOAITOATHUOC[1],MN], @param2=[LSTLOAITOATHUOC[2],MP], @param3=[LSTLOAITOATHUOC[3],TV]]
2020-01-02 17:52:49,304 [1] DEBUG - Statement Id: [DAO00040_LayListToaMau] Types: [@param0=[String, System.String], @param1=[String, System.String], @param2=[String, System.String], @param3=[String, System.String]]
2020-01-02 17:52:49,338 [1] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoVaBookingCOM23UpdateRedis_TheoPhamvi] PreparedStatement : [declare @TOAMUANGOAI int = 0;        select @TOAMUANGOAI = isnull(VALUE,0) from TM_SYS_APPSETTINGS where CODE = 'OPD_TOAMUANGOAI_DUNGDANHMUC_DUOC'                if @TOAMUANGOAI = 1        begin        select  distinct '0' + '_' + LTRIM(d.DUOC_ID) + '_' + '0' as DUOC_KEY, 999999999 as SOLUONG        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        where  @param0  = 0        union all        select distinct tk.DUOC_KEY, tk.SOLUONG        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        inner join        (        select  LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')) DUOC_KEY, (SUM(dtk.SOLUONG) - isnull(sum(A.SOLUONG),0) - isnull(sum(B.SOLUONG),0)) SOLUONG, pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        from (select sum(soluong) soluong,duoc_id,nguonduoc_id,khoduoc_id,benhvien_id from TT_DUOC_TONKHO  group by duoc_id,nguonduoc_id,khoduoc_id,benhvien_id) dtk        inner join TM_DUOC_PHAMVISD_MAPPING pvsd on dtk.KHODUOC_ID = pvsd.KHODUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NOITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) B on B.DUOC_ID = dtk.DUOC_ID and B.PHAMVI_ID = pvsd.PHAMVI_ID and B.NGUONHANG_ID = dtk.NGUONDUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NGOAITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) A on A.DUOC_ID = dtk.DUOC_ID and A.PHAMVI_ID = pvsd.PHAMVI_ID and A.NGUONHANG_ID = dtk.NGUONDUOC_ID        where dtk.BENHVIEN_ID = 'HLU01'        group by LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')), pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        ) tk on tk.DUOC_ID = d.DUOC_ID        left join TM_DUOC_PHAMVISUDUNG kd on kd.PHAMVI_ID = tk.PHAMVI_ID and kd.BENHVIEN_ID = 'HLU01'        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = tk.NGUONDUOC_ID and nh.BENHVIEN_ID = 'HLU01'        where d.BENHVIEN_ID = 'HLU01' and tk.PHAMVI_ID =  @param0         end        else        begin        select distinct tk.DUOC_KEY, tk.SOLUONG        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        inner join        (        select  LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')) DUOC_KEY, (SUM(dtk.SOLUONG) - isnull(sum(A.SOLUONG),0) - isnull(sum(B.SOLUONG),0)) SOLUONG, pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        from (select sum(soluong) soluong,duoc_id,nguonduoc_id,khoduoc_id,benhvien_id from TT_DUOC_TONKHO  group by duoc_id,nguonduoc_id,khoduoc_id,benhvien_id) dtk        inner join TM_DUOC_PHAMVISD_MAPPING pvsd on dtk.KHODUOC_ID = pvsd.KHODUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NOITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) B on B.DUOC_ID = dtk.DUOC_ID and B.PHAMVI_ID = pvsd.PHAMVI_ID and B.NGUONHANG_ID = dtk.NGUONDUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NGOAITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) A on A.DUOC_ID = dtk.DUOC_ID and A.PHAMVI_ID = pvsd.PHAMVI_ID and A.NGUONHANG_ID = dtk.NGUONDUOC_ID        where dtk.BENHVIEN_ID = 'HLU01'        group by LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')), pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        ) tk on tk.DUOC_ID = d.DUOC_ID        left join TM_DUOC_PHAMVISUDUNG kd on kd.PHAMVI_ID = tk.PHAMVI_ID and kd.BENHVIEN_ID = 'HLU01'        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = tk.NGUONDUOC_ID and nh.BENHVIEN_ID = 'HLU01'        where d.BENHVIEN_ID = 'HLU01' and tk.PHAMVI_ID =  @param0         end]
2020-01-02 17:52:49,338 [1] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoVaBookingCOM23UpdateRedis_TheoPhamvi] Parameters: [@param0=[PHAMVI_ID,1028]]
2020-01-02 17:52:49,338 [1] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoVaBookingCOM23UpdateRedis_TheoPhamvi] Types: [@param0=[Int64, System.Int64]]
2020-01-02 17:52:49,553 [1] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoVaBookingCOM23UpdateRedis_TheoPhamvi] PreparedStatement : [declare @TOAMUANGOAI int = 0;        select @TOAMUANGOAI = isnull(VALUE,0) from TM_SYS_APPSETTINGS where CODE = 'OPD_TOAMUANGOAI_DUNGDANHMUC_DUOC'                if @TOAMUANGOAI = 1        begin        select  distinct '0' + '_' + LTRIM(d.DUOC_ID) + '_' + '0' as DUOC_KEY, 999999999 as SOLUONG        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        where  @param0  = 0        union all        select distinct tk.DUOC_KEY, tk.SOLUONG        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        inner join        (        select  LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')) DUOC_KEY, (SUM(dtk.SOLUONG) - isnull(sum(A.SOLUONG),0) - isnull(sum(B.SOLUONG),0)) SOLUONG, pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        from (select sum(soluong) soluong,duoc_id,nguonduoc_id,khoduoc_id,benhvien_id from TT_DUOC_TONKHO  group by duoc_id,nguonduoc_id,khoduoc_id,benhvien_id) dtk        inner join TM_DUOC_PHAMVISD_MAPPING pvsd on dtk.KHODUOC_ID = pvsd.KHODUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NOITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) B on B.DUOC_ID = dtk.DUOC_ID and B.PHAMVI_ID = pvsd.PHAMVI_ID and B.NGUONHANG_ID = dtk.NGUONDUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NGOAITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) A on A.DUOC_ID = dtk.DUOC_ID and A.PHAMVI_ID = pvsd.PHAMVI_ID and A.NGUONHANG_ID = dtk.NGUONDUOC_ID        where dtk.BENHVIEN_ID = 'HLU01'        group by LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')), pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        ) tk on tk.DUOC_ID = d.DUOC_ID        left join TM_DUOC_PHAMVISUDUNG kd on kd.PHAMVI_ID = tk.PHAMVI_ID and kd.BENHVIEN_ID = 'HLU01'        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = tk.NGUONDUOC_ID and nh.BENHVIEN_ID = 'HLU01'        where d.BENHVIEN_ID = 'HLU01' and tk.PHAMVI_ID =  @param0         end        else        begin        select distinct tk.DUOC_KEY, tk.SOLUONG        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        inner join        (        select  LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')) DUOC_KEY, (SUM(dtk.SOLUONG) - isnull(sum(A.SOLUONG),0) - isnull(sum(B.SOLUONG),0)) SOLUONG, pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        from (select sum(soluong) soluong,duoc_id,nguonduoc_id,khoduoc_id,benhvien_id from TT_DUOC_TONKHO  group by duoc_id,nguonduoc_id,khoduoc_id,benhvien_id) dtk        inner join TM_DUOC_PHAMVISD_MAPPING pvsd on dtk.KHODUOC_ID = pvsd.KHODUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NOITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) B on B.DUOC_ID = dtk.DUOC_ID and B.PHAMVI_ID = pvsd.PHAMVI_ID and B.NGUONHANG_ID = dtk.NGUONDUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NGOAITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) A on A.DUOC_ID = dtk.DUOC_ID and A.PHAMVI_ID = pvsd.PHAMVI_ID and A.NGUONHANG_ID = dtk.NGUONDUOC_ID        where dtk.BENHVIEN_ID = 'HLU01'        group by LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')), pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        ) tk on tk.DUOC_ID = d.DUOC_ID        left join TM_DUOC_PHAMVISUDUNG kd on kd.PHAMVI_ID = tk.PHAMVI_ID and kd.BENHVIEN_ID = 'HLU01'        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = tk.NGUONDUOC_ID and nh.BENHVIEN_ID = 'HLU01'        where d.BENHVIEN_ID = 'HLU01' and tk.PHAMVI_ID =  @param0         end]
2020-01-02 17:52:49,553 [1] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoVaBookingCOM23UpdateRedis_TheoPhamvi] Parameters: [@param0=[PHAMVI_ID,1028]]
2020-01-02 17:52:49,553 [1] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoVaBookingCOM23UpdateRedis_TheoPhamvi] Types: [@param0=[Int64, System.Int64]]
2020-01-02 17:52:49,829 [1] DEBUG - Statement Id: [DAO00068_GetLastedSinhHieuInfo] PreparedStatement : [select top (1) *, CHISOBMI as BMI              from TT_NGOAITRU_KHAMBENH_SINHHIEU              where BENHNHAN_ID = '24441'              order by KHAMBENH_SINHHIEU_ID desc]
2020-01-02 17:52:56,357 [1] DEBUG - Statement Id: [DAO00014_GetChitietDVYeucauKhamBenh] PreparedStatement : [select *        from TT_DVYEUCAU        where DVYEUCAU_ID  = '206519']
2020-01-02 17:52:56,384 [1] DEBUG - Statement Id: [DAO00014_GetPatientStatus] PreparedStatement : [select        CASE        when tn.TRANGTHAI = 'HOANTHANH' Then tn.TRANGTHAI        WHEN xncp.XACNHANCHIPHI_ID is not null THEN 'XACNHANCHIPHI'        WHEN (tn.KHOADULIEU = '1') THEN 'KHOADULIEU'        ELSE tn.TRANGTHAI        END        as TRANGTHAI        from TT_TIEPNHAN tn        left join TT_XACNHANCHIPHI xncp on tn.TIEPNHAN_ID = xncp.TIEPNHAN_ID        where tn.TIEPNHAN_ID = '28493'        and tn.BENHVIEN_ID = 'HLU01']
2020-01-02 17:52:56,457 [1] DEBUG - Statement Id: [DAO00014_GetThongtinKhamsuckhoeTheoDVyc] PreparedStatement : [select HOPDONG_ID, HOPDONG_BENHNHAN_ID from TT_DVYEUCAU where DVYEUCAU_ID =  @param0]
2020-01-02 17:52:56,457 [1] DEBUG - Statement Id: [DAO00014_GetThongtinKhamsuckhoeTheoDVyc] Parameters: [@param0=[DVYEUCAU_ID,206519]]
2020-01-02 17:52:56,457 [1] DEBUG - Statement Id: [DAO00014_GetThongtinKhamsuckhoeTheoDVyc] Types: [@param0=[Int64, System.Int64]]
2020-01-02 17:52:56,485 [1] DEBUG - Statement Id: [DAO00009_TT_TIEPNHAN_GetProcess] PreparedStatement : [select PROCESS_ID from TT_TIEPNHAN where SOTIEPNHAN = 'TN200102.0000001']
2020-01-02 17:52:56,523 [1] DEBUG - Statement Id: [DAOWF004_laytrangthaiDV] PreparedStatement : [select top 1 A.CURR_STATE_CODE as STATE_CODE, isNull(C.SHORT_NAME,C.NAME) as TRANGTHAI, C.NAME as TRANGTHAI_CHITIET, C.STATUS_CODE, D.ISACTIVE as ACTIVE, E.STATUS_CODE  as OLD_STATUSCODE        from TT_REQUEST_SERVICE_DETAIL A                left join (select * from TT_REQUEST_SERVICE where PARA = '{"DICHVU_ID":"5492","DVYEUCAU_ID":"206519"}') D on D.ID = A.REQUEST_SERVICE_ID        left join TM_STATE C on A.CURR_STATE_CODE = C.STATE_CODE and C.PROCESS_CODE = D.PROCESS_CODE        left join TM_STATE E on A.OLD_STATE_CODE = E.STATE_CODE and E.PROCESS_CODE = D.PROCESS_CODE        where        A.REQUEST_SERVICE_ID = (select top 1 ID from TT_REQUEST_SERVICE where PARA = '{"DICHVU_ID":"5492","DVYEUCAU_ID":"206519"}' order by ID desc)        order by A.ID desc]
2020-01-02 17:52:56,549 [1] DEBUG - Statement Id: [DAO00014_CheckExistNhapVien] PreparedStatement : [select NHAPVIEN_ID        from TT_NOITRU_NHAPVIEN        where TIEPNHAN_ID  = '28493'        and TRANGTHAI != 'CHOXACNHAN']
2020-01-02 17:52:56,576 [1] DEBUG - Statement Id: [DAO00014_CheckExistCapCuu] PreparedStatement : [select THONGTINCAPCUU_ID        from TT_TIEPNHAN_THONGTINCAPCUU        where TIEPNHAN_ID  = '28493' and BENHVIEN_ID = 'HLU01']
2020-01-02 17:52:56,609 [1] DEBUG - Statement Id: [DAO00014_CheckExistChuyenVien] PreparedStatement : [select CHUYENVIEN_ID        from TT_CHUYENVIEN        where TIEPNHAN_ID  = '28493']
2020-01-02 17:52:56,779 [1] DEBUG - Statement Id: [DAO00017_GetLoaiGiaByDoiTuongId] PreparedStatement : [select dtlg.DOUUTIEN, dtlg.DOITUONG_ID, lg.LOAIGIA_ID, lg.TENLOAIGIA, lg.MALOAIGIA              from TM_LOAIGIA lg              left join TM_DOITUONG_LOAIGIA dtlg              on lg.LOAIGIA_ID = dtlg.LOAIGIA_ID and dtlg.BENHVIEN_ID = 'HLU01'              where lg.TAMNGUNG = 0 and lg.BENHVIEN_ID = 'HLU01'                             order by dtlg.DOUUTIEN]
2020-01-02 17:52:56,832 [1] DEBUG - Statement Id: [DAO00014_KiemTraDVYCCoGiaBHYT] PreparedStatement : [select *        from TT_VIENPHI        where REF_ID  = '206519' and REF_TABLE = 'TT_DVYEUCAU' and BHYT_DONGIA > 0]
2020-01-02 17:52:56,876 [1] DEBUG - Statement Id: [DAO00040_LayListToaMau] PreparedStatement : [select A.*, dc.TENDUOCDAYDU, dc.BHYT DUOC_BHYT, ld.LOAIVATTU_ID, ld.MALOAIDUOC, dd.DICTIONARY_NAME DUONGDUNG, dc.TAMNGUNG            from TT_TOATHUOCMAU A            left join TM_DUOC dc on A.DUOC_ID = dc.DUOC_ID            left join TM_LOAIDUOC ld on dc.LOAIDUOC_ID = ld.LOAIDUOC_ID            left join (select * from LST_DICTIONARY where DICTIONARY_TYPE_CODE like 'DuongDung') dd on dd.DICTIONARY_ID = dc.DUONGDUNG_ID            where (1=1)             and               A.BACSI_ID  = 1              and A.LOAITOATHUOC in  (                        @param0                   ,                           @param1                   ,                           @param2                   ,                           @param3                   )]
2020-01-02 17:52:56,876 [1] DEBUG - Statement Id: [DAO00040_LayListToaMau] Parameters: [@param0=[LSTLOAITOATHUOC[0],BV], @param1=[LSTLOAITOATHUOC[1],MN], @param2=[LSTLOAITOATHUOC[2],MP], @param3=[LSTLOAITOATHUOC[3],TV]]
2020-01-02 17:52:56,876 [1] DEBUG - Statement Id: [DAO00040_LayListToaMau] Types: [@param0=[String, System.String], @param1=[String, System.String], @param2=[String, System.String], @param3=[String, System.String]]
2020-01-02 17:52:56,977 [1] DEBUG - Statement Id: [DAO00040_LayListToaMau] PreparedStatement : [select A.*, dc.TENDUOCDAYDU, dc.BHYT DUOC_BHYT, ld.LOAIVATTU_ID, ld.MALOAIDUOC, dd.DICTIONARY_NAME DUONGDUNG, dc.TAMNGUNG            from TT_TOATHUOCMAU A            left join TM_DUOC dc on A.DUOC_ID = dc.DUOC_ID            left join TM_LOAIDUOC ld on dc.LOAIDUOC_ID = ld.LOAIDUOC_ID            left join (select * from LST_DICTIONARY where DICTIONARY_TYPE_CODE like 'DuongDung') dd on dd.DICTIONARY_ID = dc.DUONGDUNG_ID            where (1=1)             and               A.BACSI_ID  = 1              and A.LOAITOATHUOC in  (                        @param0                   ,                           @param1                   ,                           @param2                   ,                           @param3                   )]
2020-01-02 17:52:56,978 [1] DEBUG - Statement Id: [DAO00040_LayListToaMau] Parameters: [@param0=[LSTLOAITOATHUOC[0],BV], @param1=[LSTLOAITOATHUOC[1],MN], @param2=[LSTLOAITOATHUOC[2],MP], @param3=[LSTLOAITOATHUOC[3],TV]]
2020-01-02 17:52:56,978 [1] DEBUG - Statement Id: [DAO00040_LayListToaMau] Types: [@param0=[String, System.String], @param1=[String, System.String], @param2=[String, System.String], @param3=[String, System.String]]
2020-01-02 17:52:57,027 [1] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoVaBookingCOM23UpdateRedis_TheoPhamvi] PreparedStatement : [declare @TOAMUANGOAI int = 0;        select @TOAMUANGOAI = isnull(VALUE,0) from TM_SYS_APPSETTINGS where CODE = 'OPD_TOAMUANGOAI_DUNGDANHMUC_DUOC'                if @TOAMUANGOAI = 1        begin        select  distinct '0' + '_' + LTRIM(d.DUOC_ID) + '_' + '0' as DUOC_KEY, 999999999 as SOLUONG        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        where  @param0  = 0        union all        select distinct tk.DUOC_KEY, tk.SOLUONG        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        inner join        (        select  LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')) DUOC_KEY, (SUM(dtk.SOLUONG) - isnull(sum(A.SOLUONG),0) - isnull(sum(B.SOLUONG),0)) SOLUONG, pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        from (select sum(soluong) soluong,duoc_id,nguonduoc_id,khoduoc_id,benhvien_id from TT_DUOC_TONKHO  group by duoc_id,nguonduoc_id,khoduoc_id,benhvien_id) dtk        inner join TM_DUOC_PHAMVISD_MAPPING pvsd on dtk.KHODUOC_ID = pvsd.KHODUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NOITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) B on B.DUOC_ID = dtk.DUOC_ID and B.PHAMVI_ID = pvsd.PHAMVI_ID and B.NGUONHANG_ID = dtk.NGUONDUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NGOAITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) A on A.DUOC_ID = dtk.DUOC_ID and A.PHAMVI_ID = pvsd.PHAMVI_ID and A.NGUONHANG_ID = dtk.NGUONDUOC_ID        where dtk.BENHVIEN_ID = 'HLU01'        group by LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')), pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        ) tk on tk.DUOC_ID = d.DUOC_ID        left join TM_DUOC_PHAMVISUDUNG kd on kd.PHAMVI_ID = tk.PHAMVI_ID and kd.BENHVIEN_ID = 'HLU01'        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = tk.NGUONDUOC_ID and nh.BENHVIEN_ID = 'HLU01'        where d.BENHVIEN_ID = 'HLU01' and tk.PHAMVI_ID =  @param0         end        else        begin        select distinct tk.DUOC_KEY, tk.SOLUONG        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        inner join        (        select  LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')) DUOC_KEY, (SUM(dtk.SOLUONG) - isnull(sum(A.SOLUONG),0) - isnull(sum(B.SOLUONG),0)) SOLUONG, pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        from (select sum(soluong) soluong,duoc_id,nguonduoc_id,khoduoc_id,benhvien_id from TT_DUOC_TONKHO  group by duoc_id,nguonduoc_id,khoduoc_id,benhvien_id) dtk        inner join TM_DUOC_PHAMVISD_MAPPING pvsd on dtk.KHODUOC_ID = pvsd.KHODUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NOITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) B on B.DUOC_ID = dtk.DUOC_ID and B.PHAMVI_ID = pvsd.PHAMVI_ID and B.NGUONHANG_ID = dtk.NGUONDUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NGOAITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) A on A.DUOC_ID = dtk.DUOC_ID and A.PHAMVI_ID = pvsd.PHAMVI_ID and A.NGUONHANG_ID = dtk.NGUONDUOC_ID        where dtk.BENHVIEN_ID = 'HLU01'        group by LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')), pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        ) tk on tk.DUOC_ID = d.DUOC_ID        left join TM_DUOC_PHAMVISUDUNG kd on kd.PHAMVI_ID = tk.PHAMVI_ID and kd.BENHVIEN_ID = 'HLU01'        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = tk.NGUONDUOC_ID and nh.BENHVIEN_ID = 'HLU01'        where d.BENHVIEN_ID = 'HLU01' and tk.PHAMVI_ID =  @param0         end]
2020-01-02 17:52:57,027 [1] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoVaBookingCOM23UpdateRedis_TheoPhamvi] Parameters: [@param0=[PHAMVI_ID,1028]]
2020-01-02 17:52:57,027 [1] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoVaBookingCOM23UpdateRedis_TheoPhamvi] Types: [@param0=[Int64, System.Int64]]
2020-01-02 17:52:57,204 [1] DEBUG - Statement Id: [DAO00013_GetTienSuBenh] PreparedStatement : [select TIENSUBENH, TIENSUDIUNG        from TT_BENHNHAN        where TT_BENHNHAN.BENHNHAN_ID  = '24441']
2020-01-02 17:52:57,230 [1] DEBUG - Statement Id: [DAO00095_GetTTDiUngThuoc] PreparedStatement : [select *              from TT_BENHNHAN_DIUNG_THUOC              where BENHNHAN_ID = '24441'              and BENHVIEN_ID = 'HLU01']
2020-01-02 17:52:57,257 [1] DEBUG - Statement Id: [DAO00014_GetTotalChiPhiDVByTiepNhan] PreparedStatement : [select sum(THANHTIEN_DOANHTHU) as THANHTIEN_DOANHTHU from TT_VIENPHI        where ACTIVE = '1'        and TIEPNHAN_ID = '28493'        and REF_TABLE = 'TT_DVYEUCAU'        and exists (select DVYEUCAU_ID from TT_DVYEUCAU where HUYYEUCAU = '0' and TIEPNHAN_ID = '28493' and TT_VIENPHI.REF_ID = DVYEUCAU_ID)]
2020-01-02 17:52:57,299 [1] DEBUG - Statement Id: [DAO00014_GetKhamBenhInfo] PreparedStatement : [select * from TT_NGOAITRU_KHAMBENH where KHAMBENH_ID =        (select KHAMBENH_NGOAITRU_ID from TT_DVYEUCAU where DVYEUCAU_ID = '206519')]
2020-01-02 17:52:57,331 [1] DEBUG - Statement Id: [DAO00068_GetSinhHieuBySinhHieuID] PreparedStatement : [select top (1) *            from TT_NGOAITRU_KHAMBENH_SINHHIEU            where KHAMBENH_SINHHIEU_ID = '0'            and BENHVIEN_ID = 'HLU01'             and               BENHNHAN_ID = '24441'                           order by KHAMBENH_SINHHIEU_ID]
2020-01-02 17:52:57,471 [1] DEBUG - Statement Id: [DAO00014_GetKhamBenhICDInfo] PreparedStatement : [select *        from TT_NGOAITRU_KHAMBENH_ICD        where KHAMBENH_ID  = '27176']
2020-01-02 17:52:57,495 [1] DEBUG - Statement Id: [DAO00014_GetListToaThuoc] PreparedStatement : [select A.*        from TT_NGOAITRU_KHAMBENH_TOATHUOC A        where A.KHAMBENH_ID = '27176']
2020-01-02 17:52:57,529 [1] DEBUG - Statement Id: [DAO00014_KiemTraDVYCCoGiaBHYT] PreparedStatement : [select *        from TT_VIENPHI        where REF_ID  = '206519' and REF_TABLE = 'TT_DVYEUCAU' and BHYT_DONGIA > 0]
2020-01-02 17:52:57,574 [1] DEBUG - Statement Id: [DAO00040_LayListToaMau] PreparedStatement : [select A.*, dc.TENDUOCDAYDU, dc.BHYT DUOC_BHYT, ld.LOAIVATTU_ID, ld.MALOAIDUOC, dd.DICTIONARY_NAME DUONGDUNG, dc.TAMNGUNG            from TT_TOATHUOCMAU A            left join TM_DUOC dc on A.DUOC_ID = dc.DUOC_ID            left join TM_LOAIDUOC ld on dc.LOAIDUOC_ID = ld.LOAIDUOC_ID            left join (select * from LST_DICTIONARY where DICTIONARY_TYPE_CODE like 'DuongDung') dd on dd.DICTIONARY_ID = dc.DUONGDUNG_ID            where (1=1)             and               A.BACSI_ID  = 1              and A.LOAITOATHUOC in  (                        @param0                   ,                           @param1                   ,                           @param2                   ,                           @param3                   )]
2020-01-02 17:52:57,574 [1] DEBUG - Statement Id: [DAO00040_LayListToaMau] Parameters: [@param0=[LSTLOAITOATHUOC[0],BV], @param1=[LSTLOAITOATHUOC[1],MN], @param2=[LSTLOAITOATHUOC[2],MP], @param3=[LSTLOAITOATHUOC[3],TV]]
2020-01-02 17:52:57,574 [1] DEBUG - Statement Id: [DAO00040_LayListToaMau] Types: [@param0=[String, System.String], @param1=[String, System.String], @param2=[String, System.String], @param3=[String, System.String]]
2020-01-02 17:52:57,680 [1] DEBUG - Statement Id: [DAO00040_LayListToaMau] PreparedStatement : [select A.*, dc.TENDUOCDAYDU, dc.BHYT DUOC_BHYT, ld.LOAIVATTU_ID, ld.MALOAIDUOC, dd.DICTIONARY_NAME DUONGDUNG, dc.TAMNGUNG            from TT_TOATHUOCMAU A            left join TM_DUOC dc on A.DUOC_ID = dc.DUOC_ID            left join TM_LOAIDUOC ld on dc.LOAIDUOC_ID = ld.LOAIDUOC_ID            left join (select * from LST_DICTIONARY where DICTIONARY_TYPE_CODE like 'DuongDung') dd on dd.DICTIONARY_ID = dc.DUONGDUNG_ID            where (1=1)             and               A.BACSI_ID  = 1              and A.LOAITOATHUOC in  (                        @param0                   ,                           @param1                   ,                           @param2                   ,                           @param3                   )]
2020-01-02 17:52:57,680 [1] DEBUG - Statement Id: [DAO00040_LayListToaMau] Parameters: [@param0=[LSTLOAITOATHUOC[0],BV], @param1=[LSTLOAITOATHUOC[1],MN], @param2=[LSTLOAITOATHUOC[2],MP], @param3=[LSTLOAITOATHUOC[3],TV]]
2020-01-02 17:52:57,680 [1] DEBUG - Statement Id: [DAO00040_LayListToaMau] Types: [@param0=[String, System.String], @param1=[String, System.String], @param2=[String, System.String], @param3=[String, System.String]]
2020-01-02 17:52:57,713 [1] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoVaBookingCOM23UpdateRedis_TheoPhamvi] PreparedStatement : [declare @TOAMUANGOAI int = 0;        select @TOAMUANGOAI = isnull(VALUE,0) from TM_SYS_APPSETTINGS where CODE = 'OPD_TOAMUANGOAI_DUNGDANHMUC_DUOC'                if @TOAMUANGOAI = 1        begin        select  distinct '0' + '_' + LTRIM(d.DUOC_ID) + '_' + '0' as DUOC_KEY, 999999999 as SOLUONG        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        where  @param0  = 0        union all        select distinct tk.DUOC_KEY, tk.SOLUONG        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        inner join        (        select  LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')) DUOC_KEY, (SUM(dtk.SOLUONG) - isnull(sum(A.SOLUONG),0) - isnull(sum(B.SOLUONG),0)) SOLUONG, pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        from (select sum(soluong) soluong,duoc_id,nguonduoc_id,khoduoc_id,benhvien_id from TT_DUOC_TONKHO  group by duoc_id,nguonduoc_id,khoduoc_id,benhvien_id) dtk        inner join TM_DUOC_PHAMVISD_MAPPING pvsd on dtk.KHODUOC_ID = pvsd.KHODUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NOITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) B on B.DUOC_ID = dtk.DUOC_ID and B.PHAMVI_ID = pvsd.PHAMVI_ID and B.NGUONHANG_ID = dtk.NGUONDUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NGOAITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) A on A.DUOC_ID = dtk.DUOC_ID and A.PHAMVI_ID = pvsd.PHAMVI_ID and A.NGUONHANG_ID = dtk.NGUONDUOC_ID        where dtk.BENHVIEN_ID = 'HLU01'        group by LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')), pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        ) tk on tk.DUOC_ID = d.DUOC_ID        left join TM_DUOC_PHAMVISUDUNG kd on kd.PHAMVI_ID = tk.PHAMVI_ID and kd.BENHVIEN_ID = 'HLU01'        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = tk.NGUONDUOC_ID and nh.BENHVIEN_ID = 'HLU01'        where d.BENHVIEN_ID = 'HLU01' and tk.PHAMVI_ID =  @param0         end        else        begin        select distinct tk.DUOC_KEY, tk.SOLUONG        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        inner join        (        select  LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')) DUOC_KEY, (SUM(dtk.SOLUONG) - isnull(sum(A.SOLUONG),0) - isnull(sum(B.SOLUONG),0)) SOLUONG, pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        from (select sum(soluong) soluong,duoc_id,nguonduoc_id,khoduoc_id,benhvien_id from TT_DUOC_TONKHO  group by duoc_id,nguonduoc_id,khoduoc_id,benhvien_id) dtk        inner join TM_DUOC_PHAMVISD_MAPPING pvsd on dtk.KHODUOC_ID = pvsd.KHODUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NOITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) B on B.DUOC_ID = dtk.DUOC_ID and B.PHAMVI_ID = pvsd.PHAMVI_ID and B.NGUONHANG_ID = dtk.NGUONDUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NGOAITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) A on A.DUOC_ID = dtk.DUOC_ID and A.PHAMVI_ID = pvsd.PHAMVI_ID and A.NGUONHANG_ID = dtk.NGUONDUOC_ID        where dtk.BENHVIEN_ID = 'HLU01'        group by LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')), pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        ) tk on tk.DUOC_ID = d.DUOC_ID        left join TM_DUOC_PHAMVISUDUNG kd on kd.PHAMVI_ID = tk.PHAMVI_ID and kd.BENHVIEN_ID = 'HLU01'        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = tk.NGUONDUOC_ID and nh.BENHVIEN_ID = 'HLU01'        where d.BENHVIEN_ID = 'HLU01' and tk.PHAMVI_ID =  @param0         end]
2020-01-02 17:52:57,713 [1] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoVaBookingCOM23UpdateRedis_TheoPhamvi] Parameters: [@param0=[PHAMVI_ID,1028]]
2020-01-02 17:52:57,713 [1] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoVaBookingCOM23UpdateRedis_TheoPhamvi] Types: [@param0=[Int64, System.Int64]]
2020-01-02 17:52:57,914 [1] DEBUG - Statement Id: [DAO00068_GetLastedSinhHieuInfo] PreparedStatement : [select top (1) *, CHISOBMI as BMI              from TT_NGOAITRU_KHAMBENH_SINHHIEU              where BENHNHAN_ID = '24441'              order by KHAMBENH_SINHHIEU_ID desc]
2020-01-02 17:52:58,033 [1] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoVaBookingCOM23UpdateRedis_TheoPhamvi] PreparedStatement : [declare @TOAMUANGOAI int = 0;        select @TOAMUANGOAI = isnull(VALUE,0) from TM_SYS_APPSETTINGS where CODE = 'OPD_TOAMUANGOAI_DUNGDANHMUC_DUOC'                if @TOAMUANGOAI = 1        begin        select  distinct '0' + '_' + LTRIM(d.DUOC_ID) + '_' + '0' as DUOC_KEY, 999999999 as SOLUONG        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        where  @param0  = 0        union all        select distinct tk.DUOC_KEY, tk.SOLUONG        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        inner join        (        select  LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')) DUOC_KEY, (SUM(dtk.SOLUONG) - isnull(sum(A.SOLUONG),0) - isnull(sum(B.SOLUONG),0)) SOLUONG, pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        from (select sum(soluong) soluong,duoc_id,nguonduoc_id,khoduoc_id,benhvien_id from TT_DUOC_TONKHO  group by duoc_id,nguonduoc_id,khoduoc_id,benhvien_id) dtk        inner join TM_DUOC_PHAMVISD_MAPPING pvsd on dtk.KHODUOC_ID = pvsd.KHODUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NOITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) B on B.DUOC_ID = dtk.DUOC_ID and B.PHAMVI_ID = pvsd.PHAMVI_ID and B.NGUONHANG_ID = dtk.NGUONDUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NGOAITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) A on A.DUOC_ID = dtk.DUOC_ID and A.PHAMVI_ID = pvsd.PHAMVI_ID and A.NGUONHANG_ID = dtk.NGUONDUOC_ID        where dtk.BENHVIEN_ID = 'HLU01'        group by LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')), pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        ) tk on tk.DUOC_ID = d.DUOC_ID        left join TM_DUOC_PHAMVISUDUNG kd on kd.PHAMVI_ID = tk.PHAMVI_ID and kd.BENHVIEN_ID = 'HLU01'        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = tk.NGUONDUOC_ID and nh.BENHVIEN_ID = 'HLU01'        where d.BENHVIEN_ID = 'HLU01' and tk.PHAMVI_ID =  @param0         end        else        begin        select distinct tk.DUOC_KEY, tk.SOLUONG        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        inner join        (        select  LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')) DUOC_KEY, (SUM(dtk.SOLUONG) - isnull(sum(A.SOLUONG),0) - isnull(sum(B.SOLUONG),0)) SOLUONG, pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        from (select sum(soluong) soluong,duoc_id,nguonduoc_id,khoduoc_id,benhvien_id from TT_DUOC_TONKHO  group by duoc_id,nguonduoc_id,khoduoc_id,benhvien_id) dtk        inner join TM_DUOC_PHAMVISD_MAPPING pvsd on dtk.KHODUOC_ID = pvsd.KHODUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NOITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) B on B.DUOC_ID = dtk.DUOC_ID and B.PHAMVI_ID = pvsd.PHAMVI_ID and B.NGUONHANG_ID = dtk.NGUONDUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NGOAITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) A on A.DUOC_ID = dtk.DUOC_ID and A.PHAMVI_ID = pvsd.PHAMVI_ID and A.NGUONHANG_ID = dtk.NGUONDUOC_ID        where dtk.BENHVIEN_ID = 'HLU01'        group by LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')), pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        ) tk on tk.DUOC_ID = d.DUOC_ID        left join TM_DUOC_PHAMVISUDUNG kd on kd.PHAMVI_ID = tk.PHAMVI_ID and kd.BENHVIEN_ID = 'HLU01'        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = tk.NGUONDUOC_ID and nh.BENHVIEN_ID = 'HLU01'        where d.BENHVIEN_ID = 'HLU01' and tk.PHAMVI_ID =  @param0         end]
2020-01-02 17:52:58,033 [1] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoVaBookingCOM23UpdateRedis_TheoPhamvi] Parameters: [@param0=[PHAMVI_ID,1028]]
2020-01-02 17:52:58,033 [1] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoVaBookingCOM23UpdateRedis_TheoPhamvi] Types: [@param0=[Int64, System.Int64]]
2020-01-02 17:53:09,389 [1] DEBUG - Statement Id: [DAO00067_GET_CHUYENVIENINFO_FROM_BENHNHANID] PreparedStatement : [select *        from TT_CHUYENVIEN        where BENHNHAN_ID  = '0' and BENHVIEN_ID = 'HLU01'        and TIEPNHAN_ID = '28493'         and           KHAMBENH_ID = '27176']
2020-01-02 17:53:09,420 [1] DEBUG - Statement Id: [DAO00014_GetChanDoan] PreparedStatement : [DECLARE @VAL1 NVARCHAR(1000) = ''        DECLARE @VAL2 NVARCHAR(1000) = ''        SELECT @VAL1 = (SELECT ICD.TENICD +'('+ICD.MAICD+'); '+ KB.CHANDOANKHOAKHAM FROM TT_NGOAITRU_KHAMBENH KB        INNER JOIN TM_ICD ICD ON ICD.ICD_ID = KB.CHANDOANICD_ID        WHERE KHAMBENH_ID =  @param0 )        SELECT @VAl2 = @VAL2 + ICD.TENICD +'('+ICD.MAICD +'); ' FROM        TT_NGOAITRU_KHAMBENH_ICD KBI        INNER JOIN TM_ICD ICD ON KBI.ICD_ID = ICD.ICD_ID        WHERE KBI.KHAMBENH_ID =  @param0         SELECT @VAL1 + '; '+ ISNULL(@VAL2,'')]
2020-01-02 17:53:09,421 [1] DEBUG - Statement Id: [DAO00014_GetChanDoan] Parameters: [@param0=[KHAMBENH_ID,27176]]
2020-01-02 17:53:09,421 [1] DEBUG - Statement Id: [DAO00014_GetChanDoan] Types: [@param0=[Int64, System.Int64]]
2020-01-02 17:53:09,447 [1] DEBUG - Statement Id: [DAO00016_GetDSThuocDaDungByTiepNhan] PreparedStatement : [select A.*, dc.TENDUOCDAYDU        from TT_NGOAITRU_TOATHUOC A        left join TM_DUOC dc on A.DUOC_ID = dc.DUOC_ID        where exists (select KHAMBENH_ID from TT_NGOAITRU_KHAMBENH where A.KHAMBENH_ID = KHAMBENH_ID and  TIEPNHAN_ID = '28493')        and exists (select KHAMBENH_TOATHUOC_ID from TT_NGOAITRU_KHAMBENH_TOATHUOC where A.KHAMBENH_TOATHUOC_ID = KHAMBENH_TOATHUOC_ID and CHUNGTUPHATTHUOC_ID is not null)        and A.BENHVIEN_ID = 'HLU01']
2020-01-02 17:53:09,475 [1] DEBUG - Statement Id: [DAO00067_GetDanhsachDichvuDungChoChuyentuyen] PreparedStatement : [select A.DICHVU_ID, B.TENDICHVU, A.DVYEUCAU_ID        from TT_DVYEUCAU A        left join TM_DICHVU B on A.DICHVU_ID = B.DICHVU_ID        left join TM_NHOMDICHVU C on C.NHOMDICHVU_ID = B.NHOMDICHVU_ID        where        ( @param0  IS NOT NULL OR  @param1  IS NOT NULL) AND        LEFT(C.MANHOMDICHVU,2) in ('01', '02', '05', '06') and A.HUYYEUCAU = '0'         and           A.TIEPNHAN_ID = '28493']
2020-01-02 17:53:09,475 [1] DEBUG - Statement Id: [DAO00067_GetDanhsachDichvuDungChoChuyentuyen] Parameters: [@param0=[BENHAN_ID,null], @param1=[TIEPNHAN_ID,28493]]
2020-01-02 17:53:09,475 [1] DEBUG - Statement Id: [DAO00067_GetDanhsachDichvuDungChoChuyentuyen] Types: [@param0=[System.DBNull, null], @param1=[Int64, System.Int64]]
2020-01-02 17:53:09,499 [1] DEBUG - Statement Id: [DAO00067_GetDanhsachxetnghiemkq] PreparedStatement : [select distinct C.CLSKETQUACHITIET_ID, B.TENDICHVU, C.KETQUA, C.DICHVU_ID, A.DVYEUCAU_ID        from TT_DVYEUCAU A        inner join TT_CLSKETQUACHITIET C on C.DVYEUCAU_ID = A.DVYEUCAU_ID        left join TM_DICHVU B on C.DICHVU_ID = B.DICHVU_ID        where A.HUYYEUCAU = '0' and A.BENHAN_ID is not null                 AND ( @param0  IS NOT NULL OR  @param1  IS NOT NULL)         and           A.TIEPNHAN_ID = '28493'                 order by C.CLSKETQUACHITIET_ID]
2020-01-02 17:53:09,499 [1] DEBUG - Statement Id: [DAO00067_GetDanhsachxetnghiemkq] Parameters: [@param0=[BENHAN_ID,null], @param1=[TIEPNHAN_ID,28493]]
2020-01-02 17:53:09,499 [1] DEBUG - Statement Id: [DAO00067_GetDanhsachxetnghiemkq] Types: [@param0=[System.DBNull, null], @param1=[Int64, System.Int64]]
2020-01-02 17:53:09,529 [1] DEBUG - Statement Id: [DAO00067_GetDanhsachsieuamkq] PreparedStatement : [select C.DVYEUCAU_ID, B.TENDICHVU,C.KETLUAN        from TT_DVYEUCAU A        inner join TT_CLSKETQUA C on C.DVYEUCAU_ID = A.DVYEUCAU_ID        left join TM_DICHVU B on C.DICHVU_ID = B.DICHVU_ID        where        ( @param0  IS NOT NULL OR  @param1  IS NOT NULL) AND                 A.DVYEUCAU_ID not in        (select DVYEUCAU_ID from TT_CLSKETQUACHITIET        where exists (        select DVYEUCAU_ID from TT_DVYEUCAU where TT_CLSKETQUACHITIET.DVYEUCAU_ID = DVYEUCAU_ID                 ))         and           A.TIEPNHAN_ID = 28493]
2020-01-02 17:53:09,529 [1] DEBUG - Statement Id: [DAO00067_GetDanhsachsieuamkq] Parameters: [@param0=[BENHAN_ID,null], @param1=[TIEPNHAN_ID,28493]]
2020-01-02 17:53:09,529 [1] DEBUG - Statement Id: [DAO00067_GetDanhsachsieuamkq] Types: [@param0=[System.DBNull, null], @param1=[Int64, System.Int64]]
2020-01-02 17:53:50,526 [1] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoVaBookingCOM23UpdateRedis_TheoPhamvi] PreparedStatement : [declare @TOAMUANGOAI int = 0;        select @TOAMUANGOAI = isnull(VALUE,0) from TM_SYS_APPSETTINGS where CODE = 'OPD_TOAMUANGOAI_DUNGDANHMUC_DUOC'                if @TOAMUANGOAI = 1        begin        select  distinct '0' + '_' + LTRIM(d.DUOC_ID) + '_' + '0' as DUOC_KEY, 999999999 as SOLUONG        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        where  @param0  = 0        union all        select distinct tk.DUOC_KEY, tk.SOLUONG        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        inner join        (        select  LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')) DUOC_KEY, (SUM(dtk.SOLUONG) - isnull(sum(A.SOLUONG),0) - isnull(sum(B.SOLUONG),0)) SOLUONG, pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        from (select sum(soluong) soluong,duoc_id,nguonduoc_id,khoduoc_id,benhvien_id from TT_DUOC_TONKHO  group by duoc_id,nguonduoc_id,khoduoc_id,benhvien_id) dtk        inner join TM_DUOC_PHAMVISD_MAPPING pvsd on dtk.KHODUOC_ID = pvsd.KHODUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NOITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) B on B.DUOC_ID = dtk.DUOC_ID and B.PHAMVI_ID = pvsd.PHAMVI_ID and B.NGUONHANG_ID = dtk.NGUONDUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NGOAITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) A on A.DUOC_ID = dtk.DUOC_ID and A.PHAMVI_ID = pvsd.PHAMVI_ID and A.NGUONHANG_ID = dtk.NGUONDUOC_ID        where dtk.BENHVIEN_ID = 'HLU01'        group by LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')), pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        ) tk on tk.DUOC_ID = d.DUOC_ID        left join TM_DUOC_PHAMVISUDUNG kd on kd.PHAMVI_ID = tk.PHAMVI_ID and kd.BENHVIEN_ID = 'HLU01'        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = tk.NGUONDUOC_ID and nh.BENHVIEN_ID = 'HLU01'        where d.BENHVIEN_ID = 'HLU01' and tk.PHAMVI_ID =  @param0         end        else        begin        select distinct tk.DUOC_KEY, tk.SOLUONG        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        inner join        (        select  LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')) DUOC_KEY, (SUM(dtk.SOLUONG) - isnull(sum(A.SOLUONG),0) - isnull(sum(B.SOLUONG),0)) SOLUONG, pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        from (select sum(soluong) soluong,duoc_id,nguonduoc_id,khoduoc_id,benhvien_id from TT_DUOC_TONKHO  group by duoc_id,nguonduoc_id,khoduoc_id,benhvien_id) dtk        inner join TM_DUOC_PHAMVISD_MAPPING pvsd on dtk.KHODUOC_ID = pvsd.KHODUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NOITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) B on B.DUOC_ID = dtk.DUOC_ID and B.PHAMVI_ID = pvsd.PHAMVI_ID and B.NGUONHANG_ID = dtk.NGUONDUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NGOAITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) A on A.DUOC_ID = dtk.DUOC_ID and A.PHAMVI_ID = pvsd.PHAMVI_ID and A.NGUONHANG_ID = dtk.NGUONDUOC_ID        where dtk.BENHVIEN_ID = 'HLU01'        group by LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')), pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        ) tk on tk.DUOC_ID = d.DUOC_ID        left join TM_DUOC_PHAMVISUDUNG kd on kd.PHAMVI_ID = tk.PHAMVI_ID and kd.BENHVIEN_ID = 'HLU01'        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = tk.NGUONDUOC_ID and nh.BENHVIEN_ID = 'HLU01'        where d.BENHVIEN_ID = 'HLU01' and tk.PHAMVI_ID =  @param0         end]
2020-01-02 17:53:50,526 [1] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoVaBookingCOM23UpdateRedis_TheoPhamvi] Parameters: [@param0=[PHAMVI_ID,1028]]
2020-01-02 17:53:50,526 [1] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoVaBookingCOM23UpdateRedis_TheoPhamvi] Types: [@param0=[Int64, System.Int64]]
2020-01-02 17:53:52,061 [1] DEBUG - Statement Id: [DAO00014_GetChitietDVYeucauKhamBenh] PreparedStatement : [select *        from TT_DVYEUCAU        where DVYEUCAU_ID  = '206519']
2020-01-02 17:53:52,088 [1] DEBUG - Statement Id: [DAO00014_GetPatientStatus] PreparedStatement : [select        CASE        when tn.TRANGTHAI = 'HOANTHANH' Then tn.TRANGTHAI        WHEN xncp.XACNHANCHIPHI_ID is not null THEN 'XACNHANCHIPHI'        WHEN (tn.KHOADULIEU = '1') THEN 'KHOADULIEU'        ELSE tn.TRANGTHAI        END        as TRANGTHAI        from TT_TIEPNHAN tn        left join TT_XACNHANCHIPHI xncp on tn.TIEPNHAN_ID = xncp.TIEPNHAN_ID        where tn.TIEPNHAN_ID = '28493'        and tn.BENHVIEN_ID = 'HLU01']
2020-01-02 17:53:52,160 [1] DEBUG - Statement Id: [DAO00014_GetThongtinKhamsuckhoeTheoDVyc] PreparedStatement : [select HOPDONG_ID, HOPDONG_BENHNHAN_ID from TT_DVYEUCAU where DVYEUCAU_ID =  @param0]
2020-01-02 17:53:52,160 [1] DEBUG - Statement Id: [DAO00014_GetThongtinKhamsuckhoeTheoDVyc] Parameters: [@param0=[DVYEUCAU_ID,206519]]
2020-01-02 17:53:52,160 [1] DEBUG - Statement Id: [DAO00014_GetThongtinKhamsuckhoeTheoDVyc] Types: [@param0=[Int64, System.Int64]]
2020-01-02 17:53:52,185 [1] DEBUG - Statement Id: [DAO00009_TT_TIEPNHAN_GetProcess] PreparedStatement : [select PROCESS_ID from TT_TIEPNHAN where SOTIEPNHAN = 'TN200102.0000001']
2020-01-02 17:53:52,221 [1] DEBUG - Statement Id: [DAOWF004_laytrangthaiDV] PreparedStatement : [select top 1 A.CURR_STATE_CODE as STATE_CODE, isNull(C.SHORT_NAME,C.NAME) as TRANGTHAI, C.NAME as TRANGTHAI_CHITIET, C.STATUS_CODE, D.ISACTIVE as ACTIVE, E.STATUS_CODE  as OLD_STATUSCODE        from TT_REQUEST_SERVICE_DETAIL A                left join (select * from TT_REQUEST_SERVICE where PARA = '{"DICHVU_ID":"5492","DVYEUCAU_ID":"206519"}') D on D.ID = A.REQUEST_SERVICE_ID        left join TM_STATE C on A.CURR_STATE_CODE = C.STATE_CODE and C.PROCESS_CODE = D.PROCESS_CODE        left join TM_STATE E on A.OLD_STATE_CODE = E.STATE_CODE and E.PROCESS_CODE = D.PROCESS_CODE        where        A.REQUEST_SERVICE_ID = (select top 1 ID from TT_REQUEST_SERVICE where PARA = '{"DICHVU_ID":"5492","DVYEUCAU_ID":"206519"}' order by ID desc)        order by A.ID desc]
2020-01-02 17:53:52,248 [1] DEBUG - Statement Id: [DAO00014_CheckExistNhapVien] PreparedStatement : [select NHAPVIEN_ID        from TT_NOITRU_NHAPVIEN        where TIEPNHAN_ID  = '28493'        and TRANGTHAI != 'CHOXACNHAN']
2020-01-02 17:53:52,273 [1] DEBUG - Statement Id: [DAO00014_CheckExistCapCuu] PreparedStatement : [select THONGTINCAPCUU_ID        from TT_TIEPNHAN_THONGTINCAPCUU        where TIEPNHAN_ID  = '28493' and BENHVIEN_ID = 'HLU01']
2020-01-02 17:53:52,298 [1] DEBUG - Statement Id: [DAO00014_CheckExistChuyenVien] PreparedStatement : [select CHUYENVIEN_ID        from TT_CHUYENVIEN        where TIEPNHAN_ID  = '28493']
2020-01-02 17:53:52,461 [1] DEBUG - Statement Id: [DAO00017_GetLoaiGiaByDoiTuongId] PreparedStatement : [select dtlg.DOUUTIEN, dtlg.DOITUONG_ID, lg.LOAIGIA_ID, lg.TENLOAIGIA, lg.MALOAIGIA              from TM_LOAIGIA lg              left join TM_DOITUONG_LOAIGIA dtlg              on lg.LOAIGIA_ID = dtlg.LOAIGIA_ID and dtlg.BENHVIEN_ID = 'HLU01'              where lg.TAMNGUNG = 0 and lg.BENHVIEN_ID = 'HLU01'                             order by dtlg.DOUUTIEN]
2020-01-02 17:53:52,505 [1] DEBUG - Statement Id: [DAO00014_KiemTraDVYCCoGiaBHYT] PreparedStatement : [select *        from TT_VIENPHI        where REF_ID  = '206519' and REF_TABLE = 'TT_DVYEUCAU' and BHYT_DONGIA > 0]
2020-01-02 17:53:52,541 [1] DEBUG - Statement Id: [DAO00040_LayListToaMau] PreparedStatement : [select A.*, dc.TENDUOCDAYDU, dc.BHYT DUOC_BHYT, ld.LOAIVATTU_ID, ld.MALOAIDUOC, dd.DICTIONARY_NAME DUONGDUNG, dc.TAMNGUNG            from TT_TOATHUOCMAU A            left join TM_DUOC dc on A.DUOC_ID = dc.DUOC_ID            left join TM_LOAIDUOC ld on dc.LOAIDUOC_ID = ld.LOAIDUOC_ID            left join (select * from LST_DICTIONARY where DICTIONARY_TYPE_CODE like 'DuongDung') dd on dd.DICTIONARY_ID = dc.DUONGDUNG_ID            where (1=1)             and               A.BACSI_ID  = 1              and A.LOAITOATHUOC in  (                        @param0                   ,                           @param1                   ,                           @param2                   ,                           @param3                   )]
2020-01-02 17:53:52,541 [1] DEBUG - Statement Id: [DAO00040_LayListToaMau] Parameters: [@param0=[LSTLOAITOATHUOC[0],BV], @param1=[LSTLOAITOATHUOC[1],MN], @param2=[LSTLOAITOATHUOC[2],MP], @param3=[LSTLOAITOATHUOC[3],TV]]
2020-01-02 17:53:52,541 [1] DEBUG - Statement Id: [DAO00040_LayListToaMau] Types: [@param0=[String, System.String], @param1=[String, System.String], @param2=[String, System.String], @param3=[String, System.String]]
2020-01-02 17:53:52,646 [1] DEBUG - Statement Id: [DAO00040_LayListToaMau] PreparedStatement : [select A.*, dc.TENDUOCDAYDU, dc.BHYT DUOC_BHYT, ld.LOAIVATTU_ID, ld.MALOAIDUOC, dd.DICTIONARY_NAME DUONGDUNG, dc.TAMNGUNG            from TT_TOATHUOCMAU A            left join TM_DUOC dc on A.DUOC_ID = dc.DUOC_ID            left join TM_LOAIDUOC ld on dc.LOAIDUOC_ID = ld.LOAIDUOC_ID            left join (select * from LST_DICTIONARY where DICTIONARY_TYPE_CODE like 'DuongDung') dd on dd.DICTIONARY_ID = dc.DUONGDUNG_ID            where (1=1)             and               A.BACSI_ID  = 1              and A.LOAITOATHUOC in  (                        @param0                   ,                           @param1                   ,                           @param2                   ,                           @param3                   )]
2020-01-02 17:53:52,647 [1] DEBUG - Statement Id: [DAO00040_LayListToaMau] Parameters: [@param0=[LSTLOAITOATHUOC[0],BV], @param1=[LSTLOAITOATHUOC[1],MN], @param2=[LSTLOAITOATHUOC[2],MP], @param3=[LSTLOAITOATHUOC[3],TV]]
2020-01-02 17:53:52,647 [1] DEBUG - Statement Id: [DAO00040_LayListToaMau] Types: [@param0=[String, System.String], @param1=[String, System.String], @param2=[String, System.String], @param3=[String, System.String]]
2020-01-02 17:53:52,689 [1] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoVaBookingCOM23UpdateRedis_TheoPhamvi] PreparedStatement : [declare @TOAMUANGOAI int = 0;        select @TOAMUANGOAI = isnull(VALUE,0) from TM_SYS_APPSETTINGS where CODE = 'OPD_TOAMUANGOAI_DUNGDANHMUC_DUOC'                if @TOAMUANGOAI = 1        begin        select  distinct '0' + '_' + LTRIM(d.DUOC_ID) + '_' + '0' as DUOC_KEY, 999999999 as SOLUONG        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        where  @param0  = 0        union all        select distinct tk.DUOC_KEY, tk.SOLUONG        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        inner join        (        select  LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')) DUOC_KEY, (SUM(dtk.SOLUONG) - isnull(sum(A.SOLUONG),0) - isnull(sum(B.SOLUONG),0)) SOLUONG, pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        from (select sum(soluong) soluong,duoc_id,nguonduoc_id,khoduoc_id,benhvien_id from TT_DUOC_TONKHO  group by duoc_id,nguonduoc_id,khoduoc_id,benhvien_id) dtk        inner join TM_DUOC_PHAMVISD_MAPPING pvsd on dtk.KHODUOC_ID = pvsd.KHODUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NOITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) B on B.DUOC_ID = dtk.DUOC_ID and B.PHAMVI_ID = pvsd.PHAMVI_ID and B.NGUONHANG_ID = dtk.NGUONDUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NGOAITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) A on A.DUOC_ID = dtk.DUOC_ID and A.PHAMVI_ID = pvsd.PHAMVI_ID and A.NGUONHANG_ID = dtk.NGUONDUOC_ID        where dtk.BENHVIEN_ID = 'HLU01'        group by LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')), pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        ) tk on tk.DUOC_ID = d.DUOC_ID        left join TM_DUOC_PHAMVISUDUNG kd on kd.PHAMVI_ID = tk.PHAMVI_ID and kd.BENHVIEN_ID = 'HLU01'        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = tk.NGUONDUOC_ID and nh.BENHVIEN_ID = 'HLU01'        where d.BENHVIEN_ID = 'HLU01' and tk.PHAMVI_ID =  @param0         end        else        begin        select distinct tk.DUOC_KEY, tk.SOLUONG        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        inner join        (        select  LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')) DUOC_KEY, (SUM(dtk.SOLUONG) - isnull(sum(A.SOLUONG),0) - isnull(sum(B.SOLUONG),0)) SOLUONG, pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        from (select sum(soluong) soluong,duoc_id,nguonduoc_id,khoduoc_id,benhvien_id from TT_DUOC_TONKHO  group by duoc_id,nguonduoc_id,khoduoc_id,benhvien_id) dtk        inner join TM_DUOC_PHAMVISD_MAPPING pvsd on dtk.KHODUOC_ID = pvsd.KHODUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NOITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) B on B.DUOC_ID = dtk.DUOC_ID and B.PHAMVI_ID = pvsd.PHAMVI_ID and B.NGUONHANG_ID = dtk.NGUONDUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NGOAITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) A on A.DUOC_ID = dtk.DUOC_ID and A.PHAMVI_ID = pvsd.PHAMVI_ID and A.NGUONHANG_ID = dtk.NGUONDUOC_ID        where dtk.BENHVIEN_ID = 'HLU01'        group by LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')), pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        ) tk on tk.DUOC_ID = d.DUOC_ID        left join TM_DUOC_PHAMVISUDUNG kd on kd.PHAMVI_ID = tk.PHAMVI_ID and kd.BENHVIEN_ID = 'HLU01'        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = tk.NGUONDUOC_ID and nh.BENHVIEN_ID = 'HLU01'        where d.BENHVIEN_ID = 'HLU01' and tk.PHAMVI_ID =  @param0         end]
2020-01-02 17:53:52,689 [1] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoVaBookingCOM23UpdateRedis_TheoPhamvi] Parameters: [@param0=[PHAMVI_ID,1028]]
2020-01-02 17:53:52,689 [1] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoVaBookingCOM23UpdateRedis_TheoPhamvi] Types: [@param0=[Int64, System.Int64]]
2020-01-02 17:53:52,855 [1] DEBUG - Statement Id: [DAO00013_GetTienSuBenh] PreparedStatement : [select TIENSUBENH, TIENSUDIUNG        from TT_BENHNHAN        where TT_BENHNHAN.BENHNHAN_ID  = '24441']
2020-01-02 17:53:52,881 [1] DEBUG - Statement Id: [DAO00095_GetTTDiUngThuoc] PreparedStatement : [select *              from TT_BENHNHAN_DIUNG_THUOC              where BENHNHAN_ID = '24441'              and BENHVIEN_ID = 'HLU01']
2020-01-02 17:53:52,907 [1] DEBUG - Statement Id: [DAO00014_GetTotalChiPhiDVByTiepNhan] PreparedStatement : [select sum(THANHTIEN_DOANHTHU) as THANHTIEN_DOANHTHU from TT_VIENPHI        where ACTIVE = '1'        and TIEPNHAN_ID = '28493'        and REF_TABLE = 'TT_DVYEUCAU'        and exists (select DVYEUCAU_ID from TT_DVYEUCAU where HUYYEUCAU = '0' and TIEPNHAN_ID = '28493' and TT_VIENPHI.REF_ID = DVYEUCAU_ID)]
2020-01-02 17:53:52,948 [1] DEBUG - Statement Id: [DAO00014_GetKhamBenhInfo] PreparedStatement : [select * from TT_NGOAITRU_KHAMBENH where KHAMBENH_ID =        (select KHAMBENH_NGOAITRU_ID from TT_DVYEUCAU where DVYEUCAU_ID = '206519')]
2020-01-02 17:53:52,977 [1] DEBUG - Statement Id: [DAO00068_GetSinhHieuBySinhHieuID] PreparedStatement : [select top (1) *            from TT_NGOAITRU_KHAMBENH_SINHHIEU            where KHAMBENH_SINHHIEU_ID = '0'            and BENHVIEN_ID = 'HLU01'             and               BENHNHAN_ID = '24441'                           order by KHAMBENH_SINHHIEU_ID]
2020-01-02 17:53:53,117 [1] DEBUG - Statement Id: [DAO00014_GetKhamBenhICDInfo] PreparedStatement : [select *        from TT_NGOAITRU_KHAMBENH_ICD        where KHAMBENH_ID  = '27176']
2020-01-02 17:53:53,142 [1] DEBUG - Statement Id: [DAO00014_GetListToaThuoc] PreparedStatement : [select A.*        from TT_NGOAITRU_KHAMBENH_TOATHUOC A        where A.KHAMBENH_ID = '27176']
2020-01-02 17:53:53,171 [1] DEBUG - Statement Id: [DAO00014_KiemTraDVYCCoGiaBHYT] PreparedStatement : [select *        from TT_VIENPHI        where REF_ID  = '206519' and REF_TABLE = 'TT_DVYEUCAU' and BHYT_DONGIA > 0]
2020-01-02 17:53:53,210 [1] DEBUG - Statement Id: [DAO00040_LayListToaMau] PreparedStatement : [select A.*, dc.TENDUOCDAYDU, dc.BHYT DUOC_BHYT, ld.LOAIVATTU_ID, ld.MALOAIDUOC, dd.DICTIONARY_NAME DUONGDUNG, dc.TAMNGUNG            from TT_TOATHUOCMAU A            left join TM_DUOC dc on A.DUOC_ID = dc.DUOC_ID            left join TM_LOAIDUOC ld on dc.LOAIDUOC_ID = ld.LOAIDUOC_ID            left join (select * from LST_DICTIONARY where DICTIONARY_TYPE_CODE like 'DuongDung') dd on dd.DICTIONARY_ID = dc.DUONGDUNG_ID            where (1=1)             and               A.BACSI_ID  = 1              and A.LOAITOATHUOC in  (                        @param0                   ,                           @param1                   ,                           @param2                   ,                           @param3                   )]
2020-01-02 17:53:53,210 [1] DEBUG - Statement Id: [DAO00040_LayListToaMau] Parameters: [@param0=[LSTLOAITOATHUOC[0],BV], @param1=[LSTLOAITOATHUOC[1],MN], @param2=[LSTLOAITOATHUOC[2],MP], @param3=[LSTLOAITOATHUOC[3],TV]]
2020-01-02 17:53:53,210 [1] DEBUG - Statement Id: [DAO00040_LayListToaMau] Types: [@param0=[String, System.String], @param1=[String, System.String], @param2=[String, System.String], @param3=[String, System.String]]
2020-01-02 17:53:53,302 [1] DEBUG - Statement Id: [DAO00040_LayListToaMau] PreparedStatement : [select A.*, dc.TENDUOCDAYDU, dc.BHYT DUOC_BHYT, ld.LOAIVATTU_ID, ld.MALOAIDUOC, dd.DICTIONARY_NAME DUONGDUNG, dc.TAMNGUNG            from TT_TOATHUOCMAU A            left join TM_DUOC dc on A.DUOC_ID = dc.DUOC_ID            left join TM_LOAIDUOC ld on dc.LOAIDUOC_ID = ld.LOAIDUOC_ID            left join (select * from LST_DICTIONARY where DICTIONARY_TYPE_CODE like 'DuongDung') dd on dd.DICTIONARY_ID = dc.DUONGDUNG_ID            where (1=1)             and               A.BACSI_ID  = 1              and A.LOAITOATHUOC in  (                        @param0                   ,                           @param1                   ,                           @param2                   ,                           @param3                   )]
2020-01-02 17:53:53,302 [1] DEBUG - Statement Id: [DAO00040_LayListToaMau] Parameters: [@param0=[LSTLOAITOATHUOC[0],BV], @param1=[LSTLOAITOATHUOC[1],MN], @param2=[LSTLOAITOATHUOC[2],MP], @param3=[LSTLOAITOATHUOC[3],TV]]
2020-01-02 17:53:53,302 [1] DEBUG - Statement Id: [DAO00040_LayListToaMau] Types: [@param0=[String, System.String], @param1=[String, System.String], @param2=[String, System.String], @param3=[String, System.String]]
2020-01-02 17:53:53,341 [1] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoVaBookingCOM23UpdateRedis_TheoPhamvi] PreparedStatement : [declare @TOAMUANGOAI int = 0;        select @TOAMUANGOAI = isnull(VALUE,0) from TM_SYS_APPSETTINGS where CODE = 'OPD_TOAMUANGOAI_DUNGDANHMUC_DUOC'                if @TOAMUANGOAI = 1        begin        select  distinct '0' + '_' + LTRIM(d.DUOC_ID) + '_' + '0' as DUOC_KEY, 999999999 as SOLUONG        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        where  @param0  = 0        union all        select distinct tk.DUOC_KEY, tk.SOLUONG        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        inner join        (        select  LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')) DUOC_KEY, (SUM(dtk.SOLUONG) - isnull(sum(A.SOLUONG),0) - isnull(sum(B.SOLUONG),0)) SOLUONG, pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        from (select sum(soluong) soluong,duoc_id,nguonduoc_id,khoduoc_id,benhvien_id from TT_DUOC_TONKHO  group by duoc_id,nguonduoc_id,khoduoc_id,benhvien_id) dtk        inner join TM_DUOC_PHAMVISD_MAPPING pvsd on dtk.KHODUOC_ID = pvsd.KHODUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NOITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) B on B.DUOC_ID = dtk.DUOC_ID and B.PHAMVI_ID = pvsd.PHAMVI_ID and B.NGUONHANG_ID = dtk.NGUONDUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NGOAITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) A on A.DUOC_ID = dtk.DUOC_ID and A.PHAMVI_ID = pvsd.PHAMVI_ID and A.NGUONHANG_ID = dtk.NGUONDUOC_ID        where dtk.BENHVIEN_ID = 'HLU01'        group by LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')), pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        ) tk on tk.DUOC_ID = d.DUOC_ID        left join TM_DUOC_PHAMVISUDUNG kd on kd.PHAMVI_ID = tk.PHAMVI_ID and kd.BENHVIEN_ID = 'HLU01'        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = tk.NGUONDUOC_ID and nh.BENHVIEN_ID = 'HLU01'        where d.BENHVIEN_ID = 'HLU01' and tk.PHAMVI_ID =  @param0         end        else        begin        select distinct tk.DUOC_KEY, tk.SOLUONG        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        inner join        (        select  LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')) DUOC_KEY, (SUM(dtk.SOLUONG) - isnull(sum(A.SOLUONG),0) - isnull(sum(B.SOLUONG),0)) SOLUONG, pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        from (select sum(soluong) soluong,duoc_id,nguonduoc_id,khoduoc_id,benhvien_id from TT_DUOC_TONKHO  group by duoc_id,nguonduoc_id,khoduoc_id,benhvien_id) dtk        inner join TM_DUOC_PHAMVISD_MAPPING pvsd on dtk.KHODUOC_ID = pvsd.KHODUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NOITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) B on B.DUOC_ID = dtk.DUOC_ID and B.PHAMVI_ID = pvsd.PHAMVI_ID and B.NGUONHANG_ID = dtk.NGUONDUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NGOAITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) A on A.DUOC_ID = dtk.DUOC_ID and A.PHAMVI_ID = pvsd.PHAMVI_ID and A.NGUONHANG_ID = dtk.NGUONDUOC_ID        where dtk.BENHVIEN_ID = 'HLU01'        group by LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')), pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        ) tk on tk.DUOC_ID = d.DUOC_ID        left join TM_DUOC_PHAMVISUDUNG kd on kd.PHAMVI_ID = tk.PHAMVI_ID and kd.BENHVIEN_ID = 'HLU01'        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = tk.NGUONDUOC_ID and nh.BENHVIEN_ID = 'HLU01'        where d.BENHVIEN_ID = 'HLU01' and tk.PHAMVI_ID =  @param0         end]
2020-01-02 17:53:53,341 [1] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoVaBookingCOM23UpdateRedis_TheoPhamvi] Parameters: [@param0=[PHAMVI_ID,1028]]
2020-01-02 17:53:53,341 [1] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoVaBookingCOM23UpdateRedis_TheoPhamvi] Types: [@param0=[Int64, System.Int64]]
2020-01-02 17:53:53,606 [1] DEBUG - Statement Id: [DAO00068_GetLastedSinhHieuInfo] PreparedStatement : [select top (1) *, CHISOBMI as BMI              from TT_NGOAITRU_KHAMBENH_SINHHIEU              where BENHNHAN_ID = '24441'              order by KHAMBENH_SINHHIEU_ID desc]
2020-01-02 17:53:53,723 [1] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoVaBookingCOM23UpdateRedis_TheoPhamvi] PreparedStatement : [declare @TOAMUANGOAI int = 0;        select @TOAMUANGOAI = isnull(VALUE,0) from TM_SYS_APPSETTINGS where CODE = 'OPD_TOAMUANGOAI_DUNGDANHMUC_DUOC'                if @TOAMUANGOAI = 1        begin        select  distinct '0' + '_' + LTRIM(d.DUOC_ID) + '_' + '0' as DUOC_KEY, 999999999 as SOLUONG        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        where  @param0  = 0        union all        select distinct tk.DUOC_KEY, tk.SOLUONG        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        inner join        (        select  LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')) DUOC_KEY, (SUM(dtk.SOLUONG) - isnull(sum(A.SOLUONG),0) - isnull(sum(B.SOLUONG),0)) SOLUONG, pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        from (select sum(soluong) soluong,duoc_id,nguonduoc_id,khoduoc_id,benhvien_id from TT_DUOC_TONKHO  group by duoc_id,nguonduoc_id,khoduoc_id,benhvien_id) dtk        inner join TM_DUOC_PHAMVISD_MAPPING pvsd on dtk.KHODUOC_ID = pvsd.KHODUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NOITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) B on B.DUOC_ID = dtk.DUOC_ID and B.PHAMVI_ID = pvsd.PHAMVI_ID and B.NGUONHANG_ID = dtk.NGUONDUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NGOAITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) A on A.DUOC_ID = dtk.DUOC_ID and A.PHAMVI_ID = pvsd.PHAMVI_ID and A.NGUONHANG_ID = dtk.NGUONDUOC_ID        where dtk.BENHVIEN_ID = 'HLU01'        group by LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')), pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        ) tk on tk.DUOC_ID = d.DUOC_ID        left join TM_DUOC_PHAMVISUDUNG kd on kd.PHAMVI_ID = tk.PHAMVI_ID and kd.BENHVIEN_ID = 'HLU01'        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = tk.NGUONDUOC_ID and nh.BENHVIEN_ID = 'HLU01'        where d.BENHVIEN_ID = 'HLU01' and tk.PHAMVI_ID =  @param0         end        else        begin        select distinct tk.DUOC_KEY, tk.SOLUONG        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        inner join        (        select  LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')) DUOC_KEY, (SUM(dtk.SOLUONG) - isnull(sum(A.SOLUONG),0) - isnull(sum(B.SOLUONG),0)) SOLUONG, pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        from (select sum(soluong) soluong,duoc_id,nguonduoc_id,khoduoc_id,benhvien_id from TT_DUOC_TONKHO  group by duoc_id,nguonduoc_id,khoduoc_id,benhvien_id) dtk        inner join TM_DUOC_PHAMVISD_MAPPING pvsd on dtk.KHODUOC_ID = pvsd.KHODUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NOITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) B on B.DUOC_ID = dtk.DUOC_ID and B.PHAMVI_ID = pvsd.PHAMVI_ID and B.NGUONHANG_ID = dtk.NGUONDUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NGOAITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) A on A.DUOC_ID = dtk.DUOC_ID and A.PHAMVI_ID = pvsd.PHAMVI_ID and A.NGUONHANG_ID = dtk.NGUONDUOC_ID        where dtk.BENHVIEN_ID = 'HLU01'        group by LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')), pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        ) tk on tk.DUOC_ID = d.DUOC_ID        left join TM_DUOC_PHAMVISUDUNG kd on kd.PHAMVI_ID = tk.PHAMVI_ID and kd.BENHVIEN_ID = 'HLU01'        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = tk.NGUONDUOC_ID and nh.BENHVIEN_ID = 'HLU01'        where d.BENHVIEN_ID = 'HLU01' and tk.PHAMVI_ID =  @param0         end]
2020-01-02 17:53:53,724 [1] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoVaBookingCOM23UpdateRedis_TheoPhamvi] Parameters: [@param0=[PHAMVI_ID,1028]]
2020-01-02 17:53:53,724 [1] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoVaBookingCOM23UpdateRedis_TheoPhamvi] Types: [@param0=[Int64, System.Int64]]
2020-01-02 18:00:49,908 [1] DEBUG - Statement Id: [DAO00017_GetLoaiGiaByDoiTuongId] PreparedStatement : [select dtlg.DOUUTIEN, dtlg.DOITUONG_ID, lg.LOAIGIA_ID, lg.TENLOAIGIA, lg.MALOAIGIA              from TM_LOAIGIA lg              left join TM_DOITUONG_LOAIGIA dtlg              on lg.LOAIGIA_ID = dtlg.LOAIGIA_ID and dtlg.BENHVIEN_ID = 'HLU01'              where lg.TAMNGUNG = 0 and lg.BENHVIEN_ID = 'HLU01'                             order by dtlg.DOUUTIEN]
2020-01-02 18:00:50,277 [1] DEBUG - Statement Id: [DAO00014_KiemTraDVYCCoGiaBHYT] PreparedStatement : [select *        from TT_VIENPHI        where REF_ID  = '' and REF_TABLE = 'TT_DVYEUCAU' and BHYT_DONGIA > 0]
2020-01-02 18:00:50,311 [1] DEBUG - Statement Id: [DAO00040_LayListToaMau] PreparedStatement : [select A.*, dc.TENDUOCDAYDU, dc.BHYT DUOC_BHYT, ld.LOAIVATTU_ID, ld.MALOAIDUOC, dd.DICTIONARY_NAME DUONGDUNG, dc.TAMNGUNG            from TT_TOATHUOCMAU A            left join TM_DUOC dc on A.DUOC_ID = dc.DUOC_ID            left join TM_LOAIDUOC ld on dc.LOAIDUOC_ID = ld.LOAIDUOC_ID            left join (select * from LST_DICTIONARY where DICTIONARY_TYPE_CODE like 'DuongDung') dd on dd.DICTIONARY_ID = dc.DUONGDUNG_ID            where (1=1)             and               A.BACSI_ID  = 1              and A.LOAITOATHUOC in  (                        @param0                   ,                           @param1                   ,                           @param2                   ,                           @param3                   )]
2020-01-02 18:00:50,311 [1] DEBUG - Statement Id: [DAO00040_LayListToaMau] Parameters: [@param0=[LSTLOAITOATHUOC[0],BV], @param1=[LSTLOAITOATHUOC[1],MN], @param2=[LSTLOAITOATHUOC[2],MP], @param3=[LSTLOAITOATHUOC[3],TV]]
2020-01-02 18:00:50,311 [1] DEBUG - Statement Id: [DAO00040_LayListToaMau] Types: [@param0=[String, System.String], @param1=[String, System.String], @param2=[String, System.String], @param3=[String, System.String]]
2020-01-02 18:00:50,395 [1] DEBUG - Statement Id: [DAO00040_LayListToaMau] PreparedStatement : [select A.*, dc.TENDUOCDAYDU, dc.BHYT DUOC_BHYT, ld.LOAIVATTU_ID, ld.MALOAIDUOC, dd.DICTIONARY_NAME DUONGDUNG, dc.TAMNGUNG            from TT_TOATHUOCMAU A            left join TM_DUOC dc on A.DUOC_ID = dc.DUOC_ID            left join TM_LOAIDUOC ld on dc.LOAIDUOC_ID = ld.LOAIDUOC_ID            left join (select * from LST_DICTIONARY where DICTIONARY_TYPE_CODE like 'DuongDung') dd on dd.DICTIONARY_ID = dc.DUONGDUNG_ID            where (1=1)             and               A.BACSI_ID  = 1              and A.LOAITOATHUOC in  (                        @param0                   ,                           @param1                   ,                           @param2                   ,                           @param3                   )]
2020-01-02 18:00:50,395 [1] DEBUG - Statement Id: [DAO00040_LayListToaMau] Parameters: [@param0=[LSTLOAITOATHUOC[0],BV], @param1=[LSTLOAITOATHUOC[1],MN], @param2=[LSTLOAITOATHUOC[2],MP], @param3=[LSTLOAITOATHUOC[3],TV]]
2020-01-02 18:00:50,395 [1] DEBUG - Statement Id: [DAO00040_LayListToaMau] Types: [@param0=[String, System.String], @param1=[String, System.String], @param2=[String, System.String], @param3=[String, System.String]]
2020-01-02 18:00:50,483 [1] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoVaBookingCOM23UpdateRedis_TheoPhamvi] PreparedStatement : [declare @TOAMUANGOAI int = 0;        select @TOAMUANGOAI = isnull(VALUE,0) from TM_SYS_APPSETTINGS where CODE = 'OPD_TOAMUANGOAI_DUNGDANHMUC_DUOC'                if @TOAMUANGOAI = 1        begin        select  distinct '0' + '_' + LTRIM(d.DUOC_ID) + '_' + '0' as DUOC_KEY, 999999999 as SOLUONG        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        where  @param0  = 0        union all        select distinct tk.DUOC_KEY, tk.SOLUONG        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        inner join        (        select  LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')) DUOC_KEY, (SUM(dtk.SOLUONG) - isnull(sum(A.SOLUONG),0) - isnull(sum(B.SOLUONG),0)) SOLUONG, pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        from (select sum(soluong) soluong,duoc_id,nguonduoc_id,khoduoc_id,benhvien_id from TT_DUOC_TONKHO  group by duoc_id,nguonduoc_id,khoduoc_id,benhvien_id) dtk        inner join TM_DUOC_PHAMVISD_MAPPING pvsd on dtk.KHODUOC_ID = pvsd.KHODUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NOITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) B on B.DUOC_ID = dtk.DUOC_ID and B.PHAMVI_ID = pvsd.PHAMVI_ID and B.NGUONHANG_ID = dtk.NGUONDUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NGOAITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) A on A.DUOC_ID = dtk.DUOC_ID and A.PHAMVI_ID = pvsd.PHAMVI_ID and A.NGUONHANG_ID = dtk.NGUONDUOC_ID        where dtk.BENHVIEN_ID = 'HLU01'        group by LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')), pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        ) tk on tk.DUOC_ID = d.DUOC_ID        left join TM_DUOC_PHAMVISUDUNG kd on kd.PHAMVI_ID = tk.PHAMVI_ID and kd.BENHVIEN_ID = 'HLU01'        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = tk.NGUONDUOC_ID and nh.BENHVIEN_ID = 'HLU01'        where d.BENHVIEN_ID = 'HLU01' and tk.PHAMVI_ID =  @param0         end        else        begin        select distinct tk.DUOC_KEY, tk.SOLUONG        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        inner join        (        select  LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')) DUOC_KEY, (SUM(dtk.SOLUONG) - isnull(sum(A.SOLUONG),0) - isnull(sum(B.SOLUONG),0)) SOLUONG, pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        from (select sum(soluong) soluong,duoc_id,nguonduoc_id,khoduoc_id,benhvien_id from TT_DUOC_TONKHO  group by duoc_id,nguonduoc_id,khoduoc_id,benhvien_id) dtk        inner join TM_DUOC_PHAMVISD_MAPPING pvsd on dtk.KHODUOC_ID = pvsd.KHODUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NOITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) B on B.DUOC_ID = dtk.DUOC_ID and B.PHAMVI_ID = pvsd.PHAMVI_ID and B.NGUONHANG_ID = dtk.NGUONDUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NGOAITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) A on A.DUOC_ID = dtk.DUOC_ID and A.PHAMVI_ID = pvsd.PHAMVI_ID and A.NGUONHANG_ID = dtk.NGUONDUOC_ID        where dtk.BENHVIEN_ID = 'HLU01'        group by LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')), pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        ) tk on tk.DUOC_ID = d.DUOC_ID        left join TM_DUOC_PHAMVISUDUNG kd on kd.PHAMVI_ID = tk.PHAMVI_ID and kd.BENHVIEN_ID = 'HLU01'        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = tk.NGUONDUOC_ID and nh.BENHVIEN_ID = 'HLU01'        where d.BENHVIEN_ID = 'HLU01' and tk.PHAMVI_ID =  @param0         end]
2020-01-02 18:00:50,483 [1] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoVaBookingCOM23UpdateRedis_TheoPhamvi] Parameters: [@param0=[PHAMVI_ID,1033]]
2020-01-02 18:00:50,483 [1] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoVaBookingCOM23UpdateRedis_TheoPhamvi] Types: [@param0=[Int64, System.Int64]]
2020-01-02 18:00:50,690 [1] DEBUG - Statement Id: [DAO00012_GetLoaiTCLS] PreparedStatement : [select DICTIONARY_ID, DICTIONARY_CODE, DICTIONARY_NAME, cast('0' as Bit) CHON        from LST_DICTIONARY              where DICTIONARY_TYPE_CODE = 'KHAMBENH_LOAI_TRIEUCHUNGLS'        order by LST_DICTIONARY.IDX]
2020-01-02 18:00:50,717 [1] DEBUG - Statement Id: [DAO00012_GetAllTCLS] PreparedStatement : [select MALOAITRIEUCHUNG DICTIONARY_TYPE_CODE, MALOAITRIEUCHUNG DICTIONARY_CODE,        TENTRIEUCHUNG DICTIONARY_NAME from TM_TRIEUCHUNGLS]
2020-01-02 18:00:50,743 [1] DEBUG - Statement Id: [DAO00019_ThongTinBenhNhanDvYeuCau] PreparedStatement : [select distinct A.SOTIEPNHAN, A.TIEPNHAN_ID, A.DOITUONG_ID, A.TRANGTHAI,        A.LOAITHANHVIEN_ID, A.SUDUNG_BHTN, A.THE_ID, A.THANHVIEN_ID, A.VIP, A.NGUON_BENHNHAN_ID, A.BAOLANH_VIENPHI, A.NGAYMIENDONGCHITRA,        B.*,  C.DICHVU_ID, C.DVYEUCAU_ID, C.NOITHUCHIEN_ID, A.SOBHYT        from TT_TIEPNHAN A        inner join TT_DVYEUCAU C on C.TIEPNHAN_ID = A.TIEPNHAN_ID        inner join TT_BENHNHAN B on B.BENHNHAN_ID = A.BENHNHAN_ID and B.ACTIVE = '1'        where                    C.DVYEUCAU_ID = '206520'                 and A.BENHVIEN_ID = 'HLU01']
2020-01-02 18:00:50,840 [1] DEBUG - Statement Id: [DAO00017_GetLoaiGiaByDoiTuongId] PreparedStatement : [select dtlg.DOUUTIEN, dtlg.DOITUONG_ID, lg.LOAIGIA_ID, lg.TENLOAIGIA, lg.MALOAIGIA              from TM_LOAIGIA lg              left join TM_DOITUONG_LOAIGIA dtlg              on lg.LOAIGIA_ID = dtlg.LOAIGIA_ID and dtlg.BENHVIEN_ID = 'HLU01'              where lg.TAMNGUNG = 0 and lg.BENHVIEN_ID = 'HLU01'                             order by dtlg.DOUUTIEN]
2020-01-02 18:00:50,907 [1] DEBUG - Statement Id: [DAO00014_KiemTraDVYCCoGiaBHYT] PreparedStatement : [select *        from TT_VIENPHI        where REF_ID  = '206520' and REF_TABLE = 'TT_DVYEUCAU' and BHYT_DONGIA > 0]
2020-01-02 18:00:50,942 [1] DEBUG - Statement Id: [DAO00040_LayListToaMau] PreparedStatement : [select A.*, dc.TENDUOCDAYDU, dc.BHYT DUOC_BHYT, ld.LOAIVATTU_ID, ld.MALOAIDUOC, dd.DICTIONARY_NAME DUONGDUNG, dc.TAMNGUNG            from TT_TOATHUOCMAU A            left join TM_DUOC dc on A.DUOC_ID = dc.DUOC_ID            left join TM_LOAIDUOC ld on dc.LOAIDUOC_ID = ld.LOAIDUOC_ID            left join (select * from LST_DICTIONARY where DICTIONARY_TYPE_CODE like 'DuongDung') dd on dd.DICTIONARY_ID = dc.DUONGDUNG_ID            where (1=1)             and               A.BACSI_ID  = 1              and A.LOAITOATHUOC in  (                        @param0                   ,                           @param1                   ,                           @param2                   ,                           @param3                   )]
2020-01-02 18:00:50,942 [1] DEBUG - Statement Id: [DAO00040_LayListToaMau] Parameters: [@param0=[LSTLOAITOATHUOC[0],BV], @param1=[LSTLOAITOATHUOC[1],MN], @param2=[LSTLOAITOATHUOC[2],MP], @param3=[LSTLOAITOATHUOC[3],TV]]
2020-01-02 18:00:50,942 [1] DEBUG - Statement Id: [DAO00040_LayListToaMau] Types: [@param0=[String, System.String], @param1=[String, System.String], @param2=[String, System.String], @param3=[String, System.String]]
2020-01-02 18:00:51,023 [1] DEBUG - Statement Id: [DAO00040_LayListToaMau] PreparedStatement : [select A.*, dc.TENDUOCDAYDU, dc.BHYT DUOC_BHYT, ld.LOAIVATTU_ID, ld.MALOAIDUOC, dd.DICTIONARY_NAME DUONGDUNG, dc.TAMNGUNG            from TT_TOATHUOCMAU A            left join TM_DUOC dc on A.DUOC_ID = dc.DUOC_ID            left join TM_LOAIDUOC ld on dc.LOAIDUOC_ID = ld.LOAIDUOC_ID            left join (select * from LST_DICTIONARY where DICTIONARY_TYPE_CODE like 'DuongDung') dd on dd.DICTIONARY_ID = dc.DUONGDUNG_ID            where (1=1)             and               A.BACSI_ID  = 1              and A.LOAITOATHUOC in  (                        @param0                   ,                           @param1                   ,                           @param2                   ,                           @param3                   )]
2020-01-02 18:00:51,023 [1] DEBUG - Statement Id: [DAO00040_LayListToaMau] Parameters: [@param0=[LSTLOAITOATHUOC[0],BV], @param1=[LSTLOAITOATHUOC[1],MN], @param2=[LSTLOAITOATHUOC[2],MP], @param3=[LSTLOAITOATHUOC[3],TV]]
2020-01-02 18:00:51,023 [1] DEBUG - Statement Id: [DAO00040_LayListToaMau] Types: [@param0=[String, System.String], @param1=[String, System.String], @param2=[String, System.String], @param3=[String, System.String]]
2020-01-02 18:00:51,056 [1] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoVaBookingCOM23UpdateRedis_TheoPhamvi] PreparedStatement : [declare @TOAMUANGOAI int = 0;        select @TOAMUANGOAI = isnull(VALUE,0) from TM_SYS_APPSETTINGS where CODE = 'OPD_TOAMUANGOAI_DUNGDANHMUC_DUOC'                if @TOAMUANGOAI = 1        begin        select  distinct '0' + '_' + LTRIM(d.DUOC_ID) + '_' + '0' as DUOC_KEY, 999999999 as SOLUONG        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        where  @param0  = 0        union all        select distinct tk.DUOC_KEY, tk.SOLUONG        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        inner join        (        select  LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')) DUOC_KEY, (SUM(dtk.SOLUONG) - isnull(sum(A.SOLUONG),0) - isnull(sum(B.SOLUONG),0)) SOLUONG, pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        from (select sum(soluong) soluong,duoc_id,nguonduoc_id,khoduoc_id,benhvien_id from TT_DUOC_TONKHO  group by duoc_id,nguonduoc_id,khoduoc_id,benhvien_id) dtk        inner join TM_DUOC_PHAMVISD_MAPPING pvsd on dtk.KHODUOC_ID = pvsd.KHODUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NOITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) B on B.DUOC_ID = dtk.DUOC_ID and B.PHAMVI_ID = pvsd.PHAMVI_ID and B.NGUONHANG_ID = dtk.NGUONDUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NGOAITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) A on A.DUOC_ID = dtk.DUOC_ID and A.PHAMVI_ID = pvsd.PHAMVI_ID and A.NGUONHANG_ID = dtk.NGUONDUOC_ID        where dtk.BENHVIEN_ID = 'HLU01'        group by LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')), pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        ) tk on tk.DUOC_ID = d.DUOC_ID        left join TM_DUOC_PHAMVISUDUNG kd on kd.PHAMVI_ID = tk.PHAMVI_ID and kd.BENHVIEN_ID = 'HLU01'        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = tk.NGUONDUOC_ID and nh.BENHVIEN_ID = 'HLU01'        where d.BENHVIEN_ID = 'HLU01' and tk.PHAMVI_ID =  @param0         end        else        begin        select distinct tk.DUOC_KEY, tk.SOLUONG        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        inner join        (        select  LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')) DUOC_KEY, (SUM(dtk.SOLUONG) - isnull(sum(A.SOLUONG),0) - isnull(sum(B.SOLUONG),0)) SOLUONG, pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        from (select sum(soluong) soluong,duoc_id,nguonduoc_id,khoduoc_id,benhvien_id from TT_DUOC_TONKHO  group by duoc_id,nguonduoc_id,khoduoc_id,benhvien_id) dtk        inner join TM_DUOC_PHAMVISD_MAPPING pvsd on dtk.KHODUOC_ID = pvsd.KHODUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NOITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) B on B.DUOC_ID = dtk.DUOC_ID and B.PHAMVI_ID = pvsd.PHAMVI_ID and B.NGUONHANG_ID = dtk.NGUONDUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NGOAITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) A on A.DUOC_ID = dtk.DUOC_ID and A.PHAMVI_ID = pvsd.PHAMVI_ID and A.NGUONHANG_ID = dtk.NGUONDUOC_ID        where dtk.BENHVIEN_ID = 'HLU01'        group by LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')), pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        ) tk on tk.DUOC_ID = d.DUOC_ID        left join TM_DUOC_PHAMVISUDUNG kd on kd.PHAMVI_ID = tk.PHAMVI_ID and kd.BENHVIEN_ID = 'HLU01'        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = tk.NGUONDUOC_ID and nh.BENHVIEN_ID = 'HLU01'        where d.BENHVIEN_ID = 'HLU01' and tk.PHAMVI_ID =  @param0         end]
2020-01-02 18:00:51,056 [1] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoVaBookingCOM23UpdateRedis_TheoPhamvi] Parameters: [@param0=[PHAMVI_ID,1028]]
2020-01-02 18:00:51,056 [1] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoVaBookingCOM23UpdateRedis_TheoPhamvi] Types: [@param0=[Int64, System.Int64]]
2020-01-02 18:00:51,232 [1] DEBUG - Statement Id: [DAO00013_GetTienSuBenh] PreparedStatement : [select TIENSUBENH, TIENSUDIUNG        from TT_BENHNHAN        where TT_BENHNHAN.BENHNHAN_ID  = '24442']
2020-01-02 18:00:51,256 [1] DEBUG - Statement Id: [DAO00095_GetTTDiUngThuoc] PreparedStatement : [select *              from TT_BENHNHAN_DIUNG_THUOC              where BENHNHAN_ID = '24442'              and BENHVIEN_ID = 'HLU01']
2020-01-02 18:00:51,281 [1] DEBUG - Statement Id: [DAO00014_GetTotalChiPhiDVByTiepNhan] PreparedStatement : [select sum(THANHTIEN_DOANHTHU) as THANHTIEN_DOANHTHU from TT_VIENPHI        where ACTIVE = '1'        and TIEPNHAN_ID = '28494'        and REF_TABLE = 'TT_DVYEUCAU'        and exists (select DVYEUCAU_ID from TT_DVYEUCAU where HUYYEUCAU = '0' and TIEPNHAN_ID = '28494' and TT_VIENPHI.REF_ID = DVYEUCAU_ID)]
2020-01-02 18:00:51,314 [1] DEBUG - Statement Id: [DAO00014_GetKhamBenhInfo] PreparedStatement : [select * from TT_NGOAITRU_KHAMBENH where KHAMBENH_ID =        (select KHAMBENH_NGOAITRU_ID from TT_DVYEUCAU where DVYEUCAU_ID = '206520')]
2020-01-02 18:00:51,346 [1] DEBUG - Statement Id: [DAO00068_GetSinhHieuBySinhHieuID] PreparedStatement : [select top (1) *            from TT_NGOAITRU_KHAMBENH_SINHHIEU            where KHAMBENH_SINHHIEU_ID = '0'            and BENHVIEN_ID = 'HLU01'             and               BENHNHAN_ID = '24442'                           order by KHAMBENH_SINHHIEU_ID]
2020-01-02 18:00:51,470 [1] DEBUG - Statement Id: [DAO00014_GetKhamBenhICDInfo] PreparedStatement : [select *        from TT_NGOAITRU_KHAMBENH_ICD        where KHAMBENH_ID  = '27177']
2020-01-02 18:00:51,494 [1] DEBUG - Statement Id: [DAO00014_GetListToaThuoc] PreparedStatement : [select A.*        from TT_NGOAITRU_KHAMBENH_TOATHUOC A        where A.KHAMBENH_ID = '27177']
2020-01-02 18:00:51,523 [1] DEBUG - Statement Id: [DAO00014_KiemTraDVYCCoGiaBHYT] PreparedStatement : [select *        from TT_VIENPHI        where REF_ID  = '206520' and REF_TABLE = 'TT_DVYEUCAU' and BHYT_DONGIA > 0]
2020-01-02 18:00:51,557 [1] DEBUG - Statement Id: [DAO00040_LayListToaMau] PreparedStatement : [select A.*, dc.TENDUOCDAYDU, dc.BHYT DUOC_BHYT, ld.LOAIVATTU_ID, ld.MALOAIDUOC, dd.DICTIONARY_NAME DUONGDUNG, dc.TAMNGUNG            from TT_TOATHUOCMAU A            left join TM_DUOC dc on A.DUOC_ID = dc.DUOC_ID            left join TM_LOAIDUOC ld on dc.LOAIDUOC_ID = ld.LOAIDUOC_ID            left join (select * from LST_DICTIONARY where DICTIONARY_TYPE_CODE like 'DuongDung') dd on dd.DICTIONARY_ID = dc.DUONGDUNG_ID            where (1=1)             and               A.BACSI_ID  = 1              and A.LOAITOATHUOC in  (                        @param0                   ,                           @param1                   ,                           @param2                   ,                           @param3                   )]
2020-01-02 18:00:51,558 [1] DEBUG - Statement Id: [DAO00040_LayListToaMau] Parameters: [@param0=[LSTLOAITOATHUOC[0],BV], @param1=[LSTLOAITOATHUOC[1],MN], @param2=[LSTLOAITOATHUOC[2],MP], @param3=[LSTLOAITOATHUOC[3],TV]]
2020-01-02 18:00:51,558 [1] DEBUG - Statement Id: [DAO00040_LayListToaMau] Types: [@param0=[String, System.String], @param1=[String, System.String], @param2=[String, System.String], @param3=[String, System.String]]
2020-01-02 18:00:51,654 [1] DEBUG - Statement Id: [DAO00040_LayListToaMau] PreparedStatement : [select A.*, dc.TENDUOCDAYDU, dc.BHYT DUOC_BHYT, ld.LOAIVATTU_ID, ld.MALOAIDUOC, dd.DICTIONARY_NAME DUONGDUNG, dc.TAMNGUNG            from TT_TOATHUOCMAU A            left join TM_DUOC dc on A.DUOC_ID = dc.DUOC_ID            left join TM_LOAIDUOC ld on dc.LOAIDUOC_ID = ld.LOAIDUOC_ID            left join (select * from LST_DICTIONARY where DICTIONARY_TYPE_CODE like 'DuongDung') dd on dd.DICTIONARY_ID = dc.DUONGDUNG_ID            where (1=1)             and               A.BACSI_ID  = 1              and A.LOAITOATHUOC in  (                        @param0                   ,                           @param1                   ,                           @param2                   ,                           @param3                   )]
2020-01-02 18:00:51,654 [1] DEBUG - Statement Id: [DAO00040_LayListToaMau] Parameters: [@param0=[LSTLOAITOATHUOC[0],BV], @param1=[LSTLOAITOATHUOC[1],MN], @param2=[LSTLOAITOATHUOC[2],MP], @param3=[LSTLOAITOATHUOC[3],TV]]
2020-01-02 18:00:51,654 [1] DEBUG - Statement Id: [DAO00040_LayListToaMau] Types: [@param0=[String, System.String], @param1=[String, System.String], @param2=[String, System.String], @param3=[String, System.String]]
2020-01-02 18:00:51,911 [1] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoVaBookingCOM23UpdateRedis_TheoPhamvi] PreparedStatement : [declare @TOAMUANGOAI int = 0;        select @TOAMUANGOAI = isnull(VALUE,0) from TM_SYS_APPSETTINGS where CODE = 'OPD_TOAMUANGOAI_DUNGDANHMUC_DUOC'                if @TOAMUANGOAI = 1        begin        select  distinct '0' + '_' + LTRIM(d.DUOC_ID) + '_' + '0' as DUOC_KEY, 999999999 as SOLUONG        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        where  @param0  = 0        union all        select distinct tk.DUOC_KEY, tk.SOLUONG        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        inner join        (        select  LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')) DUOC_KEY, (SUM(dtk.SOLUONG) - isnull(sum(A.SOLUONG),0) - isnull(sum(B.SOLUONG),0)) SOLUONG, pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        from (select sum(soluong) soluong,duoc_id,nguonduoc_id,khoduoc_id,benhvien_id from TT_DUOC_TONKHO  group by duoc_id,nguonduoc_id,khoduoc_id,benhvien_id) dtk        inner join TM_DUOC_PHAMVISD_MAPPING pvsd on dtk.KHODUOC_ID = pvsd.KHODUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NOITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) B on B.DUOC_ID = dtk.DUOC_ID and B.PHAMVI_ID = pvsd.PHAMVI_ID and B.NGUONHANG_ID = dtk.NGUONDUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NGOAITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) A on A.DUOC_ID = dtk.DUOC_ID and A.PHAMVI_ID = pvsd.PHAMVI_ID and A.NGUONHANG_ID = dtk.NGUONDUOC_ID        where dtk.BENHVIEN_ID = 'HLU01'        group by LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')), pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        ) tk on tk.DUOC_ID = d.DUOC_ID        left join TM_DUOC_PHAMVISUDUNG kd on kd.PHAMVI_ID = tk.PHAMVI_ID and kd.BENHVIEN_ID = 'HLU01'        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = tk.NGUONDUOC_ID and nh.BENHVIEN_ID = 'HLU01'        where d.BENHVIEN_ID = 'HLU01' and tk.PHAMVI_ID =  @param0         end        else        begin        select distinct tk.DUOC_KEY, tk.SOLUONG        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        inner join        (        select  LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')) DUOC_KEY, (SUM(dtk.SOLUONG) - isnull(sum(A.SOLUONG),0) - isnull(sum(B.SOLUONG),0)) SOLUONG, pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        from (select sum(soluong) soluong,duoc_id,nguonduoc_id,khoduoc_id,benhvien_id from TT_DUOC_TONKHO  group by duoc_id,nguonduoc_id,khoduoc_id,benhvien_id) dtk        inner join TM_DUOC_PHAMVISD_MAPPING pvsd on dtk.KHODUOC_ID = pvsd.KHODUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NOITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) B on B.DUOC_ID = dtk.DUOC_ID and B.PHAMVI_ID = pvsd.PHAMVI_ID and B.NGUONHANG_ID = dtk.NGUONDUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NGOAITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) A on A.DUOC_ID = dtk.DUOC_ID and A.PHAMVI_ID = pvsd.PHAMVI_ID and A.NGUONHANG_ID = dtk.NGUONDUOC_ID        where dtk.BENHVIEN_ID = 'HLU01'        group by LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')), pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        ) tk on tk.DUOC_ID = d.DUOC_ID        left join TM_DUOC_PHAMVISUDUNG kd on kd.PHAMVI_ID = tk.PHAMVI_ID and kd.BENHVIEN_ID = 'HLU01'        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = tk.NGUONDUOC_ID and nh.BENHVIEN_ID = 'HLU01'        where d.BENHVIEN_ID = 'HLU01' and tk.PHAMVI_ID =  @param0         end]
2020-01-02 18:00:51,911 [1] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoVaBookingCOM23UpdateRedis_TheoPhamvi] Parameters: [@param0=[PHAMVI_ID,1028]]
2020-01-02 18:00:51,911 [1] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoVaBookingCOM23UpdateRedis_TheoPhamvi] Types: [@param0=[Int64, System.Int64]]
2020-01-02 18:00:52,148 [1] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoVaBookingCOM23UpdateRedis_TheoPhamvi] PreparedStatement : [declare @TOAMUANGOAI int = 0;        select @TOAMUANGOAI = isnull(VALUE,0) from TM_SYS_APPSETTINGS where CODE = 'OPD_TOAMUANGOAI_DUNGDANHMUC_DUOC'                if @TOAMUANGOAI = 1        begin        select  distinct '0' + '_' + LTRIM(d.DUOC_ID) + '_' + '0' as DUOC_KEY, 999999999 as SOLUONG        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        where  @param0  = 0        union all        select distinct tk.DUOC_KEY, tk.SOLUONG        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        inner join        (        select  LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')) DUOC_KEY, (SUM(dtk.SOLUONG) - isnull(sum(A.SOLUONG),0) - isnull(sum(B.SOLUONG),0)) SOLUONG, pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        from (select sum(soluong) soluong,duoc_id,nguonduoc_id,khoduoc_id,benhvien_id from TT_DUOC_TONKHO  group by duoc_id,nguonduoc_id,khoduoc_id,benhvien_id) dtk        inner join TM_DUOC_PHAMVISD_MAPPING pvsd on dtk.KHODUOC_ID = pvsd.KHODUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NOITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) B on B.DUOC_ID = dtk.DUOC_ID and B.PHAMVI_ID = pvsd.PHAMVI_ID and B.NGUONHANG_ID = dtk.NGUONDUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NGOAITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) A on A.DUOC_ID = dtk.DUOC_ID and A.PHAMVI_ID = pvsd.PHAMVI_ID and A.NGUONHANG_ID = dtk.NGUONDUOC_ID        where dtk.BENHVIEN_ID = 'HLU01'        group by LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')), pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        ) tk on tk.DUOC_ID = d.DUOC_ID        left join TM_DUOC_PHAMVISUDUNG kd on kd.PHAMVI_ID = tk.PHAMVI_ID and kd.BENHVIEN_ID = 'HLU01'        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = tk.NGUONDUOC_ID and nh.BENHVIEN_ID = 'HLU01'        where d.BENHVIEN_ID = 'HLU01' and tk.PHAMVI_ID =  @param0         end        else        begin        select distinct tk.DUOC_KEY, tk.SOLUONG        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        inner join        (        select  LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')) DUOC_KEY, (SUM(dtk.SOLUONG) - isnull(sum(A.SOLUONG),0) - isnull(sum(B.SOLUONG),0)) SOLUONG, pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        from (select sum(soluong) soluong,duoc_id,nguonduoc_id,khoduoc_id,benhvien_id from TT_DUOC_TONKHO  group by duoc_id,nguonduoc_id,khoduoc_id,benhvien_id) dtk        inner join TM_DUOC_PHAMVISD_MAPPING pvsd on dtk.KHODUOC_ID = pvsd.KHODUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NOITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) B on B.DUOC_ID = dtk.DUOC_ID and B.PHAMVI_ID = pvsd.PHAMVI_ID and B.NGUONHANG_ID = dtk.NGUONDUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NGOAITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) A on A.DUOC_ID = dtk.DUOC_ID and A.PHAMVI_ID = pvsd.PHAMVI_ID and A.NGUONHANG_ID = dtk.NGUONDUOC_ID        where dtk.BENHVIEN_ID = 'HLU01'        group by LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')), pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        ) tk on tk.DUOC_ID = d.DUOC_ID        left join TM_DUOC_PHAMVISUDUNG kd on kd.PHAMVI_ID = tk.PHAMVI_ID and kd.BENHVIEN_ID = 'HLU01'        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = tk.NGUONDUOC_ID and nh.BENHVIEN_ID = 'HLU01'        where d.BENHVIEN_ID = 'HLU01' and tk.PHAMVI_ID =  @param0         end]
2020-01-02 18:00:52,148 [1] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoVaBookingCOM23UpdateRedis_TheoPhamvi] Parameters: [@param0=[PHAMVI_ID,1028]]
2020-01-02 18:00:52,148 [1] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoVaBookingCOM23UpdateRedis_TheoPhamvi] Types: [@param0=[Int64, System.Int64]]
2020-01-02 18:00:52,428 [1] DEBUG - Statement Id: [DAO00068_GetLastedSinhHieuInfo] PreparedStatement : [select top (1) *, CHISOBMI as BMI              from TT_NGOAITRU_KHAMBENH_SINHHIEU              where BENHNHAN_ID = '24442'              order by KHAMBENH_SINHHIEU_ID desc]
2020-01-02 18:00:56,993 [1] DEBUG - Statement Id: [DAO00017_GetLoaiGiaByDoiTuongId] PreparedStatement : [select dtlg.DOUUTIEN, dtlg.DOITUONG_ID, lg.LOAIGIA_ID, lg.TENLOAIGIA, lg.MALOAIGIA              from TM_LOAIGIA lg              left join TM_DOITUONG_LOAIGIA dtlg              on lg.LOAIGIA_ID = dtlg.LOAIGIA_ID and dtlg.BENHVIEN_ID = 'HLU01'              where lg.TAMNGUNG = 0 and lg.BENHVIEN_ID = 'HLU01'                             order by dtlg.DOUUTIEN]
2020-01-02 18:00:57,153 [1] DEBUG - Statement Id: [DAO00014_KiemTraDVYCCoGiaBHYT] PreparedStatement : [select *        from TT_VIENPHI        where REF_ID  = '' and REF_TABLE = 'TT_DVYEUCAU' and BHYT_DONGIA > 0]
2020-01-02 18:00:57,186 [1] DEBUG - Statement Id: [DAO00040_LayListToaMau] PreparedStatement : [select A.*, dc.TENDUOCDAYDU, dc.BHYT DUOC_BHYT, ld.LOAIVATTU_ID, ld.MALOAIDUOC, dd.DICTIONARY_NAME DUONGDUNG, dc.TAMNGUNG            from TT_TOATHUOCMAU A            left join TM_DUOC dc on A.DUOC_ID = dc.DUOC_ID            left join TM_LOAIDUOC ld on dc.LOAIDUOC_ID = ld.LOAIDUOC_ID            left join (select * from LST_DICTIONARY where DICTIONARY_TYPE_CODE like 'DuongDung') dd on dd.DICTIONARY_ID = dc.DUONGDUNG_ID            where (1=1)             and               A.BACSI_ID  = 1              and A.LOAITOATHUOC in  (                        @param0                   ,                           @param1                   ,                           @param2                   ,                           @param3                   )]
2020-01-02 18:00:57,186 [1] DEBUG - Statement Id: [DAO00040_LayListToaMau] Parameters: [@param0=[LSTLOAITOATHUOC[0],BV], @param1=[LSTLOAITOATHUOC[1],MN], @param2=[LSTLOAITOATHUOC[2],MP], @param3=[LSTLOAITOATHUOC[3],TV]]
2020-01-02 18:00:57,187 [1] DEBUG - Statement Id: [DAO00040_LayListToaMau] Types: [@param0=[String, System.String], @param1=[String, System.String], @param2=[String, System.String], @param3=[String, System.String]]
2020-01-02 18:00:57,287 [1] DEBUG - Statement Id: [DAO00040_LayListToaMau] PreparedStatement : [select A.*, dc.TENDUOCDAYDU, dc.BHYT DUOC_BHYT, ld.LOAIVATTU_ID, ld.MALOAIDUOC, dd.DICTIONARY_NAME DUONGDUNG, dc.TAMNGUNG            from TT_TOATHUOCMAU A            left join TM_DUOC dc on A.DUOC_ID = dc.DUOC_ID            left join TM_LOAIDUOC ld on dc.LOAIDUOC_ID = ld.LOAIDUOC_ID            left join (select * from LST_DICTIONARY where DICTIONARY_TYPE_CODE like 'DuongDung') dd on dd.DICTIONARY_ID = dc.DUONGDUNG_ID            where (1=1)             and               A.BACSI_ID  = 1              and A.LOAITOATHUOC in  (                        @param0                   ,                           @param1                   ,                           @param2                   ,                           @param3                   )]
2020-01-02 18:00:57,288 [1] DEBUG - Statement Id: [DAO00040_LayListToaMau] Parameters: [@param0=[LSTLOAITOATHUOC[0],BV], @param1=[LSTLOAITOATHUOC[1],MN], @param2=[LSTLOAITOATHUOC[2],MP], @param3=[LSTLOAITOATHUOC[3],TV]]
2020-01-02 18:00:57,288 [1] DEBUG - Statement Id: [DAO00040_LayListToaMau] Types: [@param0=[String, System.String], @param1=[String, System.String], @param2=[String, System.String], @param3=[String, System.String]]
2020-01-02 18:00:57,321 [1] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoVaBookingCOM23UpdateRedis_TheoPhamvi] PreparedStatement : [declare @TOAMUANGOAI int = 0;        select @TOAMUANGOAI = isnull(VALUE,0) from TM_SYS_APPSETTINGS where CODE = 'OPD_TOAMUANGOAI_DUNGDANHMUC_DUOC'                if @TOAMUANGOAI = 1        begin        select  distinct '0' + '_' + LTRIM(d.DUOC_ID) + '_' + '0' as DUOC_KEY, 999999999 as SOLUONG        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        where  @param0  = 0        union all        select distinct tk.DUOC_KEY, tk.SOLUONG        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        inner join        (        select  LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')) DUOC_KEY, (SUM(dtk.SOLUONG) - isnull(sum(A.SOLUONG),0) - isnull(sum(B.SOLUONG),0)) SOLUONG, pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        from (select sum(soluong) soluong,duoc_id,nguonduoc_id,khoduoc_id,benhvien_id from TT_DUOC_TONKHO  group by duoc_id,nguonduoc_id,khoduoc_id,benhvien_id) dtk        inner join TM_DUOC_PHAMVISD_MAPPING pvsd on dtk.KHODUOC_ID = pvsd.KHODUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NOITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) B on B.DUOC_ID = dtk.DUOC_ID and B.PHAMVI_ID = pvsd.PHAMVI_ID and B.NGUONHANG_ID = dtk.NGUONDUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NGOAITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) A on A.DUOC_ID = dtk.DUOC_ID and A.PHAMVI_ID = pvsd.PHAMVI_ID and A.NGUONHANG_ID = dtk.NGUONDUOC_ID        where dtk.BENHVIEN_ID = 'HLU01'        group by LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')), pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        ) tk on tk.DUOC_ID = d.DUOC_ID        left join TM_DUOC_PHAMVISUDUNG kd on kd.PHAMVI_ID = tk.PHAMVI_ID and kd.BENHVIEN_ID = 'HLU01'        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = tk.NGUONDUOC_ID and nh.BENHVIEN_ID = 'HLU01'        where d.BENHVIEN_ID = 'HLU01' and tk.PHAMVI_ID =  @param0         end        else        begin        select distinct tk.DUOC_KEY, tk.SOLUONG        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        inner join        (        select  LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')) DUOC_KEY, (SUM(dtk.SOLUONG) - isnull(sum(A.SOLUONG),0) - isnull(sum(B.SOLUONG),0)) SOLUONG, pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        from (select sum(soluong) soluong,duoc_id,nguonduoc_id,khoduoc_id,benhvien_id from TT_DUOC_TONKHO  group by duoc_id,nguonduoc_id,khoduoc_id,benhvien_id) dtk        inner join TM_DUOC_PHAMVISD_MAPPING pvsd on dtk.KHODUOC_ID = pvsd.KHODUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NOITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) B on B.DUOC_ID = dtk.DUOC_ID and B.PHAMVI_ID = pvsd.PHAMVI_ID and B.NGUONHANG_ID = dtk.NGUONDUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NGOAITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) A on A.DUOC_ID = dtk.DUOC_ID and A.PHAMVI_ID = pvsd.PHAMVI_ID and A.NGUONHANG_ID = dtk.NGUONDUOC_ID        where dtk.BENHVIEN_ID = 'HLU01'        group by LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')), pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        ) tk on tk.DUOC_ID = d.DUOC_ID        left join TM_DUOC_PHAMVISUDUNG kd on kd.PHAMVI_ID = tk.PHAMVI_ID and kd.BENHVIEN_ID = 'HLU01'        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = tk.NGUONDUOC_ID and nh.BENHVIEN_ID = 'HLU01'        where d.BENHVIEN_ID = 'HLU01' and tk.PHAMVI_ID =  @param0         end]
2020-01-02 18:00:57,321 [1] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoVaBookingCOM23UpdateRedis_TheoPhamvi] Parameters: [@param0=[PHAMVI_ID,1033]]
2020-01-02 18:00:57,321 [1] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoVaBookingCOM23UpdateRedis_TheoPhamvi] Types: [@param0=[Int64, System.Int64]]
2020-01-02 18:00:57,491 [1] DEBUG - Statement Id: [DAO00012_GetLoaiTCLS] PreparedStatement : [select DICTIONARY_ID, DICTIONARY_CODE, DICTIONARY_NAME, cast('0' as Bit) CHON        from LST_DICTIONARY              where DICTIONARY_TYPE_CODE = 'KHAMBENH_LOAI_TRIEUCHUNGLS'        order by LST_DICTIONARY.IDX]
2020-01-02 18:00:57,520 [1] DEBUG - Statement Id: [DAO00012_GetAllTCLS] PreparedStatement : [select MALOAITRIEUCHUNG DICTIONARY_TYPE_CODE, MALOAITRIEUCHUNG DICTIONARY_CODE,        TENTRIEUCHUNG DICTIONARY_NAME from TM_TRIEUCHUNGLS]
2020-01-02 18:00:57,547 [1] DEBUG - Statement Id: [DAO00019_ThongTinBenhNhanDvYeuCau] PreparedStatement : [select distinct A.SOTIEPNHAN, A.TIEPNHAN_ID, A.DOITUONG_ID, A.TRANGTHAI,        A.LOAITHANHVIEN_ID, A.SUDUNG_BHTN, A.THE_ID, A.THANHVIEN_ID, A.VIP, A.NGUON_BENHNHAN_ID, A.BAOLANH_VIENPHI, A.NGAYMIENDONGCHITRA,        B.*,  C.DICHVU_ID, C.DVYEUCAU_ID, C.NOITHUCHIEN_ID, A.SOBHYT        from TT_TIEPNHAN A        inner join TT_DVYEUCAU C on C.TIEPNHAN_ID = A.TIEPNHAN_ID        inner join TT_BENHNHAN B on B.BENHNHAN_ID = A.BENHNHAN_ID and B.ACTIVE = '1'        where                    C.DVYEUCAU_ID = '206519'                 and A.BENHVIEN_ID = 'HLU01']
2020-01-02 18:00:57,638 [1] DEBUG - Statement Id: [DAO00017_GetLoaiGiaByDoiTuongId] PreparedStatement : [select dtlg.DOUUTIEN, dtlg.DOITUONG_ID, lg.LOAIGIA_ID, lg.TENLOAIGIA, lg.MALOAIGIA              from TM_LOAIGIA lg              left join TM_DOITUONG_LOAIGIA dtlg              on lg.LOAIGIA_ID = dtlg.LOAIGIA_ID and dtlg.BENHVIEN_ID = 'HLU01'              where lg.TAMNGUNG = 0 and lg.BENHVIEN_ID = 'HLU01'                             order by dtlg.DOUUTIEN]
2020-01-02 18:00:57,696 [1] DEBUG - Statement Id: [DAO00014_KiemTraDVYCCoGiaBHYT] PreparedStatement : [select *        from TT_VIENPHI        where REF_ID  = '206519' and REF_TABLE = 'TT_DVYEUCAU' and BHYT_DONGIA > 0]
2020-01-02 18:00:57,729 [1] DEBUG - Statement Id: [DAO00040_LayListToaMau] PreparedStatement : [select A.*, dc.TENDUOCDAYDU, dc.BHYT DUOC_BHYT, ld.LOAIVATTU_ID, ld.MALOAIDUOC, dd.DICTIONARY_NAME DUONGDUNG, dc.TAMNGUNG            from TT_TOATHUOCMAU A            left join TM_DUOC dc on A.DUOC_ID = dc.DUOC_ID            left join TM_LOAIDUOC ld on dc.LOAIDUOC_ID = ld.LOAIDUOC_ID            left join (select * from LST_DICTIONARY where DICTIONARY_TYPE_CODE like 'DuongDung') dd on dd.DICTIONARY_ID = dc.DUONGDUNG_ID            where (1=1)             and               A.BACSI_ID  = 1              and A.LOAITOATHUOC in  (                        @param0                   ,                           @param1                   ,                           @param2                   ,                           @param3                   )]
2020-01-02 18:00:57,729 [1] DEBUG - Statement Id: [DAO00040_LayListToaMau] Parameters: [@param0=[LSTLOAITOATHUOC[0],BV], @param1=[LSTLOAITOATHUOC[1],MN], @param2=[LSTLOAITOATHUOC[2],MP], @param3=[LSTLOAITOATHUOC[3],TV]]
2020-01-02 18:00:57,729 [1] DEBUG - Statement Id: [DAO00040_LayListToaMau] Types: [@param0=[String, System.String], @param1=[String, System.String], @param2=[String, System.String], @param3=[String, System.String]]
2020-01-02 18:00:57,866 [1] DEBUG - Statement Id: [DAO00040_LayListToaMau] PreparedStatement : [select A.*, dc.TENDUOCDAYDU, dc.BHYT DUOC_BHYT, ld.LOAIVATTU_ID, ld.MALOAIDUOC, dd.DICTIONARY_NAME DUONGDUNG, dc.TAMNGUNG            from TT_TOATHUOCMAU A            left join TM_DUOC dc on A.DUOC_ID = dc.DUOC_ID            left join TM_LOAIDUOC ld on dc.LOAIDUOC_ID = ld.LOAIDUOC_ID            left join (select * from LST_DICTIONARY where DICTIONARY_TYPE_CODE like 'DuongDung') dd on dd.DICTIONARY_ID = dc.DUONGDUNG_ID            where (1=1)             and               A.BACSI_ID  = 1              and A.LOAITOATHUOC in  (                        @param0                   ,                           @param1                   ,                           @param2                   ,                           @param3                   )]
2020-01-02 18:00:57,866 [1] DEBUG - Statement Id: [DAO00040_LayListToaMau] Parameters: [@param0=[LSTLOAITOATHUOC[0],BV], @param1=[LSTLOAITOATHUOC[1],MN], @param2=[LSTLOAITOATHUOC[2],MP], @param3=[LSTLOAITOATHUOC[3],TV]]
2020-01-02 18:00:57,866 [1] DEBUG - Statement Id: [DAO00040_LayListToaMau] Types: [@param0=[String, System.String], @param1=[String, System.String], @param2=[String, System.String], @param3=[String, System.String]]
2020-01-02 18:00:57,927 [1] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoVaBookingCOM23UpdateRedis_TheoPhamvi] PreparedStatement : [declare @TOAMUANGOAI int = 0;        select @TOAMUANGOAI = isnull(VALUE,0) from TM_SYS_APPSETTINGS where CODE = 'OPD_TOAMUANGOAI_DUNGDANHMUC_DUOC'                if @TOAMUANGOAI = 1        begin        select  distinct '0' + '_' + LTRIM(d.DUOC_ID) + '_' + '0' as DUOC_KEY, 999999999 as SOLUONG        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        where  @param0  = 0        union all        select distinct tk.DUOC_KEY, tk.SOLUONG        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        inner join        (        select  LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')) DUOC_KEY, (SUM(dtk.SOLUONG) - isnull(sum(A.SOLUONG),0) - isnull(sum(B.SOLUONG),0)) SOLUONG, pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        from (select sum(soluong) soluong,duoc_id,nguonduoc_id,khoduoc_id,benhvien_id from TT_DUOC_TONKHO  group by duoc_id,nguonduoc_id,khoduoc_id,benhvien_id) dtk        inner join TM_DUOC_PHAMVISD_MAPPING pvsd on dtk.KHODUOC_ID = pvsd.KHODUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NOITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) B on B.DUOC_ID = dtk.DUOC_ID and B.PHAMVI_ID = pvsd.PHAMVI_ID and B.NGUONHANG_ID = dtk.NGUONDUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NGOAITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) A on A.DUOC_ID = dtk.DUOC_ID and A.PHAMVI_ID = pvsd.PHAMVI_ID and A.NGUONHANG_ID = dtk.NGUONDUOC_ID        where dtk.BENHVIEN_ID = 'HLU01'        group by LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')), pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        ) tk on tk.DUOC_ID = d.DUOC_ID        left join TM_DUOC_PHAMVISUDUNG kd on kd.PHAMVI_ID = tk.PHAMVI_ID and kd.BENHVIEN_ID = 'HLU01'        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = tk.NGUONDUOC_ID and nh.BENHVIEN_ID = 'HLU01'        where d.BENHVIEN_ID = 'HLU01' and tk.PHAMVI_ID =  @param0         end        else        begin        select distinct tk.DUOC_KEY, tk.SOLUONG        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        inner join        (        select  LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')) DUOC_KEY, (SUM(dtk.SOLUONG) - isnull(sum(A.SOLUONG),0) - isnull(sum(B.SOLUONG),0)) SOLUONG, pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        from (select sum(soluong) soluong,duoc_id,nguonduoc_id,khoduoc_id,benhvien_id from TT_DUOC_TONKHO  group by duoc_id,nguonduoc_id,khoduoc_id,benhvien_id) dtk        inner join TM_DUOC_PHAMVISD_MAPPING pvsd on dtk.KHODUOC_ID = pvsd.KHODUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NOITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) B on B.DUOC_ID = dtk.DUOC_ID and B.PHAMVI_ID = pvsd.PHAMVI_ID and B.NGUONHANG_ID = dtk.NGUONDUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NGOAITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) A on A.DUOC_ID = dtk.DUOC_ID and A.PHAMVI_ID = pvsd.PHAMVI_ID and A.NGUONHANG_ID = dtk.NGUONDUOC_ID        where dtk.BENHVIEN_ID = 'HLU01'        group by LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')), pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        ) tk on tk.DUOC_ID = d.DUOC_ID        left join TM_DUOC_PHAMVISUDUNG kd on kd.PHAMVI_ID = tk.PHAMVI_ID and kd.BENHVIEN_ID = 'HLU01'        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = tk.NGUONDUOC_ID and nh.BENHVIEN_ID = 'HLU01'        where d.BENHVIEN_ID = 'HLU01' and tk.PHAMVI_ID =  @param0         end]
2020-01-02 18:00:57,927 [1] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoVaBookingCOM23UpdateRedis_TheoPhamvi] Parameters: [@param0=[PHAMVI_ID,1028]]
2020-01-02 18:00:57,928 [1] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoVaBookingCOM23UpdateRedis_TheoPhamvi] Types: [@param0=[Int64, System.Int64]]
2020-01-02 18:00:58,095 [1] DEBUG - Statement Id: [DAO00013_GetTienSuBenh] PreparedStatement : [select TIENSUBENH, TIENSUDIUNG        from TT_BENHNHAN        where TT_BENHNHAN.BENHNHAN_ID  = '24441']
2020-01-02 18:00:58,120 [1] DEBUG - Statement Id: [DAO00095_GetTTDiUngThuoc] PreparedStatement : [select *              from TT_BENHNHAN_DIUNG_THUOC              where BENHNHAN_ID = '24441'              and BENHVIEN_ID = 'HLU01']
2020-01-02 18:00:58,144 [1] DEBUG - Statement Id: [DAO00014_GetTotalChiPhiDVByTiepNhan] PreparedStatement : [select sum(THANHTIEN_DOANHTHU) as THANHTIEN_DOANHTHU from TT_VIENPHI        where ACTIVE = '1'        and TIEPNHAN_ID = '28493'        and REF_TABLE = 'TT_DVYEUCAU'        and exists (select DVYEUCAU_ID from TT_DVYEUCAU where HUYYEUCAU = '0' and TIEPNHAN_ID = '28493' and TT_VIENPHI.REF_ID = DVYEUCAU_ID)]
2020-01-02 18:00:58,176 [1] DEBUG - Statement Id: [DAO00014_GetKhamBenhInfo] PreparedStatement : [select * from TT_NGOAITRU_KHAMBENH where KHAMBENH_ID =        (select KHAMBENH_NGOAITRU_ID from TT_DVYEUCAU where DVYEUCAU_ID = '206519')]
2020-01-02 18:00:58,205 [1] DEBUG - Statement Id: [DAO00068_GetSinhHieuBySinhHieuID] PreparedStatement : [select top (1) *            from TT_NGOAITRU_KHAMBENH_SINHHIEU            where KHAMBENH_SINHHIEU_ID = '0'            and BENHVIEN_ID = 'HLU01'             and               BENHNHAN_ID = '24441'                           order by KHAMBENH_SINHHIEU_ID]
2020-01-02 18:00:58,330 [1] DEBUG - Statement Id: [DAO00014_GetKhamBenhICDInfo] PreparedStatement : [select *        from TT_NGOAITRU_KHAMBENH_ICD        where KHAMBENH_ID  = '27176']
2020-01-02 18:00:58,354 [1] DEBUG - Statement Id: [DAO00014_GetListToaThuoc] PreparedStatement : [select A.*        from TT_NGOAITRU_KHAMBENH_TOATHUOC A        where A.KHAMBENH_ID = '27176']
2020-01-02 18:00:58,381 [1] DEBUG - Statement Id: [DAO00014_KiemTraDVYCCoGiaBHYT] PreparedStatement : [select *        from TT_VIENPHI        where REF_ID  = '206519' and REF_TABLE = 'TT_DVYEUCAU' and BHYT_DONGIA > 0]
2020-01-02 18:00:58,413 [1] DEBUG - Statement Id: [DAO00040_LayListToaMau] PreparedStatement : [select A.*, dc.TENDUOCDAYDU, dc.BHYT DUOC_BHYT, ld.LOAIVATTU_ID, ld.MALOAIDUOC, dd.DICTIONARY_NAME DUONGDUNG, dc.TAMNGUNG            from TT_TOATHUOCMAU A            left join TM_DUOC dc on A.DUOC_ID = dc.DUOC_ID            left join TM_LOAIDUOC ld on dc.LOAIDUOC_ID = ld.LOAIDUOC_ID            left join (select * from LST_DICTIONARY where DICTIONARY_TYPE_CODE like 'DuongDung') dd on dd.DICTIONARY_ID = dc.DUONGDUNG_ID            where (1=1)             and               A.BACSI_ID  = 1              and A.LOAITOATHUOC in  (                        @param0                   ,                           @param1                   ,                           @param2                   ,                           @param3                   )]
2020-01-02 18:00:58,413 [1] DEBUG - Statement Id: [DAO00040_LayListToaMau] Parameters: [@param0=[LSTLOAITOATHUOC[0],BV], @param1=[LSTLOAITOATHUOC[1],MN], @param2=[LSTLOAITOATHUOC[2],MP], @param3=[LSTLOAITOATHUOC[3],TV]]
2020-01-02 18:00:58,413 [1] DEBUG - Statement Id: [DAO00040_LayListToaMau] Types: [@param0=[String, System.String], @param1=[String, System.String], @param2=[String, System.String], @param3=[String, System.String]]
2020-01-02 18:00:58,515 [1] DEBUG - Statement Id: [DAO00040_LayListToaMau] PreparedStatement : [select A.*, dc.TENDUOCDAYDU, dc.BHYT DUOC_BHYT, ld.LOAIVATTU_ID, ld.MALOAIDUOC, dd.DICTIONARY_NAME DUONGDUNG, dc.TAMNGUNG            from TT_TOATHUOCMAU A            left join TM_DUOC dc on A.DUOC_ID = dc.DUOC_ID            left join TM_LOAIDUOC ld on dc.LOAIDUOC_ID = ld.LOAIDUOC_ID            left join (select * from LST_DICTIONARY where DICTIONARY_TYPE_CODE like 'DuongDung') dd on dd.DICTIONARY_ID = dc.DUONGDUNG_ID            where (1=1)             and               A.BACSI_ID  = 1              and A.LOAITOATHUOC in  (                        @param0                   ,                           @param1                   ,                           @param2                   ,                           @param3                   )]
2020-01-02 18:00:58,516 [1] DEBUG - Statement Id: [DAO00040_LayListToaMau] Parameters: [@param0=[LSTLOAITOATHUOC[0],BV], @param1=[LSTLOAITOATHUOC[1],MN], @param2=[LSTLOAITOATHUOC[2],MP], @param3=[LSTLOAITOATHUOC[3],TV]]
2020-01-02 18:00:58,516 [1] DEBUG - Statement Id: [DAO00040_LayListToaMau] Types: [@param0=[String, System.String], @param1=[String, System.String], @param2=[String, System.String], @param3=[String, System.String]]
2020-01-02 18:00:58,558 [1] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoVaBookingCOM23UpdateRedis_TheoPhamvi] PreparedStatement : [declare @TOAMUANGOAI int = 0;        select @TOAMUANGOAI = isnull(VALUE,0) from TM_SYS_APPSETTINGS where CODE = 'OPD_TOAMUANGOAI_DUNGDANHMUC_DUOC'                if @TOAMUANGOAI = 1        begin        select  distinct '0' + '_' + LTRIM(d.DUOC_ID) + '_' + '0' as DUOC_KEY, 999999999 as SOLUONG        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        where  @param0  = 0        union all        select distinct tk.DUOC_KEY, tk.SOLUONG        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        inner join        (        select  LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')) DUOC_KEY, (SUM(dtk.SOLUONG) - isnull(sum(A.SOLUONG),0) - isnull(sum(B.SOLUONG),0)) SOLUONG, pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        from (select sum(soluong) soluong,duoc_id,nguonduoc_id,khoduoc_id,benhvien_id from TT_DUOC_TONKHO  group by duoc_id,nguonduoc_id,khoduoc_id,benhvien_id) dtk        inner join TM_DUOC_PHAMVISD_MAPPING pvsd on dtk.KHODUOC_ID = pvsd.KHODUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NOITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) B on B.DUOC_ID = dtk.DUOC_ID and B.PHAMVI_ID = pvsd.PHAMVI_ID and B.NGUONHANG_ID = dtk.NGUONDUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NGOAITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) A on A.DUOC_ID = dtk.DUOC_ID and A.PHAMVI_ID = pvsd.PHAMVI_ID and A.NGUONHANG_ID = dtk.NGUONDUOC_ID        where dtk.BENHVIEN_ID = 'HLU01'        group by LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')), pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        ) tk on tk.DUOC_ID = d.DUOC_ID        left join TM_DUOC_PHAMVISUDUNG kd on kd.PHAMVI_ID = tk.PHAMVI_ID and kd.BENHVIEN_ID = 'HLU01'        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = tk.NGUONDUOC_ID and nh.BENHVIEN_ID = 'HLU01'        where d.BENHVIEN_ID = 'HLU01' and tk.PHAMVI_ID =  @param0         end        else        begin        select distinct tk.DUOC_KEY, tk.SOLUONG        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        inner join        (        select  LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')) DUOC_KEY, (SUM(dtk.SOLUONG) - isnull(sum(A.SOLUONG),0) - isnull(sum(B.SOLUONG),0)) SOLUONG, pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        from (select sum(soluong) soluong,duoc_id,nguonduoc_id,khoduoc_id,benhvien_id from TT_DUOC_TONKHO  group by duoc_id,nguonduoc_id,khoduoc_id,benhvien_id) dtk        inner join TM_DUOC_PHAMVISD_MAPPING pvsd on dtk.KHODUOC_ID = pvsd.KHODUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NOITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) B on B.DUOC_ID = dtk.DUOC_ID and B.PHAMVI_ID = pvsd.PHAMVI_ID and B.NGUONHANG_ID = dtk.NGUONDUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NGOAITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) A on A.DUOC_ID = dtk.DUOC_ID and A.PHAMVI_ID = pvsd.PHAMVI_ID and A.NGUONHANG_ID = dtk.NGUONDUOC_ID        where dtk.BENHVIEN_ID = 'HLU01'        group by LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')), pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        ) tk on tk.DUOC_ID = d.DUOC_ID        left join TM_DUOC_PHAMVISUDUNG kd on kd.PHAMVI_ID = tk.PHAMVI_ID and kd.BENHVIEN_ID = 'HLU01'        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = tk.NGUONDUOC_ID and nh.BENHVIEN_ID = 'HLU01'        where d.BENHVIEN_ID = 'HLU01' and tk.PHAMVI_ID =  @param0         end]
2020-01-02 18:00:58,558 [1] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoVaBookingCOM23UpdateRedis_TheoPhamvi] Parameters: [@param0=[PHAMVI_ID,1028]]
2020-01-02 18:00:58,558 [1] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoVaBookingCOM23UpdateRedis_TheoPhamvi] Types: [@param0=[Int64, System.Int64]]
2020-01-02 18:00:58,747 [1] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoVaBookingCOM23UpdateRedis_TheoPhamvi] PreparedStatement : [declare @TOAMUANGOAI int = 0;        select @TOAMUANGOAI = isnull(VALUE,0) from TM_SYS_APPSETTINGS where CODE = 'OPD_TOAMUANGOAI_DUNGDANHMUC_DUOC'                if @TOAMUANGOAI = 1        begin        select  distinct '0' + '_' + LTRIM(d.DUOC_ID) + '_' + '0' as DUOC_KEY, 999999999 as SOLUONG        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        where  @param0  = 0        union all        select distinct tk.DUOC_KEY, tk.SOLUONG        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        inner join        (        select  LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')) DUOC_KEY, (SUM(dtk.SOLUONG) - isnull(sum(A.SOLUONG),0) - isnull(sum(B.SOLUONG),0)) SOLUONG, pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        from (select sum(soluong) soluong,duoc_id,nguonduoc_id,khoduoc_id,benhvien_id from TT_DUOC_TONKHO  group by duoc_id,nguonduoc_id,khoduoc_id,benhvien_id) dtk        inner join TM_DUOC_PHAMVISD_MAPPING pvsd on dtk.KHODUOC_ID = pvsd.KHODUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NOITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) B on B.DUOC_ID = dtk.DUOC_ID and B.PHAMVI_ID = pvsd.PHAMVI_ID and B.NGUONHANG_ID = dtk.NGUONDUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NGOAITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) A on A.DUOC_ID = dtk.DUOC_ID and A.PHAMVI_ID = pvsd.PHAMVI_ID and A.NGUONHANG_ID = dtk.NGUONDUOC_ID        where dtk.BENHVIEN_ID = 'HLU01'        group by LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')), pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        ) tk on tk.DUOC_ID = d.DUOC_ID        left join TM_DUOC_PHAMVISUDUNG kd on kd.PHAMVI_ID = tk.PHAMVI_ID and kd.BENHVIEN_ID = 'HLU01'        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = tk.NGUONDUOC_ID and nh.BENHVIEN_ID = 'HLU01'        where d.BENHVIEN_ID = 'HLU01' and tk.PHAMVI_ID =  @param0         end        else        begin        select distinct tk.DUOC_KEY, tk.SOLUONG        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        inner join        (        select  LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')) DUOC_KEY, (SUM(dtk.SOLUONG) - isnull(sum(A.SOLUONG),0) - isnull(sum(B.SOLUONG),0)) SOLUONG, pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        from (select sum(soluong) soluong,duoc_id,nguonduoc_id,khoduoc_id,benhvien_id from TT_DUOC_TONKHO  group by duoc_id,nguonduoc_id,khoduoc_id,benhvien_id) dtk        inner join TM_DUOC_PHAMVISD_MAPPING pvsd on dtk.KHODUOC_ID = pvsd.KHODUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NOITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) B on B.DUOC_ID = dtk.DUOC_ID and B.PHAMVI_ID = pvsd.PHAMVI_ID and B.NGUONHANG_ID = dtk.NGUONDUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NGOAITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) A on A.DUOC_ID = dtk.DUOC_ID and A.PHAMVI_ID = pvsd.PHAMVI_ID and A.NGUONHANG_ID = dtk.NGUONDUOC_ID        where dtk.BENHVIEN_ID = 'HLU01'        group by LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')), pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        ) tk on tk.DUOC_ID = d.DUOC_ID        left join TM_DUOC_PHAMVISUDUNG kd on kd.PHAMVI_ID = tk.PHAMVI_ID and kd.BENHVIEN_ID = 'HLU01'        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = tk.NGUONDUOC_ID and nh.BENHVIEN_ID = 'HLU01'        where d.BENHVIEN_ID = 'HLU01' and tk.PHAMVI_ID =  @param0         end]
2020-01-02 18:00:58,748 [1] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoVaBookingCOM23UpdateRedis_TheoPhamvi] Parameters: [@param0=[PHAMVI_ID,1028]]
2020-01-02 18:00:58,748 [1] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoVaBookingCOM23UpdateRedis_TheoPhamvi] Types: [@param0=[Int64, System.Int64]]
2020-01-02 18:00:59,035 [1] DEBUG - Statement Id: [DAO00068_GetLastedSinhHieuInfo] PreparedStatement : [select top (1) *, CHISOBMI as BMI              from TT_NGOAITRU_KHAMBENH_SINHHIEU              where BENHNHAN_ID = '24441'              order by KHAMBENH_SINHHIEU_ID desc]
2020-01-02 18:01:10,283 [1] DEBUG - Statement Id: [DAO00067_GET_CHUYENVIENINFO_FROM_BENHNHANID] PreparedStatement : [select *        from TT_CHUYENVIEN        where BENHNHAN_ID  = '0' and BENHVIEN_ID = 'HLU01'        and TIEPNHAN_ID = '28493'         and           KHAMBENH_ID = '27176']
2020-01-02 18:01:10,312 [1] DEBUG - Statement Id: [DAO00014_GetChanDoan] PreparedStatement : [DECLARE @VAL1 NVARCHAR(1000) = ''        DECLARE @VAL2 NVARCHAR(1000) = ''        SELECT @VAL1 = (SELECT ICD.TENICD +'('+ICD.MAICD+'); '+ KB.CHANDOANKHOAKHAM FROM TT_NGOAITRU_KHAMBENH KB        INNER JOIN TM_ICD ICD ON ICD.ICD_ID = KB.CHANDOANICD_ID        WHERE KHAMBENH_ID =  @param0 )        SELECT @VAl2 = @VAL2 + ICD.TENICD +'('+ICD.MAICD +'); ' FROM        TT_NGOAITRU_KHAMBENH_ICD KBI        INNER JOIN TM_ICD ICD ON KBI.ICD_ID = ICD.ICD_ID        WHERE KBI.KHAMBENH_ID =  @param0         SELECT @VAL1 + '; '+ ISNULL(@VAL2,'')]
2020-01-02 18:01:10,312 [1] DEBUG - Statement Id: [DAO00014_GetChanDoan] Parameters: [@param0=[KHAMBENH_ID,27176]]
2020-01-02 18:01:10,312 [1] DEBUG - Statement Id: [DAO00014_GetChanDoan] Types: [@param0=[Int64, System.Int64]]
2020-01-02 18:01:10,340 [1] DEBUG - Statement Id: [DAO00016_GetDSThuocDaDungByTiepNhan] PreparedStatement : [select A.*, dc.TENDUOCDAYDU        from TT_NGOAITRU_TOATHUOC A        left join TM_DUOC dc on A.DUOC_ID = dc.DUOC_ID        where exists (select KHAMBENH_ID from TT_NGOAITRU_KHAMBENH where A.KHAMBENH_ID = KHAMBENH_ID and  TIEPNHAN_ID = '28493')        and exists (select KHAMBENH_TOATHUOC_ID from TT_NGOAITRU_KHAMBENH_TOATHUOC where A.KHAMBENH_TOATHUOC_ID = KHAMBENH_TOATHUOC_ID and CHUNGTUPHATTHUOC_ID is not null)        and A.BENHVIEN_ID = 'HLU01']
2020-01-02 18:01:10,365 [1] DEBUG - Statement Id: [DAO00067_GetDanhsachDichvuDungChoChuyentuyen] PreparedStatement : [select A.DICHVU_ID, B.TENDICHVU, A.DVYEUCAU_ID        from TT_DVYEUCAU A        left join TM_DICHVU B on A.DICHVU_ID = B.DICHVU_ID        left join TM_NHOMDICHVU C on C.NHOMDICHVU_ID = B.NHOMDICHVU_ID        where        ( @param0  IS NOT NULL OR  @param1  IS NOT NULL) AND        LEFT(C.MANHOMDICHVU,2) in ('01', '02', '05', '06') and A.HUYYEUCAU = '0'         and           A.TIEPNHAN_ID = '28493']
2020-01-02 18:01:10,365 [1] DEBUG - Statement Id: [DAO00067_GetDanhsachDichvuDungChoChuyentuyen] Parameters: [@param0=[BENHAN_ID,null], @param1=[TIEPNHAN_ID,28493]]
2020-01-02 18:01:10,365 [1] DEBUG - Statement Id: [DAO00067_GetDanhsachDichvuDungChoChuyentuyen] Types: [@param0=[System.DBNull, null], @param1=[Int64, System.Int64]]
2020-01-02 18:01:10,392 [1] DEBUG - Statement Id: [DAO00067_GetDanhsachxetnghiemkq] PreparedStatement : [select distinct C.CLSKETQUACHITIET_ID, B.TENDICHVU, C.KETQUA, C.DICHVU_ID, A.DVYEUCAU_ID        from TT_DVYEUCAU A        inner join TT_CLSKETQUACHITIET C on C.DVYEUCAU_ID = A.DVYEUCAU_ID        left join TM_DICHVU B on C.DICHVU_ID = B.DICHVU_ID        where A.HUYYEUCAU = '0' and A.BENHAN_ID is not null                 AND ( @param0  IS NOT NULL OR  @param1  IS NOT NULL)         and           A.TIEPNHAN_ID = '28493'                 order by C.CLSKETQUACHITIET_ID]
2020-01-02 18:01:10,392 [1] DEBUG - Statement Id: [DAO00067_GetDanhsachxetnghiemkq] Parameters: [@param0=[BENHAN_ID,null], @param1=[TIEPNHAN_ID,28493]]
2020-01-02 18:01:10,392 [1] DEBUG - Statement Id: [DAO00067_GetDanhsachxetnghiemkq] Types: [@param0=[System.DBNull, null], @param1=[Int64, System.Int64]]
2020-01-02 18:01:10,417 [1] DEBUG - Statement Id: [DAO00067_GetDanhsachsieuamkq] PreparedStatement : [select C.DVYEUCAU_ID, B.TENDICHVU,C.KETLUAN        from TT_DVYEUCAU A        inner join TT_CLSKETQUA C on C.DVYEUCAU_ID = A.DVYEUCAU_ID        left join TM_DICHVU B on C.DICHVU_ID = B.DICHVU_ID        where        ( @param0  IS NOT NULL OR  @param1  IS NOT NULL) AND                 A.DVYEUCAU_ID not in        (select DVYEUCAU_ID from TT_CLSKETQUACHITIET        where exists (        select DVYEUCAU_ID from TT_DVYEUCAU where TT_CLSKETQUACHITIET.DVYEUCAU_ID = DVYEUCAU_ID                 ))         and           A.TIEPNHAN_ID = 28493]
2020-01-02 18:01:10,417 [1] DEBUG - Statement Id: [DAO00067_GetDanhsachsieuamkq] Parameters: [@param0=[BENHAN_ID,null], @param1=[TIEPNHAN_ID,28493]]
2020-01-02 18:01:10,417 [1] DEBUG - Statement Id: [DAO00067_GetDanhsachsieuamkq] Types: [@param0=[System.DBNull, null], @param1=[Int64, System.Int64]]
2020-01-02 18:01:26,500 [1] DEBUG - Statement Id: [DAO00017_GetLoaiGiaByDoiTuongId] PreparedStatement : [select dtlg.DOUUTIEN, dtlg.DOITUONG_ID, lg.LOAIGIA_ID, lg.TENLOAIGIA, lg.MALOAIGIA              from TM_LOAIGIA lg              left join TM_DOITUONG_LOAIGIA dtlg              on lg.LOAIGIA_ID = dtlg.LOAIGIA_ID and dtlg.BENHVIEN_ID = 'HLU01'              where lg.TAMNGUNG = 0 and lg.BENHVIEN_ID = 'HLU01'                             order by dtlg.DOUUTIEN]
2020-01-02 18:01:26,659 [1] DEBUG - Statement Id: [DAO00014_KiemTraDVYCCoGiaBHYT] PreparedStatement : [select *        from TT_VIENPHI        where REF_ID  = '' and REF_TABLE = 'TT_DVYEUCAU' and BHYT_DONGIA > 0]
2020-01-02 18:01:26,752 [1] DEBUG - Statement Id: [DAO00040_LayListToaMau] PreparedStatement : [select A.*, dc.TENDUOCDAYDU, dc.BHYT DUOC_BHYT, ld.LOAIVATTU_ID, ld.MALOAIDUOC, dd.DICTIONARY_NAME DUONGDUNG, dc.TAMNGUNG            from TT_TOATHUOCMAU A            left join TM_DUOC dc on A.DUOC_ID = dc.DUOC_ID            left join TM_LOAIDUOC ld on dc.LOAIDUOC_ID = ld.LOAIDUOC_ID            left join (select * from LST_DICTIONARY where DICTIONARY_TYPE_CODE like 'DuongDung') dd on dd.DICTIONARY_ID = dc.DUONGDUNG_ID            where (1=1)             and               A.BACSI_ID  = 1              and A.LOAITOATHUOC in  (                        @param0                   ,                           @param1                   ,                           @param2                   ,                           @param3                   )]
2020-01-02 18:01:26,752 [1] DEBUG - Statement Id: [DAO00040_LayListToaMau] Parameters: [@param0=[LSTLOAITOATHUOC[0],BV], @param1=[LSTLOAITOATHUOC[1],MN], @param2=[LSTLOAITOATHUOC[2],MP], @param3=[LSTLOAITOATHUOC[3],TV]]
2020-01-02 18:01:26,752 [1] DEBUG - Statement Id: [DAO00040_LayListToaMau] Types: [@param0=[String, System.String], @param1=[String, System.String], @param2=[String, System.String], @param3=[String, System.String]]
2020-01-02 18:01:26,842 [1] DEBUG - Statement Id: [DAO00040_LayListToaMau] PreparedStatement : [select A.*, dc.TENDUOCDAYDU, dc.BHYT DUOC_BHYT, ld.LOAIVATTU_ID, ld.MALOAIDUOC, dd.DICTIONARY_NAME DUONGDUNG, dc.TAMNGUNG            from TT_TOATHUOCMAU A            left join TM_DUOC dc on A.DUOC_ID = dc.DUOC_ID            left join TM_LOAIDUOC ld on dc.LOAIDUOC_ID = ld.LOAIDUOC_ID            left join (select * from LST_DICTIONARY where DICTIONARY_TYPE_CODE like 'DuongDung') dd on dd.DICTIONARY_ID = dc.DUONGDUNG_ID            where (1=1)             and               A.BACSI_ID  = 1              and A.LOAITOATHUOC in  (                        @param0                   ,                           @param1                   ,                           @param2                   ,                           @param3                   )]
2020-01-02 18:01:26,842 [1] DEBUG - Statement Id: [DAO00040_LayListToaMau] Parameters: [@param0=[LSTLOAITOATHUOC[0],BV], @param1=[LSTLOAITOATHUOC[1],MN], @param2=[LSTLOAITOATHUOC[2],MP], @param3=[LSTLOAITOATHUOC[3],TV]]
2020-01-02 18:01:26,842 [1] DEBUG - Statement Id: [DAO00040_LayListToaMau] Types: [@param0=[String, System.String], @param1=[String, System.String], @param2=[String, System.String], @param3=[String, System.String]]
2020-01-02 18:01:26,924 [1] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoVaBookingCOM23UpdateRedis_TheoPhamvi] PreparedStatement : [declare @TOAMUANGOAI int = 0;        select @TOAMUANGOAI = isnull(VALUE,0) from TM_SYS_APPSETTINGS where CODE = 'OPD_TOAMUANGOAI_DUNGDANHMUC_DUOC'                if @TOAMUANGOAI = 1        begin        select  distinct '0' + '_' + LTRIM(d.DUOC_ID) + '_' + '0' as DUOC_KEY, 999999999 as SOLUONG        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        where  @param0  = 0        union all        select distinct tk.DUOC_KEY, tk.SOLUONG        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        inner join        (        select  LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')) DUOC_KEY, (SUM(dtk.SOLUONG) - isnull(sum(A.SOLUONG),0) - isnull(sum(B.SOLUONG),0)) SOLUONG, pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        from (select sum(soluong) soluong,duoc_id,nguonduoc_id,khoduoc_id,benhvien_id from TT_DUOC_TONKHO  group by duoc_id,nguonduoc_id,khoduoc_id,benhvien_id) dtk        inner join TM_DUOC_PHAMVISD_MAPPING pvsd on dtk.KHODUOC_ID = pvsd.KHODUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NOITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) B on B.DUOC_ID = dtk.DUOC_ID and B.PHAMVI_ID = pvsd.PHAMVI_ID and B.NGUONHANG_ID = dtk.NGUONDUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NGOAITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) A on A.DUOC_ID = dtk.DUOC_ID and A.PHAMVI_ID = pvsd.PHAMVI_ID and A.NGUONHANG_ID = dtk.NGUONDUOC_ID        where dtk.BENHVIEN_ID = 'HLU01'        group by LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')), pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        ) tk on tk.DUOC_ID = d.DUOC_ID        left join TM_DUOC_PHAMVISUDUNG kd on kd.PHAMVI_ID = tk.PHAMVI_ID and kd.BENHVIEN_ID = 'HLU01'        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = tk.NGUONDUOC_ID and nh.BENHVIEN_ID = 'HLU01'        where d.BENHVIEN_ID = 'HLU01' and tk.PHAMVI_ID =  @param0         end        else        begin        select distinct tk.DUOC_KEY, tk.SOLUONG        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        inner join        (        select  LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')) DUOC_KEY, (SUM(dtk.SOLUONG) - isnull(sum(A.SOLUONG),0) - isnull(sum(B.SOLUONG),0)) SOLUONG, pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        from (select sum(soluong) soluong,duoc_id,nguonduoc_id,khoduoc_id,benhvien_id from TT_DUOC_TONKHO  group by duoc_id,nguonduoc_id,khoduoc_id,benhvien_id) dtk        inner join TM_DUOC_PHAMVISD_MAPPING pvsd on dtk.KHODUOC_ID = pvsd.KHODUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NOITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) B on B.DUOC_ID = dtk.DUOC_ID and B.PHAMVI_ID = pvsd.PHAMVI_ID and B.NGUONHANG_ID = dtk.NGUONDUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NGOAITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) A on A.DUOC_ID = dtk.DUOC_ID and A.PHAMVI_ID = pvsd.PHAMVI_ID and A.NGUONHANG_ID = dtk.NGUONDUOC_ID        where dtk.BENHVIEN_ID = 'HLU01'        group by LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')), pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        ) tk on tk.DUOC_ID = d.DUOC_ID        left join TM_DUOC_PHAMVISUDUNG kd on kd.PHAMVI_ID = tk.PHAMVI_ID and kd.BENHVIEN_ID = 'HLU01'        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = tk.NGUONDUOC_ID and nh.BENHVIEN_ID = 'HLU01'        where d.BENHVIEN_ID = 'HLU01' and tk.PHAMVI_ID =  @param0         end]
2020-01-02 18:01:26,924 [1] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoVaBookingCOM23UpdateRedis_TheoPhamvi] Parameters: [@param0=[PHAMVI_ID,1033]]
2020-01-02 18:01:26,924 [1] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoVaBookingCOM23UpdateRedis_TheoPhamvi] Types: [@param0=[Int64, System.Int64]]
2020-01-02 18:01:27,114 [1] DEBUG - Statement Id: [DAO00012_GetLoaiTCLS] PreparedStatement : [select DICTIONARY_ID, DICTIONARY_CODE, DICTIONARY_NAME, cast('0' as Bit) CHON        from LST_DICTIONARY              where DICTIONARY_TYPE_CODE = 'KHAMBENH_LOAI_TRIEUCHUNGLS'        order by LST_DICTIONARY.IDX]
2020-01-02 18:01:27,140 [1] DEBUG - Statement Id: [DAO00012_GetAllTCLS] PreparedStatement : [select MALOAITRIEUCHUNG DICTIONARY_TYPE_CODE, MALOAITRIEUCHUNG DICTIONARY_CODE,        TENTRIEUCHUNG DICTIONARY_NAME from TM_TRIEUCHUNGLS]
2020-01-02 18:01:27,170 [1] DEBUG - Statement Id: [DAO00019_ThongTinBenhNhanDvYeuCau] PreparedStatement : [select distinct A.SOTIEPNHAN, A.TIEPNHAN_ID, A.DOITUONG_ID, A.TRANGTHAI,        A.LOAITHANHVIEN_ID, A.SUDUNG_BHTN, A.THE_ID, A.THANHVIEN_ID, A.VIP, A.NGUON_BENHNHAN_ID, A.BAOLANH_VIENPHI, A.NGAYMIENDONGCHITRA,        B.*,  C.DICHVU_ID, C.DVYEUCAU_ID, C.NOITHUCHIEN_ID, A.SOBHYT        from TT_TIEPNHAN A        inner join TT_DVYEUCAU C on C.TIEPNHAN_ID = A.TIEPNHAN_ID        inner join TT_BENHNHAN B on B.BENHNHAN_ID = A.BENHNHAN_ID and B.ACTIVE = '1'        where                    C.DVYEUCAU_ID = '206520'                 and A.BENHVIEN_ID = 'HLU01']
2020-01-02 18:01:27,267 [1] DEBUG - Statement Id: [DAO00017_GetLoaiGiaByDoiTuongId] PreparedStatement : [select dtlg.DOUUTIEN, dtlg.DOITUONG_ID, lg.LOAIGIA_ID, lg.TENLOAIGIA, lg.MALOAIGIA              from TM_LOAIGIA lg              left join TM_DOITUONG_LOAIGIA dtlg              on lg.LOAIGIA_ID = dtlg.LOAIGIA_ID and dtlg.BENHVIEN_ID = 'HLU01'              where lg.TAMNGUNG = 0 and lg.BENHVIEN_ID = 'HLU01'                             order by dtlg.DOUUTIEN]
2020-01-02 18:01:27,330 [1] DEBUG - Statement Id: [DAO00014_KiemTraDVYCCoGiaBHYT] PreparedStatement : [select *        from TT_VIENPHI        where REF_ID  = '206520' and REF_TABLE = 'TT_DVYEUCAU' and BHYT_DONGIA > 0]
2020-01-02 18:01:27,361 [1] DEBUG - Statement Id: [DAO00040_LayListToaMau] PreparedStatement : [select A.*, dc.TENDUOCDAYDU, dc.BHYT DUOC_BHYT, ld.LOAIVATTU_ID, ld.MALOAIDUOC, dd.DICTIONARY_NAME DUONGDUNG, dc.TAMNGUNG            from TT_TOATHUOCMAU A            left join TM_DUOC dc on A.DUOC_ID = dc.DUOC_ID            left join TM_LOAIDUOC ld on dc.LOAIDUOC_ID = ld.LOAIDUOC_ID            left join (select * from LST_DICTIONARY where DICTIONARY_TYPE_CODE like 'DuongDung') dd on dd.DICTIONARY_ID = dc.DUONGDUNG_ID            where (1=1)             and               A.BACSI_ID  = 1              and A.LOAITOATHUOC in  (                        @param0                   ,                           @param1                   ,                           @param2                   ,                           @param3                   )]
2020-01-02 18:01:27,361 [1] DEBUG - Statement Id: [DAO00040_LayListToaMau] Parameters: [@param0=[LSTLOAITOATHUOC[0],BV], @param1=[LSTLOAITOATHUOC[1],MN], @param2=[LSTLOAITOATHUOC[2],MP], @param3=[LSTLOAITOATHUOC[3],TV]]
2020-01-02 18:01:27,361 [1] DEBUG - Statement Id: [DAO00040_LayListToaMau] Types: [@param0=[String, System.String], @param1=[String, System.String], @param2=[String, System.String], @param3=[String, System.String]]
2020-01-02 18:01:27,456 [1] DEBUG - Statement Id: [DAO00040_LayListToaMau] PreparedStatement : [select A.*, dc.TENDUOCDAYDU, dc.BHYT DUOC_BHYT, ld.LOAIVATTU_ID, ld.MALOAIDUOC, dd.DICTIONARY_NAME DUONGDUNG, dc.TAMNGUNG            from TT_TOATHUOCMAU A            left join TM_DUOC dc on A.DUOC_ID = dc.DUOC_ID            left join TM_LOAIDUOC ld on dc.LOAIDUOC_ID = ld.LOAIDUOC_ID            left join (select * from LST_DICTIONARY where DICTIONARY_TYPE_CODE like 'DuongDung') dd on dd.DICTIONARY_ID = dc.DUONGDUNG_ID            where (1=1)             and               A.BACSI_ID  = 1              and A.LOAITOATHUOC in  (                        @param0                   ,                           @param1                   ,                           @param2                   ,                           @param3                   )]
2020-01-02 18:01:27,456 [1] DEBUG - Statement Id: [DAO00040_LayListToaMau] Parameters: [@param0=[LSTLOAITOATHUOC[0],BV], @param1=[LSTLOAITOATHUOC[1],MN], @param2=[LSTLOAITOATHUOC[2],MP], @param3=[LSTLOAITOATHUOC[3],TV]]
2020-01-02 18:01:27,456 [1] DEBUG - Statement Id: [DAO00040_LayListToaMau] Types: [@param0=[String, System.String], @param1=[String, System.String], @param2=[String, System.String], @param3=[String, System.String]]
2020-01-02 18:01:27,488 [1] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoVaBookingCOM23UpdateRedis_TheoPhamvi] PreparedStatement : [declare @TOAMUANGOAI int = 0;        select @TOAMUANGOAI = isnull(VALUE,0) from TM_SYS_APPSETTINGS where CODE = 'OPD_TOAMUANGOAI_DUNGDANHMUC_DUOC'                if @TOAMUANGOAI = 1        begin        select  distinct '0' + '_' + LTRIM(d.DUOC_ID) + '_' + '0' as DUOC_KEY, 999999999 as SOLUONG        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        where  @param0  = 0        union all        select distinct tk.DUOC_KEY, tk.SOLUONG        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        inner join        (        select  LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')) DUOC_KEY, (SUM(dtk.SOLUONG) - isnull(sum(A.SOLUONG),0) - isnull(sum(B.SOLUONG),0)) SOLUONG, pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        from (select sum(soluong) soluong,duoc_id,nguonduoc_id,khoduoc_id,benhvien_id from TT_DUOC_TONKHO  group by duoc_id,nguonduoc_id,khoduoc_id,benhvien_id) dtk        inner join TM_DUOC_PHAMVISD_MAPPING pvsd on dtk.KHODUOC_ID = pvsd.KHODUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NOITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) B on B.DUOC_ID = dtk.DUOC_ID and B.PHAMVI_ID = pvsd.PHAMVI_ID and B.NGUONHANG_ID = dtk.NGUONDUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NGOAITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) A on A.DUOC_ID = dtk.DUOC_ID and A.PHAMVI_ID = pvsd.PHAMVI_ID and A.NGUONHANG_ID = dtk.NGUONDUOC_ID        where dtk.BENHVIEN_ID = 'HLU01'        group by LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')), pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        ) tk on tk.DUOC_ID = d.DUOC_ID        left join TM_DUOC_PHAMVISUDUNG kd on kd.PHAMVI_ID = tk.PHAMVI_ID and kd.BENHVIEN_ID = 'HLU01'        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = tk.NGUONDUOC_ID and nh.BENHVIEN_ID = 'HLU01'        where d.BENHVIEN_ID = 'HLU01' and tk.PHAMVI_ID =  @param0         end        else        begin        select distinct tk.DUOC_KEY, tk.SOLUONG        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        inner join        (        select  LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')) DUOC_KEY, (SUM(dtk.SOLUONG) - isnull(sum(A.SOLUONG),0) - isnull(sum(B.SOLUONG),0)) SOLUONG, pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        from (select sum(soluong) soluong,duoc_id,nguonduoc_id,khoduoc_id,benhvien_id from TT_DUOC_TONKHO  group by duoc_id,nguonduoc_id,khoduoc_id,benhvien_id) dtk        inner join TM_DUOC_PHAMVISD_MAPPING pvsd on dtk.KHODUOC_ID = pvsd.KHODUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NOITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) B on B.DUOC_ID = dtk.DUOC_ID and B.PHAMVI_ID = pvsd.PHAMVI_ID and B.NGUONHANG_ID = dtk.NGUONDUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NGOAITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) A on A.DUOC_ID = dtk.DUOC_ID and A.PHAMVI_ID = pvsd.PHAMVI_ID and A.NGUONHANG_ID = dtk.NGUONDUOC_ID        where dtk.BENHVIEN_ID = 'HLU01'        group by LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')), pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        ) tk on tk.DUOC_ID = d.DUOC_ID        left join TM_DUOC_PHAMVISUDUNG kd on kd.PHAMVI_ID = tk.PHAMVI_ID and kd.BENHVIEN_ID = 'HLU01'        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = tk.NGUONDUOC_ID and nh.BENHVIEN_ID = 'HLU01'        where d.BENHVIEN_ID = 'HLU01' and tk.PHAMVI_ID =  @param0         end]
2020-01-02 18:01:27,489 [1] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoVaBookingCOM23UpdateRedis_TheoPhamvi] Parameters: [@param0=[PHAMVI_ID,1028]]
2020-01-02 18:01:27,489 [1] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoVaBookingCOM23UpdateRedis_TheoPhamvi] Types: [@param0=[Int64, System.Int64]]
2020-01-02 18:01:27,660 [1] DEBUG - Statement Id: [DAO00013_GetTienSuBenh] PreparedStatement : [select TIENSUBENH, TIENSUDIUNG        from TT_BENHNHAN        where TT_BENHNHAN.BENHNHAN_ID  = '24442']
2020-01-02 18:01:27,684 [1] DEBUG - Statement Id: [DAO00095_GetTTDiUngThuoc] PreparedStatement : [select *              from TT_BENHNHAN_DIUNG_THUOC              where BENHNHAN_ID = '24442'              and BENHVIEN_ID = 'HLU01']
2020-01-02 18:01:27,709 [1] DEBUG - Statement Id: [DAO00014_GetTotalChiPhiDVByTiepNhan] PreparedStatement : [select sum(THANHTIEN_DOANHTHU) as THANHTIEN_DOANHTHU from TT_VIENPHI        where ACTIVE = '1'        and TIEPNHAN_ID = '28494'        and REF_TABLE = 'TT_DVYEUCAU'        and exists (select DVYEUCAU_ID from TT_DVYEUCAU where HUYYEUCAU = '0' and TIEPNHAN_ID = '28494' and TT_VIENPHI.REF_ID = DVYEUCAU_ID)]
2020-01-02 18:01:27,742 [1] DEBUG - Statement Id: [DAO00014_GetKhamBenhInfo] PreparedStatement : [select * from TT_NGOAITRU_KHAMBENH where KHAMBENH_ID =        (select KHAMBENH_NGOAITRU_ID from TT_DVYEUCAU where DVYEUCAU_ID = '206520')]
2020-01-02 18:01:27,769 [1] DEBUG - Statement Id: [DAO00068_GetSinhHieuBySinhHieuID] PreparedStatement : [select top (1) *            from TT_NGOAITRU_KHAMBENH_SINHHIEU            where KHAMBENH_SINHHIEU_ID = '0'            and BENHVIEN_ID = 'HLU01'             and               BENHNHAN_ID = '24442'                           order by KHAMBENH_SINHHIEU_ID]
2020-01-02 18:01:27,884 [1] DEBUG - Statement Id: [DAO00014_GetKhamBenhICDInfo] PreparedStatement : [select *        from TT_NGOAITRU_KHAMBENH_ICD        where KHAMBENH_ID  = '27177']
2020-01-02 18:01:27,909 [1] DEBUG - Statement Id: [DAO00014_GetListToaThuoc] PreparedStatement : [select A.*        from TT_NGOAITRU_KHAMBENH_TOATHUOC A        where A.KHAMBENH_ID = '27177']
2020-01-02 18:01:27,936 [1] DEBUG - Statement Id: [DAO00014_KiemTraDVYCCoGiaBHYT] PreparedStatement : [select *        from TT_VIENPHI        where REF_ID  = '206520' and REF_TABLE = 'TT_DVYEUCAU' and BHYT_DONGIA > 0]
2020-01-02 18:01:27,972 [1] DEBUG - Statement Id: [DAO00040_LayListToaMau] PreparedStatement : [select A.*, dc.TENDUOCDAYDU, dc.BHYT DUOC_BHYT, ld.LOAIVATTU_ID, ld.MALOAIDUOC, dd.DICTIONARY_NAME DUONGDUNG, dc.TAMNGUNG            from TT_TOATHUOCMAU A            left join TM_DUOC dc on A.DUOC_ID = dc.DUOC_ID            left join TM_LOAIDUOC ld on dc.LOAIDUOC_ID = ld.LOAIDUOC_ID            left join (select * from LST_DICTIONARY where DICTIONARY_TYPE_CODE like 'DuongDung') dd on dd.DICTIONARY_ID = dc.DUONGDUNG_ID            where (1=1)             and               A.BACSI_ID  = 1              and A.LOAITOATHUOC in  (                        @param0                   ,                           @param1                   ,                           @param2                   ,                           @param3                   )]
2020-01-02 18:01:27,972 [1] DEBUG - Statement Id: [DAO00040_LayListToaMau] Parameters: [@param0=[LSTLOAITOATHUOC[0],BV], @param1=[LSTLOAITOATHUOC[1],MN], @param2=[LSTLOAITOATHUOC[2],MP], @param3=[LSTLOAITOATHUOC[3],TV]]
2020-01-02 18:01:27,972 [1] DEBUG - Statement Id: [DAO00040_LayListToaMau] Types: [@param0=[String, System.String], @param1=[String, System.String], @param2=[String, System.String], @param3=[String, System.String]]
2020-01-02 18:01:28,065 [1] DEBUG - Statement Id: [DAO00040_LayListToaMau] PreparedStatement : [select A.*, dc.TENDUOCDAYDU, dc.BHYT DUOC_BHYT, ld.LOAIVATTU_ID, ld.MALOAIDUOC, dd.DICTIONARY_NAME DUONGDUNG, dc.TAMNGUNG            from TT_TOATHUOCMAU A            left join TM_DUOC dc on A.DUOC_ID = dc.DUOC_ID            left join TM_LOAIDUOC ld on dc.LOAIDUOC_ID = ld.LOAIDUOC_ID            left join (select * from LST_DICTIONARY where DICTIONARY_TYPE_CODE like 'DuongDung') dd on dd.DICTIONARY_ID = dc.DUONGDUNG_ID            where (1=1)             and               A.BACSI_ID  = 1              and A.LOAITOATHUOC in  (                        @param0                   ,                           @param1                   ,                           @param2                   ,                           @param3                   )]
2020-01-02 18:01:28,065 [1] DEBUG - Statement Id: [DAO00040_LayListToaMau] Parameters: [@param0=[LSTLOAITOATHUOC[0],BV], @param1=[LSTLOAITOATHUOC[1],MN], @param2=[LSTLOAITOATHUOC[2],MP], @param3=[LSTLOAITOATHUOC[3],TV]]
2020-01-02 18:01:28,065 [1] DEBUG - Statement Id: [DAO00040_LayListToaMau] Types: [@param0=[String, System.String], @param1=[String, System.String], @param2=[String, System.String], @param3=[String, System.String]]
2020-01-02 18:01:28,114 [1] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoVaBookingCOM23UpdateRedis_TheoPhamvi] PreparedStatement : [declare @TOAMUANGOAI int = 0;        select @TOAMUANGOAI = isnull(VALUE,0) from TM_SYS_APPSETTINGS where CODE = 'OPD_TOAMUANGOAI_DUNGDANHMUC_DUOC'                if @TOAMUANGOAI = 1        begin        select  distinct '0' + '_' + LTRIM(d.DUOC_ID) + '_' + '0' as DUOC_KEY, 999999999 as SOLUONG        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        where  @param0  = 0        union all        select distinct tk.DUOC_KEY, tk.SOLUONG        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        inner join        (        select  LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')) DUOC_KEY, (SUM(dtk.SOLUONG) - isnull(sum(A.SOLUONG),0) - isnull(sum(B.SOLUONG),0)) SOLUONG, pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        from (select sum(soluong) soluong,duoc_id,nguonduoc_id,khoduoc_id,benhvien_id from TT_DUOC_TONKHO  group by duoc_id,nguonduoc_id,khoduoc_id,benhvien_id) dtk        inner join TM_DUOC_PHAMVISD_MAPPING pvsd on dtk.KHODUOC_ID = pvsd.KHODUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NOITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) B on B.DUOC_ID = dtk.DUOC_ID and B.PHAMVI_ID = pvsd.PHAMVI_ID and B.NGUONHANG_ID = dtk.NGUONDUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NGOAITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) A on A.DUOC_ID = dtk.DUOC_ID and A.PHAMVI_ID = pvsd.PHAMVI_ID and A.NGUONHANG_ID = dtk.NGUONDUOC_ID        where dtk.BENHVIEN_ID = 'HLU01'        group by LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')), pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        ) tk on tk.DUOC_ID = d.DUOC_ID        left join TM_DUOC_PHAMVISUDUNG kd on kd.PHAMVI_ID = tk.PHAMVI_ID and kd.BENHVIEN_ID = 'HLU01'        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = tk.NGUONDUOC_ID and nh.BENHVIEN_ID = 'HLU01'        where d.BENHVIEN_ID = 'HLU01' and tk.PHAMVI_ID =  @param0         end        else        begin        select distinct tk.DUOC_KEY, tk.SOLUONG        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        inner join        (        select  LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')) DUOC_KEY, (SUM(dtk.SOLUONG) - isnull(sum(A.SOLUONG),0) - isnull(sum(B.SOLUONG),0)) SOLUONG, pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        from (select sum(soluong) soluong,duoc_id,nguonduoc_id,khoduoc_id,benhvien_id from TT_DUOC_TONKHO  group by duoc_id,nguonduoc_id,khoduoc_id,benhvien_id) dtk        inner join TM_DUOC_PHAMVISD_MAPPING pvsd on dtk.KHODUOC_ID = pvsd.KHODUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NOITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) B on B.DUOC_ID = dtk.DUOC_ID and B.PHAMVI_ID = pvsd.PHAMVI_ID and B.NGUONHANG_ID = dtk.NGUONDUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NGOAITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) A on A.DUOC_ID = dtk.DUOC_ID and A.PHAMVI_ID = pvsd.PHAMVI_ID and A.NGUONHANG_ID = dtk.NGUONDUOC_ID        where dtk.BENHVIEN_ID = 'HLU01'        group by LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')), pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        ) tk on tk.DUOC_ID = d.DUOC_ID        left join TM_DUOC_PHAMVISUDUNG kd on kd.PHAMVI_ID = tk.PHAMVI_ID and kd.BENHVIEN_ID = 'HLU01'        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = tk.NGUONDUOC_ID and nh.BENHVIEN_ID = 'HLU01'        where d.BENHVIEN_ID = 'HLU01' and tk.PHAMVI_ID =  @param0         end]
2020-01-02 18:01:28,114 [1] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoVaBookingCOM23UpdateRedis_TheoPhamvi] Parameters: [@param0=[PHAMVI_ID,1028]]
2020-01-02 18:01:28,114 [1] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoVaBookingCOM23UpdateRedis_TheoPhamvi] Types: [@param0=[Int64, System.Int64]]
2020-01-02 18:01:28,329 [1] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoVaBookingCOM23UpdateRedis_TheoPhamvi] PreparedStatement : [declare @TOAMUANGOAI int = 0;        select @TOAMUANGOAI = isnull(VALUE,0) from TM_SYS_APPSETTINGS where CODE = 'OPD_TOAMUANGOAI_DUNGDANHMUC_DUOC'                if @TOAMUANGOAI = 1        begin        select  distinct '0' + '_' + LTRIM(d.DUOC_ID) + '_' + '0' as DUOC_KEY, 999999999 as SOLUONG        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        where  @param0  = 0        union all        select distinct tk.DUOC_KEY, tk.SOLUONG        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        inner join        (        select  LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')) DUOC_KEY, (SUM(dtk.SOLUONG) - isnull(sum(A.SOLUONG),0) - isnull(sum(B.SOLUONG),0)) SOLUONG, pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        from (select sum(soluong) soluong,duoc_id,nguonduoc_id,khoduoc_id,benhvien_id from TT_DUOC_TONKHO  group by duoc_id,nguonduoc_id,khoduoc_id,benhvien_id) dtk        inner join TM_DUOC_PHAMVISD_MAPPING pvsd on dtk.KHODUOC_ID = pvsd.KHODUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NOITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) B on B.DUOC_ID = dtk.DUOC_ID and B.PHAMVI_ID = pvsd.PHAMVI_ID and B.NGUONHANG_ID = dtk.NGUONDUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NGOAITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) A on A.DUOC_ID = dtk.DUOC_ID and A.PHAMVI_ID = pvsd.PHAMVI_ID and A.NGUONHANG_ID = dtk.NGUONDUOC_ID        where dtk.BENHVIEN_ID = 'HLU01'        group by LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')), pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        ) tk on tk.DUOC_ID = d.DUOC_ID        left join TM_DUOC_PHAMVISUDUNG kd on kd.PHAMVI_ID = tk.PHAMVI_ID and kd.BENHVIEN_ID = 'HLU01'        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = tk.NGUONDUOC_ID and nh.BENHVIEN_ID = 'HLU01'        where d.BENHVIEN_ID = 'HLU01' and tk.PHAMVI_ID =  @param0         end        else        begin        select distinct tk.DUOC_KEY, tk.SOLUONG        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        inner join        (        select  LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')) DUOC_KEY, (SUM(dtk.SOLUONG) - isnull(sum(A.SOLUONG),0) - isnull(sum(B.SOLUONG),0)) SOLUONG, pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        from (select sum(soluong) soluong,duoc_id,nguonduoc_id,khoduoc_id,benhvien_id from TT_DUOC_TONKHO  group by duoc_id,nguonduoc_id,khoduoc_id,benhvien_id) dtk        inner join TM_DUOC_PHAMVISD_MAPPING pvsd on dtk.KHODUOC_ID = pvsd.KHODUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NOITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) B on B.DUOC_ID = dtk.DUOC_ID and B.PHAMVI_ID = pvsd.PHAMVI_ID and B.NGUONHANG_ID = dtk.NGUONDUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NGOAITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) A on A.DUOC_ID = dtk.DUOC_ID and A.PHAMVI_ID = pvsd.PHAMVI_ID and A.NGUONHANG_ID = dtk.NGUONDUOC_ID        where dtk.BENHVIEN_ID = 'HLU01'        group by LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')), pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        ) tk on tk.DUOC_ID = d.DUOC_ID        left join TM_DUOC_PHAMVISUDUNG kd on kd.PHAMVI_ID = tk.PHAMVI_ID and kd.BENHVIEN_ID = 'HLU01'        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = tk.NGUONDUOC_ID and nh.BENHVIEN_ID = 'HLU01'        where d.BENHVIEN_ID = 'HLU01' and tk.PHAMVI_ID =  @param0         end]
2020-01-02 18:01:28,329 [1] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoVaBookingCOM23UpdateRedis_TheoPhamvi] Parameters: [@param0=[PHAMVI_ID,1028]]
2020-01-02 18:01:28,329 [1] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoVaBookingCOM23UpdateRedis_TheoPhamvi] Types: [@param0=[Int64, System.Int64]]
2020-01-02 18:01:28,618 [1] DEBUG - Statement Id: [DAO00068_GetLastedSinhHieuInfo] PreparedStatement : [select top (1) *, CHISOBMI as BMI              from TT_NGOAITRU_KHAMBENH_SINHHIEU              where BENHNHAN_ID = '24442'              order by KHAMBENH_SINHHIEU_ID desc]
2020-01-02 18:01:32,200 [1] DEBUG - Statement Id: [DAO00019_GetDanhsachKhambenh] PreparedStatement : [select *        from        (SELECT COUNT(*) OVER() as TOTALROWS, ROW_NUMBER() OVER(order by isnull(dv.SOTHUTU,'999999999'), dv.NGAYGIOYEUCAU) as ROWNUMBER,        bn.MAYTE, bn.TENBENHNHAN, bn.NAMSINH, bn.NGAYSINH as TUOI, ISNULL(CONVERT(VARCHAR(10), bn.NGAYSINH, 103),CAST(bn.NAMSINH AS varchar)) as NGAYSINH, bn.DIACHILIENLAC as DIACHI, bn.GIOITINH, GD.DESCRIPTION as TENGIOITINH,        tn.DOITUONG_ID, tn.THOIGIANTIEPNHAN, tn.BENHNHAN_ID, tn.TIEPNHAN_ID, tn.TRAITUYEN, tn.SOTIEPNHAN,        dv.DICHVU_ID, dv.NOITHUCHIEN_ID, isnull(dv.NGAYTAO, dv.NGAYCAPNHAT) as THOIGIANDKDICHVU,        dv.KHAN, dv.NOIYEUCAU_ID, dv.NGAYGIOYEUCAU, dv.BACSICHIDINH_ID, dv.DONVIGIOITHIEU_ID, dv.NGUOIGIOITHIEU_ID,        tn.NOIGIOITHIEU_ID, kbnt.HUONGGIAIQUYET_ID,        dv.DVYEUCAU_ID, dv.MARIS, dv.TRANGTHAI as TRANGTHAICODE, B.TENNHOMDICHVU, dv.SOPHIEUYEUCAU, dv.KHAMBENH_NGOAITRU_ID, dv.NGUOICAPNHAT_ID, dv.NGAYCAPNHAT,        CASE WHEN Left(B.MANHOMDICHVU,2) = '03' THEN '02' ELSE Left(B.MANHOMDICHVU,2) END AS MANHOMDICHVU, B.MANHOMDICHVU as MANHOMDICHVUCHITIET, tn.TRANGTHAI as TRANGTHAI_TIEPNHAN,        'True' as DAKHAM, isnull(dv.SOTHUTU,'999999999') as SOHANGDOI,        vp.DATHANHTOAN, dv.TRANGTHAI_WFL,        BA.SOBENHAN, dv.CHANDOAN, dt.TENDOITUONG, isnull(kbnt.THOIGIANKHAM, dv.NGAYCAPNHAT) as THOIGIANKHAM,        tn.SOBHYT        FROM TT_DVYEUCAU (NOLOCK) dv        inner join TT_TIEPNHAN (NOLOCK) tn on dv.TIEPNHAN_ID = tn.TIEPNHAN_ID        inner join TT_BENHNHAN (NOLOCK) bn on tn.BENHNHAN_ID = bn.BENHNHAN_ID        inner join TM_DICHVU A on A.DICHVU_ID = dv.DICHVU_ID        inner join TM_NHOMDICHVU B on B.NHOMDICHVU_ID = A.NHOMDICHVU_ID        inner join TT_VIENPHI(NOLOCK) VP on VP.TIEPNHAN_ID = tn.TIEPNHAN_ID and VP.DICHVU_ID = dv.DICHVU_ID and VP.REF_ID = dv.DVYEUCAU_ID        left join TT_NOITRU_BENHAN (NOLOCK) BA on BA.TIEPNHAN_ID = tn.TIEPNHAN_ID AND dv.BENHAN_ID = BA.BENHAN_ID        inner join TM_GENDER GD on GD.ID = bn.GIOITINH        left join TT_NGOAITRU_KHAMBENH (NOLOCK) kbnt on kbnt.KHAMBENH_ID = dv.KHAMBENH_NGOAITRU_ID        inner join TM_DOITUONG dt on dt.DOITUONG_ID = tn.DOITUONG_ID        where        dv.DICHVU_ID IS NOT NULL        and tn.BENHVIEN_ID = 'HLU01'        and HUYYEUCAU = 0        and dv.NGAYHENCLS is NULL         and           dv.NGAYYEUCAU >= '1/2/2020 12:00:00 AM'         and           dv.NGAYYEUCAU <= '1/2/2020 12:00:00 AM'         and           dv.NOITHUCHIEN_ID = 62          AND             (dv.TRANGTHAI != 'CHUAKETQUA' or isnull(kbnt.HUONGGIAIQUYET_ID, 0) > 0)           and           (CASE WHEN Left(B.MANHOMDICHVU,2) = '03' THEN '02' ELSE Left(B.MANHOMDICHVU,2) END) = '04'                 ) lst                    where          lst.ROWNUMBER between 1 and 5                 order by SOHANGDOI, NGAYGIOYEUCAU asc]
2020-01-02 18:01:33,692 [1] DEBUG - Statement Id: [DAO00017_GetLoaiGiaByDoiTuongId] PreparedStatement : [select dtlg.DOUUTIEN, dtlg.DOITUONG_ID, lg.LOAIGIA_ID, lg.TENLOAIGIA, lg.MALOAIGIA              from TM_LOAIGIA lg              left join TM_DOITUONG_LOAIGIA dtlg              on lg.LOAIGIA_ID = dtlg.LOAIGIA_ID and dtlg.BENHVIEN_ID = 'HLU01'              where lg.TAMNGUNG = 0 and lg.BENHVIEN_ID = 'HLU01'                             order by dtlg.DOUUTIEN]
2020-01-02 18:01:33,851 [1] DEBUG - Statement Id: [DAO00014_KiemTraDVYCCoGiaBHYT] PreparedStatement : [select *        from TT_VIENPHI        where REF_ID  = '' and REF_TABLE = 'TT_DVYEUCAU' and BHYT_DONGIA > 0]
2020-01-02 18:01:33,883 [1] DEBUG - Statement Id: [DAO00040_LayListToaMau] PreparedStatement : [select A.*, dc.TENDUOCDAYDU, dc.BHYT DUOC_BHYT, ld.LOAIVATTU_ID, ld.MALOAIDUOC, dd.DICTIONARY_NAME DUONGDUNG, dc.TAMNGUNG            from TT_TOATHUOCMAU A            left join TM_DUOC dc on A.DUOC_ID = dc.DUOC_ID            left join TM_LOAIDUOC ld on dc.LOAIDUOC_ID = ld.LOAIDUOC_ID            left join (select * from LST_DICTIONARY where DICTIONARY_TYPE_CODE like 'DuongDung') dd on dd.DICTIONARY_ID = dc.DUONGDUNG_ID            where (1=1)             and               A.BACSI_ID  = 1              and A.LOAITOATHUOC in  (                        @param0                   ,                           @param1                   ,                           @param2                   ,                           @param3                   )]
2020-01-02 18:01:33,883 [1] DEBUG - Statement Id: [DAO00040_LayListToaMau] Parameters: [@param0=[LSTLOAITOATHUOC[0],BV], @param1=[LSTLOAITOATHUOC[1],MN], @param2=[LSTLOAITOATHUOC[2],MP], @param3=[LSTLOAITOATHUOC[3],TV]]
2020-01-02 18:01:33,883 [1] DEBUG - Statement Id: [DAO00040_LayListToaMau] Types: [@param0=[String, System.String], @param1=[String, System.String], @param2=[String, System.String], @param3=[String, System.String]]
2020-01-02 18:01:33,963 [1] DEBUG - Statement Id: [DAO00040_LayListToaMau] PreparedStatement : [select A.*, dc.TENDUOCDAYDU, dc.BHYT DUOC_BHYT, ld.LOAIVATTU_ID, ld.MALOAIDUOC, dd.DICTIONARY_NAME DUONGDUNG, dc.TAMNGUNG            from TT_TOATHUOCMAU A            left join TM_DUOC dc on A.DUOC_ID = dc.DUOC_ID            left join TM_LOAIDUOC ld on dc.LOAIDUOC_ID = ld.LOAIDUOC_ID            left join (select * from LST_DICTIONARY where DICTIONARY_TYPE_CODE like 'DuongDung') dd on dd.DICTIONARY_ID = dc.DUONGDUNG_ID            where (1=1)             and               A.BACSI_ID  = 1              and A.LOAITOATHUOC in  (                        @param0                   ,                           @param1                   ,                           @param2                   ,                           @param3                   )]
2020-01-02 18:01:33,963 [1] DEBUG - Statement Id: [DAO00040_LayListToaMau] Parameters: [@param0=[LSTLOAITOATHUOC[0],BV], @param1=[LSTLOAITOATHUOC[1],MN], @param2=[LSTLOAITOATHUOC[2],MP], @param3=[LSTLOAITOATHUOC[3],TV]]
2020-01-02 18:01:33,963 [1] DEBUG - Statement Id: [DAO00040_LayListToaMau] Types: [@param0=[String, System.String], @param1=[String, System.String], @param2=[String, System.String], @param3=[String, System.String]]
2020-01-02 18:01:33,996 [1] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoVaBookingCOM23UpdateRedis_TheoPhamvi] PreparedStatement : [declare @TOAMUANGOAI int = 0;        select @TOAMUANGOAI = isnull(VALUE,0) from TM_SYS_APPSETTINGS where CODE = 'OPD_TOAMUANGOAI_DUNGDANHMUC_DUOC'                if @TOAMUANGOAI = 1        begin        select  distinct '0' + '_' + LTRIM(d.DUOC_ID) + '_' + '0' as DUOC_KEY, 999999999 as SOLUONG        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        where  @param0  = 0        union all        select distinct tk.DUOC_KEY, tk.SOLUONG        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        inner join        (        select  LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')) DUOC_KEY, (SUM(dtk.SOLUONG) - isnull(sum(A.SOLUONG),0) - isnull(sum(B.SOLUONG),0)) SOLUONG, pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        from (select sum(soluong) soluong,duoc_id,nguonduoc_id,khoduoc_id,benhvien_id from TT_DUOC_TONKHO  group by duoc_id,nguonduoc_id,khoduoc_id,benhvien_id) dtk        inner join TM_DUOC_PHAMVISD_MAPPING pvsd on dtk.KHODUOC_ID = pvsd.KHODUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NOITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) B on B.DUOC_ID = dtk.DUOC_ID and B.PHAMVI_ID = pvsd.PHAMVI_ID and B.NGUONHANG_ID = dtk.NGUONDUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NGOAITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) A on A.DUOC_ID = dtk.DUOC_ID and A.PHAMVI_ID = pvsd.PHAMVI_ID and A.NGUONHANG_ID = dtk.NGUONDUOC_ID        where dtk.BENHVIEN_ID = 'HLU01'        group by LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')), pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        ) tk on tk.DUOC_ID = d.DUOC_ID        left join TM_DUOC_PHAMVISUDUNG kd on kd.PHAMVI_ID = tk.PHAMVI_ID and kd.BENHVIEN_ID = 'HLU01'        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = tk.NGUONDUOC_ID and nh.BENHVIEN_ID = 'HLU01'        where d.BENHVIEN_ID = 'HLU01' and tk.PHAMVI_ID =  @param0         end        else        begin        select distinct tk.DUOC_KEY, tk.SOLUONG        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        inner join        (        select  LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')) DUOC_KEY, (SUM(dtk.SOLUONG) - isnull(sum(A.SOLUONG),0) - isnull(sum(B.SOLUONG),0)) SOLUONG, pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        from (select sum(soluong) soluong,duoc_id,nguonduoc_id,khoduoc_id,benhvien_id from TT_DUOC_TONKHO  group by duoc_id,nguonduoc_id,khoduoc_id,benhvien_id) dtk        inner join TM_DUOC_PHAMVISD_MAPPING pvsd on dtk.KHODUOC_ID = pvsd.KHODUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NOITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) B on B.DUOC_ID = dtk.DUOC_ID and B.PHAMVI_ID = pvsd.PHAMVI_ID and B.NGUONHANG_ID = dtk.NGUONDUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NGOAITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) A on A.DUOC_ID = dtk.DUOC_ID and A.PHAMVI_ID = pvsd.PHAMVI_ID and A.NGUONHANG_ID = dtk.NGUONDUOC_ID        where dtk.BENHVIEN_ID = 'HLU01'        group by LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')), pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        ) tk on tk.DUOC_ID = d.DUOC_ID        left join TM_DUOC_PHAMVISUDUNG kd on kd.PHAMVI_ID = tk.PHAMVI_ID and kd.BENHVIEN_ID = 'HLU01'        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = tk.NGUONDUOC_ID and nh.BENHVIEN_ID = 'HLU01'        where d.BENHVIEN_ID = 'HLU01' and tk.PHAMVI_ID =  @param0         end]
2020-01-02 18:01:33,996 [1] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoVaBookingCOM23UpdateRedis_TheoPhamvi] Parameters: [@param0=[PHAMVI_ID,1033]]
2020-01-02 18:01:33,996 [1] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoVaBookingCOM23UpdateRedis_TheoPhamvi] Types: [@param0=[Int64, System.Int64]]
2020-01-02 18:01:34,235 [1] DEBUG - Statement Id: [DAO00012_GetLoaiTCLS] PreparedStatement : [select DICTIONARY_ID, DICTIONARY_CODE, DICTIONARY_NAME, cast('0' as Bit) CHON        from LST_DICTIONARY              where DICTIONARY_TYPE_CODE = 'KHAMBENH_LOAI_TRIEUCHUNGLS'        order by LST_DICTIONARY.IDX]
2020-01-02 18:01:34,262 [1] DEBUG - Statement Id: [DAO00012_GetAllTCLS] PreparedStatement : [select MALOAITRIEUCHUNG DICTIONARY_TYPE_CODE, MALOAITRIEUCHUNG DICTIONARY_CODE,        TENTRIEUCHUNG DICTIONARY_NAME from TM_TRIEUCHUNGLS]
2020-01-02 18:01:34,289 [1] DEBUG - Statement Id: [DAO00019_ThongTinBenhNhanDvYeuCau] PreparedStatement : [select distinct A.SOTIEPNHAN, A.TIEPNHAN_ID, A.DOITUONG_ID, A.TRANGTHAI,        A.LOAITHANHVIEN_ID, A.SUDUNG_BHTN, A.THE_ID, A.THANHVIEN_ID, A.VIP, A.NGUON_BENHNHAN_ID, A.BAOLANH_VIENPHI, A.NGAYMIENDONGCHITRA,        B.*,  C.DICHVU_ID, C.DVYEUCAU_ID, C.NOITHUCHIEN_ID, A.SOBHYT        from TT_TIEPNHAN A        inner join TT_DVYEUCAU C on C.TIEPNHAN_ID = A.TIEPNHAN_ID        inner join TT_BENHNHAN B on B.BENHNHAN_ID = A.BENHNHAN_ID and B.ACTIVE = '1'        where                    C.DVYEUCAU_ID = '206520'                 and A.BENHVIEN_ID = 'HLU01']
2020-01-02 18:01:34,409 [1] DEBUG - Statement Id: [DAO00017_GetLoaiGiaByDoiTuongId] PreparedStatement : [select dtlg.DOUUTIEN, dtlg.DOITUONG_ID, lg.LOAIGIA_ID, lg.TENLOAIGIA, lg.MALOAIGIA              from TM_LOAIGIA lg              left join TM_DOITUONG_LOAIGIA dtlg              on lg.LOAIGIA_ID = dtlg.LOAIGIA_ID and dtlg.BENHVIEN_ID = 'HLU01'              where lg.TAMNGUNG = 0 and lg.BENHVIEN_ID = 'HLU01'                             order by dtlg.DOUUTIEN]
2020-01-02 18:01:34,448 [1] DEBUG - Statement Id: [DAO00014_KiemTraDVYCCoGiaBHYT] PreparedStatement : [select *        from TT_VIENPHI        where REF_ID  = '206520' and REF_TABLE = 'TT_DVYEUCAU' and BHYT_DONGIA > 0]
2020-01-02 18:01:34,478 [1] DEBUG - Statement Id: [DAO00040_LayListToaMau] PreparedStatement : [select A.*, dc.TENDUOCDAYDU, dc.BHYT DUOC_BHYT, ld.LOAIVATTU_ID, ld.MALOAIDUOC, dd.DICTIONARY_NAME DUONGDUNG, dc.TAMNGUNG            from TT_TOATHUOCMAU A            left join TM_DUOC dc on A.DUOC_ID = dc.DUOC_ID            left join TM_LOAIDUOC ld on dc.LOAIDUOC_ID = ld.LOAIDUOC_ID            left join (select * from LST_DICTIONARY where DICTIONARY_TYPE_CODE like 'DuongDung') dd on dd.DICTIONARY_ID = dc.DUONGDUNG_ID            where (1=1)             and               A.BACSI_ID  = 1              and A.LOAITOATHUOC in  (                        @param0                   ,                           @param1                   ,                           @param2                   ,                           @param3                   )]
2020-01-02 18:01:34,479 [1] DEBUG - Statement Id: [DAO00040_LayListToaMau] Parameters: [@param0=[LSTLOAITOATHUOC[0],BV], @param1=[LSTLOAITOATHUOC[1],MN], @param2=[LSTLOAITOATHUOC[2],MP], @param3=[LSTLOAITOATHUOC[3],TV]]
2020-01-02 18:01:34,479 [1] DEBUG - Statement Id: [DAO00040_LayListToaMau] Types: [@param0=[String, System.String], @param1=[String, System.String], @param2=[String, System.String], @param3=[String, System.String]]
2020-01-02 18:01:34,622 [1] DEBUG - Statement Id: [DAO00040_LayListToaMau] PreparedStatement : [select A.*, dc.TENDUOCDAYDU, dc.BHYT DUOC_BHYT, ld.LOAIVATTU_ID, ld.MALOAIDUOC, dd.DICTIONARY_NAME DUONGDUNG, dc.TAMNGUNG            from TT_TOATHUOCMAU A            left join TM_DUOC dc on A.DUOC_ID = dc.DUOC_ID            left join TM_LOAIDUOC ld on dc.LOAIDUOC_ID = ld.LOAIDUOC_ID            left join (select * from LST_DICTIONARY where DICTIONARY_TYPE_CODE like 'DuongDung') dd on dd.DICTIONARY_ID = dc.DUONGDUNG_ID            where (1=1)             and               A.BACSI_ID  = 1              and A.LOAITOATHUOC in  (                        @param0                   ,                           @param1                   ,                           @param2                   ,                           @param3                   )]
2020-01-02 18:01:34,622 [1] DEBUG - Statement Id: [DAO00040_LayListToaMau] Parameters: [@param0=[LSTLOAITOATHUOC[0],BV], @param1=[LSTLOAITOATHUOC[1],MN], @param2=[LSTLOAITOATHUOC[2],MP], @param3=[LSTLOAITOATHUOC[3],TV]]
2020-01-02 18:01:34,622 [1] DEBUG - Statement Id: [DAO00040_LayListToaMau] Types: [@param0=[String, System.String], @param1=[String, System.String], @param2=[String, System.String], @param3=[String, System.String]]
2020-01-02 18:01:34,720 [1] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoVaBookingCOM23UpdateRedis_TheoPhamvi] PreparedStatement : [declare @TOAMUANGOAI int = 0;        select @TOAMUANGOAI = isnull(VALUE,0) from TM_SYS_APPSETTINGS where CODE = 'OPD_TOAMUANGOAI_DUNGDANHMUC_DUOC'                if @TOAMUANGOAI = 1        begin        select  distinct '0' + '_' + LTRIM(d.DUOC_ID) + '_' + '0' as DUOC_KEY, 999999999 as SOLUONG        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        where  @param0  = 0        union all        select distinct tk.DUOC_KEY, tk.SOLUONG        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        inner join        (        select  LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')) DUOC_KEY, (SUM(dtk.SOLUONG) - isnull(sum(A.SOLUONG),0) - isnull(sum(B.SOLUONG),0)) SOLUONG, pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        from (select sum(soluong) soluong,duoc_id,nguonduoc_id,khoduoc_id,benhvien_id from TT_DUOC_TONKHO  group by duoc_id,nguonduoc_id,khoduoc_id,benhvien_id) dtk        inner join TM_DUOC_PHAMVISD_MAPPING pvsd on dtk.KHODUOC_ID = pvsd.KHODUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NOITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) B on B.DUOC_ID = dtk.DUOC_ID and B.PHAMVI_ID = pvsd.PHAMVI_ID and B.NGUONHANG_ID = dtk.NGUONDUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NGOAITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) A on A.DUOC_ID = dtk.DUOC_ID and A.PHAMVI_ID = pvsd.PHAMVI_ID and A.NGUONHANG_ID = dtk.NGUONDUOC_ID        where dtk.BENHVIEN_ID = 'HLU01'        group by LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')), pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        ) tk on tk.DUOC_ID = d.DUOC_ID        left join TM_DUOC_PHAMVISUDUNG kd on kd.PHAMVI_ID = tk.PHAMVI_ID and kd.BENHVIEN_ID = 'HLU01'        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = tk.NGUONDUOC_ID and nh.BENHVIEN_ID = 'HLU01'        where d.BENHVIEN_ID = 'HLU01' and tk.PHAMVI_ID =  @param0         end        else        begin        select distinct tk.DUOC_KEY, tk.SOLUONG        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        inner join        (        select  LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')) DUOC_KEY, (SUM(dtk.SOLUONG) - isnull(sum(A.SOLUONG),0) - isnull(sum(B.SOLUONG),0)) SOLUONG, pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        from (select sum(soluong) soluong,duoc_id,nguonduoc_id,khoduoc_id,benhvien_id from TT_DUOC_TONKHO  group by duoc_id,nguonduoc_id,khoduoc_id,benhvien_id) dtk        inner join TM_DUOC_PHAMVISD_MAPPING pvsd on dtk.KHODUOC_ID = pvsd.KHODUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NOITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) B on B.DUOC_ID = dtk.DUOC_ID and B.PHAMVI_ID = pvsd.PHAMVI_ID and B.NGUONHANG_ID = dtk.NGUONDUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NGOAITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) A on A.DUOC_ID = dtk.DUOC_ID and A.PHAMVI_ID = pvsd.PHAMVI_ID and A.NGUONHANG_ID = dtk.NGUONDUOC_ID        where dtk.BENHVIEN_ID = 'HLU01'        group by LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')), pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        ) tk on tk.DUOC_ID = d.DUOC_ID        left join TM_DUOC_PHAMVISUDUNG kd on kd.PHAMVI_ID = tk.PHAMVI_ID and kd.BENHVIEN_ID = 'HLU01'        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = tk.NGUONDUOC_ID and nh.BENHVIEN_ID = 'HLU01'        where d.BENHVIEN_ID = 'HLU01' and tk.PHAMVI_ID =  @param0         end]
2020-01-02 18:01:34,721 [1] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoVaBookingCOM23UpdateRedis_TheoPhamvi] Parameters: [@param0=[PHAMVI_ID,1028]]
2020-01-02 18:01:34,721 [1] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoVaBookingCOM23UpdateRedis_TheoPhamvi] Types: [@param0=[Int64, System.Int64]]
2020-01-02 18:01:34,891 [1] DEBUG - Statement Id: [DAO00013_GetTienSuBenh] PreparedStatement : [select TIENSUBENH, TIENSUDIUNG        from TT_BENHNHAN        where TT_BENHNHAN.BENHNHAN_ID  = '24442']
2020-01-02 18:01:34,916 [1] DEBUG - Statement Id: [DAO00095_GetTTDiUngThuoc] PreparedStatement : [select *              from TT_BENHNHAN_DIUNG_THUOC              where BENHNHAN_ID = '24442'              and BENHVIEN_ID = 'HLU01']
2020-01-02 18:01:34,941 [1] DEBUG - Statement Id: [DAO00014_GetTotalChiPhiDVByTiepNhan] PreparedStatement : [select sum(THANHTIEN_DOANHTHU) as THANHTIEN_DOANHTHU from TT_VIENPHI        where ACTIVE = '1'        and TIEPNHAN_ID = '28494'        and REF_TABLE = 'TT_DVYEUCAU'        and exists (select DVYEUCAU_ID from TT_DVYEUCAU where HUYYEUCAU = '0' and TIEPNHAN_ID = '28494' and TT_VIENPHI.REF_ID = DVYEUCAU_ID)]
2020-01-02 18:01:34,974 [1] DEBUG - Statement Id: [DAO00014_GetKhamBenhInfo] PreparedStatement : [select * from TT_NGOAITRU_KHAMBENH where KHAMBENH_ID =        (select KHAMBENH_NGOAITRU_ID from TT_DVYEUCAU where DVYEUCAU_ID = '206520')]
2020-01-02 18:01:35,003 [1] DEBUG - Statement Id: [DAO00068_GetSinhHieuBySinhHieuID] PreparedStatement : [select top (1) *            from TT_NGOAITRU_KHAMBENH_SINHHIEU            where KHAMBENH_SINHHIEU_ID = '0'            and BENHVIEN_ID = 'HLU01'             and               BENHNHAN_ID = '24442'                           order by KHAMBENH_SINHHIEU_ID]
2020-01-02 18:01:35,118 [1] DEBUG - Statement Id: [DAO00014_GetKhamBenhICDInfo] PreparedStatement : [select *        from TT_NGOAITRU_KHAMBENH_ICD        where KHAMBENH_ID  = '27177']
2020-01-02 18:01:35,459 [1] DEBUG - Statement Id: [DAO00014_GetListToaThuoc] PreparedStatement : [select A.*        from TT_NGOAITRU_KHAMBENH_TOATHUOC A        where A.KHAMBENH_ID = '27177']
2020-01-02 18:01:35,487 [1] DEBUG - Statement Id: [DAO00014_KiemTraDVYCCoGiaBHYT] PreparedStatement : [select *        from TT_VIENPHI        where REF_ID  = '206520' and REF_TABLE = 'TT_DVYEUCAU' and BHYT_DONGIA > 0]
2020-01-02 18:01:35,584 [1] DEBUG - Statement Id: [DAO00040_LayListToaMau] PreparedStatement : [select A.*, dc.TENDUOCDAYDU, dc.BHYT DUOC_BHYT, ld.LOAIVATTU_ID, ld.MALOAIDUOC, dd.DICTIONARY_NAME DUONGDUNG, dc.TAMNGUNG            from TT_TOATHUOCMAU A            left join TM_DUOC dc on A.DUOC_ID = dc.DUOC_ID            left join TM_LOAIDUOC ld on dc.LOAIDUOC_ID = ld.LOAIDUOC_ID            left join (select * from LST_DICTIONARY where DICTIONARY_TYPE_CODE like 'DuongDung') dd on dd.DICTIONARY_ID = dc.DUONGDUNG_ID            where (1=1)             and               A.BACSI_ID  = 1              and A.LOAITOATHUOC in  (                        @param0                   ,                           @param1                   ,                           @param2                   ,                           @param3                   )]
2020-01-02 18:01:35,584 [1] DEBUG - Statement Id: [DAO00040_LayListToaMau] Parameters: [@param0=[LSTLOAITOATHUOC[0],BV], @param1=[LSTLOAITOATHUOC[1],MN], @param2=[LSTLOAITOATHUOC[2],MP], @param3=[LSTLOAITOATHUOC[3],TV]]
2020-01-02 18:01:35,584 [1] DEBUG - Statement Id: [DAO00040_LayListToaMau] Types: [@param0=[String, System.String], @param1=[String, System.String], @param2=[String, System.String], @param3=[String, System.String]]
2020-01-02 18:01:35,674 [1] DEBUG - Statement Id: [DAO00040_LayListToaMau] PreparedStatement : [select A.*, dc.TENDUOCDAYDU, dc.BHYT DUOC_BHYT, ld.LOAIVATTU_ID, ld.MALOAIDUOC, dd.DICTIONARY_NAME DUONGDUNG, dc.TAMNGUNG            from TT_TOATHUOCMAU A            left join TM_DUOC dc on A.DUOC_ID = dc.DUOC_ID            left join TM_LOAIDUOC ld on dc.LOAIDUOC_ID = ld.LOAIDUOC_ID            left join (select * from LST_DICTIONARY where DICTIONARY_TYPE_CODE like 'DuongDung') dd on dd.DICTIONARY_ID = dc.DUONGDUNG_ID            where (1=1)             and               A.BACSI_ID  = 1              and A.LOAITOATHUOC in  (                        @param0                   ,                           @param1                   ,                           @param2                   ,                           @param3                   )]
2020-01-02 18:01:35,674 [1] DEBUG - Statement Id: [DAO00040_LayListToaMau] Parameters: [@param0=[LSTLOAITOATHUOC[0],BV], @param1=[LSTLOAITOATHUOC[1],MN], @param2=[LSTLOAITOATHUOC[2],MP], @param3=[LSTLOAITOATHUOC[3],TV]]
2020-01-02 18:01:35,674 [1] DEBUG - Statement Id: [DAO00040_LayListToaMau] Types: [@param0=[String, System.String], @param1=[String, System.String], @param2=[String, System.String], @param3=[String, System.String]]
2020-01-02 18:01:35,706 [1] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoVaBookingCOM23UpdateRedis_TheoPhamvi] PreparedStatement : [declare @TOAMUANGOAI int = 0;        select @TOAMUANGOAI = isnull(VALUE,0) from TM_SYS_APPSETTINGS where CODE = 'OPD_TOAMUANGOAI_DUNGDANHMUC_DUOC'                if @TOAMUANGOAI = 1        begin        select  distinct '0' + '_' + LTRIM(d.DUOC_ID) + '_' + '0' as DUOC_KEY, 999999999 as SOLUONG        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        where  @param0  = 0        union all        select distinct tk.DUOC_KEY, tk.SOLUONG        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        inner join        (        select  LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')) DUOC_KEY, (SUM(dtk.SOLUONG) - isnull(sum(A.SOLUONG),0) - isnull(sum(B.SOLUONG),0)) SOLUONG, pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        from (select sum(soluong) soluong,duoc_id,nguonduoc_id,khoduoc_id,benhvien_id from TT_DUOC_TONKHO  group by duoc_id,nguonduoc_id,khoduoc_id,benhvien_id) dtk        inner join TM_DUOC_PHAMVISD_MAPPING pvsd on dtk.KHODUOC_ID = pvsd.KHODUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NOITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) B on B.DUOC_ID = dtk.DUOC_ID and B.PHAMVI_ID = pvsd.PHAMVI_ID and B.NGUONHANG_ID = dtk.NGUONDUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NGOAITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) A on A.DUOC_ID = dtk.DUOC_ID and A.PHAMVI_ID = pvsd.PHAMVI_ID and A.NGUONHANG_ID = dtk.NGUONDUOC_ID        where dtk.BENHVIEN_ID = 'HLU01'        group by LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')), pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        ) tk on tk.DUOC_ID = d.DUOC_ID        left join TM_DUOC_PHAMVISUDUNG kd on kd.PHAMVI_ID = tk.PHAMVI_ID and kd.BENHVIEN_ID = 'HLU01'        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = tk.NGUONDUOC_ID and nh.BENHVIEN_ID = 'HLU01'        where d.BENHVIEN_ID = 'HLU01' and tk.PHAMVI_ID =  @param0         end        else        begin        select distinct tk.DUOC_KEY, tk.SOLUONG        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        inner join        (        select  LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')) DUOC_KEY, (SUM(dtk.SOLUONG) - isnull(sum(A.SOLUONG),0) - isnull(sum(B.SOLUONG),0)) SOLUONG, pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        from (select sum(soluong) soluong,duoc_id,nguonduoc_id,khoduoc_id,benhvien_id from TT_DUOC_TONKHO  group by duoc_id,nguonduoc_id,khoduoc_id,benhvien_id) dtk        inner join TM_DUOC_PHAMVISD_MAPPING pvsd on dtk.KHODUOC_ID = pvsd.KHODUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NOITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) B on B.DUOC_ID = dtk.DUOC_ID and B.PHAMVI_ID = pvsd.PHAMVI_ID and B.NGUONHANG_ID = dtk.NGUONDUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NGOAITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) A on A.DUOC_ID = dtk.DUOC_ID and A.PHAMVI_ID = pvsd.PHAMVI_ID and A.NGUONHANG_ID = dtk.NGUONDUOC_ID        where dtk.BENHVIEN_ID = 'HLU01'        group by LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')), pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        ) tk on tk.DUOC_ID = d.DUOC_ID        left join TM_DUOC_PHAMVISUDUNG kd on kd.PHAMVI_ID = tk.PHAMVI_ID and kd.BENHVIEN_ID = 'HLU01'        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = tk.NGUONDUOC_ID and nh.BENHVIEN_ID = 'HLU01'        where d.BENHVIEN_ID = 'HLU01' and tk.PHAMVI_ID =  @param0         end]
2020-01-02 18:01:35,706 [1] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoVaBookingCOM23UpdateRedis_TheoPhamvi] Parameters: [@param0=[PHAMVI_ID,1028]]
2020-01-02 18:01:35,706 [1] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoVaBookingCOM23UpdateRedis_TheoPhamvi] Types: [@param0=[Int64, System.Int64]]
2020-01-02 18:01:35,901 [1] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoVaBookingCOM23UpdateRedis_TheoPhamvi] PreparedStatement : [declare @TOAMUANGOAI int = 0;        select @TOAMUANGOAI = isnull(VALUE,0) from TM_SYS_APPSETTINGS where CODE = 'OPD_TOAMUANGOAI_DUNGDANHMUC_DUOC'                if @TOAMUANGOAI = 1        begin        select  distinct '0' + '_' + LTRIM(d.DUOC_ID) + '_' + '0' as DUOC_KEY, 999999999 as SOLUONG        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        where  @param0  = 0        union all        select distinct tk.DUOC_KEY, tk.SOLUONG        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        inner join        (        select  LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')) DUOC_KEY, (SUM(dtk.SOLUONG) - isnull(sum(A.SOLUONG),0) - isnull(sum(B.SOLUONG),0)) SOLUONG, pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        from (select sum(soluong) soluong,duoc_id,nguonduoc_id,khoduoc_id,benhvien_id from TT_DUOC_TONKHO  group by duoc_id,nguonduoc_id,khoduoc_id,benhvien_id) dtk        inner join TM_DUOC_PHAMVISD_MAPPING pvsd on dtk.KHODUOC_ID = pvsd.KHODUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NOITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) B on B.DUOC_ID = dtk.DUOC_ID and B.PHAMVI_ID = pvsd.PHAMVI_ID and B.NGUONHANG_ID = dtk.NGUONDUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NGOAITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) A on A.DUOC_ID = dtk.DUOC_ID and A.PHAMVI_ID = pvsd.PHAMVI_ID and A.NGUONHANG_ID = dtk.NGUONDUOC_ID        where dtk.BENHVIEN_ID = 'HLU01'        group by LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')), pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        ) tk on tk.DUOC_ID = d.DUOC_ID        left join TM_DUOC_PHAMVISUDUNG kd on kd.PHAMVI_ID = tk.PHAMVI_ID and kd.BENHVIEN_ID = 'HLU01'        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = tk.NGUONDUOC_ID and nh.BENHVIEN_ID = 'HLU01'        where d.BENHVIEN_ID = 'HLU01' and tk.PHAMVI_ID =  @param0         end        else        begin        select distinct tk.DUOC_KEY, tk.SOLUONG        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        inner join        (        select  LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')) DUOC_KEY, (SUM(dtk.SOLUONG) - isnull(sum(A.SOLUONG),0) - isnull(sum(B.SOLUONG),0)) SOLUONG, pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        from (select sum(soluong) soluong,duoc_id,nguonduoc_id,khoduoc_id,benhvien_id from TT_DUOC_TONKHO  group by duoc_id,nguonduoc_id,khoduoc_id,benhvien_id) dtk        inner join TM_DUOC_PHAMVISD_MAPPING pvsd on dtk.KHODUOC_ID = pvsd.KHODUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NOITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) B on B.DUOC_ID = dtk.DUOC_ID and B.PHAMVI_ID = pvsd.PHAMVI_ID and B.NGUONHANG_ID = dtk.NGUONDUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NGOAITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) A on A.DUOC_ID = dtk.DUOC_ID and A.PHAMVI_ID = pvsd.PHAMVI_ID and A.NGUONHANG_ID = dtk.NGUONDUOC_ID        where dtk.BENHVIEN_ID = 'HLU01'        group by LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')), pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        ) tk on tk.DUOC_ID = d.DUOC_ID        left join TM_DUOC_PHAMVISUDUNG kd on kd.PHAMVI_ID = tk.PHAMVI_ID and kd.BENHVIEN_ID = 'HLU01'        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = tk.NGUONDUOC_ID and nh.BENHVIEN_ID = 'HLU01'        where d.BENHVIEN_ID = 'HLU01' and tk.PHAMVI_ID =  @param0         end]
2020-01-02 18:01:35,901 [1] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoVaBookingCOM23UpdateRedis_TheoPhamvi] Parameters: [@param0=[PHAMVI_ID,1028]]
2020-01-02 18:01:35,901 [1] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoVaBookingCOM23UpdateRedis_TheoPhamvi] Types: [@param0=[Int64, System.Int64]]
2020-01-02 18:01:36,179 [1] DEBUG - Statement Id: [DAO00068_GetLastedSinhHieuInfo] PreparedStatement : [select top (1) *, CHISOBMI as BMI              from TT_NGOAITRU_KHAMBENH_SINHHIEU              where BENHNHAN_ID = '24442'              order by KHAMBENH_SINHHIEU_ID desc]
2020-01-02 18:01:45,874 [1] DEBUG - Statement Id: [DAO00014_GetPatientStatus] PreparedStatement : [select        CASE        when tn.TRANGTHAI = 'HOANTHANH' Then tn.TRANGTHAI        WHEN xncp.XACNHANCHIPHI_ID is not null THEN 'XACNHANCHIPHI'        WHEN (tn.KHOADULIEU = '1') THEN 'KHOADULIEU'        ELSE tn.TRANGTHAI        END        as TRANGTHAI        from TT_TIEPNHAN tn        left join TT_XACNHANCHIPHI xncp on tn.TIEPNHAN_ID = xncp.TIEPNHAN_ID        where tn.TIEPNHAN_ID = '28494'        and tn.BENHVIEN_ID = 'HLU01']
2020-01-02 18:01:45,948 [1] DEBUG - Statement Id: [DAO00014_GetThongtinKhamsuckhoeTheoDVyc] PreparedStatement : [select HOPDONG_ID, HOPDONG_BENHNHAN_ID from TT_DVYEUCAU where DVYEUCAU_ID =  @param0]
2020-01-02 18:01:45,948 [1] DEBUG - Statement Id: [DAO00014_GetThongtinKhamsuckhoeTheoDVyc] Parameters: [@param0=[DVYEUCAU_ID,206520]]
2020-01-02 18:01:45,948 [1] DEBUG - Statement Id: [DAO00014_GetThongtinKhamsuckhoeTheoDVyc] Types: [@param0=[Int64, System.Int64]]
2020-01-02 18:01:45,974 [1] DEBUG - Statement Id: [DAO00009_TT_TIEPNHAN_GetProcess] PreparedStatement : [select PROCESS_ID from TT_TIEPNHAN where SOTIEPNHAN = 'TN200102.0000002']
2020-01-02 18:01:46,013 [1] DEBUG - Statement Id: [DAOWF004_laytrangthaiDV] PreparedStatement : [select top 1 A.CURR_STATE_CODE as STATE_CODE, isNull(C.SHORT_NAME,C.NAME) as TRANGTHAI, C.NAME as TRANGTHAI_CHITIET, C.STATUS_CODE, D.ISACTIVE as ACTIVE, E.STATUS_CODE  as OLD_STATUSCODE        from TT_REQUEST_SERVICE_DETAIL A                left join (select * from TT_REQUEST_SERVICE where PARA = '{"DICHVU_ID":"5492","DVYEUCAU_ID":"206520"}') D on D.ID = A.REQUEST_SERVICE_ID        left join TM_STATE C on A.CURR_STATE_CODE = C.STATE_CODE and C.PROCESS_CODE = D.PROCESS_CODE        left join TM_STATE E on A.OLD_STATE_CODE = E.STATE_CODE and E.PROCESS_CODE = D.PROCESS_CODE        where        A.REQUEST_SERVICE_ID = (select top 1 ID from TT_REQUEST_SERVICE where PARA = '{"DICHVU_ID":"5492","DVYEUCAU_ID":"206520"}' order by ID desc)        order by A.ID desc]
2020-01-02 18:01:46,172 [1] DEBUG - Statement Id: [DAO00014_CheckExistNhapVien] PreparedStatement : [select NHAPVIEN_ID        from TT_NOITRU_NHAPVIEN        where TIEPNHAN_ID  = '28494'        and TRANGTHAI != 'CHOXACNHAN']
2020-01-02 18:01:46,198 [1] DEBUG - Statement Id: [DAO00014_CheckExistCapCuu] PreparedStatement : [select THONGTINCAPCUU_ID        from TT_TIEPNHAN_THONGTINCAPCUU        where TIEPNHAN_ID  = '28494' and BENHVIEN_ID = 'HLU01']
2020-01-02 18:01:46,223 [1] DEBUG - Statement Id: [DAO00014_CheckExistChuyenVien] PreparedStatement : [select CHUYENVIEN_ID        from TT_CHUYENVIEN        where TIEPNHAN_ID  = '28494']
2020-01-02 18:01:46,248 [1] DEBUG - Statement Id: [DAO00014_GetTrangThaiTiepNhan] PreparedStatement : [select tn.TIEPNHAN_ID, tn.KHOADULIEU, xncp.XACNHANCHIPHI_ID from TT_TIEPNHAN tn        left join TT_XACNHANCHIPHI xncp        on tn.TIEPNHAN_ID = xncp.TIEPNHAN_ID        where tn.TIEPNHAN_ID = '28494'        and tn.BENHVIEN_ID = 'HLU01']
2020-01-02 18:01:46,272 [1] DEBUG - Statement Id: [DAO00014_CheckExistsToaThuoc_ByTiepNhan_ID] PreparedStatement : [select count(KHAMBENH_TOATHUOC_ID)        from TT_NGOAITRU_KHAMBENH_TOATHUOC        where        TIEPNHAN_ID = '28494' and LOAITOATHUOC = 'BV']
2020-01-02 18:01:46,299 [1] DEBUG - Statement Id: [DAO00014_CheckBenhNhanChuaXSDVTYT] PreparedStatement : [IF EXISTS (        select vt.KHAMBENH_VTYT_ID        from TT_NGOAITRU_KHAMBENH_VTYT vt        inner join TT_NGOAITRU_KHAMBENH kb on kb.KHAMBENH_ID = vt.KHAMBENH_ID        where kb.TIEPNHAN_ID = 28494        and kb.BENHVIEN_ID = 'HLU01'        and vt.CHUNGTU_ID is null          union all          select vt.CLSKETQUA_VTYT_ID        from TT_CLSKETQUA_VTYT vt        inner join TT_DVYEUCAU yc on yc.DVYEUCAU_ID = vt.DVYEUCAU_ID and yc.BENHVIEN_ID = vt.BENHVIEN_ID        where yc.TIEPNHAN_ID = 28494        and yc.BENHVIEN_ID = 'HLU01'        and vt.CHUNGTU_ID is null        )        BEGIN        SELECT -1 AS RESULT        END        ELSE        BEGIN        SELECT 1 AS RESULT        END]
2020-01-02 18:01:46,327 [1] DEBUG - Statement Id: [DAO00014_GetListToaThuoc] PreparedStatement : [select A.*        from TT_NGOAITRU_KHAMBENH_TOATHUOC A        where A.KHAMBENH_ID = '27177']
2020-01-02 18:01:46,360 [1] DEBUG - Statement Id: [DAOLOG01_LockBegin] PreparedStatement : [INSERT into TT_LOG_UPDATE ( REF_TABLE , REF_ID , BENHVIEN_ID )         values ( @param0 ,  @param1 ,  @param2 );]
2020-01-02 18:01:46,360 [1] DEBUG - Statement Id: [DAOLOG01_LockBegin] Parameters: [@param0=[REF_TABLE,TT_NGOAITRU_KHAMBENH], @param1=[REF_ID,28494], @param2=[BENHVIEN_ID,HLU01]]
2020-01-02 18:01:46,360 [1] DEBUG - Statement Id: [DAOLOG01_LockBegin] Types: [@param0=[String, System.String], @param1=[Int64, System.Int64], @param2=[String, System.String]]
2020-01-02 18:01:46,386 [1] DEBUG - Statement Id: [DAO00014_GetTTNhapVien] PreparedStatement : [select *        from TT_NOITRU_NHAPVIEN        where TIEPNHAN_ID  = '28494']
2020-01-02 18:01:46,436 [1] DEBUG - Statement Id: [DAO00014_GetTTDVYeucauOPD] PreparedStatement : [select A.KHAMBENH_NGOAITRU_ID, B.KHAMBENH_ID        from TT_DVYEUCAU A        left join TT_NGOAITRU_KHAMBENH B on A.KHAMBENH_NGOAITRU_ID = B.KHAMBENH_ID        where A.DVYEUCAU_ID = '206520' and A.TIEPNHAN_ID =  @param0]
2020-01-02 18:01:46,436 [1] DEBUG - Statement Id: [DAO00014_GetTTDVYeucauOPD] Parameters: [@param0=[TIEPNHAN_ID,28494]]
2020-01-02 18:01:46,436 [1] DEBUG - Statement Id: [DAO00014_GetTTDVYeucauOPD] Types: [@param0=[String, System.String]]
2020-01-02 18:01:46,462 [1] DEBUG - Statement Id: [DAO00014_Update] PreparedStatement : [update TT_NGOAITRU_KHAMBENH set        BENHNHAN_ID =  @param0         , DICHVU_ID =  @param1                 , NGAYKHAM =  @param2         , CHANDOANICD_ID =  @param3         , HUONGGIAIQUYET_ID =  @param4                 , YEUCAUCHITIET_ID =  @param5         , CHANDOANKHOAKHAM =  @param6         , SONGAYHENTAIKHAM =  @param7         , NHANAP_MT =  @param8         , NHANAP_MP =  @param9         , CHANDOANPHUICD_ID =  @param10         , TRIEUCHUNGLAMSANG =  @param11         , HUYETAPTHAP =  @param12         , HUYETAPCAO =  @param13         , BENHMANTINH_ID =  @param14         , NHAPKHOA_ID =  @param15         , CHANDOANSOBOICD_ID =  @param16         , CHANDOANSOBO =  @param17         , CHUYENDENBENHVIEN_ID =  @param18         , LYDONHAPVIEN_ID =  @param19         , NGHIOM_TUNGAY =  @param20         , NGHIOM_DENNGAY =  @param21         , TLDG_MT_TEXT =  @param22         , TLDG_MP_TEXT =  @param23         , TKLT_MP_TEXT =  @param24         , TKLT_MT_TEXT =  @param25         , SIEUHIENVI =  @param26         , SOIDAYMAT =  @param27         , MACH =  @param28         , CANNANG =  @param29         , CHIEUCAO =  @param30         , BMI =  @param31         , NHIPTHO =  @param32         , NHIETDO =  @param33         , GHICHU =  @param34         , KHOADULIEU =  @param35         , NGUOIKHOA_ID =  @param36         , NGAYKHOA =  @param37         , THOIGIANKHOA =  @param38         , NGAYCAPNHAT =  @param39         , NGUOICAPNHAT_ID =  @param40         , KHAMBENH_SINHHIEU_ID =  @param41         where        KHAMBENH_ID =  @param42]
2020-01-02 18:01:46,462 [1] DEBUG - Statement Id: [DAO00014_Update] Parameters: [@param0=[BENHNHAN_ID,24442], @param1=[DICHVU_ID,5492], @param2=[NGAYKHAM,1/2/2020 12:00:00 AM], @param3=[CHANDOANICD_ID,3990], @param4=[HUONGGIAIQUYET_ID,458], @param5=[YEUCAUCHITIET_ID,null], @param6=[CHANDOANKHOAKHAM,Viêm phế quản cấp(J20)], @param7=[SONGAYHENTAIKHAM,null], @param8=[NHANAP_MT,null], @param9=[NHANAP_MP,null], @param10=[CHANDOANPHUICD_ID,null], @param11=[TRIEUCHUNGLAMSANG,test 2], @param12=[HUYETAPTHAP,null], @param13=[HUYETAPCAO,null], @param14=[BENHMANTINH_ID,null], @param15=[NHAPKHOA_ID,null], @param16=[CHANDOANSOBOICD_ID,null], @param17=[CHANDOANSOBO,], @param18=[CHUYENDENBENHVIEN_ID,7179], @param19=[LYDONHAPVIEN_ID,null], @param20=[NGHIOM_TUNGAY,null], @param21=[NGHIOM_DENNGAY,null], @param22=[TLDG_MT_TEXT,], @param23=[TLDG_MP_TEXT,], @param24=[TKLT_MP_TEXT,], @param25=[TKLT_MT_TEXT,], @param26=[SIEUHIENVI,], @param27=[SOIDAYMAT,], @param28=[MACH,null], @param29=[CANNANG,null], @param30=[CHIEUCAO,null], @param31=[BMI,null], @param32=[NHIPTHO,null], @param33=[NHIETDO,null], @param34=[GHICHU,], @param35=[KHOADULIEU,0], @param36=[NGUOIKHOA_ID,null], @param37=[NGAYKHOA,null], @param38=[THOIGIANKHOA,null], @param39=[NGAYCAPNHAT,1/2/2020 6:01:46 PM], @param40=[NGUOICAPNHAT_ID,1], @param41=[KHAMBENH_SINHHIEU_ID,0], @param42=[KHAMBENH_ID,27177]]
2020-01-02 18:01:46,462 [1] DEBUG - Statement Id: [DAO00014_Update] Types: [@param0=[Int64, System.Int64], @param1=[Int64, System.Int64], @param2=[DateTime, System.DateTime], @param3=[String, System.String], @param4=[String, System.String], @param5=[System.DBNull, null], @param6=[String, System.String], @param7=[System.DBNull, null], @param8=[System.DBNull, null], @param9=[System.DBNull, null], @param10=[System.DBNull, null], @param11=[String, System.String], @param12=[System.DBNull, null], @param13=[System.DBNull, null], @param14=[System.DBNull, null], @param15=[System.DBNull, null], @param16=[System.DBNull, null], @param17=[String, System.String], @param18=[Int64, System.Int64], @param19=[System.DBNull, null], @param20=[System.DBNull, null], @param21=[System.DBNull, null], @param22=[String, System.String], @param23=[String, System.String], @param24=[String, System.String], @param25=[String, System.String], @param26=[String, System.String], @param27=[String, System.String], @param28=[System.DBNull, null], @param29=[System.DBNull, null], @param30=[System.DBNull, null], @param31=[System.DBNull, null], @param32=[System.DBNull, null], @param33=[System.DBNull, null], @param34=[String, System.String], @param35=[String, System.String], @param36=[System.DBNull, null], @param37=[System.DBNull, null], @param38=[System.DBNull, null], @param39=[DateTime, System.DateTime], @param40=[Int64, System.Int64], @param41=[Int64, System.Int64], @param42=[Int64, System.Int64]]
2020-01-02 18:01:46,507 [1] DEBUG - Statement Id: [DAO00014_CheckExistHenTaiKHam] PreparedStatement : [select KHAMBENH_HENTAIKHAM        from TT_NGOAITRU_KHAMBENH_HENTK        where KHAMBENH_ID  = '27177']
2020-01-02 18:01:46,531 [1] DEBUG - Statement Id: [DAO00020_UpdateKhamBenhIDInDVYC] PreparedStatement : [update TT_DVYEUCAU        set KHAMBENH_NGOAITRU_ID =  @param0                 , TRANGTHAI =  @param1         , NGUOICAPNHAT_ID =  @param2         , NGAYCAPNHAT =  @param3         where TIEPNHAN_ID = 28494        and DVYEUCAU_ID = 206520                update TT_VIENPHI        set DATHUCHIEN =  @param4         , NGUOICAPNHAT_ID =  @param2         , NGAYCAPNHAT =  @param3         where REF_ID = 206520        and REF_TABLE = 'TT_DVYEUCAU']
2020-01-02 18:01:46,531 [1] DEBUG - Statement Id: [DAO00020_UpdateKhamBenhIDInDVYC] Parameters: [@param0=[KHAMBENH_ID,27177], @param1=[TRANGTHAI,DACHUYENTUYEN], @param2=[NGUOICAPNHAT_ID,1], @param3=[NGAYCAPNHAT,1/2/2020 6:01:46 PM], @param4=[DATHUCHIEN,1]]
2020-01-02 18:01:46,531 [1] DEBUG - Statement Id: [DAO00020_UpdateKhamBenhIDInDVYC] Types: [@param0=[Int32, System.Int32], @param1=[String, System.String], @param2=[Int64, System.Int64], @param3=[DateTime, System.DateTime], @param4=[Int32, System.Int32]]
2020-01-02 18:01:46,571 [1] DEBUG - Statement Id: [DAO00023_GetSOBHYT_HUONG_ID] PreparedStatement : [select isnull(MAX(SOBHYT_HUONG_ID),0) SOBHYT_HUONG_ID        from TT_TIEPNHAN_SOTHEBHYT        where TIEPNHAN_ID = '28494']
2020-01-02 18:01:46,596 [1] DEBUG - Statement Id: [DAO00062_GetAllPhamviKhoDuoc] PreparedStatement : [select distinct dmap.*        from TM_DUOC_PHAMVISD_MAPPING dmap        left join TM_DUOC_PHAMVISUDUNG dpv on dpv.PHAMVI_ID = dmap.PHAMVI_ID]
2020-01-02 18:01:46,621 [1] DEBUG - Statement Id: [DAO00062_GetKhoDuocNhaThuoc] PreparedStatement : [select * from TM_KHODUOC where MAKHO = 'KHO_NT']
2020-01-02 18:01:46,646 [1] DEBUG - Statement Id: [DAO00049_KiemtraloaiDV] PreparedStatement : [select DICHVU_ID AS HA, '' AS XN, '' as TDCN, '' as TT, '' as KB from TM_DICHVU            left join TM_NHOMDICHVU ndv on ndv.NHOMDICHVU_ID = TM_DICHVU.NHOMDICHVU_ID            where DICHVU_ID = '5492' and left(ndv.MANHOMDICHVU, 2) = '02'            union            select  '' as HA, DICHVU_ID AS XN, '' as TDCN, '' as TT, '' as KB from TM_DICHVU            left join TM_NHOMDICHVU ndv on ndv.NHOMDICHVU_ID = TM_DICHVU.NHOMDICHVU_ID            where DICHVU_ID = '5492' and left(ndv.MANHOMDICHVU, 2) = '01'            union            select  '' as HA, '' AS XN, DICHVU_ID as TDCN, '' as TT, '' as KB from TM_DICHVU            left join TM_NHOMDICHVU ndv on ndv.NHOMDICHVU_ID = TM_DICHVU.NHOMDICHVU_ID            where DICHVU_ID = '5492' and left(ndv.MANHOMDICHVU, 2) = '03'            union            select  '' as HA, '' AS XN, '' as TDCN, DICHVU_ID as TT, '' as KB from TM_DICHVU            left join TM_NHOMDICHVU ndv on ndv.NHOMDICHVU_ID = TM_DICHVU.NHOMDICHVU_ID            where DICHVU_ID = '5492' and left(ndv.MANHOMDICHVU, 2) = '05'            union            select  '' as HA, '' AS XN, '' as TDCN, DICHVU_ID as TT, '' as KB from TM_DICHVU            left join TM_NHOMDICHVU ndv on ndv.NHOMDICHVU_ID = TM_DICHVU.NHOMDICHVU_ID            where DICHVU_ID = '5492' and left(ndv.MANHOMDICHVU, 2) = '06'            union            select  '' as HA, '' AS XN, '' as TDCN, '' as TT, DICHVU_ID as KB from TM_DICHVU            left join TM_NHOMDICHVU ndv on ndv.NHOMDICHVU_ID = TM_DICHVU.NHOMDICHVU_ID            where DICHVU_ID = '5492' and left(ndv.MANHOMDICHVU, 2) = '04']
2020-01-02 18:01:46,672 [1] DEBUG - Statement Id: [DAO00009_GetThutiensauDVThuthuatKhamBenh] PreparedStatement : [select A.THUTIENSAU, B.SOTIEPNHAN, A.DICHVU_ID, A.DVYEUCAU_ID        from TT_DVYEUCAU A        inner join TT_TIEPNHAN B on B.TIEPNHAN_ID = A.TIEPNHAN_ID        left join TT_NGOAITRU_KHAMBENH C on A.TIEPNHAN_ID = C.TIEPNHAN_ID and A.DICHVU_ID = C.DICHVU_ID        where        C.KHAMBENH_ID = '27177']
2020-01-02 18:01:46,696 [1] DEBUG - Statement Id: [DAO00009_TT_TIEPNHAN_GetProcess] PreparedStatement : [select PROCESS_ID from TT_TIEPNHAN where SOTIEPNHAN = 'TN200102.0000002']
2020-01-02 18:01:46,732 [1] DEBUG - Statement Id: [DAOWF001_Kiemtrathongtindayeucaureturn] PreparedStatement : [select * from TT_REQUEST        where        PARA = '{"HOSPITAL_ID":"HLU01","SOTIEPNHAN":"TN200102.0000002"}']
2020-01-02 18:01:46,778 [1] DEBUG - Statement Id: [DAOWF001_Kiemtrathongtindichvudayeucaureturn] PreparedStatement : [select top 1 * from TT_REQUEST_SERVICE        where        PARA = '{"DICHVU_ID":"5492","DVYEUCAU_ID":"206520"}'  order by ID desc]
2020-01-02 18:01:46,803 [1] DEBUG - Statement Id: [DAOWF005_ReturnStateCuaDichVuYeuCau] PreparedStatement : [declare        @Detail_Id int,        @CurentState char(8),        @OldState char(8)          select top 1 @Detail_Id = ID, @CurentState = OLD_STATE_CODE, @OldState = CURR_STATE_CODE from TT_REQUEST_SERVICE_DETAIL        where        REQUEST_ID = '32794'        AND REQUEST_SERVICE_ID = '148396'        order by ID desc;          update TT_REQUEST_SERVICE set CURR_STATE_CODE = @CurentState, ISACTIVE = 1, ISCOMPLETE = 0 where ID = '148396';        delete from TT_REQUEST_SERVICE_DETAIL where ID = @Detail_Id;        insert into TT_REQUEST_SERVICE_HISTORY        (REQUEST_ID,REQUEST_SERVICE_ID, OLD_STATE_CODE, CURR_STATE_CODE) values ('32794','148396',@OldState, @CurentState);        select top 1 A.*, B.STATUS_CODE from TT_REQUEST_SERVICE A        left join TM_STATE B on A.CURR_STATE_CODE = B.STATE_CODE and A.PROCESS_CODE = B.PROCESS_CODE        where A.ID = '148396';]
2020-01-02 18:01:46,851 [1] DEBUG - Statement Id: [DAO00009_TT_DVYEUCAU_Update] PreparedStatement : [Update TT_DVYEUCAU set TRANGTHAI_WFL = 'CHUAKETQUA' where DVYEUCAU_ID = '206520']
2020-01-02 18:01:46,876 [1] DEBUG - Statement Id: [DAO00049_KiemtraloaiDV] PreparedStatement : [select DICHVU_ID AS HA, '' AS XN, '' as TDCN, '' as TT, '' as KB from TM_DICHVU            left join TM_NHOMDICHVU ndv on ndv.NHOMDICHVU_ID = TM_DICHVU.NHOMDICHVU_ID            where DICHVU_ID = '5492' and left(ndv.MANHOMDICHVU, 2) = '02'            union            select  '' as HA, DICHVU_ID AS XN, '' as TDCN, '' as TT, '' as KB from TM_DICHVU            left join TM_NHOMDICHVU ndv on ndv.NHOMDICHVU_ID = TM_DICHVU.NHOMDICHVU_ID            where DICHVU_ID = '5492' and left(ndv.MANHOMDICHVU, 2) = '01'            union            select  '' as HA, '' AS XN, DICHVU_ID as TDCN, '' as TT, '' as KB from TM_DICHVU            left join TM_NHOMDICHVU ndv on ndv.NHOMDICHVU_ID = TM_DICHVU.NHOMDICHVU_ID            where DICHVU_ID = '5492' and left(ndv.MANHOMDICHVU, 2) = '03'            union            select  '' as HA, '' AS XN, '' as TDCN, DICHVU_ID as TT, '' as KB from TM_DICHVU            left join TM_NHOMDICHVU ndv on ndv.NHOMDICHVU_ID = TM_DICHVU.NHOMDICHVU_ID            where DICHVU_ID = '5492' and left(ndv.MANHOMDICHVU, 2) = '05'            union            select  '' as HA, '' AS XN, '' as TDCN, DICHVU_ID as TT, '' as KB from TM_DICHVU            left join TM_NHOMDICHVU ndv on ndv.NHOMDICHVU_ID = TM_DICHVU.NHOMDICHVU_ID            where DICHVU_ID = '5492' and left(ndv.MANHOMDICHVU, 2) = '06'            union            select  '' as HA, '' AS XN, '' as TDCN, '' as TT, DICHVU_ID as KB from TM_DICHVU            left join TM_NHOMDICHVU ndv on ndv.NHOMDICHVU_ID = TM_DICHVU.NHOMDICHVU_ID            where DICHVU_ID = '5492' and left(ndv.MANHOMDICHVU, 2) = '04']
2020-01-02 18:01:46,901 [1] DEBUG - Statement Id: [DAO00009_GetThutiensauDVThuthuat] PreparedStatement : [select A.THUTIENSAU, B.SOTIEPNHAN, A.DICHVU_ID, A.DVYEUCAU_ID        from TT_DVYEUCAU A        inner join TT_TIEPNHAN B on B.TIEPNHAN_ID = A.TIEPNHAN_ID        where        A.DVYEUCAU_ID = '206520']
2020-01-02 18:01:46,925 [1] DEBUG - Statement Id: [DAO00009_TT_TIEPNHAN_GetProcess] PreparedStatement : [select PROCESS_ID from TT_TIEPNHAN where SOTIEPNHAN = 'TN200102.0000002']
2020-01-02 18:01:46,961 [1] DEBUG - Statement Id: [DAOWF001_Kiemtrathongtindayeucaudacochua] PreparedStatement : [select * from TT_REQUEST        where        PARA = '{"HOSPITAL_ID":"HLU01","SOTIEPNHAN":"TN200102.0000002"}'        AND ISACTIVE = '1']
2020-01-02 18:01:47,006 [1] DEBUG - Statement Id: [DAOWF001_Kiemtrathongtindichvudayeucau] PreparedStatement : [select top 1 * from TT_REQUEST_SERVICE        where        PARA = '{"DICHVU_ID":"5492","DVYEUCAU_ID":"206520"}'                AND ISACTIVE = '1' order by ID desc]
2020-01-02 18:01:47,030 [1] DEBUG - Statement Id: [DAOWF001_KiemtrathongtinchitietDichvuYeucau] PreparedStatement : [select * from TT_REQUEST_SERVICE_DETAIL        where        REQUEST_SERVICE_ID = '148396']
2020-01-02 18:01:47,088 [1] DEBUG - Statement Id: [DAOWF001_Laythongtinwithstatecode] PreparedStatement : [select A.*, B.STATUS_CODE from        TM_STATE_ACTION A        left join TM_STATE B on B.STATE_CODE = A.NEXT_STATE_CODE and A.PROCESS_CODE = B.PROCESS_CODE        where        A.CURR_STATE_CODE = '0     '        AND A.PROCESS_CODE = 'P02'        Order By ORDER_ID ASC]
2020-01-02 18:01:47,115 [1] DEBUG - Statement Id: [DAOWF003_Update] PreparedStatement : [update TT_REQUEST_SERVICE set        CURR_STATE_CODE =  @param0                   , ISACTIVE =  @param1                     , ISCOMPLETE =  @param2                        where        ID = '148396']
2020-01-02 18:01:47,115 [1] DEBUG - Statement Id: [DAOWF003_Update] Parameters: [@param0=[CURR_STATE_CODE,8], @param1=[ISACTIVE,1], @param2=[ISCOMPLETE,0]]
2020-01-02 18:01:47,115 [1] DEBUG - Statement Id: [DAOWF003_Update] Types: [@param0=[String, System.String], @param1=[String, System.String], @param2=[String, System.String]]
2020-01-02 18:01:47,140 [1] DEBUG - Statement Id: [DAOWF005_Add] PreparedStatement : [insert into TT_REQUEST_SERVICE_DETAIL (        REQUEST_ID        ,REQUEST_SERVICE_ID        , OLD_STATE_CODE        , CURR_STATE_CODE        ) values (         @param0         , @param1         ,  @param2         ,  @param3         )        SELECT SCOPE_IDENTITY()]
2020-01-02 18:01:47,140 [1] DEBUG - Statement Id: [DAOWF005_Add] Parameters: [@param0=[REQUEST_ID,32794], @param1=[REQUEST_SERVICE_ID,148396], @param2=[OLD_STATE_CODE,0     ], @param3=[CURR_STATE_CODE,8]]
2020-01-02 18:01:47,140 [1] DEBUG - Statement Id: [DAOWF005_Add] Types: [@param0=[String, System.String], @param1=[Int32, System.Int32], @param2=[String, System.String], @param3=[String, System.String]]
2020-01-02 18:01:47,165 [1] DEBUG - Statement Id: [DAOWF005_Add_History] PreparedStatement : [insert into TT_REQUEST_SERVICE_HISTORY (        REQUEST_ID        ,REQUEST_SERVICE_ID        , OLD_STATE_CODE        , CURR_STATE_CODE        ) values (         @param0         , @param1         ,  @param2         ,  @param3         )]
2020-01-02 18:01:47,165 [1] DEBUG - Statement Id: [DAOWF005_Add_History] Parameters: [@param0=[REQUEST_ID,32794], @param1=[REQUEST_SERVICE_ID,148396], @param2=[OLD_STATE_CODE,0     ], @param3=[CURR_STATE_CODE,8]]
2020-01-02 18:01:47,165 [1] DEBUG - Statement Id: [DAOWF005_Add_History] Types: [@param0=[String, System.String], @param1=[Int32, System.Int32], @param2=[String, System.String], @param3=[String, System.String]]
2020-01-02 18:01:47,191 [1] DEBUG - Statement Id: [DAO00009_TT_DVYEUCAU_Update] PreparedStatement : [Update TT_DVYEUCAU set TRANGTHAI_WFL = 'HOANTAT' where DVYEUCAU_ID = '206520']
2020-01-02 18:01:47,215 [1] DEBUG - Statement Id: [DAO00026_GetListDanhSachDichVuGhiNhanVTYT_COM25_WithTN] PreparedStatement : [select distinct CONVERT(VARCHAR(11),C.NGAYYEUCAU,103) as NGAYYEUCAU, C.DICHVU_ID, C.DVYEUCAU_ID, D.TENDICHVU, C.NOITHUCHIEN_ID, A.SOTIEPNHAN, A.TRAITUYEN, A.NGAYMIENDONGCHITRA, A.TIEPNHAN_ID, A.DOITUONG_ID, A.TRANGTHAI,            A.LOAITHANHVIEN_ID, A.SUDUNG_BHTN, A.THE_ID, A.THANHVIEN_ID, A.VIP, A.NGUON_BENHNHAN_ID, A.BAOLANH_VIENPHI,            CASE WHEN (A.TRANGTHAI = 'NOITRU' OR A.TRANGTHAI = 'CAPCUU') THEN 'IN' ELSE 'OUT' END AS LOAIBENHAN,            CASE WHEN (C.TRANGTHAI = 'CHUAKETQUA') THEN 'CHUAKETQUA' ELSE 'HOANTAT' END AS TRANGTHAIDICHVU,            B.*, isnull(ntba.SOBENHAN, '') SOBENHAN, isnull(ntba.BENHAN_ID, 0) BENHAN_ID,            CASE WHEN Left(E.MANHOMDICHVU,2) = '03' THEN '02' ELSE Left(E.MANHOMDICHVU,2) END AS MANHOMDICHVU            from TT_TIEPNHAN A            inner join TT_BENHNHAN B on B.BENHNHAN_ID = A.BENHNHAN_ID and B.ACTIVE = '1'            inner join TT_DVYEUCAU C on C.TIEPNHAN_ID = A.TIEPNHAN_ID                        left join TM_DICHVU D on D.DICHVU_ID = C.DICHVU_ID            left join TM_NHOMDICHVU E on E.NHOMDICHVU_ID = D.NHOMDICHVU_ID            left join TT_NOITRU_BENHAN ntba on ntba.BENHAN_ID = C.BENHAN_ID              where            C.NGAYHENCLS is NULL and A.BENHVIEN_ID = 'HLU01'            and (A.TRANGTHAI = 'DATIEPNHAN' or A.TRANGTHAI = 'NOITRU' or A.TRANGTHAI = 'CAPCUU' or A.TRANGTHAI = 'NGOAITRU')            and (CASE WHEN Left(E.MANHOMDICHVU,2) = '03' THEN '02' ELSE Left(E.MANHOMDICHVU,2) END in ('02', '04'))            and A.TIEPNHAN_ID = '28494']
2020-01-02 18:01:47,280 [1] DEBUG - Statement Id: [DAOLOG01_LockEnd] PreparedStatement : [DELETE TT_LOG_UPDATE        where REF_TABLE = 'TT_NGOAITRU_KHAMBENH' and REF_ID = '28494' and BENHVIEN_ID = 'HLU01']
2020-01-02 18:01:47,307 [1] DEBUG - Statement Id: [DAO00014_Clear_1ToaThuocKhambenh] PreparedStatement : [DELETE FROM TT_DUOC_TONKHO_BOOK_NGOAITRU where REF_TABLE = 'TT_NGOAITRU_TOATHUOC'        and REF_ID in (        select TOATHUOC_ID from TT_NGOAITRU_TOATHUOC        where             KHAMBENH_TOATHUOC_ID in (select KHAMBENH_TOATHUOC_ID from TT_NGOAITRU_KHAMBENH_TOATHUOC        where TIEPNHAN_ID = '28494' and                   KHAMBENH_ID not in (select KHAMBENH_ID from TT_NGOAITRU_KHAMBENH where  TIEPNHAN_ID = '28494'))        and TIEPNHAN_ID = '28494')          DELETE FROM TT_VIENPHI where REF_TABLE = 'TT_NGOAITRU_TOATHUOC'        and REF_ID in (        select TOATHUOC_ID from TT_NGOAITRU_TOATHUOC        where KHAMBENH_TOATHUOC_ID in (select KHAMBENH_TOATHUOC_ID from TT_NGOAITRU_KHAMBENH_TOATHUOC        where TIEPNHAN_ID = '28494' and KHAMBENH_ID not in (select KHAMBENH_ID from TT_NGOAITRU_KHAMBENH where TIEPNHAN_ID = '28494'))        and TIEPNHAN_ID = '28494')          delete from TT_NGOAITRU_TOATHUOC        where KHAMBENH_TOATHUOC_ID in (select KHAMBENH_TOATHUOC_ID from TT_NGOAITRU_KHAMBENH_TOATHUOC        where TIEPNHAN_ID = '28494' and KHAMBENH_ID not in (select KHAMBENH_ID from TT_NGOAITRU_KHAMBENH where TIEPNHAN_ID = '28494')        and TIEPNHAN_ID = '28494')          delete from TT_NGOAITRU_KHAMBENH_TOATHUOC where TIEPNHAN_ID = '28494'        and KHAMBENH_ID not in (select KHAMBENH_ID from TT_NGOAITRU_KHAMBENH where TIEPNHAN_ID = '28494') and TIEPNHAN_ID = '28494']
2020-01-02 18:01:47,345 [1] DEBUG - Statement Id: [DAO00014_GetKhamBenhInfo] PreparedStatement : [select * from TT_NGOAITRU_KHAMBENH where KHAMBENH_ID =        (select KHAMBENH_NGOAITRU_ID from TT_DVYEUCAU where DVYEUCAU_ID = '206520')]
2020-01-02 18:01:47,370 [1] DEBUG - Statement Id: [DAO00068_GetSinhHieuBySinhHieuID] PreparedStatement : [select top (1) *            from TT_NGOAITRU_KHAMBENH_SINHHIEU            where KHAMBENH_SINHHIEU_ID = '0'            and BENHVIEN_ID = 'HLU01'             and               BENHNHAN_ID = '24442'                           order by KHAMBENH_SINHHIEU_ID]
2020-01-02 18:01:47,396 [1] DEBUG - Statement Id: [DAO00014_GetKhamBenhICDInfo] PreparedStatement : [select *        from TT_NGOAITRU_KHAMBENH_ICD        where KHAMBENH_ID  = '27177']
2020-01-02 18:01:47,421 [1] DEBUG - Statement Id: [DAO00014_GetListToaThuoc] PreparedStatement : [select A.*        from TT_NGOAITRU_KHAMBENH_TOATHUOC A        where A.KHAMBENH_ID = '27177']
2020-01-02 18:01:47,452 [1] DEBUG - Statement Id: [DAO00014_KiemTraDVYCCoGiaBHYT] PreparedStatement : [select *        from TT_VIENPHI        where REF_ID  = '206520' and REF_TABLE = 'TT_DVYEUCAU' and BHYT_DONGIA > 0]
2020-01-02 18:01:47,491 [1] DEBUG - Statement Id: [DAO00040_LayListToaMau] PreparedStatement : [select A.*, dc.TENDUOCDAYDU, dc.BHYT DUOC_BHYT, ld.LOAIVATTU_ID, ld.MALOAIDUOC, dd.DICTIONARY_NAME DUONGDUNG, dc.TAMNGUNG            from TT_TOATHUOCMAU A            left join TM_DUOC dc on A.DUOC_ID = dc.DUOC_ID            left join TM_LOAIDUOC ld on dc.LOAIDUOC_ID = ld.LOAIDUOC_ID            left join (select * from LST_DICTIONARY where DICTIONARY_TYPE_CODE like 'DuongDung') dd on dd.DICTIONARY_ID = dc.DUONGDUNG_ID            where (1=1)             and               A.BACSI_ID  = 1              and A.LOAITOATHUOC in  (                        @param0                   ,                           @param1                   ,                           @param2                   ,                           @param3                   )]
2020-01-02 18:01:47,491 [1] DEBUG - Statement Id: [DAO00040_LayListToaMau] Parameters: [@param0=[LSTLOAITOATHUOC[0],BV], @param1=[LSTLOAITOATHUOC[1],MN], @param2=[LSTLOAITOATHUOC[2],MP], @param3=[LSTLOAITOATHUOC[3],TV]]
2020-01-02 18:01:47,491 [1] DEBUG - Statement Id: [DAO00040_LayListToaMau] Types: [@param0=[String, System.String], @param1=[String, System.String], @param2=[String, System.String], @param3=[String, System.String]]
2020-01-02 18:01:47,591 [1] DEBUG - Statement Id: [DAO00040_LayListToaMau] PreparedStatement : [select A.*, dc.TENDUOCDAYDU, dc.BHYT DUOC_BHYT, ld.LOAIVATTU_ID, ld.MALOAIDUOC, dd.DICTIONARY_NAME DUONGDUNG, dc.TAMNGUNG            from TT_TOATHUOCMAU A            left join TM_DUOC dc on A.DUOC_ID = dc.DUOC_ID            left join TM_LOAIDUOC ld on dc.LOAIDUOC_ID = ld.LOAIDUOC_ID            left join (select * from LST_DICTIONARY where DICTIONARY_TYPE_CODE like 'DuongDung') dd on dd.DICTIONARY_ID = dc.DUONGDUNG_ID            where (1=1)             and               A.BACSI_ID  = 1              and A.LOAITOATHUOC in  (                        @param0                   ,                           @param1                   ,                           @param2                   ,                           @param3                   )]
2020-01-02 18:01:47,591 [1] DEBUG - Statement Id: [DAO00040_LayListToaMau] Parameters: [@param0=[LSTLOAITOATHUOC[0],BV], @param1=[LSTLOAITOATHUOC[1],MN], @param2=[LSTLOAITOATHUOC[2],MP], @param3=[LSTLOAITOATHUOC[3],TV]]
2020-01-02 18:01:47,591 [1] DEBUG - Statement Id: [DAO00040_LayListToaMau] Types: [@param0=[String, System.String], @param1=[String, System.String], @param2=[String, System.String], @param3=[String, System.String]]
2020-01-02 18:01:47,677 [1] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoVaBookingCOM23UpdateRedis_TheoPhamvi] PreparedStatement : [declare @TOAMUANGOAI int = 0;        select @TOAMUANGOAI = isnull(VALUE,0) from TM_SYS_APPSETTINGS where CODE = 'OPD_TOAMUANGOAI_DUNGDANHMUC_DUOC'                if @TOAMUANGOAI = 1        begin        select  distinct '0' + '_' + LTRIM(d.DUOC_ID) + '_' + '0' as DUOC_KEY, 999999999 as SOLUONG        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        where  @param0  = 0        union all        select distinct tk.DUOC_KEY, tk.SOLUONG        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        inner join        (        select  LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')) DUOC_KEY, (SUM(dtk.SOLUONG) - isnull(sum(A.SOLUONG),0) - isnull(sum(B.SOLUONG),0)) SOLUONG, pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        from (select sum(soluong) soluong,duoc_id,nguonduoc_id,khoduoc_id,benhvien_id from TT_DUOC_TONKHO  group by duoc_id,nguonduoc_id,khoduoc_id,benhvien_id) dtk        inner join TM_DUOC_PHAMVISD_MAPPING pvsd on dtk.KHODUOC_ID = pvsd.KHODUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NOITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) B on B.DUOC_ID = dtk.DUOC_ID and B.PHAMVI_ID = pvsd.PHAMVI_ID and B.NGUONHANG_ID = dtk.NGUONDUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NGOAITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) A on A.DUOC_ID = dtk.DUOC_ID and A.PHAMVI_ID = pvsd.PHAMVI_ID and A.NGUONHANG_ID = dtk.NGUONDUOC_ID        where dtk.BENHVIEN_ID = 'HLU01'        group by LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')), pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        ) tk on tk.DUOC_ID = d.DUOC_ID        left join TM_DUOC_PHAMVISUDUNG kd on kd.PHAMVI_ID = tk.PHAMVI_ID and kd.BENHVIEN_ID = 'HLU01'        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = tk.NGUONDUOC_ID and nh.BENHVIEN_ID = 'HLU01'        where d.BENHVIEN_ID = 'HLU01' and tk.PHAMVI_ID =  @param0         end        else        begin        select distinct tk.DUOC_KEY, tk.SOLUONG        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        inner join        (        select  LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')) DUOC_KEY, (SUM(dtk.SOLUONG) - isnull(sum(A.SOLUONG),0) - isnull(sum(B.SOLUONG),0)) SOLUONG, pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        from (select sum(soluong) soluong,duoc_id,nguonduoc_id,khoduoc_id,benhvien_id from TT_DUOC_TONKHO  group by duoc_id,nguonduoc_id,khoduoc_id,benhvien_id) dtk        inner join TM_DUOC_PHAMVISD_MAPPING pvsd on dtk.KHODUOC_ID = pvsd.KHODUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NOITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) B on B.DUOC_ID = dtk.DUOC_ID and B.PHAMVI_ID = pvsd.PHAMVI_ID and B.NGUONHANG_ID = dtk.NGUONDUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NGOAITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) A on A.DUOC_ID = dtk.DUOC_ID and A.PHAMVI_ID = pvsd.PHAMVI_ID and A.NGUONHANG_ID = dtk.NGUONDUOC_ID        where dtk.BENHVIEN_ID = 'HLU01'        group by LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')), pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        ) tk on tk.DUOC_ID = d.DUOC_ID        left join TM_DUOC_PHAMVISUDUNG kd on kd.PHAMVI_ID = tk.PHAMVI_ID and kd.BENHVIEN_ID = 'HLU01'        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = tk.NGUONDUOC_ID and nh.BENHVIEN_ID = 'HLU01'        where d.BENHVIEN_ID = 'HLU01' and tk.PHAMVI_ID =  @param0         end]
2020-01-02 18:01:47,677 [1] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoVaBookingCOM23UpdateRedis_TheoPhamvi] Parameters: [@param0=[PHAMVI_ID,1028]]
2020-01-02 18:01:47,677 [1] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoVaBookingCOM23UpdateRedis_TheoPhamvi] Types: [@param0=[Int64, System.Int64]]
2020-01-02 18:01:48,030 [1] DEBUG - Statement Id: [DAO00064_GetlistTT_TIEPNHAN_SOTHEBHYT] PreparedStatement : [select stbhyt.*, ba.SOBENHAN,        tn.SOTIEPNHAN, tn.LOAITHANHVIEN_ID, tn.THE_ID, tn.THANHVIEN_ID,        tn.SUDUNG_BHTN, tn.BAOLANH_VIENPHI, tn.VIP, tn.NGUOINUOCNGOAI        from TT_TIEPNHAN_SOTHEBHYT stbhyt        left join TT_TIEPNHAN tn on tn.TIEPNHAN_ID = stbhyt.TIEPNHAN_ID        left join TT_NOITRU_BENHAN ba on ba.TIEPNHAN_ID = stbhyt.TIEPNHAN_ID        where        stbhyt.TIEPNHAN_ID = '28494' and isnull(stbhyt.KHONGSUDUNG, '0') = '0']
2020-01-02 18:01:48,062 [1] DEBUG - Statement Id: [DAO00064_GetListVienPhiByTiepNnan] PreparedStatement : [select distinct        B.DOITUONG_ID, B.NGAYMIENDONGCHITRA, B.BENHNHAN_ID as TIEPNHAN_BENHNHAN_ID, B.TRAITUYEN,        B.BHYTTREN3NAM as TREN3NAM, B.BHYTTREN5NAM as TREN5NAM, B.SOTIEPNHAN, B.SOBENHAN,        B.LOAITHANHVIEN_ID, B.SUDUNG_BHTN, B.THE_ID, B.THANHVIEN_ID, B.BAOLANH_VIENPHI, B.VIP, B.NGUOINUOCNGOAI,        C.GIATRIMIENGIAM as GIATRIMIENGIAM, D.GIATRIMIENGIAM as GIATRIMIENGIAM_BHTN, E.GIATRIMIENGIAM as GIATRIMIENGIAM_THANHVIEN,        F.GIATRIMIENGIAM as GIATRIMIENGIAM_CONGTY, DVYC.THE_ID as DVDUNGTHE, DVYC.TRANGTHAI as TRANGTHAIDICHVU, ndv.MANHOMDICHVU,        A.* from TT_VIENPHI A        left join        (select B.*, C.SOBENHAN, C.BENHAN_ID        from TT_TIEPNHAN B        left join TT_NOITRU_BENHAN C on B.TIEPNHAN_ID = C.TIEPNHAN_ID                 where B.TIEPNHAN_ID = '28494') B on B.TIEPNHAN_ID = A.TIEPNHAN_ID        left join (select sum(GIATRIMIENGIAM) as GIATRIMIENGIAM, VIENPHI_ID, REF_TABLE        from TT_MIENGIAM_CHITIET        where REF_TABLE = 'TT_MIENGIAM'        and exists (select MIENGIAM_ID from TT_MIENGIAM where TT_MIENGIAM_CHITIET.MIENGIAM_ID = MIENGIAM_ID and TINHTRANG = 1 and TIEPNHAN_ID = '28494')        group by VIENPHI_ID, REF_TABLE) C on C.REF_TABLE = 'TT_MIENGIAM' and C.VIENPHI_ID = A.VIENPHI_ID        left join (select sum(GIATRIMIENGIAM) as GIATRIMIENGIAM, VIENPHI_ID, REF_TABLE        from TT_MIENGIAM_CHITIET        where REF_TABLE = 'TT_MIENGIAM_BHTN'        and exists (select MIENGIAM_BHTN_ID from TT_MIENGIAM_BHTN where TT_MIENGIAM_CHITIET.MIENGIAM_ID = MIENGIAM_BHTN_ID and  TINHTRANG = 1 and TIEPNHAN_ID = '28494')        group by VIENPHI_ID, REF_TABLE) D on D.REF_TABLE = 'TT_MIENGIAM_BHTN' and D.VIENPHI_ID = A.VIENPHI_ID        left join (select sum(GIATRIMIENGIAM) as GIATRIMIENGIAM, VIENPHI_ID, REF_TABLE        from TT_MIENGIAM_CHITIET        where REF_TABLE = 'TT_MIENGIAM_THANHVIEN'        and exists (select MIENGIAM_THANHVIEN_ID from TT_MIENGIAM_THANHVIEN where TT_MIENGIAM_CHITIET.MIENGIAM_ID = MIENGIAM_THANHVIEN_ID and TINHTRANG = 1 and TIEPNHAN_ID = '28494')        group by VIENPHI_ID, REF_TABLE) E on E.REF_TABLE = 'TT_MIENGIAM_THANHVIEN' and E.VIENPHI_ID = A.VIENPHI_ID        left join (select sum(GIATRIMIENGIAM) as GIATRIMIENGIAM, VIENPHI_ID, REF_TABLE        from TT_MIENGIAM_CHITIET        where REF_TABLE = 'TT_MIENGIAM_CONGTY'        and exists (select MIENGIAM_CONGTY_ID from TT_MIENGIAM_CONGTY where TT_MIENGIAM_CHITIET.MIENGIAM_ID = MIENGIAM_CONGTY_ID and TINHTRANG = 1 and TIEPNHAN_ID = '28494')        group by VIENPHI_ID, REF_TABLE) F on F.REF_TABLE = 'TT_MIENGIAM_CONGTY' and F.VIENPHI_ID = A.VIENPHI_ID        left join TT_DVYEUCAU DVYC on DVYC.DVYEUCAU_ID = A.REF_ID and A.REF_TABLE = 'TT_DVYEUCAU'        left join TM_DICHVU DV on DVYC.DICHVU_ID = DV.DICHVU_ID and A.REF_TABLE = 'TT_DVYEUCAU'        left join TM_NHOMDICHVU ndv on ndv.NHOMDICHVU_ID = DV.NHOMDICHVU_ID and A.REF_TABLE = 'TT_DVYEUCAU'        where        A.TIEPNHAN_ID = '28494' and ((DVYC.HUYYEUCAU = '0' and A.DICHVU_ID is not null)        or A.DUOC_ID is not null or A.REF_TABLE = 'TT_NUT_XACNHANSUATAN_CHITIET')        and A.ACTIVE = '1'                 and A.BENHVIEN_ID = 'HLU01'        order by A.VIENPHI_ID]
2020-01-02 18:01:48,100 [1] DEBUG - Statement Id: [DAO00006_GetListDuocTyle] PreparedStatement : [select DUOC_ID, DOITUONG_ID, (TYLE/100) as TYLE, DONGIA MUCTRAN_THANHTOAN from TM_DOITUONG_GIADUOC_TYLE            where            BENHVIEN_ID = 'HLU01'            and DOITUONG_ID = '4']
2020-01-02 18:01:48,124 [1] DEBUG - Statement Id: [DAO00027_GetListTuongTrinhDichVuPhauThuatCuaTiepNhan] PreparedStatement : [declare @ManhomDSA varchar(10);        declare @PhanLoaiNhomDV varchar(20) = '05';        select top 1  @ManhomDSA = VALUE from TM_SYS_APPSETTINGS where CODE = 'MANHOM_DICHVU_DSA'        if (@ManhomDSA is not null) set @PhanLoaiNhomDV += ',' + @ManhomDSA        select distinct ptyc.*        from TT_PHAUTHUAT_YEUCAU ptyc        inner join TM_DICHVU dv on dv.DICHVU_ID = ptyc.DICHVU_ID        inner join TM_NHOMDICHVU ndv on ndv.NHOMDICHVU_ID = dv.NHOMDICHVU_ID        inner join TT_PHAUTHUAT pt on pt.PHAUTHUAT_ID = ptyc.PHAUTHUAT_ID        where        pt.TIEPNHAN_ID = 28494        and (left(ndv.MANHOMDICHVU, 2) in (select * from STRING_SPLIT(@PhanLoaiNhomDV,',')) or ndv.MANHOMDICHVU in (select * from STRING_SPLIT(@PhanLoaiNhomDV,',')))]
2020-01-02 18:01:48,157 [1] DEBUG - Statement Id: [DAO00006_GetList] PreparedStatement : [select dv.*, loaiDV.MALOAIDICHVU, captren.NHOMDICHVU_ID as NHOMDICHVU_CAPTREN_ID, captren.TENNHOMDICHVU as NHOMDICHVU_CAPTREN,              nhom_dv.TENNHOMDICHVU as TENNHOMDICHVU, nhom_dv.MANHOMDICHVU,              case when dv.ATTRIBUTE5 is null then 'TT' else 'KTC' end as LOAI_CHIPHI              from TM_DICHVU as dv              left join TM_NHOMDICHVU as nhom_dv on nhom_dv.NHOMDICHVU_ID = dv.NHOMDICHVU_ID and nhom_dv.BENHVIEN_ID = 'HLU01'              left join TM_NHOMDICHVU as captren on nhom_dv.CAPTREN_ID = captren.NHOMDICHVU_ID and captren.BENHVIEN_ID = 'HLU01'              left join TM_LOAIDICHVU loaiDV on nhom_dv.LOAIDICHVU_ID = loaiDV.LOAIDICHVU_ID and loaiDV.BENHVIEN_ID = 'HLU01'              where nhom_dv.TAMNGUNG = '0' and dv.BENHVIEN_ID = 'HLU01'              and dv.TAMNGUNG = '0'               AND                   loaiDV.MALOAIDICHVU = 'KhamBenh']
2020-01-02 18:01:48,241 [1] DEBUG - Statement Id: [DAO00027_GetDichvuYCBHYTTyle] PreparedStatement : [select DVYEUCAU_ID from TT_DVYEUCAU        where TIEPNHAN_ID = 28494 and isnull(BHYT_TYLETHANHTOAN_ID, 0) > 0]
2020-01-02 18:01:48,268 [1] DEBUG - Statement Id: [DAO00023_UpdateNhieuVP] PreparedStatement : [declare @jsonVienPhi nvarchar(max) = N'[{"VIENPHI_ID":675811,"TIEPNHAN_ID":28494,"DICHVU_ID":5492,"BENHAN_ID":0,"SOLUONG":1.0000,"DONGIA_DOANHTHU":33000.0000,"THANHTIEN_DOANHTHU":33000.00,"BHYT_TL":1.0,"BHYT_DONGIA":33000.0000,"BHYT_THANHTIEN":33000.00,"BHYT_DONGIA_CONGKHAM_DAU":33000.0000,"BHYT_CONGKHAM_DAU_TYLE":1.0,"BHYT_DONGIA_CHITRA":33000.0,"BHYT_THANHTIEN_CHITRA":33000.00,"BENHNHAN_PHAITHANHTOAN":0.00,"GIATRI_HOADON":0.0,"GIATRI_HOADON_DATHANHTOAN":0.0,"GIATRI_BIENLAI":0.0,"GIATRI_BIENLAI_DATHANHTOAN":0.0,"GIATRI_BENHNHAN_DATHANHTOAN":0.0,"DATHUCHIEN":"1","KHONGTHUTIEN":"0","BHYTDONGTIEN":"0","DICHVU_TL":1.0,"BHYT_DONGIA_DONGCT_DAU":0.0,"SOBHYT":"DN466456425324438289","SOBHYT_HUONG_ID":29517,"GIATRIMIENGIAM":0.0,"GIATRIMIENGIAM_BHTN":0.0,"GIATRIMIENGIAM_THANHVIEN":0.0,"GIATRIMIENGIAM_CONGTY":0.0,"BHYT_CK2_KHONGTHANHTOAN":false}]';        begin        UPDATE TT_VIENPHI        SET        SOLUONG = json.SOLUONG,        DONGIA_DOANHTHU = json.DONGIA_DOANHTHU,        THANHTIEN_DOANHTHU = json.THANHTIEN_DOANHTHU,        BHYT_TL = json.BHYT_TL,        BHYT_DONGIA = json.BHYT_DONGIA,        BHYT_THANHTIEN = json.BHYT_THANHTIEN,        BHYT_DONGIA_CONGKHAM_DAU = json.BHYT_DONGIA_CONGKHAM_DAU,        BHYT_CONGKHAM_DAU_TYLE = json.BHYT_CONGKHAM_DAU_TYLE,        BHYT_DONGIA_CHITRA = json.BHYT_DONGIA_CHITRA,        BHYT_THANHTIEN_CHITRA = json.BHYT_THANHTIEN_CHITRA,        BENHNHAN_PHAITHANHTOAN = json.BENHNHAN_PHAITHANHTOAN,        GIATRI_HOADON = json.GIATRI_HOADON,                GIATRI_BIENLAI = json.GIATRI_BIENLAI,                DATHUCHIEN = json.DATHUCHIEN,                DICHVU_TL = json.DICHVU_TL,        BHYT_DONGIA_DONGCT_DAU = json.BHYT_DONGIA_DONGCT_DAU,        NGAYCAPNHAT = GETDATE()        FROM OPENJSON (@jsonVienPhi)        WITH (        VIENPHI_ID int,        SOLUONG numeric(25, 4),        DONGIA_DOANHTHU numeric(25, 4),        THANHTIEN_DOANHTHU numeric(25, 4),        BHYT_TL numeric(25, 4),        BHYT_DONGIA numeric(25, 4),        BHYT_THANHTIEN numeric(25, 4),        BHYT_DONGIA_CONGKHAM_DAU numeric(25, 4),        BHYT_CONGKHAM_DAU_TYLE numeric(25, 4),        BHYT_DONGIA_CHITRA numeric(25, 4),        BHYT_THANHTIEN_CHITRA numeric(25, 4),        BENHNHAN_PHAITHANHTOAN numeric(25, 4),        GIATRI_HOADON numeric(25, 4),                GIATRI_BIENLAI numeric(25, 4),                DATHUCHIEN char(1),        KHONGTHUTIEN char(1),        BHYTDONGTIEN char(1),        DICHVU_TL numeric(25, 4),        BHYT_DONGIA_DONGCT_DAU numeric(25, 4))  json        WHERE TT_VIENPHI.VIENPHI_ID = json.VIENPHI_ID and json.DONGIA_DOANHTHU > 0                  insert into TT_TINH_VIENPHI_LOG        SELECT json.VIENPHI_ID, json.TIEPNHAN_ID, json.BENHAN_ID, json.SOLUONG, json.BHYT_TL, json.DONGIA_DOANHTHU,        json.THANHTIEN_DOANHTHU, json.BHYT_DONGIA, json.BHYT_THANHTIEN, json.BHYT_DONGIA_CHITRA, json.BHYT_THANHTIEN_CHITRA, json.BENHNHAN_PHAITHANHTOAN,        json.SOBHYT_HUONG_ID, json.SOBHYT, GETDATE(), -1, 'HLU01'        FROM OPENJSON(@jsonVienPhi)        WITH (        VIENPHI_ID int,        TIEPNHAN_ID int,        BENHAN_ID int,        SOLUONG numeric(25, 4),        DONGIA_DOANHTHU numeric(25, 4),        THANHTIEN_DOANHTHU numeric(25, 4),        BHYT_TL numeric(25, 4),        BHYT_DONGIA numeric(25, 4),        BHYT_THANHTIEN numeric(25, 4),        BHYT_DONGIA_CHITRA numeric(25, 4),        BHYT_THANHTIEN_CHITRA numeric(25, 4),        BENHNHAN_PHAITHANHTOAN numeric(25, 4),        SOBHYT_HUONG_ID int,        SOBHYT nvarchar(30)) json        end]
2020-01-02 18:01:48,296 [1] DEBUG - Statement Id: [DAO00067_UpdateDataVienPhiDongiaBHYT] PreparedStatement : [update TT_VIENPHI          set BHYT_DONGIA_CHITRA = 0, BHYT_THANHTIEN = 0, BHYT_THANHTIEN_CHITRA = 0          where          TIEPNHAN_ID = 28494 and BHYT_DONGIA = 0          and (BHYT_DONGIA_CHITRA > 0 or BHYT_THANHTIEN > 0 or BHYT_THANHTIEN_CHITRA > 0)]
2020-01-02 18:01:48,321 [1] DEBUG - Statement Id: [DAO00067_CapnhatDataVienphiKhiHuyThanhtoanHoadon] PreparedStatement : [update TT_VIENPHI        set TT_VIENPHI.HOADON_ID = hdct.HOADON_ID, TT_VIENPHI.GIATRI_BENHNHAN_DATHANHTOAN = TT_VIENPHI.GIATRI_BENHNHAN_DATHANHTOAN + hdct.GIATRI_BENHNHAN_DATHANHTOAN        from (select CT.HOADON_ID, CT.VIENPHI_ID, CT.GIATRI_BENHNHAN_DATHANHTOAN        from TT_HOADON_CHITIET_NGOAITRU CT        join TT_HOADON HD on HD.HOADON_ID = CT.HOADON_ID        join TT_VIENPHI vp on vp.VIENPHI_ID = ct.VIENPHI_ID        where HD.DATHANHTOAN = 1 and HD.HUYHOADON = 0 and HD.HOANTRA = 0 and vp.TIEPNHAN_ID =  @param0 ) hdct        where        TT_VIENPHI.VIENPHI_ID = hdct.VIENPHI_ID and TT_VIENPHI.HOADON_ID is null and isnull(TT_VIENPHI.GIATRI_BENHNHAN_DATHANHTOAN,0) = 0        and TT_VIENPHI.TIEPNHAN_ID =  @param0           update TT_VIENPHI        set TT_VIENPHI.HOADON_ID = null, TT_VIENPHI.GIATRI_BENHNHAN_DATHANHTOAN = TT_VIENPHI.GIATRI_BENHNHAN_DATHANHTOAN - hdct.GIATRI_BENHNHAN_DATHANHTOAN,        TT_VIENPHI.DATHANHTOAN = '0'        from (select CT.HOADON_ID, CT.VIENPHI_ID, CT.GIATRI_BENHNHAN_DATHANHTOAN        from TT_HOADON_CHITIET_NGOAITRU CT        join TT_HOADON HD on HD.HOADON_ID = CT.HOADON_ID        join TT_VIENPHI vp on vp.VIENPHI_ID = ct.VIENPHI_ID and vp.HOADON_ID = ct.HOADON_ID        where HD.DATHANHTOAN = 0 and (HD.HUYHOADON = 1 or HD.HOANTRA = 1) and vp.TIEPNHAN_ID =  @param0 ) hdct        where        TT_VIENPHI.VIENPHI_ID = hdct.VIENPHI_ID and TT_VIENPHI.HOADON_ID = hdct.HOADON_ID        and TT_VIENPHI.TIEPNHAN_ID =  @param0]
2020-01-02 18:01:48,321 [1] DEBUG - Statement Id: [DAO00067_CapnhatDataVienphiKhiHuyThanhtoanHoadon] Parameters: [@param0=[TIEPNHAN_ID,28494]]
2020-01-02 18:01:48,321 [1] DEBUG - Statement Id: [DAO00067_CapnhatDataVienphiKhiHuyThanhtoanHoadon] Types: [@param0=[Int64, System.Int64]]
2020-01-02 18:02:44,132 [1] DEBUG - Statement Id: [DAO00067_GET_CHUYENVIENINFO_FROM_BENHNHANID] PreparedStatement : [select *        from TT_CHUYENVIEN        where BENHNHAN_ID  = '0' and BENHVIEN_ID = 'HLU01'        and TIEPNHAN_ID = '28494'         and           KHAMBENH_ID = '27177']
2020-01-02 18:02:53,624 [1] DEBUG - Statement Id: [DAO00014_GetChanDoan] PreparedStatement : [DECLARE @VAL1 NVARCHAR(1000) = ''        DECLARE @VAL2 NVARCHAR(1000) = ''        SELECT @VAL1 = (SELECT ICD.TENICD +'('+ICD.MAICD+'); '+ KB.CHANDOANKHOAKHAM FROM TT_NGOAITRU_KHAMBENH KB        INNER JOIN TM_ICD ICD ON ICD.ICD_ID = KB.CHANDOANICD_ID        WHERE KHAMBENH_ID =  @param0 )        SELECT @VAl2 = @VAL2 + ICD.TENICD +'('+ICD.MAICD +'); ' FROM        TT_NGOAITRU_KHAMBENH_ICD KBI        INNER JOIN TM_ICD ICD ON KBI.ICD_ID = ICD.ICD_ID        WHERE KBI.KHAMBENH_ID =  @param0         SELECT @VAL1 + '; '+ ISNULL(@VAL2,'')]
2020-01-02 18:02:53,624 [1] DEBUG - Statement Id: [DAO00014_GetChanDoan] Parameters: [@param0=[KHAMBENH_ID,27177]]
2020-01-02 18:02:53,624 [1] DEBUG - Statement Id: [DAO00014_GetChanDoan] Types: [@param0=[Int64, System.Int64]]
2020-01-02 18:02:53,652 [1] DEBUG - Statement Id: [DAO00016_GetDSThuocDaDungByTiepNhan] PreparedStatement : [select A.*, dc.TENDUOCDAYDU        from TT_NGOAITRU_TOATHUOC A        left join TM_DUOC dc on A.DUOC_ID = dc.DUOC_ID        where exists (select KHAMBENH_ID from TT_NGOAITRU_KHAMBENH where A.KHAMBENH_ID = KHAMBENH_ID and  TIEPNHAN_ID = '28494')        and exists (select KHAMBENH_TOATHUOC_ID from TT_NGOAITRU_KHAMBENH_TOATHUOC where A.KHAMBENH_TOATHUOC_ID = KHAMBENH_TOATHUOC_ID and CHUNGTUPHATTHUOC_ID is not null)        and A.BENHVIEN_ID = 'HLU01']
2020-01-02 18:02:53,677 [1] DEBUG - Statement Id: [DAO00067_GetDanhsachDichvuDungChoChuyentuyen] PreparedStatement : [select A.DICHVU_ID, B.TENDICHVU, A.DVYEUCAU_ID        from TT_DVYEUCAU A        left join TM_DICHVU B on A.DICHVU_ID = B.DICHVU_ID        left join TM_NHOMDICHVU C on C.NHOMDICHVU_ID = B.NHOMDICHVU_ID        where        ( @param0  IS NOT NULL OR  @param1  IS NOT NULL) AND        LEFT(C.MANHOMDICHVU,2) in ('01', '02', '05', '06') and A.HUYYEUCAU = '0'         and           A.TIEPNHAN_ID = '28494']
2020-01-02 18:02:53,677 [1] DEBUG - Statement Id: [DAO00067_GetDanhsachDichvuDungChoChuyentuyen] Parameters: [@param0=[BENHAN_ID,null], @param1=[TIEPNHAN_ID,28494]]
2020-01-02 18:02:53,677 [1] DEBUG - Statement Id: [DAO00067_GetDanhsachDichvuDungChoChuyentuyen] Types: [@param0=[System.DBNull, null], @param1=[Int64, System.Int64]]
2020-01-02 18:02:53,702 [1] DEBUG - Statement Id: [DAO00067_GetDanhsachxetnghiemkq] PreparedStatement : [select distinct C.CLSKETQUACHITIET_ID, B.TENDICHVU, C.KETQUA, C.DICHVU_ID, A.DVYEUCAU_ID        from TT_DVYEUCAU A        inner join TT_CLSKETQUACHITIET C on C.DVYEUCAU_ID = A.DVYEUCAU_ID        left join TM_DICHVU B on C.DICHVU_ID = B.DICHVU_ID        where A.HUYYEUCAU = '0' and A.BENHAN_ID is not null                 AND ( @param0  IS NOT NULL OR  @param1  IS NOT NULL)         and           A.TIEPNHAN_ID = '28494'                 order by C.CLSKETQUACHITIET_ID]
2020-01-02 18:02:53,702 [1] DEBUG - Statement Id: [DAO00067_GetDanhsachxetnghiemkq] Parameters: [@param0=[BENHAN_ID,null], @param1=[TIEPNHAN_ID,28494]]
2020-01-02 18:02:53,702 [1] DEBUG - Statement Id: [DAO00067_GetDanhsachxetnghiemkq] Types: [@param0=[System.DBNull, null], @param1=[Int64, System.Int64]]
2020-01-02 18:02:53,727 [1] DEBUG - Statement Id: [DAO00067_GetDanhsachsieuamkq] PreparedStatement : [select C.DVYEUCAU_ID, B.TENDICHVU,C.KETLUAN        from TT_DVYEUCAU A        inner join TT_CLSKETQUA C on C.DVYEUCAU_ID = A.DVYEUCAU_ID        left join TM_DICHVU B on C.DICHVU_ID = B.DICHVU_ID        where        ( @param0  IS NOT NULL OR  @param1  IS NOT NULL) AND                 A.DVYEUCAU_ID not in        (select DVYEUCAU_ID from TT_CLSKETQUACHITIET        where exists (        select DVYEUCAU_ID from TT_DVYEUCAU where TT_CLSKETQUACHITIET.DVYEUCAU_ID = DVYEUCAU_ID                 ))         and           A.TIEPNHAN_ID = 28494]
2020-01-02 18:02:53,728 [1] DEBUG - Statement Id: [DAO00067_GetDanhsachsieuamkq] Parameters: [@param0=[BENHAN_ID,null], @param1=[TIEPNHAN_ID,28494]]
2020-01-02 18:02:53,728 [1] DEBUG - Statement Id: [DAO00067_GetDanhsachsieuamkq] Types: [@param0=[System.DBNull, null], @param1=[Int64, System.Int64]]
