--------------------------------------------------------------------------------
2019-08-14 11:00:03,513 [1] DEBUG - Statement Id: [DAO00001_DBList] PreparedStatement : [select *              from TM_SYS_SERVER              where HOSPITAL_ID = '_SYSTEM_' and TYPE = 'D']
2019-08-14 11:00:03,927 [1] DEBUG - Statement Id: [DAO00001_DaoList] PreparedStatement : [select              TM_SYS_SERVICEMAP.ID,              TM_SYS_SERVICEMAP.HOSPITAL_ID,              TM_SYS_SERVICEMAP.DB_NAME,              TM_SYS_SERVICEMAP.TYPE,              TM_SYS_SERVICEMAP.NAME,              TM_SYS_SERVICEMAP.CLASS,              (TM_SYS_DIC.VALUE + '.' + TM_SYS_SERVICEMAP.CLASS) as CLASSFULL,              TM_SYS_SERVICEMAP.ASSEMBLY              from TM_SYS_SERVICEMAP              inner join TM_SYS_DIC              on TM_SYS_SERVICEMAP.NAMESPACE = TM_SYS_DIC.ID              where HOSPITAL_ID = '_SYSTEM_' AND TYPE = 'D' AND ACTIVE = '1'              order by DB_NAME]
2019-08-14 11:00:03,965 [1] DEBUG - Statement Id: [DAO00001_ServiceList] PreparedStatement : [select              TM_SYS_SERVICEMAP.ID,              TM_SYS_SERVICEMAP.HOSPITAL_ID,              TM_SYS_SERVICEMAP.DB_NAME,              TM_SYS_SERVICEMAP.TYPE,              TM_SYS_SERVICEMAP.NAME,              TM_SYS_SERVICEMAP.CLASS,              (TM_SYS_DIC.VALUE + '.' + TM_SYS_SERVICEMAP.CLASS) as CLASSFULL,              TM_SYS_SERVICEMAP.ASSEMBLY,              TM_SYS_SERVER.URL              from TM_SYS_SERVICEMAP              inner join TM_SYS_DIC on TM_SYS_SERVICEMAP.NAMESPACE = TM_SYS_DIC.ID              inner join TM_SYS_SERVER on (TM_SYS_SERVICEMAP.DB_NAME = TM_SYS_SERVER.NAME) and (TM_SYS_SERVER.HOSPITAL_ID = '_SYSTEM_')              where TM_SYS_SERVICEMAP.HOSPITAL_ID = '_SYSTEM_' AND TM_SYS_SERVICEMAP.TYPE = 'S'  AND ACTIVE = '1'              order by URL]
2019-08-14 11:00:05,252 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = '_SYSTEM_'               AND                   TM_SYS_SCREEN.PAGE = 'LOGIN'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2019-08-14 11:00:05,603 [1] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = '_SYSTEM_'               AND                   TM_SYS_CACHE.ACTIVE = '1']
--------------------------------------------------------------------------------
2019-08-14 11:17:45,684 [1] DEBUG - Statement Id: [DAO00001_DBList] PreparedStatement : [select *              from TM_SYS_SERVER              where HOSPITAL_ID = '_SYSTEM_' and TYPE = 'D']
2019-08-14 11:17:46,009 [1] DEBUG - Statement Id: [DAO00001_DaoList] PreparedStatement : [select              TM_SYS_SERVICEMAP.ID,              TM_SYS_SERVICEMAP.HOSPITAL_ID,              TM_SYS_SERVICEMAP.DB_NAME,              TM_SYS_SERVICEMAP.TYPE,              TM_SYS_SERVICEMAP.NAME,              TM_SYS_SERVICEMAP.CLASS,              (TM_SYS_DIC.VALUE + '.' + TM_SYS_SERVICEMAP.CLASS) as CLASSFULL,              TM_SYS_SERVICEMAP.ASSEMBLY              from TM_SYS_SERVICEMAP              inner join TM_SYS_DIC              on TM_SYS_SERVICEMAP.NAMESPACE = TM_SYS_DIC.ID              where HOSPITAL_ID = '_SYSTEM_' AND TYPE = 'D' AND ACTIVE = '1'              order by DB_NAME]
2019-08-14 11:17:46,051 [1] DEBUG - Statement Id: [DAO00001_ServiceList] PreparedStatement : [select              TM_SYS_SERVICEMAP.ID,              TM_SYS_SERVICEMAP.HOSPITAL_ID,              TM_SYS_SERVICEMAP.DB_NAME,              TM_SYS_SERVICEMAP.TYPE,              TM_SYS_SERVICEMAP.NAME,              TM_SYS_SERVICEMAP.CLASS,              (TM_SYS_DIC.VALUE + '.' + TM_SYS_SERVICEMAP.CLASS) as CLASSFULL,              TM_SYS_SERVICEMAP.ASSEMBLY,              TM_SYS_SERVER.URL              from TM_SYS_SERVICEMAP              inner join TM_SYS_DIC on TM_SYS_SERVICEMAP.NAMESPACE = TM_SYS_DIC.ID              inner join TM_SYS_SERVER on (TM_SYS_SERVICEMAP.DB_NAME = TM_SYS_SERVER.NAME) and (TM_SYS_SERVER.HOSPITAL_ID = '_SYSTEM_')              where TM_SYS_SERVICEMAP.HOSPITAL_ID = '_SYSTEM_' AND TM_SYS_SERVICEMAP.TYPE = 'S'  AND ACTIVE = '1'              order by URL]
2019-08-14 11:17:46,619 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = '_SYSTEM_'               AND                   TM_SYS_SCREEN.PAGE = 'LOGIN'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2019-08-14 11:17:46,932 [1] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = '_SYSTEM_'               AND                   TM_SYS_CACHE.ACTIVE = '1']
2019-08-14 11:19:24,441 [1] DEBUG - Statement Id: [DAO00001_DBList] PreparedStatement : [select *              from TM_SYS_SERVER              where HOSPITAL_ID = 'HLU01' and TYPE = 'D']
2019-08-14 11:19:24,532 [1] DEBUG - Statement Id: [DAO00001_DaoList] PreparedStatement : [select              TM_SYS_SERVICEMAP.ID,              TM_SYS_SERVICEMAP.HOSPITAL_ID,              TM_SYS_SERVICEMAP.DB_NAME,              TM_SYS_SERVICEMAP.TYPE,              TM_SYS_SERVICEMAP.NAME,              TM_SYS_SERVICEMAP.CLASS,              (TM_SYS_DIC.VALUE + '.' + TM_SYS_SERVICEMAP.CLASS) as CLASSFULL,              TM_SYS_SERVICEMAP.ASSEMBLY              from TM_SYS_SERVICEMAP              inner join TM_SYS_DIC              on TM_SYS_SERVICEMAP.NAMESPACE = TM_SYS_DIC.ID              where HOSPITAL_ID = 'HLU01' AND TYPE = 'D' AND ACTIVE = '1'              order by DB_NAME]
2019-08-14 11:19:33,389 [1] DEBUG - Statement Id: [DAO00001_ServiceList] PreparedStatement : [select              TM_SYS_SERVICEMAP.ID,              TM_SYS_SERVICEMAP.HOSPITAL_ID,              TM_SYS_SERVICEMAP.DB_NAME,              TM_SYS_SERVICEMAP.TYPE,              TM_SYS_SERVICEMAP.NAME,              TM_SYS_SERVICEMAP.CLASS,              (TM_SYS_DIC.VALUE + '.' + TM_SYS_SERVICEMAP.CLASS) as CLASSFULL,              TM_SYS_SERVICEMAP.ASSEMBLY,              TM_SYS_SERVER.URL              from TM_SYS_SERVICEMAP              inner join TM_SYS_DIC on TM_SYS_SERVICEMAP.NAMESPACE = TM_SYS_DIC.ID              inner join TM_SYS_SERVER on (TM_SYS_SERVICEMAP.DB_NAME = TM_SYS_SERVER.NAME) and (TM_SYS_SERVER.HOSPITAL_ID = 'HLU01')              where TM_SYS_SERVICEMAP.HOSPITAL_ID = 'HLU01' AND TM_SYS_SERVICEMAP.TYPE = 'S'  AND ACTIVE = '1'              order by URL]
2019-08-14 11:19:33,658 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1']
2019-08-14 11:19:36,087 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM005']
2019-08-14 11:19:36,511 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM015']
2019-08-14 11:19:36,613 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM067']
2019-08-14 11:19:36,706 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM008']
2019-08-14 11:19:36,784 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM068']
2019-08-14 11:19:36,915 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM006']
2019-08-14 11:19:37,011 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM030']
2019-08-14 11:19:37,092 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM025']
2019-08-14 11:19:37,179 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM024']
2019-08-14 11:19:38,955 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM033']
2019-08-14 11:19:39,006 [5] DEBUG - Statement Id: [DAO00027_GetListDuocKyGuiTonKho] PreparedStatement : [select  distinct TT_TONKHO.DUOC_KEY, LTRIM(TT_TONKHO.KHODUOC_ID) as KHODUOC_ID, TM_DUOC.DUOC_ID, TM_LOAIDUOC.MALOAIDUOC,TM_DUOC.SOVISA,TM_DUOC.TYLE_VAT,TM_DUOC.COTOA,        TM_DUOC.MADUOC, TM_DUOC.TENHANG, TM_DUOC.TENDUOCDAYDU, dvt.TENDONVITINH as DONVITINH,  TM_DUOC.DONVITINH_ID,TM_DUOC.BHYT,TM_DUOC.PHAMVI,        TM_DUOC.TENHOATCHAT, TM_DUOC.HAMLUONG, TM_DUOC.HANGSANXUAT, TM_DUOC.QUOCGIA, TM_DUOC.LOAIDUOC_ID, TM_DUOC.DUONGDUNG_ID,        TM_TENDUOC.TENDUOC, TM_TENDUOC.TENDUOC_EN, TM_TENDUOC.MAQUOCTE, TM_TENDUOC.MAQUOCTEBT,        TM_LOAIDUOC.LOAIVATTU_ID, TM_DUOC.BENHVIEN_ID,TT_TONKHO.SOLUONG, TT_TONKHO.NGUONDUOC_ID, NH.TENNGUONDUOC        , TAMNGUNG = CASE WHEN TM_DUOC.TAMNGUNG = '1' OR nh.TAMNGUNG = '1' OR KD.TAMNGUNG = '1' THEN '1' ELSE '0' END        , TM_DUOC.DANGTRINHBAY        from TM_DUOC        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = TM_DUOC.DONVITINH_ID        left join TM_TENDUOC on TM_DUOC.TENDUOC_ID = TM_TENDUOC.TENDUOC_ID and TM_DUOC.BENHVIEN_ID = 'HLU01' and TM_DUOC.TAMNGUNG = '0'        left join TM_LOAIDUOC on TM_LOAIDUOC.LOAIDUOC_ID = TM_DUOC.LOAIDUOC_ID and TM_LOAIDUOC.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG on (TM_LOAIDUOC.LOAIVATTU_ID = TM_DUOC_HANDUNG.LOAIDUOC and TM_DUOC_HANDUNG.BENHVIEN_ID = 'HLU01')        inner join        (select LTRIM(A.KHODUOC_ID) + '_' + LTRIM(A.DUOC_ID) + '_' + LTRIM(ISNULL(A.NGUONDUOC_ID,'')) as DUOC_KEY, A.KHODUOC_ID, A.DUOC_ID,A.NGUONDUOC_ID,        SUM(isnull(A.SOLUONG,0)) as SOLUONG        from        (select SUM(SOLUONG) as SOLUONG, KHODUOC_ID, DUOC_ID, NGUONDUOC_ID from TT_DUOC_KYGUI_TONKHO        where BENHVIEN_ID = 'HLU01' group by KHODUOC_ID, DUOC_ID, NGUONDUOC_ID) A        group by LTRIM(A.KHODUOC_ID) + '_' + LTRIM(A.DUOC_ID) + '_' + LTRIM(A.NGUONDUOC_ID), A.KHODUOC_ID, A.DUOC_ID, A.NGUONDUOC_ID)        TT_TONKHO on TT_TONKHO.DUOC_ID = TM_DUOC.DUOC_ID        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = TT_TONKHO.NGUONDUOC_ID and nh.BENHVIEN_ID = 'HLU01'        LEFT JOIN TM_KHODUOC KD ON KD.KHODUOC_ID = TT_TONKHO.KHODUOC_ID        where TM_DUOC.BENHVIEN_ID = 'HLU01' AND TT_TONKHO.SOLUONG >= 0]
2019-08-14 11:19:39,409 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM018']
2019-08-14 11:19:39,449 [5] DEBUG - Statement Id: [DAO00027_GetListDuocTonKho] PreparedStatement : [select distinct TT_TONKHO.DUOC_KEY, LTRIM(TT_TONKHO.KHODUOC_ID) as KHODUOC_ID, TM_DUOC.DUOC_ID, TM_LOAIDUOC.MALOAIDUOC,TM_DUOC.SOVISA,TM_DUOC.TYLE_VAT,TM_DUOC.COTOA,        TM_DUOC.MADUOC, TM_DUOC.TENHANG, TM_DUOC.TENDUOCDAYDU, dvt.TENDONVITINH as DONVITINH,  TM_DUOC.DONVITINH_ID,TM_DUOC.BHYT,                TM_DUOC.TENHOATCHAT,          TM_DUOC.HAMLUONG, TM_DUOC.HANGSANXUAT, TM_DUOC.QUOCGIA, TM_DUOC.LOAIDUOC_ID, TM_DUOC.DUONGDUNG_ID,        TM_TENDUOC.TENDUOC, TM_TENDUOC.TENDUOC_EN, TM_TENDUOC.MAQUOCTE, TM_TENDUOC.MAQUOCTEBT,        TM_LOAIDUOC.LOAIVATTU_ID, TM_DUOC.BENHVIEN_ID,        TT_TONKHO.SOLUONG, TM_DUOC.VTYT_PHANLOAI, TM_DUOC.PHAMVI, TT_TONKHO.NGUONDUOC_ID, NG.TENNGUONDUOC AS TENNGUONDUOC        , TAMNGUNG = CASE WHEN TM_DUOC.TAMNGUNG = '1' OR NG.TAMNGUNG = '1' OR KD.TAMNGUNG = '1' THEN '1' ELSE '0' END        , TM_DUOC.DANGTRINHBAY        from TM_DUOC        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = TM_DUOC.DONVITINH_ID        left join TM_TENDUOC on TM_DUOC.TENDUOC_ID = TM_TENDUOC.TENDUOC_ID and TM_DUOC.BENHVIEN_ID = 'HLU01' and TM_DUOC.TAMNGUNG = '0'        left join TM_LOAIDUOC on TM_LOAIDUOC.LOAIDUOC_ID = TM_DUOC.LOAIDUOC_ID and TM_LOAIDUOC.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG on (TM_LOAIDUOC.LOAIVATTU_ID = TM_DUOC_HANDUNG.LOAIDUOC and TM_DUOC_HANDUNG.BENHVIEN_ID = 'HLU01')        inner join        (select LTRIM(A.KHODUOC_ID) + '_' + LTRIM(A.DUOC_ID) + '_' + LTRIM(ISNULL(A.NGUONDUOC_ID,'')) as DUOC_KEY, A.KHODUOC_ID, A.DUOC_ID, A.NGUONDUOC_ID,        SUM(isnull(A.SOLUONG,0)) as SOLUONG        from        (select SUM(SOLUONG) as SOLUONG, KHODUOC_ID, DUOC_ID, NGUONDUOC_ID from TT_DUOC_TONKHO        where BENHVIEN_ID = 'HLU01' group by KHODUOC_ID, DUOC_ID, NGUONDUOC_ID) A        group by LTRIM(A.KHODUOC_ID) + '_' + LTRIM(A.DUOC_ID) + '_' + LTRIM(ISNULL(A.NGUONDUOC_ID,'')), A.KHODUOC_ID, A.DUOC_ID, NGUONDUOC_ID        ) TT_TONKHO on TT_TONKHO.DUOC_ID = TM_DUOC.DUOC_ID        LEFT JOIN TM_NGUONHANG NG ON NG.NGUONDUOC_ID = TT_TONKHO.NGUONDUOC_ID        LEFT JOIN TM_KHODUOC KD ON KD.KHODUOC_ID = TT_TONKHO.KHODUOC_ID        where TM_DUOC.BENHVIEN_ID = 'HLU01' and TT_TONKHO.SOLUONG >= 0]
2019-08-14 11:19:41,374 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM023']
2019-08-14 11:19:41,653 [5] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoVaBooking] PreparedStatement : [declare @TOAMUANGOAI int = 0;        select @TOAMUANGOAI = isnull(VALUE,0) from TM_SYS_APPSETTINGS where CODE = 'OPD_TOAMUANGOAI_DUNGDANHMUC_DUOC'                if @TOAMUANGOAI = 1        begin        select  distinct '0' + '_' + LTRIM(d.DUOC_ID) + '_' + '0' as DUOC_KEY, 0 as PHAMVI_ID, 0 as NGUONDUOC_ID, null as TENNGUONDUOC, null as TINHTIEN, d.DUOC_ID, ld.MALOAIDUOC,        d.SOVISA,d.TYLE_VAT,d.COTOA, d.MADUOC, d.TENHANG, d.TENDUOCDAYDU, d.DONVITINH as DONVITINH, d.BHYT,        d.TENHOATCHAT, d.HAMLUONG, d.HANGSANXUAT, d.QUOCGIA, d.LOAIDUOC_ID, d.DUONGDUNG_ID, d.TINHTIEN_PTTT,        ten.TENDUOC, ten.TENDUOC_EN, ten.MAQUOCTE, ten.MAQUOCTEBT,        '' as BHYT_TEXT        , ld.LOAIVATTU_ID        , d.BENHVIEN_ID,        999999999 as SOLUONG, d.VTYT_PHANLOAI, d.PHAMVI, d.SUASOLUONGTONGHOP, d.MADUOCBV, d.DANGTRINHBAY        , TAMNGUNG = CASE WHEN d.TAMNGUNG = '1' THEN '1' ELSE '0' END        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        union all        select  distinct tk.DUOC_KEY, LTRIM(tk.PHAMVI_ID) as PHAMVI_ID, tk.NGUONDUOC_ID, nh.TENNGUONDUOC, nh.TINHTIEN, d.DUOC_ID, ld.MALOAIDUOC,        d.SOVISA,d.TYLE_VAT,d.COTOA, d.MADUOC, d.TENHANG, d.TENDUOCDAYDU, dvt.TENDONVITINH as DONVITINH, d.BHYT,        d.TENHOATCHAT, d.HAMLUONG, d.HANGSANXUAT, d.QUOCGIA, d.LOAIDUOC_ID, d.DUONGDUNG_ID, d.TINHTIEN_PTTT,        ten.TENDUOC, ten.TENDUOC_EN, ten.MAQUOCTE, ten.MAQUOCTEBT,        CASE WHEN d.BHYT = '1' THEN 'BHYT' ELSE '' END as BHYT_TEXT        , ld.LOAIVATTU_ID        , d.BENHVIEN_ID,        tk.SOLUONG, d.VTYT_PHANLOAI, d.PHAMVI, d.SUASOLUONGTONGHOP, d.MADUOCBV, d.DANGTRINHBAY        , TAMNGUNG = CASE WHEN d.TAMNGUNG = '1' OR nh.TAMNGUNG = '1' OR kd.TAMNGUNG = '1' THEN '1' ELSE '0' END        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        inner join        (        select  LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')) DUOC_KEY, (SUM(dtk.SOLUONG) - isnull(sum(A.SOLUONG),0) - isnull(sum(B.SOLUONG),0)) SOLUONG, pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        from (select sum(soluong) soluong,duoc_id,nguonduoc_id,khoduoc_id,benhvien_id from TT_DUOC_TONKHO  group by duoc_id,nguonduoc_id,khoduoc_id,benhvien_id) dtk        inner join TM_DUOC_PHAMVISD_MAPPING pvsd on dtk.KHODUOC_ID = pvsd.KHODUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NOITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) B on B.DUOC_ID = dtk.DUOC_ID and B.SOLUONG > 0 and B.PHAMVI_ID = pvsd.PHAMVI_ID and B.NGUONHANG_ID = dtk.NGUONDUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NGOAITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) A on A.DUOC_ID = dtk.DUOC_ID and A.SOLUONG > 0 and A.PHAMVI_ID = pvsd.PHAMVI_ID and A.NGUONHANG_ID = dtk.NGUONDUOC_ID        where dtk.SOLUONG > 0 and dtk.BENHVIEN_ID = 'HLU01'        group by LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')), pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        ) tk on tk.DUOC_ID = d.DUOC_ID        left join TM_DUOC_PHAMVISUDUNG kd on kd.PHAMVI_ID = tk.PHAMVI_ID and kd.BENHVIEN_ID = 'HLU01'        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = tk.NGUONDUOC_ID and nh.BENHVIEN_ID = 'HLU01'        where d.BENHVIEN_ID = 'HLU01'  and tk.SOLUONG >= 0         end                else        begin        select  distinct tk.DUOC_KEY, LTRIM(tk.PHAMVI_ID) as PHAMVI_ID, tk.NGUONDUOC_ID, nh.TENNGUONDUOC, nh.TINHTIEN, d.DUOC_ID, ld.MALOAIDUOC,        d.SOVISA,d.TYLE_VAT,d.COTOA, d.MADUOC, d.TENHANG, d.TENDUOCDAYDU, d.DONVITINH as DONVITINH, d.BHYT,        d.TENHOATCHAT, d.HAMLUONG, d.HANGSANXUAT, d.QUOCGIA, d.LOAIDUOC_ID, d.DUONGDUNG_ID, d.TINHTIEN_PTTT,        ten.TENDUOC, ten.TENDUOC_EN, ten.MAQUOCTE, ten.MAQUOCTEBT,        CASE WHEN d.BHYT = '1' THEN 'BHYT' ELSE '' END as BHYT_TEXT        , ld.LOAIVATTU_ID        , d.BENHVIEN_ID,        tk.SOLUONG, d.VTYT_PHANLOAI, d.PHAMVI, d.SUASOLUONGTONGHOP, d.MADUOCBV, d.DANGTRINHBAY        , TAMNGUNG = CASE WHEN d.TAMNGUNG = '1' OR nh.TAMNGUNG = '1' OR kd.TAMNGUNG = '1' THEN '1' ELSE '0' END        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        inner join        (        select  LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')) DUOC_KEY, (SUM(dtk.SOLUONG) - isnull(sum(A.SOLUONG),0) - isnull(sum(B.SOLUONG),0)) SOLUONG, pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        from (select sum(soluong) soluong,duoc_id,nguonduoc_id,khoduoc_id,benhvien_id from TT_DUOC_TONKHO  group by duoc_id,nguonduoc_id,khoduoc_id,benhvien_id) dtk        inner join TM_DUOC_PHAMVISD_MAPPING pvsd on dtk.KHODUOC_ID = pvsd.KHODUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NOITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) B on B.DUOC_ID = dtk.DUOC_ID and B.SOLUONG > 0 and B.PHAMVI_ID = pvsd.PHAMVI_ID and B.NGUONHANG_ID = dtk.NGUONDUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NGOAITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) A on A.DUOC_ID = dtk.DUOC_ID and A.SOLUONG > 0 and A.PHAMVI_ID = pvsd.PHAMVI_ID and A.NGUONHANG_ID = dtk.NGUONDUOC_ID        where dtk.SOLUONG > 0 and dtk.BENHVIEN_ID = 'HLU01'        group by LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')), pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        ) tk on tk.DUOC_ID = d.DUOC_ID        left join TM_DUOC_PHAMVISUDUNG kd on kd.PHAMVI_ID = tk.PHAMVI_ID and kd.BENHVIEN_ID = 'HLU01'        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = tk.NGUONDUOC_ID and nh.BENHVIEN_ID = 'HLU01'        where d.BENHVIEN_ID = 'HLU01'  and tk.SOLUONG >= 0        end]
2019-08-14 11:19:45,992 [5] DEBUG - Statement Id: [DAO00320_GetList] PreparedStatement : [select M.*            from TM_MAU M            LEFT JOIN TM_MAU_DONVITINH DVT on M.DONVITINH_ID=DVT.DONVITINH_ID            where            M.TAMNGUNG = '0'            and M.BENHVIEN_ID = 'HLU01'            order by M.TENMAU]
2019-08-14 11:19:46,087 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM071']
2019-08-14 11:19:46,126 [5] DEBUG - Statement Id: [DAO00322_GetListMauTonKhoForCreateCached] PreparedStatement : [SELECT DISTINCT          TK.MAU_KEY, TK.KHOMAU_ID, M.MAU_ID, M.MAMAU, M.TENMAU, M.NHOM_ABO, M.NHOM_RH, M.LOAIMAU_ID,          TK.SOLONHAP_ID, SLN.SOLONHAP, SLN.SOKIEMSOAT, TK.NGUONHANG_ID, NG.TENNGUONMAU, M.BENHVIEN_ID, M.DONVITINH_ID,          SUM(tk.SOLUONG) AS SOLUONG,K.TENKHO,DVT.TENDONVITINH          FROM TT_MAU_TONKHO TK          JOIN TM_KHO K ON TK.KHOMAU_ID = K.KHO_ID          JOIN TT_MAU_CHUNGTU_SOLONHAP SLN ON TK.SOLONHAP_ID = SLN.SOLONHAP_ID          JOIN TM_MAU M on TK.MAU_ID = M.MAU_ID and M.TAMNGUNG = '0'          LEFT JOIN TM_MAU_DONVITINH DVT on M.DONVITINH_ID=DVT.DONVITINH_ID          LEFT JOIN TM_NGUONMAU NG ON NG.NGUONMAU_ID = TK.NGUONHANG_ID          WHERE TK.SOLUONG > 0          GROUP BY TK.MAU_KEY, TK.KHOMAU_ID, M.MAU_ID, M.MAMAU, M.TENMAU, M.NHOM_ABO, M.NHOM_RH, M.LOAIMAU_ID,          TK.SOLONHAP_ID, SLN.SOLONHAP, SLN.SOKIEMSOAT,TK.NGUONHANG_ID, NG.TENNGUONMAU, M.BENHVIEN_ID, M.DONVITINH_ID,K.TENKHO,DVT.TENDONVITINH]
2019-08-14 11:19:46,196 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM073']
2019-08-14 11:19:46,231 [5] DEBUG - Statement Id: [DAO00322_GetListMauTonKhoTruBooking] PreparedStatement : [select distinct          TK.MAU_KEY, TK.KHOMAU_ID, M.MAU_ID, M.MAMAU, M.TENMAU, M.NHOM_ABO, M.NHOM_RH, M.LOAIMAU_ID, M.DONVITINH_ID,          TK.SOLONHAP_ID, TK.SOLONHAP, TK.SOKIEMSOAT,M.PHAMVI, TK.NGUONHANG_ID, NG.TENNGUONMAU, M.BENHVIEN_ID,          TK.SOLUONG,TK.TENKHO,DVT.TENDONVITINH          from TM_MAU M          JOIN          (          select          A.MAU_KEY, A.KHOMAU_ID, A.MAU_ID ,a.NGUONHANG_ID, A.SOLONHAP_ID, A.SOLONHAP, A.SOKIEMSOAT, A.SOLUONG,A.TENKHO          from          (          select KHOMAU_ID, TK.MAU_ID, TK.NGUONHANG_ID, TK.MAU_KEY, SLN.SOLONHAP_ID, SLN.SOLONHAP, SLN.SOKIEMSOAT, ISNULL(TK.SOLUONG,0) - ISNULL(book.SOLUONG,0) as SOLUONG,K.TENKHO          from TT_MAU_TONKHO TK          JOIN TM_KHO K ON TK.KHOMAU_ID = K.KHO_ID          inner join TT_MAU_CHUNGTU_SOLONHAP SLN ON TK.SOLONHAP_ID = SLN.SOLONHAP_ID          left join dbo.TT_MAU_TONKHO_BOOK book ON book.MAU_KEY = TK.MAU_KEY AND book.TRANGTHAI = 'HIEULUC'          where ISNULL(TK.SOLUONG,0) - ISNULL(book.SOLUONG,0) > 0          ) A          )TK on TK.MAU_ID = M.MAU_ID and M.TAMNGUNG = '0'          LEFT JOIN TM_MAU_DONVITINH DVT on M.DONVITINH_ID=DVT.DONVITINH_ID          LEFT JOIN TM_NGUONMAU NG ON NG.NGUONMAU_ID = TK.NGUONHANG_ID]
2019-08-14 11:19:46,363 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM072']
2019-08-14 11:19:47,636 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'MAIN'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2019-08-14 11:19:53,286 [1] DEBUG - Statement Id: [DAO00002_FormList] PreparedStatement : [select              TM_SYS_FORM.HOSPITAL_ID,              TM_SYS_FORM.NAME,              TM_SYS_FORM.CLASS,              TM_SYS_FORM.ASSEMBLY,              TM_SYS_FORM.TITLE_VI as TITLE              from TM_SYS_FORM              where HOSPITAL_ID = 'HLU01']
2019-08-14 11:20:06,057 [1] DEBUG - Statement Id: [DAO00300_GetShortcutListByUserID] PreparedStatement : [SELECT S.SHORTCUT_CODE, S.SHORTCUT_VALUE              FROM TM_SHORTCUT AS S              WHERE S.BENHVIEN_ID = 'HLU01' AND S.USER_ID = '1' AND TAMNGUNG = '0']
2019-08-14 11:20:06,240 [1] DEBUG - Statement Id: [DAO00087_GetList] PreparedStatement : [select CODE, VALUE, BENHVIEN_ID              from TM_SYS_APPSETTINGS              where LOCKED = '0' and BENHVIEN_ID = 'HLU01'              order by SETTING_ID]
2019-08-14 11:20:06,348 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'MSG01'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2019-08-14 11:20:06,585 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'MSG02'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2019-08-14 11:20:07,388 [1] DEBUG - Statement Id: [DAO00008_GetUserSettings] PreparedStatement : [select A.*, B.TENKHO , C.TENPHONGBAN, B.MAKHO, C.MAPHONGBAN          from TM_SYS_USERS A          left join TM_KHODUOC B on B.KHODUOC_ID = A.INVENTORY_ID          left join TM_PHONGBAN C on (C.PHONGBAN_ID = A.WORKING_DEPT_ID and C.BENHVIEN_ID =  @param0 )          left join TM_SYS_USERKHO D on (D.ACCOUNT_ID = A.ACCOUNT_ID and D.HOSPITAL_ID =  @param0 )          where          A.HOSPITAL_ID =  @param0            and                 A.ACCOUNT_ID =  @param1]
2019-08-14 11:20:07,441 [1] DEBUG - Statement Id: [DAO00008_GetUserSettings] Parameters: [@param0=[HOSPITAL_ID,HLU01], @param1=[ACCOUNT_ID,113]]
2019-08-14 11:20:07,441 [1] DEBUG - Statement Id: [DAO00008_GetUserSettings] Types: [@param0=[String, System.String], @param1=[String, System.String]]
2019-08-14 11:20:07,553 [1] DEBUG - Statement Id: [DAO00008_GetUserInvSettings] PreparedStatement : [select A.*, B.TENKHO, B.MAKHO, B.LOAIKHO_ID, B.KHOQUANLY_ID          from TM_SYS_USERKHO A          left join TM_KHO B on B.MODULE_ID = A.MODULE_ID and B.KHO_ID = A.KHO_ID          where A.HOSPITAL_ID =  @param0  and A.ACCOUNT_ID =  @param1           order by B.TENKHO]
2019-08-14 11:20:07,553 [1] DEBUG - Statement Id: [DAO00008_GetUserInvSettings] Parameters: [@param0=[HOSPITAL_ID,HLU01], @param1=[ACCOUNT_ID,113]]
2019-08-14 11:20:07,553 [1] DEBUG - Statement Id: [DAO00008_GetUserInvSettings] Types: [@param0=[String, System.String], @param1=[String, System.String]]
2019-08-14 11:20:08,287 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'COM30'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2019-08-14 11:20:09,384 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'RIS04'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2019-08-14 11:20:38,517 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'MENU1'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2019-08-14 11:20:38,782 [1] DEBUG - Statement Id: [DAO00011_GetList] PreparedStatement : [select              TM_SYS_MENU.ID,              TM_SYS_MENU.PARENTID,              TM_SYS_MENU.SCREEN,              TM_SYS_MENU.SMALLIMAGE,              TM_SYS_MENU.LARGEIMAGE,              TM_SYS_MENU.DESCRIPTION,              TM_SYS_MENU.TYPE,              TM_SYS_MENU.TITLE_VI as TITLE              from TM_SYS_MENU              where TM_SYS_MENU.HOSPITAL_ID = 'HLU01' and TM_SYS_MENU.ACTIVE = '1'               AND                   (TM_SYS_MENU.TYPE & '8' = '8')                             order by TM_SYS_MENU.ORDERNUM]
2019-08-14 11:20:39,586 [1] DEBUG - Statement Id: [DAO00011_usermenu_list] PreparedStatement : [select              TM_SYS_HOMEMENU.MENUID as ID,              TM_SYS_MENU.TITLE_VI as TITLE,              TM_SYS_MENU.SCREEN,              TM_SYS_MENU.SMALLIMAGE,              TM_SYS_MENU.LARGEIMAGE,              TM_SYS_MENU.TYPE              from TM_SYS_HOMEMENU              left join TM_SYS_MENU on TM_SYS_MENU.ID = TM_SYS_HOMEMENU.MENUID and TM_SYS_MENU.HOSPITAL_ID = TM_SYS_HOMEMENU.HOSPITAL_ID              where TM_SYS_HOMEMENU.HOSPITAL_ID = 'HLU01' and TM_SYS_HOMEMENU.USERID = '113' and TM_SYS_MENU.ACTIVE = '1'               AND                   (TM_SYS_MENU.TYPE & '8' = '8')                             ORDER BY TM_SYS_HOMEMENU.ORDERNUM]
2019-08-14 11:24:05,160 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'COM98'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2019-08-14 11:24:06,466 [1] DEBUG - Statement Id: [DAO00020_ListKhoDuocOfPhongBan] PreparedStatement : [select B.* from TM_PHONGBAN_KHODUOC A        inner join TM_KHODUOC B on B.KHODUOC_ID = A.KHODUOC_ID        where        A.PHONGBAN_ID = '20'        and A.BENHVIEN_ID = 'HLU01']
2019-08-14 11:24:11,451 [1] DEBUG - Statement Id: [DAO00020_ListKhoDuocOfPhongBan] PreparedStatement : [select B.* from TM_PHONGBAN_KHODUOC A        inner join TM_KHODUOC B on B.KHODUOC_ID = A.KHODUOC_ID        where        A.PHONGBAN_ID = '61'        and A.BENHVIEN_ID = 'HLU01']
2019-08-14 11:24:12,092 [1] DEBUG - Statement Id: [DAO00008_UpdateUserIdPhongBanKhoDuoc] PreparedStatement : [IF EXISTS            (SELECT ACCOUNT_ID FROM TM_SYS_USERS WHERE ACCOUNT_ID =  @param0  and HOSPITAL_ID =  @param1 )            BEGIN            update TM_SYS_USERS set INVENTORY_ID =  @param2 , WORKING_DEPT_ID =  @param3             WHERE ACCOUNT_ID =  @param0  and HOSPITAL_ID =  @param1             END            ELSE            BEGIN            insert into TM_SYS_USERS ([ACCOUNT_ID], [ACCOUNT_NAME], [INVENTORY_ID], [WORKING_DEPT_ID], [HOSPITAL_ID])            values ( @param0 ,  @param4 ,  @param2 ,  @param3 ,  @param1 )            END]
2019-08-14 11:24:12,092 [1] DEBUG - Statement Id: [DAO00008_UpdateUserIdPhongBanKhoDuoc] Parameters: [@param0=[ACCOUNT_ID,113], @param1=[HOSPITAL_ID,HLU01], @param2=[INVENTORY_ID,null], @param3=[WORKING_DEPT_ID,61], @param4=[ACCOUNT_NAME,admin]]
2019-08-14 11:24:12,092 [1] DEBUG - Statement Id: [DAO00008_UpdateUserIdPhongBanKhoDuoc] Types: [@param0=[String, System.String], @param1=[String, System.String], @param2=[System.DBNull, null], @param3=[String, System.String], @param4=[String, System.String]]
2019-08-14 11:24:16,286 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'OPD02'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2019-08-14 11:24:18,826 [1] DEBUG - Statement Id: [DAO00012_GetList] PreparedStatement : [select        DICTIONARY_ID,        DICTIONARY_CODE,        DICTIONARY_NAME,        ATTRIBUTE1,        ATTRIBUTE2,        DICTIONARY_NAME_EN        from LST_DICTIONARY        where LST_DICTIONARY.Enabled = '1'         AND           LST_DICTIONARY.DICTIONARY_TYPE_CODE = 'GiaiQuyetKhamBenh'                 order by LST_DICTIONARY.IDX]
2019-08-14 11:24:19,172 [1] DEBUG - Statement Id: [DAO00012_GetList] PreparedStatement : [select        DICTIONARY_ID,        DICTIONARY_CODE,        DICTIONARY_NAME,        ATTRIBUTE1,        ATTRIBUTE2,        DICTIONARY_NAME_EN        from LST_DICTIONARY        where LST_DICTIONARY.Enabled = '1'         AND           LST_DICTIONARY.DICTIONARY_TYPE_CODE = 'LyDoNhapVien'                 order by LST_DICTIONARY.IDX]
2019-08-14 11:24:19,443 [1] DEBUG - Statement Id: [DAO00012_GetList] PreparedStatement : [select        DICTIONARY_ID,        DICTIONARY_CODE,        DICTIONARY_NAME,        ATTRIBUTE1,        ATTRIBUTE2,        DICTIONARY_NAME_EN        from LST_DICTIONARY        where LST_DICTIONARY.Enabled = '1'         AND           LST_DICTIONARY.DICTIONARY_TYPE_CODE = 'CachDung'                 order by LST_DICTIONARY.IDX]
2019-08-14 11:24:21,636 [1] DEBUG - Statement Id: [DAO00017_GetLoaiGiaByDoiTuongId] PreparedStatement : [select dtlg.DOUUTIEN, dtlg.DOITUONG_ID, lg.LOAIGIA_ID, lg.TENLOAIGIA, lg.MALOAIGIA              from TM_LOAIGIA lg              left join TM_DOITUONG_LOAIGIA dtlg              on lg.LOAIGIA_ID = dtlg.LOAIGIA_ID and dtlg.BENHVIEN_ID = 'HLU01'              where lg.TAMNGUNG = 0 and lg.BENHVIEN_ID = 'HLU01'                             order by dtlg.DOUUTIEN]
2019-08-14 11:24:22,193 [1] DEBUG - Statement Id: [DAO00092_GetList_ToathuocNgoaitru] PreparedStatement : [select A.*, B.PHAMVI_ID, C.KHODUOC_ID from TM_TOATHUOC_NGOAITRU A        left join TM_DUOC_PHAMVISUDUNG B on B.MAPHAMVI = A.MAPHAMVI        left join (select distinct PHAMVI_ID, KHODUOC_ID from TM_DUOC_PHAMVISD_MAPPING) C on C.PHAMVI_ID = B.PHAMVI_ID        where A.TAMNGUNG != '1' and A.BENHVIEN_ID = 'HLU01'        ORDER BY A.SAPXEP ASC]
2019-08-14 11:24:37,462 [1] DEBUG - Statement Id: [DAO00009_TT_TIEPNHAN_GetProcess] PreparedStatement : [select PROCESS_ID from TT_TIEPNHAN where SOTIEPNHAN = 'TN190419.0000335']
2019-08-14 11:24:40,370 [1] DEBUG - Statement Id: [DAOWF004_laytrangthaiDV] PreparedStatement : [select top 1 A.CURR_STATE_CODE as STATE_CODE, isNull(C.SHORT_NAME,C.NAME) as TRANGTHAI, C.NAME as TRANGTHAI_CHITIET, C.STATUS_CODE, D.ISACTIVE as ACTIVE, E.STATUS_CODE  as OLD_STATUSCODE        from TT_REQUEST_SERVICE_DETAIL A                left join (select * from TT_REQUEST_SERVICE where PARA = '{"DICHVU_ID":"5436","DVYEUCAU_ID":"67614"}') D on D.ID = A.REQUEST_SERVICE_ID        left join TM_STATE C on A.CURR_STATE_CODE = C.STATE_CODE and C.PROCESS_CODE = D.PROCESS_CODE        left join TM_STATE E on A.OLD_STATE_CODE = E.STATE_CODE and E.PROCESS_CODE = D.PROCESS_CODE        where        A.REQUEST_SERVICE_ID = (select top 1 ID from TT_REQUEST_SERVICE where PARA = '{"DICHVU_ID":"5436","DVYEUCAU_ID":"67614"}' order by ID desc)        order by A.ID desc]
2019-08-14 11:24:47,410 [1] DEBUG - Statement Id: [DAO00017_GetLoaiGiaByDoiTuongId] PreparedStatement : [select dtlg.DOUUTIEN, dtlg.DOITUONG_ID, lg.LOAIGIA_ID, lg.TENLOAIGIA, lg.MALOAIGIA              from TM_LOAIGIA lg              left join TM_DOITUONG_LOAIGIA dtlg              on lg.LOAIGIA_ID = dtlg.LOAIGIA_ID and dtlg.BENHVIEN_ID = 'HLU01'              where lg.TAMNGUNG = 0 and lg.BENHVIEN_ID = 'HLU01'                             order by dtlg.DOUUTIEN]
2019-08-14 11:24:47,498 [1] DEBUG - Statement Id: [DAO00087_GetServiceParams] PreparedStatement : [select CODE, VALUE              from TM_SYS_APPSETTINGS              where LOCKED = '0' and BENHVIEN_ID = 'HLU01']
2019-08-14 11:24:47,599 [1] DEBUG - Statement Id: [DAO00014_KiemTraDVYCCoBHYT] PreparedStatement : [select *        from TT_VIENPHI        where REF_ID  = '67614' and REF_TABLE = 'TT_DVYEUCAU' and BHYT_DONGIA > 0]
2019-08-14 11:24:47,797 [1] DEBUG - Statement Id: [DAO00040_LayListToaMau] PreparedStatement : [select A.*, dc.TENDUOCDAYDU, dc.BHYT DUOC_BHYT, ld.LOAIVATTU_ID, ld.MALOAIDUOC, dd.DICTIONARY_NAME DUONGDUNG, dc.TAMNGUNG            from TT_TOATHUOCMAU A            left join TM_DUOC dc on A.DUOC_ID = dc.DUOC_ID            left join TM_LOAIDUOC ld on dc.LOAIDUOC_ID = ld.LOAIDUOC_ID            left join (select * from LST_DICTIONARY where DICTIONARY_TYPE_CODE like 'DuongDung') dd on dd.DICTIONARY_ID = dc.DUONGDUNG_ID            where (1=1)             and               A.BACSI_ID  = 1              and A.LOAITOATHUOC in  (                        @param0                   ,                           @param1                   ,                           @param2                   ,                           @param3                   )]
2019-08-14 11:24:47,798 [1] DEBUG - Statement Id: [DAO00040_LayListToaMau] Parameters: [@param0=[LSTLOAITOATHUOC[0],BV], @param1=[LSTLOAITOATHUOC[1],MN], @param2=[LSTLOAITOATHUOC[2],MP], @param3=[LSTLOAITOATHUOC[3],TV]]
2019-08-14 11:24:47,798 [1] DEBUG - Statement Id: [DAO00040_LayListToaMau] Types: [@param0=[String, System.String], @param1=[String, System.String], @param2=[String, System.String], @param3=[String, System.String]]
2019-08-14 11:24:54,498 [1] DEBUG - Statement Id: [DAO00040_LayListToaMau] PreparedStatement : [select A.*, dc.TENDUOCDAYDU, dc.BHYT DUOC_BHYT, ld.LOAIVATTU_ID, ld.MALOAIDUOC, dd.DICTIONARY_NAME DUONGDUNG, dc.TAMNGUNG            from TT_TOATHUOCMAU A            left join TM_DUOC dc on A.DUOC_ID = dc.DUOC_ID            left join TM_LOAIDUOC ld on dc.LOAIDUOC_ID = ld.LOAIDUOC_ID            left join (select * from LST_DICTIONARY where DICTIONARY_TYPE_CODE like 'DuongDung') dd on dd.DICTIONARY_ID = dc.DUONGDUNG_ID            where (1=1)             and               A.BACSI_ID  = 1              and A.LOAITOATHUOC in  (                        @param0                   ,                           @param1                   ,                           @param2                   ,                           @param3                   )]
2019-08-14 11:24:54,498 [1] DEBUG - Statement Id: [DAO00040_LayListToaMau] Parameters: [@param0=[LSTLOAITOATHUOC[0],BV], @param1=[LSTLOAITOATHUOC[1],MN], @param2=[LSTLOAITOATHUOC[2],MP], @param3=[LSTLOAITOATHUOC[3],TV]]
2019-08-14 11:24:54,498 [1] DEBUG - Statement Id: [DAO00040_LayListToaMau] Types: [@param0=[String, System.String], @param1=[String, System.String], @param2=[String, System.String], @param3=[String, System.String]]
2019-08-14 11:24:54,554 [1] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoVaBookingCOM23UpdateRedis_TheoPhamvi] PreparedStatement : [select distinct tk.DUOC_KEY, tk.SOLUONG        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        inner join        (        select  LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')) DUOC_KEY, (SUM(dtk.SOLUONG) - isnull(sum(A.SOLUONG),0) - isnull(sum(B.SOLUONG),0)) SOLUONG, pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        from (select sum(soluong) soluong,duoc_id,nguonduoc_id,khoduoc_id,benhvien_id from TT_DUOC_TONKHO  group by duoc_id,nguonduoc_id,khoduoc_id,benhvien_id) dtk        inner join TM_DUOC_PHAMVISD_MAPPING pvsd on dtk.KHODUOC_ID = pvsd.KHODUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NOITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) B on B.DUOC_ID = dtk.DUOC_ID and B.SOLUONG > 0 and B.PHAMVI_ID = pvsd.PHAMVI_ID and B.NGUONHANG_ID = dtk.NGUONDUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NGOAITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) A on A.DUOC_ID = dtk.DUOC_ID and A.SOLUONG > 0 and A.PHAMVI_ID = pvsd.PHAMVI_ID and A.NGUONHANG_ID = dtk.NGUONDUOC_ID        where dtk.SOLUONG > 0 and dtk.BENHVIEN_ID = 'HLU01'        group by LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')), pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        ) tk on tk.DUOC_ID = d.DUOC_ID        left join TM_DUOC_PHAMVISUDUNG kd on kd.PHAMVI_ID = tk.PHAMVI_ID and kd.BENHVIEN_ID = 'HLU01'        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = tk.NGUONDUOC_ID and nh.BENHVIEN_ID = 'HLU01'        where  d.BENHVIEN_ID = 'HLU01' and tk.PHAMVI_ID =  @param0]
2019-08-14 11:24:54,555 [1] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoVaBookingCOM23UpdateRedis_TheoPhamvi] Parameters: [@param0=[PHAMVI_ID,1028]]
2019-08-14 11:24:54,555 [1] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoVaBookingCOM23UpdateRedis_TheoPhamvi] Types: [@param0=[Int64, System.Int64]]
2019-08-14 11:24:55,626 [1] DEBUG - Statement Id: [DAO00013_GetTienSuBenh] PreparedStatement : [select TIENSUBENH, TIENSUDIUNG              from TT_BENHNHAN              where TT_BENHNHAN.BENHNHAN_ID  = '9046']
2019-08-14 11:24:56,396 [1] DEBUG - Statement Id: [DAO00095_GetTTDiUngThuoc] PreparedStatement : [select *              from TT_BENHNHAN_DIUNG_THUOC              where BENHNHAN_ID = '9046'              and BENHVIEN_ID = 'HLU01']
2019-08-14 11:24:56,425 [1] DEBUG - Statement Id: [DAO00014_GetTotalChiPhiDVByTiepNhan] PreparedStatement : [select sum(THANHTIEN_DOANHTHU) as THANHTIEN_DOANHTHU from TT_VIENPHI        where ACTIVE = '1'        and TIEPNHAN_ID = '9383'        and REF_TABLE = 'TT_DVYEUCAU'        and exists (select DVYEUCAU_ID from TT_DVYEUCAU where HUYYEUCAU = '0' and TIEPNHAN_ID = '9383' and TT_VIENPHI.REF_ID = DVYEUCAU_ID)]
2019-08-14 11:24:56,597 [1] DEBUG - Statement Id: [DAO00014_GetKhamBenhInfo] PreparedStatement : [select * from TT_NGOAITRU_KHAMBENH where KHAMBENH_ID =        (select KHAMBENH_NGOAITRU_ID from TT_DVYEUCAU where DVYEUCAU_ID = '67614')]
2019-08-14 11:24:57,150 [1] DEBUG - Statement Id: [DAO00014_GetSoCaKhamTrongNgay] PreparedStatement : [select Count(KB.KHAMBENH_ID) as SOCAKHAMTRONGNGAY        from TT_NGOAITRU_KHAMBENH KB        inner join TT_TIEPNHAN TN on TN.TIEPNHAN_ID = KB.TIEPNHAN_ID        where KB.NGAYKHAM = convert(date, GETDATE())        and KB.BACSIKHAM_ID = '1'        and KB.BENHVIEN_ID = 'HLU01'        and TN.SOBHYT IS NOT NULL and TN.SOBHYT != '']
2019-08-14 11:25:03,876 [1] DEBUG - Statement Id: [DAO00068_GetLastedSinhHieuInfo] PreparedStatement : [select top (1) *, CHISOBMI as BMI              from TT_NGOAITRU_KHAMBENH_SINHHIEU              where BENHNHAN_ID = '9046'              order by KHAMBENH_SINHHIEU_ID desc]
2019-08-14 11:25:04,100 [1] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoVaBookingCOM23UpdateRedis_TheoPhamvi] PreparedStatement : [select distinct tk.DUOC_KEY, tk.SOLUONG        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        inner join        (        select  LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')) DUOC_KEY, (SUM(dtk.SOLUONG) - isnull(sum(A.SOLUONG),0) - isnull(sum(B.SOLUONG),0)) SOLUONG, pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        from (select sum(soluong) soluong,duoc_id,nguonduoc_id,khoduoc_id,benhvien_id from TT_DUOC_TONKHO  group by duoc_id,nguonduoc_id,khoduoc_id,benhvien_id) dtk        inner join TM_DUOC_PHAMVISD_MAPPING pvsd on dtk.KHODUOC_ID = pvsd.KHODUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NOITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) B on B.DUOC_ID = dtk.DUOC_ID and B.SOLUONG > 0 and B.PHAMVI_ID = pvsd.PHAMVI_ID and B.NGUONHANG_ID = dtk.NGUONDUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NGOAITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) A on A.DUOC_ID = dtk.DUOC_ID and A.SOLUONG > 0 and A.PHAMVI_ID = pvsd.PHAMVI_ID and A.NGUONHANG_ID = dtk.NGUONDUOC_ID        where dtk.SOLUONG > 0 and dtk.BENHVIEN_ID = 'HLU01'        group by LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')), pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        ) tk on tk.DUOC_ID = d.DUOC_ID        left join TM_DUOC_PHAMVISUDUNG kd on kd.PHAMVI_ID = tk.PHAMVI_ID and kd.BENHVIEN_ID = 'HLU01'        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = tk.NGUONDUOC_ID and nh.BENHVIEN_ID = 'HLU01'        where  d.BENHVIEN_ID = 'HLU01' and tk.PHAMVI_ID =  @param0]
2019-08-14 11:25:04,100 [1] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoVaBookingCOM23UpdateRedis_TheoPhamvi] Parameters: [@param0=[PHAMVI_ID,1028]]
2019-08-14 11:25:04,100 [1] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoVaBookingCOM23UpdateRedis_TheoPhamvi] Types: [@param0=[Int64, System.Int64]]
--------------------------------------------------------------------------------
2019-08-14 11:36:40,290 [1] DEBUG - Statement Id: [DAO00001_DBList] PreparedStatement : [select *              from TM_SYS_SERVER              where HOSPITAL_ID = '_SYSTEM_' and TYPE = 'D']
2019-08-14 11:36:40,585 [1] DEBUG - Statement Id: [DAO00001_DaoList] PreparedStatement : [select              TM_SYS_SERVICEMAP.ID,              TM_SYS_SERVICEMAP.HOSPITAL_ID,              TM_SYS_SERVICEMAP.DB_NAME,              TM_SYS_SERVICEMAP.TYPE,              TM_SYS_SERVICEMAP.NAME,              TM_SYS_SERVICEMAP.CLASS,              (TM_SYS_DIC.VALUE + '.' + TM_SYS_SERVICEMAP.CLASS) as CLASSFULL,              TM_SYS_SERVICEMAP.ASSEMBLY              from TM_SYS_SERVICEMAP              inner join TM_SYS_DIC              on TM_SYS_SERVICEMAP.NAMESPACE = TM_SYS_DIC.ID              where HOSPITAL_ID = '_SYSTEM_' AND TYPE = 'D' AND ACTIVE = '1'              order by DB_NAME]
2019-08-14 11:36:40,622 [1] DEBUG - Statement Id: [DAO00001_ServiceList] PreparedStatement : [select              TM_SYS_SERVICEMAP.ID,              TM_SYS_SERVICEMAP.HOSPITAL_ID,              TM_SYS_SERVICEMAP.DB_NAME,              TM_SYS_SERVICEMAP.TYPE,              TM_SYS_SERVICEMAP.NAME,              TM_SYS_SERVICEMAP.CLASS,              (TM_SYS_DIC.VALUE + '.' + TM_SYS_SERVICEMAP.CLASS) as CLASSFULL,              TM_SYS_SERVICEMAP.ASSEMBLY,              TM_SYS_SERVER.URL              from TM_SYS_SERVICEMAP              inner join TM_SYS_DIC on TM_SYS_SERVICEMAP.NAMESPACE = TM_SYS_DIC.ID              inner join TM_SYS_SERVER on (TM_SYS_SERVICEMAP.DB_NAME = TM_SYS_SERVER.NAME) and (TM_SYS_SERVER.HOSPITAL_ID = '_SYSTEM_')              where TM_SYS_SERVICEMAP.HOSPITAL_ID = '_SYSTEM_' AND TM_SYS_SERVICEMAP.TYPE = 'S'  AND ACTIVE = '1'              order by URL]
2019-08-14 11:36:41,340 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = '_SYSTEM_'               AND                   TM_SYS_SCREEN.PAGE = 'LOGIN'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2019-08-14 11:36:41,615 [1] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = '_SYSTEM_'               AND                   TM_SYS_CACHE.ACTIVE = '1']
2019-08-14 11:36:48,107 [1] DEBUG - Statement Id: [DAO00001_DBList] PreparedStatement : [select *              from TM_SYS_SERVER              where HOSPITAL_ID = 'HLU01' and TYPE = 'D']
2019-08-14 11:36:48,140 [1] DEBUG - Statement Id: [DAO00001_DaoList] PreparedStatement : [select              TM_SYS_SERVICEMAP.ID,              TM_SYS_SERVICEMAP.HOSPITAL_ID,              TM_SYS_SERVICEMAP.DB_NAME,              TM_SYS_SERVICEMAP.TYPE,              TM_SYS_SERVICEMAP.NAME,              TM_SYS_SERVICEMAP.CLASS,              (TM_SYS_DIC.VALUE + '.' + TM_SYS_SERVICEMAP.CLASS) as CLASSFULL,              TM_SYS_SERVICEMAP.ASSEMBLY              from TM_SYS_SERVICEMAP              inner join TM_SYS_DIC              on TM_SYS_SERVICEMAP.NAMESPACE = TM_SYS_DIC.ID              where HOSPITAL_ID = 'HLU01' AND TYPE = 'D' AND ACTIVE = '1'              order by DB_NAME]
2019-08-14 11:36:50,408 [1] DEBUG - Statement Id: [DAO00001_ServiceList] PreparedStatement : [select              TM_SYS_SERVICEMAP.ID,              TM_SYS_SERVICEMAP.HOSPITAL_ID,              TM_SYS_SERVICEMAP.DB_NAME,              TM_SYS_SERVICEMAP.TYPE,              TM_SYS_SERVICEMAP.NAME,              TM_SYS_SERVICEMAP.CLASS,              (TM_SYS_DIC.VALUE + '.' + TM_SYS_SERVICEMAP.CLASS) as CLASSFULL,              TM_SYS_SERVICEMAP.ASSEMBLY,              TM_SYS_SERVER.URL              from TM_SYS_SERVICEMAP              inner join TM_SYS_DIC on TM_SYS_SERVICEMAP.NAMESPACE = TM_SYS_DIC.ID              inner join TM_SYS_SERVER on (TM_SYS_SERVICEMAP.DB_NAME = TM_SYS_SERVER.NAME) and (TM_SYS_SERVER.HOSPITAL_ID = 'HLU01')              where TM_SYS_SERVICEMAP.HOSPITAL_ID = 'HLU01' AND TM_SYS_SERVICEMAP.TYPE = 'S'  AND ACTIVE = '1'              order by URL]
2019-08-14 11:36:50,519 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1']
2019-08-14 11:36:51,434 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM005']
2019-08-14 11:36:54,471 [13] DEBUG - Statement Id: [DAO00013_GetListChiaSeBenhNhan_Total] PreparedStatement : [select count(*) as TOTALROWS              from TT_BENHNHAN A              where  A.ACTIVE = '1']
2019-08-14 11:37:00,249 [13] DEBUG - Statement Id: [DAO00013_GetListChiaSeBenhNhan] PreparedStatement : [select * from              (              select ROW_NUMBER() OVER(order by a.MAYTE) as ROWNUMBER, *,              CASE              WHEN A.GIOITINH = 1 THEN 'Nam'              WHEN A.GIOITINH = 2 THEN N'Nữ'              END as TENGIOITINH              from TT_BENHNHAN A              where  ACTIVE = '1') lst where lst.ROWNUMBER between 1 and 200000]
2019-08-14 11:37:29,483 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM015']
2019-08-14 11:37:30,614 [10] DEBUG - Statement Id: [DAO00027_GetListTiepNhanCOM015] PreparedStatement : [SELECT * FROM        (        SELECT        (A.SOTIEPNHAN + (CASE WHEN Left(E.MANHOMDICHVU,2) = '03' THEN '02' ELSE Left(E.MANHOMDICHVU,2) END) + LTRIM(C.NOITHUCHIEN_ID)) AS acss_lookupID,        ROW_NUMBER() OVER        (PARTITION BY (A.SOTIEPNHAN + (CASE WHEN Left(E.MANHOMDICHVU,2) = '03' THEN '02' ELSE Left(E.MANHOMDICHVU,2) END) + LTRIM(C.NOITHUCHIEN_ID))        ORDER BY (A.SOTIEPNHAN + (CASE WHEN Left(E.MANHOMDICHVU,2) = '03' THEN '02' ELSE Left(E.MANHOMDICHVU,2) END) + LTRIM(C.NOITHUCHIEN_ID)))        as num,        A.SOTIEPNHAN + (CASE WHEN Left(E.MANHOMDICHVU,2) = '03' THEN '02' ELSE Left(E.MANHOMDICHVU,2) END) + LTRIM(C.NOITHUCHIEN_ID) as KEYCOM15,        C.NOITHUCHIEN_ID, A.SOTIEPNHAN, A.TRAITUYEN, A.NGAYMIENDONGCHITRA, A.TIEPNHAN_ID, A.DOITUONG_ID, A.TRANGTHAI,        A.LOAITHANHVIEN_ID, A.SUDUNG_BHTN, A.THE_ID, A.THANHVIEN_ID, A.VIP, A.NGUON_BENHNHAN_ID, A.BAOLANH_VIENPHI,        CASE WHEN (A.TRANGTHAI = 'NOITRU' OR A.TRANGTHAI = 'CAPCUU') THEN 'IN' ELSE 'OUT' END AS LOAIBENHAN,        CASE WHEN (C.TRANGTHAI = 'CHUAKETQUA') THEN 'CHUAKETQUA' ELSE 'HOANTAT' END AS TRANGTHAIDICHVU, A.SOBHYT,        B.*, F.TRANGTHAI as TRANGTHAI_BENHAN_NOITRU,        CASE WHEN Left(E.MANHOMDICHVU,2) = '03' THEN '02' ELSE Left(E.MANHOMDICHVU,2) END AS MANHOMDICHVU        , A.UUTIEN        from TT_TIEPNHAN A        inner join TT_BENHNHAN B on B.BENHNHAN_ID = A.BENHNHAN_ID and (A.TRANGTHAI = 'DATIEPNHAN' or A.TRANGTHAI = 'NOITRU' or A.TRANGTHAI = 'CAPCUU' or A.TRANGTHAI = 'NGOAITRU') and B.ACTIVE = '1'        inner join TT_DVYEUCAU C on C.TIEPNHAN_ID = A.TIEPNHAN_ID        left join TM_DICHVU D on D.DICHVU_ID = C.DICHVU_ID        left join TM_NHOMDICHVU E on E.NHOMDICHVU_ID = D.NHOMDICHVU_ID        left join TT_NOITRU_BENHAN F on F.TIEPNHAN_ID = A.TIEPNHAN_ID        where C.NGAYHENCLS is NULL and A.BENHVIEN_ID = 'HLU01'        ) a WHERE a.num = 1]
2019-08-14 11:37:55,182 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM067']
2019-08-14 11:37:56,248 [15] DEBUG - Statement Id: [DAO00117_GetList] PreparedStatement : [select A.*              from TT_NGOAITRU_TOATHUOC_NGUOIMUA A]
2019-08-14 11:37:57,935 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM008']
2019-08-14 11:37:59,263 [14] DEBUG - Statement Id: [DAO00027_GetListTiepNhanNoiTru] PreparedStatement : [select distinct B.*, C.SOBENHAN, C.BENHAN_ID, A.SOTIEPNHAN, A.TRAITUYEN, A.NGAYMIENDONGCHITRA, A.TIEPNHAN_ID,        isnull(C.KHOACHUYENDEN_ID,C.KHOAVAO_ID) as KHOACHUYENDEN_ID, A.TRANGTHAI, A.DOITUONG_ID, C.TRANGTHAI as TRANGTHAI_BENHAN,        A.LOAITHANHVIEN_ID, A.SUDUNG_BHTN, A.THE_ID, A.THANHVIEN_ID, A.VIP, A.NGUON_BENHNHAN_ID, A.BAOLANH_VIENPHI, A.SOBHYT,        CASE WHEN RIGHT(C.SOBENHAN,2) = 'CC' THEN 'CC' ELSE 'NT' END AS LOAIBENHAN, CONVERT(VARCHAR(11), C.NGAYVAOKHOA,103) as NGAYVAOKHOA        , A.UUTIEN                from TT_TIEPNHAN A        inner join TT_BENHNHAN B on B.BENHNHAN_ID = A.BENHNHAN_ID and (A.TRANGTHAI = 'CAPCUU' or A.TRANGTHAI = 'NOITRU' or A.TRANGTHAI = 'HOANTHANH' or A.TRANGTHAI = 'NGOAITRU') and B.ACTIVE = '1'        inner join TT_NOITRU_BENHAN C on C.TIEPNHAN_ID = A.TIEPNHAN_ID and (C.TRANGTHAI='DAXUATVIEN' or C.TRANGTHAI='DATHANHTOAN' OR C.TRANGTHAI='DANGDIEUTRI')                where A.BENHVIEN_ID = 'HLU01' and C.LOAIBENHAN != 2]
2019-08-14 11:38:00,702 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM068']
2019-08-14 11:38:01,923 [18] DEBUG - Statement Id: [DAO00027_GetListCacheTiepNhanNgoaiTru] PreparedStatement : [select distinct B.*, C.SOBENHAN, C.BENHAN_ID, A.SOTIEPNHAN, A.TRAITUYEN, A.NGAYMIENDONGCHITRA, A.TIEPNHAN_ID,        isnull(C.KHOACHUYENDEN_ID,C.KHOAVAO_ID) as KHOACHUYENDEN_ID, A.TRANGTHAI, A.DOITUONG_ID, C.TRANGTHAI as TRANGTHAI_BENHAN,        A.LOAITHANHVIEN_ID, A.SUDUNG_BHTN, A.THE_ID, A.THANHVIEN_ID, A.VIP, A.NGUON_BENHNHAN_ID, A.BAOLANH_VIENPHI,        'NGOAITRU' AS LOAIBENHAN, CONVERT(VARCHAR(11),C.NGAYVAOKHOA,103) as NGAYVAOKHOA, A.SOBHYT        , A.UUTIEN        from TT_TIEPNHAN A        inner join TT_BENHNHAN B on B.BENHNHAN_ID = A.BENHNHAN_ID and (A.TRANGTHAI = 'HOANTHANH' or A.TRANGTHAI = 'NGOAITRU') and B.ACTIVE = '1'        inner join TT_NOITRU_BENHAN C on C.TIEPNHAN_ID = A.TIEPNHAN_ID and (C.TRANGTHAI='DAXUATVIEN' or C.TRANGTHAI='DATHANHTOAN' OR C.TRANGTHAI='DANGDIEUTRI')        where A.BENHVIEN_ID = 'HLU01' and C.LOAIBENHAN = 2]
2019-08-14 11:38:02,608 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM006']
2019-08-14 11:38:03,869 [18] DEBUG - Statement Id: [DAO00027_GetListTiepNhan] PreparedStatement : [select distinct CONVERT(VARCHAR(11),C.NGAYYEUCAU,103) as NGAYYEUCAU, C.DICHVU_ID, C.DVYEUCAU_ID, D.TENDICHVU, C.NOITHUCHIEN_ID, A.SOTIEPNHAN, A.TRAITUYEN, A.NGAYMIENDONGCHITRA, A.TIEPNHAN_ID, A.DOITUONG_ID, A.TRANGTHAI,        A.LOAITHANHVIEN_ID, A.SUDUNG_BHTN, A.THE_ID, A.THANHVIEN_ID, A.VIP, A.NGUON_BENHNHAN_ID, A.BAOLANH_VIENPHI,        CASE WHEN (A.TRANGTHAI = 'NOITRU' OR A.TRANGTHAI = 'CAPCUU' OR A.TRANGTHAI = 'NGOAITRU') THEN 'IN' ELSE 'OUT' END AS LOAIBENHAN,        CASE WHEN (C.TRANGTHAI = 'CHUAKETQUA') THEN 'CHUAKETQUA' ELSE 'HOANTAT' END AS TRANGTHAIDICHVU, A.SOBHYT,        B.*,        CASE WHEN Left(E.MANHOMDICHVU,2) = '03' THEN '02' ELSE Left(E.MANHOMDICHVU,2) END AS MANHOMDICHVU        , A.UUTIEN        from TT_TIEPNHAN A        inner join TT_BENHNHAN B on B.BENHNHAN_ID = A.BENHNHAN_ID and (A.TRANGTHAI = 'DATIEPNHAN' or A.TRANGTHAI = 'NOITRU' or A.TRANGTHAI = 'CAPCUU'  or A.TRANGTHAI = 'NGOAITRU') and B.ACTIVE = '1'        inner join TT_DVYEUCAU C on C.TIEPNHAN_ID = A.TIEPNHAN_ID                left join TM_DICHVU D on D.DICHVU_ID = C.DICHVU_ID        left join TM_NHOMDICHVU E on E.NHOMDICHVU_ID = D.NHOMDICHVU_ID        where C.NGAYHENCLS is NULL and A.BENHVIEN_ID = 'HLU01']
2019-08-14 11:38:43,908 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM030']
2019-08-14 11:38:44,927 [11] DEBUG - Statement Id: [DAO00027_GetListTiepNhanAll] PreparedStatement : [select distinct A.SOTIEPNHAN, A.TRAITUYEN, A.NGAYMIENDONGCHITRA, A.TIEPNHAN_ID, A.DOITUONG_ID, isnull(C.SOBENHAN,NULL) as SOBENHAN,        A.LOAITHANHVIEN_ID, A.SUDUNG_BHTN, A.THE_ID, A.THANHVIEN_ID, A.VIP, A.NGUON_BENHNHAN_ID, A.BAOLANH_VIENPHI, A.SOBHYT, CONVERT(VARCHAR(11),A.NGAYTIEPNHAN,103) as NGAYTIEPNHAN,        B.*        , A.UUTIEN        from TT_TIEPNHAN A        inner join TT_BENHNHAN B on B.BENHNHAN_ID = A.BENHNHAN_ID and (A.TRANGTHAI = 'DATIEPNHAN') and B.ACTIVE = '1'        left join TT_NOITRU_BENHAN C on C.TIEPNHAN_ID = A.TIEPNHAN_ID        where A.BENHVIEN_ID = 'HLU01']
2019-08-14 11:38:50,675 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM025']
2019-08-14 11:38:51,684 [6] DEBUG - Statement Id: [DAO00026_GetListDanhSachDichVuGhiNhanVTYT_COM25] PreparedStatement : [select distinct CONVERT(VARCHAR(11),C.NGAYYEUCAU,103) as NGAYYEUCAU, C.DICHVU_ID, C.DVYEUCAU_ID, D.TENDICHVU, C.NOITHUCHIEN_ID, A.SOTIEPNHAN, A.TRAITUYEN, A.NGAYMIENDONGCHITRA, A.TIEPNHAN_ID, A.DOITUONG_ID, A.TRANGTHAI,            A.LOAITHANHVIEN_ID, A.SUDUNG_BHTN, A.THE_ID, A.THANHVIEN_ID, A.VIP, A.NGUON_BENHNHAN_ID, A.BAOLANH_VIENPHI,            CASE WHEN (A.TRANGTHAI = 'NOITRU' OR A.TRANGTHAI = 'CAPCUU') THEN 'IN' ELSE 'OUT' END AS LOAIBENHAN,            CASE WHEN (C.TRANGTHAI = 'CHUAKETQUA') THEN 'CHUAKETQUA' ELSE 'HOANTAT' END AS TRANGTHAIDICHVU,            B.*, isnull(ntba.SOBENHAN, '') SOBENHAN, isnull(ntba.BENHAN_ID, 0) BENHAN_ID,            CASE WHEN Left(E.MANHOMDICHVU,2) = '03' THEN '02' ELSE Left(E.MANHOMDICHVU,2) END AS MANHOMDICHVU            from TT_TIEPNHAN A            inner join TT_BENHNHAN B on B.BENHNHAN_ID = A.BENHNHAN_ID and B.ACTIVE = '1'            inner join TT_DVYEUCAU C on C.TIEPNHAN_ID = A.TIEPNHAN_ID                        left join TM_DICHVU D on D.DICHVU_ID = C.DICHVU_ID            left join TM_NHOMDICHVU E on E.NHOMDICHVU_ID = D.NHOMDICHVU_ID            left join TT_NOITRU_BENHAN ntba on ntba.BENHAN_ID = C.BENHAN_ID              where            C.NGAYHENCLS is NULL and A.BENHVIEN_ID = 'HLU01'            and (A.TRANGTHAI = 'DATIEPNHAN' or A.TRANGTHAI = 'NOITRU' or A.TRANGTHAI = 'CAPCUU' or A.TRANGTHAI = 'NGOAITRU')            and (CASE WHEN Left(E.MANHOMDICHVU,2) = '03' THEN '02' ELSE Left(E.MANHOMDICHVU,2) END in ('02', '04'))]
2019-08-14 11:39:08,501 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM024']
2019-08-14 11:39:09,549 [18] DEBUG - Statement Id: [DAO00027_GetListDuyetToaThuoc] PreparedStatement : [select distinct A.SOTIEPNHAN, A.TRAITUYEN, A.NGAYMIENDONGCHITRA, A.TIEPNHAN_ID, A.DOITUONG_ID,        A.LOAITHANHVIEN_ID, A.SUDUNG_BHTN, A.THE_ID, A.THANHVIEN_ID, A.VIP, A.NGUON_BENHNHAN_ID, A.BAOLANH_VIENPHI,        B.*, 'NGOAITRU' as LOAITOA, C.PHAMVI_ID as PHAMVI_ID        from TT_NGOAITRU_KHAMBENH_TOATHUOC C        inner join TT_NGOAITRU_KHAMBENH D on C.KHAMBENH_ID = D.KHAMBENH_ID        inner join TT_TIEPNHAN A on D.TIEPNHAN_ID = A.TIEPNHAN_ID        inner join TT_BENHNHAN B on B.BENHNHAN_ID = A.BENHNHAN_ID        where C.DUYET = '1' and C.TRANGTHAI = 'CHUAXUAT' and C.BENHVIEN_ID = 'HLU01' and (C.LOAITOATHUOC = 'BV' or C.LOAITOATHUOC = 'MP' or C.LOAITOATHUOC = 'KTBV')        union        select distinct A.SOTIEPNHAN, A.TRAITUYEN, A.NGAYMIENDONGCHITRA, A.TIEPNHAN_ID, A.DOITUONG_ID,        A.LOAITHANHVIEN_ID, A.SUDUNG_BHTN, A.THE_ID, A.THANHVIEN_ID, A.VIP, A.NGUON_BENHNHAN_ID, A.BAOLANH_VIENPHI,        B.*, 'MUANGOAI' as LOAITOA, C.PHAMVI_ID as PHAMVI_ID        from TT_NGOAITRU_KHAMBENH_TOATHUOC C        inner join TT_NGOAITRU_KHAMBENH D on C.KHAMBENH_ID = D.KHAMBENH_ID        inner join TT_TIEPNHAN A on D.TIEPNHAN_ID = A.TIEPNHAN_ID and (A.TRANGTHAI = 'DATIEPNHAN' or A.TRANGTHAI = 'NOITRU' or A.TRANGTHAI = 'CAPCUU' or A.TRANGTHAI = 'NGOAITRU')        inner join TT_BENHNHAN B on B.BENHNHAN_ID = A.BENHNHAN_ID        where C.DUYET = '1' and C.TRANGTHAI = 'CHUAXUAT' and C.BENHVIEN_ID = 'HLU01' and (A.SOBHYT is null or A.SOBHYT = '')        union        select distinct A.SOTIEPNHAN, A.TRAITUYEN, A.NGAYMIENDONGCHITRA, A.TIEPNHAN_ID, A.DOITUONG_ID,        A.LOAITHANHVIEN_ID, A.SUDUNG_BHTN, A.THE_ID, A.THANHVIEN_ID, A.VIP, A.NGUON_BENHNHAN_ID, A.BAOLANH_VIENPHI,        B.*, 'NOITRU' as LOAITOA, C.PHAMVI_ID as PHAMVI_ID        from TT_NOITRU_TOATHUOC C        inner join TT_TIEPNHAN A on C.TIEPNHAN_ID = A.TIEPNHAN_ID and (A.TRANGTHAI = 'DATIEPNHAN' or A.TRANGTHAI = 'NOITRU' or A.TRANGTHAI = 'CAPCUU' or A.TRANGTHAI = 'NGOAITRU')        inner join TT_BENHNHAN B on B.BENHNHAN_ID = A.BENHNHAN_ID        where (C.TRANGTHAI = 'DADUYET' or C.TRANGTHAI = 'CHUAXUAT') and C.BENHVIEN_ID = 'HLU01' and (A.SOBHYT is not null or A.SOBHYT != '')        union        select distinct A.SOTIEPNHAN, A.TRAITUYEN, A.NGAYMIENDONGCHITRA, A.TIEPNHAN_ID, A.DOITUONG_ID,        A.LOAITHANHVIEN_ID, A.SUDUNG_BHTN, A.THE_ID, A.THANHVIEN_ID, A.VIP, A.NGUON_BENHNHAN_ID, A.BAOLANH_VIENPHI,        B.*, 'MUANGOAI' as LOAITOA, C.PHAMVI_ID as PHAMVI_ID        from TT_NOITRU_TOATHUOC C        inner join TT_TIEPNHAN A on C.TIEPNHAN_ID = A.TIEPNHAN_ID and (A.TRANGTHAI = 'DATIEPNHAN' or A.TRANGTHAI = 'NOITRU' or A.TRANGTHAI = 'CAPCUU' or A.TRANGTHAI = 'NGOAITRU')        inner join TT_BENHNHAN B on B.BENHNHAN_ID = A.BENHNHAN_ID        inner join TT_NOITRU_BENHAN D on D.TIEPNHAN_ID = C.TIEPNHAN_ID        where (C.TRANGTHAI = 'DADUYET' or C.TRANGTHAI = 'CHUAXUAT') and C.BENHVIEN_ID = 'HLU01' and (A.SOBHYT is null or A.SOBHYT = '') and D.TRANGTHAI != 'DANGDIEUTRI']
2019-08-14 11:39:13,910 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM033']
2019-08-14 11:39:15,145 [19] DEBUG - Statement Id: [DAO00027_GetListDuocKyGuiTonKho] PreparedStatement : [select  distinct TT_TONKHO.DUOC_KEY, LTRIM(TT_TONKHO.KHODUOC_ID) as KHODUOC_ID, TM_DUOC.DUOC_ID, TM_LOAIDUOC.MALOAIDUOC,TM_DUOC.SOVISA,TM_DUOC.TYLE_VAT,TM_DUOC.COTOA,        TM_DUOC.MADUOC, TM_DUOC.TENHANG, TM_DUOC.TENDUOCDAYDU, dvt.TENDONVITINH as DONVITINH,  TM_DUOC.DONVITINH_ID,TM_DUOC.BHYT,TM_DUOC.PHAMVI,        TM_DUOC.TENHOATCHAT, TM_DUOC.HAMLUONG, TM_DUOC.HANGSANXUAT, TM_DUOC.QUOCGIA, TM_DUOC.LOAIDUOC_ID, TM_DUOC.DUONGDUNG_ID,        TM_TENDUOC.TENDUOC, TM_TENDUOC.TENDUOC_EN, TM_TENDUOC.MAQUOCTE, TM_TENDUOC.MAQUOCTEBT,        TM_LOAIDUOC.LOAIVATTU_ID, TM_DUOC.BENHVIEN_ID,TT_TONKHO.SOLUONG, TT_TONKHO.NGUONDUOC_ID, NH.TENNGUONDUOC        , TAMNGUNG = CASE WHEN TM_DUOC.TAMNGUNG = '1' OR nh.TAMNGUNG = '1' OR KD.TAMNGUNG = '1' THEN '1' ELSE '0' END        , TM_DUOC.DANGTRINHBAY        from TM_DUOC        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = TM_DUOC.DONVITINH_ID        left join TM_TENDUOC on TM_DUOC.TENDUOC_ID = TM_TENDUOC.TENDUOC_ID and TM_DUOC.BENHVIEN_ID = 'HLU01' and TM_DUOC.TAMNGUNG = '0'        left join TM_LOAIDUOC on TM_LOAIDUOC.LOAIDUOC_ID = TM_DUOC.LOAIDUOC_ID and TM_LOAIDUOC.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG on (TM_LOAIDUOC.LOAIVATTU_ID = TM_DUOC_HANDUNG.LOAIDUOC and TM_DUOC_HANDUNG.BENHVIEN_ID = 'HLU01')        inner join        (select LTRIM(A.KHODUOC_ID) + '_' + LTRIM(A.DUOC_ID) + '_' + LTRIM(ISNULL(A.NGUONDUOC_ID,'')) as DUOC_KEY, A.KHODUOC_ID, A.DUOC_ID,A.NGUONDUOC_ID,        SUM(isnull(A.SOLUONG,0)) as SOLUONG        from        (select SUM(SOLUONG) as SOLUONG, KHODUOC_ID, DUOC_ID, NGUONDUOC_ID from TT_DUOC_KYGUI_TONKHO        where BENHVIEN_ID = 'HLU01' group by KHODUOC_ID, DUOC_ID, NGUONDUOC_ID) A        group by LTRIM(A.KHODUOC_ID) + '_' + LTRIM(A.DUOC_ID) + '_' + LTRIM(A.NGUONDUOC_ID), A.KHODUOC_ID, A.DUOC_ID, A.NGUONDUOC_ID)        TT_TONKHO on TT_TONKHO.DUOC_ID = TM_DUOC.DUOC_ID        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = TT_TONKHO.NGUONDUOC_ID and nh.BENHVIEN_ID = 'HLU01'        LEFT JOIN TM_KHODUOC KD ON KD.KHODUOC_ID = TT_TONKHO.KHODUOC_ID        where TM_DUOC.BENHVIEN_ID = 'HLU01' AND TT_TONKHO.SOLUONG >= 0]
2019-08-14 11:39:15,177 [5] DEBUG - Statement Id: [DAO00027_GetListDuocKyGuiTonKho] PreparedStatement : [select  distinct TT_TONKHO.DUOC_KEY, LTRIM(TT_TONKHO.KHODUOC_ID) as KHODUOC_ID, TM_DUOC.DUOC_ID, TM_LOAIDUOC.MALOAIDUOC,TM_DUOC.SOVISA,TM_DUOC.TYLE_VAT,TM_DUOC.COTOA,        TM_DUOC.MADUOC, TM_DUOC.TENHANG, TM_DUOC.TENDUOCDAYDU, dvt.TENDONVITINH as DONVITINH,  TM_DUOC.DONVITINH_ID,TM_DUOC.BHYT,TM_DUOC.PHAMVI,        TM_DUOC.TENHOATCHAT, TM_DUOC.HAMLUONG, TM_DUOC.HANGSANXUAT, TM_DUOC.QUOCGIA, TM_DUOC.LOAIDUOC_ID, TM_DUOC.DUONGDUNG_ID,        TM_TENDUOC.TENDUOC, TM_TENDUOC.TENDUOC_EN, TM_TENDUOC.MAQUOCTE, TM_TENDUOC.MAQUOCTEBT,        TM_LOAIDUOC.LOAIVATTU_ID, TM_DUOC.BENHVIEN_ID,TT_TONKHO.SOLUONG, TT_TONKHO.NGUONDUOC_ID, NH.TENNGUONDUOC        , TAMNGUNG = CASE WHEN TM_DUOC.TAMNGUNG = '1' OR nh.TAMNGUNG = '1' OR KD.TAMNGUNG = '1' THEN '1' ELSE '0' END        , TM_DUOC.DANGTRINHBAY        from TM_DUOC        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = TM_DUOC.DONVITINH_ID        left join TM_TENDUOC on TM_DUOC.TENDUOC_ID = TM_TENDUOC.TENDUOC_ID and TM_DUOC.BENHVIEN_ID = 'HLU01' and TM_DUOC.TAMNGUNG = '0'        left join TM_LOAIDUOC on TM_LOAIDUOC.LOAIDUOC_ID = TM_DUOC.LOAIDUOC_ID and TM_LOAIDUOC.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG on (TM_LOAIDUOC.LOAIVATTU_ID = TM_DUOC_HANDUNG.LOAIDUOC and TM_DUOC_HANDUNG.BENHVIEN_ID = 'HLU01')        inner join        (select LTRIM(A.KHODUOC_ID) + '_' + LTRIM(A.DUOC_ID) + '_' + LTRIM(ISNULL(A.NGUONDUOC_ID,'')) as DUOC_KEY, A.KHODUOC_ID, A.DUOC_ID,A.NGUONDUOC_ID,        SUM(isnull(A.SOLUONG,0)) as SOLUONG        from        (select SUM(SOLUONG) as SOLUONG, KHODUOC_ID, DUOC_ID, NGUONDUOC_ID from TT_DUOC_KYGUI_TONKHO        where BENHVIEN_ID = 'HLU01' group by KHODUOC_ID, DUOC_ID, NGUONDUOC_ID) A        group by LTRIM(A.KHODUOC_ID) + '_' + LTRIM(A.DUOC_ID) + '_' + LTRIM(A.NGUONDUOC_ID), A.KHODUOC_ID, A.DUOC_ID, A.NGUONDUOC_ID)        TT_TONKHO on TT_TONKHO.DUOC_ID = TM_DUOC.DUOC_ID        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = TT_TONKHO.NGUONDUOC_ID and nh.BENHVIEN_ID = 'HLU01'        LEFT JOIN TM_KHODUOC KD ON KD.KHODUOC_ID = TT_TONKHO.KHODUOC_ID        where TM_DUOC.BENHVIEN_ID = 'HLU01' AND TT_TONKHO.SOLUONG >= 0]
2019-08-14 11:39:15,264 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM018']
2019-08-14 11:39:16,750 [19] DEBUG - Statement Id: [DAO00027_GetListDuocTonKho] PreparedStatement : [select distinct TT_TONKHO.DUOC_KEY, LTRIM(TT_TONKHO.KHODUOC_ID) as KHODUOC_ID, TM_DUOC.DUOC_ID, TM_LOAIDUOC.MALOAIDUOC,TM_DUOC.SOVISA,TM_DUOC.TYLE_VAT,TM_DUOC.COTOA,        TM_DUOC.MADUOC, TM_DUOC.TENHANG, TM_DUOC.TENDUOCDAYDU, dvt.TENDONVITINH as DONVITINH,  TM_DUOC.DONVITINH_ID,TM_DUOC.BHYT,                TM_DUOC.TENHOATCHAT,          TM_DUOC.HAMLUONG, TM_DUOC.HANGSANXUAT, TM_DUOC.QUOCGIA, TM_DUOC.LOAIDUOC_ID, TM_DUOC.DUONGDUNG_ID,        TM_TENDUOC.TENDUOC, TM_TENDUOC.TENDUOC_EN, TM_TENDUOC.MAQUOCTE, TM_TENDUOC.MAQUOCTEBT,        TM_LOAIDUOC.LOAIVATTU_ID, TM_DUOC.BENHVIEN_ID,        TT_TONKHO.SOLUONG, TM_DUOC.VTYT_PHANLOAI, TM_DUOC.PHAMVI, TT_TONKHO.NGUONDUOC_ID, NG.TENNGUONDUOC AS TENNGUONDUOC        , TAMNGUNG = CASE WHEN TM_DUOC.TAMNGUNG = '1' OR NG.TAMNGUNG = '1' OR KD.TAMNGUNG = '1' THEN '1' ELSE '0' END        , TM_DUOC.DANGTRINHBAY        from TM_DUOC        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = TM_DUOC.DONVITINH_ID        left join TM_TENDUOC on TM_DUOC.TENDUOC_ID = TM_TENDUOC.TENDUOC_ID and TM_DUOC.BENHVIEN_ID = 'HLU01' and TM_DUOC.TAMNGUNG = '0'        left join TM_LOAIDUOC on TM_LOAIDUOC.LOAIDUOC_ID = TM_DUOC.LOAIDUOC_ID and TM_LOAIDUOC.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG on (TM_LOAIDUOC.LOAIVATTU_ID = TM_DUOC_HANDUNG.LOAIDUOC and TM_DUOC_HANDUNG.BENHVIEN_ID = 'HLU01')        inner join        (select LTRIM(A.KHODUOC_ID) + '_' + LTRIM(A.DUOC_ID) + '_' + LTRIM(ISNULL(A.NGUONDUOC_ID,'')) as DUOC_KEY, A.KHODUOC_ID, A.DUOC_ID, A.NGUONDUOC_ID,        SUM(isnull(A.SOLUONG,0)) as SOLUONG        from        (select SUM(SOLUONG) as SOLUONG, KHODUOC_ID, DUOC_ID, NGUONDUOC_ID from TT_DUOC_TONKHO        where BENHVIEN_ID = 'HLU01' group by KHODUOC_ID, DUOC_ID, NGUONDUOC_ID) A        group by LTRIM(A.KHODUOC_ID) + '_' + LTRIM(A.DUOC_ID) + '_' + LTRIM(ISNULL(A.NGUONDUOC_ID,'')), A.KHODUOC_ID, A.DUOC_ID, NGUONDUOC_ID        ) TT_TONKHO on TT_TONKHO.DUOC_ID = TM_DUOC.DUOC_ID        LEFT JOIN TM_NGUONHANG NG ON NG.NGUONDUOC_ID = TT_TONKHO.NGUONDUOC_ID        LEFT JOIN TM_KHODUOC KD ON KD.KHODUOC_ID = TT_TONKHO.KHODUOC_ID        where TM_DUOC.BENHVIEN_ID = 'HLU01' and TT_TONKHO.SOLUONG >= 0]
2019-08-14 11:39:21,854 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM023']
2019-08-14 11:39:23,427 [28] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoVaBooking] PreparedStatement : [declare @TOAMUANGOAI int = 0;        select @TOAMUANGOAI = isnull(VALUE,0) from TM_SYS_APPSETTINGS where CODE = 'OPD_TOAMUANGOAI_DUNGDANHMUC_DUOC'                if @TOAMUANGOAI = 1        begin        select  distinct '0' + '_' + LTRIM(d.DUOC_ID) + '_' + '0' as DUOC_KEY, 0 as PHAMVI_ID, 0 as NGUONDUOC_ID, null as TENNGUONDUOC, null as TINHTIEN, d.DUOC_ID, ld.MALOAIDUOC,        d.SOVISA,d.TYLE_VAT,d.COTOA, d.MADUOC, d.TENHANG, d.TENDUOCDAYDU, d.DONVITINH as DONVITINH, d.BHYT,        d.TENHOATCHAT, d.HAMLUONG, d.HANGSANXUAT, d.QUOCGIA, d.LOAIDUOC_ID, d.DUONGDUNG_ID, d.TINHTIEN_PTTT,        ten.TENDUOC, ten.TENDUOC_EN, ten.MAQUOCTE, ten.MAQUOCTEBT,        '' as BHYT_TEXT        , ld.LOAIVATTU_ID        , d.BENHVIEN_ID,        999999999 as SOLUONG, d.VTYT_PHANLOAI, d.PHAMVI, d.SUASOLUONGTONGHOP, d.MADUOCBV, d.DANGTRINHBAY        , TAMNGUNG = CASE WHEN d.TAMNGUNG = '1' THEN '1' ELSE '0' END        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        union all        select  distinct tk.DUOC_KEY, LTRIM(tk.PHAMVI_ID) as PHAMVI_ID, tk.NGUONDUOC_ID, nh.TENNGUONDUOC, nh.TINHTIEN, d.DUOC_ID, ld.MALOAIDUOC,        d.SOVISA,d.TYLE_VAT,d.COTOA, d.MADUOC, d.TENHANG, d.TENDUOCDAYDU, dvt.TENDONVITINH as DONVITINH, d.BHYT,        d.TENHOATCHAT, d.HAMLUONG, d.HANGSANXUAT, d.QUOCGIA, d.LOAIDUOC_ID, d.DUONGDUNG_ID, d.TINHTIEN_PTTT,        ten.TENDUOC, ten.TENDUOC_EN, ten.MAQUOCTE, ten.MAQUOCTEBT,        CASE WHEN d.BHYT = '1' THEN 'BHYT' ELSE '' END as BHYT_TEXT        , ld.LOAIVATTU_ID        , d.BENHVIEN_ID,        tk.SOLUONG, d.VTYT_PHANLOAI, d.PHAMVI, d.SUASOLUONGTONGHOP, d.MADUOCBV, d.DANGTRINHBAY        , TAMNGUNG = CASE WHEN d.TAMNGUNG = '1' OR nh.TAMNGUNG = '1' OR kd.TAMNGUNG = '1' THEN '1' ELSE '0' END        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        inner join        (        select  LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')) DUOC_KEY, (SUM(dtk.SOLUONG) - isnull(sum(A.SOLUONG),0) - isnull(sum(B.SOLUONG),0)) SOLUONG, pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        from (select sum(soluong) soluong,duoc_id,nguonduoc_id,khoduoc_id,benhvien_id from TT_DUOC_TONKHO  group by duoc_id,nguonduoc_id,khoduoc_id,benhvien_id) dtk        inner join TM_DUOC_PHAMVISD_MAPPING pvsd on dtk.KHODUOC_ID = pvsd.KHODUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NOITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) B on B.DUOC_ID = dtk.DUOC_ID and B.SOLUONG > 0 and B.PHAMVI_ID = pvsd.PHAMVI_ID and B.NGUONHANG_ID = dtk.NGUONDUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NGOAITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) A on A.DUOC_ID = dtk.DUOC_ID and A.SOLUONG > 0 and A.PHAMVI_ID = pvsd.PHAMVI_ID and A.NGUONHANG_ID = dtk.NGUONDUOC_ID        where dtk.SOLUONG > 0 and dtk.BENHVIEN_ID = 'HLU01'        group by LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')), pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        ) tk on tk.DUOC_ID = d.DUOC_ID        left join TM_DUOC_PHAMVISUDUNG kd on kd.PHAMVI_ID = tk.PHAMVI_ID and kd.BENHVIEN_ID = 'HLU01'        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = tk.NGUONDUOC_ID and nh.BENHVIEN_ID = 'HLU01'        where d.BENHVIEN_ID = 'HLU01'  and tk.SOLUONG >= 0         end                else        begin        select  distinct tk.DUOC_KEY, LTRIM(tk.PHAMVI_ID) as PHAMVI_ID, tk.NGUONDUOC_ID, nh.TENNGUONDUOC, nh.TINHTIEN, d.DUOC_ID, ld.MALOAIDUOC,        d.SOVISA,d.TYLE_VAT,d.COTOA, d.MADUOC, d.TENHANG, d.TENDUOCDAYDU, d.DONVITINH as DONVITINH, d.BHYT,        d.TENHOATCHAT, d.HAMLUONG, d.HANGSANXUAT, d.QUOCGIA, d.LOAIDUOC_ID, d.DUONGDUNG_ID, d.TINHTIEN_PTTT,        ten.TENDUOC, ten.TENDUOC_EN, ten.MAQUOCTE, ten.MAQUOCTEBT,        CASE WHEN d.BHYT = '1' THEN 'BHYT' ELSE '' END as BHYT_TEXT        , ld.LOAIVATTU_ID        , d.BENHVIEN_ID,        tk.SOLUONG, d.VTYT_PHANLOAI, d.PHAMVI, d.SUASOLUONGTONGHOP, d.MADUOCBV, d.DANGTRINHBAY        , TAMNGUNG = CASE WHEN d.TAMNGUNG = '1' OR nh.TAMNGUNG = '1' OR kd.TAMNGUNG = '1' THEN '1' ELSE '0' END        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        inner join        (        select  LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')) DUOC_KEY, (SUM(dtk.SOLUONG) - isnull(sum(A.SOLUONG),0) - isnull(sum(B.SOLUONG),0)) SOLUONG, pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        from (select sum(soluong) soluong,duoc_id,nguonduoc_id,khoduoc_id,benhvien_id from TT_DUOC_TONKHO  group by duoc_id,nguonduoc_id,khoduoc_id,benhvien_id) dtk        inner join TM_DUOC_PHAMVISD_MAPPING pvsd on dtk.KHODUOC_ID = pvsd.KHODUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NOITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) B on B.DUOC_ID = dtk.DUOC_ID and B.SOLUONG > 0 and B.PHAMVI_ID = pvsd.PHAMVI_ID and B.NGUONHANG_ID = dtk.NGUONDUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NGOAITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) A on A.DUOC_ID = dtk.DUOC_ID and A.SOLUONG > 0 and A.PHAMVI_ID = pvsd.PHAMVI_ID and A.NGUONHANG_ID = dtk.NGUONDUOC_ID        where dtk.SOLUONG > 0 and dtk.BENHVIEN_ID = 'HLU01'        group by LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')), pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        ) tk on tk.DUOC_ID = d.DUOC_ID        left join TM_DUOC_PHAMVISUDUNG kd on kd.PHAMVI_ID = tk.PHAMVI_ID and kd.BENHVIEN_ID = 'HLU01'        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = tk.NGUONDUOC_ID and nh.BENHVIEN_ID = 'HLU01'        where d.BENHVIEN_ID = 'HLU01'  and tk.SOLUONG >= 0        end]
2019-08-14 11:39:27,486 [5] DEBUG - Statement Id: [DAO00320_GetList] PreparedStatement : [select M.*            from TM_MAU M            LEFT JOIN TM_MAU_DONVITINH DVT on M.DONVITINH_ID=DVT.DONVITINH_ID            where            M.TAMNGUNG = '0'            and M.BENHVIEN_ID = 'HLU01'            order by M.TENMAU]
2019-08-14 11:39:27,825 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM071']
2019-08-14 11:39:29,322 [28] DEBUG - Statement Id: [DAO00322_GetListMauTonKhoForCreateCached] PreparedStatement : [SELECT DISTINCT          TK.MAU_KEY, TK.KHOMAU_ID, M.MAU_ID, M.MAMAU, M.TENMAU, M.NHOM_ABO, M.NHOM_RH, M.LOAIMAU_ID,          TK.SOLONHAP_ID, SLN.SOLONHAP, SLN.SOKIEMSOAT, TK.NGUONHANG_ID, NG.TENNGUONMAU, M.BENHVIEN_ID, M.DONVITINH_ID,          SUM(tk.SOLUONG) AS SOLUONG,K.TENKHO,DVT.TENDONVITINH          FROM TT_MAU_TONKHO TK          JOIN TM_KHO K ON TK.KHOMAU_ID = K.KHO_ID          JOIN TT_MAU_CHUNGTU_SOLONHAP SLN ON TK.SOLONHAP_ID = SLN.SOLONHAP_ID          JOIN TM_MAU M on TK.MAU_ID = M.MAU_ID and M.TAMNGUNG = '0'          LEFT JOIN TM_MAU_DONVITINH DVT on M.DONVITINH_ID=DVT.DONVITINH_ID          LEFT JOIN TM_NGUONMAU NG ON NG.NGUONMAU_ID = TK.NGUONHANG_ID          WHERE TK.SOLUONG > 0          GROUP BY TK.MAU_KEY, TK.KHOMAU_ID, M.MAU_ID, M.MAMAU, M.TENMAU, M.NHOM_ABO, M.NHOM_RH, M.LOAIMAU_ID,          TK.SOLONHAP_ID, SLN.SOLONHAP, SLN.SOKIEMSOAT,TK.NGUONHANG_ID, NG.TENNGUONMAU, M.BENHVIEN_ID, M.DONVITINH_ID,K.TENKHO,DVT.TENDONVITINH]
2019-08-14 11:39:29,354 [5] DEBUG - Statement Id: [DAO00322_GetListMauTonKhoForCreateCached] PreparedStatement : [SELECT DISTINCT          TK.MAU_KEY, TK.KHOMAU_ID, M.MAU_ID, M.MAMAU, M.TENMAU, M.NHOM_ABO, M.NHOM_RH, M.LOAIMAU_ID,          TK.SOLONHAP_ID, SLN.SOLONHAP, SLN.SOKIEMSOAT, TK.NGUONHANG_ID, NG.TENNGUONMAU, M.BENHVIEN_ID, M.DONVITINH_ID,          SUM(tk.SOLUONG) AS SOLUONG,K.TENKHO,DVT.TENDONVITINH          FROM TT_MAU_TONKHO TK          JOIN TM_KHO K ON TK.KHOMAU_ID = K.KHO_ID          JOIN TT_MAU_CHUNGTU_SOLONHAP SLN ON TK.SOLONHAP_ID = SLN.SOLONHAP_ID          JOIN TM_MAU M on TK.MAU_ID = M.MAU_ID and M.TAMNGUNG = '0'          LEFT JOIN TM_MAU_DONVITINH DVT on M.DONVITINH_ID=DVT.DONVITINH_ID          LEFT JOIN TM_NGUONMAU NG ON NG.NGUONMAU_ID = TK.NGUONHANG_ID          WHERE TK.SOLUONG > 0          GROUP BY TK.MAU_KEY, TK.KHOMAU_ID, M.MAU_ID, M.MAMAU, M.TENMAU, M.NHOM_ABO, M.NHOM_RH, M.LOAIMAU_ID,          TK.SOLONHAP_ID, SLN.SOLONHAP, SLN.SOKIEMSOAT,TK.NGUONHANG_ID, NG.TENNGUONMAU, M.BENHVIEN_ID, M.DONVITINH_ID,K.TENKHO,DVT.TENDONVITINH]
2019-08-14 11:39:29,442 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM073']
2019-08-14 11:39:31,007 [28] DEBUG - Statement Id: [DAO00322_GetListMauTonKhoTruBooking] PreparedStatement : [select distinct          TK.MAU_KEY, TK.KHOMAU_ID, M.MAU_ID, M.MAMAU, M.TENMAU, M.NHOM_ABO, M.NHOM_RH, M.LOAIMAU_ID, M.DONVITINH_ID,          TK.SOLONHAP_ID, TK.SOLONHAP, TK.SOKIEMSOAT,M.PHAMVI, TK.NGUONHANG_ID, NG.TENNGUONMAU, M.BENHVIEN_ID,          TK.SOLUONG,TK.TENKHO,DVT.TENDONVITINH          from TM_MAU M          JOIN          (          select          A.MAU_KEY, A.KHOMAU_ID, A.MAU_ID ,a.NGUONHANG_ID, A.SOLONHAP_ID, A.SOLONHAP, A.SOKIEMSOAT, A.SOLUONG,A.TENKHO          from          (          select KHOMAU_ID, TK.MAU_ID, TK.NGUONHANG_ID, TK.MAU_KEY, SLN.SOLONHAP_ID, SLN.SOLONHAP, SLN.SOKIEMSOAT, ISNULL(TK.SOLUONG,0) - ISNULL(book.SOLUONG,0) as SOLUONG,K.TENKHO          from TT_MAU_TONKHO TK          JOIN TM_KHO K ON TK.KHOMAU_ID = K.KHO_ID          inner join TT_MAU_CHUNGTU_SOLONHAP SLN ON TK.SOLONHAP_ID = SLN.SOLONHAP_ID          left join dbo.TT_MAU_TONKHO_BOOK book ON book.MAU_KEY = TK.MAU_KEY AND book.TRANGTHAI = 'HIEULUC'          where ISNULL(TK.SOLUONG,0) - ISNULL(book.SOLUONG,0) > 0          ) A          )TK on TK.MAU_ID = M.MAU_ID and M.TAMNGUNG = '0'          LEFT JOIN TM_MAU_DONVITINH DVT on M.DONVITINH_ID=DVT.DONVITINH_ID          LEFT JOIN TM_NGUONMAU NG ON NG.NGUONMAU_ID = TK.NGUONHANG_ID]
2019-08-14 11:39:31,037 [5] DEBUG - Statement Id: [DAO00322_GetListMauTonKhoTruBooking] PreparedStatement : [select distinct          TK.MAU_KEY, TK.KHOMAU_ID, M.MAU_ID, M.MAMAU, M.TENMAU, M.NHOM_ABO, M.NHOM_RH, M.LOAIMAU_ID, M.DONVITINH_ID,          TK.SOLONHAP_ID, TK.SOLONHAP, TK.SOKIEMSOAT,M.PHAMVI, TK.NGUONHANG_ID, NG.TENNGUONMAU, M.BENHVIEN_ID,          TK.SOLUONG,TK.TENKHO,DVT.TENDONVITINH          from TM_MAU M          JOIN          (          select          A.MAU_KEY, A.KHOMAU_ID, A.MAU_ID ,a.NGUONHANG_ID, A.SOLONHAP_ID, A.SOLONHAP, A.SOKIEMSOAT, A.SOLUONG,A.TENKHO          from          (          select KHOMAU_ID, TK.MAU_ID, TK.NGUONHANG_ID, TK.MAU_KEY, SLN.SOLONHAP_ID, SLN.SOLONHAP, SLN.SOKIEMSOAT, ISNULL(TK.SOLUONG,0) - ISNULL(book.SOLUONG,0) as SOLUONG,K.TENKHO          from TT_MAU_TONKHO TK          JOIN TM_KHO K ON TK.KHOMAU_ID = K.KHO_ID          inner join TT_MAU_CHUNGTU_SOLONHAP SLN ON TK.SOLONHAP_ID = SLN.SOLONHAP_ID          left join dbo.TT_MAU_TONKHO_BOOK book ON book.MAU_KEY = TK.MAU_KEY AND book.TRANGTHAI = 'HIEULUC'          where ISNULL(TK.SOLUONG,0) - ISNULL(book.SOLUONG,0) > 0          ) A          )TK on TK.MAU_ID = M.MAU_ID and M.TAMNGUNG = '0'          LEFT JOIN TM_MAU_DONVITINH DVT on M.DONVITINH_ID=DVT.DONVITINH_ID          LEFT JOIN TM_NGUONMAU NG ON NG.NGUONMAU_ID = TK.NGUONHANG_ID]
2019-08-14 11:39:31,124 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM072']
2019-08-14 11:39:32,487 [29] DEBUG - Statement Id: [DAO00322_GetListMauTonKhoBangKhongForCreateCached] PreparedStatement : [SELECT DISTINCT          TK.MAU_KEY, TK.KHOMAU_ID, M.MAU_ID, M.MAMAU, M.TENMAU, M.NHOM_ABO, M.NHOM_RH, M.LOAIMAU_ID, M.DONVITINH_ID,          TK.SOLONHAP_ID, SLN.SOLONHAP, SLN.SOKIEMSOAT, TK.NGUONHANG_ID, NG.TENNGUONMAU, M.BENHVIEN_ID,          SUM(tk.SOLUONG) AS SOLUONG,K.TENKHO,DVT.TENDONVITINH          FROM TT_MAU_TONKHO TK          JOIN TM_KHO K ON TK.KHOMAU_ID = K.KHO_ID          JOIN TT_MAU_CHUNGTU_SOLONHAP SLN ON TK.SOLONHAP_ID = SLN.SOLONHAP_ID          JOIN TM_MAU M on TK.MAU_ID = M.MAU_ID and M.TAMNGUNG = '0'          LEFT JOIN TM_MAU_DONVITINH DVT on M.DONVITINH_ID=DVT.DONVITINH_ID          LEFT JOIN TM_NGUONMAU NG ON NG.NGUONMAU_ID = TK.NGUONHANG_ID          WHERE TK.SOLUONG = 0          GROUP BY          TK.MAU_KEY, TK.KHOMAU_ID, M.MAU_ID, M.MAMAU, M.TENMAU, M.NHOM_ABO, M.NHOM_RH,M.LOAIMAU_ID,M.DONVITINH_ID,          TK.SOLONHAP_ID, SLN.SOLONHAP, SLN.SOKIEMSOAT,TK.NGUONHANG_ID, NG.TENNGUONMAU, M.BENHVIEN_ID,K.TENKHO,DVT.TENDONVITINH]
2019-08-14 11:39:33,465 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'MAIN'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2019-08-14 11:39:34,324 [1] DEBUG - Statement Id: [DAO00002_FormList] PreparedStatement : [select              TM_SYS_FORM.HOSPITAL_ID,              TM_SYS_FORM.NAME,              TM_SYS_FORM.CLASS,              TM_SYS_FORM.ASSEMBLY,              TM_SYS_FORM.TITLE_VI as TITLE              from TM_SYS_FORM              where HOSPITAL_ID = 'HLU01']
2019-08-14 11:39:39,343 [1] DEBUG - Statement Id: [DAO00300_GetShortcutListByUserID] PreparedStatement : [SELECT S.SHORTCUT_CODE, S.SHORTCUT_VALUE              FROM TM_SHORTCUT AS S              WHERE S.BENHVIEN_ID = 'HLU01' AND S.USER_ID = '1' AND TAMNGUNG = '0']
2019-08-14 11:39:39,377 [1] DEBUG - Statement Id: [DAO00087_GetList] PreparedStatement : [select CODE, VALUE, BENHVIEN_ID              from TM_SYS_APPSETTINGS              where LOCKED = '0' and BENHVIEN_ID = 'HLU01'              order by SETTING_ID]
2019-08-14 11:39:39,469 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'MSG01'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2019-08-14 11:39:39,605 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'MSG02'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2019-08-14 11:39:39,771 [1] DEBUG - Statement Id: [DAO00008_GetUserSettings] PreparedStatement : [select A.*, B.TENKHO , C.TENPHONGBAN, B.MAKHO, C.MAPHONGBAN          from TM_SYS_USERS A          left join TM_KHODUOC B on B.KHODUOC_ID = A.INVENTORY_ID          left join TM_PHONGBAN C on (C.PHONGBAN_ID = A.WORKING_DEPT_ID and C.BENHVIEN_ID =  @param0 )          left join TM_SYS_USERKHO D on (D.ACCOUNT_ID = A.ACCOUNT_ID and D.HOSPITAL_ID =  @param0 )          where          A.HOSPITAL_ID =  @param0            and                 A.ACCOUNT_ID =  @param1]
2019-08-14 11:39:39,775 [1] DEBUG - Statement Id: [DAO00008_GetUserSettings] Parameters: [@param0=[HOSPITAL_ID,HLU01], @param1=[ACCOUNT_ID,113]]
2019-08-14 11:39:39,775 [1] DEBUG - Statement Id: [DAO00008_GetUserSettings] Types: [@param0=[String, System.String], @param1=[String, System.String]]
2019-08-14 11:39:39,805 [1] DEBUG - Statement Id: [DAO00008_GetUserInvSettings] PreparedStatement : [select A.*, B.TENKHO, B.MAKHO, B.LOAIKHO_ID, B.KHOQUANLY_ID          from TM_SYS_USERKHO A          left join TM_KHO B on B.MODULE_ID = A.MODULE_ID and B.KHO_ID = A.KHO_ID          where A.HOSPITAL_ID =  @param0  and A.ACCOUNT_ID =  @param1           order by B.TENKHO]
2019-08-14 11:39:39,805 [1] DEBUG - Statement Id: [DAO00008_GetUserInvSettings] Parameters: [@param0=[HOSPITAL_ID,HLU01], @param1=[ACCOUNT_ID,113]]
2019-08-14 11:39:39,805 [1] DEBUG - Statement Id: [DAO00008_GetUserInvSettings] Types: [@param0=[String, System.String], @param1=[String, System.String]]
2019-08-14 11:39:39,943 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'COM30'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2019-08-14 11:39:40,116 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'RIS04'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2019-08-14 11:39:48,478 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'MENU1'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2019-08-14 11:39:48,563 [1] DEBUG - Statement Id: [DAO00011_GetList] PreparedStatement : [select              TM_SYS_MENU.ID,              TM_SYS_MENU.PARENTID,              TM_SYS_MENU.SCREEN,              TM_SYS_MENU.SMALLIMAGE,              TM_SYS_MENU.LARGEIMAGE,              TM_SYS_MENU.DESCRIPTION,              TM_SYS_MENU.TYPE,              TM_SYS_MENU.TITLE_VI as TITLE              from TM_SYS_MENU              where TM_SYS_MENU.HOSPITAL_ID = 'HLU01' and TM_SYS_MENU.ACTIVE = '1'               AND                   (TM_SYS_MENU.TYPE & '8' = '8')                             order by TM_SYS_MENU.ORDERNUM]
2019-08-14 11:39:48,816 [1] DEBUG - Statement Id: [DAO00011_usermenu_list] PreparedStatement : [select              TM_SYS_HOMEMENU.MENUID as ID,              TM_SYS_MENU.TITLE_VI as TITLE,              TM_SYS_MENU.SCREEN,              TM_SYS_MENU.SMALLIMAGE,              TM_SYS_MENU.LARGEIMAGE,              TM_SYS_MENU.TYPE              from TM_SYS_HOMEMENU              left join TM_SYS_MENU on TM_SYS_MENU.ID = TM_SYS_HOMEMENU.MENUID and TM_SYS_MENU.HOSPITAL_ID = TM_SYS_HOMEMENU.HOSPITAL_ID              where TM_SYS_HOMEMENU.HOSPITAL_ID = 'HLU01' and TM_SYS_HOMEMENU.USERID = '113' and TM_SYS_MENU.ACTIVE = '1'               AND                   (TM_SYS_MENU.TYPE & '8' = '8')                             ORDER BY TM_SYS_HOMEMENU.ORDERNUM]
2019-08-14 11:40:17,662 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'OPD02'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2019-08-14 11:40:18,965 [1] DEBUG - Statement Id: [DAO00017_GetLoaiGiaByDoiTuongId] PreparedStatement : [select dtlg.DOUUTIEN, dtlg.DOITUONG_ID, lg.LOAIGIA_ID, lg.TENLOAIGIA, lg.MALOAIGIA              from TM_LOAIGIA lg              left join TM_DOITUONG_LOAIGIA dtlg              on lg.LOAIGIA_ID = dtlg.LOAIGIA_ID and dtlg.BENHVIEN_ID = 'HLU01'              where lg.TAMNGUNG = 0 and lg.BENHVIEN_ID = 'HLU01'                             order by dtlg.DOUUTIEN]
2019-08-14 11:40:19,253 [1] DEBUG - Statement Id: [DAO00092_GetList_ToathuocNgoaitru] PreparedStatement : [select A.*, B.PHAMVI_ID, C.KHODUOC_ID from TM_TOATHUOC_NGOAITRU A        left join TM_DUOC_PHAMVISUDUNG B on B.MAPHAMVI = A.MAPHAMVI        left join (select distinct PHAMVI_ID, KHODUOC_ID from TM_DUOC_PHAMVISD_MAPPING) C on C.PHAMVI_ID = B.PHAMVI_ID        where A.TAMNGUNG != '1' and A.BENHVIEN_ID = 'HLU01'        ORDER BY A.SAPXEP ASC]
2019-08-14 11:40:24,409 [1] DEBUG - Statement Id: [DAO00009_TT_TIEPNHAN_GetProcess] PreparedStatement : [select PROCESS_ID from TT_TIEPNHAN where SOTIEPNHAN = 'TN190419.0000335']
2019-08-14 11:40:24,546 [1] DEBUG - Statement Id: [DAOWF004_laytrangthaiDV] PreparedStatement : [select top 1 A.CURR_STATE_CODE as STATE_CODE, isNull(C.SHORT_NAME,C.NAME) as TRANGTHAI, C.NAME as TRANGTHAI_CHITIET, C.STATUS_CODE, D.ISACTIVE as ACTIVE, E.STATUS_CODE  as OLD_STATUSCODE        from TT_REQUEST_SERVICE_DETAIL A                left join (select * from TT_REQUEST_SERVICE where PARA = '{"DICHVU_ID":"5436","DVYEUCAU_ID":"67614"}') D on D.ID = A.REQUEST_SERVICE_ID        left join TM_STATE C on A.CURR_STATE_CODE = C.STATE_CODE and C.PROCESS_CODE = D.PROCESS_CODE        left join TM_STATE E on A.OLD_STATE_CODE = E.STATE_CODE and E.PROCESS_CODE = D.PROCESS_CODE        where        A.REQUEST_SERVICE_ID = (select top 1 ID from TT_REQUEST_SERVICE where PARA = '{"DICHVU_ID":"5436","DVYEUCAU_ID":"67614"}' order by ID desc)        order by A.ID desc]
2019-08-14 11:40:24,834 [1] DEBUG - Statement Id: [DAO00017_GetLoaiGiaByDoiTuongId] PreparedStatement : [select dtlg.DOUUTIEN, dtlg.DOITUONG_ID, lg.LOAIGIA_ID, lg.TENLOAIGIA, lg.MALOAIGIA              from TM_LOAIGIA lg              left join TM_DOITUONG_LOAIGIA dtlg              on lg.LOAIGIA_ID = dtlg.LOAIGIA_ID and dtlg.BENHVIEN_ID = 'HLU01'              where lg.TAMNGUNG = 0 and lg.BENHVIEN_ID = 'HLU01'                             order by dtlg.DOUUTIEN]
2019-08-14 11:40:24,902 [1] DEBUG - Statement Id: [DAO00087_GetServiceParams] PreparedStatement : [select CODE, VALUE              from TM_SYS_APPSETTINGS              where LOCKED = '0' and BENHVIEN_ID = 'HLU01']
2019-08-14 11:40:25,004 [1] DEBUG - Statement Id: [DAO00014_KiemTraDVYCCoBHYT] PreparedStatement : [select *        from TT_VIENPHI        where REF_ID  = '67614' and REF_TABLE = 'TT_DVYEUCAU' and BHYT_DONGIA > 0]
2019-08-14 11:40:25,047 [1] DEBUG - Statement Id: [DAO00040_LayListToaMau] PreparedStatement : [select A.*, dc.TENDUOCDAYDU, dc.BHYT DUOC_BHYT, ld.LOAIVATTU_ID, ld.MALOAIDUOC, dd.DICTIONARY_NAME DUONGDUNG, dc.TAMNGUNG            from TT_TOATHUOCMAU A            left join TM_DUOC dc on A.DUOC_ID = dc.DUOC_ID            left join TM_LOAIDUOC ld on dc.LOAIDUOC_ID = ld.LOAIDUOC_ID            left join (select * from LST_DICTIONARY where DICTIONARY_TYPE_CODE like 'DuongDung') dd on dd.DICTIONARY_ID = dc.DUONGDUNG_ID            where (1=1)             and               A.BACSI_ID  = 1              and A.LOAITOATHUOC in  (                        @param0                   ,                           @param1                   ,                           @param2                   ,                           @param3                   )]
2019-08-14 11:40:25,048 [1] DEBUG - Statement Id: [DAO00040_LayListToaMau] Parameters: [@param0=[LSTLOAITOATHUOC[0],BV], @param1=[LSTLOAITOATHUOC[1],MN], @param2=[LSTLOAITOATHUOC[2],MP], @param3=[LSTLOAITOATHUOC[3],TV]]
2019-08-14 11:40:25,048 [1] DEBUG - Statement Id: [DAO00040_LayListToaMau] Types: [@param0=[String, System.String], @param1=[String, System.String], @param2=[String, System.String], @param3=[String, System.String]]
2019-08-14 11:40:25,172 [1] DEBUG - Statement Id: [DAO00040_LayListToaMau] PreparedStatement : [select A.*, dc.TENDUOCDAYDU, dc.BHYT DUOC_BHYT, ld.LOAIVATTU_ID, ld.MALOAIDUOC, dd.DICTIONARY_NAME DUONGDUNG, dc.TAMNGUNG            from TT_TOATHUOCMAU A            left join TM_DUOC dc on A.DUOC_ID = dc.DUOC_ID            left join TM_LOAIDUOC ld on dc.LOAIDUOC_ID = ld.LOAIDUOC_ID            left join (select * from LST_DICTIONARY where DICTIONARY_TYPE_CODE like 'DuongDung') dd on dd.DICTIONARY_ID = dc.DUONGDUNG_ID            where (1=1)             and               A.BACSI_ID  = 1              and A.LOAITOATHUOC in  (                        @param0                   ,                           @param1                   ,                           @param2                   ,                           @param3                   )]
2019-08-14 11:40:25,172 [1] DEBUG - Statement Id: [DAO00040_LayListToaMau] Parameters: [@param0=[LSTLOAITOATHUOC[0],BV], @param1=[LSTLOAITOATHUOC[1],MN], @param2=[LSTLOAITOATHUOC[2],MP], @param3=[LSTLOAITOATHUOC[3],TV]]
2019-08-14 11:40:25,172 [1] DEBUG - Statement Id: [DAO00040_LayListToaMau] Types: [@param0=[String, System.String], @param1=[String, System.String], @param2=[String, System.String], @param3=[String, System.String]]
2019-08-14 11:40:25,273 [1] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoVaBookingCOM23UpdateRedis_TheoPhamvi] PreparedStatement : [select distinct tk.DUOC_KEY, tk.SOLUONG        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        inner join        (        select  LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')) DUOC_KEY, (SUM(dtk.SOLUONG) - isnull(sum(A.SOLUONG),0) - isnull(sum(B.SOLUONG),0)) SOLUONG, pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        from (select sum(soluong) soluong,duoc_id,nguonduoc_id,khoduoc_id,benhvien_id from TT_DUOC_TONKHO  group by duoc_id,nguonduoc_id,khoduoc_id,benhvien_id) dtk        inner join TM_DUOC_PHAMVISD_MAPPING pvsd on dtk.KHODUOC_ID = pvsd.KHODUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NOITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) B on B.DUOC_ID = dtk.DUOC_ID and B.SOLUONG > 0 and B.PHAMVI_ID = pvsd.PHAMVI_ID and B.NGUONHANG_ID = dtk.NGUONDUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NGOAITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) A on A.DUOC_ID = dtk.DUOC_ID and A.SOLUONG > 0 and A.PHAMVI_ID = pvsd.PHAMVI_ID and A.NGUONHANG_ID = dtk.NGUONDUOC_ID        where dtk.SOLUONG > 0 and dtk.BENHVIEN_ID = 'HLU01'        group by LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')), pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        ) tk on tk.DUOC_ID = d.DUOC_ID        left join TM_DUOC_PHAMVISUDUNG kd on kd.PHAMVI_ID = tk.PHAMVI_ID and kd.BENHVIEN_ID = 'HLU01'        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = tk.NGUONDUOC_ID and nh.BENHVIEN_ID = 'HLU01'        where  d.BENHVIEN_ID = 'HLU01' and tk.PHAMVI_ID =  @param0]
2019-08-14 11:40:25,274 [1] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoVaBookingCOM23UpdateRedis_TheoPhamvi] Parameters: [@param0=[PHAMVI_ID,1028]]
2019-08-14 11:40:25,274 [1] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoVaBookingCOM23UpdateRedis_TheoPhamvi] Types: [@param0=[Int64, System.Int64]]
2019-08-14 11:40:25,555 [1] DEBUG - Statement Id: [DAO00013_GetTienSuBenh] PreparedStatement : [select TIENSUBENH, TIENSUDIUNG              from TT_BENHNHAN              where TT_BENHNHAN.BENHNHAN_ID  = '9046']
2019-08-14 11:40:25,662 [1] DEBUG - Statement Id: [DAO00095_GetTTDiUngThuoc] PreparedStatement : [select *              from TT_BENHNHAN_DIUNG_THUOC              where BENHNHAN_ID = '9046'              and BENHVIEN_ID = 'HLU01']
2019-08-14 11:40:25,698 [1] DEBUG - Statement Id: [DAO00014_GetTotalChiPhiDVByTiepNhan] PreparedStatement : [select sum(THANHTIEN_DOANHTHU) as THANHTIEN_DOANHTHU from TT_VIENPHI        where ACTIVE = '1'        and TIEPNHAN_ID = '9383'        and REF_TABLE = 'TT_DVYEUCAU'        and exists (select DVYEUCAU_ID from TT_DVYEUCAU where HUYYEUCAU = '0' and TIEPNHAN_ID = '9383' and TT_VIENPHI.REF_ID = DVYEUCAU_ID)]
2019-08-14 11:40:25,740 [1] DEBUG - Statement Id: [DAO00014_GetKhamBenhInfo] PreparedStatement : [select * from TT_NGOAITRU_KHAMBENH where KHAMBENH_ID =        (select KHAMBENH_NGOAITRU_ID from TT_DVYEUCAU where DVYEUCAU_ID = '67614')]
2019-08-14 11:40:25,771 [1] DEBUG - Statement Id: [DAO00014_GetSoCaKhamTrongNgay] PreparedStatement : [select Count(KB.KHAMBENH_ID) as SOCAKHAMTRONGNGAY        from TT_NGOAITRU_KHAMBENH KB        inner join TT_TIEPNHAN TN on TN.TIEPNHAN_ID = KB.TIEPNHAN_ID        where KB.NGAYKHAM = convert(date, GETDATE())        and KB.BACSIKHAM_ID = '1'        and KB.BENHVIEN_ID = 'HLU01'        and TN.SOBHYT IS NOT NULL and TN.SOBHYT != '']
2019-08-14 11:40:25,913 [1] DEBUG - Statement Id: [DAO00068_GetLastedSinhHieuInfo] PreparedStatement : [select top (1) *, CHISOBMI as BMI              from TT_NGOAITRU_KHAMBENH_SINHHIEU              where BENHNHAN_ID = '9046'              order by KHAMBENH_SINHHIEU_ID desc]
2019-08-14 11:40:26,084 [1] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoVaBookingCOM23UpdateRedis_TheoPhamvi] PreparedStatement : [select distinct tk.DUOC_KEY, tk.SOLUONG        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        inner join        (        select  LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')) DUOC_KEY, (SUM(dtk.SOLUONG) - isnull(sum(A.SOLUONG),0) - isnull(sum(B.SOLUONG),0)) SOLUONG, pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        from (select sum(soluong) soluong,duoc_id,nguonduoc_id,khoduoc_id,benhvien_id from TT_DUOC_TONKHO  group by duoc_id,nguonduoc_id,khoduoc_id,benhvien_id) dtk        inner join TM_DUOC_PHAMVISD_MAPPING pvsd on dtk.KHODUOC_ID = pvsd.KHODUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NOITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) B on B.DUOC_ID = dtk.DUOC_ID and B.SOLUONG > 0 and B.PHAMVI_ID = pvsd.PHAMVI_ID and B.NGUONHANG_ID = dtk.NGUONDUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NGOAITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) A on A.DUOC_ID = dtk.DUOC_ID and A.SOLUONG > 0 and A.PHAMVI_ID = pvsd.PHAMVI_ID and A.NGUONHANG_ID = dtk.NGUONDUOC_ID        where dtk.SOLUONG > 0 and dtk.BENHVIEN_ID = 'HLU01'        group by LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')), pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        ) tk on tk.DUOC_ID = d.DUOC_ID        left join TM_DUOC_PHAMVISUDUNG kd on kd.PHAMVI_ID = tk.PHAMVI_ID and kd.BENHVIEN_ID = 'HLU01'        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = tk.NGUONDUOC_ID and nh.BENHVIEN_ID = 'HLU01'        where  d.BENHVIEN_ID = 'HLU01' and tk.PHAMVI_ID =  @param0]
2019-08-14 11:40:26,084 [1] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoVaBookingCOM23UpdateRedis_TheoPhamvi] Parameters: [@param0=[PHAMVI_ID,1028]]
2019-08-14 11:40:26,084 [1] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoVaBookingCOM23UpdateRedis_TheoPhamvi] Types: [@param0=[Int64, System.Int64]]
--------------------------------------------------------------------------------
2019-08-14 13:37:34,876 [1] DEBUG - Statement Id: [DAO00001_DBList] PreparedStatement : [select *              from TM_SYS_SERVER              where HOSPITAL_ID = '_SYSTEM_' and TYPE = 'D']
2019-08-14 13:37:35,201 [1] DEBUG - Statement Id: [DAO00001_DaoList] PreparedStatement : [select              TM_SYS_SERVICEMAP.ID,              TM_SYS_SERVICEMAP.HOSPITAL_ID,              TM_SYS_SERVICEMAP.DB_NAME,              TM_SYS_SERVICEMAP.TYPE,              TM_SYS_SERVICEMAP.NAME,              TM_SYS_SERVICEMAP.CLASS,              (TM_SYS_DIC.VALUE + '.' + TM_SYS_SERVICEMAP.CLASS) as CLASSFULL,              TM_SYS_SERVICEMAP.ASSEMBLY              from TM_SYS_SERVICEMAP              inner join TM_SYS_DIC              on TM_SYS_SERVICEMAP.NAMESPACE = TM_SYS_DIC.ID              where HOSPITAL_ID = '_SYSTEM_' AND TYPE = 'D' AND ACTIVE = '1'              order by DB_NAME]
2019-08-14 13:37:35,240 [1] DEBUG - Statement Id: [DAO00001_ServiceList] PreparedStatement : [select              TM_SYS_SERVICEMAP.ID,              TM_SYS_SERVICEMAP.HOSPITAL_ID,              TM_SYS_SERVICEMAP.DB_NAME,              TM_SYS_SERVICEMAP.TYPE,              TM_SYS_SERVICEMAP.NAME,              TM_SYS_SERVICEMAP.CLASS,              (TM_SYS_DIC.VALUE + '.' + TM_SYS_SERVICEMAP.CLASS) as CLASSFULL,              TM_SYS_SERVICEMAP.ASSEMBLY,              TM_SYS_SERVER.URL              from TM_SYS_SERVICEMAP              inner join TM_SYS_DIC on TM_SYS_SERVICEMAP.NAMESPACE = TM_SYS_DIC.ID              inner join TM_SYS_SERVER on (TM_SYS_SERVICEMAP.DB_NAME = TM_SYS_SERVER.NAME) and (TM_SYS_SERVER.HOSPITAL_ID = '_SYSTEM_')              where TM_SYS_SERVICEMAP.HOSPITAL_ID = '_SYSTEM_' AND TM_SYS_SERVICEMAP.TYPE = 'S'  AND ACTIVE = '1'              order by URL]
2019-08-14 13:37:35,645 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = '_SYSTEM_'               AND                   TM_SYS_SCREEN.PAGE = 'LOGIN'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2019-08-14 13:37:35,880 [1] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = '_SYSTEM_'               AND                   TM_SYS_CACHE.ACTIVE = '1']
2019-08-14 13:37:46,132 [1] DEBUG - Statement Id: [DAO00001_DBList] PreparedStatement : [select *              from TM_SYS_SERVER              where HOSPITAL_ID = 'HLU01' and TYPE = 'D']
2019-08-14 13:37:46,235 [1] DEBUG - Statement Id: [DAO00001_DaoList] PreparedStatement : [select              TM_SYS_SERVICEMAP.ID,              TM_SYS_SERVICEMAP.HOSPITAL_ID,              TM_SYS_SERVICEMAP.DB_NAME,              TM_SYS_SERVICEMAP.TYPE,              TM_SYS_SERVICEMAP.NAME,              TM_SYS_SERVICEMAP.CLASS,              (TM_SYS_DIC.VALUE + '.' + TM_SYS_SERVICEMAP.CLASS) as CLASSFULL,              TM_SYS_SERVICEMAP.ASSEMBLY              from TM_SYS_SERVICEMAP              inner join TM_SYS_DIC              on TM_SYS_SERVICEMAP.NAMESPACE = TM_SYS_DIC.ID              where HOSPITAL_ID = 'HLU01' AND TYPE = 'D' AND ACTIVE = '1'              order by DB_NAME]
2019-08-14 13:37:48,094 [1] DEBUG - Statement Id: [DAO00001_ServiceList] PreparedStatement : [select              TM_SYS_SERVICEMAP.ID,              TM_SYS_SERVICEMAP.HOSPITAL_ID,              TM_SYS_SERVICEMAP.DB_NAME,              TM_SYS_SERVICEMAP.TYPE,              TM_SYS_SERVICEMAP.NAME,              TM_SYS_SERVICEMAP.CLASS,              (TM_SYS_DIC.VALUE + '.' + TM_SYS_SERVICEMAP.CLASS) as CLASSFULL,              TM_SYS_SERVICEMAP.ASSEMBLY,              TM_SYS_SERVER.URL              from TM_SYS_SERVICEMAP              inner join TM_SYS_DIC on TM_SYS_SERVICEMAP.NAMESPACE = TM_SYS_DIC.ID              inner join TM_SYS_SERVER on (TM_SYS_SERVICEMAP.DB_NAME = TM_SYS_SERVER.NAME) and (TM_SYS_SERVER.HOSPITAL_ID = 'HLU01')              where TM_SYS_SERVICEMAP.HOSPITAL_ID = 'HLU01' AND TM_SYS_SERVICEMAP.TYPE = 'S'  AND ACTIVE = '1'              order by URL]
2019-08-14 13:37:48,183 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1']
2019-08-14 13:37:48,971 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM005']
2019-08-14 13:37:49,148 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM015']
2019-08-14 13:37:49,237 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM067']
2019-08-14 13:37:49,343 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM008']
2019-08-14 13:37:49,505 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM068']
2019-08-14 13:37:49,603 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM006']
2019-08-14 13:37:49,731 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM030']
2019-08-14 13:37:49,815 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM025']
2019-08-14 13:37:49,897 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM024']
2019-08-14 13:37:50,410 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM033']
2019-08-14 13:37:50,466 [5] DEBUG - Statement Id: [DAO00027_GetListDuocKyGuiTonKho] PreparedStatement : [select  distinct TT_TONKHO.DUOC_KEY, LTRIM(TT_TONKHO.KHODUOC_ID) as KHODUOC_ID, TM_DUOC.DUOC_ID, TM_LOAIDUOC.MALOAIDUOC,TM_DUOC.SOVISA,TM_DUOC.TYLE_VAT,TM_DUOC.COTOA,        TM_DUOC.MADUOC, TM_DUOC.TENHANG, TM_DUOC.TENDUOCDAYDU, dvt.TENDONVITINH as DONVITINH,  TM_DUOC.DONVITINH_ID,TM_DUOC.BHYT,TM_DUOC.PHAMVI,        TM_DUOC.TENHOATCHAT, TM_DUOC.HAMLUONG, TM_DUOC.HANGSANXUAT, TM_DUOC.QUOCGIA, TM_DUOC.LOAIDUOC_ID, TM_DUOC.DUONGDUNG_ID,        TM_TENDUOC.TENDUOC, TM_TENDUOC.TENDUOC_EN, TM_TENDUOC.MAQUOCTE, TM_TENDUOC.MAQUOCTEBT,        TM_LOAIDUOC.LOAIVATTU_ID, TM_DUOC.BENHVIEN_ID,TT_TONKHO.SOLUONG, TT_TONKHO.NGUONDUOC_ID, NH.TENNGUONDUOC        , TAMNGUNG = CASE WHEN TM_DUOC.TAMNGUNG = '1' OR nh.TAMNGUNG = '1' OR KD.TAMNGUNG = '1' THEN '1' ELSE '0' END        , TM_DUOC.DANGTRINHBAY        from TM_DUOC        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = TM_DUOC.DONVITINH_ID        left join TM_TENDUOC on TM_DUOC.TENDUOC_ID = TM_TENDUOC.TENDUOC_ID and TM_DUOC.BENHVIEN_ID = 'HLU01' and TM_DUOC.TAMNGUNG = '0'        left join TM_LOAIDUOC on TM_LOAIDUOC.LOAIDUOC_ID = TM_DUOC.LOAIDUOC_ID and TM_LOAIDUOC.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG on (TM_LOAIDUOC.LOAIVATTU_ID = TM_DUOC_HANDUNG.LOAIDUOC and TM_DUOC_HANDUNG.BENHVIEN_ID = 'HLU01')        inner join        (select LTRIM(A.KHODUOC_ID) + '_' + LTRIM(A.DUOC_ID) + '_' + LTRIM(ISNULL(A.NGUONDUOC_ID,'')) as DUOC_KEY, A.KHODUOC_ID, A.DUOC_ID,A.NGUONDUOC_ID,        SUM(isnull(A.SOLUONG,0)) as SOLUONG        from        (select SUM(SOLUONG) as SOLUONG, KHODUOC_ID, DUOC_ID, NGUONDUOC_ID from TT_DUOC_KYGUI_TONKHO        where BENHVIEN_ID = 'HLU01' group by KHODUOC_ID, DUOC_ID, NGUONDUOC_ID) A        group by LTRIM(A.KHODUOC_ID) + '_' + LTRIM(A.DUOC_ID) + '_' + LTRIM(A.NGUONDUOC_ID), A.KHODUOC_ID, A.DUOC_ID, A.NGUONDUOC_ID)        TT_TONKHO on TT_TONKHO.DUOC_ID = TM_DUOC.DUOC_ID        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = TT_TONKHO.NGUONDUOC_ID and nh.BENHVIEN_ID = 'HLU01'        LEFT JOIN TM_KHODUOC KD ON KD.KHODUOC_ID = TT_TONKHO.KHODUOC_ID        where TM_DUOC.BENHVIEN_ID = 'HLU01' AND TT_TONKHO.SOLUONG >= 0]
2019-08-14 13:37:50,545 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM018']
2019-08-14 13:37:50,588 [5] DEBUG - Statement Id: [DAO00027_GetListDuocTonKho] PreparedStatement : [select distinct TT_TONKHO.DUOC_KEY, LTRIM(TT_TONKHO.KHODUOC_ID) as KHODUOC_ID, TM_DUOC.DUOC_ID, TM_LOAIDUOC.MALOAIDUOC,TM_DUOC.SOVISA,TM_DUOC.TYLE_VAT,TM_DUOC.COTOA,        TM_DUOC.MADUOC, TM_DUOC.TENHANG, TM_DUOC.TENDUOCDAYDU, dvt.TENDONVITINH as DONVITINH,  TM_DUOC.DONVITINH_ID,TM_DUOC.BHYT,                TM_DUOC.TENHOATCHAT,          TM_DUOC.HAMLUONG, TM_DUOC.HANGSANXUAT, TM_DUOC.QUOCGIA, TM_DUOC.LOAIDUOC_ID, TM_DUOC.DUONGDUNG_ID,        TM_TENDUOC.TENDUOC, TM_TENDUOC.TENDUOC_EN, TM_TENDUOC.MAQUOCTE, TM_TENDUOC.MAQUOCTEBT,        TM_LOAIDUOC.LOAIVATTU_ID, TM_DUOC.BENHVIEN_ID,        TT_TONKHO.SOLUONG, TM_DUOC.VTYT_PHANLOAI, TM_DUOC.PHAMVI, TT_TONKHO.NGUONDUOC_ID, NG.TENNGUONDUOC AS TENNGUONDUOC        , TAMNGUNG = CASE WHEN TM_DUOC.TAMNGUNG = '1' OR NG.TAMNGUNG = '1' OR KD.TAMNGUNG = '1' THEN '1' ELSE '0' END        , TM_DUOC.DANGTRINHBAY        from TM_DUOC        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = TM_DUOC.DONVITINH_ID        left join TM_TENDUOC on TM_DUOC.TENDUOC_ID = TM_TENDUOC.TENDUOC_ID and TM_DUOC.BENHVIEN_ID = 'HLU01' and TM_DUOC.TAMNGUNG = '0'        left join TM_LOAIDUOC on TM_LOAIDUOC.LOAIDUOC_ID = TM_DUOC.LOAIDUOC_ID and TM_LOAIDUOC.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG on (TM_LOAIDUOC.LOAIVATTU_ID = TM_DUOC_HANDUNG.LOAIDUOC and TM_DUOC_HANDUNG.BENHVIEN_ID = 'HLU01')        inner join        (select LTRIM(A.KHODUOC_ID) + '_' + LTRIM(A.DUOC_ID) + '_' + LTRIM(ISNULL(A.NGUONDUOC_ID,'')) as DUOC_KEY, A.KHODUOC_ID, A.DUOC_ID, A.NGUONDUOC_ID,        SUM(isnull(A.SOLUONG,0)) as SOLUONG        from        (select SUM(SOLUONG) as SOLUONG, KHODUOC_ID, DUOC_ID, NGUONDUOC_ID from TT_DUOC_TONKHO        where BENHVIEN_ID = 'HLU01' group by KHODUOC_ID, DUOC_ID, NGUONDUOC_ID) A        group by LTRIM(A.KHODUOC_ID) + '_' + LTRIM(A.DUOC_ID) + '_' + LTRIM(ISNULL(A.NGUONDUOC_ID,'')), A.KHODUOC_ID, A.DUOC_ID, NGUONDUOC_ID        ) TT_TONKHO on TT_TONKHO.DUOC_ID = TM_DUOC.DUOC_ID        LEFT JOIN TM_NGUONHANG NG ON NG.NGUONDUOC_ID = TT_TONKHO.NGUONDUOC_ID        LEFT JOIN TM_KHODUOC KD ON KD.KHODUOC_ID = TT_TONKHO.KHODUOC_ID        where TM_DUOC.BENHVIEN_ID = 'HLU01' and TT_TONKHO.SOLUONG >= 0]
2019-08-14 13:37:54,566 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM023']
2019-08-14 13:37:54,608 [5] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoVaBooking] PreparedStatement : [declare @TOAMUANGOAI int = 0;        select @TOAMUANGOAI = isnull(VALUE,0) from TM_SYS_APPSETTINGS where CODE = 'OPD_TOAMUANGOAI_DUNGDANHMUC_DUOC'                if @TOAMUANGOAI = 1        begin        select  distinct '0' + '_' + LTRIM(d.DUOC_ID) + '_' + '0' as DUOC_KEY, 0 as PHAMVI_ID, 0 as NGUONDUOC_ID, null as TENNGUONDUOC, null as TINHTIEN, d.DUOC_ID, ld.MALOAIDUOC,        d.SOVISA,d.TYLE_VAT,d.COTOA, d.MADUOC, d.TENHANG, d.TENDUOCDAYDU, d.DONVITINH as DONVITINH, d.BHYT,        d.TENHOATCHAT, d.HAMLUONG, d.HANGSANXUAT, d.QUOCGIA, d.LOAIDUOC_ID, d.DUONGDUNG_ID, d.TINHTIEN_PTTT,        ten.TENDUOC, ten.TENDUOC_EN, ten.MAQUOCTE, ten.MAQUOCTEBT,        '' as BHYT_TEXT        , ld.LOAIVATTU_ID        , d.BENHVIEN_ID,        999999999 as SOLUONG, d.VTYT_PHANLOAI, d.PHAMVI, d.SUASOLUONGTONGHOP, d.MADUOCBV, d.DANGTRINHBAY        , TAMNGUNG = CASE WHEN d.TAMNGUNG = '1' THEN '1' ELSE '0' END        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        union all        select  distinct tk.DUOC_KEY, LTRIM(tk.PHAMVI_ID) as PHAMVI_ID, tk.NGUONDUOC_ID, nh.TENNGUONDUOC, nh.TINHTIEN, d.DUOC_ID, ld.MALOAIDUOC,        d.SOVISA,d.TYLE_VAT,d.COTOA, d.MADUOC, d.TENHANG, d.TENDUOCDAYDU, dvt.TENDONVITINH as DONVITINH, d.BHYT,        d.TENHOATCHAT, d.HAMLUONG, d.HANGSANXUAT, d.QUOCGIA, d.LOAIDUOC_ID, d.DUONGDUNG_ID, d.TINHTIEN_PTTT,        ten.TENDUOC, ten.TENDUOC_EN, ten.MAQUOCTE, ten.MAQUOCTEBT,        CASE WHEN d.BHYT = '1' THEN 'BHYT' ELSE '' END as BHYT_TEXT        , ld.LOAIVATTU_ID        , d.BENHVIEN_ID,        tk.SOLUONG, d.VTYT_PHANLOAI, d.PHAMVI, d.SUASOLUONGTONGHOP, d.MADUOCBV, d.DANGTRINHBAY        , TAMNGUNG = CASE WHEN d.TAMNGUNG = '1' OR nh.TAMNGUNG = '1' OR kd.TAMNGUNG = '1' THEN '1' ELSE '0' END        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        inner join        (        select  LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')) DUOC_KEY, (SUM(dtk.SOLUONG) - isnull(sum(A.SOLUONG),0) - isnull(sum(B.SOLUONG),0)) SOLUONG, pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        from (select sum(soluong) soluong,duoc_id,nguonduoc_id,khoduoc_id,benhvien_id from TT_DUOC_TONKHO  group by duoc_id,nguonduoc_id,khoduoc_id,benhvien_id) dtk        inner join TM_DUOC_PHAMVISD_MAPPING pvsd on dtk.KHODUOC_ID = pvsd.KHODUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NOITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) B on B.DUOC_ID = dtk.DUOC_ID and B.SOLUONG > 0 and B.PHAMVI_ID = pvsd.PHAMVI_ID and B.NGUONHANG_ID = dtk.NGUONDUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NGOAITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) A on A.DUOC_ID = dtk.DUOC_ID and A.SOLUONG > 0 and A.PHAMVI_ID = pvsd.PHAMVI_ID and A.NGUONHANG_ID = dtk.NGUONDUOC_ID        where dtk.SOLUONG > 0 and dtk.BENHVIEN_ID = 'HLU01'        group by LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')), pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        ) tk on tk.DUOC_ID = d.DUOC_ID        left join TM_DUOC_PHAMVISUDUNG kd on kd.PHAMVI_ID = tk.PHAMVI_ID and kd.BENHVIEN_ID = 'HLU01'        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = tk.NGUONDUOC_ID and nh.BENHVIEN_ID = 'HLU01'        where d.BENHVIEN_ID = 'HLU01'  and tk.SOLUONG >= 0         end                else        begin        select  distinct tk.DUOC_KEY, LTRIM(tk.PHAMVI_ID) as PHAMVI_ID, tk.NGUONDUOC_ID, nh.TENNGUONDUOC, nh.TINHTIEN, d.DUOC_ID, ld.MALOAIDUOC,        d.SOVISA,d.TYLE_VAT,d.COTOA, d.MADUOC, d.TENHANG, d.TENDUOCDAYDU, d.DONVITINH as DONVITINH, d.BHYT,        d.TENHOATCHAT, d.HAMLUONG, d.HANGSANXUAT, d.QUOCGIA, d.LOAIDUOC_ID, d.DUONGDUNG_ID, d.TINHTIEN_PTTT,        ten.TENDUOC, ten.TENDUOC_EN, ten.MAQUOCTE, ten.MAQUOCTEBT,        CASE WHEN d.BHYT = '1' THEN 'BHYT' ELSE '' END as BHYT_TEXT        , ld.LOAIVATTU_ID        , d.BENHVIEN_ID,        tk.SOLUONG, d.VTYT_PHANLOAI, d.PHAMVI, d.SUASOLUONGTONGHOP, d.MADUOCBV, d.DANGTRINHBAY        , TAMNGUNG = CASE WHEN d.TAMNGUNG = '1' OR nh.TAMNGUNG = '1' OR kd.TAMNGUNG = '1' THEN '1' ELSE '0' END        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        inner join        (        select  LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')) DUOC_KEY, (SUM(dtk.SOLUONG) - isnull(sum(A.SOLUONG),0) - isnull(sum(B.SOLUONG),0)) SOLUONG, pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        from (select sum(soluong) soluong,duoc_id,nguonduoc_id,khoduoc_id,benhvien_id from TT_DUOC_TONKHO  group by duoc_id,nguonduoc_id,khoduoc_id,benhvien_id) dtk        inner join TM_DUOC_PHAMVISD_MAPPING pvsd on dtk.KHODUOC_ID = pvsd.KHODUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NOITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) B on B.DUOC_ID = dtk.DUOC_ID and B.SOLUONG > 0 and B.PHAMVI_ID = pvsd.PHAMVI_ID and B.NGUONHANG_ID = dtk.NGUONDUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NGOAITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) A on A.DUOC_ID = dtk.DUOC_ID and A.SOLUONG > 0 and A.PHAMVI_ID = pvsd.PHAMVI_ID and A.NGUONHANG_ID = dtk.NGUONDUOC_ID        where dtk.SOLUONG > 0 and dtk.BENHVIEN_ID = 'HLU01'        group by LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')), pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        ) tk on tk.DUOC_ID = d.DUOC_ID        left join TM_DUOC_PHAMVISUDUNG kd on kd.PHAMVI_ID = tk.PHAMVI_ID and kd.BENHVIEN_ID = 'HLU01'        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = tk.NGUONDUOC_ID and nh.BENHVIEN_ID = 'HLU01'        where d.BENHVIEN_ID = 'HLU01'  and tk.SOLUONG >= 0        end]
2019-08-14 13:37:58,136 [5] DEBUG - Statement Id: [DAO00320_GetList] PreparedStatement : [select M.*            from TM_MAU M            LEFT JOIN TM_MAU_DONVITINH DVT on M.DONVITINH_ID=DVT.DONVITINH_ID            where            M.TAMNGUNG = '0'            and M.BENHVIEN_ID = 'HLU01'            order by M.TENMAU]
2019-08-14 13:37:58,223 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM071']
2019-08-14 13:37:58,271 [5] DEBUG - Statement Id: [DAO00322_GetListMauTonKhoForCreateCached] PreparedStatement : [SELECT DISTINCT          TK.MAU_KEY, TK.KHOMAU_ID, M.MAU_ID, M.MAMAU, M.TENMAU, M.NHOM_ABO, M.NHOM_RH, M.LOAIMAU_ID,          TK.SOLONHAP_ID, SLN.SOLONHAP, SLN.SOKIEMSOAT, TK.NGUONHANG_ID, NG.TENNGUONMAU, M.BENHVIEN_ID, M.DONVITINH_ID,          SUM(tk.SOLUONG) AS SOLUONG,K.TENKHO,DVT.TENDONVITINH          FROM TT_MAU_TONKHO TK          JOIN TM_KHO K ON TK.KHOMAU_ID = K.KHO_ID          JOIN TT_MAU_CHUNGTU_SOLONHAP SLN ON TK.SOLONHAP_ID = SLN.SOLONHAP_ID          JOIN TM_MAU M on TK.MAU_ID = M.MAU_ID and M.TAMNGUNG = '0'          LEFT JOIN TM_MAU_DONVITINH DVT on M.DONVITINH_ID=DVT.DONVITINH_ID          LEFT JOIN TM_NGUONMAU NG ON NG.NGUONMAU_ID = TK.NGUONHANG_ID          WHERE TK.SOLUONG > 0          GROUP BY TK.MAU_KEY, TK.KHOMAU_ID, M.MAU_ID, M.MAMAU, M.TENMAU, M.NHOM_ABO, M.NHOM_RH, M.LOAIMAU_ID,          TK.SOLONHAP_ID, SLN.SOLONHAP, SLN.SOKIEMSOAT,TK.NGUONHANG_ID, NG.TENNGUONMAU, M.BENHVIEN_ID, M.DONVITINH_ID,K.TENKHO,DVT.TENDONVITINH]
2019-08-14 13:37:58,386 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM073']
2019-08-14 13:37:58,425 [5] DEBUG - Statement Id: [DAO00322_GetListMauTonKhoTruBooking] PreparedStatement : [select distinct          TK.MAU_KEY, TK.KHOMAU_ID, M.MAU_ID, M.MAMAU, M.TENMAU, M.NHOM_ABO, M.NHOM_RH, M.LOAIMAU_ID, M.DONVITINH_ID,          TK.SOLONHAP_ID, TK.SOLONHAP, TK.SOKIEMSOAT,M.PHAMVI, TK.NGUONHANG_ID, NG.TENNGUONMAU, M.BENHVIEN_ID,          TK.SOLUONG,TK.TENKHO,DVT.TENDONVITINH          from TM_MAU M          JOIN          (          select          A.MAU_KEY, A.KHOMAU_ID, A.MAU_ID ,a.NGUONHANG_ID, A.SOLONHAP_ID, A.SOLONHAP, A.SOKIEMSOAT, A.SOLUONG,A.TENKHO          from          (          select KHOMAU_ID, TK.MAU_ID, TK.NGUONHANG_ID, TK.MAU_KEY, SLN.SOLONHAP_ID, SLN.SOLONHAP, SLN.SOKIEMSOAT, ISNULL(TK.SOLUONG,0) - ISNULL(book.SOLUONG,0) as SOLUONG,K.TENKHO          from TT_MAU_TONKHO TK          JOIN TM_KHO K ON TK.KHOMAU_ID = K.KHO_ID          inner join TT_MAU_CHUNGTU_SOLONHAP SLN ON TK.SOLONHAP_ID = SLN.SOLONHAP_ID          left join dbo.TT_MAU_TONKHO_BOOK book ON book.MAU_KEY = TK.MAU_KEY AND book.TRANGTHAI = 'HIEULUC'          where ISNULL(TK.SOLUONG,0) - ISNULL(book.SOLUONG,0) > 0          ) A          )TK on TK.MAU_ID = M.MAU_ID and M.TAMNGUNG = '0'          LEFT JOIN TM_MAU_DONVITINH DVT on M.DONVITINH_ID=DVT.DONVITINH_ID          LEFT JOIN TM_NGUONMAU NG ON NG.NGUONMAU_ID = TK.NGUONHANG_ID]
2019-08-14 13:37:58,505 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM072']
2019-08-14 13:37:59,463 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'MAIN'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2019-08-14 13:38:00,511 [1] DEBUG - Statement Id: [DAO00002_FormList] PreparedStatement : [select              TM_SYS_FORM.HOSPITAL_ID,              TM_SYS_FORM.NAME,              TM_SYS_FORM.CLASS,              TM_SYS_FORM.ASSEMBLY,              TM_SYS_FORM.TITLE_VI as TITLE              from TM_SYS_FORM              where HOSPITAL_ID = 'HLU01']
2019-08-14 13:38:07,155 [1] DEBUG - Statement Id: [DAO00300_GetShortcutListByUserID] PreparedStatement : [SELECT S.SHORTCUT_CODE, S.SHORTCUT_VALUE              FROM TM_SHORTCUT AS S              WHERE S.BENHVIEN_ID = 'HLU01' AND S.USER_ID = '1' AND TAMNGUNG = '0']
2019-08-14 13:38:07,186 [1] DEBUG - Statement Id: [DAO00087_GetList] PreparedStatement : [select CODE, VALUE, BENHVIEN_ID              from TM_SYS_APPSETTINGS              where LOCKED = '0' and BENHVIEN_ID = 'HLU01'              order by SETTING_ID]
2019-08-14 13:38:07,283 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'MSG01'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2019-08-14 13:38:07,414 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'MSG02'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2019-08-14 13:38:07,586 [1] DEBUG - Statement Id: [DAO00008_GetUserSettings] PreparedStatement : [select A.*, B.TENKHO , C.TENPHONGBAN, B.MAKHO, C.MAPHONGBAN          from TM_SYS_USERS A          left join TM_KHODUOC B on B.KHODUOC_ID = A.INVENTORY_ID          left join TM_PHONGBAN C on (C.PHONGBAN_ID = A.WORKING_DEPT_ID and C.BENHVIEN_ID =  @param0 )          left join TM_SYS_USERKHO D on (D.ACCOUNT_ID = A.ACCOUNT_ID and D.HOSPITAL_ID =  @param0 )          where          A.HOSPITAL_ID =  @param0            and                 A.ACCOUNT_ID =  @param1]
2019-08-14 13:38:07,588 [1] DEBUG - Statement Id: [DAO00008_GetUserSettings] Parameters: [@param0=[HOSPITAL_ID,HLU01], @param1=[ACCOUNT_ID,113]]
2019-08-14 13:38:07,588 [1] DEBUG - Statement Id: [DAO00008_GetUserSettings] Types: [@param0=[String, System.String], @param1=[String, System.String]]
2019-08-14 13:38:07,619 [1] DEBUG - Statement Id: [DAO00008_GetUserInvSettings] PreparedStatement : [select A.*, B.TENKHO, B.MAKHO, B.LOAIKHO_ID, B.KHOQUANLY_ID          from TM_SYS_USERKHO A          left join TM_KHO B on B.MODULE_ID = A.MODULE_ID and B.KHO_ID = A.KHO_ID          where A.HOSPITAL_ID =  @param0  and A.ACCOUNT_ID =  @param1           order by B.TENKHO]
2019-08-14 13:38:07,619 [1] DEBUG - Statement Id: [DAO00008_GetUserInvSettings] Parameters: [@param0=[HOSPITAL_ID,HLU01], @param1=[ACCOUNT_ID,113]]
2019-08-14 13:38:07,619 [1] DEBUG - Statement Id: [DAO00008_GetUserInvSettings] Types: [@param0=[String, System.String], @param1=[String, System.String]]
2019-08-14 13:38:07,793 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'COM30'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2019-08-14 13:38:07,988 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'RIS04'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2019-08-14 13:38:17,772 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'MENU1'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2019-08-14 13:38:17,866 [1] DEBUG - Statement Id: [DAO00011_GetList] PreparedStatement : [select              TM_SYS_MENU.ID,              TM_SYS_MENU.PARENTID,              TM_SYS_MENU.SCREEN,              TM_SYS_MENU.SMALLIMAGE,              TM_SYS_MENU.LARGEIMAGE,              TM_SYS_MENU.DESCRIPTION,              TM_SYS_MENU.TYPE,              TM_SYS_MENU.TITLE_VI as TITLE              from TM_SYS_MENU              where TM_SYS_MENU.HOSPITAL_ID = 'HLU01' and TM_SYS_MENU.ACTIVE = '1'               AND                   (TM_SYS_MENU.TYPE & '8' = '8')                             order by TM_SYS_MENU.ORDERNUM]
2019-08-14 13:38:18,248 [1] DEBUG - Statement Id: [DAO00011_usermenu_list] PreparedStatement : [select              TM_SYS_HOMEMENU.MENUID as ID,              TM_SYS_MENU.TITLE_VI as TITLE,              TM_SYS_MENU.SCREEN,              TM_SYS_MENU.SMALLIMAGE,              TM_SYS_MENU.LARGEIMAGE,              TM_SYS_MENU.TYPE              from TM_SYS_HOMEMENU              left join TM_SYS_MENU on TM_SYS_MENU.ID = TM_SYS_HOMEMENU.MENUID and TM_SYS_MENU.HOSPITAL_ID = TM_SYS_HOMEMENU.HOSPITAL_ID              where TM_SYS_HOMEMENU.HOSPITAL_ID = 'HLU01' and TM_SYS_HOMEMENU.USERID = '113' and TM_SYS_MENU.ACTIVE = '1'               AND                   (TM_SYS_MENU.TYPE & '8' = '8')                             ORDER BY TM_SYS_HOMEMENU.ORDERNUM]
2019-08-14 13:38:24,593 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'OPD02'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2019-08-14 13:38:26,187 [1] DEBUG - Statement Id: [DAO00017_GetLoaiGiaByDoiTuongId] PreparedStatement : [select dtlg.DOUUTIEN, dtlg.DOITUONG_ID, lg.LOAIGIA_ID, lg.TENLOAIGIA, lg.MALOAIGIA              from TM_LOAIGIA lg              left join TM_DOITUONG_LOAIGIA dtlg              on lg.LOAIGIA_ID = dtlg.LOAIGIA_ID and dtlg.BENHVIEN_ID = 'HLU01'              where lg.TAMNGUNG = 0 and lg.BENHVIEN_ID = 'HLU01'                             order by dtlg.DOUUTIEN]
2019-08-14 13:38:26,453 [1] DEBUG - Statement Id: [DAO00092_GetList_ToathuocNgoaitru] PreparedStatement : [select A.*, B.PHAMVI_ID, C.KHODUOC_ID from TM_TOATHUOC_NGOAITRU A        left join TM_DUOC_PHAMVISUDUNG B on B.MAPHAMVI = A.MAPHAMVI        left join (select distinct PHAMVI_ID, KHODUOC_ID from TM_DUOC_PHAMVISD_MAPPING) C on C.PHAMVI_ID = B.PHAMVI_ID        where A.TAMNGUNG != '1' and A.BENHVIEN_ID = 'HLU01'        ORDER BY A.SAPXEP ASC]
2019-08-14 13:38:31,168 [1] DEBUG - Statement Id: [DAO00009_TT_TIEPNHAN_GetProcess] PreparedStatement : [select PROCESS_ID from TT_TIEPNHAN where SOTIEPNHAN = 'TN190602.0000288']
2019-08-14 13:38:31,347 [1] DEBUG - Statement Id: [DAOWF004_laytrangthaiDV] PreparedStatement : [select top 1 A.CURR_STATE_CODE as STATE_CODE, isNull(C.SHORT_NAME,C.NAME) as TRANGTHAI, C.NAME as TRANGTHAI_CHITIET, C.STATUS_CODE, D.ISACTIVE as ACTIVE, E.STATUS_CODE  as OLD_STATUSCODE        from TT_REQUEST_SERVICE_DETAIL A                left join (select * from TT_REQUEST_SERVICE where PARA = '{"DICHVU_ID":"5436","DVYEUCAU_ID":"198821"}') D on D.ID = A.REQUEST_SERVICE_ID        left join TM_STATE C on A.CURR_STATE_CODE = C.STATE_CODE and C.PROCESS_CODE = D.PROCESS_CODE        left join TM_STATE E on A.OLD_STATE_CODE = E.STATE_CODE and E.PROCESS_CODE = D.PROCESS_CODE        where        A.REQUEST_SERVICE_ID = (select top 1 ID from TT_REQUEST_SERVICE where PARA = '{"DICHVU_ID":"5436","DVYEUCAU_ID":"198821"}' order by ID desc)        order by A.ID desc]
2019-08-14 13:38:31,601 [1] DEBUG - Statement Id: [DAO00017_GetLoaiGiaByDoiTuongId] PreparedStatement : [select dtlg.DOUUTIEN, dtlg.DOITUONG_ID, lg.LOAIGIA_ID, lg.TENLOAIGIA, lg.MALOAIGIA              from TM_LOAIGIA lg              left join TM_DOITUONG_LOAIGIA dtlg              on lg.LOAIGIA_ID = dtlg.LOAIGIA_ID and dtlg.BENHVIEN_ID = 'HLU01'              where lg.TAMNGUNG = 0 and lg.BENHVIEN_ID = 'HLU01'                             order by dtlg.DOUUTIEN]
2019-08-14 13:38:31,692 [1] DEBUG - Statement Id: [DAO00087_GetServiceParams] PreparedStatement : [select CODE, VALUE              from TM_SYS_APPSETTINGS              where LOCKED = '0' and BENHVIEN_ID = 'HLU01']
2019-08-14 13:38:31,811 [1] DEBUG - Statement Id: [DAO00040_LayListToaMau] PreparedStatement : [select A.*, dc.TENDUOCDAYDU, dc.BHYT DUOC_BHYT, ld.LOAIVATTU_ID, ld.MALOAIDUOC, dd.DICTIONARY_NAME DUONGDUNG, dc.TAMNGUNG            from TT_TOATHUOCMAU A            left join TM_DUOC dc on A.DUOC_ID = dc.DUOC_ID            left join TM_LOAIDUOC ld on dc.LOAIDUOC_ID = ld.LOAIDUOC_ID            left join (select * from LST_DICTIONARY where DICTIONARY_TYPE_CODE like 'DuongDung') dd on dd.DICTIONARY_ID = dc.DUONGDUNG_ID            where (1=1)             and               A.BACSI_ID  = 1              and A.LOAITOATHUOC in  (                        @param0                   ,                           @param1                   ,                           @param2                   ,                           @param3                   )]
2019-08-14 13:38:31,812 [1] DEBUG - Statement Id: [DAO00040_LayListToaMau] Parameters: [@param0=[LSTLOAITOATHUOC[0],BV], @param1=[LSTLOAITOATHUOC[1],MN], @param2=[LSTLOAITOATHUOC[2],MP], @param3=[LSTLOAITOATHUOC[3],TV]]
2019-08-14 13:38:31,813 [1] DEBUG - Statement Id: [DAO00040_LayListToaMau] Types: [@param0=[String, System.String], @param1=[String, System.String], @param2=[String, System.String], @param3=[String, System.String]]
2019-08-14 13:38:31,943 [1] DEBUG - Statement Id: [DAO00040_LayListToaMau] PreparedStatement : [select A.*, dc.TENDUOCDAYDU, dc.BHYT DUOC_BHYT, ld.LOAIVATTU_ID, ld.MALOAIDUOC, dd.DICTIONARY_NAME DUONGDUNG, dc.TAMNGUNG            from TT_TOATHUOCMAU A            left join TM_DUOC dc on A.DUOC_ID = dc.DUOC_ID            left join TM_LOAIDUOC ld on dc.LOAIDUOC_ID = ld.LOAIDUOC_ID            left join (select * from LST_DICTIONARY where DICTIONARY_TYPE_CODE like 'DuongDung') dd on dd.DICTIONARY_ID = dc.DUONGDUNG_ID            where (1=1)             and               A.BACSI_ID  = 1              and A.LOAITOATHUOC in  (                        @param0                   ,                           @param1                   ,                           @param2                   ,                           @param3                   )]
2019-08-14 13:38:31,943 [1] DEBUG - Statement Id: [DAO00040_LayListToaMau] Parameters: [@param0=[LSTLOAITOATHUOC[0],BV], @param1=[LSTLOAITOATHUOC[1],MN], @param2=[LSTLOAITOATHUOC[2],MP], @param3=[LSTLOAITOATHUOC[3],TV]]
2019-08-14 13:38:31,943 [1] DEBUG - Statement Id: [DAO00040_LayListToaMau] Types: [@param0=[String, System.String], @param1=[String, System.String], @param2=[String, System.String], @param3=[String, System.String]]
2019-08-14 13:38:32,009 [1] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoVaBookingCOM23UpdateRedis_TheoPhamvi] PreparedStatement : [select distinct tk.DUOC_KEY, tk.SOLUONG        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        inner join        (        select  LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')) DUOC_KEY, (SUM(dtk.SOLUONG) - isnull(sum(A.SOLUONG),0) - isnull(sum(B.SOLUONG),0)) SOLUONG, pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        from (select sum(soluong) soluong,duoc_id,nguonduoc_id,khoduoc_id,benhvien_id from TT_DUOC_TONKHO  group by duoc_id,nguonduoc_id,khoduoc_id,benhvien_id) dtk        inner join TM_DUOC_PHAMVISD_MAPPING pvsd on dtk.KHODUOC_ID = pvsd.KHODUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NOITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) B on B.DUOC_ID = dtk.DUOC_ID and B.SOLUONG > 0 and B.PHAMVI_ID = pvsd.PHAMVI_ID and B.NGUONHANG_ID = dtk.NGUONDUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NGOAITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) A on A.DUOC_ID = dtk.DUOC_ID and A.SOLUONG > 0 and A.PHAMVI_ID = pvsd.PHAMVI_ID and A.NGUONHANG_ID = dtk.NGUONDUOC_ID        where dtk.SOLUONG > 0 and dtk.BENHVIEN_ID = 'HLU01'        group by LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')), pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        ) tk on tk.DUOC_ID = d.DUOC_ID        left join TM_DUOC_PHAMVISUDUNG kd on kd.PHAMVI_ID = tk.PHAMVI_ID and kd.BENHVIEN_ID = 'HLU01'        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = tk.NGUONDUOC_ID and nh.BENHVIEN_ID = 'HLU01'        where  d.BENHVIEN_ID = 'HLU01' and tk.PHAMVI_ID =  @param0]
2019-08-14 13:38:32,009 [1] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoVaBookingCOM23UpdateRedis_TheoPhamvi] Parameters: [@param0=[PHAMVI_ID,1033]]
2019-08-14 13:38:32,009 [1] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoVaBookingCOM23UpdateRedis_TheoPhamvi] Types: [@param0=[Int64, System.Int64]]
2019-08-14 13:38:32,325 [1] DEBUG - Statement Id: [DAO00013_GetTienSuBenh] PreparedStatement : [select TIENSUBENH, TIENSUDIUNG              from TT_BENHNHAN              where TT_BENHNHAN.BENHNHAN_ID  = '10954']
2019-08-14 13:38:32,420 [1] DEBUG - Statement Id: [DAO00095_GetTTDiUngThuoc] PreparedStatement : [select *              from TT_BENHNHAN_DIUNG_THUOC              where BENHNHAN_ID = '10954'              and BENHVIEN_ID = 'HLU01']
2019-08-14 13:38:32,467 [1] DEBUG - Statement Id: [DAO00014_GetTotalChiPhiDVByTiepNhan] PreparedStatement : [select sum(THANHTIEN_DOANHTHU) as THANHTIEN_DOANHTHU from TT_VIENPHI        where ACTIVE = '1'        and TIEPNHAN_ID = '26528'        and REF_TABLE = 'TT_DVYEUCAU'        and exists (select DVYEUCAU_ID from TT_DVYEUCAU where HUYYEUCAU = '0' and TIEPNHAN_ID = '26528' and TT_VIENPHI.REF_ID = DVYEUCAU_ID)]
2019-08-14 13:38:32,747 [1] DEBUG - Statement Id: [DAO00014_GetKhamBenhInfo] PreparedStatement : [select * from TT_NGOAITRU_KHAMBENH where KHAMBENH_ID =        (select KHAMBENH_NGOAITRU_ID from TT_DVYEUCAU where DVYEUCAU_ID = '198821')]
2019-08-14 13:38:32,783 [1] DEBUG - Statement Id: [DAO00014_GetSoCaKhamTrongNgay] PreparedStatement : [select Count(KB.KHAMBENH_ID) as SOCAKHAMTRONGNGAY        from TT_NGOAITRU_KHAMBENH KB        inner join TT_TIEPNHAN TN on TN.TIEPNHAN_ID = KB.TIEPNHAN_ID        where KB.NGAYKHAM = convert(date, GETDATE())        and KB.BACSIKHAM_ID = '1'        and KB.BENHVIEN_ID = 'HLU01'        and TN.SOBHYT IS NOT NULL and TN.SOBHYT != '']
2019-08-14 13:38:32,937 [1] DEBUG - Statement Id: [DAO00068_GetLastedSinhHieuInfo] PreparedStatement : [select top (1) *, CHISOBMI as BMI              from TT_NGOAITRU_KHAMBENH_SINHHIEU              where BENHNHAN_ID = '10954'              order by KHAMBENH_SINHHIEU_ID desc]
2019-08-14 13:38:33,144 [1] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoVaBookingCOM23UpdateRedis_TheoPhamvi] PreparedStatement : [select distinct tk.DUOC_KEY, tk.SOLUONG        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        inner join        (        select  LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')) DUOC_KEY, (SUM(dtk.SOLUONG) - isnull(sum(A.SOLUONG),0) - isnull(sum(B.SOLUONG),0)) SOLUONG, pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        from (select sum(soluong) soluong,duoc_id,nguonduoc_id,khoduoc_id,benhvien_id from TT_DUOC_TONKHO  group by duoc_id,nguonduoc_id,khoduoc_id,benhvien_id) dtk        inner join TM_DUOC_PHAMVISD_MAPPING pvsd on dtk.KHODUOC_ID = pvsd.KHODUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NOITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) B on B.DUOC_ID = dtk.DUOC_ID and B.SOLUONG > 0 and B.PHAMVI_ID = pvsd.PHAMVI_ID and B.NGUONHANG_ID = dtk.NGUONDUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NGOAITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) A on A.DUOC_ID = dtk.DUOC_ID and A.SOLUONG > 0 and A.PHAMVI_ID = pvsd.PHAMVI_ID and A.NGUONHANG_ID = dtk.NGUONDUOC_ID        where dtk.SOLUONG > 0 and dtk.BENHVIEN_ID = 'HLU01'        group by LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')), pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        ) tk on tk.DUOC_ID = d.DUOC_ID        left join TM_DUOC_PHAMVISUDUNG kd on kd.PHAMVI_ID = tk.PHAMVI_ID and kd.BENHVIEN_ID = 'HLU01'        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = tk.NGUONDUOC_ID and nh.BENHVIEN_ID = 'HLU01'        where  d.BENHVIEN_ID = 'HLU01' and tk.PHAMVI_ID =  @param0]
2019-08-14 13:38:33,144 [1] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoVaBookingCOM23UpdateRedis_TheoPhamvi] Parameters: [@param0=[PHAMVI_ID,1033]]
2019-08-14 13:38:33,144 [1] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoVaBookingCOM23UpdateRedis_TheoPhamvi] Types: [@param0=[Int64, System.Int64]]
--------------------------------------------------------------------------------
2019-08-14 13:46:01,925 [1] DEBUG - Statement Id: [DAO00001_DBList] PreparedStatement : [select *              from TM_SYS_SERVER              where HOSPITAL_ID = '_SYSTEM_' and TYPE = 'D']
2019-08-14 13:46:02,279 [1] DEBUG - Statement Id: [DAO00001_DaoList] PreparedStatement : [select              TM_SYS_SERVICEMAP.ID,              TM_SYS_SERVICEMAP.HOSPITAL_ID,              TM_SYS_SERVICEMAP.DB_NAME,              TM_SYS_SERVICEMAP.TYPE,              TM_SYS_SERVICEMAP.NAME,              TM_SYS_SERVICEMAP.CLASS,              (TM_SYS_DIC.VALUE + '.' + TM_SYS_SERVICEMAP.CLASS) as CLASSFULL,              TM_SYS_SERVICEMAP.ASSEMBLY              from TM_SYS_SERVICEMAP              inner join TM_SYS_DIC              on TM_SYS_SERVICEMAP.NAMESPACE = TM_SYS_DIC.ID              where HOSPITAL_ID = '_SYSTEM_' AND TYPE = 'D' AND ACTIVE = '1'              order by DB_NAME]
2019-08-14 13:46:02,319 [1] DEBUG - Statement Id: [DAO00001_ServiceList] PreparedStatement : [select              TM_SYS_SERVICEMAP.ID,              TM_SYS_SERVICEMAP.HOSPITAL_ID,              TM_SYS_SERVICEMAP.DB_NAME,              TM_SYS_SERVICEMAP.TYPE,              TM_SYS_SERVICEMAP.NAME,              TM_SYS_SERVICEMAP.CLASS,              (TM_SYS_DIC.VALUE + '.' + TM_SYS_SERVICEMAP.CLASS) as CLASSFULL,              TM_SYS_SERVICEMAP.ASSEMBLY,              TM_SYS_SERVER.URL              from TM_SYS_SERVICEMAP              inner join TM_SYS_DIC on TM_SYS_SERVICEMAP.NAMESPACE = TM_SYS_DIC.ID              inner join TM_SYS_SERVER on (TM_SYS_SERVICEMAP.DB_NAME = TM_SYS_SERVER.NAME) and (TM_SYS_SERVER.HOSPITAL_ID = '_SYSTEM_')              where TM_SYS_SERVICEMAP.HOSPITAL_ID = '_SYSTEM_' AND TM_SYS_SERVICEMAP.TYPE = 'S'  AND ACTIVE = '1'              order by URL]
2019-08-14 13:46:02,854 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = '_SYSTEM_'               AND                   TM_SYS_SCREEN.PAGE = 'LOGIN'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2019-08-14 13:46:03,139 [1] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = '_SYSTEM_'               AND                   TM_SYS_CACHE.ACTIVE = '1']
2019-08-14 13:46:36,792 [1] DEBUG - Statement Id: [DAO00001_DBList] PreparedStatement : [select *              from TM_SYS_SERVER              where HOSPITAL_ID = 'HLU01' and TYPE = 'D']
2019-08-14 13:46:36,826 [1] DEBUG - Statement Id: [DAO00001_DaoList] PreparedStatement : [select              TM_SYS_SERVICEMAP.ID,              TM_SYS_SERVICEMAP.HOSPITAL_ID,              TM_SYS_SERVICEMAP.DB_NAME,              TM_SYS_SERVICEMAP.TYPE,              TM_SYS_SERVICEMAP.NAME,              TM_SYS_SERVICEMAP.CLASS,              (TM_SYS_DIC.VALUE + '.' + TM_SYS_SERVICEMAP.CLASS) as CLASSFULL,              TM_SYS_SERVICEMAP.ASSEMBLY              from TM_SYS_SERVICEMAP              inner join TM_SYS_DIC              on TM_SYS_SERVICEMAP.NAMESPACE = TM_SYS_DIC.ID              where HOSPITAL_ID = 'HLU01' AND TYPE = 'D' AND ACTIVE = '1'              order by DB_NAME]
2019-08-14 13:46:38,570 [1] DEBUG - Statement Id: [DAO00001_ServiceList] PreparedStatement : [select              TM_SYS_SERVICEMAP.ID,              TM_SYS_SERVICEMAP.HOSPITAL_ID,              TM_SYS_SERVICEMAP.DB_NAME,              TM_SYS_SERVICEMAP.TYPE,              TM_SYS_SERVICEMAP.NAME,              TM_SYS_SERVICEMAP.CLASS,              (TM_SYS_DIC.VALUE + '.' + TM_SYS_SERVICEMAP.CLASS) as CLASSFULL,              TM_SYS_SERVICEMAP.ASSEMBLY,              TM_SYS_SERVER.URL              from TM_SYS_SERVICEMAP              inner join TM_SYS_DIC on TM_SYS_SERVICEMAP.NAMESPACE = TM_SYS_DIC.ID              inner join TM_SYS_SERVER on (TM_SYS_SERVICEMAP.DB_NAME = TM_SYS_SERVER.NAME) and (TM_SYS_SERVER.HOSPITAL_ID = 'HLU01')              where TM_SYS_SERVICEMAP.HOSPITAL_ID = 'HLU01' AND TM_SYS_SERVICEMAP.TYPE = 'S'  AND ACTIVE = '1'              order by URL]
2019-08-14 13:46:38,655 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1']
2019-08-14 13:46:39,527 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM005']
2019-08-14 13:46:39,692 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM015']
2019-08-14 13:46:39,792 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM067']
2019-08-14 13:46:39,879 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM008']
2019-08-14 13:46:39,963 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM068']
2019-08-14 13:46:40,049 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM006']
2019-08-14 13:46:40,129 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM030']
2019-08-14 13:46:40,230 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM025']
2019-08-14 13:46:40,310 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM024']
2019-08-14 13:46:40,853 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM033']
2019-08-14 13:46:40,893 [5] DEBUG - Statement Id: [DAO00027_GetListDuocKyGuiTonKho] PreparedStatement : [select  distinct TT_TONKHO.DUOC_KEY, LTRIM(TT_TONKHO.KHODUOC_ID) as KHODUOC_ID, TM_DUOC.DUOC_ID, TM_LOAIDUOC.MALOAIDUOC,TM_DUOC.SOVISA,TM_DUOC.TYLE_VAT,TM_DUOC.COTOA,        TM_DUOC.MADUOC, TM_DUOC.TENHANG, TM_DUOC.TENDUOCDAYDU, dvt.TENDONVITINH as DONVITINH,  TM_DUOC.DONVITINH_ID,TM_DUOC.BHYT,TM_DUOC.PHAMVI,        TM_DUOC.TENHOATCHAT, TM_DUOC.HAMLUONG, TM_DUOC.HANGSANXUAT, TM_DUOC.QUOCGIA, TM_DUOC.LOAIDUOC_ID, TM_DUOC.DUONGDUNG_ID,        TM_TENDUOC.TENDUOC, TM_TENDUOC.TENDUOC_EN, TM_TENDUOC.MAQUOCTE, TM_TENDUOC.MAQUOCTEBT,        TM_LOAIDUOC.LOAIVATTU_ID, TM_DUOC.BENHVIEN_ID,TT_TONKHO.SOLUONG, TT_TONKHO.NGUONDUOC_ID, NH.TENNGUONDUOC        , TAMNGUNG = CASE WHEN TM_DUOC.TAMNGUNG = '1' OR nh.TAMNGUNG = '1' OR KD.TAMNGUNG = '1' THEN '1' ELSE '0' END        , TM_DUOC.DANGTRINHBAY        from TM_DUOC        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = TM_DUOC.DONVITINH_ID        left join TM_TENDUOC on TM_DUOC.TENDUOC_ID = TM_TENDUOC.TENDUOC_ID and TM_DUOC.BENHVIEN_ID = 'HLU01' and TM_DUOC.TAMNGUNG = '0'        left join TM_LOAIDUOC on TM_LOAIDUOC.LOAIDUOC_ID = TM_DUOC.LOAIDUOC_ID and TM_LOAIDUOC.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG on (TM_LOAIDUOC.LOAIVATTU_ID = TM_DUOC_HANDUNG.LOAIDUOC and TM_DUOC_HANDUNG.BENHVIEN_ID = 'HLU01')        inner join        (select LTRIM(A.KHODUOC_ID) + '_' + LTRIM(A.DUOC_ID) + '_' + LTRIM(ISNULL(A.NGUONDUOC_ID,'')) as DUOC_KEY, A.KHODUOC_ID, A.DUOC_ID,A.NGUONDUOC_ID,        SUM(isnull(A.SOLUONG,0)) as SOLUONG        from        (select SUM(SOLUONG) as SOLUONG, KHODUOC_ID, DUOC_ID, NGUONDUOC_ID from TT_DUOC_KYGUI_TONKHO        where BENHVIEN_ID = 'HLU01' group by KHODUOC_ID, DUOC_ID, NGUONDUOC_ID) A        group by LTRIM(A.KHODUOC_ID) + '_' + LTRIM(A.DUOC_ID) + '_' + LTRIM(A.NGUONDUOC_ID), A.KHODUOC_ID, A.DUOC_ID, A.NGUONDUOC_ID)        TT_TONKHO on TT_TONKHO.DUOC_ID = TM_DUOC.DUOC_ID        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = TT_TONKHO.NGUONDUOC_ID and nh.BENHVIEN_ID = 'HLU01'        LEFT JOIN TM_KHODUOC KD ON KD.KHODUOC_ID = TT_TONKHO.KHODUOC_ID        where TM_DUOC.BENHVIEN_ID = 'HLU01' AND TT_TONKHO.SOLUONG >= 0]
2019-08-14 13:46:40,976 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM018']
2019-08-14 13:46:41,015 [5] DEBUG - Statement Id: [DAO00027_GetListDuocTonKho] PreparedStatement : [select distinct TT_TONKHO.DUOC_KEY, LTRIM(TT_TONKHO.KHODUOC_ID) as KHODUOC_ID, TM_DUOC.DUOC_ID, TM_LOAIDUOC.MALOAIDUOC,TM_DUOC.SOVISA,TM_DUOC.TYLE_VAT,TM_DUOC.COTOA,        TM_DUOC.MADUOC, TM_DUOC.TENHANG, TM_DUOC.TENDUOCDAYDU, dvt.TENDONVITINH as DONVITINH,  TM_DUOC.DONVITINH_ID,TM_DUOC.BHYT,                TM_DUOC.TENHOATCHAT,          TM_DUOC.HAMLUONG, TM_DUOC.HANGSANXUAT, TM_DUOC.QUOCGIA, TM_DUOC.LOAIDUOC_ID, TM_DUOC.DUONGDUNG_ID,        TM_TENDUOC.TENDUOC, TM_TENDUOC.TENDUOC_EN, TM_TENDUOC.MAQUOCTE, TM_TENDUOC.MAQUOCTEBT,        TM_LOAIDUOC.LOAIVATTU_ID, TM_DUOC.BENHVIEN_ID,        TT_TONKHO.SOLUONG, TM_DUOC.VTYT_PHANLOAI, TM_DUOC.PHAMVI, TT_TONKHO.NGUONDUOC_ID, NG.TENNGUONDUOC AS TENNGUONDUOC        , TAMNGUNG = CASE WHEN TM_DUOC.TAMNGUNG = '1' OR NG.TAMNGUNG = '1' OR KD.TAMNGUNG = '1' THEN '1' ELSE '0' END        , TM_DUOC.DANGTRINHBAY        from TM_DUOC        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = TM_DUOC.DONVITINH_ID        left join TM_TENDUOC on TM_DUOC.TENDUOC_ID = TM_TENDUOC.TENDUOC_ID and TM_DUOC.BENHVIEN_ID = 'HLU01' and TM_DUOC.TAMNGUNG = '0'        left join TM_LOAIDUOC on TM_LOAIDUOC.LOAIDUOC_ID = TM_DUOC.LOAIDUOC_ID and TM_LOAIDUOC.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG on (TM_LOAIDUOC.LOAIVATTU_ID = TM_DUOC_HANDUNG.LOAIDUOC and TM_DUOC_HANDUNG.BENHVIEN_ID = 'HLU01')        inner join        (select LTRIM(A.KHODUOC_ID) + '_' + LTRIM(A.DUOC_ID) + '_' + LTRIM(ISNULL(A.NGUONDUOC_ID,'')) as DUOC_KEY, A.KHODUOC_ID, A.DUOC_ID, A.NGUONDUOC_ID,        SUM(isnull(A.SOLUONG,0)) as SOLUONG        from        (select SUM(SOLUONG) as SOLUONG, KHODUOC_ID, DUOC_ID, NGUONDUOC_ID from TT_DUOC_TONKHO        where BENHVIEN_ID = 'HLU01' group by KHODUOC_ID, DUOC_ID, NGUONDUOC_ID) A        group by LTRIM(A.KHODUOC_ID) + '_' + LTRIM(A.DUOC_ID) + '_' + LTRIM(ISNULL(A.NGUONDUOC_ID,'')), A.KHODUOC_ID, A.DUOC_ID, NGUONDUOC_ID        ) TT_TONKHO on TT_TONKHO.DUOC_ID = TM_DUOC.DUOC_ID        LEFT JOIN TM_NGUONHANG NG ON NG.NGUONDUOC_ID = TT_TONKHO.NGUONDUOC_ID        LEFT JOIN TM_KHODUOC KD ON KD.KHODUOC_ID = TT_TONKHO.KHODUOC_ID        where TM_DUOC.BENHVIEN_ID = 'HLU01' and TT_TONKHO.SOLUONG >= 0]
2019-08-14 13:46:41,988 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM023']
2019-08-14 13:46:42,024 [5] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoVaBooking] PreparedStatement : [declare @TOAMUANGOAI int = 0;        select @TOAMUANGOAI = isnull(VALUE,0) from TM_SYS_APPSETTINGS where CODE = 'OPD_TOAMUANGOAI_DUNGDANHMUC_DUOC'                if @TOAMUANGOAI = 1        begin        select  distinct '0' + '_' + LTRIM(d.DUOC_ID) + '_' + '0' as DUOC_KEY, 0 as PHAMVI_ID, 0 as NGUONDUOC_ID, null as TENNGUONDUOC, null as TINHTIEN, d.DUOC_ID, ld.MALOAIDUOC,        d.SOVISA,d.TYLE_VAT,d.COTOA, d.MADUOC, d.TENHANG, d.TENDUOCDAYDU, d.DONVITINH as DONVITINH, d.BHYT,        d.TENHOATCHAT, d.HAMLUONG, d.HANGSANXUAT, d.QUOCGIA, d.LOAIDUOC_ID, d.DUONGDUNG_ID, d.TINHTIEN_PTTT,        ten.TENDUOC, ten.TENDUOC_EN, ten.MAQUOCTE, ten.MAQUOCTEBT,        '' as BHYT_TEXT        , ld.LOAIVATTU_ID        , d.BENHVIEN_ID,        999999999 as SOLUONG, d.VTYT_PHANLOAI, d.PHAMVI, d.SUASOLUONGTONGHOP, d.MADUOCBV, d.DANGTRINHBAY        , TAMNGUNG = CASE WHEN d.TAMNGUNG = '1' THEN '1' ELSE '0' END        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        union all        select  distinct tk.DUOC_KEY, LTRIM(tk.PHAMVI_ID) as PHAMVI_ID, tk.NGUONDUOC_ID, nh.TENNGUONDUOC, nh.TINHTIEN, d.DUOC_ID, ld.MALOAIDUOC,        d.SOVISA,d.TYLE_VAT,d.COTOA, d.MADUOC, d.TENHANG, d.TENDUOCDAYDU, dvt.TENDONVITINH as DONVITINH, d.BHYT,        d.TENHOATCHAT, d.HAMLUONG, d.HANGSANXUAT, d.QUOCGIA, d.LOAIDUOC_ID, d.DUONGDUNG_ID, d.TINHTIEN_PTTT,        ten.TENDUOC, ten.TENDUOC_EN, ten.MAQUOCTE, ten.MAQUOCTEBT,        CASE WHEN d.BHYT = '1' THEN 'BHYT' ELSE '' END as BHYT_TEXT        , ld.LOAIVATTU_ID        , d.BENHVIEN_ID,        tk.SOLUONG, d.VTYT_PHANLOAI, d.PHAMVI, d.SUASOLUONGTONGHOP, d.MADUOCBV, d.DANGTRINHBAY        , TAMNGUNG = CASE WHEN d.TAMNGUNG = '1' OR nh.TAMNGUNG = '1' OR kd.TAMNGUNG = '1' THEN '1' ELSE '0' END        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        inner join        (        select  LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')) DUOC_KEY, (SUM(dtk.SOLUONG) - isnull(sum(A.SOLUONG),0) - isnull(sum(B.SOLUONG),0)) SOLUONG, pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        from (select sum(soluong) soluong,duoc_id,nguonduoc_id,khoduoc_id,benhvien_id from TT_DUOC_TONKHO  group by duoc_id,nguonduoc_id,khoduoc_id,benhvien_id) dtk        inner join TM_DUOC_PHAMVISD_MAPPING pvsd on dtk.KHODUOC_ID = pvsd.KHODUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NOITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) B on B.DUOC_ID = dtk.DUOC_ID and B.SOLUONG > 0 and B.PHAMVI_ID = pvsd.PHAMVI_ID and B.NGUONHANG_ID = dtk.NGUONDUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NGOAITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) A on A.DUOC_ID = dtk.DUOC_ID and A.SOLUONG > 0 and A.PHAMVI_ID = pvsd.PHAMVI_ID and A.NGUONHANG_ID = dtk.NGUONDUOC_ID        where dtk.SOLUONG > 0 and dtk.BENHVIEN_ID = 'HLU01'        group by LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')), pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        ) tk on tk.DUOC_ID = d.DUOC_ID        left join TM_DUOC_PHAMVISUDUNG kd on kd.PHAMVI_ID = tk.PHAMVI_ID and kd.BENHVIEN_ID = 'HLU01'        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = tk.NGUONDUOC_ID and nh.BENHVIEN_ID = 'HLU01'        where d.BENHVIEN_ID = 'HLU01'  and tk.SOLUONG >= 0         end                else        begin        select  distinct tk.DUOC_KEY, LTRIM(tk.PHAMVI_ID) as PHAMVI_ID, tk.NGUONDUOC_ID, nh.TENNGUONDUOC, nh.TINHTIEN, d.DUOC_ID, ld.MALOAIDUOC,        d.SOVISA,d.TYLE_VAT,d.COTOA, d.MADUOC, d.TENHANG, d.TENDUOCDAYDU, d.DONVITINH as DONVITINH, d.BHYT,        d.TENHOATCHAT, d.HAMLUONG, d.HANGSANXUAT, d.QUOCGIA, d.LOAIDUOC_ID, d.DUONGDUNG_ID, d.TINHTIEN_PTTT,        ten.TENDUOC, ten.TENDUOC_EN, ten.MAQUOCTE, ten.MAQUOCTEBT,        CASE WHEN d.BHYT = '1' THEN 'BHYT' ELSE '' END as BHYT_TEXT        , ld.LOAIVATTU_ID        , d.BENHVIEN_ID,        tk.SOLUONG, d.VTYT_PHANLOAI, d.PHAMVI, d.SUASOLUONGTONGHOP, d.MADUOCBV, d.DANGTRINHBAY        , TAMNGUNG = CASE WHEN d.TAMNGUNG = '1' OR nh.TAMNGUNG = '1' OR kd.TAMNGUNG = '1' THEN '1' ELSE '0' END        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        inner join        (        select  LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')) DUOC_KEY, (SUM(dtk.SOLUONG) - isnull(sum(A.SOLUONG),0) - isnull(sum(B.SOLUONG),0)) SOLUONG, pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        from (select sum(soluong) soluong,duoc_id,nguonduoc_id,khoduoc_id,benhvien_id from TT_DUOC_TONKHO  group by duoc_id,nguonduoc_id,khoduoc_id,benhvien_id) dtk        inner join TM_DUOC_PHAMVISD_MAPPING pvsd on dtk.KHODUOC_ID = pvsd.KHODUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NOITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) B on B.DUOC_ID = dtk.DUOC_ID and B.SOLUONG > 0 and B.PHAMVI_ID = pvsd.PHAMVI_ID and B.NGUONHANG_ID = dtk.NGUONDUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NGOAITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) A on A.DUOC_ID = dtk.DUOC_ID and A.SOLUONG > 0 and A.PHAMVI_ID = pvsd.PHAMVI_ID and A.NGUONHANG_ID = dtk.NGUONDUOC_ID        where dtk.SOLUONG > 0 and dtk.BENHVIEN_ID = 'HLU01'        group by LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')), pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        ) tk on tk.DUOC_ID = d.DUOC_ID        left join TM_DUOC_PHAMVISUDUNG kd on kd.PHAMVI_ID = tk.PHAMVI_ID and kd.BENHVIEN_ID = 'HLU01'        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = tk.NGUONDUOC_ID and nh.BENHVIEN_ID = 'HLU01'        where d.BENHVIEN_ID = 'HLU01'  and tk.SOLUONG >= 0        end]
2019-08-14 13:46:44,540 [5] DEBUG - Statement Id: [DAO00320_GetList] PreparedStatement : [select M.*            from TM_MAU M            LEFT JOIN TM_MAU_DONVITINH DVT on M.DONVITINH_ID=DVT.DONVITINH_ID            where            M.TAMNGUNG = '0'            and M.BENHVIEN_ID = 'HLU01'            order by M.TENMAU]
2019-08-14 13:46:44,629 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM071']
2019-08-14 13:46:44,665 [5] DEBUG - Statement Id: [DAO00322_GetListMauTonKhoForCreateCached] PreparedStatement : [SELECT DISTINCT          TK.MAU_KEY, TK.KHOMAU_ID, M.MAU_ID, M.MAMAU, M.TENMAU, M.NHOM_ABO, M.NHOM_RH, M.LOAIMAU_ID,          TK.SOLONHAP_ID, SLN.SOLONHAP, SLN.SOKIEMSOAT, TK.NGUONHANG_ID, NG.TENNGUONMAU, M.BENHVIEN_ID, M.DONVITINH_ID,          SUM(tk.SOLUONG) AS SOLUONG,K.TENKHO,DVT.TENDONVITINH          FROM TT_MAU_TONKHO TK          JOIN TM_KHO K ON TK.KHOMAU_ID = K.KHO_ID          JOIN TT_MAU_CHUNGTU_SOLONHAP SLN ON TK.SOLONHAP_ID = SLN.SOLONHAP_ID          JOIN TM_MAU M on TK.MAU_ID = M.MAU_ID and M.TAMNGUNG = '0'          LEFT JOIN TM_MAU_DONVITINH DVT on M.DONVITINH_ID=DVT.DONVITINH_ID          LEFT JOIN TM_NGUONMAU NG ON NG.NGUONMAU_ID = TK.NGUONHANG_ID          WHERE TK.SOLUONG > 0          GROUP BY TK.MAU_KEY, TK.KHOMAU_ID, M.MAU_ID, M.MAMAU, M.TENMAU, M.NHOM_ABO, M.NHOM_RH, M.LOAIMAU_ID,          TK.SOLONHAP_ID, SLN.SOLONHAP, SLN.SOKIEMSOAT,TK.NGUONHANG_ID, NG.TENNGUONMAU, M.BENHVIEN_ID, M.DONVITINH_ID,K.TENKHO,DVT.TENDONVITINH]
2019-08-14 13:46:44,741 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM073']
2019-08-14 13:46:44,778 [5] DEBUG - Statement Id: [DAO00322_GetListMauTonKhoTruBooking] PreparedStatement : [select distinct          TK.MAU_KEY, TK.KHOMAU_ID, M.MAU_ID, M.MAMAU, M.TENMAU, M.NHOM_ABO, M.NHOM_RH, M.LOAIMAU_ID, M.DONVITINH_ID,          TK.SOLONHAP_ID, TK.SOLONHAP, TK.SOKIEMSOAT,M.PHAMVI, TK.NGUONHANG_ID, NG.TENNGUONMAU, M.BENHVIEN_ID,          TK.SOLUONG,TK.TENKHO,DVT.TENDONVITINH          from TM_MAU M          JOIN          (          select          A.MAU_KEY, A.KHOMAU_ID, A.MAU_ID ,a.NGUONHANG_ID, A.SOLONHAP_ID, A.SOLONHAP, A.SOKIEMSOAT, A.SOLUONG,A.TENKHO          from          (          select KHOMAU_ID, TK.MAU_ID, TK.NGUONHANG_ID, TK.MAU_KEY, SLN.SOLONHAP_ID, SLN.SOLONHAP, SLN.SOKIEMSOAT, ISNULL(TK.SOLUONG,0) - ISNULL(book.SOLUONG,0) as SOLUONG,K.TENKHO          from TT_MAU_TONKHO TK          JOIN TM_KHO K ON TK.KHOMAU_ID = K.KHO_ID          inner join TT_MAU_CHUNGTU_SOLONHAP SLN ON TK.SOLONHAP_ID = SLN.SOLONHAP_ID          left join dbo.TT_MAU_TONKHO_BOOK book ON book.MAU_KEY = TK.MAU_KEY AND book.TRANGTHAI = 'HIEULUC'          where ISNULL(TK.SOLUONG,0) - ISNULL(book.SOLUONG,0) > 0          ) A          )TK on TK.MAU_ID = M.MAU_ID and M.TAMNGUNG = '0'          LEFT JOIN TM_MAU_DONVITINH DVT on M.DONVITINH_ID=DVT.DONVITINH_ID          LEFT JOIN TM_NGUONMAU NG ON NG.NGUONMAU_ID = TK.NGUONHANG_ID]
2019-08-14 13:46:44,849 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM072']
2019-08-14 13:46:45,805 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'MAIN'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2019-08-14 13:46:46,985 [1] DEBUG - Statement Id: [DAO00002_FormList] PreparedStatement : [select              TM_SYS_FORM.HOSPITAL_ID,              TM_SYS_FORM.NAME,              TM_SYS_FORM.CLASS,              TM_SYS_FORM.ASSEMBLY,              TM_SYS_FORM.TITLE_VI as TITLE              from TM_SYS_FORM              where HOSPITAL_ID = 'HLU01']
2019-08-14 13:46:53,445 [1] DEBUG - Statement Id: [DAO00300_GetShortcutListByUserID] PreparedStatement : [SELECT S.SHORTCUT_CODE, S.SHORTCUT_VALUE              FROM TM_SHORTCUT AS S              WHERE S.BENHVIEN_ID = 'HLU01' AND S.USER_ID = '1' AND TAMNGUNG = '0']
2019-08-14 13:46:53,479 [1] DEBUG - Statement Id: [DAO00087_GetList] PreparedStatement : [select CODE, VALUE, BENHVIEN_ID              from TM_SYS_APPSETTINGS              where LOCKED = '0' and BENHVIEN_ID = 'HLU01'              order by SETTING_ID]
2019-08-14 13:46:53,595 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'MSG01'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2019-08-14 13:46:53,751 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'MSG02'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2019-08-14 13:46:53,907 [1] DEBUG - Statement Id: [DAO00008_GetUserSettings] PreparedStatement : [select A.*, B.TENKHO , C.TENPHONGBAN, B.MAKHO, C.MAPHONGBAN          from TM_SYS_USERS A          left join TM_KHODUOC B on B.KHODUOC_ID = A.INVENTORY_ID          left join TM_PHONGBAN C on (C.PHONGBAN_ID = A.WORKING_DEPT_ID and C.BENHVIEN_ID =  @param0 )          left join TM_SYS_USERKHO D on (D.ACCOUNT_ID = A.ACCOUNT_ID and D.HOSPITAL_ID =  @param0 )          where          A.HOSPITAL_ID =  @param0            and                 A.ACCOUNT_ID =  @param1]
2019-08-14 13:46:53,910 [1] DEBUG - Statement Id: [DAO00008_GetUserSettings] Parameters: [@param0=[HOSPITAL_ID,HLU01], @param1=[ACCOUNT_ID,113]]
2019-08-14 13:46:53,910 [1] DEBUG - Statement Id: [DAO00008_GetUserSettings] Types: [@param0=[String, System.String], @param1=[String, System.String]]
2019-08-14 13:46:53,964 [1] DEBUG - Statement Id: [DAO00008_GetUserInvSettings] PreparedStatement : [select A.*, B.TENKHO, B.MAKHO, B.LOAIKHO_ID, B.KHOQUANLY_ID          from TM_SYS_USERKHO A          left join TM_KHO B on B.MODULE_ID = A.MODULE_ID and B.KHO_ID = A.KHO_ID          where A.HOSPITAL_ID =  @param0  and A.ACCOUNT_ID =  @param1           order by B.TENKHO]
2019-08-14 13:46:53,965 [1] DEBUG - Statement Id: [DAO00008_GetUserInvSettings] Parameters: [@param0=[HOSPITAL_ID,HLU01], @param1=[ACCOUNT_ID,113]]
2019-08-14 13:46:53,965 [1] DEBUG - Statement Id: [DAO00008_GetUserInvSettings] Types: [@param0=[String, System.String], @param1=[String, System.String]]
2019-08-14 13:46:54,137 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'COM30'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2019-08-14 13:46:54,316 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'RIS04'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2019-08-14 13:47:03,455 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'MENU1'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2019-08-14 13:47:03,550 [1] DEBUG - Statement Id: [DAO00011_GetList] PreparedStatement : [select              TM_SYS_MENU.ID,              TM_SYS_MENU.PARENTID,              TM_SYS_MENU.SCREEN,              TM_SYS_MENU.SMALLIMAGE,              TM_SYS_MENU.LARGEIMAGE,              TM_SYS_MENU.DESCRIPTION,              TM_SYS_MENU.TYPE,              TM_SYS_MENU.TITLE_VI as TITLE              from TM_SYS_MENU              where TM_SYS_MENU.HOSPITAL_ID = 'HLU01' and TM_SYS_MENU.ACTIVE = '1'               AND                   (TM_SYS_MENU.TYPE & '8' = '8')                             order by TM_SYS_MENU.ORDERNUM]
2019-08-14 13:47:03,827 [1] DEBUG - Statement Id: [DAO00011_usermenu_list] PreparedStatement : [select              TM_SYS_HOMEMENU.MENUID as ID,              TM_SYS_MENU.TITLE_VI as TITLE,              TM_SYS_MENU.SCREEN,              TM_SYS_MENU.SMALLIMAGE,              TM_SYS_MENU.LARGEIMAGE,              TM_SYS_MENU.TYPE              from TM_SYS_HOMEMENU              left join TM_SYS_MENU on TM_SYS_MENU.ID = TM_SYS_HOMEMENU.MENUID and TM_SYS_MENU.HOSPITAL_ID = TM_SYS_HOMEMENU.HOSPITAL_ID              where TM_SYS_HOMEMENU.HOSPITAL_ID = 'HLU01' and TM_SYS_HOMEMENU.USERID = '113' and TM_SYS_MENU.ACTIVE = '1'               AND                   (TM_SYS_MENU.TYPE & '8' = '8')                             ORDER BY TM_SYS_HOMEMENU.ORDERNUM]
2019-08-14 13:47:34,877 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'OPD02'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2019-08-14 13:47:36,161 [1] DEBUG - Statement Id: [DAO00017_GetLoaiGiaByDoiTuongId] PreparedStatement : [select dtlg.DOUUTIEN, dtlg.DOITUONG_ID, lg.LOAIGIA_ID, lg.TENLOAIGIA, lg.MALOAIGIA              from TM_LOAIGIA lg              left join TM_DOITUONG_LOAIGIA dtlg              on lg.LOAIGIA_ID = dtlg.LOAIGIA_ID and dtlg.BENHVIEN_ID = 'HLU01'              where lg.TAMNGUNG = 0 and lg.BENHVIEN_ID = 'HLU01'                             order by dtlg.DOUUTIEN]
2019-08-14 13:47:36,447 [1] DEBUG - Statement Id: [DAO00092_GetList_ToathuocNgoaitru] PreparedStatement : [select A.*, B.PHAMVI_ID, C.KHODUOC_ID from TM_TOATHUOC_NGOAITRU A        left join TM_DUOC_PHAMVISUDUNG B on B.MAPHAMVI = A.MAPHAMVI        left join (select distinct PHAMVI_ID, KHODUOC_ID from TM_DUOC_PHAMVISD_MAPPING) C on C.PHAMVI_ID = B.PHAMVI_ID        where A.TAMNGUNG != '1' and A.BENHVIEN_ID = 'HLU01'        ORDER BY A.SAPXEP ASC]
2019-08-14 13:47:40,047 [1] DEBUG - Statement Id: [DAO00009_TT_TIEPNHAN_GetProcess] PreparedStatement : [select PROCESS_ID from TT_TIEPNHAN where SOTIEPNHAN = 'TN190531.0000238']
2019-08-14 13:47:40,247 [1] DEBUG - Statement Id: [DAOWF004_laytrangthaiDV] PreparedStatement : [select top 1 A.CURR_STATE_CODE as STATE_CODE, isNull(C.SHORT_NAME,C.NAME) as TRANGTHAI, C.NAME as TRANGTHAI_CHITIET, C.STATUS_CODE, D.ISACTIVE as ACTIVE, E.STATUS_CODE  as OLD_STATUSCODE        from TT_REQUEST_SERVICE_DETAIL A                left join (select * from TT_REQUEST_SERVICE where PARA = '{"DICHVU_ID":"5436","DVYEUCAU_ID":"193804"}') D on D.ID = A.REQUEST_SERVICE_ID        left join TM_STATE C on A.CURR_STATE_CODE = C.STATE_CODE and C.PROCESS_CODE = D.PROCESS_CODE        left join TM_STATE E on A.OLD_STATE_CODE = E.STATE_CODE and E.PROCESS_CODE = D.PROCESS_CODE        where        A.REQUEST_SERVICE_ID = (select top 1 ID from TT_REQUEST_SERVICE where PARA = '{"DICHVU_ID":"5436","DVYEUCAU_ID":"193804"}' order by ID desc)        order by A.ID desc]
2019-08-14 13:47:40,684 [1] DEBUG - Statement Id: [DAO00017_GetLoaiGiaByDoiTuongId] PreparedStatement : [select dtlg.DOUUTIEN, dtlg.DOITUONG_ID, lg.LOAIGIA_ID, lg.TENLOAIGIA, lg.MALOAIGIA              from TM_LOAIGIA lg              left join TM_DOITUONG_LOAIGIA dtlg              on lg.LOAIGIA_ID = dtlg.LOAIGIA_ID and dtlg.BENHVIEN_ID = 'HLU01'              where lg.TAMNGUNG = 0 and lg.BENHVIEN_ID = 'HLU01'                             order by dtlg.DOUUTIEN]
2019-08-14 13:47:40,822 [1] DEBUG - Statement Id: [DAO00087_GetServiceParams] PreparedStatement : [select CODE, VALUE              from TM_SYS_APPSETTINGS              where LOCKED = '0' and BENHVIEN_ID = 'HLU01']
2019-08-14 13:47:41,129 [1] DEBUG - Statement Id: [DAO00040_LayListToaMau] PreparedStatement : [select A.*, dc.TENDUOCDAYDU, dc.BHYT DUOC_BHYT, ld.LOAIVATTU_ID, ld.MALOAIDUOC, dd.DICTIONARY_NAME DUONGDUNG, dc.TAMNGUNG            from TT_TOATHUOCMAU A            left join TM_DUOC dc on A.DUOC_ID = dc.DUOC_ID            left join TM_LOAIDUOC ld on dc.LOAIDUOC_ID = ld.LOAIDUOC_ID            left join (select * from LST_DICTIONARY where DICTIONARY_TYPE_CODE like 'DuongDung') dd on dd.DICTIONARY_ID = dc.DUONGDUNG_ID            where (1=1)             and               A.BACSI_ID  = 1              and A.LOAITOATHUOC in  (                        @param0                   ,                           @param1                   ,                           @param2                   ,                           @param3                   )]
2019-08-14 13:47:41,130 [1] DEBUG - Statement Id: [DAO00040_LayListToaMau] Parameters: [@param0=[LSTLOAITOATHUOC[0],BV], @param1=[LSTLOAITOATHUOC[1],MN], @param2=[LSTLOAITOATHUOC[2],MP], @param3=[LSTLOAITOATHUOC[3],TV]]
2019-08-14 13:47:41,130 [1] DEBUG - Statement Id: [DAO00040_LayListToaMau] Types: [@param0=[String, System.String], @param1=[String, System.String], @param2=[String, System.String], @param3=[String, System.String]]
2019-08-14 13:47:41,251 [1] DEBUG - Statement Id: [DAO00040_LayListToaMau] PreparedStatement : [select A.*, dc.TENDUOCDAYDU, dc.BHYT DUOC_BHYT, ld.LOAIVATTU_ID, ld.MALOAIDUOC, dd.DICTIONARY_NAME DUONGDUNG, dc.TAMNGUNG            from TT_TOATHUOCMAU A            left join TM_DUOC dc on A.DUOC_ID = dc.DUOC_ID            left join TM_LOAIDUOC ld on dc.LOAIDUOC_ID = ld.LOAIDUOC_ID            left join (select * from LST_DICTIONARY where DICTIONARY_TYPE_CODE like 'DuongDung') dd on dd.DICTIONARY_ID = dc.DUONGDUNG_ID            where (1=1)             and               A.BACSI_ID  = 1              and A.LOAITOATHUOC in  (                        @param0                   ,                           @param1                   ,                           @param2                   ,                           @param3                   )]
2019-08-14 13:47:41,251 [1] DEBUG - Statement Id: [DAO00040_LayListToaMau] Parameters: [@param0=[LSTLOAITOATHUOC[0],BV], @param1=[LSTLOAITOATHUOC[1],MN], @param2=[LSTLOAITOATHUOC[2],MP], @param3=[LSTLOAITOATHUOC[3],TV]]
2019-08-14 13:47:41,251 [1] DEBUG - Statement Id: [DAO00040_LayListToaMau] Types: [@param0=[String, System.String], @param1=[String, System.String], @param2=[String, System.String], @param3=[String, System.String]]
2019-08-14 13:47:41,336 [1] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoVaBookingCOM23UpdateRedis_TheoPhamvi] PreparedStatement : [select distinct tk.DUOC_KEY, tk.SOLUONG        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        inner join        (        select  LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')) DUOC_KEY, (SUM(dtk.SOLUONG) - isnull(sum(A.SOLUONG),0) - isnull(sum(B.SOLUONG),0)) SOLUONG, pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        from (select sum(soluong) soluong,duoc_id,nguonduoc_id,khoduoc_id,benhvien_id from TT_DUOC_TONKHO  group by duoc_id,nguonduoc_id,khoduoc_id,benhvien_id) dtk        inner join TM_DUOC_PHAMVISD_MAPPING pvsd on dtk.KHODUOC_ID = pvsd.KHODUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NOITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) B on B.DUOC_ID = dtk.DUOC_ID and B.SOLUONG > 0 and B.PHAMVI_ID = pvsd.PHAMVI_ID and B.NGUONHANG_ID = dtk.NGUONDUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NGOAITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) A on A.DUOC_ID = dtk.DUOC_ID and A.SOLUONG > 0 and A.PHAMVI_ID = pvsd.PHAMVI_ID and A.NGUONHANG_ID = dtk.NGUONDUOC_ID        where dtk.SOLUONG > 0 and dtk.BENHVIEN_ID = 'HLU01'        group by LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')), pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        ) tk on tk.DUOC_ID = d.DUOC_ID        left join TM_DUOC_PHAMVISUDUNG kd on kd.PHAMVI_ID = tk.PHAMVI_ID and kd.BENHVIEN_ID = 'HLU01'        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = tk.NGUONDUOC_ID and nh.BENHVIEN_ID = 'HLU01'        where  d.BENHVIEN_ID = 'HLU01' and tk.PHAMVI_ID =  @param0]
2019-08-14 13:47:41,336 [1] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoVaBookingCOM23UpdateRedis_TheoPhamvi] Parameters: [@param0=[PHAMVI_ID,1033]]
2019-08-14 13:47:41,336 [1] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoVaBookingCOM23UpdateRedis_TheoPhamvi] Types: [@param0=[Int64, System.Int64]]
2019-08-14 13:47:41,617 [1] DEBUG - Statement Id: [DAO00013_GetTienSuBenh] PreparedStatement : [select TIENSUBENH, TIENSUDIUNG              from TT_BENHNHAN              where TT_BENHNHAN.BENHNHAN_ID  = '16655']
2019-08-14 13:47:41,735 [1] DEBUG - Statement Id: [DAO00095_GetTTDiUngThuoc] PreparedStatement : [select *              from TT_BENHNHAN_DIUNG_THUOC              where BENHNHAN_ID = '16655'              and BENHVIEN_ID = 'HLU01']
2019-08-14 13:47:41,798 [1] DEBUG - Statement Id: [DAO00014_GetTotalChiPhiDVByTiepNhan] PreparedStatement : [select sum(THANHTIEN_DOANHTHU) as THANHTIEN_DOANHTHU from TT_VIENPHI        where ACTIVE = '1'        and TIEPNHAN_ID = '25830'        and REF_TABLE = 'TT_DVYEUCAU'        and exists (select DVYEUCAU_ID from TT_DVYEUCAU where HUYYEUCAU = '0' and TIEPNHAN_ID = '25830' and TT_VIENPHI.REF_ID = DVYEUCAU_ID)]
2019-08-14 13:47:41,964 [1] DEBUG - Statement Id: [DAO00014_GetKhamBenhInfo] PreparedStatement : [select * from TT_NGOAITRU_KHAMBENH where KHAMBENH_ID =        (select KHAMBENH_NGOAITRU_ID from TT_DVYEUCAU where DVYEUCAU_ID = '193804')]
2019-08-14 13:47:41,998 [1] DEBUG - Statement Id: [DAO00014_GetSoCaKhamTrongNgay] PreparedStatement : [select Count(KB.KHAMBENH_ID) as SOCAKHAMTRONGNGAY        from TT_NGOAITRU_KHAMBENH KB        inner join TT_TIEPNHAN TN on TN.TIEPNHAN_ID = KB.TIEPNHAN_ID        where KB.NGAYKHAM = convert(date, GETDATE())        and KB.BACSIKHAM_ID = '1'        and KB.BENHVIEN_ID = 'HLU01'        and TN.SOBHYT IS NOT NULL and TN.SOBHYT != '']
2019-08-14 13:47:42,172 [1] DEBUG - Statement Id: [DAO00068_GetLastedSinhHieuInfo] PreparedStatement : [select top (1) *, CHISOBMI as BMI              from TT_NGOAITRU_KHAMBENH_SINHHIEU              where BENHNHAN_ID = '16655'              order by KHAMBENH_SINHHIEU_ID desc]
2019-08-14 13:47:42,371 [1] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoVaBookingCOM23UpdateRedis_TheoPhamvi] PreparedStatement : [select distinct tk.DUOC_KEY, tk.SOLUONG        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        inner join        (        select  LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')) DUOC_KEY, (SUM(dtk.SOLUONG) - isnull(sum(A.SOLUONG),0) - isnull(sum(B.SOLUONG),0)) SOLUONG, pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        from (select sum(soluong) soluong,duoc_id,nguonduoc_id,khoduoc_id,benhvien_id from TT_DUOC_TONKHO  group by duoc_id,nguonduoc_id,khoduoc_id,benhvien_id) dtk        inner join TM_DUOC_PHAMVISD_MAPPING pvsd on dtk.KHODUOC_ID = pvsd.KHODUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NOITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) B on B.DUOC_ID = dtk.DUOC_ID and B.SOLUONG > 0 and B.PHAMVI_ID = pvsd.PHAMVI_ID and B.NGUONHANG_ID = dtk.NGUONDUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NGOAITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) A on A.DUOC_ID = dtk.DUOC_ID and A.SOLUONG > 0 and A.PHAMVI_ID = pvsd.PHAMVI_ID and A.NGUONHANG_ID = dtk.NGUONDUOC_ID        where dtk.SOLUONG > 0 and dtk.BENHVIEN_ID = 'HLU01'        group by LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')), pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        ) tk on tk.DUOC_ID = d.DUOC_ID        left join TM_DUOC_PHAMVISUDUNG kd on kd.PHAMVI_ID = tk.PHAMVI_ID and kd.BENHVIEN_ID = 'HLU01'        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = tk.NGUONDUOC_ID and nh.BENHVIEN_ID = 'HLU01'        where  d.BENHVIEN_ID = 'HLU01' and tk.PHAMVI_ID =  @param0]
2019-08-14 13:47:42,371 [1] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoVaBookingCOM23UpdateRedis_TheoPhamvi] Parameters: [@param0=[PHAMVI_ID,1033]]
2019-08-14 13:47:42,371 [1] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoVaBookingCOM23UpdateRedis_TheoPhamvi] Types: [@param0=[Int64, System.Int64]]
--------------------------------------------------------------------------------
2019-08-14 14:05:36,518 [1] DEBUG - Statement Id: [DAO00001_DBList] PreparedStatement : [select *              from TM_SYS_SERVER              where HOSPITAL_ID = '_SYSTEM_' and TYPE = 'D']
2019-08-14 14:05:36,892 [1] DEBUG - Statement Id: [DAO00001_DaoList] PreparedStatement : [select              TM_SYS_SERVICEMAP.ID,              TM_SYS_SERVICEMAP.HOSPITAL_ID,              TM_SYS_SERVICEMAP.DB_NAME,              TM_SYS_SERVICEMAP.TYPE,              TM_SYS_SERVICEMAP.NAME,              TM_SYS_SERVICEMAP.CLASS,              (TM_SYS_DIC.VALUE + '.' + TM_SYS_SERVICEMAP.CLASS) as CLASSFULL,              TM_SYS_SERVICEMAP.ASSEMBLY              from TM_SYS_SERVICEMAP              inner join TM_SYS_DIC              on TM_SYS_SERVICEMAP.NAMESPACE = TM_SYS_DIC.ID              where HOSPITAL_ID = '_SYSTEM_' AND TYPE = 'D' AND ACTIVE = '1'              order by DB_NAME]
2019-08-14 14:05:36,931 [1] DEBUG - Statement Id: [DAO00001_ServiceList] PreparedStatement : [select              TM_SYS_SERVICEMAP.ID,              TM_SYS_SERVICEMAP.HOSPITAL_ID,              TM_SYS_SERVICEMAP.DB_NAME,              TM_SYS_SERVICEMAP.TYPE,              TM_SYS_SERVICEMAP.NAME,              TM_SYS_SERVICEMAP.CLASS,              (TM_SYS_DIC.VALUE + '.' + TM_SYS_SERVICEMAP.CLASS) as CLASSFULL,              TM_SYS_SERVICEMAP.ASSEMBLY,              TM_SYS_SERVER.URL              from TM_SYS_SERVICEMAP              inner join TM_SYS_DIC on TM_SYS_SERVICEMAP.NAMESPACE = TM_SYS_DIC.ID              inner join TM_SYS_SERVER on (TM_SYS_SERVICEMAP.DB_NAME = TM_SYS_SERVER.NAME) and (TM_SYS_SERVER.HOSPITAL_ID = '_SYSTEM_')              where TM_SYS_SERVICEMAP.HOSPITAL_ID = '_SYSTEM_' AND TM_SYS_SERVICEMAP.TYPE = 'S'  AND ACTIVE = '1'              order by URL]
2019-08-14 14:05:37,602 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = '_SYSTEM_'               AND                   TM_SYS_SCREEN.PAGE = 'LOGIN'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2019-08-14 14:05:37,908 [1] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = '_SYSTEM_'               AND                   TM_SYS_CACHE.ACTIVE = '1']
2019-08-14 14:05:42,416 [1] DEBUG - Statement Id: [DAO00001_DBList] PreparedStatement : [select *              from TM_SYS_SERVER              where HOSPITAL_ID = 'HLU01' and TYPE = 'D']
2019-08-14 14:05:42,536 [1] DEBUG - Statement Id: [DAO00001_DaoList] PreparedStatement : [select              TM_SYS_SERVICEMAP.ID,              TM_SYS_SERVICEMAP.HOSPITAL_ID,              TM_SYS_SERVICEMAP.DB_NAME,              TM_SYS_SERVICEMAP.TYPE,              TM_SYS_SERVICEMAP.NAME,              TM_SYS_SERVICEMAP.CLASS,              (TM_SYS_DIC.VALUE + '.' + TM_SYS_SERVICEMAP.CLASS) as CLASSFULL,              TM_SYS_SERVICEMAP.ASSEMBLY              from TM_SYS_SERVICEMAP              inner join TM_SYS_DIC              on TM_SYS_SERVICEMAP.NAMESPACE = TM_SYS_DIC.ID              where HOSPITAL_ID = 'HLU01' AND TYPE = 'D' AND ACTIVE = '1'              order by DB_NAME]
2019-08-14 14:05:44,389 [1] DEBUG - Statement Id: [DAO00001_ServiceList] PreparedStatement : [select              TM_SYS_SERVICEMAP.ID,              TM_SYS_SERVICEMAP.HOSPITAL_ID,              TM_SYS_SERVICEMAP.DB_NAME,              TM_SYS_SERVICEMAP.TYPE,              TM_SYS_SERVICEMAP.NAME,              TM_SYS_SERVICEMAP.CLASS,              (TM_SYS_DIC.VALUE + '.' + TM_SYS_SERVICEMAP.CLASS) as CLASSFULL,              TM_SYS_SERVICEMAP.ASSEMBLY,              TM_SYS_SERVER.URL              from TM_SYS_SERVICEMAP              inner join TM_SYS_DIC on TM_SYS_SERVICEMAP.NAMESPACE = TM_SYS_DIC.ID              inner join TM_SYS_SERVER on (TM_SYS_SERVICEMAP.DB_NAME = TM_SYS_SERVER.NAME) and (TM_SYS_SERVER.HOSPITAL_ID = 'HLU01')              where TM_SYS_SERVICEMAP.HOSPITAL_ID = 'HLU01' AND TM_SYS_SERVICEMAP.TYPE = 'S'  AND ACTIVE = '1'              order by URL]
2019-08-14 14:05:44,481 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1']
2019-08-14 14:05:45,348 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM005']
2019-08-14 14:05:45,717 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM015']
2019-08-14 14:05:45,825 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM067']
2019-08-14 14:05:45,947 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM008']
2019-08-14 14:05:46,026 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM068']
2019-08-14 14:05:46,145 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM006']
2019-08-14 14:05:46,237 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM030']
2019-08-14 14:05:46,323 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM025']
2019-08-14 14:05:46,414 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM024']
2019-08-14 14:05:46,952 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM033']
2019-08-14 14:05:46,990 [5] DEBUG - Statement Id: [DAO00027_GetListDuocKyGuiTonKho] PreparedStatement : [select  distinct TT_TONKHO.DUOC_KEY, LTRIM(TT_TONKHO.KHODUOC_ID) as KHODUOC_ID, TM_DUOC.DUOC_ID, TM_LOAIDUOC.MALOAIDUOC,TM_DUOC.SOVISA,TM_DUOC.TYLE_VAT,TM_DUOC.COTOA,        TM_DUOC.MADUOC, TM_DUOC.TENHANG, TM_DUOC.TENDUOCDAYDU, dvt.TENDONVITINH as DONVITINH,  TM_DUOC.DONVITINH_ID,TM_DUOC.BHYT,TM_DUOC.PHAMVI,        TM_DUOC.TENHOATCHAT, TM_DUOC.HAMLUONG, TM_DUOC.HANGSANXUAT, TM_DUOC.QUOCGIA, TM_DUOC.LOAIDUOC_ID, TM_DUOC.DUONGDUNG_ID,        TM_TENDUOC.TENDUOC, TM_TENDUOC.TENDUOC_EN, TM_TENDUOC.MAQUOCTE, TM_TENDUOC.MAQUOCTEBT,        TM_LOAIDUOC.LOAIVATTU_ID, TM_DUOC.BENHVIEN_ID,TT_TONKHO.SOLUONG, TT_TONKHO.NGUONDUOC_ID, NH.TENNGUONDUOC        , TAMNGUNG = CASE WHEN TM_DUOC.TAMNGUNG = '1' OR nh.TAMNGUNG = '1' OR KD.TAMNGUNG = '1' THEN '1' ELSE '0' END        , TM_DUOC.DANGTRINHBAY        from TM_DUOC        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = TM_DUOC.DONVITINH_ID        left join TM_TENDUOC on TM_DUOC.TENDUOC_ID = TM_TENDUOC.TENDUOC_ID and TM_DUOC.BENHVIEN_ID = 'HLU01' and TM_DUOC.TAMNGUNG = '0'        left join TM_LOAIDUOC on TM_LOAIDUOC.LOAIDUOC_ID = TM_DUOC.LOAIDUOC_ID and TM_LOAIDUOC.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG on (TM_LOAIDUOC.LOAIVATTU_ID = TM_DUOC_HANDUNG.LOAIDUOC and TM_DUOC_HANDUNG.BENHVIEN_ID = 'HLU01')        inner join        (select LTRIM(A.KHODUOC_ID) + '_' + LTRIM(A.DUOC_ID) + '_' + LTRIM(ISNULL(A.NGUONDUOC_ID,'')) as DUOC_KEY, A.KHODUOC_ID, A.DUOC_ID,A.NGUONDUOC_ID,        SUM(isnull(A.SOLUONG,0)) as SOLUONG        from        (select SUM(SOLUONG) as SOLUONG, KHODUOC_ID, DUOC_ID, NGUONDUOC_ID from TT_DUOC_KYGUI_TONKHO        where BENHVIEN_ID = 'HLU01' group by KHODUOC_ID, DUOC_ID, NGUONDUOC_ID) A        group by LTRIM(A.KHODUOC_ID) + '_' + LTRIM(A.DUOC_ID) + '_' + LTRIM(A.NGUONDUOC_ID), A.KHODUOC_ID, A.DUOC_ID, A.NGUONDUOC_ID)        TT_TONKHO on TT_TONKHO.DUOC_ID = TM_DUOC.DUOC_ID        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = TT_TONKHO.NGUONDUOC_ID and nh.BENHVIEN_ID = 'HLU01'        LEFT JOIN TM_KHODUOC KD ON KD.KHODUOC_ID = TT_TONKHO.KHODUOC_ID        where TM_DUOC.BENHVIEN_ID = 'HLU01' AND TT_TONKHO.SOLUONG >= 0]
2019-08-14 14:05:47,069 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM018']
2019-08-14 14:05:47,103 [5] DEBUG - Statement Id: [DAO00027_GetListDuocTonKho] PreparedStatement : [select distinct TT_TONKHO.DUOC_KEY, LTRIM(TT_TONKHO.KHODUOC_ID) as KHODUOC_ID, TM_DUOC.DUOC_ID, TM_LOAIDUOC.MALOAIDUOC,TM_DUOC.SOVISA,TM_DUOC.TYLE_VAT,TM_DUOC.COTOA,        TM_DUOC.MADUOC, TM_DUOC.TENHANG, TM_DUOC.TENDUOCDAYDU, dvt.TENDONVITINH as DONVITINH,  TM_DUOC.DONVITINH_ID,TM_DUOC.BHYT,                TM_DUOC.TENHOATCHAT,          TM_DUOC.HAMLUONG, TM_DUOC.HANGSANXUAT, TM_DUOC.QUOCGIA, TM_DUOC.LOAIDUOC_ID, TM_DUOC.DUONGDUNG_ID,        TM_TENDUOC.TENDUOC, TM_TENDUOC.TENDUOC_EN, TM_TENDUOC.MAQUOCTE, TM_TENDUOC.MAQUOCTEBT,        TM_LOAIDUOC.LOAIVATTU_ID, TM_DUOC.BENHVIEN_ID,        TT_TONKHO.SOLUONG, TM_DUOC.VTYT_PHANLOAI, TM_DUOC.PHAMVI, TT_TONKHO.NGUONDUOC_ID, NG.TENNGUONDUOC AS TENNGUONDUOC        , TAMNGUNG = CASE WHEN TM_DUOC.TAMNGUNG = '1' OR NG.TAMNGUNG = '1' OR KD.TAMNGUNG = '1' THEN '1' ELSE '0' END        , TM_DUOC.DANGTRINHBAY        from TM_DUOC        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = TM_DUOC.DONVITINH_ID        left join TM_TENDUOC on TM_DUOC.TENDUOC_ID = TM_TENDUOC.TENDUOC_ID and TM_DUOC.BENHVIEN_ID = 'HLU01' and TM_DUOC.TAMNGUNG = '0'        left join TM_LOAIDUOC on TM_LOAIDUOC.LOAIDUOC_ID = TM_DUOC.LOAIDUOC_ID and TM_LOAIDUOC.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG on (TM_LOAIDUOC.LOAIVATTU_ID = TM_DUOC_HANDUNG.LOAIDUOC and TM_DUOC_HANDUNG.BENHVIEN_ID = 'HLU01')        inner join        (select LTRIM(A.KHODUOC_ID) + '_' + LTRIM(A.DUOC_ID) + '_' + LTRIM(ISNULL(A.NGUONDUOC_ID,'')) as DUOC_KEY, A.KHODUOC_ID, A.DUOC_ID, A.NGUONDUOC_ID,        SUM(isnull(A.SOLUONG,0)) as SOLUONG        from        (select SUM(SOLUONG) as SOLUONG, KHODUOC_ID, DUOC_ID, NGUONDUOC_ID from TT_DUOC_TONKHO        where BENHVIEN_ID = 'HLU01' group by KHODUOC_ID, DUOC_ID, NGUONDUOC_ID) A        group by LTRIM(A.KHODUOC_ID) + '_' + LTRIM(A.DUOC_ID) + '_' + LTRIM(ISNULL(A.NGUONDUOC_ID,'')), A.KHODUOC_ID, A.DUOC_ID, NGUONDUOC_ID        ) TT_TONKHO on TT_TONKHO.DUOC_ID = TM_DUOC.DUOC_ID        LEFT JOIN TM_NGUONHANG NG ON NG.NGUONDUOC_ID = TT_TONKHO.NGUONDUOC_ID        LEFT JOIN TM_KHODUOC KD ON KD.KHODUOC_ID = TT_TONKHO.KHODUOC_ID        where TM_DUOC.BENHVIEN_ID = 'HLU01' and TT_TONKHO.SOLUONG >= 0]
2019-08-14 14:05:49,089 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM023']
2019-08-14 14:05:49,205 [5] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoVaBooking] PreparedStatement : [declare @TOAMUANGOAI int = 0;        select @TOAMUANGOAI = isnull(VALUE,0) from TM_SYS_APPSETTINGS where CODE = 'OPD_TOAMUANGOAI_DUNGDANHMUC_DUOC'                if @TOAMUANGOAI = 1        begin        select  distinct '0' + '_' + LTRIM(d.DUOC_ID) + '_' + '0' as DUOC_KEY, 0 as PHAMVI_ID, 0 as NGUONDUOC_ID, null as TENNGUONDUOC, null as TINHTIEN, d.DUOC_ID, ld.MALOAIDUOC,        d.SOVISA,d.TYLE_VAT,d.COTOA, d.MADUOC, d.TENHANG, d.TENDUOCDAYDU, d.DONVITINH as DONVITINH, d.BHYT,        d.TENHOATCHAT, d.HAMLUONG, d.HANGSANXUAT, d.QUOCGIA, d.LOAIDUOC_ID, d.DUONGDUNG_ID, d.TINHTIEN_PTTT,        ten.TENDUOC, ten.TENDUOC_EN, ten.MAQUOCTE, ten.MAQUOCTEBT,        '' as BHYT_TEXT        , ld.LOAIVATTU_ID        , d.BENHVIEN_ID,        999999999 as SOLUONG, d.VTYT_PHANLOAI, d.PHAMVI, d.SUASOLUONGTONGHOP, d.MADUOCBV, d.DANGTRINHBAY        , TAMNGUNG = CASE WHEN d.TAMNGUNG = '1' THEN '1' ELSE '0' END        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        union all        select  distinct tk.DUOC_KEY, LTRIM(tk.PHAMVI_ID) as PHAMVI_ID, tk.NGUONDUOC_ID, nh.TENNGUONDUOC, nh.TINHTIEN, d.DUOC_ID, ld.MALOAIDUOC,        d.SOVISA,d.TYLE_VAT,d.COTOA, d.MADUOC, d.TENHANG, d.TENDUOCDAYDU, dvt.TENDONVITINH as DONVITINH, d.BHYT,        d.TENHOATCHAT, d.HAMLUONG, d.HANGSANXUAT, d.QUOCGIA, d.LOAIDUOC_ID, d.DUONGDUNG_ID, d.TINHTIEN_PTTT,        ten.TENDUOC, ten.TENDUOC_EN, ten.MAQUOCTE, ten.MAQUOCTEBT,        CASE WHEN d.BHYT = '1' THEN 'BHYT' ELSE '' END as BHYT_TEXT        , ld.LOAIVATTU_ID        , d.BENHVIEN_ID,        tk.SOLUONG, d.VTYT_PHANLOAI, d.PHAMVI, d.SUASOLUONGTONGHOP, d.MADUOCBV, d.DANGTRINHBAY        , TAMNGUNG = CASE WHEN d.TAMNGUNG = '1' OR nh.TAMNGUNG = '1' OR kd.TAMNGUNG = '1' THEN '1' ELSE '0' END        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        inner join        (        select  LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')) DUOC_KEY, (SUM(dtk.SOLUONG) - isnull(sum(A.SOLUONG),0) - isnull(sum(B.SOLUONG),0)) SOLUONG, pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        from (select sum(soluong) soluong,duoc_id,nguonduoc_id,khoduoc_id,benhvien_id from TT_DUOC_TONKHO  group by duoc_id,nguonduoc_id,khoduoc_id,benhvien_id) dtk        inner join TM_DUOC_PHAMVISD_MAPPING pvsd on dtk.KHODUOC_ID = pvsd.KHODUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NOITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) B on B.DUOC_ID = dtk.DUOC_ID and B.SOLUONG > 0 and B.PHAMVI_ID = pvsd.PHAMVI_ID and B.NGUONHANG_ID = dtk.NGUONDUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NGOAITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) A on A.DUOC_ID = dtk.DUOC_ID and A.SOLUONG > 0 and A.PHAMVI_ID = pvsd.PHAMVI_ID and A.NGUONHANG_ID = dtk.NGUONDUOC_ID        where dtk.SOLUONG > 0 and dtk.BENHVIEN_ID = 'HLU01'        group by LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')), pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        ) tk on tk.DUOC_ID = d.DUOC_ID        left join TM_DUOC_PHAMVISUDUNG kd on kd.PHAMVI_ID = tk.PHAMVI_ID and kd.BENHVIEN_ID = 'HLU01'        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = tk.NGUONDUOC_ID and nh.BENHVIEN_ID = 'HLU01'        where d.BENHVIEN_ID = 'HLU01'  and tk.SOLUONG >= 0         end                else        begin        select  distinct tk.DUOC_KEY, LTRIM(tk.PHAMVI_ID) as PHAMVI_ID, tk.NGUONDUOC_ID, nh.TENNGUONDUOC, nh.TINHTIEN, d.DUOC_ID, ld.MALOAIDUOC,        d.SOVISA,d.TYLE_VAT,d.COTOA, d.MADUOC, d.TENHANG, d.TENDUOCDAYDU, d.DONVITINH as DONVITINH, d.BHYT,        d.TENHOATCHAT, d.HAMLUONG, d.HANGSANXUAT, d.QUOCGIA, d.LOAIDUOC_ID, d.DUONGDUNG_ID, d.TINHTIEN_PTTT,        ten.TENDUOC, ten.TENDUOC_EN, ten.MAQUOCTE, ten.MAQUOCTEBT,        CASE WHEN d.BHYT = '1' THEN 'BHYT' ELSE '' END as BHYT_TEXT        , ld.LOAIVATTU_ID        , d.BENHVIEN_ID,        tk.SOLUONG, d.VTYT_PHANLOAI, d.PHAMVI, d.SUASOLUONGTONGHOP, d.MADUOCBV, d.DANGTRINHBAY        , TAMNGUNG = CASE WHEN d.TAMNGUNG = '1' OR nh.TAMNGUNG = '1' OR kd.TAMNGUNG = '1' THEN '1' ELSE '0' END        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        inner join        (        select  LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')) DUOC_KEY, (SUM(dtk.SOLUONG) - isnull(sum(A.SOLUONG),0) - isnull(sum(B.SOLUONG),0)) SOLUONG, pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        from (select sum(soluong) soluong,duoc_id,nguonduoc_id,khoduoc_id,benhvien_id from TT_DUOC_TONKHO  group by duoc_id,nguonduoc_id,khoduoc_id,benhvien_id) dtk        inner join TM_DUOC_PHAMVISD_MAPPING pvsd on dtk.KHODUOC_ID = pvsd.KHODUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NOITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) B on B.DUOC_ID = dtk.DUOC_ID and B.SOLUONG > 0 and B.PHAMVI_ID = pvsd.PHAMVI_ID and B.NGUONHANG_ID = dtk.NGUONDUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NGOAITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) A on A.DUOC_ID = dtk.DUOC_ID and A.SOLUONG > 0 and A.PHAMVI_ID = pvsd.PHAMVI_ID and A.NGUONHANG_ID = dtk.NGUONDUOC_ID        where dtk.SOLUONG > 0 and dtk.BENHVIEN_ID = 'HLU01'        group by LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')), pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        ) tk on tk.DUOC_ID = d.DUOC_ID        left join TM_DUOC_PHAMVISUDUNG kd on kd.PHAMVI_ID = tk.PHAMVI_ID and kd.BENHVIEN_ID = 'HLU01'        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = tk.NGUONDUOC_ID and nh.BENHVIEN_ID = 'HLU01'        where d.BENHVIEN_ID = 'HLU01'  and tk.SOLUONG >= 0        end]
2019-08-14 14:05:52,248 [5] DEBUG - Statement Id: [DAO00320_GetList] PreparedStatement : [select M.*            from TM_MAU M            LEFT JOIN TM_MAU_DONVITINH DVT on M.DONVITINH_ID=DVT.DONVITINH_ID            where            M.TAMNGUNG = '0'            and M.BENHVIEN_ID = 'HLU01'            order by M.TENMAU]
2019-08-14 14:05:52,318 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM071']
2019-08-14 14:05:52,352 [5] DEBUG - Statement Id: [DAO00322_GetListMauTonKhoForCreateCached] PreparedStatement : [SELECT DISTINCT          TK.MAU_KEY, TK.KHOMAU_ID, M.MAU_ID, M.MAMAU, M.TENMAU, M.NHOM_ABO, M.NHOM_RH, M.LOAIMAU_ID,          TK.SOLONHAP_ID, SLN.SOLONHAP, SLN.SOKIEMSOAT, TK.NGUONHANG_ID, NG.TENNGUONMAU, M.BENHVIEN_ID, M.DONVITINH_ID,          SUM(tk.SOLUONG) AS SOLUONG,K.TENKHO,DVT.TENDONVITINH          FROM TT_MAU_TONKHO TK          JOIN TM_KHO K ON TK.KHOMAU_ID = K.KHO_ID          JOIN TT_MAU_CHUNGTU_SOLONHAP SLN ON TK.SOLONHAP_ID = SLN.SOLONHAP_ID          JOIN TM_MAU M on TK.MAU_ID = M.MAU_ID and M.TAMNGUNG = '0'          LEFT JOIN TM_MAU_DONVITINH DVT on M.DONVITINH_ID=DVT.DONVITINH_ID          LEFT JOIN TM_NGUONMAU NG ON NG.NGUONMAU_ID = TK.NGUONHANG_ID          WHERE TK.SOLUONG > 0          GROUP BY TK.MAU_KEY, TK.KHOMAU_ID, M.MAU_ID, M.MAMAU, M.TENMAU, M.NHOM_ABO, M.NHOM_RH, M.LOAIMAU_ID,          TK.SOLONHAP_ID, SLN.SOLONHAP, SLN.SOKIEMSOAT,TK.NGUONHANG_ID, NG.TENNGUONMAU, M.BENHVIEN_ID, M.DONVITINH_ID,K.TENKHO,DVT.TENDONVITINH]
2019-08-14 14:05:52,423 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM073']
2019-08-14 14:05:52,457 [5] DEBUG - Statement Id: [DAO00322_GetListMauTonKhoTruBooking] PreparedStatement : [select distinct          TK.MAU_KEY, TK.KHOMAU_ID, M.MAU_ID, M.MAMAU, M.TENMAU, M.NHOM_ABO, M.NHOM_RH, M.LOAIMAU_ID, M.DONVITINH_ID,          TK.SOLONHAP_ID, TK.SOLONHAP, TK.SOKIEMSOAT,M.PHAMVI, TK.NGUONHANG_ID, NG.TENNGUONMAU, M.BENHVIEN_ID,          TK.SOLUONG,TK.TENKHO,DVT.TENDONVITINH          from TM_MAU M          JOIN          (          select          A.MAU_KEY, A.KHOMAU_ID, A.MAU_ID ,a.NGUONHANG_ID, A.SOLONHAP_ID, A.SOLONHAP, A.SOKIEMSOAT, A.SOLUONG,A.TENKHO          from          (          select KHOMAU_ID, TK.MAU_ID, TK.NGUONHANG_ID, TK.MAU_KEY, SLN.SOLONHAP_ID, SLN.SOLONHAP, SLN.SOKIEMSOAT, ISNULL(TK.SOLUONG,0) - ISNULL(book.SOLUONG,0) as SOLUONG,K.TENKHO          from TT_MAU_TONKHO TK          JOIN TM_KHO K ON TK.KHOMAU_ID = K.KHO_ID          inner join TT_MAU_CHUNGTU_SOLONHAP SLN ON TK.SOLONHAP_ID = SLN.SOLONHAP_ID          left join dbo.TT_MAU_TONKHO_BOOK book ON book.MAU_KEY = TK.MAU_KEY AND book.TRANGTHAI = 'HIEULUC'          where ISNULL(TK.SOLUONG,0) - ISNULL(book.SOLUONG,0) > 0          ) A          )TK on TK.MAU_ID = M.MAU_ID and M.TAMNGUNG = '0'          LEFT JOIN TM_MAU_DONVITINH DVT on M.DONVITINH_ID=DVT.DONVITINH_ID          LEFT JOIN TM_NGUONMAU NG ON NG.NGUONMAU_ID = TK.NGUONHANG_ID]
2019-08-14 14:05:52,531 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM072']
2019-08-14 14:05:53,782 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'MAIN'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2019-08-14 14:05:55,173 [1] DEBUG - Statement Id: [DAO00002_FormList] PreparedStatement : [select              TM_SYS_FORM.HOSPITAL_ID,              TM_SYS_FORM.NAME,              TM_SYS_FORM.CLASS,              TM_SYS_FORM.ASSEMBLY,              TM_SYS_FORM.TITLE_VI as TITLE              from TM_SYS_FORM              where HOSPITAL_ID = 'HLU01']
2019-08-14 14:05:59,987 [1] DEBUG - Statement Id: [DAO00300_GetShortcutListByUserID] PreparedStatement : [SELECT S.SHORTCUT_CODE, S.SHORTCUT_VALUE              FROM TM_SHORTCUT AS S              WHERE S.BENHVIEN_ID = 'HLU01' AND S.USER_ID = '1' AND TAMNGUNG = '0']
2019-08-14 14:06:00,020 [1] DEBUG - Statement Id: [DAO00087_GetList] PreparedStatement : [select CODE, VALUE, BENHVIEN_ID              from TM_SYS_APPSETTINGS              where LOCKED = '0' and BENHVIEN_ID = 'HLU01'              order by SETTING_ID]
2019-08-14 14:06:00,122 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'MSG01'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2019-08-14 14:06:00,263 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'MSG02'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2019-08-14 14:06:00,391 [1] DEBUG - Statement Id: [DAO00008_GetUserSettings] PreparedStatement : [select A.*, B.TENKHO , C.TENPHONGBAN, B.MAKHO, C.MAPHONGBAN          from TM_SYS_USERS A          left join TM_KHODUOC B on B.KHODUOC_ID = A.INVENTORY_ID          left join TM_PHONGBAN C on (C.PHONGBAN_ID = A.WORKING_DEPT_ID and C.BENHVIEN_ID =  @param0 )          left join TM_SYS_USERKHO D on (D.ACCOUNT_ID = A.ACCOUNT_ID and D.HOSPITAL_ID =  @param0 )          where          A.HOSPITAL_ID =  @param0            and                 A.ACCOUNT_ID =  @param1]
2019-08-14 14:06:00,393 [1] DEBUG - Statement Id: [DAO00008_GetUserSettings] Parameters: [@param0=[HOSPITAL_ID,HLU01], @param1=[ACCOUNT_ID,113]]
2019-08-14 14:06:00,393 [1] DEBUG - Statement Id: [DAO00008_GetUserSettings] Types: [@param0=[String, System.String], @param1=[String, System.String]]
2019-08-14 14:06:00,426 [1] DEBUG - Statement Id: [DAO00008_GetUserInvSettings] PreparedStatement : [select A.*, B.TENKHO, B.MAKHO, B.LOAIKHO_ID, B.KHOQUANLY_ID          from TM_SYS_USERKHO A          left join TM_KHO B on B.MODULE_ID = A.MODULE_ID and B.KHO_ID = A.KHO_ID          where A.HOSPITAL_ID =  @param0  and A.ACCOUNT_ID =  @param1           order by B.TENKHO]
2019-08-14 14:06:00,426 [1] DEBUG - Statement Id: [DAO00008_GetUserInvSettings] Parameters: [@param0=[HOSPITAL_ID,HLU01], @param1=[ACCOUNT_ID,113]]
2019-08-14 14:06:00,426 [1] DEBUG - Statement Id: [DAO00008_GetUserInvSettings] Types: [@param0=[String, System.String], @param1=[String, System.String]]
2019-08-14 14:06:00,561 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'COM30'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2019-08-14 14:06:00,751 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'RIS04'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2019-08-14 14:06:09,907 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'MENU1'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2019-08-14 14:06:10,067 [1] DEBUG - Statement Id: [DAO00011_GetList] PreparedStatement : [select              TM_SYS_MENU.ID,              TM_SYS_MENU.PARENTID,              TM_SYS_MENU.SCREEN,              TM_SYS_MENU.SMALLIMAGE,              TM_SYS_MENU.LARGEIMAGE,              TM_SYS_MENU.DESCRIPTION,              TM_SYS_MENU.TYPE,              TM_SYS_MENU.TITLE_VI as TITLE              from TM_SYS_MENU              where TM_SYS_MENU.HOSPITAL_ID = 'HLU01' and TM_SYS_MENU.ACTIVE = '1'               AND                   (TM_SYS_MENU.TYPE & '8' = '8')                             order by TM_SYS_MENU.ORDERNUM]
2019-08-14 14:06:10,357 [1] DEBUG - Statement Id: [DAO00011_usermenu_list] PreparedStatement : [select              TM_SYS_HOMEMENU.MENUID as ID,              TM_SYS_MENU.TITLE_VI as TITLE,              TM_SYS_MENU.SCREEN,              TM_SYS_MENU.SMALLIMAGE,              TM_SYS_MENU.LARGEIMAGE,              TM_SYS_MENU.TYPE              from TM_SYS_HOMEMENU              left join TM_SYS_MENU on TM_SYS_MENU.ID = TM_SYS_HOMEMENU.MENUID and TM_SYS_MENU.HOSPITAL_ID = TM_SYS_HOMEMENU.HOSPITAL_ID              where TM_SYS_HOMEMENU.HOSPITAL_ID = 'HLU01' and TM_SYS_HOMEMENU.USERID = '113' and TM_SYS_MENU.ACTIVE = '1'               AND                   (TM_SYS_MENU.TYPE & '8' = '8')                             ORDER BY TM_SYS_HOMEMENU.ORDERNUM]
2019-08-14 14:09:04,364 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'OPD02'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2019-08-14 14:09:05,694 [1] DEBUG - Statement Id: [DAO00017_GetLoaiGiaByDoiTuongId] PreparedStatement : [select dtlg.DOUUTIEN, dtlg.DOITUONG_ID, lg.LOAIGIA_ID, lg.TENLOAIGIA, lg.MALOAIGIA              from TM_LOAIGIA lg              left join TM_DOITUONG_LOAIGIA dtlg              on lg.LOAIGIA_ID = dtlg.LOAIGIA_ID and dtlg.BENHVIEN_ID = 'HLU01'              where lg.TAMNGUNG = 0 and lg.BENHVIEN_ID = 'HLU01'                             order by dtlg.DOUUTIEN]
2019-08-14 14:09:05,925 [1] DEBUG - Statement Id: [DAO00092_GetList_ToathuocNgoaitru] PreparedStatement : [select A.*, B.PHAMVI_ID, C.KHODUOC_ID from TM_TOATHUOC_NGOAITRU A        left join TM_DUOC_PHAMVISUDUNG B on B.MAPHAMVI = A.MAPHAMVI        left join (select distinct PHAMVI_ID, KHODUOC_ID from TM_DUOC_PHAMVISD_MAPPING) C on C.PHAMVI_ID = B.PHAMVI_ID        where A.TAMNGUNG != '1' and A.BENHVIEN_ID = 'HLU01'        ORDER BY A.SAPXEP ASC]
2019-08-14 14:09:09,398 [1] DEBUG - Statement Id: [DAO00009_TT_TIEPNHAN_GetProcess] PreparedStatement : [select PROCESS_ID from TT_TIEPNHAN where SOTIEPNHAN = 'TN190510.0000172']
2019-08-14 14:09:09,776 [1] DEBUG - Statement Id: [DAOWF004_laytrangthaiDV] PreparedStatement : [select top 1 A.CURR_STATE_CODE as STATE_CODE, isNull(C.SHORT_NAME,C.NAME) as TRANGTHAI, C.NAME as TRANGTHAI_CHITIET, C.STATUS_CODE, D.ISACTIVE as ACTIVE, E.STATUS_CODE  as OLD_STATUSCODE        from TT_REQUEST_SERVICE_DETAIL A                left join (select * from TT_REQUEST_SERVICE where PARA = '{"DICHVU_ID":"5436","DVYEUCAU_ID":"127426"}') D on D.ID = A.REQUEST_SERVICE_ID        left join TM_STATE C on A.CURR_STATE_CODE = C.STATE_CODE and C.PROCESS_CODE = D.PROCESS_CODE        left join TM_STATE E on A.OLD_STATE_CODE = E.STATE_CODE and E.PROCESS_CODE = D.PROCESS_CODE        where        A.REQUEST_SERVICE_ID = (select top 1 ID from TT_REQUEST_SERVICE where PARA = '{"DICHVU_ID":"5436","DVYEUCAU_ID":"127426"}' order by ID desc)        order by A.ID desc]
2019-08-14 14:09:10,531 [1] DEBUG - Statement Id: [DAO00017_GetLoaiGiaByDoiTuongId] PreparedStatement : [select dtlg.DOUUTIEN, dtlg.DOITUONG_ID, lg.LOAIGIA_ID, lg.TENLOAIGIA, lg.MALOAIGIA              from TM_LOAIGIA lg              left join TM_DOITUONG_LOAIGIA dtlg              on lg.LOAIGIA_ID = dtlg.LOAIGIA_ID and dtlg.BENHVIEN_ID = 'HLU01'              where lg.TAMNGUNG = 0 and lg.BENHVIEN_ID = 'HLU01'                             order by dtlg.DOUUTIEN]
2019-08-14 14:09:10,782 [1] DEBUG - Statement Id: [DAO00087_GetServiceParams] PreparedStatement : [select CODE, VALUE              from TM_SYS_APPSETTINGS              where LOCKED = '0' and BENHVIEN_ID = 'HLU01']
2019-08-14 14:09:11,155 [1] DEBUG - Statement Id: [DAO00014_KiemTraDVYCCoBHYT] PreparedStatement : [select *        from TT_VIENPHI        where REF_ID  = '127426' and REF_TABLE = 'TT_DVYEUCAU' and BHYT_DONGIA > 0]
2019-08-14 14:09:11,345 [1] DEBUG - Statement Id: [DAO00040_LayListToaMau] PreparedStatement : [select A.*, dc.TENDUOCDAYDU, dc.BHYT DUOC_BHYT, ld.LOAIVATTU_ID, ld.MALOAIDUOC, dd.DICTIONARY_NAME DUONGDUNG, dc.TAMNGUNG            from TT_TOATHUOCMAU A            left join TM_DUOC dc on A.DUOC_ID = dc.DUOC_ID            left join TM_LOAIDUOC ld on dc.LOAIDUOC_ID = ld.LOAIDUOC_ID            left join (select * from LST_DICTIONARY where DICTIONARY_TYPE_CODE like 'DuongDung') dd on dd.DICTIONARY_ID = dc.DUONGDUNG_ID            where (1=1)             and               A.BACSI_ID  = 1              and A.LOAITOATHUOC in  (                        @param0                   ,                           @param1                   ,                           @param2                   ,                           @param3                   )]
2019-08-14 14:09:11,346 [1] DEBUG - Statement Id: [DAO00040_LayListToaMau] Parameters: [@param0=[LSTLOAITOATHUOC[0],BV], @param1=[LSTLOAITOATHUOC[1],MN], @param2=[LSTLOAITOATHUOC[2],MP], @param3=[LSTLOAITOATHUOC[3],TV]]
2019-08-14 14:09:11,346 [1] DEBUG - Statement Id: [DAO00040_LayListToaMau] Types: [@param0=[String, System.String], @param1=[String, System.String], @param2=[String, System.String], @param3=[String, System.String]]
2019-08-14 14:09:11,560 [1] DEBUG - Statement Id: [DAO00040_LayListToaMau] PreparedStatement : [select A.*, dc.TENDUOCDAYDU, dc.BHYT DUOC_BHYT, ld.LOAIVATTU_ID, ld.MALOAIDUOC, dd.DICTIONARY_NAME DUONGDUNG, dc.TAMNGUNG            from TT_TOATHUOCMAU A            left join TM_DUOC dc on A.DUOC_ID = dc.DUOC_ID            left join TM_LOAIDUOC ld on dc.LOAIDUOC_ID = ld.LOAIDUOC_ID            left join (select * from LST_DICTIONARY where DICTIONARY_TYPE_CODE like 'DuongDung') dd on dd.DICTIONARY_ID = dc.DUONGDUNG_ID            where (1=1)             and               A.BACSI_ID  = 1              and A.LOAITOATHUOC in  (                        @param0                   ,                           @param1                   ,                           @param2                   ,                           @param3                   )]
2019-08-14 14:09:11,560 [1] DEBUG - Statement Id: [DAO00040_LayListToaMau] Parameters: [@param0=[LSTLOAITOATHUOC[0],BV], @param1=[LSTLOAITOATHUOC[1],MN], @param2=[LSTLOAITOATHUOC[2],MP], @param3=[LSTLOAITOATHUOC[3],TV]]
2019-08-14 14:09:11,560 [1] DEBUG - Statement Id: [DAO00040_LayListToaMau] Types: [@param0=[String, System.String], @param1=[String, System.String], @param2=[String, System.String], @param3=[String, System.String]]
2019-08-14 14:09:11,785 [1] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoVaBookingCOM23UpdateRedis_TheoPhamvi] PreparedStatement : [select distinct tk.DUOC_KEY, tk.SOLUONG        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        inner join        (        select  LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')) DUOC_KEY, (SUM(dtk.SOLUONG) - isnull(sum(A.SOLUONG),0) - isnull(sum(B.SOLUONG),0)) SOLUONG, pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        from (select sum(soluong) soluong,duoc_id,nguonduoc_id,khoduoc_id,benhvien_id from TT_DUOC_TONKHO  group by duoc_id,nguonduoc_id,khoduoc_id,benhvien_id) dtk        inner join TM_DUOC_PHAMVISD_MAPPING pvsd on dtk.KHODUOC_ID = pvsd.KHODUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NOITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) B on B.DUOC_ID = dtk.DUOC_ID and B.SOLUONG > 0 and B.PHAMVI_ID = pvsd.PHAMVI_ID and B.NGUONHANG_ID = dtk.NGUONDUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NGOAITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) A on A.DUOC_ID = dtk.DUOC_ID and A.SOLUONG > 0 and A.PHAMVI_ID = pvsd.PHAMVI_ID and A.NGUONHANG_ID = dtk.NGUONDUOC_ID        where dtk.SOLUONG > 0 and dtk.BENHVIEN_ID = 'HLU01'        group by LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')), pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        ) tk on tk.DUOC_ID = d.DUOC_ID        left join TM_DUOC_PHAMVISUDUNG kd on kd.PHAMVI_ID = tk.PHAMVI_ID and kd.BENHVIEN_ID = 'HLU01'        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = tk.NGUONDUOC_ID and nh.BENHVIEN_ID = 'HLU01'        where  d.BENHVIEN_ID = 'HLU01' and tk.PHAMVI_ID =  @param0]
2019-08-14 14:09:11,785 [1] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoVaBookingCOM23UpdateRedis_TheoPhamvi] Parameters: [@param0=[PHAMVI_ID,1028]]
2019-08-14 14:09:11,785 [1] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoVaBookingCOM23UpdateRedis_TheoPhamvi] Types: [@param0=[Int64, System.Int64]]
2019-08-14 14:09:12,252 [1] DEBUG - Statement Id: [DAO00013_GetTienSuBenh] PreparedStatement : [select TIENSUBENH, TIENSUDIUNG              from TT_BENHNHAN              where TT_BENHNHAN.BENHNHAN_ID  = '15640']
2019-08-14 14:09:12,348 [1] DEBUG - Statement Id: [DAO00095_GetTTDiUngThuoc] PreparedStatement : [select *              from TT_BENHNHAN_DIUNG_THUOC              where BENHNHAN_ID = '15640'              and BENHVIEN_ID = 'HLU01']
2019-08-14 14:09:12,436 [1] DEBUG - Statement Id: [DAO00014_GetTotalChiPhiDVByTiepNhan] PreparedStatement : [select sum(THANHTIEN_DOANHTHU) as THANHTIEN_DOANHTHU from TT_VIENPHI        where ACTIVE = '1'        and TIEPNHAN_ID = '17518'        and REF_TABLE = 'TT_DVYEUCAU'        and exists (select DVYEUCAU_ID from TT_DVYEUCAU where HUYYEUCAU = '0' and TIEPNHAN_ID = '17518' and TT_VIENPHI.REF_ID = DVYEUCAU_ID)]
2019-08-14 14:09:12,720 [1] DEBUG - Statement Id: [DAO00014_GetKhamBenhInfo] PreparedStatement : [select * from TT_NGOAITRU_KHAMBENH where KHAMBENH_ID =        (select KHAMBENH_NGOAITRU_ID from TT_DVYEUCAU where DVYEUCAU_ID = '127426')]
2019-08-14 14:09:12,841 [1] DEBUG - Statement Id: [DAO00014_GetSoCaKhamTrongNgay] PreparedStatement : [select Count(KB.KHAMBENH_ID) as SOCAKHAMTRONGNGAY        from TT_NGOAITRU_KHAMBENH KB        inner join TT_TIEPNHAN TN on TN.TIEPNHAN_ID = KB.TIEPNHAN_ID        where KB.NGAYKHAM = convert(date, GETDATE())        and KB.BACSIKHAM_ID = '1'        and KB.BENHVIEN_ID = 'HLU01'        and TN.SOBHYT IS NOT NULL and TN.SOBHYT != '']
2019-08-14 14:09:13,096 [1] DEBUG - Statement Id: [DAO00068_GetLastedSinhHieuInfo] PreparedStatement : [select top (1) *, CHISOBMI as BMI              from TT_NGOAITRU_KHAMBENH_SINHHIEU              where BENHNHAN_ID = '15640'              order by KHAMBENH_SINHHIEU_ID desc]
2019-08-14 14:09:13,339 [1] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoVaBookingCOM23UpdateRedis_TheoPhamvi] PreparedStatement : [select distinct tk.DUOC_KEY, tk.SOLUONG        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        inner join        (        select  LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')) DUOC_KEY, (SUM(dtk.SOLUONG) - isnull(sum(A.SOLUONG),0) - isnull(sum(B.SOLUONG),0)) SOLUONG, pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        from (select sum(soluong) soluong,duoc_id,nguonduoc_id,khoduoc_id,benhvien_id from TT_DUOC_TONKHO  group by duoc_id,nguonduoc_id,khoduoc_id,benhvien_id) dtk        inner join TM_DUOC_PHAMVISD_MAPPING pvsd on dtk.KHODUOC_ID = pvsd.KHODUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NOITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) B on B.DUOC_ID = dtk.DUOC_ID and B.SOLUONG > 0 and B.PHAMVI_ID = pvsd.PHAMVI_ID and B.NGUONHANG_ID = dtk.NGUONDUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NGOAITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) A on A.DUOC_ID = dtk.DUOC_ID and A.SOLUONG > 0 and A.PHAMVI_ID = pvsd.PHAMVI_ID and A.NGUONHANG_ID = dtk.NGUONDUOC_ID        where dtk.SOLUONG > 0 and dtk.BENHVIEN_ID = 'HLU01'        group by LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')), pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        ) tk on tk.DUOC_ID = d.DUOC_ID        left join TM_DUOC_PHAMVISUDUNG kd on kd.PHAMVI_ID = tk.PHAMVI_ID and kd.BENHVIEN_ID = 'HLU01'        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = tk.NGUONDUOC_ID and nh.BENHVIEN_ID = 'HLU01'        where  d.BENHVIEN_ID = 'HLU01' and tk.PHAMVI_ID =  @param0]
2019-08-14 14:09:13,339 [1] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoVaBookingCOM23UpdateRedis_TheoPhamvi] Parameters: [@param0=[PHAMVI_ID,1028]]
2019-08-14 14:09:13,339 [1] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoVaBookingCOM23UpdateRedis_TheoPhamvi] Types: [@param0=[Int64, System.Int64]]
2019-08-14 14:09:17,233 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'OPD89'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2019-08-14 14:09:17,413 [1] DEBUG - Statement Id: [DAO00012_GetList] PreparedStatement : [select        DICTIONARY_ID,        DICTIONARY_CODE,        DICTIONARY_NAME,        ATTRIBUTE1,        ATTRIBUTE2,        DICTIONARY_NAME_EN        from LST_DICTIONARY        where LST_DICTIONARY.Enabled = '1'         AND           LST_DICTIONARY.DICTIONARY_TYPE_CODE = 'DiaDiemTaiNan'                 order by LST_DICTIONARY.IDX]
2019-08-14 14:09:17,655 [1] DEBUG - Statement Id: [DAO00012_GetList] PreparedStatement : [select        DICTIONARY_ID,        DICTIONARY_CODE,        DICTIONARY_NAME,        ATTRIBUTE1,        ATTRIBUTE2,        DICTIONARY_NAME_EN        from LST_DICTIONARY        where LST_DICTIONARY.Enabled = '1'         AND           LST_DICTIONARY.DICTIONARY_TYPE_CODE = 'BoPhanBiThuong'                 order by LST_DICTIONARY.IDX]
2019-08-14 14:09:17,872 [1] DEBUG - Statement Id: [DAO00012_GetList] PreparedStatement : [select        DICTIONARY_ID,        DICTIONARY_CODE,        DICTIONARY_NAME,        ATTRIBUTE1,        ATTRIBUTE2,        DICTIONARY_NAME_EN        from LST_DICTIONARY        where LST_DICTIONARY.Enabled = '1'         AND           LST_DICTIONARY.DICTIONARY_TYPE_CODE = 'LyDoCapCuu'                 order by LST_DICTIONARY.IDX]
2019-08-14 14:09:18,092 [1] DEBUG - Statement Id: [DAO00012_GetList] PreparedStatement : [select        DICTIONARY_ID,        DICTIONARY_CODE,        DICTIONARY_NAME,        ATTRIBUTE1,        ATTRIBUTE2,        DICTIONARY_NAME_EN        from LST_DICTIONARY        where LST_DICTIONARY.Enabled = '1'         AND           LST_DICTIONARY.DICTIONARY_TYPE_CODE = 'NguyenNhanTaiNan'                 order by LST_DICTIONARY.IDX]
2019-08-14 14:09:18,235 [1] DEBUG - Statement Id: [DAO00012_GetList] PreparedStatement : [select        DICTIONARY_ID,        DICTIONARY_CODE,        DICTIONARY_NAME,        ATTRIBUTE1,        ATTRIBUTE2,        DICTIONARY_NAME_EN        from LST_DICTIONARY        where LST_DICTIONARY.Enabled = '1'         AND           LST_DICTIONARY.DICTIONARY_TYPE_CODE = 'DienBienSauTaiNan'                 order by LST_DICTIONARY.IDX]
2019-08-14 14:09:18,314 [1] DEBUG - Statement Id: [DAO00012_GetList] PreparedStatement : [select        DICTIONARY_ID,        DICTIONARY_CODE,        DICTIONARY_NAME,        ATTRIBUTE1,        ATTRIBUTE2,        DICTIONARY_NAME_EN        from LST_DICTIONARY        where LST_DICTIONARY.Enabled = '1'         AND           LST_DICTIONARY.DICTIONARY_TYPE_CODE = 'XuTriSauTaiNan'                 order by LST_DICTIONARY.IDX]
2019-08-14 14:09:18,460 [1] DEBUG - Statement Id: [DAO00012_GetList] PreparedStatement : [select        DICTIONARY_ID,        DICTIONARY_CODE,        DICTIONARY_NAME,        ATTRIBUTE1,        ATTRIBUTE2,        DICTIONARY_NAME_EN        from LST_DICTIONARY        where LST_DICTIONARY.Enabled = '1'         AND           LST_DICTIONARY.DICTIONARY_TYPE_CODE = 'XuTriKhamCapCuu'                 order by LST_DICTIONARY.IDX]
2019-08-14 14:09:18,569 [1] DEBUG - Statement Id: [DAO00012_GetList] PreparedStatement : [select        DICTIONARY_ID,        DICTIONARY_CODE,        DICTIONARY_NAME,        ATTRIBUTE1,        ATTRIBUTE2,        DICTIONARY_NAME_EN        from LST_DICTIONARY        where LST_DICTIONARY.Enabled = '1'         AND           LST_DICTIONARY.DICTIONARY_TYPE_CODE = 'MucDoTaiNan'                 order by LST_DICTIONARY.IDX]
2019-08-14 14:09:22,599 [1] DEBUG - Statement Id: [DAO00068_GetTTBenhAnByBenhNhanID] PreparedStatement : [select TOP (1) tn.TIEPNHAN_ID, BENHAN_ID, ba.TRANGTHAI              from TT_TIEPNHAN tn              left join TT_NOITRU_BENHAN ba              on tn.TIEPNHAN_ID = ba.TIEPNHAN_ID              where tn.BENHNHAN_ID = '15640'              order by tn.NGAYTAO desc]
2019-08-14 14:09:23,066 [1] DEBUG - Statement Id: [DAO00014_GetTrangThaiTiepNhan] PreparedStatement : [select tn.TIEPNHAN_ID, tn.KHOADULIEU, xncp.XACNHANCHIPHI_ID from TT_TIEPNHAN tn        left join TT_XACNHANCHIPHI xncp        on tn.TIEPNHAN_ID = xncp.TIEPNHAN_ID        where tn.TIEPNHAN_ID = '17518'        and tn.BENHVIEN_ID = 'HLU01']
2019-08-14 14:09:23,296 [1] DEBUG - Statement Id: [DAO00014_GetTT_TAINANTHUONGTICH] PreparedStatement : [SELECT *        FROM [dbo].[TT_TAINANTHUONGTICH]        WHERE        TT_TAINANTHUONGTICH.TIEPNHAN_ID = '17518' AND        TT_TAINANTHUONGTICH.BENHNHAN_ID = '15640']
2019-08-14 14:09:23,479 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'COM98'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
--------------------------------------------------------------------------------
2019-08-14 14:18:57,375 [1] DEBUG - Statement Id: [DAO00001_DBList] PreparedStatement : [select *              from TM_SYS_SERVER              where HOSPITAL_ID = '_SYSTEM_' and TYPE = 'D']
2019-08-14 14:18:57,767 [1] DEBUG - Statement Id: [DAO00001_DaoList] PreparedStatement : [select              TM_SYS_SERVICEMAP.ID,              TM_SYS_SERVICEMAP.HOSPITAL_ID,              TM_SYS_SERVICEMAP.DB_NAME,              TM_SYS_SERVICEMAP.TYPE,              TM_SYS_SERVICEMAP.NAME,              TM_SYS_SERVICEMAP.CLASS,              (TM_SYS_DIC.VALUE + '.' + TM_SYS_SERVICEMAP.CLASS) as CLASSFULL,              TM_SYS_SERVICEMAP.ASSEMBLY              from TM_SYS_SERVICEMAP              inner join TM_SYS_DIC              on TM_SYS_SERVICEMAP.NAMESPACE = TM_SYS_DIC.ID              where HOSPITAL_ID = '_SYSTEM_' AND TYPE = 'D' AND ACTIVE = '1'              order by DB_NAME]
2019-08-14 14:18:57,817 [1] DEBUG - Statement Id: [DAO00001_ServiceList] PreparedStatement : [select              TM_SYS_SERVICEMAP.ID,              TM_SYS_SERVICEMAP.HOSPITAL_ID,              TM_SYS_SERVICEMAP.DB_NAME,              TM_SYS_SERVICEMAP.TYPE,              TM_SYS_SERVICEMAP.NAME,              TM_SYS_SERVICEMAP.CLASS,              (TM_SYS_DIC.VALUE + '.' + TM_SYS_SERVICEMAP.CLASS) as CLASSFULL,              TM_SYS_SERVICEMAP.ASSEMBLY,              TM_SYS_SERVER.URL              from TM_SYS_SERVICEMAP              inner join TM_SYS_DIC on TM_SYS_SERVICEMAP.NAMESPACE = TM_SYS_DIC.ID              inner join TM_SYS_SERVER on (TM_SYS_SERVICEMAP.DB_NAME = TM_SYS_SERVER.NAME) and (TM_SYS_SERVER.HOSPITAL_ID = '_SYSTEM_')              where TM_SYS_SERVICEMAP.HOSPITAL_ID = '_SYSTEM_' AND TM_SYS_SERVICEMAP.TYPE = 'S'  AND ACTIVE = '1'              order by URL]
2019-08-14 14:18:58,339 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = '_SYSTEM_'               AND                   TM_SYS_SCREEN.PAGE = 'LOGIN'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2019-08-14 14:18:58,675 [1] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = '_SYSTEM_'               AND                   TM_SYS_CACHE.ACTIVE = '1']
2019-08-14 14:19:03,700 [1] DEBUG - Statement Id: [DAO00001_DBList] PreparedStatement : [select *              from TM_SYS_SERVER              where HOSPITAL_ID = 'HLU01' and TYPE = 'D']
2019-08-14 14:19:03,745 [1] DEBUG - Statement Id: [DAO00001_DaoList] PreparedStatement : [select              TM_SYS_SERVICEMAP.ID,              TM_SYS_SERVICEMAP.HOSPITAL_ID,              TM_SYS_SERVICEMAP.DB_NAME,              TM_SYS_SERVICEMAP.TYPE,              TM_SYS_SERVICEMAP.NAME,              TM_SYS_SERVICEMAP.CLASS,              (TM_SYS_DIC.VALUE + '.' + TM_SYS_SERVICEMAP.CLASS) as CLASSFULL,              TM_SYS_SERVICEMAP.ASSEMBLY              from TM_SYS_SERVICEMAP              inner join TM_SYS_DIC              on TM_SYS_SERVICEMAP.NAMESPACE = TM_SYS_DIC.ID              where HOSPITAL_ID = 'HLU01' AND TYPE = 'D' AND ACTIVE = '1'              order by DB_NAME]
2019-08-14 14:19:05,525 [1] DEBUG - Statement Id: [DAO00001_ServiceList] PreparedStatement : [select              TM_SYS_SERVICEMAP.ID,              TM_SYS_SERVICEMAP.HOSPITAL_ID,              TM_SYS_SERVICEMAP.DB_NAME,              TM_SYS_SERVICEMAP.TYPE,              TM_SYS_SERVICEMAP.NAME,              TM_SYS_SERVICEMAP.CLASS,              (TM_SYS_DIC.VALUE + '.' + TM_SYS_SERVICEMAP.CLASS) as CLASSFULL,              TM_SYS_SERVICEMAP.ASSEMBLY,              TM_SYS_SERVER.URL              from TM_SYS_SERVICEMAP              inner join TM_SYS_DIC on TM_SYS_SERVICEMAP.NAMESPACE = TM_SYS_DIC.ID              inner join TM_SYS_SERVER on (TM_SYS_SERVICEMAP.DB_NAME = TM_SYS_SERVER.NAME) and (TM_SYS_SERVER.HOSPITAL_ID = 'HLU01')              where TM_SYS_SERVICEMAP.HOSPITAL_ID = 'HLU01' AND TM_SYS_SERVICEMAP.TYPE = 'S'  AND ACTIVE = '1'              order by URL]
2019-08-14 14:19:05,671 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1']
2019-08-14 14:19:06,778 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM005']
2019-08-14 14:19:06,980 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM015']
2019-08-14 14:19:07,080 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM067']
2019-08-14 14:19:07,172 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM008']
2019-08-14 14:19:07,561 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM068']
2019-08-14 14:19:07,649 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM006']
2019-08-14 14:19:07,740 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM030']
2019-08-14 14:19:07,829 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM025']
2019-08-14 14:19:07,930 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM024']
2019-08-14 14:19:08,443 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM033']
2019-08-14 14:19:08,487 [5] DEBUG - Statement Id: [DAO00027_GetListDuocKyGuiTonKho] PreparedStatement : [select  distinct TT_TONKHO.DUOC_KEY, LTRIM(TT_TONKHO.KHODUOC_ID) as KHODUOC_ID, TM_DUOC.DUOC_ID, TM_LOAIDUOC.MALOAIDUOC,TM_DUOC.SOVISA,TM_DUOC.TYLE_VAT,TM_DUOC.COTOA,        TM_DUOC.MADUOC, TM_DUOC.TENHANG, TM_DUOC.TENDUOCDAYDU, dvt.TENDONVITINH as DONVITINH,  TM_DUOC.DONVITINH_ID,TM_DUOC.BHYT,TM_DUOC.PHAMVI,        TM_DUOC.TENHOATCHAT, TM_DUOC.HAMLUONG, TM_DUOC.HANGSANXUAT, TM_DUOC.QUOCGIA, TM_DUOC.LOAIDUOC_ID, TM_DUOC.DUONGDUNG_ID,        TM_TENDUOC.TENDUOC, TM_TENDUOC.TENDUOC_EN, TM_TENDUOC.MAQUOCTE, TM_TENDUOC.MAQUOCTEBT,        TM_LOAIDUOC.LOAIVATTU_ID, TM_DUOC.BENHVIEN_ID,TT_TONKHO.SOLUONG, TT_TONKHO.NGUONDUOC_ID, NH.TENNGUONDUOC        , TAMNGUNG = CASE WHEN TM_DUOC.TAMNGUNG = '1' OR nh.TAMNGUNG = '1' OR KD.TAMNGUNG = '1' THEN '1' ELSE '0' END        , TM_DUOC.DANGTRINHBAY        from TM_DUOC        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = TM_DUOC.DONVITINH_ID        left join TM_TENDUOC on TM_DUOC.TENDUOC_ID = TM_TENDUOC.TENDUOC_ID and TM_DUOC.BENHVIEN_ID = 'HLU01' and TM_DUOC.TAMNGUNG = '0'        left join TM_LOAIDUOC on TM_LOAIDUOC.LOAIDUOC_ID = TM_DUOC.LOAIDUOC_ID and TM_LOAIDUOC.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG on (TM_LOAIDUOC.LOAIVATTU_ID = TM_DUOC_HANDUNG.LOAIDUOC and TM_DUOC_HANDUNG.BENHVIEN_ID = 'HLU01')        inner join        (select LTRIM(A.KHODUOC_ID) + '_' + LTRIM(A.DUOC_ID) + '_' + LTRIM(ISNULL(A.NGUONDUOC_ID,'')) as DUOC_KEY, A.KHODUOC_ID, A.DUOC_ID,A.NGUONDUOC_ID,        SUM(isnull(A.SOLUONG,0)) as SOLUONG        from        (select SUM(SOLUONG) as SOLUONG, KHODUOC_ID, DUOC_ID, NGUONDUOC_ID from TT_DUOC_KYGUI_TONKHO        where BENHVIEN_ID = 'HLU01' group by KHODUOC_ID, DUOC_ID, NGUONDUOC_ID) A        group by LTRIM(A.KHODUOC_ID) + '_' + LTRIM(A.DUOC_ID) + '_' + LTRIM(A.NGUONDUOC_ID), A.KHODUOC_ID, A.DUOC_ID, A.NGUONDUOC_ID)        TT_TONKHO on TT_TONKHO.DUOC_ID = TM_DUOC.DUOC_ID        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = TT_TONKHO.NGUONDUOC_ID and nh.BENHVIEN_ID = 'HLU01'        LEFT JOIN TM_KHODUOC KD ON KD.KHODUOC_ID = TT_TONKHO.KHODUOC_ID        where TM_DUOC.BENHVIEN_ID = 'HLU01' AND TT_TONKHO.SOLUONG >= 0]
2019-08-14 14:19:08,975 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM018']
2019-08-14 14:19:09,036 [5] DEBUG - Statement Id: [DAO00027_GetListDuocTonKho] PreparedStatement : [select distinct TT_TONKHO.DUOC_KEY, LTRIM(TT_TONKHO.KHODUOC_ID) as KHODUOC_ID, TM_DUOC.DUOC_ID, TM_LOAIDUOC.MALOAIDUOC,TM_DUOC.SOVISA,TM_DUOC.TYLE_VAT,TM_DUOC.COTOA,        TM_DUOC.MADUOC, TM_DUOC.TENHANG, TM_DUOC.TENDUOCDAYDU, dvt.TENDONVITINH as DONVITINH,  TM_DUOC.DONVITINH_ID,TM_DUOC.BHYT,                TM_DUOC.TENHOATCHAT,          TM_DUOC.HAMLUONG, TM_DUOC.HANGSANXUAT, TM_DUOC.QUOCGIA, TM_DUOC.LOAIDUOC_ID, TM_DUOC.DUONGDUNG_ID,        TM_TENDUOC.TENDUOC, TM_TENDUOC.TENDUOC_EN, TM_TENDUOC.MAQUOCTE, TM_TENDUOC.MAQUOCTEBT,        TM_LOAIDUOC.LOAIVATTU_ID, TM_DUOC.BENHVIEN_ID,        TT_TONKHO.SOLUONG, TM_DUOC.VTYT_PHANLOAI, TM_DUOC.PHAMVI, TT_TONKHO.NGUONDUOC_ID, NG.TENNGUONDUOC AS TENNGUONDUOC        , TAMNGUNG = CASE WHEN TM_DUOC.TAMNGUNG = '1' OR NG.TAMNGUNG = '1' OR KD.TAMNGUNG = '1' THEN '1' ELSE '0' END        , TM_DUOC.DANGTRINHBAY        from TM_DUOC        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = TM_DUOC.DONVITINH_ID        left join TM_TENDUOC on TM_DUOC.TENDUOC_ID = TM_TENDUOC.TENDUOC_ID and TM_DUOC.BENHVIEN_ID = 'HLU01' and TM_DUOC.TAMNGUNG = '0'        left join TM_LOAIDUOC on TM_LOAIDUOC.LOAIDUOC_ID = TM_DUOC.LOAIDUOC_ID and TM_LOAIDUOC.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG on (TM_LOAIDUOC.LOAIVATTU_ID = TM_DUOC_HANDUNG.LOAIDUOC and TM_DUOC_HANDUNG.BENHVIEN_ID = 'HLU01')        inner join        (select LTRIM(A.KHODUOC_ID) + '_' + LTRIM(A.DUOC_ID) + '_' + LTRIM(ISNULL(A.NGUONDUOC_ID,'')) as DUOC_KEY, A.KHODUOC_ID, A.DUOC_ID, A.NGUONDUOC_ID,        SUM(isnull(A.SOLUONG,0)) as SOLUONG        from        (select SUM(SOLUONG) as SOLUONG, KHODUOC_ID, DUOC_ID, NGUONDUOC_ID from TT_DUOC_TONKHO        where BENHVIEN_ID = 'HLU01' group by KHODUOC_ID, DUOC_ID, NGUONDUOC_ID) A        group by LTRIM(A.KHODUOC_ID) + '_' + LTRIM(A.DUOC_ID) + '_' + LTRIM(ISNULL(A.NGUONDUOC_ID,'')), A.KHODUOC_ID, A.DUOC_ID, NGUONDUOC_ID        ) TT_TONKHO on TT_TONKHO.DUOC_ID = TM_DUOC.DUOC_ID        LEFT JOIN TM_NGUONHANG NG ON NG.NGUONDUOC_ID = TT_TONKHO.NGUONDUOC_ID        LEFT JOIN TM_KHODUOC KD ON KD.KHODUOC_ID = TT_TONKHO.KHODUOC_ID        where TM_DUOC.BENHVIEN_ID = 'HLU01' and TT_TONKHO.SOLUONG >= 0]
2019-08-14 14:19:17,601 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM023']
2019-08-14 14:19:17,662 [5] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoVaBooking] PreparedStatement : [declare @TOAMUANGOAI int = 0;        select @TOAMUANGOAI = isnull(VALUE,0) from TM_SYS_APPSETTINGS where CODE = 'OPD_TOAMUANGOAI_DUNGDANHMUC_DUOC'                if @TOAMUANGOAI = 1        begin        select  distinct '0' + '_' + LTRIM(d.DUOC_ID) + '_' + '0' as DUOC_KEY, 0 as PHAMVI_ID, 0 as NGUONDUOC_ID, null as TENNGUONDUOC, null as TINHTIEN, d.DUOC_ID, ld.MALOAIDUOC,        d.SOVISA,d.TYLE_VAT,d.COTOA, d.MADUOC, d.TENHANG, d.TENDUOCDAYDU, d.DONVITINH as DONVITINH, d.BHYT,        d.TENHOATCHAT, d.HAMLUONG, d.HANGSANXUAT, d.QUOCGIA, d.LOAIDUOC_ID, d.DUONGDUNG_ID, d.TINHTIEN_PTTT,        ten.TENDUOC, ten.TENDUOC_EN, ten.MAQUOCTE, ten.MAQUOCTEBT,        '' as BHYT_TEXT        , ld.LOAIVATTU_ID        , d.BENHVIEN_ID,        999999999 as SOLUONG, d.VTYT_PHANLOAI, d.PHAMVI, d.SUASOLUONGTONGHOP, d.MADUOCBV, d.DANGTRINHBAY        , TAMNGUNG = CASE WHEN d.TAMNGUNG = '1' THEN '1' ELSE '0' END        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        union all        select  distinct tk.DUOC_KEY, LTRIM(tk.PHAMVI_ID) as PHAMVI_ID, tk.NGUONDUOC_ID, nh.TENNGUONDUOC, nh.TINHTIEN, d.DUOC_ID, ld.MALOAIDUOC,        d.SOVISA,d.TYLE_VAT,d.COTOA, d.MADUOC, d.TENHANG, d.TENDUOCDAYDU, dvt.TENDONVITINH as DONVITINH, d.BHYT,        d.TENHOATCHAT, d.HAMLUONG, d.HANGSANXUAT, d.QUOCGIA, d.LOAIDUOC_ID, d.DUONGDUNG_ID, d.TINHTIEN_PTTT,        ten.TENDUOC, ten.TENDUOC_EN, ten.MAQUOCTE, ten.MAQUOCTEBT,        CASE WHEN d.BHYT = '1' THEN 'BHYT' ELSE '' END as BHYT_TEXT        , ld.LOAIVATTU_ID        , d.BENHVIEN_ID,        tk.SOLUONG, d.VTYT_PHANLOAI, d.PHAMVI, d.SUASOLUONGTONGHOP, d.MADUOCBV, d.DANGTRINHBAY        , TAMNGUNG = CASE WHEN d.TAMNGUNG = '1' OR nh.TAMNGUNG = '1' OR kd.TAMNGUNG = '1' THEN '1' ELSE '0' END        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        inner join        (        select  LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')) DUOC_KEY, (SUM(dtk.SOLUONG) - isnull(sum(A.SOLUONG),0) - isnull(sum(B.SOLUONG),0)) SOLUONG, pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        from (select sum(soluong) soluong,duoc_id,nguonduoc_id,khoduoc_id,benhvien_id from TT_DUOC_TONKHO  group by duoc_id,nguonduoc_id,khoduoc_id,benhvien_id) dtk        inner join TM_DUOC_PHAMVISD_MAPPING pvsd on dtk.KHODUOC_ID = pvsd.KHODUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NOITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) B on B.DUOC_ID = dtk.DUOC_ID and B.SOLUONG > 0 and B.PHAMVI_ID = pvsd.PHAMVI_ID and B.NGUONHANG_ID = dtk.NGUONDUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NGOAITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) A on A.DUOC_ID = dtk.DUOC_ID and A.SOLUONG > 0 and A.PHAMVI_ID = pvsd.PHAMVI_ID and A.NGUONHANG_ID = dtk.NGUONDUOC_ID        where dtk.SOLUONG > 0 and dtk.BENHVIEN_ID = 'HLU01'        group by LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')), pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        ) tk on tk.DUOC_ID = d.DUOC_ID        left join TM_DUOC_PHAMVISUDUNG kd on kd.PHAMVI_ID = tk.PHAMVI_ID and kd.BENHVIEN_ID = 'HLU01'        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = tk.NGUONDUOC_ID and nh.BENHVIEN_ID = 'HLU01'        where d.BENHVIEN_ID = 'HLU01'  and tk.SOLUONG >= 0         end                else        begin        select  distinct tk.DUOC_KEY, LTRIM(tk.PHAMVI_ID) as PHAMVI_ID, tk.NGUONDUOC_ID, nh.TENNGUONDUOC, nh.TINHTIEN, d.DUOC_ID, ld.MALOAIDUOC,        d.SOVISA,d.TYLE_VAT,d.COTOA, d.MADUOC, d.TENHANG, d.TENDUOCDAYDU, d.DONVITINH as DONVITINH, d.BHYT,        d.TENHOATCHAT, d.HAMLUONG, d.HANGSANXUAT, d.QUOCGIA, d.LOAIDUOC_ID, d.DUONGDUNG_ID, d.TINHTIEN_PTTT,        ten.TENDUOC, ten.TENDUOC_EN, ten.MAQUOCTE, ten.MAQUOCTEBT,        CASE WHEN d.BHYT = '1' THEN 'BHYT' ELSE '' END as BHYT_TEXT        , ld.LOAIVATTU_ID        , d.BENHVIEN_ID,        tk.SOLUONG, d.VTYT_PHANLOAI, d.PHAMVI, d.SUASOLUONGTONGHOP, d.MADUOCBV, d.DANGTRINHBAY        , TAMNGUNG = CASE WHEN d.TAMNGUNG = '1' OR nh.TAMNGUNG = '1' OR kd.TAMNGUNG = '1' THEN '1' ELSE '0' END        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        inner join        (        select  LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')) DUOC_KEY, (SUM(dtk.SOLUONG) - isnull(sum(A.SOLUONG),0) - isnull(sum(B.SOLUONG),0)) SOLUONG, pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        from (select sum(soluong) soluong,duoc_id,nguonduoc_id,khoduoc_id,benhvien_id from TT_DUOC_TONKHO  group by duoc_id,nguonduoc_id,khoduoc_id,benhvien_id) dtk        inner join TM_DUOC_PHAMVISD_MAPPING pvsd on dtk.KHODUOC_ID = pvsd.KHODUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NOITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) B on B.DUOC_ID = dtk.DUOC_ID and B.SOLUONG > 0 and B.PHAMVI_ID = pvsd.PHAMVI_ID and B.NGUONHANG_ID = dtk.NGUONDUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NGOAITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) A on A.DUOC_ID = dtk.DUOC_ID and A.SOLUONG > 0 and A.PHAMVI_ID = pvsd.PHAMVI_ID and A.NGUONHANG_ID = dtk.NGUONDUOC_ID        where dtk.SOLUONG > 0 and dtk.BENHVIEN_ID = 'HLU01'        group by LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')), pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        ) tk on tk.DUOC_ID = d.DUOC_ID        left join TM_DUOC_PHAMVISUDUNG kd on kd.PHAMVI_ID = tk.PHAMVI_ID and kd.BENHVIEN_ID = 'HLU01'        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = tk.NGUONDUOC_ID and nh.BENHVIEN_ID = 'HLU01'        where d.BENHVIEN_ID = 'HLU01'  and tk.SOLUONG >= 0        end]
2019-08-14 14:19:26,019 [5] DEBUG - Statement Id: [DAO00320_GetList] PreparedStatement : [select M.*            from TM_MAU M            LEFT JOIN TM_MAU_DONVITINH DVT on M.DONVITINH_ID=DVT.DONVITINH_ID            where            M.TAMNGUNG = '0'            and M.BENHVIEN_ID = 'HLU01'            order by M.TENMAU]
2019-08-14 14:19:26,094 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM071']
2019-08-14 14:19:26,152 [5] DEBUG - Statement Id: [DAO00322_GetListMauTonKhoForCreateCached] PreparedStatement : [SELECT DISTINCT          TK.MAU_KEY, TK.KHOMAU_ID, M.MAU_ID, M.MAMAU, M.TENMAU, M.NHOM_ABO, M.NHOM_RH, M.LOAIMAU_ID,          TK.SOLONHAP_ID, SLN.SOLONHAP, SLN.SOKIEMSOAT, TK.NGUONHANG_ID, NG.TENNGUONMAU, M.BENHVIEN_ID, M.DONVITINH_ID,          SUM(tk.SOLUONG) AS SOLUONG,K.TENKHO,DVT.TENDONVITINH          FROM TT_MAU_TONKHO TK          JOIN TM_KHO K ON TK.KHOMAU_ID = K.KHO_ID          JOIN TT_MAU_CHUNGTU_SOLONHAP SLN ON TK.SOLONHAP_ID = SLN.SOLONHAP_ID          JOIN TM_MAU M on TK.MAU_ID = M.MAU_ID and M.TAMNGUNG = '0'          LEFT JOIN TM_MAU_DONVITINH DVT on M.DONVITINH_ID=DVT.DONVITINH_ID          LEFT JOIN TM_NGUONMAU NG ON NG.NGUONMAU_ID = TK.NGUONHANG_ID          WHERE TK.SOLUONG > 0          GROUP BY TK.MAU_KEY, TK.KHOMAU_ID, M.MAU_ID, M.MAMAU, M.TENMAU, M.NHOM_ABO, M.NHOM_RH, M.LOAIMAU_ID,          TK.SOLONHAP_ID, SLN.SOLONHAP, SLN.SOKIEMSOAT,TK.NGUONHANG_ID, NG.TENNGUONMAU, M.BENHVIEN_ID, M.DONVITINH_ID,K.TENKHO,DVT.TENDONVITINH]
2019-08-14 14:19:26,237 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM073']
2019-08-14 14:19:26,280 [5] DEBUG - Statement Id: [DAO00322_GetListMauTonKhoTruBooking] PreparedStatement : [select distinct          TK.MAU_KEY, TK.KHOMAU_ID, M.MAU_ID, M.MAMAU, M.TENMAU, M.NHOM_ABO, M.NHOM_RH, M.LOAIMAU_ID, M.DONVITINH_ID,          TK.SOLONHAP_ID, TK.SOLONHAP, TK.SOKIEMSOAT,M.PHAMVI, TK.NGUONHANG_ID, NG.TENNGUONMAU, M.BENHVIEN_ID,          TK.SOLUONG,TK.TENKHO,DVT.TENDONVITINH          from TM_MAU M          JOIN          (          select          A.MAU_KEY, A.KHOMAU_ID, A.MAU_ID ,a.NGUONHANG_ID, A.SOLONHAP_ID, A.SOLONHAP, A.SOKIEMSOAT, A.SOLUONG,A.TENKHO          from          (          select KHOMAU_ID, TK.MAU_ID, TK.NGUONHANG_ID, TK.MAU_KEY, SLN.SOLONHAP_ID, SLN.SOLONHAP, SLN.SOKIEMSOAT, ISNULL(TK.SOLUONG,0) - ISNULL(book.SOLUONG,0) as SOLUONG,K.TENKHO          from TT_MAU_TONKHO TK          JOIN TM_KHO K ON TK.KHOMAU_ID = K.KHO_ID          inner join TT_MAU_CHUNGTU_SOLONHAP SLN ON TK.SOLONHAP_ID = SLN.SOLONHAP_ID          left join dbo.TT_MAU_TONKHO_BOOK book ON book.MAU_KEY = TK.MAU_KEY AND book.TRANGTHAI = 'HIEULUC'          where ISNULL(TK.SOLUONG,0) - ISNULL(book.SOLUONG,0) > 0          ) A          )TK on TK.MAU_ID = M.MAU_ID and M.TAMNGUNG = '0'          LEFT JOIN TM_MAU_DONVITINH DVT on M.DONVITINH_ID=DVT.DONVITINH_ID          LEFT JOIN TM_NGUONMAU NG ON NG.NGUONMAU_ID = TK.NGUONHANG_ID]
2019-08-14 14:19:26,355 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM072']
2019-08-14 14:19:27,326 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'MAIN'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2019-08-14 14:19:28,765 [1] DEBUG - Statement Id: [DAO00002_FormList] PreparedStatement : [select              TM_SYS_FORM.HOSPITAL_ID,              TM_SYS_FORM.NAME,              TM_SYS_FORM.CLASS,              TM_SYS_FORM.ASSEMBLY,              TM_SYS_FORM.TITLE_VI as TITLE              from TM_SYS_FORM              where HOSPITAL_ID = 'HLU01']
2019-08-14 14:19:34,926 [1] DEBUG - Statement Id: [DAO00300_GetShortcutListByUserID] PreparedStatement : [SELECT S.SHORTCUT_CODE, S.SHORTCUT_VALUE              FROM TM_SHORTCUT AS S              WHERE S.BENHVIEN_ID = 'HLU01' AND S.USER_ID = '1' AND TAMNGUNG = '0']
2019-08-14 14:19:35,019 [1] DEBUG - Statement Id: [DAO00087_GetList] PreparedStatement : [select CODE, VALUE, BENHVIEN_ID              from TM_SYS_APPSETTINGS              where LOCKED = '0' and BENHVIEN_ID = 'HLU01'              order by SETTING_ID]
2019-08-14 14:19:35,138 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'MSG01'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2019-08-14 14:19:35,323 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'MSG02'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2019-08-14 14:19:35,503 [1] DEBUG - Statement Id: [DAO00008_GetUserSettings] PreparedStatement : [select A.*, B.TENKHO , C.TENPHONGBAN, B.MAKHO, C.MAPHONGBAN          from TM_SYS_USERS A          left join TM_KHODUOC B on B.KHODUOC_ID = A.INVENTORY_ID          left join TM_PHONGBAN C on (C.PHONGBAN_ID = A.WORKING_DEPT_ID and C.BENHVIEN_ID =  @param0 )          left join TM_SYS_USERKHO D on (D.ACCOUNT_ID = A.ACCOUNT_ID and D.HOSPITAL_ID =  @param0 )          where          A.HOSPITAL_ID =  @param0            and                 A.ACCOUNT_ID =  @param1]
2019-08-14 14:19:35,505 [1] DEBUG - Statement Id: [DAO00008_GetUserSettings] Parameters: [@param0=[HOSPITAL_ID,HLU01], @param1=[ACCOUNT_ID,113]]
2019-08-14 14:19:35,505 [1] DEBUG - Statement Id: [DAO00008_GetUserSettings] Types: [@param0=[String, System.String], @param1=[String, System.String]]
2019-08-14 14:19:35,575 [1] DEBUG - Statement Id: [DAO00008_GetUserInvSettings] PreparedStatement : [select A.*, B.TENKHO, B.MAKHO, B.LOAIKHO_ID, B.KHOQUANLY_ID          from TM_SYS_USERKHO A          left join TM_KHO B on B.MODULE_ID = A.MODULE_ID and B.KHO_ID = A.KHO_ID          where A.HOSPITAL_ID =  @param0  and A.ACCOUNT_ID =  @param1           order by B.TENKHO]
2019-08-14 14:19:35,575 [1] DEBUG - Statement Id: [DAO00008_GetUserInvSettings] Parameters: [@param0=[HOSPITAL_ID,HLU01], @param1=[ACCOUNT_ID,113]]
2019-08-14 14:19:35,575 [1] DEBUG - Statement Id: [DAO00008_GetUserInvSettings] Types: [@param0=[String, System.String], @param1=[String, System.String]]
2019-08-14 14:19:35,790 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'COM30'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2019-08-14 14:19:36,000 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'RIS04'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2019-08-14 14:19:48,089 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'MENU1'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2019-08-14 14:19:48,569 [1] DEBUG - Statement Id: [DAO00011_GetList] PreparedStatement : [select              TM_SYS_MENU.ID,              TM_SYS_MENU.PARENTID,              TM_SYS_MENU.SCREEN,              TM_SYS_MENU.SMALLIMAGE,              TM_SYS_MENU.LARGEIMAGE,              TM_SYS_MENU.DESCRIPTION,              TM_SYS_MENU.TYPE,              TM_SYS_MENU.TITLE_VI as TITLE              from TM_SYS_MENU              where TM_SYS_MENU.HOSPITAL_ID = 'HLU01' and TM_SYS_MENU.ACTIVE = '1'               AND                   (TM_SYS_MENU.TYPE & '8' = '8')                             order by TM_SYS_MENU.ORDERNUM]
2019-08-14 14:19:48,987 [1] DEBUG - Statement Id: [DAO00011_usermenu_list] PreparedStatement : [select              TM_SYS_HOMEMENU.MENUID as ID,              TM_SYS_MENU.TITLE_VI as TITLE,              TM_SYS_MENU.SCREEN,              TM_SYS_MENU.SMALLIMAGE,              TM_SYS_MENU.LARGEIMAGE,              TM_SYS_MENU.TYPE              from TM_SYS_HOMEMENU              left join TM_SYS_MENU on TM_SYS_MENU.ID = TM_SYS_HOMEMENU.MENUID and TM_SYS_MENU.HOSPITAL_ID = TM_SYS_HOMEMENU.HOSPITAL_ID              where TM_SYS_HOMEMENU.HOSPITAL_ID = 'HLU01' and TM_SYS_HOMEMENU.USERID = '113' and TM_SYS_MENU.ACTIVE = '1'               AND                   (TM_SYS_MENU.TYPE & '8' = '8')                             ORDER BY TM_SYS_HOMEMENU.ORDERNUM]
2019-08-14 14:20:25,516 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'EMR04'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2019-08-14 14:20:26,100 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'EMR05'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2019-08-14 14:20:27,127 [1] DEBUG - Statement Id: [DAO00045_GetList] PreparedStatement : [SELECT            TM_DICHVU.DICHVU_ID, TM_NHOMDICHVU.NHOMDICHVU_ID, TM_NHOMDICHVU.MANHOMDICHVU, TM_DICHVU.MADICHVU, TM_NHOMDICHVU.TENNHOMDICHVU,            TM_NHOMDICHVU.TENNHOMDICHVU_EN, TM_NHOMDICHVU.TENNHOMDICHVU_RU, TM_NHOMDICHVU.CAP, TM_NHOMDICHVU.CAPTREN_ID, TM_DICHVU.TENDICHVU,            TM_DICHVU.BENHVIEN_ID, TM_DICHVU.CHONHETCAPDUOI, TM_DICHVU.CAPTREN_ID AS DICHVU_CAPTREN_ID            FROM            TM_DICHVU            INNER JOIN            TM_NHOMDICHVU ON TM_DICHVU.NHOMDICHVU_ID = TM_NHOMDICHVU.NHOMDICHVU_ID AND TM_DICHVU.BENHVIEN_ID = TM_NHOMDICHVU.BENHVIEN_ID            where left(MANHOMDICHVU,2) in (01)            and TM_DICHVU.BENHVIEN_ID = 'HLU01']
2019-08-14 14:20:28,125 [1] DEBUG - Statement Id: [DAO00013_GetTTBenhNhanByMaYTe] PreparedStatement : [select *              from TT_BENHNHAN              where MAYTE  = '']
2019-08-14 14:20:28,569 [1] DEBUG - Statement Id: [DAO00014_GetTTinKhamBenhByBenhNhanID] PreparedStatement : [select *        from TT_NGOAITRU_KHAMBENH        where BENHNHAN_ID  =  @param0         and BENHVIEN_ID = 'HLU01'                    and NGAYKHAM >= '2/14/2019 12:00:00 AM'                  and NGAYKHAM <= '8/14/2019 12:00:00 AM'               order by THOIGIANKHAM desc]
2019-08-14 14:20:28,569 [1] DEBUG - Statement Id: [DAO00014_GetTTinKhamBenhByBenhNhanID] Parameters: [@param0=[BENHNHAN_ID,null]]
2019-08-14 14:20:28,569 [1] DEBUG - Statement Id: [DAO00014_GetTTinKhamBenhByBenhNhanID] Types: [@param0=[System.DBNull, null]]
2019-08-14 14:20:28,720 [1] DEBUG - Statement Id: [DAO00013_GetTTBenhNhanByMaYTe] PreparedStatement : [select *              from TT_BENHNHAN              where MAYTE  = '']
2019-08-14 14:20:28,777 [1] DEBUG - Statement Id: [DAO00014_GetTTinKhamBenhByBenhNhanID] PreparedStatement : [select *        from TT_NGOAITRU_KHAMBENH        where BENHNHAN_ID  =  @param0         and BENHVIEN_ID = 'HLU01'                    and NGAYKHAM >= '2/14/2019 12:00:00 AM'                  and NGAYKHAM <= '8/14/2019 12:00:00 AM'               order by THOIGIANKHAM desc]
2019-08-14 14:20:28,777 [1] DEBUG - Statement Id: [DAO00014_GetTTinKhamBenhByBenhNhanID] Parameters: [@param0=[BENHNHAN_ID,null]]
2019-08-14 14:20:28,777 [1] DEBUG - Statement Id: [DAO00014_GetTTinKhamBenhByBenhNhanID] Types: [@param0=[System.DBNull, null]]
2019-08-14 14:20:29,598 [1] DEBUG - Statement Id: [DAO00013_GetTTBenhNhanByMaYTe] PreparedStatement : [select *              from TT_BENHNHAN              where MAYTE  = '']
2019-08-14 14:20:29,656 [1] DEBUG - Statement Id: [DAO00014_GetTTinKhamBenhByBenhNhanID] PreparedStatement : [select *        from TT_NGOAITRU_KHAMBENH        where BENHNHAN_ID  =  @param0         and BENHVIEN_ID = 'HLU01'                    and NGAYKHAM >= '2/14/2019 12:00:00 AM'                  and NGAYKHAM <= '8/14/2019 12:00:00 AM'               order by THOIGIANKHAM desc]
2019-08-14 14:20:29,656 [1] DEBUG - Statement Id: [DAO00014_GetTTinKhamBenhByBenhNhanID] Parameters: [@param0=[BENHNHAN_ID,null]]
2019-08-14 14:20:29,656 [1] DEBUG - Statement Id: [DAO00014_GetTTinKhamBenhByBenhNhanID] Types: [@param0=[System.DBNull, null]]
2019-08-14 14:20:33,027 [1] DEBUG - Statement Id: [DAO00013_GetTTBenhNhanByMaYTe] PreparedStatement : [select *              from TT_BENHNHAN              where MAYTE  = '190043296']
2019-08-14 14:20:33,090 [1] DEBUG - Statement Id: [DAO00014_GetTTinKhamBenhByBenhNhanID] PreparedStatement : [select *        from TT_NGOAITRU_KHAMBENH        where BENHNHAN_ID  =  @param0         and BENHVIEN_ID = 'HLU01'                    and NGAYKHAM >= '2/14/2019 12:00:00 AM'                  and NGAYKHAM <= '8/14/2019 12:00:00 AM'               order by THOIGIANKHAM desc]
2019-08-14 14:20:33,090 [1] DEBUG - Statement Id: [DAO00014_GetTTinKhamBenhByBenhNhanID] Parameters: [@param0=[BENHNHAN_ID,23414]]
2019-08-14 14:20:33,090 [1] DEBUG - Statement Id: [DAO00014_GetTTinKhamBenhByBenhNhanID] Types: [@param0=[Int64, System.Int64]]
2019-08-14 14:20:38,317 [1] DEBUG - Statement Id: [DAO00013_GetTTBenhNhanByMaYTe] PreparedStatement : [select *              from TT_BENHNHAN              where MAYTE  = '']
2019-08-14 14:20:38,394 [1] DEBUG - Statement Id: [DAO00014_GetTTinKhamBenhByBenhNhanID] PreparedStatement : [select *        from TT_NGOAITRU_KHAMBENH        where BENHNHAN_ID  =  @param0         and BENHVIEN_ID = 'HLU01'                    and NGAYKHAM >= '2/14/2019 12:00:00 AM'                  and NGAYKHAM <= '8/14/2019 12:00:00 AM'               order by THOIGIANKHAM desc]
2019-08-14 14:20:38,394 [1] DEBUG - Statement Id: [DAO00014_GetTTinKhamBenhByBenhNhanID] Parameters: [@param0=[BENHNHAN_ID,null]]
2019-08-14 14:20:38,394 [1] DEBUG - Statement Id: [DAO00014_GetTTinKhamBenhByBenhNhanID] Types: [@param0=[System.DBNull, null]]
2019-08-14 14:20:46,724 [1] DEBUG - Statement Id: [DAO00013_GetTTBenhNhanByMaYTe] PreparedStatement : [select *              from TT_BENHNHAN              where MAYTE  = '190043299']
2019-08-14 14:20:46,808 [1] DEBUG - Statement Id: [DAO00014_GetTTinKhamBenhByBenhNhanID] PreparedStatement : [select *        from TT_NGOAITRU_KHAMBENH        where BENHNHAN_ID  =  @param0         and BENHVIEN_ID = 'HLU01'                    and NGAYKHAM >= '2/14/2019 12:00:00 AM'                  and NGAYKHAM <= '8/14/2019 12:00:00 AM'               order by THOIGIANKHAM desc]
2019-08-14 14:20:46,808 [1] DEBUG - Statement Id: [DAO00014_GetTTinKhamBenhByBenhNhanID] Parameters: [@param0=[BENHNHAN_ID,23418]]
2019-08-14 14:20:46,808 [1] DEBUG - Statement Id: [DAO00014_GetTTinKhamBenhByBenhNhanID] Types: [@param0=[Int64, System.Int64]]
2019-08-14 14:20:54,841 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'OPD02'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2019-08-14 14:20:56,128 [1] DEBUG - Statement Id: [DAO00017_GetLoaiGiaByDoiTuongId] PreparedStatement : [select dtlg.DOUUTIEN, dtlg.DOITUONG_ID, lg.LOAIGIA_ID, lg.TENLOAIGIA, lg.MALOAIGIA              from TM_LOAIGIA lg              left join TM_DOITUONG_LOAIGIA dtlg              on lg.LOAIGIA_ID = dtlg.LOAIGIA_ID and dtlg.BENHVIEN_ID = 'HLU01'              where lg.TAMNGUNG = 0 and lg.BENHVIEN_ID = 'HLU01'                             order by dtlg.DOUUTIEN]
2019-08-14 14:20:56,365 [1] DEBUG - Statement Id: [DAO00092_GetList_ToathuocNgoaitru] PreparedStatement : [select A.*, B.PHAMVI_ID, C.KHODUOC_ID from TM_TOATHUOC_NGOAITRU A        left join TM_DUOC_PHAMVISUDUNG B on B.MAPHAMVI = A.MAPHAMVI        left join (select distinct PHAMVI_ID, KHODUOC_ID from TM_DUOC_PHAMVISD_MAPPING) C on C.PHAMVI_ID = B.PHAMVI_ID        where A.TAMNGUNG != '1' and A.BENHVIEN_ID = 'HLU01'        ORDER BY A.SAPXEP ASC]
2019-08-14 14:20:59,279 [1] DEBUG - Statement Id: [DAO00009_TT_TIEPNHAN_GetProcess] PreparedStatement : [select PROCESS_ID from TT_TIEPNHAN where SOTIEPNHAN = 'TN190426.0000334']
2019-08-14 14:20:59,448 [1] DEBUG - Statement Id: [DAOWF004_laytrangthaiDV] PreparedStatement : [select top 1 A.CURR_STATE_CODE as STATE_CODE, isNull(C.SHORT_NAME,C.NAME) as TRANGTHAI, C.NAME as TRANGTHAI_CHITIET, C.STATUS_CODE, D.ISACTIVE as ACTIVE, E.STATUS_CODE  as OLD_STATUSCODE        from TT_REQUEST_SERVICE_DETAIL A                left join (select * from TT_REQUEST_SERVICE where PARA = '{"DICHVU_ID":"5436","DVYEUCAU_ID":"89051"}') D on D.ID = A.REQUEST_SERVICE_ID        left join TM_STATE C on A.CURR_STATE_CODE = C.STATE_CODE and C.PROCESS_CODE = D.PROCESS_CODE        left join TM_STATE E on A.OLD_STATE_CODE = E.STATE_CODE and E.PROCESS_CODE = D.PROCESS_CODE        where        A.REQUEST_SERVICE_ID = (select top 1 ID from TT_REQUEST_SERVICE where PARA = '{"DICHVU_ID":"5436","DVYEUCAU_ID":"89051"}' order by ID desc)        order by A.ID desc]
2019-08-14 14:20:59,733 [1] DEBUG - Statement Id: [DAO00017_GetLoaiGiaByDoiTuongId] PreparedStatement : [select dtlg.DOUUTIEN, dtlg.DOITUONG_ID, lg.LOAIGIA_ID, lg.TENLOAIGIA, lg.MALOAIGIA              from TM_LOAIGIA lg              left join TM_DOITUONG_LOAIGIA dtlg              on lg.LOAIGIA_ID = dtlg.LOAIGIA_ID and dtlg.BENHVIEN_ID = 'HLU01'              where lg.TAMNGUNG = 0 and lg.BENHVIEN_ID = 'HLU01'                             order by dtlg.DOUUTIEN]
2019-08-14 14:20:59,806 [1] DEBUG - Statement Id: [DAO00087_GetServiceParams] PreparedStatement : [select CODE, VALUE              from TM_SYS_APPSETTINGS              where LOCKED = '0' and BENHVIEN_ID = 'HLU01']
2019-08-14 14:20:59,908 [1] DEBUG - Statement Id: [DAO00014_KiemTraDVYCCoBHYT] PreparedStatement : [select *        from TT_VIENPHI        where REF_ID  = '89051' and REF_TABLE = 'TT_DVYEUCAU' and BHYT_DONGIA > 0]
2019-08-14 14:21:00,099 [1] DEBUG - Statement Id: [DAO00040_LayListToaMau] PreparedStatement : [select A.*, dc.TENDUOCDAYDU, dc.BHYT DUOC_BHYT, ld.LOAIVATTU_ID, ld.MALOAIDUOC, dd.DICTIONARY_NAME DUONGDUNG, dc.TAMNGUNG            from TT_TOATHUOCMAU A            left join TM_DUOC dc on A.DUOC_ID = dc.DUOC_ID            left join TM_LOAIDUOC ld on dc.LOAIDUOC_ID = ld.LOAIDUOC_ID            left join (select * from LST_DICTIONARY where DICTIONARY_TYPE_CODE like 'DuongDung') dd on dd.DICTIONARY_ID = dc.DUONGDUNG_ID            where (1=1)             and               A.BACSI_ID  = 1              and A.LOAITOATHUOC in  (                        @param0                   ,                           @param1                   ,                           @param2                   ,                           @param3                   )]
2019-08-14 14:21:00,100 [1] DEBUG - Statement Id: [DAO00040_LayListToaMau] Parameters: [@param0=[LSTLOAITOATHUOC[0],BV], @param1=[LSTLOAITOATHUOC[1],MN], @param2=[LSTLOAITOATHUOC[2],MP], @param3=[LSTLOAITOATHUOC[3],TV]]
2019-08-14 14:21:00,100 [1] DEBUG - Statement Id: [DAO00040_LayListToaMau] Types: [@param0=[String, System.String], @param1=[String, System.String], @param2=[String, System.String], @param3=[String, System.String]]
2019-08-14 14:21:00,232 [1] DEBUG - Statement Id: [DAO00040_LayListToaMau] PreparedStatement : [select A.*, dc.TENDUOCDAYDU, dc.BHYT DUOC_BHYT, ld.LOAIVATTU_ID, ld.MALOAIDUOC, dd.DICTIONARY_NAME DUONGDUNG, dc.TAMNGUNG            from TT_TOATHUOCMAU A            left join TM_DUOC dc on A.DUOC_ID = dc.DUOC_ID            left join TM_LOAIDUOC ld on dc.LOAIDUOC_ID = ld.LOAIDUOC_ID            left join (select * from LST_DICTIONARY where DICTIONARY_TYPE_CODE like 'DuongDung') dd on dd.DICTIONARY_ID = dc.DUONGDUNG_ID            where (1=1)             and               A.BACSI_ID  = 1              and A.LOAITOATHUOC in  (                        @param0                   ,                           @param1                   ,                           @param2                   ,                           @param3                   )]
2019-08-14 14:21:00,233 [1] DEBUG - Statement Id: [DAO00040_LayListToaMau] Parameters: [@param0=[LSTLOAITOATHUOC[0],BV], @param1=[LSTLOAITOATHUOC[1],MN], @param2=[LSTLOAITOATHUOC[2],MP], @param3=[LSTLOAITOATHUOC[3],TV]]
2019-08-14 14:21:00,233 [1] DEBUG - Statement Id: [DAO00040_LayListToaMau] Types: [@param0=[String, System.String], @param1=[String, System.String], @param2=[String, System.String], @param3=[String, System.String]]
2019-08-14 14:21:00,289 [1] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoVaBookingCOM23UpdateRedis_TheoPhamvi] PreparedStatement : [select distinct tk.DUOC_KEY, tk.SOLUONG        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        inner join        (        select  LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')) DUOC_KEY, (SUM(dtk.SOLUONG) - isnull(sum(A.SOLUONG),0) - isnull(sum(B.SOLUONG),0)) SOLUONG, pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        from (select sum(soluong) soluong,duoc_id,nguonduoc_id,khoduoc_id,benhvien_id from TT_DUOC_TONKHO  group by duoc_id,nguonduoc_id,khoduoc_id,benhvien_id) dtk        inner join TM_DUOC_PHAMVISD_MAPPING pvsd on dtk.KHODUOC_ID = pvsd.KHODUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NOITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) B on B.DUOC_ID = dtk.DUOC_ID and B.SOLUONG > 0 and B.PHAMVI_ID = pvsd.PHAMVI_ID and B.NGUONHANG_ID = dtk.NGUONDUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NGOAITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) A on A.DUOC_ID = dtk.DUOC_ID and A.SOLUONG > 0 and A.PHAMVI_ID = pvsd.PHAMVI_ID and A.NGUONHANG_ID = dtk.NGUONDUOC_ID        where dtk.SOLUONG > 0 and dtk.BENHVIEN_ID = 'HLU01'        group by LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')), pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        ) tk on tk.DUOC_ID = d.DUOC_ID        left join TM_DUOC_PHAMVISUDUNG kd on kd.PHAMVI_ID = tk.PHAMVI_ID and kd.BENHVIEN_ID = 'HLU01'        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = tk.NGUONDUOC_ID and nh.BENHVIEN_ID = 'HLU01'        where  d.BENHVIEN_ID = 'HLU01' and tk.PHAMVI_ID =  @param0]
2019-08-14 14:21:00,289 [1] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoVaBookingCOM23UpdateRedis_TheoPhamvi] Parameters: [@param0=[PHAMVI_ID,1028]]
2019-08-14 14:21:00,289 [1] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoVaBookingCOM23UpdateRedis_TheoPhamvi] Types: [@param0=[Int64, System.Int64]]
2019-08-14 14:21:00,616 [1] DEBUG - Statement Id: [DAO00013_GetTienSuBenh] PreparedStatement : [select TIENSUBENH, TIENSUDIUNG              from TT_BENHNHAN              where TT_BENHNHAN.BENHNHAN_ID  = '7919']
2019-08-14 14:21:00,703 [1] DEBUG - Statement Id: [DAO00095_GetTTDiUngThuoc] PreparedStatement : [select *              from TT_BENHNHAN_DIUNG_THUOC              where BENHNHAN_ID = '7919'              and BENHVIEN_ID = 'HLU01']
2019-08-14 14:21:00,753 [1] DEBUG - Statement Id: [DAO00014_GetTotalChiPhiDVByTiepNhan] PreparedStatement : [select sum(THANHTIEN_DOANHTHU) as THANHTIEN_DOANHTHU from TT_VIENPHI        where ACTIVE = '1'        and TIEPNHAN_ID = '12426'        and REF_TABLE = 'TT_DVYEUCAU'        and exists (select DVYEUCAU_ID from TT_DVYEUCAU where HUYYEUCAU = '0' and TIEPNHAN_ID = '12426' and TT_VIENPHI.REF_ID = DVYEUCAU_ID)]
2019-08-14 14:21:00,839 [1] DEBUG - Statement Id: [DAO00014_GetKhamBenhInfo] PreparedStatement : [select * from TT_NGOAITRU_KHAMBENH where KHAMBENH_ID =        (select KHAMBENH_NGOAITRU_ID from TT_DVYEUCAU where DVYEUCAU_ID = '89051')]
2019-08-14 14:21:00,873 [1] DEBUG - Statement Id: [DAO00014_GetSoCaKhamTrongNgay] PreparedStatement : [select Count(KB.KHAMBENH_ID) as SOCAKHAMTRONGNGAY        from TT_NGOAITRU_KHAMBENH KB        inner join TT_TIEPNHAN TN on TN.TIEPNHAN_ID = KB.TIEPNHAN_ID        where KB.NGAYKHAM = convert(date, GETDATE())        and KB.BACSIKHAM_ID = '1'        and KB.BENHVIEN_ID = 'HLU01'        and TN.SOBHYT IS NOT NULL and TN.SOBHYT != '']
2019-08-14 14:21:01,032 [1] DEBUG - Statement Id: [DAO00068_GetLastedSinhHieuInfo] PreparedStatement : [select top (1) *, CHISOBMI as BMI              from TT_NGOAITRU_KHAMBENH_SINHHIEU              where BENHNHAN_ID = '7919'              order by KHAMBENH_SINHHIEU_ID desc]
2019-08-14 14:21:01,223 [1] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoVaBookingCOM23UpdateRedis_TheoPhamvi] PreparedStatement : [select distinct tk.DUOC_KEY, tk.SOLUONG        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        inner join        (        select  LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')) DUOC_KEY, (SUM(dtk.SOLUONG) - isnull(sum(A.SOLUONG),0) - isnull(sum(B.SOLUONG),0)) SOLUONG, pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        from (select sum(soluong) soluong,duoc_id,nguonduoc_id,khoduoc_id,benhvien_id from TT_DUOC_TONKHO  group by duoc_id,nguonduoc_id,khoduoc_id,benhvien_id) dtk        inner join TM_DUOC_PHAMVISD_MAPPING pvsd on dtk.KHODUOC_ID = pvsd.KHODUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NOITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) B on B.DUOC_ID = dtk.DUOC_ID and B.SOLUONG > 0 and B.PHAMVI_ID = pvsd.PHAMVI_ID and B.NGUONHANG_ID = dtk.NGUONDUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NGOAITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) A on A.DUOC_ID = dtk.DUOC_ID and A.SOLUONG > 0 and A.PHAMVI_ID = pvsd.PHAMVI_ID and A.NGUONHANG_ID = dtk.NGUONDUOC_ID        where dtk.SOLUONG > 0 and dtk.BENHVIEN_ID = 'HLU01'        group by LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')), pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        ) tk on tk.DUOC_ID = d.DUOC_ID        left join TM_DUOC_PHAMVISUDUNG kd on kd.PHAMVI_ID = tk.PHAMVI_ID and kd.BENHVIEN_ID = 'HLU01'        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = tk.NGUONDUOC_ID and nh.BENHVIEN_ID = 'HLU01'        where  d.BENHVIEN_ID = 'HLU01' and tk.PHAMVI_ID =  @param0]
2019-08-14 14:21:01,223 [1] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoVaBookingCOM23UpdateRedis_TheoPhamvi] Parameters: [@param0=[PHAMVI_ID,1028]]
2019-08-14 14:21:01,224 [1] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoVaBookingCOM23UpdateRedis_TheoPhamvi] Types: [@param0=[Int64, System.Int64]]
2019-08-14 14:21:07,313 [1] DEBUG - Statement Id: [DAO00013_GetTTBenhNhanByMaYTe] PreparedStatement : [select *              from TT_BENHNHAN              where MAYTE  = '190027867']
2019-08-14 14:21:07,395 [1] DEBUG - Statement Id: [DAO00014_GetTTinKhamBenhByBenhNhanID] PreparedStatement : [select *        from TT_NGOAITRU_KHAMBENH        where BENHNHAN_ID  =  @param0         and BENHVIEN_ID = 'HLU01'                    and NGAYKHAM >= '2/14/2019 12:00:00 AM'                  and NGAYKHAM <= '8/14/2019 12:00:00 AM'               order by THOIGIANKHAM desc]
2019-08-14 14:21:07,395 [1] DEBUG - Statement Id: [DAO00014_GetTTinKhamBenhByBenhNhanID] Parameters: [@param0=[BENHNHAN_ID,7919]]
2019-08-14 14:21:07,395 [1] DEBUG - Statement Id: [DAO00014_GetTTinKhamBenhByBenhNhanID] Types: [@param0=[Int64, System.Int64]]
2019-08-14 14:21:07,579 [1] DEBUG - Statement Id: [DAO00194_GetList] PreparedStatement : [select A.* from TM_PHONGBAN A        inner join LST_DICTIONARY B on A.LOAIPHONGBAN_ID = B.DICTIONARY_ID        and B.DICTIONARY_TYPE_CODE = 'LoaiPhongBan' and B.DICTIONARY_CODE not in ('PhongMo','PhongBenh')        where A.BENHVIEN_ID = 'HLU01' order by A.TENPHONGBAN asc]
2019-08-14 14:25:24,643 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'EMR06'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2019-08-14 14:25:25,095 [1] DEBUG - Statement Id: [DAO00068_GetDSSinhHieuByBenhNhanID] PreparedStatement : [select *              from TT_NGOAITRU_KHAMBENH_SINHHIEU              where BENHNHAN_ID = '7919'              and BENHVIEN_ID = 'HLU01'               and                   NGAYDO >= '2/14/2019 12:00:00 AM'               and                   NGAYDO <= '8/14/2019 12:00:00 AM'                             order by THOIGIANDO desc]
2019-08-14 14:25:25,195 [1] DEBUG - Statement Id: [DAO00068_GetDSSinhHieuByBenhNhanID] PreparedStatement : [select *              from TT_NGOAITRU_KHAMBENH_SINHHIEU              where BENHNHAN_ID = '7919'              and BENHVIEN_ID = 'HLU01'               and                   NGAYDO >= '2/14/2019 12:00:00 AM'               and                   NGAYDO <= '8/14/2019 12:00:00 AM'                             order by THOIGIANDO desc]
2019-08-14 14:25:25,231 [1] DEBUG - Statement Id: [DAO00068_GetDSSinhHieuByBenhNhanID] PreparedStatement : [select *              from TT_NGOAITRU_KHAMBENH_SINHHIEU              where BENHNHAN_ID = '7919'              and BENHVIEN_ID = 'HLU01'               and                   NGAYDO >= '2/14/2019 12:00:00 AM'               and                   NGAYDO <= '8/14/2019 12:00:00 AM'                             order by THOIGIANDO desc]
2019-08-14 14:25:26,953 [1] DEBUG - Statement Id: [DAO00013_GetTTBenhNhanByMaYTe] PreparedStatement : [select *              from TT_BENHNHAN              where MAYTE  = '190027867']
2019-08-14 14:25:27,006 [1] DEBUG - Statement Id: [DAO00014_GetTTinKhamBenhByBenhNhanID] PreparedStatement : [select *        from TT_NGOAITRU_KHAMBENH        where BENHNHAN_ID  =  @param0         and BENHVIEN_ID = 'HLU01'                    and NGAYKHAM >= '2/14/2019 12:00:00 AM'                  and NGAYKHAM <= '8/14/2019 12:00:00 AM'               order by THOIGIANKHAM desc]
2019-08-14 14:25:27,006 [1] DEBUG - Statement Id: [DAO00014_GetTTinKhamBenhByBenhNhanID] Parameters: [@param0=[BENHNHAN_ID,7919]]
2019-08-14 14:25:27,006 [1] DEBUG - Statement Id: [DAO00014_GetTTinKhamBenhByBenhNhanID] Types: [@param0=[Int64, System.Int64]]
2019-08-14 14:25:39,511 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'EMR12'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2019-08-14 14:25:39,964 [1] DEBUG - Statement Id: [DAO00061_GetDSBenhAnByBenhNhanID] PreparedStatement : [select ntba.*        ,case        when SOBENHAN like '%/CC' then icd_cc.MAICD        else icd_nt.MAICD + COALESCE(';' + ICD_BENHPHU,'')        end as MAICD        , case        when SOBENHAN like '%/CC' then icd_cc.TENICD + COALESCE( '; ' + CHANDOANRAVIEN, '')        else icd_nt.TENICD + COALESCE('; ' + CHANDOANRAVIEN,'') + (select '; ' + TENICD from [dbo].[SplitString](ICD_BENHPHU,';') as a        left join TM_ICD icd_p on a.s=icd_p.MAICD        group by TENICD        FOR XML PATH ('')        )        end as CHANDOAN        , lt.SOLUUTRU as SOLUUTRU_BGA        from TT_NOITRU_BENHAN ntba        left join TM_ICD icd_nt on ntba.ICD_BENHCHINH = icd_nt.ICD_ID        left join TM_ICD icd_cc on ntba.ICD_KHAMBENH = icd_cc.ICD_ID        left join TT_BENHAN_LUUTRU lt on lt.BENHAN_ID = ntba.BENHAN_ID        where BENHNHAN_ID = '7919'        and ntba.BENHVIEN_ID = 'HLU01'         and           convert(date, ntba.NGAYTAO) >= convert(date, '2/14/2019 12:00:00 AM')         and           convert(date, ntba.NGAYTAO) <= convert(date, '8/14/2019 12:00:00 AM')                 order by BENHAN_ID desc]
2019-08-14 14:28:50,690 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'EMR09'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2019-08-14 14:28:51,104 [1] DEBUG - Statement Id: [DAO00046_GetDSKQPTTTByBenhNhanID] PreparedStatement : [select ptyc.*, pt.MOTA, pt.TIEPNHAN_ID, pt.NGUOITAO_ID as BACSITHUCHIEN_ID, pt.PHONGBANTHUCHIEN_ID as NOITHUCHIEN_ID, pt.NGAYTHUCHIEN as THOIGIANTHUCHIEN, pt.LOAIPHAUTHUAT, ba.SOBENHAN        from TT_PHAUTHUAT_YEUCAU as ptyc        left join TT_PHAUTHUAT as pt on pt.PHAUTHUAT_ID = ptyc.PHAUTHUAT_ID        left join TT_NOITRU_BENHAN ba on pt.BENHAN_ID = ba.BENHAN_ID        where ptyc.DVYEUCAU_ID in        (select DVYEUCAU_ID from TT_DVYEUCAU where BENHNHAN_ID = '7919')                    and pt.NGAYTHUCHIEN >= '2/14/2019 12:00:00 AM'                    and pt.NGAYTHUCHIEN <= '8/14/2019 12:00:00 AM']
2019-08-14 14:29:00,919 [1] DEBUG - Statement Id: [DAO00046_GetDSKQPTTTByBenhNhanID] PreparedStatement : [select ptyc.*, pt.MOTA, pt.TIEPNHAN_ID, pt.NGUOITAO_ID as BACSITHUCHIEN_ID, pt.PHONGBANTHUCHIEN_ID as NOITHUCHIEN_ID, pt.NGAYTHUCHIEN as THOIGIANTHUCHIEN, pt.LOAIPHAUTHUAT, ba.SOBENHAN        from TT_PHAUTHUAT_YEUCAU as ptyc        left join TT_PHAUTHUAT as pt on pt.PHAUTHUAT_ID = ptyc.PHAUTHUAT_ID        left join TT_NOITRU_BENHAN ba on pt.BENHAN_ID = ba.BENHAN_ID        where ptyc.DVYEUCAU_ID in        (select DVYEUCAU_ID from TT_DVYEUCAU where BENHNHAN_ID = '7919')                    and pt.NGAYTHUCHIEN >= '10/1/2018 12:00:00 AM'                    and pt.NGAYTHUCHIEN <= '8/14/2019 12:00:00 AM']
--------------------------------------------------------------------------------
2019-08-14 17:38:16,672 [1] DEBUG - Statement Id: [DAO00001_DBList] PreparedStatement : [select *              from TM_SYS_SERVER              where HOSPITAL_ID = '_SYSTEM_' and TYPE = 'D']
2019-08-14 17:38:16,909 [1] DEBUG - Statement Id: [DAO00001_DaoList] PreparedStatement : [select              TM_SYS_SERVICEMAP.ID,              TM_SYS_SERVICEMAP.HOSPITAL_ID,              TM_SYS_SERVICEMAP.DB_NAME,              TM_SYS_SERVICEMAP.TYPE,              TM_SYS_SERVICEMAP.NAME,              TM_SYS_SERVICEMAP.CLASS,              (TM_SYS_DIC.VALUE + '.' + TM_SYS_SERVICEMAP.CLASS) as CLASSFULL,              TM_SYS_SERVICEMAP.ASSEMBLY              from TM_SYS_SERVICEMAP              inner join TM_SYS_DIC              on TM_SYS_SERVICEMAP.NAMESPACE = TM_SYS_DIC.ID              where HOSPITAL_ID = '_SYSTEM_' AND TYPE = 'D' AND ACTIVE = '1'              order by DB_NAME]
2019-08-14 17:38:16,946 [1] DEBUG - Statement Id: [DAO00001_ServiceList] PreparedStatement : [select              TM_SYS_SERVICEMAP.ID,              TM_SYS_SERVICEMAP.HOSPITAL_ID,              TM_SYS_SERVICEMAP.DB_NAME,              TM_SYS_SERVICEMAP.TYPE,              TM_SYS_SERVICEMAP.NAME,              TM_SYS_SERVICEMAP.CLASS,              (TM_SYS_DIC.VALUE + '.' + TM_SYS_SERVICEMAP.CLASS) as CLASSFULL,              TM_SYS_SERVICEMAP.ASSEMBLY,              TM_SYS_SERVER.URL              from TM_SYS_SERVICEMAP              inner join TM_SYS_DIC on TM_SYS_SERVICEMAP.NAMESPACE = TM_SYS_DIC.ID              inner join TM_SYS_SERVER on (TM_SYS_SERVICEMAP.DB_NAME = TM_SYS_SERVER.NAME) and (TM_SYS_SERVER.HOSPITAL_ID = '_SYSTEM_')              where TM_SYS_SERVICEMAP.HOSPITAL_ID = '_SYSTEM_' AND TM_SYS_SERVICEMAP.TYPE = 'S'  AND ACTIVE = '1'              order by URL]
2019-08-14 17:38:17,363 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = '_SYSTEM_'               AND                   TM_SYS_SCREEN.PAGE = 'LOGIN'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2019-08-14 17:38:17,634 [1] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = '_SYSTEM_'               AND                   TM_SYS_CACHE.ACTIVE = '1']
2019-08-14 17:41:52,547 [1] DEBUG - Statement Id: [DAO00001_DBList] PreparedStatement : [select *              from TM_SYS_SERVER              where HOSPITAL_ID = 'HLU01' and TYPE = 'D']
2019-08-14 17:41:52,577 [1] DEBUG - Statement Id: [DAO00001_DaoList] PreparedStatement : [select              TM_SYS_SERVICEMAP.ID,              TM_SYS_SERVICEMAP.HOSPITAL_ID,              TM_SYS_SERVICEMAP.DB_NAME,              TM_SYS_SERVICEMAP.TYPE,              TM_SYS_SERVICEMAP.NAME,              TM_SYS_SERVICEMAP.CLASS,              (TM_SYS_DIC.VALUE + '.' + TM_SYS_SERVICEMAP.CLASS) as CLASSFULL,              TM_SYS_SERVICEMAP.ASSEMBLY              from TM_SYS_SERVICEMAP              inner join TM_SYS_DIC              on TM_SYS_SERVICEMAP.NAMESPACE = TM_SYS_DIC.ID              where HOSPITAL_ID = 'HLU01' AND TYPE = 'D' AND ACTIVE = '1'              order by DB_NAME]
2019-08-14 17:41:54,210 [1] DEBUG - Statement Id: [DAO00001_ServiceList] PreparedStatement : [select              TM_SYS_SERVICEMAP.ID,              TM_SYS_SERVICEMAP.HOSPITAL_ID,              TM_SYS_SERVICEMAP.DB_NAME,              TM_SYS_SERVICEMAP.TYPE,              TM_SYS_SERVICEMAP.NAME,              TM_SYS_SERVICEMAP.CLASS,              (TM_SYS_DIC.VALUE + '.' + TM_SYS_SERVICEMAP.CLASS) as CLASSFULL,              TM_SYS_SERVICEMAP.ASSEMBLY,              TM_SYS_SERVER.URL              from TM_SYS_SERVICEMAP              inner join TM_SYS_DIC on TM_SYS_SERVICEMAP.NAMESPACE = TM_SYS_DIC.ID              inner join TM_SYS_SERVER on (TM_SYS_SERVICEMAP.DB_NAME = TM_SYS_SERVER.NAME) and (TM_SYS_SERVER.HOSPITAL_ID = 'HLU01')              where TM_SYS_SERVICEMAP.HOSPITAL_ID = 'HLU01' AND TM_SYS_SERVICEMAP.TYPE = 'S'  AND ACTIVE = '1'              order by URL]
2019-08-14 17:41:54,295 [6] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1']
2019-08-14 17:41:55,205 [6] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM005']
2019-08-14 17:41:55,379 [6] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM015']
2019-08-14 17:41:55,465 [6] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM067']
2019-08-14 17:41:55,582 [6] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM008']
2019-08-14 17:41:55,673 [6] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM068']
2019-08-14 17:41:55,762 [6] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM006']
2019-08-14 17:41:55,838 [6] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM030']
2019-08-14 17:41:55,910 [6] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM025']
2019-08-14 17:41:55,985 [6] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM024']
2019-08-14 17:41:56,500 [6] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM033']
2019-08-14 17:41:56,558 [6] DEBUG - Statement Id: [DAO00027_GetListDuocKyGuiTonKho] PreparedStatement : [select  distinct TT_TONKHO.DUOC_KEY, LTRIM(TT_TONKHO.KHODUOC_ID) as KHODUOC_ID, TM_DUOC.DUOC_ID, TM_LOAIDUOC.MALOAIDUOC,TM_DUOC.SOVISA,TM_DUOC.TYLE_VAT,TM_DUOC.COTOA,        TM_DUOC.MADUOC, TM_DUOC.TENHANG, TM_DUOC.TENDUOCDAYDU, dvt.TENDONVITINH as DONVITINH,  TM_DUOC.DONVITINH_ID,TM_DUOC.BHYT,TM_DUOC.PHAMVI,        TM_DUOC.TENHOATCHAT, TM_DUOC.HAMLUONG, TM_DUOC.HANGSANXUAT, TM_DUOC.QUOCGIA, TM_DUOC.LOAIDUOC_ID, TM_DUOC.DUONGDUNG_ID,        TM_TENDUOC.TENDUOC, TM_TENDUOC.TENDUOC_EN, TM_TENDUOC.MAQUOCTE, TM_TENDUOC.MAQUOCTEBT,        TM_LOAIDUOC.LOAIVATTU_ID, TM_DUOC.BENHVIEN_ID,TT_TONKHO.SOLUONG, TT_TONKHO.NGUONDUOC_ID, NH.TENNGUONDUOC        , TAMNGUNG = CASE WHEN TM_DUOC.TAMNGUNG = '1' OR nh.TAMNGUNG = '1' OR KD.TAMNGUNG = '1' THEN '1' ELSE '0' END        , TM_DUOC.DANGTRINHBAY        from TM_DUOC        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = TM_DUOC.DONVITINH_ID        left join TM_TENDUOC on TM_DUOC.TENDUOC_ID = TM_TENDUOC.TENDUOC_ID and TM_DUOC.BENHVIEN_ID = 'HLU01' and TM_DUOC.TAMNGUNG = '0'        left join TM_LOAIDUOC on TM_LOAIDUOC.LOAIDUOC_ID = TM_DUOC.LOAIDUOC_ID and TM_LOAIDUOC.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG on (TM_LOAIDUOC.LOAIVATTU_ID = TM_DUOC_HANDUNG.LOAIDUOC and TM_DUOC_HANDUNG.BENHVIEN_ID = 'HLU01')        inner join        (select LTRIM(A.KHODUOC_ID) + '_' + LTRIM(A.DUOC_ID) + '_' + LTRIM(ISNULL(A.NGUONDUOC_ID,'')) as DUOC_KEY, A.KHODUOC_ID, A.DUOC_ID,A.NGUONDUOC_ID,        SUM(isnull(A.SOLUONG,0)) as SOLUONG        from        (select SUM(SOLUONG) as SOLUONG, KHODUOC_ID, DUOC_ID, NGUONDUOC_ID from TT_DUOC_KYGUI_TONKHO        where BENHVIEN_ID = 'HLU01' group by KHODUOC_ID, DUOC_ID, NGUONDUOC_ID) A        group by LTRIM(A.KHODUOC_ID) + '_' + LTRIM(A.DUOC_ID) + '_' + LTRIM(A.NGUONDUOC_ID), A.KHODUOC_ID, A.DUOC_ID, A.NGUONDUOC_ID)        TT_TONKHO on TT_TONKHO.DUOC_ID = TM_DUOC.DUOC_ID        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = TT_TONKHO.NGUONDUOC_ID and nh.BENHVIEN_ID = 'HLU01'        LEFT JOIN TM_KHODUOC KD ON KD.KHODUOC_ID = TT_TONKHO.KHODUOC_ID        where TM_DUOC.BENHVIEN_ID = 'HLU01' AND TT_TONKHO.SOLUONG >= 0]
2019-08-14 17:41:56,634 [6] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM018']
2019-08-14 17:41:56,671 [6] DEBUG - Statement Id: [DAO00027_GetListDuocTonKho] PreparedStatement : [select distinct TT_TONKHO.DUOC_KEY, LTRIM(TT_TONKHO.KHODUOC_ID) as KHODUOC_ID, TM_DUOC.DUOC_ID, TM_LOAIDUOC.MALOAIDUOC,TM_DUOC.SOVISA,TM_DUOC.TYLE_VAT,TM_DUOC.COTOA,        TM_DUOC.MADUOC, TM_DUOC.TENHANG, TM_DUOC.TENDUOCDAYDU, dvt.TENDONVITINH as DONVITINH,  TM_DUOC.DONVITINH_ID,TM_DUOC.BHYT,                TM_DUOC.TENHOATCHAT,          TM_DUOC.HAMLUONG, TM_DUOC.HANGSANXUAT, TM_DUOC.QUOCGIA, TM_DUOC.LOAIDUOC_ID, TM_DUOC.DUONGDUNG_ID,        TM_TENDUOC.TENDUOC, TM_TENDUOC.TENDUOC_EN, TM_TENDUOC.MAQUOCTE, TM_TENDUOC.MAQUOCTEBT,        TM_LOAIDUOC.LOAIVATTU_ID, TM_DUOC.BENHVIEN_ID,        TT_TONKHO.SOLUONG, TM_DUOC.VTYT_PHANLOAI, TM_DUOC.PHAMVI, TT_TONKHO.NGUONDUOC_ID, NG.TENNGUONDUOC AS TENNGUONDUOC        , TAMNGUNG = CASE WHEN TM_DUOC.TAMNGUNG = '1' OR NG.TAMNGUNG = '1' OR KD.TAMNGUNG = '1' THEN '1' ELSE '0' END        , TM_DUOC.DANGTRINHBAY        from TM_DUOC        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = TM_DUOC.DONVITINH_ID        left join TM_TENDUOC on TM_DUOC.TENDUOC_ID = TM_TENDUOC.TENDUOC_ID and TM_DUOC.BENHVIEN_ID = 'HLU01' and TM_DUOC.TAMNGUNG = '0'        left join TM_LOAIDUOC on TM_LOAIDUOC.LOAIDUOC_ID = TM_DUOC.LOAIDUOC_ID and TM_LOAIDUOC.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG on (TM_LOAIDUOC.LOAIVATTU_ID = TM_DUOC_HANDUNG.LOAIDUOC and TM_DUOC_HANDUNG.BENHVIEN_ID = 'HLU01')        inner join        (select LTRIM(A.KHODUOC_ID) + '_' + LTRIM(A.DUOC_ID) + '_' + LTRIM(ISNULL(A.NGUONDUOC_ID,'')) as DUOC_KEY, A.KHODUOC_ID, A.DUOC_ID, A.NGUONDUOC_ID,        SUM(isnull(A.SOLUONG,0)) as SOLUONG        from        (select SUM(SOLUONG) as SOLUONG, KHODUOC_ID, DUOC_ID, NGUONDUOC_ID from TT_DUOC_TONKHO        where BENHVIEN_ID = 'HLU01' group by KHODUOC_ID, DUOC_ID, NGUONDUOC_ID) A        group by LTRIM(A.KHODUOC_ID) + '_' + LTRIM(A.DUOC_ID) + '_' + LTRIM(ISNULL(A.NGUONDUOC_ID,'')), A.KHODUOC_ID, A.DUOC_ID, NGUONDUOC_ID        ) TT_TONKHO on TT_TONKHO.DUOC_ID = TM_DUOC.DUOC_ID        LEFT JOIN TM_NGUONHANG NG ON NG.NGUONDUOC_ID = TT_TONKHO.NGUONDUOC_ID        LEFT JOIN TM_KHODUOC KD ON KD.KHODUOC_ID = TT_TONKHO.KHODUOC_ID        where TM_DUOC.BENHVIEN_ID = 'HLU01' and TT_TONKHO.SOLUONG >= 0]
2019-08-14 17:41:57,657 [6] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM023']
2019-08-14 17:41:57,690 [6] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoVaBooking] PreparedStatement : [declare @TOAMUANGOAI int = 0;        select @TOAMUANGOAI = isnull(VALUE,0) from TM_SYS_APPSETTINGS where CODE = 'OPD_TOAMUANGOAI_DUNGDANHMUC_DUOC'                if @TOAMUANGOAI = 1        begin        select  distinct '0' + '_' + LTRIM(d.DUOC_ID) + '_' + '0' as DUOC_KEY, 0 as PHAMVI_ID, 0 as NGUONDUOC_ID, null as TENNGUONDUOC, null as TINHTIEN, d.DUOC_ID, ld.MALOAIDUOC,        d.SOVISA,d.TYLE_VAT,d.COTOA, d.MADUOC, d.TENHANG, d.TENDUOCDAYDU, d.DONVITINH as DONVITINH, d.BHYT,        d.TENHOATCHAT, d.HAMLUONG, d.HANGSANXUAT, d.QUOCGIA, d.LOAIDUOC_ID, d.DUONGDUNG_ID, d.TINHTIEN_PTTT,        ten.TENDUOC, ten.TENDUOC_EN, ten.MAQUOCTE, ten.MAQUOCTEBT,        '' as BHYT_TEXT        , ld.LOAIVATTU_ID        , d.BENHVIEN_ID,        999999999 as SOLUONG, d.VTYT_PHANLOAI, d.PHAMVI, d.SUASOLUONGTONGHOP, d.MADUOCBV, d.DANGTRINHBAY        , TAMNGUNG = CASE WHEN d.TAMNGUNG = '1' THEN '1' ELSE '0' END        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        union all        select  distinct tk.DUOC_KEY, LTRIM(tk.PHAMVI_ID) as PHAMVI_ID, tk.NGUONDUOC_ID, nh.TENNGUONDUOC, nh.TINHTIEN, d.DUOC_ID, ld.MALOAIDUOC,        d.SOVISA,d.TYLE_VAT,d.COTOA, d.MADUOC, d.TENHANG, d.TENDUOCDAYDU, dvt.TENDONVITINH as DONVITINH, d.BHYT,        d.TENHOATCHAT, d.HAMLUONG, d.HANGSANXUAT, d.QUOCGIA, d.LOAIDUOC_ID, d.DUONGDUNG_ID, d.TINHTIEN_PTTT,        ten.TENDUOC, ten.TENDUOC_EN, ten.MAQUOCTE, ten.MAQUOCTEBT,        CASE WHEN d.BHYT = '1' THEN 'BHYT' ELSE '' END as BHYT_TEXT        , ld.LOAIVATTU_ID        , d.BENHVIEN_ID,        tk.SOLUONG, d.VTYT_PHANLOAI, d.PHAMVI, d.SUASOLUONGTONGHOP, d.MADUOCBV, d.DANGTRINHBAY        , TAMNGUNG = CASE WHEN d.TAMNGUNG = '1' OR nh.TAMNGUNG = '1' OR kd.TAMNGUNG = '1' THEN '1' ELSE '0' END        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        inner join        (        select  LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')) DUOC_KEY, (SUM(dtk.SOLUONG) - isnull(sum(A.SOLUONG),0) - isnull(sum(B.SOLUONG),0)) SOLUONG, pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        from (select sum(soluong) soluong,duoc_id,nguonduoc_id,khoduoc_id,benhvien_id from TT_DUOC_TONKHO  group by duoc_id,nguonduoc_id,khoduoc_id,benhvien_id) dtk        inner join TM_DUOC_PHAMVISD_MAPPING pvsd on dtk.KHODUOC_ID = pvsd.KHODUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NOITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) B on B.DUOC_ID = dtk.DUOC_ID and B.SOLUONG > 0 and B.PHAMVI_ID = pvsd.PHAMVI_ID and B.NGUONHANG_ID = dtk.NGUONDUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NGOAITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) A on A.DUOC_ID = dtk.DUOC_ID and A.SOLUONG > 0 and A.PHAMVI_ID = pvsd.PHAMVI_ID and A.NGUONHANG_ID = dtk.NGUONDUOC_ID        where dtk.SOLUONG > 0 and dtk.BENHVIEN_ID = 'HLU01'        group by LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')), pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        ) tk on tk.DUOC_ID = d.DUOC_ID        left join TM_DUOC_PHAMVISUDUNG kd on kd.PHAMVI_ID = tk.PHAMVI_ID and kd.BENHVIEN_ID = 'HLU01'        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = tk.NGUONDUOC_ID and nh.BENHVIEN_ID = 'HLU01'        where d.BENHVIEN_ID = 'HLU01'  and tk.SOLUONG >= 0         end                else        begin        select  distinct tk.DUOC_KEY, LTRIM(tk.PHAMVI_ID) as PHAMVI_ID, tk.NGUONDUOC_ID, nh.TENNGUONDUOC, nh.TINHTIEN, d.DUOC_ID, ld.MALOAIDUOC,        d.SOVISA,d.TYLE_VAT,d.COTOA, d.MADUOC, d.TENHANG, d.TENDUOCDAYDU, d.DONVITINH as DONVITINH, d.BHYT,        d.TENHOATCHAT, d.HAMLUONG, d.HANGSANXUAT, d.QUOCGIA, d.LOAIDUOC_ID, d.DUONGDUNG_ID, d.TINHTIEN_PTTT,        ten.TENDUOC, ten.TENDUOC_EN, ten.MAQUOCTE, ten.MAQUOCTEBT,        CASE WHEN d.BHYT = '1' THEN 'BHYT' ELSE '' END as BHYT_TEXT        , ld.LOAIVATTU_ID        , d.BENHVIEN_ID,        tk.SOLUONG, d.VTYT_PHANLOAI, d.PHAMVI, d.SUASOLUONGTONGHOP, d.MADUOCBV, d.DANGTRINHBAY        , TAMNGUNG = CASE WHEN d.TAMNGUNG = '1' OR nh.TAMNGUNG = '1' OR kd.TAMNGUNG = '1' THEN '1' ELSE '0' END        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        inner join        (        select  LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')) DUOC_KEY, (SUM(dtk.SOLUONG) - isnull(sum(A.SOLUONG),0) - isnull(sum(B.SOLUONG),0)) SOLUONG, pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        from (select sum(soluong) soluong,duoc_id,nguonduoc_id,khoduoc_id,benhvien_id from TT_DUOC_TONKHO  group by duoc_id,nguonduoc_id,khoduoc_id,benhvien_id) dtk        inner join TM_DUOC_PHAMVISD_MAPPING pvsd on dtk.KHODUOC_ID = pvsd.KHODUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NOITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) B on B.DUOC_ID = dtk.DUOC_ID and B.SOLUONG > 0 and B.PHAMVI_ID = pvsd.PHAMVI_ID and B.NGUONHANG_ID = dtk.NGUONDUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NGOAITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) A on A.DUOC_ID = dtk.DUOC_ID and A.SOLUONG > 0 and A.PHAMVI_ID = pvsd.PHAMVI_ID and A.NGUONHANG_ID = dtk.NGUONDUOC_ID        where dtk.SOLUONG > 0 and dtk.BENHVIEN_ID = 'HLU01'        group by LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')), pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        ) tk on tk.DUOC_ID = d.DUOC_ID        left join TM_DUOC_PHAMVISUDUNG kd on kd.PHAMVI_ID = tk.PHAMVI_ID and kd.BENHVIEN_ID = 'HLU01'        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = tk.NGUONDUOC_ID and nh.BENHVIEN_ID = 'HLU01'        where d.BENHVIEN_ID = 'HLU01'  and tk.SOLUONG >= 0        end]
2019-08-14 17:41:59,725 [6] DEBUG - Statement Id: [DAO00320_GetList] PreparedStatement : [select M.*            from TM_MAU M            LEFT JOIN TM_MAU_DONVITINH DVT on M.DONVITINH_ID=DVT.DONVITINH_ID            where            M.TAMNGUNG = '0'            and M.BENHVIEN_ID = 'HLU01'            order by M.TENMAU]
2019-08-14 17:41:59,795 [6] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM071']
2019-08-14 17:41:59,829 [6] DEBUG - Statement Id: [DAO00322_GetListMauTonKhoForCreateCached] PreparedStatement : [SELECT DISTINCT          TK.MAU_KEY, TK.KHOMAU_ID, M.MAU_ID, M.MAMAU, M.TENMAU, M.NHOM_ABO, M.NHOM_RH, M.LOAIMAU_ID,          TK.SOLONHAP_ID, SLN.SOLONHAP, SLN.SOKIEMSOAT, TK.NGUONHANG_ID, NG.TENNGUONMAU, M.BENHVIEN_ID, M.DONVITINH_ID,          SUM(tk.SOLUONG) AS SOLUONG,K.TENKHO,DVT.TENDONVITINH          FROM TT_MAU_TONKHO TK          JOIN TM_KHO K ON TK.KHOMAU_ID = K.KHO_ID          JOIN TT_MAU_CHUNGTU_SOLONHAP SLN ON TK.SOLONHAP_ID = SLN.SOLONHAP_ID          JOIN TM_MAU M on TK.MAU_ID = M.MAU_ID and M.TAMNGUNG = '0'          LEFT JOIN TM_MAU_DONVITINH DVT on M.DONVITINH_ID=DVT.DONVITINH_ID          LEFT JOIN TM_NGUONMAU NG ON NG.NGUONMAU_ID = TK.NGUONHANG_ID          WHERE TK.SOLUONG > 0          GROUP BY TK.MAU_KEY, TK.KHOMAU_ID, M.MAU_ID, M.MAMAU, M.TENMAU, M.NHOM_ABO, M.NHOM_RH, M.LOAIMAU_ID,          TK.SOLONHAP_ID, SLN.SOLONHAP, SLN.SOKIEMSOAT,TK.NGUONHANG_ID, NG.TENNGUONMAU, M.BENHVIEN_ID, M.DONVITINH_ID,K.TENKHO,DVT.TENDONVITINH]
2019-08-14 17:41:59,900 [6] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM073']
2019-08-14 17:41:59,935 [6] DEBUG - Statement Id: [DAO00322_GetListMauTonKhoTruBooking] PreparedStatement : [select distinct          TK.MAU_KEY, TK.KHOMAU_ID, M.MAU_ID, M.MAMAU, M.TENMAU, M.NHOM_ABO, M.NHOM_RH, M.LOAIMAU_ID, M.DONVITINH_ID,          TK.SOLONHAP_ID, TK.SOLONHAP, TK.SOKIEMSOAT,M.PHAMVI, TK.NGUONHANG_ID, NG.TENNGUONMAU, M.BENHVIEN_ID,          TK.SOLUONG,TK.TENKHO,DVT.TENDONVITINH          from TM_MAU M          JOIN          (          select          A.MAU_KEY, A.KHOMAU_ID, A.MAU_ID ,a.NGUONHANG_ID, A.SOLONHAP_ID, A.SOLONHAP, A.SOKIEMSOAT, A.SOLUONG,A.TENKHO          from          (          select KHOMAU_ID, TK.MAU_ID, TK.NGUONHANG_ID, TK.MAU_KEY, SLN.SOLONHAP_ID, SLN.SOLONHAP, SLN.SOKIEMSOAT, ISNULL(TK.SOLUONG,0) - ISNULL(book.SOLUONG,0) as SOLUONG,K.TENKHO          from TT_MAU_TONKHO TK          JOIN TM_KHO K ON TK.KHOMAU_ID = K.KHO_ID          inner join TT_MAU_CHUNGTU_SOLONHAP SLN ON TK.SOLONHAP_ID = SLN.SOLONHAP_ID          left join dbo.TT_MAU_TONKHO_BOOK book ON book.MAU_KEY = TK.MAU_KEY AND book.TRANGTHAI = 'HIEULUC'          where ISNULL(TK.SOLUONG,0) - ISNULL(book.SOLUONG,0) > 0          ) A          )TK on TK.MAU_ID = M.MAU_ID and M.TAMNGUNG = '0'          LEFT JOIN TM_MAU_DONVITINH DVT on M.DONVITINH_ID=DVT.DONVITINH_ID          LEFT JOIN TM_NGUONMAU NG ON NG.NGUONMAU_ID = TK.NGUONHANG_ID]
2019-08-14 17:42:00,007 [6] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM072']
2019-08-14 17:42:00,941 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'MAIN'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2019-08-14 17:42:01,820 [1] DEBUG - Statement Id: [DAO00002_FormList] PreparedStatement : [select              TM_SYS_FORM.HOSPITAL_ID,              TM_SYS_FORM.NAME,              TM_SYS_FORM.CLASS,              TM_SYS_FORM.ASSEMBLY,              TM_SYS_FORM.TITLE_VI as TITLE              from TM_SYS_FORM              where HOSPITAL_ID = 'HLU01']
2019-08-14 17:42:07,592 [1] DEBUG - Statement Id: [DAO00300_GetShortcutListByUserID] PreparedStatement : [SELECT S.SHORTCUT_CODE, S.SHORTCUT_VALUE              FROM TM_SHORTCUT AS S              WHERE S.BENHVIEN_ID = 'HLU01' AND S.USER_ID = '1' AND TAMNGUNG = '0']
2019-08-14 17:42:07,621 [1] DEBUG - Statement Id: [DAO00087_GetList] PreparedStatement : [select CODE, VALUE, BENHVIEN_ID              from TM_SYS_APPSETTINGS              where LOCKED = '0' and BENHVIEN_ID = 'HLU01'              order by SETTING_ID]
2019-08-14 17:42:07,705 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'MSG01'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2019-08-14 17:42:07,815 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'MSG02'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2019-08-14 17:42:07,959 [1] DEBUG - Statement Id: [DAO00008_GetUserSettings] PreparedStatement : [select A.*, B.TENKHO , C.TENPHONGBAN, B.MAKHO, C.MAPHONGBAN          from TM_SYS_USERS A          left join TM_KHODUOC B on B.KHODUOC_ID = A.INVENTORY_ID          left join TM_PHONGBAN C on (C.PHONGBAN_ID = A.WORKING_DEPT_ID and C.BENHVIEN_ID =  @param0 )          left join TM_SYS_USERKHO D on (D.ACCOUNT_ID = A.ACCOUNT_ID and D.HOSPITAL_ID =  @param0 )          where          A.HOSPITAL_ID =  @param0            and                 A.ACCOUNT_ID =  @param1]
2019-08-14 17:42:07,961 [1] DEBUG - Statement Id: [DAO00008_GetUserSettings] Parameters: [@param0=[HOSPITAL_ID,HLU01], @param1=[ACCOUNT_ID,113]]
2019-08-14 17:42:07,961 [1] DEBUG - Statement Id: [DAO00008_GetUserSettings] Types: [@param0=[String, System.String], @param1=[String, System.String]]
2019-08-14 17:42:07,992 [1] DEBUG - Statement Id: [DAO00008_GetUserInvSettings] PreparedStatement : [select A.*, B.TENKHO, B.MAKHO, B.LOAIKHO_ID, B.KHOQUANLY_ID          from TM_SYS_USERKHO A          left join TM_KHO B on B.MODULE_ID = A.MODULE_ID and B.KHO_ID = A.KHO_ID          where A.HOSPITAL_ID =  @param0  and A.ACCOUNT_ID =  @param1           order by B.TENKHO]
2019-08-14 17:42:07,992 [1] DEBUG - Statement Id: [DAO00008_GetUserInvSettings] Parameters: [@param0=[HOSPITAL_ID,HLU01], @param1=[ACCOUNT_ID,113]]
2019-08-14 17:42:07,992 [1] DEBUG - Statement Id: [DAO00008_GetUserInvSettings] Types: [@param0=[String, System.String], @param1=[String, System.String]]
2019-08-14 17:42:08,196 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'COM30'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2019-08-14 17:42:08,371 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'RIS04'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2019-08-14 17:42:14,838 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'MENU1'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2019-08-14 17:42:14,918 [1] DEBUG - Statement Id: [DAO00011_GetList] PreparedStatement : [select              TM_SYS_MENU.ID,              TM_SYS_MENU.PARENTID,              TM_SYS_MENU.SCREEN,              TM_SYS_MENU.SMALLIMAGE,              TM_SYS_MENU.LARGEIMAGE,              TM_SYS_MENU.DESCRIPTION,              TM_SYS_MENU.TYPE,              TM_SYS_MENU.TITLE_VI as TITLE              from TM_SYS_MENU              where TM_SYS_MENU.HOSPITAL_ID = 'HLU01' and TM_SYS_MENU.ACTIVE = '1'               AND                   (TM_SYS_MENU.TYPE & '8' = '8')                             order by TM_SYS_MENU.ORDERNUM]
2019-08-14 17:42:15,154 [1] DEBUG - Statement Id: [DAO00011_usermenu_list] PreparedStatement : [select              TM_SYS_HOMEMENU.MENUID as ID,              TM_SYS_MENU.TITLE_VI as TITLE,              TM_SYS_MENU.SCREEN,              TM_SYS_MENU.SMALLIMAGE,              TM_SYS_MENU.LARGEIMAGE,              TM_SYS_MENU.TYPE              from TM_SYS_HOMEMENU              left join TM_SYS_MENU on TM_SYS_MENU.ID = TM_SYS_HOMEMENU.MENUID and TM_SYS_MENU.HOSPITAL_ID = TM_SYS_HOMEMENU.HOSPITAL_ID              where TM_SYS_HOMEMENU.HOSPITAL_ID = 'HLU01' and TM_SYS_HOMEMENU.USERID = '113' and TM_SYS_MENU.ACTIVE = '1'               AND                   (TM_SYS_MENU.TYPE & '8' = '8')                             ORDER BY TM_SYS_HOMEMENU.ORDERNUM]
2019-08-14 17:42:21,124 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'COM98'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2019-08-14 17:42:21,902 [1] DEBUG - Statement Id: [DAO00020_ListKhoDuocOfPhongBan] PreparedStatement : [select B.* from TM_PHONGBAN_KHODUOC A        inner join TM_KHODUOC B on B.KHODUOC_ID = A.KHODUOC_ID        where        A.PHONGBAN_ID = '61'        and A.BENHVIEN_ID = 'HLU01']
2019-08-14 17:42:25,855 [1] DEBUG - Statement Id: [DAO00020_ListKhoDuocOfPhongBan] PreparedStatement : [select B.* from TM_PHONGBAN_KHODUOC A        inner join TM_KHODUOC B on B.KHODUOC_ID = A.KHODUOC_ID        where        A.PHONGBAN_ID = '25'        and A.BENHVIEN_ID = 'HLU01']
2019-08-14 17:42:26,165 [1] DEBUG - Statement Id: [DAO00008_UpdateUserIdPhongBanKhoDuoc] PreparedStatement : [IF EXISTS            (SELECT ACCOUNT_ID FROM TM_SYS_USERS WHERE ACCOUNT_ID =  @param0  and HOSPITAL_ID =  @param1 )            BEGIN            update TM_SYS_USERS set INVENTORY_ID =  @param2 , WORKING_DEPT_ID =  @param3             WHERE ACCOUNT_ID =  @param0  and HOSPITAL_ID =  @param1             END            ELSE            BEGIN            insert into TM_SYS_USERS ([ACCOUNT_ID], [ACCOUNT_NAME], [INVENTORY_ID], [WORKING_DEPT_ID], [HOSPITAL_ID])            values ( @param0 ,  @param4 ,  @param2 ,  @param3 ,  @param1 )            END]
2019-08-14 17:42:26,165 [1] DEBUG - Statement Id: [DAO00008_UpdateUserIdPhongBanKhoDuoc] Parameters: [@param0=[ACCOUNT_ID,113], @param1=[HOSPITAL_ID,HLU01], @param2=[INVENTORY_ID,29], @param3=[WORKING_DEPT_ID,25], @param4=[ACCOUNT_NAME,admin]]
2019-08-14 17:42:26,165 [1] DEBUG - Statement Id: [DAO00008_UpdateUserIdPhongBanKhoDuoc] Types: [@param0=[String, System.String], @param1=[String, System.String], @param2=[String, System.String], @param3=[String, System.String], @param4=[String, System.String]]
2019-08-14 17:42:34,600 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'OPD23'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2019-08-14 17:42:35,985 [1] DEBUG - Statement Id: [DAO00019_DanhSachPhauThuatThuThuat] PreparedStatement : [declare @TenBenhVien nvarchar(500)        set @TenBenhVien = (select VALUE from TM_SYS_APPSETTINGS where CODE = 'APP_BENHVIEN_TEN')        select * from(        select ROW_NUMBER() OVER(order by NGAYGIOYEUCAU) as ROWNUMBER, *        from        (SELECT distinct        COUNT(*) OVER() as TOTALROWS,        N'Mã người bệnh: ' + bn.MAYTE + ' - ' + N'Tên người bệnh: ' + bn.TENBENHNHAN + ' - ' + N'Số bệnh án: ' + ISNULL(BA.SOBENHAN,'') + ' - ' + N'Sinh ngày: ' + isnull(Convert(varchar(10),bn.NGAYSINH,103),bn.NAMSINH) + ' - ' + N'Giới tính: ' + GD.DESCRIPTION as GROUPNAME,        bn.MAYTE, bn.TENBENHNHAN, bn.NAMSINH, bn.NGAYSINH as TUOI, ISNULL(CONVERT(VARCHAR(10), bn.NGAYSINH, 103),CAST(bn.NAMSINH AS varchar)) as NGAYSINH, bn.DIACHILIENLAC as DIACHI, bn.GIOITINH, GD.DESCRIPTION as TENGIOITINH,        tn.DOITUONG_ID, tn.THOIGIANTIEPNHAN, tn.BENHNHAN_ID, tn.TIEPNHAN_ID, tn.TRAITUYEN, tn.SOTIEPNHAN        , dv.DICHVU_ID, dv.NOITHUCHIEN_ID, isnull(dv.NGAYTAO, dv.NGAYCAPNHAT) as THOIGIANDKDICHVU        , dv.KHAN, dv.NOIYEUCAU_ID, dv.NGAYGIOYEUCAU, dv.BACSICHIDINH_ID, dv.DONVIGIOITHIEU_ID        , dv.NGUOIGIOITHIEU_ID, dv.TRANGTHAI_WFL, tn.NOIGIOITHIEU_ID        , dv.DVYEUCAU_ID, dv.MARIS, dv.TRANGTHAI as TRANGTHAICODE, B.TENNHOMDICHVU, dv.SOPHIEUYEUCAU, dv.KHAMBENH_NGOAITRU_ID, dv.NGUOICAPNHAT_ID, dv.NGAYCAPNHAT,        CASE WHEN Left(B.MANHOMDICHVU,2) = '03' THEN '02' ELSE Left(B.MANHOMDICHVU,2) END AS MANHOMDICHVU, B.MANHOMDICHVU as MANHOMDICHVUCHITIET, tn.TRANGTHAI as TRANGTHAI_TIEPNHAN,        'False' as DAKHAM,        vp.DATHANHTOAN, vp.DONGIA_DOANHTHU, BA.SOBENHAN, dv.CHANDOAN        , a.TENDICHVU, nth.TENPHONGBAN as TENPHONGKHAM, nyc.TENPHONGBAN as TENKHOACHIDINH        , bscd.TENNHANVIEN as TENBACSICHIDINH        , 0 as GUINGOAI        , 0 as VTYT        , 0 as CLSKETQUA_ID                 FROM TT_DVYEUCAU (NOLOCK) dv        inner join TT_TIEPNHAN (NOLOCK) tn on dv.TIEPNHAN_ID = tn.TIEPNHAN_ID        inner join TT_BENHNHAN (NOLOCK) bn on tn.BENHNHAN_ID = bn.BENHNHAN_ID        inner join TM_DICHVU A on A.DICHVU_ID = dv.DICHVU_ID        inner join TM_PHONGBAN nth on nth.PHONGBAN_ID = dv.NOITHUCHIEN_ID        left join TM_NHANVIEN bscd on bscd.NHANVIEN_ID = dv.BACSICHIDINH_ID        inner join TM_PHONGBAN nyc on nyc.PHONGBAN_ID = dv.NOIYEUCAU_ID        inner join TM_NHOMDICHVU B on B.NHOMDICHVU_ID = A.NHOMDICHVU_ID        inner join TT_VIENPHI (NOLOCK) VP on VP.TIEPNHAN_ID = tn.TIEPNHAN_ID and VP.DICHVU_ID = dv.DICHVU_ID and VP.REF_ID = dv.DVYEUCAU_ID        left join TT_NOITRU_BENHAN (NOLOCK) BA on BA.TIEPNHAN_ID = tn.TIEPNHAN_ID AND dv.BENHAN_ID = BA.BENHAN_ID        inner join TM_GENDER GD on GD.ID = bn.GIOITINH                 where        dv.DICHVU_ID IS NOT NULL        and tn.BENHVIEN_ID = 'HLU01'        and HUYYEUCAU = 0        and dv.NGAYHENCLS is NULL                       and dv.TRANGTHAI = 'CHUAKETQUA'           and           dv.NGAYYEUCAU >= '8/14/2019 12:00:00 AM'         and           dv.NGAYYEUCAU <= '8/14/2019 12:00:00 AM'         and           dv.NOITHUCHIEN_ID = 25         and           (CASE WHEN Left(B.MANHOMDICHVU,2) = '03' THEN '02' ELSE Left(B.MANHOMDICHVU,2) END) = '05'         and           tn.TRANGTHAI IN ('DATIEPNHAN','NOITRU','CAPCUU', 'HOANTHANH')         and           (vp.DATHANHTOAN = '1'  or vp.DONGIA_DOANHTHU = '0' OR TN.SUDUNG_BHTN='1' OR TN.BAOLANH_VIENPHI='1'  OR tn.TRANGTHAI IN ('NOITRU','CAPCUU','NGOAITRU') or dv.HOPDONG_BENHNHAN_ID is not null or vp.BENHNHAN_PHAITHANHTOAN >= 0)                 ) data1) lst                    where          lst.ROWNUMBER between 1 and 20                 order by NGAYGIOYEUCAU asc]
2019-08-14 17:42:42,649 [1] DEBUG - Statement Id: [DAO00019_DanhSachPhauThuatThuThuat] PreparedStatement : [declare @TenBenhVien nvarchar(500)        set @TenBenhVien = (select VALUE from TM_SYS_APPSETTINGS where CODE = 'APP_BENHVIEN_TEN')        select * from(        select ROW_NUMBER() OVER(order by NGAYGIOYEUCAU) as ROWNUMBER, *        from        (SELECT distinct        COUNT(*) OVER() as TOTALROWS,        N'Mã người bệnh: ' + bn.MAYTE + ' - ' + N'Tên người bệnh: ' + bn.TENBENHNHAN + ' - ' + N'Số bệnh án: ' + ISNULL(BA.SOBENHAN,'') + ' - ' + N'Sinh ngày: ' + isnull(Convert(varchar(10),bn.NGAYSINH,103),bn.NAMSINH) + ' - ' + N'Giới tính: ' + GD.DESCRIPTION as GROUPNAME,        bn.MAYTE, bn.TENBENHNHAN, bn.NAMSINH, bn.NGAYSINH as TUOI, ISNULL(CONVERT(VARCHAR(10), bn.NGAYSINH, 103),CAST(bn.NAMSINH AS varchar)) as NGAYSINH, bn.DIACHILIENLAC as DIACHI, bn.GIOITINH, GD.DESCRIPTION as TENGIOITINH,        tn.DOITUONG_ID, tn.THOIGIANTIEPNHAN, tn.BENHNHAN_ID, tn.TIEPNHAN_ID, tn.TRAITUYEN, tn.SOTIEPNHAN        , dv.DICHVU_ID, dv.NOITHUCHIEN_ID, isnull(dv.NGAYTAO, dv.NGAYCAPNHAT) as THOIGIANDKDICHVU        , dv.KHAN, dv.NOIYEUCAU_ID, dv.NGAYGIOYEUCAU, dv.BACSICHIDINH_ID, dv.DONVIGIOITHIEU_ID        , dv.NGUOIGIOITHIEU_ID, dv.TRANGTHAI_WFL, tn.NOIGIOITHIEU_ID        , dv.DVYEUCAU_ID, dv.MARIS, dv.TRANGTHAI as TRANGTHAICODE, B.TENNHOMDICHVU, dv.SOPHIEUYEUCAU, dv.KHAMBENH_NGOAITRU_ID, dv.NGUOICAPNHAT_ID, dv.NGAYCAPNHAT,        CASE WHEN Left(B.MANHOMDICHVU,2) = '03' THEN '02' ELSE Left(B.MANHOMDICHVU,2) END AS MANHOMDICHVU, B.MANHOMDICHVU as MANHOMDICHVUCHITIET, tn.TRANGTHAI as TRANGTHAI_TIEPNHAN,        'False' as DAKHAM,        vp.DATHANHTOAN, vp.DONGIA_DOANHTHU, BA.SOBENHAN, dv.CHANDOAN        , a.TENDICHVU, nth.TENPHONGBAN as TENPHONGKHAM, nyc.TENPHONGBAN as TENKHOACHIDINH        , bscd.TENNHANVIEN as TENBACSICHIDINH        , 0 as GUINGOAI        , 0 as VTYT        , 0 as CLSKETQUA_ID                 FROM TT_DVYEUCAU (NOLOCK) dv        inner join TT_TIEPNHAN (NOLOCK) tn on dv.TIEPNHAN_ID = tn.TIEPNHAN_ID        inner join TT_BENHNHAN (NOLOCK) bn on tn.BENHNHAN_ID = bn.BENHNHAN_ID        inner join TM_DICHVU A on A.DICHVU_ID = dv.DICHVU_ID        inner join TM_PHONGBAN nth on nth.PHONGBAN_ID = dv.NOITHUCHIEN_ID        left join TM_NHANVIEN bscd on bscd.NHANVIEN_ID = dv.BACSICHIDINH_ID        inner join TM_PHONGBAN nyc on nyc.PHONGBAN_ID = dv.NOIYEUCAU_ID        inner join TM_NHOMDICHVU B on B.NHOMDICHVU_ID = A.NHOMDICHVU_ID        inner join TT_VIENPHI (NOLOCK) VP on VP.TIEPNHAN_ID = tn.TIEPNHAN_ID and VP.DICHVU_ID = dv.DICHVU_ID and VP.REF_ID = dv.DVYEUCAU_ID        left join TT_NOITRU_BENHAN (NOLOCK) BA on BA.TIEPNHAN_ID = tn.TIEPNHAN_ID AND dv.BENHAN_ID = BA.BENHAN_ID        inner join TM_GENDER GD on GD.ID = bn.GIOITINH                 where        dv.DICHVU_ID IS NOT NULL        and tn.BENHVIEN_ID = 'HLU01'        and HUYYEUCAU = 0        and dv.NGAYHENCLS is NULL                       and dv.TRANGTHAI = 'CHUAKETQUA'           and           dv.NGAYYEUCAU >= '8/1/2019 12:00:00 AM'         and           dv.NGAYYEUCAU <= '8/14/2019 12:00:00 AM'         and           dv.NOITHUCHIEN_ID = 25         and           (CASE WHEN Left(B.MANHOMDICHVU,2) = '03' THEN '02' ELSE Left(B.MANHOMDICHVU,2) END) = '05'         and           tn.TRANGTHAI IN ('DATIEPNHAN','NOITRU','CAPCUU', 'HOANTHANH')         and           (vp.DATHANHTOAN = '1'  or vp.DONGIA_DOANHTHU = '0' OR TN.SUDUNG_BHTN='1' OR TN.BAOLANH_VIENPHI='1'  OR tn.TRANGTHAI IN ('NOITRU','CAPCUU','NGOAITRU') or dv.HOPDONG_BENHNHAN_ID is not null or vp.BENHNHAN_PHAITHANHTOAN >= 0)                 ) data1) lst                    where          lst.ROWNUMBER between 1 and 20                 order by NGAYGIOYEUCAU asc]
2019-08-14 17:42:49,580 [1] DEBUG - Statement Id: [DAO00019_DanhSachPhauThuatThuThuat] PreparedStatement : [declare @TenBenhVien nvarchar(500)        set @TenBenhVien = (select VALUE from TM_SYS_APPSETTINGS where CODE = 'APP_BENHVIEN_TEN')        select * from(        select ROW_NUMBER() OVER(order by NGAYGIOYEUCAU) as ROWNUMBER, *        from        (SELECT distinct        COUNT(*) OVER() as TOTALROWS,        N'Mã người bệnh: ' + bn.MAYTE + ' - ' + N'Tên người bệnh: ' + bn.TENBENHNHAN + ' - ' + N'Số bệnh án: ' + ISNULL(BA.SOBENHAN,'') + ' - ' + N'Sinh ngày: ' + isnull(Convert(varchar(10),bn.NGAYSINH,103),bn.NAMSINH) + ' - ' + N'Giới tính: ' + GD.DESCRIPTION as GROUPNAME,        bn.MAYTE, bn.TENBENHNHAN, bn.NAMSINH, bn.NGAYSINH as TUOI, ISNULL(CONVERT(VARCHAR(10), bn.NGAYSINH, 103),CAST(bn.NAMSINH AS varchar)) as NGAYSINH, bn.DIACHILIENLAC as DIACHI, bn.GIOITINH, GD.DESCRIPTION as TENGIOITINH,        tn.DOITUONG_ID, tn.THOIGIANTIEPNHAN, tn.BENHNHAN_ID, tn.TIEPNHAN_ID, tn.TRAITUYEN, tn.SOTIEPNHAN        , dv.DICHVU_ID, dv.NOITHUCHIEN_ID, isnull(dv.NGAYTAO, dv.NGAYCAPNHAT) as THOIGIANDKDICHVU        , dv.KHAN, dv.NOIYEUCAU_ID, dv.NGAYGIOYEUCAU, dv.BACSICHIDINH_ID, dv.DONVIGIOITHIEU_ID        , dv.NGUOIGIOITHIEU_ID, dv.TRANGTHAI_WFL, tn.NOIGIOITHIEU_ID        , dv.DVYEUCAU_ID, dv.MARIS, dv.TRANGTHAI as TRANGTHAICODE, B.TENNHOMDICHVU, dv.SOPHIEUYEUCAU, dv.KHAMBENH_NGOAITRU_ID, dv.NGUOICAPNHAT_ID, dv.NGAYCAPNHAT,        CASE WHEN Left(B.MANHOMDICHVU,2) = '03' THEN '02' ELSE Left(B.MANHOMDICHVU,2) END AS MANHOMDICHVU, B.MANHOMDICHVU as MANHOMDICHVUCHITIET, tn.TRANGTHAI as TRANGTHAI_TIEPNHAN,        'False' as DAKHAM,        vp.DATHANHTOAN, vp.DONGIA_DOANHTHU, BA.SOBENHAN, dv.CHANDOAN        , a.TENDICHVU, nth.TENPHONGBAN as TENPHONGKHAM, nyc.TENPHONGBAN as TENKHOACHIDINH        , bscd.TENNHANVIEN as TENBACSICHIDINH        , 0 as GUINGOAI        , 0 as VTYT        , 0 as CLSKETQUA_ID                 FROM TT_DVYEUCAU (NOLOCK) dv        inner join TT_TIEPNHAN (NOLOCK) tn on dv.TIEPNHAN_ID = tn.TIEPNHAN_ID        inner join TT_BENHNHAN (NOLOCK) bn on tn.BENHNHAN_ID = bn.BENHNHAN_ID        inner join TM_DICHVU A on A.DICHVU_ID = dv.DICHVU_ID        inner join TM_PHONGBAN nth on nth.PHONGBAN_ID = dv.NOITHUCHIEN_ID        left join TM_NHANVIEN bscd on bscd.NHANVIEN_ID = dv.BACSICHIDINH_ID        inner join TM_PHONGBAN nyc on nyc.PHONGBAN_ID = dv.NOIYEUCAU_ID        inner join TM_NHOMDICHVU B on B.NHOMDICHVU_ID = A.NHOMDICHVU_ID        inner join TT_VIENPHI (NOLOCK) VP on VP.TIEPNHAN_ID = tn.TIEPNHAN_ID and VP.DICHVU_ID = dv.DICHVU_ID and VP.REF_ID = dv.DVYEUCAU_ID        left join TT_NOITRU_BENHAN (NOLOCK) BA on BA.TIEPNHAN_ID = tn.TIEPNHAN_ID AND dv.BENHAN_ID = BA.BENHAN_ID        inner join TM_GENDER GD on GD.ID = bn.GIOITINH                 where        dv.DICHVU_ID IS NOT NULL        and tn.BENHVIEN_ID = 'HLU01'        and HUYYEUCAU = 0        and dv.NGAYHENCLS is NULL                       and dv.TRANGTHAI = 'CHUAKETQUA'           and           dv.NGAYYEUCAU >= '6/1/2019 12:00:00 AM'         and           dv.NGAYYEUCAU <= '8/14/2019 12:00:00 AM'         and           dv.NOITHUCHIEN_ID = 25         and           (CASE WHEN Left(B.MANHOMDICHVU,2) = '03' THEN '02' ELSE Left(B.MANHOMDICHVU,2) END) = '05'         and           tn.TRANGTHAI IN ('DATIEPNHAN','NOITRU','CAPCUU', 'HOANTHANH')         and           (vp.DATHANHTOAN = '1'  or vp.DONGIA_DOANHTHU = '0' OR TN.SUDUNG_BHTN='1' OR TN.BAOLANH_VIENPHI='1'  OR tn.TRANGTHAI IN ('NOITRU','CAPCUU','NGOAITRU') or dv.HOPDONG_BENHNHAN_ID is not null or vp.BENHNHAN_PHAITHANHTOAN >= 0)                 ) data1) lst                    where          lst.ROWNUMBER between 1 and 20                 order by NGAYGIOYEUCAU asc]
2019-08-14 17:42:50,241 [1] DEBUG - Statement Id: [DAO00000_GetNhomDoiTuong] PreparedStatement : [SELECT DOITUONG_ID              ,[TENDOITUONG]              ,[NHOMDICHVU]              ,[TYLE_VUOT_LCB]              ,[GIOIHAN_VUOT_LCB]              ,[GIOIHAN_VUOT_DVKTC]              ,[TYLE_THUOC_UT]              ,[CPVC]              ,[CHIPHINGOAI_BHYT]              ,[NGANSACH_TL]              ,[MIENGIAM_TL]              ,[TAITRO_TL]              ,[BHTN_TL]              FROM [dbo].[TM_DOITUONG]]
2019-08-14 17:42:57,422 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'ORM04'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2019-08-14 17:42:57,704 [1] DEBUG - Statement Id: [DAO00012_GetList] PreparedStatement : [select        DICTIONARY_ID,        DICTIONARY_CODE,        DICTIONARY_NAME,        ATTRIBUTE1,        ATTRIBUTE2,        DICTIONARY_NAME_EN        from LST_DICTIONARY        where LST_DICTIONARY.Enabled = '1'         AND           LST_DICTIONARY.DICTIONARY_TYPE_CODE = 'NguonBenh'                 order by LST_DICTIONARY.IDX]
2019-08-14 17:42:57,989 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'ORM05'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2019-08-14 17:42:58,112 [1] DEBUG - Statement Id: [DAO00012_GetList] PreparedStatement : [select        DICTIONARY_ID,        DICTIONARY_CODE,        DICTIONARY_NAME,        ATTRIBUTE1,        ATTRIBUTE2,        DICTIONARY_NAME_EN        from LST_DICTIONARY        where LST_DICTIONARY.Enabled = '1'         AND           LST_DICTIONARY.DICTIONARY_TYPE_CODE = 'PhuongPhapGayMe'                 order by LST_DICTIONARY.IDX]
2019-08-14 17:42:58,961 [1] DEBUG - Statement Id: [DAO00012_GetList] PreparedStatement : [select        DICTIONARY_ID,        DICTIONARY_CODE,        DICTIONARY_NAME,        ATTRIBUTE1,        ATTRIBUTE2,        DICTIONARY_NAME_EN        from LST_DICTIONARY        where LST_DICTIONARY.Enabled = '1'         AND           LST_DICTIONARY.DICTIONARY_TYPE_CODE = 'TuVongPhauThuat'                 order by LST_DICTIONARY.IDX]
2019-08-14 17:42:59,111 [1] DEBUG - Statement Id: [DAO00012_GetList] PreparedStatement : [select        DICTIONARY_ID,        DICTIONARY_CODE,        DICTIONARY_NAME,        ATTRIBUTE1,        ATTRIBUTE2,        DICTIONARY_NAME_EN        from LST_DICTIONARY        where LST_DICTIONARY.Enabled = '1'         AND           LST_DICTIONARY.DICTIONARY_TYPE_CODE = 'CheDo_PT_TT'                 order by LST_DICTIONARY.IDX]
2019-08-14 17:42:59,299 [1] DEBUG - Statement Id: [DAO00012_GetList] PreparedStatement : [select        DICTIONARY_ID,        DICTIONARY_CODE,        DICTIONARY_NAME,        ATTRIBUTE1,        ATTRIBUTE2,        DICTIONARY_NAME_EN        from LST_DICTIONARY        where LST_DICTIONARY.Enabled = '1'         AND           LST_DICTIONARY.DICTIONARY_TYPE_CODE = 'TaiBienPhauThuat'                 order by LST_DICTIONARY.IDX]
2019-08-14 17:42:59,510 [1] DEBUG - Statement Id: [DAO00047_GetList] PreparedStatement : [select *              from TM_LOAIPHAUTHUAT              where TAMNGUNG = '0' and BENHVIEN_ID = 'HLU01'              order by STT]
2019-08-14 17:43:00,033 [1] DEBUG - Statement Id: [DAO00019_ThongTinBenhNhanTiepNhan] PreparedStatement : [select distinct A.SOTIEPNHAN, A.TIEPNHAN_ID, A.DOITUONG_ID, A.TRANGTHAI,        A.LOAITHANHVIEN_ID, A.SUDUNG_BHTN, A.THE_ID, A.THANHVIEN_ID, A.VIP, A.NGUON_BENHNHAN_ID, A.BAOLANH_VIENPHI,        B.*, A.SOBHYT        from TT_TIEPNHAN A        inner join TT_BENHNHAN B on B.BENHNHAN_ID = A.BENHNHAN_ID and B.ACTIVE = '1'        where                    A.TIEPNHAN_ID = '26730'                 and A.BENHVIEN_ID = 'HLU01']
2019-08-14 17:43:00,428 [1] DEBUG - Statement Id: [DAO00048_TT_PHAUTHUAT_GetList] PreparedStatement : [select *              from TT_PHAUTHUAT               where                             TT_PHAUTHUAT.LOAI = 'P'                       and                           TT_PHAUTHUAT.TIEPNHAN_ID = 26730                       and                           TT_PHAUTHUAT.BENHVIEN_ID = 'HLU01'                                     order by PHAUTHUAT_ID DESC]
2019-08-14 17:43:00,695 [1] DEBUG - Statement Id: [DAO00066_GetBENHAN_TIEPNHAN] PreparedStatement : [select top 1 *        from TT_NOITRU_BENHAN        where TIEPNHAN_ID = '26730'  and BENHVIEN_ID = 'HLU01'        order by NGAYTAO desc]
2019-08-14 17:43:00,803 [1] DEBUG - Statement Id: [DAO00048_GetBenhNhanByBenhNhanID] PreparedStatement : [SELECT *              FROM              TT_BENHNHAN               where                             BENHNHAN_ID = '15236']
2019-08-14 17:43:00,866 [1] DEBUG - Statement Id: [DAO00000_GetDoiTuongIsBHYT] PreparedStatement : [select * from TM_DOITUONG Where DOITUONG_ID = 6 and MADOITUONG like '%BHYT%']
2019-08-14 17:43:01,373 [1] DEBUG - Statement Id: [DAO00041_GetList] PreparedStatement : [select * from              (select dv.*, ndv.LOAIDICHVU_ID, ndv.MANHOMDICHVU, ndv.TENNHOMDICHVU as TENNHOMDICHVU,              ndv.TENKHONGDAU as TENNDVKHONGDAU, ndv.TENNHOMDICHVU_EN, ndv.TENNHOMDICHVU_RU,              CASE WHEN Left(ndv.MANHOMDICHVU,2) = '03' THEN '02' ELSE Left(ndv.MANHOMDICHVU,2) END AS PHANLOAI_MANHOMDICHVU              from TM_DICHVU dv              left join TM_NHOMDICHVU ndv on dv.NHOMDICHVU_ID = ndv.NHOMDICHVU_ID                             where ndv.TAMNGUNG = '0' and dv.TAMNGUNG = '0' and dv.BENHVIEN_ID = 'HLU01') as tbl                 where                           PHANLOAI_MANHOMDICHVU in (05)]
2019-08-14 17:43:02,604 [1] DEBUG - Statement Id: [DAO00048_GetDICHVUYCByTiepNhanID] PreparedStatement : [SELECT DISTINCT D.HOPDONG_ID, D.HOPDONG_BENHNHAN_ID, D.DVYEUCAU_ID, D.DICHVU_ID, D.SOPHIEUYEUCAU, D.NGAYGIOYEUCAU, D.NOITHUCHIEN_ID, P.LOAIPHAUTHUAT, L.STT AS STT_LOAIPHAUTHUAT            FROM            TT_DVYEUCAU AS D            left join TM_PHANLOAIPHAUTHUAT AS P ON D.DICHVU_ID = P.DICHVU_ID            left join TM_LOAIPHAUTHUAT AS L ON L.LOAIPHAUTHUAT = P.LOAIPHAUTHUAT            where            not exists (select DVYEUCAU_ID from TT_PHAUTHUAT_YEUCAU where D.DVYEUCAU_ID = DVYEUCAU_ID)               and                       exists (select DICHVU_ID from TM_DICHVU                      where D.DICHVU_ID = DICHVU_ID and                      exists (select NHOMDICHVU_ID from TM_NHOMDICHVU where TM_DICHVU.NHOMDICHVU_ID = NHOMDICHVU_ID and left(MANHOMDICHVU,2) in (05) ))                     and                           D.TIEPNHAN_ID = '26730']
2019-08-14 17:43:02,832 [1] DEBUG - Statement Id: [DAO00066_GetBENHAN_TIEPNHAN] PreparedStatement : [select top 1 *        from TT_NOITRU_BENHAN        where TIEPNHAN_ID = '26730'  and BENHVIEN_ID = 'HLU01'        order by NGAYTAO desc]
2019-08-14 17:43:03,017 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'COM60'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2019-08-14 17:43:05,868 [1] DEBUG - Statement Id: [DAO00048_GetDVYeuCauByDVYeuCauID] PreparedStatement : [SELECT *              FROM              TT_VIENPHI              WHERE              REF_ID IN (202112) and REF_TABLE='TT_DVYEUCAU'              AND TIEPNHAN_ID = 26730]
2019-08-14 17:43:05,914 [1] DEBUG - Statement Id: [DAO00041_GetList] PreparedStatement : [select * from              (select dv.*, ndv.LOAIDICHVU_ID, ndv.MANHOMDICHVU, ndv.TENNHOMDICHVU as TENNHOMDICHVU,              ndv.TENKHONGDAU as TENNDVKHONGDAU, ndv.TENNHOMDICHVU_EN, ndv.TENNHOMDICHVU_RU,              CASE WHEN Left(ndv.MANHOMDICHVU,2) = '03' THEN '02' ELSE Left(ndv.MANHOMDICHVU,2) END AS PHANLOAI_MANHOMDICHVU              from TM_DICHVU dv              left join TM_NHOMDICHVU ndv on dv.NHOMDICHVU_ID = ndv.NHOMDICHVU_ID                             where ndv.TAMNGUNG = '0' and dv.TAMNGUNG = '0' and dv.BENHVIEN_ID = 'HLU01') as tbl                 where                           PHANLOAI_MANHOMDICHVU in (05, 06)]
2019-08-14 17:43:28,087 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'ORM06'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2019-08-14 17:43:28,662 [1] DEBUG - Statement Id: [DAO00051_GetMauTuongTrinh] PreparedStatement : [select *              from TM_TUDIENKETQUA              where BENHVIEN_ID = 'HLU01'               and                   NGUOITAO_ID = '1'                and DICHVU_ID in  (                        @param0                   )               ORDER BY TENNOIDUNG]
2019-08-14 17:43:28,663 [1] DEBUG - Statement Id: [DAO00051_GetMauTuongTrinh] Parameters: [@param0=[LSTDICHVU_ID[0],3329]]
2019-08-14 17:43:28,663 [1] DEBUG - Statement Id: [DAO00051_GetMauTuongTrinh] Types: [@param0=[Int64, System.Int64]]
2019-08-14 17:43:31,647 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'ORM07'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2019-08-14 17:43:32,001 [1] DEBUG - Statement Id: [DAO00012_GetList] PreparedStatement : [select        DICTIONARY_ID,        DICTIONARY_CODE,        DICTIONARY_NAME,        ATTRIBUTE1,        ATTRIBUTE2,        DICTIONARY_NAME_EN        from LST_DICTIONARY        where LST_DICTIONARY.Enabled = '1'         AND           LST_DICTIONARY.DICTIONARY_TYPE_CODE = 'KipMo_VaiTro'                 order by LST_DICTIONARY.IDX]
2019-08-14 17:43:39,918 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'ORM08'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2019-08-14 17:43:40,526 [1] DEBUG - Statement Id: [DAO00063_GetListKhoThuocPhongBanPhamvi] PreparedStatement : [select distinct dpv.*        from TM_DUOC_PHAMVISD_MAPPING dmap        left join TM_DUOC_PHAMVISUDUNG dpv on dpv.PHAMVI_ID = dmap.PHAMVI_ID        where dmap.KHODUOC_ID in (select KHODUOC_ID from TM_PHONGBAN_KHODUOC where PHONGBAN_ID = '25')]
2019-08-14 17:43:40,602 [1] DEBUG - Statement Id: [DAO00051_GetTemplateDuoc] PreparedStatement : [select *              from TM_TEMPLATEDUOC               where                             NGUOITAO_ID = '1'                       and                           KHOATAO_ID = '25'                                     ORDER BY TENTEMPLATE]
2019-08-14 17:43:54,943 [1] DEBUG - Statement Id: [DAO00000_GetCHECK_DOITUONG_BHYT] PreparedStatement : [select count(*) as DOITUONG_BHYT FROM TM_DOITUONG A            WHERE A.DOITUONG_ID = '6' and A.BENHVIEN_ID = 'HLU01' and MADOITUONG like '%BHYT%']
2019-08-14 17:43:54,976 [1] DEBUG - Statement Id: [DAO00000_GetLOAIGIATHUOC_NOI_NGOAI_VIEN] PreparedStatement : [SELECT LOAIGIA_ID              FROM TM_LOAIGIA              WHERE MALOAIGIA = 'GiaThuoc_NoiVien' and BENHVIEN_ID = 'HLU01']
2019-08-14 17:43:55,003 [1] DEBUG - Statement Id: [DAO00087_GetServiceParams] PreparedStatement : [select CODE, VALUE              from TM_SYS_APPSETTINGS              where LOCKED = '0' and BENHVIEN_ID = 'HLU01']
2019-08-14 17:43:55,041 [1] DEBUG - Statement Id: [DAO00000_GetDUOC_DONGIADOANHTHU_NOIVIEN] PreparedStatement : [declare @doanhthu numeric(24,2);          declare @hotro numeric(24,2);          select top 1 @doanhthu = dg.DONGIA           from TM_DUOC_DONGIA dg          left join TM_DOITUONG_LOAIGIA dtlg on dtlg.LOAIGIA_ID = dg.LOAIGIA_ID                     where dg.DUOC_ID = '14' and dtlg.DOITUONG_ID = '6' and dg.DONGIA is not null and dg.DONGIA > 0                      order by dtlg.DOUUTIEN asc           select top 1 @hotro = dg.DONGIA           from TM_DUOC_DONGIA dg          left join TM_DOITUONG_LOAIGIA dtlg on dtlg.LOAIGIA_ID = dg.LOAIGIA_ID                     where dg.DUOC_ID = '14' and dtlg.DOITUONG_ID = '6' and dg.DONGIA is not null and dg.DONGIA > 0  and GIAHOTRO = '1'                     order by dtlg.DOUUTIEN asc              select ISNULL(@doanhthu,0.0) DONGIA_DOANHTHU, ISNULL(@hotro, 0.0) DONGIA_KHAC]
2019-08-14 17:43:55,452 [1] DEBUG - Statement Id: [DAO00000_GetDuocBHYT] PreparedStatement : [select count(*) BHYT FROM TM_DUOC A WHERE A.DUOC_ID = '14' and BHYT = '1']
2019-08-14 17:43:55,549 [1] DEBUG - Statement Id: [DAO00012_GetList] PreparedStatement : [select        DICTIONARY_ID,        DICTIONARY_CODE,        DICTIONARY_NAME,        ATTRIBUTE1,        ATTRIBUTE2,        DICTIONARY_NAME_EN        from LST_DICTIONARY        where LST_DICTIONARY.Enabled = '1'         AND           LST_DICTIONARY.DICTIONARY_TYPE_CODE = 'Phanloai_VTYT'                 order by LST_DICTIONARY.IDX]
2019-08-14 17:43:55,674 [1] DEBUG - Statement Id: [DAO00000_GetCHECK_DOITUONG_BHYT] PreparedStatement : [select count(*) as DOITUONG_BHYT FROM TM_DOITUONG A            WHERE A.DOITUONG_ID = '6' and A.BENHVIEN_ID = 'HLU01' and MADOITUONG like '%BHYT%']
2019-08-14 17:43:55,701 [1] DEBUG - Statement Id: [DAO00000_GetLOAIGIATHUOC_NOI_NGOAI_VIEN] PreparedStatement : [SELECT LOAIGIA_ID              FROM TM_LOAIGIA              WHERE MALOAIGIA = 'GiaThuoc_NoiVien' and BENHVIEN_ID = 'HLU01']
2019-08-14 17:43:55,726 [1] DEBUG - Statement Id: [DAO00000_GetDUOC_DONGIADOANHTHU_NOIVIEN] PreparedStatement : [declare @doanhthu numeric(24,2);          declare @hotro numeric(24,2);          select top 1 @doanhthu = dg.DONGIA           from TM_DUOC_DONGIA dg          left join TM_DOITUONG_LOAIGIA dtlg on dtlg.LOAIGIA_ID = dg.LOAIGIA_ID                     where dg.DUOC_ID = '14' and dtlg.DOITUONG_ID = '6' and dg.DONGIA is not null and dg.DONGIA > 0                      order by dtlg.DOUUTIEN asc           select top 1 @hotro = dg.DONGIA           from TM_DUOC_DONGIA dg          left join TM_DOITUONG_LOAIGIA dtlg on dtlg.LOAIGIA_ID = dg.LOAIGIA_ID                     where dg.DUOC_ID = '14' and dtlg.DOITUONG_ID = '6' and dg.DONGIA is not null and dg.DONGIA > 0  and GIAHOTRO = '1'                     order by dtlg.DOUUTIEN asc              select ISNULL(@doanhthu,0.0) DONGIA_DOANHTHU, ISNULL(@hotro, 0.0) DONGIA_KHAC]
2019-08-14 17:43:55,754 [1] DEBUG - Statement Id: [DAO00000_GetDuocBHYT] PreparedStatement : [select count(*) BHYT FROM TM_DUOC A WHERE A.DUOC_ID = '14' and BHYT = '1']
2019-08-14 17:44:05,089 [1] DEBUG - Statement Id: [DAO00000_GetCHECK_DOITUONG_BHYT] PreparedStatement : [select count(*) as DOITUONG_BHYT FROM TM_DOITUONG A            WHERE A.DOITUONG_ID = '6' and A.BENHVIEN_ID = 'HLU01' and MADOITUONG like '%BHYT%']
2019-08-14 17:44:05,135 [1] DEBUG - Statement Id: [DAO00000_GetLOAIGIATHUOC_NOI_NGOAI_VIEN] PreparedStatement : [SELECT LOAIGIA_ID              FROM TM_LOAIGIA              WHERE MALOAIGIA = 'GiaThuoc_NoiVien' and BENHVIEN_ID = 'HLU01']
2019-08-14 17:44:05,161 [1] DEBUG - Statement Id: [DAO00000_GetDUOC_DONGIADOANHTHU_NOIVIEN] PreparedStatement : [declare @doanhthu numeric(24,2);          declare @hotro numeric(24,2);          select top 1 @doanhthu = dg.DONGIA           from TM_DUOC_DONGIA dg          left join TM_DOITUONG_LOAIGIA dtlg on dtlg.LOAIGIA_ID = dg.LOAIGIA_ID                     where dg.DUOC_ID = '3' and dtlg.DOITUONG_ID = '6' and dg.DONGIA is not null and dg.DONGIA > 0                      order by dtlg.DOUUTIEN asc           select top 1 @hotro = dg.DONGIA           from TM_DUOC_DONGIA dg          left join TM_DOITUONG_LOAIGIA dtlg on dtlg.LOAIGIA_ID = dg.LOAIGIA_ID                     where dg.DUOC_ID = '3' and dtlg.DOITUONG_ID = '6' and dg.DONGIA is not null and dg.DONGIA > 0  and GIAHOTRO = '1'                     order by dtlg.DOUUTIEN asc              select ISNULL(@doanhthu,0.0) DONGIA_DOANHTHU, ISNULL(@hotro, 0.0) DONGIA_KHAC]
2019-08-14 17:44:05,209 [1] DEBUG - Statement Id: [DAO00000_GetDuocBHYT] PreparedStatement : [select count(*) BHYT FROM TM_DUOC A WHERE A.DUOC_ID = '3' and BHYT = '1']
2019-08-14 17:44:05,321 [1] DEBUG - Statement Id: [DAO00000_GetCHECK_DOITUONG_BHYT] PreparedStatement : [select count(*) as DOITUONG_BHYT FROM TM_DOITUONG A            WHERE A.DOITUONG_ID = '6' and A.BENHVIEN_ID = 'HLU01' and MADOITUONG like '%BHYT%']
2019-08-14 17:44:05,369 [1] DEBUG - Statement Id: [DAO00000_GetLOAIGIATHUOC_NOI_NGOAI_VIEN] PreparedStatement : [SELECT LOAIGIA_ID              FROM TM_LOAIGIA              WHERE MALOAIGIA = 'GiaThuoc_NoiVien' and BENHVIEN_ID = 'HLU01']
2019-08-14 17:44:05,395 [1] DEBUG - Statement Id: [DAO00000_GetDUOC_DONGIADOANHTHU_NOIVIEN] PreparedStatement : [declare @doanhthu numeric(24,2);          declare @hotro numeric(24,2);          select top 1 @doanhthu = dg.DONGIA           from TM_DUOC_DONGIA dg          left join TM_DOITUONG_LOAIGIA dtlg on dtlg.LOAIGIA_ID = dg.LOAIGIA_ID                     where dg.DUOC_ID = '3' and dtlg.DOITUONG_ID = '6' and dg.DONGIA is not null and dg.DONGIA > 0                      order by dtlg.DOUUTIEN asc           select top 1 @hotro = dg.DONGIA           from TM_DUOC_DONGIA dg          left join TM_DOITUONG_LOAIGIA dtlg on dtlg.LOAIGIA_ID = dg.LOAIGIA_ID                     where dg.DUOC_ID = '3' and dtlg.DOITUONG_ID = '6' and dg.DONGIA is not null and dg.DONGIA > 0  and GIAHOTRO = '1'                     order by dtlg.DOUUTIEN asc              select ISNULL(@doanhthu,0.0) DONGIA_DOANHTHU, ISNULL(@hotro, 0.0) DONGIA_KHAC]
2019-08-14 17:44:05,449 [1] DEBUG - Statement Id: [DAO00000_GetDuocBHYT] PreparedStatement : [select count(*) BHYT FROM TM_DUOC A WHERE A.DUOC_ID = '3' and BHYT = '1']
2019-08-14 17:44:11,696 [1] DEBUG - Statement Id: [DAO00066_GetBENHAN_TIEPNHAN] PreparedStatement : [select top 1 *        from TT_NOITRU_BENHAN        where TIEPNHAN_ID = '26730'  and BENHVIEN_ID = 'HLU01'        order by NGAYTAO desc]
2019-08-14 17:44:11,791 [1] DEBUG - Statement Id: [DAO00014_GetInPatientStatus] PreparedStatement : [select TRANGTHAI, isnull(KHOACHUYENDEN_ID, KHOAVAO_ID) as KHOAHIENTAI from TT_NOITRU_BENHAN        where        TIEPNHAN_ID = '26730'        and BENHVIEN_ID = 'HLU01'         and           BENHAN_ID = '5737']
2019-08-14 17:44:28,215 [1] DEBUG - Statement Id: [DAO00066_GetBENHAN_TIEPNHAN] PreparedStatement : [select top 1 *        from TT_NOITRU_BENHAN        where TIEPNHAN_ID = '26730'  and BENHVIEN_ID = 'HLU01'        order by NGAYTAO desc]
2019-08-14 17:44:28,293 [1] DEBUG - Statement Id: [DAO00014_GetInPatientStatus] PreparedStatement : [select TRANGTHAI, isnull(KHOACHUYENDEN_ID, KHOAVAO_ID) as KHOAHIENTAI from TT_NOITRU_BENHAN        where        TIEPNHAN_ID = '26730'        and BENHVIEN_ID = 'HLU01'         and           BENHAN_ID = '5737']
2019-08-14 17:44:28,373 [1] DEBUG - Statement Id: [DAO00066_GetBENHAN_TIEPNHAN] PreparedStatement : [select top 1 *        from TT_NOITRU_BENHAN        where TIEPNHAN_ID = '26730'  and BENHVIEN_ID = 'HLU01'        order by NGAYTAO desc]
2019-08-14 17:44:28,454 [1] DEBUG - Statement Id: [DAO00014_GetInPatientStatus] PreparedStatement : [select TRANGTHAI, isnull(KHOACHUYENDEN_ID, KHOAVAO_ID) as KHOAHIENTAI from TT_NOITRU_BENHAN        where        TIEPNHAN_ID = '26730'        and BENHVIEN_ID = 'HLU01'         and           BENHAN_ID = '5737']
2019-08-14 17:44:28,603 [1] DEBUG - Statement Id: [DAO00048_GetTrangThaiTruocKhiLuu_TuongTrinh] PreparedStatement : [SELECT PHAUTHUAT_YEUCAU_ID FROM TT_PHAUTHUAT_YEUCAU PTYC              WHERE BENHVIEN_ID ='HLU01'                and DVYEUCAU_ID in  (                        @param0                   )]
2019-08-14 17:44:28,603 [1] DEBUG - Statement Id: [DAO00048_GetTrangThaiTruocKhiLuu_TuongTrinh] Parameters: [@param0=[LISTDVYEUCAU_ID[0],202112]]
2019-08-14 17:44:28,603 [1] DEBUG - Statement Id: [DAO00048_GetTrangThaiTruocKhiLuu_TuongTrinh] Types: [@param0=[Int64, System.Int64]]
2019-08-14 17:44:28,882 [1] DEBUG - Statement Id: [DAO00063_KiemtraSoluongDuocXuatNgoaitru] PreparedStatement : [select A.TONKHO, isnull(B.BOOK_NGOAI,0) BOOK_NGOAI, isnull(D.BOOK_NOI,0) BOOK_NOI,  (A.TONKHO - isnull(B.BOOK_NGOAI,0) - isnull(D.BOOK_NOI,0)) TONKHO_BOOK        from(        select SUM(tk.SOLUONG) TONKHO, tk.DUOC_ID, sd.PHAMVI_ID, tk.NGUONDUOC_ID from TT_DUOC_TONKHO tk        inner join TM_DUOC_PHAMVISD_MAPPING sd on sd.KHODUOC_ID = tk.KHODUOC_ID        where sd.PHAMVI_ID  = '1052' and tk.DUOC_ID = '14' and tk.NGUONDUOC_ID = '1'        group by tk.DUOC_ID, sd.PHAMVI_ID, tk.NGUONDUOC_ID) A        left join (        select SUM(SOLUONG) BOOK_NGOAI,DUOC_ID, PHAMVI_ID, NGUONHANG_ID from TT_DUOC_TONKHO_BOOK_NGOAITRU        where PHAMVI_ID  = '1052' and DUOC_ID = '14' and NGUONHANG_ID = '1' and TRANGTHAI = 'HIEULUC' and SOLUONG > 0        group by DUOC_ID, PHAMVI_ID, NGUONHANG_ID) B on A.DUOC_ID = B.DUOC_ID and A.PHAMVI_ID = B.PHAMVI_ID and A.NGUONDUOC_ID = B.NGUONHANG_ID        left join (        select SUM(SOLUONG) BOOK_NOI,DUOC_ID, PHAMVI_ID, NGUONHANG_ID from TT_DUOC_TONKHO_BOOK_NOITRU        where PHAMVI_ID  = '1052' and DUOC_ID = '14' and NGUONHANG_ID = '1' and TRANGTHAI = 'HIEULUC'  and SOLUONG > 0        group by DUOC_ID, PHAMVI_ID, NGUONHANG_ID) D on A.DUOC_ID = D.DUOC_ID and A.PHAMVI_ID = D.PHAMVI_ID and A.NGUONDUOC_ID = D.NGUONHANG_ID]
2019-08-14 17:44:29,010 [1] DEBUG - Statement Id: [DAO00063_KiemtraSoluongDuocXuatNgoaitru] PreparedStatement : [select A.TONKHO, isnull(B.BOOK_NGOAI,0) BOOK_NGOAI, isnull(D.BOOK_NOI,0) BOOK_NOI,  (A.TONKHO - isnull(B.BOOK_NGOAI,0) - isnull(D.BOOK_NOI,0)) TONKHO_BOOK        from(        select SUM(tk.SOLUONG) TONKHO, tk.DUOC_ID, sd.PHAMVI_ID, tk.NGUONDUOC_ID from TT_DUOC_TONKHO tk        inner join TM_DUOC_PHAMVISD_MAPPING sd on sd.KHODUOC_ID = tk.KHODUOC_ID        where sd.PHAMVI_ID  = '1052' and tk.DUOC_ID = '3' and tk.NGUONDUOC_ID = '1'        group by tk.DUOC_ID, sd.PHAMVI_ID, tk.NGUONDUOC_ID) A        left join (        select SUM(SOLUONG) BOOK_NGOAI,DUOC_ID, PHAMVI_ID, NGUONHANG_ID from TT_DUOC_TONKHO_BOOK_NGOAITRU        where PHAMVI_ID  = '1052' and DUOC_ID = '3' and NGUONHANG_ID = '1' and TRANGTHAI = 'HIEULUC' and SOLUONG > 0        group by DUOC_ID, PHAMVI_ID, NGUONHANG_ID) B on A.DUOC_ID = B.DUOC_ID and A.PHAMVI_ID = B.PHAMVI_ID and A.NGUONDUOC_ID = B.NGUONHANG_ID        left join (        select SUM(SOLUONG) BOOK_NOI,DUOC_ID, PHAMVI_ID, NGUONHANG_ID from TT_DUOC_TONKHO_BOOK_NOITRU        where PHAMVI_ID  = '1052' and DUOC_ID = '3' and NGUONHANG_ID = '1' and TRANGTHAI = 'HIEULUC'  and SOLUONG > 0        group by DUOC_ID, PHAMVI_ID, NGUONHANG_ID) D on A.DUOC_ID = D.DUOC_ID and A.PHAMVI_ID = D.PHAMVI_ID and A.NGUONDUOC_ID = D.NGUONHANG_ID]
2019-08-14 17:44:31,637 [1] DEBUG - Statement Id: [DAO00050_GetDetail] PreparedStatement : [select *              from LST_KEYDATA_DICHVU               where                             LST_KEYDATA_DICHVU.KEYTYPE = 'SOPHIEUYEUCAUCLS'                       and                           LST_KEYDATA_DICHVU.KEYYEAR = '2019'                       and                           LST_KEYDATA_DICHVU.KEYMONTH = '0'                       and                           LST_KEYDATA_DICHVU.KEYDAY = '0'                       and                           LST_KEYDATA_DICHVU.SEGMENT_1 = '0621'                       and                           LST_KEYDATA_DICHVU.SEGMENT_2 = '0'                       and                           LST_KEYDATA_DICHVU.SEGMENT_3 = '0'                                     order by KEYTYPE]
2019-08-14 17:44:31,733 [1] DEBUG - Statement Id: [DAO00050_Update] PreparedStatement : [update LST_KEYDATA_DICHVU set              KEYVALUE =  @param0               where              KEYTYPE = 'SOPHIEUYEUCAUCLS'              AND KEYYEAR = '2019'              AND KEYMONTH = '0'              AND KEYDAY = '0'              AND SEGMENT_1 = '0621'              AND SEGMENT_2 = '0'              AND SEGMENT_3 = '0']
2019-08-14 17:44:31,733 [1] DEBUG - Statement Id: [DAO00050_Update] Parameters: [@param0=[KEYVALUE,03905]]
2019-08-14 17:44:31,733 [1] DEBUG - Statement Id: [DAO00050_Update] Types: [@param0=[String, System.String]]
2019-08-14 17:44:31,767 [1] DEBUG - Statement Id: [DAO00048_TT_PHAUTHUAT_Add] PreparedStatement : [insert into TT_PHAUTHUAT (            SOPHIEUPHAUTHUAT            , LOAI            , BENHAN_ID            , LUUTRU_ID            , TIEPNHAN_ID            , PHONGBANTHUCHIEN_ID            , NGAYTHUCHIEN            , THOIGIANBATDAU            , THOIGIANKETTHUC            , ICD_VAOKHOA            , ICD_VAOKHOA_MOTA            , ICD_TRUOCPHAUTHUAT            , ICD_TRUOCPHAUTHUAT_MOTA            , ICD_SAUPHAUTHUAT            , ICD_SAUPHAUTHUAT_MOTA            , NHOMDICHVU_ID            , DICHVU_ID            , PHUONGPHAPVOCAM_ID            , TAIBIEN_ID            , CHEDO_ID            , TUVONG_ID            , TRINHTUTHUCHIEN            , MOTA            , KETQUA            , BENHNHANBENNGOAI            , NGUONBENH_ID            , LOAIPHAUTHUAT            , DANLUU            , NGAYRUT            , NGAYCATCHI            , KHAC            , SOLANMOLAI            , LYDOMOLAI            , CANTHIEPPHAUTHUAT            , TUDIENKETQUA_ID            , PHONGBANCHIDINH_ID            , PPMO_ID            , THOIGIANGAYME            , KHOADULIEU            , NGUOIKHOA_ID            , TENNGUOIKHOA            , NGAYKHOADULIEU            , THOIGIANKHOADULIEU            , NGAYTAO            , NGUOITAO_ID            , NGAYCAPNHAT            , NGUOICAPNHAT_ID            , BENHVIEN_ID                         ) values (             @param0             ,  @param1             ,  @param2             ,  @param3             ,  @param4             ,  @param5             ,  @param6             ,  @param7             ,  @param8             ,  @param9             ,  @param10             ,  @param11             ,  @param12             ,  @param13             ,  @param14             ,  @param15             ,  @param16             ,  @param17             ,  @param18             ,  @param19             ,  @param20             ,  @param21             ,  @param22             ,  @param23             ,  @param24             ,  @param25             ,  @param26             ,  @param27             ,  @param28             ,  @param29             ,  @param30             ,  @param31             ,  @param32             ,  @param33             ,  @param34             ,  @param35             ,  @param36             ,  @param37             ,  @param38             ,  @param39             ,  @param40             ,  @param41             ,  @param42             ,  @param43             ,  @param44             ,  @param45             ,  @param46             ,  @param47                            )              SELECT SCOPE_IDENTITY()]
2019-08-14 17:44:31,822 [1] DEBUG - Statement Id: [DAO00048_TT_PHAUTHUAT_Add] Parameters: [@param0=[SOPHIEUPHAUTHUAT,19.P.03905], @param1=[LOAI,P], @param2=[BENHAN_ID,5737], @param3=[LUUTRU_ID,null], @param4=[TIEPNHAN_ID,26730], @param5=[PHONGBANTHUCHIEN_ID,25], @param6=[NGAYTHUCHIEN,8/14/2019 5:44:31 PM], @param7=[THOIGIANBATDAU,8/14/2019 5:44:00 PM], @param8=[THOIGIANKETTHUC,8/14/2019 6:44:00 PM], @param9=[ICD_VAOKHOA,null], @param10=[ICD_VAOKHOA_MOTA,null], @param11=[ICD_TRUOCPHAUTHUAT,null], @param12=[ICD_TRUOCPHAUTHUAT_MOTA,null], @param13=[ICD_SAUPHAUTHUAT,null], @param14=[ICD_SAUPHAUTHUAT_MOTA,null], @param15=[NHOMDICHVU_ID,null], @param16=[DICHVU_ID,null], @param17=[PHUONGPHAPVOCAM_ID,null], @param18=[TAIBIEN_ID,null], @param19=[CHEDO_ID,768], @param20=[TUVONG_ID,null], @param21=[TRINHTUTHUCHIEN,null], @param22=[MOTA,null], @param23=[KETQUA,null], @param24=[BENHNHANBENNGOAI,null], @param25=[NGUONBENH_ID,745], @param26=[LOAIPHAUTHUAT,PTM], @param27=[DANLUU,null], @param28=[NGAYRUT,null], @param29=[NGAYCATCHI,null], @param30=[KHAC,null], @param31=[SOLANMOLAI,null], @param32=[LYDOMOLAI,null], @param33=[CANTHIEPPHAUTHUAT,null], @param34=[TUDIENKETQUA_ID,null], @param35=[PHONGBANCHIDINH_ID,null], @param36=[PPMO_ID,null], @param37=[THOIGIANGAYME,null], @param38=[KHOADULIEU,0], @param39=[NGUOIKHOA_ID,null], @param40=[TENNGUOIKHOA,null], @param41=[NGAYKHOADULIEU,null], @param42=[THOIGIANKHOADULIEU,null], @param43=[NGAYTAO,8/14/2019 5:44:31 PM], @param44=[NGUOITAO_ID,1], @param45=[NGAYCAPNHAT,8/14/2019 5:44:31 PM], @param46=[NGUOICAPNHAT_ID,1], @param47=[BENHVIEN_ID,HLU01]]
2019-08-14 17:44:31,822 [1] DEBUG - Statement Id: [DAO00048_TT_PHAUTHUAT_Add] Types: [@param0=[String, System.String], @param1=[String, System.String], @param2=[Int64, System.Int64], @param3=[System.DBNull, null], @param4=[Int64, System.Int64], @param5=[Int64, System.Int64], @param6=[DateTime, System.DateTime], @param7=[DateTime, System.DateTime], @param8=[DateTime, System.DateTime], @param9=[System.DBNull, null], @param10=[System.DBNull, null], @param11=[System.DBNull, null], @param12=[System.DBNull, null], @param13=[System.DBNull, null], @param14=[System.DBNull, null], @param15=[System.DBNull, null], @param16=[System.DBNull, null], @param17=[System.DBNull, null], @param18=[System.DBNull, null], @param19=[Int64, System.Int64], @param20=[System.DBNull, null], @param21=[System.DBNull, null], @param22=[System.DBNull, null], @param23=[System.DBNull, null], @param24=[System.DBNull, null], @param25=[Int64, System.Int64], @param26=[String, System.String], @param27=[System.DBNull, null], @param28=[System.DBNull, null], @param29=[System.DBNull, null], @param30=[System.DBNull, null], @param31=[System.DBNull, null], @param32=[System.DBNull, null], @param33=[System.DBNull, null], @param34=[System.DBNull, null], @param35=[System.DBNull, null], @param36=[System.DBNull, null], @param37=[System.DBNull, null], @param38=[String, System.String], @param39=[System.DBNull, null], @param40=[System.DBNull, null], @param41=[System.DBNull, null], @param42=[System.DBNull, null], @param43=[DateTime, System.DateTime], @param44=[Int64, System.Int64], @param45=[DateTime, System.DateTime], @param46=[Int64, System.Int64], @param47=[String, System.String]]
2019-08-14 17:44:31,863 [1] DEBUG - Statement Id: [DAO00048_TT_PHAUTHUAT_YEUCAU_Add] PreparedStatement : [insert into TT_PHAUTHUAT_YEUCAU (              PHAUTHUAT_ID              , DVYEUCAU_ID              , NHOMDICHVU_ID              , DICHVU_ID              , LOAIGIA_ID              , THANHTIEN_DOANHTHU              , BHYT_THANHTIEN_CHITRA              , BENHNHAN_PHAITHANHTOAN              , BENHVIEN_ID              ) values (               @param0               ,  @param1               ,  @param2               ,  @param3               ,  @param4               ,  @param5               ,  @param6               ,  @param7               ,  @param8               )]
2019-08-14 17:44:31,864 [1] DEBUG - Statement Id: [DAO00048_TT_PHAUTHUAT_YEUCAU_Add] Parameters: [@param0=[PHAUTHUAT_ID,3745], @param1=[DVYEUCAU_ID,202112], @param2=[NHOMDICHVU_ID,29], @param3=[DICHVU_ID,3329], @param4=[LOAIGIA_ID,2], @param5=[THANHTIEN_DOANHTHU,949000], @param6=[BHYT_THANHTIEN_CHITRA,949000], @param7=[BENHNHAN_PHAITHANHTOAN,0], @param8=[BENHVIEN_ID,HLU01]]
2019-08-14 17:44:31,864 [1] DEBUG - Statement Id: [DAO00048_TT_PHAUTHUAT_YEUCAU_Add] Types: [@param0=[Int64, System.Int64], @param1=[Int64, System.Int64], @param2=[Int64, System.Int64], @param3=[Int64, System.Int64], @param4=[Int64, System.Int64], @param5=[Double, System.Double], @param6=[Double, System.Double], @param7=[Double, System.Double], @param8=[String, System.String]]
2019-08-14 17:44:31,895 [1] DEBUG - Statement Id: [DAO00048_UpdateDVYeuCauVienPhi] PreparedStatement : [update  TT_VIENPHI              set DATHUCHIEN = '1',              NGUOICAPNHAT_ID =  @param0 ,              NGAYCAPNHAT =  @param1               where              VIENPHI_ID =  @param2]
2019-08-14 17:44:31,895 [1] DEBUG - Statement Id: [DAO00048_UpdateDVYeuCauVienPhi] Parameters: [@param0=[NGUOICAPNHAT_ID,1], @param1=[NGAYCAPNHAT,8/14/2019 5:44:31 PM], @param2=[VIENPHI_ID,664171]]
2019-08-14 17:44:31,895 [1] DEBUG - Statement Id: [DAO00048_UpdateDVYeuCauVienPhi] Types: [@param0=[Int64, System.Int64], @param1=[DateTime, System.DateTime], @param2=[Int64, System.Int64]]
2019-08-14 17:44:31,932 [1] DEBUG - Statement Id: [DAO00048_UpdateDVYeuCau] PreparedStatement : [update  TT_DVYEUCAU              set TRANGTHAI =  @param0 ,              NGUOICAPNHAT_ID =  @param1 ,              NGAYCAPNHAT =  @param2               where              DVYEUCAU_ID =  @param3]
2019-08-14 17:44:31,932 [1] DEBUG - Statement Id: [DAO00048_UpdateDVYeuCau] Parameters: [@param0=[TRANGTHAI,CHOXACNHAN], @param1=[NGUOICAPNHAT_ID,1], @param2=[NGAYCAPNHAT,8/14/2019 5:44:31 PM], @param3=[DVYEUCAU_ID,202112]]
2019-08-14 17:44:31,932 [1] DEBUG - Statement Id: [DAO00048_UpdateDVYeuCau] Types: [@param0=[String, System.String], @param1=[Int64, System.Int64], @param2=[DateTime, System.DateTime], @param3=[Int64, System.Int64]]
2019-08-14 17:44:31,963 [1] DEBUG - Statement Id: [DAO00048_TT_PHAUTHUAT_PPVOCAM_Add] PreparedStatement : [insert into TT_PHAUTHUAT_PPVOCAM (              PHAUTHUAT_ID,              PPVOCAM_ID,              BENHVIEN_ID)              values (               @param0 ,               @param1 ,               @param2 )]
2019-08-14 17:44:31,964 [1] DEBUG - Statement Id: [DAO00048_TT_PHAUTHUAT_PPVOCAM_Add] Parameters: [@param0=[PHAUTHUAT_ID,3745], @param1=[PPVOCAM_ID,1832], @param2=[BENHVIEN_ID,HLU01]]
2019-08-14 17:44:31,964 [1] DEBUG - Statement Id: [DAO00048_TT_PHAUTHUAT_PPVOCAM_Add] Types: [@param0=[Int64, System.Int64], @param1=[Int64, System.Int64], @param2=[String, System.String]]
2019-08-14 17:44:32,016 [1] DEBUG - Statement Id: [DAO00048_TT_PHAUTHUAT_EKIP_Add] PreparedStatement : [insert into TT_PHAUTHUAT_EKIP (              PHAUTHUAT_ID                ,                       NHANVIEN_ID                   ,                       VAITRO_ID                                 , PTVC_ID              , PPT1_ID              , PPT2_ID              , GMC_ID              , GMP_ID              , DCVT_ID              , DCVN_ID              , BSHC_ID              , BSTC_ID              , BENHVIEN_ID              ) values (               @param0                 ,                        @param1                    ,                        @param2                                  ,  @param3               ,  @param4               ,  @param5               ,  @param6               ,  @param7               ,  @param8               ,  @param9               ,  @param10               ,  @param11               ,  @param12               )]
2019-08-14 17:44:32,016 [1] DEBUG - Statement Id: [DAO00048_TT_PHAUTHUAT_EKIP_Add] Parameters: [@param0=[PHAUTHUAT_ID,3745], @param1=[NHANVIEN_ID,34], @param2=[VAITRO_ID,748], @param3=[PTVC_ID,null], @param4=[PPT1_ID,null], @param5=[PPT2_ID,null], @param6=[GMC_ID,null], @param7=[GMP_ID,null], @param8=[DCVT_ID,null], @param9=[DCVN_ID,null], @param10=[BSHC_ID,null], @param11=[BSTC_ID,null], @param12=[BENHVIEN_ID,HLU01]]
2019-08-14 17:44:32,016 [1] DEBUG - Statement Id: [DAO00048_TT_PHAUTHUAT_EKIP_Add] Types: [@param0=[Int64, System.Int64], @param1=[Int64, System.Int64], @param2=[Int64, System.Int64], @param3=[System.DBNull, null], @param4=[System.DBNull, null], @param5=[System.DBNull, null], @param6=[System.DBNull, null], @param7=[System.DBNull, null], @param8=[System.DBNull, null], @param9=[System.DBNull, null], @param10=[System.DBNull, null], @param11=[System.DBNull, null], @param12=[String, System.String]]
2019-08-14 17:44:32,133 [1] DEBUG - Statement Id: [DAO00048_GetlistvtytBeforeDelete] PreparedStatement : [select * from TT_PHAUTHUAT_VTYT where PHAUTHUAT_ID = 3745]
2019-08-14 17:44:32,163 [1] DEBUG - Statement Id: [DAO00062_GetKhoThuocCosoKhongCoso] PreparedStatement : [select distinct kd.KHODUOC_ID, lst.DICTIONARY_CODE  LOAIKHO from TM_KHODUOC kd        left join TM_PHONGBAN_KHODUOC pbkd        on kd.KHODUOC_ID = pbkd.KHODUOC_ID        and kd.BENHVIEN_ID = pbkd.BENHVIEN_ID        left join LST_DICTIONARY lst on lst.DICTIONARY_ID = kd.LOAIKHO_ID        where lst.DICTIONARY_CODE = 'Coso']
2019-08-14 17:44:32,191 [1] DEBUG - Statement Id: [DAO00062_GetAllPhamviKhoDuoc] PreparedStatement : [select distinct dmap.*        from TM_DUOC_PHAMVISD_MAPPING dmap        left join TM_DUOC_PHAMVISUDUNG dpv on dpv.PHAMVI_ID = dmap.PHAMVI_ID]
2019-08-14 17:44:32,218 [1] DEBUG - Statement Id: [DAO00023_GetSOBHYT_HUONG_ID] PreparedStatement : [select isnull(MAX(SOBHYT_HUONG_ID),0) SOBHYT_HUONG_ID        from TT_TIEPNHAN_SOTHEBHYT        where TIEPNHAN_ID = '26730']
2019-08-14 17:44:32,361 [1] DEBUG - Statement Id: [DAO00304_DotDieuTriID] PreparedStatement : [select top 1 DOTDIEUTRI_ID        from TT_NOITRU_DOTDIEUTRI        where BENHAN_ID = 5737 and TRANGTHAI='0'        order by DOTDIEUTRI_ID DESC]
2019-08-14 17:44:32,413 [1] DEBUG - Statement Id: [DAO00304_DotDieuTriID] PreparedStatement : [select top 1 DOTDIEUTRI_ID        from TT_NOITRU_DOTDIEUTRI        where BENHAN_ID = 5737 and TRANGTHAI='0'        order by DOTDIEUTRI_ID DESC]
2019-08-14 17:44:32,441 [1] DEBUG - Statement Id: [DAO00048_Add_GhiNhanVTYT_Phauthuat] PreparedStatement : [declare @jsonVienPhi nvarchar(max);          set @jsonVienPhi = N'{          "DATA": [{"COSO":"1","UID":"efcf8f85-76c7-44ec-8ecd-e0c5a4077827","PHAUTHUAT_VTYT_ID":0,"PHAUTHUAT_ID":3745,"STT":null,"CHUNGTU_ID":null,"CHUNGTUTONGHOP_ID":null,"KHOSUDUNG_ID":null,"KHODUOC_ID":null,"KHOTAO_ID":29,"KHOPHAT_ID":29,"PHAMVI_ID":1052,"NGAYSUDUNG":"2019-08-14T17:43:55.6726902+07:00","NGUONHANG_ID":1,"NGUONDUOC_ID":1,"TRANGTHAI_XEM":null,"NGUONGOCDULIEU":null,"NGUOITAO_ID":1,"NGAYTAO":"2019-08-14T17:43:55.6726902+07:00","BENHVIEN_ID":"HLU01","TENKHO":"TT Khoa Phẫu thuật - Gây mê hồi sức","DUOC_ID":14,"DUOC_KEY":"1052_14_1","MADUOC":"VT608","TENDUOCDAYDU":"(Kim luồn tĩnh mạch có cánh có cửa bơm thuốc JCM) ","DONVITINH":"Cái","DUOC_BHYT":false,"DONGIABAN":null,"SOLUONG":1.0,"BOOKED_SOLUONG":0.0,"BookedSoLuong":0.0,"THANHTIEN_DOANHTHU":6380.0,"THANHTIEN":6380.0,"DONGIA_DOANHTHU":6380.0,"BHYT_DONGIA":0.0,"BHYT_THANHTIEN":0.0,"NGUONDUOC":"Nguồn Mua","TINHTIEN":"1","BNTUCHITRA":"0","GHICHU":null,"TONKHO":null,"SOPHIEULINH":null,"SOPHIEUXUAT":null,"BHYTDONGTIEN":"0","KHONGTHUTIEN":"0","DOITUONG_HUONG_ID":6,"SOBHYT_HUONG_ID":27750,"LOAI_CHIPHI":"TT","TIEPNHAN_ID":26730,"BENHNHAN_ID":15236,"BENHAN_ID":5737,"REF_TABLE":"TT_PHAUTHUAT_VTYT","DICHVU_ID":null,"ACTIVE":"1"},{"COSO":"1","UID":"7990bf0c-2512-4303-b4c4-6738aacdd329","PHAUTHUAT_VTYT_ID":0,"PHAUTHUAT_ID":3745,"STT":null,"CHUNGTU_ID":null,"CHUNGTUTONGHOP_ID":null,"KHOSUDUNG_ID":null,"KHODUOC_ID":null,"KHOTAO_ID":29,"KHOPHAT_ID":29,"PHAMVI_ID":1052,"NGAYSUDUNG":"2019-08-14T17:44:05.3203519+07:00","NGUONHANG_ID":1,"NGUONDUOC_ID":1,"TRANGTHAI_XEM":null,"NGUONGOCDULIEU":null,"NGUOITAO_ID":1,"NGAYTAO":"2019-08-14T17:44:05.3203519+07:00","BENHVIEN_ID":"HLU01","TENKHO":"TT Khoa Phẫu thuật - Gây mê hồi sức","DUOC_ID":3,"DUOC_KEY":"1052_3_1","MADUOC":"VT788","TENDUOCDAYDU":"(Bơm tiêm nhựa 5ml) ","DONVITINH":"Cái","DUOC_BHYT":false,"DONGIABAN":null,"SOLUONG":2.0,"BOOKED_SOLUONG":0.0,"BookedSoLuong":0.0,"THANHTIEN_DOANHTHU":1260.0,"THANHTIEN":1260.0,"DONGIA_DOANHTHU":630.0,"BHYT_DONGIA":0.0,"BHYT_THANHTIEN":0.0,"NGUONDUOC":"Nguồn Mua","TINHTIEN":"1","BNTUCHITRA":"0","GHICHU":null,"TONKHO":null,"SOPHIEULINH":null,"SOPHIEUXUAT":null,"BHYTDONGTIEN":"0","KHONGTHUTIEN":"0","DOITUONG_HUONG_ID":6,"SOBHYT_HUONG_ID":27750,"LOAI_CHIPHI":"TT","TIEPNHAN_ID":26730,"BENHNHAN_ID":15236,"BENHAN_ID":5737,"REF_TABLE":"TT_PHAUTHUAT_VTYT","DICHVU_ID":null,"ACTIVE":"1"}]          }';            declare @PHAUTHUAT_VTYT_ID int;          declare @BENHAN_ID int;          declare @PHAUTHUAT_ID int;          declare @TIEPNHAN_ID int;          declare @BENHNHAN_ID int;          declare @NGUONDUOC_ID int;          declare @DUOC_ID int;          declare @SOLUONG numeric(18, 4);          declare @GHICHU nvarchar(100);          declare @COSO char(1);          declare @KHOTAO_ID int;          declare @KHOPHAT_ID int;          declare @PHAMVI_ID int;          declare @TINHTIEN char(1);          declare @NGUONHANG_ID int;          declare @DONGIA_DOANHTHU numeric(25, 4);          declare @THANHTIEN_DOANHTHU numeric(25, 4);          declare @BHYT_DONGIA numeric(25, 4);          declare @BHYT_THANHTIEN numeric(25, 4);          declare @DOITUONG_HUONG_ID numeric(25, 4);          declare @SOBHYT_HUONG_ID numeric(25, 4);          declare @BHYTDONGTIEN char(1);          declare @KHONGTHUTIEN char(1);          declare @NGUOITAO_ID int =  @param0 ;          declare @NGUOICAPNHAT_ID int =  @param1 ;          declare @BENHVIEN_ID varchar(10) =  @param2 ;          declare @DOTDIEUTRI_ID int;            declare @iTotal int =  @param3 ;          declare @icnt int = 0;          WHILE @iTotal > @icnt          BEGIN          declare @dyn_sql nvarchar(1000) = 'select @data = json_query(@json_dyn, ''' + CHAR(36) +'.DATA[' + cast(@icnt as varchar(10)) + ']'');'          declare @jsondatamax nvarchar(max);            exec sp_executesql @dyn_sql          , N'@json_dyn nvarchar(max), @data nvarchar(max) OUTPUT'          , @json_dyn = @jsonVienPhi          , @data = @jsondatamax OUTPUT            select          @BENHAN_ID =  JSON_VALUE(@jsondatamax, '' + CHAR(36) +'.BENHAN_ID'),          @PHAUTHUAT_ID =  JSON_VALUE(@jsondatamax, '' + CHAR(36) +'.PHAUTHUAT_ID'),          @TIEPNHAN_ID =  JSON_VALUE(@jsondatamax, '' + CHAR(36) +'.TIEPNHAN_ID'),          @BENHNHAN_ID =  JSON_VALUE(@jsondatamax, '' + CHAR(36) +'.BENHNHAN_ID'),          @NGUONDUOC_ID =  JSON_VALUE(@jsondatamax, '' + CHAR(36) +'.NGUONDUOC_ID'),          @DUOC_ID =  JSON_VALUE(@jsondatamax, '' + CHAR(36) +'.DUOC_ID'),          @GHICHU =  JSON_VALUE(@jsondatamax, '' + CHAR(36) +'.GHICHU'),          @SOLUONG =  JSON_VALUE(@jsondatamax, '' + CHAR(36) +'.SOLUONG'),          @COSO =  JSON_VALUE(@jsondatamax, '' + CHAR(36) +'.COSO'),          @KHOTAO_ID =  JSON_VALUE(@jsondatamax, '' + CHAR(36) +'.KHOTAO_ID'),          @KHOPHAT_ID =  JSON_VALUE(@jsondatamax, '' + CHAR(36) +'.KHOPHAT_ID'),          @TINHTIEN =  JSON_VALUE(@jsondatamax, '' + CHAR(36) +'.TINHTIEN'),          @BHYTDONGTIEN =  JSON_VALUE(@jsondatamax, '' + CHAR(36) +'.BHYTDONGTIEN'),          @KHONGTHUTIEN =  JSON_VALUE(@jsondatamax, '' + CHAR(36) +'.KHONGTHUTIEN'),          @NGUONHANG_ID =  JSON_VALUE(@jsondatamax, '' + CHAR(36) +'.NGUONHANG_ID'),            @NGUOITAO_ID =  JSON_VALUE(@jsondatamax, '' + CHAR(36) +'.NGUOITAO_ID'),          @NGUOICAPNHAT_ID =  JSON_VALUE(@jsondatamax, '' + CHAR(36) +'.NGUOICAPNHAT_ID'),          @PHAMVI_ID =  JSON_VALUE(@jsondatamax, '' + CHAR(36) +'.PHAMVI_ID'),          @DOITUONG_HUONG_ID =  JSON_VALUE(@jsondatamax, '' + CHAR(36) +'.DOITUONG_HUONG_ID'),          @SOBHYT_HUONG_ID =  JSON_VALUE(@jsondatamax, '' + CHAR(36) +'.SOBHYT_HUONG_ID'),            @DONGIA_DOANHTHU =  JSON_VALUE(@jsondatamax, '' + CHAR(36) +'.DONGIA_DOANHTHU'),          @THANHTIEN_DOANHTHU =  JSON_VALUE(@jsondatamax, '' + CHAR(36) +'.THANHTIEN_DOANHTHU'),          @BHYT_DONGIA =  JSON_VALUE(@jsondatamax, '' + CHAR(36) +'.BHYT_DONGIA'),          @BHYT_THANHTIEN =  JSON_VALUE(@jsondatamax, '' + CHAR(36) +'.BHYT_THANHTIEN'),          @DOTDIEUTRI_ID =  JSON_VALUE(@jsondatamax, '' + CHAR(36) +'.DOTDIEUTRI_ID')            INSERT INTO [TT_PHAUTHUAT_VTYT]          ([PHAUTHUAT_ID], [DUOC_ID], [SOLUONG] ,[KHOTAO_ID] ,[KHOSUDUNG_ID] ,[TINHTIEN],[BNTUCHITRA] ,[NGAYSUDUNG] ,[NGUONHANG_ID]          ,[COSO], [GHICHU] ,[NGUOITAO_ID] ,[NGAYTAO] ,[NGUOICAPNHAT_ID],[NGAYCAPNHAT],[BENHVIEN_ID] ,[PHAMVI_ID],[KHOPHAT_ID])          VALUES          (@PHAUTHUAT_ID,@DUOC_ID,@SOLUONG,@KHOTAO_ID,@KHOTAO_ID, @TINHTIEN, @BHYTDONGTIEN,GETDATE(),@NGUONHANG_ID          ,@COSO, @GHICHU, @NGUOITAO_ID, GETDATE(), @NGUOICAPNHAT_ID, GETDATE(), @BENHVIEN_ID, @PHAMVI_ID, @KHOPHAT_ID)                    set @PHAUTHUAT_VTYT_ID = SCOPE_IDENTITY()                      INSERT INTO TT_VIENPHI          ([TIEPNHAN_ID],[BENHAN_ID]          ,[BENHNHAN_ID],[KHAMBENH_ID],[REF_ID],[REF_TABLE],[DICHVU_ID],[DUOC_ID],[LOAI_CHIPHI]          ,[SOLUONG],[DONGIA_DOANHTHU],[THANHTIEN_DOANHTHU],[BHYT_DONGIA],[BHYT_THANHTIEN],[HUY],[DATHANHTOAN]          ,[DATHUCHIEN],[KHONGTHUTIEN],[BHYTDONGTIEN],[BENHVIEN_ID],[NGUOITAO_ID],[NGAYTAO],[NGUOICAPNHAT_ID],[NGAYCAPNHAT], [DOITUONG_HUONG_ID], [SOBHYT_HUONG_ID], [DOTDIEUTRI_ID])          VALUES          (@TIEPNHAN_ID,@BENHAN_ID          ,@BENHNHAN_ID,@PHAUTHUAT_ID,@PHAUTHUAT_VTYT_ID,'TT_PHAUTHUAT_VTYT',null,@DUOC_ID,'TT'          ,@SOLUONG,@DONGIA_DOANHTHU,@THANHTIEN_DOANHTHU,@BHYT_DONGIA,@BHYT_THANHTIEN,'0','0'          ,'0',@KHONGTHUTIEN,@BHYTDONGTIEN,@BENHVIEN_ID,@NGUOITAO_ID,GETDATE(),@NGUOICAPNHAT_ID,GETDATE(), @DOITUONG_HUONG_ID, @SOBHYT_HUONG_ID, @DOTDIEUTRI_ID)                      insert into TT_DUOC_TONKHO_BOOK_NGOAITRU          ([REF_TABLE],[REF_ID],[PHAMVI_ID],[KHODUOC_ID],[DUOC_ID],[SOLUONG],[NGUONHANG_ID]          ,[GHICHU],[BENHVIEN_ID],[NGAYTAO],[NGUOITAO_ID],[NGAYCAPNHAT],[NGUOICAPNHAT_ID], [TRANGTHAI])          VALUES          ('TT_PHAUTHUAT_VTYT',@PHAUTHUAT_VTYT_ID,@PHAMVI_ID,@KHOPHAT_ID,@DUOC_ID,@SOLUONG,@NGUONHANG_ID          ,@GHICHU,@BENHVIEN_ID,GETDATE(),@NGUOITAO_ID,GETDATE(),@NGUOICAPNHAT_ID, 'HIEULUC')            set @icnt = @icnt + 1;          END]
2019-08-14 17:44:32,441 [1] DEBUG - Statement Id: [DAO00048_Add_GhiNhanVTYT_Phauthuat] Parameters: [@param0=[NGUOITAO_ID,1], @param1=[NGUOICAPNHAT_ID,1], @param2=[BENHVIEN_ID,HLU01], @param3=[TOTAL_RECORD,2]]
2019-08-14 17:44:32,441 [1] DEBUG - Statement Id: [DAO00048_Add_GhiNhanVTYT_Phauthuat] Types: [@param0=[Int64, System.Int64], @param1=[Int64, System.Int64], @param2=[String, System.String], @param3=[Int32, System.Int32]]
2019-08-14 17:44:32,917 [1] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoVaBookingCOM23UpdateRedis] PreparedStatement : [select  distinct tk.DUOC_KEY, LTRIM(tk.PHAMVI_ID) as PHAMVI_ID, tk.NGUONDUOC_ID, nh.TENNGUONDUOC, nh.TINHTIEN, d.DUOC_ID, ld.MALOAIDUOC,        d.SOVISA,d.TYLE_VAT,d.COTOA, d.MADUOC, d.TENHANG, d.TENDUOCDAYDU, dvt.TENDONVITINH as DONVITINH, d.BHYT,        d.TENHOATCHAT, d.HAMLUONG, d.HANGSANXUAT, d.QUOCGIA, d.LOAIDUOC_ID, d.DUONGDUNG_ID, d.TINHTIEN_PTTT,        ten.TENDUOC, ten.TENDUOC_EN, ten.MAQUOCTE, ten.MAQUOCTEBT,        CASE WHEN d.BHYT = '1' THEN 'BHYT' ELSE '' END as BHYT_TEXT        , ld.LOAIVATTU_ID        , d.BENHVIEN_ID,        tk.SOLUONG, d.VTYT_PHANLOAI, d.PHAMVI, d.SUASOLUONGTONGHOP, d.MADUOCBV, d.DANGTRINHBAY        , TAMNGUNG = CASE WHEN d.TAMNGUNG = '1' OR nh.TAMNGUNG = '1' OR kd.TAMNGUNG = '1' THEN '1' ELSE '0' END        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        inner join        (        select  LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')) DUOC_KEY, (SUM(dtk.SOLUONG) - isnull(sum(A.SOLUONG),0) - isnull(sum(B.SOLUONG),0)) SOLUONG, pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        from (select sum(soluong) soluong,duoc_id,nguonduoc_id,khoduoc_id,benhvien_id from TT_DUOC_TONKHO  group by duoc_id,nguonduoc_id,khoduoc_id,benhvien_id) dtk        inner join TM_DUOC_PHAMVISD_MAPPING pvsd on dtk.KHODUOC_ID = pvsd.KHODUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NOITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) B on B.DUOC_ID = dtk.DUOC_ID and B.SOLUONG > 0 and B.PHAMVI_ID = pvsd.PHAMVI_ID and B.NGUONHANG_ID = dtk.NGUONDUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NGOAITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) A on A.DUOC_ID = dtk.DUOC_ID and A.SOLUONG > 0 and A.PHAMVI_ID = pvsd.PHAMVI_ID and A.NGUONHANG_ID = dtk.NGUONDUOC_ID        where dtk.SOLUONG > 0 and dtk.BENHVIEN_ID = 'HLU01'        group by LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')), pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        ) tk on tk.DUOC_ID = d.DUOC_ID        left join TM_DUOC_PHAMVISUDUNG kd on kd.PHAMVI_ID = tk.PHAMVI_ID and kd.BENHVIEN_ID = 'HLU01'        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = tk.NGUONDUOC_ID and nh.BENHVIEN_ID = 'HLU01'        where  d.BENHVIEN_ID = 'HLU01' and d.DUOC_ID in (14,3)]
2019-08-14 17:44:35,621 [1] DEBUG - Statement Id: [DAO00030_GetKhoDuoc] PreparedStatement : [SELECT *            FROM            TM_KHODUOC            WHERE            KHODUOC_ID= '29'            and BENHVIEN_ID= 'HLU01']
2019-08-14 17:44:35,661 [1] DEBUG - Statement Id: [DAO00030_GetMucDichChungTuID] PreparedStatement : [SELECT DICTIONARY_ID              FROM              LST_DICTIONARY              WHERE              DICTIONARY_TYPE_CODE = 'MucDichChungTu'              and DICTIONARY_CODE = 'X13']
2019-08-14 17:44:35,696 [1] DEBUG - Statement Id: [DAO00036_GetDetail] PreparedStatement : [select KEYTYPE, KEYYEAR, KEYMONTH, KEYDAY, SEGMENT_1, SEGMENT_2, SEGMENT_3, KEYVALUE              from LST_KEYDATA_DUOCPHAM as kd               WHERE                        kd.KEYTYPE = 'SOCHUNGTUNHAPXUATBENNGOAI'                   AND                       kd.KEYYEAR = '2019'                   AND                       kd.KEYMONTH = '0'                   AND                       kd.KEYDAY = '0'                   AND                       kd.SEGMENT_1 = 'CS_GMHS'                   AND                       kd.SEGMENT_2 = 'X13'                   AND                       kd.SEGMENT_3 = ' ']
2019-08-14 17:44:35,836 [1] DEBUG - Statement Id: [DAO00036_Update] PreparedStatement : [update LST_KEYDATA_DUOCPHAM set              KEYVALUE =  @param0               where              KEYTYPE = 'SOCHUNGTUNHAPXUATBENNGOAI'              AND KEYYEAR = '2019'              AND KEYMONTH = '0'              AND KEYDAY = '0'              AND SEGMENT_1 = 'CS_GMHS'              AND SEGMENT_2 = 'X13'              AND SEGMENT_3 = ' ']
2019-08-14 17:44:35,836 [1] DEBUG - Statement Id: [DAO00036_Update] Parameters: [@param0=[KEYVALUE,002655]]
2019-08-14 17:44:35,836 [1] DEBUG - Statement Id: [DAO00036_Update] Types: [@param0=[String, System.String]]
2019-08-14 17:44:36,824 [1] DEBUG - Statement Id: [DAO00030_GetGhiNhanPhauThuatVTYT] PreparedStatement : [SELECT            N'Người bệnh: ' + bn.MAYTE + ' - ' + bn.TENBENHNHAN + ' - ' +  CONVERT(VARCHAR(10), pt.NGAYTHUCHIEN, 103) + ' - ' + CONVERT(VARCHAR(5), pt.NGAYTHUCHIEN, 108) as BENHNHAN            ,vtyt.*             FROM TT_PHAUTHUAT_VTYT vtyt            INNER JOIN TT_PHAUTHUAT pt on pt.PHAUTHUAT_ID = vtyt.PHAUTHUAT_ID            INNER JOIN dbo.TT_TIEPNHAN tn on tn.TIEPNHAN_ID = pt.TIEPNHAN_ID            INNER JOIN TT_BENHNHAN bn on bn.BENHNHAN_ID = tn.BENHNHAN_ID                      WHERE            pt.PHAUTHUAT_ID= '3745'            and vtyt.COSO = '1'      and vtyt.CHUNGTU_ID is null]
2019-08-14 17:44:36,873 [1] DEBUG - Statement Id: [DAO00030_GET_SOLONHAP_XUATSUDUNG] PreparedStatement : [SELECT DISTINCT            SLN.SOLONHAP_ID, SLN.SOLONHAP, SLN.SOLOSANPHAM, SLN.SOKIEMSOAT, SLN.SOVISA, CONVERT(varchar(20), SLN.SOLOSANPHAM) + '/' + CONVERT(varchar(20), TK.SOLUONG) AS SOLOSOTON,            SLN.NGAYNHAP AS NGAYNHAPLO, SLN.HANDUNG AS HANSUDUNG,  SLN.HANDUNG, SLN.NGUONDUOC_ID, SLN.NGUONDUOC_ID as NGUONHANG_ID,            SLNGB.DONGIAMUA, SLNGB.DONGIAVON, SLNGB.TYLEVAT_DAUVAO as TYLEVAT, d.TYLE_VAT, SLNGB.DONGIAVONVAT, SLNGB.DONGIABANVAT_DAUVAO,            dg.DONGIA AS DONGIATHAU, dg.DONGIA AS DONGIABAN, dg.DONGIA AS DONGIABAN_VAT,                      TK.KHODUOC_ID,TK.DUOC_ID, TK.SOLUONG, TK.SOLUONG AS SOLUONGTON,            D.TENDUOCDAYDU,D.DONVITINH_ID, D.DONVITINH, D.BHYT, NH.TENNGUONDUOC AS NGUONHANG,            LTRIM(TK.KHODUOC_ID) + '_' + LTRIM(TK.DUOC_ID) + '_' + LTRIM(TK.NGUONDUOC_ID) as DUOC_KEY            FROM            TT_DUOC_CHUNGTU_SOLONHAP SLN            INNER JOIN TT_DUOC_TONKHO TK on SLN.SOLONHAP_ID = TK.SOLONHAP_ID            INNER JOIN TT_DUOC_SOLONHAP_GIABAN SLNGB on SLN.SOLONHAP_ID = SLNGB.SOLONHAP_ID            INNER JOIN TM_NGUONHANG NH on SLN.NGUONDUOC_ID = NH.NGUONDUOC_ID            INNER JOIN TM_DUOC D on SLN.DUOC_ID = D.DUOC_ID            LEFT JOIN TM_DUOC_DONGIA dg on dg.DUOC_ID = SLN.DUOC_ID            LEFT JOIN TM_LOAIGIA lg on (lg.LOAIGIA_ID = dg.LOAIGIA_ID AND lg.MALOAIGIA = 'GiaduocBHYT')            WHERE            TK.DUOC_ID = '14'            AND TK.KHODUOC_ID = '29'            AND TK.BENHVIEN_ID = 'HLU01'            AND TK.SOLUONG > 0                 and                     SLN.NGUONDUOC_ID = '1'                                      ORDER BY NGAYNHAP]
2019-08-14 17:44:37,252 [1] DEBUG - Statement Id: [DAO00030_GET_SOLONHAP_XUATSUDUNG] PreparedStatement : [SELECT DISTINCT            SLN.SOLONHAP_ID, SLN.SOLONHAP, SLN.SOLOSANPHAM, SLN.SOKIEMSOAT, SLN.SOVISA, CONVERT(varchar(20), SLN.SOLOSANPHAM) + '/' + CONVERT(varchar(20), TK.SOLUONG) AS SOLOSOTON,            SLN.NGAYNHAP AS NGAYNHAPLO, SLN.HANDUNG AS HANSUDUNG,  SLN.HANDUNG, SLN.NGUONDUOC_ID, SLN.NGUONDUOC_ID as NGUONHANG_ID,            SLNGB.DONGIAMUA, SLNGB.DONGIAVON, SLNGB.TYLEVAT_DAUVAO as TYLEVAT, d.TYLE_VAT, SLNGB.DONGIAVONVAT, SLNGB.DONGIABANVAT_DAUVAO,            dg.DONGIA AS DONGIATHAU, dg.DONGIA AS DONGIABAN, dg.DONGIA AS DONGIABAN_VAT,                      TK.KHODUOC_ID,TK.DUOC_ID, TK.SOLUONG, TK.SOLUONG AS SOLUONGTON,            D.TENDUOCDAYDU,D.DONVITINH_ID, D.DONVITINH, D.BHYT, NH.TENNGUONDUOC AS NGUONHANG,            LTRIM(TK.KHODUOC_ID) + '_' + LTRIM(TK.DUOC_ID) + '_' + LTRIM(TK.NGUONDUOC_ID) as DUOC_KEY            FROM            TT_DUOC_CHUNGTU_SOLONHAP SLN            INNER JOIN TT_DUOC_TONKHO TK on SLN.SOLONHAP_ID = TK.SOLONHAP_ID            INNER JOIN TT_DUOC_SOLONHAP_GIABAN SLNGB on SLN.SOLONHAP_ID = SLNGB.SOLONHAP_ID            INNER JOIN TM_NGUONHANG NH on SLN.NGUONDUOC_ID = NH.NGUONDUOC_ID            INNER JOIN TM_DUOC D on SLN.DUOC_ID = D.DUOC_ID            LEFT JOIN TM_DUOC_DONGIA dg on dg.DUOC_ID = SLN.DUOC_ID            LEFT JOIN TM_LOAIGIA lg on (lg.LOAIGIA_ID = dg.LOAIGIA_ID AND lg.MALOAIGIA = 'GiaduocBHYT')            WHERE            TK.DUOC_ID = '3'            AND TK.KHODUOC_ID = '29'            AND TK.BENHVIEN_ID = 'HLU01'            AND TK.SOLUONG > 0                 and                     SLN.NGUONDUOC_ID = '1'                                      ORDER BY NGAYNHAP]
2019-08-14 17:44:37,405 [1] DEBUG - Statement Id: [DAO00030_ThemChungTuXSD] PreparedStatement : [declare @jsonChiTiet nvarchar(max);          set @jsonChiTiet =  @param0 ;          declare @type nvarchar(max);          set @type =  @param1 ;            declare @chungtu_id int;                    BEGIN                      insert into TT_DUOC_CHUNGTU (          MACHUNGTU,SOCHUNGTU,NGAYCHUNGTU,LOAICHUNGTU,MUCDICHCHUNGTU_ID,MUCDICHCHUNGTU_CODE,KHOXUAT_ID,NGUOIGIAO_ID,NGUOIGIAO,KHONHAP_ID,NGUOINHAN_ID,NGUOINHAN,NGUOIKIEMTRA_ID,NGUOIKIEMTRA,NGUOIDUYET_ID,NGUOIDUYET,PHUONGPHAPXUAT,KETOANTRUONG_ID,KETOANTRUONG,THUKHO_ID,THUKHO,MAUHOADON,SOHOADON,SOSERI,NGAYHOADON,DIENGIAI,GIATRI,GIATRITHANHTOAN,TYLEVAT,GIATRIVAT,THUESUAT,GIATRITHUE,TYLECHIETKHAU,GIATRICHIETKHAU,TIENTE_ID,TYGIA,SOCHUNGTUGOC,NGAYCHUNGTUGOC,NHACUNGCAP_ID,HINHTHUCTHANHTOAN_ID,NGUONDUOC_ID,CHUNGTULIENQUAN_ID,KHAMBENH_ID,TOATHUOCNOITRU_ID,TIEPNHAN_ID,BENHAN_ID,DANHANTHUOC,NGUOINHAP_ID,NGAYNHAP,TRANGTHAI,LOAITOATHUOC,PHIEULINH_ID,DIENGIAINGHIEPVUPHATSINH,DONVIGIAO_ID,KHOSUDUNG_ID,LOAIVATTU_ID,BENHNHAN_ID,NGOAITRU_TOATHUOC_NGUOIMUA_ID,TENBENHNHAN,BACSIGIOITHIEU_ID,DOITUONG_ID,IDCHUYEN,CHUNGTUKETOAN,STATUS,TRANSFER_VIENPHI_ID,PHONGBAN_ID,BACSI_ID,TKNO,TKCO,MACHUNGTUREF,LOAICHUNGTUREF,PHIEULINHCANTRU_ID,KHOTHUCHIEN_ID,KHODOIUNG_ID,MENU_LOAIDUOC_ID,NGUOISUDUNGMAY_ID,GOITHAU_ID,XUATTHUOCBANGOAITRU,NGAYGIOCHUNGTU,NOIDAKHAM,HOIDONGKIEMNHAP_ID,HOIDONGTHANHLY_ID,CHUYENCHUNGTUID,CHUYENDOANHTHUID,LYDOXUATSUDUNG_ID,BENHVIEN_ID,NGAYTAO,NGUOITAO_ID,NGAYCAPNHAT,NGUOICAPNHAT_ID)          values ( @param2 , @param3 , @param4 ,'X', @param5 , @param6 , @param7 , @param8 , @param9 , @param10 , @param11 , @param12 , @param13 , @param14 , @param15 , @param16 , @param17 , @param18 , @param19 , @param20 , @param21 , @param22 , @param23 , @param24 , @param25 , @param26 , @param27 , @param28 , @param29 , @param30 , @param31 , @param32 , @param33 , @param34 , @param35 , @param36 , @param37 , @param38 , @param39 , @param40 , @param41 , @param42 , @param43 , @param44 , @param45 , @param46 , @param47 , @param48 , @param49 ,'DXK', @param50 , @param51 , @param52 , @param53 , @param54 , @param55 , @param56 , @param57 , @param58 , @param59 , @param60 , @param61 , @param62 , @param63 , @param64 , @param65 , @param66 , @param67 , @param68 , @param69 , @param70 , @param71 , @param72 , @param73 , @param74 , @param75 , @param76 , @param77 , @param78 , @param79 , @param80 , @param81 , @param82 , @param83 , @param84 , @param85 , @param4 , @param86 , @param87 , @param88 )          set @chungtu_id = SCOPE_IDENTITY()                      INSERT INTO TT_DUOC_CHUNGTU_CHITIET          (CHUNGTU_ID,DUOC_ID,SOLONHAP_ID,SOKIEMSOAT,SOVISA,HANDUNG,DONVITINH_ID          ,SOLUONGYEUCAU,SOLUONGDAXUAT,THANHTIENVON          ,DONGIABAN,DONGIAVON,TRANGTHAI,NGUONHANG_ID          ,TOATHUOCNOITRU_ID,KHAMBENH_VTYT_ID          ,PHAUTHUAT_VTYT_ID,CLSKETQUA_VTYT_ID,TOATHUOCNGOAITRU_ID          ,MASTER_ID,BENHNHAN,BENHVIEN_ID,NGAYTAO,NGUOITAO_ID)            SELECT @chungtu_id, json.DUOC_ID, json.SOLONHAP_ID, json.SOKIEMSOAT, json.SOVISA, json.HANDUNG, json.DONVITINH_ID          ,json.SOLUONGYEUCAU, json.SOLUONGDAXUAT, json.THANHTIENVON          ,json.DONGIABAN, json.DONGIAVON, json.TRANGTHAI, json.NGUONHANG_ID          ,json.TOATHUOCNOITRU_ID, json.KHAMBENH_VTYT_ID          ,json.PHAUTHUAT_VTYT_ID, json.CLSKETQUA_VTYT_ID, json.TOATHUOCNGOAITRU_ID          ,json.MASTER_ID, json.BENHNHAN,  @param85 , json.NGAYTAO, json.NGUOITAO_ID          FROM OPENJSON(@jsonChiTiet)          WITH (          DUOC_ID int,SOLONHAP_ID int,SOKIEMSOAT varchar(20),SOVISA varchar(20),HANDUNG datetime,DONVITINH_ID int,          SOLUONGYEUCAU numeric(25, 4),SOLUONGDAXUAT numeric(25, 4),THANHTIENVON numeric(25, 4),          DONGIABAN numeric(25, 4),DONGIAVON numeric(25, 4),TRANGTHAI varchar(10),NGUONHANG_ID int,          TOATHUOCNOITRU_ID int,KHAMBENH_VTYT_ID int,          PHAUTHUAT_VTYT_ID int,CLSKETQUA_VTYT_ID int,TOATHUOCNGOAITRU_ID int,          MASTER_ID int,BENHNHAN nvarchar(1000), BENHVIEN_ID varchar(10),NGAYTAO datetime,NGUOITAO_ID int          ) json                      if(@type = 'TT_NOITRU_TOATHUOC')          BEGIN                    UPDATE TT_NOITRU_TOATHUOC SET CHUNGTU_ID = @chungtu_id, TRANGTHAI = 'DAXUAT', NGAYCAPNHAT = getdate()          FROM OPENJSON(@jsonChiTiet)          WITH (MASTER_ID int, TOATHUOCNOITRU_ID int) json          WHERE TT_NOITRU_TOATHUOC.TOATHUOC_ID = json.TOATHUOCNOITRU_ID and json.TOATHUOCNOITRU_ID is not NULL and json.MASTER_ID = TT_NOITRU_TOATHUOC.KHAMBENH_ID                      UPDATE TT_DUOC_TONKHO_BOOK_NOITRU SET SOLUONG = 0          FROM OPENJSON(@jsonChiTiet)          WITH (TOATHUOCNOITRU_ID int) json          WHERE TT_DUOC_TONKHO_BOOK_NOITRU.REF_ID = json.TOATHUOCNOITRU_ID and json.TOATHUOCNOITRU_ID is not NULL and TT_DUOC_TONKHO_BOOK_NOITRU.REF_TABLE = 'TT_NOITRU_TOATHUOC'          END                            if(@type = 'TT_PHAUTHUAT_VTYT')          BEGIN          UPDATE TT_PHAUTHUAT_VTYT SET CHUNGTU_ID = @chungtu_id          FROM OPENJSON(@jsonChiTiet)          WITH (PHAUTHUAT_VTYT_ID int) json          WHERE TT_PHAUTHUAT_VTYT.PHAUTHUAT_VTYT_ID = json.PHAUTHUAT_VTYT_ID and json.PHAUTHUAT_VTYT_ID is not NULL                              UPDATE TT_VIENPHI set DUYET = '1', DATHUCHIEN = '1', NGAYCAPNHAT = getdate()          FROM OPENJSON(@jsonChiTiet)          WITH (PHAUTHUAT_VTYT_ID int) json          WHERE TT_VIENPHI.REF_TABLE = 'TT_PHAUTHUAT_VTYT' and TT_VIENPHI.REF_ID = json.PHAUTHUAT_VTYT_ID and json.PHAUTHUAT_VTYT_ID is not NULL                      UPDATE TT_DUOC_TONKHO_BOOK_NGOAITRU SET SOLUONG = 0          FROM OPENJSON(@jsonChiTiet)          WITH (PHAUTHUAT_VTYT_ID int) json          WHERE TT_DUOC_TONKHO_BOOK_NGOAITRU.REF_ID = json.PHAUTHUAT_VTYT_ID and json.PHAUTHUAT_VTYT_ID is not NULL          and TT_DUOC_TONKHO_BOOK_NGOAITRU.REF_TABLE = 'TT_PHAUTHUAT_VTYT'          END                    if(@type = 'TT_CLSKETQUA_VTYT')          BEGIN                    UPDATE TT_CLSKETQUA_VTYT SET CHUNGTU_ID = @chungtu_id, TRANGTHAI = 'DAXUAT', NGAYCAPNHAT = getdate()          FROM OPENJSON(@jsonChiTiet)          WITH (CLSKETQUA_VTYT_ID int) json          WHERE TT_CLSKETQUA_VTYT.CLSKETQUA_VTYT_ID = json.CLSKETQUA_VTYT_ID and json.CLSKETQUA_VTYT_ID is not NULL            UPDATE TT_VIENPHI set DUYET = '1', DATHUCHIEN = '1', NGAYCAPNHAT = getdate()          FROM OPENJSON(@jsonChiTiet)          WITH (CLSKETQUA_VTYT_ID int) json          WHERE TT_VIENPHI.REF_TABLE = 'TT_CLSKETQUA_VTYT' and TT_VIENPHI.REF_ID = json.CLSKETQUA_VTYT_ID and json.CLSKETQUA_VTYT_ID is not NULL                       UPDATE TT_DUOC_TONKHO_BOOK_NGOAITRU SET SOLUONG = 0          FROM OPENJSON(@jsonChiTiet)          WITH (CLSKETQUA_VTYT_ID int) json          WHERE TT_DUOC_TONKHO_BOOK_NGOAITRU.REF_ID = json.CLSKETQUA_VTYT_ID and json.CLSKETQUA_VTYT_ID is not NULL          and TT_DUOC_TONKHO_BOOK_NGOAITRU.REF_TABLE = 'TT_CLSKETQUA_VTYT'          END                              select @chungtu_id            END]
2019-08-14 17:44:37,405 [1] DEBUG - Statement Id: [DAO00030_ThemChungTuXSD] Parameters: [@param0=[JSON_DATA,[{"SOLONHAP_ID":4030,"SOLONHAP":"190400792","SOLOSANPHAM":"p","SOKIEMSOAT":null,"SOVISA":"","SOLOSOTON":"p/25.0000","NGAYNHAPLO":"2019-04-05T13:08:00","HANSUDUNG":"2026-12-12T00:00:00","HANDUNG":"2026-12-12T00:00:00","NGUONDUOC_ID":1,"NGUONHANG_ID":1,"DONGIAMUA":4800.0000,"DONGIAVON":4800.0000,"TYLEVAT":0.0000,"TYLE_VAT":0.00,"DONGIAVONVAT":4800.0000,"DONGIABANVAT_DAUVAO":4800.0000,"DONGIATHAU":6380.00,"DONGIABAN":6380.00,"DONGIABAN_VAT":6380.00,"KHODUOC_ID":29,"DUOC_ID":14,"SOLUONG":25.0000,"SOLUONGTON":25.0000,"TENDUOCDAYDU":"(Kim luồn tĩnh mạch có cánh có cửa bơm thuốc JCM) ","DONVITINH_ID":17,"DONVITINH":"Cái","BHYT":"1","NGUONHANG":"Nguồn Mua","DUOC_KEY":"29_14_1","CHUNGTUCHITIET_ID":0,"CHUNGTU_ID":null,"SOLUONGTHUCTE":null,"TOATHUOC":"PHAUTHUATVTYT","PHAUTHUAT_VTYT_ID":1239,"REF_TABLE":"TT_PHAUTHUAT_VTYT","REF_ID":1239,"BENHNHAN":"Người bệnh: 190035158 - Lê Thị Lan - 14/08/2019 - 17:45","SOLUONGYEUCAU":1.0000,"KHAMBENH_VTYT_ID":null,"TOATHUOCNOITRU_ID":null,"CLSKETQUA_VTYT_ID":null,"SOLUONGDAXUAT":1.0000,"THANHTIENVON":4800.00000000},{"SOLONHAP_ID":9260,"SOLONHAP":"190502340","SOLOSANPHAM":"a","SOKIEMSOAT":null,"SOVISA":"","SOLOSOTON":"a/100.0000","NGAYNHAPLO":"2019-05-16T09:08:00","HANSUDUNG":"2026-12-12T00:00:00","HANDUNG":"2026-12-12T00:00:00","NGUONDUOC_ID":1,"NGUONHANG_ID":1,"DONGIAMUA":630.0000,"DONGIAVON":630.0000,"TYLEVAT":0.0000,"TYLE_VAT":0.00,"DONGIAVONVAT":630.0000,"DONGIABANVAT_DAUVAO":630.0000,"DONGIATHAU":630.00,"DONGIABAN":630.00,"DONGIABAN_VAT":630.00,"KHODUOC_ID":29,"DUOC_ID":3,"SOLUONG":100.0000,"SOLUONGTON":100.0000,"TENDUOCDAYDU":"(Bơm tiêm nhựa 5ml) ","DONVITINH_ID":17,"DONVITINH":"Cái","BHYT":"1","NGUONHANG":"Nguồn Mua","DUOC_KEY":"29_3_1","CHUNGTUCHITIET_ID":0,"CHUNGTU_ID":null,"SOLUONGTHUCTE":null,"TOATHUOC":"PHAUTHUATVTYT","PHAUTHUAT_VTYT_ID":1240,"REF_TABLE":"TT_PHAUTHUAT_VTYT","REF_ID":1240,"BENHNHAN":"Người bệnh: 190035158 - Lê Thị Lan - 14/08/2019 - 17:45","SOLUONGYEUCAU":2.0000,"KHAMBENH_VTYT_ID":null,"TOATHUOCNOITRU_ID":null,"CLSKETQUA_VTYT_ID":null,"SOLUONGDAXUAT":2.0000,"THANHTIENVON":1260.00000000}]], @param1=[REF_TABLE,TT_PHAUTHUAT_VTYT], @param2=[MACHUNGTU,CS_GMHSX1319002655], @param3=[SOCHUNGTU,002655], @param4=[NGAYCHUNGTU,8/14/2019 5:44:31 PM], @param5=[MUCDICHCHUNGTU_ID,1060], @param6=[MUCDICHCHUNGTU_CODE,X13], @param7=[KHOXUAT_ID,29], @param8=[NGUOIGIAO_ID,0], @param9=[NGUOIGIAO,null], @param10=[KHONHAP_ID,null], @param11=[NGUOINHAN_ID,null], @param12=[NGUOINHAN,null], @param13=[NGUOIKIEMTRA_ID,null], @param14=[NGUOIKIEMTRA,null], @param15=[NGUOIDUYET_ID,null], @param16=[NGUOIDUYET,null], @param17=[PHUONGPHAPXUAT,0], @param18=[KETOANTRUONG_ID,null], @param19=[KETOANTRUONG,null], @param20=[THUKHO_ID,null], @param21=[THUKHO,null], @param22=[MAUHOADON,null], @param23=[SOHOADON,null], @param24=[SOSERI,null], @param25=[NGAYHOADON,null], @param26=[DIENGIAI,null], @param27=[GIATRI,null], @param28=[GIATRITHANHTOAN,null], @param29=[TYLEVAT,5], @param30=[GIATRIVAT,0], @param31=[THUESUAT,null], @param32=[GIATRITHUE,null], @param33=[TYLECHIETKHAU,null], @param34=[GIATRICHIETKHAU,null], @param35=[TIENTE_ID,null], @param36=[TYGIA,null], @param37=[SOCHUNGTUGOC,null], @param38=[NGAYCHUNGTUGOC,null], @param39=[NHACUNGCAP_ID,null], @param40=[HINHTHUCTHANHTOAN_ID,null], @param41=[NGUONDUOC_ID,null], @param42=[CHUNGTULIENQUAN_ID,null], @param43=[KHAMBENH_ID,null], @param44=[TOATHUOCNOITRU_ID,1], @param45=[TIEPNHAN_ID,null], @param46=[BENHAN_ID,null], @param47=[DANHANTHUOC,], @param48=[NGUOINHAP_ID,null], @param49=[NGAYNHAP,null], @param50=[LOAITOATHUOC,null], @param51=[PHIEULINH_ID,null], @param52=[DIENGIAINGHIEPVUPHATSINH,null], @param53=[DONVIGIAO_ID,null], @param54=[KHOSUDUNG_ID,null], @param55=[LOAIVATTU_ID,null], @param56=[BENHNHAN_ID,null], @param57=[NGOAITRU_TOATHUOC_NGUOIMUA_ID,null], @param58=[TENBENHNHAN,null], @param59=[BACSIGIOITHIEU_ID,null], @param60=[DOITUONG_ID,null], @param61=[IDCHUYEN,null], @param62=[CHUNGTUKETOAN,null], @param63=[STATUS,null], @param64=[TRANSFER_VIENPHI_ID,null], @param65=[PHONGBAN_ID,25], @param66=[BACSI_ID,null], @param67=[TKNO,null], @param68=[TKCO,null], @param69=[MACHUNGTUREF,null], @param70=[LOAICHUNGTUREF,null], @param71=[PHIEULINHCANTRU_ID,null], @param72=[KHOTHUCHIEN_ID,null], @param73=[KHODOIUNG_ID,null], @param74=[MENU_LOAIDUOC_ID,null], @param75=[NGUOISUDUNGMAY_ID,null], @param76=[GOITHAU_ID,null], @param77=[XUATTHUOCBANGOAITRU,null], @param78=[NGAYGIOCHUNGTU,null], @param79=[NOIDAKHAM,null], @param80=[HOIDONGKIEMNHAP_ID,null], @param81=[HOIDONGTHANHLY_ID,null], @param82=[CHUYENCHUNGTUID,null], @param83=[CHUYENDOANHTHUID,null], @param84=[LYDOXUATSUDUNG_ID,8294], @param85=[BENHVIEN_ID,HLU01], @param86=[NGUOITAO_ID,0], @param87=[NGAYCAPNHAT,8/14/2019 5:44:37 PM], @param88=[NGUOICAPNHAT_ID,0]]
2019-08-14 17:44:37,405 [1] DEBUG - Statement Id: [DAO00030_ThemChungTuXSD] Types: [@param0=[String, System.String], @param1=[String, System.String], @param2=[String, System.String], @param3=[String, System.String], @param4=[DateTime, System.DateTime], @param5=[Int32, System.Int32], @param6=[String, System.String], @param7=[Int32, System.Int32], @param8=[Int32, System.Int32], @param9=[System.DBNull, null], @param10=[System.DBNull, null], @param11=[System.DBNull, null], @param12=[System.DBNull, null], @param13=[System.DBNull, null], @param14=[System.DBNull, null], @param15=[System.DBNull, null], @param16=[System.DBNull, null], @param17=[Int32, System.Int32], @param18=[System.DBNull, null], @param19=[System.DBNull, null], @param20=[System.DBNull, null], @param21=[System.DBNull, null], @param22=[System.DBNull, null], @param23=[System.DBNull, null], @param24=[System.DBNull, null], @param25=[System.DBNull, null], @param26=[System.DBNull, null], @param27=[System.DBNull, null], @param28=[System.DBNull, null], @param29=[Decimal, System.Decimal], @param30=[Decimal, System.Decimal], @param31=[System.DBNull, null], @param32=[System.DBNull, null], @param33=[System.DBNull, null], @param34=[System.DBNull, null], @param35=[System.DBNull, null], @param36=[System.DBNull, null], @param37=[System.DBNull, null], @param38=[System.DBNull, null], @param39=[System.DBNull, null], @param40=[System.DBNull, null], @param41=[System.DBNull, null], @param42=[System.DBNull, null], @param43=[System.DBNull, null], @param44=[Int32, System.Int32], @param45=[System.DBNull, null], @param46=[System.DBNull, null], @param47=[String, System.String], @param48=[System.DBNull, null], @param49=[System.DBNull, null], @param50=[System.DBNull, null], @param51=[System.DBNull, null], @param52=[System.DBNull, null], @param53=[System.DBNull, null], @param54=[System.DBNull, null], @param55=[System.DBNull, null], @param56=[System.DBNull, null], @param57=[System.DBNull, null], @param58=[System.DBNull, null], @param59=[System.DBNull, null], @param60=[System.DBNull, null], @param61=[System.DBNull, null], @param62=[System.DBNull, null], @param63=[System.DBNull, null], @param64=[System.DBNull, null], @param65=[Int32, System.Int32], @param66=[System.DBNull, null], @param67=[System.DBNull, null], @param68=[System.DBNull, null], @param69=[System.DBNull, null], @param70=[System.DBNull, null], @param71=[System.DBNull, null], @param72=[System.DBNull, null], @param73=[System.DBNull, null], @param74=[System.DBNull, null], @param75=[System.DBNull, null], @param76=[System.DBNull, null], @param77=[System.DBNull, null], @param78=[System.DBNull, null], @param79=[System.DBNull, null], @param80=[System.DBNull, null], @param81=[System.DBNull, null], @param82=[System.DBNull, null], @param83=[System.DBNull, null], @param84=[Int32, System.Int32], @param85=[String, System.String], @param86=[Int32, System.Int32], @param87=[DateTime, System.DateTime], @param88=[Int32, System.Int32]]
2019-08-14 17:44:39,792 [1] DEBUG - Statement Id: [DAO00030_MergSoLuongTonKho] PreparedStatement : [BEGIN          BEGIN TRY          BEGIN TRANSACTION            UPDATE TT_DUOC_TONKHO SET SOLUONG=0,DONGIAMUA=null WHERE KHODUOC_ID IN(29);          MERGE TT_DUOC_TONKHO AS X USING          (          select aa.SoLoNhap_ID,aa.KHODUOC_ID,aa.DUOC_ID,  aa.NGUONDUOC_ID,aa.BENHVIEN_ID, (case when sum(aa.soluong) < 0 then 0 else sum(aa.soluong) end) as SOLUONG from (          Select (case when CTU.LoaiChungTu = 'N' then CTU.KhoNhap_ID else ctu.KhoXuat_ID end) as KHODUOC_ID, CT.SOLONHAP_ID,          (case when CTU.LoaiChungTu = 'N' then SoLuongThucTe*ISNULL(CT.TYLEQUIDOI,1) else - SOLUONGDAXUAT end) as SOLUONG,CT.DUOC_ID,          Lo.NGUONDUOC_ID,CTU.BENHVIEN_ID          from TT_DUOC_CHUNGTU_CHITIET CT          join TT_DUOC_CHUNGTU CTU on CT.ChungTu_ID = CTU.ChungTu_ID AND CT.BENHVIEN_ID=CTU.BENHVIEN_ID          join TT_DUOC_CHUNGTU_SOLONHAP Lo on Lo.SoLoNhap_ID = CT.SoLoNhap_ID          join TM_DUOC duoc on CT.DUOC_ID = duoc.DUOC_ID          where ((CTU.TRANGTHAI not in ('PNCXN','CXN','HUY','PNCNK')) or CTU.TRANGTHAI is null) AND CTU.BENHVIEN_ID='HLU01'          ) aa where aa.KHODUOC_ID IN(29)          Group by AA.SoLoNhap_ID,AA.KHODUOC_ID,AA.DUOC_ID,  AA.NGUONDUOC_ID,AA.BENHVIEN_ID          ) AS Y          ON (X.KHODUOC_ID =Y.KHODUOC_ID AND X.SOLONHAP_ID=Y.SOLONHAP_ID AND X.DUOC_ID=Y.DUOC_ID AND X.NGUONDUOC_ID=Y.NGUONDUOC_ID AND X.BENHVIEN_ID=Y.BENHVIEN_ID)          WHEN MATCHED THEN UPDATE SET X.SOLUONG=Y.SOLUONG          WHEN NOT MATCHED THEN          INSERT (KHODUOC_ID,DUOC_ID,SOLONHAP_ID,SOLUONG,NGUONDUOC_ID,BENHVIEN_ID,NGAYTAO,NGUOITAO_ID,NGAYCAPNHAT,NGUOICAPNHAT_ID) VALUES          (Y.KHODUOC_ID,Y.DUOC_ID,Y.SOLONHAP_ID,Y.SOLUONG,Y.NGUONDUOC_ID,Y.BENHVIEN_ID,GETDATE(),NULL,GETDATE(),NULL);            COMMIT TRANSACTION          END TRY          BEGIN CATCH          IF @@TRANCOUNT > 0          ROLLBACK TRANSACTION          END CATCH          END]
2019-08-14 17:45:34,917 [1] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoCOM18] PreparedStatement : [select  distinct TT_TONKHO.DUOC_KEY, LTRIM(TT_TONKHO.KHODUOC_ID) as KHODUOC_ID, TM_DUOC.DUOC_ID, TM_LOAIDUOC.MALOAIDUOC,TM_DUOC.SOVISA,TM_DUOC.TYLE_VAT,TM_DUOC.COTOA,        TM_DUOC.MADUOC, TM_DUOC.TENHANG, TM_DUOC.TENDUOCDAYDU, dvt.TENDONVITINH as DONVITINH, TM_DUOC.DONVITINH_ID, TM_DUOC.BHYT,        TM_DUOC.TENHOATCHAT, TM_DUOC.HAMLUONG, TM_DUOC.HANGSANXUAT, TM_DUOC.QUOCGIA, TM_DUOC.LOAIDUOC_ID, TM_DUOC.DUONGDUNG_ID,        TM_TENDUOC.TENDUOC, TM_TENDUOC.TENDUOC_EN, TM_TENDUOC.MAQUOCTE, TM_TENDUOC.MAQUOCTEBT,        TM_LOAIDUOC.LOAIVATTU_ID, TM_DUOC.BENHVIEN_ID,        TT_TONKHO.SOLUONG, TM_DUOC.VTYT_PHANLOAI, TM_DUOC.PHAMVI, TT_TONKHO.NGUONDUOC_ID, NG.TENNGUONDUOC        , TAMNGUNG = CASE WHEN TM_DUOC.TAMNGUNG = '1' OR NG.TAMNGUNG = '1' OR KD.TAMNGUNG = '1' THEN '1' ELSE '0' END        , TM_DUOC.DANGTRINHBAY        from TM_DUOC        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = TM_DUOC.DONVITINH_ID        left join TM_TENDUOC on TM_DUOC.TENDUOC_ID = TM_TENDUOC.TENDUOC_ID and TM_DUOC.BENHVIEN_ID = 'HLU01'  and TM_DUOC.TAMNGUNG = '0'        left join TM_LOAIDUOC on TM_LOAIDUOC.LOAIDUOC_ID = TM_DUOC.LOAIDUOC_ID and TM_LOAIDUOC.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG on (TM_LOAIDUOC.LOAIVATTU_ID = TM_DUOC_HANDUNG.LOAIDUOC and TM_DUOC_HANDUNG.BENHVIEN_ID = 'HLU01')        inner join        (select LTRIM(A.KHODUOC_ID) + '_' + LTRIM(A.DUOC_ID) + '_' + LTRIM(ISNULL(A.NGUONDUOC_ID,'')) as DUOC_KEY, A.KHODUOC_ID, A.DUOC_ID ,a.NGUONDUOC_ID,        SUM(isnull(A.SOLUONG,0)) as SOLUONG        from        (select SUM(SOLUONG) as SOLUONG, KHODUOC_ID, DUOC_ID, NGUONDUOC_ID from TT_DUOC_TONKHO        where KHODUOC_ID in (29) and DUOC_ID in (14) group by KHODUOC_ID, DUOC_ID, NGUONDUOC_ID        ) A        where A.KHODUOC_ID in (29) and A.DUOC_ID in (14)        group by LTRIM(A.KHODUOC_ID) + '_' + LTRIM(A.DUOC_ID) + '_' + LTRIM(A.NGUONDUOC_ID), A.KHODUOC_ID, A.DUOC_ID, A.NGUONDUOC_ID)        TT_TONKHO on TT_TONKHO.DUOC_ID = TM_DUOC.DUOC_ID        LEFT JOIN TM_NGUONHANG NG ON NG.NGUONDUOC_ID = TT_TONKHO.NGUONDUOC_ID        LEFT JOIN TM_KHODUOC KD ON KD.KHODUOC_ID = TT_TONKHO.KHODUOC_ID        where TM_DUOC.BENHVIEN_ID = 'HLU01' and TM_DUOC.DUOC_ID in (14)]
2019-08-14 17:45:35,128 [1] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoCOM18] PreparedStatement : [select  distinct TT_TONKHO.DUOC_KEY, LTRIM(TT_TONKHO.KHODUOC_ID) as KHODUOC_ID, TM_DUOC.DUOC_ID, TM_LOAIDUOC.MALOAIDUOC,TM_DUOC.SOVISA,TM_DUOC.TYLE_VAT,TM_DUOC.COTOA,        TM_DUOC.MADUOC, TM_DUOC.TENHANG, TM_DUOC.TENDUOCDAYDU, dvt.TENDONVITINH as DONVITINH, TM_DUOC.DONVITINH_ID, TM_DUOC.BHYT,        TM_DUOC.TENHOATCHAT, TM_DUOC.HAMLUONG, TM_DUOC.HANGSANXUAT, TM_DUOC.QUOCGIA, TM_DUOC.LOAIDUOC_ID, TM_DUOC.DUONGDUNG_ID,        TM_TENDUOC.TENDUOC, TM_TENDUOC.TENDUOC_EN, TM_TENDUOC.MAQUOCTE, TM_TENDUOC.MAQUOCTEBT,        TM_LOAIDUOC.LOAIVATTU_ID, TM_DUOC.BENHVIEN_ID,        TT_TONKHO.SOLUONG, TM_DUOC.VTYT_PHANLOAI, TM_DUOC.PHAMVI, TT_TONKHO.NGUONDUOC_ID, NG.TENNGUONDUOC        , TAMNGUNG = CASE WHEN TM_DUOC.TAMNGUNG = '1' OR NG.TAMNGUNG = '1' OR KD.TAMNGUNG = '1' THEN '1' ELSE '0' END        , TM_DUOC.DANGTRINHBAY        from TM_DUOC        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = TM_DUOC.DONVITINH_ID        left join TM_TENDUOC on TM_DUOC.TENDUOC_ID = TM_TENDUOC.TENDUOC_ID and TM_DUOC.BENHVIEN_ID = 'HLU01'  and TM_DUOC.TAMNGUNG = '0'        left join TM_LOAIDUOC on TM_LOAIDUOC.LOAIDUOC_ID = TM_DUOC.LOAIDUOC_ID and TM_LOAIDUOC.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG on (TM_LOAIDUOC.LOAIVATTU_ID = TM_DUOC_HANDUNG.LOAIDUOC and TM_DUOC_HANDUNG.BENHVIEN_ID = 'HLU01')        inner join        (select LTRIM(A.KHODUOC_ID) + '_' + LTRIM(A.DUOC_ID) + '_' + LTRIM(ISNULL(A.NGUONDUOC_ID,'')) as DUOC_KEY, A.KHODUOC_ID, A.DUOC_ID ,a.NGUONDUOC_ID,        SUM(isnull(A.SOLUONG,0)) as SOLUONG        from        (select SUM(SOLUONG) as SOLUONG, KHODUOC_ID, DUOC_ID, NGUONDUOC_ID from TT_DUOC_TONKHO        where KHODUOC_ID in (29) and DUOC_ID in (3) group by KHODUOC_ID, DUOC_ID, NGUONDUOC_ID        ) A        where A.KHODUOC_ID in (29) and A.DUOC_ID in (3)        group by LTRIM(A.KHODUOC_ID) + '_' + LTRIM(A.DUOC_ID) + '_' + LTRIM(A.NGUONDUOC_ID), A.KHODUOC_ID, A.DUOC_ID, A.NGUONDUOC_ID)        TT_TONKHO on TT_TONKHO.DUOC_ID = TM_DUOC.DUOC_ID        LEFT JOIN TM_NGUONHANG NG ON NG.NGUONDUOC_ID = TT_TONKHO.NGUONDUOC_ID        LEFT JOIN TM_KHODUOC KD ON KD.KHODUOC_ID = TT_TONKHO.KHODUOC_ID        where TM_DUOC.BENHVIEN_ID = 'HLU01' and TM_DUOC.DUOC_ID in (3)]
2019-08-14 17:45:35,194 [1] DEBUG - Statement Id: [DAO00030_GetListPhamViByKhoDuoc] PreparedStatement : [SELECT DISTINCT PHAMVI_ID          FROM TM_DUOC_PHAMVISD_MAPPING          WHERE          KHODUOC_ID IN (29)          AND BENHVIEN_ID ='HLU01'          AND TAMNGUNG = '0']
2019-08-14 17:45:35,223 [1] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoVaBookingCOM23] PreparedStatement : [select  distinct tk.DUOC_KEY, LTRIM(tk.PHAMVI_ID) as PHAMVI_ID, tk.NGUONDUOC_ID, nh.TENNGUONDUOC, nh.TINHTIEN, d.DUOC_ID, ld.MALOAIDUOC,        d.SOVISA,d.TYLE_VAT,d.COTOA, d.MADUOC, d.TENHANG, d.TENDUOCDAYDU, dvt.TENDONVITINH as DONVITINH, d.BHYT,        d.TENHOATCHAT, d.HAMLUONG, d.HANGSANXUAT, d.QUOCGIA, d.LOAIDUOC_ID, d.DUONGDUNG_ID, d.TINHTIEN_PTTT,        ten.TENDUOC, ten.TENDUOC_EN, ten.MAQUOCTE, ten.MAQUOCTEBT,        CASE WHEN d.BHYT = '1' THEN 'BHYT' ELSE '' END as BHYT_TEXT        , ld.LOAIVATTU_ID        , d.BENHVIEN_ID,        tk.SOLUONG, d.VTYT_PHANLOAI, d.PHAMVI, d.SUASOLUONGTONGHOP, d.MADUOCBV, d.DANGTRINHBAY        , TAMNGUNG = CASE WHEN d.TAMNGUNG = '1' OR nh.TAMNGUNG = '1' OR kd.TAMNGUNG = '1' THEN '1' ELSE '0' END        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        inner join        (        select  LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')) DUOC_KEY, (SUM(dtk.SOLUONG) - isnull(sum(A.SOLUONG),0) - isnull(sum(B.SOLUONG),0)) SOLUONG, pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        from (select sum(soluong) soluong,duoc_id,nguonduoc_id,khoduoc_id,benhvien_id from TT_DUOC_TONKHO  group by duoc_id,nguonduoc_id,khoduoc_id,benhvien_id) dtk        inner join TM_DUOC_PHAMVISD_MAPPING pvsd on dtk.KHODUOC_ID = pvsd.KHODUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NOITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) B on B.DUOC_ID = dtk.DUOC_ID and B.SOLUONG > 0 and B.PHAMVI_ID = pvsd.PHAMVI_ID and B.NGUONHANG_ID = dtk.NGUONDUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NGOAITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) A on A.DUOC_ID = dtk.DUOC_ID and A.SOLUONG > 0 and A.PHAMVI_ID = pvsd.PHAMVI_ID and A.NGUONHANG_ID = dtk.NGUONDUOC_ID        where dtk.SOLUONG > 0 and dtk.BENHVIEN_ID = 'HLU01'        group by LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')), pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        ) tk on tk.DUOC_ID = d.DUOC_ID        left join TM_DUOC_PHAMVISUDUNG kd on kd.PHAMVI_ID = tk.PHAMVI_ID and kd.BENHVIEN_ID = 'HLU01'        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = tk.NGUONDUOC_ID and nh.BENHVIEN_ID = 'HLU01'        where  d.BENHVIEN_ID = 'HLU01' and d.DUOC_ID in (14) and TK.PHAMVI_ID in (1052)        and tk.NGUONDUOC_ID in (1)]
2019-08-14 17:45:35,721 [1] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoVaBookingCOM23] PreparedStatement : [select  distinct tk.DUOC_KEY, LTRIM(tk.PHAMVI_ID) as PHAMVI_ID, tk.NGUONDUOC_ID, nh.TENNGUONDUOC, nh.TINHTIEN, d.DUOC_ID, ld.MALOAIDUOC,        d.SOVISA,d.TYLE_VAT,d.COTOA, d.MADUOC, d.TENHANG, d.TENDUOCDAYDU, dvt.TENDONVITINH as DONVITINH, d.BHYT,        d.TENHOATCHAT, d.HAMLUONG, d.HANGSANXUAT, d.QUOCGIA, d.LOAIDUOC_ID, d.DUONGDUNG_ID, d.TINHTIEN_PTTT,        ten.TENDUOC, ten.TENDUOC_EN, ten.MAQUOCTE, ten.MAQUOCTEBT,        CASE WHEN d.BHYT = '1' THEN 'BHYT' ELSE '' END as BHYT_TEXT        , ld.LOAIVATTU_ID        , d.BENHVIEN_ID,        tk.SOLUONG, d.VTYT_PHANLOAI, d.PHAMVI, d.SUASOLUONGTONGHOP, d.MADUOCBV, d.DANGTRINHBAY        , TAMNGUNG = CASE WHEN d.TAMNGUNG = '1' OR nh.TAMNGUNG = '1' OR kd.TAMNGUNG = '1' THEN '1' ELSE '0' END        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        inner join        (        select  LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')) DUOC_KEY, (SUM(dtk.SOLUONG) - isnull(sum(A.SOLUONG),0) - isnull(sum(B.SOLUONG),0)) SOLUONG, pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        from (select sum(soluong) soluong,duoc_id,nguonduoc_id,khoduoc_id,benhvien_id from TT_DUOC_TONKHO  group by duoc_id,nguonduoc_id,khoduoc_id,benhvien_id) dtk        inner join TM_DUOC_PHAMVISD_MAPPING pvsd on dtk.KHODUOC_ID = pvsd.KHODUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NOITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) B on B.DUOC_ID = dtk.DUOC_ID and B.SOLUONG > 0 and B.PHAMVI_ID = pvsd.PHAMVI_ID and B.NGUONHANG_ID = dtk.NGUONDUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NGOAITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) A on A.DUOC_ID = dtk.DUOC_ID and A.SOLUONG > 0 and A.PHAMVI_ID = pvsd.PHAMVI_ID and A.NGUONHANG_ID = dtk.NGUONDUOC_ID        where dtk.SOLUONG > 0 and dtk.BENHVIEN_ID = 'HLU01'        group by LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')), pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        ) tk on tk.DUOC_ID = d.DUOC_ID        left join TM_DUOC_PHAMVISUDUNG kd on kd.PHAMVI_ID = tk.PHAMVI_ID and kd.BENHVIEN_ID = 'HLU01'        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = tk.NGUONDUOC_ID and nh.BENHVIEN_ID = 'HLU01'        where  d.BENHVIEN_ID = 'HLU01' and d.DUOC_ID in (3) and TK.PHAMVI_ID in (1052)        and tk.NGUONDUOC_ID in (1)]
2019-08-14 17:45:36,018 [1] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoCOM18UpdateRedis] PreparedStatement : [select distinct TT_TONKHO.DUOC_KEY, LTRIM(TT_TONKHO.KHODUOC_ID) as KHODUOC_ID, TM_DUOC.DUOC_ID, TM_LOAIDUOC.MALOAIDUOC,TM_DUOC.SOVISA,TM_DUOC.TYLE_VAT,TM_DUOC.COTOA,        TM_DUOC.MADUOC, TM_DUOC.TENHANG, TM_DUOC.TENDUOCDAYDU, dvt.TENDONVITINH as DONVITINH,  TM_DUOC.DONVITINH_ID,TM_DUOC.BHYT,        TM_DUOC.TENHOATCHAT,        TM_DUOC.HAMLUONG, TM_DUOC.HANGSANXUAT, TM_DUOC.QUOCGIA, TM_DUOC.LOAIDUOC_ID, TM_DUOC.DUONGDUNG_ID,        TM_TENDUOC.TENDUOC, TM_TENDUOC.TENDUOC_EN, TM_TENDUOC.MAQUOCTE, TM_TENDUOC.MAQUOCTEBT,        TM_LOAIDUOC.LOAIVATTU_ID, TM_DUOC.BENHVIEN_ID,        TT_TONKHO.SOLUONG, TM_DUOC.VTYT_PHANLOAI, TM_DUOC.PHAMVI, TT_TONKHO.NGUONDUOC_ID, NG.TENNGUONDUOC AS TENNGUONDUOC        , TAMNGUNG = CASE WHEN TM_DUOC.TAMNGUNG = '1' OR NG.TAMNGUNG = '1' OR KD.TAMNGUNG = '1' THEN '1' ELSE '0' END        , TM_DUOC.DANGTRINHBAY        from TM_DUOC        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = TM_DUOC.DONVITINH_ID        left join TM_TENDUOC on TM_DUOC.TENDUOC_ID = TM_TENDUOC.TENDUOC_ID and TM_DUOC.BENHVIEN_ID = 'HLU01' and TM_DUOC.TAMNGUNG = '0'        left join TM_LOAIDUOC on TM_LOAIDUOC.LOAIDUOC_ID = TM_DUOC.LOAIDUOC_ID and TM_LOAIDUOC.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG on (TM_LOAIDUOC.LOAIVATTU_ID = TM_DUOC_HANDUNG.LOAIDUOC and TM_DUOC_HANDUNG.BENHVIEN_ID = 'HLU01')        inner join        (select LTRIM(A.KHODUOC_ID) + '_' + LTRIM(A.DUOC_ID) + '_' + LTRIM(ISNULL(A.NGUONDUOC_ID,'')) as DUOC_KEY, A.KHODUOC_ID, A.DUOC_ID, A.NGUONDUOC_ID,        SUM(isnull(A.SOLUONG,0)) as SOLUONG        from        (select SUM(SOLUONG) as SOLUONG, KHODUOC_ID, DUOC_ID, NGUONDUOC_ID from TT_DUOC_TONKHO        where BENHVIEN_ID = 'HLU01' group by KHODUOC_ID, DUOC_ID, NGUONDUOC_ID) A        group by LTRIM(A.KHODUOC_ID) + '_' + LTRIM(A.DUOC_ID) + '_' + LTRIM(ISNULL(A.NGUONDUOC_ID,'')), A.KHODUOC_ID, A.DUOC_ID, NGUONDUOC_ID        ) TT_TONKHO on TT_TONKHO.DUOC_ID = TM_DUOC.DUOC_ID        LEFT JOIN TM_NGUONHANG NG ON NG.NGUONDUOC_ID = TT_TONKHO.NGUONDUOC_ID        LEFT JOIN TM_KHODUOC KD ON KD.KHODUOC_ID = TT_TONKHO.KHODUOC_ID        where TM_DUOC.BENHVIEN_ID = 'HLU01' and TT_TONKHO.SOLUONG >= 0        and TM_DUOC.DUOC_ID in (14,3)]
2019-08-14 17:45:36,109 [1] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoVaBookingCOM23UpdateRedis] PreparedStatement : [select  distinct tk.DUOC_KEY, LTRIM(tk.PHAMVI_ID) as PHAMVI_ID, tk.NGUONDUOC_ID, nh.TENNGUONDUOC, nh.TINHTIEN, d.DUOC_ID, ld.MALOAIDUOC,        d.SOVISA,d.TYLE_VAT,d.COTOA, d.MADUOC, d.TENHANG, d.TENDUOCDAYDU, dvt.TENDONVITINH as DONVITINH, d.BHYT,        d.TENHOATCHAT, d.HAMLUONG, d.HANGSANXUAT, d.QUOCGIA, d.LOAIDUOC_ID, d.DUONGDUNG_ID, d.TINHTIEN_PTTT,        ten.TENDUOC, ten.TENDUOC_EN, ten.MAQUOCTE, ten.MAQUOCTEBT,        CASE WHEN d.BHYT = '1' THEN 'BHYT' ELSE '' END as BHYT_TEXT        , ld.LOAIVATTU_ID        , d.BENHVIEN_ID,        tk.SOLUONG, d.VTYT_PHANLOAI, d.PHAMVI, d.SUASOLUONGTONGHOP, d.MADUOCBV, d.DANGTRINHBAY        , TAMNGUNG = CASE WHEN d.TAMNGUNG = '1' OR nh.TAMNGUNG = '1' OR kd.TAMNGUNG = '1' THEN '1' ELSE '0' END        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        inner join        (        select  LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')) DUOC_KEY, (SUM(dtk.SOLUONG) - isnull(sum(A.SOLUONG),0) - isnull(sum(B.SOLUONG),0)) SOLUONG, pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        from (select sum(soluong) soluong,duoc_id,nguonduoc_id,khoduoc_id,benhvien_id from TT_DUOC_TONKHO  group by duoc_id,nguonduoc_id,khoduoc_id,benhvien_id) dtk        inner join TM_DUOC_PHAMVISD_MAPPING pvsd on dtk.KHODUOC_ID = pvsd.KHODUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NOITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) B on B.DUOC_ID = dtk.DUOC_ID and B.SOLUONG > 0 and B.PHAMVI_ID = pvsd.PHAMVI_ID and B.NGUONHANG_ID = dtk.NGUONDUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NGOAITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) A on A.DUOC_ID = dtk.DUOC_ID and A.SOLUONG > 0 and A.PHAMVI_ID = pvsd.PHAMVI_ID and A.NGUONHANG_ID = dtk.NGUONDUOC_ID        where dtk.SOLUONG > 0 and dtk.BENHVIEN_ID = 'HLU01'        group by LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')), pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        ) tk on tk.DUOC_ID = d.DUOC_ID        left join TM_DUOC_PHAMVISUDUNG kd on kd.PHAMVI_ID = tk.PHAMVI_ID and kd.BENHVIEN_ID = 'HLU01'        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = tk.NGUONDUOC_ID and nh.BENHVIEN_ID = 'HLU01'        where  d.BENHVIEN_ID = 'HLU01' and d.DUOC_ID in (14,3)]
2019-08-14 17:45:36,622 [1] DEBUG - Statement Id: [DAO00048_TT_PHAUTHUAT_GetList] PreparedStatement : [select *              from TT_PHAUTHUAT               where                             TT_PHAUTHUAT.LOAI = 'P'                       and                           TT_PHAUTHUAT.TIEPNHAN_ID = 26730                       and                           TT_PHAUTHUAT.BENHVIEN_ID = 'HLU01'                                     order by PHAUTHUAT_ID DESC]
2019-08-14 17:45:42,298 [1] DEBUG - Statement Id: [DAO00048_TT_PHAUTHUAT_GetDetail] PreparedStatement : [select PT.*, TN.BENHNHAN_ID              from              TT_PHAUTHUAT PT, TT_TIEPNHAN TN              where              PT.TIEPNHAN_ID = TN.TIEPNHAN_ID              AND PHAUTHUAT_ID  = 3745]
2019-08-14 17:45:42,657 [1] DEBUG - Statement Id: [DAO00048_CheckDVPhauThuatBHYT] PreparedStatement : [select count(0) from TT_VIENPHI          where REF_TABLE = 'TT_DVYEUCAU' and REF_ID = (select top 1 DVYEUCAU_ID from TT_PHAUTHUAT_YEUCAU where PHAUTHUAT_ID =  @param0 )          and TIEPNHAN_ID =  @param1  and BHYT_DONGIA > 0]
2019-08-14 17:45:42,657 [1] DEBUG - Statement Id: [DAO00048_CheckDVPhauThuatBHYT] Parameters: [@param0=[PHAUTHUAT_ID,3745], @param1=[TIEPNHAN_ID,26730]]
2019-08-14 17:45:42,657 [1] DEBUG - Statement Id: [DAO00048_CheckDVPhauThuatBHYT] Types: [@param0=[Int64, System.Int64], @param1=[Int64, System.Int64]]
2019-08-14 17:45:42,715 [1] DEBUG - Statement Id: [DAO00116_File_GetList] PreparedStatement : [select *              from TT_FILE_DINHKEM               where                             TT_FILE_DINHKEM.REF_TABLE = 'TT_PHAUTHUAT'                       and                           TT_FILE_DINHKEM.REF_ID = '3745'                       and                           TT_FILE_DINHKEM.BENHVIEN_ID = 'HLU01'                                     order by FILE_ID]
2019-08-14 17:45:44,873 [1] DEBUG - Statement Id: [DAO00048_TT_VIENPHI_GetList] PreparedStatement : [select *              from TT_VIENPHI               where                             TT_VIENPHI.TIEPNHAN_ID = '26730'                       and                           TT_VIENPHI.REF_TABLE = 'TT_PHAUTHUAT_VTYT'                       and                           TT_VIENPHI.BENHVIEN_ID = 'HLU01'                                     order by VIENPHI_ID]
2019-08-14 17:45:45,187 [1] DEBUG - Statement Id: [DAO00048_GetPhauThuat_VTYT_ByPhauThuatID] PreparedStatement : [SELECT            VTYT.PHAUTHUAT_VTYT_ID,            VTYT.PHAUTHUAT_ID,            VTYT.NGAYSUDUNG,            VTYT.TRANGTHAI_XEM,            VTYT.NGUONGOCDULIEU,            VTYT.NGUOITAO_ID,            VTYT.NGAYTAO,            VTYT.DUOC_ID,            VP.SOLUONG,            VTYT.PHAMVI_ID,            VTYT.KHOSUDUNG_ID AS KHODUOC_ID,            VTYT.CHUNGTU_ID,            VTYT.CHUNGTUTONGHOP_ID,            VTYT.NGUONHANG_ID,            VTYT.TINHTIEN,            VTYT.BNTUCHITRA,            VTYT.KHOTAO_ID,            VTYT.COSO,            VTYT.GHICHU,            VP.DONGIA_DOANHTHU,            VP.THANHTIEN_DOANHTHU,            vp.BHYT_DONGIA,            VP.BHYT_THANHTIEN,            CT.MACHUNGTU AS SOPHIEUXUAT,            PL.MACHUNGTU AS SOPHIEULINH            FROM            TT_PHAUTHUAT_VTYT VTYT            left join TT_PHAUTHUAT  PT on PT.PHAUTHUAT_ID = VTYT.PHAUTHUAT_ID            left join TT_VIENPHI VP  on VTYT.PHAUTHUAT_VTYT_ID = VP.REF_ID and VP.REF_TABLE = 'TT_PHAUTHUAT_VTYT'            left join TT_DUOC_CHUNGTU CT on VTYT.CHUNGTU_ID = CT.CHUNGTU_ID            left join TT_DUOC_PHIEULINH PL on VTYT.CHUNGTUTONGHOP_ID = PL.CHUNGTU_ID            WHERE            PT.PHAUTHUAT_ID =  '3745']
2019-08-14 17:45:45,487 [1] DEBUG - Statement Id: [DAO00063_GetListPhamviTuKhoThuocVaPhongBan] PreparedStatement : [select distinct dpv.*, dmap.KHODUOC_ID        from TM_DUOC_PHAMVISD_MAPPING dmap        left join TM_DUOC_PHAMVISUDUNG dpv on dpv.PHAMVI_ID = dmap.PHAMVI_ID and dpv.TAMNGUNG != '1'        where dmap.KHODUOC_ID in (select KHODUOC_ID from TM_PHONGBAN_KHODUOC where PHONGBAN_ID = '25')        and dmap.KHODUOC_ID = '29' and dpv.MAPHAMVI is not null]
2019-08-14 17:45:58,646 [1] DEBUG - Statement Id: [DAO00066_GetBENHAN_TIEPNHAN] PreparedStatement : [select top 1 *        from TT_NOITRU_BENHAN        where TIEPNHAN_ID = '26730'  and BENHVIEN_ID = 'HLU01'        order by NGAYTAO desc]
2019-08-14 17:45:58,723 [1] DEBUG - Statement Id: [DAO00014_GetInPatientStatus] PreparedStatement : [select TRANGTHAI, isnull(KHOACHUYENDEN_ID, KHOAVAO_ID) as KHOAHIENTAI from TT_NOITRU_BENHAN        where        TIEPNHAN_ID = '26730'        and BENHVIEN_ID = 'HLU01'         and           BENHAN_ID = '5737']
2019-08-14 17:45:58,799 [1] DEBUG - Statement Id: [DAO00014_GetORMServiceStatus] PreparedStatement : [select dvyc.TRANGTHAI, pt.NGUOIKHOA_ID, pt.NGUOITAO_ID        from TT_PHAUTHUAT pt        left join TT_PHAUTHUAT_YEUCAU ptyc on ptyc.PHAUTHUAT_ID = pt.PHAUTHUAT_ID        left join (select * from TT_DVYEUCAU where exists (select DVYEUCAU_ID from TT_PHAUTHUAT where TT_DVYEUCAU.DVYEUCAU_ID = DVYEUCAU_ID and PHAUTHUAT_ID = '3745')) dvyc        on ptyc.DVYEUCAU_ID = dvyc.DVYEUCAU_ID        where pt.PHAUTHUAT_ID = '3745']
2019-08-14 17:46:00,397 [1] DEBUG - Statement Id: [DAO00048_GetDanhSachBookingDuocTheo_PhauThuat_ID] PreparedStatement : [SELECT REF_TABLE,REF_ID ,B.DUOC_ID,B.BENHVIEN_ID,B.SOLUONG, B.PHAMVI_ID  ,B.KHODUOC_ID, B.NGUONHANG_ID, B.NGUONHANG_ID AS NGUONDUOC_ID            FROM TT_DUOC_TONKHO_BOOK_NGOAITRU B            INNER JOIN TT_PHAUTHUAT_VTYT VT ON B.REF_ID=VT.PHAUTHUAT_VTYT_ID            WHERE REF_TABLE='TT_PHAUTHUAT_VTYT' AND VT.PHAUTHUAT_ID='3745'AND B.BENHVIEN_ID='HLU01']
2019-08-14 17:46:00,498 [1] DEBUG - Statement Id: [DAO00014_Delete_Booking] PreparedStatement : [delete from TT_DUOC_TONKHO_BOOK_NGOAITRU        where REF_TABLE =  @param0         and REF_ID =  @param1         and DUOC_ID =  @param2         and BENHVIEN_ID =  @param3          and           PHAMVI_ID =  @param4]
2019-08-14 17:46:00,498 [1] DEBUG - Statement Id: [DAO00014_Delete_Booking] Parameters: [@param0=[REF_TABLE,TT_PHAUTHUAT_VTYT], @param1=[REF_ID,1239], @param2=[DUOC_ID,14], @param3=[BENHVIEN_ID,HLU01], @param4=[PHAMVI_ID,1052]]
2019-08-14 17:46:00,498 [1] DEBUG - Statement Id: [DAO00014_Delete_Booking] Types: [@param0=[String, System.String], @param1=[Int32, System.Int32], @param2=[Int32, System.Int32], @param3=[String, System.String], @param4=[Int32, System.Int32]]
2019-08-14 17:46:00,553 [1] DEBUG - Statement Id: [DAO00014_Delete_Booking] PreparedStatement : [delete from TT_DUOC_TONKHO_BOOK_NGOAITRU        where REF_TABLE =  @param0         and REF_ID =  @param1         and DUOC_ID =  @param2         and BENHVIEN_ID =  @param3          and           PHAMVI_ID =  @param4]
2019-08-14 17:46:00,553 [1] DEBUG - Statement Id: [DAO00014_Delete_Booking] Parameters: [@param0=[REF_TABLE,TT_PHAUTHUAT_VTYT], @param1=[REF_ID,1240], @param2=[DUOC_ID,3], @param3=[BENHVIEN_ID,HLU01], @param4=[PHAMVI_ID,1052]]
2019-08-14 17:46:00,553 [1] DEBUG - Statement Id: [DAO00014_Delete_Booking] Types: [@param0=[String, System.String], @param1=[Int32, System.Int32], @param2=[Int32, System.Int32], @param3=[String, System.String], @param4=[Int32, System.Int32]]
2019-08-14 17:46:00,609 [1] DEBUG - Statement Id: [DAO00048_GetlistvtytBeforeDelete] PreparedStatement : [select * from TT_PHAUTHUAT_VTYT where PHAUTHUAT_ID = 3745]
2019-08-14 17:46:00,639 [1] DEBUG - Statement Id: [DAO00048_DeleteAllVTYT] PreparedStatement : [delete from TT_DUOC_TONKHO_BOOK_NGOAITRU          where REF_TABLE = 'TT_PHAUTHUAT_VTYT' and exists (select PHAUTHUAT_VTYT_ID from TT_PHAUTHUAT_VTYT where TT_DUOC_TONKHO_BOOK_NGOAITRU.REF_ID = PHAUTHUAT_VTYT_ID and PHAUTHUAT_ID = 3745)            delete from TT_VIENPHI          where REF_TABLE = 'TT_PHAUTHUAT_VTYT' and exists (select PHAUTHUAT_VTYT_ID from TT_PHAUTHUAT_VTYT where TT_VIENPHI.REF_ID = PHAUTHUAT_VTYT_ID and PHAUTHUAT_ID = 3745)            delete from TT_PHAUTHUAT_VTYT where PHAUTHUAT_ID = 3745]
2019-08-14 17:46:00,803 [1] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoVaBookingCOM23UpdateRedis] PreparedStatement : [select  distinct tk.DUOC_KEY, LTRIM(tk.PHAMVI_ID) as PHAMVI_ID, tk.NGUONDUOC_ID, nh.TENNGUONDUOC, nh.TINHTIEN, d.DUOC_ID, ld.MALOAIDUOC,        d.SOVISA,d.TYLE_VAT,d.COTOA, d.MADUOC, d.TENHANG, d.TENDUOCDAYDU, dvt.TENDONVITINH as DONVITINH, d.BHYT,        d.TENHOATCHAT, d.HAMLUONG, d.HANGSANXUAT, d.QUOCGIA, d.LOAIDUOC_ID, d.DUONGDUNG_ID, d.TINHTIEN_PTTT,        ten.TENDUOC, ten.TENDUOC_EN, ten.MAQUOCTE, ten.MAQUOCTEBT,        CASE WHEN d.BHYT = '1' THEN 'BHYT' ELSE '' END as BHYT_TEXT        , ld.LOAIVATTU_ID        , d.BENHVIEN_ID,        tk.SOLUONG, d.VTYT_PHANLOAI, d.PHAMVI, d.SUASOLUONGTONGHOP, d.MADUOCBV, d.DANGTRINHBAY        , TAMNGUNG = CASE WHEN d.TAMNGUNG = '1' OR nh.TAMNGUNG = '1' OR kd.TAMNGUNG = '1' THEN '1' ELSE '0' END        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        inner join        (        select  LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')) DUOC_KEY, (SUM(dtk.SOLUONG) - isnull(sum(A.SOLUONG),0) - isnull(sum(B.SOLUONG),0)) SOLUONG, pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        from (select sum(soluong) soluong,duoc_id,nguonduoc_id,khoduoc_id,benhvien_id from TT_DUOC_TONKHO  group by duoc_id,nguonduoc_id,khoduoc_id,benhvien_id) dtk        inner join TM_DUOC_PHAMVISD_MAPPING pvsd on dtk.KHODUOC_ID = pvsd.KHODUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NOITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) B on B.DUOC_ID = dtk.DUOC_ID and B.SOLUONG > 0 and B.PHAMVI_ID = pvsd.PHAMVI_ID and B.NGUONHANG_ID = dtk.NGUONDUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NGOAITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) A on A.DUOC_ID = dtk.DUOC_ID and A.SOLUONG > 0 and A.PHAMVI_ID = pvsd.PHAMVI_ID and A.NGUONHANG_ID = dtk.NGUONDUOC_ID        where dtk.SOLUONG > 0 and dtk.BENHVIEN_ID = 'HLU01'        group by LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')), pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        ) tk on tk.DUOC_ID = d.DUOC_ID        left join TM_DUOC_PHAMVISUDUNG kd on kd.PHAMVI_ID = tk.PHAMVI_ID and kd.BENHVIEN_ID = 'HLU01'        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = tk.NGUONDUOC_ID and nh.BENHVIEN_ID = 'HLU01'        where  d.BENHVIEN_ID = 'HLU01' and d.DUOC_ID in (1239,1240)]
2019-08-14 17:46:01,483 [1] DEBUG - Statement Id: [DAO00048_TT_PHAUTHUAT_GetList] PreparedStatement : [select *              from TT_PHAUTHUAT               where                             TT_PHAUTHUAT.LOAI = 'P'                       and                           TT_PHAUTHUAT.TIEPNHAN_ID = 26730                       and                           TT_PHAUTHUAT.BENHVIEN_ID = 'HLU01'                                     order by PHAUTHUAT_ID DESC]
2019-08-14 17:46:07,342 [1] DEBUG - Statement Id: [DAO00048_TT_PHAUTHUAT_YEUCAU_GetList] PreparedStatement : [SELECT YC.[PHAUTHUAT_YEUCAU_ID]              ,YC.[PHAUTHUAT_ID]              ,YC.[DVYEUCAU_ID]              ,YC.[NHOMDICHVU_ID]              ,YC.[DICHVU_ID]              ,YC.[LOAIGIA_ID]              ,VP.[BHYT_THANHTIEN_CHITRA]              ,VP.[BENHNHAN_PHAITHANHTOAN]              ,VP.[THANHTIEN_DOANHTHU]              ,YC.[BENHVIEN_ID]              FROM [TT_PHAUTHUAT_YEUCAU] YC              INNER JOIN TT_VIENPHI VP ON YC.DVYEUCAU_ID= VP.REF_ID AND VP.REF_TABLE ='TT_DVYEUCAU'               where                             YC.PHAUTHUAT_ID = '3745'                       and                           YC.BENHVIEN_ID = 'HLU01'                                     order by PHAUTHUAT_YEUCAU_ID]
2019-08-14 17:46:07,388 [1] DEBUG - Statement Id: [DAO00048_TT_PHAUTHUAT_PPVOCAM_GetDetail] PreparedStatement : [select *              from TT_PHAUTHUAT_PPVOCAM              where PHAUTHUAT_ID  = 3745]
2019-08-14 17:46:07,652 [1] DEBUG - Statement Id: [DAO00048_TT_PHAUTHUAT_GetDetail] PreparedStatement : [select PT.*, TN.BENHNHAN_ID              from              TT_PHAUTHUAT PT, TT_TIEPNHAN TN              where              PT.TIEPNHAN_ID = TN.TIEPNHAN_ID              AND PHAUTHUAT_ID  = 3745]
2019-08-14 17:46:07,792 [1] DEBUG - Statement Id: [DAO00048_CheckDVPhauThuatBHYT] PreparedStatement : [select count(0) from TT_VIENPHI          where REF_TABLE = 'TT_DVYEUCAU' and REF_ID = (select top 1 DVYEUCAU_ID from TT_PHAUTHUAT_YEUCAU where PHAUTHUAT_ID =  @param0 )          and TIEPNHAN_ID =  @param1  and BHYT_DONGIA > 0]
2019-08-14 17:46:07,792 [1] DEBUG - Statement Id: [DAO00048_CheckDVPhauThuatBHYT] Parameters: [@param0=[PHAUTHUAT_ID,3745], @param1=[TIEPNHAN_ID,26730]]
2019-08-14 17:46:07,792 [1] DEBUG - Statement Id: [DAO00048_CheckDVPhauThuatBHYT] Types: [@param0=[Int64, System.Int64], @param1=[Int64, System.Int64]]
2019-08-14 17:46:07,827 [1] DEBUG - Statement Id: [DAO00116_File_GetList] PreparedStatement : [select *              from TT_FILE_DINHKEM               where                             TT_FILE_DINHKEM.REF_TABLE = 'TT_PHAUTHUAT'                       and                           TT_FILE_DINHKEM.REF_ID = '3745'                       and                           TT_FILE_DINHKEM.BENHVIEN_ID = 'HLU01'                                     order by FILE_ID]
2019-08-14 17:46:08,052 [1] DEBUG - Statement Id: [DAO00048_TT_PHAUTHUAT_GetDetail] PreparedStatement : [select PT.*, TN.BENHNHAN_ID              from              TT_PHAUTHUAT PT, TT_TIEPNHAN TN              where              PT.TIEPNHAN_ID = TN.TIEPNHAN_ID              AND PHAUTHUAT_ID  = 3745]
2019-08-14 17:46:08,449 [1] DEBUG - Statement Id: [DAO00048_CheckDVPhauThuatBHYT] PreparedStatement : [select count(0) from TT_VIENPHI          where REF_TABLE = 'TT_DVYEUCAU' and REF_ID = (select top 1 DVYEUCAU_ID from TT_PHAUTHUAT_YEUCAU where PHAUTHUAT_ID =  @param0 )          and TIEPNHAN_ID =  @param1  and BHYT_DONGIA > 0]
2019-08-14 17:46:08,450 [1] DEBUG - Statement Id: [DAO00048_CheckDVPhauThuatBHYT] Parameters: [@param0=[PHAUTHUAT_ID,3745], @param1=[TIEPNHAN_ID,26730]]
2019-08-14 17:46:08,450 [1] DEBUG - Statement Id: [DAO00048_CheckDVPhauThuatBHYT] Types: [@param0=[Int64, System.Int64], @param1=[Int64, System.Int64]]
2019-08-14 17:46:08,486 [1] DEBUG - Statement Id: [DAO00116_File_GetList] PreparedStatement : [select *              from TT_FILE_DINHKEM               where                             TT_FILE_DINHKEM.REF_TABLE = 'TT_PHAUTHUAT'                       and                           TT_FILE_DINHKEM.REF_ID = '3745'                       and                           TT_FILE_DINHKEM.BENHVIEN_ID = 'HLU01'                                     order by FILE_ID]
2019-08-14 17:46:08,565 [1] DEBUG - Statement Id: [DAO00048_TT_PHAUTHUAT_YEUCAU_GetList] PreparedStatement : [SELECT YC.[PHAUTHUAT_YEUCAU_ID]              ,YC.[PHAUTHUAT_ID]              ,YC.[DVYEUCAU_ID]              ,YC.[NHOMDICHVU_ID]              ,YC.[DICHVU_ID]              ,YC.[LOAIGIA_ID]              ,VP.[BHYT_THANHTIEN_CHITRA]              ,VP.[BENHNHAN_PHAITHANHTOAN]              ,VP.[THANHTIEN_DOANHTHU]              ,YC.[BENHVIEN_ID]              FROM [TT_PHAUTHUAT_YEUCAU] YC              INNER JOIN TT_VIENPHI VP ON YC.DVYEUCAU_ID= VP.REF_ID AND VP.REF_TABLE ='TT_DVYEUCAU'               where                             YC.PHAUTHUAT_ID = '3745'                       and                           YC.BENHVIEN_ID = 'HLU01'                                     order by PHAUTHUAT_YEUCAU_ID]
2019-08-14 17:46:08,605 [1] DEBUG - Statement Id: [DAO00048_TT_PHAUTHUAT_PPVOCAM_GetDetail] PreparedStatement : [select *              from TT_PHAUTHUAT_PPVOCAM              where PHAUTHUAT_ID  = 3745]
2019-08-14 17:46:15,353 [1] DEBUG - Statement Id: [DAO00063_GetListKhoThuocPhongBanPhamvi] PreparedStatement : [select distinct dpv.*        from TM_DUOC_PHAMVISD_MAPPING dmap        left join TM_DUOC_PHAMVISUDUNG dpv on dpv.PHAMVI_ID = dmap.PHAMVI_ID        where dmap.KHODUOC_ID in (select KHODUOC_ID from TM_PHONGBAN_KHODUOC where PHONGBAN_ID = '25')]
2019-08-14 17:46:15,396 [1] DEBUG - Statement Id: [DAO00051_GetTemplateDuoc] PreparedStatement : [select *              from TM_TEMPLATEDUOC               where                             NGUOITAO_ID = '1'                       and                           KHOATAO_ID = '25'                                     ORDER BY TENTEMPLATE]
2019-08-14 17:46:15,425 [1] DEBUG - Statement Id: [DAO00048_TT_VIENPHI_GetList] PreparedStatement : [select *              from TT_VIENPHI               where                             TT_VIENPHI.TIEPNHAN_ID = '26730'                       and                           TT_VIENPHI.BENHAN_ID = '5737'                       and                           TT_VIENPHI.BENHVIEN_ID = 'HLU01'                       and                           TT_VIENPHI.NGUOITAO_ID = '1'                       and                           TT_VIENPHI.NGAYTAO = '8/14/2019 5:44:31 PM'                       and                           TT_VIENPHI.NGUOICAPNHAT_ID = '1'                       and                           TT_VIENPHI.NGAYCAPNHAT = '8/14/2019 5:44:31 PM'                                     order by VIENPHI_ID]
2019-08-14 17:46:15,608 [1] DEBUG - Statement Id: [DAO00048_GetPhauThuat_VTYT_ByPhauThuatID] PreparedStatement : [SELECT            VTYT.PHAUTHUAT_VTYT_ID,            VTYT.PHAUTHUAT_ID,            VTYT.NGAYSUDUNG,            VTYT.TRANGTHAI_XEM,            VTYT.NGUONGOCDULIEU,            VTYT.NGUOITAO_ID,            VTYT.NGAYTAO,            VTYT.DUOC_ID,            VP.SOLUONG,            VTYT.PHAMVI_ID,            VTYT.KHOSUDUNG_ID AS KHODUOC_ID,            VTYT.CHUNGTU_ID,            VTYT.CHUNGTUTONGHOP_ID,            VTYT.NGUONHANG_ID,            VTYT.TINHTIEN,            VTYT.BNTUCHITRA,            VTYT.KHOTAO_ID,            VTYT.COSO,            VTYT.GHICHU,            VP.DONGIA_DOANHTHU,            VP.THANHTIEN_DOANHTHU,            vp.BHYT_DONGIA,            VP.BHYT_THANHTIEN,            CT.MACHUNGTU AS SOPHIEUXUAT,            PL.MACHUNGTU AS SOPHIEULINH            FROM            TT_PHAUTHUAT_VTYT VTYT            left join TT_PHAUTHUAT  PT on PT.PHAUTHUAT_ID = VTYT.PHAUTHUAT_ID            left join TT_VIENPHI VP  on VTYT.PHAUTHUAT_VTYT_ID = VP.REF_ID and VP.REF_TABLE = 'TT_PHAUTHUAT_VTYT'            left join TT_DUOC_CHUNGTU CT on VTYT.CHUNGTU_ID = CT.CHUNGTU_ID            left join TT_DUOC_PHIEULINH PL on VTYT.CHUNGTUTONGHOP_ID = PL.CHUNGTU_ID            WHERE            PT.PHAUTHUAT_ID =  '3745']
2019-08-14 17:46:15,636 [1] DEBUG - Statement Id: [DAO00063_GetListPhamviTuKhoThuocVaPhongBan] PreparedStatement : [select distinct dpv.*, dmap.KHODUOC_ID        from TM_DUOC_PHAMVISD_MAPPING dmap        left join TM_DUOC_PHAMVISUDUNG dpv on dpv.PHAMVI_ID = dmap.PHAMVI_ID and dpv.TAMNGUNG != '1'        where dmap.KHODUOC_ID in (select KHODUOC_ID from TM_PHONGBAN_KHODUOC where PHONGBAN_ID = '25')        and dmap.KHODUOC_ID = '29' and dpv.MAPHAMVI is not null]
2019-08-14 17:46:18,182 [1] DEBUG - Statement Id: [DAO00051_GetMauTuongTrinh] PreparedStatement : [select *              from TM_TUDIENKETQUA              where BENHVIEN_ID = 'HLU01'               and                   NGUOITAO_ID = '1'                and DICHVU_ID in  (                        @param0                   )               ORDER BY TENNOIDUNG]
2019-08-14 17:46:18,183 [1] DEBUG - Statement Id: [DAO00051_GetMauTuongTrinh] Parameters: [@param0=[LSTDICHVU_ID[0],3329]]
2019-08-14 17:46:18,183 [1] DEBUG - Statement Id: [DAO00051_GetMauTuongTrinh] Types: [@param0=[Int64, System.Int64]]
2019-08-14 17:46:18,213 [1] DEBUG - Statement Id: [DAO00048_TT_PHAUTHUAT_GetDetail] PreparedStatement : [select PT.*, TN.BENHNHAN_ID              from              TT_PHAUTHUAT PT, TT_TIEPNHAN TN              where              PT.TIEPNHAN_ID = TN.TIEPNHAN_ID              AND PHAUTHUAT_ID  = 3745]
2019-08-14 17:46:18,248 [1] DEBUG - Statement Id: [DAO00048_TT_PHAUTHUAT_IMAGES_GetList] PreparedStatement : [select *              from TT_PHAUTHUAT_IMAGES               where                             TT_PHAUTHUAT_IMAGES.PHAUTHUAT_ID = '3745'                       and                           TT_PHAUTHUAT_IMAGES.BENHVIEN_ID = 'HLU01'                                     order by IMAGES_ID]
2019-08-14 17:46:20,698 [1] DEBUG - Statement Id: [DAO00048_TT_PHAUTHUAT_EKIP_GetDetail] PreparedStatement : [select *              from TT_PHAUTHUAT_EKIP              where PHAUTHUAT_ID  = 3745]
2019-08-14 17:46:24,769 [1] DEBUG - Statement Id: [DAO00048_TT_VIENPHI_GetList] PreparedStatement : [select *              from TT_VIENPHI               where                             TT_VIENPHI.TIEPNHAN_ID = '26730'                       and                           TT_VIENPHI.BENHAN_ID = '5737'                       and                           TT_VIENPHI.BENHVIEN_ID = 'HLU01'                       and                           TT_VIENPHI.NGUOITAO_ID = '1'                       and                           TT_VIENPHI.NGAYTAO = '8/14/2019 5:44:31 PM'                       and                           TT_VIENPHI.NGUOICAPNHAT_ID = '1'                       and                           TT_VIENPHI.NGAYCAPNHAT = '8/14/2019 5:44:31 PM'                                     order by VIENPHI_ID]
2019-08-14 17:46:24,867 [1] DEBUG - Statement Id: [DAO00048_GetPhauThuat_VTYT_ByPhauThuatID] PreparedStatement : [SELECT            VTYT.PHAUTHUAT_VTYT_ID,            VTYT.PHAUTHUAT_ID,            VTYT.NGAYSUDUNG,            VTYT.TRANGTHAI_XEM,            VTYT.NGUONGOCDULIEU,            VTYT.NGUOITAO_ID,            VTYT.NGAYTAO,            VTYT.DUOC_ID,            VP.SOLUONG,            VTYT.PHAMVI_ID,            VTYT.KHOSUDUNG_ID AS KHODUOC_ID,            VTYT.CHUNGTU_ID,            VTYT.CHUNGTUTONGHOP_ID,            VTYT.NGUONHANG_ID,            VTYT.TINHTIEN,            VTYT.BNTUCHITRA,            VTYT.KHOTAO_ID,            VTYT.COSO,            VTYT.GHICHU,            VP.DONGIA_DOANHTHU,            VP.THANHTIEN_DOANHTHU,            vp.BHYT_DONGIA,            VP.BHYT_THANHTIEN,            CT.MACHUNGTU AS SOPHIEUXUAT,            PL.MACHUNGTU AS SOPHIEULINH            FROM            TT_PHAUTHUAT_VTYT VTYT            left join TT_PHAUTHUAT  PT on PT.PHAUTHUAT_ID = VTYT.PHAUTHUAT_ID            left join TT_VIENPHI VP  on VTYT.PHAUTHUAT_VTYT_ID = VP.REF_ID and VP.REF_TABLE = 'TT_PHAUTHUAT_VTYT'            left join TT_DUOC_CHUNGTU CT on VTYT.CHUNGTU_ID = CT.CHUNGTU_ID            left join TT_DUOC_PHIEULINH PL on VTYT.CHUNGTUTONGHOP_ID = PL.CHUNGTU_ID            WHERE            PT.PHAUTHUAT_ID =  '3745']
2019-08-14 17:46:24,896 [1] DEBUG - Statement Id: [DAO00063_GetListPhamviTuKhoThuocVaPhongBan] PreparedStatement : [select distinct dpv.*, dmap.KHODUOC_ID        from TM_DUOC_PHAMVISD_MAPPING dmap        left join TM_DUOC_PHAMVISUDUNG dpv on dpv.PHAMVI_ID = dmap.PHAMVI_ID and dpv.TAMNGUNG != '1'        where dmap.KHODUOC_ID in (select KHODUOC_ID from TM_PHONGBAN_KHODUOC where PHONGBAN_ID = '25')        and dmap.KHODUOC_ID = '29' and dpv.MAPHAMVI is not null]
2019-08-14 17:46:33,026 [1] DEBUG - Statement Id: [DAO00048_TT_VIENPHI_GetList] PreparedStatement : [select *              from TT_VIENPHI               where                             TT_VIENPHI.TIEPNHAN_ID = '26730'                       and                           TT_VIENPHI.BENHAN_ID = '5737'                       and                           TT_VIENPHI.BENHVIEN_ID = 'HLU01'                       and                           TT_VIENPHI.NGUOITAO_ID = '1'                       and                           TT_VIENPHI.NGAYTAO = '8/14/2019 5:44:31 PM'                       and                           TT_VIENPHI.NGUOICAPNHAT_ID = '1'                       and                           TT_VIENPHI.NGAYCAPNHAT = '8/14/2019 5:44:31 PM'                                     order by VIENPHI_ID]
2019-08-14 17:46:33,056 [1] DEBUG - Statement Id: [DAO00048_GetPhauThuat_VTYT_ByPhauThuatID] PreparedStatement : [SELECT            VTYT.PHAUTHUAT_VTYT_ID,            VTYT.PHAUTHUAT_ID,            VTYT.NGAYSUDUNG,            VTYT.TRANGTHAI_XEM,            VTYT.NGUONGOCDULIEU,            VTYT.NGUOITAO_ID,            VTYT.NGAYTAO,            VTYT.DUOC_ID,            VP.SOLUONG,            VTYT.PHAMVI_ID,            VTYT.KHOSUDUNG_ID AS KHODUOC_ID,            VTYT.CHUNGTU_ID,            VTYT.CHUNGTUTONGHOP_ID,            VTYT.NGUONHANG_ID,            VTYT.TINHTIEN,            VTYT.BNTUCHITRA,            VTYT.KHOTAO_ID,            VTYT.COSO,            VTYT.GHICHU,            VP.DONGIA_DOANHTHU,            VP.THANHTIEN_DOANHTHU,            vp.BHYT_DONGIA,            VP.BHYT_THANHTIEN,            CT.MACHUNGTU AS SOPHIEUXUAT,            PL.MACHUNGTU AS SOPHIEULINH            FROM            TT_PHAUTHUAT_VTYT VTYT            left join TT_PHAUTHUAT  PT on PT.PHAUTHUAT_ID = VTYT.PHAUTHUAT_ID            left join TT_VIENPHI VP  on VTYT.PHAUTHUAT_VTYT_ID = VP.REF_ID and VP.REF_TABLE = 'TT_PHAUTHUAT_VTYT'            left join TT_DUOC_CHUNGTU CT on VTYT.CHUNGTU_ID = CT.CHUNGTU_ID            left join TT_DUOC_PHIEULINH PL on VTYT.CHUNGTUTONGHOP_ID = PL.CHUNGTU_ID            WHERE            PT.PHAUTHUAT_ID =  '3745']
2019-08-14 17:46:33,085 [1] DEBUG - Statement Id: [DAO00063_GetListPhamviTuKhoThuocVaPhongBan] PreparedStatement : [select distinct dpv.*, dmap.KHODUOC_ID        from TM_DUOC_PHAMVISD_MAPPING dmap        left join TM_DUOC_PHAMVISUDUNG dpv on dpv.PHAMVI_ID = dmap.PHAMVI_ID and dpv.TAMNGUNG != '1'        where dmap.KHODUOC_ID in (select KHODUOC_ID from TM_PHONGBAN_KHODUOC where PHONGBAN_ID = '25')        and dmap.KHODUOC_ID = '29' and dpv.MAPHAMVI is not null]
2019-08-14 17:46:41,878 [1] DEBUG - Statement Id: [DAO00000_GetCHECK_DOITUONG_BHYT] PreparedStatement : [select count(*) as DOITUONG_BHYT FROM TM_DOITUONG A            WHERE A.DOITUONG_ID = '6' and A.BENHVIEN_ID = 'HLU01' and MADOITUONG like '%BHYT%']
2019-08-14 17:46:41,904 [1] DEBUG - Statement Id: [DAO00000_GetLOAIGIATHUOC_NOI_NGOAI_VIEN] PreparedStatement : [SELECT LOAIGIA_ID              FROM TM_LOAIGIA              WHERE MALOAIGIA = 'GiaThuoc_NoiVien' and BENHVIEN_ID = 'HLU01']
2019-08-14 17:46:41,930 [1] DEBUG - Statement Id: [DAO00000_GetDUOC_DONGIADOANHTHU_NOIVIEN] PreparedStatement : [declare @doanhthu numeric(24,2);          declare @hotro numeric(24,2);          select top 1 @doanhthu = dg.DONGIA           from TM_DUOC_DONGIA dg          left join TM_DOITUONG_LOAIGIA dtlg on dtlg.LOAIGIA_ID = dg.LOAIGIA_ID                     where dg.DUOC_ID = '5' and dtlg.DOITUONG_ID = '6' and dg.DONGIA is not null and dg.DONGIA > 0                      order by dtlg.DOUUTIEN asc           select top 1 @hotro = dg.DONGIA           from TM_DUOC_DONGIA dg          left join TM_DOITUONG_LOAIGIA dtlg on dtlg.LOAIGIA_ID = dg.LOAIGIA_ID                     where dg.DUOC_ID = '5' and dtlg.DOITUONG_ID = '6' and dg.DONGIA is not null and dg.DONGIA > 0  and GIAHOTRO = '1'                     order by dtlg.DOUUTIEN asc              select ISNULL(@doanhthu,0.0) DONGIA_DOANHTHU, ISNULL(@hotro, 0.0) DONGIA_KHAC]
2019-08-14 17:46:41,977 [1] DEBUG - Statement Id: [DAO00000_GetDuocBHYT] PreparedStatement : [select count(*) BHYT FROM TM_DUOC A WHERE A.DUOC_ID = '5' and BHYT = '1']
2019-08-14 17:46:42,031 [1] DEBUG - Statement Id: [DAO00000_GetCHECK_DOITUONG_BHYT] PreparedStatement : [select count(*) as DOITUONG_BHYT FROM TM_DOITUONG A            WHERE A.DOITUONG_ID = '6' and A.BENHVIEN_ID = 'HLU01' and MADOITUONG like '%BHYT%']
2019-08-14 17:46:42,057 [1] DEBUG - Statement Id: [DAO00000_GetLOAIGIATHUOC_NOI_NGOAI_VIEN] PreparedStatement : [SELECT LOAIGIA_ID              FROM TM_LOAIGIA              WHERE MALOAIGIA = 'GiaThuoc_NoiVien' and BENHVIEN_ID = 'HLU01']
2019-08-14 17:46:42,083 [1] DEBUG - Statement Id: [DAO00000_GetDUOC_DONGIADOANHTHU_NOIVIEN] PreparedStatement : [declare @doanhthu numeric(24,2);          declare @hotro numeric(24,2);          select top 1 @doanhthu = dg.DONGIA           from TM_DUOC_DONGIA dg          left join TM_DOITUONG_LOAIGIA dtlg on dtlg.LOAIGIA_ID = dg.LOAIGIA_ID                     where dg.DUOC_ID = '5' and dtlg.DOITUONG_ID = '6' and dg.DONGIA is not null and dg.DONGIA > 0                      order by dtlg.DOUUTIEN asc           select top 1 @hotro = dg.DONGIA           from TM_DUOC_DONGIA dg          left join TM_DOITUONG_LOAIGIA dtlg on dtlg.LOAIGIA_ID = dg.LOAIGIA_ID                     where dg.DUOC_ID = '5' and dtlg.DOITUONG_ID = '6' and dg.DONGIA is not null and dg.DONGIA > 0  and GIAHOTRO = '1'                     order by dtlg.DOUUTIEN asc              select ISNULL(@doanhthu,0.0) DONGIA_DOANHTHU, ISNULL(@hotro, 0.0) DONGIA_KHAC]
2019-08-14 17:46:42,110 [1] DEBUG - Statement Id: [DAO00000_GetDuocBHYT] PreparedStatement : [select count(*) BHYT FROM TM_DUOC A WHERE A.DUOC_ID = '5' and BHYT = '1']
2019-08-14 17:46:50,824 [1] DEBUG - Statement Id: [DAO00066_GetBENHAN_TIEPNHAN] PreparedStatement : [select top 1 *        from TT_NOITRU_BENHAN        where TIEPNHAN_ID = '26730'  and BENHVIEN_ID = 'HLU01'        order by NGAYTAO desc]
2019-08-14 17:46:50,901 [1] DEBUG - Statement Id: [DAO00014_GetInPatientStatus] PreparedStatement : [select TRANGTHAI, isnull(KHOACHUYENDEN_ID, KHOAVAO_ID) as KHOAHIENTAI from TT_NOITRU_BENHAN        where        TIEPNHAN_ID = '26730'        and BENHVIEN_ID = 'HLU01'         and           BENHAN_ID = '5737']
2019-08-14 17:46:50,977 [1] DEBUG - Statement Id: [DAO00014_GetORMServiceStatus] PreparedStatement : [select dvyc.TRANGTHAI, pt.NGUOIKHOA_ID, pt.NGUOITAO_ID        from TT_PHAUTHUAT pt        left join TT_PHAUTHUAT_YEUCAU ptyc on ptyc.PHAUTHUAT_ID = pt.PHAUTHUAT_ID        left join (select * from TT_DVYEUCAU where exists (select DVYEUCAU_ID from TT_PHAUTHUAT where TT_DVYEUCAU.DVYEUCAU_ID = DVYEUCAU_ID and PHAUTHUAT_ID = '3745')) dvyc        on ptyc.DVYEUCAU_ID = dvyc.DVYEUCAU_ID        where pt.PHAUTHUAT_ID = '3745']
2019-08-14 17:46:51,057 [1] DEBUG - Statement Id: [DAO00066_GetBENHAN_TIEPNHAN] PreparedStatement : [select top 1 *        from TT_NOITRU_BENHAN        where TIEPNHAN_ID = '26730'  and BENHVIEN_ID = 'HLU01'        order by NGAYTAO desc]
2019-08-14 17:46:51,138 [1] DEBUG - Statement Id: [DAO00014_GetInPatientStatus] PreparedStatement : [select TRANGTHAI, isnull(KHOACHUYENDEN_ID, KHOAVAO_ID) as KHOAHIENTAI from TT_NOITRU_BENHAN        where        TIEPNHAN_ID = '26730'        and BENHVIEN_ID = 'HLU01'         and           BENHAN_ID = '5737']
2019-08-14 17:46:51,221 [1] DEBUG - Statement Id: [DAO00063_KiemtraSoluongDuocXuatNgoaitru] PreparedStatement : [select A.TONKHO, isnull(B.BOOK_NGOAI,0) BOOK_NGOAI, isnull(D.BOOK_NOI,0) BOOK_NOI,  (A.TONKHO - isnull(B.BOOK_NGOAI,0) - isnull(D.BOOK_NOI,0)) TONKHO_BOOK        from(        select SUM(tk.SOLUONG) TONKHO, tk.DUOC_ID, sd.PHAMVI_ID, tk.NGUONDUOC_ID from TT_DUOC_TONKHO tk        inner join TM_DUOC_PHAMVISD_MAPPING sd on sd.KHODUOC_ID = tk.KHODUOC_ID        where sd.PHAMVI_ID  = '1052' and tk.DUOC_ID = '5' and tk.NGUONDUOC_ID = '1'        group by tk.DUOC_ID, sd.PHAMVI_ID, tk.NGUONDUOC_ID) A        left join (        select SUM(SOLUONG) BOOK_NGOAI,DUOC_ID, PHAMVI_ID, NGUONHANG_ID from TT_DUOC_TONKHO_BOOK_NGOAITRU        where PHAMVI_ID  = '1052' and DUOC_ID = '5' and NGUONHANG_ID = '1' and TRANGTHAI = 'HIEULUC' and SOLUONG > 0        group by DUOC_ID, PHAMVI_ID, NGUONHANG_ID) B on A.DUOC_ID = B.DUOC_ID and A.PHAMVI_ID = B.PHAMVI_ID and A.NGUONDUOC_ID = B.NGUONHANG_ID        left join (        select SUM(SOLUONG) BOOK_NOI,DUOC_ID, PHAMVI_ID, NGUONHANG_ID from TT_DUOC_TONKHO_BOOK_NOITRU        where PHAMVI_ID  = '1052' and DUOC_ID = '5' and NGUONHANG_ID = '1' and TRANGTHAI = 'HIEULUC'  and SOLUONG > 0        group by DUOC_ID, PHAMVI_ID, NGUONHANG_ID) D on A.DUOC_ID = D.DUOC_ID and A.PHAMVI_ID = D.PHAMVI_ID and A.NGUONDUOC_ID = D.NGUONHANG_ID]
2019-08-14 17:46:51,353 [1] DEBUG - Statement Id: [DAO00048_TT_PHAUTHUAT_Update] PreparedStatement : [update TT_PHAUTHUAT set              SOPHIEUPHAUTHUAT =  @param0               , LOAI =  @param1               , BENHAN_ID =  @param2               , LUUTRU_ID =  @param3               , TIEPNHAN_ID =  @param4               , PHONGBANTHUCHIEN_ID =  @param5               , NGAYTHUCHIEN =  @param6               , THOIGIANBATDAU =  @param7               , THOIGIANKETTHUC =  @param8               , ICD_VAOKHOA =  @param9               , ICD_VAOKHOA_MOTA =  @param10               , ICD_TRUOCPHAUTHUAT =  @param11               , ICD_TRUOCPHAUTHUAT_MOTA =  @param12               , ICD_SAUPHAUTHUAT =  @param13               , ICD_SAUPHAUTHUAT_MOTA =  @param14               , NHOMDICHVU_ID =  @param15               , DICHVU_ID =  @param16               , PHUONGPHAPVOCAM_ID =  @param17               , TAIBIEN_ID =  @param18               , CHEDO_ID =  @param19               , TUVONG_ID =  @param20               , TRINHTUTHUCHIEN =  @param21               , MOTA =  @param22               , KETQUA =  @param23               , BENHNHANBENNGOAI =  @param24               , NGUONBENH_ID =  @param25               , LOAIPHAUTHUAT =  @param26               , DANLUU =  @param27               , NGAYRUT =  @param28               , NGAYCATCHI =  @param29               , KHAC =  @param30               , SOLANMOLAI =  @param31               , LYDOMOLAI =  @param32               , CANTHIEPPHAUTHUAT =  @param33               , TUDIENKETQUA_ID =  @param34               , PHONGBANCHIDINH_ID =  @param35               , PPMO_ID =  @param36               , THOIGIANGAYME =  @param37               , KHOADULIEU =  @param38               , NGUOIKHOA_ID =  @param39               , TENNGUOIKHOA =  @param40               , NGAYKHOADULIEU =  @param41               , THOIGIANKHOADULIEU =  @param42                            , NGAYCAPNHAT =  @param43             , NGUOICAPNHAT_ID =  @param44             , BENHVIEN_ID =  @param45              ,               PHUONGPHAPPTTT =  @param46                            where              PHAUTHUAT_ID = 3745]
2019-08-14 17:46:51,354 [1] DEBUG - Statement Id: [DAO00048_TT_PHAUTHUAT_Update] Parameters: [@param0=[SOPHIEUPHAUTHUAT,19.P.03905], @param1=[LOAI,P], @param2=[BENHAN_ID,5737], @param3=[LUUTRU_ID,null], @param4=[TIEPNHAN_ID,26730], @param5=[PHONGBANTHUCHIEN_ID,25], @param6=[NGAYTHUCHIEN,8/14/2019 5:46:51 PM], @param7=[THOIGIANBATDAU,8/14/2019 5:44:00 PM], @param8=[THOIGIANKETTHUC,8/14/2019 6:44:00 PM], @param9=[ICD_VAOKHOA,null], @param10=[ICD_VAOKHOA_MOTA,null], @param11=[ICD_TRUOCPHAUTHUAT,null], @param12=[ICD_TRUOCPHAUTHUAT_MOTA,null], @param13=[ICD_SAUPHAUTHUAT,null], @param14=[ICD_SAUPHAUTHUAT_MOTA,null], @param15=[NHOMDICHVU_ID,null], @param16=[DICHVU_ID,null], @param17=[PHUONGPHAPVOCAM_ID,null], @param18=[TAIBIEN_ID,null], @param19=[CHEDO_ID,768], @param20=[TUVONG_ID,null], @param21=[TRINHTUTHUCHIEN,null], @param22=[MOTA,null], @param23=[KETQUA,null], @param24=[BENHNHANBENNGOAI,null], @param25=[NGUONBENH_ID,745], @param26=[LOAIPHAUTHUAT,PTM], @param27=[DANLUU,null], @param28=[NGAYRUT,null], @param29=[NGAYCATCHI,null], @param30=[KHAC,null], @param31=[SOLANMOLAI,null], @param32=[LYDOMOLAI,null], @param33=[CANTHIEPPHAUTHUAT,null], @param34=[TUDIENKETQUA_ID,null], @param35=[PHONGBANCHIDINH_ID,null], @param36=[PPMO_ID,null], @param37=[THOIGIANGAYME,null], @param38=[KHOADULIEU,0], @param39=[NGUOIKHOA_ID,null], @param40=[TENNGUOIKHOA,null], @param41=[NGAYKHOADULIEU,null], @param42=[THOIGIANKHOADULIEU,null], @param43=[NGAYCAPNHAT,8/14/2019 5:46:51 PM], @param44=[NGUOICAPNHAT_ID,1], @param45=[BENHVIEN_ID,HLU01], @param46=[PHUONGPHAPPTTT,null]]
2019-08-14 17:46:51,354 [1] DEBUG - Statement Id: [DAO00048_TT_PHAUTHUAT_Update] Types: [@param0=[String, System.String], @param1=[String, System.String], @param2=[Int64, System.Int64], @param3=[System.DBNull, null], @param4=[Int64, System.Int64], @param5=[Int64, System.Int64], @param6=[DateTime, System.DateTime], @param7=[DateTime, System.DateTime], @param8=[DateTime, System.DateTime], @param9=[System.DBNull, null], @param10=[System.DBNull, null], @param11=[System.DBNull, null], @param12=[System.DBNull, null], @param13=[System.DBNull, null], @param14=[System.DBNull, null], @param15=[System.DBNull, null], @param16=[System.DBNull, null], @param17=[System.DBNull, null], @param18=[System.DBNull, null], @param19=[Int64, System.Int64], @param20=[System.DBNull, null], @param21=[System.DBNull, null], @param22=[System.DBNull, null], @param23=[System.DBNull, null], @param24=[System.DBNull, null], @param25=[Int64, System.Int64], @param26=[String, System.String], @param27=[System.DBNull, null], @param28=[System.DBNull, null], @param29=[System.DBNull, null], @param30=[System.DBNull, null], @param31=[System.DBNull, null], @param32=[System.DBNull, null], @param33=[System.DBNull, null], @param34=[System.DBNull, null], @param35=[System.DBNull, null], @param36=[System.DBNull, null], @param37=[System.DBNull, null], @param38=[String, System.String], @param39=[System.DBNull, null], @param40=[System.DBNull, null], @param41=[System.DBNull, null], @param42=[System.DBNull, null], @param43=[DateTime, System.DateTime], @param44=[Int64, System.Int64], @param45=[String, System.String], @param46=[System.DBNull, null]]
2019-08-14 17:46:51,427 [1] DEBUG - Statement Id: [DAO00048_TT_PHAUTHUAT_YEUCAU_DeleteP] PreparedStatement : [delete from TT_PHAUTHUAT_YEUCAU             where                     TT_PHAUTHUAT_YEUCAU.PHAUTHUAT_ID = '3745']
2019-08-14 17:46:51,458 [1] DEBUG - Statement Id: [DAO00048_TT_PHAUTHUAT_PPVOCAM_DeleteP] PreparedStatement : [delete from TT_PHAUTHUAT_PPVOCAM              where PHAUTHUAT_ID = '3745']
2019-08-14 17:46:51,487 [1] DEBUG - Statement Id: [DAO00048_TT_PHAUTHUAT_YEUCAU_Add] PreparedStatement : [insert into TT_PHAUTHUAT_YEUCAU (              PHAUTHUAT_ID              , DVYEUCAU_ID              , NHOMDICHVU_ID              , DICHVU_ID              , LOAIGIA_ID              , THANHTIEN_DOANHTHU              , BHYT_THANHTIEN_CHITRA              , BENHNHAN_PHAITHANHTOAN              , BENHVIEN_ID              ) values (               @param0               ,  @param1               ,  @param2               ,  @param3               ,  @param4               ,  @param5               ,  @param6               ,  @param7               ,  @param8               )]
2019-08-14 17:46:51,487 [1] DEBUG - Statement Id: [DAO00048_TT_PHAUTHUAT_YEUCAU_Add] Parameters: [@param0=[PHAUTHUAT_ID,3745], @param1=[DVYEUCAU_ID,202112], @param2=[NHOMDICHVU_ID,29], @param3=[DICHVU_ID,3329], @param4=[LOAIGIA_ID,2], @param5=[THANHTIEN_DOANHTHU,949000], @param6=[BHYT_THANHTIEN_CHITRA,949000], @param7=[BENHNHAN_PHAITHANHTOAN,0], @param8=[BENHVIEN_ID,HLU01]]
2019-08-14 17:46:51,487 [1] DEBUG - Statement Id: [DAO00048_TT_PHAUTHUAT_YEUCAU_Add] Types: [@param0=[Int64, System.Int64], @param1=[Int64, System.Int64], @param2=[Int64, System.Int64], @param3=[Int64, System.Int64], @param4=[Int64, System.Int64], @param5=[Double, System.Double], @param6=[Double, System.Double], @param7=[Double, System.Double], @param8=[String, System.String]]
2019-08-14 17:46:51,514 [1] DEBUG - Statement Id: [DAO00048_UpdateDVYeuCauVienPhi] PreparedStatement : [update  TT_VIENPHI              set DATHUCHIEN = '1',              NGUOICAPNHAT_ID =  @param0 ,              NGAYCAPNHAT =  @param1               where              VIENPHI_ID =  @param2]
2019-08-14 17:46:51,514 [1] DEBUG - Statement Id: [DAO00048_UpdateDVYeuCauVienPhi] Parameters: [@param0=[NGUOICAPNHAT_ID,1], @param1=[NGAYCAPNHAT,8/14/2019 5:46:51 PM], @param2=[VIENPHI_ID,0]]
2019-08-14 17:46:51,516 [1] DEBUG - Statement Id: [DAO00048_UpdateDVYeuCauVienPhi] Types: [@param0=[Int64, System.Int64], @param1=[DateTime, System.DateTime], @param2=[Int64, System.Int64]]
2019-08-14 17:46:51,542 [1] DEBUG - Statement Id: [DAO00048_UpdateDVYeuCau] PreparedStatement : [update  TT_DVYEUCAU              set TRANGTHAI =  @param0 ,              NGUOICAPNHAT_ID =  @param1 ,              NGAYCAPNHAT =  @param2               where              DVYEUCAU_ID =  @param3]
2019-08-14 17:46:51,542 [1] DEBUG - Statement Id: [DAO00048_UpdateDVYeuCau] Parameters: [@param0=[TRANGTHAI,CHOXACNHAN], @param1=[NGUOICAPNHAT_ID,1], @param2=[NGAYCAPNHAT,8/14/2019 5:46:51 PM], @param3=[DVYEUCAU_ID,202112]]
2019-08-14 17:46:51,542 [1] DEBUG - Statement Id: [DAO00048_UpdateDVYeuCau] Types: [@param0=[String, System.String], @param1=[Int64, System.Int64], @param2=[DateTime, System.DateTime], @param3=[Int64, System.Int64]]
2019-08-14 17:46:51,569 [1] DEBUG - Statement Id: [DAO00048_TT_PHAUTHUAT_PPVOCAM_Add] PreparedStatement : [insert into TT_PHAUTHUAT_PPVOCAM (              PHAUTHUAT_ID,              PPVOCAM_ID,              BENHVIEN_ID)              values (               @param0 ,               @param1 ,               @param2 )]
2019-08-14 17:46:51,569 [1] DEBUG - Statement Id: [DAO00048_TT_PHAUTHUAT_PPVOCAM_Add] Parameters: [@param0=[PHAUTHUAT_ID,3745], @param1=[PPVOCAM_ID,1832], @param2=[BENHVIEN_ID,HLU01]]
2019-08-14 17:46:51,569 [1] DEBUG - Statement Id: [DAO00048_TT_PHAUTHUAT_PPVOCAM_Add] Types: [@param0=[Int64, System.Int64], @param1=[Int64, System.Int64], @param2=[String, System.String]]
2019-08-14 17:46:51,595 [1] DEBUG - Statement Id: [DAO00048_GetlistvtytBeforeDelete] PreparedStatement : [select * from TT_PHAUTHUAT_VTYT where PHAUTHUAT_ID = 3745]
2019-08-14 17:46:51,622 [1] DEBUG - Statement Id: [DAO00062_GetKhoThuocCosoKhongCoso] PreparedStatement : [select distinct kd.KHODUOC_ID, lst.DICTIONARY_CODE  LOAIKHO from TM_KHODUOC kd        left join TM_PHONGBAN_KHODUOC pbkd        on kd.KHODUOC_ID = pbkd.KHODUOC_ID        and kd.BENHVIEN_ID = pbkd.BENHVIEN_ID        left join LST_DICTIONARY lst on lst.DICTIONARY_ID = kd.LOAIKHO_ID        where lst.DICTIONARY_CODE = 'Coso']
2019-08-14 17:46:51,648 [1] DEBUG - Statement Id: [DAO00062_GetAllPhamviKhoDuoc] PreparedStatement : [select distinct dmap.*        from TM_DUOC_PHAMVISD_MAPPING dmap        left join TM_DUOC_PHAMVISUDUNG dpv on dpv.PHAMVI_ID = dmap.PHAMVI_ID]
2019-08-14 17:46:51,716 [1] DEBUG - Statement Id: [DAO00023_GetSOBHYT_HUONG_ID] PreparedStatement : [select isnull(MAX(SOBHYT_HUONG_ID),0) SOBHYT_HUONG_ID        from TT_TIEPNHAN_SOTHEBHYT        where TIEPNHAN_ID = '26730']
2019-08-14 17:46:53,444 [1] DEBUG - Statement Id: [DAO00304_DotDieuTriID] PreparedStatement : [select top 1 DOTDIEUTRI_ID        from TT_NOITRU_DOTDIEUTRI        where BENHAN_ID = 5737 and TRANGTHAI='0'        order by DOTDIEUTRI_ID DESC]
2019-08-14 17:46:53,562 [1] DEBUG - Statement Id: [DAO00048_Add_GhiNhanVTYT_Phauthuat] PreparedStatement : [declare @jsonVienPhi nvarchar(max);          set @jsonVienPhi = N'{          "DATA": [{"COSO":"1","UID":"366dc354-3269-4b0b-a87d-b0ce5a212ecc","PHAUTHUAT_VTYT_ID":0,"PHAUTHUAT_ID":3745,"STT":null,"CHUNGTU_ID":null,"CHUNGTUTONGHOP_ID":null,"KHOSUDUNG_ID":null,"KHODUOC_ID":null,"KHOTAO_ID":29,"KHOPHAT_ID":29,"PHAMVI_ID":1052,"NGAYSUDUNG":"2019-08-14T17:46:42.0309712+07:00","NGUONHANG_ID":1,"NGUONDUOC_ID":1,"TRANGTHAI_XEM":null,"NGUONGOCDULIEU":null,"NGUOITAO_ID":1,"NGAYTAO":"2019-08-14T17:46:42.0309712+07:00","BENHVIEN_ID":"HLU01","TENKHO":"TT Khoa Phẫu thuật - Gây mê hồi sức","DUOC_ID":5,"DUOC_KEY":"1052_5_1","MADUOC":"VT576","TENDUOCDAYDU":"(Bơm tiêm vô trùng sử dụng một lần Insulin 1cc VIKIMCO) ","DONVITINH":"Cái","DUOC_BHYT":false,"DONGIABAN":null,"SOLUONG":1.0,"BOOKED_SOLUONG":0.0,"BookedSoLuong":0.0,"THANHTIEN_DOANHTHU":1750.0,"THANHTIEN":1750.0,"DONGIA_DOANHTHU":1750.0,"BHYT_DONGIA":1750.0,"BHYT_THANHTIEN":1750.0,"NGUONDUOC":"Nguồn Mua","TINHTIEN":"1","BNTUCHITRA":"0","GHICHU":null,"TONKHO":null,"SOPHIEULINH":null,"SOPHIEUXUAT":null,"BHYTDONGTIEN":"0","KHONGTHUTIEN":"0","DOITUONG_HUONG_ID":6,"SOBHYT_HUONG_ID":27750,"LOAI_CHIPHI":"TT","TIEPNHAN_ID":26730,"BENHNHAN_ID":15236,"BENHAN_ID":5737,"REF_TABLE":"TT_PHAUTHUAT_VTYT","DICHVU_ID":null,"ACTIVE":"1"}]          }';            declare @PHAUTHUAT_VTYT_ID int;          declare @BENHAN_ID int;          declare @PHAUTHUAT_ID int;          declare @TIEPNHAN_ID int;          declare @BENHNHAN_ID int;          declare @NGUONDUOC_ID int;          declare @DUOC_ID int;          declare @SOLUONG numeric(18, 4);          declare @GHICHU nvarchar(100);          declare @COSO char(1);          declare @KHOTAO_ID int;          declare @KHOPHAT_ID int;          declare @PHAMVI_ID int;          declare @TINHTIEN char(1);          declare @NGUONHANG_ID int;          declare @DONGIA_DOANHTHU numeric(25, 4);          declare @THANHTIEN_DOANHTHU numeric(25, 4);          declare @BHYT_DONGIA numeric(25, 4);          declare @BHYT_THANHTIEN numeric(25, 4);          declare @DOITUONG_HUONG_ID numeric(25, 4);          declare @SOBHYT_HUONG_ID numeric(25, 4);          declare @BHYTDONGTIEN char(1);          declare @KHONGTHUTIEN char(1);          declare @NGUOITAO_ID int =  @param0 ;          declare @NGUOICAPNHAT_ID int =  @param1 ;          declare @BENHVIEN_ID varchar(10) =  @param2 ;          declare @DOTDIEUTRI_ID int;            declare @iTotal int =  @param3 ;          declare @icnt int = 0;          WHILE @iTotal > @icnt          BEGIN          declare @dyn_sql nvarchar(1000) = 'select @data = json_query(@json_dyn, ''' + CHAR(36) +'.DATA[' + cast(@icnt as varchar(10)) + ']'');'          declare @jsondatamax nvarchar(max);            exec sp_executesql @dyn_sql          , N'@json_dyn nvarchar(max), @data nvarchar(max) OUTPUT'          , @json_dyn = @jsonVienPhi          , @data = @jsondatamax OUTPUT            select          @BENHAN_ID =  JSON_VALUE(@jsondatamax, '' + CHAR(36) +'.BENHAN_ID'),          @PHAUTHUAT_ID =  JSON_VALUE(@jsondatamax, '' + CHAR(36) +'.PHAUTHUAT_ID'),          @TIEPNHAN_ID =  JSON_VALUE(@jsondatamax, '' + CHAR(36) +'.TIEPNHAN_ID'),          @BENHNHAN_ID =  JSON_VALUE(@jsondatamax, '' + CHAR(36) +'.BENHNHAN_ID'),          @NGUONDUOC_ID =  JSON_VALUE(@jsondatamax, '' + CHAR(36) +'.NGUONDUOC_ID'),          @DUOC_ID =  JSON_VALUE(@jsondatamax, '' + CHAR(36) +'.DUOC_ID'),          @GHICHU =  JSON_VALUE(@jsondatamax, '' + CHAR(36) +'.GHICHU'),          @SOLUONG =  JSON_VALUE(@jsondatamax, '' + CHAR(36) +'.SOLUONG'),          @COSO =  JSON_VALUE(@jsondatamax, '' + CHAR(36) +'.COSO'),          @KHOTAO_ID =  JSON_VALUE(@jsondatamax, '' + CHAR(36) +'.KHOTAO_ID'),          @KHOPHAT_ID =  JSON_VALUE(@jsondatamax, '' + CHAR(36) +'.KHOPHAT_ID'),          @TINHTIEN =  JSON_VALUE(@jsondatamax, '' + CHAR(36) +'.TINHTIEN'),          @BHYTDONGTIEN =  JSON_VALUE(@jsondatamax, '' + CHAR(36) +'.BHYTDONGTIEN'),          @KHONGTHUTIEN =  JSON_VALUE(@jsondatamax, '' + CHAR(36) +'.KHONGTHUTIEN'),          @NGUONHANG_ID =  JSON_VALUE(@jsondatamax, '' + CHAR(36) +'.NGUONHANG_ID'),            @NGUOITAO_ID =  JSON_VALUE(@jsondatamax, '' + CHAR(36) +'.NGUOITAO_ID'),          @NGUOICAPNHAT_ID =  JSON_VALUE(@jsondatamax, '' + CHAR(36) +'.NGUOICAPNHAT_ID'),          @PHAMVI_ID =  JSON_VALUE(@jsondatamax, '' + CHAR(36) +'.PHAMVI_ID'),          @DOITUONG_HUONG_ID =  JSON_VALUE(@jsondatamax, '' + CHAR(36) +'.DOITUONG_HUONG_ID'),          @SOBHYT_HUONG_ID =  JSON_VALUE(@jsondatamax, '' + CHAR(36) +'.SOBHYT_HUONG_ID'),            @DONGIA_DOANHTHU =  JSON_VALUE(@jsondatamax, '' + CHAR(36) +'.DONGIA_DOANHTHU'),          @THANHTIEN_DOANHTHU =  JSON_VALUE(@jsondatamax, '' + CHAR(36) +'.THANHTIEN_DOANHTHU'),          @BHYT_DONGIA =  JSON_VALUE(@jsondatamax, '' + CHAR(36) +'.BHYT_DONGIA'),          @BHYT_THANHTIEN =  JSON_VALUE(@jsondatamax, '' + CHAR(36) +'.BHYT_THANHTIEN'),          @DOTDIEUTRI_ID =  JSON_VALUE(@jsondatamax, '' + CHAR(36) +'.DOTDIEUTRI_ID')            INSERT INTO [TT_PHAUTHUAT_VTYT]          ([PHAUTHUAT_ID], [DUOC_ID], [SOLUONG] ,[KHOTAO_ID] ,[KHOSUDUNG_ID] ,[TINHTIEN],[BNTUCHITRA] ,[NGAYSUDUNG] ,[NGUONHANG_ID]          ,[COSO], [GHICHU] ,[NGUOITAO_ID] ,[NGAYTAO] ,[NGUOICAPNHAT_ID],[NGAYCAPNHAT],[BENHVIEN_ID] ,[PHAMVI_ID],[KHOPHAT_ID])          VALUES          (@PHAUTHUAT_ID,@DUOC_ID,@SOLUONG,@KHOTAO_ID,@KHOTAO_ID, @TINHTIEN, @BHYTDONGTIEN,GETDATE(),@NGUONHANG_ID          ,@COSO, @GHICHU, @NGUOITAO_ID, GETDATE(), @NGUOICAPNHAT_ID, GETDATE(), @BENHVIEN_ID, @PHAMVI_ID, @KHOPHAT_ID)                    set @PHAUTHUAT_VTYT_ID = SCOPE_IDENTITY()                      INSERT INTO TT_VIENPHI          ([TIEPNHAN_ID],[BENHAN_ID]          ,[BENHNHAN_ID],[KHAMBENH_ID],[REF_ID],[REF_TABLE],[DICHVU_ID],[DUOC_ID],[LOAI_CHIPHI]          ,[SOLUONG],[DONGIA_DOANHTHU],[THANHTIEN_DOANHTHU],[BHYT_DONGIA],[BHYT_THANHTIEN],[HUY],[DATHANHTOAN]          ,[DATHUCHIEN],[KHONGTHUTIEN],[BHYTDONGTIEN],[BENHVIEN_ID],[NGUOITAO_ID],[NGAYTAO],[NGUOICAPNHAT_ID],[NGAYCAPNHAT], [DOITUONG_HUONG_ID], [SOBHYT_HUONG_ID], [DOTDIEUTRI_ID])          VALUES          (@TIEPNHAN_ID,@BENHAN_ID          ,@BENHNHAN_ID,@PHAUTHUAT_ID,@PHAUTHUAT_VTYT_ID,'TT_PHAUTHUAT_VTYT',null,@DUOC_ID,'TT'          ,@SOLUONG,@DONGIA_DOANHTHU,@THANHTIEN_DOANHTHU,@BHYT_DONGIA,@BHYT_THANHTIEN,'0','0'          ,'0',@KHONGTHUTIEN,@BHYTDONGTIEN,@BENHVIEN_ID,@NGUOITAO_ID,GETDATE(),@NGUOICAPNHAT_ID,GETDATE(), @DOITUONG_HUONG_ID, @SOBHYT_HUONG_ID, @DOTDIEUTRI_ID)                      insert into TT_DUOC_TONKHO_BOOK_NGOAITRU          ([REF_TABLE],[REF_ID],[PHAMVI_ID],[KHODUOC_ID],[DUOC_ID],[SOLUONG],[NGUONHANG_ID]          ,[GHICHU],[BENHVIEN_ID],[NGAYTAO],[NGUOITAO_ID],[NGAYCAPNHAT],[NGUOICAPNHAT_ID], [TRANGTHAI])          VALUES          ('TT_PHAUTHUAT_VTYT',@PHAUTHUAT_VTYT_ID,@PHAMVI_ID,@KHOPHAT_ID,@DUOC_ID,@SOLUONG,@NGUONHANG_ID          ,@GHICHU,@BENHVIEN_ID,GETDATE(),@NGUOITAO_ID,GETDATE(),@NGUOICAPNHAT_ID, 'HIEULUC')            set @icnt = @icnt + 1;          END]
2019-08-14 17:46:53,562 [1] DEBUG - Statement Id: [DAO00048_Add_GhiNhanVTYT_Phauthuat] Parameters: [@param0=[NGUOITAO_ID,1], @param1=[NGUOICAPNHAT_ID,1], @param2=[BENHVIEN_ID,HLU01], @param3=[TOTAL_RECORD,1]]
2019-08-14 17:46:53,562 [1] DEBUG - Statement Id: [DAO00048_Add_GhiNhanVTYT_Phauthuat] Types: [@param0=[Int64, System.Int64], @param1=[Int64, System.Int64], @param2=[String, System.String], @param3=[Int32, System.Int32]]
2019-08-14 17:46:53,612 [1] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoVaBookingCOM23UpdateRedis] PreparedStatement : [select  distinct tk.DUOC_KEY, LTRIM(tk.PHAMVI_ID) as PHAMVI_ID, tk.NGUONDUOC_ID, nh.TENNGUONDUOC, nh.TINHTIEN, d.DUOC_ID, ld.MALOAIDUOC,        d.SOVISA,d.TYLE_VAT,d.COTOA, d.MADUOC, d.TENHANG, d.TENDUOCDAYDU, dvt.TENDONVITINH as DONVITINH, d.BHYT,        d.TENHOATCHAT, d.HAMLUONG, d.HANGSANXUAT, d.QUOCGIA, d.LOAIDUOC_ID, d.DUONGDUNG_ID, d.TINHTIEN_PTTT,        ten.TENDUOC, ten.TENDUOC_EN, ten.MAQUOCTE, ten.MAQUOCTEBT,        CASE WHEN d.BHYT = '1' THEN 'BHYT' ELSE '' END as BHYT_TEXT        , ld.LOAIVATTU_ID        , d.BENHVIEN_ID,        tk.SOLUONG, d.VTYT_PHANLOAI, d.PHAMVI, d.SUASOLUONGTONGHOP, d.MADUOCBV, d.DANGTRINHBAY        , TAMNGUNG = CASE WHEN d.TAMNGUNG = '1' OR nh.TAMNGUNG = '1' OR kd.TAMNGUNG = '1' THEN '1' ELSE '0' END        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        inner join        (        select  LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')) DUOC_KEY, (SUM(dtk.SOLUONG) - isnull(sum(A.SOLUONG),0) - isnull(sum(B.SOLUONG),0)) SOLUONG, pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        from (select sum(soluong) soluong,duoc_id,nguonduoc_id,khoduoc_id,benhvien_id from TT_DUOC_TONKHO  group by duoc_id,nguonduoc_id,khoduoc_id,benhvien_id) dtk        inner join TM_DUOC_PHAMVISD_MAPPING pvsd on dtk.KHODUOC_ID = pvsd.KHODUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NOITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) B on B.DUOC_ID = dtk.DUOC_ID and B.SOLUONG > 0 and B.PHAMVI_ID = pvsd.PHAMVI_ID and B.NGUONHANG_ID = dtk.NGUONDUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NGOAITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) A on A.DUOC_ID = dtk.DUOC_ID and A.SOLUONG > 0 and A.PHAMVI_ID = pvsd.PHAMVI_ID and A.NGUONHANG_ID = dtk.NGUONDUOC_ID        where dtk.SOLUONG > 0 and dtk.BENHVIEN_ID = 'HLU01'        group by LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')), pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        ) tk on tk.DUOC_ID = d.DUOC_ID        left join TM_DUOC_PHAMVISUDUNG kd on kd.PHAMVI_ID = tk.PHAMVI_ID and kd.BENHVIEN_ID = 'HLU01'        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = tk.NGUONDUOC_ID and nh.BENHVIEN_ID = 'HLU01'        where  d.BENHVIEN_ID = 'HLU01' and d.DUOC_ID in (5)]
2019-08-14 17:46:56,700 [1] DEBUG - Statement Id: [DAO00030_GetKhoDuoc] PreparedStatement : [SELECT *            FROM            TM_KHODUOC            WHERE            KHODUOC_ID= '29'            and BENHVIEN_ID= 'HLU01']
2019-08-14 17:46:56,729 [1] DEBUG - Statement Id: [DAO00030_GetMucDichChungTuID] PreparedStatement : [SELECT DICTIONARY_ID              FROM              LST_DICTIONARY              WHERE              DICTIONARY_TYPE_CODE = 'MucDichChungTu'              and DICTIONARY_CODE = 'X13']
2019-08-14 17:46:56,757 [1] DEBUG - Statement Id: [DAO00036_GetDetail] PreparedStatement : [select KEYTYPE, KEYYEAR, KEYMONTH, KEYDAY, SEGMENT_1, SEGMENT_2, SEGMENT_3, KEYVALUE              from LST_KEYDATA_DUOCPHAM as kd               WHERE                        kd.KEYTYPE = 'SOCHUNGTUNHAPXUATBENNGOAI'                   AND                       kd.KEYYEAR = '2019'                   AND                       kd.KEYMONTH = '0'                   AND                       kd.KEYDAY = '0'                   AND                       kd.SEGMENT_1 = 'CS_GMHS'                   AND                       kd.SEGMENT_2 = 'X13'                   AND                       kd.SEGMENT_3 = ' ']
2019-08-14 17:46:56,784 [1] DEBUG - Statement Id: [DAO00036_Update] PreparedStatement : [update LST_KEYDATA_DUOCPHAM set              KEYVALUE =  @param0               where              KEYTYPE = 'SOCHUNGTUNHAPXUATBENNGOAI'              AND KEYYEAR = '2019'              AND KEYMONTH = '0'              AND KEYDAY = '0'              AND SEGMENT_1 = 'CS_GMHS'              AND SEGMENT_2 = 'X13'              AND SEGMENT_3 = ' ']
2019-08-14 17:46:56,784 [1] DEBUG - Statement Id: [DAO00036_Update] Parameters: [@param0=[KEYVALUE,002656]]
2019-08-14 17:46:56,784 [1] DEBUG - Statement Id: [DAO00036_Update] Types: [@param0=[String, System.String]]
2019-08-14 17:46:58,934 [1] DEBUG - Statement Id: [DAO00030_GetGhiNhanPhauThuatVTYT] PreparedStatement : [SELECT            N'Người bệnh: ' + bn.MAYTE + ' - ' + bn.TENBENHNHAN + ' - ' +  CONVERT(VARCHAR(10), pt.NGAYTHUCHIEN, 103) + ' - ' + CONVERT(VARCHAR(5), pt.NGAYTHUCHIEN, 108) as BENHNHAN            ,vtyt.*             FROM TT_PHAUTHUAT_VTYT vtyt            INNER JOIN TT_PHAUTHUAT pt on pt.PHAUTHUAT_ID = vtyt.PHAUTHUAT_ID            INNER JOIN dbo.TT_TIEPNHAN tn on tn.TIEPNHAN_ID = pt.TIEPNHAN_ID            INNER JOIN TT_BENHNHAN bn on bn.BENHNHAN_ID = tn.BENHNHAN_ID                      WHERE            pt.PHAUTHUAT_ID= '3745'            and vtyt.COSO = '1'      and vtyt.CHUNGTU_ID is null]
2019-08-14 17:46:58,963 [1] DEBUG - Statement Id: [DAO00030_GET_SOLONHAP_XUATSUDUNG] PreparedStatement : [SELECT DISTINCT            SLN.SOLONHAP_ID, SLN.SOLONHAP, SLN.SOLOSANPHAM, SLN.SOKIEMSOAT, SLN.SOVISA, CONVERT(varchar(20), SLN.SOLOSANPHAM) + '/' + CONVERT(varchar(20), TK.SOLUONG) AS SOLOSOTON,            SLN.NGAYNHAP AS NGAYNHAPLO, SLN.HANDUNG AS HANSUDUNG,  SLN.HANDUNG, SLN.NGUONDUOC_ID, SLN.NGUONDUOC_ID as NGUONHANG_ID,            SLNGB.DONGIAMUA, SLNGB.DONGIAVON, SLNGB.TYLEVAT_DAUVAO as TYLEVAT, d.TYLE_VAT, SLNGB.DONGIAVONVAT, SLNGB.DONGIABANVAT_DAUVAO,            dg.DONGIA AS DONGIATHAU, dg.DONGIA AS DONGIABAN, dg.DONGIA AS DONGIABAN_VAT,                      TK.KHODUOC_ID,TK.DUOC_ID, TK.SOLUONG, TK.SOLUONG AS SOLUONGTON,            D.TENDUOCDAYDU,D.DONVITINH_ID, D.DONVITINH, D.BHYT, NH.TENNGUONDUOC AS NGUONHANG,            LTRIM(TK.KHODUOC_ID) + '_' + LTRIM(TK.DUOC_ID) + '_' + LTRIM(TK.NGUONDUOC_ID) as DUOC_KEY            FROM            TT_DUOC_CHUNGTU_SOLONHAP SLN            INNER JOIN TT_DUOC_TONKHO TK on SLN.SOLONHAP_ID = TK.SOLONHAP_ID            INNER JOIN TT_DUOC_SOLONHAP_GIABAN SLNGB on SLN.SOLONHAP_ID = SLNGB.SOLONHAP_ID            INNER JOIN TM_NGUONHANG NH on SLN.NGUONDUOC_ID = NH.NGUONDUOC_ID            INNER JOIN TM_DUOC D on SLN.DUOC_ID = D.DUOC_ID            LEFT JOIN TM_DUOC_DONGIA dg on dg.DUOC_ID = SLN.DUOC_ID            LEFT JOIN TM_LOAIGIA lg on (lg.LOAIGIA_ID = dg.LOAIGIA_ID AND lg.MALOAIGIA = 'GiaduocBHYT')            WHERE            TK.DUOC_ID = '5'            AND TK.KHODUOC_ID = '29'            AND TK.BENHVIEN_ID = 'HLU01'            AND TK.SOLUONG > 0                 and                     SLN.NGUONDUOC_ID = '1'                                      ORDER BY NGAYNHAP]
2019-08-14 17:46:59,234 [1] DEBUG - Statement Id: [DAO00030_ThemChungTuXSD] PreparedStatement : [declare @jsonChiTiet nvarchar(max);          set @jsonChiTiet =  @param0 ;          declare @type nvarchar(max);          set @type =  @param1 ;            declare @chungtu_id int;                    BEGIN                      insert into TT_DUOC_CHUNGTU (          MACHUNGTU,SOCHUNGTU,NGAYCHUNGTU,LOAICHUNGTU,MUCDICHCHUNGTU_ID,MUCDICHCHUNGTU_CODE,KHOXUAT_ID,NGUOIGIAO_ID,NGUOIGIAO,KHONHAP_ID,NGUOINHAN_ID,NGUOINHAN,NGUOIKIEMTRA_ID,NGUOIKIEMTRA,NGUOIDUYET_ID,NGUOIDUYET,PHUONGPHAPXUAT,KETOANTRUONG_ID,KETOANTRUONG,THUKHO_ID,THUKHO,MAUHOADON,SOHOADON,SOSERI,NGAYHOADON,DIENGIAI,GIATRI,GIATRITHANHTOAN,TYLEVAT,GIATRIVAT,THUESUAT,GIATRITHUE,TYLECHIETKHAU,GIATRICHIETKHAU,TIENTE_ID,TYGIA,SOCHUNGTUGOC,NGAYCHUNGTUGOC,NHACUNGCAP_ID,HINHTHUCTHANHTOAN_ID,NGUONDUOC_ID,CHUNGTULIENQUAN_ID,KHAMBENH_ID,TOATHUOCNOITRU_ID,TIEPNHAN_ID,BENHAN_ID,DANHANTHUOC,NGUOINHAP_ID,NGAYNHAP,TRANGTHAI,LOAITOATHUOC,PHIEULINH_ID,DIENGIAINGHIEPVUPHATSINH,DONVIGIAO_ID,KHOSUDUNG_ID,LOAIVATTU_ID,BENHNHAN_ID,NGOAITRU_TOATHUOC_NGUOIMUA_ID,TENBENHNHAN,BACSIGIOITHIEU_ID,DOITUONG_ID,IDCHUYEN,CHUNGTUKETOAN,STATUS,TRANSFER_VIENPHI_ID,PHONGBAN_ID,BACSI_ID,TKNO,TKCO,MACHUNGTUREF,LOAICHUNGTUREF,PHIEULINHCANTRU_ID,KHOTHUCHIEN_ID,KHODOIUNG_ID,MENU_LOAIDUOC_ID,NGUOISUDUNGMAY_ID,GOITHAU_ID,XUATTHUOCBANGOAITRU,NGAYGIOCHUNGTU,NOIDAKHAM,HOIDONGKIEMNHAP_ID,HOIDONGTHANHLY_ID,CHUYENCHUNGTUID,CHUYENDOANHTHUID,LYDOXUATSUDUNG_ID,BENHVIEN_ID,NGAYTAO,NGUOITAO_ID,NGAYCAPNHAT,NGUOICAPNHAT_ID)          values ( @param2 , @param3 , @param4 ,'X', @param5 , @param6 , @param7 , @param8 , @param9 , @param10 , @param11 , @param12 , @param13 , @param14 , @param15 , @param16 , @param17 , @param18 , @param19 , @param20 , @param21 , @param22 , @param23 , @param24 , @param25 , @param26 , @param27 , @param28 , @param29 , @param30 , @param31 , @param32 , @param33 , @param34 , @param35 , @param36 , @param37 , @param38 , @param39 , @param40 , @param41 , @param42 , @param43 , @param44 , @param45 , @param46 , @param47 , @param48 , @param49 ,'DXK', @param50 , @param51 , @param52 , @param53 , @param54 , @param55 , @param56 , @param57 , @param58 , @param59 , @param60 , @param61 , @param62 , @param63 , @param64 , @param65 , @param66 , @param67 , @param68 , @param69 , @param70 , @param71 , @param72 , @param73 , @param74 , @param75 , @param76 , @param77 , @param78 , @param79 , @param80 , @param81 , @param82 , @param83 , @param84 , @param85 , @param4 , @param86 , @param87 , @param88 )          set @chungtu_id = SCOPE_IDENTITY()                      INSERT INTO TT_DUOC_CHUNGTU_CHITIET          (CHUNGTU_ID,DUOC_ID,SOLONHAP_ID,SOKIEMSOAT,SOVISA,HANDUNG,DONVITINH_ID          ,SOLUONGYEUCAU,SOLUONGDAXUAT,THANHTIENVON          ,DONGIABAN,DONGIAVON,TRANGTHAI,NGUONHANG_ID          ,TOATHUOCNOITRU_ID,KHAMBENH_VTYT_ID          ,PHAUTHUAT_VTYT_ID,CLSKETQUA_VTYT_ID,TOATHUOCNGOAITRU_ID          ,MASTER_ID,BENHNHAN,BENHVIEN_ID,NGAYTAO,NGUOITAO_ID)            SELECT @chungtu_id, json.DUOC_ID, json.SOLONHAP_ID, json.SOKIEMSOAT, json.SOVISA, json.HANDUNG, json.DONVITINH_ID          ,json.SOLUONGYEUCAU, json.SOLUONGDAXUAT, json.THANHTIENVON          ,json.DONGIABAN, json.DONGIAVON, json.TRANGTHAI, json.NGUONHANG_ID          ,json.TOATHUOCNOITRU_ID, json.KHAMBENH_VTYT_ID          ,json.PHAUTHUAT_VTYT_ID, json.CLSKETQUA_VTYT_ID, json.TOATHUOCNGOAITRU_ID          ,json.MASTER_ID, json.BENHNHAN,  @param85 , json.NGAYTAO, json.NGUOITAO_ID          FROM OPENJSON(@jsonChiTiet)          WITH (          DUOC_ID int,SOLONHAP_ID int,SOKIEMSOAT varchar(20),SOVISA varchar(20),HANDUNG datetime,DONVITINH_ID int,          SOLUONGYEUCAU numeric(25, 4),SOLUONGDAXUAT numeric(25, 4),THANHTIENVON numeric(25, 4),          DONGIABAN numeric(25, 4),DONGIAVON numeric(25, 4),TRANGTHAI varchar(10),NGUONHANG_ID int,          TOATHUOCNOITRU_ID int,KHAMBENH_VTYT_ID int,          PHAUTHUAT_VTYT_ID int,CLSKETQUA_VTYT_ID int,TOATHUOCNGOAITRU_ID int,          MASTER_ID int,BENHNHAN nvarchar(1000), BENHVIEN_ID varchar(10),NGAYTAO datetime,NGUOITAO_ID int          ) json                      if(@type = 'TT_NOITRU_TOATHUOC')          BEGIN                    UPDATE TT_NOITRU_TOATHUOC SET CHUNGTU_ID = @chungtu_id, TRANGTHAI = 'DAXUAT', NGAYCAPNHAT = getdate()          FROM OPENJSON(@jsonChiTiet)          WITH (MASTER_ID int, TOATHUOCNOITRU_ID int) json          WHERE TT_NOITRU_TOATHUOC.TOATHUOC_ID = json.TOATHUOCNOITRU_ID and json.TOATHUOCNOITRU_ID is not NULL and json.MASTER_ID = TT_NOITRU_TOATHUOC.KHAMBENH_ID                      UPDATE TT_DUOC_TONKHO_BOOK_NOITRU SET SOLUONG = 0          FROM OPENJSON(@jsonChiTiet)          WITH (TOATHUOCNOITRU_ID int) json          WHERE TT_DUOC_TONKHO_BOOK_NOITRU.REF_ID = json.TOATHUOCNOITRU_ID and json.TOATHUOCNOITRU_ID is not NULL and TT_DUOC_TONKHO_BOOK_NOITRU.REF_TABLE = 'TT_NOITRU_TOATHUOC'          END                            if(@type = 'TT_PHAUTHUAT_VTYT')          BEGIN          UPDATE TT_PHAUTHUAT_VTYT SET CHUNGTU_ID = @chungtu_id          FROM OPENJSON(@jsonChiTiet)          WITH (PHAUTHUAT_VTYT_ID int) json          WHERE TT_PHAUTHUAT_VTYT.PHAUTHUAT_VTYT_ID = json.PHAUTHUAT_VTYT_ID and json.PHAUTHUAT_VTYT_ID is not NULL                              UPDATE TT_VIENPHI set DUYET = '1', DATHUCHIEN = '1', NGAYCAPNHAT = getdate()          FROM OPENJSON(@jsonChiTiet)          WITH (PHAUTHUAT_VTYT_ID int) json          WHERE TT_VIENPHI.REF_TABLE = 'TT_PHAUTHUAT_VTYT' and TT_VIENPHI.REF_ID = json.PHAUTHUAT_VTYT_ID and json.PHAUTHUAT_VTYT_ID is not NULL                      UPDATE TT_DUOC_TONKHO_BOOK_NGOAITRU SET SOLUONG = 0          FROM OPENJSON(@jsonChiTiet)          WITH (PHAUTHUAT_VTYT_ID int) json          WHERE TT_DUOC_TONKHO_BOOK_NGOAITRU.REF_ID = json.PHAUTHUAT_VTYT_ID and json.PHAUTHUAT_VTYT_ID is not NULL          and TT_DUOC_TONKHO_BOOK_NGOAITRU.REF_TABLE = 'TT_PHAUTHUAT_VTYT'          END                    if(@type = 'TT_CLSKETQUA_VTYT')          BEGIN                    UPDATE TT_CLSKETQUA_VTYT SET CHUNGTU_ID = @chungtu_id, TRANGTHAI = 'DAXUAT', NGAYCAPNHAT = getdate()          FROM OPENJSON(@jsonChiTiet)          WITH (CLSKETQUA_VTYT_ID int) json          WHERE TT_CLSKETQUA_VTYT.CLSKETQUA_VTYT_ID = json.CLSKETQUA_VTYT_ID and json.CLSKETQUA_VTYT_ID is not NULL            UPDATE TT_VIENPHI set DUYET = '1', DATHUCHIEN = '1', NGAYCAPNHAT = getdate()          FROM OPENJSON(@jsonChiTiet)          WITH (CLSKETQUA_VTYT_ID int) json          WHERE TT_VIENPHI.REF_TABLE = 'TT_CLSKETQUA_VTYT' and TT_VIENPHI.REF_ID = json.CLSKETQUA_VTYT_ID and json.CLSKETQUA_VTYT_ID is not NULL                       UPDATE TT_DUOC_TONKHO_BOOK_NGOAITRU SET SOLUONG = 0          FROM OPENJSON(@jsonChiTiet)          WITH (CLSKETQUA_VTYT_ID int) json          WHERE TT_DUOC_TONKHO_BOOK_NGOAITRU.REF_ID = json.CLSKETQUA_VTYT_ID and json.CLSKETQUA_VTYT_ID is not NULL          and TT_DUOC_TONKHO_BOOK_NGOAITRU.REF_TABLE = 'TT_CLSKETQUA_VTYT'          END                              select @chungtu_id            END]
2019-08-14 17:46:59,234 [1] DEBUG - Statement Id: [DAO00030_ThemChungTuXSD] Parameters: [@param0=[JSON_DATA,[{"SOLONHAP_ID":7542,"SOLONHAP":"190500625","SOLOSANPHAM":"a","SOKIEMSOAT":null,"SOVISA":"","SOLOSOTON":"a/20.0000","NGAYNHAPLO":"2019-05-06T10:24:00","HANSUDUNG":"2026-12-12T00:00:00","HANDUNG":"2026-12-12T00:00:00","NGUONDUOC_ID":1,"NGUONHANG_ID":1,"DONGIAMUA":600.0000,"DONGIAVON":600.0000,"TYLEVAT":0.0000,"TYLE_VAT":0.00,"DONGIAVONVAT":600.0000,"DONGIABANVAT_DAUVAO":600.0000,"DONGIATHAU":1750.00,"DONGIABAN":1750.00,"DONGIABAN_VAT":1750.00,"KHODUOC_ID":29,"DUOC_ID":5,"SOLUONG":20.0000,"SOLUONGTON":20.0000,"TENDUOCDAYDU":"(Bơm tiêm vô trùng sử dụng một lần Insulin 1cc VIKIMCO) ","DONVITINH_ID":17,"DONVITINH":"Cái","BHYT":"1","NGUONHANG":"Nguồn Mua","DUOC_KEY":"29_5_1","CHUNGTUCHITIET_ID":0,"CHUNGTU_ID":null,"SOLUONGTHUCTE":null,"TOATHUOC":"PHAUTHUATVTYT","PHAUTHUAT_VTYT_ID":1241,"REF_TABLE":"TT_PHAUTHUAT_VTYT","REF_ID":1241,"BENHNHAN":"Người bệnh: 190035158 - Lê Thị Lan - 14/08/2019 - 17:47","SOLUONGYEUCAU":1.0000,"KHAMBENH_VTYT_ID":null,"TOATHUOCNOITRU_ID":null,"CLSKETQUA_VTYT_ID":null,"SOLUONGDAXUAT":1.0000,"THANHTIENVON":600.00000000}]], @param1=[REF_TABLE,TT_PHAUTHUAT_VTYT], @param2=[MACHUNGTU,CS_GMHSX1319002656], @param3=[SOCHUNGTU,002656], @param4=[NGAYCHUNGTU,8/14/2019 5:46:51 PM], @param5=[MUCDICHCHUNGTU_ID,1060], @param6=[MUCDICHCHUNGTU_CODE,X13], @param7=[KHOXUAT_ID,29], @param8=[NGUOIGIAO_ID,0], @param9=[NGUOIGIAO,null], @param10=[KHONHAP_ID,null], @param11=[NGUOINHAN_ID,null], @param12=[NGUOINHAN,null], @param13=[NGUOIKIEMTRA_ID,null], @param14=[NGUOIKIEMTRA,null], @param15=[NGUOIDUYET_ID,null], @param16=[NGUOIDUYET,null], @param17=[PHUONGPHAPXUAT,0], @param18=[KETOANTRUONG_ID,null], @param19=[KETOANTRUONG,null], @param20=[THUKHO_ID,null], @param21=[THUKHO,null], @param22=[MAUHOADON,null], @param23=[SOHOADON,null], @param24=[SOSERI,null], @param25=[NGAYHOADON,null], @param26=[DIENGIAI,null], @param27=[GIATRI,null], @param28=[GIATRITHANHTOAN,null], @param29=[TYLEVAT,5], @param30=[GIATRIVAT,0], @param31=[THUESUAT,null], @param32=[GIATRITHUE,null], @param33=[TYLECHIETKHAU,null], @param34=[GIATRICHIETKHAU,null], @param35=[TIENTE_ID,null], @param36=[TYGIA,null], @param37=[SOCHUNGTUGOC,null], @param38=[NGAYCHUNGTUGOC,null], @param39=[NHACUNGCAP_ID,null], @param40=[HINHTHUCTHANHTOAN_ID,null], @param41=[NGUONDUOC_ID,null], @param42=[CHUNGTULIENQUAN_ID,null], @param43=[KHAMBENH_ID,null], @param44=[TOATHUOCNOITRU_ID,1], @param45=[TIEPNHAN_ID,null], @param46=[BENHAN_ID,null], @param47=[DANHANTHUOC,], @param48=[NGUOINHAP_ID,null], @param49=[NGAYNHAP,null], @param50=[LOAITOATHUOC,null], @param51=[PHIEULINH_ID,null], @param52=[DIENGIAINGHIEPVUPHATSINH,null], @param53=[DONVIGIAO_ID,null], @param54=[KHOSUDUNG_ID,null], @param55=[LOAIVATTU_ID,null], @param56=[BENHNHAN_ID,null], @param57=[NGOAITRU_TOATHUOC_NGUOIMUA_ID,null], @param58=[TENBENHNHAN,null], @param59=[BACSIGIOITHIEU_ID,null], @param60=[DOITUONG_ID,null], @param61=[IDCHUYEN,null], @param62=[CHUNGTUKETOAN,null], @param63=[STATUS,null], @param64=[TRANSFER_VIENPHI_ID,null], @param65=[PHONGBAN_ID,25], @param66=[BACSI_ID,null], @param67=[TKNO,null], @param68=[TKCO,null], @param69=[MACHUNGTUREF,null], @param70=[LOAICHUNGTUREF,null], @param71=[PHIEULINHCANTRU_ID,null], @param72=[KHOTHUCHIEN_ID,null], @param73=[KHODOIUNG_ID,null], @param74=[MENU_LOAIDUOC_ID,null], @param75=[NGUOISUDUNGMAY_ID,null], @param76=[GOITHAU_ID,null], @param77=[XUATTHUOCBANGOAITRU,null], @param78=[NGAYGIOCHUNGTU,null], @param79=[NOIDAKHAM,null], @param80=[HOIDONGKIEMNHAP_ID,null], @param81=[HOIDONGTHANHLY_ID,null], @param82=[CHUYENCHUNGTUID,null], @param83=[CHUYENDOANHTHUID,null], @param84=[LYDOXUATSUDUNG_ID,8294], @param85=[BENHVIEN_ID,HLU01], @param86=[NGUOITAO_ID,0], @param87=[NGAYCAPNHAT,8/14/2019 5:46:59 PM], @param88=[NGUOICAPNHAT_ID,0]]
2019-08-14 17:46:59,234 [1] DEBUG - Statement Id: [DAO00030_ThemChungTuXSD] Types: [@param0=[String, System.String], @param1=[String, System.String], @param2=[String, System.String], @param3=[String, System.String], @param4=[DateTime, System.DateTime], @param5=[Int32, System.Int32], @param6=[String, System.String], @param7=[Int32, System.Int32], @param8=[Int32, System.Int32], @param9=[System.DBNull, null], @param10=[System.DBNull, null], @param11=[System.DBNull, null], @param12=[System.DBNull, null], @param13=[System.DBNull, null], @param14=[System.DBNull, null], @param15=[System.DBNull, null], @param16=[System.DBNull, null], @param17=[Int32, System.Int32], @param18=[System.DBNull, null], @param19=[System.DBNull, null], @param20=[System.DBNull, null], @param21=[System.DBNull, null], @param22=[System.DBNull, null], @param23=[System.DBNull, null], @param24=[System.DBNull, null], @param25=[System.DBNull, null], @param26=[System.DBNull, null], @param27=[System.DBNull, null], @param28=[System.DBNull, null], @param29=[Decimal, System.Decimal], @param30=[Decimal, System.Decimal], @param31=[System.DBNull, null], @param32=[System.DBNull, null], @param33=[System.DBNull, null], @param34=[System.DBNull, null], @param35=[System.DBNull, null], @param36=[System.DBNull, null], @param37=[System.DBNull, null], @param38=[System.DBNull, null], @param39=[System.DBNull, null], @param40=[System.DBNull, null], @param41=[System.DBNull, null], @param42=[System.DBNull, null], @param43=[System.DBNull, null], @param44=[Int32, System.Int32], @param45=[System.DBNull, null], @param46=[System.DBNull, null], @param47=[String, System.String], @param48=[System.DBNull, null], @param49=[System.DBNull, null], @param50=[System.DBNull, null], @param51=[System.DBNull, null], @param52=[System.DBNull, null], @param53=[System.DBNull, null], @param54=[System.DBNull, null], @param55=[System.DBNull, null], @param56=[System.DBNull, null], @param57=[System.DBNull, null], @param58=[System.DBNull, null], @param59=[System.DBNull, null], @param60=[System.DBNull, null], @param61=[System.DBNull, null], @param62=[System.DBNull, null], @param63=[System.DBNull, null], @param64=[System.DBNull, null], @param65=[Int32, System.Int32], @param66=[System.DBNull, null], @param67=[System.DBNull, null], @param68=[System.DBNull, null], @param69=[System.DBNull, null], @param70=[System.DBNull, null], @param71=[System.DBNull, null], @param72=[System.DBNull, null], @param73=[System.DBNull, null], @param74=[System.DBNull, null], @param75=[System.DBNull, null], @param76=[System.DBNull, null], @param77=[System.DBNull, null], @param78=[System.DBNull, null], @param79=[System.DBNull, null], @param80=[System.DBNull, null], @param81=[System.DBNull, null], @param82=[System.DBNull, null], @param83=[System.DBNull, null], @param84=[Int32, System.Int32], @param85=[String, System.String], @param86=[Int32, System.Int32], @param87=[DateTime, System.DateTime], @param88=[Int32, System.Int32]]
2019-08-14 17:46:59,662 [1] DEBUG - Statement Id: [DAO00030_MergSoLuongTonKho] PreparedStatement : [BEGIN          BEGIN TRY          BEGIN TRANSACTION            UPDATE TT_DUOC_TONKHO SET SOLUONG=0,DONGIAMUA=null WHERE KHODUOC_ID IN(29);          MERGE TT_DUOC_TONKHO AS X USING          (          select aa.SoLoNhap_ID,aa.KHODUOC_ID,aa.DUOC_ID,  aa.NGUONDUOC_ID,aa.BENHVIEN_ID, (case when sum(aa.soluong) < 0 then 0 else sum(aa.soluong) end) as SOLUONG from (          Select (case when CTU.LoaiChungTu = 'N' then CTU.KhoNhap_ID else ctu.KhoXuat_ID end) as KHODUOC_ID, CT.SOLONHAP_ID,          (case when CTU.LoaiChungTu = 'N' then SoLuongThucTe*ISNULL(CT.TYLEQUIDOI,1) else - SOLUONGDAXUAT end) as SOLUONG,CT.DUOC_ID,          Lo.NGUONDUOC_ID,CTU.BENHVIEN_ID          from TT_DUOC_CHUNGTU_CHITIET CT          join TT_DUOC_CHUNGTU CTU on CT.ChungTu_ID = CTU.ChungTu_ID AND CT.BENHVIEN_ID=CTU.BENHVIEN_ID          join TT_DUOC_CHUNGTU_SOLONHAP Lo on Lo.SoLoNhap_ID = CT.SoLoNhap_ID          join TM_DUOC duoc on CT.DUOC_ID = duoc.DUOC_ID          where ((CTU.TRANGTHAI not in ('PNCXN','CXN','HUY','PNCNK')) or CTU.TRANGTHAI is null) AND CTU.BENHVIEN_ID='HLU01'          ) aa where aa.KHODUOC_ID IN(29)          Group by AA.SoLoNhap_ID,AA.KHODUOC_ID,AA.DUOC_ID,  AA.NGUONDUOC_ID,AA.BENHVIEN_ID          ) AS Y          ON (X.KHODUOC_ID =Y.KHODUOC_ID AND X.SOLONHAP_ID=Y.SOLONHAP_ID AND X.DUOC_ID=Y.DUOC_ID AND X.NGUONDUOC_ID=Y.NGUONDUOC_ID AND X.BENHVIEN_ID=Y.BENHVIEN_ID)          WHEN MATCHED THEN UPDATE SET X.SOLUONG=Y.SOLUONG          WHEN NOT MATCHED THEN          INSERT (KHODUOC_ID,DUOC_ID,SOLONHAP_ID,SOLUONG,NGUONDUOC_ID,BENHVIEN_ID,NGAYTAO,NGUOITAO_ID,NGAYCAPNHAT,NGUOICAPNHAT_ID) VALUES          (Y.KHODUOC_ID,Y.DUOC_ID,Y.SOLONHAP_ID,Y.SOLUONG,Y.NGUONDUOC_ID,Y.BENHVIEN_ID,GETDATE(),NULL,GETDATE(),NULL);            COMMIT TRANSACTION          END TRY          BEGIN CATCH          IF @@TRANCOUNT > 0          ROLLBACK TRANSACTION          END CATCH          END]
2019-08-14 17:47:00,551 [1] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoCOM18] PreparedStatement : [select  distinct TT_TONKHO.DUOC_KEY, LTRIM(TT_TONKHO.KHODUOC_ID) as KHODUOC_ID, TM_DUOC.DUOC_ID, TM_LOAIDUOC.MALOAIDUOC,TM_DUOC.SOVISA,TM_DUOC.TYLE_VAT,TM_DUOC.COTOA,        TM_DUOC.MADUOC, TM_DUOC.TENHANG, TM_DUOC.TENDUOCDAYDU, dvt.TENDONVITINH as DONVITINH, TM_DUOC.DONVITINH_ID, TM_DUOC.BHYT,        TM_DUOC.TENHOATCHAT, TM_DUOC.HAMLUONG, TM_DUOC.HANGSANXUAT, TM_DUOC.QUOCGIA, TM_DUOC.LOAIDUOC_ID, TM_DUOC.DUONGDUNG_ID,        TM_TENDUOC.TENDUOC, TM_TENDUOC.TENDUOC_EN, TM_TENDUOC.MAQUOCTE, TM_TENDUOC.MAQUOCTEBT,        TM_LOAIDUOC.LOAIVATTU_ID, TM_DUOC.BENHVIEN_ID,        TT_TONKHO.SOLUONG, TM_DUOC.VTYT_PHANLOAI, TM_DUOC.PHAMVI, TT_TONKHO.NGUONDUOC_ID, NG.TENNGUONDUOC        , TAMNGUNG = CASE WHEN TM_DUOC.TAMNGUNG = '1' OR NG.TAMNGUNG = '1' OR KD.TAMNGUNG = '1' THEN '1' ELSE '0' END        , TM_DUOC.DANGTRINHBAY        from TM_DUOC        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = TM_DUOC.DONVITINH_ID        left join TM_TENDUOC on TM_DUOC.TENDUOC_ID = TM_TENDUOC.TENDUOC_ID and TM_DUOC.BENHVIEN_ID = 'HLU01'  and TM_DUOC.TAMNGUNG = '0'        left join TM_LOAIDUOC on TM_LOAIDUOC.LOAIDUOC_ID = TM_DUOC.LOAIDUOC_ID and TM_LOAIDUOC.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG on (TM_LOAIDUOC.LOAIVATTU_ID = TM_DUOC_HANDUNG.LOAIDUOC and TM_DUOC_HANDUNG.BENHVIEN_ID = 'HLU01')        inner join        (select LTRIM(A.KHODUOC_ID) + '_' + LTRIM(A.DUOC_ID) + '_' + LTRIM(ISNULL(A.NGUONDUOC_ID,'')) as DUOC_KEY, A.KHODUOC_ID, A.DUOC_ID ,a.NGUONDUOC_ID,        SUM(isnull(A.SOLUONG,0)) as SOLUONG        from        (select SUM(SOLUONG) as SOLUONG, KHODUOC_ID, DUOC_ID, NGUONDUOC_ID from TT_DUOC_TONKHO        where KHODUOC_ID in (29) and DUOC_ID in (5) group by KHODUOC_ID, DUOC_ID, NGUONDUOC_ID        ) A        where A.KHODUOC_ID in (29) and A.DUOC_ID in (5)        group by LTRIM(A.KHODUOC_ID) + '_' + LTRIM(A.DUOC_ID) + '_' + LTRIM(A.NGUONDUOC_ID), A.KHODUOC_ID, A.DUOC_ID, A.NGUONDUOC_ID)        TT_TONKHO on TT_TONKHO.DUOC_ID = TM_DUOC.DUOC_ID        LEFT JOIN TM_NGUONHANG NG ON NG.NGUONDUOC_ID = TT_TONKHO.NGUONDUOC_ID        LEFT JOIN TM_KHODUOC KD ON KD.KHODUOC_ID = TT_TONKHO.KHODUOC_ID        where TM_DUOC.BENHVIEN_ID = 'HLU01' and TM_DUOC.DUOC_ID in (5)]
2019-08-14 17:47:00,607 [1] DEBUG - Statement Id: [DAO00030_GetListPhamViByKhoDuoc] PreparedStatement : [SELECT DISTINCT PHAMVI_ID          FROM TM_DUOC_PHAMVISD_MAPPING          WHERE          KHODUOC_ID IN (29)          AND BENHVIEN_ID ='HLU01'          AND TAMNGUNG = '0']
2019-08-14 17:47:00,633 [1] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoVaBookingCOM23] PreparedStatement : [select  distinct tk.DUOC_KEY, LTRIM(tk.PHAMVI_ID) as PHAMVI_ID, tk.NGUONDUOC_ID, nh.TENNGUONDUOC, nh.TINHTIEN, d.DUOC_ID, ld.MALOAIDUOC,        d.SOVISA,d.TYLE_VAT,d.COTOA, d.MADUOC, d.TENHANG, d.TENDUOCDAYDU, dvt.TENDONVITINH as DONVITINH, d.BHYT,        d.TENHOATCHAT, d.HAMLUONG, d.HANGSANXUAT, d.QUOCGIA, d.LOAIDUOC_ID, d.DUONGDUNG_ID, d.TINHTIEN_PTTT,        ten.TENDUOC, ten.TENDUOC_EN, ten.MAQUOCTE, ten.MAQUOCTEBT,        CASE WHEN d.BHYT = '1' THEN 'BHYT' ELSE '' END as BHYT_TEXT        , ld.LOAIVATTU_ID        , d.BENHVIEN_ID,        tk.SOLUONG, d.VTYT_PHANLOAI, d.PHAMVI, d.SUASOLUONGTONGHOP, d.MADUOCBV, d.DANGTRINHBAY        , TAMNGUNG = CASE WHEN d.TAMNGUNG = '1' OR nh.TAMNGUNG = '1' OR kd.TAMNGUNG = '1' THEN '1' ELSE '0' END        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        inner join        (        select  LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')) DUOC_KEY, (SUM(dtk.SOLUONG) - isnull(sum(A.SOLUONG),0) - isnull(sum(B.SOLUONG),0)) SOLUONG, pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        from (select sum(soluong) soluong,duoc_id,nguonduoc_id,khoduoc_id,benhvien_id from TT_DUOC_TONKHO  group by duoc_id,nguonduoc_id,khoduoc_id,benhvien_id) dtk        inner join TM_DUOC_PHAMVISD_MAPPING pvsd on dtk.KHODUOC_ID = pvsd.KHODUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NOITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) B on B.DUOC_ID = dtk.DUOC_ID and B.SOLUONG > 0 and B.PHAMVI_ID = pvsd.PHAMVI_ID and B.NGUONHANG_ID = dtk.NGUONDUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NGOAITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) A on A.DUOC_ID = dtk.DUOC_ID and A.SOLUONG > 0 and A.PHAMVI_ID = pvsd.PHAMVI_ID and A.NGUONHANG_ID = dtk.NGUONDUOC_ID        where dtk.SOLUONG > 0 and dtk.BENHVIEN_ID = 'HLU01'        group by LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')), pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        ) tk on tk.DUOC_ID = d.DUOC_ID        left join TM_DUOC_PHAMVISUDUNG kd on kd.PHAMVI_ID = tk.PHAMVI_ID and kd.BENHVIEN_ID = 'HLU01'        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = tk.NGUONDUOC_ID and nh.BENHVIEN_ID = 'HLU01'        where  d.BENHVIEN_ID = 'HLU01' and d.DUOC_ID in (5) and TK.PHAMVI_ID in (1052)        and tk.NGUONDUOC_ID in (1)]
2019-08-14 17:47:00,889 [1] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoCOM18UpdateRedis] PreparedStatement : [select distinct TT_TONKHO.DUOC_KEY, LTRIM(TT_TONKHO.KHODUOC_ID) as KHODUOC_ID, TM_DUOC.DUOC_ID, TM_LOAIDUOC.MALOAIDUOC,TM_DUOC.SOVISA,TM_DUOC.TYLE_VAT,TM_DUOC.COTOA,        TM_DUOC.MADUOC, TM_DUOC.TENHANG, TM_DUOC.TENDUOCDAYDU, dvt.TENDONVITINH as DONVITINH,  TM_DUOC.DONVITINH_ID,TM_DUOC.BHYT,        TM_DUOC.TENHOATCHAT,        TM_DUOC.HAMLUONG, TM_DUOC.HANGSANXUAT, TM_DUOC.QUOCGIA, TM_DUOC.LOAIDUOC_ID, TM_DUOC.DUONGDUNG_ID,        TM_TENDUOC.TENDUOC, TM_TENDUOC.TENDUOC_EN, TM_TENDUOC.MAQUOCTE, TM_TENDUOC.MAQUOCTEBT,        TM_LOAIDUOC.LOAIVATTU_ID, TM_DUOC.BENHVIEN_ID,        TT_TONKHO.SOLUONG, TM_DUOC.VTYT_PHANLOAI, TM_DUOC.PHAMVI, TT_TONKHO.NGUONDUOC_ID, NG.TENNGUONDUOC AS TENNGUONDUOC        , TAMNGUNG = CASE WHEN TM_DUOC.TAMNGUNG = '1' OR NG.TAMNGUNG = '1' OR KD.TAMNGUNG = '1' THEN '1' ELSE '0' END        , TM_DUOC.DANGTRINHBAY        from TM_DUOC        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = TM_DUOC.DONVITINH_ID        left join TM_TENDUOC on TM_DUOC.TENDUOC_ID = TM_TENDUOC.TENDUOC_ID and TM_DUOC.BENHVIEN_ID = 'HLU01' and TM_DUOC.TAMNGUNG = '0'        left join TM_LOAIDUOC on TM_LOAIDUOC.LOAIDUOC_ID = TM_DUOC.LOAIDUOC_ID and TM_LOAIDUOC.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG on (TM_LOAIDUOC.LOAIVATTU_ID = TM_DUOC_HANDUNG.LOAIDUOC and TM_DUOC_HANDUNG.BENHVIEN_ID = 'HLU01')        inner join        (select LTRIM(A.KHODUOC_ID) + '_' + LTRIM(A.DUOC_ID) + '_' + LTRIM(ISNULL(A.NGUONDUOC_ID,'')) as DUOC_KEY, A.KHODUOC_ID, A.DUOC_ID, A.NGUONDUOC_ID,        SUM(isnull(A.SOLUONG,0)) as SOLUONG        from        (select SUM(SOLUONG) as SOLUONG, KHODUOC_ID, DUOC_ID, NGUONDUOC_ID from TT_DUOC_TONKHO        where BENHVIEN_ID = 'HLU01' group by KHODUOC_ID, DUOC_ID, NGUONDUOC_ID) A        group by LTRIM(A.KHODUOC_ID) + '_' + LTRIM(A.DUOC_ID) + '_' + LTRIM(ISNULL(A.NGUONDUOC_ID,'')), A.KHODUOC_ID, A.DUOC_ID, NGUONDUOC_ID        ) TT_TONKHO on TT_TONKHO.DUOC_ID = TM_DUOC.DUOC_ID        LEFT JOIN TM_NGUONHANG NG ON NG.NGUONDUOC_ID = TT_TONKHO.NGUONDUOC_ID        LEFT JOIN TM_KHODUOC KD ON KD.KHODUOC_ID = TT_TONKHO.KHODUOC_ID        where TM_DUOC.BENHVIEN_ID = 'HLU01' and TT_TONKHO.SOLUONG >= 0        and TM_DUOC.DUOC_ID in (5)]
2019-08-14 17:47:00,958 [1] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoVaBookingCOM23UpdateRedis] PreparedStatement : [select  distinct tk.DUOC_KEY, LTRIM(tk.PHAMVI_ID) as PHAMVI_ID, tk.NGUONDUOC_ID, nh.TENNGUONDUOC, nh.TINHTIEN, d.DUOC_ID, ld.MALOAIDUOC,        d.SOVISA,d.TYLE_VAT,d.COTOA, d.MADUOC, d.TENHANG, d.TENDUOCDAYDU, dvt.TENDONVITINH as DONVITINH, d.BHYT,        d.TENHOATCHAT, d.HAMLUONG, d.HANGSANXUAT, d.QUOCGIA, d.LOAIDUOC_ID, d.DUONGDUNG_ID, d.TINHTIEN_PTTT,        ten.TENDUOC, ten.TENDUOC_EN, ten.MAQUOCTE, ten.MAQUOCTEBT,        CASE WHEN d.BHYT = '1' THEN 'BHYT' ELSE '' END as BHYT_TEXT        , ld.LOAIVATTU_ID        , d.BENHVIEN_ID,        tk.SOLUONG, d.VTYT_PHANLOAI, d.PHAMVI, d.SUASOLUONGTONGHOP, d.MADUOCBV, d.DANGTRINHBAY        , TAMNGUNG = CASE WHEN d.TAMNGUNG = '1' OR nh.TAMNGUNG = '1' OR kd.TAMNGUNG = '1' THEN '1' ELSE '0' END        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        inner join        (        select  LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')) DUOC_KEY, (SUM(dtk.SOLUONG) - isnull(sum(A.SOLUONG),0) - isnull(sum(B.SOLUONG),0)) SOLUONG, pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        from (select sum(soluong) soluong,duoc_id,nguonduoc_id,khoduoc_id,benhvien_id from TT_DUOC_TONKHO  group by duoc_id,nguonduoc_id,khoduoc_id,benhvien_id) dtk        inner join TM_DUOC_PHAMVISD_MAPPING pvsd on dtk.KHODUOC_ID = pvsd.KHODUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NOITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) B on B.DUOC_ID = dtk.DUOC_ID and B.SOLUONG > 0 and B.PHAMVI_ID = pvsd.PHAMVI_ID and B.NGUONHANG_ID = dtk.NGUONDUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NGOAITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) A on A.DUOC_ID = dtk.DUOC_ID and A.SOLUONG > 0 and A.PHAMVI_ID = pvsd.PHAMVI_ID and A.NGUONHANG_ID = dtk.NGUONDUOC_ID        where dtk.SOLUONG > 0 and dtk.BENHVIEN_ID = 'HLU01'        group by LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')), pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        ) tk on tk.DUOC_ID = d.DUOC_ID        left join TM_DUOC_PHAMVISUDUNG kd on kd.PHAMVI_ID = tk.PHAMVI_ID and kd.BENHVIEN_ID = 'HLU01'        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = tk.NGUONDUOC_ID and nh.BENHVIEN_ID = 'HLU01'        where  d.BENHVIEN_ID = 'HLU01' and d.DUOC_ID in (5)]
2019-08-14 17:47:01,116 [1] DEBUG - Statement Id: [DAO00048_TT_PHAUTHUAT_GetDetail] PreparedStatement : [select PT.*, TN.BENHNHAN_ID              from              TT_PHAUTHUAT PT, TT_TIEPNHAN TN              where              PT.TIEPNHAN_ID = TN.TIEPNHAN_ID              AND PHAUTHUAT_ID  = 3745]
2019-08-14 17:47:01,193 [1] DEBUG - Statement Id: [DAO00048_CheckDVPhauThuatBHYT] PreparedStatement : [select count(0) from TT_VIENPHI          where REF_TABLE = 'TT_DVYEUCAU' and REF_ID = (select top 1 DVYEUCAU_ID from TT_PHAUTHUAT_YEUCAU where PHAUTHUAT_ID =  @param0 )          and TIEPNHAN_ID =  @param1  and BHYT_DONGIA > 0]
2019-08-14 17:47:01,193 [1] DEBUG - Statement Id: [DAO00048_CheckDVPhauThuatBHYT] Parameters: [@param0=[PHAUTHUAT_ID,3745], @param1=[TIEPNHAN_ID,26730]]
2019-08-14 17:47:01,193 [1] DEBUG - Statement Id: [DAO00048_CheckDVPhauThuatBHYT] Types: [@param0=[Int64, System.Int64], @param1=[Int64, System.Int64]]
2019-08-14 17:47:01,226 [1] DEBUG - Statement Id: [DAO00116_File_GetList] PreparedStatement : [select *              from TT_FILE_DINHKEM               where                             TT_FILE_DINHKEM.REF_TABLE = 'TT_PHAUTHUAT'                       and                           TT_FILE_DINHKEM.REF_ID = '3745'                       and                           TT_FILE_DINHKEM.BENHVIEN_ID = 'HLU01'                                     order by FILE_ID]
2019-08-14 17:47:01,341 [1] DEBUG - Statement Id: [DAO00048_TT_VIENPHI_GetList] PreparedStatement : [select *              from TT_VIENPHI               where                             TT_VIENPHI.TIEPNHAN_ID = '26730'                       and                           TT_VIENPHI.REF_TABLE = 'TT_PHAUTHUAT_VTYT'                       and                           TT_VIENPHI.BENHVIEN_ID = 'HLU01'                                     order by VIENPHI_ID]
2019-08-14 17:47:01,374 [1] DEBUG - Statement Id: [DAO00048_GetPhauThuat_VTYT_ByPhauThuatID] PreparedStatement : [SELECT            VTYT.PHAUTHUAT_VTYT_ID,            VTYT.PHAUTHUAT_ID,            VTYT.NGAYSUDUNG,            VTYT.TRANGTHAI_XEM,            VTYT.NGUONGOCDULIEU,            VTYT.NGUOITAO_ID,            VTYT.NGAYTAO,            VTYT.DUOC_ID,            VP.SOLUONG,            VTYT.PHAMVI_ID,            VTYT.KHOSUDUNG_ID AS KHODUOC_ID,            VTYT.CHUNGTU_ID,            VTYT.CHUNGTUTONGHOP_ID,            VTYT.NGUONHANG_ID,            VTYT.TINHTIEN,            VTYT.BNTUCHITRA,            VTYT.KHOTAO_ID,            VTYT.COSO,            VTYT.GHICHU,            VP.DONGIA_DOANHTHU,            VP.THANHTIEN_DOANHTHU,            vp.BHYT_DONGIA,            VP.BHYT_THANHTIEN,            CT.MACHUNGTU AS SOPHIEUXUAT,            PL.MACHUNGTU AS SOPHIEULINH            FROM            TT_PHAUTHUAT_VTYT VTYT            left join TT_PHAUTHUAT  PT on PT.PHAUTHUAT_ID = VTYT.PHAUTHUAT_ID            left join TT_VIENPHI VP  on VTYT.PHAUTHUAT_VTYT_ID = VP.REF_ID and VP.REF_TABLE = 'TT_PHAUTHUAT_VTYT'            left join TT_DUOC_CHUNGTU CT on VTYT.CHUNGTU_ID = CT.CHUNGTU_ID            left join TT_DUOC_PHIEULINH PL on VTYT.CHUNGTUTONGHOP_ID = PL.CHUNGTU_ID            WHERE            PT.PHAUTHUAT_ID =  '3745']
2019-08-14 17:47:01,414 [1] DEBUG - Statement Id: [DAO00063_GetListPhamviTuKhoThuocVaPhongBan] PreparedStatement : [select distinct dpv.*, dmap.KHODUOC_ID        from TM_DUOC_PHAMVISD_MAPPING dmap        left join TM_DUOC_PHAMVISUDUNG dpv on dpv.PHAMVI_ID = dmap.PHAMVI_ID and dpv.TAMNGUNG != '1'        where dmap.KHODUOC_ID in (select KHODUOC_ID from TM_PHONGBAN_KHODUOC where PHONGBAN_ID = '25')        and dmap.KHODUOC_ID = '29' and dpv.MAPHAMVI is not null]
2019-08-14 17:47:41,166 [1] DEBUG - Statement Id: [DAO00066_GetBENHAN_TIEPNHAN] PreparedStatement : [select top 1 *        from TT_NOITRU_BENHAN        where TIEPNHAN_ID = '26730'  and BENHVIEN_ID = 'HLU01'        order by NGAYTAO desc]
2019-08-14 17:47:41,244 [1] DEBUG - Statement Id: [DAO00014_GetInPatientStatus] PreparedStatement : [select TRANGTHAI, isnull(KHOACHUYENDEN_ID, KHOAVAO_ID) as KHOAHIENTAI from TT_NOITRU_BENHAN        where        TIEPNHAN_ID = '26730'        and BENHVIEN_ID = 'HLU01'         and           BENHAN_ID = '5737']
2019-08-14 17:47:50,781 [1] DEBUG - Statement Id: [DAO00014_GetORMServiceStatus] PreparedStatement : [select dvyc.TRANGTHAI, pt.NGUOIKHOA_ID, pt.NGUOITAO_ID        from TT_PHAUTHUAT pt        left join TT_PHAUTHUAT_YEUCAU ptyc on ptyc.PHAUTHUAT_ID = pt.PHAUTHUAT_ID        left join (select * from TT_DVYEUCAU where exists (select DVYEUCAU_ID from TT_PHAUTHUAT where TT_DVYEUCAU.DVYEUCAU_ID = DVYEUCAU_ID and PHAUTHUAT_ID = '3745')) dvyc        on ptyc.DVYEUCAU_ID = dvyc.DVYEUCAU_ID        where pt.PHAUTHUAT_ID = '3745']
2019-08-14 17:49:58,653 [1] DEBUG - Statement Id: [DAO00048_GetTTPhauThuatVTYT] PreparedStatement : [SELECT              VTYT.PHAUTHUAT_VTYT_ID,              VTYT.PHAUTHUAT_ID,              VTYT.NGAYSUDUNG,              VTYT.TRANGTHAI_XEM,              VTYT.NGUONGOCDULIEU,              VTYT.NGUOITAO_ID,              VTYT.NGAYTAO,              VTYT.DUOC_ID,              VTYT.SOLUONG,              VTYT.KHOSUDUNG_ID AS KHODUOC_ID,              VTYT.CHUNGTU_ID,              VTYT.CHUNGTUTONGHOP_ID,              VTYT.NGUONHANG_ID,              VTYT.TINHTIEN,              VTYT.BNTUCHITRA,              VTYT.GHICHU              ,max(VP.DONGIA_DOANHTHU) AS DONGIABAN,              sum(isnull(VP.BENHNHAN_PHAITHANHTOAN,0))  BENHNHAN_PHAITHANHTOAN,              sum(isnull(VP.THANHTIEN_DOANHTHU,0)) THANHTIEN_DOANHTHU,              CT.MACHUNGTU AS SOPHIEUXUAT,              PL.MACHUNGTU AS SOPHIEULINH              FROM              TT_PHAUTHUAT_VTYT VTYT              left join TT_PHAUTHUAT  PT              on PT.PHAUTHUAT_ID = VTYT.PHAUTHUAT_ID              left join TT_VIENPHI VP              on VTYT.PHAUTHUAT_VTYT_ID = VP.REF_ID              and VP.REF_TABLE = 'TT_PHAUTHUAT_VTYT'              left join TT_DUOC_CHUNGTU CT              on VTYT.CHUNGTU_ID = CT.CHUNGTU_ID              left join TT_DUOC_PHIEULINH PL              on VTYT.CHUNGTUTONGHOP_ID = PL.CHUNGTU_ID              WHERE              VTYT.PHAUTHUAT_VTYT_ID = 1241              group by  VTYT.PHAUTHUAT_VTYT_ID,              VTYT.PHAUTHUAT_ID,              VTYT.NGAYSUDUNG,              VTYT.TRANGTHAI_XEM,              VTYT.NGUONGOCDULIEU,              VTYT.NGUOITAO_ID,              VTYT.NGAYTAO,              VTYT.DUOC_ID,              VTYT.SOLUONG,              VTYT.KHOSUDUNG_ID ,              VTYT.CHUNGTU_ID,              VTYT.CHUNGTUTONGHOP_ID,              VTYT.NGUONHANG_ID,              VTYT.TINHTIEN,              VTYT.BNTUCHITRA,              VTYT.GHICHU,              CT.MACHUNGTU ,              PL.MACHUNGTU]
--------------------------------------------------------------------------------
2019-08-14 18:05:45,078 [1] DEBUG - Statement Id: [DAO00001_DBList] PreparedStatement : [select *              from TM_SYS_SERVER              where HOSPITAL_ID = '_SYSTEM_' and TYPE = 'D']
2019-08-14 18:05:45,320 [1] DEBUG - Statement Id: [DAO00001_DaoList] PreparedStatement : [select              TM_SYS_SERVICEMAP.ID,              TM_SYS_SERVICEMAP.HOSPITAL_ID,              TM_SYS_SERVICEMAP.DB_NAME,              TM_SYS_SERVICEMAP.TYPE,              TM_SYS_SERVICEMAP.NAME,              TM_SYS_SERVICEMAP.CLASS,              (TM_SYS_DIC.VALUE + '.' + TM_SYS_SERVICEMAP.CLASS) as CLASSFULL,              TM_SYS_SERVICEMAP.ASSEMBLY              from TM_SYS_SERVICEMAP              inner join TM_SYS_DIC              on TM_SYS_SERVICEMAP.NAMESPACE = TM_SYS_DIC.ID              where HOSPITAL_ID = '_SYSTEM_' AND TYPE = 'D' AND ACTIVE = '1'              order by DB_NAME]
2019-08-14 18:05:45,359 [1] DEBUG - Statement Id: [DAO00001_ServiceList] PreparedStatement : [select              TM_SYS_SERVICEMAP.ID,              TM_SYS_SERVICEMAP.HOSPITAL_ID,              TM_SYS_SERVICEMAP.DB_NAME,              TM_SYS_SERVICEMAP.TYPE,              TM_SYS_SERVICEMAP.NAME,              TM_SYS_SERVICEMAP.CLASS,              (TM_SYS_DIC.VALUE + '.' + TM_SYS_SERVICEMAP.CLASS) as CLASSFULL,              TM_SYS_SERVICEMAP.ASSEMBLY,              TM_SYS_SERVER.URL              from TM_SYS_SERVICEMAP              inner join TM_SYS_DIC on TM_SYS_SERVICEMAP.NAMESPACE = TM_SYS_DIC.ID              inner join TM_SYS_SERVER on (TM_SYS_SERVICEMAP.DB_NAME = TM_SYS_SERVER.NAME) and (TM_SYS_SERVER.HOSPITAL_ID = '_SYSTEM_')              where TM_SYS_SERVICEMAP.HOSPITAL_ID = '_SYSTEM_' AND TM_SYS_SERVICEMAP.TYPE = 'S'  AND ACTIVE = '1'              order by URL]
2019-08-14 18:05:45,686 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = '_SYSTEM_'               AND                   TM_SYS_SCREEN.PAGE = 'LOGIN'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2019-08-14 18:05:45,896 [1] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = '_SYSTEM_'               AND                   TM_SYS_CACHE.ACTIVE = '1']
2019-08-14 18:05:52,611 [1] DEBUG - Statement Id: [DAO00001_DBList] PreparedStatement : [select *              from TM_SYS_SERVER              where HOSPITAL_ID = 'HLU01' and TYPE = 'D']
2019-08-14 18:05:52,681 [1] DEBUG - Statement Id: [DAO00001_DaoList] PreparedStatement : [select              TM_SYS_SERVICEMAP.ID,              TM_SYS_SERVICEMAP.HOSPITAL_ID,              TM_SYS_SERVICEMAP.DB_NAME,              TM_SYS_SERVICEMAP.TYPE,              TM_SYS_SERVICEMAP.NAME,              TM_SYS_SERVICEMAP.CLASS,              (TM_SYS_DIC.VALUE + '.' + TM_SYS_SERVICEMAP.CLASS) as CLASSFULL,              TM_SYS_SERVICEMAP.ASSEMBLY              from TM_SYS_SERVICEMAP              inner join TM_SYS_DIC              on TM_SYS_SERVICEMAP.NAMESPACE = TM_SYS_DIC.ID              where HOSPITAL_ID = 'HLU01' AND TYPE = 'D' AND ACTIVE = '1'              order by DB_NAME]
2019-08-14 18:05:55,343 [1] DEBUG - Statement Id: [DAO00001_ServiceList] PreparedStatement : [select              TM_SYS_SERVICEMAP.ID,              TM_SYS_SERVICEMAP.HOSPITAL_ID,              TM_SYS_SERVICEMAP.DB_NAME,              TM_SYS_SERVICEMAP.TYPE,              TM_SYS_SERVICEMAP.NAME,              TM_SYS_SERVICEMAP.CLASS,              (TM_SYS_DIC.VALUE + '.' + TM_SYS_SERVICEMAP.CLASS) as CLASSFULL,              TM_SYS_SERVICEMAP.ASSEMBLY,              TM_SYS_SERVER.URL              from TM_SYS_SERVICEMAP              inner join TM_SYS_DIC on TM_SYS_SERVICEMAP.NAMESPACE = TM_SYS_DIC.ID              inner join TM_SYS_SERVER on (TM_SYS_SERVICEMAP.DB_NAME = TM_SYS_SERVER.NAME) and (TM_SYS_SERVER.HOSPITAL_ID = 'HLU01')              where TM_SYS_SERVICEMAP.HOSPITAL_ID = 'HLU01' AND TM_SYS_SERVICEMAP.TYPE = 'S'  AND ACTIVE = '1'              order by URL]
2019-08-14 18:05:55,432 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1']
2019-08-14 18:05:56,373 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM005']
2019-08-14 18:05:56,531 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM015']
2019-08-14 18:05:56,609 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM067']
2019-08-14 18:05:56,684 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM008']
2019-08-14 18:05:56,762 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM068']
2019-08-14 18:05:56,853 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM006']
2019-08-14 18:05:56,929 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM030']
2019-08-14 18:05:57,009 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM025']
2019-08-14 18:05:57,092 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM024']
2019-08-14 18:05:57,596 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM033']
2019-08-14 18:05:57,639 [5] DEBUG - Statement Id: [DAO00027_GetListDuocKyGuiTonKho] PreparedStatement : [select  distinct TT_TONKHO.DUOC_KEY, LTRIM(TT_TONKHO.KHODUOC_ID) as KHODUOC_ID, TM_DUOC.DUOC_ID, TM_LOAIDUOC.MALOAIDUOC,TM_DUOC.SOVISA,TM_DUOC.TYLE_VAT,TM_DUOC.COTOA,        TM_DUOC.MADUOC, TM_DUOC.TENHANG, TM_DUOC.TENDUOCDAYDU, dvt.TENDONVITINH as DONVITINH,  TM_DUOC.DONVITINH_ID,TM_DUOC.BHYT,TM_DUOC.PHAMVI,        TM_DUOC.TENHOATCHAT, TM_DUOC.HAMLUONG, TM_DUOC.HANGSANXUAT, TM_DUOC.QUOCGIA, TM_DUOC.LOAIDUOC_ID, TM_DUOC.DUONGDUNG_ID,        TM_TENDUOC.TENDUOC, TM_TENDUOC.TENDUOC_EN, TM_TENDUOC.MAQUOCTE, TM_TENDUOC.MAQUOCTEBT,        TM_LOAIDUOC.LOAIVATTU_ID, TM_DUOC.BENHVIEN_ID,TT_TONKHO.SOLUONG, TT_TONKHO.NGUONDUOC_ID, NH.TENNGUONDUOC        , TAMNGUNG = CASE WHEN TM_DUOC.TAMNGUNG = '1' OR nh.TAMNGUNG = '1' OR KD.TAMNGUNG = '1' THEN '1' ELSE '0' END        , TM_DUOC.DANGTRINHBAY        from TM_DUOC        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = TM_DUOC.DONVITINH_ID        left join TM_TENDUOC on TM_DUOC.TENDUOC_ID = TM_TENDUOC.TENDUOC_ID and TM_DUOC.BENHVIEN_ID = 'HLU01' and TM_DUOC.TAMNGUNG = '0'        left join TM_LOAIDUOC on TM_LOAIDUOC.LOAIDUOC_ID = TM_DUOC.LOAIDUOC_ID and TM_LOAIDUOC.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG on (TM_LOAIDUOC.LOAIVATTU_ID = TM_DUOC_HANDUNG.LOAIDUOC and TM_DUOC_HANDUNG.BENHVIEN_ID = 'HLU01')        inner join        (select LTRIM(A.KHODUOC_ID) + '_' + LTRIM(A.DUOC_ID) + '_' + LTRIM(ISNULL(A.NGUONDUOC_ID,'')) as DUOC_KEY, A.KHODUOC_ID, A.DUOC_ID,A.NGUONDUOC_ID,        SUM(isnull(A.SOLUONG,0)) as SOLUONG        from        (select SUM(SOLUONG) as SOLUONG, KHODUOC_ID, DUOC_ID, NGUONDUOC_ID from TT_DUOC_KYGUI_TONKHO        where BENHVIEN_ID = 'HLU01' group by KHODUOC_ID, DUOC_ID, NGUONDUOC_ID) A        group by LTRIM(A.KHODUOC_ID) + '_' + LTRIM(A.DUOC_ID) + '_' + LTRIM(A.NGUONDUOC_ID), A.KHODUOC_ID, A.DUOC_ID, A.NGUONDUOC_ID)        TT_TONKHO on TT_TONKHO.DUOC_ID = TM_DUOC.DUOC_ID        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = TT_TONKHO.NGUONDUOC_ID and nh.BENHVIEN_ID = 'HLU01'        LEFT JOIN TM_KHODUOC KD ON KD.KHODUOC_ID = TT_TONKHO.KHODUOC_ID        where TM_DUOC.BENHVIEN_ID = 'HLU01' AND TT_TONKHO.SOLUONG >= 0]
2019-08-14 18:05:57,714 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM018']
2019-08-14 18:05:57,747 [5] DEBUG - Statement Id: [DAO00027_GetListDuocTonKho] PreparedStatement : [select distinct TT_TONKHO.DUOC_KEY, LTRIM(TT_TONKHO.KHODUOC_ID) as KHODUOC_ID, TM_DUOC.DUOC_ID, TM_LOAIDUOC.MALOAIDUOC,TM_DUOC.SOVISA,TM_DUOC.TYLE_VAT,TM_DUOC.COTOA,        TM_DUOC.MADUOC, TM_DUOC.TENHANG, TM_DUOC.TENDUOCDAYDU, dvt.TENDONVITINH as DONVITINH,  TM_DUOC.DONVITINH_ID,TM_DUOC.BHYT,                TM_DUOC.TENHOATCHAT,          TM_DUOC.HAMLUONG, TM_DUOC.HANGSANXUAT, TM_DUOC.QUOCGIA, TM_DUOC.LOAIDUOC_ID, TM_DUOC.DUONGDUNG_ID,        TM_TENDUOC.TENDUOC, TM_TENDUOC.TENDUOC_EN, TM_TENDUOC.MAQUOCTE, TM_TENDUOC.MAQUOCTEBT,        TM_LOAIDUOC.LOAIVATTU_ID, TM_DUOC.BENHVIEN_ID,        TT_TONKHO.SOLUONG, TM_DUOC.VTYT_PHANLOAI, TM_DUOC.PHAMVI, TT_TONKHO.NGUONDUOC_ID, NG.TENNGUONDUOC AS TENNGUONDUOC        , TAMNGUNG = CASE WHEN TM_DUOC.TAMNGUNG = '1' OR NG.TAMNGUNG = '1' OR KD.TAMNGUNG = '1' THEN '1' ELSE '0' END        , TM_DUOC.DANGTRINHBAY        from TM_DUOC        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = TM_DUOC.DONVITINH_ID        left join TM_TENDUOC on TM_DUOC.TENDUOC_ID = TM_TENDUOC.TENDUOC_ID and TM_DUOC.BENHVIEN_ID = 'HLU01' and TM_DUOC.TAMNGUNG = '0'        left join TM_LOAIDUOC on TM_LOAIDUOC.LOAIDUOC_ID = TM_DUOC.LOAIDUOC_ID and TM_LOAIDUOC.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG on (TM_LOAIDUOC.LOAIVATTU_ID = TM_DUOC_HANDUNG.LOAIDUOC and TM_DUOC_HANDUNG.BENHVIEN_ID = 'HLU01')        inner join        (select LTRIM(A.KHODUOC_ID) + '_' + LTRIM(A.DUOC_ID) + '_' + LTRIM(ISNULL(A.NGUONDUOC_ID,'')) as DUOC_KEY, A.KHODUOC_ID, A.DUOC_ID, A.NGUONDUOC_ID,        SUM(isnull(A.SOLUONG,0)) as SOLUONG        from        (select SUM(SOLUONG) as SOLUONG, KHODUOC_ID, DUOC_ID, NGUONDUOC_ID from TT_DUOC_TONKHO        where BENHVIEN_ID = 'HLU01' group by KHODUOC_ID, DUOC_ID, NGUONDUOC_ID) A        group by LTRIM(A.KHODUOC_ID) + '_' + LTRIM(A.DUOC_ID) + '_' + LTRIM(ISNULL(A.NGUONDUOC_ID,'')), A.KHODUOC_ID, A.DUOC_ID, NGUONDUOC_ID        ) TT_TONKHO on TT_TONKHO.DUOC_ID = TM_DUOC.DUOC_ID        LEFT JOIN TM_NGUONHANG NG ON NG.NGUONDUOC_ID = TT_TONKHO.NGUONDUOC_ID        LEFT JOIN TM_KHODUOC KD ON KD.KHODUOC_ID = TT_TONKHO.KHODUOC_ID        where TM_DUOC.BENHVIEN_ID = 'HLU01' and TT_TONKHO.SOLUONG >= 0]
2019-08-14 18:05:58,630 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM023']
2019-08-14 18:05:58,669 [5] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoVaBooking] PreparedStatement : [declare @TOAMUANGOAI int = 0;        select @TOAMUANGOAI = isnull(VALUE,0) from TM_SYS_APPSETTINGS where CODE = 'OPD_TOAMUANGOAI_DUNGDANHMUC_DUOC'                if @TOAMUANGOAI = 1        begin        select  distinct '0' + '_' + LTRIM(d.DUOC_ID) + '_' + '0' as DUOC_KEY, 0 as PHAMVI_ID, 0 as NGUONDUOC_ID, null as TENNGUONDUOC, null as TINHTIEN, d.DUOC_ID, ld.MALOAIDUOC,        d.SOVISA,d.TYLE_VAT,d.COTOA, d.MADUOC, d.TENHANG, d.TENDUOCDAYDU, d.DONVITINH as DONVITINH, d.BHYT,        d.TENHOATCHAT, d.HAMLUONG, d.HANGSANXUAT, d.QUOCGIA, d.LOAIDUOC_ID, d.DUONGDUNG_ID, d.TINHTIEN_PTTT,        ten.TENDUOC, ten.TENDUOC_EN, ten.MAQUOCTE, ten.MAQUOCTEBT,        '' as BHYT_TEXT        , ld.LOAIVATTU_ID        , d.BENHVIEN_ID,        999999999 as SOLUONG, d.VTYT_PHANLOAI, d.PHAMVI, d.SUASOLUONGTONGHOP, d.MADUOCBV, d.DANGTRINHBAY        , TAMNGUNG = CASE WHEN d.TAMNGUNG = '1' THEN '1' ELSE '0' END        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        union all        select  distinct tk.DUOC_KEY, LTRIM(tk.PHAMVI_ID) as PHAMVI_ID, tk.NGUONDUOC_ID, nh.TENNGUONDUOC, nh.TINHTIEN, d.DUOC_ID, ld.MALOAIDUOC,        d.SOVISA,d.TYLE_VAT,d.COTOA, d.MADUOC, d.TENHANG, d.TENDUOCDAYDU, dvt.TENDONVITINH as DONVITINH, d.BHYT,        d.TENHOATCHAT, d.HAMLUONG, d.HANGSANXUAT, d.QUOCGIA, d.LOAIDUOC_ID, d.DUONGDUNG_ID, d.TINHTIEN_PTTT,        ten.TENDUOC, ten.TENDUOC_EN, ten.MAQUOCTE, ten.MAQUOCTEBT,        CASE WHEN d.BHYT = '1' THEN 'BHYT' ELSE '' END as BHYT_TEXT        , ld.LOAIVATTU_ID        , d.BENHVIEN_ID,        tk.SOLUONG, d.VTYT_PHANLOAI, d.PHAMVI, d.SUASOLUONGTONGHOP, d.MADUOCBV, d.DANGTRINHBAY        , TAMNGUNG = CASE WHEN d.TAMNGUNG = '1' OR nh.TAMNGUNG = '1' OR kd.TAMNGUNG = '1' THEN '1' ELSE '0' END        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        inner join        (        select  LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')) DUOC_KEY, (SUM(dtk.SOLUONG) - isnull(sum(A.SOLUONG),0) - isnull(sum(B.SOLUONG),0)) SOLUONG, pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        from (select sum(soluong) soluong,duoc_id,nguonduoc_id,khoduoc_id,benhvien_id from TT_DUOC_TONKHO  group by duoc_id,nguonduoc_id,khoduoc_id,benhvien_id) dtk        inner join TM_DUOC_PHAMVISD_MAPPING pvsd on dtk.KHODUOC_ID = pvsd.KHODUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NOITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) B on B.DUOC_ID = dtk.DUOC_ID and B.SOLUONG > 0 and B.PHAMVI_ID = pvsd.PHAMVI_ID and B.NGUONHANG_ID = dtk.NGUONDUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NGOAITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) A on A.DUOC_ID = dtk.DUOC_ID and A.SOLUONG > 0 and A.PHAMVI_ID = pvsd.PHAMVI_ID and A.NGUONHANG_ID = dtk.NGUONDUOC_ID        where dtk.SOLUONG > 0 and dtk.BENHVIEN_ID = 'HLU01'        group by LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')), pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        ) tk on tk.DUOC_ID = d.DUOC_ID        left join TM_DUOC_PHAMVISUDUNG kd on kd.PHAMVI_ID = tk.PHAMVI_ID and kd.BENHVIEN_ID = 'HLU01'        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = tk.NGUONDUOC_ID and nh.BENHVIEN_ID = 'HLU01'        where d.BENHVIEN_ID = 'HLU01'  and tk.SOLUONG >= 0         end                else        begin        select  distinct tk.DUOC_KEY, LTRIM(tk.PHAMVI_ID) as PHAMVI_ID, tk.NGUONDUOC_ID, nh.TENNGUONDUOC, nh.TINHTIEN, d.DUOC_ID, ld.MALOAIDUOC,        d.SOVISA,d.TYLE_VAT,d.COTOA, d.MADUOC, d.TENHANG, d.TENDUOCDAYDU, d.DONVITINH as DONVITINH, d.BHYT,        d.TENHOATCHAT, d.HAMLUONG, d.HANGSANXUAT, d.QUOCGIA, d.LOAIDUOC_ID, d.DUONGDUNG_ID, d.TINHTIEN_PTTT,        ten.TENDUOC, ten.TENDUOC_EN, ten.MAQUOCTE, ten.MAQUOCTEBT,        CASE WHEN d.BHYT = '1' THEN 'BHYT' ELSE '' END as BHYT_TEXT        , ld.LOAIVATTU_ID        , d.BENHVIEN_ID,        tk.SOLUONG, d.VTYT_PHANLOAI, d.PHAMVI, d.SUASOLUONGTONGHOP, d.MADUOCBV, d.DANGTRINHBAY        , TAMNGUNG = CASE WHEN d.TAMNGUNG = '1' OR nh.TAMNGUNG = '1' OR kd.TAMNGUNG = '1' THEN '1' ELSE '0' END        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        inner join        (        select  LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')) DUOC_KEY, (SUM(dtk.SOLUONG) - isnull(sum(A.SOLUONG),0) - isnull(sum(B.SOLUONG),0)) SOLUONG, pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        from (select sum(soluong) soluong,duoc_id,nguonduoc_id,khoduoc_id,benhvien_id from TT_DUOC_TONKHO  group by duoc_id,nguonduoc_id,khoduoc_id,benhvien_id) dtk        inner join TM_DUOC_PHAMVISD_MAPPING pvsd on dtk.KHODUOC_ID = pvsd.KHODUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NOITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) B on B.DUOC_ID = dtk.DUOC_ID and B.SOLUONG > 0 and B.PHAMVI_ID = pvsd.PHAMVI_ID and B.NGUONHANG_ID = dtk.NGUONDUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NGOAITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) A on A.DUOC_ID = dtk.DUOC_ID and A.SOLUONG > 0 and A.PHAMVI_ID = pvsd.PHAMVI_ID and A.NGUONHANG_ID = dtk.NGUONDUOC_ID        where dtk.SOLUONG > 0 and dtk.BENHVIEN_ID = 'HLU01'        group by LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')), pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        ) tk on tk.DUOC_ID = d.DUOC_ID        left join TM_DUOC_PHAMVISUDUNG kd on kd.PHAMVI_ID = tk.PHAMVI_ID and kd.BENHVIEN_ID = 'HLU01'        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = tk.NGUONDUOC_ID and nh.BENHVIEN_ID = 'HLU01'        where d.BENHVIEN_ID = 'HLU01'  and tk.SOLUONG >= 0        end]
2019-08-14 18:06:00,846 [5] DEBUG - Statement Id: [DAO00320_GetList] PreparedStatement : [select M.*            from TM_MAU M            LEFT JOIN TM_MAU_DONVITINH DVT on M.DONVITINH_ID=DVT.DONVITINH_ID            where            M.TAMNGUNG = '0'            and M.BENHVIEN_ID = 'HLU01'            order by M.TENMAU]
2019-08-14 18:06:00,909 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM071']
2019-08-14 18:06:00,943 [5] DEBUG - Statement Id: [DAO00322_GetListMauTonKhoForCreateCached] PreparedStatement : [SELECT DISTINCT          TK.MAU_KEY, TK.KHOMAU_ID, M.MAU_ID, M.MAMAU, M.TENMAU, M.NHOM_ABO, M.NHOM_RH, M.LOAIMAU_ID,          TK.SOLONHAP_ID, SLN.SOLONHAP, SLN.SOKIEMSOAT, TK.NGUONHANG_ID, NG.TENNGUONMAU, M.BENHVIEN_ID, M.DONVITINH_ID,          SUM(tk.SOLUONG) AS SOLUONG,K.TENKHO,DVT.TENDONVITINH          FROM TT_MAU_TONKHO TK          JOIN TM_KHO K ON TK.KHOMAU_ID = K.KHO_ID          JOIN TT_MAU_CHUNGTU_SOLONHAP SLN ON TK.SOLONHAP_ID = SLN.SOLONHAP_ID          JOIN TM_MAU M on TK.MAU_ID = M.MAU_ID and M.TAMNGUNG = '0'          LEFT JOIN TM_MAU_DONVITINH DVT on M.DONVITINH_ID=DVT.DONVITINH_ID          LEFT JOIN TM_NGUONMAU NG ON NG.NGUONMAU_ID = TK.NGUONHANG_ID          WHERE TK.SOLUONG > 0          GROUP BY TK.MAU_KEY, TK.KHOMAU_ID, M.MAU_ID, M.MAMAU, M.TENMAU, M.NHOM_ABO, M.NHOM_RH, M.LOAIMAU_ID,          TK.SOLONHAP_ID, SLN.SOLONHAP, SLN.SOKIEMSOAT,TK.NGUONHANG_ID, NG.TENNGUONMAU, M.BENHVIEN_ID, M.DONVITINH_ID,K.TENKHO,DVT.TENDONVITINH]
2019-08-14 18:06:01,006 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM073']
2019-08-14 18:06:01,043 [5] DEBUG - Statement Id: [DAO00322_GetListMauTonKhoTruBooking] PreparedStatement : [select distinct          TK.MAU_KEY, TK.KHOMAU_ID, M.MAU_ID, M.MAMAU, M.TENMAU, M.NHOM_ABO, M.NHOM_RH, M.LOAIMAU_ID, M.DONVITINH_ID,          TK.SOLONHAP_ID, TK.SOLONHAP, TK.SOKIEMSOAT,M.PHAMVI, TK.NGUONHANG_ID, NG.TENNGUONMAU, M.BENHVIEN_ID,          TK.SOLUONG,TK.TENKHO,DVT.TENDONVITINH          from TM_MAU M          JOIN          (          select          A.MAU_KEY, A.KHOMAU_ID, A.MAU_ID ,a.NGUONHANG_ID, A.SOLONHAP_ID, A.SOLONHAP, A.SOKIEMSOAT, A.SOLUONG,A.TENKHO          from          (          select KHOMAU_ID, TK.MAU_ID, TK.NGUONHANG_ID, TK.MAU_KEY, SLN.SOLONHAP_ID, SLN.SOLONHAP, SLN.SOKIEMSOAT, ISNULL(TK.SOLUONG,0) - ISNULL(book.SOLUONG,0) as SOLUONG,K.TENKHO          from TT_MAU_TONKHO TK          JOIN TM_KHO K ON TK.KHOMAU_ID = K.KHO_ID          inner join TT_MAU_CHUNGTU_SOLONHAP SLN ON TK.SOLONHAP_ID = SLN.SOLONHAP_ID          left join dbo.TT_MAU_TONKHO_BOOK book ON book.MAU_KEY = TK.MAU_KEY AND book.TRANGTHAI = 'HIEULUC'          where ISNULL(TK.SOLUONG,0) - ISNULL(book.SOLUONG,0) > 0          ) A          )TK on TK.MAU_ID = M.MAU_ID and M.TAMNGUNG = '0'          LEFT JOIN TM_MAU_DONVITINH DVT on M.DONVITINH_ID=DVT.DONVITINH_ID          LEFT JOIN TM_NGUONMAU NG ON NG.NGUONMAU_ID = TK.NGUONHANG_ID]
2019-08-14 18:06:01,114 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM072']
2019-08-14 18:06:02,052 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'MAIN'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2019-08-14 18:06:02,938 [1] DEBUG - Statement Id: [DAO00002_FormList] PreparedStatement : [select              TM_SYS_FORM.HOSPITAL_ID,              TM_SYS_FORM.NAME,              TM_SYS_FORM.CLASS,              TM_SYS_FORM.ASSEMBLY,              TM_SYS_FORM.TITLE_VI as TITLE              from TM_SYS_FORM              where HOSPITAL_ID = 'HLU01']
2019-08-14 18:06:08,065 [1] DEBUG - Statement Id: [DAO00300_GetShortcutListByUserID] PreparedStatement : [SELECT S.SHORTCUT_CODE, S.SHORTCUT_VALUE              FROM TM_SHORTCUT AS S              WHERE S.BENHVIEN_ID = 'HLU01' AND S.USER_ID = '1' AND TAMNGUNG = '0']
2019-08-14 18:06:08,096 [1] DEBUG - Statement Id: [DAO00087_GetList] PreparedStatement : [select CODE, VALUE, BENHVIEN_ID              from TM_SYS_APPSETTINGS              where LOCKED = '0' and BENHVIEN_ID = 'HLU01'              order by SETTING_ID]
2019-08-14 18:06:08,172 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'MSG01'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2019-08-14 18:06:08,344 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'MSG02'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2019-08-14 18:06:08,505 [1] DEBUG - Statement Id: [DAO00008_GetUserSettings] PreparedStatement : [select A.*, B.TENKHO , C.TENPHONGBAN, B.MAKHO, C.MAPHONGBAN          from TM_SYS_USERS A          left join TM_KHODUOC B on B.KHODUOC_ID = A.INVENTORY_ID          left join TM_PHONGBAN C on (C.PHONGBAN_ID = A.WORKING_DEPT_ID and C.BENHVIEN_ID =  @param0 )          left join TM_SYS_USERKHO D on (D.ACCOUNT_ID = A.ACCOUNT_ID and D.HOSPITAL_ID =  @param0 )          where          A.HOSPITAL_ID =  @param0            and                 A.ACCOUNT_ID =  @param1]
2019-08-14 18:06:08,507 [1] DEBUG - Statement Id: [DAO00008_GetUserSettings] Parameters: [@param0=[HOSPITAL_ID,HLU01], @param1=[ACCOUNT_ID,113]]
2019-08-14 18:06:08,507 [1] DEBUG - Statement Id: [DAO00008_GetUserSettings] Types: [@param0=[String, System.String], @param1=[String, System.String]]
2019-08-14 18:06:08,535 [1] DEBUG - Statement Id: [DAO00008_GetUserInvSettings] PreparedStatement : [select A.*, B.TENKHO, B.MAKHO, B.LOAIKHO_ID, B.KHOQUANLY_ID          from TM_SYS_USERKHO A          left join TM_KHO B on B.MODULE_ID = A.MODULE_ID and B.KHO_ID = A.KHO_ID          where A.HOSPITAL_ID =  @param0  and A.ACCOUNT_ID =  @param1           order by B.TENKHO]
2019-08-14 18:06:08,535 [1] DEBUG - Statement Id: [DAO00008_GetUserInvSettings] Parameters: [@param0=[HOSPITAL_ID,HLU01], @param1=[ACCOUNT_ID,113]]
2019-08-14 18:06:08,535 [1] DEBUG - Statement Id: [DAO00008_GetUserInvSettings] Types: [@param0=[String, System.String], @param1=[String, System.String]]
2019-08-14 18:06:08,688 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'COM30'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2019-08-14 18:06:08,840 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'RIS04'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2019-08-14 18:06:16,567 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'MENU1'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2019-08-14 18:06:16,674 [1] DEBUG - Statement Id: [DAO00011_GetList] PreparedStatement : [select              TM_SYS_MENU.ID,              TM_SYS_MENU.PARENTID,              TM_SYS_MENU.SCREEN,              TM_SYS_MENU.SMALLIMAGE,              TM_SYS_MENU.LARGEIMAGE,              TM_SYS_MENU.DESCRIPTION,              TM_SYS_MENU.TYPE,              TM_SYS_MENU.TITLE_VI as TITLE              from TM_SYS_MENU              where TM_SYS_MENU.HOSPITAL_ID = 'HLU01' and TM_SYS_MENU.ACTIVE = '1'               AND                   (TM_SYS_MENU.TYPE & '8' = '8')                             order by TM_SYS_MENU.ORDERNUM]
2019-08-14 18:06:16,926 [1] DEBUG - Statement Id: [DAO00011_usermenu_list] PreparedStatement : [select              TM_SYS_HOMEMENU.MENUID as ID,              TM_SYS_MENU.TITLE_VI as TITLE,              TM_SYS_MENU.SCREEN,              TM_SYS_MENU.SMALLIMAGE,              TM_SYS_MENU.LARGEIMAGE,              TM_SYS_MENU.TYPE              from TM_SYS_HOMEMENU              left join TM_SYS_MENU on TM_SYS_MENU.ID = TM_SYS_HOMEMENU.MENUID and TM_SYS_MENU.HOSPITAL_ID = TM_SYS_HOMEMENU.HOSPITAL_ID              where TM_SYS_HOMEMENU.HOSPITAL_ID = 'HLU01' and TM_SYS_HOMEMENU.USERID = '113' and TM_SYS_MENU.ACTIVE = '1'               AND                   (TM_SYS_MENU.TYPE & '8' = '8')                             ORDER BY TM_SYS_HOMEMENU.ORDERNUM]
2019-08-14 18:06:24,726 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'OPD23'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2019-08-14 18:06:26,013 [1] DEBUG - Statement Id: [DAO00019_DanhSachPhauThuatThuThuat] PreparedStatement : [declare @TenBenhVien nvarchar(500)        set @TenBenhVien = (select VALUE from TM_SYS_APPSETTINGS where CODE = 'APP_BENHVIEN_TEN')        select * from(        select ROW_NUMBER() OVER(order by NGAYGIOYEUCAU) as ROWNUMBER, *        from        (SELECT distinct        COUNT(*) OVER() as TOTALROWS,        N'Mã người bệnh: ' + bn.MAYTE + ' - ' + N'Tên người bệnh: ' + bn.TENBENHNHAN + ' - ' + N'Số bệnh án: ' + ISNULL(BA.SOBENHAN,'') + ' - ' + N'Sinh ngày: ' + isnull(Convert(varchar(10),bn.NGAYSINH,103),bn.NAMSINH) + ' - ' + N'Giới tính: ' + GD.DESCRIPTION as GROUPNAME,        bn.MAYTE, bn.TENBENHNHAN, bn.NAMSINH, bn.NGAYSINH as TUOI, ISNULL(CONVERT(VARCHAR(10), bn.NGAYSINH, 103),CAST(bn.NAMSINH AS varchar)) as NGAYSINH, bn.DIACHILIENLAC as DIACHI, bn.GIOITINH, GD.DESCRIPTION as TENGIOITINH,        tn.DOITUONG_ID, tn.THOIGIANTIEPNHAN, tn.BENHNHAN_ID, tn.TIEPNHAN_ID, tn.TRAITUYEN, tn.SOTIEPNHAN        , dv.DICHVU_ID, dv.NOITHUCHIEN_ID, isnull(dv.NGAYTAO, dv.NGAYCAPNHAT) as THOIGIANDKDICHVU        , dv.KHAN, dv.NOIYEUCAU_ID, dv.NGAYGIOYEUCAU, dv.BACSICHIDINH_ID, dv.DONVIGIOITHIEU_ID        , dv.NGUOIGIOITHIEU_ID, dv.TRANGTHAI_WFL, tn.NOIGIOITHIEU_ID        , dv.DVYEUCAU_ID, dv.MARIS, dv.TRANGTHAI as TRANGTHAICODE, B.TENNHOMDICHVU, dv.SOPHIEUYEUCAU, dv.KHAMBENH_NGOAITRU_ID, dv.NGUOICAPNHAT_ID, dv.NGAYCAPNHAT,        CASE WHEN Left(B.MANHOMDICHVU,2) = '03' THEN '02' ELSE Left(B.MANHOMDICHVU,2) END AS MANHOMDICHVU, B.MANHOMDICHVU as MANHOMDICHVUCHITIET, tn.TRANGTHAI as TRANGTHAI_TIEPNHAN,        'False' as DAKHAM,        vp.DATHANHTOAN, vp.DONGIA_DOANHTHU, BA.SOBENHAN, dv.CHANDOAN        , a.TENDICHVU, nth.TENPHONGBAN as TENPHONGKHAM, nyc.TENPHONGBAN as TENKHOACHIDINH        , bscd.TENNHANVIEN as TENBACSICHIDINH        , 0 as GUINGOAI        , 0 as VTYT        , 0 as CLSKETQUA_ID                 FROM TT_DVYEUCAU (NOLOCK) dv        inner join TT_TIEPNHAN (NOLOCK) tn on dv.TIEPNHAN_ID = tn.TIEPNHAN_ID        inner join TT_BENHNHAN (NOLOCK) bn on tn.BENHNHAN_ID = bn.BENHNHAN_ID        inner join TM_DICHVU A on A.DICHVU_ID = dv.DICHVU_ID        inner join TM_PHONGBAN nth on nth.PHONGBAN_ID = dv.NOITHUCHIEN_ID        left join TM_NHANVIEN bscd on bscd.NHANVIEN_ID = dv.BACSICHIDINH_ID        inner join TM_PHONGBAN nyc on nyc.PHONGBAN_ID = dv.NOIYEUCAU_ID        inner join TM_NHOMDICHVU B on B.NHOMDICHVU_ID = A.NHOMDICHVU_ID        inner join TT_VIENPHI (NOLOCK) VP on VP.TIEPNHAN_ID = tn.TIEPNHAN_ID and VP.DICHVU_ID = dv.DICHVU_ID and VP.REF_ID = dv.DVYEUCAU_ID        left join TT_NOITRU_BENHAN (NOLOCK) BA on BA.TIEPNHAN_ID = tn.TIEPNHAN_ID AND dv.BENHAN_ID = BA.BENHAN_ID        inner join TM_GENDER GD on GD.ID = bn.GIOITINH                 where        dv.DICHVU_ID IS NOT NULL        and tn.BENHVIEN_ID = 'HLU01'        and HUYYEUCAU = 0        and dv.NGAYHENCLS is NULL                       and dv.TRANGTHAI = 'CHUAKETQUA'           and           dv.NGAYYEUCAU >= '8/14/2019 12:00:00 AM'         and           dv.NGAYYEUCAU <= '8/14/2019 12:00:00 AM'         and           dv.NOITHUCHIEN_ID = 25         and           (CASE WHEN Left(B.MANHOMDICHVU,2) = '03' THEN '02' ELSE Left(B.MANHOMDICHVU,2) END) = '05'         and           tn.TRANGTHAI IN ('DATIEPNHAN','NOITRU','CAPCUU', 'HOANTHANH')         and           (vp.DATHANHTOAN = '1'  or vp.DONGIA_DOANHTHU = '0' OR TN.SUDUNG_BHTN='1' OR TN.BAOLANH_VIENPHI='1'  OR tn.TRANGTHAI IN ('NOITRU','CAPCUU','NGOAITRU') or dv.HOPDONG_BENHNHAN_ID is not null or vp.BENHNHAN_PHAITHANHTOAN >= 0)                 ) data1) lst                    where          lst.ROWNUMBER between 1 and 20                 order by NGAYGIOYEUCAU asc]
2019-08-14 18:06:32,177 [1] DEBUG - Statement Id: [DAO00019_DanhSachPhauThuatThuThuat] PreparedStatement : [declare @TenBenhVien nvarchar(500)        set @TenBenhVien = (select VALUE from TM_SYS_APPSETTINGS where CODE = 'APP_BENHVIEN_TEN')        select * from(        select ROW_NUMBER() OVER(order by NGAYGIOYEUCAU) as ROWNUMBER, *        from        (SELECT distinct        COUNT(*) OVER() as TOTALROWS,        N'Mã người bệnh: ' + bn.MAYTE + ' - ' + N'Tên người bệnh: ' + bn.TENBENHNHAN + ' - ' + N'Số bệnh án: ' + ISNULL(BA.SOBENHAN,'') + ' - ' + N'Sinh ngày: ' + isnull(Convert(varchar(10),bn.NGAYSINH,103),bn.NAMSINH) + ' - ' + N'Giới tính: ' + GD.DESCRIPTION as GROUPNAME,        bn.MAYTE, bn.TENBENHNHAN, bn.NAMSINH, bn.NGAYSINH as TUOI, ISNULL(CONVERT(VARCHAR(10), bn.NGAYSINH, 103),CAST(bn.NAMSINH AS varchar)) as NGAYSINH, bn.DIACHILIENLAC as DIACHI, bn.GIOITINH, GD.DESCRIPTION as TENGIOITINH,        tn.DOITUONG_ID, tn.THOIGIANTIEPNHAN, tn.BENHNHAN_ID, tn.TIEPNHAN_ID, tn.TRAITUYEN, tn.SOTIEPNHAN        , dv.DICHVU_ID, dv.NOITHUCHIEN_ID, isnull(dv.NGAYTAO, dv.NGAYCAPNHAT) as THOIGIANDKDICHVU        , dv.KHAN, dv.NOIYEUCAU_ID, dv.NGAYGIOYEUCAU, dv.BACSICHIDINH_ID, dv.DONVIGIOITHIEU_ID        , dv.NGUOIGIOITHIEU_ID, dv.TRANGTHAI_WFL, tn.NOIGIOITHIEU_ID        , dv.DVYEUCAU_ID, dv.MARIS, dv.TRANGTHAI as TRANGTHAICODE, B.TENNHOMDICHVU, dv.SOPHIEUYEUCAU, dv.KHAMBENH_NGOAITRU_ID, dv.NGUOICAPNHAT_ID, dv.NGAYCAPNHAT,        CASE WHEN Left(B.MANHOMDICHVU,2) = '03' THEN '02' ELSE Left(B.MANHOMDICHVU,2) END AS MANHOMDICHVU, B.MANHOMDICHVU as MANHOMDICHVUCHITIET, tn.TRANGTHAI as TRANGTHAI_TIEPNHAN,        'False' as DAKHAM,        vp.DATHANHTOAN, vp.DONGIA_DOANHTHU, BA.SOBENHAN, dv.CHANDOAN        , a.TENDICHVU, nth.TENPHONGBAN as TENPHONGKHAM, nyc.TENPHONGBAN as TENKHOACHIDINH        , bscd.TENNHANVIEN as TENBACSICHIDINH        , 0 as GUINGOAI        , 0 as VTYT        , 0 as CLSKETQUA_ID                 FROM TT_DVYEUCAU (NOLOCK) dv        inner join TT_TIEPNHAN (NOLOCK) tn on dv.TIEPNHAN_ID = tn.TIEPNHAN_ID        inner join TT_BENHNHAN (NOLOCK) bn on tn.BENHNHAN_ID = bn.BENHNHAN_ID        inner join TM_DICHVU A on A.DICHVU_ID = dv.DICHVU_ID        inner join TM_PHONGBAN nth on nth.PHONGBAN_ID = dv.NOITHUCHIEN_ID        left join TM_NHANVIEN bscd on bscd.NHANVIEN_ID = dv.BACSICHIDINH_ID        inner join TM_PHONGBAN nyc on nyc.PHONGBAN_ID = dv.NOIYEUCAU_ID        inner join TM_NHOMDICHVU B on B.NHOMDICHVU_ID = A.NHOMDICHVU_ID        inner join TT_VIENPHI (NOLOCK) VP on VP.TIEPNHAN_ID = tn.TIEPNHAN_ID and VP.DICHVU_ID = dv.DICHVU_ID and VP.REF_ID = dv.DVYEUCAU_ID        left join TT_NOITRU_BENHAN (NOLOCK) BA on BA.TIEPNHAN_ID = tn.TIEPNHAN_ID AND dv.BENHAN_ID = BA.BENHAN_ID        inner join TM_GENDER GD on GD.ID = bn.GIOITINH                 where        dv.DICHVU_ID IS NOT NULL        and tn.BENHVIEN_ID = 'HLU01'        and HUYYEUCAU = 0        and dv.NGAYHENCLS is NULL                       and dv.TRANGTHAI = 'CHUAKETQUA'           and           dv.NGAYYEUCAU >= '6/1/2019 12:00:00 AM'         and           dv.NGAYYEUCAU <= '8/14/2019 12:00:00 AM'         and           dv.NOITHUCHIEN_ID = 25         and           (CASE WHEN Left(B.MANHOMDICHVU,2) = '03' THEN '02' ELSE Left(B.MANHOMDICHVU,2) END) = '05'         and           tn.TRANGTHAI IN ('DATIEPNHAN','NOITRU','CAPCUU', 'HOANTHANH')         and           (vp.DATHANHTOAN = '1'  or vp.DONGIA_DOANHTHU = '0' OR TN.SUDUNG_BHTN='1' OR TN.BAOLANH_VIENPHI='1'  OR tn.TRANGTHAI IN ('NOITRU','CAPCUU','NGOAITRU') or dv.HOPDONG_BENHNHAN_ID is not null or vp.BENHNHAN_PHAITHANHTOAN >= 0)                 ) data1) lst                    where          lst.ROWNUMBER between 1 and 20                 order by NGAYGIOYEUCAU asc]
2019-08-14 18:06:32,650 [1] DEBUG - Statement Id: [DAO00000_GetNhomDoiTuong] PreparedStatement : [SELECT DOITUONG_ID              ,[TENDOITUONG]              ,[NHOMDICHVU]              ,[TYLE_VUOT_LCB]              ,[GIOIHAN_VUOT_LCB]              ,[GIOIHAN_VUOT_DVKTC]              ,[TYLE_THUOC_UT]              ,[CPVC]              ,[CHIPHINGOAI_BHYT]              ,[NGANSACH_TL]              ,[MIENGIAM_TL]              ,[TAITRO_TL]              ,[BHTN_TL]              FROM [dbo].[TM_DOITUONG]]
2019-08-14 18:06:36,183 [1] DEBUG - Statement Id: [DAO00019_DanhSachPhauThuatThuThuat] PreparedStatement : [declare @TenBenhVien nvarchar(500)        set @TenBenhVien = (select VALUE from TM_SYS_APPSETTINGS where CODE = 'APP_BENHVIEN_TEN')        select * from(        select ROW_NUMBER() OVER(order by NGAYGIOYEUCAU) as ROWNUMBER, *        from        (SELECT distinct        COUNT(*) OVER() as TOTALROWS,        N'Mã người bệnh: ' + bn.MAYTE + ' - ' + N'Tên người bệnh: ' + bn.TENBENHNHAN + ' - ' + N'Số bệnh án: ' + ISNULL(BA.SOBENHAN,'') + ' - ' + N'Sinh ngày: ' + isnull(Convert(varchar(10),bn.NGAYSINH,103),bn.NAMSINH) + ' - ' + N'Giới tính: ' + GD.DESCRIPTION as GROUPNAME,        bn.MAYTE, bn.TENBENHNHAN, bn.NAMSINH, bn.NGAYSINH as TUOI, ISNULL(CONVERT(VARCHAR(10), bn.NGAYSINH, 103),CAST(bn.NAMSINH AS varchar)) as NGAYSINH, bn.DIACHILIENLAC as DIACHI, bn.GIOITINH, GD.DESCRIPTION as TENGIOITINH,        tn.DOITUONG_ID, tn.THOIGIANTIEPNHAN, tn.BENHNHAN_ID, tn.TIEPNHAN_ID, tn.TRAITUYEN, tn.SOTIEPNHAN        , dv.DICHVU_ID, dv.NOITHUCHIEN_ID, isnull(dv.NGAYTAO, dv.NGAYCAPNHAT) as THOIGIANDKDICHVU        , dv.KHAN, dv.NOIYEUCAU_ID, dv.NGAYGIOYEUCAU, dv.BACSICHIDINH_ID, dv.DONVIGIOITHIEU_ID        , dv.NGUOIGIOITHIEU_ID, dv.TRANGTHAI_WFL, tn.NOIGIOITHIEU_ID        , dv.DVYEUCAU_ID, dv.MARIS, dv.TRANGTHAI as TRANGTHAICODE, B.TENNHOMDICHVU, dv.SOPHIEUYEUCAU, dv.KHAMBENH_NGOAITRU_ID, dv.NGUOICAPNHAT_ID, dv.NGAYCAPNHAT,        CASE WHEN Left(B.MANHOMDICHVU,2) = '03' THEN '02' ELSE Left(B.MANHOMDICHVU,2) END AS MANHOMDICHVU, B.MANHOMDICHVU as MANHOMDICHVUCHITIET, tn.TRANGTHAI as TRANGTHAI_TIEPNHAN,        'True' as DAKHAM,        vp.DATHANHTOAN, vp.DONGIA_DOANHTHU, BA.SOBENHAN, dv.CHANDOAN        , a.TENDICHVU, nth.TENPHONGBAN as TENPHONGKHAM, nyc.TENPHONGBAN as TENKHOACHIDINH        , bscd.TENNHANVIEN as TENBACSICHIDINH        , 0 as GUINGOAI        , 0 as VTYT        , 0 as CLSKETQUA_ID          ,             pt.PHAUTHUAT_ID, pt.NGAYTHUCHIEN , pt.THOIGIANKHOADULIEU, pt.NGUOIKHOA_ID            , pt.TENNGUOIKHOA as TENNGUOIDUYET                   FROM TT_DVYEUCAU (NOLOCK) dv        inner join TT_TIEPNHAN (NOLOCK) tn on dv.TIEPNHAN_ID = tn.TIEPNHAN_ID        inner join TT_BENHNHAN (NOLOCK) bn on tn.BENHNHAN_ID = bn.BENHNHAN_ID        inner join TM_DICHVU A on A.DICHVU_ID = dv.DICHVU_ID        inner join TM_PHONGBAN nth on nth.PHONGBAN_ID = dv.NOITHUCHIEN_ID        left join TM_NHANVIEN bscd on bscd.NHANVIEN_ID = dv.BACSICHIDINH_ID        inner join TM_PHONGBAN nyc on nyc.PHONGBAN_ID = dv.NOIYEUCAU_ID        inner join TM_NHOMDICHVU B on B.NHOMDICHVU_ID = A.NHOMDICHVU_ID        inner join TT_VIENPHI (NOLOCK) VP on VP.TIEPNHAN_ID = tn.TIEPNHAN_ID and VP.DICHVU_ID = dv.DICHVU_ID and VP.REF_ID = dv.DVYEUCAU_ID        left join TT_NOITRU_BENHAN (NOLOCK) BA on BA.TIEPNHAN_ID = tn.TIEPNHAN_ID AND dv.BENHAN_ID = BA.BENHAN_ID        inner join TM_GENDER GD on GD.ID = bn.GIOITINH                       inner join TT_PHAUTHUAT_YEUCAU (NOLOCK) ptyc on ptyc.DVYEUCAU_ID = dv.DVYEUCAU_ID            inner join TT_PHAUTHUAT (NOLOCK) pt on pt.PHAUTHUAT_ID = ptyc.PHAUTHUAT_ID            left join TM_PHONGBAN pt_pb on pt_pb.PHONGBAN_ID = pt.PHONGBANTHUCHIEN_ID                   where        dv.DICHVU_ID IS NOT NULL        and tn.BENHVIEN_ID = 'HLU01'        and HUYYEUCAU = 0        and dv.NGAYHENCLS is NULL                       and dv.TRANGTHAI IN ('CHOXACNHAN','HOANTAT')           and           dv.NGAYYEUCAU >= '6/1/2019 12:00:00 AM'         and           dv.NGAYYEUCAU <= '8/14/2019 12:00:00 AM'         and           dv.NOITHUCHIEN_ID = 25         and           (CASE WHEN Left(B.MANHOMDICHVU,2) = '03' THEN '02' ELSE Left(B.MANHOMDICHVU,2) END) = '05'         and           tn.TRANGTHAI IN ('DATIEPNHAN','NOITRU','CAPCUU', 'HOANTHANH')         and           (vp.DATHANHTOAN = '1'  or vp.DONGIA_DOANHTHU = '0' OR TN.SUDUNG_BHTN='1' OR TN.BAOLANH_VIENPHI='1'  OR tn.TRANGTHAI IN ('NOITRU','CAPCUU','NGOAITRU') or dv.HOPDONG_BENHNHAN_ID is not null or vp.BENHNHAN_PHAITHANHTOAN >= 0)                 ) data1) lst                    where          lst.ROWNUMBER between 1 and 20                 order by NGAYGIOYEUCAU asc]
2019-08-14 18:06:42,367 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'ORM04'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2019-08-14 18:06:42,837 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'ORM05'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2019-08-14 18:06:43,542 [1] DEBUG - Statement Id: [DAO00019_ThongTinBenhNhanTiepNhan] PreparedStatement : [select distinct A.SOTIEPNHAN, A.TIEPNHAN_ID, A.DOITUONG_ID, A.TRANGTHAI,        A.LOAITHANHVIEN_ID, A.SUDUNG_BHTN, A.THE_ID, A.THANHVIEN_ID, A.VIP, A.NGUON_BENHNHAN_ID, A.BAOLANH_VIENPHI,        B.*, A.SOBHYT        from TT_TIEPNHAN A        inner join TT_BENHNHAN B on B.BENHNHAN_ID = A.BENHNHAN_ID and B.ACTIVE = '1'        where                    A.TIEPNHAN_ID = '24854'                 and A.BENHVIEN_ID = 'HLU01']
2019-08-14 18:06:43,851 [1] DEBUG - Statement Id: [DAO00048_TT_PHAUTHUAT_GetList] PreparedStatement : [select *              from TT_PHAUTHUAT               where                             TT_PHAUTHUAT.LOAI = 'P'                       and                           TT_PHAUTHUAT.TIEPNHAN_ID = 24854                       and                           TT_PHAUTHUAT.BENHVIEN_ID = 'HLU01'                                     order by PHAUTHUAT_ID DESC]
2019-08-14 18:06:43,948 [1] DEBUG - Statement Id: [DAO00066_GetBENHAN_TIEPNHAN] PreparedStatement : [select top 1 *        from TT_NOITRU_BENHAN        where TIEPNHAN_ID = '24854'  and BENHVIEN_ID = 'HLU01'        order by NGAYTAO desc]
2019-08-14 18:06:44,120 [1] DEBUG - Statement Id: [DAO00048_GetBenhNhanByBenhNhanID] PreparedStatement : [SELECT *              FROM              TT_BENHNHAN               where                             BENHNHAN_ID = '21398']
2019-08-14 18:06:44,161 [1] DEBUG - Statement Id: [DAO00000_GetDoiTuongIsBHYT] PreparedStatement : [select * from TM_DOITUONG Where DOITUONG_ID = 6 and MADOITUONG like '%BHYT%']
2019-08-14 18:06:44,884 [1] DEBUG - Statement Id: [DAO00048_GetDICHVUYCByTiepNhanID] PreparedStatement : [SELECT DISTINCT D.HOPDONG_ID, D.HOPDONG_BENHNHAN_ID, D.DVYEUCAU_ID, D.DICHVU_ID, D.SOPHIEUYEUCAU, D.NGAYGIOYEUCAU, D.NOITHUCHIEN_ID, P.LOAIPHAUTHUAT, L.STT AS STT_LOAIPHAUTHUAT            FROM            TT_DVYEUCAU AS D            left join TM_PHANLOAIPHAUTHUAT AS P ON D.DICHVU_ID = P.DICHVU_ID            left join TM_LOAIPHAUTHUAT AS L ON L.LOAIPHAUTHUAT = P.LOAIPHAUTHUAT            where            not exists (select DVYEUCAU_ID from TT_PHAUTHUAT_YEUCAU where D.DVYEUCAU_ID = DVYEUCAU_ID)               and                       exists (select DICHVU_ID from TM_DICHVU                      where D.DICHVU_ID = DICHVU_ID and                      exists (select NHOMDICHVU_ID from TM_NHOMDICHVU where TM_DICHVU.NHOMDICHVU_ID = NHOMDICHVU_ID and left(MANHOMDICHVU,2) in (05) ))                     and                           D.TIEPNHAN_ID = '24854']
2019-08-14 18:06:45,731 [1] DEBUG - Statement Id: [DAO00066_GetBENHAN_TIEPNHAN] PreparedStatement : [select top 1 *        from TT_NOITRU_BENHAN        where TIEPNHAN_ID = '24854'  and BENHVIEN_ID = 'HLU01'        order by NGAYTAO desc]
2019-08-14 18:06:50,175 [1] DEBUG - Statement Id: [DAO00048_TT_PHAUTHUAT_GetDetail] PreparedStatement : [select PT.*, TN.BENHNHAN_ID              from              TT_PHAUTHUAT PT, TT_TIEPNHAN TN              where              PT.TIEPNHAN_ID = TN.TIEPNHAN_ID              AND PHAUTHUAT_ID  = 3589]
2019-08-14 18:06:50,427 [1] DEBUG - Statement Id: [DAO00048_CheckDVPhauThuatBHYT] PreparedStatement : [select count(0) from TT_VIENPHI          where REF_TABLE = 'TT_DVYEUCAU' and REF_ID = (select top 1 DVYEUCAU_ID from TT_PHAUTHUAT_YEUCAU where PHAUTHUAT_ID =  @param0 )          and TIEPNHAN_ID =  @param1  and BHYT_DONGIA > 0]
2019-08-14 18:06:50,427 [1] DEBUG - Statement Id: [DAO00048_CheckDVPhauThuatBHYT] Parameters: [@param0=[PHAUTHUAT_ID,3589], @param1=[TIEPNHAN_ID,24854]]
2019-08-14 18:06:50,427 [1] DEBUG - Statement Id: [DAO00048_CheckDVPhauThuatBHYT] Types: [@param0=[Int64, System.Int64], @param1=[Int64, System.Int64]]
2019-08-14 18:06:50,537 [1] DEBUG - Statement Id: [DAO00116_File_GetList] PreparedStatement : [select *              from TT_FILE_DINHKEM               where                             TT_FILE_DINHKEM.REF_TABLE = 'TT_PHAUTHUAT'                       and                           TT_FILE_DINHKEM.REF_ID = '3589'                       and                           TT_FILE_DINHKEM.BENHVIEN_ID = 'HLU01'                                     order by FILE_ID]
2019-08-14 18:06:50,693 [1] DEBUG - Statement Id: [DAO00048_TT_PHAUTHUAT_YEUCAU_GetList] PreparedStatement : [SELECT YC.[PHAUTHUAT_YEUCAU_ID]              ,YC.[PHAUTHUAT_ID]              ,YC.[DVYEUCAU_ID]              ,YC.[NHOMDICHVU_ID]              ,YC.[DICHVU_ID]              ,YC.[LOAIGIA_ID]              ,VP.[BHYT_THANHTIEN_CHITRA]              ,VP.[BENHNHAN_PHAITHANHTOAN]              ,VP.[THANHTIEN_DOANHTHU]              ,YC.[BENHVIEN_ID]              FROM [TT_PHAUTHUAT_YEUCAU] YC              INNER JOIN TT_VIENPHI VP ON YC.DVYEUCAU_ID= VP.REF_ID AND VP.REF_TABLE ='TT_DVYEUCAU'               where                             YC.PHAUTHUAT_ID = '3589'                       and                           YC.BENHVIEN_ID = 'HLU01'                                     order by PHAUTHUAT_YEUCAU_ID]
2019-08-14 18:06:50,818 [1] DEBUG - Statement Id: [DAO00048_TT_PHAUTHUAT_PPVOCAM_GetDetail] PreparedStatement : [select *              from TT_PHAUTHUAT_PPVOCAM              where PHAUTHUAT_ID  = 3589]
2019-08-14 18:06:51,043 [1] DEBUG - Statement Id: [DAO00048_TT_PHAUTHUAT_GetDetail] PreparedStatement : [select PT.*, TN.BENHNHAN_ID              from              TT_PHAUTHUAT PT, TT_TIEPNHAN TN              where              PT.TIEPNHAN_ID = TN.TIEPNHAN_ID              AND PHAUTHUAT_ID  = 3589]
2019-08-14 18:06:51,091 [1] DEBUG - Statement Id: [DAO00048_CheckDVPhauThuatBHYT] PreparedStatement : [select count(0) from TT_VIENPHI          where REF_TABLE = 'TT_DVYEUCAU' and REF_ID = (select top 1 DVYEUCAU_ID from TT_PHAUTHUAT_YEUCAU where PHAUTHUAT_ID =  @param0 )          and TIEPNHAN_ID =  @param1  and BHYT_DONGIA > 0]
2019-08-14 18:06:51,091 [1] DEBUG - Statement Id: [DAO00048_CheckDVPhauThuatBHYT] Parameters: [@param0=[PHAUTHUAT_ID,3589], @param1=[TIEPNHAN_ID,24854]]
2019-08-14 18:06:51,091 [1] DEBUG - Statement Id: [DAO00048_CheckDVPhauThuatBHYT] Types: [@param0=[Int64, System.Int64], @param1=[Int64, System.Int64]]
2019-08-14 18:06:51,139 [1] DEBUG - Statement Id: [DAO00116_File_GetList] PreparedStatement : [select *              from TT_FILE_DINHKEM               where                             TT_FILE_DINHKEM.REF_TABLE = 'TT_PHAUTHUAT'                       and                           TT_FILE_DINHKEM.REF_ID = '3589'                       and                           TT_FILE_DINHKEM.BENHVIEN_ID = 'HLU01'                                     order by FILE_ID]
2019-08-14 18:06:51,211 [1] DEBUG - Statement Id: [DAO00048_TT_PHAUTHUAT_YEUCAU_GetList] PreparedStatement : [SELECT YC.[PHAUTHUAT_YEUCAU_ID]              ,YC.[PHAUTHUAT_ID]              ,YC.[DVYEUCAU_ID]              ,YC.[NHOMDICHVU_ID]              ,YC.[DICHVU_ID]              ,YC.[LOAIGIA_ID]              ,VP.[BHYT_THANHTIEN_CHITRA]              ,VP.[BENHNHAN_PHAITHANHTOAN]              ,VP.[THANHTIEN_DOANHTHU]              ,YC.[BENHVIEN_ID]              FROM [TT_PHAUTHUAT_YEUCAU] YC              INNER JOIN TT_VIENPHI VP ON YC.DVYEUCAU_ID= VP.REF_ID AND VP.REF_TABLE ='TT_DVYEUCAU'               where                             YC.PHAUTHUAT_ID = '3589'                       and                           YC.BENHVIEN_ID = 'HLU01'                                     order by PHAUTHUAT_YEUCAU_ID]
2019-08-14 18:06:51,308 [1] DEBUG - Statement Id: [DAO00048_TT_PHAUTHUAT_PPVOCAM_GetDetail] PreparedStatement : [select *              from TT_PHAUTHUAT_PPVOCAM              where PHAUTHUAT_ID  = 3589]
2019-08-14 18:06:53,028 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'ORM08'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2019-08-14 18:06:53,493 [1] DEBUG - Statement Id: [DAO00063_GetListKhoThuocPhongBanPhamvi] PreparedStatement : [select distinct dpv.*        from TM_DUOC_PHAMVISD_MAPPING dmap        left join TM_DUOC_PHAMVISUDUNG dpv on dpv.PHAMVI_ID = dmap.PHAMVI_ID        where dmap.KHODUOC_ID in (select KHODUOC_ID from TM_PHONGBAN_KHODUOC where PHONGBAN_ID = '25')]
2019-08-14 18:06:53,590 [1] DEBUG - Statement Id: [DAO00051_GetTemplateDuoc] PreparedStatement : [select *              from TM_TEMPLATEDUOC               where                             NGUOITAO_ID = '1'                       and                           KHOATAO_ID = '25'                                     ORDER BY TENTEMPLATE]
2019-08-14 18:06:53,641 [1] DEBUG - Statement Id: [DAO00048_TT_VIENPHI_GetList] PreparedStatement : [select *              from TT_VIENPHI               where                             TT_VIENPHI.TIEPNHAN_ID = '24854'                       and                           TT_VIENPHI.BENHAN_ID = '5289'                       and                           TT_VIENPHI.BENHVIEN_ID = 'HLU01'                       and                           TT_VIENPHI.NGUOITAO_ID = '576'                       and                           TT_VIENPHI.NGAYTAO = '6/1/2019 10:19:18 AM'                       and                           TT_VIENPHI.NGUOICAPNHAT_ID = '576'                       and                           TT_VIENPHI.NGAYCAPNHAT = '6/1/2019 10:21:18 AM'                                     order by VIENPHI_ID]
2019-08-14 18:06:54,128 [1] DEBUG - Statement Id: [DAO00048_GetPhauThuat_VTYT_ByPhauThuatID] PreparedStatement : [SELECT            VTYT.PHAUTHUAT_VTYT_ID,            VTYT.PHAUTHUAT_ID,            VTYT.NGAYSUDUNG,            VTYT.TRANGTHAI_XEM,            VTYT.NGUONGOCDULIEU,            VTYT.NGUOITAO_ID,            VTYT.NGAYTAO,            VTYT.DUOC_ID,            VP.SOLUONG,            VTYT.PHAMVI_ID,            VTYT.KHOSUDUNG_ID AS KHODUOC_ID,            VTYT.CHUNGTU_ID,            VTYT.CHUNGTUTONGHOP_ID,            VTYT.NGUONHANG_ID,            VTYT.TINHTIEN,            VTYT.BNTUCHITRA,            VTYT.KHOTAO_ID,            VTYT.COSO,            VTYT.GHICHU,            VP.DONGIA_DOANHTHU,            VP.THANHTIEN_DOANHTHU,            vp.BHYT_DONGIA,            VP.BHYT_THANHTIEN,            CT.MACHUNGTU AS SOPHIEUXUAT,            PL.MACHUNGTU AS SOPHIEULINH            FROM            TT_PHAUTHUAT_VTYT VTYT            left join TT_PHAUTHUAT  PT on PT.PHAUTHUAT_ID = VTYT.PHAUTHUAT_ID            left join TT_VIENPHI VP  on VTYT.PHAUTHUAT_VTYT_ID = VP.REF_ID and VP.REF_TABLE = 'TT_PHAUTHUAT_VTYT'            left join TT_DUOC_CHUNGTU CT on VTYT.CHUNGTU_ID = CT.CHUNGTU_ID            left join TT_DUOC_PHIEULINH PL on VTYT.CHUNGTUTONGHOP_ID = PL.CHUNGTU_ID            WHERE            PT.PHAUTHUAT_ID =  '3589']
2019-08-14 18:06:54,178 [1] DEBUG - Statement Id: [DAO00063_GetListPhamviTuKhoThuocVaPhongBan] PreparedStatement : [select distinct dpv.*, dmap.KHODUOC_ID        from TM_DUOC_PHAMVISD_MAPPING dmap        left join TM_DUOC_PHAMVISUDUNG dpv on dpv.PHAMVI_ID = dmap.PHAMVI_ID and dpv.TAMNGUNG != '1'        where dmap.KHODUOC_ID in (select KHODUOC_ID from TM_PHONGBAN_KHODUOC where PHONGBAN_ID = '25')        and dmap.KHODUOC_ID = '29' and dpv.MAPHAMVI is not null]
2019-08-14 18:07:01,430 [1] DEBUG - Statement Id: [DAO00000_GetCHECK_DOITUONG_BHYT] PreparedStatement : [select count(*) as DOITUONG_BHYT FROM TM_DOITUONG A            WHERE A.DOITUONG_ID = '6' and A.BENHVIEN_ID = 'HLU01' and MADOITUONG like '%BHYT%']
2019-08-14 18:07:01,565 [1] DEBUG - Statement Id: [DAO00000_GetLOAIGIATHUOC_NOI_NGOAI_VIEN] PreparedStatement : [SELECT LOAIGIA_ID              FROM TM_LOAIGIA              WHERE MALOAIGIA = 'GiaThuoc_NoiVien' and BENHVIEN_ID = 'HLU01']
2019-08-14 18:07:01,627 [1] DEBUG - Statement Id: [DAO00087_GetServiceParams] PreparedStatement : [select CODE, VALUE              from TM_SYS_APPSETTINGS              where LOCKED = '0' and BENHVIEN_ID = 'HLU01']
2019-08-14 18:07:01,766 [1] DEBUG - Statement Id: [DAO00000_GetDUOC_DONGIADOANHTHU_NOIVIEN] PreparedStatement : [declare @doanhthu numeric(24,2);          declare @hotro numeric(24,2);          select top 1 @doanhthu = dg.DONGIA           from TM_DUOC_DONGIA dg          left join TM_DOITUONG_LOAIGIA dtlg on dtlg.LOAIGIA_ID = dg.LOAIGIA_ID                     where dg.DUOC_ID = '3' and dtlg.DOITUONG_ID = '6' and dg.DONGIA is not null and dg.DONGIA > 0                      order by dtlg.DOUUTIEN asc           select top 1 @hotro = dg.DONGIA           from TM_DUOC_DONGIA dg          left join TM_DOITUONG_LOAIGIA dtlg on dtlg.LOAIGIA_ID = dg.LOAIGIA_ID                     where dg.DUOC_ID = '3' and dtlg.DOITUONG_ID = '6' and dg.DONGIA is not null and dg.DONGIA > 0  and GIAHOTRO = '1'                     order by dtlg.DOUUTIEN asc              select ISNULL(@doanhthu,0.0) DONGIA_DOANHTHU, ISNULL(@hotro, 0.0) DONGIA_KHAC]
2019-08-14 18:07:01,835 [1] DEBUG - Statement Id: [DAO00000_GetDuocBHYT] PreparedStatement : [select count(*) BHYT FROM TM_DUOC A WHERE A.DUOC_ID = '3' and BHYT = '1']
2019-08-14 18:07:02,002 [1] DEBUG - Statement Id: [DAO00000_GetCHECK_DOITUONG_BHYT] PreparedStatement : [select count(*) as DOITUONG_BHYT FROM TM_DOITUONG A            WHERE A.DOITUONG_ID = '6' and A.BENHVIEN_ID = 'HLU01' and MADOITUONG like '%BHYT%']
2019-08-14 18:07:02,127 [1] DEBUG - Statement Id: [DAO00000_GetLOAIGIATHUOC_NOI_NGOAI_VIEN] PreparedStatement : [SELECT LOAIGIA_ID              FROM TM_LOAIGIA              WHERE MALOAIGIA = 'GiaThuoc_NoiVien' and BENHVIEN_ID = 'HLU01']
2019-08-14 18:07:02,200 [1] DEBUG - Statement Id: [DAO00000_GetDUOC_DONGIADOANHTHU_NOIVIEN] PreparedStatement : [declare @doanhthu numeric(24,2);          declare @hotro numeric(24,2);          select top 1 @doanhthu = dg.DONGIA           from TM_DUOC_DONGIA dg          left join TM_DOITUONG_LOAIGIA dtlg on dtlg.LOAIGIA_ID = dg.LOAIGIA_ID                     where dg.DUOC_ID = '3' and dtlg.DOITUONG_ID = '6' and dg.DONGIA is not null and dg.DONGIA > 0                      order by dtlg.DOUUTIEN asc           select top 1 @hotro = dg.DONGIA           from TM_DUOC_DONGIA dg          left join TM_DOITUONG_LOAIGIA dtlg on dtlg.LOAIGIA_ID = dg.LOAIGIA_ID                     where dg.DUOC_ID = '3' and dtlg.DOITUONG_ID = '6' and dg.DONGIA is not null and dg.DONGIA > 0  and GIAHOTRO = '1'                     order by dtlg.DOUUTIEN asc              select ISNULL(@doanhthu,0.0) DONGIA_DOANHTHU, ISNULL(@hotro, 0.0) DONGIA_KHAC]
2019-08-14 18:07:02,339 [1] DEBUG - Statement Id: [DAO00000_GetDuocBHYT] PreparedStatement : [select count(*) BHYT FROM TM_DUOC A WHERE A.DUOC_ID = '3' and BHYT = '1']
2019-08-14 18:07:04,968 [1] DEBUG - Statement Id: [DAO00066_GetBENHAN_TIEPNHAN] PreparedStatement : [select top 1 *        from TT_NOITRU_BENHAN        where TIEPNHAN_ID = '24854'  and BENHVIEN_ID = 'HLU01'        order by NGAYTAO desc]
2019-08-14 18:07:05,086 [1] DEBUG - Statement Id: [DAO00014_GetInPatientStatus] PreparedStatement : [select TRANGTHAI, isnull(KHOACHUYENDEN_ID, KHOAVAO_ID) as KHOAHIENTAI from TT_NOITRU_BENHAN        where        TIEPNHAN_ID = '24854'        and BENHVIEN_ID = 'HLU01'         and           BENHAN_ID = '5289']
2019-08-14 18:07:05,272 [1] DEBUG - Statement Id: [DAO00014_GetORMServiceStatus] PreparedStatement : [select dvyc.TRANGTHAI, pt.NGUOIKHOA_ID, pt.NGUOITAO_ID        from TT_PHAUTHUAT pt        left join TT_PHAUTHUAT_YEUCAU ptyc on ptyc.PHAUTHUAT_ID = pt.PHAUTHUAT_ID        left join (select * from TT_DVYEUCAU where exists (select DVYEUCAU_ID from TT_PHAUTHUAT where TT_DVYEUCAU.DVYEUCAU_ID = DVYEUCAU_ID and PHAUTHUAT_ID = '3589')) dvyc        on ptyc.DVYEUCAU_ID = dvyc.DVYEUCAU_ID        where pt.PHAUTHUAT_ID = '3589']
2019-08-14 18:07:05,526 [1] DEBUG - Statement Id: [DAO00066_GetBENHAN_TIEPNHAN] PreparedStatement : [select top 1 *        from TT_NOITRU_BENHAN        where TIEPNHAN_ID = '24854'  and BENHVIEN_ID = 'HLU01'        order by NGAYTAO desc]
2019-08-14 18:07:05,666 [1] DEBUG - Statement Id: [DAO00014_GetInPatientStatus] PreparedStatement : [select TRANGTHAI, isnull(KHOACHUYENDEN_ID, KHOAVAO_ID) as KHOAHIENTAI from TT_NOITRU_BENHAN        where        TIEPNHAN_ID = '24854'        and BENHVIEN_ID = 'HLU01'         and           BENHAN_ID = '5289']
2019-08-14 18:07:29,080 [1] DEBUG - Statement Id: [DAO00063_KiemtraSoluongDuocXuatNgoaitru] PreparedStatement : [select A.TONKHO, isnull(B.BOOK_NGOAI,0) BOOK_NGOAI, isnull(D.BOOK_NOI,0) BOOK_NOI,  (A.TONKHO - isnull(B.BOOK_NGOAI,0) - isnull(D.BOOK_NOI,0)) TONKHO_BOOK        from(        select SUM(tk.SOLUONG) TONKHO, tk.DUOC_ID, sd.PHAMVI_ID, tk.NGUONDUOC_ID from TT_DUOC_TONKHO tk        inner join TM_DUOC_PHAMVISD_MAPPING sd on sd.KHODUOC_ID = tk.KHODUOC_ID        where sd.PHAMVI_ID  = '1052' and tk.DUOC_ID = '3' and tk.NGUONDUOC_ID = '1'        group by tk.DUOC_ID, sd.PHAMVI_ID, tk.NGUONDUOC_ID) A        left join (        select SUM(SOLUONG) BOOK_NGOAI,DUOC_ID, PHAMVI_ID, NGUONHANG_ID from TT_DUOC_TONKHO_BOOK_NGOAITRU        where PHAMVI_ID  = '1052' and DUOC_ID = '3' and NGUONHANG_ID = '1' and TRANGTHAI = 'HIEULUC' and SOLUONG > 0        group by DUOC_ID, PHAMVI_ID, NGUONHANG_ID) B on A.DUOC_ID = B.DUOC_ID and A.PHAMVI_ID = B.PHAMVI_ID and A.NGUONDUOC_ID = B.NGUONHANG_ID        left join (        select SUM(SOLUONG) BOOK_NOI,DUOC_ID, PHAMVI_ID, NGUONHANG_ID from TT_DUOC_TONKHO_BOOK_NOITRU        where PHAMVI_ID  = '1052' and DUOC_ID = '3' and NGUONHANG_ID = '1' and TRANGTHAI = 'HIEULUC'  and SOLUONG > 0        group by DUOC_ID, PHAMVI_ID, NGUONHANG_ID) D on A.DUOC_ID = D.DUOC_ID and A.PHAMVI_ID = D.PHAMVI_ID and A.NGUONDUOC_ID = D.NGUONHANG_ID]
2019-08-14 18:07:29,206 [1] DEBUG - Statement Id: [DAO00048_TT_PHAUTHUAT_Update] PreparedStatement : [update TT_PHAUTHUAT set              SOPHIEUPHAUTHUAT =  @param0               , LOAI =  @param1               , BENHAN_ID =  @param2               , LUUTRU_ID =  @param3               , TIEPNHAN_ID =  @param4               , PHONGBANTHUCHIEN_ID =  @param5               , NGAYTHUCHIEN =  @param6               , THOIGIANBATDAU =  @param7               , THOIGIANKETTHUC =  @param8               , ICD_VAOKHOA =  @param9               , ICD_VAOKHOA_MOTA =  @param10               , ICD_TRUOCPHAUTHUAT =  @param11               , ICD_TRUOCPHAUTHUAT_MOTA =  @param12               , ICD_SAUPHAUTHUAT =  @param13               , ICD_SAUPHAUTHUAT_MOTA =  @param14               , NHOMDICHVU_ID =  @param15               , DICHVU_ID =  @param16               , PHUONGPHAPVOCAM_ID =  @param17               , TAIBIEN_ID =  @param18               , CHEDO_ID =  @param19               , TUVONG_ID =  @param20               , TRINHTUTHUCHIEN =  @param21               , MOTA =  @param22               , KETQUA =  @param23               , BENHNHANBENNGOAI =  @param24               , NGUONBENH_ID =  @param25               , LOAIPHAUTHUAT =  @param26               , DANLUU =  @param27               , NGAYRUT =  @param28               , NGAYCATCHI =  @param29               , KHAC =  @param30               , SOLANMOLAI =  @param31               , LYDOMOLAI =  @param32               , CANTHIEPPHAUTHUAT =  @param33               , TUDIENKETQUA_ID =  @param34               , PHONGBANCHIDINH_ID =  @param35               , PPMO_ID =  @param36               , THOIGIANGAYME =  @param37               , KHOADULIEU =  @param38               , NGUOIKHOA_ID =  @param39               , TENNGUOIKHOA =  @param40               , NGAYKHOADULIEU =  @param41               , THOIGIANKHOADULIEU =  @param42                            , NGAYCAPNHAT =  @param43             , NGUOICAPNHAT_ID =  @param44             , BENHVIEN_ID =  @param45              ,               PHUONGPHAPPTTT =  @param46                            where              PHAUTHUAT_ID = 3589]
2019-08-14 18:07:29,207 [1] DEBUG - Statement Id: [DAO00048_TT_PHAUTHUAT_Update] Parameters: [@param0=[SOPHIEUPHAUTHUAT,19.P.03763], @param1=[LOAI,P], @param2=[BENHAN_ID,5289], @param3=[LUUTRU_ID,null], @param4=[TIEPNHAN_ID,24854], @param5=[PHONGBANTHUCHIEN_ID,25], @param6=[NGAYTHUCHIEN,8/14/2019 6:07:29 PM], @param7=[THOIGIANBATDAU,6/1/2019 8:30:00 AM], @param8=[THOIGIANKETTHUC,6/1/2019 10:00:00 AM], @param9=[ICD_VAOKHOA,null], @param10=[ICD_VAOKHOA_MOTA,u phì đại tiền liệt tuyến], @param11=[ICD_TRUOCPHAUTHUAT,null], @param12=[ICD_TRUOCPHAUTHUAT_MOTA,u phì đại tiền liệt tuyến], @param13=[ICD_SAUPHAUTHUAT,null], @param14=[ICD_SAUPHAUTHUAT_MOTA,u phì đại tiền liệt tuyến], @param15=[NHOMDICHVU_ID,null], @param16=[DICHVU_ID,null], @param17=[PHUONGPHAPVOCAM_ID,null], @param18=[TAIBIEN_ID,null], @param19=[CHEDO_ID,768], @param20=[TUVONG_ID,null], @param21=[TRINHTUTHUCHIEN,<body>
	<p style="text-align:left;text-indent:0pt;margin:0pt 0pt 0pt 0pt;"><span style="color:#000000;background-color:transparent;font-family:Arial;font-size:14pt;font-weight:normal;font-style:normal;">Tts, nằm tư thế sản khoa.</span></p><p style="text-align:left;text-indent:0pt;margin:0pt 0pt 0pt 0pt;"><span style="color:#000000;background-color:transparent;font-family:Arial;font-size:14pt;font-weight:normal;font-style:normal;">Soi b&agrave;ng quang 2 lỗ niệu quản r&otilde;, b&agrave;ng quang chống đối.</span></p><p style="text-align:left;text-indent:0pt;margin:0pt 0pt 0pt 0pt;"><span style="color:#000000;background-color:transparent;font-family:Arial;font-size:14pt;font-weight:normal;font-style:normal;">Cắt tiền liệt tuyến s&aacute;t vỏ từ cổ b&agrave;ng quang đến ụ n&uacute;i, đốt cầm m&aacute;u.</span></p><p style="text-align:left;text-indent:0pt;margin:0pt 0pt 0pt 0pt;"><span style="color:#000000;background-color:transparent;font-family:Arial;font-size:14pt;font-weight:normal;font-style:normal;">S&uacute;c rửa sạch b&agrave;ng quang</span></p><p style="text-align:left;text-indent:0pt;margin:0pt 0pt 0pt 0pt;"><span style="color:#000000;background-color:transparent;font-family:Arial;font-size:14pt;font-weight:normal;font-style:normal;">Đặt foley 3 chạc rửa li&ecirc;n tục bằng Na 0,9%</span></p><p style="text-align:left;text-indent:0pt;margin:0pt 0pt 0pt 0pt;"><span style="color:#000000;background-color:transparent;font-family:Arial;font-size:14pt;font-weight:normal;font-style:normal;">Giải phẫu bệnh.</span></p><p style="text-align:left;text-indent:0pt;margin:0pt 0pt 0pt 0pt;"><span style="color:#000000;background-color:transparent;font-family:Arial;font-size:14pt;font-weight:normal;font-style:normal;">Kết th&uacute;c</span></p><p style="text-align:left;text-indent:0pt;margin:0pt 0pt 0pt 0pt;"><span style="color:#000000;background-color:transparent;font-family:Arial;font-size:14pt;font-weight:normal;font-style:normal;">&nbsp;</span></p><p style="text-align:left;text-indent:0pt;margin:0pt 0pt 0pt 0pt;"><span style="color:#000000;background-color:transparent;font-family:Times New Roman;font-size:14pt;font-weight:normal;font-style:normal;">&nbsp;</span></p><p style="text-align:left;text-indent:0pt;margin:0pt 0pt 0pt 0pt;"><span style="color:#000000;background-color:transparent;font-family:Times New Roman;font-size:12pt;font-weight:normal;font-style:normal;">&nbsp;</span></p><p style="text-align:left;text-indent:0pt;margin:0pt 0pt 0pt 0pt;"><span style="color:#000000;background-color:transparent;font-family:Times New Roman;font-size:12pt;font-weight:normal;font-style:normal;">&nbsp;</span></p></body>
], @param22=[MOTA,null], @param23=[KETQUA,null], @param24=[BENHNHANBENNGOAI,null], @param25=[NGUONBENH_ID,745], @param26=[LOAIPHAUTHUAT,PTM], @param27=[DANLUU,null], @param28=[NGAYRUT,null], @param29=[NGAYCATCHI,null], @param30=[KHAC,null], @param31=[SOLANMOLAI,null], @param32=[LYDOMOLAI,null], @param33=[CANTHIEPPHAUTHUAT,ptns cắt toàn bộ tiền liệt tuyến], @param34=[TUDIENKETQUA_ID,null], @param35=[PHONGBANCHIDINH_ID,null], @param36=[PPMO_ID,null], @param37=[THOIGIANGAYME,null], @param38=[KHOADULIEU,1], @param39=[NGUOIKHOA_ID,576], @param40=[TENNGUOIKHOA,Nguyễn Văn Kiên], @param41=[NGAYKHOADULIEU,6/1/2019 10:21:00 AM], @param42=[THOIGIANKHOADULIEU,6/1/2019 10:21:22 AM], @param43=[NGAYCAPNHAT,8/14/2019 6:07:29 PM], @param44=[NGUOICAPNHAT_ID,1], @param45=[BENHVIEN_ID,HLU01], @param46=[PHUONGPHAPPTTT,null]]
2019-08-14 18:07:29,207 [1] DEBUG - Statement Id: [DAO00048_TT_PHAUTHUAT_Update] Types: [@param0=[String, System.String], @param1=[String, System.String], @param2=[Int64, System.Int64], @param3=[System.DBNull, null], @param4=[Int64, System.Int64], @param5=[Int64, System.Int64], @param6=[DateTime, System.DateTime], @param7=[DateTime, System.DateTime], @param8=[DateTime, System.DateTime], @param9=[System.DBNull, null], @param10=[String, System.String], @param11=[System.DBNull, null], @param12=[String, System.String], @param13=[System.DBNull, null], @param14=[String, System.String], @param15=[System.DBNull, null], @param16=[System.DBNull, null], @param17=[System.DBNull, null], @param18=[System.DBNull, null], @param19=[Int64, System.Int64], @param20=[System.DBNull, null], @param21=[String, System.String], @param22=[System.DBNull, null], @param23=[System.DBNull, null], @param24=[System.DBNull, null], @param25=[Int64, System.Int64], @param26=[String, System.String], @param27=[System.DBNull, null], @param28=[System.DBNull, null], @param29=[System.DBNull, null], @param30=[System.DBNull, null], @param31=[System.DBNull, null], @param32=[System.DBNull, null], @param33=[String, System.String], @param34=[System.DBNull, null], @param35=[System.DBNull, null], @param36=[System.DBNull, null], @param37=[System.DBNull, null], @param38=[String, System.String], @param39=[Int64, System.Int64], @param40=[String, System.String], @param41=[DateTime, System.DateTime], @param42=[DateTime, System.DateTime], @param43=[DateTime, System.DateTime], @param44=[Int64, System.Int64], @param45=[String, System.String], @param46=[System.DBNull, null]]
2019-08-14 18:07:29,330 [1] DEBUG - Statement Id: [DAO00048_TT_PHAUTHUAT_YEUCAU_DeleteP] PreparedStatement : [delete from TT_PHAUTHUAT_YEUCAU             where                     TT_PHAUTHUAT_YEUCAU.PHAUTHUAT_ID = '3589']
2019-08-14 18:07:29,388 [1] DEBUG - Statement Id: [DAO00048_TT_PHAUTHUAT_PPVOCAM_DeleteP] PreparedStatement : [delete from TT_PHAUTHUAT_PPVOCAM              where PHAUTHUAT_ID = '3589']
2019-08-14 18:07:29,449 [1] DEBUG - Statement Id: [DAO00048_TT_PHAUTHUAT_YEUCAU_Add] PreparedStatement : [insert into TT_PHAUTHUAT_YEUCAU (              PHAUTHUAT_ID              , DVYEUCAU_ID              , NHOMDICHVU_ID              , DICHVU_ID              , LOAIGIA_ID              , THANHTIEN_DOANHTHU              , BHYT_THANHTIEN_CHITRA              , BENHNHAN_PHAITHANHTOAN              , BENHVIEN_ID              ) values (               @param0               ,  @param1               ,  @param2               ,  @param3               ,  @param4               ,  @param5               ,  @param6               ,  @param7               ,  @param8               )]
2019-08-14 18:07:29,450 [1] DEBUG - Statement Id: [DAO00048_TT_PHAUTHUAT_YEUCAU_Add] Parameters: [@param0=[PHAUTHUAT_ID,3589], @param1=[DVYEUCAU_ID,196030], @param2=[NHOMDICHVU_ID,26], @param3=[DICHVU_ID,5250], @param4=[LOAIGIA_ID,1], @param5=[THANHTIEN_DOANHTHU,4690000], @param6=[BHYT_THANHTIEN_CHITRA,2344800], @param7=[BENHNHAN_PHAITHANHTOAN,2345200], @param8=[BENHVIEN_ID,HLU01]]
2019-08-14 18:07:29,450 [1] DEBUG - Statement Id: [DAO00048_TT_PHAUTHUAT_YEUCAU_Add] Types: [@param0=[Int64, System.Int64], @param1=[Int64, System.Int64], @param2=[Int64, System.Int64], @param3=[Int64, System.Int64], @param4=[Int64, System.Int64], @param5=[Double, System.Double], @param6=[Double, System.Double], @param7=[Double, System.Double], @param8=[String, System.String]]
2019-08-14 18:07:29,506 [1] DEBUG - Statement Id: [DAO00048_UpdateDVYeuCauVienPhi] PreparedStatement : [update  TT_VIENPHI              set DATHUCHIEN = '1',              NGUOICAPNHAT_ID =  @param0 ,              NGAYCAPNHAT =  @param1               where              VIENPHI_ID =  @param2]
2019-08-14 18:07:29,506 [1] DEBUG - Statement Id: [DAO00048_UpdateDVYeuCauVienPhi] Parameters: [@param0=[NGUOICAPNHAT_ID,1], @param1=[NGAYCAPNHAT,8/14/2019 6:07:29 PM], @param2=[VIENPHI_ID,0]]
2019-08-14 18:07:29,506 [1] DEBUG - Statement Id: [DAO00048_UpdateDVYeuCauVienPhi] Types: [@param0=[Int64, System.Int64], @param1=[DateTime, System.DateTime], @param2=[Int64, System.Int64]]
2019-08-14 18:07:29,564 [1] DEBUG - Statement Id: [DAO00048_UpdateDVYeuCau] PreparedStatement : [update  TT_DVYEUCAU              set TRANGTHAI =  @param0 ,              NGUOICAPNHAT_ID =  @param1 ,              NGAYCAPNHAT =  @param2               where              DVYEUCAU_ID =  @param3]
2019-08-14 18:07:29,564 [1] DEBUG - Statement Id: [DAO00048_UpdateDVYeuCau] Parameters: [@param0=[TRANGTHAI,CHOXACNHAN], @param1=[NGUOICAPNHAT_ID,1], @param2=[NGAYCAPNHAT,8/14/2019 6:07:29 PM], @param3=[DVYEUCAU_ID,196030]]
2019-08-14 18:07:29,564 [1] DEBUG - Statement Id: [DAO00048_UpdateDVYeuCau] Types: [@param0=[String, System.String], @param1=[Int64, System.Int64], @param2=[DateTime, System.DateTime], @param3=[Int64, System.Int64]]
2019-08-14 18:07:29,626 [1] DEBUG - Statement Id: [DAO00048_TT_PHAUTHUAT_PPVOCAM_Add] PreparedStatement : [insert into TT_PHAUTHUAT_PPVOCAM (              PHAUTHUAT_ID,              PPVOCAM_ID,              BENHVIEN_ID)              values (               @param0 ,               @param1 ,               @param2 )]
2019-08-14 18:07:29,627 [1] DEBUG - Statement Id: [DAO00048_TT_PHAUTHUAT_PPVOCAM_Add] Parameters: [@param0=[PHAUTHUAT_ID,3589], @param1=[PPVOCAM_ID,520], @param2=[BENHVIEN_ID,HLU01]]
2019-08-14 18:07:29,627 [1] DEBUG - Statement Id: [DAO00048_TT_PHAUTHUAT_PPVOCAM_Add] Types: [@param0=[Int64, System.Int64], @param1=[Int64, System.Int64], @param2=[String, System.String]]
2019-08-14 18:07:29,692 [1] DEBUG - Statement Id: [DAO00048_GetlistvtytBeforeDelete] PreparedStatement : [select * from TT_PHAUTHUAT_VTYT where PHAUTHUAT_ID = 3589]
2019-08-14 18:07:29,757 [1] DEBUG - Statement Id: [DAO00062_GetKhoThuocCosoKhongCoso] PreparedStatement : [select distinct kd.KHODUOC_ID, lst.DICTIONARY_CODE  LOAIKHO from TM_KHODUOC kd        left join TM_PHONGBAN_KHODUOC pbkd        on kd.KHODUOC_ID = pbkd.KHODUOC_ID        and kd.BENHVIEN_ID = pbkd.BENHVIEN_ID        left join LST_DICTIONARY lst on lst.DICTIONARY_ID = kd.LOAIKHO_ID        where lst.DICTIONARY_CODE = 'Coso']
2019-08-14 18:07:29,823 [1] DEBUG - Statement Id: [DAO00062_GetAllPhamviKhoDuoc] PreparedStatement : [select distinct dmap.*        from TM_DUOC_PHAMVISD_MAPPING dmap        left join TM_DUOC_PHAMVISUDUNG dpv on dpv.PHAMVI_ID = dmap.PHAMVI_ID]
2019-08-14 18:07:29,896 [1] DEBUG - Statement Id: [DAO00023_GetSOBHYT_HUONG_ID] PreparedStatement : [select isnull(MAX(SOBHYT_HUONG_ID),0) SOBHYT_HUONG_ID        from TT_TIEPNHAN_SOTHEBHYT        where TIEPNHAN_ID = '24854']
2019-08-14 18:07:30,109 [1] DEBUG - Statement Id: [DAO00304_DotDieuTriID] PreparedStatement : [select top 1 DOTDIEUTRI_ID        from TT_NOITRU_DOTDIEUTRI        where BENHAN_ID = 5289 and TRANGTHAI='0'        order by DOTDIEUTRI_ID DESC]
2019-08-14 18:07:30,189 [1] DEBUG - Statement Id: [DAO00048_Add_GhiNhanVTYT_Phauthuat] PreparedStatement : [declare @jsonVienPhi nvarchar(max);          set @jsonVienPhi = N'{          "DATA": [{"COSO":"1","UID":"19711453-7851-480c-a306-fe69a22b2478","PHAUTHUAT_VTYT_ID":0,"PHAUTHUAT_ID":3589,"STT":null,"CHUNGTU_ID":null,"CHUNGTUTONGHOP_ID":null,"KHOSUDUNG_ID":null,"KHODUOC_ID":null,"KHOTAO_ID":29,"KHOPHAT_ID":29,"PHAMVI_ID":1052,"NGAYSUDUNG":"2019-08-14T18:07:02.0008486+07:00","NGUONHANG_ID":1,"NGUONDUOC_ID":1,"TRANGTHAI_XEM":null,"NGUONGOCDULIEU":null,"NGUOITAO_ID":1,"NGAYTAO":"2019-08-14T18:07:02.0008486+07:00","BENHVIEN_ID":"HLU01","TENKHO":"TT Khoa Phẫu thuật - Gây mê hồi sức","DUOC_ID":3,"DUOC_KEY":"1052_3_1","MADUOC":"VT788","TENDUOCDAYDU":"(Bơm tiêm nhựa 5ml) ","DONVITINH":"Cái","DUOC_BHYT":false,"DONGIABAN":null,"SOLUONG":1.0,"BOOKED_SOLUONG":0.0,"BookedSoLuong":0.0,"THANHTIEN_DOANHTHU":630.0,"THANHTIEN":630.0,"DONGIA_DOANHTHU":630.0,"BHYT_DONGIA":630.0,"BHYT_THANHTIEN":630.0,"NGUONDUOC":"Nguồn Mua","TINHTIEN":"1","BNTUCHITRA":"0","GHICHU":null,"TONKHO":null,"SOPHIEULINH":null,"SOPHIEUXUAT":null,"BHYTDONGTIEN":"0","KHONGTHUTIEN":"0","DOITUONG_HUONG_ID":6,"SOBHYT_HUONG_ID":25808,"LOAI_CHIPHI":"TT","TIEPNHAN_ID":24854,"BENHNHAN_ID":21398,"BENHAN_ID":5289,"REF_TABLE":"TT_PHAUTHUAT_VTYT","DICHVU_ID":null,"ACTIVE":"1"}]          }';            declare @PHAUTHUAT_VTYT_ID int;          declare @BENHAN_ID int;          declare @PHAUTHUAT_ID int;          declare @TIEPNHAN_ID int;          declare @BENHNHAN_ID int;          declare @NGUONDUOC_ID int;          declare @DUOC_ID int;          declare @SOLUONG numeric(18, 4);          declare @GHICHU nvarchar(100);          declare @COSO char(1);          declare @KHOTAO_ID int;          declare @KHOPHAT_ID int;          declare @PHAMVI_ID int;          declare @TINHTIEN char(1);          declare @NGUONHANG_ID int;          declare @DONGIA_DOANHTHU numeric(25, 4);          declare @THANHTIEN_DOANHTHU numeric(25, 4);          declare @BHYT_DONGIA numeric(25, 4);          declare @BHYT_THANHTIEN numeric(25, 4);          declare @DOITUONG_HUONG_ID numeric(25, 4);          declare @SOBHYT_HUONG_ID numeric(25, 4);          declare @BHYTDONGTIEN char(1);          declare @KHONGTHUTIEN char(1);          declare @NGUOITAO_ID int =  @param0 ;          declare @NGUOICAPNHAT_ID int =  @param1 ;          declare @BENHVIEN_ID varchar(10) =  @param2 ;          declare @DOTDIEUTRI_ID int;            declare @iTotal int =  @param3 ;          declare @icnt int = 0;          WHILE @iTotal > @icnt          BEGIN          declare @dyn_sql nvarchar(1000) = 'select @data = json_query(@json_dyn, ''' + CHAR(36) +'.DATA[' + cast(@icnt as varchar(10)) + ']'');'          declare @jsondatamax nvarchar(max);            exec sp_executesql @dyn_sql          , N'@json_dyn nvarchar(max), @data nvarchar(max) OUTPUT'          , @json_dyn = @jsonVienPhi          , @data = @jsondatamax OUTPUT            select          @BENHAN_ID =  JSON_VALUE(@jsondatamax, '' + CHAR(36) +'.BENHAN_ID'),          @PHAUTHUAT_ID =  JSON_VALUE(@jsondatamax, '' + CHAR(36) +'.PHAUTHUAT_ID'),          @TIEPNHAN_ID =  JSON_VALUE(@jsondatamax, '' + CHAR(36) +'.TIEPNHAN_ID'),          @BENHNHAN_ID =  JSON_VALUE(@jsondatamax, '' + CHAR(36) +'.BENHNHAN_ID'),          @NGUONDUOC_ID =  JSON_VALUE(@jsondatamax, '' + CHAR(36) +'.NGUONDUOC_ID'),          @DUOC_ID =  JSON_VALUE(@jsondatamax, '' + CHAR(36) +'.DUOC_ID'),          @GHICHU =  JSON_VALUE(@jsondatamax, '' + CHAR(36) +'.GHICHU'),          @SOLUONG =  JSON_VALUE(@jsondatamax, '' + CHAR(36) +'.SOLUONG'),          @COSO =  JSON_VALUE(@jsondatamax, '' + CHAR(36) +'.COSO'),          @KHOTAO_ID =  JSON_VALUE(@jsondatamax, '' + CHAR(36) +'.KHOTAO_ID'),          @KHOPHAT_ID =  JSON_VALUE(@jsondatamax, '' + CHAR(36) +'.KHOPHAT_ID'),          @TINHTIEN =  JSON_VALUE(@jsondatamax, '' + CHAR(36) +'.TINHTIEN'),          @BHYTDONGTIEN =  JSON_VALUE(@jsondatamax, '' + CHAR(36) +'.BHYTDONGTIEN'),          @KHONGTHUTIEN =  JSON_VALUE(@jsondatamax, '' + CHAR(36) +'.KHONGTHUTIEN'),          @NGUONHANG_ID =  JSON_VALUE(@jsondatamax, '' + CHAR(36) +'.NGUONHANG_ID'),            @NGUOITAO_ID =  JSON_VALUE(@jsondatamax, '' + CHAR(36) +'.NGUOITAO_ID'),          @NGUOICAPNHAT_ID =  JSON_VALUE(@jsondatamax, '' + CHAR(36) +'.NGUOICAPNHAT_ID'),          @PHAMVI_ID =  JSON_VALUE(@jsondatamax, '' + CHAR(36) +'.PHAMVI_ID'),          @DOITUONG_HUONG_ID =  JSON_VALUE(@jsondatamax, '' + CHAR(36) +'.DOITUONG_HUONG_ID'),          @SOBHYT_HUONG_ID =  JSON_VALUE(@jsondatamax, '' + CHAR(36) +'.SOBHYT_HUONG_ID'),            @DONGIA_DOANHTHU =  JSON_VALUE(@jsondatamax, '' + CHAR(36) +'.DONGIA_DOANHTHU'),          @THANHTIEN_DOANHTHU =  JSON_VALUE(@jsondatamax, '' + CHAR(36) +'.THANHTIEN_DOANHTHU'),          @BHYT_DONGIA =  JSON_VALUE(@jsondatamax, '' + CHAR(36) +'.BHYT_DONGIA'),          @BHYT_THANHTIEN =  JSON_VALUE(@jsondatamax, '' + CHAR(36) +'.BHYT_THANHTIEN'),          @DOTDIEUTRI_ID =  JSON_VALUE(@jsondatamax, '' + CHAR(36) +'.DOTDIEUTRI_ID')            INSERT INTO [TT_PHAUTHUAT_VTYT]          ([PHAUTHUAT_ID], [DUOC_ID], [SOLUONG] ,[KHOTAO_ID] ,[KHOSUDUNG_ID] ,[TINHTIEN],[BNTUCHITRA] ,[NGAYSUDUNG] ,[NGUONHANG_ID]          ,[COSO], [GHICHU] ,[NGUOITAO_ID] ,[NGAYTAO] ,[NGUOICAPNHAT_ID],[NGAYCAPNHAT],[BENHVIEN_ID] ,[PHAMVI_ID],[KHOPHAT_ID])          VALUES          (@PHAUTHUAT_ID,@DUOC_ID,@SOLUONG,@KHOTAO_ID,@KHOTAO_ID, @TINHTIEN, @BHYTDONGTIEN,GETDATE(),@NGUONHANG_ID          ,@COSO, @GHICHU, @NGUOITAO_ID, GETDATE(), @NGUOICAPNHAT_ID, GETDATE(), @BENHVIEN_ID, @PHAMVI_ID, @KHOPHAT_ID)                    set @PHAUTHUAT_VTYT_ID = SCOPE_IDENTITY()                      INSERT INTO TT_VIENPHI          ([TIEPNHAN_ID],[BENHAN_ID]          ,[BENHNHAN_ID],[KHAMBENH_ID],[REF_ID],[REF_TABLE],[DICHVU_ID],[DUOC_ID],[LOAI_CHIPHI]          ,[SOLUONG],[DONGIA_DOANHTHU],[THANHTIEN_DOANHTHU],[BHYT_DONGIA],[BHYT_THANHTIEN],[HUY],[DATHANHTOAN]          ,[DATHUCHIEN],[KHONGTHUTIEN],[BHYTDONGTIEN],[BENHVIEN_ID],[NGUOITAO_ID],[NGAYTAO],[NGUOICAPNHAT_ID],[NGAYCAPNHAT], [DOITUONG_HUONG_ID], [SOBHYT_HUONG_ID], [DOTDIEUTRI_ID])          VALUES          (@TIEPNHAN_ID,@BENHAN_ID          ,@BENHNHAN_ID,@PHAUTHUAT_ID,@PHAUTHUAT_VTYT_ID,'TT_PHAUTHUAT_VTYT',null,@DUOC_ID,'TT'          ,@SOLUONG,@DONGIA_DOANHTHU,@THANHTIEN_DOANHTHU,@BHYT_DONGIA,@BHYT_THANHTIEN,'0','0'          ,'0',@KHONGTHUTIEN,@BHYTDONGTIEN,@BENHVIEN_ID,@NGUOITAO_ID,GETDATE(),@NGUOICAPNHAT_ID,GETDATE(), @DOITUONG_HUONG_ID, @SOBHYT_HUONG_ID, @DOTDIEUTRI_ID)                      insert into TT_DUOC_TONKHO_BOOK_NGOAITRU          ([REF_TABLE],[REF_ID],[PHAMVI_ID],[KHODUOC_ID],[DUOC_ID],[SOLUONG],[NGUONHANG_ID]          ,[GHICHU],[BENHVIEN_ID],[NGAYTAO],[NGUOITAO_ID],[NGAYCAPNHAT],[NGUOICAPNHAT_ID], [TRANGTHAI])          VALUES          ('TT_PHAUTHUAT_VTYT',@PHAUTHUAT_VTYT_ID,@PHAMVI_ID,@KHOPHAT_ID,@DUOC_ID,@SOLUONG,@NGUONHANG_ID          ,@GHICHU,@BENHVIEN_ID,GETDATE(),@NGUOITAO_ID,GETDATE(),@NGUOICAPNHAT_ID, 'HIEULUC')            set @icnt = @icnt + 1;          END]
2019-08-14 18:07:30,189 [1] DEBUG - Statement Id: [DAO00048_Add_GhiNhanVTYT_Phauthuat] Parameters: [@param0=[NGUOITAO_ID,1], @param1=[NGUOICAPNHAT_ID,1], @param2=[BENHVIEN_ID,HLU01], @param3=[TOTAL_RECORD,1]]
2019-08-14 18:07:30,189 [1] DEBUG - Statement Id: [DAO00048_Add_GhiNhanVTYT_Phauthuat] Types: [@param0=[Int64, System.Int64], @param1=[Int64, System.Int64], @param2=[String, System.String], @param3=[Int32, System.Int32]]
2019-08-14 18:07:30,323 [1] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoVaBookingCOM23UpdateRedis] PreparedStatement : [select  distinct tk.DUOC_KEY, LTRIM(tk.PHAMVI_ID) as PHAMVI_ID, tk.NGUONDUOC_ID, nh.TENNGUONDUOC, nh.TINHTIEN, d.DUOC_ID, ld.MALOAIDUOC,        d.SOVISA,d.TYLE_VAT,d.COTOA, d.MADUOC, d.TENHANG, d.TENDUOCDAYDU, dvt.TENDONVITINH as DONVITINH, d.BHYT,        d.TENHOATCHAT, d.HAMLUONG, d.HANGSANXUAT, d.QUOCGIA, d.LOAIDUOC_ID, d.DUONGDUNG_ID, d.TINHTIEN_PTTT,        ten.TENDUOC, ten.TENDUOC_EN, ten.MAQUOCTE, ten.MAQUOCTEBT,        CASE WHEN d.BHYT = '1' THEN 'BHYT' ELSE '' END as BHYT_TEXT        , ld.LOAIVATTU_ID        , d.BENHVIEN_ID,        tk.SOLUONG, d.VTYT_PHANLOAI, d.PHAMVI, d.SUASOLUONGTONGHOP, d.MADUOCBV, d.DANGTRINHBAY        , TAMNGUNG = CASE WHEN d.TAMNGUNG = '1' OR nh.TAMNGUNG = '1' OR kd.TAMNGUNG = '1' THEN '1' ELSE '0' END        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        inner join        (        select  LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')) DUOC_KEY, (SUM(dtk.SOLUONG) - isnull(sum(A.SOLUONG),0) - isnull(sum(B.SOLUONG),0)) SOLUONG, pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        from (select sum(soluong) soluong,duoc_id,nguonduoc_id,khoduoc_id,benhvien_id from TT_DUOC_TONKHO  group by duoc_id,nguonduoc_id,khoduoc_id,benhvien_id) dtk        inner join TM_DUOC_PHAMVISD_MAPPING pvsd on dtk.KHODUOC_ID = pvsd.KHODUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NOITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) B on B.DUOC_ID = dtk.DUOC_ID and B.SOLUONG > 0 and B.PHAMVI_ID = pvsd.PHAMVI_ID and B.NGUONHANG_ID = dtk.NGUONDUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NGOAITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) A on A.DUOC_ID = dtk.DUOC_ID and A.SOLUONG > 0 and A.PHAMVI_ID = pvsd.PHAMVI_ID and A.NGUONHANG_ID = dtk.NGUONDUOC_ID        where dtk.SOLUONG > 0 and dtk.BENHVIEN_ID = 'HLU01'        group by LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')), pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        ) tk on tk.DUOC_ID = d.DUOC_ID        left join TM_DUOC_PHAMVISUDUNG kd on kd.PHAMVI_ID = tk.PHAMVI_ID and kd.BENHVIEN_ID = 'HLU01'        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = tk.NGUONDUOC_ID and nh.BENHVIEN_ID = 'HLU01'        where  d.BENHVIEN_ID = 'HLU01' and d.DUOC_ID in (3)]
2019-08-14 18:07:31,199 [1] DEBUG - Statement Id: [DAO00030_GetKhoDuoc] PreparedStatement : [SELECT *            FROM            TM_KHODUOC            WHERE            KHODUOC_ID= '29'            and BENHVIEN_ID= 'HLU01']
2019-08-14 18:07:31,239 [1] DEBUG - Statement Id: [DAO00030_GetMucDichChungTuID] PreparedStatement : [SELECT DICTIONARY_ID              FROM              LST_DICTIONARY              WHERE              DICTIONARY_TYPE_CODE = 'MucDichChungTu'              and DICTIONARY_CODE = 'X13']
2019-08-14 18:07:31,288 [1] DEBUG - Statement Id: [DAO00036_GetDetail] PreparedStatement : [select KEYTYPE, KEYYEAR, KEYMONTH, KEYDAY, SEGMENT_1, SEGMENT_2, SEGMENT_3, KEYVALUE              from LST_KEYDATA_DUOCPHAM as kd               WHERE                        kd.KEYTYPE = 'SOCHUNGTUNHAPXUATBENNGOAI'                   AND                       kd.KEYYEAR = '2019'                   AND                       kd.KEYMONTH = '0'                   AND                       kd.KEYDAY = '0'                   AND                       kd.SEGMENT_1 = 'CS_GMHS'                   AND                       kd.SEGMENT_2 = 'X13'                   AND                       kd.SEGMENT_3 = ' ']
2019-08-14 18:07:31,330 [1] DEBUG - Statement Id: [DAO00036_Update] PreparedStatement : [update LST_KEYDATA_DUOCPHAM set              KEYVALUE =  @param0               where              KEYTYPE = 'SOCHUNGTUNHAPXUATBENNGOAI'              AND KEYYEAR = '2019'              AND KEYMONTH = '0'              AND KEYDAY = '0'              AND SEGMENT_1 = 'CS_GMHS'              AND SEGMENT_2 = 'X13'              AND SEGMENT_3 = ' ']
2019-08-14 18:07:31,331 [1] DEBUG - Statement Id: [DAO00036_Update] Parameters: [@param0=[KEYVALUE,002657]]
2019-08-14 18:07:31,331 [1] DEBUG - Statement Id: [DAO00036_Update] Types: [@param0=[String, System.String]]
2019-08-14 18:07:31,380 [1] DEBUG - Statement Id: [DAO00030_GetGhiNhanPhauThuatVTYT] PreparedStatement : [SELECT            N'Người bệnh: ' + bn.MAYTE + ' - ' + bn.TENBENHNHAN + ' - ' +  CONVERT(VARCHAR(10), pt.NGAYTHUCHIEN, 103) + ' - ' + CONVERT(VARCHAR(5), pt.NGAYTHUCHIEN, 108) as BENHNHAN            ,vtyt.*             FROM TT_PHAUTHUAT_VTYT vtyt            INNER JOIN TT_PHAUTHUAT pt on pt.PHAUTHUAT_ID = vtyt.PHAUTHUAT_ID            INNER JOIN dbo.TT_TIEPNHAN tn on tn.TIEPNHAN_ID = pt.TIEPNHAN_ID            INNER JOIN TT_BENHNHAN bn on bn.BENHNHAN_ID = tn.BENHNHAN_ID                      WHERE            pt.PHAUTHUAT_ID= '3589'            and vtyt.COSO = '1'      and vtyt.CHUNGTU_ID is null]
2019-08-14 18:07:31,433 [1] DEBUG - Statement Id: [DAO00030_GET_SOLONHAP_XUATSUDUNG] PreparedStatement : [SELECT DISTINCT            SLN.SOLONHAP_ID, SLN.SOLONHAP, SLN.SOLOSANPHAM, SLN.SOKIEMSOAT, SLN.SOVISA, CONVERT(varchar(20), SLN.SOLOSANPHAM) + '/' + CONVERT(varchar(20), TK.SOLUONG) AS SOLOSOTON,            SLN.NGAYNHAP AS NGAYNHAPLO, SLN.HANDUNG AS HANSUDUNG,  SLN.HANDUNG, SLN.NGUONDUOC_ID, SLN.NGUONDUOC_ID as NGUONHANG_ID,            SLNGB.DONGIAMUA, SLNGB.DONGIAVON, SLNGB.TYLEVAT_DAUVAO as TYLEVAT, d.TYLE_VAT, SLNGB.DONGIAVONVAT, SLNGB.DONGIABANVAT_DAUVAO,            dg.DONGIA AS DONGIATHAU, dg.DONGIA AS DONGIABAN, dg.DONGIA AS DONGIABAN_VAT,                      TK.KHODUOC_ID,TK.DUOC_ID, TK.SOLUONG, TK.SOLUONG AS SOLUONGTON,            D.TENDUOCDAYDU,D.DONVITINH_ID, D.DONVITINH, D.BHYT, NH.TENNGUONDUOC AS NGUONHANG,            LTRIM(TK.KHODUOC_ID) + '_' + LTRIM(TK.DUOC_ID) + '_' + LTRIM(TK.NGUONDUOC_ID) as DUOC_KEY            FROM            TT_DUOC_CHUNGTU_SOLONHAP SLN            INNER JOIN TT_DUOC_TONKHO TK on SLN.SOLONHAP_ID = TK.SOLONHAP_ID            INNER JOIN TT_DUOC_SOLONHAP_GIABAN SLNGB on SLN.SOLONHAP_ID = SLNGB.SOLONHAP_ID            INNER JOIN TM_NGUONHANG NH on SLN.NGUONDUOC_ID = NH.NGUONDUOC_ID            INNER JOIN TM_DUOC D on SLN.DUOC_ID = D.DUOC_ID            LEFT JOIN TM_DUOC_DONGIA dg on dg.DUOC_ID = SLN.DUOC_ID            LEFT JOIN TM_LOAIGIA lg on (lg.LOAIGIA_ID = dg.LOAIGIA_ID AND lg.MALOAIGIA = 'GiaduocBHYT')            WHERE            TK.DUOC_ID = '3'            AND TK.KHODUOC_ID = '29'            AND TK.BENHVIEN_ID = 'HLU01'            AND TK.SOLUONG > 0                 and                     SLN.NGUONDUOC_ID = '1'                                      ORDER BY NGAYNHAP]
2019-08-14 18:07:31,536 [1] DEBUG - Statement Id: [DAO00030_ThemChungTuXSD] PreparedStatement : [declare @jsonChiTiet nvarchar(max);          set @jsonChiTiet =  @param0 ;          declare @type nvarchar(max);          set @type =  @param1 ;            declare @chungtu_id int;                    BEGIN                      insert into TT_DUOC_CHUNGTU (          MACHUNGTU,SOCHUNGTU,NGAYCHUNGTU,LOAICHUNGTU,MUCDICHCHUNGTU_ID,MUCDICHCHUNGTU_CODE,KHOXUAT_ID,NGUOIGIAO_ID,NGUOIGIAO,KHONHAP_ID,NGUOINHAN_ID,NGUOINHAN,NGUOIKIEMTRA_ID,NGUOIKIEMTRA,NGUOIDUYET_ID,NGUOIDUYET,PHUONGPHAPXUAT,KETOANTRUONG_ID,KETOANTRUONG,THUKHO_ID,THUKHO,MAUHOADON,SOHOADON,SOSERI,NGAYHOADON,DIENGIAI,GIATRI,GIATRITHANHTOAN,TYLEVAT,GIATRIVAT,THUESUAT,GIATRITHUE,TYLECHIETKHAU,GIATRICHIETKHAU,TIENTE_ID,TYGIA,SOCHUNGTUGOC,NGAYCHUNGTUGOC,NHACUNGCAP_ID,HINHTHUCTHANHTOAN_ID,NGUONDUOC_ID,CHUNGTULIENQUAN_ID,KHAMBENH_ID,TOATHUOCNOITRU_ID,TIEPNHAN_ID,BENHAN_ID,DANHANTHUOC,NGUOINHAP_ID,NGAYNHAP,TRANGTHAI,LOAITOATHUOC,PHIEULINH_ID,DIENGIAINGHIEPVUPHATSINH,DONVIGIAO_ID,KHOSUDUNG_ID,LOAIVATTU_ID,BENHNHAN_ID,NGOAITRU_TOATHUOC_NGUOIMUA_ID,TENBENHNHAN,BACSIGIOITHIEU_ID,DOITUONG_ID,IDCHUYEN,CHUNGTUKETOAN,STATUS,TRANSFER_VIENPHI_ID,PHONGBAN_ID,BACSI_ID,TKNO,TKCO,MACHUNGTUREF,LOAICHUNGTUREF,PHIEULINHCANTRU_ID,KHOTHUCHIEN_ID,KHODOIUNG_ID,MENU_LOAIDUOC_ID,NGUOISUDUNGMAY_ID,GOITHAU_ID,XUATTHUOCBANGOAITRU,NGAYGIOCHUNGTU,NOIDAKHAM,HOIDONGKIEMNHAP_ID,HOIDONGTHANHLY_ID,CHUYENCHUNGTUID,CHUYENDOANHTHUID,LYDOXUATSUDUNG_ID,BENHVIEN_ID,NGAYTAO,NGUOITAO_ID,NGAYCAPNHAT,NGUOICAPNHAT_ID)          values ( @param2 , @param3 , @param4 ,'X', @param5 , @param6 , @param7 , @param8 , @param9 , @param10 , @param11 , @param12 , @param13 , @param14 , @param15 , @param16 , @param17 , @param18 , @param19 , @param20 , @param21 , @param22 , @param23 , @param24 , @param25 , @param26 , @param27 , @param28 , @param29 , @param30 , @param31 , @param32 , @param33 , @param34 , @param35 , @param36 , @param37 , @param38 , @param39 , @param40 , @param41 , @param42 , @param43 , @param44 , @param45 , @param46 , @param47 , @param48 , @param49 ,'DXK', @param50 , @param51 , @param52 , @param53 , @param54 , @param55 , @param56 , @param57 , @param58 , @param59 , @param60 , @param61 , @param62 , @param63 , @param64 , @param65 , @param66 , @param67 , @param68 , @param69 , @param70 , @param71 , @param72 , @param73 , @param74 , @param75 , @param76 , @param77 , @param78 , @param79 , @param80 , @param81 , @param82 , @param83 , @param84 , @param85 , @param4 , @param86 , @param87 , @param88 )          set @chungtu_id = SCOPE_IDENTITY()                      INSERT INTO TT_DUOC_CHUNGTU_CHITIET          (CHUNGTU_ID,DUOC_ID,SOLONHAP_ID,SOKIEMSOAT,SOVISA,HANDUNG,DONVITINH_ID          ,SOLUONGYEUCAU,SOLUONGDAXUAT,THANHTIENVON          ,DONGIABAN,DONGIAVON,TRANGTHAI,NGUONHANG_ID          ,TOATHUOCNOITRU_ID,KHAMBENH_VTYT_ID          ,PHAUTHUAT_VTYT_ID,CLSKETQUA_VTYT_ID,TOATHUOCNGOAITRU_ID          ,MASTER_ID,BENHNHAN,BENHVIEN_ID,NGAYTAO,NGUOITAO_ID)            SELECT @chungtu_id, json.DUOC_ID, json.SOLONHAP_ID, json.SOKIEMSOAT, json.SOVISA, json.HANDUNG, json.DONVITINH_ID          ,json.SOLUONGYEUCAU, json.SOLUONGDAXUAT, json.THANHTIENVON          ,json.DONGIABAN, json.DONGIAVON, json.TRANGTHAI, json.NGUONHANG_ID          ,json.TOATHUOCNOITRU_ID, json.KHAMBENH_VTYT_ID          ,json.PHAUTHUAT_VTYT_ID, json.CLSKETQUA_VTYT_ID, json.TOATHUOCNGOAITRU_ID          ,json.MASTER_ID, json.BENHNHAN,  @param85 , json.NGAYTAO, json.NGUOITAO_ID          FROM OPENJSON(@jsonChiTiet)          WITH (          DUOC_ID int,SOLONHAP_ID int,SOKIEMSOAT varchar(20),SOVISA varchar(20),HANDUNG datetime,DONVITINH_ID int,          SOLUONGYEUCAU numeric(25, 4),SOLUONGDAXUAT numeric(25, 4),THANHTIENVON numeric(25, 4),          DONGIABAN numeric(25, 4),DONGIAVON numeric(25, 4),TRANGTHAI varchar(10),NGUONHANG_ID int,          TOATHUOCNOITRU_ID int,KHAMBENH_VTYT_ID int,          PHAUTHUAT_VTYT_ID int,CLSKETQUA_VTYT_ID int,TOATHUOCNGOAITRU_ID int,          MASTER_ID int,BENHNHAN nvarchar(1000), BENHVIEN_ID varchar(10),NGAYTAO datetime,NGUOITAO_ID int          ) json                      if(@type = 'TT_NOITRU_TOATHUOC')          BEGIN                    UPDATE TT_NOITRU_TOATHUOC SET CHUNGTU_ID = @chungtu_id, TRANGTHAI = 'DAXUAT', NGAYCAPNHAT = getdate()          FROM OPENJSON(@jsonChiTiet)          WITH (MASTER_ID int, TOATHUOCNOITRU_ID int) json          WHERE TT_NOITRU_TOATHUOC.TOATHUOC_ID = json.TOATHUOCNOITRU_ID and json.TOATHUOCNOITRU_ID is not NULL and json.MASTER_ID = TT_NOITRU_TOATHUOC.KHAMBENH_ID                      UPDATE TT_DUOC_TONKHO_BOOK_NOITRU SET SOLUONG = 0          FROM OPENJSON(@jsonChiTiet)          WITH (TOATHUOCNOITRU_ID int) json          WHERE TT_DUOC_TONKHO_BOOK_NOITRU.REF_ID = json.TOATHUOCNOITRU_ID and json.TOATHUOCNOITRU_ID is not NULL and TT_DUOC_TONKHO_BOOK_NOITRU.REF_TABLE = 'TT_NOITRU_TOATHUOC'          END                            if(@type = 'TT_PHAUTHUAT_VTYT')          BEGIN          UPDATE TT_PHAUTHUAT_VTYT SET CHUNGTU_ID = @chungtu_id          FROM OPENJSON(@jsonChiTiet)          WITH (PHAUTHUAT_VTYT_ID int) json          WHERE TT_PHAUTHUAT_VTYT.PHAUTHUAT_VTYT_ID = json.PHAUTHUAT_VTYT_ID and json.PHAUTHUAT_VTYT_ID is not NULL                              UPDATE TT_VIENPHI set DUYET = '1', DATHUCHIEN = '1', NGAYCAPNHAT = getdate()          FROM OPENJSON(@jsonChiTiet)          WITH (PHAUTHUAT_VTYT_ID int) json          WHERE TT_VIENPHI.REF_TABLE = 'TT_PHAUTHUAT_VTYT' and TT_VIENPHI.REF_ID = json.PHAUTHUAT_VTYT_ID and json.PHAUTHUAT_VTYT_ID is not NULL                      UPDATE TT_DUOC_TONKHO_BOOK_NGOAITRU SET SOLUONG = 0          FROM OPENJSON(@jsonChiTiet)          WITH (PHAUTHUAT_VTYT_ID int) json          WHERE TT_DUOC_TONKHO_BOOK_NGOAITRU.REF_ID = json.PHAUTHUAT_VTYT_ID and json.PHAUTHUAT_VTYT_ID is not NULL          and TT_DUOC_TONKHO_BOOK_NGOAITRU.REF_TABLE = 'TT_PHAUTHUAT_VTYT'          END                    if(@type = 'TT_CLSKETQUA_VTYT')          BEGIN                    UPDATE TT_CLSKETQUA_VTYT SET CHUNGTU_ID = @chungtu_id, TRANGTHAI = 'DAXUAT', NGAYCAPNHAT = getdate()          FROM OPENJSON(@jsonChiTiet)          WITH (CLSKETQUA_VTYT_ID int) json          WHERE TT_CLSKETQUA_VTYT.CLSKETQUA_VTYT_ID = json.CLSKETQUA_VTYT_ID and json.CLSKETQUA_VTYT_ID is not NULL            UPDATE TT_VIENPHI set DUYET = '1', DATHUCHIEN = '1', NGAYCAPNHAT = getdate()          FROM OPENJSON(@jsonChiTiet)          WITH (CLSKETQUA_VTYT_ID int) json          WHERE TT_VIENPHI.REF_TABLE = 'TT_CLSKETQUA_VTYT' and TT_VIENPHI.REF_ID = json.CLSKETQUA_VTYT_ID and json.CLSKETQUA_VTYT_ID is not NULL                       UPDATE TT_DUOC_TONKHO_BOOK_NGOAITRU SET SOLUONG = 0          FROM OPENJSON(@jsonChiTiet)          WITH (CLSKETQUA_VTYT_ID int) json          WHERE TT_DUOC_TONKHO_BOOK_NGOAITRU.REF_ID = json.CLSKETQUA_VTYT_ID and json.CLSKETQUA_VTYT_ID is not NULL          and TT_DUOC_TONKHO_BOOK_NGOAITRU.REF_TABLE = 'TT_CLSKETQUA_VTYT'          END                              select @chungtu_id            END]
2019-08-14 18:07:31,536 [1] DEBUG - Statement Id: [DAO00030_ThemChungTuXSD] Parameters: [@param0=[JSON_DATA,[{"SOLONHAP_ID":9260,"SOLONHAP":"190502340","SOLOSANPHAM":"a","SOKIEMSOAT":null,"SOVISA":"","SOLOSOTON":"a/98.0000","NGAYNHAPLO":"2019-05-16T09:08:00","HANSUDUNG":"2026-12-12T00:00:00","HANDUNG":"2026-12-12T00:00:00","NGUONDUOC_ID":1,"NGUONHANG_ID":1,"DONGIAMUA":630.0000,"DONGIAVON":630.0000,"TYLEVAT":0.0000,"TYLE_VAT":0.00,"DONGIAVONVAT":630.0000,"DONGIABANVAT_DAUVAO":630.0000,"DONGIATHAU":630.00,"DONGIABAN":630.00,"DONGIABAN_VAT":630.00,"KHODUOC_ID":29,"DUOC_ID":3,"SOLUONG":98.0000,"SOLUONGTON":98.0000,"TENDUOCDAYDU":"(Bơm tiêm nhựa 5ml) ","DONVITINH_ID":17,"DONVITINH":"Cái","BHYT":"1","NGUONHANG":"Nguồn Mua","DUOC_KEY":"29_3_1","CHUNGTUCHITIET_ID":0,"CHUNGTU_ID":null,"SOLUONGTHUCTE":null,"TOATHUOC":"PHAUTHUATVTYT","PHAUTHUAT_VTYT_ID":1242,"REF_TABLE":"TT_PHAUTHUAT_VTYT","REF_ID":1242,"BENHNHAN":"Người bệnh: 190041285 - Lộc Văn En - 14/08/2019 - 18:07","SOLUONGYEUCAU":1.0000,"KHAMBENH_VTYT_ID":null,"TOATHUOCNOITRU_ID":null,"CLSKETQUA_VTYT_ID":null,"SOLUONGDAXUAT":1.0000,"THANHTIENVON":630.00000000}]], @param1=[REF_TABLE,TT_PHAUTHUAT_VTYT], @param2=[MACHUNGTU,CS_GMHSX1319002657], @param3=[SOCHUNGTU,002657], @param4=[NGAYCHUNGTU,8/14/2019 6:07:29 PM], @param5=[MUCDICHCHUNGTU_ID,1060], @param6=[MUCDICHCHUNGTU_CODE,X13], @param7=[KHOXUAT_ID,29], @param8=[NGUOIGIAO_ID,0], @param9=[NGUOIGIAO,null], @param10=[KHONHAP_ID,null], @param11=[NGUOINHAN_ID,null], @param12=[NGUOINHAN,null], @param13=[NGUOIKIEMTRA_ID,null], @param14=[NGUOIKIEMTRA,null], @param15=[NGUOIDUYET_ID,null], @param16=[NGUOIDUYET,null], @param17=[PHUONGPHAPXUAT,0], @param18=[KETOANTRUONG_ID,null], @param19=[KETOANTRUONG,null], @param20=[THUKHO_ID,null], @param21=[THUKHO,null], @param22=[MAUHOADON,null], @param23=[SOHOADON,null], @param24=[SOSERI,null], @param25=[NGAYHOADON,null], @param26=[DIENGIAI,null], @param27=[GIATRI,null], @param28=[GIATRITHANHTOAN,null], @param29=[TYLEVAT,5], @param30=[GIATRIVAT,0], @param31=[THUESUAT,null], @param32=[GIATRITHUE,null], @param33=[TYLECHIETKHAU,null], @param34=[GIATRICHIETKHAU,null], @param35=[TIENTE_ID,null], @param36=[TYGIA,null], @param37=[SOCHUNGTUGOC,null], @param38=[NGAYCHUNGTUGOC,null], @param39=[NHACUNGCAP_ID,null], @param40=[HINHTHUCTHANHTOAN_ID,null], @param41=[NGUONDUOC_ID,null], @param42=[CHUNGTULIENQUAN_ID,null], @param43=[KHAMBENH_ID,null], @param44=[TOATHUOCNOITRU_ID,1], @param45=[TIEPNHAN_ID,null], @param46=[BENHAN_ID,null], @param47=[DANHANTHUOC,], @param48=[NGUOINHAP_ID,null], @param49=[NGAYNHAP,null], @param50=[LOAITOATHUOC,null], @param51=[PHIEULINH_ID,null], @param52=[DIENGIAINGHIEPVUPHATSINH,null], @param53=[DONVIGIAO_ID,null], @param54=[KHOSUDUNG_ID,null], @param55=[LOAIVATTU_ID,null], @param56=[BENHNHAN_ID,null], @param57=[NGOAITRU_TOATHUOC_NGUOIMUA_ID,null], @param58=[TENBENHNHAN,null], @param59=[BACSIGIOITHIEU_ID,null], @param60=[DOITUONG_ID,null], @param61=[IDCHUYEN,null], @param62=[CHUNGTUKETOAN,null], @param63=[STATUS,null], @param64=[TRANSFER_VIENPHI_ID,null], @param65=[PHONGBAN_ID,25], @param66=[BACSI_ID,null], @param67=[TKNO,null], @param68=[TKCO,null], @param69=[MACHUNGTUREF,null], @param70=[LOAICHUNGTUREF,null], @param71=[PHIEULINHCANTRU_ID,null], @param72=[KHOTHUCHIEN_ID,null], @param73=[KHODOIUNG_ID,null], @param74=[MENU_LOAIDUOC_ID,null], @param75=[NGUOISUDUNGMAY_ID,null], @param76=[GOITHAU_ID,null], @param77=[XUATTHUOCBANGOAITRU,null], @param78=[NGAYGIOCHUNGTU,null], @param79=[NOIDAKHAM,null], @param80=[HOIDONGKIEMNHAP_ID,null], @param81=[HOIDONGTHANHLY_ID,null], @param82=[CHUYENCHUNGTUID,null], @param83=[CHUYENDOANHTHUID,null], @param84=[LYDOXUATSUDUNG_ID,8294], @param85=[BENHVIEN_ID,HLU01], @param86=[NGUOITAO_ID,0], @param87=[NGAYCAPNHAT,8/14/2019 6:07:31 PM], @param88=[NGUOICAPNHAT_ID,0]]
2019-08-14 18:07:31,536 [1] DEBUG - Statement Id: [DAO00030_ThemChungTuXSD] Types: [@param0=[String, System.String], @param1=[String, System.String], @param2=[String, System.String], @param3=[String, System.String], @param4=[DateTime, System.DateTime], @param5=[Int32, System.Int32], @param6=[String, System.String], @param7=[Int32, System.Int32], @param8=[Int32, System.Int32], @param9=[System.DBNull, null], @param10=[System.DBNull, null], @param11=[System.DBNull, null], @param12=[System.DBNull, null], @param13=[System.DBNull, null], @param14=[System.DBNull, null], @param15=[System.DBNull, null], @param16=[System.DBNull, null], @param17=[Int32, System.Int32], @param18=[System.DBNull, null], @param19=[System.DBNull, null], @param20=[System.DBNull, null], @param21=[System.DBNull, null], @param22=[System.DBNull, null], @param23=[System.DBNull, null], @param24=[System.DBNull, null], @param25=[System.DBNull, null], @param26=[System.DBNull, null], @param27=[System.DBNull, null], @param28=[System.DBNull, null], @param29=[Decimal, System.Decimal], @param30=[Decimal, System.Decimal], @param31=[System.DBNull, null], @param32=[System.DBNull, null], @param33=[System.DBNull, null], @param34=[System.DBNull, null], @param35=[System.DBNull, null], @param36=[System.DBNull, null], @param37=[System.DBNull, null], @param38=[System.DBNull, null], @param39=[System.DBNull, null], @param40=[System.DBNull, null], @param41=[System.DBNull, null], @param42=[System.DBNull, null], @param43=[System.DBNull, null], @param44=[Int32, System.Int32], @param45=[System.DBNull, null], @param46=[System.DBNull, null], @param47=[String, System.String], @param48=[System.DBNull, null], @param49=[System.DBNull, null], @param50=[System.DBNull, null], @param51=[System.DBNull, null], @param52=[System.DBNull, null], @param53=[System.DBNull, null], @param54=[System.DBNull, null], @param55=[System.DBNull, null], @param56=[System.DBNull, null], @param57=[System.DBNull, null], @param58=[System.DBNull, null], @param59=[System.DBNull, null], @param60=[System.DBNull, null], @param61=[System.DBNull, null], @param62=[System.DBNull, null], @param63=[System.DBNull, null], @param64=[System.DBNull, null], @param65=[Int32, System.Int32], @param66=[System.DBNull, null], @param67=[System.DBNull, null], @param68=[System.DBNull, null], @param69=[System.DBNull, null], @param70=[System.DBNull, null], @param71=[System.DBNull, null], @param72=[System.DBNull, null], @param73=[System.DBNull, null], @param74=[System.DBNull, null], @param75=[System.DBNull, null], @param76=[System.DBNull, null], @param77=[System.DBNull, null], @param78=[System.DBNull, null], @param79=[System.DBNull, null], @param80=[System.DBNull, null], @param81=[System.DBNull, null], @param82=[System.DBNull, null], @param83=[System.DBNull, null], @param84=[Int32, System.Int32], @param85=[String, System.String], @param86=[Int32, System.Int32], @param87=[DateTime, System.DateTime], @param88=[Int32, System.Int32]]
2019-08-14 18:07:32,412 [1] DEBUG - Statement Id: [DAO00030_MergSoLuongTonKho] PreparedStatement : [BEGIN          BEGIN TRY          BEGIN TRANSACTION            UPDATE TT_DUOC_TONKHO SET SOLUONG=0,DONGIAMUA=null WHERE KHODUOC_ID IN(29);          MERGE TT_DUOC_TONKHO AS X USING          (          select aa.SoLoNhap_ID,aa.KHODUOC_ID,aa.DUOC_ID,  aa.NGUONDUOC_ID,aa.BENHVIEN_ID, (case when sum(aa.soluong) < 0 then 0 else sum(aa.soluong) end) as SOLUONG from (          Select (case when CTU.LoaiChungTu = 'N' then CTU.KhoNhap_ID else ctu.KhoXuat_ID end) as KHODUOC_ID, CT.SOLONHAP_ID,          (case when CTU.LoaiChungTu = 'N' then SoLuongThucTe*ISNULL(CT.TYLEQUIDOI,1) else - SOLUONGDAXUAT end) as SOLUONG,CT.DUOC_ID,          Lo.NGUONDUOC_ID,CTU.BENHVIEN_ID          from TT_DUOC_CHUNGTU_CHITIET CT          join TT_DUOC_CHUNGTU CTU on CT.ChungTu_ID = CTU.ChungTu_ID AND CT.BENHVIEN_ID=CTU.BENHVIEN_ID          join TT_DUOC_CHUNGTU_SOLONHAP Lo on Lo.SoLoNhap_ID = CT.SoLoNhap_ID          join TM_DUOC duoc on CT.DUOC_ID = duoc.DUOC_ID          where ((CTU.TRANGTHAI not in ('PNCXN','CXN','HUY','PNCNK')) or CTU.TRANGTHAI is null) AND CTU.BENHVIEN_ID='HLU01'          ) aa where aa.KHODUOC_ID IN(29)          Group by AA.SoLoNhap_ID,AA.KHODUOC_ID,AA.DUOC_ID,  AA.NGUONDUOC_ID,AA.BENHVIEN_ID          ) AS Y          ON (X.KHODUOC_ID =Y.KHODUOC_ID AND X.SOLONHAP_ID=Y.SOLONHAP_ID AND X.DUOC_ID=Y.DUOC_ID AND X.NGUONDUOC_ID=Y.NGUONDUOC_ID AND X.BENHVIEN_ID=Y.BENHVIEN_ID)          WHEN MATCHED THEN UPDATE SET X.SOLUONG=Y.SOLUONG          WHEN NOT MATCHED THEN          INSERT (KHODUOC_ID,DUOC_ID,SOLONHAP_ID,SOLUONG,NGUONDUOC_ID,BENHVIEN_ID,NGAYTAO,NGUOITAO_ID,NGAYCAPNHAT,NGUOICAPNHAT_ID) VALUES          (Y.KHODUOC_ID,Y.DUOC_ID,Y.SOLONHAP_ID,Y.SOLUONG,Y.NGUONDUOC_ID,Y.BENHVIEN_ID,GETDATE(),NULL,GETDATE(),NULL);            COMMIT TRANSACTION          END TRY          BEGIN CATCH          IF @@TRANCOUNT > 0          ROLLBACK TRANSACTION          END CATCH          END]
2019-08-14 18:07:33,167 [1] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoCOM18] PreparedStatement : [select  distinct TT_TONKHO.DUOC_KEY, LTRIM(TT_TONKHO.KHODUOC_ID) as KHODUOC_ID, TM_DUOC.DUOC_ID, TM_LOAIDUOC.MALOAIDUOC,TM_DUOC.SOVISA,TM_DUOC.TYLE_VAT,TM_DUOC.COTOA,        TM_DUOC.MADUOC, TM_DUOC.TENHANG, TM_DUOC.TENDUOCDAYDU, dvt.TENDONVITINH as DONVITINH, TM_DUOC.DONVITINH_ID, TM_DUOC.BHYT,        TM_DUOC.TENHOATCHAT, TM_DUOC.HAMLUONG, TM_DUOC.HANGSANXUAT, TM_DUOC.QUOCGIA, TM_DUOC.LOAIDUOC_ID, TM_DUOC.DUONGDUNG_ID,        TM_TENDUOC.TENDUOC, TM_TENDUOC.TENDUOC_EN, TM_TENDUOC.MAQUOCTE, TM_TENDUOC.MAQUOCTEBT,        TM_LOAIDUOC.LOAIVATTU_ID, TM_DUOC.BENHVIEN_ID,        TT_TONKHO.SOLUONG, TM_DUOC.VTYT_PHANLOAI, TM_DUOC.PHAMVI, TT_TONKHO.NGUONDUOC_ID, NG.TENNGUONDUOC        , TAMNGUNG = CASE WHEN TM_DUOC.TAMNGUNG = '1' OR NG.TAMNGUNG = '1' OR KD.TAMNGUNG = '1' THEN '1' ELSE '0' END        , TM_DUOC.DANGTRINHBAY        from TM_DUOC        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = TM_DUOC.DONVITINH_ID        left join TM_TENDUOC on TM_DUOC.TENDUOC_ID = TM_TENDUOC.TENDUOC_ID and TM_DUOC.BENHVIEN_ID = 'HLU01'  and TM_DUOC.TAMNGUNG = '0'        left join TM_LOAIDUOC on TM_LOAIDUOC.LOAIDUOC_ID = TM_DUOC.LOAIDUOC_ID and TM_LOAIDUOC.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG on (TM_LOAIDUOC.LOAIVATTU_ID = TM_DUOC_HANDUNG.LOAIDUOC and TM_DUOC_HANDUNG.BENHVIEN_ID = 'HLU01')        inner join        (select LTRIM(A.KHODUOC_ID) + '_' + LTRIM(A.DUOC_ID) + '_' + LTRIM(ISNULL(A.NGUONDUOC_ID,'')) as DUOC_KEY, A.KHODUOC_ID, A.DUOC_ID ,a.NGUONDUOC_ID,        SUM(isnull(A.SOLUONG,0)) as SOLUONG        from        (select SUM(SOLUONG) as SOLUONG, KHODUOC_ID, DUOC_ID, NGUONDUOC_ID from TT_DUOC_TONKHO        where KHODUOC_ID in (29) and DUOC_ID in (3) group by KHODUOC_ID, DUOC_ID, NGUONDUOC_ID        ) A        where A.KHODUOC_ID in (29) and A.DUOC_ID in (3)        group by LTRIM(A.KHODUOC_ID) + '_' + LTRIM(A.DUOC_ID) + '_' + LTRIM(A.NGUONDUOC_ID), A.KHODUOC_ID, A.DUOC_ID, A.NGUONDUOC_ID)        TT_TONKHO on TT_TONKHO.DUOC_ID = TM_DUOC.DUOC_ID        LEFT JOIN TM_NGUONHANG NG ON NG.NGUONDUOC_ID = TT_TONKHO.NGUONDUOC_ID        LEFT JOIN TM_KHODUOC KD ON KD.KHODUOC_ID = TT_TONKHO.KHODUOC_ID        where TM_DUOC.BENHVIEN_ID = 'HLU01' and TM_DUOC.DUOC_ID in (3)]
2019-08-14 18:07:33,243 [1] DEBUG - Statement Id: [DAO00030_GetListPhamViByKhoDuoc] PreparedStatement : [SELECT DISTINCT PHAMVI_ID          FROM TM_DUOC_PHAMVISD_MAPPING          WHERE          KHODUOC_ID IN (29)          AND BENHVIEN_ID ='HLU01'          AND TAMNGUNG = '0']
2019-08-14 18:07:33,316 [1] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoVaBookingCOM23] PreparedStatement : [select  distinct tk.DUOC_KEY, LTRIM(tk.PHAMVI_ID) as PHAMVI_ID, tk.NGUONDUOC_ID, nh.TENNGUONDUOC, nh.TINHTIEN, d.DUOC_ID, ld.MALOAIDUOC,        d.SOVISA,d.TYLE_VAT,d.COTOA, d.MADUOC, d.TENHANG, d.TENDUOCDAYDU, dvt.TENDONVITINH as DONVITINH, d.BHYT,        d.TENHOATCHAT, d.HAMLUONG, d.HANGSANXUAT, d.QUOCGIA, d.LOAIDUOC_ID, d.DUONGDUNG_ID, d.TINHTIEN_PTTT,        ten.TENDUOC, ten.TENDUOC_EN, ten.MAQUOCTE, ten.MAQUOCTEBT,        CASE WHEN d.BHYT = '1' THEN 'BHYT' ELSE '' END as BHYT_TEXT        , ld.LOAIVATTU_ID        , d.BENHVIEN_ID,        tk.SOLUONG, d.VTYT_PHANLOAI, d.PHAMVI, d.SUASOLUONGTONGHOP, d.MADUOCBV, d.DANGTRINHBAY        , TAMNGUNG = CASE WHEN d.TAMNGUNG = '1' OR nh.TAMNGUNG = '1' OR kd.TAMNGUNG = '1' THEN '1' ELSE '0' END        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        inner join        (        select  LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')) DUOC_KEY, (SUM(dtk.SOLUONG) - isnull(sum(A.SOLUONG),0) - isnull(sum(B.SOLUONG),0)) SOLUONG, pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        from (select sum(soluong) soluong,duoc_id,nguonduoc_id,khoduoc_id,benhvien_id from TT_DUOC_TONKHO  group by duoc_id,nguonduoc_id,khoduoc_id,benhvien_id) dtk        inner join TM_DUOC_PHAMVISD_MAPPING pvsd on dtk.KHODUOC_ID = pvsd.KHODUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NOITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) B on B.DUOC_ID = dtk.DUOC_ID and B.SOLUONG > 0 and B.PHAMVI_ID = pvsd.PHAMVI_ID and B.NGUONHANG_ID = dtk.NGUONDUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NGOAITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) A on A.DUOC_ID = dtk.DUOC_ID and A.SOLUONG > 0 and A.PHAMVI_ID = pvsd.PHAMVI_ID and A.NGUONHANG_ID = dtk.NGUONDUOC_ID        where dtk.SOLUONG > 0 and dtk.BENHVIEN_ID = 'HLU01'        group by LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')), pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        ) tk on tk.DUOC_ID = d.DUOC_ID        left join TM_DUOC_PHAMVISUDUNG kd on kd.PHAMVI_ID = tk.PHAMVI_ID and kd.BENHVIEN_ID = 'HLU01'        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = tk.NGUONDUOC_ID and nh.BENHVIEN_ID = 'HLU01'        where  d.BENHVIEN_ID = 'HLU01' and d.DUOC_ID in (3) and TK.PHAMVI_ID in (1052)        and tk.NGUONDUOC_ID in (1)]
2019-08-14 18:07:33,504 [1] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoCOM18UpdateRedis] PreparedStatement : [select distinct TT_TONKHO.DUOC_KEY, LTRIM(TT_TONKHO.KHODUOC_ID) as KHODUOC_ID, TM_DUOC.DUOC_ID, TM_LOAIDUOC.MALOAIDUOC,TM_DUOC.SOVISA,TM_DUOC.TYLE_VAT,TM_DUOC.COTOA,        TM_DUOC.MADUOC, TM_DUOC.TENHANG, TM_DUOC.TENDUOCDAYDU, dvt.TENDONVITINH as DONVITINH,  TM_DUOC.DONVITINH_ID,TM_DUOC.BHYT,        TM_DUOC.TENHOATCHAT,        TM_DUOC.HAMLUONG, TM_DUOC.HANGSANXUAT, TM_DUOC.QUOCGIA, TM_DUOC.LOAIDUOC_ID, TM_DUOC.DUONGDUNG_ID,        TM_TENDUOC.TENDUOC, TM_TENDUOC.TENDUOC_EN, TM_TENDUOC.MAQUOCTE, TM_TENDUOC.MAQUOCTEBT,        TM_LOAIDUOC.LOAIVATTU_ID, TM_DUOC.BENHVIEN_ID,        TT_TONKHO.SOLUONG, TM_DUOC.VTYT_PHANLOAI, TM_DUOC.PHAMVI, TT_TONKHO.NGUONDUOC_ID, NG.TENNGUONDUOC AS TENNGUONDUOC        , TAMNGUNG = CASE WHEN TM_DUOC.TAMNGUNG = '1' OR NG.TAMNGUNG = '1' OR KD.TAMNGUNG = '1' THEN '1' ELSE '0' END        , TM_DUOC.DANGTRINHBAY        from TM_DUOC        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = TM_DUOC.DONVITINH_ID        left join TM_TENDUOC on TM_DUOC.TENDUOC_ID = TM_TENDUOC.TENDUOC_ID and TM_DUOC.BENHVIEN_ID = 'HLU01' and TM_DUOC.TAMNGUNG = '0'        left join TM_LOAIDUOC on TM_LOAIDUOC.LOAIDUOC_ID = TM_DUOC.LOAIDUOC_ID and TM_LOAIDUOC.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG on (TM_LOAIDUOC.LOAIVATTU_ID = TM_DUOC_HANDUNG.LOAIDUOC and TM_DUOC_HANDUNG.BENHVIEN_ID = 'HLU01')        inner join        (select LTRIM(A.KHODUOC_ID) + '_' + LTRIM(A.DUOC_ID) + '_' + LTRIM(ISNULL(A.NGUONDUOC_ID,'')) as DUOC_KEY, A.KHODUOC_ID, A.DUOC_ID, A.NGUONDUOC_ID,        SUM(isnull(A.SOLUONG,0)) as SOLUONG        from        (select SUM(SOLUONG) as SOLUONG, KHODUOC_ID, DUOC_ID, NGUONDUOC_ID from TT_DUOC_TONKHO        where BENHVIEN_ID = 'HLU01' group by KHODUOC_ID, DUOC_ID, NGUONDUOC_ID) A        group by LTRIM(A.KHODUOC_ID) + '_' + LTRIM(A.DUOC_ID) + '_' + LTRIM(ISNULL(A.NGUONDUOC_ID,'')), A.KHODUOC_ID, A.DUOC_ID, NGUONDUOC_ID        ) TT_TONKHO on TT_TONKHO.DUOC_ID = TM_DUOC.DUOC_ID        LEFT JOIN TM_NGUONHANG NG ON NG.NGUONDUOC_ID = TT_TONKHO.NGUONDUOC_ID        LEFT JOIN TM_KHODUOC KD ON KD.KHODUOC_ID = TT_TONKHO.KHODUOC_ID        where TM_DUOC.BENHVIEN_ID = 'HLU01' and TT_TONKHO.SOLUONG >= 0        and TM_DUOC.DUOC_ID in (3)]
2019-08-14 18:07:33,586 [1] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoVaBookingCOM23UpdateRedis] PreparedStatement : [select  distinct tk.DUOC_KEY, LTRIM(tk.PHAMVI_ID) as PHAMVI_ID, tk.NGUONDUOC_ID, nh.TENNGUONDUOC, nh.TINHTIEN, d.DUOC_ID, ld.MALOAIDUOC,        d.SOVISA,d.TYLE_VAT,d.COTOA, d.MADUOC, d.TENHANG, d.TENDUOCDAYDU, dvt.TENDONVITINH as DONVITINH, d.BHYT,        d.TENHOATCHAT, d.HAMLUONG, d.HANGSANXUAT, d.QUOCGIA, d.LOAIDUOC_ID, d.DUONGDUNG_ID, d.TINHTIEN_PTTT,        ten.TENDUOC, ten.TENDUOC_EN, ten.MAQUOCTE, ten.MAQUOCTEBT,        CASE WHEN d.BHYT = '1' THEN 'BHYT' ELSE '' END as BHYT_TEXT        , ld.LOAIVATTU_ID        , d.BENHVIEN_ID,        tk.SOLUONG, d.VTYT_PHANLOAI, d.PHAMVI, d.SUASOLUONGTONGHOP, d.MADUOCBV, d.DANGTRINHBAY        , TAMNGUNG = CASE WHEN d.TAMNGUNG = '1' OR nh.TAMNGUNG = '1' OR kd.TAMNGUNG = '1' THEN '1' ELSE '0' END        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        inner join        (        select  LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')) DUOC_KEY, (SUM(dtk.SOLUONG) - isnull(sum(A.SOLUONG),0) - isnull(sum(B.SOLUONG),0)) SOLUONG, pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        from (select sum(soluong) soluong,duoc_id,nguonduoc_id,khoduoc_id,benhvien_id from TT_DUOC_TONKHO  group by duoc_id,nguonduoc_id,khoduoc_id,benhvien_id) dtk        inner join TM_DUOC_PHAMVISD_MAPPING pvsd on dtk.KHODUOC_ID = pvsd.KHODUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NOITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) B on B.DUOC_ID = dtk.DUOC_ID and B.SOLUONG > 0 and B.PHAMVI_ID = pvsd.PHAMVI_ID and B.NGUONHANG_ID = dtk.NGUONDUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NGOAITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) A on A.DUOC_ID = dtk.DUOC_ID and A.SOLUONG > 0 and A.PHAMVI_ID = pvsd.PHAMVI_ID and A.NGUONHANG_ID = dtk.NGUONDUOC_ID        where dtk.SOLUONG > 0 and dtk.BENHVIEN_ID = 'HLU01'        group by LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')), pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        ) tk on tk.DUOC_ID = d.DUOC_ID        left join TM_DUOC_PHAMVISUDUNG kd on kd.PHAMVI_ID = tk.PHAMVI_ID and kd.BENHVIEN_ID = 'HLU01'        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = tk.NGUONDUOC_ID and nh.BENHVIEN_ID = 'HLU01'        where  d.BENHVIEN_ID = 'HLU01' and d.DUOC_ID in (3)]
2019-08-14 18:07:33,854 [1] DEBUG - Statement Id: [DAO00048_TT_PHAUTHUAT_GetDetail] PreparedStatement : [select PT.*, TN.BENHNHAN_ID              from              TT_PHAUTHUAT PT, TT_TIEPNHAN TN              where              PT.TIEPNHAN_ID = TN.TIEPNHAN_ID              AND PHAUTHUAT_ID  = 3589]
2019-08-14 18:07:33,909 [1] DEBUG - Statement Id: [DAO00048_CheckDVPhauThuatBHYT] PreparedStatement : [select count(0) from TT_VIENPHI          where REF_TABLE = 'TT_DVYEUCAU' and REF_ID = (select top 1 DVYEUCAU_ID from TT_PHAUTHUAT_YEUCAU where PHAUTHUAT_ID =  @param0 )          and TIEPNHAN_ID =  @param1  and BHYT_DONGIA > 0]
2019-08-14 18:07:33,909 [1] DEBUG - Statement Id: [DAO00048_CheckDVPhauThuatBHYT] Parameters: [@param0=[PHAUTHUAT_ID,3589], @param1=[TIEPNHAN_ID,24854]]
2019-08-14 18:07:33,909 [1] DEBUG - Statement Id: [DAO00048_CheckDVPhauThuatBHYT] Types: [@param0=[Int64, System.Int64], @param1=[Int64, System.Int64]]
2019-08-14 18:07:33,973 [1] DEBUG - Statement Id: [DAO00116_File_GetList] PreparedStatement : [select *              from TT_FILE_DINHKEM               where                             TT_FILE_DINHKEM.REF_TABLE = 'TT_PHAUTHUAT'                       and                           TT_FILE_DINHKEM.REF_ID = '3589'                       and                           TT_FILE_DINHKEM.BENHVIEN_ID = 'HLU01'                                     order by FILE_ID]
2019-08-14 18:07:34,139 [1] DEBUG - Statement Id: [DAO00048_TT_VIENPHI_GetList] PreparedStatement : [select *              from TT_VIENPHI               where                             TT_VIENPHI.TIEPNHAN_ID = '24854'                       and                           TT_VIENPHI.REF_TABLE = 'TT_PHAUTHUAT_VTYT'                       and                           TT_VIENPHI.BENHVIEN_ID = 'HLU01'                                     order by VIENPHI_ID]
2019-08-14 18:07:34,289 [1] DEBUG - Statement Id: [DAO00048_GetPhauThuat_VTYT_ByPhauThuatID] PreparedStatement : [SELECT            VTYT.PHAUTHUAT_VTYT_ID,            VTYT.PHAUTHUAT_ID,            VTYT.NGAYSUDUNG,            VTYT.TRANGTHAI_XEM,            VTYT.NGUONGOCDULIEU,            VTYT.NGUOITAO_ID,            VTYT.NGAYTAO,            VTYT.DUOC_ID,            VP.SOLUONG,            VTYT.PHAMVI_ID,            VTYT.KHOSUDUNG_ID AS KHODUOC_ID,            VTYT.CHUNGTU_ID,            VTYT.CHUNGTUTONGHOP_ID,            VTYT.NGUONHANG_ID,            VTYT.TINHTIEN,            VTYT.BNTUCHITRA,            VTYT.KHOTAO_ID,            VTYT.COSO,            VTYT.GHICHU,            VP.DONGIA_DOANHTHU,            VP.THANHTIEN_DOANHTHU,            vp.BHYT_DONGIA,            VP.BHYT_THANHTIEN,            CT.MACHUNGTU AS SOPHIEUXUAT,            PL.MACHUNGTU AS SOPHIEULINH            FROM            TT_PHAUTHUAT_VTYT VTYT            left join TT_PHAUTHUAT  PT on PT.PHAUTHUAT_ID = VTYT.PHAUTHUAT_ID            left join TT_VIENPHI VP  on VTYT.PHAUTHUAT_VTYT_ID = VP.REF_ID and VP.REF_TABLE = 'TT_PHAUTHUAT_VTYT'            left join TT_DUOC_CHUNGTU CT on VTYT.CHUNGTU_ID = CT.CHUNGTU_ID            left join TT_DUOC_PHIEULINH PL on VTYT.CHUNGTUTONGHOP_ID = PL.CHUNGTU_ID            WHERE            PT.PHAUTHUAT_ID =  '3589']
2019-08-14 18:07:34,356 [1] DEBUG - Statement Id: [DAO00063_GetListPhamviTuKhoThuocVaPhongBan] PreparedStatement : [select distinct dpv.*, dmap.KHODUOC_ID        from TM_DUOC_PHAMVISD_MAPPING dmap        left join TM_DUOC_PHAMVISUDUNG dpv on dpv.PHAMVI_ID = dmap.PHAMVI_ID and dpv.TAMNGUNG != '1'        where dmap.KHODUOC_ID in (select KHODUOC_ID from TM_PHONGBAN_KHODUOC where PHONGBAN_ID = '25')        and dmap.KHODUOC_ID = '29' and dpv.MAPHAMVI is not null]
2019-08-14 18:07:39,160 [1] DEBUG - Statement Id: [DAO00048_GetTTPhauThuatVTYT] PreparedStatement : [SELECT              VTYT.PHAUTHUAT_VTYT_ID,              VTYT.PHAUTHUAT_ID,              VTYT.NGAYSUDUNG,              VTYT.TRANGTHAI_XEM,              VTYT.NGUONGOCDULIEU,              VTYT.NGUOITAO_ID,              VTYT.NGAYTAO,              VTYT.DUOC_ID,              VTYT.SOLUONG,              VTYT.KHOSUDUNG_ID AS KHODUOC_ID,              VTYT.CHUNGTU_ID,              VTYT.CHUNGTUTONGHOP_ID,              VTYT.NGUONHANG_ID,              VTYT.TINHTIEN,              VTYT.BNTUCHITRA,              VTYT.GHICHU              ,max(VP.DONGIA_DOANHTHU) AS DONGIABAN,              sum(isnull(VP.BENHNHAN_PHAITHANHTOAN,0))  BENHNHAN_PHAITHANHTOAN,              sum(isnull(VP.THANHTIEN_DOANHTHU,0)) THANHTIEN_DOANHTHU,              CT.MACHUNGTU AS SOPHIEUXUAT,              PL.MACHUNGTU AS SOPHIEULINH              FROM              TT_PHAUTHUAT_VTYT VTYT              left join TT_PHAUTHUAT  PT              on PT.PHAUTHUAT_ID = VTYT.PHAUTHUAT_ID              left join TT_VIENPHI VP              on VTYT.PHAUTHUAT_VTYT_ID = VP.REF_ID              and VP.REF_TABLE = 'TT_PHAUTHUAT_VTYT'              left join TT_DUOC_CHUNGTU CT              on VTYT.CHUNGTU_ID = CT.CHUNGTU_ID              left join TT_DUOC_PHIEULINH PL              on VTYT.CHUNGTUTONGHOP_ID = PL.CHUNGTU_ID              WHERE              VTYT.PHAUTHUAT_VTYT_ID = 1242              group by  VTYT.PHAUTHUAT_VTYT_ID,              VTYT.PHAUTHUAT_ID,              VTYT.NGAYSUDUNG,              VTYT.TRANGTHAI_XEM,              VTYT.NGUONGOCDULIEU,              VTYT.NGUOITAO_ID,              VTYT.NGAYTAO,              VTYT.DUOC_ID,              VTYT.SOLUONG,              VTYT.KHOSUDUNG_ID ,              VTYT.CHUNGTU_ID,              VTYT.CHUNGTUTONGHOP_ID,              VTYT.NGUONHANG_ID,              VTYT.TINHTIEN,              VTYT.BNTUCHITRA,              VTYT.GHICHU,              CT.MACHUNGTU ,              PL.MACHUNGTU]
2019-08-14 18:07:47,384 [1] DEBUG - Statement Id: [DAO00066_GetBENHAN_TIEPNHAN] PreparedStatement : [select top 1 *        from TT_NOITRU_BENHAN        where TIEPNHAN_ID = '24854'  and BENHVIEN_ID = 'HLU01'        order by NGAYTAO desc]
2019-08-14 18:07:47,607 [1] DEBUG - Statement Id: [DAO00014_GetInPatientStatus] PreparedStatement : [select TRANGTHAI, isnull(KHOACHUYENDEN_ID, KHOAVAO_ID) as KHOAHIENTAI from TT_NOITRU_BENHAN        where        TIEPNHAN_ID = '24854'        and BENHVIEN_ID = 'HLU01'         and           BENHAN_ID = '5289']
2019-08-14 18:07:48,372 [1] DEBUG - Statement Id: [DAO00014_GetORMServiceStatus] PreparedStatement : [select dvyc.TRANGTHAI, pt.NGUOIKHOA_ID, pt.NGUOITAO_ID        from TT_PHAUTHUAT pt        left join TT_PHAUTHUAT_YEUCAU ptyc on ptyc.PHAUTHUAT_ID = pt.PHAUTHUAT_ID        left join (select * from TT_DVYEUCAU where exists (select DVYEUCAU_ID from TT_PHAUTHUAT where TT_DVYEUCAU.DVYEUCAU_ID = DVYEUCAU_ID and PHAUTHUAT_ID = '3589')) dvyc        on ptyc.DVYEUCAU_ID = dvyc.DVYEUCAU_ID        where pt.PHAUTHUAT_ID = '3589']
2019-08-14 18:08:25,610 [1] DEBUG - Statement Id: [DAO00048_GetPhauThuat_VTYT_ByPhauThuatID] PreparedStatement : [SELECT            VTYT.PHAUTHUAT_VTYT_ID,            VTYT.PHAUTHUAT_ID,            VTYT.NGAYSUDUNG,            VTYT.TRANGTHAI_XEM,            VTYT.NGUONGOCDULIEU,            VTYT.NGUOITAO_ID,            VTYT.NGAYTAO,            VTYT.DUOC_ID,            VP.SOLUONG,            VTYT.PHAMVI_ID,            VTYT.KHOSUDUNG_ID AS KHODUOC_ID,            VTYT.CHUNGTU_ID,            VTYT.CHUNGTUTONGHOP_ID,            VTYT.NGUONHANG_ID,            VTYT.TINHTIEN,            VTYT.BNTUCHITRA,            VTYT.KHOTAO_ID,            VTYT.COSO,            VTYT.GHICHU,            VP.DONGIA_DOANHTHU,            VP.THANHTIEN_DOANHTHU,            vp.BHYT_DONGIA,            VP.BHYT_THANHTIEN,            CT.MACHUNGTU AS SOPHIEUXUAT,            PL.MACHUNGTU AS SOPHIEULINH            FROM            TT_PHAUTHUAT_VTYT VTYT            left join TT_PHAUTHUAT  PT on PT.PHAUTHUAT_ID = VTYT.PHAUTHUAT_ID            left join TT_VIENPHI VP  on VTYT.PHAUTHUAT_VTYT_ID = VP.REF_ID and VP.REF_TABLE = 'TT_PHAUTHUAT_VTYT'            left join TT_DUOC_CHUNGTU CT on VTYT.CHUNGTU_ID = CT.CHUNGTU_ID            left join TT_DUOC_PHIEULINH PL on VTYT.CHUNGTUTONGHOP_ID = PL.CHUNGTU_ID            WHERE            PT.PHAUTHUAT_ID =  '3589']
2019-08-14 18:09:24,999 [1] DEBUG - Statement Id: [DAO00030_GetMucDichChungTuID] PreparedStatement : [SELECT DICTIONARY_ID              FROM              LST_DICTIONARY              WHERE              DICTIONARY_TYPE_CODE = 'MucDichChungTu'              and DICTIONARY_CODE = 'X13']
2019-08-14 18:09:25,188 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'PHA22'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2019-08-14 18:09:25,469 [1] DEBUG - Statement Id: [DAO00012_GetList] PreparedStatement : [select        DICTIONARY_ID,        DICTIONARY_CODE,        DICTIONARY_NAME,        ATTRIBUTE1,        ATTRIBUTE2,        DICTIONARY_NAME_EN        from LST_DICTIONARY        where LST_DICTIONARY.Enabled = '1'         AND           LST_DICTIONARY.DICTIONARY_TYPE_CODE = 'LyDoXuatSuDung'                 order by LST_DICTIONARY.IDX]
2019-08-14 18:09:25,859 [1] DEBUG - Statement Id: [DAO00030_GET_SOLONHAP] PreparedStatement : [SELECT DISTINCT            SLN.SOLONHAP_ID, SLN.SOLONHAP, SLN.SOLOSANPHAM, SLN.SOKIEMSOAT, SLN.SOVISA, CONVERT(varchar(20), SLN.SOLOSANPHAM) + '/' + CONVERT(varchar(20), TK.SOLUONG) AS SOLOSOTON,            SLN.NGAYNHAP AS NGAYNHAPLO, SLN.HANDUNG AS HANSUDUNG,  SLN.HANDUNG, SLN.NGUONDUOC_ID, SLN.NGUONDUOC_ID as NGUONHANG_ID,            SLNGB.DONGIAMUA, SLNGB.DONGIAVON, SLNGB.TYLEVAT_DAUVAO as TYLEVAT, d.TYLE_VAT, SLNGB.DONGIAVONVAT, SLNGB.DONGIABAN, SLNGB.DONGIABANVAT_DAUVAO as DONGIABAN_VAT,            TK.DUOCTONKHO_ID, TK.KHODUOC_ID, TK.DUOC_ID, TK.SOLUONG, TK.SOLUONG AS SOLUONGTON,            D.TENDUOCDAYDU,D.DONVITINH_ID, D.DONVITINH, D.BHYT, NH.TENNGUONDUOC AS NGUONHANG,            LTRIM(TK.KHODUOC_ID) + '_' + LTRIM(TK.DUOC_ID) + '_' + LTRIM(TK.NGUONDUOC_ID) as DUOC_KEY, D.SO_QDTT            FROM            TT_DUOC_CHUNGTU_SOLONHAP SLN,            TT_DUOC_TONKHO TK,            TT_DUOC_SOLONHAP_GIABAN SLNGB,            TM_DUOC D,            TM_NGUONHANG NH            WHERE            SLN.SOLONHAP_ID = TK.SOLONHAP_ID            AND SLN.SOLONHAP_ID = SLNGB.SOLONHAP_ID            AND SLN.NGUONDUOC_ID = NH.NGUONDUOC_ID            AND SLN.DUOC_ID = D.DUOC_ID            AND TK.DUOC_ID = ''            AND TK.KHODUOC_ID = ''            AND SLN.BENHVIEN_ID = 'HLU01'            AND TK.SOLUONG > 0                 and                     SLN.NGUONDUOC_ID = '1'                                      ORDER BY NGAYNHAP]
2019-08-14 18:09:25,983 [1] DEBUG - Statement Id: [DAO00030_GetMucDichChungTuID] PreparedStatement : [SELECT DICTIONARY_ID              FROM              LST_DICTIONARY              WHERE              DICTIONARY_TYPE_CODE = 'MucDichChungTu'              and DICTIONARY_CODE = 'X13']
2019-08-14 18:09:26,148 [1] DEBUG - Statement Id: [DAO00030_GetMucDichChungTuID] PreparedStatement : [SELECT DICTIONARY_ID              FROM              LST_DICTIONARY              WHERE              DICTIONARY_TYPE_CODE = 'MucDichChungTu'              and DICTIONARY_CODE = 'X13']
2019-08-14 18:09:26,575 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'PHA74'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2019-08-14 18:09:29,619 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'COM98'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2019-08-14 18:09:30,200 [1] DEBUG - Statement Id: [DAO00030_Search_PhieuXuatSD] PreparedStatement : [SELECT DISTINCT phieuxuat.* FROM          (          select DISTINCT          CT.CHUNGTU_ID,          CT.SOCHUNGTU,          CT.MACHUNGTU,          CT.NGAYCHUNGTU,          CT.NGAYTAO,          CT.KHOXUAT_ID,          CT.NGUOIGIAO_ID,          CT.KHONHAP_ID,          CT.NGUOINHAN_ID,          PL.MACHUNGTU as MAPHIEULINH,          PL.NGAYCHUNGTU as NGAYPHIEULINH,          bn.MAYTE,          bn.TENBENHNHAN,          CONVERT(VARCHAR(10), KB.THOIGIANKHAM, 103) + ' - ' + CONVERT(VARCHAR(5), KB.THOIGIANKHAM, 108) as THOIGIANKHAM,          nl.TENNHANVIEN as NGUOILAP,          CT.DIENGIAI          from TT_DUOC_CHUNGTU CT          inner join TT_DUOC_CHUNGTU_CHITIET ctct on ct.CHUNGTU_ID = ctct.CHUNGTU_ID          inner join TT_NOITRU_TOATHUOC TT on ctct.TOATHUOCNOITRU_ID = TT.TOATHUOC_ID          inner join TT_NOITRU_KHAMBENH KB on kb.KHAMBENH_ID = TT.KHAMBENH_ID          inner join TT_BENHNHAN BN on TT.BENHNHAN_ID = BN.BENHNHAN_ID          left join TT_DUOC_PHIEULINH PL on PL.CHUNGTU_ID = CT.PHIEULINH_ID          left join TM_NHANVIEN nl on nl.NHANVIEN_ID = TT.NGUOITAO_ID           where                   CT.MUCDICHCHUNGTU_ID = '1060'               and                 CT.KHOXUAT_ID = '29'               and                 CONVERT(date, CT.NGAYCHUNGTU) BETWEEN CONVERT(date, '8/14/2019 12:00:00 AM')  and  CONVERT(date, '8/14/2019 12:00:00 AM')               and                 CT.BENHVIEN_ID = 'HLU01'                           UNION            select DISTINCT          CT.CHUNGTU_ID,          CT.SOCHUNGTU,          CT.MACHUNGTU,          CT.NGAYCHUNGTU,          CT.NGAYTAO,          CT.KHOXUAT_ID,          CT.NGUOIGIAO_ID,          CT.KHONHAP_ID,          CT.NGUOINHAN_ID,          PL.MACHUNGTU as MAPHIEULINH,          PL.NGAYCHUNGTU as NGAYPHIEULINH,          bn.MAYTE,          bn.TENBENHNHAN,          CONVERT(VARCHAR(10), KB.THOIGIANKHAM, 103) + ' - ' + CONVERT(VARCHAR(5), KB.THOIGIANKHAM, 108) as THOIGIANKHAM,          nl.TENNHANVIEN as NGUOILAP,          CT.DIENGIAI          from TT_DUOC_CHUNGTU CT          inner join TT_DUOC_CHUNGTU_CHITIET ctct on ct.CHUNGTU_ID = ctct.CHUNGTU_ID          inner join TT_NGOAITRU_KHAMBENH_VTYT vt on ctct.KHAMBENH_VTYT_ID = vt.KHAMBENH_VTYT_ID          inner join TT_NGOAITRU_KHAMBENH kb on kb.KHAMBENH_ID = vt.KHAMBENH_ID          inner join TT_BENHNHAN BN on bn.BENHNHAN_ID = kb.BENHNHAN_ID          left join TT_DUOC_PHIEULINH PL on PL.CHUNGTU_ID = CT.PHIEULINH_ID          left join TM_NHANVIEN nl on nl.NHANVIEN_ID = vt.NGUOITAO_ID           where                   CT.MUCDICHCHUNGTU_ID = '1060'               and                 CT.KHOXUAT_ID = '29'               and                 CONVERT(date, CT.NGAYCHUNGTU) BETWEEN CONVERT(date, '8/14/2019 12:00:00 AM')  and  CONVERT(date, '8/14/2019 12:00:00 AM')               and                 CT.BENHVIEN_ID = 'HLU01'                           UNION            select DISTINCT          CT.CHUNGTU_ID,          CT.SOCHUNGTU,          CT.MACHUNGTU,          CT.NGAYCHUNGTU,          CT.NGAYTAO,          CT.KHOXUAT_ID,          CT.NGUOIGIAO_ID,          CT.KHONHAP_ID,          CT.NGUOINHAN_ID,          PL.MACHUNGTU as MAPHIEULINH,          PL.NGAYCHUNGTU as NGAYPHIEULINH,          bn.MAYTE,          bn.TENBENHNHAN,          CONVERT(VARCHAR(10), pt.NGAYTHUCHIEN, 103) + ' - ' + CONVERT(VARCHAR(5), pt.NGAYTHUCHIEN, 108) as THOIGIANKHAM,          nl.TENNHANVIEN as NGUOILAP,          CT.DIENGIAI          from TT_DUOC_CHUNGTU CT          inner join TT_DUOC_CHUNGTU_CHITIET ctct on ct.CHUNGTU_ID = ctct.CHUNGTU_ID          inner join TT_PHAUTHUAT_VTYT vt on ctct.PHAUTHUAT_VTYT_ID = vt.PHAUTHUAT_VTYT_ID          inner join TT_PHAUTHUAT pt on pt.PHAUTHUAT_ID = vt.PHAUTHUAT_ID          inner join TT_TIEPNHAN tn on tn.TIEPNHAN_ID = pt.TIEPNHAN_ID          inner join TT_BENHNHAN bn on bn.BENHNHAN_ID = tn.BENHNHAN_ID          left join TT_DUOC_PHIEULINH PL on PL.CHUNGTU_ID = CT.PHIEULINH_ID          left join TM_NHANVIEN nl on nl.NHANVIEN_ID = pt.NGUOITAO_ID           where                   CT.MUCDICHCHUNGTU_ID = '1060'               and                 CT.KHOXUAT_ID = '29'               and                 CONVERT(date, CT.NGAYCHUNGTU) BETWEEN CONVERT(date, '8/14/2019 12:00:00 AM')  and  CONVERT(date, '8/14/2019 12:00:00 AM')               and                 CT.BENHVIEN_ID = 'HLU01'                           UNION            select DISTINCT          CT.CHUNGTU_ID,          CT.SOCHUNGTU,          CT.MACHUNGTU,          CT.NGAYCHUNGTU,          CT.NGAYTAO,          CT.KHOXUAT_ID,          CT.NGUOIGIAO_ID,          CT.KHONHAP_ID,          CT.NGUOINHAN_ID,          PL.MACHUNGTU as MAPHIEULINH,          PL.NGAYCHUNGTU as NGAYPHIEULINH,          bn.MAYTE,          bn.TENBENHNHAN,          CONVERT(VARCHAR(10), cls.NGAYTAO, 103) + ' - ' + CONVERT(VARCHAR(5), cls.NGAYTAO, 108) as THOIGIANKHAM,          nl.TENNHANVIEN as NGUOILAP,          CT.DIENGIAI          from TT_DUOC_CHUNGTU CT          inner join TT_DUOC_CHUNGTU_CHITIET ctct on ct.CHUNGTU_ID = ctct.CHUNGTU_ID          inner join TT_CLSKETQUA_VTYT cls on ctct.CLSKETQUA_VTYT_ID = cls.CLSKETQUA_VTYT_ID          inner join TT_DVYEUCAU DV on DV.DVYEUCAU_ID = CLS.DVYEUCAU_ID          inner join TT_BENHNHAN bn on bn.BENHNHAN_ID = DV.BENHNHAN_ID          left join TT_DUOC_PHIEULINH PL on PL.CHUNGTU_ID = CT.PHIEULINH_ID          left join TM_NHANVIEN nl on nl.NHANVIEN_ID = cls.NGUOITAO_ID           where                   CT.MUCDICHCHUNGTU_ID = '1060'               and                 CT.KHOXUAT_ID = '29'               and                 CONVERT(date, CT.NGAYCHUNGTU) BETWEEN CONVERT(date, '8/14/2019 12:00:00 AM')  and  CONVERT(date, '8/14/2019 12:00:00 AM')               and                 CT.BENHVIEN_ID = 'HLU01'                           UNION            select DISTINCT          CT.CHUNGTU_ID,          CT.SOCHUNGTU,          CT.MACHUNGTU,          CT.NGAYCHUNGTU,          CT.NGAYTAO,          CT.KHOXUAT_ID,          CT.NGUOIGIAO_ID,          CT.KHONHAP_ID,          CT.NGUOINHAN_ID,          PL.MACHUNGTU as MAPHIEULINH,          PL.NGAYCHUNGTU as NGAYPHIEULINH,          null as MAYTE,          null as TENBENHNHAN,          null as THOIGIANKHAM,          nl.TENNHANVIEN as NGUOILAP,          CT.DIENGIAI          from TT_DUOC_CHUNGTU CT          inner join TT_DUOC_CHUNGTU_CHITIET ctct on ct.CHUNGTU_ID = ctct.CHUNGTU_ID          left join TT_DUOC_PHIEULINH PL on PL.CHUNGTU_ID = CT.PHIEULINH_ID          left join TM_NHANVIEN nl on nl.NHANVIEN_ID = ct.NGUOITAO_ID          WHERE (ctct.TOATHUOCNOITRU_ID IS NULL AND ctct.KHAMBENH_VTYT_ID IS NULL AND ctct.PHAUTHUAT_VTYT_ID IS NULL AND ctct.CLSKETQUA_VTYT_ID IS NULL)             and                 CT.MUCDICHCHUNGTU_ID = '1060'               and                 CT.KHOXUAT_ID = '29'               and                 CONVERT(date, CT.NGAYCHUNGTU) BETWEEN CONVERT(date, '8/14/2019 12:00:00 AM')  and  CONVERT(date, '8/14/2019 12:00:00 AM')               and                 CT.BENHVIEN_ID = 'HLU01'                         )PhieuXuat          ORDER BY PhieuXuat.CHUNGTU_ID desc]
2019-08-14 18:09:38,243 [1] DEBUG - Statement Id: [DAO00030_GetList] PreparedStatement : [select *              from TT_DUOC_CHUNGTU              where BENHVIEN_ID = 'HLU01'                and                   TT_DUOC_CHUNGTU.CHUNGTU_ID = '137701'                               order by CHUNGTU_ID]
2019-08-14 18:09:38,581 [1] DEBUG - Statement Id: [DAO00030_CHUNGTUXUAT_CHITIET_GetList] PreparedStatement : [SELECT            ctct.*,            d.MADUOC, d.TENHANG, d.TENDUOCDAYDU, dvt.TENDONVITINH as DONVITINH,n.TENNGUONDUOC as NGUONHANG,            sln.SOLONHAP, sln.SOLOSANPHAM, sln.NGAYNHAP as NGAYNHAPLO, sln.HANDUNG as HANSUDUNG,            isnull(tk.SOLUONG,0) as SOLUONGTON,            LTRIM(ct.KHOXUAT_ID) + '_' + LTRIM(sln.DUOC_ID) + '_' + LTRIM(sln.NGUONDUOC_ID) as DUOC_KEY            , NLD.MANHOMLOAIDUOC, ld.MALOAIDUOC, D.SO_QDTT            FROM            TT_DUOC_CHUNGTU_CHITIET ctct            INNER JOIN TT_DUOC_CHUNGTU ct ON (ct.CHUNGTU_ID = ctct.CHUNGTU_ID)            INNER JOIN TT_DUOC_CHUNGTU_SOLONHAP sln ON (sln.SOLONHAP_ID = ctct.SOLONHAP_ID)            LEFT JOIN (            select xx.DUOCTONKHO_ID, xx.KHODUOC_ID, xx.DUOC_ID, xx.SOLONHAP_ID, xx.SOLUONG, xx.NGUONDUOC_ID, xx.BENHVIEN_ID from TT_DUOC_TONKHO xx            join ( select max(DUOCTONKHO_ID) as DUOCTONKHO_ID, KHODUOC_ID, DUOC_ID, SOLONHAP_ID, NGUONDUOC_ID            from TT_DUOC_TONKHO group by KHODUOC_ID, DUOC_ID, SOLONHAP_ID, NGUONDUOC_ID) yy on xx.DUOCTONKHO_ID=yy.DUOCTONKHO_ID            ) tk ON (tk.SOLONHAP_ID = sln.SOLONHAP_ID AND tk.DUOC_ID = sln.DUOC_ID and tk.KHODUOC_ID = ct.KHOXUAT_ID)            INNER JOIN TM_DUOC d ON (d.DUOC_ID = ctct.DUOC_ID)            INNER JOIN TM_NGUONHANG n ON (n.NGUONDUOC_ID = ctct.NGUONHANG_ID)            LEFT JOIN TM_DONVITINH dvt ON (dvt.DONVITINH_ID = ctct.DONVITINH_ID)            left join TM_LOAIDUOC LD on LD.LOAIDUOC_ID = D.LOAIDUOC_ID            LEFT JOIN TM_NHOMLOAIDUOC NLD on NLD.NHOMLOAIDUOC_ID = LD.NHOMLOAIDUOC_ID             where                             ct.CHUNGTU_ID = '137701'                       and                           ct.BENHVIEN_ID = 'HLU01'                                     order by CHUNGTUCHITIET_ID]
2019-08-14 18:09:39,094 [1] DEBUG - Statement Id: [DAO00030_KiemTraChungTuKhoaSo] PreparedStatement : [SELECT CHUNGTU_ID              FROM TT_DUOC_CHUNGTU              WHERE              MACHUNGTU = 'CS_GMHSX1319002657'              and BENHVIEN_ID = 'HLU01'              and              convert(date, NGAYCHUNGTU) <=              (              SELECT TOP 1 convert(date, KHOADENNGAY)              FROM TT_DUOC_KHOASOCHUNGTU              WHERE              KHODUOC_ID = '29'              and BENHVIEN_ID = 'HLU01'              AND KHOASO = '1'              ORDER BY KHOADENNGAY DESC              )]
2019-08-14 18:09:39,310 [1] DEBUG - Statement Id: [DAO00030_KiemTraChungTuDaChuyenKeToan] PreparedStatement : [SELECT CHUNGTU_ID            FROM TT_DUOC_CHUNGTU            WHERE            CHUNGTU_ID = '137701'            and IDCHUYEN IS NOT NULL            and BENHVIEN_ID = 'HLU01']
2019-08-14 18:09:39,357 [1] DEBUG - Statement Id: [DAO00030_KiemTraBenhNhanXuatVien] PreparedStatement : [select              TT.TOATHUOC_ID              from              TT_NOITRU_TOATHUOC TT              inner join TT_NOITRU_KHAMBENH KB on TT.KHAMBENH_ID = KB.KHAMBENH_ID              inner join TT_NOITRU_BENHAN BA on BA.BENHAN_ID = KB.BENHAN_ID              WHERE              BA.TRANGTHAI = 'DAXUATVIEN'              AND TT.CHUNGTU_ID =  137701              and TT.BENHVIEN_ID = 'HLU01']
2019-08-14 18:09:49,878 [1] DEBUG - Statement Id: [DAO00030_DUOCTONKHO_GetSoTonTheoDuoc] PreparedStatement : [SELECT              DUOC_ID,              SUM(SOLUONG) AS TONGTON              FROM              TT_DUOC_TONKHO              WHERE              KHODUOC_ID = '29'              and BENHVIEN_ID = 'HLU01'              and DUOC_ID IN (3)              GROUP BY DUOC_ID]
2019-08-14 18:09:49,956 [1] DEBUG - Statement Id: [DAO00030_DUOCTONKHO_GetSoTonTheoDuocTheoLo] PreparedStatement : [SELECT              DUOC_ID,SOLONHAP_ID,              SUM(SOLUONG) AS SOLUONGTONLO              FROM              TT_DUOC_TONKHO              WHERE              KHODUOC_ID = '29'              and BENHVIEN_ID = 'HLU01'              and DUOC_ID IN (3)              and SOLONHAP_ID IN (9260)              GROUP BY DUOC_ID, SOLONHAP_ID]
2019-08-14 18:09:50,083 [1] DEBUG - Statement Id: [DAO00030_DUOCTONKHO_GetSoTonTheoDuoc] PreparedStatement : [SELECT              DUOC_ID,              SUM(SOLUONG) AS TONGTON              FROM              TT_DUOC_TONKHO              WHERE              KHODUOC_ID = '29'              and BENHVIEN_ID = 'HLU01'              and DUOC_ID IN (3)              GROUP BY DUOC_ID]
2019-08-14 18:09:50,162 [1] DEBUG - Statement Id: [DAO00030_KTDaPhatSinhBienLai] PreparedStatement : [SELECT CHUNGTU_ID            FROM TT_NOITRU_TOATHUOC tt            INNER JOIN TT_VIENPHI vp on (tt.TOATHUOC_ID = vp.REF_ID and REF_TABLE = 'TT_NOITRU_TOATHUOC')            WHERE            CHUNGTU_ID = '137701'            AND tt.BENHVIEN_ID = 'HLU01'            AND HOADON_ID is not NULL            AND vp.HUY = '0'              union all            SELECT  kbtt.CHUNGTUPHATTHUOC_ID as CHUNGTU_ID            FROM TT_NGOAITRU_TOATHUOC tt            INNER JOIN TT_NGOAITRU_KHAMBENH_TOATHUOC kbtt on (kbtt.KHAMBENH_TOATHUOC_ID = tt.KHAMBENH_TOATHUOC_ID)            INNER JOIN TT_VIENPHI vp on (tt.TOATHUOC_ID = vp.REF_ID and REF_TABLE = 'TT_NGOAITRU_TOATHUOC')            WHERE            kbtt.CHUNGTUPHATTHUOC_ID = '137701'            AND tt.BENHVIEN_ID = 'HLU01'            AND HOADON_ID is not NULL            AND vp.HUY = '0'              union all            SELECT ctct.CHUNGTU_ID from            TT_DUOC_CHUNGTU_CHITIET ctct            INNER JOIN TT_HOADON_CHITIET_NGOAITRU hdct on (hdct.REF_ID = ctct.CHUNGTUCHITIET_ID and hdct.REF_TABLE = 'TT_DUOC_CHUNGTU_CHITIET')            INNER JOIN TT_HOADON hd on hd.HOADON_ID = hdct.HOADON_ID            WHERE            ctct.CHUNGTU_ID = '137701'                            AND hd.HUYHOADON = '0'              AND hd.HOANTRA = '0'                                  AND ctct.BENHVIEN_ID = 'HLU01'                        union all            SELECT CHUNGTU_ID            FROM TT_NGOAITRU_KHAMBENH_VTYT tt            INNER JOIN TT_VIENPHI vp on (tt.KHAMBENH_VTYT_ID = vp.REF_ID and REF_TABLE = 'TT_NGOAITRU_KHAMBENH_VTYT')            WHERE            CHUNGTU_ID = '137701'            AND tt.BENHVIEN_ID = 'HLU01'            AND HOADON_ID is not NULL            AND vp.HUY = '0'                        union all            SELECT CHUNGTU_ID            FROM TT_PHAUTHUAT_VTYT tt            INNER JOIN TT_VIENPHI vp on (tt.PHAUTHUAT_VTYT_ID = vp.REF_ID and REF_TABLE = 'TT_PHAUTHUAT_VTYT')            WHERE            CHUNGTU_ID = '137701'            AND tt.BENHVIEN_ID = 'HLU01'            AND HOADON_ID is not NULL            AND vp.HUY = '0'                        union all            SELECT CHUNGTU_ID            FROM TT_CLSKETQUA_VTYT tt            INNER JOIN TT_VIENPHI vp on (tt.CLSKETQUA_VTYT_ID = vp.REF_ID and REF_TABLE = 'TT_CLSKETQUA_VTYT')            WHERE            CHUNGTU_ID = '137701'            AND tt.BENHVIEN_ID = 'HLU01'            AND HOADON_ID is not NULL            AND vp.HUY = '0']
2019-08-14 18:10:00,425 [1] DEBUG - Statement Id: [DAO00030_KTDaPhatSinhBienLai] PreparedStatement : [SELECT CHUNGTU_ID            FROM TT_NOITRU_TOATHUOC tt            INNER JOIN TT_VIENPHI vp on (tt.TOATHUOC_ID = vp.REF_ID and REF_TABLE = 'TT_NOITRU_TOATHUOC')            WHERE            CHUNGTU_ID = '137701'            AND tt.BENHVIEN_ID = 'HLU01'            AND HOADON_ID is not NULL            AND vp.HUY = '0'              union all            SELECT  kbtt.CHUNGTUPHATTHUOC_ID as CHUNGTU_ID            FROM TT_NGOAITRU_TOATHUOC tt            INNER JOIN TT_NGOAITRU_KHAMBENH_TOATHUOC kbtt on (kbtt.KHAMBENH_TOATHUOC_ID = tt.KHAMBENH_TOATHUOC_ID)            INNER JOIN TT_VIENPHI vp on (tt.TOATHUOC_ID = vp.REF_ID and REF_TABLE = 'TT_NGOAITRU_TOATHUOC')            WHERE            kbtt.CHUNGTUPHATTHUOC_ID = '137701'            AND tt.BENHVIEN_ID = 'HLU01'            AND HOADON_ID is not NULL            AND vp.HUY = '0'              union all            SELECT ctct.CHUNGTU_ID from            TT_DUOC_CHUNGTU_CHITIET ctct            INNER JOIN TT_HOADON_CHITIET_NGOAITRU hdct on (hdct.REF_ID = ctct.CHUNGTUCHITIET_ID and hdct.REF_TABLE = 'TT_DUOC_CHUNGTU_CHITIET')            INNER JOIN TT_HOADON hd on hd.HOADON_ID = hdct.HOADON_ID            WHERE            ctct.CHUNGTU_ID = '137701'                            AND hd.HUYHOADON = '0'              AND hd.HOANTRA = '0'                                  AND ctct.BENHVIEN_ID = 'HLU01'                        union all            SELECT CHUNGTU_ID            FROM TT_NGOAITRU_KHAMBENH_VTYT tt            INNER JOIN TT_VIENPHI vp on (tt.KHAMBENH_VTYT_ID = vp.REF_ID and REF_TABLE = 'TT_NGOAITRU_KHAMBENH_VTYT')            WHERE            CHUNGTU_ID = '137701'            AND tt.BENHVIEN_ID = 'HLU01'            AND HOADON_ID is not NULL            AND vp.HUY = '0'                        union all            SELECT CHUNGTU_ID            FROM TT_PHAUTHUAT_VTYT tt            INNER JOIN TT_VIENPHI vp on (tt.PHAUTHUAT_VTYT_ID = vp.REF_ID and REF_TABLE = 'TT_PHAUTHUAT_VTYT')            WHERE            CHUNGTU_ID = '137701'            AND tt.BENHVIEN_ID = 'HLU01'            AND HOADON_ID is not NULL            AND vp.HUY = '0'                        union all            SELECT CHUNGTU_ID            FROM TT_CLSKETQUA_VTYT tt            INNER JOIN TT_VIENPHI vp on (tt.CLSKETQUA_VTYT_ID = vp.REF_ID and REF_TABLE = 'TT_CLSKETQUA_VTYT')            WHERE            CHUNGTU_ID = '137701'            AND tt.BENHVIEN_ID = 'HLU01'            AND HOADON_ID is not NULL            AND vp.HUY = '0']
2019-08-14 18:10:00,707 [1] DEBUG - Statement Id: [DAO00030_KTDaPhatSinhPhieuBHTN] PreparedStatement : [SELECT vp.VIENPHI_ID              FROM TT_VIENPHI vp              INNER JOIN TT_MIENGIAM_CHITIET  mgct on mgct.VIENPHI_ID = vp.VIENPHI_ID              INNER JOIN TT_DUOC_CHUNGTU ct on ct.TIEPNHAN_ID = vp.TIEPNHAN_ID              WHERE              ct.CHUNGTU_ID = '137701'              AND vp.DUOC_ID is not null              AND vp.BENHVIEN_ID = 'HLU01']
2019-08-14 18:10:00,935 [1] DEBUG - Statement Id: [DAO00030_KiemTraBenhNhanXuatVien] PreparedStatement : [select              TT.TOATHUOC_ID              from              TT_NOITRU_TOATHUOC TT              inner join TT_NOITRU_KHAMBENH KB on TT.KHAMBENH_ID = KB.KHAMBENH_ID              inner join TT_NOITRU_BENHAN BA on BA.BENHAN_ID = KB.BENHAN_ID              WHERE              BA.TRANGTHAI = 'DAXUATVIEN'              AND TT.CHUNGTU_ID =  137701              and TT.BENHVIEN_ID = 'HLU01']
2019-08-14 18:10:01,152 [1] DEBUG - Statement Id: [DAO00030_KiemTraChungTuKhoaSo] PreparedStatement : [SELECT CHUNGTU_ID              FROM TT_DUOC_CHUNGTU              WHERE              MACHUNGTU = 'CS_GMHSX1319002657'              and BENHVIEN_ID = 'HLU01'              and              convert(date, NGAYCHUNGTU) <=              (              SELECT TOP 1 convert(date, KHOADENNGAY)              FROM TT_DUOC_KHOASOCHUNGTU              WHERE              KHODUOC_ID = '29'              and BENHVIEN_ID = 'HLU01'              AND KHOASO = '1'              ORDER BY KHOADENNGAY DESC              )]
2019-08-14 18:10:01,203 [1] DEBUG - Statement Id: [DAO00030_GetList] PreparedStatement : [select *              from TT_DUOC_CHUNGTU              where BENHVIEN_ID = 'HLU01'                and                   TT_DUOC_CHUNGTU.MACHUNGTU = 'CS_GMHSX1319002657'                               order by CHUNGTU_ID]
2019-08-14 18:10:01,335 [1] DEBUG - Statement Id: [DAO00030_KiemTraBenhNhanXuatVien] PreparedStatement : [select              TT.TOATHUOC_ID              from              TT_NOITRU_TOATHUOC TT              inner join TT_NOITRU_KHAMBENH KB on TT.KHAMBENH_ID = KB.KHAMBENH_ID              inner join TT_NOITRU_BENHAN BA on BA.BENHAN_ID = KB.BENHAN_ID              WHERE              BA.TRANGTHAI = 'DAXUATVIEN'              AND TT.CHUNGTU_ID =  137701              and TT.BENHVIEN_ID = 'HLU01']
2019-08-14 18:10:02,673 [1] DEBUG - Statement Id: [DAO00030_GetList] PreparedStatement : [select *              from TT_DUOC_CHUNGTU              where BENHVIEN_ID = 'HLU01'                and                   TT_DUOC_CHUNGTU.MACHUNGTU = 'CS_GMHSX1319002657'                               order by CHUNGTU_ID]
2019-08-14 18:10:02,785 [1] DEBUG - Statement Id: [DAO00030_KiemTraBenhNhanXuatVien] PreparedStatement : [select              TT.TOATHUOC_ID              from              TT_NOITRU_TOATHUOC TT              inner join TT_NOITRU_KHAMBENH KB on TT.KHAMBENH_ID = KB.KHAMBENH_ID              inner join TT_NOITRU_BENHAN BA on BA.BENHAN_ID = KB.BENHAN_ID              WHERE              BA.TRANGTHAI = 'DAXUATVIEN'              AND TT.CHUNGTU_ID =  137701              and TT.BENHVIEN_ID = 'HLU01']
2019-08-14 18:10:02,953 [1] DEBUG - Statement Id: [DAO00030_GetList] PreparedStatement : [select *              from TT_DUOC_CHUNGTU              where BENHVIEN_ID = 'HLU01'                and                   TT_DUOC_CHUNGTU.MACHUNGTU = 'CS_GMHSX1319002657'                               order by CHUNGTU_ID]
2019-08-14 18:10:03,468 [1] DEBUG - Statement Id: [DAO00030_CHUNGTUCT_DeleteP] PreparedStatement : [delete from TT_DUOC_CHUNGTU_CHITIET               where                             TT_DUOC_CHUNGTU_CHITIET.CHUNGTU_ID = '137701']
2019-08-14 18:10:03,570 [1] DEBUG - Statement Id: [DAO00030_TT_DUOC_TONKHO_LOG_Add] PreparedStatement : [DECLARE @KHODUOC_ID int               DECLARE @TONTRUOC numeric(18, 4)               DECLARE @TONSAU numeric(18, 4)               DECLARE @SOLUONGNHAP numeric(18, 4)               DECLARE @SOLUONGXUAT numeric(18, 4)                              IF( @param0  = 'N')               BEGIN                SET @KHODUOC_ID =  @param1                END               ELSE               BEGIN                 SET @KHODUOC_ID =  @param2                END                              SELECT @TONTRUOC = SOLUONG FROM TT_DUOC_TONKHO WHERE KHODUOC_ID = @KHODUOC_ID  AND DUOC_ID =  @param3  AND SOLONHAP_ID =  @param4  AND NGUONDUOC_ID =  @param5                               IF( @param0  = 'N' AND  @param6  = 'ADD')               BEGIN                SET @TONSAU = ISNULL(@TONTRUOC,0) +  @param7                 SET @SOLUONGNHAP =  @param7                 SET @SOLUONGXUAT = 0               END               IF( @param0  = 'N' AND  @param6  = 'DEL')               BEGIN                SET @TONSAU = ISNULL(@TONTRUOC,0) -  @param7                 SET @SOLUONGXUAT =  @param7                 SET @SOLUONGNHAP = 0               END                                         IF( @param0  = 'X' AND  @param6  = 'ADD')               BEGIN                SET @TONSAU = ISNULL(@TONTRUOC,0) -  @param8                 SET @SOLUONGXUAT =  @param8                 SET @SOLUONGNHAP = 0               END               IF( @param0  = 'X' AND  @param6  = 'DEL')               BEGIN                SET @TONSAU = ISNULL(@TONTRUOC,0) +  @param8                 SET @SOLUONGNHAP =  @param8                 SET @SOLUONGXUAT = 0                             END                        insert into TT_DUOC_TONKHO_LOG (                           CHUNGTUCHITIET_ID              ,CHUNGTU_ID              ,MACHUNGTU              ,LOAICHUNGTU              ,MUCDICHCHUNGTU_CODE              ,KHONHAP_ID              ,KHOXUAT_ID              ,DUOC_ID              ,SOLONHAP_ID              ,NGUONDUOC_ID              ,SOLUONGNHAP              ,SOLUONGXUAT              ,DONGIAMUA              ,DONGIAVON              ,TYLE_VAT              ,DONGIAVONVAT              ,TONTRUOC              ,TONSAU              ,ACTION              ,BENHVIEN_ID              ,NGAYTAO              ,NGUOITAO_ID                          ) values (              @param9               , @param10               , @param11               , @param0               , @param12               , @param1               , @param2               , @param3               , @param4               , @param5               ,@SOLUONGNHAP              ,@SOLUONGXUAT              , @param13               , @param14               , @param15               , @param16               ,@TONTRUOC              ,@TONSAU              , @param6               , @param17               , @param18               , @param19               )]
2019-08-14 18:10:03,570 [1] DEBUG - Statement Id: [DAO00030_TT_DUOC_TONKHO_LOG_Add] Parameters: [@param0=[LOAICHUNGTU,X], @param1=[KHONHAP_ID,null], @param2=[KHOXUAT_ID,29], @param3=[DUOC_ID,3], @param4=[SOLONHAP_ID,9260], @param5=[NGUONDUOC_ID,1], @param6=[ACTION,DEL], @param7=[SOLUONGNHAP,0], @param8=[SOLUONGXUAT,1], @param9=[CHUNGTUCHITIET_ID,1299043], @param10=[CHUNGTU_ID,137701], @param11=[MACHUNGTU,CS_GMHSX1319002657], @param12=[MUCDICHCHUNGTU_CODE,X13], @param13=[DONGIAMUA,0], @param14=[DONGIAVON,630], @param15=[TYLE_VAT,null], @param16=[DONGIAVONVAT,null], @param17=[BENHVIEN_ID,HLU01], @param18=[NGAYTAO,8/14/2019 6:10:03 PM], @param19=[NGUOITAO_ID,1]]
2019-08-14 18:10:03,570 [1] DEBUG - Statement Id: [DAO00030_TT_DUOC_TONKHO_LOG_Add] Types: [@param0=[String, System.String], @param1=[System.DBNull, null], @param2=[Int64, System.Int64], @param3=[Int64, System.Int64], @param4=[Int64, System.Int64], @param5=[Int64, System.Int64], @param6=[String, System.String], @param7=[Decimal, System.Decimal], @param8=[Decimal, System.Decimal], @param9=[Int64, System.Int64], @param10=[Int64, System.Int64], @param11=[String, System.String], @param12=[String, System.String], @param13=[Decimal, System.Decimal], @param14=[Decimal, System.Decimal], @param15=[System.DBNull, null], @param16=[System.DBNull, null], @param17=[String, System.String], @param18=[DateTime, System.DateTime], @param19=[Int64, System.Int64]]
2019-08-14 18:10:03,625 [1] DEBUG - Statement Id: [DAO00030_Delete] PreparedStatement : [delete from TT_DUOC_CHUNGTU              where              CHUNGTU_ID = '137701']
2019-08-14 18:10:03,667 [1] DEBUG - Statement Id: [DAO00030_DUOC_TONKHO_BOOKING_NGOAITRU_Tang] PreparedStatement : [update TT_DUOC_TONKHO_BOOK_NGOAITRU            set            SOLUONG = SOLUONG +  @param0             , NGUOICAPNHAT_ID =  @param1             , NGAYCAPNHAT = getdate()            where            REF_TABLE =  @param2             AND REF_ID =  @param3             AND KHODUOC_ID =  @param4             AND DUOC_ID =  @param5             AND SOLUONG = 0            AND BENHVIEN_ID = 'HLU01']
2019-08-14 18:10:03,667 [1] DEBUG - Statement Id: [DAO00030_DUOC_TONKHO_BOOKING_NGOAITRU_Tang] Parameters: [@param0=[SOLUONGTHAYDOI,1], @param1=[NGUOICAPNHAT_ID,1], @param2=[REF_TABLE,TT_PHAUTHUAT_VTYT], @param3=[REF_ID,1242], @param4=[KHODUOC_ID,29], @param5=[DUOC_ID,3]]
2019-08-14 18:10:03,667 [1] DEBUG - Statement Id: [DAO00030_DUOC_TONKHO_BOOKING_NGOAITRU_Tang] Types: [@param0=[Double, System.Double], @param1=[Int64, System.Int64], @param2=[String, System.String], @param3=[Int64, System.Int64], @param4=[Int64, System.Int64], @param5=[Int64, System.Int64]]
2019-08-14 18:10:03,736 [1] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoVaBookingCOM23UpdateRedis] PreparedStatement : [select  distinct tk.DUOC_KEY, LTRIM(tk.PHAMVI_ID) as PHAMVI_ID, tk.NGUONDUOC_ID, nh.TENNGUONDUOC, nh.TINHTIEN, d.DUOC_ID, ld.MALOAIDUOC,        d.SOVISA,d.TYLE_VAT,d.COTOA, d.MADUOC, d.TENHANG, d.TENDUOCDAYDU, dvt.TENDONVITINH as DONVITINH, d.BHYT,        d.TENHOATCHAT, d.HAMLUONG, d.HANGSANXUAT, d.QUOCGIA, d.LOAIDUOC_ID, d.DUONGDUNG_ID, d.TINHTIEN_PTTT,        ten.TENDUOC, ten.TENDUOC_EN, ten.MAQUOCTE, ten.MAQUOCTEBT,        CASE WHEN d.BHYT = '1' THEN 'BHYT' ELSE '' END as BHYT_TEXT        , ld.LOAIVATTU_ID        , d.BENHVIEN_ID,        tk.SOLUONG, d.VTYT_PHANLOAI, d.PHAMVI, d.SUASOLUONGTONGHOP, d.MADUOCBV, d.DANGTRINHBAY        , TAMNGUNG = CASE WHEN d.TAMNGUNG = '1' OR nh.TAMNGUNG = '1' OR kd.TAMNGUNG = '1' THEN '1' ELSE '0' END        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        inner join        (        select  LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')) DUOC_KEY, (SUM(dtk.SOLUONG) - isnull(sum(A.SOLUONG),0) - isnull(sum(B.SOLUONG),0)) SOLUONG, pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        from (select sum(soluong) soluong,duoc_id,nguonduoc_id,khoduoc_id,benhvien_id from TT_DUOC_TONKHO  group by duoc_id,nguonduoc_id,khoduoc_id,benhvien_id) dtk        inner join TM_DUOC_PHAMVISD_MAPPING pvsd on dtk.KHODUOC_ID = pvsd.KHODUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NOITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) B on B.DUOC_ID = dtk.DUOC_ID and B.SOLUONG > 0 and B.PHAMVI_ID = pvsd.PHAMVI_ID and B.NGUONHANG_ID = dtk.NGUONDUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NGOAITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) A on A.DUOC_ID = dtk.DUOC_ID and A.SOLUONG > 0 and A.PHAMVI_ID = pvsd.PHAMVI_ID and A.NGUONHANG_ID = dtk.NGUONDUOC_ID        where dtk.SOLUONG > 0 and dtk.BENHVIEN_ID = 'HLU01'        group by LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')), pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        ) tk on tk.DUOC_ID = d.DUOC_ID        left join TM_DUOC_PHAMVISUDUNG kd on kd.PHAMVI_ID = tk.PHAMVI_ID and kd.BENHVIEN_ID = 'HLU01'        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = tk.NGUONDUOC_ID and nh.BENHVIEN_ID = 'HLU01'        where  d.BENHVIEN_ID = 'HLU01' and d.DUOC_ID in (3)]
2019-08-14 18:10:03,981 [1] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoCOM18UpdateRedis] PreparedStatement : [select distinct TT_TONKHO.DUOC_KEY, LTRIM(TT_TONKHO.KHODUOC_ID) as KHODUOC_ID, TM_DUOC.DUOC_ID, TM_LOAIDUOC.MALOAIDUOC,TM_DUOC.SOVISA,TM_DUOC.TYLE_VAT,TM_DUOC.COTOA,        TM_DUOC.MADUOC, TM_DUOC.TENHANG, TM_DUOC.TENDUOCDAYDU, dvt.TENDONVITINH as DONVITINH,  TM_DUOC.DONVITINH_ID,TM_DUOC.BHYT,        TM_DUOC.TENHOATCHAT,        TM_DUOC.HAMLUONG, TM_DUOC.HANGSANXUAT, TM_DUOC.QUOCGIA, TM_DUOC.LOAIDUOC_ID, TM_DUOC.DUONGDUNG_ID,        TM_TENDUOC.TENDUOC, TM_TENDUOC.TENDUOC_EN, TM_TENDUOC.MAQUOCTE, TM_TENDUOC.MAQUOCTEBT,        TM_LOAIDUOC.LOAIVATTU_ID, TM_DUOC.BENHVIEN_ID,        TT_TONKHO.SOLUONG, TM_DUOC.VTYT_PHANLOAI, TM_DUOC.PHAMVI, TT_TONKHO.NGUONDUOC_ID, NG.TENNGUONDUOC AS TENNGUONDUOC        , TAMNGUNG = CASE WHEN TM_DUOC.TAMNGUNG = '1' OR NG.TAMNGUNG = '1' OR KD.TAMNGUNG = '1' THEN '1' ELSE '0' END        , TM_DUOC.DANGTRINHBAY        from TM_DUOC        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = TM_DUOC.DONVITINH_ID        left join TM_TENDUOC on TM_DUOC.TENDUOC_ID = TM_TENDUOC.TENDUOC_ID and TM_DUOC.BENHVIEN_ID = 'HLU01' and TM_DUOC.TAMNGUNG = '0'        left join TM_LOAIDUOC on TM_LOAIDUOC.LOAIDUOC_ID = TM_DUOC.LOAIDUOC_ID and TM_LOAIDUOC.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG on (TM_LOAIDUOC.LOAIVATTU_ID = TM_DUOC_HANDUNG.LOAIDUOC and TM_DUOC_HANDUNG.BENHVIEN_ID = 'HLU01')        inner join        (select LTRIM(A.KHODUOC_ID) + '_' + LTRIM(A.DUOC_ID) + '_' + LTRIM(ISNULL(A.NGUONDUOC_ID,'')) as DUOC_KEY, A.KHODUOC_ID, A.DUOC_ID, A.NGUONDUOC_ID,        SUM(isnull(A.SOLUONG,0)) as SOLUONG        from        (select SUM(SOLUONG) as SOLUONG, KHODUOC_ID, DUOC_ID, NGUONDUOC_ID from TT_DUOC_TONKHO        where BENHVIEN_ID = 'HLU01' group by KHODUOC_ID, DUOC_ID, NGUONDUOC_ID) A        group by LTRIM(A.KHODUOC_ID) + '_' + LTRIM(A.DUOC_ID) + '_' + LTRIM(ISNULL(A.NGUONDUOC_ID,'')), A.KHODUOC_ID, A.DUOC_ID, NGUONDUOC_ID        ) TT_TONKHO on TT_TONKHO.DUOC_ID = TM_DUOC.DUOC_ID        LEFT JOIN TM_NGUONHANG NG ON NG.NGUONDUOC_ID = TT_TONKHO.NGUONDUOC_ID        LEFT JOIN TM_KHODUOC KD ON KD.KHODUOC_ID = TT_TONKHO.KHODUOC_ID        where TM_DUOC.BENHVIEN_ID = 'HLU01' and TT_TONKHO.SOLUONG >= 0        and TM_DUOC.DUOC_ID in (3)]
2019-08-14 18:10:04,083 [1] DEBUG - Statement Id: [DAO00030_DUOCTONKHO_Tang] PreparedStatement : [IF EXISTS            (              SELECT DUOCTONKHO_ID              FROM TT_DUOC_TONKHO              WHERE              KHODUOC_ID =  @param0               AND DUOC_ID =  @param1               AND  SOLONHAP_ID =  @param2             )            BEGIN              update TT_DUOC_TONKHO set              SOLUONG = SOLUONG +   @param3               , NGAYCAPNHAT =  @param4               , NGUOICAPNHAT_ID =  @param5               where              KHODUOC_ID =  @param0               AND DUOC_ID =  @param1               AND  SOLONHAP_ID =  @param2             END            ELSE            BEGIN              insert into TT_DUOC_TONKHO (              KHODUOC_ID              , DUOC_ID              , NGUONDUOC_ID              , SOLONHAP_ID              , DONGIAMUA              , SOLUONG              , BENHVIEN_ID              , NGAYTAO              , NGUOITAO_ID                     ) values (               @param0               ,  @param1               ,  @param6               ,  @param2               ,  @param7               ,  @param3               ,  @param8               ,  @param9               ,  @param10                        )            END]
2019-08-14 18:10:04,083 [1] DEBUG - Statement Id: [DAO00030_DUOCTONKHO_Tang] Parameters: [@param0=[KHODUOC_ID,29], @param1=[DUOC_ID,3], @param2=[SOLONHAP_ID,9260], @param3=[SOLUONGTHAYDOI,1], @param4=[NGAYCAPNHAT,8/14/2019 6:10:04 PM], @param5=[NGUOICAPNHAT_ID,1], @param6=[NGUONDUOC_ID,1], @param7=[DONGIAMUA,null], @param8=[BENHVIEN_ID,HLU01], @param9=[NGAYTAO,8/14/2019 6:07:29 PM], @param10=[NGUOITAO_ID,1]]
2019-08-14 18:10:04,083 [1] DEBUG - Statement Id: [DAO00030_DUOCTONKHO_Tang] Types: [@param0=[Int64, System.Int64], @param1=[Int64, System.Int64], @param2=[Int64, System.Int64], @param3=[Double, System.Double], @param4=[DateTime, System.DateTime], @param5=[Int64, System.Int64], @param6=[Int64, System.Int64], @param7=[System.DBNull, null], @param8=[String, System.String], @param9=[DateTime, System.DateTime], @param10=[Int64, System.Int64]]
2019-08-14 18:10:04,150 [1] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoCOM18] PreparedStatement : [select  distinct TT_TONKHO.DUOC_KEY, LTRIM(TT_TONKHO.KHODUOC_ID) as KHODUOC_ID, TM_DUOC.DUOC_ID, TM_LOAIDUOC.MALOAIDUOC,TM_DUOC.SOVISA,TM_DUOC.TYLE_VAT,TM_DUOC.COTOA,        TM_DUOC.MADUOC, TM_DUOC.TENHANG, TM_DUOC.TENDUOCDAYDU, dvt.TENDONVITINH as DONVITINH, TM_DUOC.DONVITINH_ID, TM_DUOC.BHYT,        TM_DUOC.TENHOATCHAT, TM_DUOC.HAMLUONG, TM_DUOC.HANGSANXUAT, TM_DUOC.QUOCGIA, TM_DUOC.LOAIDUOC_ID, TM_DUOC.DUONGDUNG_ID,        TM_TENDUOC.TENDUOC, TM_TENDUOC.TENDUOC_EN, TM_TENDUOC.MAQUOCTE, TM_TENDUOC.MAQUOCTEBT,        TM_LOAIDUOC.LOAIVATTU_ID, TM_DUOC.BENHVIEN_ID,        TT_TONKHO.SOLUONG, TM_DUOC.VTYT_PHANLOAI, TM_DUOC.PHAMVI, TT_TONKHO.NGUONDUOC_ID, NG.TENNGUONDUOC        , TAMNGUNG = CASE WHEN TM_DUOC.TAMNGUNG = '1' OR NG.TAMNGUNG = '1' OR KD.TAMNGUNG = '1' THEN '1' ELSE '0' END        , TM_DUOC.DANGTRINHBAY        from TM_DUOC        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = TM_DUOC.DONVITINH_ID        left join TM_TENDUOC on TM_DUOC.TENDUOC_ID = TM_TENDUOC.TENDUOC_ID and TM_DUOC.BENHVIEN_ID = 'HLU01'  and TM_DUOC.TAMNGUNG = '0'        left join TM_LOAIDUOC on TM_LOAIDUOC.LOAIDUOC_ID = TM_DUOC.LOAIDUOC_ID and TM_LOAIDUOC.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG on (TM_LOAIDUOC.LOAIVATTU_ID = TM_DUOC_HANDUNG.LOAIDUOC and TM_DUOC_HANDUNG.BENHVIEN_ID = 'HLU01')        inner join        (select LTRIM(A.KHODUOC_ID) + '_' + LTRIM(A.DUOC_ID) + '_' + LTRIM(ISNULL(A.NGUONDUOC_ID,'')) as DUOC_KEY, A.KHODUOC_ID, A.DUOC_ID ,a.NGUONDUOC_ID,        SUM(isnull(A.SOLUONG,0)) as SOLUONG        from        (select SUM(SOLUONG) as SOLUONG, KHODUOC_ID, DUOC_ID, NGUONDUOC_ID from TT_DUOC_TONKHO        where KHODUOC_ID in (29) and DUOC_ID in (3) group by KHODUOC_ID, DUOC_ID, NGUONDUOC_ID        ) A        where A.KHODUOC_ID in (29) and A.DUOC_ID in (3)        group by LTRIM(A.KHODUOC_ID) + '_' + LTRIM(A.DUOC_ID) + '_' + LTRIM(A.NGUONDUOC_ID), A.KHODUOC_ID, A.DUOC_ID, A.NGUONDUOC_ID)        TT_TONKHO on TT_TONKHO.DUOC_ID = TM_DUOC.DUOC_ID        LEFT JOIN TM_NGUONHANG NG ON NG.NGUONDUOC_ID = TT_TONKHO.NGUONDUOC_ID        LEFT JOIN TM_KHODUOC KD ON KD.KHODUOC_ID = TT_TONKHO.KHODUOC_ID        where TM_DUOC.BENHVIEN_ID = 'HLU01' and TM_DUOC.DUOC_ID in (3)]
2019-08-14 18:10:04,202 [1] DEBUG - Statement Id: [DAO00030_GetListPhamViByKhoDuoc] PreparedStatement : [SELECT DISTINCT PHAMVI_ID          FROM TM_DUOC_PHAMVISD_MAPPING          WHERE          KHODUOC_ID IN (29)          AND BENHVIEN_ID ='HLU01'          AND TAMNGUNG = '0']
2019-08-14 18:10:04,246 [1] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoVaBookingCOM23] PreparedStatement : [select  distinct tk.DUOC_KEY, LTRIM(tk.PHAMVI_ID) as PHAMVI_ID, tk.NGUONDUOC_ID, nh.TENNGUONDUOC, nh.TINHTIEN, d.DUOC_ID, ld.MALOAIDUOC,        d.SOVISA,d.TYLE_VAT,d.COTOA, d.MADUOC, d.TENHANG, d.TENDUOCDAYDU, dvt.TENDONVITINH as DONVITINH, d.BHYT,        d.TENHOATCHAT, d.HAMLUONG, d.HANGSANXUAT, d.QUOCGIA, d.LOAIDUOC_ID, d.DUONGDUNG_ID, d.TINHTIEN_PTTT,        ten.TENDUOC, ten.TENDUOC_EN, ten.MAQUOCTE, ten.MAQUOCTEBT,        CASE WHEN d.BHYT = '1' THEN 'BHYT' ELSE '' END as BHYT_TEXT        , ld.LOAIVATTU_ID        , d.BENHVIEN_ID,        tk.SOLUONG, d.VTYT_PHANLOAI, d.PHAMVI, d.SUASOLUONGTONGHOP, d.MADUOCBV, d.DANGTRINHBAY        , TAMNGUNG = CASE WHEN d.TAMNGUNG = '1' OR nh.TAMNGUNG = '1' OR kd.TAMNGUNG = '1' THEN '1' ELSE '0' END        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        inner join        (        select  LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')) DUOC_KEY, (SUM(dtk.SOLUONG) - isnull(sum(A.SOLUONG),0) - isnull(sum(B.SOLUONG),0)) SOLUONG, pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        from (select sum(soluong) soluong,duoc_id,nguonduoc_id,khoduoc_id,benhvien_id from TT_DUOC_TONKHO  group by duoc_id,nguonduoc_id,khoduoc_id,benhvien_id) dtk        inner join TM_DUOC_PHAMVISD_MAPPING pvsd on dtk.KHODUOC_ID = pvsd.KHODUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NOITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) B on B.DUOC_ID = dtk.DUOC_ID and B.SOLUONG > 0 and B.PHAMVI_ID = pvsd.PHAMVI_ID and B.NGUONHANG_ID = dtk.NGUONDUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NGOAITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) A on A.DUOC_ID = dtk.DUOC_ID and A.SOLUONG > 0 and A.PHAMVI_ID = pvsd.PHAMVI_ID and A.NGUONHANG_ID = dtk.NGUONDUOC_ID        where dtk.SOLUONG > 0 and dtk.BENHVIEN_ID = 'HLU01'        group by LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')), pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        ) tk on tk.DUOC_ID = d.DUOC_ID        left join TM_DUOC_PHAMVISUDUNG kd on kd.PHAMVI_ID = tk.PHAMVI_ID and kd.BENHVIEN_ID = 'HLU01'        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = tk.NGUONDUOC_ID and nh.BENHVIEN_ID = 'HLU01'        where  d.BENHVIEN_ID = 'HLU01' and d.DUOC_ID in (3) and TK.PHAMVI_ID in (1052)        and tk.NGUONDUOC_ID in (1)]
2019-08-14 18:10:04,412 [1] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoCOM18UpdateRedis] PreparedStatement : [select distinct TT_TONKHO.DUOC_KEY, LTRIM(TT_TONKHO.KHODUOC_ID) as KHODUOC_ID, TM_DUOC.DUOC_ID, TM_LOAIDUOC.MALOAIDUOC,TM_DUOC.SOVISA,TM_DUOC.TYLE_VAT,TM_DUOC.COTOA,        TM_DUOC.MADUOC, TM_DUOC.TENHANG, TM_DUOC.TENDUOCDAYDU, dvt.TENDONVITINH as DONVITINH,  TM_DUOC.DONVITINH_ID,TM_DUOC.BHYT,        TM_DUOC.TENHOATCHAT,        TM_DUOC.HAMLUONG, TM_DUOC.HANGSANXUAT, TM_DUOC.QUOCGIA, TM_DUOC.LOAIDUOC_ID, TM_DUOC.DUONGDUNG_ID,        TM_TENDUOC.TENDUOC, TM_TENDUOC.TENDUOC_EN, TM_TENDUOC.MAQUOCTE, TM_TENDUOC.MAQUOCTEBT,        TM_LOAIDUOC.LOAIVATTU_ID, TM_DUOC.BENHVIEN_ID,        TT_TONKHO.SOLUONG, TM_DUOC.VTYT_PHANLOAI, TM_DUOC.PHAMVI, TT_TONKHO.NGUONDUOC_ID, NG.TENNGUONDUOC AS TENNGUONDUOC        , TAMNGUNG = CASE WHEN TM_DUOC.TAMNGUNG = '1' OR NG.TAMNGUNG = '1' OR KD.TAMNGUNG = '1' THEN '1' ELSE '0' END        , TM_DUOC.DANGTRINHBAY        from TM_DUOC        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = TM_DUOC.DONVITINH_ID        left join TM_TENDUOC on TM_DUOC.TENDUOC_ID = TM_TENDUOC.TENDUOC_ID and TM_DUOC.BENHVIEN_ID = 'HLU01' and TM_DUOC.TAMNGUNG = '0'        left join TM_LOAIDUOC on TM_LOAIDUOC.LOAIDUOC_ID = TM_DUOC.LOAIDUOC_ID and TM_LOAIDUOC.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG on (TM_LOAIDUOC.LOAIVATTU_ID = TM_DUOC_HANDUNG.LOAIDUOC and TM_DUOC_HANDUNG.BENHVIEN_ID = 'HLU01')        inner join        (select LTRIM(A.KHODUOC_ID) + '_' + LTRIM(A.DUOC_ID) + '_' + LTRIM(ISNULL(A.NGUONDUOC_ID,'')) as DUOC_KEY, A.KHODUOC_ID, A.DUOC_ID, A.NGUONDUOC_ID,        SUM(isnull(A.SOLUONG,0)) as SOLUONG        from        (select SUM(SOLUONG) as SOLUONG, KHODUOC_ID, DUOC_ID, NGUONDUOC_ID from TT_DUOC_TONKHO        where BENHVIEN_ID = 'HLU01' group by KHODUOC_ID, DUOC_ID, NGUONDUOC_ID) A        group by LTRIM(A.KHODUOC_ID) + '_' + LTRIM(A.DUOC_ID) + '_' + LTRIM(ISNULL(A.NGUONDUOC_ID,'')), A.KHODUOC_ID, A.DUOC_ID, NGUONDUOC_ID        ) TT_TONKHO on TT_TONKHO.DUOC_ID = TM_DUOC.DUOC_ID        LEFT JOIN TM_NGUONHANG NG ON NG.NGUONDUOC_ID = TT_TONKHO.NGUONDUOC_ID        LEFT JOIN TM_KHODUOC KD ON KD.KHODUOC_ID = TT_TONKHO.KHODUOC_ID        where TM_DUOC.BENHVIEN_ID = 'HLU01' and TT_TONKHO.SOLUONG >= 0        and TM_DUOC.DUOC_ID in (3)]
2019-08-14 18:10:04,457 [1] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoVaBookingCOM23UpdateRedis] PreparedStatement : [select  distinct tk.DUOC_KEY, LTRIM(tk.PHAMVI_ID) as PHAMVI_ID, tk.NGUONDUOC_ID, nh.TENNGUONDUOC, nh.TINHTIEN, d.DUOC_ID, ld.MALOAIDUOC,        d.SOVISA,d.TYLE_VAT,d.COTOA, d.MADUOC, d.TENHANG, d.TENDUOCDAYDU, dvt.TENDONVITINH as DONVITINH, d.BHYT,        d.TENHOATCHAT, d.HAMLUONG, d.HANGSANXUAT, d.QUOCGIA, d.LOAIDUOC_ID, d.DUONGDUNG_ID, d.TINHTIEN_PTTT,        ten.TENDUOC, ten.TENDUOC_EN, ten.MAQUOCTE, ten.MAQUOCTEBT,        CASE WHEN d.BHYT = '1' THEN 'BHYT' ELSE '' END as BHYT_TEXT        , ld.LOAIVATTU_ID        , d.BENHVIEN_ID,        tk.SOLUONG, d.VTYT_PHANLOAI, d.PHAMVI, d.SUASOLUONGTONGHOP, d.MADUOCBV, d.DANGTRINHBAY        , TAMNGUNG = CASE WHEN d.TAMNGUNG = '1' OR nh.TAMNGUNG = '1' OR kd.TAMNGUNG = '1' THEN '1' ELSE '0' END        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        inner join        (        select  LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')) DUOC_KEY, (SUM(dtk.SOLUONG) - isnull(sum(A.SOLUONG),0) - isnull(sum(B.SOLUONG),0)) SOLUONG, pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        from (select sum(soluong) soluong,duoc_id,nguonduoc_id,khoduoc_id,benhvien_id from TT_DUOC_TONKHO  group by duoc_id,nguonduoc_id,khoduoc_id,benhvien_id) dtk        inner join TM_DUOC_PHAMVISD_MAPPING pvsd on dtk.KHODUOC_ID = pvsd.KHODUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NOITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) B on B.DUOC_ID = dtk.DUOC_ID and B.SOLUONG > 0 and B.PHAMVI_ID = pvsd.PHAMVI_ID and B.NGUONHANG_ID = dtk.NGUONDUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NGOAITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) A on A.DUOC_ID = dtk.DUOC_ID and A.SOLUONG > 0 and A.PHAMVI_ID = pvsd.PHAMVI_ID and A.NGUONHANG_ID = dtk.NGUONDUOC_ID        where dtk.SOLUONG > 0 and dtk.BENHVIEN_ID = 'HLU01'        group by LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')), pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        ) tk on tk.DUOC_ID = d.DUOC_ID        left join TM_DUOC_PHAMVISUDUNG kd on kd.PHAMVI_ID = tk.PHAMVI_ID and kd.BENHVIEN_ID = 'HLU01'        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = tk.NGUONDUOC_ID and nh.BENHVIEN_ID = 'HLU01'        where  d.BENHVIEN_ID = 'HLU01' and d.DUOC_ID in (3)]
2019-08-14 18:10:04,657 [1] DEBUG - Statement Id: [DAO00030_RemoveChungTuVTYTThuThuat] PreparedStatement : [update TT_PHAUTHUAT_VTYT set            CHUNGTU_ID = null            where            CHUNGTU_ID =   @param0               update TT_VIENPHI            SET            DUYET = '0',            DATHUCHIEN = '0'            WHERE REF_TABLE = 'TT_PHAUTHUAT_VTYT'            AND REF_ID IN (1242)]
2019-08-14 18:10:04,657 [1] DEBUG - Statement Id: [DAO00030_RemoveChungTuVTYTThuThuat] Parameters: [@param0=[CHUNGTU_ID,137701]]
2019-08-14 18:10:04,657 [1] DEBUG - Statement Id: [DAO00030_RemoveChungTuVTYTThuThuat] Types: [@param0=[Int64, System.Int64]]
2019-08-14 18:10:04,716 [1] DEBUG - Statement Id: [DAO00030_UpdateChungTuLienQuan] PreparedStatement : [update              TT_DUOC_CHUNGTU              set              CHUNGTULIENQUAN_ID =  @param0 ,              NGAYCAPNHAT = getdate()              where              MACHUNGTU = '']
2019-08-14 18:10:04,716 [1] DEBUG - Statement Id: [DAO00030_UpdateChungTuLienQuan] Parameters: [@param0=[CHUNGTULIENQUAN_ID,null]]
2019-08-14 18:10:04,716 [1] DEBUG - Statement Id: [DAO00030_UpdateChungTuLienQuan] Types: [@param0=[System.DBNull, null]]
2019-08-14 18:10:04,924 [1] DEBUG - Statement Id: [DAO00030_GET_SOLONHAP] PreparedStatement : [SELECT DISTINCT            SLN.SOLONHAP_ID, SLN.SOLONHAP, SLN.SOLOSANPHAM, SLN.SOKIEMSOAT, SLN.SOVISA, CONVERT(varchar(20), SLN.SOLOSANPHAM) + '/' + CONVERT(varchar(20), TK.SOLUONG) AS SOLOSOTON,            SLN.NGAYNHAP AS NGAYNHAPLO, SLN.HANDUNG AS HANSUDUNG,  SLN.HANDUNG, SLN.NGUONDUOC_ID, SLN.NGUONDUOC_ID as NGUONHANG_ID,            SLNGB.DONGIAMUA, SLNGB.DONGIAVON, SLNGB.TYLEVAT_DAUVAO as TYLEVAT, d.TYLE_VAT, SLNGB.DONGIAVONVAT, SLNGB.DONGIABAN, SLNGB.DONGIABANVAT_DAUVAO as DONGIABAN_VAT,            TK.DUOCTONKHO_ID, TK.KHODUOC_ID, TK.DUOC_ID, TK.SOLUONG, TK.SOLUONG AS SOLUONGTON,            D.TENDUOCDAYDU,D.DONVITINH_ID, D.DONVITINH, D.BHYT, NH.TENNGUONDUOC AS NGUONHANG,            LTRIM(TK.KHODUOC_ID) + '_' + LTRIM(TK.DUOC_ID) + '_' + LTRIM(TK.NGUONDUOC_ID) as DUOC_KEY, D.SO_QDTT            FROM            TT_DUOC_CHUNGTU_SOLONHAP SLN,            TT_DUOC_TONKHO TK,            TT_DUOC_SOLONHAP_GIABAN SLNGB,            TM_DUOC D,            TM_NGUONHANG NH            WHERE            SLN.SOLONHAP_ID = TK.SOLONHAP_ID            AND SLN.SOLONHAP_ID = SLNGB.SOLONHAP_ID            AND SLN.NGUONDUOC_ID = NH.NGUONDUOC_ID            AND SLN.DUOC_ID = D.DUOC_ID            AND TK.DUOC_ID = ''            AND TK.KHODUOC_ID = ''            AND SLN.BENHVIEN_ID = 'HLU01'            AND TK.SOLUONG > 0                 and                     SLN.NGUONDUOC_ID = '1'                                      ORDER BY NGAYNHAP]
2019-08-14 18:10:05,000 [1] DEBUG - Statement Id: [DAO00030_GetMucDichChungTuID] PreparedStatement : [SELECT DICTIONARY_ID              FROM              LST_DICTIONARY              WHERE              DICTIONARY_TYPE_CODE = 'MucDichChungTu'              and DICTIONARY_CODE = 'X13']
2019-08-14 18:10:23,542 [1] DEBUG - Statement Id: [DAO00063_GetListKhoThuocPhongBanPhamvi] PreparedStatement : [select distinct dpv.*        from TM_DUOC_PHAMVISD_MAPPING dmap        left join TM_DUOC_PHAMVISUDUNG dpv on dpv.PHAMVI_ID = dmap.PHAMVI_ID        where dmap.KHODUOC_ID in (select KHODUOC_ID from TM_PHONGBAN_KHODUOC where PHONGBAN_ID = '25')]
2019-08-14 18:10:23,582 [1] DEBUG - Statement Id: [DAO00051_GetTemplateDuoc] PreparedStatement : [select *              from TM_TEMPLATEDUOC               where                             NGUOITAO_ID = '1'                       and                           KHOATAO_ID = '25'                                     ORDER BY TENTEMPLATE]
2019-08-14 18:10:23,663 [1] DEBUG - Statement Id: [DAO00048_TT_PHAUTHUAT_YEUCAU_GetList] PreparedStatement : [SELECT YC.[PHAUTHUAT_YEUCAU_ID]              ,YC.[PHAUTHUAT_ID]              ,YC.[DVYEUCAU_ID]              ,YC.[NHOMDICHVU_ID]              ,YC.[DICHVU_ID]              ,YC.[LOAIGIA_ID]              ,VP.[BHYT_THANHTIEN_CHITRA]              ,VP.[BENHNHAN_PHAITHANHTOAN]              ,VP.[THANHTIEN_DOANHTHU]              ,YC.[BENHVIEN_ID]              FROM [TT_PHAUTHUAT_YEUCAU] YC              INNER JOIN TT_VIENPHI VP ON YC.DVYEUCAU_ID= VP.REF_ID AND VP.REF_TABLE ='TT_DVYEUCAU'               where                             YC.PHAUTHUAT_ID = '3589'                       and                           YC.BENHVIEN_ID = 'HLU01'                                     order by PHAUTHUAT_YEUCAU_ID]
2019-08-14 18:10:23,711 [1] DEBUG - Statement Id: [DAO00048_TT_PHAUTHUAT_PPVOCAM_GetDetail] PreparedStatement : [select *              from TT_PHAUTHUAT_PPVOCAM              where PHAUTHUAT_ID  = 3589]
2019-08-14 18:10:23,855 [1] DEBUG - Statement Id: [DAO00019_ThongTinBenhNhanTiepNhan] PreparedStatement : [select distinct A.SOTIEPNHAN, A.TIEPNHAN_ID, A.DOITUONG_ID, A.TRANGTHAI,        A.LOAITHANHVIEN_ID, A.SUDUNG_BHTN, A.THE_ID, A.THANHVIEN_ID, A.VIP, A.NGUON_BENHNHAN_ID, A.BAOLANH_VIENPHI,        B.*, A.SOBHYT        from TT_TIEPNHAN A        inner join TT_BENHNHAN B on B.BENHNHAN_ID = A.BENHNHAN_ID and B.ACTIVE = '1'        where                    A.TIEPNHAN_ID = '24854'                 and A.BENHVIEN_ID = 'HLU01']
2019-08-14 18:10:23,978 [1] DEBUG - Statement Id: [DAO00048_TT_PHAUTHUAT_GetList] PreparedStatement : [select *              from TT_PHAUTHUAT               where                             TT_PHAUTHUAT.LOAI = 'P'                       and                           TT_PHAUTHUAT.TIEPNHAN_ID = 24854                       and                           TT_PHAUTHUAT.BENHVIEN_ID = 'HLU01'                                     order by PHAUTHUAT_ID DESC]
2019-08-14 18:10:24,015 [1] DEBUG - Statement Id: [DAO00066_GetBENHAN_TIEPNHAN] PreparedStatement : [select top 1 *        from TT_NOITRU_BENHAN        where TIEPNHAN_ID = '24854'  and BENHVIEN_ID = 'HLU01'        order by NGAYTAO desc]
2019-08-14 18:10:24,093 [1] DEBUG - Statement Id: [DAO00048_GetBenhNhanByBenhNhanID] PreparedStatement : [SELECT *              FROM              TT_BENHNHAN               where                             BENHNHAN_ID = '21398']
2019-08-14 18:10:24,120 [1] DEBUG - Statement Id: [DAO00000_GetDoiTuongIsBHYT] PreparedStatement : [select * from TM_DOITUONG Where DOITUONG_ID = 6 and MADOITUONG like '%BHYT%']
2019-08-14 18:10:24,466 [1] DEBUG - Statement Id: [DAO00048_GetDICHVUYCByTiepNhanID] PreparedStatement : [SELECT DISTINCT D.HOPDONG_ID, D.HOPDONG_BENHNHAN_ID, D.DVYEUCAU_ID, D.DICHVU_ID, D.SOPHIEUYEUCAU, D.NGAYGIOYEUCAU, D.NOITHUCHIEN_ID, P.LOAIPHAUTHUAT, L.STT AS STT_LOAIPHAUTHUAT            FROM            TT_DVYEUCAU AS D            left join TM_PHANLOAIPHAUTHUAT AS P ON D.DICHVU_ID = P.DICHVU_ID            left join TM_LOAIPHAUTHUAT AS L ON L.LOAIPHAUTHUAT = P.LOAIPHAUTHUAT            where            not exists (select DVYEUCAU_ID from TT_PHAUTHUAT_YEUCAU where D.DVYEUCAU_ID = DVYEUCAU_ID)               and                       exists (select DICHVU_ID from TM_DICHVU                      where D.DICHVU_ID = DICHVU_ID and                      exists (select NHOMDICHVU_ID from TM_NHOMDICHVU where TM_DICHVU.NHOMDICHVU_ID = NHOMDICHVU_ID and left(MANHOMDICHVU,2) in (05) ))                     and                           D.TIEPNHAN_ID = '24854']
2019-08-14 18:10:24,506 [1] DEBUG - Statement Id: [DAO00066_GetBENHAN_TIEPNHAN] PreparedStatement : [select top 1 *        from TT_NOITRU_BENHAN        where TIEPNHAN_ID = '24854'  and BENHVIEN_ID = 'HLU01'        order by NGAYTAO desc]
2019-08-14 18:10:24,763 [1] DEBUG - Statement Id: [DAO00040_LayListToaMauVTYT_TheoLoaitoathuoc] PreparedStatement : [select A.*, dc.TENDUOCDAYDU, dc.BHYT DUOC_BHYT, ld.LOAIVATTU_ID, ld.MALOAIDUOC, dd.DICTIONARY_NAME DUONGDUNG, dc.TAMNGUNG          from TT_TOATHUOCMAU A          left join TM_DUOC dc on A.DUOC_ID = dc.DUOC_ID          left join TM_LOAIDUOC ld on dc.LOAIDUOC_ID = ld.LOAIDUOC_ID          left join (select * from LST_DICTIONARY where DICTIONARY_TYPE_CODE like 'DuongDung') dd on dd.DICTIONARY_ID = dc.DUONGDUNG_ID          where (1=1)           and             A.LOAITOATHUOC = 'PTVT']
2019-08-14 18:10:27,114 [1] DEBUG - Statement Id: [DAO00048_TT_PHAUTHUAT_GetDetail] PreparedStatement : [select PT.*, TN.BENHNHAN_ID              from              TT_PHAUTHUAT PT, TT_TIEPNHAN TN              where              PT.TIEPNHAN_ID = TN.TIEPNHAN_ID              AND PHAUTHUAT_ID  = 3589]
2019-08-14 18:10:27,232 [1] DEBUG - Statement Id: [DAO00048_CheckDVPhauThuatBHYT] PreparedStatement : [select count(0) from TT_VIENPHI          where REF_TABLE = 'TT_DVYEUCAU' and REF_ID = (select top 1 DVYEUCAU_ID from TT_PHAUTHUAT_YEUCAU where PHAUTHUAT_ID =  @param0 )          and TIEPNHAN_ID =  @param1  and BHYT_DONGIA > 0]
2019-08-14 18:10:27,233 [1] DEBUG - Statement Id: [DAO00048_CheckDVPhauThuatBHYT] Parameters: [@param0=[PHAUTHUAT_ID,3589], @param1=[TIEPNHAN_ID,24854]]
2019-08-14 18:10:27,233 [1] DEBUG - Statement Id: [DAO00048_CheckDVPhauThuatBHYT] Types: [@param0=[Int64, System.Int64], @param1=[Int64, System.Int64]]
2019-08-14 18:10:27,328 [1] DEBUG - Statement Id: [DAO00116_File_GetList] PreparedStatement : [select *              from TT_FILE_DINHKEM               where                             TT_FILE_DINHKEM.REF_TABLE = 'TT_PHAUTHUAT'                       and                           TT_FILE_DINHKEM.REF_ID = '3589'                       and                           TT_FILE_DINHKEM.BENHVIEN_ID = 'HLU01'                                     order by FILE_ID]
2019-08-14 18:10:27,389 [1] DEBUG - Statement Id: [DAO00048_TT_PHAUTHUAT_YEUCAU_GetList] PreparedStatement : [SELECT YC.[PHAUTHUAT_YEUCAU_ID]              ,YC.[PHAUTHUAT_ID]              ,YC.[DVYEUCAU_ID]              ,YC.[NHOMDICHVU_ID]              ,YC.[DICHVU_ID]              ,YC.[LOAIGIA_ID]              ,VP.[BHYT_THANHTIEN_CHITRA]              ,VP.[BENHNHAN_PHAITHANHTOAN]              ,VP.[THANHTIEN_DOANHTHU]              ,YC.[BENHVIEN_ID]              FROM [TT_PHAUTHUAT_YEUCAU] YC              INNER JOIN TT_VIENPHI VP ON YC.DVYEUCAU_ID= VP.REF_ID AND VP.REF_TABLE ='TT_DVYEUCAU'               where                             YC.PHAUTHUAT_ID = '3589'                       and                           YC.BENHVIEN_ID = 'HLU01'                                     order by PHAUTHUAT_YEUCAU_ID]
2019-08-14 18:10:27,430 [1] DEBUG - Statement Id: [DAO00048_TT_PHAUTHUAT_PPVOCAM_GetDetail] PreparedStatement : [select *              from TT_PHAUTHUAT_PPVOCAM              where PHAUTHUAT_ID  = 3589]
2019-08-14 18:10:27,543 [1] DEBUG - Statement Id: [DAO00048_TT_PHAUTHUAT_GetDetail] PreparedStatement : [select PT.*, TN.BENHNHAN_ID              from              TT_PHAUTHUAT PT, TT_TIEPNHAN TN              where              PT.TIEPNHAN_ID = TN.TIEPNHAN_ID              AND PHAUTHUAT_ID  = 3589]
2019-08-14 18:10:27,573 [1] DEBUG - Statement Id: [DAO00048_CheckDVPhauThuatBHYT] PreparedStatement : [select count(0) from TT_VIENPHI          where REF_TABLE = 'TT_DVYEUCAU' and REF_ID = (select top 1 DVYEUCAU_ID from TT_PHAUTHUAT_YEUCAU where PHAUTHUAT_ID =  @param0 )          and TIEPNHAN_ID =  @param1  and BHYT_DONGIA > 0]
2019-08-14 18:10:27,574 [1] DEBUG - Statement Id: [DAO00048_CheckDVPhauThuatBHYT] Parameters: [@param0=[PHAUTHUAT_ID,3589], @param1=[TIEPNHAN_ID,24854]]
2019-08-14 18:10:27,574 [1] DEBUG - Statement Id: [DAO00048_CheckDVPhauThuatBHYT] Types: [@param0=[Int64, System.Int64], @param1=[Int64, System.Int64]]
2019-08-14 18:10:27,612 [1] DEBUG - Statement Id: [DAO00116_File_GetList] PreparedStatement : [select *              from TT_FILE_DINHKEM               where                             TT_FILE_DINHKEM.REF_TABLE = 'TT_PHAUTHUAT'                       and                           TT_FILE_DINHKEM.REF_ID = '3589'                       and                           TT_FILE_DINHKEM.BENHVIEN_ID = 'HLU01'                                     order by FILE_ID]
2019-08-14 18:10:27,675 [1] DEBUG - Statement Id: [DAO00048_TT_PHAUTHUAT_YEUCAU_GetList] PreparedStatement : [SELECT YC.[PHAUTHUAT_YEUCAU_ID]              ,YC.[PHAUTHUAT_ID]              ,YC.[DVYEUCAU_ID]              ,YC.[NHOMDICHVU_ID]              ,YC.[DICHVU_ID]              ,YC.[LOAIGIA_ID]              ,VP.[BHYT_THANHTIEN_CHITRA]              ,VP.[BENHNHAN_PHAITHANHTOAN]              ,VP.[THANHTIEN_DOANHTHU]              ,YC.[BENHVIEN_ID]              FROM [TT_PHAUTHUAT_YEUCAU] YC              INNER JOIN TT_VIENPHI VP ON YC.DVYEUCAU_ID= VP.REF_ID AND VP.REF_TABLE ='TT_DVYEUCAU'               where                             YC.PHAUTHUAT_ID = '3589'                       and                           YC.BENHVIEN_ID = 'HLU01'                                     order by PHAUTHUAT_YEUCAU_ID]
2019-08-14 18:10:27,710 [1] DEBUG - Statement Id: [DAO00048_TT_PHAUTHUAT_PPVOCAM_GetDetail] PreparedStatement : [select *              from TT_PHAUTHUAT_PPVOCAM              where PHAUTHUAT_ID  = 3589]
2019-08-14 18:10:28,794 [1] DEBUG - Statement Id: [DAO00063_GetListKhoThuocPhongBanPhamvi] PreparedStatement : [select distinct dpv.*        from TM_DUOC_PHAMVISD_MAPPING dmap        left join TM_DUOC_PHAMVISUDUNG dpv on dpv.PHAMVI_ID = dmap.PHAMVI_ID        where dmap.KHODUOC_ID in (select KHODUOC_ID from TM_PHONGBAN_KHODUOC where PHONGBAN_ID = '25')]
2019-08-14 18:10:28,895 [1] DEBUG - Statement Id: [DAO00051_GetTemplateDuoc] PreparedStatement : [select *              from TM_TEMPLATEDUOC               where                             NGUOITAO_ID = '1'                       and                           KHOATAO_ID = '25'                                     ORDER BY TENTEMPLATE]
2019-08-14 18:10:29,231 [1] DEBUG - Statement Id: [DAO00048_TT_VIENPHI_GetList] PreparedStatement : [select *              from TT_VIENPHI               where                             TT_VIENPHI.TIEPNHAN_ID = '24854'                       and                           TT_VIENPHI.BENHAN_ID = '5289'                       and                           TT_VIENPHI.BENHVIEN_ID = 'HLU01'                       and                           TT_VIENPHI.NGUOITAO_ID = '576'                       and                           TT_VIENPHI.NGAYTAO = '6/1/2019 10:19:18 AM'                       and                           TT_VIENPHI.NGUOICAPNHAT_ID = '1'                       and                           TT_VIENPHI.NGAYCAPNHAT = '8/14/2019 6:07:29 PM'                                     order by VIENPHI_ID]
2019-08-14 18:10:29,568 [1] DEBUG - Statement Id: [DAO00048_GetPhauThuat_VTYT_ByPhauThuatID] PreparedStatement : [SELECT            VTYT.PHAUTHUAT_VTYT_ID,            VTYT.PHAUTHUAT_ID,            VTYT.NGAYSUDUNG,            VTYT.TRANGTHAI_XEM,            VTYT.NGUONGOCDULIEU,            VTYT.NGUOITAO_ID,            VTYT.NGAYTAO,            VTYT.DUOC_ID,            VP.SOLUONG,            VTYT.PHAMVI_ID,            VTYT.KHOSUDUNG_ID AS KHODUOC_ID,            VTYT.CHUNGTU_ID,            VTYT.CHUNGTUTONGHOP_ID,            VTYT.NGUONHANG_ID,            VTYT.TINHTIEN,            VTYT.BNTUCHITRA,            VTYT.KHOTAO_ID,            VTYT.COSO,            VTYT.GHICHU,            VP.DONGIA_DOANHTHU,            VP.THANHTIEN_DOANHTHU,            vp.BHYT_DONGIA,            VP.BHYT_THANHTIEN,            CT.MACHUNGTU AS SOPHIEUXUAT,            PL.MACHUNGTU AS SOPHIEULINH            FROM            TT_PHAUTHUAT_VTYT VTYT            left join TT_PHAUTHUAT  PT on PT.PHAUTHUAT_ID = VTYT.PHAUTHUAT_ID            left join TT_VIENPHI VP  on VTYT.PHAUTHUAT_VTYT_ID = VP.REF_ID and VP.REF_TABLE = 'TT_PHAUTHUAT_VTYT'            left join TT_DUOC_CHUNGTU CT on VTYT.CHUNGTU_ID = CT.CHUNGTU_ID            left join TT_DUOC_PHIEULINH PL on VTYT.CHUNGTUTONGHOP_ID = PL.CHUNGTU_ID            WHERE            PT.PHAUTHUAT_ID =  '3589']
2019-08-14 18:10:29,601 [1] DEBUG - Statement Id: [DAO00063_GetListPhamviTuKhoThuocVaPhongBan] PreparedStatement : [select distinct dpv.*, dmap.KHODUOC_ID        from TM_DUOC_PHAMVISD_MAPPING dmap        left join TM_DUOC_PHAMVISUDUNG dpv on dpv.PHAMVI_ID = dmap.PHAMVI_ID and dpv.TAMNGUNG != '1'        where dmap.KHODUOC_ID in (select KHODUOC_ID from TM_PHONGBAN_KHODUOC where PHONGBAN_ID = '25')        and dmap.KHODUOC_ID = '29' and dpv.MAPHAMVI is not null]
2019-08-14 18:10:34,831 [1] DEBUG - Statement Id: [DAO00066_GetBENHAN_TIEPNHAN] PreparedStatement : [select top 1 *        from TT_NOITRU_BENHAN        where TIEPNHAN_ID = '24854'  and BENHVIEN_ID = 'HLU01'        order by NGAYTAO desc]
2019-08-14 18:10:34,908 [1] DEBUG - Statement Id: [DAO00014_GetInPatientStatus] PreparedStatement : [select TRANGTHAI, isnull(KHOACHUYENDEN_ID, KHOAVAO_ID) as KHOAHIENTAI from TT_NOITRU_BENHAN        where        TIEPNHAN_ID = '24854'        and BENHVIEN_ID = 'HLU01'         and           BENHAN_ID = '5289']
2019-08-14 18:10:34,984 [1] DEBUG - Statement Id: [DAO00014_GetORMServiceStatus] PreparedStatement : [select dvyc.TRANGTHAI, pt.NGUOIKHOA_ID, pt.NGUOITAO_ID        from TT_PHAUTHUAT pt        left join TT_PHAUTHUAT_YEUCAU ptyc on ptyc.PHAUTHUAT_ID = pt.PHAUTHUAT_ID        left join (select * from TT_DVYEUCAU where exists (select DVYEUCAU_ID from TT_PHAUTHUAT where TT_DVYEUCAU.DVYEUCAU_ID = DVYEUCAU_ID and PHAUTHUAT_ID = '3589')) dvyc        on ptyc.DVYEUCAU_ID = dvyc.DVYEUCAU_ID        where pt.PHAUTHUAT_ID = '3589']
2019-08-14 18:10:46,211 [1] DEBUG - Statement Id: [DAO00048_GetPhauThuat_VTYT_ByPhauThuatID] PreparedStatement : [SELECT            VTYT.PHAUTHUAT_VTYT_ID,            VTYT.PHAUTHUAT_ID,            VTYT.NGAYSUDUNG,            VTYT.TRANGTHAI_XEM,            VTYT.NGUONGOCDULIEU,            VTYT.NGUOITAO_ID,            VTYT.NGAYTAO,            VTYT.DUOC_ID,            VP.SOLUONG,            VTYT.PHAMVI_ID,            VTYT.KHOSUDUNG_ID AS KHODUOC_ID,            VTYT.CHUNGTU_ID,            VTYT.CHUNGTUTONGHOP_ID,            VTYT.NGUONHANG_ID,            VTYT.TINHTIEN,            VTYT.BNTUCHITRA,            VTYT.KHOTAO_ID,            VTYT.COSO,            VTYT.GHICHU,            VP.DONGIA_DOANHTHU,            VP.THANHTIEN_DOANHTHU,            vp.BHYT_DONGIA,            VP.BHYT_THANHTIEN,            CT.MACHUNGTU AS SOPHIEUXUAT,            PL.MACHUNGTU AS SOPHIEULINH            FROM            TT_PHAUTHUAT_VTYT VTYT            left join TT_PHAUTHUAT  PT on PT.PHAUTHUAT_ID = VTYT.PHAUTHUAT_ID            left join TT_VIENPHI VP  on VTYT.PHAUTHUAT_VTYT_ID = VP.REF_ID and VP.REF_TABLE = 'TT_PHAUTHUAT_VTYT'            left join TT_DUOC_CHUNGTU CT on VTYT.CHUNGTU_ID = CT.CHUNGTU_ID            left join TT_DUOC_PHIEULINH PL on VTYT.CHUNGTUTONGHOP_ID = PL.CHUNGTU_ID            WHERE            PT.PHAUTHUAT_ID =  '3589']
2019-08-14 18:10:50,385 [1] DEBUG - Statement Id: [DAO00048_GetPhauThuat_VTYT_ByPhauThuatID] PreparedStatement : [SELECT            VTYT.PHAUTHUAT_VTYT_ID,            VTYT.PHAUTHUAT_ID,            VTYT.NGAYSUDUNG,            VTYT.TRANGTHAI_XEM,            VTYT.NGUONGOCDULIEU,            VTYT.NGUOITAO_ID,            VTYT.NGAYTAO,            VTYT.DUOC_ID,            VP.SOLUONG,            VTYT.PHAMVI_ID,            VTYT.KHOSUDUNG_ID AS KHODUOC_ID,            VTYT.CHUNGTU_ID,            VTYT.CHUNGTUTONGHOP_ID,            VTYT.NGUONHANG_ID,            VTYT.TINHTIEN,            VTYT.BNTUCHITRA,            VTYT.KHOTAO_ID,            VTYT.COSO,            VTYT.GHICHU,            VP.DONGIA_DOANHTHU,            VP.THANHTIEN_DOANHTHU,            vp.BHYT_DONGIA,            VP.BHYT_THANHTIEN,            CT.MACHUNGTU AS SOPHIEUXUAT,            PL.MACHUNGTU AS SOPHIEULINH            FROM            TT_PHAUTHUAT_VTYT VTYT            left join TT_PHAUTHUAT  PT on PT.PHAUTHUAT_ID = VTYT.PHAUTHUAT_ID            left join TT_VIENPHI VP  on VTYT.PHAUTHUAT_VTYT_ID = VP.REF_ID and VP.REF_TABLE = 'TT_PHAUTHUAT_VTYT'            left join TT_DUOC_CHUNGTU CT on VTYT.CHUNGTU_ID = CT.CHUNGTU_ID            left join TT_DUOC_PHIEULINH PL on VTYT.CHUNGTUTONGHOP_ID = PL.CHUNGTU_ID            WHERE            PT.PHAUTHUAT_ID =  '3589']
2019-08-14 18:10:50,427 [1] DEBUG - Statement Id: [DAO00048_GetDanhSachBookingDuocTheo_PhauThuat_ID] PreparedStatement : [SELECT REF_TABLE,REF_ID ,B.DUOC_ID,B.BENHVIEN_ID,B.SOLUONG, B.PHAMVI_ID  ,B.KHODUOC_ID, B.NGUONHANG_ID, B.NGUONHANG_ID AS NGUONDUOC_ID            FROM TT_DUOC_TONKHO_BOOK_NGOAITRU B            INNER JOIN TT_PHAUTHUAT_VTYT VT ON B.REF_ID=VT.PHAUTHUAT_VTYT_ID            WHERE REF_TABLE='TT_PHAUTHUAT_VTYT' AND VT.PHAUTHUAT_ID='3589'AND B.BENHVIEN_ID='HLU01']
2019-08-14 18:10:50,519 [1] DEBUG - Statement Id: [DAO00014_Delete_Booking] PreparedStatement : [delete from TT_DUOC_TONKHO_BOOK_NGOAITRU        where REF_TABLE =  @param0         and REF_ID =  @param1         and DUOC_ID =  @param2         and BENHVIEN_ID =  @param3          and           PHAMVI_ID =  @param4]
2019-08-14 18:10:50,519 [1] DEBUG - Statement Id: [DAO00014_Delete_Booking] Parameters: [@param0=[REF_TABLE,TT_PHAUTHUAT_VTYT], @param1=[REF_ID,1242], @param2=[DUOC_ID,3], @param3=[BENHVIEN_ID,HLU01], @param4=[PHAMVI_ID,1052]]
2019-08-14 18:10:50,519 [1] DEBUG - Statement Id: [DAO00014_Delete_Booking] Types: [@param0=[String, System.String], @param1=[Int32, System.Int32], @param2=[Int32, System.Int32], @param3=[String, System.String], @param4=[Int32, System.Int32]]
2019-08-14 18:10:50,583 [1] DEBUG - Statement Id: [DAO00048_GetlistvtytBeforeDelete] PreparedStatement : [select * from TT_PHAUTHUAT_VTYT where PHAUTHUAT_ID = 3589]
2019-08-14 18:10:50,613 [1] DEBUG - Statement Id: [DAO00048_DeleteAllVTYT] PreparedStatement : [delete from TT_DUOC_TONKHO_BOOK_NGOAITRU          where REF_TABLE = 'TT_PHAUTHUAT_VTYT' and exists (select PHAUTHUAT_VTYT_ID from TT_PHAUTHUAT_VTYT where TT_DUOC_TONKHO_BOOK_NGOAITRU.REF_ID = PHAUTHUAT_VTYT_ID and PHAUTHUAT_ID = 3589)            delete from TT_VIENPHI          where REF_TABLE = 'TT_PHAUTHUAT_VTYT' and exists (select PHAUTHUAT_VTYT_ID from TT_PHAUTHUAT_VTYT where TT_VIENPHI.REF_ID = PHAUTHUAT_VTYT_ID and PHAUTHUAT_ID = 3589)            delete from TT_PHAUTHUAT_VTYT where PHAUTHUAT_ID = 3589]
2019-08-14 18:10:50,698 [1] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoVaBookingCOM23UpdateRedis] PreparedStatement : [select  distinct tk.DUOC_KEY, LTRIM(tk.PHAMVI_ID) as PHAMVI_ID, tk.NGUONDUOC_ID, nh.TENNGUONDUOC, nh.TINHTIEN, d.DUOC_ID, ld.MALOAIDUOC,        d.SOVISA,d.TYLE_VAT,d.COTOA, d.MADUOC, d.TENHANG, d.TENDUOCDAYDU, dvt.TENDONVITINH as DONVITINH, d.BHYT,        d.TENHOATCHAT, d.HAMLUONG, d.HANGSANXUAT, d.QUOCGIA, d.LOAIDUOC_ID, d.DUONGDUNG_ID, d.TINHTIEN_PTTT,        ten.TENDUOC, ten.TENDUOC_EN, ten.MAQUOCTE, ten.MAQUOCTEBT,        CASE WHEN d.BHYT = '1' THEN 'BHYT' ELSE '' END as BHYT_TEXT        , ld.LOAIVATTU_ID        , d.BENHVIEN_ID,        tk.SOLUONG, d.VTYT_PHANLOAI, d.PHAMVI, d.SUASOLUONGTONGHOP, d.MADUOCBV, d.DANGTRINHBAY        , TAMNGUNG = CASE WHEN d.TAMNGUNG = '1' OR nh.TAMNGUNG = '1' OR kd.TAMNGUNG = '1' THEN '1' ELSE '0' END        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        inner join        (        select  LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')) DUOC_KEY, (SUM(dtk.SOLUONG) - isnull(sum(A.SOLUONG),0) - isnull(sum(B.SOLUONG),0)) SOLUONG, pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        from (select sum(soluong) soluong,duoc_id,nguonduoc_id,khoduoc_id,benhvien_id from TT_DUOC_TONKHO  group by duoc_id,nguonduoc_id,khoduoc_id,benhvien_id) dtk        inner join TM_DUOC_PHAMVISD_MAPPING pvsd on dtk.KHODUOC_ID = pvsd.KHODUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NOITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) B on B.DUOC_ID = dtk.DUOC_ID and B.SOLUONG > 0 and B.PHAMVI_ID = pvsd.PHAMVI_ID and B.NGUONHANG_ID = dtk.NGUONDUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NGOAITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) A on A.DUOC_ID = dtk.DUOC_ID and A.SOLUONG > 0 and A.PHAMVI_ID = pvsd.PHAMVI_ID and A.NGUONHANG_ID = dtk.NGUONDUOC_ID        where dtk.SOLUONG > 0 and dtk.BENHVIEN_ID = 'HLU01'        group by LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')), pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        ) tk on tk.DUOC_ID = d.DUOC_ID        left join TM_DUOC_PHAMVISUDUNG kd on kd.PHAMVI_ID = tk.PHAMVI_ID and kd.BENHVIEN_ID = 'HLU01'        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = tk.NGUONDUOC_ID and nh.BENHVIEN_ID = 'HLU01'        where  d.BENHVIEN_ID = 'HLU01' and d.DUOC_ID in (1242)]
2019-08-14 18:10:51,170 [1] DEBUG - Statement Id: [DAO00048_TT_PHAUTHUAT_GetList] PreparedStatement : [select *              from TT_PHAUTHUAT               where                             TT_PHAUTHUAT.LOAI = 'P'                       and                           TT_PHAUTHUAT.TIEPNHAN_ID = 24854                       and                           TT_PHAUTHUAT.BENHVIEN_ID = 'HLU01'                                     order by PHAUTHUAT_ID DESC]
--------------------------------------------------------------------------------
2019-08-14 18:43:57,801 [1] DEBUG - Statement Id: [DAO00001_DBList] PreparedStatement : [select *              from TM_SYS_SERVER              where HOSPITAL_ID = '_SYSTEM_' and TYPE = 'D']
2019-08-14 18:43:58,072 [1] DEBUG - Statement Id: [DAO00001_DaoList] PreparedStatement : [select              TM_SYS_SERVICEMAP.ID,              TM_SYS_SERVICEMAP.HOSPITAL_ID,              TM_SYS_SERVICEMAP.DB_NAME,              TM_SYS_SERVICEMAP.TYPE,              TM_SYS_SERVICEMAP.NAME,              TM_SYS_SERVICEMAP.CLASS,              (TM_SYS_DIC.VALUE + '.' + TM_SYS_SERVICEMAP.CLASS) as CLASSFULL,              TM_SYS_SERVICEMAP.ASSEMBLY              from TM_SYS_SERVICEMAP              inner join TM_SYS_DIC              on TM_SYS_SERVICEMAP.NAMESPACE = TM_SYS_DIC.ID              where HOSPITAL_ID = '_SYSTEM_' AND TYPE = 'D' AND ACTIVE = '1'              order by DB_NAME]
2019-08-14 18:43:58,113 [1] DEBUG - Statement Id: [DAO00001_ServiceList] PreparedStatement : [select              TM_SYS_SERVICEMAP.ID,              TM_SYS_SERVICEMAP.HOSPITAL_ID,              TM_SYS_SERVICEMAP.DB_NAME,              TM_SYS_SERVICEMAP.TYPE,              TM_SYS_SERVICEMAP.NAME,              TM_SYS_SERVICEMAP.CLASS,              (TM_SYS_DIC.VALUE + '.' + TM_SYS_SERVICEMAP.CLASS) as CLASSFULL,              TM_SYS_SERVICEMAP.ASSEMBLY,              TM_SYS_SERVER.URL              from TM_SYS_SERVICEMAP              inner join TM_SYS_DIC on TM_SYS_SERVICEMAP.NAMESPACE = TM_SYS_DIC.ID              inner join TM_SYS_SERVER on (TM_SYS_SERVICEMAP.DB_NAME = TM_SYS_SERVER.NAME) and (TM_SYS_SERVER.HOSPITAL_ID = '_SYSTEM_')              where TM_SYS_SERVICEMAP.HOSPITAL_ID = '_SYSTEM_' AND TM_SYS_SERVICEMAP.TYPE = 'S'  AND ACTIVE = '1'              order by URL]
2019-08-14 18:43:58,535 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = '_SYSTEM_'               AND                   TM_SYS_SCREEN.PAGE = 'LOGIN'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2019-08-14 18:43:58,809 [1] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = '_SYSTEM_'               AND                   TM_SYS_CACHE.ACTIVE = '1']
2019-08-14 18:44:06,179 [1] DEBUG - Statement Id: [DAO00001_DBList] PreparedStatement : [select *              from TM_SYS_SERVER              where HOSPITAL_ID = 'HLU01' and TYPE = 'D']
2019-08-14 18:44:06,231 [1] DEBUG - Statement Id: [DAO00001_DaoList] PreparedStatement : [select              TM_SYS_SERVICEMAP.ID,              TM_SYS_SERVICEMAP.HOSPITAL_ID,              TM_SYS_SERVICEMAP.DB_NAME,              TM_SYS_SERVICEMAP.TYPE,              TM_SYS_SERVICEMAP.NAME,              TM_SYS_SERVICEMAP.CLASS,              (TM_SYS_DIC.VALUE + '.' + TM_SYS_SERVICEMAP.CLASS) as CLASSFULL,              TM_SYS_SERVICEMAP.ASSEMBLY              from TM_SYS_SERVICEMAP              inner join TM_SYS_DIC              on TM_SYS_SERVICEMAP.NAMESPACE = TM_SYS_DIC.ID              where HOSPITAL_ID = 'HLU01' AND TYPE = 'D' AND ACTIVE = '1'              order by DB_NAME]
2019-08-14 18:44:08,152 [1] DEBUG - Statement Id: [DAO00001_ServiceList] PreparedStatement : [select              TM_SYS_SERVICEMAP.ID,              TM_SYS_SERVICEMAP.HOSPITAL_ID,              TM_SYS_SERVICEMAP.DB_NAME,              TM_SYS_SERVICEMAP.TYPE,              TM_SYS_SERVICEMAP.NAME,              TM_SYS_SERVICEMAP.CLASS,              (TM_SYS_DIC.VALUE + '.' + TM_SYS_SERVICEMAP.CLASS) as CLASSFULL,              TM_SYS_SERVICEMAP.ASSEMBLY,              TM_SYS_SERVER.URL              from TM_SYS_SERVICEMAP              inner join TM_SYS_DIC on TM_SYS_SERVICEMAP.NAMESPACE = TM_SYS_DIC.ID              inner join TM_SYS_SERVER on (TM_SYS_SERVICEMAP.DB_NAME = TM_SYS_SERVER.NAME) and (TM_SYS_SERVER.HOSPITAL_ID = 'HLU01')              where TM_SYS_SERVICEMAP.HOSPITAL_ID = 'HLU01' AND TM_SYS_SERVICEMAP.TYPE = 'S'  AND ACTIVE = '1'              order by URL]
2019-08-14 18:44:08,242 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1']
2019-08-14 18:44:09,100 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM005']
2019-08-14 18:44:09,265 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM015']
2019-08-14 18:44:09,362 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM067']
2019-08-14 18:44:09,474 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM008']
2019-08-14 18:44:09,584 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM068']
2019-08-14 18:44:09,656 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM006']
2019-08-14 18:44:09,739 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM030']
2019-08-14 18:44:09,824 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM025']
2019-08-14 18:44:09,896 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM024']
2019-08-14 18:44:10,418 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM033']
2019-08-14 18:44:10,455 [5] DEBUG - Statement Id: [DAO00027_GetListDuocKyGuiTonKho] PreparedStatement : [select  distinct TT_TONKHO.DUOC_KEY, LTRIM(TT_TONKHO.KHODUOC_ID) as KHODUOC_ID, TM_DUOC.DUOC_ID, TM_LOAIDUOC.MALOAIDUOC,TM_DUOC.SOVISA,TM_DUOC.TYLE_VAT,TM_DUOC.COTOA,        TM_DUOC.MADUOC, TM_DUOC.TENHANG, TM_DUOC.TENDUOCDAYDU, dvt.TENDONVITINH as DONVITINH,  TM_DUOC.DONVITINH_ID,TM_DUOC.BHYT,TM_DUOC.PHAMVI,        TM_DUOC.TENHOATCHAT, TM_DUOC.HAMLUONG, TM_DUOC.HANGSANXUAT, TM_DUOC.QUOCGIA, TM_DUOC.LOAIDUOC_ID, TM_DUOC.DUONGDUNG_ID,        TM_TENDUOC.TENDUOC, TM_TENDUOC.TENDUOC_EN, TM_TENDUOC.MAQUOCTE, TM_TENDUOC.MAQUOCTEBT,        TM_LOAIDUOC.LOAIVATTU_ID, TM_DUOC.BENHVIEN_ID,TT_TONKHO.SOLUONG, TT_TONKHO.NGUONDUOC_ID, NH.TENNGUONDUOC        , TAMNGUNG = CASE WHEN TM_DUOC.TAMNGUNG = '1' OR nh.TAMNGUNG = '1' OR KD.TAMNGUNG = '1' THEN '1' ELSE '0' END        , TM_DUOC.DANGTRINHBAY        from TM_DUOC        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = TM_DUOC.DONVITINH_ID        left join TM_TENDUOC on TM_DUOC.TENDUOC_ID = TM_TENDUOC.TENDUOC_ID and TM_DUOC.BENHVIEN_ID = 'HLU01' and TM_DUOC.TAMNGUNG = '0'        left join TM_LOAIDUOC on TM_LOAIDUOC.LOAIDUOC_ID = TM_DUOC.LOAIDUOC_ID and TM_LOAIDUOC.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG on (TM_LOAIDUOC.LOAIVATTU_ID = TM_DUOC_HANDUNG.LOAIDUOC and TM_DUOC_HANDUNG.BENHVIEN_ID = 'HLU01')        inner join        (select LTRIM(A.KHODUOC_ID) + '_' + LTRIM(A.DUOC_ID) + '_' + LTRIM(ISNULL(A.NGUONDUOC_ID,'')) as DUOC_KEY, A.KHODUOC_ID, A.DUOC_ID,A.NGUONDUOC_ID,        SUM(isnull(A.SOLUONG,0)) as SOLUONG        from        (select SUM(SOLUONG) as SOLUONG, KHODUOC_ID, DUOC_ID, NGUONDUOC_ID from TT_DUOC_KYGUI_TONKHO        where BENHVIEN_ID = 'HLU01' group by KHODUOC_ID, DUOC_ID, NGUONDUOC_ID) A        group by LTRIM(A.KHODUOC_ID) + '_' + LTRIM(A.DUOC_ID) + '_' + LTRIM(A.NGUONDUOC_ID), A.KHODUOC_ID, A.DUOC_ID, A.NGUONDUOC_ID)        TT_TONKHO on TT_TONKHO.DUOC_ID = TM_DUOC.DUOC_ID        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = TT_TONKHO.NGUONDUOC_ID and nh.BENHVIEN_ID = 'HLU01'        LEFT JOIN TM_KHODUOC KD ON KD.KHODUOC_ID = TT_TONKHO.KHODUOC_ID        where TM_DUOC.BENHVIEN_ID = 'HLU01' AND TT_TONKHO.SOLUONG >= 0]
2019-08-14 18:44:10,530 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM018']
2019-08-14 18:44:10,566 [5] DEBUG - Statement Id: [DAO00027_GetListDuocTonKho] PreparedStatement : [select distinct TT_TONKHO.DUOC_KEY, LTRIM(TT_TONKHO.KHODUOC_ID) as KHODUOC_ID, TM_DUOC.DUOC_ID, TM_LOAIDUOC.MALOAIDUOC,TM_DUOC.SOVISA,TM_DUOC.TYLE_VAT,TM_DUOC.COTOA,        TM_DUOC.MADUOC, TM_DUOC.TENHANG, TM_DUOC.TENDUOCDAYDU, dvt.TENDONVITINH as DONVITINH,  TM_DUOC.DONVITINH_ID,TM_DUOC.BHYT,                TM_DUOC.TENHOATCHAT,          TM_DUOC.HAMLUONG, TM_DUOC.HANGSANXUAT, TM_DUOC.QUOCGIA, TM_DUOC.LOAIDUOC_ID, TM_DUOC.DUONGDUNG_ID,        TM_TENDUOC.TENDUOC, TM_TENDUOC.TENDUOC_EN, TM_TENDUOC.MAQUOCTE, TM_TENDUOC.MAQUOCTEBT,        TM_LOAIDUOC.LOAIVATTU_ID, TM_DUOC.BENHVIEN_ID,        TT_TONKHO.SOLUONG, TM_DUOC.VTYT_PHANLOAI, TM_DUOC.PHAMVI, TT_TONKHO.NGUONDUOC_ID, NG.TENNGUONDUOC AS TENNGUONDUOC        , TAMNGUNG = CASE WHEN TM_DUOC.TAMNGUNG = '1' OR NG.TAMNGUNG = '1' OR KD.TAMNGUNG = '1' THEN '1' ELSE '0' END        , TM_DUOC.DANGTRINHBAY        from TM_DUOC        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = TM_DUOC.DONVITINH_ID        left join TM_TENDUOC on TM_DUOC.TENDUOC_ID = TM_TENDUOC.TENDUOC_ID and TM_DUOC.BENHVIEN_ID = 'HLU01' and TM_DUOC.TAMNGUNG = '0'        left join TM_LOAIDUOC on TM_LOAIDUOC.LOAIDUOC_ID = TM_DUOC.LOAIDUOC_ID and TM_LOAIDUOC.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG on (TM_LOAIDUOC.LOAIVATTU_ID = TM_DUOC_HANDUNG.LOAIDUOC and TM_DUOC_HANDUNG.BENHVIEN_ID = 'HLU01')        inner join        (select LTRIM(A.KHODUOC_ID) + '_' + LTRIM(A.DUOC_ID) + '_' + LTRIM(ISNULL(A.NGUONDUOC_ID,'')) as DUOC_KEY, A.KHODUOC_ID, A.DUOC_ID, A.NGUONDUOC_ID,        SUM(isnull(A.SOLUONG,0)) as SOLUONG        from        (select SUM(SOLUONG) as SOLUONG, KHODUOC_ID, DUOC_ID, NGUONDUOC_ID from TT_DUOC_TONKHO        where BENHVIEN_ID = 'HLU01' group by KHODUOC_ID, DUOC_ID, NGUONDUOC_ID) A        group by LTRIM(A.KHODUOC_ID) + '_' + LTRIM(A.DUOC_ID) + '_' + LTRIM(ISNULL(A.NGUONDUOC_ID,'')), A.KHODUOC_ID, A.DUOC_ID, NGUONDUOC_ID        ) TT_TONKHO on TT_TONKHO.DUOC_ID = TM_DUOC.DUOC_ID        LEFT JOIN TM_NGUONHANG NG ON NG.NGUONDUOC_ID = TT_TONKHO.NGUONDUOC_ID        LEFT JOIN TM_KHODUOC KD ON KD.KHODUOC_ID = TT_TONKHO.KHODUOC_ID        where TM_DUOC.BENHVIEN_ID = 'HLU01' and TT_TONKHO.SOLUONG >= 0]
2019-08-14 18:44:11,617 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM023']
2019-08-14 18:44:11,652 [5] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoVaBooking] PreparedStatement : [declare @TOAMUANGOAI int = 0;        select @TOAMUANGOAI = isnull(VALUE,0) from TM_SYS_APPSETTINGS where CODE = 'OPD_TOAMUANGOAI_DUNGDANHMUC_DUOC'                if @TOAMUANGOAI = 1        begin        select  distinct '0' + '_' + LTRIM(d.DUOC_ID) + '_' + '0' as DUOC_KEY, 0 as PHAMVI_ID, 0 as NGUONDUOC_ID, null as TENNGUONDUOC, null as TINHTIEN, d.DUOC_ID, ld.MALOAIDUOC,        d.SOVISA,d.TYLE_VAT,d.COTOA, d.MADUOC, d.TENHANG, d.TENDUOCDAYDU, d.DONVITINH as DONVITINH, d.BHYT,        d.TENHOATCHAT, d.HAMLUONG, d.HANGSANXUAT, d.QUOCGIA, d.LOAIDUOC_ID, d.DUONGDUNG_ID, d.TINHTIEN_PTTT,        ten.TENDUOC, ten.TENDUOC_EN, ten.MAQUOCTE, ten.MAQUOCTEBT,        '' as BHYT_TEXT        , ld.LOAIVATTU_ID        , d.BENHVIEN_ID,        999999999 as SOLUONG, d.VTYT_PHANLOAI, d.PHAMVI, d.SUASOLUONGTONGHOP, d.MADUOCBV, d.DANGTRINHBAY        , TAMNGUNG = CASE WHEN d.TAMNGUNG = '1' THEN '1' ELSE '0' END        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        union all        select  distinct tk.DUOC_KEY, LTRIM(tk.PHAMVI_ID) as PHAMVI_ID, tk.NGUONDUOC_ID, nh.TENNGUONDUOC, nh.TINHTIEN, d.DUOC_ID, ld.MALOAIDUOC,        d.SOVISA,d.TYLE_VAT,d.COTOA, d.MADUOC, d.TENHANG, d.TENDUOCDAYDU, dvt.TENDONVITINH as DONVITINH, d.BHYT,        d.TENHOATCHAT, d.HAMLUONG, d.HANGSANXUAT, d.QUOCGIA, d.LOAIDUOC_ID, d.DUONGDUNG_ID, d.TINHTIEN_PTTT,        ten.TENDUOC, ten.TENDUOC_EN, ten.MAQUOCTE, ten.MAQUOCTEBT,        CASE WHEN d.BHYT = '1' THEN 'BHYT' ELSE '' END as BHYT_TEXT        , ld.LOAIVATTU_ID        , d.BENHVIEN_ID,        tk.SOLUONG, d.VTYT_PHANLOAI, d.PHAMVI, d.SUASOLUONGTONGHOP, d.MADUOCBV, d.DANGTRINHBAY        , TAMNGUNG = CASE WHEN d.TAMNGUNG = '1' OR nh.TAMNGUNG = '1' OR kd.TAMNGUNG = '1' THEN '1' ELSE '0' END        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        inner join        (        select  LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')) DUOC_KEY, (SUM(dtk.SOLUONG) - isnull(sum(A.SOLUONG),0) - isnull(sum(B.SOLUONG),0)) SOLUONG, pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        from (select sum(soluong) soluong,duoc_id,nguonduoc_id,khoduoc_id,benhvien_id from TT_DUOC_TONKHO  group by duoc_id,nguonduoc_id,khoduoc_id,benhvien_id) dtk        inner join TM_DUOC_PHAMVISD_MAPPING pvsd on dtk.KHODUOC_ID = pvsd.KHODUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NOITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) B on B.DUOC_ID = dtk.DUOC_ID and B.SOLUONG > 0 and B.PHAMVI_ID = pvsd.PHAMVI_ID and B.NGUONHANG_ID = dtk.NGUONDUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NGOAITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) A on A.DUOC_ID = dtk.DUOC_ID and A.SOLUONG > 0 and A.PHAMVI_ID = pvsd.PHAMVI_ID and A.NGUONHANG_ID = dtk.NGUONDUOC_ID        where dtk.SOLUONG > 0 and dtk.BENHVIEN_ID = 'HLU01'        group by LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')), pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        ) tk on tk.DUOC_ID = d.DUOC_ID        left join TM_DUOC_PHAMVISUDUNG kd on kd.PHAMVI_ID = tk.PHAMVI_ID and kd.BENHVIEN_ID = 'HLU01'        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = tk.NGUONDUOC_ID and nh.BENHVIEN_ID = 'HLU01'        where d.BENHVIEN_ID = 'HLU01'  and tk.SOLUONG >= 0         end                else        begin        select  distinct tk.DUOC_KEY, LTRIM(tk.PHAMVI_ID) as PHAMVI_ID, tk.NGUONDUOC_ID, nh.TENNGUONDUOC, nh.TINHTIEN, d.DUOC_ID, ld.MALOAIDUOC,        d.SOVISA,d.TYLE_VAT,d.COTOA, d.MADUOC, d.TENHANG, d.TENDUOCDAYDU, d.DONVITINH as DONVITINH, d.BHYT,        d.TENHOATCHAT, d.HAMLUONG, d.HANGSANXUAT, d.QUOCGIA, d.LOAIDUOC_ID, d.DUONGDUNG_ID, d.TINHTIEN_PTTT,        ten.TENDUOC, ten.TENDUOC_EN, ten.MAQUOCTE, ten.MAQUOCTEBT,        CASE WHEN d.BHYT = '1' THEN 'BHYT' ELSE '' END as BHYT_TEXT        , ld.LOAIVATTU_ID        , d.BENHVIEN_ID,        tk.SOLUONG, d.VTYT_PHANLOAI, d.PHAMVI, d.SUASOLUONGTONGHOP, d.MADUOCBV, d.DANGTRINHBAY        , TAMNGUNG = CASE WHEN d.TAMNGUNG = '1' OR nh.TAMNGUNG = '1' OR kd.TAMNGUNG = '1' THEN '1' ELSE '0' END        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        inner join        (        select  LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')) DUOC_KEY, (SUM(dtk.SOLUONG) - isnull(sum(A.SOLUONG),0) - isnull(sum(B.SOLUONG),0)) SOLUONG, pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        from (select sum(soluong) soluong,duoc_id,nguonduoc_id,khoduoc_id,benhvien_id from TT_DUOC_TONKHO  group by duoc_id,nguonduoc_id,khoduoc_id,benhvien_id) dtk        inner join TM_DUOC_PHAMVISD_MAPPING pvsd on dtk.KHODUOC_ID = pvsd.KHODUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NOITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) B on B.DUOC_ID = dtk.DUOC_ID and B.SOLUONG > 0 and B.PHAMVI_ID = pvsd.PHAMVI_ID and B.NGUONHANG_ID = dtk.NGUONDUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NGOAITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) A on A.DUOC_ID = dtk.DUOC_ID and A.SOLUONG > 0 and A.PHAMVI_ID = pvsd.PHAMVI_ID and A.NGUONHANG_ID = dtk.NGUONDUOC_ID        where dtk.SOLUONG > 0 and dtk.BENHVIEN_ID = 'HLU01'        group by LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')), pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        ) tk on tk.DUOC_ID = d.DUOC_ID        left join TM_DUOC_PHAMVISUDUNG kd on kd.PHAMVI_ID = tk.PHAMVI_ID and kd.BENHVIEN_ID = 'HLU01'        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = tk.NGUONDUOC_ID and nh.BENHVIEN_ID = 'HLU01'        where d.BENHVIEN_ID = 'HLU01'  and tk.SOLUONG >= 0        end]
2019-08-14 18:44:13,772 [5] DEBUG - Statement Id: [DAO00320_GetList] PreparedStatement : [select M.*            from TM_MAU M            LEFT JOIN TM_MAU_DONVITINH DVT on M.DONVITINH_ID=DVT.DONVITINH_ID            where            M.TAMNGUNG = '0'            and M.BENHVIEN_ID = 'HLU01'            order by M.TENMAU]
2019-08-14 18:44:13,834 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM071']
2019-08-14 18:44:13,868 [5] DEBUG - Statement Id: [DAO00322_GetListMauTonKhoForCreateCached] PreparedStatement : [SELECT DISTINCT          TK.MAU_KEY, TK.KHOMAU_ID, M.MAU_ID, M.MAMAU, M.TENMAU, M.NHOM_ABO, M.NHOM_RH, M.LOAIMAU_ID,          TK.SOLONHAP_ID, SLN.SOLONHAP, SLN.SOKIEMSOAT, TK.NGUONHANG_ID, NG.TENNGUONMAU, M.BENHVIEN_ID, M.DONVITINH_ID,          SUM(tk.SOLUONG) AS SOLUONG,K.TENKHO,DVT.TENDONVITINH          FROM TT_MAU_TONKHO TK          JOIN TM_KHO K ON TK.KHOMAU_ID = K.KHO_ID          JOIN TT_MAU_CHUNGTU_SOLONHAP SLN ON TK.SOLONHAP_ID = SLN.SOLONHAP_ID          JOIN TM_MAU M on TK.MAU_ID = M.MAU_ID and M.TAMNGUNG = '0'          LEFT JOIN TM_MAU_DONVITINH DVT on M.DONVITINH_ID=DVT.DONVITINH_ID          LEFT JOIN TM_NGUONMAU NG ON NG.NGUONMAU_ID = TK.NGUONHANG_ID          WHERE TK.SOLUONG > 0          GROUP BY TK.MAU_KEY, TK.KHOMAU_ID, M.MAU_ID, M.MAMAU, M.TENMAU, M.NHOM_ABO, M.NHOM_RH, M.LOAIMAU_ID,          TK.SOLONHAP_ID, SLN.SOLONHAP, SLN.SOKIEMSOAT,TK.NGUONHANG_ID, NG.TENNGUONMAU, M.BENHVIEN_ID, M.DONVITINH_ID,K.TENKHO,DVT.TENDONVITINH]
2019-08-14 18:44:13,949 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM073']
2019-08-14 18:44:13,983 [5] DEBUG - Statement Id: [DAO00322_GetListMauTonKhoTruBooking] PreparedStatement : [select distinct          TK.MAU_KEY, TK.KHOMAU_ID, M.MAU_ID, M.MAMAU, M.TENMAU, M.NHOM_ABO, M.NHOM_RH, M.LOAIMAU_ID, M.DONVITINH_ID,          TK.SOLONHAP_ID, TK.SOLONHAP, TK.SOKIEMSOAT,M.PHAMVI, TK.NGUONHANG_ID, NG.TENNGUONMAU, M.BENHVIEN_ID,          TK.SOLUONG,TK.TENKHO,DVT.TENDONVITINH          from TM_MAU M          JOIN          (          select          A.MAU_KEY, A.KHOMAU_ID, A.MAU_ID ,a.NGUONHANG_ID, A.SOLONHAP_ID, A.SOLONHAP, A.SOKIEMSOAT, A.SOLUONG,A.TENKHO          from          (          select KHOMAU_ID, TK.MAU_ID, TK.NGUONHANG_ID, TK.MAU_KEY, SLN.SOLONHAP_ID, SLN.SOLONHAP, SLN.SOKIEMSOAT, ISNULL(TK.SOLUONG,0) - ISNULL(book.SOLUONG,0) as SOLUONG,K.TENKHO          from TT_MAU_TONKHO TK          JOIN TM_KHO K ON TK.KHOMAU_ID = K.KHO_ID          inner join TT_MAU_CHUNGTU_SOLONHAP SLN ON TK.SOLONHAP_ID = SLN.SOLONHAP_ID          left join dbo.TT_MAU_TONKHO_BOOK book ON book.MAU_KEY = TK.MAU_KEY AND book.TRANGTHAI = 'HIEULUC'          where ISNULL(TK.SOLUONG,0) - ISNULL(book.SOLUONG,0) > 0          ) A          )TK on TK.MAU_ID = M.MAU_ID and M.TAMNGUNG = '0'          LEFT JOIN TM_MAU_DONVITINH DVT on M.DONVITINH_ID=DVT.DONVITINH_ID          LEFT JOIN TM_NGUONMAU NG ON NG.NGUONMAU_ID = TK.NGUONHANG_ID]
2019-08-14 18:44:14,054 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM072']
2019-08-14 18:44:14,985 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'MAIN'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2019-08-14 18:44:15,883 [1] DEBUG - Statement Id: [DAO00002_FormList] PreparedStatement : [select              TM_SYS_FORM.HOSPITAL_ID,              TM_SYS_FORM.NAME,              TM_SYS_FORM.CLASS,              TM_SYS_FORM.ASSEMBLY,              TM_SYS_FORM.TITLE_VI as TITLE              from TM_SYS_FORM              where HOSPITAL_ID = 'HLU01']
2019-08-14 18:44:21,070 [1] DEBUG - Statement Id: [DAO00300_GetShortcutListByUserID] PreparedStatement : [SELECT S.SHORTCUT_CODE, S.SHORTCUT_VALUE              FROM TM_SHORTCUT AS S              WHERE S.BENHVIEN_ID = 'HLU01' AND S.USER_ID = '1' AND TAMNGUNG = '0']
2019-08-14 18:44:21,146 [1] DEBUG - Statement Id: [DAO00087_GetList] PreparedStatement : [select CODE, VALUE, BENHVIEN_ID              from TM_SYS_APPSETTINGS              where LOCKED = '0' and BENHVIEN_ID = 'HLU01'              order by SETTING_ID]
2019-08-14 18:44:21,294 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'MSG01'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2019-08-14 18:44:21,652 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'MSG02'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2019-08-14 18:44:21,818 [1] DEBUG - Statement Id: [DAO00008_GetUserSettings] PreparedStatement : [select A.*, B.TENKHO , C.TENPHONGBAN, B.MAKHO, C.MAPHONGBAN          from TM_SYS_USERS A          left join TM_KHODUOC B on B.KHODUOC_ID = A.INVENTORY_ID          left join TM_PHONGBAN C on (C.PHONGBAN_ID = A.WORKING_DEPT_ID and C.BENHVIEN_ID =  @param0 )          left join TM_SYS_USERKHO D on (D.ACCOUNT_ID = A.ACCOUNT_ID and D.HOSPITAL_ID =  @param0 )          where          A.HOSPITAL_ID =  @param0            and                 A.ACCOUNT_ID =  @param1]
2019-08-14 18:44:21,822 [1] DEBUG - Statement Id: [DAO00008_GetUserSettings] Parameters: [@param0=[HOSPITAL_ID,HLU01], @param1=[ACCOUNT_ID,113]]
2019-08-14 18:44:21,822 [1] DEBUG - Statement Id: [DAO00008_GetUserSettings] Types: [@param0=[String, System.String], @param1=[String, System.String]]
2019-08-14 18:44:21,851 [1] DEBUG - Statement Id: [DAO00008_GetUserInvSettings] PreparedStatement : [select A.*, B.TENKHO, B.MAKHO, B.LOAIKHO_ID, B.KHOQUANLY_ID          from TM_SYS_USERKHO A          left join TM_KHO B on B.MODULE_ID = A.MODULE_ID and B.KHO_ID = A.KHO_ID          where A.HOSPITAL_ID =  @param0  and A.ACCOUNT_ID =  @param1           order by B.TENKHO]
2019-08-14 18:44:21,851 [1] DEBUG - Statement Id: [DAO00008_GetUserInvSettings] Parameters: [@param0=[HOSPITAL_ID,HLU01], @param1=[ACCOUNT_ID,113]]
2019-08-14 18:44:21,851 [1] DEBUG - Statement Id: [DAO00008_GetUserInvSettings] Types: [@param0=[String, System.String], @param1=[String, System.String]]
2019-08-14 18:44:22,029 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'COM30'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2019-08-14 18:44:22,230 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'RIS04'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2019-08-14 18:44:30,963 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'MENU1'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2019-08-14 18:44:31,140 [1] DEBUG - Statement Id: [DAO00011_GetList] PreparedStatement : [select              TM_SYS_MENU.ID,              TM_SYS_MENU.PARENTID,              TM_SYS_MENU.SCREEN,              TM_SYS_MENU.SMALLIMAGE,              TM_SYS_MENU.LARGEIMAGE,              TM_SYS_MENU.DESCRIPTION,              TM_SYS_MENU.TYPE,              TM_SYS_MENU.TITLE_VI as TITLE              from TM_SYS_MENU              where TM_SYS_MENU.HOSPITAL_ID = 'HLU01' and TM_SYS_MENU.ACTIVE = '1'               AND                   (TM_SYS_MENU.TYPE & '8' = '8')                             order by TM_SYS_MENU.ORDERNUM]
2019-08-14 18:44:31,664 [1] DEBUG - Statement Id: [DAO00011_usermenu_list] PreparedStatement : [select              TM_SYS_HOMEMENU.MENUID as ID,              TM_SYS_MENU.TITLE_VI as TITLE,              TM_SYS_MENU.SCREEN,              TM_SYS_MENU.SMALLIMAGE,              TM_SYS_MENU.LARGEIMAGE,              TM_SYS_MENU.TYPE              from TM_SYS_HOMEMENU              left join TM_SYS_MENU on TM_SYS_MENU.ID = TM_SYS_HOMEMENU.MENUID and TM_SYS_MENU.HOSPITAL_ID = TM_SYS_HOMEMENU.HOSPITAL_ID              where TM_SYS_HOMEMENU.HOSPITAL_ID = 'HLU01' and TM_SYS_HOMEMENU.USERID = '113' and TM_SYS_MENU.ACTIVE = '1'               AND                   (TM_SYS_MENU.TYPE & '8' = '8')                             ORDER BY TM_SYS_HOMEMENU.ORDERNUM]
2019-08-14 18:45:34,999 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'EMR04'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2019-08-14 18:45:35,242 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'EMR05'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2019-08-14 18:45:40,794 [1] DEBUG - Statement Id: [DAO00013_GetTTBenhNhanByMaYTe] PreparedStatement : [select *              from TT_BENHNHAN              where MAYTE  = '']
2019-08-14 18:45:40,915 [1] DEBUG - Statement Id: [DAO00014_GetTTinKhamBenhByBenhNhanID] PreparedStatement : [select *        from TT_NGOAITRU_KHAMBENH        where BENHNHAN_ID  =  @param0         and BENHVIEN_ID = 'HLU01'                    and NGAYKHAM >= '2/14/2019 12:00:00 AM'                  and NGAYKHAM <= '8/14/2019 12:00:00 AM'               order by THOIGIANKHAM desc]
2019-08-14 18:45:40,915 [1] DEBUG - Statement Id: [DAO00014_GetTTinKhamBenhByBenhNhanID] Parameters: [@param0=[BENHNHAN_ID,null]]
2019-08-14 18:45:40,915 [1] DEBUG - Statement Id: [DAO00014_GetTTinKhamBenhByBenhNhanID] Types: [@param0=[System.DBNull, null]]
2019-08-14 18:45:42,661 [1] DEBUG - Statement Id: [DAO00013_GetTTBenhNhanByMaYTe] PreparedStatement : [select *              from TT_BENHNHAN              where MAYTE  = '']
2019-08-14 18:45:42,712 [1] DEBUG - Statement Id: [DAO00014_GetTTinKhamBenhByBenhNhanID] PreparedStatement : [select *        from TT_NGOAITRU_KHAMBENH        where BENHNHAN_ID  =  @param0         and BENHVIEN_ID = 'HLU01'                    and NGAYKHAM >= '2/14/2019 12:00:00 AM'                  and NGAYKHAM <= '8/14/2019 12:00:00 AM'               order by THOIGIANKHAM desc]
2019-08-14 18:45:42,712 [1] DEBUG - Statement Id: [DAO00014_GetTTinKhamBenhByBenhNhanID] Parameters: [@param0=[BENHNHAN_ID,null]]
2019-08-14 18:45:42,712 [1] DEBUG - Statement Id: [DAO00014_GetTTinKhamBenhByBenhNhanID] Types: [@param0=[System.DBNull, null]]
2019-08-14 18:45:45,025 [1] DEBUG - Statement Id: [DAO00013_GetTTBenhNhanByMaYTe] PreparedStatement : [select *              from TT_BENHNHAN              where MAYTE  = '']
2019-08-14 18:45:45,451 [1] DEBUG - Statement Id: [DAO00014_GetTTinKhamBenhByBenhNhanID] PreparedStatement : [select *        from TT_NGOAITRU_KHAMBENH        where BENHNHAN_ID  =  @param0         and BENHVIEN_ID = 'HLU01'                    and NGAYKHAM >= '2/14/2019 12:00:00 AM'                  and NGAYKHAM <= '8/14/2019 12:00:00 AM'               order by THOIGIANKHAM desc]
2019-08-14 18:45:45,451 [1] DEBUG - Statement Id: [DAO00014_GetTTinKhamBenhByBenhNhanID] Parameters: [@param0=[BENHNHAN_ID,null]]
2019-08-14 18:45:45,451 [1] DEBUG - Statement Id: [DAO00014_GetTTinKhamBenhByBenhNhanID] Types: [@param0=[System.DBNull, null]]
2019-08-14 18:45:56,939 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'IPD02'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2019-08-14 18:45:57,372 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'IPD40'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2019-08-14 18:45:57,630 [1] DEBUG - Statement Id: [DAO00069_GetCountDanhSachNoiTru] PreparedStatement : [select count(A.SOBENHAN) as TOTALROWS        from TT_NOITRU_BENHAN A        inner join TT_TIEPNHAN B on B.TIEPNHAN_ID = A.TIEPNHAN_ID and (B.TRANGTHAI = 'NOITRU' or B.TRANGTHAI = 'HOANTHANH')        inner join TT_BENHNHAN C on C.BENHNHAN_ID = B.BENHNHAN_ID        left join TT_NOITRU_LUUTRU D on D.BENHAN_ID = A.BENHAN_ID        and D.LUUTRU_ID = ( select top 1 LUUTRU_ID from TT_NOITRU_LUUTRU where BENHAN_ID = A.BENHAN_ID order by BENHAN_ID desc)        left join TT_NOITRU_XACNHAN E on E.BENHAN_ID = A.BENHAN_ID        left join TT_NOITRU_LUUTRUCHITIET F on D.LUUTRU_ID = F.LUUTRU_ID and F.LUUTRUCHITIET_CURRENT = '1'        and F.LUUTRUCHITIET_ID in (select top 1 LUUTRUCHITIET_ID from TT_NOITRU_LUUTRUCHITIET where LUUTRU_ID = D.LUUTRU_ID order by LUUTRUCHITIET_ID desc)        where        A.KHOACHUYENDEN_ID is not null  and        (E.TRANGTHAI = 'DAXACNHAN' OR E.TRANGTHAI = 'HUYXACNHAN')         and           cast(A.NGAYVAOKHOA as date) <= cast('8/14/2019 12:00:00 AM' as date)                 and B.BENHVIEN_ID = 'HLU01' and A.KHOACHUYENDEN_ID = '25'          AND             A.TRANGTHAI in ('DANGDIEUTRI')]
2019-08-14 18:45:58,443 [1] DEBUG - Statement Id: [DAO00069_GetDanhSachNoiTru] PreparedStatement : [select * from        (        SELECT ROW_NUMBER() OVER(order by B.SOTIEPNHAN) as ROWNUMBER,          A.SOBENHAN, A.BENHAN_ID, A.SOLUUTRU                 , E.NOILAP_ID as KHOAVAO_ID        , A.TRANGTHAI, IsNull(A.BACSIDIEUTRI_ID, E.BACSICHIDINH_ID) as BACSIDIEUTRI_ID,        B.TIEPNHAN_ID, B.SOTIEPNHAN, B.SOBHYT as SOTHE, B.DOITUONG_ID, A.NGAYVAOKHOA as NGAYCAPCUU, A.THOIGIANVAOKHOA as THOIGIANCAPCUU,        C.TENBENHNHAN, C.NGAYSINH, C.NAMSINH, C.BENHNHAN_ID, C.MAYTE, F.GIUONGBENH_ID, A.THOIGIANRAVIEN    , DIACHITHUONGTRU, DANTOC_ID        ,BENHVIEN_STT_ID                from TT_NOITRU_BENHAN A        inner join TT_TIEPNHAN B on B.TIEPNHAN_ID = A.TIEPNHAN_ID and (B.TRANGTHAI = 'NOITRU' or B.TRANGTHAI = 'HOANTHANH')        inner join TT_BENHNHAN C on C.BENHNHAN_ID = B.BENHNHAN_ID        left join TT_NOITRU_LUUTRU D on D.BENHAN_ID = A.BENHAN_ID        and D.LUUTRU_ID = ( select top 1 LUUTRU_ID from TT_NOITRU_LUUTRU where BENHAN_ID = A.BENHAN_ID order by LUUTRU_ID desc)        left join TT_NOITRU_XACNHAN E on E.BENHAN_ID = A.BENHAN_ID        left join TT_NOITRU_LUUTRUCHITIET F on D.LUUTRU_ID = F.LUUTRU_ID and F.LUUTRUCHITIET_CURRENT = '1'        and F.LUUTRUCHITIET_ID in (select top 1 LUUTRUCHITIET_ID from TT_NOITRU_LUUTRUCHITIET where LUUTRU_ID = D.LUUTRU_ID order by LUUTRUCHITIET_ID desc)        left join (select MABENHVIEN, BENHVIEN_STT_ID from TM_BENHVIEN) H on SUBSTRING(B.SOBHYT, 16, 5)=H.MABENHVIEN        where        A.KHOACHUYENDEN_ID is not null  and        (E.TRANGTHAI = 'DAXACNHAN' OR E.TRANGTHAI = 'HUYXACNHAN')         and           cast(A.NGAYVAOKHOA as date) <= cast('8/14/2019 12:00:00 AM' as date)                 and B.BENHVIEN_ID = 'HLU01' and A.KHOACHUYENDEN_ID = '25'          AND             A.TRANGTHAI in ('DANGDIEUTRI')                   ) lst        where        lst.ROWNUMBER between 1 and 20        order by lst.SOTIEPNHAN]
2019-08-14 18:46:00,595 [1] DEBUG - Statement Id: [DAO00069_GetCountDanhSachNoiTru] PreparedStatement : [select count(A.SOBENHAN) as TOTALROWS        from TT_NOITRU_BENHAN A        inner join TT_TIEPNHAN B on B.TIEPNHAN_ID = A.TIEPNHAN_ID and (B.TRANGTHAI = 'NOITRU' or B.TRANGTHAI = 'HOANTHANH')        inner join TT_BENHNHAN C on C.BENHNHAN_ID = B.BENHNHAN_ID        left join TT_NOITRU_LUUTRU D on D.BENHAN_ID = A.BENHAN_ID        and D.LUUTRU_ID = ( select top 1 LUUTRU_ID from TT_NOITRU_LUUTRU where BENHAN_ID = A.BENHAN_ID order by BENHAN_ID desc)        left join TT_NOITRU_XACNHAN E on E.BENHAN_ID = A.BENHAN_ID        left join TT_NOITRU_LUUTRUCHITIET F on D.LUUTRU_ID = F.LUUTRU_ID and F.LUUTRUCHITIET_CURRENT = '1'        and F.LUUTRUCHITIET_ID in (select top 1 LUUTRUCHITIET_ID from TT_NOITRU_LUUTRUCHITIET where LUUTRU_ID = D.LUUTRU_ID order by LUUTRUCHITIET_ID desc)        where        A.KHOACHUYENDEN_ID is not null  and        (E.TRANGTHAI = 'DAXACNHAN' OR E.TRANGTHAI = 'HUYXACNHAN')         and           cast(A.NGAYVAOKHOA as date) <= cast('8/14/2019 12:00:00 AM' as date)                 and B.BENHVIEN_ID = 'HLU01' and A.KHOACHUYENDEN_ID = '25'          AND             A.TRANGTHAI in ('DANGDIEUTRI')]
2019-08-14 18:46:00,703 [1] DEBUG - Statement Id: [DAO00069_GetDanhSachNoiTru] PreparedStatement : [select * from        (        SELECT ROW_NUMBER() OVER(order by B.SOTIEPNHAN) as ROWNUMBER,          A.SOBENHAN, A.BENHAN_ID, A.SOLUUTRU                 , E.NOILAP_ID as KHOAVAO_ID        , A.TRANGTHAI, IsNull(A.BACSIDIEUTRI_ID, E.BACSICHIDINH_ID) as BACSIDIEUTRI_ID,        B.TIEPNHAN_ID, B.SOTIEPNHAN, B.SOBHYT as SOTHE, B.DOITUONG_ID, A.NGAYVAOKHOA as NGAYCAPCUU, A.THOIGIANVAOKHOA as THOIGIANCAPCUU,        C.TENBENHNHAN, C.NGAYSINH, C.NAMSINH, C.BENHNHAN_ID, C.MAYTE, F.GIUONGBENH_ID, A.THOIGIANRAVIEN    , DIACHITHUONGTRU, DANTOC_ID        ,BENHVIEN_STT_ID                from TT_NOITRU_BENHAN A        inner join TT_TIEPNHAN B on B.TIEPNHAN_ID = A.TIEPNHAN_ID and (B.TRANGTHAI = 'NOITRU' or B.TRANGTHAI = 'HOANTHANH')        inner join TT_BENHNHAN C on C.BENHNHAN_ID = B.BENHNHAN_ID        left join TT_NOITRU_LUUTRU D on D.BENHAN_ID = A.BENHAN_ID        and D.LUUTRU_ID = ( select top 1 LUUTRU_ID from TT_NOITRU_LUUTRU where BENHAN_ID = A.BENHAN_ID order by LUUTRU_ID desc)        left join TT_NOITRU_XACNHAN E on E.BENHAN_ID = A.BENHAN_ID        left join TT_NOITRU_LUUTRUCHITIET F on D.LUUTRU_ID = F.LUUTRU_ID and F.LUUTRUCHITIET_CURRENT = '1'        and F.LUUTRUCHITIET_ID in (select top 1 LUUTRUCHITIET_ID from TT_NOITRU_LUUTRUCHITIET where LUUTRU_ID = D.LUUTRU_ID order by LUUTRUCHITIET_ID desc)        left join (select MABENHVIEN, BENHVIEN_STT_ID from TM_BENHVIEN) H on SUBSTRING(B.SOBHYT, 16, 5)=H.MABENHVIEN        where        A.KHOACHUYENDEN_ID is not null  and        (E.TRANGTHAI = 'DAXACNHAN' OR E.TRANGTHAI = 'HUYXACNHAN')         and           cast(A.NGAYVAOKHOA as date) <= cast('8/14/2019 12:00:00 AM' as date)                 and B.BENHVIEN_ID = 'HLU01' and A.KHOACHUYENDEN_ID = '25'          AND             A.TRANGTHAI in ('DANGDIEUTRI')                   ) lst        where        lst.ROWNUMBER between 1 and 20        order by lst.SOTIEPNHAN]
2019-08-14 18:46:03,140 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'IPD42'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2019-08-14 18:46:03,331 [1] DEBUG - Statement Id: [DAO00069_GetCountDanhSachNoiTru] PreparedStatement : [select count(A.SOBENHAN) as TOTALROWS        from TT_NOITRU_BENHAN A        inner join TT_TIEPNHAN B on B.TIEPNHAN_ID = A.TIEPNHAN_ID and (B.TRANGTHAI = 'NOITRU' or B.TRANGTHAI = 'HOANTHANH')        inner join TT_BENHNHAN C on C.BENHNHAN_ID = B.BENHNHAN_ID        left join TT_NOITRU_LUUTRU D on D.BENHAN_ID = A.BENHAN_ID        and D.LUUTRU_ID = ( select top 1 LUUTRU_ID from TT_NOITRU_LUUTRU where BENHAN_ID = A.BENHAN_ID order by BENHAN_ID desc)        left join TT_NOITRU_XACNHAN E on E.BENHAN_ID = A.BENHAN_ID        left join TT_NOITRU_LUUTRUCHITIET F on D.LUUTRU_ID = F.LUUTRU_ID and F.LUUTRUCHITIET_CURRENT = '1'        and F.LUUTRUCHITIET_ID in (select top 1 LUUTRUCHITIET_ID from TT_NOITRU_LUUTRUCHITIET where LUUTRU_ID = D.LUUTRU_ID order by LUUTRUCHITIET_ID desc)        where        A.KHOACHUYENDEN_ID is not null  and        (E.TRANGTHAI = 'DAXACNHAN' OR E.TRANGTHAI = 'HUYXACNHAN')         and           cast(A.NGAYVAOKHOA as date) <= cast('8/14/2019 12:00:00 AM' as date)                 and B.BENHVIEN_ID = 'HLU01' and A.KHOACHUYENDEN_ID = '25'          AND             A.TRANGTHAI in ('DAXUATVIEN','DATHANHTOAN')]
2019-08-14 18:46:03,456 [1] DEBUG - Statement Id: [DAO00069_GetDanhSachNoiTru] PreparedStatement : [select * from        (        SELECT ROW_NUMBER() OVER(order by B.SOTIEPNHAN) as ROWNUMBER,          A.SOBENHAN, A.BENHAN_ID, A.SOLUUTRU                 , E.NOILAP_ID as KHOAVAO_ID        , A.TRANGTHAI, IsNull(A.BACSIDIEUTRI_ID, E.BACSICHIDINH_ID) as BACSIDIEUTRI_ID,        B.TIEPNHAN_ID, B.SOTIEPNHAN, B.SOBHYT as SOTHE, B.DOITUONG_ID, A.NGAYVAOKHOA as NGAYCAPCUU, A.THOIGIANVAOKHOA as THOIGIANCAPCUU,        C.TENBENHNHAN, C.NGAYSINH, C.NAMSINH, C.BENHNHAN_ID, C.MAYTE, F.GIUONGBENH_ID, A.THOIGIANRAVIEN    , DIACHITHUONGTRU, DANTOC_ID        ,BENHVIEN_STT_ID                from TT_NOITRU_BENHAN A        inner join TT_TIEPNHAN B on B.TIEPNHAN_ID = A.TIEPNHAN_ID and (B.TRANGTHAI = 'NOITRU' or B.TRANGTHAI = 'HOANTHANH')        inner join TT_BENHNHAN C on C.BENHNHAN_ID = B.BENHNHAN_ID        left join TT_NOITRU_LUUTRU D on D.BENHAN_ID = A.BENHAN_ID        and D.LUUTRU_ID = ( select top 1 LUUTRU_ID from TT_NOITRU_LUUTRU where BENHAN_ID = A.BENHAN_ID order by LUUTRU_ID desc)        left join TT_NOITRU_XACNHAN E on E.BENHAN_ID = A.BENHAN_ID        left join TT_NOITRU_LUUTRUCHITIET F on D.LUUTRU_ID = F.LUUTRU_ID and F.LUUTRUCHITIET_CURRENT = '1'        and F.LUUTRUCHITIET_ID in (select top 1 LUUTRUCHITIET_ID from TT_NOITRU_LUUTRUCHITIET where LUUTRU_ID = D.LUUTRU_ID order by LUUTRUCHITIET_ID desc)        left join (select MABENHVIEN, BENHVIEN_STT_ID from TM_BENHVIEN) H on SUBSTRING(B.SOBHYT, 16, 5)=H.MABENHVIEN        where        A.KHOACHUYENDEN_ID is not null  and        (E.TRANGTHAI = 'DAXACNHAN' OR E.TRANGTHAI = 'HUYXACNHAN')         and           cast(A.NGAYVAOKHOA as date) <= cast('8/14/2019 12:00:00 AM' as date)                 and B.BENHVIEN_ID = 'HLU01' and A.KHOACHUYENDEN_ID = '25'          AND             A.TRANGTHAI in ('DAXUATVIEN','DATHANHTOAN')                   ) lst        where        lst.ROWNUMBER between 1 and 20        order by lst.SOTIEPNHAN]
2019-08-14 18:46:05,122 [1] DEBUG - Statement Id: [DAO00069_GetCountDanhSachNoiTru] PreparedStatement : [select count(A.SOBENHAN) as TOTALROWS        from TT_NOITRU_BENHAN A        inner join TT_TIEPNHAN B on B.TIEPNHAN_ID = A.TIEPNHAN_ID and (B.TRANGTHAI = 'NOITRU' or B.TRANGTHAI = 'HOANTHANH')        inner join TT_BENHNHAN C on C.BENHNHAN_ID = B.BENHNHAN_ID        left join TT_NOITRU_LUUTRU D on D.BENHAN_ID = A.BENHAN_ID        and D.LUUTRU_ID = ( select top 1 LUUTRU_ID from TT_NOITRU_LUUTRU where BENHAN_ID = A.BENHAN_ID order by BENHAN_ID desc)        left join TT_NOITRU_XACNHAN E on E.BENHAN_ID = A.BENHAN_ID        left join TT_NOITRU_LUUTRUCHITIET F on D.LUUTRU_ID = F.LUUTRU_ID and F.LUUTRUCHITIET_CURRENT = '1'        and F.LUUTRUCHITIET_ID in (select top 1 LUUTRUCHITIET_ID from TT_NOITRU_LUUTRUCHITIET where LUUTRU_ID = D.LUUTRU_ID order by LUUTRUCHITIET_ID desc)        where        A.KHOACHUYENDEN_ID is not null  and        (E.TRANGTHAI = 'DAXACNHAN' OR E.TRANGTHAI = 'HUYXACNHAN')         and           cast(A.NGAYVAOKHOA as date) <= cast('8/14/2019 12:00:00 AM' as date)                 and B.BENHVIEN_ID = 'HLU01' and A.KHOACHUYENDEN_ID = '25'          AND             A.TRANGTHAI in ('DANGDIEUTRI')]
2019-08-14 18:46:05,223 [1] DEBUG - Statement Id: [DAO00069_GetDanhSachNoiTru] PreparedStatement : [select * from        (        SELECT ROW_NUMBER() OVER(order by B.SOTIEPNHAN) as ROWNUMBER,          A.SOBENHAN, A.BENHAN_ID, A.SOLUUTRU                 , E.NOILAP_ID as KHOAVAO_ID        , A.TRANGTHAI, IsNull(A.BACSIDIEUTRI_ID, E.BACSICHIDINH_ID) as BACSIDIEUTRI_ID,        B.TIEPNHAN_ID, B.SOTIEPNHAN, B.SOBHYT as SOTHE, B.DOITUONG_ID, A.NGAYVAOKHOA as NGAYCAPCUU, A.THOIGIANVAOKHOA as THOIGIANCAPCUU,        C.TENBENHNHAN, C.NGAYSINH, C.NAMSINH, C.BENHNHAN_ID, C.MAYTE, F.GIUONGBENH_ID, A.THOIGIANRAVIEN    , DIACHITHUONGTRU, DANTOC_ID        ,BENHVIEN_STT_ID                from TT_NOITRU_BENHAN A        inner join TT_TIEPNHAN B on B.TIEPNHAN_ID = A.TIEPNHAN_ID and (B.TRANGTHAI = 'NOITRU' or B.TRANGTHAI = 'HOANTHANH')        inner join TT_BENHNHAN C on C.BENHNHAN_ID = B.BENHNHAN_ID        left join TT_NOITRU_LUUTRU D on D.BENHAN_ID = A.BENHAN_ID        and D.LUUTRU_ID = ( select top 1 LUUTRU_ID from TT_NOITRU_LUUTRU where BENHAN_ID = A.BENHAN_ID order by LUUTRU_ID desc)        left join TT_NOITRU_XACNHAN E on E.BENHAN_ID = A.BENHAN_ID        left join TT_NOITRU_LUUTRUCHITIET F on D.LUUTRU_ID = F.LUUTRU_ID and F.LUUTRUCHITIET_CURRENT = '1'        and F.LUUTRUCHITIET_ID in (select top 1 LUUTRUCHITIET_ID from TT_NOITRU_LUUTRUCHITIET where LUUTRU_ID = D.LUUTRU_ID order by LUUTRUCHITIET_ID desc)        left join (select MABENHVIEN, BENHVIEN_STT_ID from TM_BENHVIEN) H on SUBSTRING(B.SOBHYT, 16, 5)=H.MABENHVIEN        where        A.KHOACHUYENDEN_ID is not null  and        (E.TRANGTHAI = 'DAXACNHAN' OR E.TRANGTHAI = 'HUYXACNHAN')         and           cast(A.NGAYVAOKHOA as date) <= cast('8/14/2019 12:00:00 AM' as date)                 and B.BENHVIEN_ID = 'HLU01' and A.KHOACHUYENDEN_ID = '25'          AND             A.TRANGTHAI in ('DANGDIEUTRI')                   ) lst        where        lst.ROWNUMBER between 1 and 20        order by lst.SOTIEPNHAN]
2019-08-14 18:46:32,074 [1] DEBUG - Statement Id: [DAO00013_GetTTBenhNhanByMaYTe] PreparedStatement : [select *              from TT_BENHNHAN              where MAYTE  = '190041240']
2019-08-14 18:46:38,558 [1] DEBUG - Statement Id: [DAO00014_GetTTinKhamBenhByBenhNhanID] PreparedStatement : [select *        from TT_NGOAITRU_KHAMBENH        where BENHNHAN_ID  =  @param0         and BENHVIEN_ID = 'HLU01'                    and NGAYKHAM >= '2/14/2019 12:00:00 AM'                  and NGAYKHAM <= '8/14/2019 12:00:00 AM'               order by THOIGIANKHAM desc]
2019-08-14 18:46:38,558 [1] DEBUG - Statement Id: [DAO00014_GetTTinKhamBenhByBenhNhanID] Parameters: [@param0=[BENHNHAN_ID,21353]]
2019-08-14 18:46:38,558 [1] DEBUG - Statement Id: [DAO00014_GetTTinKhamBenhByBenhNhanID] Types: [@param0=[Int64, System.Int64]]
--------------------------------------------------------------------------------
2019-08-14 18:52:45,394 [1] DEBUG - Statement Id: [DAO00001_DBList] PreparedStatement : [select *              from TM_SYS_SERVER              where HOSPITAL_ID = '_SYSTEM_' and TYPE = 'D']
2019-08-14 18:52:45,677 [1] DEBUG - Statement Id: [DAO00001_DaoList] PreparedStatement : [select              TM_SYS_SERVICEMAP.ID,              TM_SYS_SERVICEMAP.HOSPITAL_ID,              TM_SYS_SERVICEMAP.DB_NAME,              TM_SYS_SERVICEMAP.TYPE,              TM_SYS_SERVICEMAP.NAME,              TM_SYS_SERVICEMAP.CLASS,              (TM_SYS_DIC.VALUE + '.' + TM_SYS_SERVICEMAP.CLASS) as CLASSFULL,              TM_SYS_SERVICEMAP.ASSEMBLY              from TM_SYS_SERVICEMAP              inner join TM_SYS_DIC              on TM_SYS_SERVICEMAP.NAMESPACE = TM_SYS_DIC.ID              where HOSPITAL_ID = '_SYSTEM_' AND TYPE = 'D' AND ACTIVE = '1'              order by DB_NAME]
2019-08-14 18:52:45,727 [1] DEBUG - Statement Id: [DAO00001_ServiceList] PreparedStatement : [select              TM_SYS_SERVICEMAP.ID,              TM_SYS_SERVICEMAP.HOSPITAL_ID,              TM_SYS_SERVICEMAP.DB_NAME,              TM_SYS_SERVICEMAP.TYPE,              TM_SYS_SERVICEMAP.NAME,              TM_SYS_SERVICEMAP.CLASS,              (TM_SYS_DIC.VALUE + '.' + TM_SYS_SERVICEMAP.CLASS) as CLASSFULL,              TM_SYS_SERVICEMAP.ASSEMBLY,              TM_SYS_SERVER.URL              from TM_SYS_SERVICEMAP              inner join TM_SYS_DIC on TM_SYS_SERVICEMAP.NAMESPACE = TM_SYS_DIC.ID              inner join TM_SYS_SERVER on (TM_SYS_SERVICEMAP.DB_NAME = TM_SYS_SERVER.NAME) and (TM_SYS_SERVER.HOSPITAL_ID = '_SYSTEM_')              where TM_SYS_SERVICEMAP.HOSPITAL_ID = '_SYSTEM_' AND TM_SYS_SERVICEMAP.TYPE = 'S'  AND ACTIVE = '1'              order by URL]
2019-08-14 18:52:46,151 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = '_SYSTEM_'               AND                   TM_SYS_SCREEN.PAGE = 'LOGIN'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2019-08-14 18:52:46,447 [1] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = '_SYSTEM_'               AND                   TM_SYS_CACHE.ACTIVE = '1']
2019-08-14 18:53:16,060 [1] DEBUG - Statement Id: [DAO00001_DBList] PreparedStatement : [select *              from TM_SYS_SERVER              where HOSPITAL_ID = 'HLU01' and TYPE = 'D']
2019-08-14 18:53:16,488 [1] DEBUG - Statement Id: [DAO00001_DaoList] PreparedStatement : [select              TM_SYS_SERVICEMAP.ID,              TM_SYS_SERVICEMAP.HOSPITAL_ID,              TM_SYS_SERVICEMAP.DB_NAME,              TM_SYS_SERVICEMAP.TYPE,              TM_SYS_SERVICEMAP.NAME,              TM_SYS_SERVICEMAP.CLASS,              (TM_SYS_DIC.VALUE + '.' + TM_SYS_SERVICEMAP.CLASS) as CLASSFULL,              TM_SYS_SERVICEMAP.ASSEMBLY              from TM_SYS_SERVICEMAP              inner join TM_SYS_DIC              on TM_SYS_SERVICEMAP.NAMESPACE = TM_SYS_DIC.ID              where HOSPITAL_ID = 'HLU01' AND TYPE = 'D' AND ACTIVE = '1'              order by DB_NAME]
2019-08-14 18:53:18,227 [1] DEBUG - Statement Id: [DAO00001_ServiceList] PreparedStatement : [select              TM_SYS_SERVICEMAP.ID,              TM_SYS_SERVICEMAP.HOSPITAL_ID,              TM_SYS_SERVICEMAP.DB_NAME,              TM_SYS_SERVICEMAP.TYPE,              TM_SYS_SERVICEMAP.NAME,              TM_SYS_SERVICEMAP.CLASS,              (TM_SYS_DIC.VALUE + '.' + TM_SYS_SERVICEMAP.CLASS) as CLASSFULL,              TM_SYS_SERVICEMAP.ASSEMBLY,              TM_SYS_SERVER.URL              from TM_SYS_SERVICEMAP              inner join TM_SYS_DIC on TM_SYS_SERVICEMAP.NAMESPACE = TM_SYS_DIC.ID              inner join TM_SYS_SERVER on (TM_SYS_SERVICEMAP.DB_NAME = TM_SYS_SERVER.NAME) and (TM_SYS_SERVER.HOSPITAL_ID = 'HLU01')              where TM_SYS_SERVICEMAP.HOSPITAL_ID = 'HLU01' AND TM_SYS_SERVICEMAP.TYPE = 'S'  AND ACTIVE = '1'              order by URL]
2019-08-14 18:53:18,372 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1']
2019-08-14 18:53:19,240 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM005']
2019-08-14 18:53:19,419 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM015']
2019-08-14 18:53:19,520 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM067']
2019-08-14 18:53:19,597 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM008']
2019-08-14 18:53:19,678 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM068']
2019-08-14 18:53:19,783 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM006']
2019-08-14 18:53:19,859 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM030']
2019-08-14 18:53:19,942 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM025']
2019-08-14 18:53:20,015 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM024']
2019-08-14 18:53:20,531 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM033']
2019-08-14 18:53:20,566 [5] DEBUG - Statement Id: [DAO00027_GetListDuocKyGuiTonKho] PreparedStatement : [select  distinct TT_TONKHO.DUOC_KEY, LTRIM(TT_TONKHO.KHODUOC_ID) as KHODUOC_ID, TM_DUOC.DUOC_ID, TM_LOAIDUOC.MALOAIDUOC,TM_DUOC.SOVISA,TM_DUOC.TYLE_VAT,TM_DUOC.COTOA,        TM_DUOC.MADUOC, TM_DUOC.TENHANG, TM_DUOC.TENDUOCDAYDU, dvt.TENDONVITINH as DONVITINH,  TM_DUOC.DONVITINH_ID,TM_DUOC.BHYT,TM_DUOC.PHAMVI,        TM_DUOC.TENHOATCHAT, TM_DUOC.HAMLUONG, TM_DUOC.HANGSANXUAT, TM_DUOC.QUOCGIA, TM_DUOC.LOAIDUOC_ID, TM_DUOC.DUONGDUNG_ID,        TM_TENDUOC.TENDUOC, TM_TENDUOC.TENDUOC_EN, TM_TENDUOC.MAQUOCTE, TM_TENDUOC.MAQUOCTEBT,        TM_LOAIDUOC.LOAIVATTU_ID, TM_DUOC.BENHVIEN_ID,TT_TONKHO.SOLUONG, TT_TONKHO.NGUONDUOC_ID, NH.TENNGUONDUOC        , TAMNGUNG = CASE WHEN TM_DUOC.TAMNGUNG = '1' OR nh.TAMNGUNG = '1' OR KD.TAMNGUNG = '1' THEN '1' ELSE '0' END        , TM_DUOC.DANGTRINHBAY        from TM_DUOC        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = TM_DUOC.DONVITINH_ID        left join TM_TENDUOC on TM_DUOC.TENDUOC_ID = TM_TENDUOC.TENDUOC_ID and TM_DUOC.BENHVIEN_ID = 'HLU01' and TM_DUOC.TAMNGUNG = '0'        left join TM_LOAIDUOC on TM_LOAIDUOC.LOAIDUOC_ID = TM_DUOC.LOAIDUOC_ID and TM_LOAIDUOC.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG on (TM_LOAIDUOC.LOAIVATTU_ID = TM_DUOC_HANDUNG.LOAIDUOC and TM_DUOC_HANDUNG.BENHVIEN_ID = 'HLU01')        inner join        (select LTRIM(A.KHODUOC_ID) + '_' + LTRIM(A.DUOC_ID) + '_' + LTRIM(ISNULL(A.NGUONDUOC_ID,'')) as DUOC_KEY, A.KHODUOC_ID, A.DUOC_ID,A.NGUONDUOC_ID,        SUM(isnull(A.SOLUONG,0)) as SOLUONG        from        (select SUM(SOLUONG) as SOLUONG, KHODUOC_ID, DUOC_ID, NGUONDUOC_ID from TT_DUOC_KYGUI_TONKHO        where BENHVIEN_ID = 'HLU01' group by KHODUOC_ID, DUOC_ID, NGUONDUOC_ID) A        group by LTRIM(A.KHODUOC_ID) + '_' + LTRIM(A.DUOC_ID) + '_' + LTRIM(A.NGUONDUOC_ID), A.KHODUOC_ID, A.DUOC_ID, A.NGUONDUOC_ID)        TT_TONKHO on TT_TONKHO.DUOC_ID = TM_DUOC.DUOC_ID        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = TT_TONKHO.NGUONDUOC_ID and nh.BENHVIEN_ID = 'HLU01'        LEFT JOIN TM_KHODUOC KD ON KD.KHODUOC_ID = TT_TONKHO.KHODUOC_ID        where TM_DUOC.BENHVIEN_ID = 'HLU01' AND TT_TONKHO.SOLUONG >= 0]
2019-08-14 18:53:20,674 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM018']
2019-08-14 18:53:20,709 [5] DEBUG - Statement Id: [DAO00027_GetListDuocTonKho] PreparedStatement : [select distinct TT_TONKHO.DUOC_KEY, LTRIM(TT_TONKHO.KHODUOC_ID) as KHODUOC_ID, TM_DUOC.DUOC_ID, TM_LOAIDUOC.MALOAIDUOC,TM_DUOC.SOVISA,TM_DUOC.TYLE_VAT,TM_DUOC.COTOA,        TM_DUOC.MADUOC, TM_DUOC.TENHANG, TM_DUOC.TENDUOCDAYDU, dvt.TENDONVITINH as DONVITINH,  TM_DUOC.DONVITINH_ID,TM_DUOC.BHYT,                TM_DUOC.TENHOATCHAT,          TM_DUOC.HAMLUONG, TM_DUOC.HANGSANXUAT, TM_DUOC.QUOCGIA, TM_DUOC.LOAIDUOC_ID, TM_DUOC.DUONGDUNG_ID,        TM_TENDUOC.TENDUOC, TM_TENDUOC.TENDUOC_EN, TM_TENDUOC.MAQUOCTE, TM_TENDUOC.MAQUOCTEBT,        TM_LOAIDUOC.LOAIVATTU_ID, TM_DUOC.BENHVIEN_ID,        TT_TONKHO.SOLUONG, TM_DUOC.VTYT_PHANLOAI, TM_DUOC.PHAMVI, TT_TONKHO.NGUONDUOC_ID, NG.TENNGUONDUOC AS TENNGUONDUOC        , TAMNGUNG = CASE WHEN TM_DUOC.TAMNGUNG = '1' OR NG.TAMNGUNG = '1' OR KD.TAMNGUNG = '1' THEN '1' ELSE '0' END        , TM_DUOC.DANGTRINHBAY        from TM_DUOC        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = TM_DUOC.DONVITINH_ID        left join TM_TENDUOC on TM_DUOC.TENDUOC_ID = TM_TENDUOC.TENDUOC_ID and TM_DUOC.BENHVIEN_ID = 'HLU01' and TM_DUOC.TAMNGUNG = '0'        left join TM_LOAIDUOC on TM_LOAIDUOC.LOAIDUOC_ID = TM_DUOC.LOAIDUOC_ID and TM_LOAIDUOC.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG on (TM_LOAIDUOC.LOAIVATTU_ID = TM_DUOC_HANDUNG.LOAIDUOC and TM_DUOC_HANDUNG.BENHVIEN_ID = 'HLU01')        inner join        (select LTRIM(A.KHODUOC_ID) + '_' + LTRIM(A.DUOC_ID) + '_' + LTRIM(ISNULL(A.NGUONDUOC_ID,'')) as DUOC_KEY, A.KHODUOC_ID, A.DUOC_ID, A.NGUONDUOC_ID,        SUM(isnull(A.SOLUONG,0)) as SOLUONG        from        (select SUM(SOLUONG) as SOLUONG, KHODUOC_ID, DUOC_ID, NGUONDUOC_ID from TT_DUOC_TONKHO        where BENHVIEN_ID = 'HLU01' group by KHODUOC_ID, DUOC_ID, NGUONDUOC_ID) A        group by LTRIM(A.KHODUOC_ID) + '_' + LTRIM(A.DUOC_ID) + '_' + LTRIM(ISNULL(A.NGUONDUOC_ID,'')), A.KHODUOC_ID, A.DUOC_ID, NGUONDUOC_ID        ) TT_TONKHO on TT_TONKHO.DUOC_ID = TM_DUOC.DUOC_ID        LEFT JOIN TM_NGUONHANG NG ON NG.NGUONDUOC_ID = TT_TONKHO.NGUONDUOC_ID        LEFT JOIN TM_KHODUOC KD ON KD.KHODUOC_ID = TT_TONKHO.KHODUOC_ID        where TM_DUOC.BENHVIEN_ID = 'HLU01' and TT_TONKHO.SOLUONG >= 0]
2019-08-14 18:53:21,651 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM023']
2019-08-14 18:53:21,685 [5] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoVaBooking] PreparedStatement : [declare @TOAMUANGOAI int = 0;        select @TOAMUANGOAI = isnull(VALUE,0) from TM_SYS_APPSETTINGS where CODE = 'OPD_TOAMUANGOAI_DUNGDANHMUC_DUOC'                if @TOAMUANGOAI = 1        begin        select  distinct '0' + '_' + LTRIM(d.DUOC_ID) + '_' + '0' as DUOC_KEY, 0 as PHAMVI_ID, 0 as NGUONDUOC_ID, null as TENNGUONDUOC, null as TINHTIEN, d.DUOC_ID, ld.MALOAIDUOC,        d.SOVISA,d.TYLE_VAT,d.COTOA, d.MADUOC, d.TENHANG, d.TENDUOCDAYDU, d.DONVITINH as DONVITINH, d.BHYT,        d.TENHOATCHAT, d.HAMLUONG, d.HANGSANXUAT, d.QUOCGIA, d.LOAIDUOC_ID, d.DUONGDUNG_ID, d.TINHTIEN_PTTT,        ten.TENDUOC, ten.TENDUOC_EN, ten.MAQUOCTE, ten.MAQUOCTEBT,        '' as BHYT_TEXT        , ld.LOAIVATTU_ID        , d.BENHVIEN_ID,        999999999 as SOLUONG, d.VTYT_PHANLOAI, d.PHAMVI, d.SUASOLUONGTONGHOP, d.MADUOCBV, d.DANGTRINHBAY        , TAMNGUNG = CASE WHEN d.TAMNGUNG = '1' THEN '1' ELSE '0' END        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        union all        select  distinct tk.DUOC_KEY, LTRIM(tk.PHAMVI_ID) as PHAMVI_ID, tk.NGUONDUOC_ID, nh.TENNGUONDUOC, nh.TINHTIEN, d.DUOC_ID, ld.MALOAIDUOC,        d.SOVISA,d.TYLE_VAT,d.COTOA, d.MADUOC, d.TENHANG, d.TENDUOCDAYDU, dvt.TENDONVITINH as DONVITINH, d.BHYT,        d.TENHOATCHAT, d.HAMLUONG, d.HANGSANXUAT, d.QUOCGIA, d.LOAIDUOC_ID, d.DUONGDUNG_ID, d.TINHTIEN_PTTT,        ten.TENDUOC, ten.TENDUOC_EN, ten.MAQUOCTE, ten.MAQUOCTEBT,        CASE WHEN d.BHYT = '1' THEN 'BHYT' ELSE '' END as BHYT_TEXT        , ld.LOAIVATTU_ID        , d.BENHVIEN_ID,        tk.SOLUONG, d.VTYT_PHANLOAI, d.PHAMVI, d.SUASOLUONGTONGHOP, d.MADUOCBV, d.DANGTRINHBAY        , TAMNGUNG = CASE WHEN d.TAMNGUNG = '1' OR nh.TAMNGUNG = '1' OR kd.TAMNGUNG = '1' THEN '1' ELSE '0' END        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        inner join        (        select  LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')) DUOC_KEY, (SUM(dtk.SOLUONG) - isnull(sum(A.SOLUONG),0) - isnull(sum(B.SOLUONG),0)) SOLUONG, pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        from (select sum(soluong) soluong,duoc_id,nguonduoc_id,khoduoc_id,benhvien_id from TT_DUOC_TONKHO  group by duoc_id,nguonduoc_id,khoduoc_id,benhvien_id) dtk        inner join TM_DUOC_PHAMVISD_MAPPING pvsd on dtk.KHODUOC_ID = pvsd.KHODUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NOITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) B on B.DUOC_ID = dtk.DUOC_ID and B.SOLUONG > 0 and B.PHAMVI_ID = pvsd.PHAMVI_ID and B.NGUONHANG_ID = dtk.NGUONDUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NGOAITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) A on A.DUOC_ID = dtk.DUOC_ID and A.SOLUONG > 0 and A.PHAMVI_ID = pvsd.PHAMVI_ID and A.NGUONHANG_ID = dtk.NGUONDUOC_ID        where dtk.SOLUONG > 0 and dtk.BENHVIEN_ID = 'HLU01'        group by LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')), pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        ) tk on tk.DUOC_ID = d.DUOC_ID        left join TM_DUOC_PHAMVISUDUNG kd on kd.PHAMVI_ID = tk.PHAMVI_ID and kd.BENHVIEN_ID = 'HLU01'        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = tk.NGUONDUOC_ID and nh.BENHVIEN_ID = 'HLU01'        where d.BENHVIEN_ID = 'HLU01'  and tk.SOLUONG >= 0         end                else        begin        select  distinct tk.DUOC_KEY, LTRIM(tk.PHAMVI_ID) as PHAMVI_ID, tk.NGUONDUOC_ID, nh.TENNGUONDUOC, nh.TINHTIEN, d.DUOC_ID, ld.MALOAIDUOC,        d.SOVISA,d.TYLE_VAT,d.COTOA, d.MADUOC, d.TENHANG, d.TENDUOCDAYDU, d.DONVITINH as DONVITINH, d.BHYT,        d.TENHOATCHAT, d.HAMLUONG, d.HANGSANXUAT, d.QUOCGIA, d.LOAIDUOC_ID, d.DUONGDUNG_ID, d.TINHTIEN_PTTT,        ten.TENDUOC, ten.TENDUOC_EN, ten.MAQUOCTE, ten.MAQUOCTEBT,        CASE WHEN d.BHYT = '1' THEN 'BHYT' ELSE '' END as BHYT_TEXT        , ld.LOAIVATTU_ID        , d.BENHVIEN_ID,        tk.SOLUONG, d.VTYT_PHANLOAI, d.PHAMVI, d.SUASOLUONGTONGHOP, d.MADUOCBV, d.DANGTRINHBAY        , TAMNGUNG = CASE WHEN d.TAMNGUNG = '1' OR nh.TAMNGUNG = '1' OR kd.TAMNGUNG = '1' THEN '1' ELSE '0' END        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        inner join        (        select  LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')) DUOC_KEY, (SUM(dtk.SOLUONG) - isnull(sum(A.SOLUONG),0) - isnull(sum(B.SOLUONG),0)) SOLUONG, pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        from (select sum(soluong) soluong,duoc_id,nguonduoc_id,khoduoc_id,benhvien_id from TT_DUOC_TONKHO  group by duoc_id,nguonduoc_id,khoduoc_id,benhvien_id) dtk        inner join TM_DUOC_PHAMVISD_MAPPING pvsd on dtk.KHODUOC_ID = pvsd.KHODUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NOITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) B on B.DUOC_ID = dtk.DUOC_ID and B.SOLUONG > 0 and B.PHAMVI_ID = pvsd.PHAMVI_ID and B.NGUONHANG_ID = dtk.NGUONDUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NGOAITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) A on A.DUOC_ID = dtk.DUOC_ID and A.SOLUONG > 0 and A.PHAMVI_ID = pvsd.PHAMVI_ID and A.NGUONHANG_ID = dtk.NGUONDUOC_ID        where dtk.SOLUONG > 0 and dtk.BENHVIEN_ID = 'HLU01'        group by LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')), pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        ) tk on tk.DUOC_ID = d.DUOC_ID        left join TM_DUOC_PHAMVISUDUNG kd on kd.PHAMVI_ID = tk.PHAMVI_ID and kd.BENHVIEN_ID = 'HLU01'        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = tk.NGUONDUOC_ID and nh.BENHVIEN_ID = 'HLU01'        where d.BENHVIEN_ID = 'HLU01'  and tk.SOLUONG >= 0        end]
2019-08-14 18:53:23,640 [5] DEBUG - Statement Id: [DAO00320_GetList] PreparedStatement : [select M.*            from TM_MAU M            LEFT JOIN TM_MAU_DONVITINH DVT on M.DONVITINH_ID=DVT.DONVITINH_ID            where            M.TAMNGUNG = '0'            and M.BENHVIEN_ID = 'HLU01'            order by M.TENMAU]
2019-08-14 18:53:23,922 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM071']
2019-08-14 18:53:23,967 [5] DEBUG - Statement Id: [DAO00322_GetListMauTonKhoForCreateCached] PreparedStatement : [SELECT DISTINCT          TK.MAU_KEY, TK.KHOMAU_ID, M.MAU_ID, M.MAMAU, M.TENMAU, M.NHOM_ABO, M.NHOM_RH, M.LOAIMAU_ID,          TK.SOLONHAP_ID, SLN.SOLONHAP, SLN.SOKIEMSOAT, TK.NGUONHANG_ID, NG.TENNGUONMAU, M.BENHVIEN_ID, M.DONVITINH_ID,          SUM(tk.SOLUONG) AS SOLUONG,K.TENKHO,DVT.TENDONVITINH          FROM TT_MAU_TONKHO TK          JOIN TM_KHO K ON TK.KHOMAU_ID = K.KHO_ID          JOIN TT_MAU_CHUNGTU_SOLONHAP SLN ON TK.SOLONHAP_ID = SLN.SOLONHAP_ID          JOIN TM_MAU M on TK.MAU_ID = M.MAU_ID and M.TAMNGUNG = '0'          LEFT JOIN TM_MAU_DONVITINH DVT on M.DONVITINH_ID=DVT.DONVITINH_ID          LEFT JOIN TM_NGUONMAU NG ON NG.NGUONMAU_ID = TK.NGUONHANG_ID          WHERE TK.SOLUONG > 0          GROUP BY TK.MAU_KEY, TK.KHOMAU_ID, M.MAU_ID, M.MAMAU, M.TENMAU, M.NHOM_ABO, M.NHOM_RH, M.LOAIMAU_ID,          TK.SOLONHAP_ID, SLN.SOLONHAP, SLN.SOKIEMSOAT,TK.NGUONHANG_ID, NG.TENNGUONMAU, M.BENHVIEN_ID, M.DONVITINH_ID,K.TENKHO,DVT.TENDONVITINH]
2019-08-14 18:53:24,040 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM073']
2019-08-14 18:53:24,080 [5] DEBUG - Statement Id: [DAO00322_GetListMauTonKhoTruBooking] PreparedStatement : [select distinct          TK.MAU_KEY, TK.KHOMAU_ID, M.MAU_ID, M.MAMAU, M.TENMAU, M.NHOM_ABO, M.NHOM_RH, M.LOAIMAU_ID, M.DONVITINH_ID,          TK.SOLONHAP_ID, TK.SOLONHAP, TK.SOKIEMSOAT,M.PHAMVI, TK.NGUONHANG_ID, NG.TENNGUONMAU, M.BENHVIEN_ID,          TK.SOLUONG,TK.TENKHO,DVT.TENDONVITINH          from TM_MAU M          JOIN          (          select          A.MAU_KEY, A.KHOMAU_ID, A.MAU_ID ,a.NGUONHANG_ID, A.SOLONHAP_ID, A.SOLONHAP, A.SOKIEMSOAT, A.SOLUONG,A.TENKHO          from          (          select KHOMAU_ID, TK.MAU_ID, TK.NGUONHANG_ID, TK.MAU_KEY, SLN.SOLONHAP_ID, SLN.SOLONHAP, SLN.SOKIEMSOAT, ISNULL(TK.SOLUONG,0) - ISNULL(book.SOLUONG,0) as SOLUONG,K.TENKHO          from TT_MAU_TONKHO TK          JOIN TM_KHO K ON TK.KHOMAU_ID = K.KHO_ID          inner join TT_MAU_CHUNGTU_SOLONHAP SLN ON TK.SOLONHAP_ID = SLN.SOLONHAP_ID          left join dbo.TT_MAU_TONKHO_BOOK book ON book.MAU_KEY = TK.MAU_KEY AND book.TRANGTHAI = 'HIEULUC'          where ISNULL(TK.SOLUONG,0) - ISNULL(book.SOLUONG,0) > 0          ) A          )TK on TK.MAU_ID = M.MAU_ID and M.TAMNGUNG = '0'          LEFT JOIN TM_MAU_DONVITINH DVT on M.DONVITINH_ID=DVT.DONVITINH_ID          LEFT JOIN TM_NGUONMAU NG ON NG.NGUONMAU_ID = TK.NGUONHANG_ID]
2019-08-14 18:53:24,158 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM072']
2019-08-14 18:53:25,091 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'MAIN'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2019-08-14 18:53:26,069 [1] DEBUG - Statement Id: [DAO00002_FormList] PreparedStatement : [select              TM_SYS_FORM.HOSPITAL_ID,              TM_SYS_FORM.NAME,              TM_SYS_FORM.CLASS,              TM_SYS_FORM.ASSEMBLY,              TM_SYS_FORM.TITLE_VI as TITLE              from TM_SYS_FORM              where HOSPITAL_ID = 'HLU01']
2019-08-14 18:53:30,899 [1] DEBUG - Statement Id: [DAO00300_GetShortcutListByUserID] PreparedStatement : [SELECT S.SHORTCUT_CODE, S.SHORTCUT_VALUE              FROM TM_SHORTCUT AS S              WHERE S.BENHVIEN_ID = 'HLU01' AND S.USER_ID = '1' AND TAMNGUNG = '0']
2019-08-14 18:53:30,930 [1] DEBUG - Statement Id: [DAO00087_GetList] PreparedStatement : [select CODE, VALUE, BENHVIEN_ID              from TM_SYS_APPSETTINGS              where LOCKED = '0' and BENHVIEN_ID = 'HLU01'              order by SETTING_ID]
2019-08-14 18:53:31,007 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'MSG01'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2019-08-14 18:53:31,415 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'MSG02'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2019-08-14 18:53:32,024 [1] DEBUG - Statement Id: [DAO00008_GetUserSettings] PreparedStatement : [select A.*, B.TENKHO , C.TENPHONGBAN, B.MAKHO, C.MAPHONGBAN          from TM_SYS_USERS A          left join TM_KHODUOC B on B.KHODUOC_ID = A.INVENTORY_ID          left join TM_PHONGBAN C on (C.PHONGBAN_ID = A.WORKING_DEPT_ID and C.BENHVIEN_ID =  @param0 )          left join TM_SYS_USERKHO D on (D.ACCOUNT_ID = A.ACCOUNT_ID and D.HOSPITAL_ID =  @param0 )          where          A.HOSPITAL_ID =  @param0            and                 A.ACCOUNT_ID =  @param1]
2019-08-14 18:53:32,026 [1] DEBUG - Statement Id: [DAO00008_GetUserSettings] Parameters: [@param0=[HOSPITAL_ID,HLU01], @param1=[ACCOUNT_ID,113]]
2019-08-14 18:53:32,026 [1] DEBUG - Statement Id: [DAO00008_GetUserSettings] Types: [@param0=[String, System.String], @param1=[String, System.String]]
2019-08-14 18:53:32,056 [1] DEBUG - Statement Id: [DAO00008_GetUserInvSettings] PreparedStatement : [select A.*, B.TENKHO, B.MAKHO, B.LOAIKHO_ID, B.KHOQUANLY_ID          from TM_SYS_USERKHO A          left join TM_KHO B on B.MODULE_ID = A.MODULE_ID and B.KHO_ID = A.KHO_ID          where A.HOSPITAL_ID =  @param0  and A.ACCOUNT_ID =  @param1           order by B.TENKHO]
2019-08-14 18:53:32,056 [1] DEBUG - Statement Id: [DAO00008_GetUserInvSettings] Parameters: [@param0=[HOSPITAL_ID,HLU01], @param1=[ACCOUNT_ID,113]]
2019-08-14 18:53:32,056 [1] DEBUG - Statement Id: [DAO00008_GetUserInvSettings] Types: [@param0=[String, System.String], @param1=[String, System.String]]
2019-08-14 18:53:32,200 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'COM30'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2019-08-14 18:53:32,700 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'RIS04'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2019-08-14 18:53:40,994 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'MENU1'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2019-08-14 18:53:41,089 [1] DEBUG - Statement Id: [DAO00011_GetList] PreparedStatement : [select              TM_SYS_MENU.ID,              TM_SYS_MENU.PARENTID,              TM_SYS_MENU.SCREEN,              TM_SYS_MENU.SMALLIMAGE,              TM_SYS_MENU.LARGEIMAGE,              TM_SYS_MENU.DESCRIPTION,              TM_SYS_MENU.TYPE,              TM_SYS_MENU.TITLE_VI as TITLE              from TM_SYS_MENU              where TM_SYS_MENU.HOSPITAL_ID = 'HLU01' and TM_SYS_MENU.ACTIVE = '1'               AND                   (TM_SYS_MENU.TYPE & '8' = '8')                             order by TM_SYS_MENU.ORDERNUM]
2019-08-14 18:53:41,428 [1] DEBUG - Statement Id: [DAO00011_usermenu_list] PreparedStatement : [select              TM_SYS_HOMEMENU.MENUID as ID,              TM_SYS_MENU.TITLE_VI as TITLE,              TM_SYS_MENU.SCREEN,              TM_SYS_MENU.SMALLIMAGE,              TM_SYS_MENU.LARGEIMAGE,              TM_SYS_MENU.TYPE              from TM_SYS_HOMEMENU              left join TM_SYS_MENU on TM_SYS_MENU.ID = TM_SYS_HOMEMENU.MENUID and TM_SYS_MENU.HOSPITAL_ID = TM_SYS_HOMEMENU.HOSPITAL_ID              where TM_SYS_HOMEMENU.HOSPITAL_ID = 'HLU01' and TM_SYS_HOMEMENU.USERID = '113' and TM_SYS_MENU.ACTIVE = '1'               AND                   (TM_SYS_MENU.TYPE & '8' = '8')                             ORDER BY TM_SYS_HOMEMENU.ORDERNUM]
2019-08-14 18:53:49,894 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'EMR04'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2019-08-14 18:53:50,110 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'EMR05'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2019-08-14 18:53:53,530 [1] DEBUG - Statement Id: [DAO00013_GetTTBenhNhanByMaYTe] PreparedStatement : [select *              from TT_BENHNHAN              where MAYTE  = '']
2019-08-14 18:53:53,881 [1] DEBUG - Statement Id: [DAO00014_GetTTinKhamBenhByBenhNhanID] PreparedStatement : [select KB.*, TN.SOBHYT, DT.TENDOITUONG        from TT_NGOAITRU_KHAMBENH KB        inner join TT_TIEPNHAN TN ON TN.TIEPNHAN_ID = KB.KHAMBENH_ID        left join TM_DOITUONG DT ON DT.DOITUONG_ID = TN.DOITUONG_ID        where KB.BENHNHAN_ID  =  @param0         and KB.BENHVIEN_ID = 'HLU01'                    and KB.NGAYKHAM >= '2/14/2019 12:00:00 AM'                  and KB.NGAYKHAM <= '8/14/2019 12:00:00 AM'               order by KB.THOIGIANKHAM desc]
2019-08-14 18:53:53,881 [1] DEBUG - Statement Id: [DAO00014_GetTTinKhamBenhByBenhNhanID] Parameters: [@param0=[BENHNHAN_ID,null]]
2019-08-14 18:53:53,881 [1] DEBUG - Statement Id: [DAO00014_GetTTinKhamBenhByBenhNhanID] Types: [@param0=[System.DBNull, null]]
2019-08-14 18:53:56,103 [1] DEBUG - Statement Id: [DAO00013_GetTTBenhNhanByMaYTe] PreparedStatement : [select *              from TT_BENHNHAN              where MAYTE  = '']
2019-08-14 18:53:56,156 [1] DEBUG - Statement Id: [DAO00014_GetTTinKhamBenhByBenhNhanID] PreparedStatement : [select KB.*, TN.SOBHYT, DT.TENDOITUONG        from TT_NGOAITRU_KHAMBENH KB        inner join TT_TIEPNHAN TN ON TN.TIEPNHAN_ID = KB.KHAMBENH_ID        left join TM_DOITUONG DT ON DT.DOITUONG_ID = TN.DOITUONG_ID        where KB.BENHNHAN_ID  =  @param0         and KB.BENHVIEN_ID = 'HLU01'                    and KB.NGAYKHAM >= '2/14/2019 12:00:00 AM'                  and KB.NGAYKHAM <= '8/14/2019 12:00:00 AM'               order by KB.THOIGIANKHAM desc]
2019-08-14 18:53:56,156 [1] DEBUG - Statement Id: [DAO00014_GetTTinKhamBenhByBenhNhanID] Parameters: [@param0=[BENHNHAN_ID,null]]
2019-08-14 18:53:56,156 [1] DEBUG - Statement Id: [DAO00014_GetTTinKhamBenhByBenhNhanID] Types: [@param0=[System.DBNull, null]]
2019-08-14 18:53:59,608 [1] DEBUG - Statement Id: [DAO00013_GetTTBenhNhanByMaYTe] PreparedStatement : [select *              from TT_BENHNHAN              where MAYTE  = '']
2019-08-14 18:53:59,678 [1] DEBUG - Statement Id: [DAO00014_GetTTinKhamBenhByBenhNhanID] PreparedStatement : [select KB.*, TN.SOBHYT, DT.TENDOITUONG        from TT_NGOAITRU_KHAMBENH KB        inner join TT_TIEPNHAN TN ON TN.TIEPNHAN_ID = KB.KHAMBENH_ID        left join TM_DOITUONG DT ON DT.DOITUONG_ID = TN.DOITUONG_ID        where KB.BENHNHAN_ID  =  @param0         and KB.BENHVIEN_ID = 'HLU01'                    and KB.NGAYKHAM >= '2/14/2019 12:00:00 AM'                  and KB.NGAYKHAM <= '8/14/2019 12:00:00 AM'               order by KB.THOIGIANKHAM desc]
2019-08-14 18:53:59,678 [1] DEBUG - Statement Id: [DAO00014_GetTTinKhamBenhByBenhNhanID] Parameters: [@param0=[BENHNHAN_ID,null]]
2019-08-14 18:53:59,678 [1] DEBUG - Statement Id: [DAO00014_GetTTinKhamBenhByBenhNhanID] Types: [@param0=[System.DBNull, null]]
2019-08-14 18:54:13,609 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'IPD02'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2019-08-14 18:54:13,970 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'IPD40'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2019-08-14 18:54:14,140 [1] DEBUG - Statement Id: [DAO00069_GetCountDanhSachNoiTru] PreparedStatement : [select count(A.SOBENHAN) as TOTALROWS        from TT_NOITRU_BENHAN A        inner join TT_TIEPNHAN B on B.TIEPNHAN_ID = A.TIEPNHAN_ID and (B.TRANGTHAI = 'NOITRU' or B.TRANGTHAI = 'HOANTHANH')        inner join TT_BENHNHAN C on C.BENHNHAN_ID = B.BENHNHAN_ID        left join TT_NOITRU_LUUTRU D on D.BENHAN_ID = A.BENHAN_ID        and D.LUUTRU_ID = ( select top 1 LUUTRU_ID from TT_NOITRU_LUUTRU where BENHAN_ID = A.BENHAN_ID order by BENHAN_ID desc)        left join TT_NOITRU_XACNHAN E on E.BENHAN_ID = A.BENHAN_ID        left join TT_NOITRU_LUUTRUCHITIET F on D.LUUTRU_ID = F.LUUTRU_ID and F.LUUTRUCHITIET_CURRENT = '1'        and F.LUUTRUCHITIET_ID in (select top 1 LUUTRUCHITIET_ID from TT_NOITRU_LUUTRUCHITIET where LUUTRU_ID = D.LUUTRU_ID order by LUUTRUCHITIET_ID desc)        where        A.KHOACHUYENDEN_ID is not null  and        (E.TRANGTHAI = 'DAXACNHAN' OR E.TRANGTHAI = 'HUYXACNHAN')         and           cast(A.NGAYVAOKHOA as date) <= cast('8/14/2019 12:00:00 AM' as date)                 and B.BENHVIEN_ID = 'HLU01' and A.KHOACHUYENDEN_ID = '25'          AND             A.TRANGTHAI in ('DANGDIEUTRI')]
2019-08-14 18:54:14,255 [1] DEBUG - Statement Id: [DAO00069_GetDanhSachNoiTru] PreparedStatement : [select * from        (        SELECT ROW_NUMBER() OVER(order by B.SOTIEPNHAN) as ROWNUMBER,          A.SOBENHAN, A.BENHAN_ID, A.SOLUUTRU                 , E.NOILAP_ID as KHOAVAO_ID        , A.TRANGTHAI, IsNull(A.BACSIDIEUTRI_ID, E.BACSICHIDINH_ID) as BACSIDIEUTRI_ID,        B.TIEPNHAN_ID, B.SOTIEPNHAN, B.SOBHYT as SOTHE, B.DOITUONG_ID, A.NGAYVAOKHOA as NGAYCAPCUU, A.THOIGIANVAOKHOA as THOIGIANCAPCUU,        C.TENBENHNHAN, C.NGAYSINH, C.NAMSINH, C.BENHNHAN_ID, C.MAYTE, F.GIUONGBENH_ID, A.THOIGIANRAVIEN    , DIACHITHUONGTRU, DANTOC_ID        ,BENHVIEN_STT_ID                from TT_NOITRU_BENHAN A        inner join TT_TIEPNHAN B on B.TIEPNHAN_ID = A.TIEPNHAN_ID and (B.TRANGTHAI = 'NOITRU' or B.TRANGTHAI = 'HOANTHANH')        inner join TT_BENHNHAN C on C.BENHNHAN_ID = B.BENHNHAN_ID        left join TT_NOITRU_LUUTRU D on D.BENHAN_ID = A.BENHAN_ID        and D.LUUTRU_ID = ( select top 1 LUUTRU_ID from TT_NOITRU_LUUTRU where BENHAN_ID = A.BENHAN_ID order by LUUTRU_ID desc)        left join TT_NOITRU_XACNHAN E on E.BENHAN_ID = A.BENHAN_ID        left join TT_NOITRU_LUUTRUCHITIET F on D.LUUTRU_ID = F.LUUTRU_ID and F.LUUTRUCHITIET_CURRENT = '1'        and F.LUUTRUCHITIET_ID in (select top 1 LUUTRUCHITIET_ID from TT_NOITRU_LUUTRUCHITIET where LUUTRU_ID = D.LUUTRU_ID order by LUUTRUCHITIET_ID desc)        left join (select MABENHVIEN, BENHVIEN_STT_ID from TM_BENHVIEN) H on SUBSTRING(B.SOBHYT, 16, 5)=H.MABENHVIEN        where        A.KHOACHUYENDEN_ID is not null  and        (E.TRANGTHAI = 'DAXACNHAN' OR E.TRANGTHAI = 'HUYXACNHAN')         and           cast(A.NGAYVAOKHOA as date) <= cast('8/14/2019 12:00:00 AM' as date)                 and B.BENHVIEN_ID = 'HLU01' and A.KHOACHUYENDEN_ID = '25'          AND             A.TRANGTHAI in ('DANGDIEUTRI')                   ) lst        where        lst.ROWNUMBER between 1 and 20        order by lst.SOTIEPNHAN]
2019-08-14 18:54:14,981 [1] DEBUG - Statement Id: [DAO00069_GetCountDanhSachNoiTru] PreparedStatement : [select count(A.SOBENHAN) as TOTALROWS        from TT_NOITRU_BENHAN A        inner join TT_TIEPNHAN B on B.TIEPNHAN_ID = A.TIEPNHAN_ID and (B.TRANGTHAI = 'NOITRU' or B.TRANGTHAI = 'HOANTHANH')        inner join TT_BENHNHAN C on C.BENHNHAN_ID = B.BENHNHAN_ID        left join TT_NOITRU_LUUTRU D on D.BENHAN_ID = A.BENHAN_ID        and D.LUUTRU_ID = ( select top 1 LUUTRU_ID from TT_NOITRU_LUUTRU where BENHAN_ID = A.BENHAN_ID order by BENHAN_ID desc)        left join TT_NOITRU_XACNHAN E on E.BENHAN_ID = A.BENHAN_ID        left join TT_NOITRU_LUUTRUCHITIET F on D.LUUTRU_ID = F.LUUTRU_ID and F.LUUTRUCHITIET_CURRENT = '1'        and F.LUUTRUCHITIET_ID in (select top 1 LUUTRUCHITIET_ID from TT_NOITRU_LUUTRUCHITIET where LUUTRU_ID = D.LUUTRU_ID order by LUUTRUCHITIET_ID desc)        where        A.KHOACHUYENDEN_ID is not null  and        (E.TRANGTHAI = 'DAXACNHAN' OR E.TRANGTHAI = 'HUYXACNHAN')         and           cast(A.NGAYVAOKHOA as date) <= cast('8/14/2019 12:00:00 AM' as date)                 and B.BENHVIEN_ID = 'HLU01' and A.KHOACHUYENDEN_ID = '25'          AND             A.TRANGTHAI in ('DANGDIEUTRI')]
2019-08-14 18:54:15,102 [1] DEBUG - Statement Id: [DAO00069_GetDanhSachNoiTru] PreparedStatement : [select * from        (        SELECT ROW_NUMBER() OVER(order by B.SOTIEPNHAN) as ROWNUMBER,          A.SOBENHAN, A.BENHAN_ID, A.SOLUUTRU                 , E.NOILAP_ID as KHOAVAO_ID        , A.TRANGTHAI, IsNull(A.BACSIDIEUTRI_ID, E.BACSICHIDINH_ID) as BACSIDIEUTRI_ID,        B.TIEPNHAN_ID, B.SOTIEPNHAN, B.SOBHYT as SOTHE, B.DOITUONG_ID, A.NGAYVAOKHOA as NGAYCAPCUU, A.THOIGIANVAOKHOA as THOIGIANCAPCUU,        C.TENBENHNHAN, C.NGAYSINH, C.NAMSINH, C.BENHNHAN_ID, C.MAYTE, F.GIUONGBENH_ID, A.THOIGIANRAVIEN    , DIACHITHUONGTRU, DANTOC_ID        ,BENHVIEN_STT_ID                from TT_NOITRU_BENHAN A        inner join TT_TIEPNHAN B on B.TIEPNHAN_ID = A.TIEPNHAN_ID and (B.TRANGTHAI = 'NOITRU' or B.TRANGTHAI = 'HOANTHANH')        inner join TT_BENHNHAN C on C.BENHNHAN_ID = B.BENHNHAN_ID        left join TT_NOITRU_LUUTRU D on D.BENHAN_ID = A.BENHAN_ID        and D.LUUTRU_ID = ( select top 1 LUUTRU_ID from TT_NOITRU_LUUTRU where BENHAN_ID = A.BENHAN_ID order by LUUTRU_ID desc)        left join TT_NOITRU_XACNHAN E on E.BENHAN_ID = A.BENHAN_ID        left join TT_NOITRU_LUUTRUCHITIET F on D.LUUTRU_ID = F.LUUTRU_ID and F.LUUTRUCHITIET_CURRENT = '1'        and F.LUUTRUCHITIET_ID in (select top 1 LUUTRUCHITIET_ID from TT_NOITRU_LUUTRUCHITIET where LUUTRU_ID = D.LUUTRU_ID order by LUUTRUCHITIET_ID desc)        left join (select MABENHVIEN, BENHVIEN_STT_ID from TM_BENHVIEN) H on SUBSTRING(B.SOBHYT, 16, 5)=H.MABENHVIEN        where        A.KHOACHUYENDEN_ID is not null  and        (E.TRANGTHAI = 'DAXACNHAN' OR E.TRANGTHAI = 'HUYXACNHAN')         and           cast(A.NGAYVAOKHOA as date) <= cast('8/14/2019 12:00:00 AM' as date)                 and B.BENHVIEN_ID = 'HLU01' and A.KHOACHUYENDEN_ID = '25'          AND             A.TRANGTHAI in ('DANGDIEUTRI')                   ) lst        where        lst.ROWNUMBER between 1 and 20        order by lst.SOTIEPNHAN]
2019-08-14 18:54:35,999 [1] DEBUG - Statement Id: [DAO00013_GetTTBenhNhanByMaYTe] PreparedStatement : [select *              from TT_BENHNHAN              where MAYTE  = '190041240']
2019-08-14 18:54:36,055 [1] DEBUG - Statement Id: [DAO00014_GetTTinKhamBenhByBenhNhanID] PreparedStatement : [select KB.*, TN.SOBHYT, DT.TENDOITUONG        from TT_NGOAITRU_KHAMBENH KB        inner join TT_TIEPNHAN TN ON TN.TIEPNHAN_ID = KB.KHAMBENH_ID        left join TM_DOITUONG DT ON DT.DOITUONG_ID = TN.DOITUONG_ID        where KB.BENHNHAN_ID  =  @param0         and KB.BENHVIEN_ID = 'HLU01'                    and KB.NGAYKHAM >= '2/14/2019 12:00:00 AM'                  and KB.NGAYKHAM <= '8/14/2019 12:00:00 AM'               order by KB.THOIGIANKHAM desc]
2019-08-14 18:54:36,057 [1] DEBUG - Statement Id: [DAO00014_GetTTinKhamBenhByBenhNhanID] Parameters: [@param0=[BENHNHAN_ID,21353]]
2019-08-14 18:54:36,057 [1] DEBUG - Statement Id: [DAO00014_GetTTinKhamBenhByBenhNhanID] Types: [@param0=[Int64, System.Int64]]
--------------------------------------------------------------------------------
