--------------------------------------------------------------------------------
2019-11-12 13:52:25,135 [1] DEBUG - Statement Id: [DAO00001_DBList] PreparedStatement : [select *              from TM_SYS_SERVER              where HOSPITAL_ID = '_SYSTEM_' and TYPE = 'D']
2019-11-12 13:52:25,519 [1] DEBUG - Statement Id: [DAO00001_DaoList] PreparedStatement : [select              TM_SYS_SERVICEMAP.ID,              TM_SYS_SERVICEMAP.HOSPITAL_ID,              TM_SYS_SERVICEMAP.DB_NAME,              TM_SYS_SERVICEMAP.TYPE,              TM_SYS_SERVICEMAP.NAME,              TM_SYS_SERVICEMAP.CLASS,              (TM_SYS_DIC.VALUE + '.' + TM_SYS_SERVICEMAP.CLASS) as CLASSFULL,              TM_SYS_SERVICEMAP.ASSEMBLY              from TM_SYS_SERVICEMAP              inner join TM_SYS_DIC              on TM_SYS_SERVICEMAP.NAMESPACE = TM_SYS_DIC.ID              where HOSPITAL_ID = '_SYSTEM_' AND TYPE = 'D' AND ACTIVE = '1'              order by DB_NAME]
2019-11-12 13:52:25,559 [1] DEBUG - Statement Id: [DAO00001_ServiceList] PreparedStatement : [select              TM_SYS_SERVICEMAP.ID,              TM_SYS_SERVICEMAP.HOSPITAL_ID,              TM_SYS_SERVICEMAP.DB_NAME,              TM_SYS_SERVICEMAP.TYPE,              TM_SYS_SERVICEMAP.NAME,              TM_SYS_SERVICEMAP.CLASS,              (TM_SYS_DIC.VALUE + '.' + TM_SYS_SERVICEMAP.CLASS) as CLASSFULL,              TM_SYS_SERVICEMAP.ASSEMBLY,              TM_SYS_SERVER.URL              from TM_SYS_SERVICEMAP              inner join TM_SYS_DIC on TM_SYS_SERVICEMAP.NAMESPACE = TM_SYS_DIC.ID              inner join TM_SYS_SERVER on (TM_SYS_SERVICEMAP.DB_NAME = TM_SYS_SERVER.NAME) and (TM_SYS_SERVER.HOSPITAL_ID = '_SYSTEM_')              where TM_SYS_SERVICEMAP.HOSPITAL_ID = '_SYSTEM_' AND TM_SYS_SERVICEMAP.TYPE = 'S'  AND ACTIVE = '1'              order by URL]
2019-11-12 13:52:26,342 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = '_SYSTEM_'               AND                   TM_SYS_SCREEN.PAGE = 'LOGIN'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2019-11-12 13:52:28,157 [1] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = '_SYSTEM_'               AND                   TM_SYS_CACHE.ACTIVE = '1']
2019-11-12 13:53:27,370 [1] DEBUG - Statement Id: [DAO00001_DBList] PreparedStatement : [select *              from TM_SYS_SERVER              where HOSPITAL_ID = 'HLU01' and TYPE = 'D']
2019-11-12 13:53:27,401 [1] DEBUG - Statement Id: [DAO00001_DaoList] PreparedStatement : [select              TM_SYS_SERVICEMAP.ID,              TM_SYS_SERVICEMAP.HOSPITAL_ID,              TM_SYS_SERVICEMAP.DB_NAME,              TM_SYS_SERVICEMAP.TYPE,              TM_SYS_SERVICEMAP.NAME,              TM_SYS_SERVICEMAP.CLASS,              (TM_SYS_DIC.VALUE + '.' + TM_SYS_SERVICEMAP.CLASS) as CLASSFULL,              TM_SYS_SERVICEMAP.ASSEMBLY              from TM_SYS_SERVICEMAP              inner join TM_SYS_DIC              on TM_SYS_SERVICEMAP.NAMESPACE = TM_SYS_DIC.ID              where HOSPITAL_ID = 'HLU01' AND TYPE = 'D' AND ACTIVE = '1'              order by DB_NAME]
2019-11-12 13:53:31,015 [1] DEBUG - Statement Id: [DAO00001_ServiceList] PreparedStatement : [select              TM_SYS_SERVICEMAP.ID,              TM_SYS_SERVICEMAP.HOSPITAL_ID,              TM_SYS_SERVICEMAP.DB_NAME,              TM_SYS_SERVICEMAP.TYPE,              TM_SYS_SERVICEMAP.NAME,              TM_SYS_SERVICEMAP.CLASS,              (TM_SYS_DIC.VALUE + '.' + TM_SYS_SERVICEMAP.CLASS) as CLASSFULL,              TM_SYS_SERVICEMAP.ASSEMBLY,              TM_SYS_SERVER.URL              from TM_SYS_SERVICEMAP              inner join TM_SYS_DIC on TM_SYS_SERVICEMAP.NAMESPACE = TM_SYS_DIC.ID              inner join TM_SYS_SERVER on (TM_SYS_SERVICEMAP.DB_NAME = TM_SYS_SERVER.NAME) and (TM_SYS_SERVER.HOSPITAL_ID = 'HLU01')              where TM_SYS_SERVICEMAP.HOSPITAL_ID = 'HLU01' AND TM_SYS_SERVICEMAP.TYPE = 'S'  AND ACTIVE = '1'              order by URL]
2019-11-12 13:53:31,258 [6] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1']
2019-11-12 13:53:32,620 [6] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM005']
2019-11-12 13:53:33,422 [6] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM015']
2019-11-12 13:53:33,499 [6] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM067']
2019-11-12 13:53:33,590 [6] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM008']
2019-11-12 13:53:34,636 [6] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM068']
2019-11-12 13:53:34,947 [6] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM006']
2019-11-12 13:53:35,085 [6] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM030']
2019-11-12 13:53:35,176 [6] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM025']
2019-11-12 13:53:35,282 [6] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM024']
2019-11-12 13:53:35,899 [6] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM033']
2019-11-12 13:53:35,932 [6] DEBUG - Statement Id: [DAO00027_GetListDuocKyGuiTonKho] PreparedStatement : [select  distinct TT_TONKHO.DUOC_KEY, LTRIM(TT_TONKHO.KHODUOC_ID) as KHODUOC_ID, TM_DUOC.DUOC_ID, TM_LOAIDUOC.MALOAIDUOC,TM_DUOC.SOVISA,TM_DUOC.TYLE_VAT,TM_DUOC.COTOA,        TM_DUOC.MADUOC, TM_DUOC.TENHANG, TM_DUOC.TENDUOCDAYDU, dvt.TENDONVITINH as DONVITINH,  TM_DUOC.DONVITINH_ID,TM_DUOC.BHYT,TM_DUOC.PHAMVI,        TM_DUOC.TENHOATCHAT, TM_DUOC.HAMLUONG, TM_DUOC.HANGSANXUAT, TM_DUOC.QUOCGIA, TM_DUOC.LOAIDUOC_ID, TM_DUOC.DUONGDUNG_ID,        TM_TENDUOC.TENDUOC, TM_TENDUOC.TENDUOC_EN, TM_TENDUOC.MAQUOCTE, TM_TENDUOC.MAQUOCTEBT,        TM_LOAIDUOC.LOAIVATTU_ID, TM_DUOC.BENHVIEN_ID,TT_TONKHO.SOLUONG, TT_TONKHO.NGUONDUOC_ID, NH.TENNGUONDUOC        , TAMNGUNG = CASE WHEN TM_DUOC.TAMNGUNG = '1' OR nh.TAMNGUNG = '1' OR KD.TAMNGUNG = '1' THEN '1' ELSE '0' END        , TM_DUOC.DANGTRINHBAY        from TM_DUOC        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = TM_DUOC.DONVITINH_ID        left join TM_TENDUOC on TM_DUOC.TENDUOC_ID = TM_TENDUOC.TENDUOC_ID and TM_DUOC.BENHVIEN_ID = 'HLU01' and TM_DUOC.TAMNGUNG = '0'        left join TM_LOAIDUOC on TM_LOAIDUOC.LOAIDUOC_ID = TM_DUOC.LOAIDUOC_ID and TM_LOAIDUOC.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG on (TM_LOAIDUOC.LOAIVATTU_ID = TM_DUOC_HANDUNG.LOAIDUOC and TM_DUOC_HANDUNG.BENHVIEN_ID = 'HLU01')        inner join        (select LTRIM(A.KHODUOC_ID) + '_' + LTRIM(A.DUOC_ID) + '_' + LTRIM(ISNULL(A.NGUONDUOC_ID,'')) as DUOC_KEY, A.KHODUOC_ID, A.DUOC_ID,A.NGUONDUOC_ID,        SUM(isnull(A.SOLUONG,0)) as SOLUONG        from        (select SUM(SOLUONG) as SOLUONG, KHODUOC_ID, DUOC_ID, NGUONDUOC_ID from TT_DUOC_KYGUI_TONKHO        where BENHVIEN_ID = 'HLU01' group by KHODUOC_ID, DUOC_ID, NGUONDUOC_ID) A        group by LTRIM(A.KHODUOC_ID) + '_' + LTRIM(A.DUOC_ID) + '_' + LTRIM(A.NGUONDUOC_ID), A.KHODUOC_ID, A.DUOC_ID, A.NGUONDUOC_ID)        TT_TONKHO on TT_TONKHO.DUOC_ID = TM_DUOC.DUOC_ID        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = TT_TONKHO.NGUONDUOC_ID and nh.BENHVIEN_ID = 'HLU01'        LEFT JOIN TM_KHODUOC KD ON KD.KHODUOC_ID = TT_TONKHO.KHODUOC_ID        where TM_DUOC.BENHVIEN_ID = 'HLU01' AND TT_TONKHO.SOLUONG >= 0]
2019-11-12 13:53:36,002 [6] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM018']
2019-11-12 13:53:36,032 [6] DEBUG - Statement Id: [DAO00027_GetListDuocTonKho] PreparedStatement : [select distinct TT_TONKHO.DUOC_KEY, LTRIM(TT_TONKHO.KHODUOC_ID) as KHODUOC_ID, TM_DUOC.DUOC_ID, TM_LOAIDUOC.MALOAIDUOC,TM_DUOC.SOVISA,TM_DUOC.TYLE_VAT,TM_DUOC.COTOA,        TM_DUOC.MADUOC, TM_DUOC.TENHANG, TM_DUOC.TENDUOCDAYDU, dvt.TENDONVITINH as DONVITINH,  TM_DUOC.DONVITINH_ID,TM_DUOC.BHYT,                TM_DUOC.TENHOATCHAT,          TM_DUOC.HAMLUONG, TM_DUOC.HANGSANXUAT, TM_DUOC.QUOCGIA, TM_DUOC.LOAIDUOC_ID, TM_DUOC.DUONGDUNG_ID,        TM_TENDUOC.TENDUOC, TM_TENDUOC.TENDUOC_EN, TM_TENDUOC.MAQUOCTE, TM_TENDUOC.MAQUOCTEBT,        TM_LOAIDUOC.LOAIVATTU_ID, TM_DUOC.BENHVIEN_ID,        TT_TONKHO.SOLUONG, TM_DUOC.VTYT_PHANLOAI, TM_DUOC.PHAMVI, TT_TONKHO.NGUONDUOC_ID, NG.TENNGUONDUOC AS TENNGUONDUOC        , TAMNGUNG = CASE WHEN TM_DUOC.TAMNGUNG = '1' OR NG.TAMNGUNG = '1' OR KD.TAMNGUNG = '1' THEN '1' ELSE '0' END        , TM_DUOC.DANGTRINHBAY        from TM_DUOC        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = TM_DUOC.DONVITINH_ID        left join TM_TENDUOC on TM_DUOC.TENDUOC_ID = TM_TENDUOC.TENDUOC_ID and TM_DUOC.BENHVIEN_ID = 'HLU01' and TM_DUOC.TAMNGUNG = '0'        left join TM_LOAIDUOC on TM_LOAIDUOC.LOAIDUOC_ID = TM_DUOC.LOAIDUOC_ID and TM_LOAIDUOC.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG on (TM_LOAIDUOC.LOAIVATTU_ID = TM_DUOC_HANDUNG.LOAIDUOC and TM_DUOC_HANDUNG.BENHVIEN_ID = 'HLU01')        inner join        (select LTRIM(A.KHODUOC_ID) + '_' + LTRIM(A.DUOC_ID) + '_' + LTRIM(ISNULL(A.NGUONDUOC_ID,'')) as DUOC_KEY, A.KHODUOC_ID, A.DUOC_ID, A.NGUONDUOC_ID,        SUM(isnull(A.SOLUONG,0)) as SOLUONG        from        (select SUM(SOLUONG) as SOLUONG, KHODUOC_ID, DUOC_ID, NGUONDUOC_ID from TT_DUOC_TONKHO        where BENHVIEN_ID = 'HLU01' group by KHODUOC_ID, DUOC_ID, NGUONDUOC_ID) A        group by LTRIM(A.KHODUOC_ID) + '_' + LTRIM(A.DUOC_ID) + '_' + LTRIM(ISNULL(A.NGUONDUOC_ID,'')), A.KHODUOC_ID, A.DUOC_ID, NGUONDUOC_ID        ) TT_TONKHO on TT_TONKHO.DUOC_ID = TM_DUOC.DUOC_ID        LEFT JOIN TM_NGUONHANG NG ON NG.NGUONDUOC_ID = TT_TONKHO.NGUONDUOC_ID        LEFT JOIN TM_KHODUOC KD ON KD.KHODUOC_ID = TT_TONKHO.KHODUOC_ID        where TM_DUOC.BENHVIEN_ID = 'HLU01' and TT_TONKHO.SOLUONG >= 0]
2019-11-12 13:53:38,383 [6] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM023']
2019-11-12 13:53:38,485 [6] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoVaBooking] PreparedStatement : [declare @NGUONDUOC_MACDINH varchar(5) = '0';        declare @TOAMUANGOAI int = 0;        select @NGUONDUOC_MACDINH = isnull(VALUE,0) from TM_SYS_APPSETTINGS where CODE = 'PHA_NGUONDUOC'        select @TOAMUANGOAI = isnull(VALUE,0) from TM_SYS_APPSETTINGS where CODE = 'OPD_TOAMUANGOAI_DUNGDANHMUC_DUOC'                if @TOAMUANGOAI = 1        begin        select  distinct '0' + '_' + LTRIM(d.DUOC_ID) + '_' + @NGUONDUOC_MACDINH as DUOC_KEY, 0 as PHAMVI_ID, @NGUONDUOC_MACDINH as NGUONDUOC_ID, null as TENNGUONDUOC, null as TINHTIEN, d.DUOC_ID, ld.MALOAIDUOC,        d.SOVISA,d.TYLE_VAT,d.COTOA, d.MADUOC, d.TENHANG, d.TENDUOCDAYDU, d.DONVITINH as DONVITINH, d.BHYT,        d.TENHOATCHAT, d.HAMLUONG, d.HANGSANXUAT, d.QUOCGIA, d.LOAIDUOC_ID, d.DUONGDUNG_ID, d.TINHTIEN_PTTT,        ten.TENDUOC, ten.TENDUOC_EN, ten.MAQUOCTE, ten.MAQUOCTEBT,        '' as BHYT_TEXT        , ld.LOAIVATTU_ID        , d.BENHVIEN_ID,        999999999 as SOLUONG, d.VTYT_PHANLOAI, d.PHAMVI, d.SUASOLUONGTONGHOP, d.MADUOCBV, d.DANGTRINHBAY        , TAMNGUNG = CASE WHEN d.TAMNGUNG = '1' THEN '1' ELSE '0' END        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        union all        select  distinct tk.DUOC_KEY, LTRIM(tk.PHAMVI_ID) as PHAMVI_ID, tk.NGUONDUOC_ID, nh.TENNGUONDUOC, nh.TINHTIEN, d.DUOC_ID, ld.MALOAIDUOC,        d.SOVISA,d.TYLE_VAT,d.COTOA, d.MADUOC, d.TENHANG, d.TENDUOCDAYDU, d.DONVITINH as DONVITINH, d.BHYT,        d.TENHOATCHAT, d.HAMLUONG, d.HANGSANXUAT, d.QUOCGIA, d.LOAIDUOC_ID, d.DUONGDUNG_ID, d.TINHTIEN_PTTT,        ten.TENDUOC, ten.TENDUOC_EN, ten.MAQUOCTE, ten.MAQUOCTEBT,        CASE WHEN d.BHYT = '1' THEN 'BHYT' ELSE '' END as BHYT_TEXT        , ld.LOAIVATTU_ID        , d.BENHVIEN_ID,        tk.SOLUONG, d.VTYT_PHANLOAI, d.PHAMVI, d.SUASOLUONGTONGHOP, d.MADUOCBV, d.DANGTRINHBAY        , TAMNGUNG = CASE WHEN d.TAMNGUNG = '1' OR nh.TAMNGUNG = '1' OR kd.TAMNGUNG = '1' THEN '1' ELSE '0' END        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        inner join        (        select  LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')) DUOC_KEY, (SUM(dtk.SOLUONG) - isnull(sum(A.SOLUONG),0) - isnull(sum(B.SOLUONG),0)) SOLUONG, pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        from (select sum(soluong) soluong,duoc_id,nguonduoc_id,khoduoc_id,benhvien_id from TT_DUOC_TONKHO  group by duoc_id,nguonduoc_id,khoduoc_id,benhvien_id) dtk        inner join TM_DUOC_PHAMVISD_MAPPING pvsd on dtk.KHODUOC_ID = pvsd.KHODUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NOITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) B on B.DUOC_ID = dtk.DUOC_ID and B.SOLUONG > 0 and B.PHAMVI_ID = pvsd.PHAMVI_ID and B.NGUONHANG_ID = dtk.NGUONDUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NGOAITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) A on A.DUOC_ID = dtk.DUOC_ID and A.SOLUONG > 0 and A.PHAMVI_ID = pvsd.PHAMVI_ID and A.NGUONHANG_ID = dtk.NGUONDUOC_ID        where dtk.SOLUONG > 0 and dtk.BENHVIEN_ID = 'HLU01'        group by LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')), pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        ) tk on tk.DUOC_ID = d.DUOC_ID        left join TM_DUOC_PHAMVISUDUNG kd on kd.PHAMVI_ID = tk.PHAMVI_ID and kd.BENHVIEN_ID = 'HLU01'        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = tk.NGUONDUOC_ID and nh.BENHVIEN_ID = 'HLU01'        where d.BENHVIEN_ID = 'HLU01'  and tk.SOLUONG >= 0        end        else        begin                  select  distinct tk.DUOC_KEY, LTRIM(tk.PHAMVI_ID) as PHAMVI_ID, tk.NGUONDUOC_ID, nh.TENNGUONDUOC, nh.TINHTIEN, d.DUOC_ID, ld.MALOAIDUOC,        d.SOVISA,d.TYLE_VAT,d.COTOA, d.MADUOC, d.TENHANG, d.TENDUOCDAYDU, d.DONVITINH as DONVITINH, d.BHYT,        d.TENHOATCHAT, d.HAMLUONG, d.HANGSANXUAT, d.QUOCGIA, d.LOAIDUOC_ID, d.DUONGDUNG_ID, d.TINHTIEN_PTTT,        ten.TENDUOC, ten.TENDUOC_EN, ten.MAQUOCTE, ten.MAQUOCTEBT,        CASE WHEN d.BHYT = '1' THEN 'BHYT' ELSE '' END as BHYT_TEXT        , ld.LOAIVATTU_ID        , d.BENHVIEN_ID,        tk.SOLUONG, d.VTYT_PHANLOAI, d.PHAMVI, d.SUASOLUONGTONGHOP, d.MADUOCBV, d.DANGTRINHBAY        , TAMNGUNG = CASE WHEN d.TAMNGUNG = '1' OR nh.TAMNGUNG = '1' OR kd.TAMNGUNG = '1' THEN '1' ELSE '0' END        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        inner join        (        select  LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')) DUOC_KEY, (SUM(dtk.SOLUONG) - isnull(sum(A.SOLUONG),0) - isnull(sum(B.SOLUONG),0)) SOLUONG, pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        from (select sum(soluong) soluong,duoc_id,nguonduoc_id,khoduoc_id,benhvien_id from TT_DUOC_TONKHO  group by duoc_id,nguonduoc_id,khoduoc_id,benhvien_id) dtk        inner join TM_DUOC_PHAMVISD_MAPPING pvsd on dtk.KHODUOC_ID = pvsd.KHODUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NOITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) B on B.DUOC_ID = dtk.DUOC_ID and B.SOLUONG > 0 and B.PHAMVI_ID = pvsd.PHAMVI_ID and B.NGUONHANG_ID = dtk.NGUONDUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NGOAITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) A on A.DUOC_ID = dtk.DUOC_ID and A.SOLUONG > 0 and A.PHAMVI_ID = pvsd.PHAMVI_ID and A.NGUONHANG_ID = dtk.NGUONDUOC_ID        where dtk.SOLUONG > 0 and dtk.BENHVIEN_ID = 'HLU01'        group by LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')), pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        ) tk on tk.DUOC_ID = d.DUOC_ID        left join TM_DUOC_PHAMVISUDUNG kd on kd.PHAMVI_ID = tk.PHAMVI_ID and kd.BENHVIEN_ID = 'HLU01'        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = tk.NGUONDUOC_ID and nh.BENHVIEN_ID = 'HLU01'        where d.BENHVIEN_ID = 'HLU01'  and tk.SOLUONG >= 0        end]
2019-11-12 13:53:43,678 [6] DEBUG - Statement Id: [DAO00320_GetList] PreparedStatement : [select M.*            from TM_MAU M            LEFT JOIN TM_MAU_DONVITINH DVT on M.DONVITINH_ID=DVT.DONVITINH_ID            where            M.TAMNGUNG = '0'            and M.BENHVIEN_ID = 'HLU01'            order by M.TENMAU]
2019-11-12 13:53:43,768 [6] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM071']
2019-11-12 13:53:43,832 [6] DEBUG - Statement Id: [DAO00322_GetListMauTonKhoForCreateCached] PreparedStatement : [SELECT DISTINCT        TK.MAU_KEY, TK.KHOMAU_ID, M.MAU_ID, M.MAMAU, M.TENMAU, M.NHOM_ABO, M.NHOM_RH, M.LOAIMAU_ID,        TK.SOLONHAP_ID, SLN.SOLONHAP, SLN.SOKIEMSOAT, TK.NGUONHANG_ID, NG.TENNGUONMAU, M.BENHVIEN_ID, M.DONVITINH_ID,        SUM(tk.SOLUONG) AS SOLUONG,K.TENKHO,DVT.TENDONVITINH        FROM TT_MAU_TONKHO TK        JOIN TM_KHO K ON TK.KHOMAU_ID = K.KHO_ID        JOIN TT_MAU_CHUNGTU_SOLONHAP SLN ON TK.SOLONHAP_ID = SLN.SOLONHAP_ID        JOIN TM_MAU M on TK.MAU_ID = M.MAU_ID and M.TAMNGUNG = '0'        LEFT JOIN TM_MAU_DONVITINH DVT on M.DONVITINH_ID=DVT.DONVITINH_ID        LEFT JOIN TM_NGUONMAU NG ON NG.NGUONMAU_ID = TK.NGUONHANG_ID        WHERE TK.SOLUONG > 0        GROUP BY TK.MAU_KEY, TK.KHOMAU_ID, M.MAU_ID, M.MAMAU, M.TENMAU, M.NHOM_ABO, M.NHOM_RH, M.LOAIMAU_ID,        TK.SOLONHAP_ID, SLN.SOLONHAP, SLN.SOKIEMSOAT,TK.NGUONHANG_ID, NG.TENNGUONMAU, M.BENHVIEN_ID, M.DONVITINH_ID,K.TENKHO,DVT.TENDONVITINH]
2019-11-12 13:53:44,245 [6] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM073']
2019-11-12 13:53:44,289 [6] DEBUG - Statement Id: [DAO00322_GetListMauTonKhoTruBooking] PreparedStatement : [select distinct        TK.MAU_KEY, TK.KHOMAU_ID, M.MAU_ID, M.MAMAU, M.TENMAU, M.NHOM_ABO, M.NHOM_RH, M.LOAIMAU_ID, M.DONVITINH_ID,        TK.SOLONHAP_ID, TK.SOLONHAP, TK.SOKIEMSOAT,M.PHAMVI, TK.NGUONHANG_ID, NG.TENNGUONMAU, M.BENHVIEN_ID,        TK.SOLUONG,TK.TENKHO,DVT.TENDONVITINH        from TM_MAU M        JOIN        (        select        A.MAU_KEY, A.KHOMAU_ID, A.MAU_ID ,a.NGUONHANG_ID, A.SOLONHAP_ID, A.SOLONHAP, A.SOKIEMSOAT, A.SOLUONG,A.TENKHO        from        (        select KHOMAU_ID, TK.MAU_ID, TK.NGUONHANG_ID, TK.MAU_KEY, SLN.SOLONHAP_ID, SLN.SOLONHAP, SLN.SOKIEMSOAT, ISNULL(TK.SOLUONG,0) - ISNULL(book.SOLUONG,0) as SOLUONG,K.TENKHO        from TT_MAU_TONKHO TK        JOIN TM_KHO K ON TK.KHOMAU_ID = K.KHO_ID        inner join TT_MAU_CHUNGTU_SOLONHAP SLN ON TK.SOLONHAP_ID = SLN.SOLONHAP_ID        left join dbo.TT_MAU_TONKHO_BOOK book ON book.MAU_KEY = TK.MAU_KEY AND book.TRANGTHAI = 'HIEULUC'        where ISNULL(TK.SOLUONG,0) - ISNULL(book.SOLUONG,0) > 0        ) A        )TK on TK.MAU_ID = M.MAU_ID and M.TAMNGUNG = '0'        LEFT JOIN TM_MAU_DONVITINH DVT on M.DONVITINH_ID=DVT.DONVITINH_ID        LEFT JOIN TM_NGUONMAU NG ON NG.NGUONMAU_ID = TK.NGUONHANG_ID]
2019-11-12 13:53:44,360 [6] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM072']
2019-11-12 13:53:45,301 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'MAIN'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2019-11-12 13:53:48,279 [1] DEBUG - Statement Id: [DAO00002_FormList] PreparedStatement : [select              TM_SYS_FORM.HOSPITAL_ID,              TM_SYS_FORM.NAME,              TM_SYS_FORM.CLASS,              TM_SYS_FORM.ASSEMBLY,              TM_SYS_FORM.TITLE_VI as TITLE              from TM_SYS_FORM              where HOSPITAL_ID = 'HLU01']
2019-11-12 13:53:55,408 [1] DEBUG - Statement Id: [DAO00300_GetShortcutListByUserID] PreparedStatement : [SELECT S.SHORTCUT_CODE, S.SHORTCUT_VALUE              FROM TM_SHORTCUT AS S              WHERE S.BENHVIEN_ID = 'HLU01' AND S.USER_ID = '1' AND TAMNGUNG = '0']
2019-11-12 13:53:55,456 [1] DEBUG - Statement Id: [DAO00087_GetList] PreparedStatement : [select CODE, VALUE, BENHVIEN_ID              from TM_SYS_APPSETTINGS              where LOCKED = '0' and BENHVIEN_ID = 'HLU01'              order by SETTING_ID]
2019-11-12 13:53:55,563 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'MSG01'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2019-11-12 13:53:55,714 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'MSG02'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2019-11-12 13:53:56,113 [1] DEBUG - Statement Id: [DAO00008_GetUserSettings] PreparedStatement : [select A.*, B.TENKHO , C.TENPHONGBAN, B.MAKHO, C.MAPHONGBAN          from TM_SYS_USERS A          left join TM_KHODUOC B on B.KHODUOC_ID = A.INVENTORY_ID          left join TM_PHONGBAN C on (C.PHONGBAN_ID = A.WORKING_DEPT_ID and C.BENHVIEN_ID =  @param0 )          left join TM_SYS_USERKHO D on (D.ACCOUNT_ID = A.ACCOUNT_ID and D.HOSPITAL_ID =  @param0 )          where          A.HOSPITAL_ID =  @param0            and                 A.ACCOUNT_ID =  @param1]
2019-11-12 13:53:56,116 [1] DEBUG - Statement Id: [DAO00008_GetUserSettings] Parameters: [@param0=[HOSPITAL_ID,HLU01], @param1=[ACCOUNT_ID,113]]
2019-11-12 13:53:56,116 [1] DEBUG - Statement Id: [DAO00008_GetUserSettings] Types: [@param0=[String, System.String], @param1=[String, System.String]]
2019-11-12 13:53:56,161 [1] DEBUG - Statement Id: [DAO00008_GetUserInvSettings] PreparedStatement : [select A.*, B.TENKHO, B.MAKHO, B.LOAIKHO_ID, B.KHOQUANLY_ID          from TM_SYS_USERKHO A          left join TM_KHO B on B.MODULE_ID = A.MODULE_ID and B.KHO_ID = A.KHO_ID          where A.HOSPITAL_ID =  @param0  and A.ACCOUNT_ID =  @param1           order by B.TENKHO]
2019-11-12 13:53:56,161 [1] DEBUG - Statement Id: [DAO00008_GetUserInvSettings] Parameters: [@param0=[HOSPITAL_ID,HLU01], @param1=[ACCOUNT_ID,113]]
2019-11-12 13:53:56,161 [1] DEBUG - Statement Id: [DAO00008_GetUserInvSettings] Types: [@param0=[String, System.String], @param1=[String, System.String]]
2019-11-12 13:53:56,351 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'COM30'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2019-11-12 13:53:56,696 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'RIS04'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2019-11-12 13:54:09,080 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'MENU1'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2019-11-12 13:54:09,900 [1] DEBUG - Statement Id: [DAO00011_GetList] PreparedStatement : [select              TM_SYS_MENU.ID,              TM_SYS_MENU.PARENTID,              TM_SYS_MENU.SCREEN,              TM_SYS_MENU.SMALLIMAGE,              TM_SYS_MENU.LARGEIMAGE,              TM_SYS_MENU.DESCRIPTION,              TM_SYS_MENU.TYPE,              TM_SYS_MENU.TITLE_VI as TITLE              from TM_SYS_MENU              where TM_SYS_MENU.HOSPITAL_ID = 'HLU01' and TM_SYS_MENU.ACTIVE = '1'               AND                   (TM_SYS_MENU.TYPE & '8' = '8')                             order by TM_SYS_MENU.ORDERNUM]
2019-11-12 13:54:10,266 [1] DEBUG - Statement Id: [DAO00011_usermenu_list] PreparedStatement : [select              TM_SYS_HOMEMENU.MENUID as ID,              TM_SYS_MENU.TITLE_VI as TITLE,              TM_SYS_MENU.SCREEN,              TM_SYS_MENU.SMALLIMAGE,              TM_SYS_MENU.LARGEIMAGE,              TM_SYS_MENU.TYPE              from TM_SYS_HOMEMENU              left join TM_SYS_MENU on TM_SYS_MENU.ID = TM_SYS_HOMEMENU.MENUID and TM_SYS_MENU.HOSPITAL_ID = TM_SYS_HOMEMENU.HOSPITAL_ID              where TM_SYS_HOMEMENU.HOSPITAL_ID = 'HLU01' and TM_SYS_HOMEMENU.USERID = '113' and TM_SYS_MENU.ACTIVE = '1'               AND                   (TM_SYS_MENU.TYPE & '8' = '8')                             ORDER BY TM_SYS_HOMEMENU.ORDERNUM]
2019-11-12 13:54:17,923 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'EIN02'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2019-11-12 13:54:19,299 [1] DEBUG - Statement Id: [EIN00002_GetListHoaDonBenhVien] PreparedStatement : [select * from          (select distinct hd.HOADON_ID, hd.SOHOADON, hd.NGAYHOADON, httt.GIATRITHUCTHU, bn.TENBENHNHAN, bn.MAYTE, bn.DIACHILIENLAC DIACHI,        case when hdngt.HOADON_ID is not null then N'Ngoại trú/ nhà thuốc' else N'Nội trú' end LOAIHOADONTHU,        case when hdngt.HOADON_ID is not null then N'TT_HOADON_CHITIET_NGOAITRU' else N'TT_HOADON_CHITIET_NOITRU' end REF_TABLE,        nv.TENNHANVIEN, httt.TENHINHTHUCTHANHTOAN, 'BENHVIEN' THANHTOANTAI        from TT_HOADON hd        left join TT_HOADON_HINHTHUCTHANHTOAN httt on httt.HOADON_ID = hd.HOADON_ID        left join TT_BENHNHAN bn on bn.BENHNHAN_ID = hd.BENHNHAN_ID        left join TT_HOADON_CHITIET_NGOAITRU hdngt on hdngt.HOADON_ID = hd.HOADON_ID        left join TT_HOADON_CHITIET_NOITRU hdnt on hdnt.HOADON_ID = hd.HOADON_ID        left join TM_NHANVIEN nv on nv.NHANVIEN_ID = hd.NGUOITAO_ID        left join TT_INVOICE_HOADON vnpt on vnpt.HOADON_ID = hd.HOADON_ID        left join TT_INVOICE main on main.INVOICE_ID = vnpt.INVOICE_ID        where        (hd.TIEPNHAN_ID is not null or hd.BENHNHAN_ID is not null ) and hd.LOAIHOADON = 'BL'        and (vnpt.HOADON_ID is null)        and hd.DATHANHTOAN = '1' and hd.HUYHOADON = '0' and hd.HOANTRA = '0'                 union all        select distinct hd.HOADON_ID, hd.SOHOADON, hd.NGAYHOADON, httt.GIATRITHUCTHU, NM.TENNGUOIMUA TENBENHNHAN, ('VANGLAI' + cast(NM.NGOAITRU_TOATHUOC_NGUOIMUA_ID as varchar(10))) MAYTE, NM.DIACHI,        N'Vãng lai nhà thuốc' LOAIHOADONTHU,        N'TT_HOADON_CHITIET_NGOAITRU' REF_TABLE,        nv.TENNHANVIEN, httt.TENHINHTHUCTHANHTOAN, 'VANGLAI' THANHTOANTAI        from TT_HOADON hd        left join TT_HOADON_HINHTHUCTHANHTOAN httt on httt.HOADON_ID = hd.HOADON_ID        left join TT_HOADON_CHITIET_NGOAITRU hdngt on hdngt.HOADON_ID = hd.HOADON_ID        left join TT_DUOC_CHUNGTU_CHITIET ctct on ctct.CHUNGTUCHITIET_ID= hdngt.REF_ID        left join TT_DUOC_CHUNGTU ct on ct.CHUNGTU_ID = ctct.CHUNGTU_ID        left join TT_NGOAITRU_TOATHUOC_NGUOIMUA NM on NM.NGOAITRU_TOATHUOC_NGUOIMUA_ID = CT.NGOAITRU_TOATHUOC_NGUOIMUA_ID        left join TM_NHANVIEN nv on nv.NHANVIEN_ID = hd.NGUOITAO_ID        left join TT_INVOICE_HOADON vnpt on vnpt.HOADON_ID = hd.HOADON_ID        left join TT_INVOICE main on main.INVOICE_ID = vnpt.INVOICE_ID        where        hd.TIEPNHAN_ID is null and hd.BENHNHAN_ID is null  and hd.LOAIHOADON = 'BL'        and (vnpt.HOADON_ID is null)        and hd.DATHANHTOAN = '1' and hd.HUYHOADON = '0' and hd.HOANTRA = '0'                 ) ds        order by ds.TENBENHNHAN]
2019-11-12 13:54:50,285 [1] DEBUG - Statement Id: [EIN00002_GetListHoaDonBenhVien] PreparedStatement : [select * from          (select distinct hd.HOADON_ID, hd.SOHOADON, hd.NGAYHOADON, httt.GIATRITHUCTHU, bn.TENBENHNHAN, bn.MAYTE, bn.DIACHILIENLAC DIACHI,        case when hdngt.HOADON_ID is not null then N'Ngoại trú/ nhà thuốc' else N'Nội trú' end LOAIHOADONTHU,        case when hdngt.HOADON_ID is not null then N'TT_HOADON_CHITIET_NGOAITRU' else N'TT_HOADON_CHITIET_NOITRU' end REF_TABLE,        nv.TENNHANVIEN, httt.TENHINHTHUCTHANHTOAN, 'BENHVIEN' THANHTOANTAI        from TT_HOADON hd        left join TT_HOADON_HINHTHUCTHANHTOAN httt on httt.HOADON_ID = hd.HOADON_ID        left join TT_BENHNHAN bn on bn.BENHNHAN_ID = hd.BENHNHAN_ID        left join TT_HOADON_CHITIET_NGOAITRU hdngt on hdngt.HOADON_ID = hd.HOADON_ID        left join TT_HOADON_CHITIET_NOITRU hdnt on hdnt.HOADON_ID = hd.HOADON_ID        left join TM_NHANVIEN nv on nv.NHANVIEN_ID = hd.NGUOITAO_ID        left join TT_INVOICE_HOADON vnpt on vnpt.HOADON_ID = hd.HOADON_ID        left join TT_INVOICE main on main.INVOICE_ID = vnpt.INVOICE_ID        where        (hd.TIEPNHAN_ID is not null or hd.BENHNHAN_ID is not null ) and hd.LOAIHOADON = 'BL'        and (vnpt.HOADON_ID is null)        and hd.DATHANHTOAN = '1' and hd.HUYHOADON = '0' and hd.HOANTRA = '0'         and           convert(date, hd.NGAYHOADON) >= convert(date, '6/1/2019 12:00:00 AM')         and           convert(date, hd.NGAYHOADON) <= convert(date, '11/12/2019 12:00:00 AM')                 union all        select distinct hd.HOADON_ID, hd.SOHOADON, hd.NGAYHOADON, httt.GIATRITHUCTHU, NM.TENNGUOIMUA TENBENHNHAN, ('VANGLAI' + cast(NM.NGOAITRU_TOATHUOC_NGUOIMUA_ID as varchar(10))) MAYTE, NM.DIACHI,        N'Vãng lai nhà thuốc' LOAIHOADONTHU,        N'TT_HOADON_CHITIET_NGOAITRU' REF_TABLE,        nv.TENNHANVIEN, httt.TENHINHTHUCTHANHTOAN, 'VANGLAI' THANHTOANTAI        from TT_HOADON hd        left join TT_HOADON_HINHTHUCTHANHTOAN httt on httt.HOADON_ID = hd.HOADON_ID        left join TT_HOADON_CHITIET_NGOAITRU hdngt on hdngt.HOADON_ID = hd.HOADON_ID        left join TT_DUOC_CHUNGTU_CHITIET ctct on ctct.CHUNGTUCHITIET_ID= hdngt.REF_ID        left join TT_DUOC_CHUNGTU ct on ct.CHUNGTU_ID = ctct.CHUNGTU_ID        left join TT_NGOAITRU_TOATHUOC_NGUOIMUA NM on NM.NGOAITRU_TOATHUOC_NGUOIMUA_ID = CT.NGOAITRU_TOATHUOC_NGUOIMUA_ID        left join TM_NHANVIEN nv on nv.NHANVIEN_ID = hd.NGUOITAO_ID        left join TT_INVOICE_HOADON vnpt on vnpt.HOADON_ID = hd.HOADON_ID        left join TT_INVOICE main on main.INVOICE_ID = vnpt.INVOICE_ID        where        hd.TIEPNHAN_ID is null and hd.BENHNHAN_ID is null  and hd.LOAIHOADON = 'BL'        and (vnpt.HOADON_ID is null)        and hd.DATHANHTOAN = '1' and hd.HUYHOADON = '0' and hd.HOANTRA = '0'         and           convert(date, hd.NGAYHOADON) >= convert(date, '6/1/2019 12:00:00 AM')         and           convert(date, hd.NGAYHOADON) <= convert(date, '11/12/2019 12:00:00 AM')                 ) ds        order by ds.TENBENHNHAN]
2019-11-12 13:54:55,401 [1] DEBUG - Statement Id: [EIN00002_GetChiTietHoaDon] PreparedStatement : [select distinct hdct.*, hdct.GIATRI_BENHNHAN_DATHANHTOAN AMOUNT, hdct.SOLUONG PRODQUANTITY,        isnull(dv.TENDICHVU, dc.TENDUOCDAYDU) PRODNAME, isnull(dv.MADICHVU, dc.MADUOC) PRODCODE,        isnull(dv.DONVITINH, dc.DONVITINH) PRODUNIT, hdct.DONGIA_DOANHTHU PRODPRICE,        case when dc.DUOC_ID is not null then case when lvt.LOAIVATTU_ID = 'T' then N'Thuốc, dịch truyền' else lvt.TENLOAIVATTU end       else isnull(ndv_ct.TENNHOMDICHVU, ndv.TENNHOMDICHVU)        end as GROUPPROD        from TT_HOADON_CHITIET_NOITRU (nolock) hdct        left join TM_DICHVU (nolock) dv on dv.DICHVU_ID = hdct.DICHVU_ID and hdct.DUOC_ID is null        left join TM_DUOC (nolock) dc on dc.DUOC_ID = hdct.DUOC_ID and hdct.DICHVU_ID is null        left join TM_NHOMDICHVU (nolock) ndv on ndv.NHOMDICHVU_ID = dv.NHOMDICHVU_ID       left join TM_NHOMDICHVU (nolock) ndv_ct on ndv_ct.NHOMDICHVU_ID = ndv.CAPTREN_ID       left join TM_LOAIDUOC (nolock) ld on ld.LOAIDUOC_ID = dc.LOAIDUOC_ID       left join TM_LOAIVATTU (nolock) lvt on lvt.LOAIVATTU_ID = ld.LOAIVATTU_ID        where HOADON_ID = 43341]
2019-11-12 13:55:18,600 [1] DEBUG - Statement Id: [EIN00002_CheckHoadondaxuat] PreparedStatement : [select B.*        from TT_INVOICE A        left join TT_INVOICE_HOADON B on A.INVOICE_ID = B.INVOICE_ID        where B.HOADON_ID = 43341 and A.HUY = '0']
2019-11-12 13:55:50,661 [1] DEBUG - Statement Id: [DAO00087_GetServiceParams] PreparedStatement : [select CODE, VALUE              from TM_SYS_APPSETTINGS              where LOCKED = '0' and BENHVIEN_ID = 'HLU01']
2019-11-12 13:58:08,994 [1] DEBUG - Statement Id: [EIN00002_INVOICE_Json] PreparedStatement : [declare @json nvarchar(max);        declare @jsonHODON_ID nvarchar(max);        set @json = N'[{"HOADON_CHITIET_NOITRU_ID":303293,"HOADON_ID":43341,"VIENPHI_ID":666621,"REF_ID":202907,"REF_TABLE":"TT_DVYEUCAU","DICHVU_ID":5677,"DUOC_ID":null,"LOAI_CHIPHI":"TT","LOAIGIA_ID":3,"SOLUONG":1.0,"DONGIA_DOANHTHU":900000.0,"THANHTIEN_DOANHTHU":900000.0,"TYLEVAT":null,"GIATRIVAT":null,"BHYT_TL":0.0,"BHYT_DONGIA":0.0,"BHYT_THANHTIEN":0.0,"BHYT_DONGIA_CHITRA":0.0,"BHYT_THANHTIEN_CHITRA":0.0,"BENHNHAN_PHAITHANHTOAN":900000.0,"GIATRI_HOADON":900000.0,"GIATRI_HOADON_DATHANHTOAN":900000.0,"GIATRI_BIENLAI":900000.0,"GIATRI_BIENLAI_DATHANHTOAN":0.0,"GIATRI_BENHNHAN_DATHANHTOAN":900000.0,"TYLE_THATTHU":null,"GIATRI_THATTHU":null,"MIENGIAM_TL":null,"MIENGIAM_GIATRI":0.0,"NGANSACH_TL":null,"NGANSACH_GIATRI":null,"TAITRO_TL":null,"TAITRO_GIATRI":null,"BHTN_GIATRI":null,"PHONGBAN_ID":null,"NOITRU_TOATHUOC_ID":null,"NOITRU_TRATHUOC_ID":null,"BENHANPHAUTHUAT_VTYT_ID":null,"NOITRU_GIUONGBENH_ID":null,"CLSGHINHANHOACHAT_ID":null,"DAHOANTRA":null,"GHICHU":null,"CONGTYCHITRA_GIATRI":0.0,"HOIVIEN_GIATRI":0.0,"BENHVIEN_ID":"HLU01","NGUOITAO_ID":691,"NGAYTAO":"2019-06-03T15:22:16.8","NGUOICAPNHAT_ID":691,"NGAYCAPNHAT":"2019-06-03T15:22:16.8","AMOUNT":900000.0,"PRODQUANTITY":1.0,"PRODNAME":"Dịch vụ XN sàng lọc sơ sinh (5 bệnh) + Hemoglobinopathies (Lấy mẫu gót chân)","PRODCODE":"5592","PRODUNIT":"lần","PRODPRICE":900000.0,"GROUPPROD":"Dịch vụ y tế khác"}]';        set @jsonHODON_ID = N'[{"HOADON_ID":43341}]';          declare @INVOICE_ID int;        INSERT INTO TT_INVOICE        (KEYINVOICE ,BUYER, [ADDRESS], CUSCODE ,CUSNAME ,PAYMENTMETHOD ,NGAYPHATSINH ,SOHOADON ,GIATRITHUCTHU ,SOTIENBANGCHU        , HUY, NGUOITAO_ID, NGAYTAO, BENHVIEN_ID)        VALUES        ( @param0 ,  @param1 ,  @param2 ,  @param3 ,  @param4 ,  @param5 , CONVERT(DATETIME,  @param6 , 103),  @param7 ,  @param8 ,  @param9         ,'0', '1', Getdate(), 'HLU01')        set @INVOICE_ID = SCOPE_IDENTITY()          insert into TT_INVOICE_HOADON        SELECT @INVOICE_ID, jsonHD.HOADON_ID, 'HLU01'        FROM OPENJSON(@jsonHODON_ID)        WITH ( HOADON_ID int) jsonHD          insert into TT_INVOICE_DETAIL        SELECT @INVOICE_ID, json.HOADON_ID, json.PRODNAME, json.PRODQUANTITY, json.PRODUNIT, json.AMOUNT, '1', getdate() , 'HLU01'        FROM OPENJSON(@json)        WITH ( HOADON_ID int, PRODNAME nvarchar(300), PRODQUANTITY float, PRODUNIT nvarchar(100), AMOUNT float) json]
2019-11-12 13:58:08,995 [1] DEBUG - Statement Id: [EIN00002_INVOICE_Json] Parameters: [@param0=[KEYINVOICE,20191112135540_190042699], @param1=[BUYER,], @param2=[ADDRESS, Xã An Thọ, Huyện Tuy An, Tỉnh Phú Yên], @param3=[CUSCODE,190042699], @param4=[CUSNAME,Bùi Tấn Minh Khang], @param5=[PAYMENTMETHOD,Tiền mặt], @param6=[NGAYPHATSINH,12/11/2019], @param7=[SOHOADON,null], @param8=[GIATRITHUCTHU,900000], @param9=[SOTIENBANGCHU,Chín trăm nghìn đồng chẵn.]]
2019-11-12 13:58:08,995 [1] DEBUG - Statement Id: [EIN00002_INVOICE_Json] Types: [@param0=[String, System.String], @param1=[String, System.String], @param2=[String, System.String], @param3=[String, System.String], @param4=[String, System.String], @param5=[String, System.String], @param6=[String, System.String], @param7=[System.DBNull, null], @param8=[Double, System.Double], @param9=[String, System.String]]
2019-11-12 13:58:11,606 [1] DEBUG - Statement Id: [EIN00002_GetHoaDonDaXuatLenCong] PreparedStatement : [select * from TT_INVOICE hd        where         HUY = '0'         and           convert(date, hd.NGAYPHATSINH) >= convert(date, '6/1/2019 12:00:00 AM')       and         convert(date, hd.NGAYPHATSINH) <= convert(date, '11/12/2019 12:00:00 AM')]
2019-11-12 13:58:20,549 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'EIN03'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2019-11-12 13:58:28,544 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'COM98'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
--------------------------------------------------------------------------------
2019-11-12 14:32:28,387 [1] DEBUG - Statement Id: [DAO00001_DBList] PreparedStatement : [select *              from TM_SYS_SERVER              where HOSPITAL_ID = '_SYSTEM_' and TYPE = 'D']
2019-11-12 14:32:28,646 [1] DEBUG - Statement Id: [DAO00001_DaoList] PreparedStatement : [select              TM_SYS_SERVICEMAP.ID,              TM_SYS_SERVICEMAP.HOSPITAL_ID,              TM_SYS_SERVICEMAP.DB_NAME,              TM_SYS_SERVICEMAP.TYPE,              TM_SYS_SERVICEMAP.NAME,              TM_SYS_SERVICEMAP.CLASS,              (TM_SYS_DIC.VALUE + '.' + TM_SYS_SERVICEMAP.CLASS) as CLASSFULL,              TM_SYS_SERVICEMAP.ASSEMBLY              from TM_SYS_SERVICEMAP              inner join TM_SYS_DIC              on TM_SYS_SERVICEMAP.NAMESPACE = TM_SYS_DIC.ID              where HOSPITAL_ID = '_SYSTEM_' AND TYPE = 'D' AND ACTIVE = '1'              order by DB_NAME]
2019-11-12 14:32:28,684 [1] DEBUG - Statement Id: [DAO00001_ServiceList] PreparedStatement : [select              TM_SYS_SERVICEMAP.ID,              TM_SYS_SERVICEMAP.HOSPITAL_ID,              TM_SYS_SERVICEMAP.DB_NAME,              TM_SYS_SERVICEMAP.TYPE,              TM_SYS_SERVICEMAP.NAME,              TM_SYS_SERVICEMAP.CLASS,              (TM_SYS_DIC.VALUE + '.' + TM_SYS_SERVICEMAP.CLASS) as CLASSFULL,              TM_SYS_SERVICEMAP.ASSEMBLY,              TM_SYS_SERVER.URL              from TM_SYS_SERVICEMAP              inner join TM_SYS_DIC on TM_SYS_SERVICEMAP.NAMESPACE = TM_SYS_DIC.ID              inner join TM_SYS_SERVER on (TM_SYS_SERVICEMAP.DB_NAME = TM_SYS_SERVER.NAME) and (TM_SYS_SERVER.HOSPITAL_ID = '_SYSTEM_')              where TM_SYS_SERVICEMAP.HOSPITAL_ID = '_SYSTEM_' AND TM_SYS_SERVICEMAP.TYPE = 'S'  AND ACTIVE = '1'              order by URL]
2019-11-12 14:32:29,399 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = '_SYSTEM_'               AND                   TM_SYS_SCREEN.PAGE = 'LOGIN'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2019-11-12 14:32:29,790 [1] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = '_SYSTEM_'               AND                   TM_SYS_CACHE.ACTIVE = '1']
2019-11-12 14:32:42,600 [1] DEBUG - Statement Id: [DAO00001_DBList] PreparedStatement : [select *              from TM_SYS_SERVER              where HOSPITAL_ID = 'HLU01' and TYPE = 'D']
2019-11-12 14:32:42,628 [1] DEBUG - Statement Id: [DAO00001_DaoList] PreparedStatement : [select              TM_SYS_SERVICEMAP.ID,              TM_SYS_SERVICEMAP.HOSPITAL_ID,              TM_SYS_SERVICEMAP.DB_NAME,              TM_SYS_SERVICEMAP.TYPE,              TM_SYS_SERVICEMAP.NAME,              TM_SYS_SERVICEMAP.CLASS,              (TM_SYS_DIC.VALUE + '.' + TM_SYS_SERVICEMAP.CLASS) as CLASSFULL,              TM_SYS_SERVICEMAP.ASSEMBLY              from TM_SYS_SERVICEMAP              inner join TM_SYS_DIC              on TM_SYS_SERVICEMAP.NAMESPACE = TM_SYS_DIC.ID              where HOSPITAL_ID = 'HLU01' AND TYPE = 'D' AND ACTIVE = '1'              order by DB_NAME]
2019-11-12 14:32:44,424 [1] DEBUG - Statement Id: [DAO00001_ServiceList] PreparedStatement : [select              TM_SYS_SERVICEMAP.ID,              TM_SYS_SERVICEMAP.HOSPITAL_ID,              TM_SYS_SERVICEMAP.DB_NAME,              TM_SYS_SERVICEMAP.TYPE,              TM_SYS_SERVICEMAP.NAME,              TM_SYS_SERVICEMAP.CLASS,              (TM_SYS_DIC.VALUE + '.' + TM_SYS_SERVICEMAP.CLASS) as CLASSFULL,              TM_SYS_SERVICEMAP.ASSEMBLY,              TM_SYS_SERVER.URL              from TM_SYS_SERVICEMAP              inner join TM_SYS_DIC on TM_SYS_SERVICEMAP.NAMESPACE = TM_SYS_DIC.ID              inner join TM_SYS_SERVER on (TM_SYS_SERVICEMAP.DB_NAME = TM_SYS_SERVER.NAME) and (TM_SYS_SERVER.HOSPITAL_ID = 'HLU01')              where TM_SYS_SERVICEMAP.HOSPITAL_ID = 'HLU01' AND TM_SYS_SERVICEMAP.TYPE = 'S'  AND ACTIVE = '1'              order by URL]
2019-11-12 14:32:44,677 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1']
2019-11-12 14:32:45,516 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM005']
2019-11-12 14:32:45,713 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM015']
2019-11-12 14:32:45,791 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM067']
2019-11-12 14:32:45,937 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM008']
2019-11-12 14:32:46,040 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM068']
2019-11-12 14:32:46,132 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM006']
2019-11-12 14:32:46,209 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM030']
2019-11-12 14:32:46,282 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM025']
2019-11-12 14:32:46,371 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM024']
2019-11-12 14:32:46,899 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM033']
2019-11-12 14:32:46,932 [5] DEBUG - Statement Id: [DAO00027_GetListDuocKyGuiTonKho] PreparedStatement : [select  distinct TT_TONKHO.DUOC_KEY, LTRIM(TT_TONKHO.KHODUOC_ID) as KHODUOC_ID, TM_DUOC.DUOC_ID, TM_LOAIDUOC.MALOAIDUOC,TM_DUOC.SOVISA,TM_DUOC.TYLE_VAT,TM_DUOC.COTOA,        TM_DUOC.MADUOC, TM_DUOC.TENHANG, TM_DUOC.TENDUOCDAYDU, dvt.TENDONVITINH as DONVITINH,  TM_DUOC.DONVITINH_ID,TM_DUOC.BHYT,TM_DUOC.PHAMVI,        TM_DUOC.TENHOATCHAT, TM_DUOC.HAMLUONG, TM_DUOC.HANGSANXUAT, TM_DUOC.QUOCGIA, TM_DUOC.LOAIDUOC_ID, TM_DUOC.DUONGDUNG_ID,        TM_TENDUOC.TENDUOC, TM_TENDUOC.TENDUOC_EN, TM_TENDUOC.MAQUOCTE, TM_TENDUOC.MAQUOCTEBT,        TM_LOAIDUOC.LOAIVATTU_ID, TM_DUOC.BENHVIEN_ID,TT_TONKHO.SOLUONG, TT_TONKHO.NGUONDUOC_ID, NH.TENNGUONDUOC        , TAMNGUNG = CASE WHEN TM_DUOC.TAMNGUNG = '1' OR nh.TAMNGUNG = '1' OR KD.TAMNGUNG = '1' THEN '1' ELSE '0' END        , TM_DUOC.DANGTRINHBAY        from TM_DUOC        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = TM_DUOC.DONVITINH_ID        left join TM_TENDUOC on TM_DUOC.TENDUOC_ID = TM_TENDUOC.TENDUOC_ID and TM_DUOC.BENHVIEN_ID = 'HLU01' and TM_DUOC.TAMNGUNG = '0'        left join TM_LOAIDUOC on TM_LOAIDUOC.LOAIDUOC_ID = TM_DUOC.LOAIDUOC_ID and TM_LOAIDUOC.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG on (TM_LOAIDUOC.LOAIVATTU_ID = TM_DUOC_HANDUNG.LOAIDUOC and TM_DUOC_HANDUNG.BENHVIEN_ID = 'HLU01')        inner join        (select LTRIM(A.KHODUOC_ID) + '_' + LTRIM(A.DUOC_ID) + '_' + LTRIM(ISNULL(A.NGUONDUOC_ID,'')) as DUOC_KEY, A.KHODUOC_ID, A.DUOC_ID,A.NGUONDUOC_ID,        SUM(isnull(A.SOLUONG,0)) as SOLUONG        from        (select SUM(SOLUONG) as SOLUONG, KHODUOC_ID, DUOC_ID, NGUONDUOC_ID from TT_DUOC_KYGUI_TONKHO        where BENHVIEN_ID = 'HLU01' group by KHODUOC_ID, DUOC_ID, NGUONDUOC_ID) A        group by LTRIM(A.KHODUOC_ID) + '_' + LTRIM(A.DUOC_ID) + '_' + LTRIM(A.NGUONDUOC_ID), A.KHODUOC_ID, A.DUOC_ID, A.NGUONDUOC_ID)        TT_TONKHO on TT_TONKHO.DUOC_ID = TM_DUOC.DUOC_ID        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = TT_TONKHO.NGUONDUOC_ID and nh.BENHVIEN_ID = 'HLU01'        LEFT JOIN TM_KHODUOC KD ON KD.KHODUOC_ID = TT_TONKHO.KHODUOC_ID        where TM_DUOC.BENHVIEN_ID = 'HLU01' AND TT_TONKHO.SOLUONG >= 0]
2019-11-12 14:32:47,002 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM018']
2019-11-12 14:32:47,035 [5] DEBUG - Statement Id: [DAO00027_GetListDuocTonKho] PreparedStatement : [select distinct TT_TONKHO.DUOC_KEY, LTRIM(TT_TONKHO.KHODUOC_ID) as KHODUOC_ID, TM_DUOC.DUOC_ID, TM_LOAIDUOC.MALOAIDUOC,TM_DUOC.SOVISA,TM_DUOC.TYLE_VAT,TM_DUOC.COTOA,        TM_DUOC.MADUOC, TM_DUOC.TENHANG, TM_DUOC.TENDUOCDAYDU, dvt.TENDONVITINH as DONVITINH,  TM_DUOC.DONVITINH_ID,TM_DUOC.BHYT,                TM_DUOC.TENHOATCHAT,          TM_DUOC.HAMLUONG, TM_DUOC.HANGSANXUAT, TM_DUOC.QUOCGIA, TM_DUOC.LOAIDUOC_ID, TM_DUOC.DUONGDUNG_ID,        TM_TENDUOC.TENDUOC, TM_TENDUOC.TENDUOC_EN, TM_TENDUOC.MAQUOCTE, TM_TENDUOC.MAQUOCTEBT,        TM_LOAIDUOC.LOAIVATTU_ID, TM_DUOC.BENHVIEN_ID,        TT_TONKHO.SOLUONG, TM_DUOC.VTYT_PHANLOAI, TM_DUOC.PHAMVI, TT_TONKHO.NGUONDUOC_ID, NG.TENNGUONDUOC AS TENNGUONDUOC        , TAMNGUNG = CASE WHEN TM_DUOC.TAMNGUNG = '1' OR NG.TAMNGUNG = '1' OR KD.TAMNGUNG = '1' THEN '1' ELSE '0' END        , TM_DUOC.DANGTRINHBAY        from TM_DUOC        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = TM_DUOC.DONVITINH_ID        left join TM_TENDUOC on TM_DUOC.TENDUOC_ID = TM_TENDUOC.TENDUOC_ID and TM_DUOC.BENHVIEN_ID = 'HLU01' and TM_DUOC.TAMNGUNG = '0'        left join TM_LOAIDUOC on TM_LOAIDUOC.LOAIDUOC_ID = TM_DUOC.LOAIDUOC_ID and TM_LOAIDUOC.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG on (TM_LOAIDUOC.LOAIVATTU_ID = TM_DUOC_HANDUNG.LOAIDUOC and TM_DUOC_HANDUNG.BENHVIEN_ID = 'HLU01')        inner join        (select LTRIM(A.KHODUOC_ID) + '_' + LTRIM(A.DUOC_ID) + '_' + LTRIM(ISNULL(A.NGUONDUOC_ID,'')) as DUOC_KEY, A.KHODUOC_ID, A.DUOC_ID, A.NGUONDUOC_ID,        SUM(isnull(A.SOLUONG,0)) as SOLUONG        from        (select SUM(SOLUONG) as SOLUONG, KHODUOC_ID, DUOC_ID, NGUONDUOC_ID from TT_DUOC_TONKHO        where BENHVIEN_ID = 'HLU01' group by KHODUOC_ID, DUOC_ID, NGUONDUOC_ID) A        group by LTRIM(A.KHODUOC_ID) + '_' + LTRIM(A.DUOC_ID) + '_' + LTRIM(ISNULL(A.NGUONDUOC_ID,'')), A.KHODUOC_ID, A.DUOC_ID, NGUONDUOC_ID        ) TT_TONKHO on TT_TONKHO.DUOC_ID = TM_DUOC.DUOC_ID        LEFT JOIN TM_NGUONHANG NG ON NG.NGUONDUOC_ID = TT_TONKHO.NGUONDUOC_ID        LEFT JOIN TM_KHODUOC KD ON KD.KHODUOC_ID = TT_TONKHO.KHODUOC_ID        where TM_DUOC.BENHVIEN_ID = 'HLU01' and TT_TONKHO.SOLUONG >= 0]
2019-11-12 14:32:48,156 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM023']
2019-11-12 14:32:48,190 [5] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoVaBooking] PreparedStatement : [declare @NGUONDUOC_MACDINH varchar(5) = '0';        declare @TOAMUANGOAI int = 0;        select @NGUONDUOC_MACDINH = isnull(VALUE,0) from TM_SYS_APPSETTINGS where CODE = 'PHA_NGUONDUOC'        select @TOAMUANGOAI = isnull(VALUE,0) from TM_SYS_APPSETTINGS where CODE = 'OPD_TOAMUANGOAI_DUNGDANHMUC_DUOC'                if @TOAMUANGOAI = 1        begin        select  distinct '0' + '_' + LTRIM(d.DUOC_ID) + '_' + @NGUONDUOC_MACDINH as DUOC_KEY, 0 as PHAMVI_ID, @NGUONDUOC_MACDINH as NGUONDUOC_ID, null as TENNGUONDUOC, null as TINHTIEN, d.DUOC_ID, ld.MALOAIDUOC,        d.SOVISA,d.TYLE_VAT,d.COTOA, d.MADUOC, d.TENHANG, d.TENDUOCDAYDU, d.DONVITINH as DONVITINH, d.BHYT,        d.TENHOATCHAT, d.HAMLUONG, d.HANGSANXUAT, d.QUOCGIA, d.LOAIDUOC_ID, d.DUONGDUNG_ID, d.TINHTIEN_PTTT,        ten.TENDUOC, ten.TENDUOC_EN, ten.MAQUOCTE, ten.MAQUOCTEBT,        '' as BHYT_TEXT        , ld.LOAIVATTU_ID        , d.BENHVIEN_ID,        999999999 as SOLUONG, d.VTYT_PHANLOAI, d.PHAMVI, d.SUASOLUONGTONGHOP, d.MADUOCBV, d.DANGTRINHBAY        , TAMNGUNG = CASE WHEN d.TAMNGUNG = '1' THEN '1' ELSE '0' END        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        union all        select  distinct tk.DUOC_KEY, LTRIM(tk.PHAMVI_ID) as PHAMVI_ID, tk.NGUONDUOC_ID, nh.TENNGUONDUOC, nh.TINHTIEN, d.DUOC_ID, ld.MALOAIDUOC,        d.SOVISA,d.TYLE_VAT,d.COTOA, d.MADUOC, d.TENHANG, d.TENDUOCDAYDU, d.DONVITINH as DONVITINH, d.BHYT,        d.TENHOATCHAT, d.HAMLUONG, d.HANGSANXUAT, d.QUOCGIA, d.LOAIDUOC_ID, d.DUONGDUNG_ID, d.TINHTIEN_PTTT,        ten.TENDUOC, ten.TENDUOC_EN, ten.MAQUOCTE, ten.MAQUOCTEBT,        CASE WHEN d.BHYT = '1' THEN 'BHYT' ELSE '' END as BHYT_TEXT        , ld.LOAIVATTU_ID        , d.BENHVIEN_ID,        tk.SOLUONG, d.VTYT_PHANLOAI, d.PHAMVI, d.SUASOLUONGTONGHOP, d.MADUOCBV, d.DANGTRINHBAY        , TAMNGUNG = CASE WHEN d.TAMNGUNG = '1' OR nh.TAMNGUNG = '1' OR kd.TAMNGUNG = '1' THEN '1' ELSE '0' END        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        inner join        (        select  LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')) DUOC_KEY, (SUM(dtk.SOLUONG) - isnull(sum(A.SOLUONG),0) - isnull(sum(B.SOLUONG),0)) SOLUONG, pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        from (select sum(soluong) soluong,duoc_id,nguonduoc_id,khoduoc_id,benhvien_id from TT_DUOC_TONKHO  group by duoc_id,nguonduoc_id,khoduoc_id,benhvien_id) dtk        inner join TM_DUOC_PHAMVISD_MAPPING pvsd on dtk.KHODUOC_ID = pvsd.KHODUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NOITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) B on B.DUOC_ID = dtk.DUOC_ID and B.SOLUONG > 0 and B.PHAMVI_ID = pvsd.PHAMVI_ID and B.NGUONHANG_ID = dtk.NGUONDUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NGOAITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) A on A.DUOC_ID = dtk.DUOC_ID and A.SOLUONG > 0 and A.PHAMVI_ID = pvsd.PHAMVI_ID and A.NGUONHANG_ID = dtk.NGUONDUOC_ID        where dtk.SOLUONG > 0 and dtk.BENHVIEN_ID = 'HLU01'        group by LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')), pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        ) tk on tk.DUOC_ID = d.DUOC_ID        left join TM_DUOC_PHAMVISUDUNG kd on kd.PHAMVI_ID = tk.PHAMVI_ID and kd.BENHVIEN_ID = 'HLU01'        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = tk.NGUONDUOC_ID and nh.BENHVIEN_ID = 'HLU01'        where d.BENHVIEN_ID = 'HLU01'  and tk.SOLUONG >= 0        end        else        begin                  select  distinct tk.DUOC_KEY, LTRIM(tk.PHAMVI_ID) as PHAMVI_ID, tk.NGUONDUOC_ID, nh.TENNGUONDUOC, nh.TINHTIEN, d.DUOC_ID, ld.MALOAIDUOC,        d.SOVISA,d.TYLE_VAT,d.COTOA, d.MADUOC, d.TENHANG, d.TENDUOCDAYDU, d.DONVITINH as DONVITINH, d.BHYT,        d.TENHOATCHAT, d.HAMLUONG, d.HANGSANXUAT, d.QUOCGIA, d.LOAIDUOC_ID, d.DUONGDUNG_ID, d.TINHTIEN_PTTT,        ten.TENDUOC, ten.TENDUOC_EN, ten.MAQUOCTE, ten.MAQUOCTEBT,        CASE WHEN d.BHYT = '1' THEN 'BHYT' ELSE '' END as BHYT_TEXT        , ld.LOAIVATTU_ID        , d.BENHVIEN_ID,        tk.SOLUONG, d.VTYT_PHANLOAI, d.PHAMVI, d.SUASOLUONGTONGHOP, d.MADUOCBV, d.DANGTRINHBAY        , TAMNGUNG = CASE WHEN d.TAMNGUNG = '1' OR nh.TAMNGUNG = '1' OR kd.TAMNGUNG = '1' THEN '1' ELSE '0' END        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = 'HLU01'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = 'HLU01')        inner join        (        select  LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')) DUOC_KEY, (SUM(dtk.SOLUONG) - isnull(sum(A.SOLUONG),0) - isnull(sum(B.SOLUONG),0)) SOLUONG, pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        from (select sum(soluong) soluong,duoc_id,nguonduoc_id,khoduoc_id,benhvien_id from TT_DUOC_TONKHO  group by duoc_id,nguonduoc_id,khoduoc_id,benhvien_id) dtk        inner join TM_DUOC_PHAMVISD_MAPPING pvsd on dtk.KHODUOC_ID = pvsd.KHODUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NOITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) B on B.DUOC_ID = dtk.DUOC_ID and B.SOLUONG > 0 and B.PHAMVI_ID = pvsd.PHAMVI_ID and B.NGUONHANG_ID = dtk.NGUONDUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NGOAITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) A on A.DUOC_ID = dtk.DUOC_ID and A.SOLUONG > 0 and A.PHAMVI_ID = pvsd.PHAMVI_ID and A.NGUONHANG_ID = dtk.NGUONDUOC_ID        where dtk.SOLUONG > 0 and dtk.BENHVIEN_ID = 'HLU01'        group by LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')), pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        ) tk on tk.DUOC_ID = d.DUOC_ID        left join TM_DUOC_PHAMVISUDUNG kd on kd.PHAMVI_ID = tk.PHAMVI_ID and kd.BENHVIEN_ID = 'HLU01'        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = tk.NGUONDUOC_ID and nh.BENHVIEN_ID = 'HLU01'        where d.BENHVIEN_ID = 'HLU01'  and tk.SOLUONG >= 0        end]
2019-11-12 14:32:50,608 [5] DEBUG - Statement Id: [DAO00320_GetList] PreparedStatement : [select M.*            from TM_MAU M            LEFT JOIN TM_MAU_DONVITINH DVT on M.DONVITINH_ID=DVT.DONVITINH_ID            where            M.TAMNGUNG = '0'            and M.BENHVIEN_ID = 'HLU01'            order by M.TENMAU]
2019-11-12 14:32:50,677 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM071']
2019-11-12 14:32:50,707 [5] DEBUG - Statement Id: [DAO00322_GetListMauTonKhoForCreateCached] PreparedStatement : [SELECT DISTINCT        TK.MAU_KEY, TK.KHOMAU_ID, M.MAU_ID, M.MAMAU, M.TENMAU, M.NHOM_ABO, M.NHOM_RH, M.LOAIMAU_ID,        TK.SOLONHAP_ID, SLN.SOLONHAP, SLN.SOKIEMSOAT, TK.NGUONHANG_ID, NG.TENNGUONMAU, M.BENHVIEN_ID, M.DONVITINH_ID,        SUM(tk.SOLUONG) AS SOLUONG,K.TENKHO,DVT.TENDONVITINH        FROM TT_MAU_TONKHO TK        JOIN TM_KHO K ON TK.KHOMAU_ID = K.KHO_ID        JOIN TT_MAU_CHUNGTU_SOLONHAP SLN ON TK.SOLONHAP_ID = SLN.SOLONHAP_ID        JOIN TM_MAU M on TK.MAU_ID = M.MAU_ID and M.TAMNGUNG = '0'        LEFT JOIN TM_MAU_DONVITINH DVT on M.DONVITINH_ID=DVT.DONVITINH_ID        LEFT JOIN TM_NGUONMAU NG ON NG.NGUONMAU_ID = TK.NGUONHANG_ID        WHERE TK.SOLUONG > 0        GROUP BY TK.MAU_KEY, TK.KHOMAU_ID, M.MAU_ID, M.MAMAU, M.TENMAU, M.NHOM_ABO, M.NHOM_RH, M.LOAIMAU_ID,        TK.SOLONHAP_ID, SLN.SOLONHAP, SLN.SOKIEMSOAT,TK.NGUONHANG_ID, NG.TENNGUONMAU, M.BENHVIEN_ID, M.DONVITINH_ID,K.TENKHO,DVT.TENDONVITINH]
2019-11-12 14:32:50,775 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM073']
2019-11-12 14:32:50,806 [5] DEBUG - Statement Id: [DAO00322_GetListMauTonKhoTruBooking] PreparedStatement : [select distinct        TK.MAU_KEY, TK.KHOMAU_ID, M.MAU_ID, M.MAMAU, M.TENMAU, M.NHOM_ABO, M.NHOM_RH, M.LOAIMAU_ID, M.DONVITINH_ID,        TK.SOLONHAP_ID, TK.SOLONHAP, TK.SOKIEMSOAT,M.PHAMVI, TK.NGUONHANG_ID, NG.TENNGUONMAU, M.BENHVIEN_ID,        TK.SOLUONG,TK.TENKHO,DVT.TENDONVITINH        from TM_MAU M        JOIN        (        select        A.MAU_KEY, A.KHOMAU_ID, A.MAU_ID ,a.NGUONHANG_ID, A.SOLONHAP_ID, A.SOLONHAP, A.SOKIEMSOAT, A.SOLUONG,A.TENKHO        from        (        select KHOMAU_ID, TK.MAU_ID, TK.NGUONHANG_ID, TK.MAU_KEY, SLN.SOLONHAP_ID, SLN.SOLONHAP, SLN.SOKIEMSOAT, ISNULL(TK.SOLUONG,0) - ISNULL(book.SOLUONG,0) as SOLUONG,K.TENKHO        from TT_MAU_TONKHO TK        JOIN TM_KHO K ON TK.KHOMAU_ID = K.KHO_ID        inner join TT_MAU_CHUNGTU_SOLONHAP SLN ON TK.SOLONHAP_ID = SLN.SOLONHAP_ID        left join dbo.TT_MAU_TONKHO_BOOK book ON book.MAU_KEY = TK.MAU_KEY AND book.TRANGTHAI = 'HIEULUC'        where ISNULL(TK.SOLUONG,0) - ISNULL(book.SOLUONG,0) > 0        ) A        )TK on TK.MAU_ID = M.MAU_ID and M.TAMNGUNG = '0'        LEFT JOIN TM_MAU_DONVITINH DVT on M.DONVITINH_ID=DVT.DONVITINH_ID        LEFT JOIN TM_NGUONMAU NG ON NG.NGUONMAU_ID = TK.NGUONHANG_ID]
2019-11-12 14:32:50,878 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM072']
2019-11-12 14:32:51,813 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'MAIN'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2019-11-12 14:32:52,576 [1] DEBUG - Statement Id: [DAO00002_FormList] PreparedStatement : [select              TM_SYS_FORM.HOSPITAL_ID,              TM_SYS_FORM.NAME,              TM_SYS_FORM.CLASS,              TM_SYS_FORM.ASSEMBLY,              TM_SYS_FORM.TITLE_VI as TITLE              from TM_SYS_FORM              where HOSPITAL_ID = 'HLU01']
2019-11-12 14:32:57,719 [1] DEBUG - Statement Id: [DAO00300_GetShortcutListByUserID] PreparedStatement : [SELECT S.SHORTCUT_CODE, S.SHORTCUT_VALUE              FROM TM_SHORTCUT AS S              WHERE S.BENHVIEN_ID = 'HLU01' AND S.USER_ID = '1' AND TAMNGUNG = '0']
2019-11-12 14:32:58,291 [1] DEBUG - Statement Id: [DAO00087_GetList] PreparedStatement : [select CODE, VALUE, BENHVIEN_ID              from TM_SYS_APPSETTINGS              where LOCKED = '0' and BENHVIEN_ID = 'HLU01'              order by SETTING_ID]
2019-11-12 14:32:58,484 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'MSG01'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2019-11-12 14:32:58,616 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'MSG02'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2019-11-12 14:32:58,894 [1] DEBUG - Statement Id: [DAO00008_GetUserSettings] PreparedStatement : [select A.*, B.TENKHO , C.TENPHONGBAN, B.MAKHO, C.MAPHONGBAN          from TM_SYS_USERS A          left join TM_KHODUOC B on B.KHODUOC_ID = A.INVENTORY_ID          left join TM_PHONGBAN C on (C.PHONGBAN_ID = A.WORKING_DEPT_ID and C.BENHVIEN_ID =  @param0 )          left join TM_SYS_USERKHO D on (D.ACCOUNT_ID = A.ACCOUNT_ID and D.HOSPITAL_ID =  @param0 )          where          A.HOSPITAL_ID =  @param0            and                 A.ACCOUNT_ID =  @param1]
2019-11-12 14:32:58,897 [1] DEBUG - Statement Id: [DAO00008_GetUserSettings] Parameters: [@param0=[HOSPITAL_ID,HLU01], @param1=[ACCOUNT_ID,113]]
2019-11-12 14:32:58,897 [1] DEBUG - Statement Id: [DAO00008_GetUserSettings] Types: [@param0=[String, System.String], @param1=[String, System.String]]
2019-11-12 14:32:58,951 [1] DEBUG - Statement Id: [DAO00008_GetUserInvSettings] PreparedStatement : [select A.*, B.TENKHO, B.MAKHO, B.LOAIKHO_ID, B.KHOQUANLY_ID          from TM_SYS_USERKHO A          left join TM_KHO B on B.MODULE_ID = A.MODULE_ID and B.KHO_ID = A.KHO_ID          where A.HOSPITAL_ID =  @param0  and A.ACCOUNT_ID =  @param1           order by B.TENKHO]
2019-11-12 14:32:58,951 [1] DEBUG - Statement Id: [DAO00008_GetUserInvSettings] Parameters: [@param0=[HOSPITAL_ID,HLU01], @param1=[ACCOUNT_ID,113]]
2019-11-12 14:32:58,951 [1] DEBUG - Statement Id: [DAO00008_GetUserInvSettings] Types: [@param0=[String, System.String], @param1=[String, System.String]]
2019-11-12 14:32:59,092 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'COM30'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2019-11-12 14:32:59,269 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'RIS04'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2019-11-12 14:33:09,238 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'MENU1'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2019-11-12 14:33:09,322 [1] DEBUG - Statement Id: [DAO00011_GetList] PreparedStatement : [select              TM_SYS_MENU.ID,              TM_SYS_MENU.PARENTID,              TM_SYS_MENU.SCREEN,              TM_SYS_MENU.SMALLIMAGE,              TM_SYS_MENU.LARGEIMAGE,              TM_SYS_MENU.DESCRIPTION,              TM_SYS_MENU.TYPE,              TM_SYS_MENU.TITLE_VI as TITLE              from TM_SYS_MENU              where TM_SYS_MENU.HOSPITAL_ID = 'HLU01' and TM_SYS_MENU.ACTIVE = '1'               AND                   (TM_SYS_MENU.TYPE & '8' = '8')                             order by TM_SYS_MENU.ORDERNUM]
2019-11-12 14:33:09,595 [1] DEBUG - Statement Id: [DAO00011_usermenu_list] PreparedStatement : [select              TM_SYS_HOMEMENU.MENUID as ID,              TM_SYS_MENU.TITLE_VI as TITLE,              TM_SYS_MENU.SCREEN,              TM_SYS_MENU.SMALLIMAGE,              TM_SYS_MENU.LARGEIMAGE,              TM_SYS_MENU.TYPE              from TM_SYS_HOMEMENU              left join TM_SYS_MENU on TM_SYS_MENU.ID = TM_SYS_HOMEMENU.MENUID and TM_SYS_MENU.HOSPITAL_ID = TM_SYS_HOMEMENU.HOSPITAL_ID              where TM_SYS_HOMEMENU.HOSPITAL_ID = 'HLU01' and TM_SYS_HOMEMENU.USERID = '113' and TM_SYS_MENU.ACTIVE = '1'               AND                   (TM_SYS_MENU.TYPE & '8' = '8')                             ORDER BY TM_SYS_HOMEMENU.ORDERNUM]
2019-11-12 14:33:14,520 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'EIN02'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2019-11-12 14:33:15,918 [1] DEBUG - Statement Id: [EIN00002_GetListHoaDonBenhVien] PreparedStatement : [select * from          (select distinct hd.HOADON_ID, hd.SOHOADON, hd.NGAYHOADON, httt.GIATRITHUCTHU, bn.TENBENHNHAN, bn.MAYTE, bn.DIACHILIENLAC DIACHI,        case when hdngt.HOADON_ID is not null then N'Ngoại trú/ nhà thuốc' else N'Nội trú' end LOAIHOADONTHU,        case when hdngt.HOADON_ID is not null then N'TT_HOADON_CHITIET_NGOAITRU' else N'TT_HOADON_CHITIET_NOITRU' end REF_TABLE,        nv.TENNHANVIEN, httt.TENHINHTHUCTHANHTOAN, 'BENHVIEN' THANHTOANTAI        from TT_HOADON hd        left join TT_HOADON_HINHTHUCTHANHTOAN httt on httt.HOADON_ID = hd.HOADON_ID        left join TT_BENHNHAN bn on bn.BENHNHAN_ID = hd.BENHNHAN_ID        left join TT_HOADON_CHITIET_NGOAITRU hdngt on hdngt.HOADON_ID = hd.HOADON_ID        left join TT_HOADON_CHITIET_NOITRU hdnt on hdnt.HOADON_ID = hd.HOADON_ID        left join TM_NHANVIEN nv on nv.NHANVIEN_ID = hd.NGUOITAO_ID        left join TT_INVOICE_HOADON vnpt on vnpt.HOADON_ID = hd.HOADON_ID        left join TT_INVOICE main on main.INVOICE_ID = vnpt.INVOICE_ID        where        (hd.TIEPNHAN_ID is not null or hd.BENHNHAN_ID is not null ) and hd.LOAIHOADON = 'BL'        and (vnpt.HOADON_ID is null)        and hd.DATHANHTOAN = '1' and hd.HUYHOADON = '0' and hd.HOANTRA = '0'                 union all        select distinct hd.HOADON_ID, hd.SOHOADON, hd.NGAYHOADON, httt.GIATRITHUCTHU, NM.TENNGUOIMUA TENBENHNHAN, ('VANGLAI' + cast(NM.NGOAITRU_TOATHUOC_NGUOIMUA_ID as varchar(10))) MAYTE, NM.DIACHI,        N'Vãng lai nhà thuốc' LOAIHOADONTHU,        N'TT_HOADON_CHITIET_NGOAITRU' REF_TABLE,        nv.TENNHANVIEN, httt.TENHINHTHUCTHANHTOAN, 'VANGLAI' THANHTOANTAI        from TT_HOADON hd        left join TT_HOADON_HINHTHUCTHANHTOAN httt on httt.HOADON_ID = hd.HOADON_ID        left join TT_HOADON_CHITIET_NGOAITRU hdngt on hdngt.HOADON_ID = hd.HOADON_ID        left join TT_DUOC_CHUNGTU_CHITIET ctct on ctct.CHUNGTUCHITIET_ID= hdngt.REF_ID        left join TT_DUOC_CHUNGTU ct on ct.CHUNGTU_ID = ctct.CHUNGTU_ID        left join TT_NGOAITRU_TOATHUOC_NGUOIMUA NM on NM.NGOAITRU_TOATHUOC_NGUOIMUA_ID = CT.NGOAITRU_TOATHUOC_NGUOIMUA_ID        left join TM_NHANVIEN nv on nv.NHANVIEN_ID = hd.NGUOITAO_ID        left join TT_INVOICE_HOADON vnpt on vnpt.HOADON_ID = hd.HOADON_ID        left join TT_INVOICE main on main.INVOICE_ID = vnpt.INVOICE_ID        where        hd.TIEPNHAN_ID is null and hd.BENHNHAN_ID is null  and hd.LOAIHOADON = 'BL'        and (vnpt.HOADON_ID is null)        and hd.DATHANHTOAN = '1' and hd.HUYHOADON = '0' and hd.HOANTRA = '0'                 ) ds        order by ds.TENBENHNHAN]
2019-11-12 14:33:39,220 [1] DEBUG - Statement Id: [EIN00002_GetListHoaDonBenhVien] PreparedStatement : [select * from          (select distinct hd.HOADON_ID, hd.SOHOADON, hd.NGAYHOADON, httt.GIATRITHUCTHU, bn.TENBENHNHAN, bn.MAYTE, bn.DIACHILIENLAC DIACHI,        case when hdngt.HOADON_ID is not null then N'Ngoại trú/ nhà thuốc' else N'Nội trú' end LOAIHOADONTHU,        case when hdngt.HOADON_ID is not null then N'TT_HOADON_CHITIET_NGOAITRU' else N'TT_HOADON_CHITIET_NOITRU' end REF_TABLE,        nv.TENNHANVIEN, httt.TENHINHTHUCTHANHTOAN, 'BENHVIEN' THANHTOANTAI        from TT_HOADON hd        left join TT_HOADON_HINHTHUCTHANHTOAN httt on httt.HOADON_ID = hd.HOADON_ID        left join TT_BENHNHAN bn on bn.BENHNHAN_ID = hd.BENHNHAN_ID        left join TT_HOADON_CHITIET_NGOAITRU hdngt on hdngt.HOADON_ID = hd.HOADON_ID        left join TT_HOADON_CHITIET_NOITRU hdnt on hdnt.HOADON_ID = hd.HOADON_ID        left join TM_NHANVIEN nv on nv.NHANVIEN_ID = hd.NGUOITAO_ID        left join TT_INVOICE_HOADON vnpt on vnpt.HOADON_ID = hd.HOADON_ID        left join TT_INVOICE main on main.INVOICE_ID = vnpt.INVOICE_ID        where        (hd.TIEPNHAN_ID is not null or hd.BENHNHAN_ID is not null ) and hd.LOAIHOADON = 'BL'        and (vnpt.HOADON_ID is null)        and hd.DATHANHTOAN = '1' and hd.HUYHOADON = '0' and hd.HOANTRA = '0'         and           convert(date, hd.NGAYHOADON) >= convert(date, '6/1/2019 12:00:00 AM')         and           convert(date, hd.NGAYHOADON) <= convert(date, '11/12/2019 12:00:00 AM')                 union all        select distinct hd.HOADON_ID, hd.SOHOADON, hd.NGAYHOADON, httt.GIATRITHUCTHU, NM.TENNGUOIMUA TENBENHNHAN, ('VANGLAI' + cast(NM.NGOAITRU_TOATHUOC_NGUOIMUA_ID as varchar(10))) MAYTE, NM.DIACHI,        N'Vãng lai nhà thuốc' LOAIHOADONTHU,        N'TT_HOADON_CHITIET_NGOAITRU' REF_TABLE,        nv.TENNHANVIEN, httt.TENHINHTHUCTHANHTOAN, 'VANGLAI' THANHTOANTAI        from TT_HOADON hd        left join TT_HOADON_HINHTHUCTHANHTOAN httt on httt.HOADON_ID = hd.HOADON_ID        left join TT_HOADON_CHITIET_NGOAITRU hdngt on hdngt.HOADON_ID = hd.HOADON_ID        left join TT_DUOC_CHUNGTU_CHITIET ctct on ctct.CHUNGTUCHITIET_ID= hdngt.REF_ID        left join TT_DUOC_CHUNGTU ct on ct.CHUNGTU_ID = ctct.CHUNGTU_ID        left join TT_NGOAITRU_TOATHUOC_NGUOIMUA NM on NM.NGOAITRU_TOATHUOC_NGUOIMUA_ID = CT.NGOAITRU_TOATHUOC_NGUOIMUA_ID        left join TM_NHANVIEN nv on nv.NHANVIEN_ID = hd.NGUOITAO_ID        left join TT_INVOICE_HOADON vnpt on vnpt.HOADON_ID = hd.HOADON_ID        left join TT_INVOICE main on main.INVOICE_ID = vnpt.INVOICE_ID        where        hd.TIEPNHAN_ID is null and hd.BENHNHAN_ID is null  and hd.LOAIHOADON = 'BL'        and (vnpt.HOADON_ID is null)        and hd.DATHANHTOAN = '1' and hd.HUYHOADON = '0' and hd.HOANTRA = '0'         and           convert(date, hd.NGAYHOADON) >= convert(date, '6/1/2019 12:00:00 AM')         and           convert(date, hd.NGAYHOADON) <= convert(date, '11/12/2019 12:00:00 AM')                 ) ds        order by ds.TENBENHNHAN]
2019-11-12 14:33:44,942 [1] DEBUG - Statement Id: [EIN00002_GetChiTietHoaDon] PreparedStatement : [select distinct hdct.*, hdct.GIATRI_BENHNHAN_DATHANHTOAN AMOUNT, hdct.SOLUONG PRODQUANTITY,        isnull(dv.TENDICHVU, dc.TENDUOCDAYDU) PRODNAME, isnull(dv.MADICHVU, dc.MADUOC) PRODCODE,        isnull(dv.DONVITINH, dc.DONVITINH) PRODUNIT, hdct.DONGIA_DOANHTHU PRODPRICE,        case when dc.DUOC_ID is not null then case when lvt.LOAIVATTU_ID = 'T' then N'Thuốc, dịch truyền' else lvt.TENLOAIVATTU end       else isnull(ndv_ct.TENNHOMDICHVU, ndv.TENNHOMDICHVU)        end as GROUPPROD_NAME,       case when dc.DUOC_ID is not null then lvt.LOAIVATTU_ID      else isnull(ndv_ct.MANHOMDICHVU, ndv.MANHOMDICHVU)        end as GROUPPROD_CODE        from TT_HOADON_CHITIET_NGOAITRU (nolock) hdct        left join TM_DICHVU (nolock) dv on dv.DICHVU_ID = hdct.DICHVU_ID and hdct.DUOC_ID is null        left join TM_DUOC (nolock) dc on dc.DUOC_ID = hdct.DUOC_ID and hdct.DICHVU_ID is null        left join TM_NHOMDICHVU (nolock) ndv on ndv.NHOMDICHVU_ID = dv.NHOMDICHVU_ID       left join TM_NHOMDICHVU (nolock) ndv_ct on ndv_ct.NHOMDICHVU_ID = ndv.CAPTREN_ID       left join TM_LOAIDUOC (nolock) ld on ld.LOAIDUOC_ID = dc.LOAIDUOC_ID       left join TM_LOAIVATTU (nolock) lvt on lvt.LOAIVATTU_ID = ld.LOAIVATTU_ID        where HOADON_ID = 41732]
2019-11-12 14:34:02,267 [1] DEBUG - Statement Id: [EIN00002_CheckHoadondaxuat] PreparedStatement : [select B.*        from TT_INVOICE A        left join TT_INVOICE_HOADON B on A.INVOICE_ID = B.INVOICE_ID        where B.HOADON_ID = 41732 and A.HUY = '0']
2019-11-12 14:34:04,036 [1] DEBUG - Statement Id: [DAO00087_GetServiceParams] PreparedStatement : [select CODE, VALUE              from TM_SYS_APPSETTINGS              where LOCKED = '0' and BENHVIEN_ID = 'HLU01']
2019-11-12 14:34:12,619 [1] DEBUG - Statement Id: [EIN00002_INVOICE_Json] PreparedStatement : [declare @json nvarchar(max);        declare @jsonHODON_ID nvarchar(max);        set @json = N'[{"HOADONCHITIET_ID":79924,"HOADON_ID":41732,"VIENPHI_ID":640013,"REF_ID":195119,"REF_TABLE":"TT_DVYEUCAU","DICHVU_ID":5686,"DUOC_ID":null,"LOAI_CHIPHI":"TT","LOAIGIA_ID":2,"SOLUONG":1,"DONGIA_DOANHTHU":33000.0,"THANHTIEN_DOANHTHU":33000.0,"BHYT_TL":0.95,"BHYT_DONGIA":33000.0,"BHYT_THANHTIEN":33000.0,"BHYT_DONGIA_CHITRA":31350.0,"BHYT_THANHTIEN_CHITRA":31350.0,"BENHNHAN_PHAITHANHTOAN":1650.0,"GIATRI_HOADON":1650.0,"GIATRI_HOADON_DATHANHTOAN":1650.0,"GIATRI_BIENLAI":1650.0,"GIATRI_BIENLAI_DATHANHTOAN":0.0,"GIATRI_BENHNHAN_DATHANHTOAN":1650.0,"TYLE_THATTHU":null,"GIATRI_THATTHU":0.0,"MIENGIAM_TL":0.0,"MIENGIAM_GIATRI":0.0,"NGANSACH_TL":0.0,"NGANSACH_GIATRI":0.0,"TAITRO_TL":0.0,"TAITRO_GIATRI":0.0,"BHTN_GIATRI":null,"NOIDUNGTHU":null,"CHUNGTUXUATBN_ID":null,"TYLEVAT":null,"GIATRIVAT":null,"MASOTHUE":null,"SOCHUNGTUKETOAN":null,"DAHOANTRA":"0","TRANGTHAI":"DATHUCHIEN","PHONGBAN_ID":null,"PHONGBAN_THAYDOI_ID":null,"CONGTYCHITRA_GIATRI":0.0,"HOIVIEN_GIATRI":0.0,"BENHVIEN_ID":"HLU01","NGAYTAO":"2019-06-01T10:10:23.383","NGUOITAO_ID":687,"NGAYCAPNHAT":"2019-06-01T10:10:23.383","NGUOICAPNHAT_ID":687,"AMOUNT":1650.0,"PRODQUANTITY":1,"PRODNAME":"Khám Nội tổng hợp (D223)","PRODCODE":"5601","PRODUNIT":"Lần","PRODPRICE":33000.0,"GROUPPROD_NAME":"Khám bệnh","GROUPPROD_CODE":"04"},{"HOADONCHITIET_ID":79925,"HOADON_ID":41732,"VIENPHI_ID":640290,"REF_ID":195190,"REF_TABLE":"TT_DVYEUCAU","DICHVU_ID":4641,"DUOC_ID":null,"LOAI_CHIPHI":"TT","LOAIGIA_ID":2,"SOLUONG":1,"DONGIA_DOANHTHU":21400.0,"THANHTIEN_DOANHTHU":21400.0,"BHYT_TL":0.95,"BHYT_DONGIA":21400.0,"BHYT_THANHTIEN":21400.0,"BHYT_DONGIA_CHITRA":20330.0,"BHYT_THANHTIEN_CHITRA":20330.0,"BENHNHAN_PHAITHANHTOAN":1070.0,"GIATRI_HOADON":1070.0,"GIATRI_HOADON_DATHANHTOAN":1070.0,"GIATRI_BIENLAI":1070.0,"GIATRI_BIENLAI_DATHANHTOAN":0.0,"GIATRI_BENHNHAN_DATHANHTOAN":1070.0,"TYLE_THATTHU":null,"GIATRI_THATTHU":0.0,"MIENGIAM_TL":0.0,"MIENGIAM_GIATRI":0.0,"NGANSACH_TL":0.0,"NGANSACH_GIATRI":0.0,"TAITRO_TL":0.0,"TAITRO_GIATRI":0.0,"BHTN_GIATRI":null,"NOIDUNGTHU":null,"CHUNGTUXUATBN_ID":null,"TYLEVAT":null,"GIATRIVAT":null,"MASOTHUE":null,"SOCHUNGTUKETOAN":null,"DAHOANTRA":"0","TRANGTHAI":"DATHUCHIEN","PHONGBAN_ID":null,"PHONGBAN_THAYDOI_ID":null,"CONGTYCHITRA_GIATRI":0.0,"HOIVIEN_GIATRI":0.0,"BENHVIEN_ID":"HLU01","NGAYTAO":"2019-06-01T10:10:23.383","NGUOITAO_ID":687,"NGAYCAPNHAT":"2019-06-01T10:10:23.383","NGUOICAPNHAT_ID":687,"AMOUNT":1070.0,"PRODQUANTITY":1,"PRODNAME":"Đo hoạt độ ALT (GPT) [Máu]","PRODCODE":"4641","PRODUNIT":"U/L","PRODPRICE":21400.0,"GROUPPROD_NAME":"Xét nghiệm","GROUPPROD_CODE":"01"},{"HOADONCHITIET_ID":79926,"HOADON_ID":41732,"VIENPHI_ID":640291,"REF_ID":195191,"REF_TABLE":"TT_DVYEUCAU","DICHVU_ID":4642,"DUOC_ID":null,"LOAI_CHIPHI":"TT","LOAIGIA_ID":2,"SOLUONG":1,"DONGIA_DOANHTHU":21400.0,"THANHTIEN_DOANHTHU":21400.0,"BHYT_TL":0.95,"BHYT_DONGIA":21400.0,"BHYT_THANHTIEN":21400.0,"BHYT_DONGIA_CHITRA":20330.0,"BHYT_THANHTIEN_CHITRA":20330.0,"BENHNHAN_PHAITHANHTOAN":1070.0,"GIATRI_HOADON":1070.0,"GIATRI_HOADON_DATHANHTOAN":1070.0,"GIATRI_BIENLAI":1070.0,"GIATRI_BIENLAI_DATHANHTOAN":0.0,"GIATRI_BENHNHAN_DATHANHTOAN":1070.0,"TYLE_THATTHU":null,"GIATRI_THATTHU":0.0,"MIENGIAM_TL":0.0,"MIENGIAM_GIATRI":0.0,"NGANSACH_TL":0.0,"NGANSACH_GIATRI":0.0,"TAITRO_TL":0.0,"TAITRO_GIATRI":0.0,"BHTN_GIATRI":null,"NOIDUNGTHU":null,"CHUNGTUXUATBN_ID":null,"TYLEVAT":null,"GIATRIVAT":null,"MASOTHUE":null,"SOCHUNGTUKETOAN":null,"DAHOANTRA":"0","TRANGTHAI":"DATHUCHIEN","PHONGBAN_ID":null,"PHONGBAN_THAYDOI_ID":null,"CONGTYCHITRA_GIATRI":0.0,"HOIVIEN_GIATRI":0.0,"BENHVIEN_ID":"HLU01","NGAYTAO":"2019-06-01T10:10:23.383","NGUOITAO_ID":687,"NGAYCAPNHAT":"2019-06-01T10:10:23.383","NGUOICAPNHAT_ID":687,"AMOUNT":1070.0,"PRODQUANTITY":1,"PRODNAME":"Đo hoạt độ AST (GOT) [Máu]","PRODCODE":"4642","PRODUNIT":"U/L","PRODPRICE":21400.0,"GROUPPROD_NAME":"Xét nghiệm","GROUPPROD_CODE":"01"},{"HOADONCHITIET_ID":79927,"HOADON_ID":41732,"VIENPHI_ID":640292,"REF_ID":195192,"REF_TABLE":"TT_DVYEUCAU","DICHVU_ID":4668,"DUOC_ID":null,"LOAI_CHIPHI":"TT","LOAIGIA_ID":2,"SOLUONG":1,"DONGIA_DOANHTHU":21400.0,"THANHTIEN_DOANHTHU":21400.0,"BHYT_TL":0.95,"BHYT_DONGIA":21400.0,"BHYT_THANHTIEN":21400.0,"BHYT_DONGIA_CHITRA":20330.0,"BHYT_THANHTIEN_CHITRA":20330.0,"BENHNHAN_PHAITHANHTOAN":1070.0,"GIATRI_HOADON":1070.0,"GIATRI_HOADON_DATHANHTOAN":1070.0,"GIATRI_BIENLAI":1070.0,"GIATRI_BIENLAI_DATHANHTOAN":0.0,"GIATRI_BENHNHAN_DATHANHTOAN":1070.0,"TYLE_THATTHU":null,"GIATRI_THATTHU":0.0,"MIENGIAM_TL":0.0,"MIENGIAM_GIATRI":0.0,"NGANSACH_TL":0.0,"NGANSACH_GIATRI":0.0,"TAITRO_TL":0.0,"TAITRO_GIATRI":0.0,"BHTN_GIATRI":null,"NOIDUNGTHU":null,"CHUNGTUXUATBN_ID":null,"TYLEVAT":null,"GIATRIVAT":null,"MASOTHUE":null,"SOCHUNGTUKETOAN":null,"DAHOANTRA":"0","TRANGTHAI":"DATHUCHIEN","PHONGBAN_ID":null,"PHONGBAN_THAYDOI_ID":null,"CONGTYCHITRA_GIATRI":0.0,"HOIVIEN_GIATRI":0.0,"BENHVIEN_ID":"HLU01","NGAYTAO":"2019-06-01T10:10:23.383","NGUOITAO_ID":687,"NGAYCAPNHAT":"2019-06-01T10:10:23.383","NGUOICAPNHAT_ID":687,"AMOUNT":1070.0,"PRODQUANTITY":1,"PRODNAME":"Định lượng Creatinin (máu)","PRODCODE":"4668","PRODUNIT":"µmol/L","PRODPRICE":21400.0,"GROUPPROD_NAME":"Xét nghiệm","GROUPPROD_CODE":"01"},{"HOADONCHITIET_ID":79928,"HOADON_ID":41732,"VIENPHI_ID":640293,"REF_ID":195193,"REF_TABLE":"TT_DVYEUCAU","DICHVU_ID":4681,"DUOC_ID":null,"LOAI_CHIPHI":"TT","LOAIGIA_ID":2,"SOLUONG":1,"DONGIA_DOANHTHU":21400.0,"THANHTIEN_DOANHTHU":21400.0,"BHYT_TL":0.95,"BHYT_DONGIA":21400.0,"BHYT_THANHTIEN":21400.0,"BHYT_DONGIA_CHITRA":20330.0,"BHYT_THANHTIEN_CHITRA":20330.0,"BENHNHAN_PHAITHANHTOAN":1070.0,"GIATRI_HOADON":1070.0,"GIATRI_HOADON_DATHANHTOAN":1070.0,"GIATRI_BIENLAI":1070.0,"GIATRI_BIENLAI_DATHANHTOAN":0.0,"GIATRI_BENHNHAN_DATHANHTOAN":1070.0,"TYLE_THATTHU":null,"GIATRI_THATTHU":0.0,"MIENGIAM_TL":0.0,"MIENGIAM_GIATRI":0.0,"NGANSACH_TL":0.0,"NGANSACH_GIATRI":0.0,"TAITRO_TL":0.0,"TAITRO_GIATRI":0.0,"BHTN_GIATRI":null,"NOIDUNGTHU":null,"CHUNGTUXUATBN_ID":null,"TYLEVAT":null,"GIATRIVAT":null,"MASOTHUE":null,"SOCHUNGTUKETOAN":null,"DAHOANTRA":"0","TRANGTHAI":"DATHUCHIEN","PHONGBAN_ID":null,"PHONGBAN_THAYDOI_ID":null,"CONGTYCHITRA_GIATRI":0.0,"HOIVIEN_GIATRI":0.0,"BENHVIEN_ID":"HLU01","NGAYTAO":"2019-06-01T10:10:23.383","NGUOITAO_ID":687,"NGAYCAPNHAT":"2019-06-01T10:10:23.383","NGUOICAPNHAT_ID":687,"AMOUNT":1070.0,"PRODQUANTITY":1,"PRODNAME":"Định lượng Glucose [Máu]","PRODCODE":"4681","PRODUNIT":"mmol/L","PRODPRICE":21400.0,"GROUPPROD_NAME":"Xét nghiệm","GROUPPROD_CODE":"01"},{"HOADONCHITIET_ID":79929,"HOADON_ID":41732,"VIENPHI_ID":640294,"REF_ID":195194,"REF_TABLE":"TT_DVYEUCAU","DICHVU_ID":4722,"DUOC_ID":null,"LOAI_CHIPHI":"TT","LOAIGIA_ID":2,"SOLUONG":1,"DONGIA_DOANHTHU":21400.0,"THANHTIEN_DOANHTHU":21400.0,"BHYT_TL":0.95,"BHYT_DONGIA":21400.0,"BHYT_THANHTIEN":21400.0,"BHYT_DONGIA_CHITRA":20330.0,"BHYT_THANHTIEN_CHITRA":20330.0,"BENHNHAN_PHAITHANHTOAN":1070.0,"GIATRI_HOADON":1070.0,"GIATRI_HOADON_DATHANHTOAN":1070.0,"GIATRI_BIENLAI":1070.0,"GIATRI_BIENLAI_DATHANHTOAN":0.0,"GIATRI_BENHNHAN_DATHANHTOAN":1070.0,"TYLE_THATTHU":null,"GIATRI_THATTHU":0.0,"MIENGIAM_TL":0.0,"MIENGIAM_GIATRI":0.0,"NGANSACH_TL":0.0,"NGANSACH_GIATRI":0.0,"TAITRO_TL":0.0,"TAITRO_GIATRI":0.0,"BHTN_GIATRI":null,"NOIDUNGTHU":null,"CHUNGTUXUATBN_ID":null,"TYLEVAT":null,"GIATRIVAT":null,"MASOTHUE":null,"SOCHUNGTUKETOAN":null,"DAHOANTRA":"0","TRANGTHAI":"DATHUCHIEN","PHONGBAN_ID":null,"PHONGBAN_THAYDOI_ID":null,"CONGTYCHITRA_GIATRI":0.0,"HOIVIEN_GIATRI":0.0,"BENHVIEN_ID":"HLU01","NGAYTAO":"2019-06-01T10:10:23.4","NGUOITAO_ID":687,"NGAYCAPNHAT":"2019-06-01T10:10:23.4","NGUOICAPNHAT_ID":687,"AMOUNT":1070.0,"PRODQUANTITY":1,"PRODNAME":"Định lượng Urê máu [Máu]","PRODCODE":"4722","PRODUNIT":"mmol/L","PRODPRICE":21400.0,"GROUPPROD_NAME":"Xét nghiệm","GROUPPROD_CODE":"01"},{"HOADONCHITIET_ID":79930,"HOADON_ID":41732,"VIENPHI_ID":640295,"REF_ID":195195,"REF_TABLE":"TT_DVYEUCAU","DICHVU_ID":4017,"DUOC_ID":null,"LOAI_CHIPHI":"TT","LOAIGIA_ID":2,"SOLUONG":1,"DONGIA_DOANHTHU":42100.0,"THANHTIEN_DOANHTHU":42100.0,"BHYT_TL":0.95,"BHYT_DONGIA":42100.0,"BHYT_THANHTIEN":42100.0,"BHYT_DONGIA_CHITRA":39995.0,"BHYT_THANHTIEN_CHITRA":39995.0,"BENHNHAN_PHAITHANHTOAN":2105.0,"GIATRI_HOADON":2105.0,"GIATRI_HOADON_DATHANHTOAN":2105.0,"GIATRI_BIENLAI":2105.0,"GIATRI_BIENLAI_DATHANHTOAN":0.0,"GIATRI_BENHNHAN_DATHANHTOAN":2105.0,"TYLE_THATTHU":null,"GIATRI_THATTHU":0.0,"MIENGIAM_TL":0.0,"MIENGIAM_GIATRI":0.0,"NGANSACH_TL":0.0,"NGANSACH_GIATRI":0.0,"TAITRO_TL":0.0,"TAITRO_GIATRI":0.0,"BHTN_GIATRI":null,"NOIDUNGTHU":null,"CHUNGTUXUATBN_ID":null,"TYLEVAT":null,"GIATRIVAT":null,"MASOTHUE":null,"SOCHUNGTUKETOAN":null,"DAHOANTRA":"0","TRANGTHAI":"DATHUCHIEN","PHONGBAN_ID":null,"PHONGBAN_THAYDOI_ID":null,"CONGTYCHITRA_GIATRI":0.0,"HOIVIEN_GIATRI":0.0,"BENHVIEN_ID":"HLU01","NGAYTAO":"2019-06-01T10:10:23.4","NGUOITAO_ID":687,"NGAYCAPNHAT":"2019-06-01T10:10:23.4","NGUOICAPNHAT_ID":687,"AMOUNT":2105.0,"PRODQUANTITY":1,"PRODNAME":"Siêu âm ổ bụng (gan mật, tụy, lách, thận, bàng quang)","PRODCODE":"4017","PRODUNIT":"Lần","PRODPRICE":42100.0,"GROUPPROD_NAME":"Chẩn đoán hình ảnh","GROUPPROD_CODE":"02"},{"HOADONCHITIET_ID":79931,"HOADON_ID":41732,"VIENPHI_ID":644611,"REF_ID":31579,"REF_TABLE":"TT_NGOAITRU_TOATHUOC","DICHVU_ID":null,"DUOC_ID":809,"LOAI_CHIPHI":"TT","LOAIGIA_ID":null,"SOLUONG":60,"DONGIA_DOANHTHU":1690.0,"THANHTIEN_DOANHTHU":101400.0,"BHYT_TL":0.95,"BHYT_DONGIA":1690.0,"BHYT_THANHTIEN":101400.0,"BHYT_DONGIA_CHITRA":1605.5,"BHYT_THANHTIEN_CHITRA":96330.0,"BENHNHAN_PHAITHANHTOAN":5070.0,"GIATRI_HOADON":5070.0,"GIATRI_HOADON_DATHANHTOAN":5070.0,"GIATRI_BIENLAI":5070.0,"GIATRI_BIENLAI_DATHANHTOAN":null,"GIATRI_BENHNHAN_DATHANHTOAN":5070.0,"TYLE_THATTHU":null,"GIATRI_THATTHU":null,"MIENGIAM_TL":null,"MIENGIAM_GIATRI":0.0,"NGANSACH_TL":null,"NGANSACH_GIATRI":null,"TAITRO_TL":null,"TAITRO_GIATRI":null,"BHTN_GIATRI":null,"NOIDUNGTHU":null,"CHUNGTUXUATBN_ID":null,"TYLEVAT":null,"GIATRIVAT":null,"MASOTHUE":null,"SOCHUNGTUKETOAN":null,"DAHOANTRA":"0","TRANGTHAI":"DATHUCHIEN","PHONGBAN_ID":null,"PHONGBAN_THAYDOI_ID":null,"CONGTYCHITRA_GIATRI":0.0,"HOIVIEN_GIATRI":0.0,"BENHVIEN_ID":"HLU01","NGAYTAO":"2019-06-01T10:10:23.4","NGUOITAO_ID":687,"NGAYCAPNHAT":"2019-06-01T10:10:23.4","NGUOICAPNHAT_ID":687,"AMOUNT":5070.0,"PRODQUANTITY":60,"PRODNAME":"Acetyl leucin (Ad- Liver) 100mg, 50mg, 50mg","PRODCODE":"A412","PRODUNIT":"Viên","PRODPRICE":1690.0,"GROUPPROD_NAME":"Thuốc, dịch truyền","GROUPPROD_CODE":"T"}]';        set @jsonHODON_ID = N'[{"HOADON_ID":41732}]';          declare @INVOICE_ID int;        INSERT INTO TT_INVOICE        (KEYINVOICE ,BUYER, [ADDRESS], CUSCODE ,CUSNAME ,PAYMENTMETHOD ,NGAYPHATSINH ,SOHOADON ,GIATRITHUCTHU ,SOTIENBANGCHU        , HUY, NGUOITAO_ID, NGAYTAO, BENHVIEN_ID)        VALUES        ( @param0 ,  @param1 ,  @param2 ,  @param3 ,  @param4 ,  @param5 , CONVERT(DATETIME,  @param6 , 103),  @param7 ,  @param8 ,  @param9         ,'0', '1', Getdate(), 'HLU01')        set @INVOICE_ID = SCOPE_IDENTITY()          insert into TT_INVOICE_HOADON        SELECT @INVOICE_ID, jsonHD.HOADON_ID, 'HLU01'        FROM OPENJSON(@jsonHODON_ID)        WITH ( HOADON_ID int) jsonHD          insert into TT_INVOICE_DETAIL        SELECT @INVOICE_ID, json.HOADON_ID, json.PRODNAME, json.PRODQUANTITY, json.PRODUNIT, json.AMOUNT, '1', getdate() , 'HLU01'        FROM OPENJSON(@json)        WITH ( HOADON_ID int, PRODNAME nvarchar(300), PRODQUANTITY float, PRODUNIT nvarchar(100), AMOUNT float) json]
2019-11-12 14:34:12,619 [1] DEBUG - Statement Id: [EIN00002_INVOICE_Json] Parameters: [@param0=[KEYINVOICE,20191112143404_190042196], @param1=[BUYER,], @param2=[ADDRESS,Phường Hàm Rồng, Thành phố Thanh Hóa, Tỉnh Thanh Hóa], @param3=[CUSCODE,190042196], @param4=[CUSNAME,Bùi Thị Duyên], @param5=[PAYMENTMETHOD,Tiền mặt], @param6=[NGAYPHATSINH,12/11/2019], @param7=[SOHOADON,null], @param8=[GIATRITHUCTHU,14175], @param9=[SOTIENBANGCHU,Mười bốn nghìn một trăm bảy mươi lăm đồng chẵn.]]
2019-11-12 14:34:12,619 [1] DEBUG - Statement Id: [EIN00002_INVOICE_Json] Types: [@param0=[String, System.String], @param1=[String, System.String], @param2=[String, System.String], @param3=[String, System.String], @param4=[String, System.String], @param5=[String, System.String], @param6=[String, System.String], @param7=[System.DBNull, null], @param8=[Double, System.Double], @param9=[String, System.String]]
2019-11-12 14:34:17,507 [1] DEBUG - Statement Id: [EIN00002_GetHoaDonDaXuatLenCong] PreparedStatement : [select * from TT_INVOICE hd        where         HUY = '0'         and           convert(date, hd.NGAYPHATSINH) >= convert(date, '6/1/2019 12:00:00 AM')       and         convert(date, hd.NGAYPHATSINH) <= convert(date, '11/12/2019 12:00:00 AM')]
2019-11-12 14:34:24,873 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'EIN03'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2019-11-12 14:34:26,360 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = 'HLU01'               AND                   TM_SYS_SCREEN.PAGE = 'COM98'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2019-11-12 14:41:46,049 [1] DEBUG - Statement Id: [EIN00002_GetListHoaDonBenhVien] PreparedStatement : [select * from          (select distinct hd.HOADON_ID, hd.SOHOADON, hd.NGAYHOADON, httt.GIATRITHUCTHU, bn.TENBENHNHAN, bn.MAYTE, bn.DIACHILIENLAC DIACHI,        case when hdngt.HOADON_ID is not null then N'Ngoại trú/ nhà thuốc' else N'Nội trú' end LOAIHOADONTHU,        case when hdngt.HOADON_ID is not null then N'TT_HOADON_CHITIET_NGOAITRU' else N'TT_HOADON_CHITIET_NOITRU' end REF_TABLE,        nv.TENNHANVIEN, httt.TENHINHTHUCTHANHTOAN, 'BENHVIEN' THANHTOANTAI        from TT_HOADON hd        left join TT_HOADON_HINHTHUCTHANHTOAN httt on httt.HOADON_ID = hd.HOADON_ID        left join TT_BENHNHAN bn on bn.BENHNHAN_ID = hd.BENHNHAN_ID        left join TT_HOADON_CHITIET_NGOAITRU hdngt on hdngt.HOADON_ID = hd.HOADON_ID        left join TT_HOADON_CHITIET_NOITRU hdnt on hdnt.HOADON_ID = hd.HOADON_ID        left join TM_NHANVIEN nv on nv.NHANVIEN_ID = hd.NGUOITAO_ID        left join TT_INVOICE_HOADON vnpt on vnpt.HOADON_ID = hd.HOADON_ID        left join TT_INVOICE main on main.INVOICE_ID = vnpt.INVOICE_ID        where        (hd.TIEPNHAN_ID is not null or hd.BENHNHAN_ID is not null ) and hd.LOAIHOADON = 'BL'        and (vnpt.HOADON_ID is null)        and hd.DATHANHTOAN = '1' and hd.HUYHOADON = '0' and hd.HOANTRA = '0'         and           convert(date, hd.NGAYHOADON) >= convert(date, '6/1/2019 12:00:00 AM')         and           convert(date, hd.NGAYHOADON) <= convert(date, '11/12/2019 12:00:00 AM')                 union all        select distinct hd.HOADON_ID, hd.SOHOADON, hd.NGAYHOADON, httt.GIATRITHUCTHU, NM.TENNGUOIMUA TENBENHNHAN, ('VANGLAI' + cast(NM.NGOAITRU_TOATHUOC_NGUOIMUA_ID as varchar(10))) MAYTE, NM.DIACHI,        N'Vãng lai nhà thuốc' LOAIHOADONTHU,        N'TT_HOADON_CHITIET_NGOAITRU' REF_TABLE,        nv.TENNHANVIEN, httt.TENHINHTHUCTHANHTOAN, 'VANGLAI' THANHTOANTAI        from TT_HOADON hd        left join TT_HOADON_HINHTHUCTHANHTOAN httt on httt.HOADON_ID = hd.HOADON_ID        left join TT_HOADON_CHITIET_NGOAITRU hdngt on hdngt.HOADON_ID = hd.HOADON_ID        left join TT_DUOC_CHUNGTU_CHITIET ctct on ctct.CHUNGTUCHITIET_ID= hdngt.REF_ID        left join TT_DUOC_CHUNGTU ct on ct.CHUNGTU_ID = ctct.CHUNGTU_ID        left join TT_NGOAITRU_TOATHUOC_NGUOIMUA NM on NM.NGOAITRU_TOATHUOC_NGUOIMUA_ID = CT.NGOAITRU_TOATHUOC_NGUOIMUA_ID        left join TM_NHANVIEN nv on nv.NHANVIEN_ID = hd.NGUOITAO_ID        left join TT_INVOICE_HOADON vnpt on vnpt.HOADON_ID = hd.HOADON_ID        left join TT_INVOICE main on main.INVOICE_ID = vnpt.INVOICE_ID        where        hd.TIEPNHAN_ID is null and hd.BENHNHAN_ID is null  and hd.LOAIHOADON = 'BL'        and (vnpt.HOADON_ID is null)        and hd.DATHANHTOAN = '1' and hd.HUYHOADON = '0' and hd.HOANTRA = '0'         and           convert(date, hd.NGAYHOADON) >= convert(date, '6/1/2019 12:00:00 AM')         and           convert(date, hd.NGAYHOADON) <= convert(date, '11/12/2019 12:00:00 AM')                 ) ds        order by ds.TENBENHNHAN]
2019-11-12 14:41:56,053 [1] DEBUG - Statement Id: [EIN00002_GetListHoaDonBenhVien] PreparedStatement : [select * from          (select distinct hd.HOADON_ID, hd.SOHOADON, hd.NGAYHOADON, httt.GIATRITHUCTHU, bn.TENBENHNHAN, bn.MAYTE, bn.DIACHILIENLAC DIACHI,        case when hdngt.HOADON_ID is not null then N'Ngoại trú/ nhà thuốc' else N'Nội trú' end LOAIHOADONTHU,        case when hdngt.HOADON_ID is not null then N'TT_HOADON_CHITIET_NGOAITRU' else N'TT_HOADON_CHITIET_NOITRU' end REF_TABLE,        nv.TENNHANVIEN, httt.TENHINHTHUCTHANHTOAN, 'BENHVIEN' THANHTOANTAI        from TT_HOADON hd        left join TT_HOADON_HINHTHUCTHANHTOAN httt on httt.HOADON_ID = hd.HOADON_ID        left join TT_BENHNHAN bn on bn.BENHNHAN_ID = hd.BENHNHAN_ID        left join TT_HOADON_CHITIET_NGOAITRU hdngt on hdngt.HOADON_ID = hd.HOADON_ID        left join TT_HOADON_CHITIET_NOITRU hdnt on hdnt.HOADON_ID = hd.HOADON_ID        left join TM_NHANVIEN nv on nv.NHANVIEN_ID = hd.NGUOITAO_ID        left join TT_INVOICE_HOADON vnpt on vnpt.HOADON_ID = hd.HOADON_ID        left join TT_INVOICE main on main.INVOICE_ID = vnpt.INVOICE_ID        where        (hd.TIEPNHAN_ID is not null or hd.BENHNHAN_ID is not null ) and hd.LOAIHOADON = 'BL'        and (vnpt.HOADON_ID is null)        and hd.DATHANHTOAN = '1' and hd.HUYHOADON = '0' and hd.HOANTRA = '0'         and           convert(date, hd.NGAYHOADON) >= convert(date, '6/1/2019 12:00:00 AM')         and           convert(date, hd.NGAYHOADON) <= convert(date, '11/12/2019 12:00:00 AM')                 union all        select distinct hd.HOADON_ID, hd.SOHOADON, hd.NGAYHOADON, httt.GIATRITHUCTHU, NM.TENNGUOIMUA TENBENHNHAN, ('VANGLAI' + cast(NM.NGOAITRU_TOATHUOC_NGUOIMUA_ID as varchar(10))) MAYTE, NM.DIACHI,        N'Vãng lai nhà thuốc' LOAIHOADONTHU,        N'TT_HOADON_CHITIET_NGOAITRU' REF_TABLE,        nv.TENNHANVIEN, httt.TENHINHTHUCTHANHTOAN, 'VANGLAI' THANHTOANTAI        from TT_HOADON hd        left join TT_HOADON_HINHTHUCTHANHTOAN httt on httt.HOADON_ID = hd.HOADON_ID        left join TT_HOADON_CHITIET_NGOAITRU hdngt on hdngt.HOADON_ID = hd.HOADON_ID        left join TT_DUOC_CHUNGTU_CHITIET ctct on ctct.CHUNGTUCHITIET_ID= hdngt.REF_ID        left join TT_DUOC_CHUNGTU ct on ct.CHUNGTU_ID = ctct.CHUNGTU_ID        left join TT_NGOAITRU_TOATHUOC_NGUOIMUA NM on NM.NGOAITRU_TOATHUOC_NGUOIMUA_ID = CT.NGOAITRU_TOATHUOC_NGUOIMUA_ID        left join TM_NHANVIEN nv on nv.NHANVIEN_ID = hd.NGUOITAO_ID        left join TT_INVOICE_HOADON vnpt on vnpt.HOADON_ID = hd.HOADON_ID        left join TT_INVOICE main on main.INVOICE_ID = vnpt.INVOICE_ID        where        hd.TIEPNHAN_ID is null and hd.BENHNHAN_ID is null  and hd.LOAIHOADON = 'BL'        and (vnpt.HOADON_ID is null)        and hd.DATHANHTOAN = '1' and hd.HUYHOADON = '0' and hd.HOANTRA = '0'         and           convert(date, hd.NGAYHOADON) >= convert(date, '6/1/2019 12:00:00 AM')         and           convert(date, hd.NGAYHOADON) <= convert(date, '11/12/2019 12:00:00 AM')                 ) ds        order by ds.TENBENHNHAN]
2019-11-12 14:46:26,875 [1] DEBUG - Statement Id: [EIN00002_GetChiTietHoaDon] PreparedStatement : [select distinct hdct.*, hdct.GIATRI_BENHNHAN_DATHANHTOAN AMOUNT, hdct.SOLUONG PRODQUANTITY,        isnull(dv.TENDICHVU, dc.TENDUOCDAYDU) PRODNAME, isnull(dv.MADICHVU, dc.MADUOC) PRODCODE,        isnull(dv.DONVITINH, dc.DONVITINH) PRODUNIT, hdct.DONGIA_DOANHTHU PRODPRICE,        case when dc.DUOC_ID is not null then case when lvt.LOAIVATTU_ID = 'T' then N'Thuốc, dịch truyền' else lvt.TENLOAIVATTU end       else isnull(ndv_ct.TENNHOMDICHVU, ndv.TENNHOMDICHVU)        end as GROUPPROD_NAME,       case when dc.DUOC_ID is not null then lvt.LOAIVATTU_ID      else isnull(ndv_ct.MANHOMDICHVU, ndv.MANHOMDICHVU)        end as GROUPPROD_CODE        from TT_HOADON_CHITIET_NOITRU (nolock) hdct        left join TM_DICHVU (nolock) dv on dv.DICHVU_ID = hdct.DICHVU_ID and hdct.DUOC_ID is null        left join TM_DUOC (nolock) dc on dc.DUOC_ID = hdct.DUOC_ID and hdct.DICHVU_ID is null        left join TM_NHOMDICHVU (nolock) ndv on ndv.NHOMDICHVU_ID = dv.NHOMDICHVU_ID       left join TM_NHOMDICHVU (nolock) ndv_ct on ndv_ct.NHOMDICHVU_ID = ndv.CAPTREN_ID       left join TM_LOAIDUOC (nolock) ld on ld.LOAIDUOC_ID = dc.LOAIDUOC_ID       left join TM_LOAIVATTU (nolock) lvt on lvt.LOAIVATTU_ID = ld.LOAIVATTU_ID        where HOADON_ID = 43387]
2019-11-12 14:46:38,557 [1] DEBUG - Statement Id: [EIN00002_GetChiTietHoaDon] PreparedStatement : [select distinct hdct.*, hdct.GIATRI_BENHNHAN_DATHANHTOAN AMOUNT, hdct.SOLUONG PRODQUANTITY,        isnull(dv.TENDICHVU, dc.TENDUOCDAYDU) PRODNAME, isnull(dv.MADICHVU, dc.MADUOC) PRODCODE,        isnull(dv.DONVITINH, dc.DONVITINH) PRODUNIT, hdct.DONGIA_DOANHTHU PRODPRICE,        case when dc.DUOC_ID is not null then case when lvt.LOAIVATTU_ID = 'T' then N'Thuốc, dịch truyền' else lvt.TENLOAIVATTU end       else isnull(ndv_ct.TENNHOMDICHVU, ndv.TENNHOMDICHVU)        end as GROUPPROD_NAME,       case when dc.DUOC_ID is not null then lvt.LOAIVATTU_ID      else isnull(ndv_ct.MANHOMDICHVU, ndv.MANHOMDICHVU)        end as GROUPPROD_CODE        from TT_HOADON_CHITIET_NGOAITRU (nolock) hdct        left join TM_DICHVU (nolock) dv on dv.DICHVU_ID = hdct.DICHVU_ID and hdct.DUOC_ID is null        left join TM_DUOC (nolock) dc on dc.DUOC_ID = hdct.DUOC_ID and hdct.DICHVU_ID is null        left join TM_NHOMDICHVU (nolock) ndv on ndv.NHOMDICHVU_ID = dv.NHOMDICHVU_ID       left join TM_NHOMDICHVU (nolock) ndv_ct on ndv_ct.NHOMDICHVU_ID = ndv.CAPTREN_ID       left join TM_LOAIDUOC (nolock) ld on ld.LOAIDUOC_ID = dc.LOAIDUOC_ID       left join TM_LOAIVATTU (nolock) lvt on lvt.LOAIVATTU_ID = ld.LOAIVATTU_ID        where HOADON_ID = 43117]
2019-11-12 14:46:39,943 [1] DEBUG - Statement Id: [EIN00002_GetChiTietHoaDon] PreparedStatement : [select distinct hdct.*, hdct.GIATRI_BENHNHAN_DATHANHTOAN AMOUNT, hdct.SOLUONG PRODQUANTITY,        isnull(dv.TENDICHVU, dc.TENDUOCDAYDU) PRODNAME, isnull(dv.MADICHVU, dc.MADUOC) PRODCODE,        isnull(dv.DONVITINH, dc.DONVITINH) PRODUNIT, hdct.DONGIA_DOANHTHU PRODPRICE,        case when dc.DUOC_ID is not null then case when lvt.LOAIVATTU_ID = 'T' then N'Thuốc, dịch truyền' else lvt.TENLOAIVATTU end       else isnull(ndv_ct.TENNHOMDICHVU, ndv.TENNHOMDICHVU)        end as GROUPPROD_NAME,       case when dc.DUOC_ID is not null then lvt.LOAIVATTU_ID      else isnull(ndv_ct.MANHOMDICHVU, ndv.MANHOMDICHVU)        end as GROUPPROD_CODE        from TT_HOADON_CHITIET_NOITRU (nolock) hdct        left join TM_DICHVU (nolock) dv on dv.DICHVU_ID = hdct.DICHVU_ID and hdct.DUOC_ID is null        left join TM_DUOC (nolock) dc on dc.DUOC_ID = hdct.DUOC_ID and hdct.DICHVU_ID is null        left join TM_NHOMDICHVU (nolock) ndv on ndv.NHOMDICHVU_ID = dv.NHOMDICHVU_ID       left join TM_NHOMDICHVU (nolock) ndv_ct on ndv_ct.NHOMDICHVU_ID = ndv.CAPTREN_ID       left join TM_LOAIDUOC (nolock) ld on ld.LOAIDUOC_ID = dc.LOAIDUOC_ID       left join TM_LOAIVATTU (nolock) lvt on lvt.LOAIVATTU_ID = ld.LOAIVATTU_ID        where HOADON_ID = 43387]
2019-11-12 14:46:41,109 [1] DEBUG - Statement Id: [EIN00002_GetChiTietHoaDon] PreparedStatement : [select distinct hdct.*, hdct.GIATRI_BENHNHAN_DATHANHTOAN AMOUNT, hdct.SOLUONG PRODQUANTITY,        isnull(dv.TENDICHVU, dc.TENDUOCDAYDU) PRODNAME, isnull(dv.MADICHVU, dc.MADUOC) PRODCODE,        isnull(dv.DONVITINH, dc.DONVITINH) PRODUNIT, hdct.DONGIA_DOANHTHU PRODPRICE,        case when dc.DUOC_ID is not null then case when lvt.LOAIVATTU_ID = 'T' then N'Thuốc, dịch truyền' else lvt.TENLOAIVATTU end       else isnull(ndv_ct.TENNHOMDICHVU, ndv.TENNHOMDICHVU)        end as GROUPPROD_NAME,       case when dc.DUOC_ID is not null then lvt.LOAIVATTU_ID      else isnull(ndv_ct.MANHOMDICHVU, ndv.MANHOMDICHVU)        end as GROUPPROD_CODE        from TT_HOADON_CHITIET_NGOAITRU (nolock) hdct        left join TM_DICHVU (nolock) dv on dv.DICHVU_ID = hdct.DICHVU_ID and hdct.DUOC_ID is null        left join TM_DUOC (nolock) dc on dc.DUOC_ID = hdct.DUOC_ID and hdct.DICHVU_ID is null        left join TM_NHOMDICHVU (nolock) ndv on ndv.NHOMDICHVU_ID = dv.NHOMDICHVU_ID       left join TM_NHOMDICHVU (nolock) ndv_ct on ndv_ct.NHOMDICHVU_ID = ndv.CAPTREN_ID       left join TM_LOAIDUOC (nolock) ld on ld.LOAIDUOC_ID = dc.LOAIDUOC_ID       left join TM_LOAIVATTU (nolock) lvt on lvt.LOAIVATTU_ID = ld.LOAIVATTU_ID        where HOADON_ID = 43117]
2019-11-12 14:46:51,104 [1] DEBUG - Statement Id: [EIN00002_CheckHoadondaxuat] PreparedStatement : [select B.*        from TT_INVOICE A        left join TT_INVOICE_HOADON B on A.INVOICE_ID = B.INVOICE_ID        where B.HOADON_ID = 43117 and A.HUY = '0']
2019-11-12 14:47:01,867 [1] DEBUG - Statement Id: [EIN00002_INVOICE_Json] PreparedStatement : [declare @json nvarchar(max);        declare @jsonHODON_ID nvarchar(max);        set @json = N'[{"HOADONCHITIET_ID":83438,"HOADON_ID":43117,"VIENPHI_ID":661350,"REF_ID":201361,"REF_TABLE":"TT_DVYEUCAU","DICHVU_ID":5439,"DUOC_ID":null,"LOAI_CHIPHI":"TT","LOAIGIA_ID":2,"SOLUONG":1,"DONGIA_DOANHTHU":33000.0,"THANHTIEN_DOANHTHU":33000.0,"BHYT_TL":0.8,"BHYT_DONGIA":33000.0,"BHYT_THANHTIEN":33000.0,"BHYT_DONGIA_CHITRA":26400.0,"BHYT_THANHTIEN_CHITRA":26400.0,"BENHNHAN_PHAITHANHTOAN":6600.0,"GIATRI_HOADON":6600.0,"GIATRI_HOADON_DATHANHTOAN":6600.0,"GIATRI_BIENLAI":6600.0,"GIATRI_BIENLAI_DATHANHTOAN":0.0,"GIATRI_BENHNHAN_DATHANHTOAN":6600.0,"TYLE_THATTHU":null,"GIATRI_THATTHU":0.0,"MIENGIAM_TL":0.0,"MIENGIAM_GIATRI":0.0,"NGANSACH_TL":0.0,"NGANSACH_GIATRI":0.0,"TAITRO_TL":0.0,"TAITRO_GIATRI":0.0,"BHTN_GIATRI":null,"NOIDUNGTHU":null,"CHUNGTUXUATBN_ID":null,"TYLEVAT":null,"GIATRIVAT":null,"MASOTHUE":null,"SOCHUNGTUKETOAN":null,"DAHOANTRA":"0","TRANGTHAI":"DATHUCHIEN","PHONGBAN_ID":null,"PHONGBAN_THAYDOI_ID":null,"CONGTYCHITRA_GIATRI":0.0,"HOIVIEN_GIATRI":0.0,"BENHVIEN_ID":"HLU01","NGAYTAO":"2019-06-03T10:42:22.243","NGUOITAO_ID":708,"NGAYCAPNHAT":"2019-06-03T10:42:22.243","NGUOICAPNHAT_ID":708,"AMOUNT":6600.0,"PRODQUANTITY":1,"PRODNAME":"Khám Nội tiết (225)","PRODCODE":"5439","PRODUNIT":"Lần","PRODPRICE":33000.0,"GROUPPROD_NAME":"Khám bệnh","GROUPPROD_CODE":"04"},{"HOADONCHITIET_ID":83439,"HOADON_ID":43117,"VIENPHI_ID":661490,"REF_ID":201404,"REF_TABLE":"TT_DVYEUCAU","DICHVU_ID":4681,"DUOC_ID":null,"LOAI_CHIPHI":"TT","LOAIGIA_ID":2,"SOLUONG":1,"DONGIA_DOANHTHU":21400.0,"THANHTIEN_DOANHTHU":21400.0,"BHYT_TL":0.8,"BHYT_DONGIA":21400.0,"BHYT_THANHTIEN":21400.0,"BHYT_DONGIA_CHITRA":17120.0,"BHYT_THANHTIEN_CHITRA":17120.0,"BENHNHAN_PHAITHANHTOAN":4280.0,"GIATRI_HOADON":4280.0,"GIATRI_HOADON_DATHANHTOAN":4280.0,"GIATRI_BIENLAI":4280.0,"GIATRI_BIENLAI_DATHANHTOAN":0.0,"GIATRI_BENHNHAN_DATHANHTOAN":4280.0,"TYLE_THATTHU":null,"GIATRI_THATTHU":0.0,"MIENGIAM_TL":0.0,"MIENGIAM_GIATRI":0.0,"NGANSACH_TL":0.0,"NGANSACH_GIATRI":0.0,"TAITRO_TL":0.0,"TAITRO_GIATRI":0.0,"BHTN_GIATRI":null,"NOIDUNGTHU":null,"CHUNGTUXUATBN_ID":null,"TYLEVAT":null,"GIATRIVAT":null,"MASOTHUE":null,"SOCHUNGTUKETOAN":null,"DAHOANTRA":"0","TRANGTHAI":"DATHUCHIEN","PHONGBAN_ID":null,"PHONGBAN_THAYDOI_ID":null,"CONGTYCHITRA_GIATRI":0.0,"HOIVIEN_GIATRI":0.0,"BENHVIEN_ID":"HLU01","NGAYTAO":"2019-06-03T10:42:22.243","NGUOITAO_ID":708,"NGAYCAPNHAT":"2019-06-03T10:42:22.243","NGUOICAPNHAT_ID":708,"AMOUNT":4280.0,"PRODQUANTITY":1,"PRODNAME":"Định lượng Glucose [Máu]","PRODCODE":"4681","PRODUNIT":"mmol/L","PRODPRICE":21400.0,"GROUPPROD_NAME":"Xét nghiệm","GROUPPROD_CODE":"01"},{"HOADONCHITIET_ID":83440,"HOADON_ID":43117,"VIENPHI_ID":661491,"REF_ID":201405,"REF_TABLE":"TT_DVYEUCAU","DICHVU_ID":4660,"DUOC_ID":null,"LOAI_CHIPHI":"TT","LOAIGIA_ID":2,"SOLUONG":1,"DONGIA_DOANHTHU":26800.0,"THANHTIEN_DOANHTHU":26800.0,"BHYT_TL":0.8,"BHYT_DONGIA":26800.0,"BHYT_THANHTIEN":26800.0,"BHYT_DONGIA_CHITRA":21440.0,"BHYT_THANHTIEN_CHITRA":21440.0,"BENHNHAN_PHAITHANHTOAN":5360.0,"GIATRI_HOADON":5360.0,"GIATRI_HOADON_DATHANHTOAN":5360.0,"GIATRI_BIENLAI":5360.0,"GIATRI_BIENLAI_DATHANHTOAN":0.0,"GIATRI_BENHNHAN_DATHANHTOAN":5360.0,"TYLE_THATTHU":null,"GIATRI_THATTHU":0.0,"MIENGIAM_TL":0.0,"MIENGIAM_GIATRI":0.0,"NGANSACH_TL":0.0,"NGANSACH_GIATRI":0.0,"TAITRO_TL":0.0,"TAITRO_GIATRI":0.0,"BHTN_GIATRI":null,"NOIDUNGTHU":null,"CHUNGTUXUATBN_ID":null,"TYLEVAT":null,"GIATRIVAT":null,"MASOTHUE":null,"SOCHUNGTUKETOAN":null,"DAHOANTRA":"0","TRANGTHAI":"DATHUCHIEN","PHONGBAN_ID":null,"PHONGBAN_THAYDOI_ID":null,"CONGTYCHITRA_GIATRI":0.0,"HOIVIEN_GIATRI":0.0,"BENHVIEN_ID":"HLU01","NGAYTAO":"2019-06-03T10:42:22.243","NGUOITAO_ID":708,"NGAYCAPNHAT":"2019-06-03T10:42:22.243","NGUOICAPNHAT_ID":708,"AMOUNT":5360.0,"PRODQUANTITY":1,"PRODNAME":"Định lượng Cholesterol toàn phần (máu)","PRODCODE":"4660","PRODUNIT":"mmol/l","PRODPRICE":26800.0,"GROUPPROD_NAME":"Xét nghiệm","GROUPPROD_CODE":"01"},{"HOADONCHITIET_ID":83441,"HOADON_ID":43117,"VIENPHI_ID":661492,"REF_ID":201406,"REF_TABLE":"TT_DVYEUCAU","DICHVU_ID":4717,"DUOC_ID":null,"LOAI_CHIPHI":"TT","LOAIGIA_ID":2,"SOLUONG":1,"DONGIA_DOANHTHU":26800.0,"THANHTIEN_DOANHTHU":26800.0,"BHYT_TL":0.8,"BHYT_DONGIA":26800.0,"BHYT_THANHTIEN":26800.0,"BHYT_DONGIA_CHITRA":21440.0,"BHYT_THANHTIEN_CHITRA":21440.0,"BENHNHAN_PHAITHANHTOAN":5360.0,"GIATRI_HOADON":5360.0,"GIATRI_HOADON_DATHANHTOAN":5360.0,"GIATRI_BIENLAI":5360.0,"GIATRI_BIENLAI_DATHANHTOAN":0.0,"GIATRI_BENHNHAN_DATHANHTOAN":5360.0,"TYLE_THATTHU":null,"GIATRI_THATTHU":0.0,"MIENGIAM_TL":0.0,"MIENGIAM_GIATRI":0.0,"NGANSACH_TL":0.0,"NGANSACH_GIATRI":0.0,"TAITRO_TL":0.0,"TAITRO_GIATRI":0.0,"BHTN_GIATRI":null,"NOIDUNGTHU":null,"CHUNGTUXUATBN_ID":null,"TYLEVAT":null,"GIATRIVAT":null,"MASOTHUE":null,"SOCHUNGTUKETOAN":null,"DAHOANTRA":"0","TRANGTHAI":"DATHUCHIEN","PHONGBAN_ID":null,"PHONGBAN_THAYDOI_ID":null,"CONGTYCHITRA_GIATRI":0.0,"HOIVIEN_GIATRI":0.0,"BENHVIEN_ID":"HLU01","NGAYTAO":"2019-06-03T10:42:22.243","NGUOITAO_ID":708,"NGAYCAPNHAT":"2019-06-03T10:42:22.243","NGUOICAPNHAT_ID":708,"AMOUNT":5360.0,"PRODQUANTITY":1,"PRODNAME":"Định lượng Triglycerid (máu) [Máu]","PRODCODE":"4717","PRODUNIT":"mmol/L","PRODPRICE":26800.0,"GROUPPROD_NAME":"Xét nghiệm","GROUPPROD_CODE":"01"},{"HOADONCHITIET_ID":83442,"HOADON_ID":43117,"VIENPHI_ID":661493,"REF_ID":201407,"REF_TABLE":"TT_DVYEUCAU","DICHVU_ID":4641,"DUOC_ID":null,"LOAI_CHIPHI":"TT","LOAIGIA_ID":2,"SOLUONG":1,"DONGIA_DOANHTHU":21400.0,"THANHTIEN_DOANHTHU":21400.0,"BHYT_TL":0.8,"BHYT_DONGIA":21400.0,"BHYT_THANHTIEN":21400.0,"BHYT_DONGIA_CHITRA":17120.0,"BHYT_THANHTIEN_CHITRA":17120.0,"BENHNHAN_PHAITHANHTOAN":4280.0,"GIATRI_HOADON":4280.0,"GIATRI_HOADON_DATHANHTOAN":4280.0,"GIATRI_BIENLAI":4280.0,"GIATRI_BIENLAI_DATHANHTOAN":0.0,"GIATRI_BENHNHAN_DATHANHTOAN":4280.0,"TYLE_THATTHU":null,"GIATRI_THATTHU":0.0,"MIENGIAM_TL":0.0,"MIENGIAM_GIATRI":0.0,"NGANSACH_TL":0.0,"NGANSACH_GIATRI":0.0,"TAITRO_TL":0.0,"TAITRO_GIATRI":0.0,"BHTN_GIATRI":null,"NOIDUNGTHU":null,"CHUNGTUXUATBN_ID":null,"TYLEVAT":null,"GIATRIVAT":null,"MASOTHUE":null,"SOCHUNGTUKETOAN":null,"DAHOANTRA":"0","TRANGTHAI":"DATHUCHIEN","PHONGBAN_ID":null,"PHONGBAN_THAYDOI_ID":null,"CONGTYCHITRA_GIATRI":0.0,"HOIVIEN_GIATRI":0.0,"BENHVIEN_ID":"HLU01","NGAYTAO":"2019-06-03T10:42:22.243","NGUOITAO_ID":708,"NGAYCAPNHAT":"2019-06-03T10:42:22.243","NGUOICAPNHAT_ID":708,"AMOUNT":4280.0,"PRODQUANTITY":1,"PRODNAME":"Đo hoạt độ ALT (GPT) [Máu]","PRODCODE":"4641","PRODUNIT":"U/L","PRODPRICE":21400.0,"GROUPPROD_NAME":"Xét nghiệm","GROUPPROD_CODE":"01"},{"HOADONCHITIET_ID":83443,"HOADON_ID":43117,"VIENPHI_ID":661494,"REF_ID":201408,"REF_TABLE":"TT_DVYEUCAU","DICHVU_ID":4642,"DUOC_ID":null,"LOAI_CHIPHI":"TT","LOAIGIA_ID":2,"SOLUONG":1,"DONGIA_DOANHTHU":21400.0,"THANHTIEN_DOANHTHU":21400.0,"BHYT_TL":0.8,"BHYT_DONGIA":21400.0,"BHYT_THANHTIEN":21400.0,"BHYT_DONGIA_CHITRA":17120.0,"BHYT_THANHTIEN_CHITRA":17120.0,"BENHNHAN_PHAITHANHTOAN":4280.0,"GIATRI_HOADON":4280.0,"GIATRI_HOADON_DATHANHTOAN":4280.0,"GIATRI_BIENLAI":4280.0,"GIATRI_BIENLAI_DATHANHTOAN":0.0,"GIATRI_BENHNHAN_DATHANHTOAN":4280.0,"TYLE_THATTHU":null,"GIATRI_THATTHU":0.0,"MIENGIAM_TL":0.0,"MIENGIAM_GIATRI":0.0,"NGANSACH_TL":0.0,"NGANSACH_GIATRI":0.0,"TAITRO_TL":0.0,"TAITRO_GIATRI":0.0,"BHTN_GIATRI":null,"NOIDUNGTHU":null,"CHUNGTUXUATBN_ID":null,"TYLEVAT":null,"GIATRIVAT":null,"MASOTHUE":null,"SOCHUNGTUKETOAN":null,"DAHOANTRA":"0","TRANGTHAI":"DATHUCHIEN","PHONGBAN_ID":null,"PHONGBAN_THAYDOI_ID":null,"CONGTYCHITRA_GIATRI":0.0,"HOIVIEN_GIATRI":0.0,"BENHVIEN_ID":"HLU01","NGAYTAO":"2019-06-03T10:42:22.243","NGUOITAO_ID":708,"NGAYCAPNHAT":"2019-06-03T10:42:22.243","NGUOICAPNHAT_ID":708,"AMOUNT":4280.0,"PRODQUANTITY":1,"PRODNAME":"Đo hoạt độ AST (GOT) [Máu]","PRODCODE":"4642","PRODUNIT":"U/L","PRODPRICE":21400.0,"GROUPPROD_NAME":"Xét nghiệm","GROUPPROD_CODE":"01"},{"HOADONCHITIET_ID":83444,"HOADON_ID":43117,"VIENPHI_ID":664520,"REF_ID":33051,"REF_TABLE":"TT_NGOAITRU_TOATHUOC","DICHVU_ID":null,"DUOC_ID":1153,"LOAI_CHIPHI":"TT","LOAIGIA_ID":null,"SOLUONG":90,"DONGIA_DOANHTHU":2765.0,"THANHTIEN_DOANHTHU":248850.0,"BHYT_TL":0.8,"BHYT_DONGIA":2765.0,"BHYT_THANHTIEN":248850.0,"BHYT_DONGIA_CHITRA":2212.0,"BHYT_THANHTIEN_CHITRA":199080.0,"BENHNHAN_PHAITHANHTOAN":49770.0,"GIATRI_HOADON":49770.0,"GIATRI_HOADON_DATHANHTOAN":49770.0,"GIATRI_BIENLAI":49770.0,"GIATRI_BIENLAI_DATHANHTOAN":null,"GIATRI_BENHNHAN_DATHANHTOAN":49770.0,"TYLE_THATTHU":null,"GIATRI_THATTHU":null,"MIENGIAM_TL":null,"MIENGIAM_GIATRI":0.0,"NGANSACH_TL":null,"NGANSACH_GIATRI":null,"TAITRO_TL":null,"TAITRO_GIATRI":null,"BHTN_GIATRI":null,"NOIDUNGTHU":null,"CHUNGTUXUATBN_ID":null,"TYLEVAT":null,"GIATRIVAT":null,"MASOTHUE":null,"SOCHUNGTUKETOAN":null,"DAHOANTRA":"0","TRANGTHAI":"DATHUCHIEN","PHONGBAN_ID":null,"PHONGBAN_THAYDOI_ID":null,"CONGTYCHITRA_GIATRI":0.0,"HOIVIEN_GIATRI":0.0,"BENHVIEN_ID":"HLU01","NGAYTAO":"2019-06-03T10:42:22.243","NGUOITAO_ID":708,"NGAYCAPNHAT":"2019-06-03T10:42:22.243","NGUOICAPNHAT_ID":708,"AMOUNT":49770.0,"PRODQUANTITY":90,"PRODNAME":"Gliclazide (Diamicron MR 30mg) 30mg","PRODCODE":"D08","PRODUNIT":"Viên","PRODPRICE":2765.0,"GROUPPROD_NAME":"Thuốc, dịch truyền","GROUPPROD_CODE":"T"},{"HOADONCHITIET_ID":83445,"HOADON_ID":43117,"VIENPHI_ID":664521,"REF_ID":33052,"REF_TABLE":"TT_NGOAITRU_TOATHUOC","DICHVU_ID":null,"DUOC_ID":927,"LOAI_CHIPHI":"TT","LOAIGIA_ID":null,"SOLUONG":60,"DONGIA_DOANHTHU":2000.0,"THANHTIEN_DOANHTHU":120000.0,"BHYT_TL":0.8,"BHYT_DONGIA":2000.0,"BHYT_THANHTIEN":120000.0,"BHYT_DONGIA_CHITRA":1600.0,"BHYT_THANHTIEN_CHITRA":96000.0,"BENHNHAN_PHAITHANHTOAN":24000.0,"GIATRI_HOADON":24000.0,"GIATRI_HOADON_DATHANHTOAN":24000.0,"GIATRI_BIENLAI":24000.0,"GIATRI_BIENLAI_DATHANHTOAN":null,"GIATRI_BENHNHAN_DATHANHTOAN":24000.0,"TYLE_THATTHU":null,"GIATRI_THATTHU":null,"MIENGIAM_TL":null,"MIENGIAM_GIATRI":0.0,"NGANSACH_TL":null,"NGANSACH_GIATRI":null,"TAITRO_TL":null,"TAITRO_GIATRI":null,"BHTN_GIATRI":null,"NOIDUNGTHU":null,"CHUNGTUXUATBN_ID":null,"TYLEVAT":null,"GIATRIVAT":null,"MASOTHUE":null,"SOCHUNGTUKETOAN":null,"DAHOANTRA":"0","TRANGTHAI":"DATHUCHIEN","PHONGBAN_ID":null,"PHONGBAN_THAYDOI_ID":null,"CONGTYCHITRA_GIATRI":0.0,"HOIVIEN_GIATRI":0.0,"BENHVIEN_ID":"HLU01","NGAYTAO":"2019-06-03T10:42:22.247","NGUOITAO_ID":708,"NGAYCAPNHAT":"2019-06-03T10:42:22.247","NGUOICAPNHAT_ID":708,"AMOUNT":24000.0,"PRODQUANTITY":60,"PRODNAME":"Metformin( Metformin Stada 1000mg MR) 1000mg","PRODCODE":"M427","PRODUNIT":"Viên","PRODPRICE":2000.0,"GROUPPROD_NAME":"Thuốc, dịch truyền","GROUPPROD_CODE":"T"}]';        set @jsonHODON_ID = N'[{"HOADON_ID":43117}]';          declare @INVOICE_ID int;        INSERT INTO TT_INVOICE        (KEYINVOICE ,BUYER, [ADDRESS], CUSCODE ,CUSNAME ,PAYMENTMETHOD ,NGAYPHATSINH ,SOHOADON ,GIATRITHUCTHU ,SOTIENBANGCHU        , HUY, NGUOITAO_ID, NGAYTAO, BENHVIEN_ID)        VALUES        ( @param0 ,  @param1 ,  @param2 ,  @param3 ,  @param4 ,  @param5 , CONVERT(DATETIME,  @param6 , 103),  @param7 ,  @param8 ,  @param9         ,'0', '1', Getdate(), 'HLU01')        set @INVOICE_ID = SCOPE_IDENTITY()          insert into TT_INVOICE_HOADON        SELECT @INVOICE_ID, jsonHD.HOADON_ID, 'HLU01'        FROM OPENJSON(@jsonHODON_ID)        WITH ( HOADON_ID int) jsonHD          insert into TT_INVOICE_DETAIL        SELECT @INVOICE_ID, json.HOADON_ID, json.PRODNAME, json.PRODQUANTITY, json.PRODUNIT, json.AMOUNT, '1', getdate() , 'HLU01'        FROM OPENJSON(@json)        WITH ( HOADON_ID int, PRODNAME nvarchar(300), PRODQUANTITY float, PRODUNIT nvarchar(100), AMOUNT float) json]
2019-11-12 14:47:01,868 [1] DEBUG - Statement Id: [EIN00002_INVOICE_Json] Parameters: [@param0=[KEYINVOICE,20191112144653_190033152], @param1=[BUYER,], @param2=[ADDRESS,Xã Quảng Phong, Huyện Quảng Xương, Tỉnh Thanh Hóa], @param3=[CUSCODE,190033152], @param4=[CUSNAME,Bùi Thanh Minh], @param5=[PAYMENTMETHOD,Tiền mặt], @param6=[NGAYPHATSINH,12/11/2019], @param7=[SOHOADON,null], @param8=[GIATRITHUCTHU,103930], @param9=[SOTIENBANGCHU,Một trăm lẻ ba nghìn chín trăm ba mươi đồng chẵn.]]
2019-11-12 14:47:01,868 [1] DEBUG - Statement Id: [EIN00002_INVOICE_Json] Types: [@param0=[String, System.String], @param1=[String, System.String], @param2=[String, System.String], @param3=[String, System.String], @param4=[String, System.String], @param5=[String, System.String], @param6=[String, System.String], @param7=[System.DBNull, null], @param8=[Double, System.Double], @param9=[String, System.String]]
2019-11-12 14:47:04,514 [1] DEBUG - Statement Id: [EIN00002_GetHoaDonDaXuatLenCong] PreparedStatement : [select * from TT_INVOICE hd        where         HUY = '0'         and           convert(date, hd.NGAYPHATSINH) >= convert(date, '6/1/2019 12:00:00 AM')       and         convert(date, hd.NGAYPHATSINH) <= convert(date, '11/12/2019 12:00:00 AM')]
