--------------------------------------------------------------------------------
2020-07-16 14:06:24,262 [1] DEBUG - Statement Id: [DAO00001_DBList] PreparedStatement : [select *              from TM_SYS_SERVER              where HOSPITAL_ID = '_SYSTEM_' and TYPE = 'D']
2020-07-16 14:06:24,706 [1] DEBUG - Statement Id: [DAO00001_DaoList] PreparedStatement : [select              TM_SYS_SERVICEMAP.ID,              TM_SYS_SERVICEMAP.HOSPITAL_ID,              TM_SYS_SERVICEMAP.DB_NAME,              TM_SYS_SERVICEMAP.TYPE,              TM_SYS_SERVICEMAP.NAME,              TM_SYS_SERVICEMAP.CLASS,              (TM_SYS_DIC.VALUE + '.' + TM_SYS_SERVICEMAP.CLASS) as CLASSFULL,              TM_SYS_SERVICEMAP.ASSEMBLY              from TM_SYS_SERVICEMAP              inner join TM_SYS_DIC              on TM_SYS_SERVICEMAP.NAMESPACE = TM_SYS_DIC.ID              where HOSPITAL_ID = '_SYSTEM_' AND TYPE = 'D' AND ACTIVE = '1'              order by DB_NAME]
2020-07-16 14:06:24,738 [1] DEBUG - Statement Id: [DAO00001_ServiceList] PreparedStatement : [select              TM_SYS_SERVICEMAP.ID,              TM_SYS_SERVICEMAP.HOSPITAL_ID,              TM_SYS_SERVICEMAP.DB_NAME,              TM_SYS_SERVICEMAP.TYPE,              TM_SYS_SERVICEMAP.NAME,              TM_SYS_SERVICEMAP.CLASS,              (TM_SYS_DIC.VALUE + '.' + TM_SYS_SERVICEMAP.CLASS) as CLASSFULL,              TM_SYS_SERVICEMAP.ASSEMBLY,              TM_SYS_SERVER.URL              from TM_SYS_SERVICEMAP              inner join TM_SYS_DIC on TM_SYS_SERVICEMAP.NAMESPACE = TM_SYS_DIC.ID              inner join TM_SYS_SERVER on (TM_SYS_SERVICEMAP.DB_NAME = TM_SYS_SERVER.NAME) and (TM_SYS_SERVER.HOSPITAL_ID = '_SYSTEM_')              where TM_SYS_SERVICEMAP.HOSPITAL_ID = '_SYSTEM_' AND TM_SYS_SERVICEMAP.TYPE = 'S'  AND ACTIVE = '1'              order by URL]
2020-07-16 14:06:25,671 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = '_SYSTEM_'               AND                   TM_SYS_SCREEN.PAGE = 'LOGIN'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2020-07-16 14:06:30,084 [1] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = '_SYSTEM_'               AND                   TM_SYS_CACHE.ACTIVE = '1']
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
2020-07-16 15:10:58,807 [1] DEBUG - Statement Id: [DAO00001_DBList] PreparedStatement : [select *              from TM_SYS_SERVER              where HOSPITAL_ID = '_SYSTEM_' and TYPE = 'D']
2020-07-16 15:10:59,396 [1] DEBUG - Statement Id: [DAO00001_DaoList] PreparedStatement : [select              TM_SYS_SERVICEMAP.ID,              TM_SYS_SERVICEMAP.HOSPITAL_ID,              TM_SYS_SERVICEMAP.DB_NAME,              TM_SYS_SERVICEMAP.TYPE,              TM_SYS_SERVICEMAP.NAME,              TM_SYS_SERVICEMAP.CLASS,              (TM_SYS_DIC.VALUE + '.' + TM_SYS_SERVICEMAP.CLASS) as CLASSFULL,              TM_SYS_SERVICEMAP.ASSEMBLY              from TM_SYS_SERVICEMAP              inner join TM_SYS_DIC              on TM_SYS_SERVICEMAP.NAMESPACE = TM_SYS_DIC.ID              where HOSPITAL_ID = '_SYSTEM_' AND TYPE = 'D' AND ACTIVE = '1'              order by DB_NAME]
2020-07-16 15:10:59,432 [1] DEBUG - Statement Id: [DAO00001_ServiceList] PreparedStatement : [select              TM_SYS_SERVICEMAP.ID,              TM_SYS_SERVICEMAP.HOSPITAL_ID,              TM_SYS_SERVICEMAP.DB_NAME,              TM_SYS_SERVICEMAP.TYPE,              TM_SYS_SERVICEMAP.NAME,              TM_SYS_SERVICEMAP.CLASS,              (TM_SYS_DIC.VALUE + '.' + TM_SYS_SERVICEMAP.CLASS) as CLASSFULL,              TM_SYS_SERVICEMAP.ASSEMBLY,              TM_SYS_SERVER.URL              from TM_SYS_SERVICEMAP              inner join TM_SYS_DIC on TM_SYS_SERVICEMAP.NAMESPACE = TM_SYS_DIC.ID              inner join TM_SYS_SERVER on (TM_SYS_SERVICEMAP.DB_NAME = TM_SYS_SERVER.NAME) and (TM_SYS_SERVER.HOSPITAL_ID = '_SYSTEM_')              where TM_SYS_SERVICEMAP.HOSPITAL_ID = '_SYSTEM_' AND TM_SYS_SERVICEMAP.TYPE = 'S'  AND ACTIVE = '1'              order by URL]
2020-07-16 15:10:59,871 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = '_SYSTEM_'               AND                   TM_SYS_SCREEN.PAGE = 'LOGIN'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2020-07-16 15:11:00,568 [1] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = '_SYSTEM_'               AND                   TM_SYS_CACHE.ACTIVE = '1']
2020-07-16 15:11:10,238 [1] DEBUG - Statement Id: [DAO00001_DBList] PreparedStatement : [select *              from TM_SYS_SERVER              where HOSPITAL_ID = '01819' and TYPE = 'D']
2020-07-16 15:11:10,297 [1] DEBUG - Statement Id: [DAO00001_DaoList] PreparedStatement : [select              TM_SYS_SERVICEMAP.ID,              TM_SYS_SERVICEMAP.HOSPITAL_ID,              TM_SYS_SERVICEMAP.DB_NAME,              TM_SYS_SERVICEMAP.TYPE,              TM_SYS_SERVICEMAP.NAME,              TM_SYS_SERVICEMAP.CLASS,              (TM_SYS_DIC.VALUE + '.' + TM_SYS_SERVICEMAP.CLASS) as CLASSFULL,              TM_SYS_SERVICEMAP.ASSEMBLY              from TM_SYS_SERVICEMAP              inner join TM_SYS_DIC              on TM_SYS_SERVICEMAP.NAMESPACE = TM_SYS_DIC.ID              where HOSPITAL_ID = '01819' AND TYPE = 'D' AND ACTIVE = '1'              order by DB_NAME]
2020-07-16 15:11:13,551 [1] DEBUG - Statement Id: [DAO00001_ServiceList] PreparedStatement : [select              TM_SYS_SERVICEMAP.ID,              TM_SYS_SERVICEMAP.HOSPITAL_ID,              TM_SYS_SERVICEMAP.DB_NAME,              TM_SYS_SERVICEMAP.TYPE,              TM_SYS_SERVICEMAP.NAME,              TM_SYS_SERVICEMAP.CLASS,              (TM_SYS_DIC.VALUE + '.' + TM_SYS_SERVICEMAP.CLASS) as CLASSFULL,              TM_SYS_SERVICEMAP.ASSEMBLY,              TM_SYS_SERVER.URL              from TM_SYS_SERVICEMAP              inner join TM_SYS_DIC on TM_SYS_SERVICEMAP.NAMESPACE = TM_SYS_DIC.ID              inner join TM_SYS_SERVER on (TM_SYS_SERVICEMAP.DB_NAME = TM_SYS_SERVER.NAME) and (TM_SYS_SERVER.HOSPITAL_ID = '01819')              where TM_SYS_SERVICEMAP.HOSPITAL_ID = '01819' AND TM_SYS_SERVICEMAP.TYPE = 'S'  AND ACTIVE = '1'              order by URL]
2020-07-16 15:11:13,736 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = '01819'               AND                   TM_SYS_CACHE.ACTIVE = '1']
2020-07-16 15:11:14,035 [5] DEBUG - Statement Id: [DAO00004_GetList] PreparedStatement : [declare @BOOTS varchar(15)              select @BOOTS = VALUE from TM_SYS_APPSETTINGS BOOST where CODE = 'APP_LOCATION_DVHC'  and BENHVIEN_ID = '01819'              select              TINH.TENDONVI AS TINH              , TINH.TENTAT AS TENTATTINH              , HUYEN.TENDONVI AS HUYEN              , HUYEN.TENTAT AS TENTATHUYEN              , XA.TENDONVI AS XA              , XA.MADONVI              , (XA.TENDONVI + ' ' + HUYEN.TENDONVI + ' ' + TINH.TENDONVI) AS TENTIMKIEM              , (XA.TENDAYDU + ', ' + HUYEN.TENDAYDU + ', ' + TINH.TENDAYDU) AS TENDAYDU,              XA.TENTAT AS TENTATXA,              (CASE              WHEN TINH.MADONVI  = @BOOTS              THEN 1              ELSE 0              END) as BOOST_SCORED              FROM TM_DONVIHANHCHINH XA              JOIN TM_DONVIHANHCHINH HUYEN ON (XA.CAPTREN_ID = HUYEN.DONVIHANHCHINH_ID AND XA.CAPDONVI = 4)              JOIN TM_DONVIHANHCHINH TINH ON (HUYEN.CAPTREN_ID = TINH.DONVIHANHCHINH_ID AND HUYEN.CAPDONVI = 3)              WHERE XA.TAMNGUNG != '1'              ORDER BY BOOST_SCORED desc, TINH, HUYEN, XA asc]
2020-07-16 15:11:16,586 [5] DEBUG - Statement Id: [DAO00106_GetList] PreparedStatement : [select * from TM_ICD_CHUONG              where TAMNGUNG = 0              and BENHVIEN_ID = '01819']
2020-07-16 15:11:17,492 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = '01819'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM005']
2020-07-16 15:11:31,575 [16] DEBUG - Statement Id: [DAO00013_GetListChiaSeBenhNhan_Total] PreparedStatement : [select count(*) as TOTALROWS        from TT_BENHNHAN A        where  A.ACTIVE = '1']
2020-07-16 15:11:31,609 [16] DEBUG - Statement Id: [DAO00013_GetListChiaSeBenhNhan] PreparedStatement : [select * from        (        select ROW_NUMBER() OVER(order by a.MAYTE) as ROWNUMBER, *,        CASE        WHEN A.GIOITINH = 1 THEN 'Nam'        WHEN A.GIOITINH = 2 THEN N'Nữ'        END as TENGIOITINH        from TT_BENHNHAN A        where  ACTIVE = '1') lst where lst.ROWNUMBER between 1 and 200000]
2020-07-16 15:11:39,601 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = '01819'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM015']
2020-07-16 15:11:44,852 [10] DEBUG - Statement Id: [DAO00027_GetListTiepNhanCOM015] PreparedStatement : [declare @ManhomDSA varchar(10);        select top 1  @ManhomDSA = VALUE from TM_SYS_APPSETTINGS where CODE = 'MANHOM_DICHVU_DSA'        SELECT * FROM        (        SELECT        (A.SOTIEPNHAN + (CASE WHEN Left(E.MANHOMDICHVU,2) = '03' THEN '02' ELSE Left(E.MANHOMDICHVU,2) END) + LTRIM(C.NOITHUCHIEN_ID)) AS acss_lookupID,        ROW_NUMBER() OVER        (PARTITION BY (A.SOTIEPNHAN + (CASE WHEN Left(E.MANHOMDICHVU,2) = '03' THEN '02' ELSE Left(E.MANHOMDICHVU,2) END) + LTRIM(C.NOITHUCHIEN_ID))        ORDER BY (A.SOTIEPNHAN + (CASE WHEN Left(E.MANHOMDICHVU,2) = '03' THEN '02' ELSE Left(E.MANHOMDICHVU,2) END) + LTRIM(C.NOITHUCHIEN_ID)))        as num,        A.SOTIEPNHAN + (CASE WHEN Left(E.MANHOMDICHVU,2) = '03' THEN '02' ELSE Left(E.MANHOMDICHVU,2) END) + LTRIM(C.NOITHUCHIEN_ID) as KEYCOM15,        C.NOITHUCHIEN_ID, A.SOTIEPNHAN, A.TRAITUYEN, A.NGAYMIENDONGCHITRA, A.TIEPNHAN_ID, A.DOITUONG_ID, A.TRANGTHAI,        A.LOAITHANHVIEN_ID, A.SUDUNG_BHTN, A.THE_ID, A.THANHVIEN_ID, A.VIP, A.NGUON_BENHNHAN_ID, A.BAOLANH_VIENPHI,        CASE WHEN (A.TRANGTHAI = 'NOITRU' OR A.TRANGTHAI = 'CAPCUU') THEN 'IN' ELSE 'OUT' END AS LOAIBENHAN,        CASE WHEN (C.TRANGTHAI = 'CHUAKETQUA') THEN 'CHUAKETQUA' ELSE 'HOANTAT' END AS TRANGTHAIDICHVU, A.SOBHYT,        B.*, F.TRANGTHAI as TRANGTHAI_BENHAN_NOITRU,        CASE        WHEN @ManhomDSA is not null and E.MANHOMDICHVU in (@ManhomDSA) THEN E.MANHOMDICHVU        WHEN Left(E.MANHOMDICHVU,2) = '03' THEN '02' ELSE Left(E.MANHOMDICHVU,2) END AS MANHOMDICHVU        , A.UUTIEN, A.NGOAIGIO        from TT_TIEPNHAN A        inner join TT_BENHNHAN B on B.BENHNHAN_ID = A.BENHNHAN_ID and (A.TRANGTHAI = 'DATIEPNHAN' or A.TRANGTHAI = 'NOITRU' or A.TRANGTHAI = 'CAPCUU' or A.TRANGTHAI = 'NGOAITRU') and B.ACTIVE = '1'        inner join TT_DVYEUCAU C on C.TIEPNHAN_ID = A.TIEPNHAN_ID        left join TM_DICHVU D on D.DICHVU_ID = C.DICHVU_ID        left join TM_NHOMDICHVU E on E.NHOMDICHVU_ID = D.NHOMDICHVU_ID        left join TT_NOITRU_BENHAN F on F.TIEPNHAN_ID = A.TIEPNHAN_ID        where C.NGAYHENCLS is NULL and A.BENHVIEN_ID = '01819'        and A.THOIGIANTIEPNHAN > DATEADD(DAY, -30, GETDATE())        ) a WHERE a.num = 1]
2020-07-16 15:11:48,632 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = '01819'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM067']
2020-07-16 15:11:51,344 [10] DEBUG - Statement Id: [DAO00117_GetList] PreparedStatement : [select A.*              from TT_NGOAITRU_TOATHUOC_NGUOIMUA A]
2020-07-16 15:11:52,216 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = '01819'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM008']
2020-07-16 15:11:55,131 [16] DEBUG - Statement Id: [DAO00027_GetListTiepNhanNoiTru] PreparedStatement : [select distinct B.*, C.SOBENHAN, C.BENHAN_ID, A.SOTIEPNHAN, A.TRAITUYEN, A.NGAYMIENDONGCHITRA, A.TIEPNHAN_ID,        isnull(C.KHOACHUYENDEN_ID,C.KHOAVAO_ID) as KHOACHUYENDEN_ID, A.TRANGTHAI, A.DOITUONG_ID, C.TRANGTHAI as TRANGTHAI_BENHAN,        A.LOAITHANHVIEN_ID, A.SUDUNG_BHTN, A.THE_ID, A.THANHVIEN_ID, A.VIP, A.NGUON_BENHNHAN_ID, A.BAOLANH_VIENPHI, A.SOBHYT,        CASE WHEN RIGHT(C.SOBENHAN,2) = 'CC' THEN 'CC' ELSE 'NT' END AS LOAIBENHAN, CONVERT(VARCHAR(11), C.NGAYVAOKHOA,103) as NGAYVAOKHOA        , A.UUTIEN, pb.TENPHONGBAN, A.NGOAIGIO                from TT_TIEPNHAN A        inner join TT_BENHNHAN B on B.BENHNHAN_ID = A.BENHNHAN_ID and (A.TRANGTHAI = 'CAPCUU' or A.TRANGTHAI = 'NOITRU' or A.TRANGTHAI = 'HOANTHANH' or A.TRANGTHAI = 'NGOAITRU') and B.ACTIVE = '1'        inner join TT_NOITRU_BENHAN C on C.TIEPNHAN_ID = A.TIEPNHAN_ID and (C.TRANGTHAI='DAXUATVIEN' or C.TRANGTHAI='DATHANHTOAN' OR C.TRANGTHAI='DANGDIEUTRI')        left join TM_PHONGBAN pb on pb.PHONGBAN_ID = isnull(C.KHOACHUYENDEN_ID,C.KHOAVAO_ID)                where A.BENHVIEN_ID = '01819' and C.LOAIBENHAN != 2]
2020-07-16 15:11:56,059 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = '01819'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM068']
2020-07-16 15:11:59,320 [9] DEBUG - Statement Id: [DAO00027_GetListCacheTiepNhanNgoaiTru] PreparedStatement : [select distinct B.*, C.SOBENHAN, C.BENHAN_ID, A.SOTIEPNHAN, A.TRAITUYEN, A.NGAYMIENDONGCHITRA, A.TIEPNHAN_ID,        isnull(C.KHOACHUYENDEN_ID,C.KHOAVAO_ID) as KHOACHUYENDEN_ID, A.TRANGTHAI, A.DOITUONG_ID, C.TRANGTHAI as TRANGTHAI_BENHAN,        A.LOAITHANHVIEN_ID, A.SUDUNG_BHTN, A.THE_ID, A.THANHVIEN_ID, A.VIP, A.NGUON_BENHNHAN_ID, A.BAOLANH_VIENPHI,        'NGOAITRU' AS LOAIBENHAN, CONVERT(VARCHAR(11),C.NGAYVAOKHOA,103) as NGAYVAOKHOA, A.SOBHYT        , A.UUTIEN, A.NGOAIGIO        from TT_TIEPNHAN A        inner join TT_BENHNHAN B on B.BENHNHAN_ID = A.BENHNHAN_ID and (A.TRANGTHAI = 'HOANTHANH' or A.TRANGTHAI = 'NGOAITRU') and B.ACTIVE = '1'        inner join TT_NOITRU_BENHAN C on C.TIEPNHAN_ID = A.TIEPNHAN_ID and (C.TRANGTHAI='DAXUATVIEN' or C.TRANGTHAI='DATHANHTOAN' OR C.TRANGTHAI='DANGDIEUTRI')        where A.BENHVIEN_ID = '01819' and C.LOAIBENHAN = 2]
2020-07-16 15:12:00,222 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = '01819'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM006']
2020-07-16 15:12:02,732 [18] DEBUG - Statement Id: [DAO00027_GetListTiepNhan] PreparedStatement : [select distinct CONVERT(VARCHAR(11),C.NGAYYEUCAU,103) as NGAYYEUCAU, C.DICHVU_ID, C.DVYEUCAU_ID, D.TENDICHVU, C.NOITHUCHIEN_ID, A.SOTIEPNHAN, A.TRAITUYEN, A.NGAYMIENDONGCHITRA, A.TIEPNHAN_ID, A.DOITUONG_ID, A.TRANGTHAI,        A.LOAITHANHVIEN_ID, A.SUDUNG_BHTN, A.THE_ID, A.THANHVIEN_ID, A.VIP, A.NGUON_BENHNHAN_ID, A.BAOLANH_VIENPHI,        CASE WHEN (A.TRANGTHAI = 'NOITRU' OR A.TRANGTHAI = 'CAPCUU' OR A.TRANGTHAI = 'NGOAITRU') THEN 'IN' ELSE 'OUT' END AS LOAIBENHAN,        CASE WHEN (C.TRANGTHAI = 'CHUAKETQUA') THEN 'CHUAKETQUA' ELSE 'HOANTAT' END AS TRANGTHAIDICHVU, A.SOBHYT,        B.*,        CASE WHEN Left(E.MANHOMDICHVU,2) = '03' THEN '02' ELSE Left(E.MANHOMDICHVU,2) END AS MANHOMDICHVU        , A.UUTIEN, A.NGOAIGIO        from TT_TIEPNHAN A        inner join TT_BENHNHAN B on B.BENHNHAN_ID = A.BENHNHAN_ID and (A.TRANGTHAI = 'DATIEPNHAN' or A.TRANGTHAI = 'NOITRU' or A.TRANGTHAI = 'CAPCUU'  or A.TRANGTHAI = 'NGOAITRU') and B.ACTIVE = '1'        inner join TT_DVYEUCAU C on C.TIEPNHAN_ID = A.TIEPNHAN_ID                left join TM_DICHVU D on D.DICHVU_ID = C.DICHVU_ID        left join TM_NHOMDICHVU E on E.NHOMDICHVU_ID = D.NHOMDICHVU_ID        where C.NGAYHENCLS is NULL and A.BENHVIEN_ID = '01819']
2020-07-16 15:12:05,942 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = '01819'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM030']
2020-07-16 15:12:08,427 [9] DEBUG - Statement Id: [DAO00027_GetListTiepNhanAll] PreparedStatement : [select distinct A.SOTIEPNHAN, A.TRAITUYEN, A.NGAYMIENDONGCHITRA, A.TIEPNHAN_ID, A.DOITUONG_ID, isnull(C.SOBENHAN,NULL) as SOBENHAN,        A.LOAITHANHVIEN_ID, A.SUDUNG_BHTN, A.THE_ID, A.THANHVIEN_ID, A.VIP, A.NGUON_BENHNHAN_ID, A.BAOLANH_VIENPHI, A.SOBHYT, CONVERT(VARCHAR(11),A.NGAYTIEPNHAN,103) as NGAYTIEPNHAN,        B.*        , A.UUTIEN, A.NGOAIGIO        from TT_TIEPNHAN A        inner join TT_BENHNHAN B on B.BENHNHAN_ID = A.BENHNHAN_ID and B.ACTIVE = '1'        left join TT_NOITRU_XACNHAN C on C.TIEPNHAN_ID = A.TIEPNHAN_ID         left join TT_NOITRU_BENHAN D on D.TIEPNHAN_ID = A.TIEPNHAN_ID        where A.BENHVIEN_ID = '01819' and D.BENHAN_ID is null and A.TRANGTHAI != 'HOANTHANH' and D.BENHAN_ID is null]
2020-07-16 15:12:10,671 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = '01819'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM025']
2020-07-16 15:12:15,396 [9] DEBUG - Statement Id: [DAO00026_GetListDanhSachDichVuGhiNhanVTYT_COM25] PreparedStatement : [select distinct CONVERT(VARCHAR(11),C.NGAYYEUCAU,103) as NGAYYEUCAU, C.DICHVU_ID, C.DVYEUCAU_ID, D.TENDICHVU, C.NOITHUCHIEN_ID, A.SOTIEPNHAN, A.TRAITUYEN, A.NGAYMIENDONGCHITRA, A.TIEPNHAN_ID, A.DOITUONG_ID, A.TRANGTHAI,            A.LOAITHANHVIEN_ID, A.SUDUNG_BHTN, A.THE_ID, A.THANHVIEN_ID, A.VIP, A.NGUON_BENHNHAN_ID, A.BAOLANH_VIENPHI,            CASE WHEN (A.TRANGTHAI = 'NOITRU' OR A.TRANGTHAI = 'CAPCUU') THEN 'IN' ELSE 'OUT' END AS LOAIBENHAN,            CASE WHEN (C.TRANGTHAI = 'CHUAKETQUA') THEN 'CHUAKETQUA' ELSE 'HOANTAT' END AS TRANGTHAIDICHVU,            B.*, isnull(ntba.SOBENHAN, '') SOBENHAN, isnull(ntba.BENHAN_ID, 0) BENHAN_ID,            CASE WHEN Left(E.MANHOMDICHVU,2) = '03' THEN '02' ELSE Left(E.MANHOMDICHVU,2) END AS MANHOMDICHVU            from TT_TIEPNHAN A            inner join TT_BENHNHAN B on B.BENHNHAN_ID = A.BENHNHAN_ID and B.ACTIVE = '1'            inner join TT_DVYEUCAU C on C.TIEPNHAN_ID = A.TIEPNHAN_ID                        left join TM_DICHVU D on D.DICHVU_ID = C.DICHVU_ID            left join TM_NHOMDICHVU E on E.NHOMDICHVU_ID = D.NHOMDICHVU_ID            left join TT_NOITRU_BENHAN ntba on ntba.BENHAN_ID = C.BENHAN_ID              where            C.NGAYHENCLS is NULL and A.BENHVIEN_ID = '01819'            and (A.TRANGTHAI = 'DATIEPNHAN' or A.TRANGTHAI = 'NOITRU' or A.TRANGTHAI = 'CAPCUU' or A.TRANGTHAI = 'NGOAITRU')            and (CASE WHEN Left(E.MANHOMDICHVU,2) = '03' THEN '02' ELSE Left(E.MANHOMDICHVU,2) END in ('02', '04'))]
2020-07-16 15:12:18,560 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = '01819'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM024']
2020-07-16 15:12:21,527 [9] DEBUG - Statement Id: [DAO00027_GetListDuyetToaThuoc] PreparedStatement : [select distinct A.SOTIEPNHAN, A.TRAITUYEN, A.NGAYMIENDONGCHITRA, A.TIEPNHAN_ID, A.DOITUONG_ID,        A.LOAITHANHVIEN_ID, A.SUDUNG_BHTN, A.THE_ID, A.THANHVIEN_ID, A.VIP, A.NGUON_BENHNHAN_ID, A.BAOLANH_VIENPHI,        B.*, 'NGOAITRU' as LOAITOA, C.PHAMVI_ID as PHAMVI_ID        from TT_NGOAITRU_KHAMBENH_TOATHUOC C        inner join TT_NGOAITRU_KHAMBENH D on C.KHAMBENH_ID = D.KHAMBENH_ID        inner join TT_TIEPNHAN A on D.TIEPNHAN_ID = A.TIEPNHAN_ID        inner join TT_BENHNHAN B on B.BENHNHAN_ID = A.BENHNHAN_ID        where C.DUYET = '1' and C.TRANGTHAI = 'CHUAXUAT' and C.BENHVIEN_ID = '01819' and (C.LOAITOATHUOC = 'BV' or C.LOAITOATHUOC = 'MP' or C.LOAITOATHUOC = 'KTBV')        union        select distinct A.SOTIEPNHAN, A.TRAITUYEN, A.NGAYMIENDONGCHITRA, A.TIEPNHAN_ID, A.DOITUONG_ID,        A.LOAITHANHVIEN_ID, A.SUDUNG_BHTN, A.THE_ID, A.THANHVIEN_ID, A.VIP, A.NGUON_BENHNHAN_ID, A.BAOLANH_VIENPHI,        B.*, 'MUANGOAI' as LOAITOA, C.PHAMVI_ID as PHAMVI_ID        from TT_NGOAITRU_KHAMBENH_TOATHUOC C        inner join TT_NGOAITRU_KHAMBENH D on C.KHAMBENH_ID = D.KHAMBENH_ID        inner join TT_TIEPNHAN A on D.TIEPNHAN_ID = A.TIEPNHAN_ID and (A.TRANGTHAI = 'DATIEPNHAN' or A.TRANGTHAI = 'NOITRU' or A.TRANGTHAI = 'CAPCUU' or A.TRANGTHAI = 'NGOAITRU')        inner join TT_BENHNHAN B on B.BENHNHAN_ID = A.BENHNHAN_ID        where C.DUYET = '1' and C.TRANGTHAI = 'CHUAXUAT' and C.BENHVIEN_ID = '01819' and (A.SOBHYT is null or A.SOBHYT = '')        union        select distinct A.SOTIEPNHAN, A.TRAITUYEN, A.NGAYMIENDONGCHITRA, A.TIEPNHAN_ID, A.DOITUONG_ID,        A.LOAITHANHVIEN_ID, A.SUDUNG_BHTN, A.THE_ID, A.THANHVIEN_ID, A.VIP, A.NGUON_BENHNHAN_ID, A.BAOLANH_VIENPHI,        B.*, 'NOITRU' as LOAITOA, C.PHAMVI_ID as PHAMVI_ID        from TT_NOITRU_TOATHUOC C        inner join TT_TIEPNHAN A on C.TIEPNHAN_ID = A.TIEPNHAN_ID and (A.TRANGTHAI = 'DATIEPNHAN' or A.TRANGTHAI = 'NOITRU' or A.TRANGTHAI = 'CAPCUU' or A.TRANGTHAI = 'NGOAITRU')        inner join TT_BENHNHAN B on B.BENHNHAN_ID = A.BENHNHAN_ID        where (C.TRANGTHAI = 'DADUYET' or C.TRANGTHAI = 'CHUAXUAT') and C.BENHVIEN_ID = '01819' and (A.SOBHYT is not null or A.SOBHYT != '')        union        select distinct A.SOTIEPNHAN, A.TRAITUYEN, A.NGAYMIENDONGCHITRA, A.TIEPNHAN_ID, A.DOITUONG_ID,        A.LOAITHANHVIEN_ID, A.SUDUNG_BHTN, A.THE_ID, A.THANHVIEN_ID, A.VIP, A.NGUON_BENHNHAN_ID, A.BAOLANH_VIENPHI,        B.*, 'MUANGOAI' as LOAITOA, C.PHAMVI_ID as PHAMVI_ID        from TT_NOITRU_TOATHUOC C        inner join TT_TIEPNHAN A on C.TIEPNHAN_ID = A.TIEPNHAN_ID and (A.TRANGTHAI = 'DATIEPNHAN' or A.TRANGTHAI = 'NOITRU' or A.TRANGTHAI = 'CAPCUU' or A.TRANGTHAI = 'NGOAITRU')        inner join TT_BENHNHAN B on B.BENHNHAN_ID = A.BENHNHAN_ID        inner join TT_NOITRU_BENHAN D on D.TIEPNHAN_ID = C.TIEPNHAN_ID        where (C.TRANGTHAI = 'DADUYET' or C.TRANGTHAI = 'CHUAXUAT') and C.BENHVIEN_ID = '01819' and (A.SOBHYT is null or A.SOBHYT = '') and D.TRANGTHAI != 'DANGDIEUTRI']
2020-07-16 15:12:22,498 [5] DEBUG - Statement Id: [DAO00034_GetList] PreparedStatement : [select *            from TM_BENHVIEN where isnull(TAMNGUNG,0) = '0']
2020-07-16 15:12:24,070 [5] DEBUG - Statement Id: [DAO00039_GetList] PreparedStatement : [select *              from TM_CHUYENKHOA              where BENHVIEN_ID = '01819']
2020-07-16 15:12:24,304 [5] DEBUG - Statement Id: [DAO00041_GetList] PreparedStatement : [declare @ManhomDSA varchar(10);            declare @PhanLoaiNhomDV varchar(20) = '';            select top 1  @ManhomDSA = VALUE from TM_SYS_APPSETTINGS where CODE = 'MANHOM_DICHVU_DSA'            if (@ManhomDSA is not null and '05' in (select * from STRING_SPLIT('', ',')))             set @PhanLoaiNhomDV += ',' + @ManhomDSA              select * from            (select dv.*, ndv.LOAIDICHVU_ID, ndv.MANHOMDICHVU, ndv.TENNHOMDICHVU as TENNHOMDICHVU,            ndv.TENKHONGDAU as TENNDVKHONGDAU, ndv.TENNHOMDICHVU_EN, ndv.TENNHOMDICHVU_RU,            CASE            WHEN @ManhomDSA is not null and ndv.MANHOMDICHVU in (@ManhomDSA) THEN ndv.MANHOMDICHVU            WHEN Left(ndv.MANHOMDICHVU,2) = '03' THEN '02' ELSE Left(ndv.MANHOMDICHVU,2)            END AS PHANLOAI_MANHOMDICHVU            from TM_DICHVU dv            left join TM_NHOMDICHVU ndv on dv.NHOMDICHVU_ID = ndv.NHOMDICHVU_ID                           where ndv.TAMNGUNG = '0' and dv.TAMNGUNG = '0' and dv.BENHVIEN_ID = '01819') as tbl]
2020-07-16 15:12:25,503 [5] DEBUG - Statement Id: [DAO00041_GetList_DVAll] PreparedStatement : [select * from          (select dv.*, ndv.LOAIDICHVU_ID, ndv.MANHOMDICHVU, ndv.TENNHOMDICHVU as TENNHOMDICHVU,          ndv.TENKHONGDAU as TENNDVKHONGDAU, ndv.TENNHOMDICHVU_EN, ndv.TENNHOMDICHVU_RU,          CASE WHEN Left(ndv.MANHOMDICHVU,2) = '03' THEN '02' ELSE Left(ndv.MANHOMDICHVU,2) END AS PHANLOAI_MANHOMDICHVU          from TM_DICHVU dv          left join TM_NHOMDICHVU ndv on dv.NHOMDICHVU_ID = ndv.NHOMDICHVU_ID                     where dv.BENHVIEN_ID = '01819') as tbl]
2020-07-16 15:12:27,143 [5] DEBUG - Statement Id: [DAO00016_GetList] PreparedStatement : [select TM_LOAIDUOC.MALOAIDUOC, TM_DUOC.*, TM_TENDUOC.TENDUOC, TM_TENDUOC.TENDUOC_EN, TM_TENDUOC.TENDUOC_RU, TM_TENDUOC.MAQUOCTE, TM_TENDUOC.MAQUOCTEBT,        TM_LOAIDUOC.LOAIVATTU_ID,TM_LOAIVATTU.TENLOAIVATTU        from TM_DUOC        left join TM_TENDUOC on TM_DUOC.TENDUOC_ID = TM_TENDUOC.TENDUOC_ID and TM_TENDUOC.BENHVIEN_ID = '01819'        left join TM_LOAIDUOC on TM_LOAIDUOC.LOAIDUOC_ID = TM_DUOC.LOAIDUOC_ID and TM_LOAIDUOC.BENHVIEN_ID = '01819'        left join TM_LOAIVATTU on TM_LOAIDUOC.LOAIVATTU_ID=TM_LOAIVATTU.LOAIVATTU_ID and TM_LOAIVATTU.BENHVIEN_ID = '01819'        where        TM_DUOC.BENHVIEN_ID = '01819'                 order by DUOC_ID]
2020-07-16 15:12:30,334 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = '01819'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM033']
2020-07-16 15:12:33,258 [9] DEBUG - Statement Id: [DAO00027_GetListDuocKyGuiTonKho] PreparedStatement : [select  distinct TT_TONKHO.DUOC_KEY, LTRIM(TT_TONKHO.KHODUOC_ID) as KHODUOC_ID, TM_DUOC.DUOC_ID, TM_LOAIDUOC.MALOAIDUOC,TM_DUOC.SOVISA,TM_DUOC.TYLE_VAT,TM_DUOC.COTOA,        TM_DUOC.MADUOC, TM_DUOC.TENHANG, TM_DUOC.TENDUOCDAYDU, dvt.TENDONVITINH as DONVITINH,  TM_DUOC.DONVITINH_ID,TM_DUOC.BHYT,TM_DUOC.PHAMVI,        TM_DUOC.TENHOATCHAT, TM_DUOC.HAMLUONG, TM_DUOC.HANGSANXUAT, TM_DUOC.QUOCGIA, TM_DUOC.LOAIDUOC_ID, TM_DUOC.DUONGDUNG_ID,        TM_TENDUOC.TENDUOC, TM_TENDUOC.TENDUOC_EN, TM_TENDUOC.MAQUOCTE, TM_TENDUOC.MAQUOCTEBT,        TM_LOAIDUOC.LOAIVATTU_ID, TM_DUOC.BENHVIEN_ID,TT_TONKHO.SOLUONG, TT_TONKHO.NGUONDUOC_ID, NH.TENNGUONDUOC        , TAMNGUNG = CASE WHEN TM_DUOC.TAMNGUNG = '1' OR nh.TAMNGUNG = '1' OR KD.TAMNGUNG = '1' THEN '1' ELSE '0' END        , TM_DUOC.DANGTRINHBAY        from TM_DUOC        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = TM_DUOC.DONVITINH_ID        left join TM_TENDUOC on TM_DUOC.TENDUOC_ID = TM_TENDUOC.TENDUOC_ID and TM_DUOC.BENHVIEN_ID = '01819' and TM_DUOC.TAMNGUNG = '0'        left join TM_LOAIDUOC on TM_LOAIDUOC.LOAIDUOC_ID = TM_DUOC.LOAIDUOC_ID and TM_LOAIDUOC.BENHVIEN_ID = '01819'        left join TM_DUOC_HANDUNG on (TM_LOAIDUOC.LOAIVATTU_ID = TM_DUOC_HANDUNG.LOAIDUOC and TM_DUOC_HANDUNG.BENHVIEN_ID = '01819')        inner join        (select LTRIM(A.KHODUOC_ID) + '_' + LTRIM(A.DUOC_ID) + '_' + LTRIM(ISNULL(A.NGUONDUOC_ID,'')) as DUOC_KEY, A.KHODUOC_ID, A.DUOC_ID,A.NGUONDUOC_ID,        SUM(isnull(A.SOLUONG,0)) as SOLUONG        from        (select SUM(SOLUONG) as SOLUONG, KHODUOC_ID, DUOC_ID, NGUONDUOC_ID from TT_DUOC_KYGUI_TONKHO        where BENHVIEN_ID = '01819' group by KHODUOC_ID, DUOC_ID, NGUONDUOC_ID) A        group by LTRIM(A.KHODUOC_ID) + '_' + LTRIM(A.DUOC_ID) + '_' + LTRIM(A.NGUONDUOC_ID), A.KHODUOC_ID, A.DUOC_ID, A.NGUONDUOC_ID)        TT_TONKHO on TT_TONKHO.DUOC_ID = TM_DUOC.DUOC_ID        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = TT_TONKHO.NGUONDUOC_ID and nh.BENHVIEN_ID = '01819'        LEFT JOIN TM_KHODUOC KD ON KD.KHODUOC_ID = TT_TONKHO.KHODUOC_ID        where TM_DUOC.BENHVIEN_ID = '01819' AND TT_TONKHO.SOLUONG >= 0]
2020-07-16 15:12:33,287 [5] DEBUG - Statement Id: [DAO00027_GetListDuocKyGuiTonKho] PreparedStatement : [select  distinct TT_TONKHO.DUOC_KEY, LTRIM(TT_TONKHO.KHODUOC_ID) as KHODUOC_ID, TM_DUOC.DUOC_ID, TM_LOAIDUOC.MALOAIDUOC,TM_DUOC.SOVISA,TM_DUOC.TYLE_VAT,TM_DUOC.COTOA,        TM_DUOC.MADUOC, TM_DUOC.TENHANG, TM_DUOC.TENDUOCDAYDU, dvt.TENDONVITINH as DONVITINH,  TM_DUOC.DONVITINH_ID,TM_DUOC.BHYT,TM_DUOC.PHAMVI,        TM_DUOC.TENHOATCHAT, TM_DUOC.HAMLUONG, TM_DUOC.HANGSANXUAT, TM_DUOC.QUOCGIA, TM_DUOC.LOAIDUOC_ID, TM_DUOC.DUONGDUNG_ID,        TM_TENDUOC.TENDUOC, TM_TENDUOC.TENDUOC_EN, TM_TENDUOC.MAQUOCTE, TM_TENDUOC.MAQUOCTEBT,        TM_LOAIDUOC.LOAIVATTU_ID, TM_DUOC.BENHVIEN_ID,TT_TONKHO.SOLUONG, TT_TONKHO.NGUONDUOC_ID, NH.TENNGUONDUOC        , TAMNGUNG = CASE WHEN TM_DUOC.TAMNGUNG = '1' OR nh.TAMNGUNG = '1' OR KD.TAMNGUNG = '1' THEN '1' ELSE '0' END        , TM_DUOC.DANGTRINHBAY        from TM_DUOC        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = TM_DUOC.DONVITINH_ID        left join TM_TENDUOC on TM_DUOC.TENDUOC_ID = TM_TENDUOC.TENDUOC_ID and TM_DUOC.BENHVIEN_ID = '01819' and TM_DUOC.TAMNGUNG = '0'        left join TM_LOAIDUOC on TM_LOAIDUOC.LOAIDUOC_ID = TM_DUOC.LOAIDUOC_ID and TM_LOAIDUOC.BENHVIEN_ID = '01819'        left join TM_DUOC_HANDUNG on (TM_LOAIDUOC.LOAIVATTU_ID = TM_DUOC_HANDUNG.LOAIDUOC and TM_DUOC_HANDUNG.BENHVIEN_ID = '01819')        inner join        (select LTRIM(A.KHODUOC_ID) + '_' + LTRIM(A.DUOC_ID) + '_' + LTRIM(ISNULL(A.NGUONDUOC_ID,'')) as DUOC_KEY, A.KHODUOC_ID, A.DUOC_ID,A.NGUONDUOC_ID,        SUM(isnull(A.SOLUONG,0)) as SOLUONG        from        (select SUM(SOLUONG) as SOLUONG, KHODUOC_ID, DUOC_ID, NGUONDUOC_ID from TT_DUOC_KYGUI_TONKHO        where BENHVIEN_ID = '01819' group by KHODUOC_ID, DUOC_ID, NGUONDUOC_ID) A        group by LTRIM(A.KHODUOC_ID) + '_' + LTRIM(A.DUOC_ID) + '_' + LTRIM(A.NGUONDUOC_ID), A.KHODUOC_ID, A.DUOC_ID, A.NGUONDUOC_ID)        TT_TONKHO on TT_TONKHO.DUOC_ID = TM_DUOC.DUOC_ID        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = TT_TONKHO.NGUONDUOC_ID and nh.BENHVIEN_ID = '01819'        LEFT JOIN TM_KHODUOC KD ON KD.KHODUOC_ID = TT_TONKHO.KHODUOC_ID        where TM_DUOC.BENHVIEN_ID = '01819' AND TT_TONKHO.SOLUONG >= 0]
2020-07-16 15:12:33,343 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = '01819'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM018']
2020-07-16 15:12:35,715 [16] DEBUG - Statement Id: [DAO00027_GetListDuocTonKho] PreparedStatement : [select distinct TT_TONKHO.DUOC_KEY, LTRIM(TT_TONKHO.KHODUOC_ID) as KHODUOC_ID, TM_DUOC.DUOC_ID, TM_LOAIDUOC.MALOAIDUOC,TM_DUOC.SOVISA,TM_DUOC.TYLE_VAT,TM_DUOC.COTOA,        TM_DUOC.MADUOC, TM_DUOC.TENHANG, TM_DUOC.TENDUOCDAYDU, dvt.TENDONVITINH as DONVITINH,  TM_DUOC.DONVITINH_ID,TM_DUOC.BHYT,                TM_DUOC.TENHOATCHAT,          TM_DUOC.HAMLUONG, TM_DUOC.HANGSANXUAT, TM_DUOC.QUOCGIA, TM_DUOC.LOAIDUOC_ID, TM_DUOC.DUONGDUNG_ID,        TM_TENDUOC.TENDUOC, TM_TENDUOC.TENDUOC_EN, TM_TENDUOC.MAQUOCTE, TM_TENDUOC.MAQUOCTEBT,        TM_LOAIDUOC.LOAIVATTU_ID, TM_DUOC.BENHVIEN_ID,        TT_TONKHO.SOLUONG, TM_DUOC.VTYT_PHANLOAI, TM_DUOC.PHAMVI, TT_TONKHO.NGUONDUOC_ID, NG.TENNGUONDUOC AS TENNGUONDUOC        , TAMNGUNG = CASE WHEN TM_DUOC.TAMNGUNG = '1' OR NG.TAMNGUNG = '1' OR KD.TAMNGUNG = '1' THEN '1' ELSE '0' END        , TM_DUOC.DANGTRINHBAY        ,TT_TONKHO.PHAMVI_ID AS KHO_PHAMVI_ID        from TM_DUOC        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = TM_DUOC.DONVITINH_ID        left join TM_TENDUOC on TM_DUOC.TENDUOC_ID = TM_TENDUOC.TENDUOC_ID and TM_DUOC.BENHVIEN_ID = '01819' and TM_DUOC.TAMNGUNG = '0'        left join TM_LOAIDUOC on TM_LOAIDUOC.LOAIDUOC_ID = TM_DUOC.LOAIDUOC_ID and TM_LOAIDUOC.BENHVIEN_ID = '01819'        left join TM_DUOC_HANDUNG on (TM_LOAIDUOC.LOAIVATTU_ID = TM_DUOC_HANDUNG.LOAIDUOC and TM_DUOC_HANDUNG.BENHVIEN_ID = '01819')        inner join        (select LTRIM(A.KHODUOC_ID) + '_' + LTRIM(A.DUOC_ID) + '_' + LTRIM(ISNULL(A.NGUONDUOC_ID,'')) as DUOC_KEY, A.KHODUOC_ID, A.DUOC_ID, A.NGUONDUOC_ID,        SUM(isnull(A.SOLUONG,0)) as SOLUONG        ,A.PHAMVI_ID        from        (select SUM(AA.SOLUONG) as SOLUONG, AA.KHODUOC_ID, AA.DUOC_ID, AA.NGUONDUOC_ID        ,CC.PHAMVI_ID        from TT_DUOC_TONKHO AA INNER JOIN TM_KHODUOC BB ON AA.KHODUOC_ID=BB.KHODUOC_ID        LEFT JOIN TM_PHAMVI CC ON BB.PHAMVI_ID=CC.PHAMVI_ID        where AA.BENHVIEN_ID = '01819' group by AA.KHODUOC_ID, AA.DUOC_ID, AA.NGUONDUOC_ID,CC.PHAMVI_ID        ) A        group by LTRIM(A.KHODUOC_ID) + '_' + LTRIM(A.DUOC_ID) + '_' + LTRIM(ISNULL(A.NGUONDUOC_ID,'')), A.KHODUOC_ID, A.DUOC_ID, NGUONDUOC_ID        ,A.PHAMVI_ID        ) TT_TONKHO on TT_TONKHO.DUOC_ID = TM_DUOC.DUOC_ID        LEFT JOIN TM_NGUONHANG NG ON NG.NGUONDUOC_ID = TT_TONKHO.NGUONDUOC_ID        LEFT JOIN TM_KHODUOC KD ON KD.KHODUOC_ID = TT_TONKHO.KHODUOC_ID        where TM_DUOC.BENHVIEN_ID = '01819' and TT_TONKHO.SOLUONG >= 0]
2020-07-16 15:12:37,254 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = '01819'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM023']
2020-07-16 15:12:39,617 [9] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoVaBooking] PreparedStatement : [declare @NGUONDUOC_MACDINH varchar(5) = '0';        declare @TOAMUANGOAI int = 0;        select @NGUONDUOC_MACDINH = isnull(VALUE,0) from TM_SYS_APPSETTINGS where CODE = 'PHA_NGUONDUOC'        select @TOAMUANGOAI = isnull(VALUE,0) from TM_SYS_APPSETTINGS where CODE = 'OPD_TOAMUANGOAI_DUNGDANHMUC_DUOC'                if @TOAMUANGOAI = 1        begin        select  distinct '0' + '_' + LTRIM(d.DUOC_ID) + '_' + @NGUONDUOC_MACDINH as DUOC_KEY, 0 as PHAMVI_ID, @NGUONDUOC_MACDINH as NGUONDUOC_ID, null as TENNGUONDUOC, null as TINHTIEN, d.DUOC_ID, ld.MALOAIDUOC,        d.SOVISA,d.TYLE_VAT,d.COTOA, d.MADUOC, d.TENHANG, d.TENDUOCDAYDU, d.DONVITINH as DONVITINH, d.BHYT,        d.TENHOATCHAT, d.HAMLUONG, d.HANGSANXUAT, d.QUOCGIA, d.LOAIDUOC_ID, d.DUONGDUNG_ID, d.TINHTIEN_PTTT,        ten.TENDUOC, ten.TENDUOC_EN, ten.MAQUOCTE, ten.MAQUOCTEBT,d.CONGDUNG,        '' as BHYT_TEXT        , ld.LOAIVATTU_ID        , d.BENHVIEN_ID,        999999999 as SOLUONG, d.VTYT_PHANLOAI, d.PHAMVI, d.SUASOLUONGTONGHOP, d.MADUOCBV, d.DANGTRINHBAY        , TAMNGUNG = CASE WHEN d.TAMNGUNG = '1' THEN '1' ELSE '0' END        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = '01819'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = '01819')        union all        select  distinct tk.DUOC_KEY, LTRIM(tk.PHAMVI_ID) as PHAMVI_ID, tk.NGUONDUOC_ID, nh.TENNGUONDUOC, nh.TINHTIEN, d.DUOC_ID, ld.MALOAIDUOC,        d.SOVISA,d.TYLE_VAT,d.COTOA, d.MADUOC, d.TENHANG, d.TENDUOCDAYDU, d.DONVITINH as DONVITINH, d.BHYT,        d.TENHOATCHAT, d.HAMLUONG, d.HANGSANXUAT, d.QUOCGIA, d.LOAIDUOC_ID, d.DUONGDUNG_ID, d.TINHTIEN_PTTT,        ten.TENDUOC, ten.TENDUOC_EN, ten.MAQUOCTE, ten.MAQUOCTEBT,d.CONGDUNG,        CASE WHEN d.BHYT = '1' THEN 'BHYT' ELSE '' END as BHYT_TEXT        , ld.LOAIVATTU_ID        , d.BENHVIEN_ID,        tk.SOLUONG, d.VTYT_PHANLOAI, d.PHAMVI, d.SUASOLUONGTONGHOP, d.MADUOCBV, d.DANGTRINHBAY        , TAMNGUNG = CASE WHEN d.TAMNGUNG = '1' OR nh.TAMNGUNG = '1' OR kd.TAMNGUNG = '1' THEN '1' ELSE '0' END        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = '01819'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = '01819')        inner join        (        select  LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')) DUOC_KEY, (SUM(dtk.SOLUONG) - isnull(sum(A.SOLUONG),0) - isnull(sum(B.SOLUONG),0)) SOLUONG, pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        from (select sum(soluong) soluong,duoc_id,nguonduoc_id,khoduoc_id,benhvien_id from TT_DUOC_TONKHO  group by duoc_id,nguonduoc_id,khoduoc_id,benhvien_id) dtk        inner join TM_DUOC_PHAMVISD_MAPPING pvsd on dtk.KHODUOC_ID = pvsd.KHODUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NOITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) B on B.DUOC_ID = dtk.DUOC_ID and B.SOLUONG > 0 and B.PHAMVI_ID = pvsd.PHAMVI_ID and B.NGUONHANG_ID = dtk.NGUONDUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NGOAITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) A on A.DUOC_ID = dtk.DUOC_ID and A.SOLUONG > 0 and A.PHAMVI_ID = pvsd.PHAMVI_ID and A.NGUONHANG_ID = dtk.NGUONDUOC_ID        where dtk.SOLUONG > 0 and dtk.BENHVIEN_ID = '01819'        group by LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')), pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        ) tk on tk.DUOC_ID = d.DUOC_ID        left join TM_DUOC_PHAMVISUDUNG kd on kd.PHAMVI_ID = tk.PHAMVI_ID and kd.BENHVIEN_ID = '01819'        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = tk.NGUONDUOC_ID and nh.BENHVIEN_ID = '01819'        where d.BENHVIEN_ID = '01819'  and tk.SOLUONG >= 0        end        else        begin                select  distinct tk.DUOC_KEY, LTRIM(tk.PHAMVI_ID) as PHAMVI_ID, tk.NGUONDUOC_ID, nh.TENNGUONDUOC, nh.TINHTIEN, d.DUOC_ID, ld.MALOAIDUOC,        d.SOVISA,d.TYLE_VAT,d.COTOA, d.MADUOC, d.TENHANG, d.TENDUOCDAYDU, d.DONVITINH as DONVITINH, d.BHYT,        d.TENHOATCHAT, d.HAMLUONG, d.HANGSANXUAT, d.QUOCGIA, d.LOAIDUOC_ID, d.DUONGDUNG_ID, d.TINHTIEN_PTTT,        ten.TENDUOC, ten.TENDUOC_EN, ten.MAQUOCTE, ten.MAQUOCTEBT,d.CONGDUNG,        CASE WHEN d.BHYT = '1' THEN 'BHYT' ELSE '' END as BHYT_TEXT        , ld.LOAIVATTU_ID        , d.BENHVIEN_ID,        tk.SOLUONG, d.VTYT_PHANLOAI, d.PHAMVI, d.SUASOLUONGTONGHOP, d.MADUOCBV, d.DANGTRINHBAY        , TAMNGUNG = CASE WHEN d.TAMNGUNG = '1' OR nh.TAMNGUNG = '1' OR kd.TAMNGUNG = '1' THEN '1' ELSE '0' END        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = '01819'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = '01819')        inner join        (        select  LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')) DUOC_KEY, (SUM(dtk.SOLUONG) - isnull(sum(A.SOLUONG),0) - isnull(sum(B.SOLUONG),0)) SOLUONG, pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        from (select sum(soluong) soluong,duoc_id,nguonduoc_id,khoduoc_id,benhvien_id from TT_DUOC_TONKHO  group by duoc_id,nguonduoc_id,khoduoc_id,benhvien_id) dtk        inner join TM_DUOC_PHAMVISD_MAPPING pvsd on dtk.KHODUOC_ID = pvsd.KHODUOC_ID        left join (        select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NOITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID)        B on B.DUOC_ID = dtk.DUOC_ID and B.SOLUONG > 0 and B.PHAMVI_ID = pvsd.PHAMVI_ID and B.NGUONHANG_ID = dtk.NGUONDUOC_ID        left join (        select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NGOAITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID)        A on A.DUOC_ID = dtk.DUOC_ID and A.SOLUONG > 0 and A.PHAMVI_ID = pvsd.PHAMVI_ID and A.NGUONHANG_ID = dtk.NGUONDUOC_ID        where dtk.SOLUONG > 0 and dtk.BENHVIEN_ID = '01819'        group by LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')), pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        ) tk on tk.DUOC_ID = d.DUOC_ID        left join TM_DUOC_PHAMVISUDUNG kd on kd.PHAMVI_ID = tk.PHAMVI_ID and kd.BENHVIEN_ID = '01819'        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = tk.NGUONDUOC_ID and nh.BENHVIEN_ID = '01819'        where d.BENHVIEN_ID = '01819'  and tk.SOLUONG >= 0        end]
2020-07-16 15:12:42,506 [5] DEBUG - Statement Id: [DAO00005_GetList] PreparedStatement : [select *              from TM_GENDER]
2020-07-16 15:12:43,096 [5] DEBUG - Statement Id: [DAO00320_GetList] PreparedStatement : [select M.*            from TM_MAU M            LEFT JOIN TM_MAU_DONVITINH DVT on M.DONVITINH_ID=DVT.DONVITINH_ID            where            M.TAMNGUNG = '0'            and M.BENHVIEN_ID = '01819'            order by M.TENMAU]
2020-07-16 15:12:43,274 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = '01819'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM071']
2020-07-16 15:12:45,018 [36] DEBUG - Statement Id: [DAO00322_GetListMauTonKhoForCreateCached] PreparedStatement : [SELECT DISTINCT        TK.MAU_KEY, TK.KHOMAU_ID, M.MAU_ID, M.MAMAU, M.TENMAU, M.NHOM_ABO, M.NHOM_RH, M.LOAIMAU_ID,        TK.SOLONHAP_ID, SLN.SOLONHAP, SLN.SOKIEMSOAT, TK.NGUONHANG_ID, NG.TENNGUONMAU, M.BENHVIEN_ID, M.DONVITINH_ID,        SUM(tk.SOLUONG) AS SOLUONG,K.TENKHO,DVT.TENDONVITINH        FROM TT_MAU_TONKHO TK        JOIN TM_KHO K ON TK.KHOMAU_ID = K.KHO_ID        JOIN TT_MAU_CHUNGTU_SOLONHAP SLN ON TK.SOLONHAP_ID = SLN.SOLONHAP_ID        JOIN TM_MAU M on TK.MAU_ID = M.MAU_ID and M.TAMNGUNG = '0'        LEFT JOIN TM_MAU_DONVITINH DVT on M.DONVITINH_ID=DVT.DONVITINH_ID        LEFT JOIN TM_NGUONMAU NG ON NG.NGUONMAU_ID = TK.NGUONHANG_ID        WHERE TK.SOLUONG > 0        GROUP BY TK.MAU_KEY, TK.KHOMAU_ID, M.MAU_ID, M.MAMAU, M.TENMAU, M.NHOM_ABO, M.NHOM_RH, M.LOAIMAU_ID,        TK.SOLONHAP_ID, SLN.SOLONHAP, SLN.SOKIEMSOAT,TK.NGUONHANG_ID, NG.TENNGUONMAU, M.BENHVIEN_ID, M.DONVITINH_ID,K.TENKHO,DVT.TENDONVITINH]
2020-07-16 15:12:45,046 [5] DEBUG - Statement Id: [DAO00322_GetListMauTonKhoForCreateCached] PreparedStatement : [SELECT DISTINCT        TK.MAU_KEY, TK.KHOMAU_ID, M.MAU_ID, M.MAMAU, M.TENMAU, M.NHOM_ABO, M.NHOM_RH, M.LOAIMAU_ID,        TK.SOLONHAP_ID, SLN.SOLONHAP, SLN.SOKIEMSOAT, TK.NGUONHANG_ID, NG.TENNGUONMAU, M.BENHVIEN_ID, M.DONVITINH_ID,        SUM(tk.SOLUONG) AS SOLUONG,K.TENKHO,DVT.TENDONVITINH        FROM TT_MAU_TONKHO TK        JOIN TM_KHO K ON TK.KHOMAU_ID = K.KHO_ID        JOIN TT_MAU_CHUNGTU_SOLONHAP SLN ON TK.SOLONHAP_ID = SLN.SOLONHAP_ID        JOIN TM_MAU M on TK.MAU_ID = M.MAU_ID and M.TAMNGUNG = '0'        LEFT JOIN TM_MAU_DONVITINH DVT on M.DONVITINH_ID=DVT.DONVITINH_ID        LEFT JOIN TM_NGUONMAU NG ON NG.NGUONMAU_ID = TK.NGUONHANG_ID        WHERE TK.SOLUONG > 0        GROUP BY TK.MAU_KEY, TK.KHOMAU_ID, M.MAU_ID, M.MAMAU, M.TENMAU, M.NHOM_ABO, M.NHOM_RH, M.LOAIMAU_ID,        TK.SOLONHAP_ID, SLN.SOLONHAP, SLN.SOKIEMSOAT,TK.NGUONHANG_ID, NG.TENNGUONMAU, M.BENHVIEN_ID, M.DONVITINH_ID,K.TENKHO,DVT.TENDONVITINH]
2020-07-16 15:12:45,102 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = '01819'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM073']
2020-07-16 15:12:46,516 [37] DEBUG - Statement Id: [DAO00322_GetListMauTonKhoTruBooking] PreparedStatement : [select distinct        TK.MAU_KEY, TK.KHOMAU_ID, M.MAU_ID, M.MAMAU, M.TENMAU, M.NHOM_ABO, M.NHOM_RH, M.LOAIMAU_ID, M.DONVITINH_ID,        TK.SOLONHAP_ID, TK.SOLONHAP, TK.SOKIEMSOAT,M.PHAMVI, TK.NGUONHANG_ID, NG.TENNGUONMAU, M.BENHVIEN_ID,        TK.SOLUONG,TK.TENKHO,DVT.TENDONVITINH        from TM_MAU M        JOIN        (        select        A.MAU_KEY, A.KHOMAU_ID, A.MAU_ID ,a.NGUONHANG_ID, A.SOLONHAP_ID, A.SOLONHAP, A.SOKIEMSOAT, A.SOLUONG,A.TENKHO        from        (        select KHOMAU_ID, TK.MAU_ID, TK.NGUONHANG_ID, TK.MAU_KEY, SLN.SOLONHAP_ID, SLN.SOLONHAP, SLN.SOKIEMSOAT, ISNULL(TK.SOLUONG,0) - ISNULL(book.SOLUONG,0) as SOLUONG,K.TENKHO        from TT_MAU_TONKHO TK        JOIN TM_KHO K ON TK.KHOMAU_ID = K.KHO_ID        inner join TT_MAU_CHUNGTU_SOLONHAP SLN ON TK.SOLONHAP_ID = SLN.SOLONHAP_ID        left join dbo.TT_MAU_TONKHO_BOOK book ON book.MAU_KEY = TK.MAU_KEY AND book.TRANGTHAI = 'HIEULUC'        where ISNULL(TK.SOLUONG,0) - ISNULL(book.SOLUONG,0) > 0        ) A        )TK on TK.MAU_ID = M.MAU_ID and M.TAMNGUNG = '0'        LEFT JOIN TM_MAU_DONVITINH DVT on M.DONVITINH_ID=DVT.DONVITINH_ID        LEFT JOIN TM_NGUONMAU NG ON NG.NGUONMAU_ID = TK.NGUONHANG_ID]
2020-07-16 15:12:46,540 [5] DEBUG - Statement Id: [DAO00322_GetListMauTonKhoTruBooking] PreparedStatement : [select distinct        TK.MAU_KEY, TK.KHOMAU_ID, M.MAU_ID, M.MAMAU, M.TENMAU, M.NHOM_ABO, M.NHOM_RH, M.LOAIMAU_ID, M.DONVITINH_ID,        TK.SOLONHAP_ID, TK.SOLONHAP, TK.SOKIEMSOAT,M.PHAMVI, TK.NGUONHANG_ID, NG.TENNGUONMAU, M.BENHVIEN_ID,        TK.SOLUONG,TK.TENKHO,DVT.TENDONVITINH        from TM_MAU M        JOIN        (        select        A.MAU_KEY, A.KHOMAU_ID, A.MAU_ID ,a.NGUONHANG_ID, A.SOLONHAP_ID, A.SOLONHAP, A.SOKIEMSOAT, A.SOLUONG,A.TENKHO        from        (        select KHOMAU_ID, TK.MAU_ID, TK.NGUONHANG_ID, TK.MAU_KEY, SLN.SOLONHAP_ID, SLN.SOLONHAP, SLN.SOKIEMSOAT, ISNULL(TK.SOLUONG,0) - ISNULL(book.SOLUONG,0) as SOLUONG,K.TENKHO        from TT_MAU_TONKHO TK        JOIN TM_KHO K ON TK.KHOMAU_ID = K.KHO_ID        inner join TT_MAU_CHUNGTU_SOLONHAP SLN ON TK.SOLONHAP_ID = SLN.SOLONHAP_ID        left join dbo.TT_MAU_TONKHO_BOOK book ON book.MAU_KEY = TK.MAU_KEY AND book.TRANGTHAI = 'HIEULUC'        where ISNULL(TK.SOLUONG,0) - ISNULL(book.SOLUONG,0) > 0        ) A        )TK on TK.MAU_ID = M.MAU_ID and M.TAMNGUNG = '0'        LEFT JOIN TM_MAU_DONVITINH DVT on M.DONVITINH_ID=DVT.DONVITINH_ID        LEFT JOIN TM_NGUONMAU NG ON NG.NGUONMAU_ID = TK.NGUONHANG_ID]
2020-07-16 15:12:46,595 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = '01819'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM072']
2020-07-16 15:12:48,042 [38] DEBUG - Statement Id: [DAO00322_GetListMauTonKhoBangKhongForCreateCached] PreparedStatement : [SELECT DISTINCT        TK.MAU_KEY, TK.KHOMAU_ID, M.MAU_ID, M.MAMAU, M.TENMAU, M.NHOM_ABO, M.NHOM_RH, M.LOAIMAU_ID, M.DONVITINH_ID,        TK.SOLONHAP_ID, SLN.SOLONHAP, SLN.SOKIEMSOAT, TK.NGUONHANG_ID, NG.TENNGUONMAU, M.BENHVIEN_ID,        SUM(tk.SOLUONG) AS SOLUONG,K.TENKHO,DVT.TENDONVITINH        FROM TT_MAU_TONKHO TK        JOIN TM_KHO K ON TK.KHOMAU_ID = K.KHO_ID        JOIN TT_MAU_CHUNGTU_SOLONHAP SLN ON TK.SOLONHAP_ID = SLN.SOLONHAP_ID        JOIN TM_MAU M on TK.MAU_ID = M.MAU_ID and M.TAMNGUNG = '0'        LEFT JOIN TM_MAU_DONVITINH DVT on M.DONVITINH_ID=DVT.DONVITINH_ID        LEFT JOIN TM_NGUONMAU NG ON NG.NGUONMAU_ID = TK.NGUONHANG_ID        WHERE TK.SOLUONG = 0        GROUP BY        TK.MAU_KEY, TK.KHOMAU_ID, M.MAU_ID, M.MAMAU, M.TENMAU, M.NHOM_ABO, M.NHOM_RH,M.LOAIMAU_ID,M.DONVITINH_ID,        TK.SOLONHAP_ID, SLN.SOLONHAP, SLN.SOKIEMSOAT,TK.NGUONHANG_ID, NG.TENNGUONMAU, M.BENHVIEN_ID,K.TENKHO,DVT.TENDONVITINH]
2020-07-16 15:12:49,421 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = '01819'               AND                   TM_SYS_SCREEN.PAGE = 'MAIN'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2020-07-16 15:12:55,326 [1] DEBUG - Statement Id: [DAO00002_FormList] PreparedStatement : [select              TM_SYS_FORM.HOSPITAL_ID,              TM_SYS_FORM.NAME,              TM_SYS_FORM.CLASS,              TM_SYS_FORM.ASSEMBLY,              TM_SYS_FORM.TITLE_VI as TITLE              from TM_SYS_FORM              where HOSPITAL_ID = '01819']
2020-07-16 15:13:05,827 [1] DEBUG - Statement Id: [DAO00300_GetShortcutListByUserID] PreparedStatement : [SELECT S.SHORTCUT_CODE, S.SHORTCUT_VALUE              FROM TM_SHORTCUT AS S              WHERE S.BENHVIEN_ID = '01819' AND S.USER_ID = '1' AND TAMNGUNG = '0']
2020-07-16 15:13:05,906 [1] DEBUG - Statement Id: [DAO00087_GetList] PreparedStatement : [select CODE, VALUE, BENHVIEN_ID              from TM_SYS_APPSETTINGS              where LOCKED = '0' and BENHVIEN_ID = '01819'              order by SETTING_ID]
2020-07-16 15:13:05,970 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = '01819'               AND                   TM_SYS_SCREEN.PAGE = 'MSG01'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2020-07-16 15:13:06,114 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = '01819'               AND                   TM_SYS_SCREEN.PAGE = 'MSG02'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2020-07-16 15:13:06,558 [1] DEBUG - Statement Id: [DAO00008_GetUserSettings] PreparedStatement : [select A.*, B.TENKHO , C.TENPHONGBAN, B.MAKHO, C.MAPHONGBAN          from TM_SYS_USERS A          left join TM_KHODUOC B on B.KHODUOC_ID = A.INVENTORY_ID          left join TM_PHONGBAN C on (C.PHONGBAN_ID = A.WORKING_DEPT_ID and C.BENHVIEN_ID =  @param0 )          left join TM_SYS_USERKHO D on (D.ACCOUNT_ID = A.ACCOUNT_ID and D.HOSPITAL_ID =  @param0 )          where          A.HOSPITAL_ID =  @param0            and                 A.ACCOUNT_ID =  @param1]
2020-07-16 15:13:06,570 [1] DEBUG - Statement Id: [DAO00008_GetUserSettings] Parameters: [@param0=[HOSPITAL_ID,01819], @param1=[ACCOUNT_ID,113]]
2020-07-16 15:13:06,570 [1] DEBUG - Statement Id: [DAO00008_GetUserSettings] Types: [@param0=[String, System.String], @param1=[String, System.String]]
2020-07-16 15:13:06,606 [1] DEBUG - Statement Id: [DAO00008_GetUserInvSettings] PreparedStatement : [select A.*, B.TENKHO, B.MAKHO, B.LOAIKHO_ID, B.KHOQUANLY_ID          from TM_SYS_USERKHO A          left join TM_KHO B on B.MODULE_ID = A.MODULE_ID and B.KHO_ID = A.KHO_ID          where A.HOSPITAL_ID =  @param0  and A.ACCOUNT_ID =  @param1           order by B.TENKHO]
2020-07-16 15:13:06,606 [1] DEBUG - Statement Id: [DAO00008_GetUserInvSettings] Parameters: [@param0=[HOSPITAL_ID,01819], @param1=[ACCOUNT_ID,113]]
2020-07-16 15:13:06,606 [1] DEBUG - Statement Id: [DAO00008_GetUserInvSettings] Types: [@param0=[String, System.String], @param1=[String, System.String]]
2020-07-16 15:13:06,766 [1] DEBUG - Statement Id: [DAO00028_GetInventories] PreparedStatement : [select distinct kd.KHO_ID,MAKHO, TENKHO, LOAIKHO_ID,          CASE WHEN KHOQUANLY_ID IS NULL THEN 0  ELSE KHOQUANLY_ID  END  AS KHOQUANLY_ID,          module.DICTIONARY_CODE AS MODULE_CODE, module.DICTIONARY_NAME AS MODULE_NAME, module.DICTIONARY_ID AS MODULE_ID          from TM_KHO kd          left join LST_DICTIONARY lst on lst.DICTIONARY_ID = kd.LOAIKHO_ID          left join LST_DICTIONARY module on module.DICTIONARY_ID = kd.MODULE_ID          inner join TM_PHONGBAN_KHO k on k.KHO_ID = kd.KHO_ID          where kd.TAMNGUNG = '0'          and kd.BENHVIEN_ID = '01819']
2020-07-16 15:13:07,031 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = '01819'               AND                   TM_SYS_SCREEN.PAGE = 'COM30'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2020-07-16 15:13:07,346 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = '01819'               AND                   TM_SYS_SCREEN.PAGE = 'RIS04'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2020-07-16 15:13:07,939 [1] DEBUG - Statement Id: [DAO00015_GetList] PreparedStatement : [select n.MANHOMICD, n.ICD_NHOM_ID as NHOM_ICD_ID, n.TENNHOMICD,              c.MACHUONGICD, c.ICD_CHUONG_ID, c.TENCHUONGICD, i.*              from TM_ICD i              left join TM_ICD_NHOM n on i.ICD_NHOM_ID = n.ICD_NHOM_ID              left join TM_ICD_CHUONG c on n.ICD_CHUONG_ID = c.ICD_CHUONG_ID              where i.TAMNGUNG = 0              and n.TAMNGUNG = 0              and c.TAMNGUNG = 0              and i.BENHVIEN_ID = '01819']
2020-07-16 15:13:10,260 [1] DEBUG - Statement Id: [DAO00018_GetList] PreparedStatement : [select A.*, B.DICTIONARY_NAME, B.DICTIONARY_CODE, B.DICTIONARY_NAME_EN CHUCDANH, (B.DICTIONARY_NAME_EN + '. ' + A.TENNHANVIEN) TENHOCVIHOCHAM            from TM_NHANVIEN A            left join (select * from LST_DICTIONARY where DICTIONARY_TYPE_CODE = 'chucdanh' and DICTIONARY_NAME_EN is not null) B on A.CHUCDANH_ID = B.DICTIONARY_ID            where A.BENHVIEN_ID = '01819' and A.TAMNGUNG = '0'             and               exists (select DICTIONARY_ID from LST_DICTIONARY where A.CHUCDANH_ID = DICTIONARY_ID and DICTIONARY_CODE in ('BS', 'BSCKDH', '4', '5', '45'))]
2020-07-16 15:13:11,453 [1] DEBUG - Statement Id: [DAO00018_GetList] PreparedStatement : [select A.*, B.DICTIONARY_NAME, B.DICTIONARY_CODE, B.DICTIONARY_NAME_EN CHUCDANH, (B.DICTIONARY_NAME_EN + '. ' + A.TENNHANVIEN) TENHOCVIHOCHAM            from TM_NHANVIEN A            left join (select * from LST_DICTIONARY where DICTIONARY_TYPE_CODE = 'chucdanh' and DICTIONARY_NAME_EN is not null) B on A.CHUCDANH_ID = B.DICTIONARY_ID            where A.BENHVIEN_ID = '01819' and A.TAMNGUNG = '0']
2020-07-16 15:13:11,785 [1] DEBUG - Statement Id: [DAO00012_GetList] PreparedStatement : [select        DICTIONARY_ID,        DICTIONARY_CODE,        DICTIONARY_NAME,        ATTRIBUTE1,        ATTRIBUTE2,        DICTIONARY_NAME_EN,        DICTIONARY_TYPE_CODE        from LST_DICTIONARY        where LST_DICTIONARY.Enabled = '1'         AND           LST_DICTIONARY.DICTIONARY_TYPE_CODE = 'CLS_LoaiThuocCanQuang'                 order by LST_DICTIONARY.IDX]
2020-07-16 15:13:12,055 [1] DEBUG - Statement Id: [DAO00012_GetList] PreparedStatement : [select        DICTIONARY_ID,        DICTIONARY_CODE,        DICTIONARY_NAME,        ATTRIBUTE1,        ATTRIBUTE2,        DICTIONARY_NAME_EN,        DICTIONARY_TYPE_CODE        from LST_DICTIONARY        where LST_DICTIONARY.Enabled = '1'         AND           LST_DICTIONARY.DICTIONARY_TYPE_CODE = 'CLS_LoaiPhim'                 order by LST_DICTIONARY.IDX]
2020-07-16 15:13:20,851 [1] DEBUG - Statement Id: [DAO00403_QMS002_GetThongTinClient] PreparedStatement : [SELECT B.ID as QUEUE_ID, B.NAME AS QUEUE_NAME,A.ID AS CLIENT_ID , A.[NAME] AS CLIENT_NAME, ISNULL(A.[STATE],1) AS [STATE],(CASE C.NAME WHEN 'UT' THEN 1 ELSE 0 END) AS QUEUETYPE     , B.DEPARTMENT_ID,ISNULL(B.SECTION_ID,-1) AS SECTION_ID,A.IPSERVER,A.NAMEAUDIO,C.QUEUE_TYPE_CODE,C.QUEUE_TYPE_CODE_SOUND,S.[NAME] AS SECTIONNAME     FROM QMS_QUEUE B LEFT JOIN QMS_CLIENT A ON A.QUEUE_ID = B.ID     LEFT JOIN QMS_QUEUE_TYPE C ON B.QUEUETYPE_ID = C.ID     LEFT JOIN QMS_SECTION S ON B.SECTION_ID=S.ID     WHERE     (A.COMPUTERNAME = 'DESKTOP-89GE5BA' OR A.IPADDRESS = '10.15.167.38') AND A.[STATE] = 1 AND B.DEPARTMENT_ID='87'            AND B.BENHVIEN_ID = '01819']
2020-07-16 15:13:21,015 [1] DEBUG - Statement Id: [DAO00045_GetList] PreparedStatement : [SELECT            TM_DICHVU.DICHVU_ID, TM_NHOMDICHVU.NHOMDICHVU_ID, TM_NHOMDICHVU.MANHOMDICHVU, TM_DICHVU.MADICHVU, TM_NHOMDICHVU.TENNHOMDICHVU,            TM_NHOMDICHVU.TENNHOMDICHVU_EN, TM_NHOMDICHVU.TENNHOMDICHVU_RU, TM_NHOMDICHVU.CAP, TM_NHOMDICHVU.CAPTREN_ID, TM_DICHVU.TENDICHVU,            TM_DICHVU.BENHVIEN_ID, TM_DICHVU.CHONHETCAPDUOI, TM_DICHVU.CAPTREN_ID AS DICHVU_CAPTREN_ID            FROM            TM_DICHVU            INNER JOIN            TM_NHOMDICHVU ON TM_DICHVU.NHOMDICHVU_ID = TM_NHOMDICHVU.NHOMDICHVU_ID AND TM_DICHVU.BENHVIEN_ID = TM_NHOMDICHVU.BENHVIEN_ID            where left(MANHOMDICHVU,2) in ('02, 03')            and TM_DICHVU.BENHVIEN_ID = '01819']
2020-07-16 15:13:21,273 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = '01819'               AND                   TM_SYS_SCREEN.PAGE = 'MENU1'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2020-07-16 15:13:21,591 [1] DEBUG - Statement Id: [DAO00011_GetList] PreparedStatement : [select              TM_SYS_MENU.ID,              TM_SYS_MENU.PARENTID,              TM_SYS_MENU.SCREEN,              TM_SYS_MENU.SMALLIMAGE,              TM_SYS_MENU.LARGEIMAGE,              TM_SYS_MENU.DESCRIPTION,              TM_SYS_MENU.TYPE,              TM_SYS_MENU.TITLE_VI as TITLE              from TM_SYS_MENU              where TM_SYS_MENU.HOSPITAL_ID = '01819' and TM_SYS_MENU.ACTIVE = '1'               AND                   (TM_SYS_MENU.TYPE & '8' = '8')                             order by TM_SYS_MENU.ORDERNUM]
2020-07-16 15:13:22,754 [1] DEBUG - Statement Id: [DAO00011_usermenu_list] PreparedStatement : [select              TM_SYS_HOMEMENU.MENUID as ID,              TM_SYS_MENU.TITLE_VI as TITLE,              TM_SYS_MENU.SCREEN,              TM_SYS_MENU.SMALLIMAGE,              TM_SYS_MENU.LARGEIMAGE,              TM_SYS_MENU.TYPE              from TM_SYS_HOMEMENU              left join TM_SYS_MENU on TM_SYS_MENU.ID = TM_SYS_HOMEMENU.MENUID and TM_SYS_MENU.HOSPITAL_ID = TM_SYS_HOMEMENU.HOSPITAL_ID              where TM_SYS_HOMEMENU.HOSPITAL_ID = '01819' and TM_SYS_HOMEMENU.USERID = '113' and TM_SYS_MENU.ACTIVE = '1'               AND                   (TM_SYS_MENU.TYPE & '8' = '8')                             ORDER BY TM_SYS_HOMEMENU.ORDERNUM]
2020-07-16 15:13:27,206 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = '01819'               AND                   TM_SYS_SCREEN.PAGE = 'REG14'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2020-07-16 15:13:27,309 [1] DEBUG - Statement Id: [DAO00006_GetList] PreparedStatement : [select dv.*, loaiDV.MALOAIDICHVU, captren.NHOMDICHVU_ID as NHOMDICHVU_CAPTREN_ID, captren.TENNHOMDICHVU as NHOMDICHVU_CAPTREN,              nhom_dv.TENNHOMDICHVU as TENNHOMDICHVU, nhom_dv.MANHOMDICHVU,              case when dv.ATTRIBUTE5 is null then 'TT' else 'KTC' end as LOAI_CHIPHI              from TM_DICHVU as dv              left join TM_NHOMDICHVU as nhom_dv on nhom_dv.NHOMDICHVU_ID = dv.NHOMDICHVU_ID and nhom_dv.BENHVIEN_ID = '01819'              left join TM_NHOMDICHVU as captren on nhom_dv.CAPTREN_ID = captren.NHOMDICHVU_ID and captren.BENHVIEN_ID = '01819'              left join TM_LOAIDICHVU loaiDV on nhom_dv.LOAIDICHVU_ID = loaiDV.LOAIDICHVU_ID and loaiDV.BENHVIEN_ID = '01819'              where nhom_dv.TAMNGUNG = '0' and dv.BENHVIEN_ID = '01819'              and dv.TAMNGUNG = '0'               AND                   loaiDV.MALOAIDICHVU = 'KhamBenh']
2020-07-16 15:13:27,623 [1] DEBUG - Statement Id: [DAO00012_GetList] PreparedStatement : [select        DICTIONARY_ID,        DICTIONARY_CODE,        DICTIONARY_NAME,        ATTRIBUTE1,        ATTRIBUTE2,        DICTIONARY_NAME_EN,        DICTIONARY_TYPE_CODE        from LST_DICTIONARY        where LST_DICTIONARY.Enabled = '1'         AND           LST_DICTIONARY.DICTIONARY_TYPE_CODE = 'KhuVucSong'                 order by LST_DICTIONARY.IDX]
2020-07-16 15:13:27,691 [1] DEBUG - Statement Id: [DAO00031_GetList] PreparedStatement : [select *              from TM_DOITUONG              where ACTIVE = 1 and BENHVIEN_ID = '01819']
2020-07-16 15:13:28,137 [1] DEBUG - Statement Id: [DAO00012_GetList] PreparedStatement : [select        DICTIONARY_ID,        DICTIONARY_CODE,        DICTIONARY_NAME,        ATTRIBUTE1,        ATTRIBUTE2,        DICTIONARY_NAME_EN,        DICTIONARY_TYPE_CODE        from LST_DICTIONARY        where LST_DICTIONARY.Enabled = '1'         AND           LST_DICTIONARY.DICTIONARY_TYPE_CODE = 'HinhThucDenKhamBenh'                 order by LST_DICTIONARY.IDX]
2020-07-16 15:13:28,256 [1] DEBUG - Statement Id: [DAO00012_GetList] PreparedStatement : [select        DICTIONARY_ID,        DICTIONARY_CODE,        DICTIONARY_NAME,        ATTRIBUTE1,        ATTRIBUTE2,        DICTIONARY_NAME_EN,        DICTIONARY_TYPE_CODE        from LST_DICTIONARY        where LST_DICTIONARY.Enabled = '1'         AND           LST_DICTIONARY.DICTIONARY_TYPE_CODE = 'NgheNghiep'                 order by LST_DICTIONARY.IDX]
2020-07-16 15:13:28,371 [1] DEBUG - Statement Id: [DAO00012_GetList] PreparedStatement : [select        DICTIONARY_ID,        DICTIONARY_CODE,        DICTIONARY_NAME,        ATTRIBUTE1,        ATTRIBUTE2,        DICTIONARY_NAME_EN,        DICTIONARY_TYPE_CODE        from LST_DICTIONARY        where LST_DICTIONARY.Enabled = '1'         AND           LST_DICTIONARY.DICTIONARY_TYPE_CODE = 'DanToc'                 order by LST_DICTIONARY.IDX]
2020-07-16 15:13:28,485 [1] DEBUG - Statement Id: [DAO00012_GetList] PreparedStatement : [select        DICTIONARY_ID,        DICTIONARY_CODE,        DICTIONARY_NAME,        ATTRIBUTE1,        ATTRIBUTE2,        DICTIONARY_NAME_EN,        DICTIONARY_TYPE_CODE        from LST_DICTIONARY        where LST_DICTIONARY.Enabled = '1'         AND           LST_DICTIONARY.DICTIONARY_TYPE_CODE = 'QuocGia'                 order by LST_DICTIONARY.IDX]
2020-07-16 15:13:28,861 [1] DEBUG - Statement Id: [DAO00012_GetList] PreparedStatement : [select        DICTIONARY_ID,        DICTIONARY_CODE,        DICTIONARY_NAME,        ATTRIBUTE1,        ATTRIBUTE2,        DICTIONARY_NAME_EN,        DICTIONARY_TYPE_CODE        from LST_DICTIONARY        where LST_DICTIONARY.Enabled = '1'         AND           LST_DICTIONARY.DICTIONARY_TYPE_CODE = 'PhanLoaiTiepNhan'                 order by LST_DICTIONARY.IDX]
2020-07-16 15:13:28,937 [1] DEBUG - Statement Id: [DAO00012_GetList] PreparedStatement : [select        DICTIONARY_ID,        DICTIONARY_CODE,        DICTIONARY_NAME,        ATTRIBUTE1,        ATTRIBUTE2,        DICTIONARY_NAME_EN,        DICTIONARY_TYPE_CODE        from LST_DICTIONARY        where LST_DICTIONARY.Enabled = '1'         AND           LST_DICTIONARY.DICTIONARY_TYPE_CODE = 'NguonBN'                 order by LST_DICTIONARY.IDX]
2020-07-16 15:13:28,961 [1] DEBUG - Statement Id: [DAO00019_GetListCongTyChiTra] PreparedStatement : [select *        from TM_CONGTYCHITRA        where        BENHVIEN_ID = '01819' AND TAMNGUNG = '0']
2020-07-16 15:13:28,985 [1] DEBUG - Statement Id: [DAO00019_GetQuanHam_TinhTrangBN] PreparedStatement : [select * from LST_DICTIONARY where DICTIONARY_TYPE_CODE = 'QuanHamBenhNhan' and ENABLED = '1']
2020-07-16 15:13:29,015 [1] DEBUG - Statement Id: [DAO00019_GetQuanHam_TinhTrangBN] PreparedStatement : [select * from LST_DICTIONARY where DICTIONARY_TYPE_CODE = 'TinhTrangBenhNhan' and ENABLED = '1']
2020-07-16 15:13:29,040 [1] DEBUG - Statement Id: [DAO00019_GetQuanHam_TinhTrangBN] PreparedStatement : [select * from LST_DICTIONARY where DICTIONARY_TYPE_CODE = 'DonViCongTac' and ENABLED = '1']
2020-07-16 15:13:29,102 [1] DEBUG - Statement Id: [DAO00403_QMS002_GetDSHangDoi_COMPUTERNAME] PreparedStatement : [SELECT B.ID,B.DEPARTMENT_ID,C.DEPARTMENT_NAME, C.DEPT_CODE, B.[NAME] as QUEUENAME,B.ID as QUEUE_ID     FROM QMS_QUEUE B     INNER JOIN QMS_DEPARTMENT C ON B.DEPARTMENT_ID=C.DEPARTMENT_ID     JOIN (SELECT DISTINCT XX.SECTION_ID FROM QMS_QUEUE XX JOIN QMS_CLIENT YY ON YY.QUEUE_ID = XX.ID     WHERE XX.DEPARTMENT_ID='87' AND (YY.COMPUTERNAME = 'DESKTOP-89GE5BA' OR YY.IPADDRESS = '10.15.167.38')) A ON A.SECTION_ID = B.SECTION_ID     WHERE B.BENHVIEN_ID = '01819' AND B.STATE = 1]
2020-07-16 15:13:29,371 [1] DEBUG - Statement Id: [DAO00017_GetListPhongKham] PreparedStatement : [select pb.PHONGBAN_ID, pb.TENPHONGBAN, case when dv.ATTRIBUTE5 is null then 'TT' else 'KTC' end as LOAI_CHIPHI              from [TM_PHONGBAN_DICHVU] as pb_dv              inner join [TM_PHONGBAN] as pb on pb.PHONGBAN_ID = pb_dv.PHONGBAN_ID and pb.BENHVIEN_ID = '01819'              inner join [TM_DICHVU] dv on dv.DICHVU_ID = pb_dv.DICHVU_ID and dv.MADICHVU = '' and dv.BENHVIEN_ID = '01819'              where pb_dv.BENHVIEN_ID = '01819']
2020-07-16 15:13:29,408 [1] DEBUG - Statement Id: [DAO00019_GetListPhongKham_REG13] PreparedStatement : [select pb.PHONGBAN_ID, pb.TENPHONGBAN, case when dv.ATTRIBUTE5 is null then 'TT' else 'KTC' end as LOAI_CHIPHI        from TM_PHONGBAN pb        left join TM_PHONGBAN_DICHVU pb_dv on pb_dv.PHONGBAN_ID = pb.PHONGBAN_ID and pb_dv.BENHVIEN_ID = pb.BENHVIEN_ID        left join TM_DICHVU dv on dv.DICHVU_ID = pb_dv.DICHVU_ID and dv.BENHVIEN_ID = pb_dv.BENHVIEN_ID        left join TM_NHOMDICHVU ndv on ndv.NHOMDICHVU_ID = dv.NHOMDICHVU_ID and ndv.BENHVIEN_ID = dv.BENHVIEN_ID        where pb.BENHVIEN_ID = '01819' and ndv.MANHOMDICHVU = '04' and dv.DICHVU_ID IS NOT NULL]
2020-07-16 15:13:29,479 [1] DEBUG - Statement Id: [DAO00019_LayThongTinSoluongDichVuPhongKham_REG13] PreparedStatement : [select PHONGBAN_ID, TENPHONGBAN, NOITHUCHIEN_ID, SUM(CHUAKETQUA) AS CHUAKETQUA, SUM(HOANTAT) AS HOANTAT, SUM(DANGTHUCHIEN) AS DANGTHUCHIEN        , SUM(BHYT) as BHYT, SUM(VIENPHI) as VIENPHI        from (        select B.PHONGBAN_ID, B.TENPHONGBAN, A.NOITHUCHIEN_ID,        case when A.TRANGTHAI = 'CHUAKETQUA' then 1 else 0 end AS CHUAKETQUA,        case when A.TRANGTHAI not in ('CHUAKETQUA','DANGTHUCHIEN','CHOXACNHAN') then 1 else 0 end AS HOANTAT,        case when A.TRANGTHAI = 'DANGTHUCHIEN' then 1 else 0 end AS DANGTHUCHIEN,        case when len(tn.SOBHYT) > 1 then 1 else 0 end as BHYT,        case when len(tn.SOBHYT) = 0 then 1 else 0 end as VIENPHI        from TM_PHONGBAN B        left join TT_DVYEUCAU A on A.NOITHUCHIEN_ID = B.PHONGBAN_ID and A.BENHVIEN_ID = B.BENHVIEN_ID and A.NGAYYEUCAU = CONVERT(date, getdate())        inner join TT_TIEPNHAN tn on tn.TIEPNHAN_ID = A.TIEPNHAN_ID        left join TM_DICHVU dv on A.DICHVU_ID = dv.DICHVU_ID        left join TM_NHOMDICHVU ndv on ndv.NHOMDICHVU_ID = dv.NHOMDICHVU_ID        where B.BENHVIEN_ID ='01819' and Left(ndv.MANHOMDICHVU,2) = '04'        and B.PHONGBAN_ID in (60,62,64,66,67,69,71,72,73,74,75,55,55,56,56,57,57,54,12,80,80,63,76,1002,79,70,68,53,53,14,14,14,61,1001)        ) tmp        group by tmp.NOITHUCHIEN_ID, tmp.TENPHONGBAN, tmp.PHONGBAN_ID]
2020-07-16 15:13:30,730 [1] DEBUG - Statement Id: [DAO00403_QMS002_GetThongTinClient] PreparedStatement : [SELECT B.ID as QUEUE_ID, B.NAME AS QUEUE_NAME,A.ID AS CLIENT_ID , A.[NAME] AS CLIENT_NAME, ISNULL(A.[STATE],1) AS [STATE],(CASE C.NAME WHEN 'UT' THEN 1 ELSE 0 END) AS QUEUETYPE     , B.DEPARTMENT_ID,ISNULL(B.SECTION_ID,-1) AS SECTION_ID,A.IPSERVER,A.NAMEAUDIO,C.QUEUE_TYPE_CODE,C.QUEUE_TYPE_CODE_SOUND,S.[NAME] AS SECTIONNAME     FROM QMS_QUEUE B LEFT JOIN QMS_CLIENT A ON A.QUEUE_ID = B.ID     LEFT JOIN QMS_QUEUE_TYPE C ON B.QUEUETYPE_ID = C.ID     LEFT JOIN QMS_SECTION S ON B.SECTION_ID=S.ID     WHERE     (A.COMPUTERNAME = 'DESKTOP-89GE5BA' OR A.IPADDRESS = '10.15.167.38') AND A.[STATE] = 1 AND B.DEPARTMENT_ID='87'            AND B.BENHVIEN_ID = '01819']
2020-07-16 15:13:39,700 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = '01819'               AND                   TM_SYS_SCREEN.PAGE = 'ADM05'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2020-07-16 15:13:40,670 [1] DEBUG - Statement Id: [DAO00205_GetAllWithoutDeactive] PreparedStatement : [SELECT DISTINCT C.CATEGORY_ID AS CATEGORY_ID            , ISNULL(C.PARENT_ID,0) AS PARENT_ID            , C.CATEGORY_CODE AS CATEGORY_CODE            , C.CATEGORY_NAME AS CATEGORY_NAME            , C.FOLDER_LEVEL            , C.IS_FOLDER            , C.FOLDER_CODE            , CASE WHEN (C.FOLDER_CODE IS NULL OR C.FOLDER_CODE = 'ROOT' OR C.FOLDER_CODE = '' )            THEN NULL ELSE C.FOLDER_CODE END AS PARENT_CODE            , C.CATEGORY_TYPE            FROM TM_CATEGORY AS C            WHERE C.ENABLED = '1'            AND C.BENHVIEN_ID = '01819' AND C.CATEGORY_ID != 0            ORDER BY C.CATEGORY_ID]
2020-07-16 15:13:44,077 [1] DEBUG - Statement Id: [DAO00012_GetList] PreparedStatement : [select        DICTIONARY_ID,        DICTIONARY_CODE,        DICTIONARY_NAME,        ATTRIBUTE1,        ATTRIBUTE2,        DICTIONARY_NAME_EN,        DICTIONARY_TYPE_CODE        from LST_DICTIONARY        where LST_DICTIONARY.Enabled = '1'         AND           LST_DICTIONARY.DICTIONARY_TYPE_CODE = 'PhanLoaiTiepNhan'                 order by LST_DICTIONARY.IDX]
2020-07-16 15:13:44,107 [1] DEBUG - Statement Id: [DAO00012_GetList] PreparedStatement : [select        DICTIONARY_ID,        DICTIONARY_CODE,        DICTIONARY_NAME,        ATTRIBUTE1,        ATTRIBUTE2,        DICTIONARY_NAME_EN,        DICTIONARY_TYPE_CODE        from LST_DICTIONARY        where LST_DICTIONARY.Enabled = '1'         AND           LST_DICTIONARY.DICTIONARY_TYPE_CODE = 'NguonBN'                 order by LST_DICTIONARY.IDX]
2020-07-16 15:13:44,133 [1] DEBUG - Statement Id: [DAO00019_GetListCongTyChiTra] PreparedStatement : [select *        from TM_CONGTYCHITRA        where        BENHVIEN_ID = '01819' AND TAMNGUNG = '0']
2020-07-16 15:13:44,158 [1] DEBUG - Statement Id: [DAO00019_GetQuanHam_TinhTrangBN] PreparedStatement : [select * from LST_DICTIONARY where DICTIONARY_TYPE_CODE = 'QuanHamBenhNhan' and ENABLED = '1']
2020-07-16 15:13:44,188 [1] DEBUG - Statement Id: [DAO00019_GetQuanHam_TinhTrangBN] PreparedStatement : [select * from LST_DICTIONARY where DICTIONARY_TYPE_CODE = 'TinhTrangBenhNhan' and ENABLED = '1']
2020-07-16 15:13:44,215 [1] DEBUG - Statement Id: [DAO00019_GetQuanHam_TinhTrangBN] PreparedStatement : [select * from LST_DICTIONARY where DICTIONARY_TYPE_CODE = 'DonViCongTac' and ENABLED = '1']
2020-07-16 15:13:44,364 [1] DEBUG - Statement Id: [DAO00403_QMS002_GetDSHangDoi_COMPUTERNAME] PreparedStatement : [SELECT B.ID,B.DEPARTMENT_ID,C.DEPARTMENT_NAME, C.DEPT_CODE, B.[NAME] as QUEUENAME,B.ID as QUEUE_ID     FROM QMS_QUEUE B     INNER JOIN QMS_DEPARTMENT C ON B.DEPARTMENT_ID=C.DEPARTMENT_ID     JOIN (SELECT DISTINCT XX.SECTION_ID FROM QMS_QUEUE XX JOIN QMS_CLIENT YY ON YY.QUEUE_ID = XX.ID     WHERE XX.DEPARTMENT_ID='87' AND (YY.COMPUTERNAME = 'DESKTOP-89GE5BA' OR YY.IPADDRESS = '10.15.167.38')) A ON A.SECTION_ID = B.SECTION_ID     WHERE B.BENHVIEN_ID = '01819' AND B.STATE = 1]
2020-07-16 15:13:44,422 [1] DEBUG - Statement Id: [DAO00017_GetListPhongKham] PreparedStatement : [select pb.PHONGBAN_ID, pb.TENPHONGBAN, case when dv.ATTRIBUTE5 is null then 'TT' else 'KTC' end as LOAI_CHIPHI              from [TM_PHONGBAN_DICHVU] as pb_dv              inner join [TM_PHONGBAN] as pb on pb.PHONGBAN_ID = pb_dv.PHONGBAN_ID and pb.BENHVIEN_ID = '01819'              inner join [TM_DICHVU] dv on dv.DICHVU_ID = pb_dv.DICHVU_ID and dv.MADICHVU = '' and dv.BENHVIEN_ID = '01819'              where pb_dv.BENHVIEN_ID = '01819']
2020-07-16 15:13:44,455 [1] DEBUG - Statement Id: [DAO00019_GetListPhongKham_REG13] PreparedStatement : [select pb.PHONGBAN_ID, pb.TENPHONGBAN, case when dv.ATTRIBUTE5 is null then 'TT' else 'KTC' end as LOAI_CHIPHI        from TM_PHONGBAN pb        left join TM_PHONGBAN_DICHVU pb_dv on pb_dv.PHONGBAN_ID = pb.PHONGBAN_ID and pb_dv.BENHVIEN_ID = pb.BENHVIEN_ID        left join TM_DICHVU dv on dv.DICHVU_ID = pb_dv.DICHVU_ID and dv.BENHVIEN_ID = pb_dv.BENHVIEN_ID        left join TM_NHOMDICHVU ndv on ndv.NHOMDICHVU_ID = dv.NHOMDICHVU_ID and ndv.BENHVIEN_ID = dv.BENHVIEN_ID        where pb.BENHVIEN_ID = '01819' and ndv.MANHOMDICHVU = '04' and dv.DICHVU_ID IS NOT NULL]
2020-07-16 15:13:44,533 [1] DEBUG - Statement Id: [DAO00019_LayThongTinSoluongDichVuPhongKham_REG13] PreparedStatement : [select PHONGBAN_ID, TENPHONGBAN, NOITHUCHIEN_ID, SUM(CHUAKETQUA) AS CHUAKETQUA, SUM(HOANTAT) AS HOANTAT, SUM(DANGTHUCHIEN) AS DANGTHUCHIEN        , SUM(BHYT) as BHYT, SUM(VIENPHI) as VIENPHI        from (        select B.PHONGBAN_ID, B.TENPHONGBAN, A.NOITHUCHIEN_ID,        case when A.TRANGTHAI = 'CHUAKETQUA' then 1 else 0 end AS CHUAKETQUA,        case when A.TRANGTHAI not in ('CHUAKETQUA','DANGTHUCHIEN','CHOXACNHAN') then 1 else 0 end AS HOANTAT,        case when A.TRANGTHAI = 'DANGTHUCHIEN' then 1 else 0 end AS DANGTHUCHIEN,        case when len(tn.SOBHYT) > 1 then 1 else 0 end as BHYT,        case when len(tn.SOBHYT) = 0 then 1 else 0 end as VIENPHI        from TM_PHONGBAN B        left join TT_DVYEUCAU A on A.NOITHUCHIEN_ID = B.PHONGBAN_ID and A.BENHVIEN_ID = B.BENHVIEN_ID and A.NGAYYEUCAU = CONVERT(date, getdate())        inner join TT_TIEPNHAN tn on tn.TIEPNHAN_ID = A.TIEPNHAN_ID        left join TM_DICHVU dv on A.DICHVU_ID = dv.DICHVU_ID        left join TM_NHOMDICHVU ndv on ndv.NHOMDICHVU_ID = dv.NHOMDICHVU_ID        where B.BENHVIEN_ID ='01819' and Left(ndv.MANHOMDICHVU,2) = '04'        and B.PHONGBAN_ID in (60,62,64,66,67,69,71,72,73,74,75,55,55,56,56,57,57,54,12,80,80,63,76,1002,79,70,68,53,53,14,14,14,61,1001)        ) tmp        group by tmp.NOITHUCHIEN_ID, tmp.TENPHONGBAN, tmp.PHONGBAN_ID]
2020-07-16 15:13:44,618 [1] DEBUG - Statement Id: [DAO00403_QMS002_GetThongTinClient] PreparedStatement : [SELECT B.ID as QUEUE_ID, B.NAME AS QUEUE_NAME,A.ID AS CLIENT_ID , A.[NAME] AS CLIENT_NAME, ISNULL(A.[STATE],1) AS [STATE],(CASE C.NAME WHEN 'UT' THEN 1 ELSE 0 END) AS QUEUETYPE     , B.DEPARTMENT_ID,ISNULL(B.SECTION_ID,-1) AS SECTION_ID,A.IPSERVER,A.NAMEAUDIO,C.QUEUE_TYPE_CODE,C.QUEUE_TYPE_CODE_SOUND,S.[NAME] AS SECTIONNAME     FROM QMS_QUEUE B LEFT JOIN QMS_CLIENT A ON A.QUEUE_ID = B.ID     LEFT JOIN QMS_QUEUE_TYPE C ON B.QUEUETYPE_ID = C.ID     LEFT JOIN QMS_SECTION S ON B.SECTION_ID=S.ID     WHERE     (A.COMPUTERNAME = 'DESKTOP-89GE5BA' OR A.IPADDRESS = '10.15.167.38') AND A.[STATE] = 1 AND B.DEPARTMENT_ID='87'            AND B.BENHVIEN_ID = '01819']
2020-07-16 15:14:13,215 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = '01819'               AND                   TM_SYS_SCREEN.PAGE = 'IPD02'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2020-07-16 15:14:13,477 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = '01819'               AND                   TM_SYS_SCREEN.PAGE = 'IPD40'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2020-07-16 15:14:13,571 [1] DEBUG - Statement Id: [DAO00403_QMS002_GetThongTinClient] PreparedStatement : [SELECT B.ID as QUEUE_ID, B.NAME AS QUEUE_NAME,A.ID AS CLIENT_ID , A.[NAME] AS CLIENT_NAME, ISNULL(A.[STATE],1) AS [STATE],(CASE C.NAME WHEN 'UT' THEN 1 ELSE 0 END) AS QUEUETYPE     , B.DEPARTMENT_ID,ISNULL(B.SECTION_ID,-1) AS SECTION_ID,A.IPSERVER,A.NAMEAUDIO,C.QUEUE_TYPE_CODE,C.QUEUE_TYPE_CODE_SOUND,S.[NAME] AS SECTIONNAME     FROM QMS_QUEUE B LEFT JOIN QMS_CLIENT A ON A.QUEUE_ID = B.ID     LEFT JOIN QMS_QUEUE_TYPE C ON B.QUEUETYPE_ID = C.ID     LEFT JOIN QMS_SECTION S ON B.SECTION_ID=S.ID     WHERE     (A.COMPUTERNAME = 'DESKTOP-89GE5BA' OR A.IPADDRESS = '10.15.167.38') AND A.[STATE] = 1 AND B.DEPARTMENT_ID='87'            AND B.BENHVIEN_ID = '01819']
2020-07-16 15:14:13,681 [1] DEBUG - Statement Id: [DAO00069_GetCountDanhSachNoiTru] PreparedStatement : [select count(A.SOBENHAN) as TOTALROWS        from TT_NOITRU_BENHAN A        inner join TT_TIEPNHAN B on B.TIEPNHAN_ID = A.TIEPNHAN_ID and (B.TRANGTHAI = 'NOITRU' or B.TRANGTHAI = 'HOANTHANH')        inner join TT_BENHNHAN C on C.BENHNHAN_ID = B.BENHNHAN_ID        left join TT_NOITRU_LUUTRU D on D.BENHAN_ID = A.BENHAN_ID        and D.LUUTRU_ID = ( select top 1 LUUTRU_ID from TT_NOITRU_LUUTRU where BENHAN_ID = A.BENHAN_ID order by BENHAN_ID desc)        left join TT_NOITRU_XACNHAN E on E.BENHAN_ID = A.BENHAN_ID        left join TT_NOITRU_LUUTRUCHITIET F on D.LUUTRU_ID = F.LUUTRU_ID and F.LUUTRUCHITIET_CURRENT = '1'        and F.LUUTRUCHITIET_ID in (select top 1 LUUTRUCHITIET_ID from TT_NOITRU_LUUTRUCHITIET where LUUTRU_ID = D.LUUTRU_ID order by LUUTRUCHITIET_ID desc)        where        A.KHOACHUYENDEN_ID is not null  and        (E.TRANGTHAI = 'DAXACNHAN' OR E.TRANGTHAI = 'HUYXACNHAN')         and           cast(A.NGAYVAOKHOA as date) <= cast('7/16/2020 12:00:00 AM' as date)                 and B.BENHVIEN_ID = '01819' and A.KHOACHUYENDEN_ID = '87'          AND             A.TRANGTHAI in ('DANGDIEUTRI')]
2020-07-16 15:14:13,835 [1] DEBUG - Statement Id: [DAO00069_GetDanhSachNoiTru] PreparedStatement : [select * from        (        SELECT ROW_NUMBER() OVER(order by B.SOTIEPNHAN) as ROWNUMBER,          A.SOBENHAN, A.BENHAN_ID, A.SOLUUTRU                 , E.NOILAP_ID as KHOAVAO_ID        , A.TRANGTHAI, IsNull(A.BACSIDIEUTRI_ID, E.BACSICHIDINH_ID) as BACSIDIEUTRI_ID,        B.TIEPNHAN_ID, B.SOTIEPNHAN, B.SOBHYT as SOTHE, B.DOITUONG_ID, A.NGAYVAOKHOA as NGAYCAPCUU, A.THOIGIANVAOKHOA as THOIGIANCAPCUU,        C.TENBENHNHAN, C.NGAYSINH, C.NAMSINH, C.BENHNHAN_ID, C.MAYTE, F.GIUONGBENH_ID, A.THOIGIANRAVIEN    , DIACHITHUONGTRU, DANTOC_ID        ,BENHVIEN_STT_ID                from TT_NOITRU_BENHAN A        inner join TT_TIEPNHAN B on B.TIEPNHAN_ID = A.TIEPNHAN_ID and (B.TRANGTHAI = 'NOITRU' or B.TRANGTHAI = 'HOANTHANH')        inner join TT_BENHNHAN C on C.BENHNHAN_ID = B.BENHNHAN_ID        left join TT_NOITRU_LUUTRU D on D.BENHAN_ID = A.BENHAN_ID        and D.LUUTRU_ID = ( select top 1 LUUTRU_ID from TT_NOITRU_LUUTRU where BENHAN_ID = A.BENHAN_ID order by LUUTRU_ID desc)        left join TT_NOITRU_XACNHAN E on E.BENHAN_ID = A.BENHAN_ID        left join TT_NOITRU_LUUTRUCHITIET F on D.LUUTRU_ID = F.LUUTRU_ID and F.LUUTRUCHITIET_CURRENT = '1'        and F.LUUTRUCHITIET_ID in (select top 1 LUUTRUCHITIET_ID from TT_NOITRU_LUUTRUCHITIET where LUUTRU_ID = D.LUUTRU_ID order by LUUTRUCHITIET_ID desc)        left join (select MABENHVIEN, BENHVIEN_STT_ID from TM_BENHVIEN) H on SUBSTRING(B.SOBHYT, 16, 5)=H.MABENHVIEN        where        A.KHOACHUYENDEN_ID is not null  and        (E.TRANGTHAI = 'DAXACNHAN' OR E.TRANGTHAI = 'HUYXACNHAN')         and           cast(A.NGAYVAOKHOA as date) <= cast('7/16/2020 12:00:00 AM' as date)                 and B.BENHVIEN_ID = '01819' and A.KHOACHUYENDEN_ID = '87'          AND             A.TRANGTHAI in ('DANGDIEUTRI')                   ) lst        where        lst.ROWNUMBER between 1 and 19        order by lst.SOTIEPNHAN]
2020-07-16 15:14:13,915 [1] DEBUG - Statement Id: [DAO00403_QMS002_GetThongTinClient] PreparedStatement : [SELECT B.ID as QUEUE_ID, B.NAME AS QUEUE_NAME,A.ID AS CLIENT_ID , A.[NAME] AS CLIENT_NAME, ISNULL(A.[STATE],1) AS [STATE],(CASE C.NAME WHEN 'UT' THEN 1 ELSE 0 END) AS QUEUETYPE     , B.DEPARTMENT_ID,ISNULL(B.SECTION_ID,-1) AS SECTION_ID,A.IPSERVER,A.NAMEAUDIO,C.QUEUE_TYPE_CODE,C.QUEUE_TYPE_CODE_SOUND,S.[NAME] AS SECTIONNAME     FROM QMS_QUEUE B LEFT JOIN QMS_CLIENT A ON A.QUEUE_ID = B.ID     LEFT JOIN QMS_QUEUE_TYPE C ON B.QUEUETYPE_ID = C.ID     LEFT JOIN QMS_SECTION S ON B.SECTION_ID=S.ID     WHERE     (A.COMPUTERNAME = 'DESKTOP-89GE5BA' OR A.IPADDRESS = '10.15.167.38') AND A.[STATE] = 1 AND B.DEPARTMENT_ID='87'            AND B.BENHVIEN_ID = '01819']
2020-07-16 15:14:13,942 [1] DEBUG - Statement Id: [DAO00069_GetCountDanhSachNoiTru] PreparedStatement : [select count(A.SOBENHAN) as TOTALROWS        from TT_NOITRU_BENHAN A        inner join TT_TIEPNHAN B on B.TIEPNHAN_ID = A.TIEPNHAN_ID and (B.TRANGTHAI = 'NOITRU' or B.TRANGTHAI = 'HOANTHANH')        inner join TT_BENHNHAN C on C.BENHNHAN_ID = B.BENHNHAN_ID        left join TT_NOITRU_LUUTRU D on D.BENHAN_ID = A.BENHAN_ID        and D.LUUTRU_ID = ( select top 1 LUUTRU_ID from TT_NOITRU_LUUTRU where BENHAN_ID = A.BENHAN_ID order by BENHAN_ID desc)        left join TT_NOITRU_XACNHAN E on E.BENHAN_ID = A.BENHAN_ID        left join TT_NOITRU_LUUTRUCHITIET F on D.LUUTRU_ID = F.LUUTRU_ID and F.LUUTRUCHITIET_CURRENT = '1'        and F.LUUTRUCHITIET_ID in (select top 1 LUUTRUCHITIET_ID from TT_NOITRU_LUUTRUCHITIET where LUUTRU_ID = D.LUUTRU_ID order by LUUTRUCHITIET_ID desc)        where        A.KHOACHUYENDEN_ID is not null  and        (E.TRANGTHAI = 'DAXACNHAN' OR E.TRANGTHAI = 'HUYXACNHAN')         and           cast(A.NGAYVAOKHOA as date) <= cast('7/16/2020 12:00:00 AM' as date)                 and B.BENHVIEN_ID = '01819' and A.KHOACHUYENDEN_ID = '87'          AND             A.TRANGTHAI in ('DANGDIEUTRI')]
2020-07-16 15:14:14,016 [1] DEBUG - Statement Id: [DAO00069_GetDanhSachNoiTru] PreparedStatement : [select * from        (        SELECT ROW_NUMBER() OVER(order by B.SOTIEPNHAN) as ROWNUMBER,          A.SOBENHAN, A.BENHAN_ID, A.SOLUUTRU                 , E.NOILAP_ID as KHOAVAO_ID        , A.TRANGTHAI, IsNull(A.BACSIDIEUTRI_ID, E.BACSICHIDINH_ID) as BACSIDIEUTRI_ID,        B.TIEPNHAN_ID, B.SOTIEPNHAN, B.SOBHYT as SOTHE, B.DOITUONG_ID, A.NGAYVAOKHOA as NGAYCAPCUU, A.THOIGIANVAOKHOA as THOIGIANCAPCUU,        C.TENBENHNHAN, C.NGAYSINH, C.NAMSINH, C.BENHNHAN_ID, C.MAYTE, F.GIUONGBENH_ID, A.THOIGIANRAVIEN    , DIACHITHUONGTRU, DANTOC_ID        ,BENHVIEN_STT_ID                from TT_NOITRU_BENHAN A        inner join TT_TIEPNHAN B on B.TIEPNHAN_ID = A.TIEPNHAN_ID and (B.TRANGTHAI = 'NOITRU' or B.TRANGTHAI = 'HOANTHANH')        inner join TT_BENHNHAN C on C.BENHNHAN_ID = B.BENHNHAN_ID        left join TT_NOITRU_LUUTRU D on D.BENHAN_ID = A.BENHAN_ID        and D.LUUTRU_ID = ( select top 1 LUUTRU_ID from TT_NOITRU_LUUTRU where BENHAN_ID = A.BENHAN_ID order by LUUTRU_ID desc)        left join TT_NOITRU_XACNHAN E on E.BENHAN_ID = A.BENHAN_ID        left join TT_NOITRU_LUUTRUCHITIET F on D.LUUTRU_ID = F.LUUTRU_ID and F.LUUTRUCHITIET_CURRENT = '1'        and F.LUUTRUCHITIET_ID in (select top 1 LUUTRUCHITIET_ID from TT_NOITRU_LUUTRUCHITIET where LUUTRU_ID = D.LUUTRU_ID order by LUUTRUCHITIET_ID desc)        left join (select MABENHVIEN, BENHVIEN_STT_ID from TM_BENHVIEN) H on SUBSTRING(B.SOBHYT, 16, 5)=H.MABENHVIEN        where        A.KHOACHUYENDEN_ID is not null  and        (E.TRANGTHAI = 'DAXACNHAN' OR E.TRANGTHAI = 'HUYXACNHAN')         and           cast(A.NGAYVAOKHOA as date) <= cast('7/16/2020 12:00:00 AM' as date)                 and B.BENHVIEN_ID = '01819' and A.KHOACHUYENDEN_ID = '87'          AND             A.TRANGTHAI in ('DANGDIEUTRI')                   ) lst        where        lst.ROWNUMBER between 1 and 19        order by lst.SOTIEPNHAN]
2020-07-16 15:14:25,248 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = '01819'               AND                   TM_SYS_SCREEN.PAGE = 'COM98'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2020-07-16 15:14:25,431 [1] DEBUG - Statement Id: [DAO00028_GetList] PreparedStatement : [select KHODUOC_ID,MAKHO, TENKHO, LOAIKHO_ID, LOAIDUOC, PHAMVI_ID, CHUYENKHOA_ID, PHONGBAN_ID,              CASE WHEN KHOQUANLY_ID IS NULL THEN 0  ELSE KHOQUANLY_ID  END  AS KHOQUANLY_ID,              lst.DICTIONARY_CODE  LOAIKHO              from TM_KHODUOC kd              left join LST_DICTIONARY lst on lst.DICTIONARY_ID = kd.LOAIKHO_ID and lst.DICTIONARY_TYPE_CODE = 'LoaiKhoDuoc'              where kd.TAMNGUNG = '0'              and kd.BENHVIEN_ID = '01819'              order by kd.TENKHO]
2020-07-16 15:14:25,633 [1] DEBUG - Statement Id: [DAO00017_GetList] PreparedStatement : [select A.*, B.DICTIONARY_CODE from TM_PHONGBAN A            inner join LST_DICTIONARY B on A.LOAIPHONGBAN_ID = B.DICTIONARY_ID            and B.DICTIONARY_TYPE_CODE = 'LoaiPhongBan'            where A.BENHVIEN_ID = '01819' AND A.TAMNGUNG = '0'  order by A.TENPHONGBAN asc]
2020-07-16 15:14:25,835 [1] DEBUG - Statement Id: [DAO00020_ListKhoDuocOfPhongBan] PreparedStatement : [select B.* from TM_PHONGBAN_KHODUOC A        inner join TM_KHODUOC B on B.KHODUOC_ID = A.KHODUOC_ID        where        A.PHONGBAN_ID = '87'        and A.BENHVIEN_ID = '01819']
2020-07-16 15:14:35,044 [1] DEBUG - Statement Id: [DAO00020_ListKhoDuocOfPhongBan] PreparedStatement : [select B.* from TM_PHONGBAN_KHODUOC A        inner join TM_KHODUOC B on B.KHODUOC_ID = A.KHODUOC_ID        where        A.PHONGBAN_ID = '25'        and A.BENHVIEN_ID = '01819']
2020-07-16 15:14:36,001 [1] DEBUG - Statement Id: [DAO00008_UpdateUserIdPhongBanKhoDuoc] PreparedStatement : [IF EXISTS            (SELECT ACCOUNT_ID FROM TM_SYS_USERS WHERE ACCOUNT_ID =  @param0  and HOSPITAL_ID =  @param1 )            BEGIN            update TM_SYS_USERS set INVENTORY_ID =  @param2 , WORKING_DEPT_ID =  @param3             WHERE ACCOUNT_ID =  @param0  and HOSPITAL_ID =  @param1             END            ELSE            BEGIN            insert into TM_SYS_USERS ([ACCOUNT_ID], [ACCOUNT_NAME], [INVENTORY_ID], [WORKING_DEPT_ID], [HOSPITAL_ID])            values ( @param0 ,  @param4 ,  @param2 ,  @param3 ,  @param1 )            END]
2020-07-16 15:14:36,001 [1] DEBUG - Statement Id: [DAO00008_UpdateUserIdPhongBanKhoDuoc] Parameters: [@param0=[ACCOUNT_ID,113], @param1=[HOSPITAL_ID,01819], @param2=[INVENTORY_ID,1020], @param3=[WORKING_DEPT_ID,25], @param4=[ACCOUNT_NAME,admin]]
2020-07-16 15:14:36,001 [1] DEBUG - Statement Id: [DAO00008_UpdateUserIdPhongBanKhoDuoc] Types: [@param0=[String, System.String], @param1=[String, System.String], @param2=[String, System.String], @param3=[String, System.String], @param4=[String, System.String]]
2020-07-16 15:14:36,268 [1] DEBUG - Statement Id: [DAO00087_GetServiceParams] PreparedStatement : [select CODE, VALUE              from TM_SYS_APPSETTINGS              where LOCKED = '0' and BENHVIEN_ID = '01819']
2020-07-16 15:14:36,466 [1] DEBUG - Statement Id: [DAO00030_CheckLoaiPhongBan] PreparedStatement : [select pb.*  from TM_PHONGBAN pb          join LST_DICTIONARY dic on pb.LOAIPHONGBAN_ID = dic.DICTIONARY_ID          where          pb.PHONGBAN_ID = 25          and dic.DICTIONARY_CODE = '']
2020-07-16 15:14:46,332 [1] DEBUG - Statement Id: [DAO00403_QMS002_GetThongTinClient] PreparedStatement : [SELECT B.ID as QUEUE_ID, B.NAME AS QUEUE_NAME,A.ID AS CLIENT_ID , A.[NAME] AS CLIENT_NAME, ISNULL(A.[STATE],1) AS [STATE],(CASE C.NAME WHEN 'UT' THEN 1 ELSE 0 END) AS QUEUETYPE     , B.DEPARTMENT_ID,ISNULL(B.SECTION_ID,-1) AS SECTION_ID,A.IPSERVER,A.NAMEAUDIO,C.QUEUE_TYPE_CODE,C.QUEUE_TYPE_CODE_SOUND,S.[NAME] AS SECTIONNAME     FROM QMS_QUEUE B LEFT JOIN QMS_CLIENT A ON A.QUEUE_ID = B.ID     LEFT JOIN QMS_QUEUE_TYPE C ON B.QUEUETYPE_ID = C.ID     LEFT JOIN QMS_SECTION S ON B.SECTION_ID=S.ID     WHERE     (A.COMPUTERNAME = 'DESKTOP-89GE5BA' OR A.IPADDRESS = '10.15.167.38') AND A.[STATE] = 1 AND B.DEPARTMENT_ID='25'            AND B.BENHVIEN_ID = '01819']
2020-07-16 15:14:46,379 [1] DEBUG - Statement Id: [DAO00069_GetCountDanhSachNoiTru] PreparedStatement : [select count(A.SOBENHAN) as TOTALROWS        from TT_NOITRU_BENHAN A        inner join TT_TIEPNHAN B on B.TIEPNHAN_ID = A.TIEPNHAN_ID and (B.TRANGTHAI = 'NOITRU' or B.TRANGTHAI = 'HOANTHANH')        inner join TT_BENHNHAN C on C.BENHNHAN_ID = B.BENHNHAN_ID        left join TT_NOITRU_LUUTRU D on D.BENHAN_ID = A.BENHAN_ID        and D.LUUTRU_ID = ( select top 1 LUUTRU_ID from TT_NOITRU_LUUTRU where BENHAN_ID = A.BENHAN_ID order by BENHAN_ID desc)        left join TT_NOITRU_XACNHAN E on E.BENHAN_ID = A.BENHAN_ID        left join TT_NOITRU_LUUTRUCHITIET F on D.LUUTRU_ID = F.LUUTRU_ID and F.LUUTRUCHITIET_CURRENT = '1'        and F.LUUTRUCHITIET_ID in (select top 1 LUUTRUCHITIET_ID from TT_NOITRU_LUUTRUCHITIET where LUUTRU_ID = D.LUUTRU_ID order by LUUTRUCHITIET_ID desc)        where        A.KHOACHUYENDEN_ID is not null  and        (E.TRANGTHAI = 'DAXACNHAN' OR E.TRANGTHAI = 'HUYXACNHAN')         and           cast(A.NGAYVAOKHOA as date) <= cast('7/16/2020 12:00:00 AM' as date)                 and B.BENHVIEN_ID = '01819' and A.KHOACHUYENDEN_ID = '25'          AND             A.TRANGTHAI in ('DANGDIEUTRI')]
2020-07-16 15:14:46,515 [1] DEBUG - Statement Id: [DAO00069_GetDanhSachNoiTru] PreparedStatement : [select * from        (        SELECT ROW_NUMBER() OVER(order by B.SOTIEPNHAN) as ROWNUMBER,          A.SOBENHAN, A.BENHAN_ID, A.SOLUUTRU                 , E.NOILAP_ID as KHOAVAO_ID        , A.TRANGTHAI, IsNull(A.BACSIDIEUTRI_ID, E.BACSICHIDINH_ID) as BACSIDIEUTRI_ID,        B.TIEPNHAN_ID, B.SOTIEPNHAN, B.SOBHYT as SOTHE, B.DOITUONG_ID, A.NGAYVAOKHOA as NGAYCAPCUU, A.THOIGIANVAOKHOA as THOIGIANCAPCUU,        C.TENBENHNHAN, C.NGAYSINH, C.NAMSINH, C.BENHNHAN_ID, C.MAYTE, F.GIUONGBENH_ID, A.THOIGIANRAVIEN    , DIACHITHUONGTRU, DANTOC_ID        ,BENHVIEN_STT_ID                from TT_NOITRU_BENHAN A        inner join TT_TIEPNHAN B on B.TIEPNHAN_ID = A.TIEPNHAN_ID and (B.TRANGTHAI = 'NOITRU' or B.TRANGTHAI = 'HOANTHANH')        inner join TT_BENHNHAN C on C.BENHNHAN_ID = B.BENHNHAN_ID        left join TT_NOITRU_LUUTRU D on D.BENHAN_ID = A.BENHAN_ID        and D.LUUTRU_ID = ( select top 1 LUUTRU_ID from TT_NOITRU_LUUTRU where BENHAN_ID = A.BENHAN_ID order by LUUTRU_ID desc)        left join TT_NOITRU_XACNHAN E on E.BENHAN_ID = A.BENHAN_ID        left join TT_NOITRU_LUUTRUCHITIET F on D.LUUTRU_ID = F.LUUTRU_ID and F.LUUTRUCHITIET_CURRENT = '1'        and F.LUUTRUCHITIET_ID in (select top 1 LUUTRUCHITIET_ID from TT_NOITRU_LUUTRUCHITIET where LUUTRU_ID = D.LUUTRU_ID order by LUUTRUCHITIET_ID desc)        left join (select MABENHVIEN, BENHVIEN_STT_ID from TM_BENHVIEN) H on SUBSTRING(B.SOBHYT, 16, 5)=H.MABENHVIEN        where        A.KHOACHUYENDEN_ID is not null  and        (E.TRANGTHAI = 'DAXACNHAN' OR E.TRANGTHAI = 'HUYXACNHAN')         and           cast(A.NGAYVAOKHOA as date) <= cast('7/16/2020 12:00:00 AM' as date)                 and B.BENHVIEN_ID = '01819' and A.KHOACHUYENDEN_ID = '25'          AND             A.TRANGTHAI in ('DANGDIEUTRI')                   ) lst        where        lst.ROWNUMBER between 1 and 19        order by lst.SOTIEPNHAN]
2020-07-16 15:14:46,743 [1] DEBUG - Statement Id: [DAO00018_GetList] PreparedStatement : [select A.*, B.DICTIONARY_NAME, B.DICTIONARY_CODE, B.DICTIONARY_NAME_EN CHUCDANH, (B.DICTIONARY_NAME_EN + '. ' + A.TENNHANVIEN) TENHOCVIHOCHAM            from TM_NHANVIEN A            left join (select * from LST_DICTIONARY where DICTIONARY_TYPE_CODE = 'chucdanh' and DICTIONARY_NAME_EN is not null) B on A.CHUCDANH_ID = B.DICTIONARY_ID            where A.BENHVIEN_ID = '01819' and A.TAMNGUNG = '0']
2020-07-16 15:14:47,864 [1] DEBUG - Statement Id: [DAO00070_GetList] PreparedStatement : [select * from TM_GIUONGBENH              where TAMNGUNG = 0 and BENHVIEN_ID = '01819']
2020-07-16 15:14:48,236 [1] DEBUG - Statement Id: [DAO00403_QMS002_GetThongTinClient] PreparedStatement : [SELECT B.ID as QUEUE_ID, B.NAME AS QUEUE_NAME,A.ID AS CLIENT_ID , A.[NAME] AS CLIENT_NAME, ISNULL(A.[STATE],1) AS [STATE],(CASE C.NAME WHEN 'UT' THEN 1 ELSE 0 END) AS QUEUETYPE     , B.DEPARTMENT_ID,ISNULL(B.SECTION_ID,-1) AS SECTION_ID,A.IPSERVER,A.NAMEAUDIO,C.QUEUE_TYPE_CODE,C.QUEUE_TYPE_CODE_SOUND,S.[NAME] AS SECTIONNAME     FROM QMS_QUEUE B LEFT JOIN QMS_CLIENT A ON A.QUEUE_ID = B.ID     LEFT JOIN QMS_QUEUE_TYPE C ON B.QUEUETYPE_ID = C.ID     LEFT JOIN QMS_SECTION S ON B.SECTION_ID=S.ID     WHERE     (A.COMPUTERNAME = 'DESKTOP-89GE5BA' OR A.IPADDRESS = '10.15.167.38') AND A.[STATE] = 1 AND B.DEPARTMENT_ID='25'            AND B.BENHVIEN_ID = '01819']
2020-07-16 15:14:48,271 [1] DEBUG - Statement Id: [DAO00069_GetCountDanhSachNoiTru] PreparedStatement : [select count(A.SOBENHAN) as TOTALROWS        from TT_NOITRU_BENHAN A        inner join TT_TIEPNHAN B on B.TIEPNHAN_ID = A.TIEPNHAN_ID and (B.TRANGTHAI = 'NOITRU' or B.TRANGTHAI = 'HOANTHANH')        inner join TT_BENHNHAN C on C.BENHNHAN_ID = B.BENHNHAN_ID        left join TT_NOITRU_LUUTRU D on D.BENHAN_ID = A.BENHAN_ID        and D.LUUTRU_ID = ( select top 1 LUUTRU_ID from TT_NOITRU_LUUTRU where BENHAN_ID = A.BENHAN_ID order by BENHAN_ID desc)        left join TT_NOITRU_XACNHAN E on E.BENHAN_ID = A.BENHAN_ID        left join TT_NOITRU_LUUTRUCHITIET F on D.LUUTRU_ID = F.LUUTRU_ID and F.LUUTRUCHITIET_CURRENT = '1'        and F.LUUTRUCHITIET_ID in (select top 1 LUUTRUCHITIET_ID from TT_NOITRU_LUUTRUCHITIET where LUUTRU_ID = D.LUUTRU_ID order by LUUTRUCHITIET_ID desc)        where        A.KHOACHUYENDEN_ID is not null  and        (E.TRANGTHAI = 'DAXACNHAN' OR E.TRANGTHAI = 'HUYXACNHAN')         and           cast(A.NGAYVAOKHOA as date) <= cast('7/16/2020 12:00:00 AM' as date)                 and B.BENHVIEN_ID = '01819' and A.KHOACHUYENDEN_ID = '25'          AND             A.TRANGTHAI in ('DANGDIEUTRI')]
2020-07-16 15:14:48,348 [1] DEBUG - Statement Id: [DAO00069_GetDanhSachNoiTru] PreparedStatement : [select * from        (        SELECT ROW_NUMBER() OVER(order by B.SOTIEPNHAN) as ROWNUMBER,          A.SOBENHAN, A.BENHAN_ID, A.SOLUUTRU                 , E.NOILAP_ID as KHOAVAO_ID        , A.TRANGTHAI, IsNull(A.BACSIDIEUTRI_ID, E.BACSICHIDINH_ID) as BACSIDIEUTRI_ID,        B.TIEPNHAN_ID, B.SOTIEPNHAN, B.SOBHYT as SOTHE, B.DOITUONG_ID, A.NGAYVAOKHOA as NGAYCAPCUU, A.THOIGIANVAOKHOA as THOIGIANCAPCUU,        C.TENBENHNHAN, C.NGAYSINH, C.NAMSINH, C.BENHNHAN_ID, C.MAYTE, F.GIUONGBENH_ID, A.THOIGIANRAVIEN    , DIACHITHUONGTRU, DANTOC_ID        ,BENHVIEN_STT_ID                from TT_NOITRU_BENHAN A        inner join TT_TIEPNHAN B on B.TIEPNHAN_ID = A.TIEPNHAN_ID and (B.TRANGTHAI = 'NOITRU' or B.TRANGTHAI = 'HOANTHANH')        inner join TT_BENHNHAN C on C.BENHNHAN_ID = B.BENHNHAN_ID        left join TT_NOITRU_LUUTRU D on D.BENHAN_ID = A.BENHAN_ID        and D.LUUTRU_ID = ( select top 1 LUUTRU_ID from TT_NOITRU_LUUTRU where BENHAN_ID = A.BENHAN_ID order by LUUTRU_ID desc)        left join TT_NOITRU_XACNHAN E on E.BENHAN_ID = A.BENHAN_ID        left join TT_NOITRU_LUUTRUCHITIET F on D.LUUTRU_ID = F.LUUTRU_ID and F.LUUTRUCHITIET_CURRENT = '1'        and F.LUUTRUCHITIET_ID in (select top 1 LUUTRUCHITIET_ID from TT_NOITRU_LUUTRUCHITIET where LUUTRU_ID = D.LUUTRU_ID order by LUUTRUCHITIET_ID desc)        left join (select MABENHVIEN, BENHVIEN_STT_ID from TM_BENHVIEN) H on SUBSTRING(B.SOBHYT, 16, 5)=H.MABENHVIEN        where        A.KHOACHUYENDEN_ID is not null  and        (E.TRANGTHAI = 'DAXACNHAN' OR E.TRANGTHAI = 'HUYXACNHAN')         and           cast(A.NGAYVAOKHOA as date) <= cast('7/16/2020 12:00:00 AM' as date)                 and B.BENHVIEN_ID = '01819' and A.KHOACHUYENDEN_ID = '25'          AND             A.TRANGTHAI in ('DANGDIEUTRI')                   ) lst        where        lst.ROWNUMBER between 1 and 19        order by lst.SOTIEPNHAN]
2020-07-16 15:14:51,274 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = '01819'               AND                   TM_SYS_SCREEN.PAGE = 'COM31'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2020-07-16 15:14:51,372 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = '01819'               AND                   TM_SYS_SCREEN.PAGE = 'IPD03'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2020-07-16 15:14:51,628 [1] DEBUG - Statement Id: [DAO00012_GetList] PreparedStatement : [select        DICTIONARY_ID,        DICTIONARY_CODE,        DICTIONARY_NAME,        ATTRIBUTE1,        ATTRIBUTE2,        DICTIONARY_NAME_EN,        DICTIONARY_TYPE_CODE        from LST_DICTIONARY        where LST_DICTIONARY.Enabled = '1'         AND           LST_DICTIONARY.DICTIONARY_TYPE_CODE = 'YeuToRH'                 order by LST_DICTIONARY.IDX]
2020-07-16 15:14:51,671 [1] DEBUG - Statement Id: [DAO00012_GetList] PreparedStatement : [select        DICTIONARY_ID,        DICTIONARY_CODE,        DICTIONARY_NAME,        ATTRIBUTE1,        ATTRIBUTE2,        DICTIONARY_NAME_EN,        DICTIONARY_TYPE_CODE        from LST_DICTIONARY        where LST_DICTIONARY.Enabled = '1'         AND           LST_DICTIONARY.DICTIONARY_TYPE_CODE = 'NhomMau'                 order by LST_DICTIONARY.IDX]
2020-07-16 15:14:51,883 [1] DEBUG - Statement Id: [DAO00012_GetList] PreparedStatement : [select        DICTIONARY_ID,        DICTIONARY_CODE,        DICTIONARY_NAME,        ATTRIBUTE1,        ATTRIBUTE2,        DICTIONARY_NAME_EN,        DICTIONARY_TYPE_CODE        from LST_DICTIONARY        where LST_DICTIONARY.Enabled = '1'         AND           LST_DICTIONARY.DICTIONARY_TYPE_CODE = 'LyDoXuatVien'                 order by LST_DICTIONARY.IDX]
2020-07-16 15:14:51,925 [1] DEBUG - Statement Id: [DAO00012_GetList] PreparedStatement : [select        DICTIONARY_ID,        DICTIONARY_CODE,        DICTIONARY_NAME,        ATTRIBUTE1,        ATTRIBUTE2,        DICTIONARY_NAME_EN,        DICTIONARY_TYPE_CODE        from LST_DICTIONARY        where LST_DICTIONARY.Enabled = '1'         AND           LST_DICTIONARY.DICTIONARY_TYPE_CODE = 'DM_ChuyenVien'                 order by LST_DICTIONARY.IDX]
2020-07-16 15:14:52,034 [1] DEBUG - Statement Id: [DAO00012_GetList] PreparedStatement : [select        DICTIONARY_ID,        DICTIONARY_CODE,        DICTIONARY_NAME,        ATTRIBUTE1,        ATTRIBUTE2,        DICTIONARY_NAME_EN,        DICTIONARY_TYPE_CODE        from LST_DICTIONARY        where LST_DICTIONARY.Enabled = '1'         AND           LST_DICTIONARY.DICTIONARY_TYPE_CODE = 'KetQuaDieuTri'                 order by LST_DICTIONARY.IDX]
2020-07-16 15:14:52,076 [1] DEBUG - Statement Id: [DAO00012_GetList] PreparedStatement : [select        DICTIONARY_ID,        DICTIONARY_CODE,        DICTIONARY_NAME,        ATTRIBUTE1,        ATTRIBUTE2,        DICTIONARY_NAME_EN,        DICTIONARY_TYPE_CODE        from LST_DICTIONARY        where LST_DICTIONARY.Enabled = '1'         AND           LST_DICTIONARY.DICTIONARY_TYPE_CODE = 'TuVongPhauThuat'                 order by LST_DICTIONARY.IDX]
2020-07-16 15:14:52,123 [1] DEBUG - Statement Id: [DAO00012_GetList] PreparedStatement : [select        DICTIONARY_ID,        DICTIONARY_CODE,        DICTIONARY_NAME,        ATTRIBUTE1,        ATTRIBUTE2,        DICTIONARY_NAME_EN,        DICTIONARY_TYPE_CODE        from LST_DICTIONARY        where LST_DICTIONARY.Enabled = '1'         AND           LST_DICTIONARY.DICTIONARY_TYPE_CODE = 'NguyenNhanTuVong'                 order by LST_DICTIONARY.IDX]
2020-07-16 15:14:53,021 [1] DEBUG - Statement Id: [DAO00059_GetList] PreparedStatement : [select A.* from TM_PHONGBAN A            inner join LST_DICTIONARY B on A.LOAIPHONGBAN_ID = B.DICTIONARY_ID            and B.DICTIONARY_TYPE_CODE = 'LoaiPhongBan' and (B.DICTIONARY_CODE = 'KhoaNoi' or B.DICTIONARY_CODE = 'KhoaNgoai')            where A.BENHVIEN_ID = '01819'            and A.MAPHONGBAN != '' AND A.TAMNGUNG = '0' order by A.TENPHONGBAN asc]
2020-07-16 15:14:53,307 [1] DEBUG - Statement Id: [DAO00080_KiemtraBenhAnDaThanhToan] PreparedStatement : [select DAXACNHANDOANHTHU        from TT_NOITRU_BENHAN where        BENHAN_ID = '4088'        and BENHVIEN_ID = '01819'        Order By BENHAN_ID Desc]
2020-07-16 15:14:53,383 [1] DEBUG - Statement Id: [DAO00061_GetBenhAnDetailByID] PreparedStatement : [select A.*, B.NOIGIOITHIEU_ID, C.KHOADIEUTRI_ID, A.ICD_BENHCHINH AS ICD_BENHCHINH_BAK, A.CDRAVIEN_CHINH AS CHANDOANRAVIEN1, B.THOIGIANTIEPNHAN        , A.CDRAVIEN_CHINH AS CHANDOANRAVIEN_BAK        from TT_NOITRU_BENHAN A        left join TT_TIEPNHAN B on B.TIEPNHAN_ID = A.TIEPNHAN_ID        left join TT_NOITRU_NHAPVIEN C on C.TIEPNHAN_ID = B.TIEPNHAN_ID        where A.BENHAN_ID = '4088']
2020-07-16 15:14:53,486 [1] DEBUG - Statement Id: [DAO00080_GetNoiTruLuuTruBenhAn] PreparedStatement : [select *        from TT_NOITRU_LUUTRU where        BENHAN_ID = '4088'        and BENHVIEN_ID = '01819'        Order By LUUTRU_ID ASC]
2020-07-16 15:14:53,513 [1] DEBUG - Statement Id: [DAO00017_GetList] PreparedStatement : [select A.*, B.DICTIONARY_CODE from TM_PHONGBAN A            inner join LST_DICTIONARY B on A.LOAIPHONGBAN_ID = B.DICTIONARY_ID            and B.DICTIONARY_TYPE_CODE = 'LoaiPhongBan'            where A.BENHVIEN_ID = '01819' AND A.TAMNGUNG = '0'  order by A.TENPHONGBAN asc]
2020-07-16 15:14:53,621 [1] DEBUG - Statement Id: [DAO00080_GetGiuongBenhCuaBenhAn] PreparedStatement : [select *        from TT_NOITRU_GIUONGBENH where        BENHAN_ID =  @param0  and BENHVIEN_ID = '01819']
2020-07-16 15:14:53,621 [1] DEBUG - Statement Id: [DAO00080_GetGiuongBenhCuaBenhAn] Parameters: [@param0=[BENHAN_ID,4088]]
2020-07-16 15:14:53,621 [1] DEBUG - Statement Id: [DAO00080_GetGiuongBenhCuaBenhAn] Types: [@param0=[Int64, System.Int64]]
2020-07-16 15:14:53,726 [1] DEBUG - Statement Id: [DAO00013_GetDetailP] PreparedStatement : [select *        from TT_BENHNHAN         WHERE              TT_BENHNHAN.MAYTE  = '200000388']
2020-07-16 15:14:53,810 [1] DEBUG - Statement Id: [DAO00061_GetBenhAnDetailByID] PreparedStatement : [select A.*, B.NOIGIOITHIEU_ID, C.KHOADIEUTRI_ID, A.ICD_BENHCHINH AS ICD_BENHCHINH_BAK, A.CDRAVIEN_CHINH AS CHANDOANRAVIEN1, B.THOIGIANTIEPNHAN        , A.CDRAVIEN_CHINH AS CHANDOANRAVIEN_BAK        from TT_NOITRU_BENHAN A        left join TT_TIEPNHAN B on B.TIEPNHAN_ID = A.TIEPNHAN_ID        left join TT_NOITRU_NHAPVIEN C on C.TIEPNHAN_ID = B.TIEPNHAN_ID        where A.BENHAN_ID = '4088']
2020-07-16 15:14:53,919 [1] DEBUG - Statement Id: [DAO00080_GetNoiTruBenhAnChiTiet] PreparedStatement : [select *        from TT_NOITRU_BENHAN_CHITIET where        BENHAN_ID = '4088'        and BENHVIEN_ID = '01819'        Order By BENHANCHITIET_ID DESC]
2020-07-16 15:14:54,025 [1] DEBUG - Statement Id: [DAO00080_GetNoiTruLuuTruBenhAn] PreparedStatement : [select *        from TT_NOITRU_LUUTRU where        BENHAN_ID = '4088'        and BENHVIEN_ID = '01819'        Order By LUUTRU_ID ASC]
2020-07-16 15:14:54,049 [1] DEBUG - Statement Id: [DAO00080_GetGiuongBenhCuaBenhAn] PreparedStatement : [select *        from TT_NOITRU_GIUONGBENH where        BENHAN_ID =  @param0  and BENHVIEN_ID = '01819']
2020-07-16 15:14:54,049 [1] DEBUG - Statement Id: [DAO00080_GetGiuongBenhCuaBenhAn] Parameters: [@param0=[BENHAN_ID,4088]]
2020-07-16 15:14:54,049 [1] DEBUG - Statement Id: [DAO00080_GetGiuongBenhCuaBenhAn] Types: [@param0=[Int64, System.Int64]]
2020-07-16 15:14:54,139 [1] DEBUG - Statement Id: [DAO00067_laytrangthaibenhannoitru] PreparedStatement : [select isnull(TRANGTHAI, '') TRANGTHAI from TT_NOITRU_BENHAN where BENHAN_ID =  @param0]
2020-07-16 15:14:54,139 [1] DEBUG - Statement Id: [DAO00067_laytrangthaibenhannoitru] Parameters: [@param0=[BENHAN_ID,4088]]
2020-07-16 15:14:54,139 [1] DEBUG - Statement Id: [DAO00067_laytrangthaibenhannoitru] Types: [@param0=[Int64, System.Int64]]
2020-07-16 15:14:54,166 [1] DEBUG - Statement Id: [DAO00067_DeleteVienPhi_Noref] PreparedStatement : [delete from TT_VIENPHI where TIEPNHAN_ID = 6311 and (REF_ID is null or REF_ID = 0)         and           BENHAN_ID = '4088'                 delete TT_DUOC_TONKHO_BOOK_NOITRU where REF_TABLE = 'TT_NOITRU_TOATHUOC' and (REF_ID is null or REF_ID = 0)        delete TT_DUOC_TONKHO_BOOK_NGOAITRU where REF_ID is null or REF_ID = 0]
2020-07-16 15:14:54,227 [1] DEBUG - Statement Id: [DAO00067_UpdateBenhanIdVienPhi] PreparedStatement : [update TT_VIENPHI          set BENHAN_ID =  @param0           from (select TOATHUOC_ID from TT_NOITRU_TOATHUOC where TIEPNHAN_ID =  @param1 ) nttt          where REF_TABLE = 'TT_NOITRU_TOATHUOC' and REF_ID = nttt.TOATHUOC_ID and isnull(BENHAN_ID, 0) = 0          and TIEPNHAN_ID =  @param1             update TT_VIENPHI          set TT_VIENPHI.BENHAN_ID =  @param0           from (select DVYEUCAU_ID, BENHAN_ID from TT_DVYEUCAU where TIEPNHAN_ID =  @param1 ) nttt          where TT_VIENPHI.REF_TABLE = 'TT_DVYEUCAU' and TT_VIENPHI.REF_ID = nttt.DVYEUCAU_ID          and isnull(TT_VIENPHI.BENHAN_ID, 0) = 0 and isnull(nttt.BENHAN_ID, 0) > 0          and TT_VIENPHI.TIEPNHAN_ID =  @param1]
2020-07-16 15:14:54,227 [1] DEBUG - Statement Id: [DAO00067_UpdateBenhanIdVienPhi] Parameters: [@param0=[BENHAN_ID,4088], @param1=[TIEPNHAN_ID,6311]]
2020-07-16 15:14:54,227 [1] DEBUG - Statement Id: [DAO00067_UpdateBenhanIdVienPhi] Types: [@param0=[Int64, System.Int64], @param1=[Int64, System.Int64]]
2020-07-16 15:14:54,339 [1] DEBUG - Statement Id: [DAO00064_GetlistTT_TIEPNHAN_SOTHEBHYT] PreparedStatement : [select stbhyt.*, ba.SOBENHAN,        tn.SOTIEPNHAN, tn.LOAITHANHVIEN_ID, tn.THE_ID, tn.THANHVIEN_ID,        tn.SUDUNG_BHTN, tn.BAOLANH_VIENPHI, tn.VIP, tn.NGUOINUOCNGOAI, tn.NGOAIGIO        from TT_TIEPNHAN_SOTHEBHYT stbhyt        left join TT_TIEPNHAN tn on tn.TIEPNHAN_ID = stbhyt.TIEPNHAN_ID        left join TT_NOITRU_BENHAN ba on ba.TIEPNHAN_ID = stbhyt.TIEPNHAN_ID        where        stbhyt.TIEPNHAN_ID = '6311' and isnull(stbhyt.KHONGSUDUNG, '0') = '0'         and           ba.BENHAN_ID = '4088']
2020-07-16 15:14:54,376 [1] DEBUG - Statement Id: [DAO00064_GetListVienPhiByTiepNnan] PreparedStatement : [select distinct        B.DOITUONG_ID, B.NGAYMIENDONGCHITRA, B.BENHNHAN_ID as TIEPNHAN_BENHNHAN_ID, B.TRAITUYEN,        B.BHYTTREN3NAM as TREN3NAM, B.BHYTTREN5NAM as TREN5NAM, B.SOTIEPNHAN, B.SOBENHAN,        B.LOAITHANHVIEN_ID, B.SUDUNG_BHTN, B.THE_ID, B.THANHVIEN_ID, B.BAOLANH_VIENPHI, B.VIP, B.NGUOINUOCNGOAI,        C.GIATRIMIENGIAM as GIATRIMIENGIAM, D.GIATRIMIENGIAM as GIATRIMIENGIAM_BHTN, E.GIATRIMIENGIAM as GIATRIMIENGIAM_THANHVIEN,        F.GIATRIMIENGIAM as GIATRIMIENGIAM_CONGTY, DVYC.THE_ID as DVDUNGTHE, DVYC.TRANGTHAI as TRANGTHAIDICHVU, ndv.MANHOMDICHVU,        A.* from TT_VIENPHI A        left join        (select B.*, C.SOBENHAN, C.BENHAN_ID        from TT_TIEPNHAN B        left join TT_NOITRU_BENHAN C on B.TIEPNHAN_ID = C.TIEPNHAN_ID         and           C.BENHAN_ID = '4088'                 where B.TIEPNHAN_ID = '6311') B on B.TIEPNHAN_ID = A.TIEPNHAN_ID        left join (select sum(GIATRIMIENGIAM) as GIATRIMIENGIAM, VIENPHI_ID, REF_TABLE        from TT_MIENGIAM_CHITIET        where REF_TABLE = 'TT_MIENGIAM'        and exists (select MIENGIAM_ID from TT_MIENGIAM where TT_MIENGIAM_CHITIET.MIENGIAM_ID = MIENGIAM_ID and TINHTRANG = 1 and TIEPNHAN_ID = '6311')        group by VIENPHI_ID, REF_TABLE) C on C.REF_TABLE = 'TT_MIENGIAM' and C.VIENPHI_ID = A.VIENPHI_ID        left join (select sum(GIATRIMIENGIAM) as GIATRIMIENGIAM, VIENPHI_ID, REF_TABLE        from TT_MIENGIAM_CHITIET        where REF_TABLE = 'TT_MIENGIAM_BHTN'        and exists (select MIENGIAM_BHTN_ID from TT_MIENGIAM_BHTN where TT_MIENGIAM_CHITIET.MIENGIAM_ID = MIENGIAM_BHTN_ID and  TINHTRANG = 1 and TIEPNHAN_ID = '6311')        group by VIENPHI_ID, REF_TABLE) D on D.REF_TABLE = 'TT_MIENGIAM_BHTN' and D.VIENPHI_ID = A.VIENPHI_ID        left join (select sum(GIATRIMIENGIAM) as GIATRIMIENGIAM, VIENPHI_ID, REF_TABLE        from TT_MIENGIAM_CHITIET        where REF_TABLE = 'TT_MIENGIAM_THANHVIEN'        and exists (select MIENGIAM_THANHVIEN_ID from TT_MIENGIAM_THANHVIEN where TT_MIENGIAM_CHITIET.MIENGIAM_ID = MIENGIAM_THANHVIEN_ID and TINHTRANG = 1 and TIEPNHAN_ID = '6311')        group by VIENPHI_ID, REF_TABLE) E on E.REF_TABLE = 'TT_MIENGIAM_THANHVIEN' and E.VIENPHI_ID = A.VIENPHI_ID        left join (select sum(GIATRIMIENGIAM) as GIATRIMIENGIAM, VIENPHI_ID, REF_TABLE        from TT_MIENGIAM_CHITIET        where REF_TABLE = 'TT_MIENGIAM_CONGTY'        and exists (select MIENGIAM_CONGTY_ID from TT_MIENGIAM_CONGTY where TT_MIENGIAM_CHITIET.MIENGIAM_ID = MIENGIAM_CONGTY_ID and TINHTRANG = 1 and TIEPNHAN_ID = '6311')        group by VIENPHI_ID, REF_TABLE) F on F.REF_TABLE = 'TT_MIENGIAM_CONGTY' and F.VIENPHI_ID = A.VIENPHI_ID        left join TT_DVYEUCAU DVYC on DVYC.DVYEUCAU_ID = A.REF_ID and A.REF_TABLE = 'TT_DVYEUCAU'        left join TM_DICHVU DV on DVYC.DICHVU_ID = DV.DICHVU_ID and A.REF_TABLE = 'TT_DVYEUCAU'        left join TM_NHOMDICHVU ndv on ndv.NHOMDICHVU_ID = DV.NHOMDICHVU_ID and A.REF_TABLE = 'TT_DVYEUCAU'        where        A.TIEPNHAN_ID = '6311' and ((DVYC.HUYYEUCAU = '0' and A.DICHVU_ID is not null)        or A.DUOC_ID is not null or A.REF_TABLE = 'TT_NUT_XACNHANSUATAN_CHITIET')        and A.ACTIVE = '1'         and           A.BENHAN_ID = '4088'                 and A.BENHVIEN_ID = '01819'        order by A.VIENPHI_ID]
2020-07-16 15:14:54,642 [1] DEBUG - Statement Id: [DAO00006_GetListDuocTyle] PreparedStatement : [select DUOC_ID, DOITUONG_ID, (TYLE/100) as TYLE, DONGIA MUCTRAN_THANHTOAN from TM_DOITUONG_GIADUOC_TYLE            where            BENHVIEN_ID = '01819'            and DOITUONG_ID = '4']
2020-07-16 15:14:54,667 [1] DEBUG - Statement Id: [DAO00027_GetListTuongTrinhDichVuPhauThuatCuaTiepNhan] PreparedStatement : [declare @ManhomDSA varchar(10);        declare @PhanLoaiNhomDV varchar(20) = '05';        select top 1  @ManhomDSA = VALUE from TM_SYS_APPSETTINGS where CODE = 'MANHOM_DICHVU_DSA'        if (@ManhomDSA is not null) set @PhanLoaiNhomDV += ',' + @ManhomDSA        select distinct ptyc.*        from TT_PHAUTHUAT_YEUCAU ptyc        inner join TM_DICHVU dv on dv.DICHVU_ID = ptyc.DICHVU_ID        inner join TM_NHOMDICHVU ndv on ndv.NHOMDICHVU_ID = dv.NHOMDICHVU_ID        inner join TT_PHAUTHUAT pt on pt.PHAUTHUAT_ID = ptyc.PHAUTHUAT_ID        where        pt.TIEPNHAN_ID = 6311        and (left(ndv.MANHOMDICHVU, 2) in (select * from STRING_SPLIT(@PhanLoaiNhomDV,',')) or ndv.MANHOMDICHVU in (select * from STRING_SPLIT(@PhanLoaiNhomDV,',')))]
2020-07-16 15:14:54,723 [1] DEBUG - Statement Id: [DAO00006_GetList] PreparedStatement : [select dv.*, loaiDV.MALOAIDICHVU, captren.NHOMDICHVU_ID as NHOMDICHVU_CAPTREN_ID, captren.TENNHOMDICHVU as NHOMDICHVU_CAPTREN,              nhom_dv.TENNHOMDICHVU as TENNHOMDICHVU, nhom_dv.MANHOMDICHVU,              case when dv.ATTRIBUTE5 is null then 'TT' else 'KTC' end as LOAI_CHIPHI              from TM_DICHVU as dv              left join TM_NHOMDICHVU as nhom_dv on nhom_dv.NHOMDICHVU_ID = dv.NHOMDICHVU_ID and nhom_dv.BENHVIEN_ID = '01819'              left join TM_NHOMDICHVU as captren on nhom_dv.CAPTREN_ID = captren.NHOMDICHVU_ID and captren.BENHVIEN_ID = '01819'              left join TM_LOAIDICHVU loaiDV on nhom_dv.LOAIDICHVU_ID = loaiDV.LOAIDICHVU_ID and loaiDV.BENHVIEN_ID = '01819'              where nhom_dv.TAMNGUNG = '0' and dv.BENHVIEN_ID = '01819'              and dv.TAMNGUNG = '0'               AND                   loaiDV.MALOAIDICHVU = 'KhamBenh']
2020-07-16 15:14:54,755 [1] DEBUG - Statement Id: [DAO00027_GetDichvuYCBHYTTyle] PreparedStatement : [select DVYEUCAU_ID from TT_DVYEUCAU        where TIEPNHAN_ID = 6311 and isnull(BHYT_TYLETHANHTOAN_ID, 0) > 0]
2020-07-16 15:14:54,850 [1] DEBUG - Statement Id: [DAO00023_UpdateNhieuVP] PreparedStatement : [declare @jsonVienPhi nvarchar(max) = N'[{"VIENPHI_ID":9230,"TIEPNHAN_ID":6311,"DICHVU_ID":7,"BENHAN_ID":4088,"SOLUONG":1.0000,"DONGIA_DOANHTHU":38700.0000,"THANHTIEN_DOANHTHU":38700.00,"BHYT_TL":0.8000,"BHYT_DONGIA":38700.0000,"BHYT_THANHTIEN":38700.00,"BHYT_DONGIA_CONGKHAM_DAU":38700.0000,"BHYT_CONGKHAM_DAU_TYLE":1.0,"BHYT_DONGIA_CHITRA":30960.0,"BHYT_THANHTIEN_CHITRA":30960.00,"BENHNHAN_PHAITHANHTOAN":7740.00,"GIATRI_HOADON":7740.00,"GIATRI_HOADON_DATHANHTOAN":0.0,"GIATRI_BIENLAI":0.0,"GIATRI_BIENLAI_DATHANHTOAN":0.0,"GIATRI_BENHNHAN_DATHANHTOAN":0.0,"DATHUCHIEN":"1","KHONGTHUTIEN":"0","BHYTDONGTIEN":"0","DICHVU_TL":1.0,"BHYT_DONGIA_DONGCT_DAU":0.0,"SOBHYT":"GD401013038224001819","SOBHYT_HUONG_ID":6317,"GIATRIMIENGIAM":0.0,"GIATRIMIENGIAM_BHTN":0.0,"GIATRIMIENGIAM_THANHVIEN":0.0,"GIATRIMIENGIAM_CONGTY":0.0,"BHYT_CK2_KHONGTHANHTOAN":false,"SOLONHAP_ID":null,"DUOC_MUCTRAN_THANHTOAN":0.0,"DUOC_TYLE":0.0000},{"VIENPHI_ID":12307,"TIEPNHAN_ID":6311,"DICHVU_ID":null,"BENHAN_ID":4088,"SOLUONG":1.0000,"DONGIA_DOANHTHU":1155.0000,"THANHTIEN_DOANHTHU":1155.00,"BHYT_TL":0.8000,"BHYT_DONGIA":1155.0000,"BHYT_THANHTIEN":1155.00,"BHYT_DONGIA_CONGKHAM_DAU":38700.0000,"BHYT_CONGKHAM_DAU_TYLE":1.0,"BHYT_DONGIA_CHITRA":924.0,"BHYT_THANHTIEN_CHITRA":924.00,"BENHNHAN_PHAITHANHTOAN":231.00,"GIATRI_HOADON":231.00,"GIATRI_HOADON_DATHANHTOAN":0.0,"GIATRI_BIENLAI":0.0,"GIATRI_BIENLAI_DATHANHTOAN":0.0,"GIATRI_BENHNHAN_DATHANHTOAN":0.0,"DATHUCHIEN":"1","KHONGTHUTIEN":"0","BHYTDONGTIEN":"0","DICHVU_TL":0.0,"BHYT_DONGIA_DONGCT_DAU":0.0,"SOBHYT":"GD401013038224001819","SOBHYT_HUONG_ID":6317,"GIATRIMIENGIAM":0.0,"GIATRIMIENGIAM_BHTN":0.0,"GIATRIMIENGIAM_THANHVIEN":0.0,"GIATRIMIENGIAM_CONGTY":0.0,"BHYT_CK2_KHONGTHANHTOAN":false,"SOLONHAP_ID":3848,"DUOC_MUCTRAN_THANHTOAN":0.0,"DUOC_TYLE":0.0000},{"VIENPHI_ID":12308,"TIEPNHAN_ID":6311,"DICHVU_ID":null,"BENHAN_ID":4088,"SOLUONG":4.0000,"DONGIA_DOANHTHU":450.0000,"THANHTIEN_DOANHTHU":1800.00,"BHYT_TL":0.8000,"BHYT_DONGIA":450.0000,"BHYT_THANHTIEN":1800.00,"BHYT_DONGIA_CONGKHAM_DAU":38700.0000,"BHYT_CONGKHAM_DAU_TYLE":1.0,"BHYT_DONGIA_CHITRA":360.0,"BHYT_THANHTIEN_CHITRA":1440.00,"BENHNHAN_PHAITHANHTOAN":360.00,"GIATRI_HOADON":360.00,"GIATRI_HOADON_DATHANHTOAN":0.0,"GIATRI_BIENLAI":0.0,"GIATRI_BIENLAI_DATHANHTOAN":0.0,"GIATRI_BENHNHAN_DATHANHTOAN":0.0,"DATHUCHIEN":"1","KHONGTHUTIEN":"0","BHYTDONGTIEN":"0","DICHVU_TL":0.0,"BHYT_DONGIA_DONGCT_DAU":0.0,"SOBHYT":"GD401013038224001819","SOBHYT_HUONG_ID":6317,"GIATRIMIENGIAM":0.0,"GIATRIMIENGIAM_BHTN":0.0,"GIATRIMIENGIAM_THANHVIEN":0.0,"GIATRIMIENGIAM_CONGTY":0.0,"BHYT_CK2_KHONGTHANHTOAN":false,"SOLONHAP_ID":3936,"DUOC_MUCTRAN_THANHTOAN":0.0,"DUOC_TYLE":0.0000},{"VIENPHI_ID":12309,"TIEPNHAN_ID":6311,"DICHVU_ID":null,"BENHAN_ID":4088,"SOLUONG":4.0000,"DONGIA_DOANHTHU":3600.0000,"THANHTIEN_DOANHTHU":14400.00,"BHYT_TL":0.8000,"BHYT_DONGIA":3600.0000,"BHYT_THANHTIEN":14400.00,"BHYT_DONGIA_CONGKHAM_DAU":38700.0000,"BHYT_CONGKHAM_DAU_TYLE":1.0,"BHYT_DONGIA_CHITRA":2880.0,"BHYT_THANHTIEN_CHITRA":11520.00,"BENHNHAN_PHAITHANHTOAN":2880.00,"GIATRI_HOADON":2880.00,"GIATRI_HOADON_DATHANHTOAN":0.0,"GIATRI_BIENLAI":0.0,"GIATRI_BIENLAI_DATHANHTOAN":0.0,"GIATRI_BENHNHAN_DATHANHTOAN":0.0,"DATHUCHIEN":"1","KHONGTHUTIEN":"0","BHYTDONGTIEN":"0","DICHVU_TL":0.0,"BHYT_DONGIA_DONGCT_DAU":0.0,"SOBHYT":"GD401013038224001819","SOBHYT_HUONG_ID":6317,"GIATRIMIENGIAM":0.0,"GIATRIMIENGIAM_BHTN":0.0,"GIATRIMIENGIAM_THANHVIEN":0.0,"GIATRIMIENGIAM_CONGTY":0.0,"BHYT_CK2_KHONGTHANHTOAN":false,"SOLONHAP_ID":3784,"DUOC_MUCTRAN_THANHTOAN":0.0,"DUOC_TYLE":0.0000},{"VIENPHI_ID":12310,"TIEPNHAN_ID":6311,"DICHVU_ID":null,"BENHAN_ID":4088,"SOLUONG":2.0000,"DONGIA_DOANHTHU":1100.0000,"THANHTIEN_DOANHTHU":2200.00,"BHYT_TL":0.8000,"BHYT_DONGIA":1100.0000,"BHYT_THANHTIEN":2200.00,"BHYT_DONGIA_CONGKHAM_DAU":38700.0000,"BHYT_CONGKHAM_DAU_TYLE":1.0,"BHYT_DONGIA_CHITRA":880.0,"BHYT_THANHTIEN_CHITRA":1760.00,"BENHNHAN_PHAITHANHTOAN":440.00,"GIATRI_HOADON":440.00,"GIATRI_HOADON_DATHANHTOAN":0.0,"GIATRI_BIENLAI":0.0,"GIATRI_BIENLAI_DATHANHTOAN":0.0,"GIATRI_BENHNHAN_DATHANHTOAN":0.0,"DATHUCHIEN":"1","KHONGTHUTIEN":"0","BHYTDONGTIEN":"0","DICHVU_TL":0.0,"BHYT_DONGIA_DONGCT_DAU":0.0,"SOBHYT":"GD401013038224001819","SOBHYT_HUONG_ID":6317,"GIATRIMIENGIAM":0.0,"GIATRIMIENGIAM_BHTN":0.0,"GIATRIMIENGIAM_THANHVIEN":0.0,"GIATRIMIENGIAM_CONGTY":0.0,"BHYT_CK2_KHONGTHANHTOAN":false,"SOLONHAP_ID":3989,"DUOC_MUCTRAN_THANHTOAN":0.0,"DUOC_TYLE":0.0000},{"VIENPHI_ID":12312,"TIEPNHAN_ID":6311,"DICHVU_ID":null,"BENHAN_ID":4088,"SOLUONG":0.0,"DONGIA_DOANHTHU":1155.0000,"THANHTIEN_DOANHTHU":0.0,"BHYT_TL":0.8000,"BHYT_DONGIA":1155.0000,"BHYT_THANHTIEN":0.0,"BHYT_DONGIA_CONGKHAM_DAU":38700.0000,"BHYT_CONGKHAM_DAU_TYLE":1.0,"BHYT_DONGIA_CHITRA":0.0,"BHYT_THANHTIEN_CHITRA":0.0,"BENHNHAN_PHAITHANHTOAN":0.0,"GIATRI_HOADON":0.0,"GIATRI_HOADON_DATHANHTOAN":0.0,"GIATRI_BIENLAI":0.0,"GIATRI_BIENLAI_DATHANHTOAN":0.0,"GIATRI_BENHNHAN_DATHANHTOAN":0.0,"DATHUCHIEN":"0","KHONGTHUTIEN":"0","BHYTDONGTIEN":"0","DICHVU_TL":0.0,"BHYT_DONGIA_DONGCT_DAU":0.0,"SOBHYT":"GD401013038224001819","SOBHYT_HUONG_ID":6317,"GIATRIMIENGIAM":0.0,"GIATRIMIENGIAM_BHTN":0.0,"GIATRIMIENGIAM_THANHVIEN":0.0,"GIATRIMIENGIAM_CONGTY":0.0,"BHYT_CK2_KHONGTHANHTOAN":false,"SOLONHAP_ID":null,"DUOC_MUCTRAN_THANHTOAN":0.0,"DUOC_TYLE":0.0000},{"VIENPHI_ID":12313,"TIEPNHAN_ID":6311,"DICHVU_ID":null,"BENHAN_ID":4088,"SOLUONG":0.0,"DONGIA_DOANHTHU":3600.0000,"THANHTIEN_DOANHTHU":0.0,"BHYT_TL":0.8000,"BHYT_DONGIA":3600.0000,"BHYT_THANHTIEN":0.0,"BHYT_DONGIA_CONGKHAM_DAU":38700.0000,"BHYT_CONGKHAM_DAU_TYLE":1.0,"BHYT_DONGIA_CHITRA":0.0,"BHYT_THANHTIEN_CHITRA":0.0,"BENHNHAN_PHAITHANHTOAN":0.0,"GIATRI_HOADON":0.0,"GIATRI_HOADON_DATHANHTOAN":0.0,"GIATRI_BIENLAI":0.0,"GIATRI_BIENLAI_DATHANHTOAN":0.0,"GIATRI_BENHNHAN_DATHANHTOAN":0.0,"DATHUCHIEN":"0","KHONGTHUTIEN":"0","BHYTDONGTIEN":"0","DICHVU_TL":0.0,"BHYT_DONGIA_DONGCT_DAU":0.0,"SOBHYT":"GD401013038224001819","SOBHYT_HUONG_ID":6317,"GIATRIMIENGIAM":0.0,"GIATRIMIENGIAM_BHTN":0.0,"GIATRIMIENGIAM_THANHVIEN":0.0,"GIATRIMIENGIAM_CONGTY":0.0,"BHYT_CK2_KHONGTHANHTOAN":false,"SOLONHAP_ID":null,"DUOC_MUCTRAN_THANHTOAN":0.0,"DUOC_TYLE":0.0000},{"VIENPHI_ID":12321,"TIEPNHAN_ID":6311,"DICHVU_ID":239,"BENHAN_ID":4088,"SOLUONG":1.0000,"DONGIA_DOANHTHU":65400.0000,"THANHTIEN_DOANHTHU":65400.00,"BHYT_TL":0.8000,"BHYT_DONGIA":65400.0000,"BHYT_THANHTIEN":65400.00,"BHYT_DONGIA_CONGKHAM_DAU":38700.0000,"BHYT_CONGKHAM_DAU_TYLE":1.0,"BHYT_DONGIA_CHITRA":52320.0,"BHYT_THANHTIEN_CHITRA":52320.00,"BENHNHAN_PHAITHANHTOAN":13080.00,"GIATRI_HOADON":13080.00,"GIATRI_HOADON_DATHANHTOAN":0.0,"GIATRI_BIENLAI":0.0,"GIATRI_BIENLAI_DATHANHTOAN":0.0,"GIATRI_BENHNHAN_DATHANHTOAN":0.0,"DATHUCHIEN":"0","KHONGTHUTIEN":"0","BHYTDONGTIEN":"0","DICHVU_TL":1.0,"BHYT_DONGIA_DONGCT_DAU":0.0,"SOBHYT":"GD401013038224001819","SOBHYT_HUONG_ID":6317,"GIATRIMIENGIAM":0.0,"GIATRIMIENGIAM_BHTN":0.0,"GIATRIMIENGIAM_THANHVIEN":0.0,"GIATRIMIENGIAM_CONGTY":0.0,"BHYT_CK2_KHONGTHANHTOAN":false,"SOLONHAP_ID":null,"DUOC_MUCTRAN_THANHTOAN":0.0,"DUOC_TYLE":0.0000},{"VIENPHI_ID":13049,"TIEPNHAN_ID":6311,"DICHVU_ID":null,"BENHAN_ID":4088,"SOLUONG":2.0000,"DONGIA_DOANHTHU":4000.0000,"THANHTIEN_DOANHTHU":8000.00,"BHYT_TL":0.8000,"BHYT_DONGIA":4000.0000,"BHYT_THANHTIEN":8000.00,"BHYT_DONGIA_CONGKHAM_DAU":38700.0000,"BHYT_CONGKHAM_DAU_TYLE":1.0,"BHYT_DONGIA_CHITRA":3200.0,"BHYT_THANHTIEN_CHITRA":6400.00,"BENHNHAN_PHAITHANHTOAN":1600.00,"GIATRI_HOADON":1600.00,"GIATRI_HOADON_DATHANHTOAN":0.0,"GIATRI_BIENLAI":0.0,"GIATRI_BIENLAI_DATHANHTOAN":0.0,"GIATRI_BENHNHAN_DATHANHTOAN":0.0,"DATHUCHIEN":"1","KHONGTHUTIEN":"0","BHYTDONGTIEN":"0","DICHVU_TL":0.0,"BHYT_DONGIA_DONGCT_DAU":0.0,"SOBHYT":"GD401013038224001819","SOBHYT_HUONG_ID":6317,"GIATRIMIENGIAM":0.0,"GIATRIMIENGIAM_BHTN":0.0,"GIATRIMIENGIAM_THANHVIEN":0.0,"GIATRIMIENGIAM_CONGTY":0.0,"BHYT_CK2_KHONGTHANHTOAN":false,"SOLONHAP_ID":3791,"DUOC_MUCTRAN_THANHTOAN":0.0,"DUOC_TYLE":0.0000},{"VIENPHI_ID":13050,"TIEPNHAN_ID":6311,"DICHVU_ID":null,"BENHAN_ID":4088,"SOLUONG":4.0000,"DONGIA_DOANHTHU":3600.0000,"THANHTIEN_DOANHTHU":14400.00,"BHYT_TL":0.8000,"BHYT_DONGIA":3600.0000,"BHYT_THANHTIEN":14400.00,"BHYT_DONGIA_CONGKHAM_DAU":38700.0000,"BHYT_CONGKHAM_DAU_TYLE":1.0,"BHYT_DONGIA_CHITRA":2880.0,"BHYT_THANHTIEN_CHITRA":11520.00,"BENHNHAN_PHAITHANHTOAN":2880.00,"GIATRI_HOADON":2880.00,"GIATRI_HOADON_DATHANHTOAN":0.0,"GIATRI_BIENLAI":0.0,"GIATRI_BIENLAI_DATHANHTOAN":0.0,"GIATRI_BENHNHAN_DATHANHTOAN":0.0,"DATHUCHIEN":"1","KHONGTHUTIEN":"0","BHYTDONGTIEN":"0","DICHVU_TL":0.0,"BHYT_DONGIA_DONGCT_DAU":0.0,"SOBHYT":"GD401013038224001819","SOBHYT_HUONG_ID":6317,"GIATRIMIENGIAM":0.0,"GIATRIMIENGIAM_BHTN":0.0,"GIATRIMIENGIAM_THANHVIEN":0.0,"GIATRIMIENGIAM_CONGTY":0.0,"BHYT_CK2_KHONGTHANHTOAN":false,"SOLONHAP_ID":3784,"DUOC_MUCTRAN_THANHTOAN":0.0,"DUOC_TYLE":0.0000},{"VIENPHI_ID":13138,"TIEPNHAN_ID":6311,"DICHVU_ID":3109,"BENHAN_ID":4088,"SOLUONG":1.0000,"DONGIA_DOANHTHU":1234000.0000,"THANHTIEN_DOANHTHU":1234000.00,"BHYT_TL":0.8000,"BHYT_DONGIA":1234000.0000,"BHYT_THANHTIEN":1234000.00,"BHYT_DONGIA_CONGKHAM_DAU":38700.0000,"BHYT_CONGKHAM_DAU_TYLE":1.0,"BHYT_DONGIA_CHITRA":987200.0,"BHYT_THANHTIEN_CHITRA":987200.00,"BENHNHAN_PHAITHANHTOAN":246800.00,"GIATRI_HOADON":246800.00,"GIATRI_HOADON_DATHANHTOAN":0.0,"GIATRI_BIENLAI":0.0,"GIATRI_BIENLAI_DATHANHTOAN":0.0,"GIATRI_BENHNHAN_DATHANHTOAN":0.0,"DATHUCHIEN":"0","KHONGTHUTIEN":"0","BHYTDONGTIEN":"0","DICHVU_TL":1.0,"BHYT_DONGIA_DONGCT_DAU":0.0,"SOBHYT":"GD401013038224001819","SOBHYT_HUONG_ID":6317,"GIATRIMIENGIAM":0.0,"GIATRIMIENGIAM_BHTN":0.0,"GIATRIMIENGIAM_THANHVIEN":0.0,"GIATRIMIENGIAM_CONGTY":0.0,"BHYT_CK2_KHONGTHANHTOAN":false,"SOLONHAP_ID":null,"DUOC_MUCTRAN_THANHTOAN":0.0,"DUOC_TYLE":0.0000},{"VIENPHI_ID":13139,"TIEPNHAN_ID":6311,"DICHVU_ID":644,"BENHAN_ID":4088,"SOLUONG":1.0000,"DONGIA_DOANHTHU":15200.0000,"THANHTIEN_DOANHTHU":15200.00,"BHYT_TL":0.8000,"BHYT_DONGIA":15200.0000,"BHYT_THANHTIEN":15200.00,"BHYT_DONGIA_CONGKHAM_DAU":38700.0000,"BHYT_CONGKHAM_DAU_TYLE":1.0,"BHYT_DONGIA_CHITRA":12160.0,"BHYT_THANHTIEN_CHITRA":12160.00,"BENHNHAN_PHAITHANHTOAN":3040.00,"GIATRI_HOADON":3040.00,"GIATRI_HOADON_DATHANHTOAN":0.0,"GIATRI_BIENLAI":0.0,"GIATRI_BIENLAI_DATHANHTOAN":0.0,"GIATRI_BENHNHAN_DATHANHTOAN":0.0,"DATHUCHIEN":"0","KHONGTHUTIEN":"0","BHYTDONGTIEN":"0","DICHVU_TL":1.0,"BHYT_DONGIA_DONGCT_DAU":0.0,"SOBHYT":"GD401013038224001819","SOBHYT_HUONG_ID":6317,"GIATRIMIENGIAM":0.0,"GIATRIMIENGIAM_BHTN":0.0,"GIATRIMIENGIAM_THANHVIEN":0.0,"GIATRIMIENGIAM_CONGTY":0.0,"BHYT_CK2_KHONGTHANHTOAN":false,"SOLONHAP_ID":null,"DUOC_MUCTRAN_THANHTOAN":0.0,"DUOC_TYLE":0.0000},{"VIENPHI_ID":13140,"TIEPNHAN_ID":6311,"DICHVU_ID":4251,"BENHAN_ID":4088,"SOLUONG":1.0000,"DONGIA_DOANHTHU":101000.0000,"THANHTIEN_DOANHTHU":101000.00,"BHYT_TL":0.0,"BHYT_DONGIA":0.0,"BHYT_THANHTIEN":0.0,"BHYT_DONGIA_CONGKHAM_DAU":38700.0000,"BHYT_CONGKHAM_DAU_TYLE":1.0,"BHYT_DONGIA_CHITRA":0.0,"BHYT_THANHTIEN_CHITRA":0.0,"BENHNHAN_PHAITHANHTOAN":101000.00,"GIATRI_HOADON":0.0,"GIATRI_HOADON_DATHANHTOAN":0.0,"GIATRI_BIENLAI":0.0,"GIATRI_BIENLAI_DATHANHTOAN":0.0,"GIATRI_BENHNHAN_DATHANHTOAN":0.0,"DATHUCHIEN":"0","KHONGTHUTIEN":"0","BHYTDONGTIEN":"1","DICHVU_TL":1.0,"BHYT_DONGIA_DONGCT_DAU":0.0,"SOBHYT":"GD401013038224001819","SOBHYT_HUONG_ID":6317,"GIATRIMIENGIAM":0.0,"GIATRIMIENGIAM_BHTN":0.0,"GIATRIMIENGIAM_THANHVIEN":0.0,"GIATRIMIENGIAM_CONGTY":0.0,"BHYT_CK2_KHONGTHANHTOAN":false,"SOLONHAP_ID":null,"DUOC_MUCTRAN_THANHTOAN":0.0,"DUOC_TYLE":0.0000}]';        begin        UPDATE TT_VIENPHI        SET        SOLUONG = json.SOLUONG,        DONGIA_DOANHTHU = json.DONGIA_DOANHTHU,        THANHTIEN_DOANHTHU = json.THANHTIEN_DOANHTHU,        BHYT_TL = json.BHYT_TL,        BHYT_DONGIA = json.BHYT_DONGIA,        BHYT_THANHTIEN = json.BHYT_THANHTIEN,        BHYT_DONGIA_CONGKHAM_DAU = json.BHYT_DONGIA_CONGKHAM_DAU,        BHYT_CONGKHAM_DAU_TYLE = json.BHYT_CONGKHAM_DAU_TYLE,        BHYT_DONGIA_CHITRA = json.BHYT_DONGIA_CHITRA,        BHYT_THANHTIEN_CHITRA = json.BHYT_THANHTIEN_CHITRA,        BENHNHAN_PHAITHANHTOAN = json.BENHNHAN_PHAITHANHTOAN,        GIATRI_HOADON = json.GIATRI_HOADON,        GIATRI_BIENLAI = json.GIATRI_BIENLAI,        DATHUCHIEN = json.DATHUCHIEN,        DICHVU_TL = json.DICHVU_TL,        BHYT_DONGIA_DONGCT_DAU = json.BHYT_DONGIA_DONGCT_DAU,        SOLONHAP_ID = json.SOLONHAP_ID,        DUOC_TYLE = json.DUOC_TYLE,        DUOC_MUCTRAN_THANHTOAN = json.DUOC_MUCTRAN_THANHTOAN,        NGAYCAPNHAT = GETDATE()        FROM OPENJSON (@jsonVienPhi)        WITH (        VIENPHI_ID int,        SOLUONG numeric(25, 4),        DONGIA_DOANHTHU numeric(25, 4),        THANHTIEN_DOANHTHU numeric(25, 4),        BHYT_TL numeric(25, 4),        BHYT_DONGIA numeric(25, 4),        BHYT_THANHTIEN numeric(25, 4),        BHYT_DONGIA_CONGKHAM_DAU numeric(25, 4),        BHYT_CONGKHAM_DAU_TYLE numeric(25, 4),        BHYT_DONGIA_CHITRA numeric(25, 4),        BHYT_THANHTIEN_CHITRA numeric(25, 4),        BENHNHAN_PHAITHANHTOAN numeric(25, 4),        GIATRI_HOADON numeric(25, 4),        GIATRI_BIENLAI numeric(25, 4),        DATHUCHIEN char(1),        KHONGTHUTIEN char(1),        BHYTDONGTIEN char(1),        DICHVU_TL numeric(25, 4),        BHYT_DONGIA_DONGCT_DAU numeric(25, 4),        SOLONHAP_ID int,        DUOC_TYLE numeric(25, 4),        DUOC_MUCTRAN_THANHTOAN numeric(25, 4))  json        WHERE TT_VIENPHI.VIENPHI_ID = json.VIENPHI_ID and json.DONGIA_DOANHTHU > 0                  insert into TT_TINH_VIENPHI_LOG        SELECT json.VIENPHI_ID, json.TIEPNHAN_ID, json.BENHAN_ID, json.SOLUONG, json.BHYT_TL, json.DONGIA_DOANHTHU,        json.THANHTIEN_DOANHTHU, json.BHYT_DONGIA, json.BHYT_THANHTIEN, json.BHYT_DONGIA_CHITRA, json.BHYT_THANHTIEN_CHITRA, json.BENHNHAN_PHAITHANHTOAN,        json.SOBHYT_HUONG_ID, json.SOBHYT, GETDATE(), -1, '01819'        FROM OPENJSON(@jsonVienPhi)        WITH (        VIENPHI_ID int,        TIEPNHAN_ID int,        BENHAN_ID int,        SOLUONG numeric(25, 4),        DONGIA_DOANHTHU numeric(25, 4),        THANHTIEN_DOANHTHU numeric(25, 4),        BHYT_TL numeric(25, 4),        BHYT_DONGIA numeric(25, 4),        BHYT_THANHTIEN numeric(25, 4),        BHYT_DONGIA_CHITRA numeric(25, 4),        BHYT_THANHTIEN_CHITRA numeric(25, 4),        BENHNHAN_PHAITHANHTOAN numeric(25, 4),        SOBHYT_HUONG_ID int,        SOBHYT nvarchar(30)) json        end]
2020-07-16 15:14:54,932 [1] DEBUG - Statement Id: [DAO00067_UpdateDataVienPhiDongiaBHYT] PreparedStatement : [update TT_VIENPHI          set BHYT_DONGIA_CHITRA = 0, BHYT_THANHTIEN = 0, BHYT_THANHTIEN_CHITRA = 0          where          TIEPNHAN_ID = 6311 and BHYT_DONGIA = 0          and (BHYT_DONGIA_CHITRA > 0 or BHYT_THANHTIEN > 0 or BHYT_THANHTIEN_CHITRA > 0)]
2020-07-16 15:14:54,968 [1] DEBUG - Statement Id: [DAO00067_CapnhatDataVienphiKhiHuyThanhtoanHoadon] PreparedStatement : [update TT_VIENPHI        set TT_VIENPHI.HOADON_ID = hdct.HOADON_ID, TT_VIENPHI.GIATRI_BENHNHAN_DATHANHTOAN = TT_VIENPHI.GIATRI_BENHNHAN_DATHANHTOAN + hdct.GIATRI_BENHNHAN_DATHANHTOAN        from (select CT.HOADON_ID, CT.VIENPHI_ID, CT.GIATRI_BENHNHAN_DATHANHTOAN        from TT_HOADON_CHITIET_NGOAITRU CT        join TT_HOADON HD on HD.HOADON_ID = CT.HOADON_ID        join TT_VIENPHI vp on vp.VIENPHI_ID = ct.VIENPHI_ID        where HD.DATHANHTOAN = 1 and HD.HUYHOADON = 0 and HD.HOANTRA = 0 and vp.TIEPNHAN_ID =  @param0 ) hdct        where        TT_VIENPHI.VIENPHI_ID = hdct.VIENPHI_ID and TT_VIENPHI.HOADON_ID is null and isnull(TT_VIENPHI.GIATRI_BENHNHAN_DATHANHTOAN,0) = 0        and TT_VIENPHI.TIEPNHAN_ID =  @param0           update TT_VIENPHI        set TT_VIENPHI.HOADON_ID = null, TT_VIENPHI.GIATRI_BENHNHAN_DATHANHTOAN = TT_VIENPHI.GIATRI_BENHNHAN_DATHANHTOAN - hdct.GIATRI_BENHNHAN_DATHANHTOAN,        TT_VIENPHI.DATHANHTOAN = '0'        from (select CT.HOADON_ID, CT.VIENPHI_ID, CT.GIATRI_BENHNHAN_DATHANHTOAN        from TT_HOADON_CHITIET_NGOAITRU CT        join TT_HOADON HD on HD.HOADON_ID = CT.HOADON_ID        join TT_VIENPHI vp on vp.VIENPHI_ID = ct.VIENPHI_ID and vp.HOADON_ID = ct.HOADON_ID        where HD.DATHANHTOAN = 0 and (HD.HUYHOADON = 1 or HD.HOANTRA = 1) and vp.TIEPNHAN_ID =  @param0 ) hdct        where        TT_VIENPHI.VIENPHI_ID = hdct.VIENPHI_ID and TT_VIENPHI.HOADON_ID = hdct.HOADON_ID        and TT_VIENPHI.TIEPNHAN_ID =  @param0]
2020-07-16 15:14:54,968 [1] DEBUG - Statement Id: [DAO00067_CapnhatDataVienphiKhiHuyThanhtoanHoadon] Parameters: [@param0=[TIEPNHAN_ID,6311]]
2020-07-16 15:14:54,968 [1] DEBUG - Statement Id: [DAO00067_CapnhatDataVienphiKhiHuyThanhtoanHoadon] Types: [@param0=[Int64, System.Int64]]
2020-07-16 15:14:55,515 [1] DEBUG - Statement Id: [DAO00305_GetListLoaiBenhAn] PreparedStatement : [select        DICTIONARY_ID as LOAIBENHAN_ID        , DICTIONARY_NAME as TENLOAIBENHAN        , DICTIONARY_NAME_EN        , DICTIONARY_CODE        , DICTIONARY_NAME        from LST_DICTIONARY        where LST_DICTIONARY.Enabled = '1' and DICTIONARY_TYPE_CODE = 'LoaiBenhAn'        order by LST_DICTIONARY.IDX]
2020-07-16 15:15:29,232 [1] DEBUG - Statement Id: [DAO00403_QMS002_GetThongTinClient] PreparedStatement : [SELECT B.ID as QUEUE_ID, B.NAME AS QUEUE_NAME,A.ID AS CLIENT_ID , A.[NAME] AS CLIENT_NAME, ISNULL(A.[STATE],1) AS [STATE],(CASE C.NAME WHEN 'UT' THEN 1 ELSE 0 END) AS QUEUETYPE     , B.DEPARTMENT_ID,ISNULL(B.SECTION_ID,-1) AS SECTION_ID,A.IPSERVER,A.NAMEAUDIO,C.QUEUE_TYPE_CODE,C.QUEUE_TYPE_CODE_SOUND,S.[NAME] AS SECTIONNAME     FROM QMS_QUEUE B LEFT JOIN QMS_CLIENT A ON A.QUEUE_ID = B.ID     LEFT JOIN QMS_QUEUE_TYPE C ON B.QUEUETYPE_ID = C.ID     LEFT JOIN QMS_SECTION S ON B.SECTION_ID=S.ID     WHERE     (A.COMPUTERNAME = 'DESKTOP-89GE5BA' OR A.IPADDRESS = '10.15.167.38') AND A.[STATE] = 1 AND B.DEPARTMENT_ID='25'            AND B.BENHVIEN_ID = '01819']
2020-07-16 15:15:29,284 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = '01819'               AND                   TM_SYS_SCREEN.PAGE = 'OPD02'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2020-07-16 15:15:29,500 [1] DEBUG - Statement Id: [DAO00012_GetList] PreparedStatement : [select        DICTIONARY_ID,        DICTIONARY_CODE,        DICTIONARY_NAME,        ATTRIBUTE1,        ATTRIBUTE2,        DICTIONARY_NAME_EN,        DICTIONARY_TYPE_CODE        from LST_DICTIONARY        where LST_DICTIONARY.Enabled = '1'         AND           LST_DICTIONARY.DICTIONARY_TYPE_CODE = 'DuongDung'                 order by LST_DICTIONARY.IDX]
2020-07-16 15:15:30,290 [1] DEBUG - Statement Id: [DAO00012_GetList] PreparedStatement : [select        DICTIONARY_ID,        DICTIONARY_CODE,        DICTIONARY_NAME,        ATTRIBUTE1,        ATTRIBUTE2,        DICTIONARY_NAME_EN,        DICTIONARY_TYPE_CODE        from LST_DICTIONARY        where LST_DICTIONARY.Enabled = '1'         AND           LST_DICTIONARY.DICTIONARY_TYPE_CODE = 'GiaiQuyetKhamBenh'                 order by LST_DICTIONARY.IDX]
2020-07-16 15:15:30,385 [1] DEBUG - Statement Id: [DAO00012_GetList] PreparedStatement : [select        DICTIONARY_ID,        DICTIONARY_CODE,        DICTIONARY_NAME,        ATTRIBUTE1,        ATTRIBUTE2,        DICTIONARY_NAME_EN,        DICTIONARY_TYPE_CODE        from LST_DICTIONARY        where LST_DICTIONARY.Enabled = '1'         AND           LST_DICTIONARY.DICTIONARY_TYPE_CODE = 'LyDoNhapVien'                 order by LST_DICTIONARY.IDX]
2020-07-16 15:15:30,467 [1] DEBUG - Statement Id: [DAO00012_GetList] PreparedStatement : [select        DICTIONARY_ID,        DICTIONARY_CODE,        DICTIONARY_NAME,        ATTRIBUTE1,        ATTRIBUTE2,        DICTIONARY_NAME_EN,        DICTIONARY_TYPE_CODE        from LST_DICTIONARY        where LST_DICTIONARY.Enabled = '1'         AND           LST_DICTIONARY.DICTIONARY_TYPE_CODE = 'CachDung'                 order by LST_DICTIONARY.IDX]
2020-07-16 15:15:36,162 [1] DEBUG - Statement Id: [DAO00033_GetList] PreparedStatement : [select *              from TM_NGUONHANG              where BENHVIEN_ID = '01819'                             order by NGUONDUOC_ID]
2020-07-16 15:15:36,273 [1] DEBUG - Statement Id: [DAO00017_GetLoaiGiaByDoiTuongId] PreparedStatement : [select dtlg.DOUUTIEN, dtlg.DOITUONG_ID, lg.LOAIGIA_ID, lg.TENLOAIGIA, lg.MALOAIGIA              from TM_LOAIGIA lg              left join TM_DOITUONG_LOAIGIA dtlg              on lg.LOAIGIA_ID = dtlg.LOAIGIA_ID and dtlg.BENHVIEN_ID = '01819'              where lg.TAMNGUNG = 0 and lg.BENHVIEN_ID = '01819'                             order by dtlg.DOUUTIEN]
2020-07-16 15:15:36,378 [1] DEBUG - Statement Id: [DAO00092_GetList_ToathuocNgoaitru] PreparedStatement : [select A.*, B.PHAMVI_ID, C.KHODUOC_ID from TM_TOATHUOC_NGOAITRU A        left join TM_DUOC_PHAMVISUDUNG B on B.MAPHAMVI = A.MAPHAMVI        left join (select distinct PHAMVI_ID, KHODUOC_ID from TM_DUOC_PHAMVISD_MAPPING) C on C.PHAMVI_ID = B.PHAMVI_ID        where A.TAMNGUNG != '1' and A.BENHVIEN_ID = '01819'        ORDER BY A.SAPXEP ASC]
2020-07-16 15:15:36,437 [1] DEBUG - Statement Id: [DAO00012_GetLoaiTCLS] PreparedStatement : [select DICTIONARY_ID, DICTIONARY_CODE, DICTIONARY_NAME, cast('0' as Bit) CHON        from LST_DICTIONARY              where DICTIONARY_TYPE_CODE = 'KHAMBENH_LOAI_TRIEUCHUNGLS'        order by LST_DICTIONARY.IDX]
2020-07-16 15:15:36,507 [1] DEBUG - Statement Id: [DAO00012_GetAllTCLS] PreparedStatement : [select MALOAITRIEUCHUNG DICTIONARY_TYPE_CODE, MALOAITRIEUCHUNG DICTIONARY_CODE,        TENTRIEUCHUNG DICTIONARY_NAME from TM_TRIEUCHUNGLS]
2020-07-16 15:15:36,756 [1] DEBUG - Statement Id: [DAO00305_GetListPhongBanKhoaNgoai] PreparedStatement : [select A.*, B.DICTIONARY_CODE from TM_PHONGBAN A        inner join LST_DICTIONARY B on A.LOAIPHONGBAN_ID = B.DICTIONARY_ID        and B.DICTIONARY_TYPE_CODE = 'LoaiPhongBan'        where A.TAMNGUNG = '0'        and B.DICTIONARY_CODE = 'KhoaNgoai'        order by A.TENPHONGBAN asc]
2020-07-16 15:15:40,876 [1] DEBUG - Statement Id: [DAO00014_Update_TTKhambenh] PreparedStatement : [update TT_NGOAITRU_KHAMBENH set        TRIEUCHUNGLAMSANG =  @param0         , CHANDOANKHOAKHAM =  @param1         , CHANDOANSOBOICD_ID =  @param2         , CHANDOANSOBO =  @param3         , CHANDOANICD_ID =  @param4         , NGUOICAPNHAT_ID =  @param5         , NGAYCAPNHAT = Getdate()        where        KHAMBENH_ID =  @param6]
2020-07-16 15:15:40,876 [1] DEBUG - Statement Id: [DAO00014_Update_TTKhambenh] Parameters: [@param0=[TRIEUCHUNGLAMSANG,], @param1=[CHANDOANKHOAKHAM,], @param2=[CHANDOANSOBOICD_ID,null], @param3=[CHANDOANSOBO,], @param4=[CHANDOANICD_ID,null], @param5=[NGUOICAPNHAT_ID,1], @param6=[KHAMBENH_ID,null]]
2020-07-16 15:15:40,876 [1] DEBUG - Statement Id: [DAO00014_Update_TTKhambenh] Types: [@param0=[String, System.String], @param1=[String, System.String], @param2=[System.DBNull, null], @param3=[String, System.String], @param4=[System.DBNull, null], @param5=[Int64, System.Int64], @param6=[System.DBNull, null]]
2020-07-16 15:16:03,600 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = '01819'               AND                   TM_SYS_SCREEN.PAGE = 'BIL18'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
2020-07-16 15:38:43,560 [1] DEBUG - Statement Id: [DAO00001_DBList] PreparedStatement : [select *              from TM_SYS_SERVER              where HOSPITAL_ID = '_SYSTEM_' and TYPE = 'D']
2020-07-16 15:38:43,905 [1] DEBUG - Statement Id: [DAO00001_DaoList] PreparedStatement : [select              TM_SYS_SERVICEMAP.ID,              TM_SYS_SERVICEMAP.HOSPITAL_ID,              TM_SYS_SERVICEMAP.DB_NAME,              TM_SYS_SERVICEMAP.TYPE,              TM_SYS_SERVICEMAP.NAME,              TM_SYS_SERVICEMAP.CLASS,              (TM_SYS_DIC.VALUE + '.' + TM_SYS_SERVICEMAP.CLASS) as CLASSFULL,              TM_SYS_SERVICEMAP.ASSEMBLY              from TM_SYS_SERVICEMAP              inner join TM_SYS_DIC              on TM_SYS_SERVICEMAP.NAMESPACE = TM_SYS_DIC.ID              where HOSPITAL_ID = '_SYSTEM_' AND TYPE = 'D' AND ACTIVE = '1'              order by DB_NAME]
2020-07-16 15:38:43,937 [1] DEBUG - Statement Id: [DAO00001_ServiceList] PreparedStatement : [select              TM_SYS_SERVICEMAP.ID,              TM_SYS_SERVICEMAP.HOSPITAL_ID,              TM_SYS_SERVICEMAP.DB_NAME,              TM_SYS_SERVICEMAP.TYPE,              TM_SYS_SERVICEMAP.NAME,              TM_SYS_SERVICEMAP.CLASS,              (TM_SYS_DIC.VALUE + '.' + TM_SYS_SERVICEMAP.CLASS) as CLASSFULL,              TM_SYS_SERVICEMAP.ASSEMBLY,              TM_SYS_SERVER.URL              from TM_SYS_SERVICEMAP              inner join TM_SYS_DIC on TM_SYS_SERVICEMAP.NAMESPACE = TM_SYS_DIC.ID              inner join TM_SYS_SERVER on (TM_SYS_SERVICEMAP.DB_NAME = TM_SYS_SERVER.NAME) and (TM_SYS_SERVER.HOSPITAL_ID = '_SYSTEM_')              where TM_SYS_SERVICEMAP.HOSPITAL_ID = '_SYSTEM_' AND TM_SYS_SERVICEMAP.TYPE = 'S'  AND ACTIVE = '1'              order by URL]
2020-07-16 15:38:44,299 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = '_SYSTEM_'               AND                   TM_SYS_SCREEN.PAGE = 'LOGIN'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2020-07-16 15:38:44,639 [1] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = '_SYSTEM_'               AND                   TM_SYS_CACHE.ACTIVE = '1']
2020-07-16 15:38:54,158 [1] DEBUG - Statement Id: [DAO00001_DBList] PreparedStatement : [select *              from TM_SYS_SERVER              where HOSPITAL_ID = '01819' and TYPE = 'D']
2020-07-16 15:38:54,183 [1] DEBUG - Statement Id: [DAO00001_DaoList] PreparedStatement : [select              TM_SYS_SERVICEMAP.ID,              TM_SYS_SERVICEMAP.HOSPITAL_ID,              TM_SYS_SERVICEMAP.DB_NAME,              TM_SYS_SERVICEMAP.TYPE,              TM_SYS_SERVICEMAP.NAME,              TM_SYS_SERVICEMAP.CLASS,              (TM_SYS_DIC.VALUE + '.' + TM_SYS_SERVICEMAP.CLASS) as CLASSFULL,              TM_SYS_SERVICEMAP.ASSEMBLY              from TM_SYS_SERVICEMAP              inner join TM_SYS_DIC              on TM_SYS_SERVICEMAP.NAMESPACE = TM_SYS_DIC.ID              where HOSPITAL_ID = '01819' AND TYPE = 'D' AND ACTIVE = '1'              order by DB_NAME]
2020-07-16 15:38:58,696 [1] DEBUG - Statement Id: [DAO00001_ServiceList] PreparedStatement : [select              TM_SYS_SERVICEMAP.ID,              TM_SYS_SERVICEMAP.HOSPITAL_ID,              TM_SYS_SERVICEMAP.DB_NAME,              TM_SYS_SERVICEMAP.TYPE,              TM_SYS_SERVICEMAP.NAME,              TM_SYS_SERVICEMAP.CLASS,              (TM_SYS_DIC.VALUE + '.' + TM_SYS_SERVICEMAP.CLASS) as CLASSFULL,              TM_SYS_SERVICEMAP.ASSEMBLY,              TM_SYS_SERVER.URL              from TM_SYS_SERVICEMAP              inner join TM_SYS_DIC on TM_SYS_SERVICEMAP.NAMESPACE = TM_SYS_DIC.ID              inner join TM_SYS_SERVER on (TM_SYS_SERVICEMAP.DB_NAME = TM_SYS_SERVER.NAME) and (TM_SYS_SERVER.HOSPITAL_ID = '01819')              where TM_SYS_SERVICEMAP.HOSPITAL_ID = '01819' AND TM_SYS_SERVICEMAP.TYPE = 'S'  AND ACTIVE = '1'              order by URL]
2020-07-16 15:38:58,835 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = '01819'               AND                   TM_SYS_CACHE.ACTIVE = '1']
2020-07-16 15:38:59,912 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = '01819'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM005']
2020-07-16 15:39:00,437 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = '01819'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM015']
2020-07-16 15:39:00,496 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = '01819'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM067']
2020-07-16 15:39:00,555 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = '01819'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM008']
2020-07-16 15:39:00,615 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = '01819'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM068']
2020-07-16 15:39:00,677 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = '01819'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM006']
2020-07-16 15:39:00,737 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = '01819'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM030']
2020-07-16 15:39:00,810 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = '01819'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM025']
2020-07-16 15:39:00,868 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = '01819'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM024']
2020-07-16 15:39:01,369 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = '01819'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM033']
2020-07-16 15:39:01,402 [5] DEBUG - Statement Id: [DAO00027_GetListDuocKyGuiTonKho] PreparedStatement : [select  distinct TT_TONKHO.DUOC_KEY, LTRIM(TT_TONKHO.KHODUOC_ID) as KHODUOC_ID, TM_DUOC.DUOC_ID, TM_LOAIDUOC.MALOAIDUOC,TM_DUOC.SOVISA,TM_DUOC.TYLE_VAT,TM_DUOC.COTOA,        TM_DUOC.MADUOC, TM_DUOC.TENHANG, TM_DUOC.TENDUOCDAYDU, dvt.TENDONVITINH as DONVITINH,  TM_DUOC.DONVITINH_ID,TM_DUOC.BHYT,TM_DUOC.PHAMVI,        TM_DUOC.TENHOATCHAT, TM_DUOC.HAMLUONG, TM_DUOC.HANGSANXUAT, TM_DUOC.QUOCGIA, TM_DUOC.LOAIDUOC_ID, TM_DUOC.DUONGDUNG_ID,        TM_TENDUOC.TENDUOC, TM_TENDUOC.TENDUOC_EN, TM_TENDUOC.MAQUOCTE, TM_TENDUOC.MAQUOCTEBT,        TM_LOAIDUOC.LOAIVATTU_ID, TM_DUOC.BENHVIEN_ID,TT_TONKHO.SOLUONG, TT_TONKHO.NGUONDUOC_ID, NH.TENNGUONDUOC        , TAMNGUNG = CASE WHEN TM_DUOC.TAMNGUNG = '1' OR nh.TAMNGUNG = '1' OR KD.TAMNGUNG = '1' THEN '1' ELSE '0' END        , TM_DUOC.DANGTRINHBAY        from TM_DUOC        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = TM_DUOC.DONVITINH_ID        left join TM_TENDUOC on TM_DUOC.TENDUOC_ID = TM_TENDUOC.TENDUOC_ID and TM_DUOC.BENHVIEN_ID = '01819' and TM_DUOC.TAMNGUNG = '0'        left join TM_LOAIDUOC on TM_LOAIDUOC.LOAIDUOC_ID = TM_DUOC.LOAIDUOC_ID and TM_LOAIDUOC.BENHVIEN_ID = '01819'        left join TM_DUOC_HANDUNG on (TM_LOAIDUOC.LOAIVATTU_ID = TM_DUOC_HANDUNG.LOAIDUOC and TM_DUOC_HANDUNG.BENHVIEN_ID = '01819')        inner join        (select LTRIM(A.KHODUOC_ID) + '_' + LTRIM(A.DUOC_ID) + '_' + LTRIM(ISNULL(A.NGUONDUOC_ID,'')) as DUOC_KEY, A.KHODUOC_ID, A.DUOC_ID,A.NGUONDUOC_ID,        SUM(isnull(A.SOLUONG,0)) as SOLUONG        from        (select SUM(SOLUONG) as SOLUONG, KHODUOC_ID, DUOC_ID, NGUONDUOC_ID from TT_DUOC_KYGUI_TONKHO        where BENHVIEN_ID = '01819' group by KHODUOC_ID, DUOC_ID, NGUONDUOC_ID) A        group by LTRIM(A.KHODUOC_ID) + '_' + LTRIM(A.DUOC_ID) + '_' + LTRIM(A.NGUONDUOC_ID), A.KHODUOC_ID, A.DUOC_ID, A.NGUONDUOC_ID)        TT_TONKHO on TT_TONKHO.DUOC_ID = TM_DUOC.DUOC_ID        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = TT_TONKHO.NGUONDUOC_ID and nh.BENHVIEN_ID = '01819'        LEFT JOIN TM_KHODUOC KD ON KD.KHODUOC_ID = TT_TONKHO.KHODUOC_ID        where TM_DUOC.BENHVIEN_ID = '01819' AND TT_TONKHO.SOLUONG >= 0]
2020-07-16 15:39:01,466 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = '01819'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM018']
2020-07-16 15:39:01,492 [5] DEBUG - Statement Id: [DAO00027_GetListDuocTonKho] PreparedStatement : [select distinct TT_TONKHO.DUOC_KEY, LTRIM(TT_TONKHO.KHODUOC_ID) as KHODUOC_ID, TM_DUOC.DUOC_ID, TM_LOAIDUOC.MALOAIDUOC,TM_DUOC.SOVISA,TM_DUOC.TYLE_VAT,TM_DUOC.COTOA,        TM_DUOC.MADUOC, TM_DUOC.TENHANG, TM_DUOC.TENDUOCDAYDU, dvt.TENDONVITINH as DONVITINH,  TM_DUOC.DONVITINH_ID,TM_DUOC.BHYT,                TM_DUOC.TENHOATCHAT,          TM_DUOC.HAMLUONG, TM_DUOC.HANGSANXUAT, TM_DUOC.QUOCGIA, TM_DUOC.LOAIDUOC_ID, TM_DUOC.DUONGDUNG_ID,        TM_TENDUOC.TENDUOC, TM_TENDUOC.TENDUOC_EN, TM_TENDUOC.MAQUOCTE, TM_TENDUOC.MAQUOCTEBT,        TM_LOAIDUOC.LOAIVATTU_ID, TM_DUOC.BENHVIEN_ID,        TT_TONKHO.SOLUONG, TM_DUOC.VTYT_PHANLOAI, TM_DUOC.PHAMVI, TT_TONKHO.NGUONDUOC_ID, NG.TENNGUONDUOC AS TENNGUONDUOC        , TAMNGUNG = CASE WHEN TM_DUOC.TAMNGUNG = '1' OR NG.TAMNGUNG = '1' OR KD.TAMNGUNG = '1' THEN '1' ELSE '0' END        , TM_DUOC.DANGTRINHBAY        ,TT_TONKHO.PHAMVI_ID AS KHO_PHAMVI_ID        from TM_DUOC        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = TM_DUOC.DONVITINH_ID        left join TM_TENDUOC on TM_DUOC.TENDUOC_ID = TM_TENDUOC.TENDUOC_ID and TM_DUOC.BENHVIEN_ID = '01819' and TM_DUOC.TAMNGUNG = '0'        left join TM_LOAIDUOC on TM_LOAIDUOC.LOAIDUOC_ID = TM_DUOC.LOAIDUOC_ID and TM_LOAIDUOC.BENHVIEN_ID = '01819'        left join TM_DUOC_HANDUNG on (TM_LOAIDUOC.LOAIVATTU_ID = TM_DUOC_HANDUNG.LOAIDUOC and TM_DUOC_HANDUNG.BENHVIEN_ID = '01819')        inner join        (select LTRIM(A.KHODUOC_ID) + '_' + LTRIM(A.DUOC_ID) + '_' + LTRIM(ISNULL(A.NGUONDUOC_ID,'')) as DUOC_KEY, A.KHODUOC_ID, A.DUOC_ID, A.NGUONDUOC_ID,        SUM(isnull(A.SOLUONG,0)) as SOLUONG        ,A.PHAMVI_ID        from        (select SUM(AA.SOLUONG) as SOLUONG, AA.KHODUOC_ID, AA.DUOC_ID, AA.NGUONDUOC_ID        ,CC.PHAMVI_ID        from TT_DUOC_TONKHO AA INNER JOIN TM_KHODUOC BB ON AA.KHODUOC_ID=BB.KHODUOC_ID        LEFT JOIN TM_PHAMVI CC ON BB.PHAMVI_ID=CC.PHAMVI_ID        where AA.BENHVIEN_ID = '01819' group by AA.KHODUOC_ID, AA.DUOC_ID, AA.NGUONDUOC_ID,CC.PHAMVI_ID        ) A        group by LTRIM(A.KHODUOC_ID) + '_' + LTRIM(A.DUOC_ID) + '_' + LTRIM(ISNULL(A.NGUONDUOC_ID,'')), A.KHODUOC_ID, A.DUOC_ID, NGUONDUOC_ID        ,A.PHAMVI_ID        ) TT_TONKHO on TT_TONKHO.DUOC_ID = TM_DUOC.DUOC_ID        LEFT JOIN TM_NGUONHANG NG ON NG.NGUONDUOC_ID = TT_TONKHO.NGUONDUOC_ID        LEFT JOIN TM_KHODUOC KD ON KD.KHODUOC_ID = TT_TONKHO.KHODUOC_ID        where TM_DUOC.BENHVIEN_ID = '01819' and TT_TONKHO.SOLUONG >= 0]
2020-07-16 15:39:02,061 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = '01819'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM023']
2020-07-16 15:39:02,092 [5] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoVaBooking] PreparedStatement : [declare @NGUONDUOC_MACDINH varchar(5) = '0';        declare @TOAMUANGOAI int = 0;        select @NGUONDUOC_MACDINH = isnull(VALUE,0) from TM_SYS_APPSETTINGS where CODE = 'PHA_NGUONDUOC'        select @TOAMUANGOAI = isnull(VALUE,0) from TM_SYS_APPSETTINGS where CODE = 'OPD_TOAMUANGOAI_DUNGDANHMUC_DUOC'                if @TOAMUANGOAI = 1        begin        select  distinct '0' + '_' + LTRIM(d.DUOC_ID) + '_' + @NGUONDUOC_MACDINH as DUOC_KEY, 0 as PHAMVI_ID, @NGUONDUOC_MACDINH as NGUONDUOC_ID, null as TENNGUONDUOC, null as TINHTIEN, d.DUOC_ID, ld.MALOAIDUOC,        d.SOVISA,d.TYLE_VAT,d.COTOA, d.MADUOC, d.TENHANG, d.TENDUOCDAYDU, d.DONVITINH as DONVITINH, d.BHYT,        d.TENHOATCHAT, d.HAMLUONG, d.HANGSANXUAT, d.QUOCGIA, d.LOAIDUOC_ID, d.DUONGDUNG_ID, d.TINHTIEN_PTTT,        ten.TENDUOC, ten.TENDUOC_EN, ten.MAQUOCTE, ten.MAQUOCTEBT,d.CONGDUNG,        '' as BHYT_TEXT        , ld.LOAIVATTU_ID        , d.BENHVIEN_ID,        999999999 as SOLUONG, d.VTYT_PHANLOAI, d.PHAMVI, d.SUASOLUONGTONGHOP, d.MADUOCBV, d.DANGTRINHBAY        , TAMNGUNG = CASE WHEN d.TAMNGUNG = '1' THEN '1' ELSE '0' END        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = '01819'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = '01819')        union all        select  distinct tk.DUOC_KEY, LTRIM(tk.PHAMVI_ID) as PHAMVI_ID, tk.NGUONDUOC_ID, nh.TENNGUONDUOC, nh.TINHTIEN, d.DUOC_ID, ld.MALOAIDUOC,        d.SOVISA,d.TYLE_VAT,d.COTOA, d.MADUOC, d.TENHANG, d.TENDUOCDAYDU, d.DONVITINH as DONVITINH, d.BHYT,        d.TENHOATCHAT, d.HAMLUONG, d.HANGSANXUAT, d.QUOCGIA, d.LOAIDUOC_ID, d.DUONGDUNG_ID, d.TINHTIEN_PTTT,        ten.TENDUOC, ten.TENDUOC_EN, ten.MAQUOCTE, ten.MAQUOCTEBT,d.CONGDUNG,        CASE WHEN d.BHYT = '1' THEN 'BHYT' ELSE '' END as BHYT_TEXT        , ld.LOAIVATTU_ID        , d.BENHVIEN_ID,        tk.SOLUONG, d.VTYT_PHANLOAI, d.PHAMVI, d.SUASOLUONGTONGHOP, d.MADUOCBV, d.DANGTRINHBAY        , TAMNGUNG = CASE WHEN d.TAMNGUNG = '1' OR nh.TAMNGUNG = '1' OR kd.TAMNGUNG = '1' THEN '1' ELSE '0' END        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = '01819'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = '01819')        inner join        (        select  LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')) DUOC_KEY, (SUM(dtk.SOLUONG) - isnull(sum(A.SOLUONG),0) - isnull(sum(B.SOLUONG),0)) SOLUONG, pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        from (select sum(soluong) soluong,duoc_id,nguonduoc_id,khoduoc_id,benhvien_id from TT_DUOC_TONKHO  group by duoc_id,nguonduoc_id,khoduoc_id,benhvien_id) dtk        inner join TM_DUOC_PHAMVISD_MAPPING pvsd on dtk.KHODUOC_ID = pvsd.KHODUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NOITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) B on B.DUOC_ID = dtk.DUOC_ID and B.SOLUONG > 0 and B.PHAMVI_ID = pvsd.PHAMVI_ID and B.NGUONHANG_ID = dtk.NGUONDUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NGOAITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) A on A.DUOC_ID = dtk.DUOC_ID and A.SOLUONG > 0 and A.PHAMVI_ID = pvsd.PHAMVI_ID and A.NGUONHANG_ID = dtk.NGUONDUOC_ID        where dtk.SOLUONG > 0 and dtk.BENHVIEN_ID = '01819'        group by LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')), pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        ) tk on tk.DUOC_ID = d.DUOC_ID        left join TM_DUOC_PHAMVISUDUNG kd on kd.PHAMVI_ID = tk.PHAMVI_ID and kd.BENHVIEN_ID = '01819'        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = tk.NGUONDUOC_ID and nh.BENHVIEN_ID = '01819'        where d.BENHVIEN_ID = '01819'  and tk.SOLUONG >= 0        end        else        begin                select  distinct tk.DUOC_KEY, LTRIM(tk.PHAMVI_ID) as PHAMVI_ID, tk.NGUONDUOC_ID, nh.TENNGUONDUOC, nh.TINHTIEN, d.DUOC_ID, ld.MALOAIDUOC,        d.SOVISA,d.TYLE_VAT,d.COTOA, d.MADUOC, d.TENHANG, d.TENDUOCDAYDU, d.DONVITINH as DONVITINH, d.BHYT,        d.TENHOATCHAT, d.HAMLUONG, d.HANGSANXUAT, d.QUOCGIA, d.LOAIDUOC_ID, d.DUONGDUNG_ID, d.TINHTIEN_PTTT,        ten.TENDUOC, ten.TENDUOC_EN, ten.MAQUOCTE, ten.MAQUOCTEBT,d.CONGDUNG,        CASE WHEN d.BHYT = '1' THEN 'BHYT' ELSE '' END as BHYT_TEXT        , ld.LOAIVATTU_ID        , d.BENHVIEN_ID,        tk.SOLUONG, d.VTYT_PHANLOAI, d.PHAMVI, d.SUASOLUONGTONGHOP, d.MADUOCBV, d.DANGTRINHBAY        , TAMNGUNG = CASE WHEN d.TAMNGUNG = '1' OR nh.TAMNGUNG = '1' OR kd.TAMNGUNG = '1' THEN '1' ELSE '0' END        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = '01819'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = '01819')        inner join        (        select  LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')) DUOC_KEY, (SUM(dtk.SOLUONG) - isnull(sum(A.SOLUONG),0) - isnull(sum(B.SOLUONG),0)) SOLUONG, pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        from (select sum(soluong) soluong,duoc_id,nguonduoc_id,khoduoc_id,benhvien_id from TT_DUOC_TONKHO  group by duoc_id,nguonduoc_id,khoduoc_id,benhvien_id) dtk        inner join TM_DUOC_PHAMVISD_MAPPING pvsd on dtk.KHODUOC_ID = pvsd.KHODUOC_ID        left join (        select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NOITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID)        B on B.DUOC_ID = dtk.DUOC_ID and B.SOLUONG > 0 and B.PHAMVI_ID = pvsd.PHAMVI_ID and B.NGUONHANG_ID = dtk.NGUONDUOC_ID        left join (        select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NGOAITRU where TRANGTHAI != 'HUY'        group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID)        A on A.DUOC_ID = dtk.DUOC_ID and A.SOLUONG > 0 and A.PHAMVI_ID = pvsd.PHAMVI_ID and A.NGUONHANG_ID = dtk.NGUONDUOC_ID        where dtk.SOLUONG > 0 and dtk.BENHVIEN_ID = '01819'        group by LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')), pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        ) tk on tk.DUOC_ID = d.DUOC_ID        left join TM_DUOC_PHAMVISUDUNG kd on kd.PHAMVI_ID = tk.PHAMVI_ID and kd.BENHVIEN_ID = '01819'        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = tk.NGUONDUOC_ID and nh.BENHVIEN_ID = '01819'        where d.BENHVIEN_ID = '01819'  and tk.SOLUONG >= 0        end]
2020-07-16 15:39:03,841 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = '01819'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM071']
2020-07-16 15:39:03,871 [5] DEBUG - Statement Id: [DAO00322_GetListMauTonKhoForCreateCached] PreparedStatement : [SELECT DISTINCT        TK.MAU_KEY, TK.KHOMAU_ID, M.MAU_ID, M.MAMAU, M.TENMAU, M.NHOM_ABO, M.NHOM_RH, M.LOAIMAU_ID,        TK.SOLONHAP_ID, SLN.SOLONHAP, SLN.SOKIEMSOAT, TK.NGUONHANG_ID, NG.TENNGUONMAU, M.BENHVIEN_ID, M.DONVITINH_ID,        SUM(tk.SOLUONG) AS SOLUONG,K.TENKHO,DVT.TENDONVITINH        FROM TT_MAU_TONKHO TK        JOIN TM_KHO K ON TK.KHOMAU_ID = K.KHO_ID        JOIN TT_MAU_CHUNGTU_SOLONHAP SLN ON TK.SOLONHAP_ID = SLN.SOLONHAP_ID        JOIN TM_MAU M on TK.MAU_ID = M.MAU_ID and M.TAMNGUNG = '0'        LEFT JOIN TM_MAU_DONVITINH DVT on M.DONVITINH_ID=DVT.DONVITINH_ID        LEFT JOIN TM_NGUONMAU NG ON NG.NGUONMAU_ID = TK.NGUONHANG_ID        WHERE TK.SOLUONG > 0        GROUP BY TK.MAU_KEY, TK.KHOMAU_ID, M.MAU_ID, M.MAMAU, M.TENMAU, M.NHOM_ABO, M.NHOM_RH, M.LOAIMAU_ID,        TK.SOLONHAP_ID, SLN.SOLONHAP, SLN.SOKIEMSOAT,TK.NGUONHANG_ID, NG.TENNGUONMAU, M.BENHVIEN_ID, M.DONVITINH_ID,K.TENKHO,DVT.TENDONVITINH]
2020-07-16 15:39:03,930 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = '01819'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM073']
2020-07-16 15:39:03,962 [5] DEBUG - Statement Id: [DAO00322_GetListMauTonKhoTruBooking] PreparedStatement : [select distinct        TK.MAU_KEY, TK.KHOMAU_ID, M.MAU_ID, M.MAMAU, M.TENMAU, M.NHOM_ABO, M.NHOM_RH, M.LOAIMAU_ID, M.DONVITINH_ID,        TK.SOLONHAP_ID, TK.SOLONHAP, TK.SOKIEMSOAT,M.PHAMVI, TK.NGUONHANG_ID, NG.TENNGUONMAU, M.BENHVIEN_ID,        TK.SOLUONG,TK.TENKHO,DVT.TENDONVITINH        from TM_MAU M        JOIN        (        select        A.MAU_KEY, A.KHOMAU_ID, A.MAU_ID ,a.NGUONHANG_ID, A.SOLONHAP_ID, A.SOLONHAP, A.SOKIEMSOAT, A.SOLUONG,A.TENKHO        from        (        select KHOMAU_ID, TK.MAU_ID, TK.NGUONHANG_ID, TK.MAU_KEY, SLN.SOLONHAP_ID, SLN.SOLONHAP, SLN.SOKIEMSOAT, ISNULL(TK.SOLUONG,0) - ISNULL(book.SOLUONG,0) as SOLUONG,K.TENKHO        from TT_MAU_TONKHO TK        JOIN TM_KHO K ON TK.KHOMAU_ID = K.KHO_ID        inner join TT_MAU_CHUNGTU_SOLONHAP SLN ON TK.SOLONHAP_ID = SLN.SOLONHAP_ID        left join dbo.TT_MAU_TONKHO_BOOK book ON book.MAU_KEY = TK.MAU_KEY AND book.TRANGTHAI = 'HIEULUC'        where ISNULL(TK.SOLUONG,0) - ISNULL(book.SOLUONG,0) > 0        ) A        )TK on TK.MAU_ID = M.MAU_ID and M.TAMNGUNG = '0'        LEFT JOIN TM_MAU_DONVITINH DVT on M.DONVITINH_ID=DVT.DONVITINH_ID        LEFT JOIN TM_NGUONMAU NG ON NG.NGUONMAU_ID = TK.NGUONHANG_ID]
2020-07-16 15:39:04,018 [5] DEBUG - Statement Id: [DAO00003_CacheList] PreparedStatement : [select *              from TM_SYS_CACHE              where HOSPITAL_ID = '01819'               AND                   TM_SYS_CACHE.ACTIVE = '1'               AND                   TM_SYS_CACHE.DAO_ID = 'COM072']
2020-07-16 15:39:04,929 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = '01819'               AND                   TM_SYS_SCREEN.PAGE = 'MAIN'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2020-07-16 15:39:05,895 [1] DEBUG - Statement Id: [DAO00002_FormList] PreparedStatement : [select              TM_SYS_FORM.HOSPITAL_ID,              TM_SYS_FORM.NAME,              TM_SYS_FORM.CLASS,              TM_SYS_FORM.ASSEMBLY,              TM_SYS_FORM.TITLE_VI as TITLE              from TM_SYS_FORM              where HOSPITAL_ID = '01819']
2020-07-16 15:39:09,041 [1] DEBUG - Statement Id: [DAO00300_GetShortcutListByUserID] PreparedStatement : [SELECT S.SHORTCUT_CODE, S.SHORTCUT_VALUE              FROM TM_SHORTCUT AS S              WHERE S.BENHVIEN_ID = '01819' AND S.USER_ID = '1' AND TAMNGUNG = '0']
2020-07-16 15:39:09,068 [1] DEBUG - Statement Id: [DAO00087_GetList] PreparedStatement : [select CODE, VALUE, BENHVIEN_ID              from TM_SYS_APPSETTINGS              where LOCKED = '0' and BENHVIEN_ID = '01819'              order by SETTING_ID]
2020-07-16 15:39:09,138 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = '01819'               AND                   TM_SYS_SCREEN.PAGE = 'MSG01'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2020-07-16 15:39:09,235 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = '01819'               AND                   TM_SYS_SCREEN.PAGE = 'MSG02'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2020-07-16 15:39:09,444 [1] DEBUG - Statement Id: [DAO00008_GetUserSettings] PreparedStatement : [select A.*, B.TENKHO , C.TENPHONGBAN, B.MAKHO, C.MAPHONGBAN          from TM_SYS_USERS A          left join TM_KHODUOC B on B.KHODUOC_ID = A.INVENTORY_ID          left join TM_PHONGBAN C on (C.PHONGBAN_ID = A.WORKING_DEPT_ID and C.BENHVIEN_ID =  @param0 )          left join TM_SYS_USERKHO D on (D.ACCOUNT_ID = A.ACCOUNT_ID and D.HOSPITAL_ID =  @param0 )          where          A.HOSPITAL_ID =  @param0            and                 A.ACCOUNT_ID =  @param1]
2020-07-16 15:39:09,445 [1] DEBUG - Statement Id: [DAO00008_GetUserSettings] Parameters: [@param0=[HOSPITAL_ID,01819], @param1=[ACCOUNT_ID,113]]
2020-07-16 15:39:09,445 [1] DEBUG - Statement Id: [DAO00008_GetUserSettings] Types: [@param0=[String, System.String], @param1=[String, System.String]]
2020-07-16 15:39:09,472 [1] DEBUG - Statement Id: [DAO00008_GetUserInvSettings] PreparedStatement : [select A.*, B.TENKHO, B.MAKHO, B.LOAIKHO_ID, B.KHOQUANLY_ID          from TM_SYS_USERKHO A          left join TM_KHO B on B.MODULE_ID = A.MODULE_ID and B.KHO_ID = A.KHO_ID          where A.HOSPITAL_ID =  @param0  and A.ACCOUNT_ID =  @param1           order by B.TENKHO]
2020-07-16 15:39:09,472 [1] DEBUG - Statement Id: [DAO00008_GetUserInvSettings] Parameters: [@param0=[HOSPITAL_ID,01819], @param1=[ACCOUNT_ID,113]]
2020-07-16 15:39:09,472 [1] DEBUG - Statement Id: [DAO00008_GetUserInvSettings] Types: [@param0=[String, System.String], @param1=[String, System.String]]
2020-07-16 15:39:09,583 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = '01819'               AND                   TM_SYS_SCREEN.PAGE = 'COM30'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2020-07-16 15:39:09,713 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = '01819'               AND                   TM_SYS_SCREEN.PAGE = 'RIS04'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2020-07-16 15:39:13,783 [1] DEBUG - Statement Id: [DAO00403_QMS002_GetThongTinClient] PreparedStatement : [SELECT B.ID as QUEUE_ID, B.NAME AS QUEUE_NAME,A.ID AS CLIENT_ID , A.[NAME] AS CLIENT_NAME, ISNULL(A.[STATE],1) AS [STATE],(CASE C.NAME WHEN 'UT' THEN 1 ELSE 0 END) AS QUEUETYPE     , B.DEPARTMENT_ID,ISNULL(B.SECTION_ID,-1) AS SECTION_ID,A.IPSERVER,A.NAMEAUDIO,C.QUEUE_TYPE_CODE,C.QUEUE_TYPE_CODE_SOUND,S.[NAME] AS SECTIONNAME     FROM QMS_QUEUE B LEFT JOIN QMS_CLIENT A ON A.QUEUE_ID = B.ID     LEFT JOIN QMS_QUEUE_TYPE C ON B.QUEUETYPE_ID = C.ID     LEFT JOIN QMS_SECTION S ON B.SECTION_ID=S.ID     WHERE     (A.COMPUTERNAME = 'DESKTOP-89GE5BA' OR A.IPADDRESS = '10.15.167.38') AND A.[STATE] = 1 AND B.DEPARTMENT_ID='25'            AND B.BENHVIEN_ID = '01819']
2020-07-16 15:39:13,863 [1] DEBUG - Statement Id: [DAO00045_GetList] PreparedStatement : [SELECT            TM_DICHVU.DICHVU_ID, TM_NHOMDICHVU.NHOMDICHVU_ID, TM_NHOMDICHVU.MANHOMDICHVU, TM_DICHVU.MADICHVU, TM_NHOMDICHVU.TENNHOMDICHVU,            TM_NHOMDICHVU.TENNHOMDICHVU_EN, TM_NHOMDICHVU.TENNHOMDICHVU_RU, TM_NHOMDICHVU.CAP, TM_NHOMDICHVU.CAPTREN_ID, TM_DICHVU.TENDICHVU,            TM_DICHVU.BENHVIEN_ID, TM_DICHVU.CHONHETCAPDUOI, TM_DICHVU.CAPTREN_ID AS DICHVU_CAPTREN_ID            FROM            TM_DICHVU            INNER JOIN            TM_NHOMDICHVU ON TM_DICHVU.NHOMDICHVU_ID = TM_NHOMDICHVU.NHOMDICHVU_ID AND TM_DICHVU.BENHVIEN_ID = TM_NHOMDICHVU.BENHVIEN_ID            where left(MANHOMDICHVU,2) in ('02, 03')            and TM_DICHVU.BENHVIEN_ID = '01819']
2020-07-16 15:39:14,546 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = '01819'               AND                   TM_SYS_SCREEN.PAGE = 'MENU1'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2020-07-16 15:39:14,612 [1] DEBUG - Statement Id: [DAO00011_GetList] PreparedStatement : [select              TM_SYS_MENU.ID,              TM_SYS_MENU.PARENTID,              TM_SYS_MENU.SCREEN,              TM_SYS_MENU.SMALLIMAGE,              TM_SYS_MENU.LARGEIMAGE,              TM_SYS_MENU.DESCRIPTION,              TM_SYS_MENU.TYPE,              TM_SYS_MENU.TITLE_VI as TITLE              from TM_SYS_MENU              where TM_SYS_MENU.HOSPITAL_ID = '01819' and TM_SYS_MENU.ACTIVE = '1'               AND                   (TM_SYS_MENU.TYPE & '8' = '8')                             order by TM_SYS_MENU.ORDERNUM]
2020-07-16 15:39:14,785 [1] DEBUG - Statement Id: [DAO00011_usermenu_list] PreparedStatement : [select              TM_SYS_HOMEMENU.MENUID as ID,              TM_SYS_MENU.TITLE_VI as TITLE,              TM_SYS_MENU.SCREEN,              TM_SYS_MENU.SMALLIMAGE,              TM_SYS_MENU.LARGEIMAGE,              TM_SYS_MENU.TYPE              from TM_SYS_HOMEMENU              left join TM_SYS_MENU on TM_SYS_MENU.ID = TM_SYS_HOMEMENU.MENUID and TM_SYS_MENU.HOSPITAL_ID = TM_SYS_HOMEMENU.HOSPITAL_ID              where TM_SYS_HOMEMENU.HOSPITAL_ID = '01819' and TM_SYS_HOMEMENU.USERID = '113' and TM_SYS_MENU.ACTIVE = '1'               AND                   (TM_SYS_MENU.TYPE & '8' = '8')                             ORDER BY TM_SYS_HOMEMENU.ORDERNUM]
2020-07-16 15:39:25,363 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = '01819'               AND                   TM_SYS_SCREEN.PAGE = 'REG14'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2020-07-16 15:39:26,154 [1] DEBUG - Statement Id: [DAO00012_GetList] PreparedStatement : [select        DICTIONARY_ID,        DICTIONARY_CODE,        DICTIONARY_NAME,        ATTRIBUTE1,        ATTRIBUTE2,        DICTIONARY_NAME_EN,        DICTIONARY_TYPE_CODE        from LST_DICTIONARY        where LST_DICTIONARY.Enabled = '1'         AND           LST_DICTIONARY.DICTIONARY_TYPE_CODE = 'PhanLoaiTiepNhan'                 order by LST_DICTIONARY.IDX]
2020-07-16 15:39:26,181 [1] DEBUG - Statement Id: [DAO00012_GetList] PreparedStatement : [select        DICTIONARY_ID,        DICTIONARY_CODE,        DICTIONARY_NAME,        ATTRIBUTE1,        ATTRIBUTE2,        DICTIONARY_NAME_EN,        DICTIONARY_TYPE_CODE        from LST_DICTIONARY        where LST_DICTIONARY.Enabled = '1'         AND           LST_DICTIONARY.DICTIONARY_TYPE_CODE = 'NguonBN'                 order by LST_DICTIONARY.IDX]
2020-07-16 15:39:26,206 [1] DEBUG - Statement Id: [DAO00019_GetListCongTyChiTra] PreparedStatement : [select *        from TM_CONGTYCHITRA        where        BENHVIEN_ID = '01819' AND TAMNGUNG = '0']
2020-07-16 15:39:26,231 [1] DEBUG - Statement Id: [DAO00019_GetQuanHam_TinhTrangBN] PreparedStatement : [select * from LST_DICTIONARY where DICTIONARY_TYPE_CODE = 'QuanHamBenhNhan' and ENABLED = '1']
2020-07-16 15:39:26,259 [1] DEBUG - Statement Id: [DAO00019_GetQuanHam_TinhTrangBN] PreparedStatement : [select * from LST_DICTIONARY where DICTIONARY_TYPE_CODE = 'TinhTrangBenhNhan' and ENABLED = '1']
2020-07-16 15:39:26,287 [1] DEBUG - Statement Id: [DAO00019_GetQuanHam_TinhTrangBN] PreparedStatement : [select * from LST_DICTIONARY where DICTIONARY_TYPE_CODE = 'DonViCongTac' and ENABLED = '1']
2020-07-16 15:39:26,394 [1] DEBUG - Statement Id: [DAO00403_QMS002_GetDSHangDoi_COMPUTERNAME] PreparedStatement : [SELECT B.ID,B.DEPARTMENT_ID,C.DEPARTMENT_NAME, C.DEPT_CODE, B.[NAME] as QUEUENAME,B.ID as QUEUE_ID     FROM QMS_QUEUE B     INNER JOIN QMS_DEPARTMENT C ON B.DEPARTMENT_ID=C.DEPARTMENT_ID     JOIN (SELECT DISTINCT XX.SECTION_ID FROM QMS_QUEUE XX JOIN QMS_CLIENT YY ON YY.QUEUE_ID = XX.ID     WHERE XX.DEPARTMENT_ID='25' AND (YY.COMPUTERNAME = 'DESKTOP-89GE5BA' OR YY.IPADDRESS = '10.15.167.38')) A ON A.SECTION_ID = B.SECTION_ID     WHERE B.BENHVIEN_ID = '01819' AND B.STATE = 1]
2020-07-16 15:39:26,592 [1] DEBUG - Statement Id: [DAO00017_GetListPhongKham] PreparedStatement : [select pb.PHONGBAN_ID, pb.TENPHONGBAN, case when dv.ATTRIBUTE5 is null then 'TT' else 'KTC' end as LOAI_CHIPHI              from [TM_PHONGBAN_DICHVU] as pb_dv              inner join [TM_PHONGBAN] as pb on pb.PHONGBAN_ID = pb_dv.PHONGBAN_ID and pb.BENHVIEN_ID = '01819'              inner join [TM_DICHVU] dv on dv.DICHVU_ID = pb_dv.DICHVU_ID and dv.MADICHVU = '' and dv.BENHVIEN_ID = '01819'              where pb_dv.BENHVIEN_ID = '01819']
2020-07-16 15:39:26,624 [1] DEBUG - Statement Id: [DAO00019_GetListPhongKham_REG13] PreparedStatement : [select pb.PHONGBAN_ID, pb.TENPHONGBAN, case when dv.ATTRIBUTE5 is null then 'TT' else 'KTC' end as LOAI_CHIPHI        from TM_PHONGBAN pb        left join TM_PHONGBAN_DICHVU pb_dv on pb_dv.PHONGBAN_ID = pb.PHONGBAN_ID and pb_dv.BENHVIEN_ID = pb.BENHVIEN_ID        left join TM_DICHVU dv on dv.DICHVU_ID = pb_dv.DICHVU_ID and dv.BENHVIEN_ID = pb_dv.BENHVIEN_ID        left join TM_NHOMDICHVU ndv on ndv.NHOMDICHVU_ID = dv.NHOMDICHVU_ID and ndv.BENHVIEN_ID = dv.BENHVIEN_ID        where pb.BENHVIEN_ID = '01819' and ndv.MANHOMDICHVU = '04' and dv.DICHVU_ID IS NOT NULL]
2020-07-16 15:39:26,695 [1] DEBUG - Statement Id: [DAO00019_LayThongTinSoluongDichVuPhongKham_REG13] PreparedStatement : [select PHONGBAN_ID, TENPHONGBAN, NOITHUCHIEN_ID, SUM(CHUAKETQUA) AS CHUAKETQUA, SUM(HOANTAT) AS HOANTAT, SUM(DANGTHUCHIEN) AS DANGTHUCHIEN        , SUM(BHYT) as BHYT, SUM(VIENPHI) as VIENPHI        from (        select B.PHONGBAN_ID, B.TENPHONGBAN, A.NOITHUCHIEN_ID,        case when A.TRANGTHAI = 'CHUAKETQUA' then 1 else 0 end AS CHUAKETQUA,        case when A.TRANGTHAI not in ('CHUAKETQUA','DANGTHUCHIEN','CHOXACNHAN') then 1 else 0 end AS HOANTAT,        case when A.TRANGTHAI = 'DANGTHUCHIEN' then 1 else 0 end AS DANGTHUCHIEN,        case when len(tn.SOBHYT) > 1 then 1 else 0 end as BHYT,        case when len(tn.SOBHYT) = 0 then 1 else 0 end as VIENPHI        from TM_PHONGBAN B        left join TT_DVYEUCAU A on A.NOITHUCHIEN_ID = B.PHONGBAN_ID and A.BENHVIEN_ID = B.BENHVIEN_ID and A.NGAYYEUCAU = CONVERT(date, getdate())        inner join TT_TIEPNHAN tn on tn.TIEPNHAN_ID = A.TIEPNHAN_ID        left join TM_DICHVU dv on A.DICHVU_ID = dv.DICHVU_ID        left join TM_NHOMDICHVU ndv on ndv.NHOMDICHVU_ID = dv.NHOMDICHVU_ID        where B.BENHVIEN_ID ='01819' and Left(ndv.MANHOMDICHVU,2) = '04'        and B.PHONGBAN_ID in (60,62,64,66,67,69,71,72,73,74,75,55,55,56,56,57,57,54,12,80,80,63,76,1002,79,70,68,53,53,14,14,14,61,1001)        ) tmp        group by tmp.NOITHUCHIEN_ID, tmp.TENPHONGBAN, tmp.PHONGBAN_ID]
2020-07-16 15:39:27,276 [1] DEBUG - Statement Id: [DAO00403_QMS002_GetThongTinClient] PreparedStatement : [SELECT B.ID as QUEUE_ID, B.NAME AS QUEUE_NAME,A.ID AS CLIENT_ID , A.[NAME] AS CLIENT_NAME, ISNULL(A.[STATE],1) AS [STATE],(CASE C.NAME WHEN 'UT' THEN 1 ELSE 0 END) AS QUEUETYPE     , B.DEPARTMENT_ID,ISNULL(B.SECTION_ID,-1) AS SECTION_ID,A.IPSERVER,A.NAMEAUDIO,C.QUEUE_TYPE_CODE,C.QUEUE_TYPE_CODE_SOUND,S.[NAME] AS SECTIONNAME     FROM QMS_QUEUE B LEFT JOIN QMS_CLIENT A ON A.QUEUE_ID = B.ID     LEFT JOIN QMS_QUEUE_TYPE C ON B.QUEUETYPE_ID = C.ID     LEFT JOIN QMS_SECTION S ON B.SECTION_ID=S.ID     WHERE     (A.COMPUTERNAME = 'DESKTOP-89GE5BA' OR A.IPADDRESS = '10.15.167.38') AND A.[STATE] = 1 AND B.DEPARTMENT_ID='25'            AND B.BENHVIEN_ID = '01819']
2020-07-16 15:39:33,879 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = '01819'               AND                   TM_SYS_SCREEN.PAGE = 'COM98'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2020-07-16 15:39:34,179 [1] DEBUG - Statement Id: [DAO00020_ListKhoDuocOfPhongBan] PreparedStatement : [select B.* from TM_PHONGBAN_KHODUOC A        inner join TM_KHODUOC B on B.KHODUOC_ID = A.KHODUOC_ID        where        A.PHONGBAN_ID = '25'        and A.BENHVIEN_ID = '01819']
2020-07-16 15:39:39,023 [1] DEBUG - Statement Id: [DAO00020_ListKhoDuocOfPhongBan] PreparedStatement : [select B.* from TM_PHONGBAN_KHODUOC A        inner join TM_KHODUOC B on B.KHODUOC_ID = A.KHODUOC_ID        where        A.PHONGBAN_ID = '97'        and A.BENHVIEN_ID = '01819']
2020-07-16 15:39:50,877 [1] DEBUG - Statement Id: [DAO00008_UpdateUserIdPhongBanKhoDuoc] PreparedStatement : [IF EXISTS            (SELECT ACCOUNT_ID FROM TM_SYS_USERS WHERE ACCOUNT_ID =  @param0  and HOSPITAL_ID =  @param1 )            BEGIN            update TM_SYS_USERS set INVENTORY_ID =  @param2 , WORKING_DEPT_ID =  @param3             WHERE ACCOUNT_ID =  @param0  and HOSPITAL_ID =  @param1             END            ELSE            BEGIN            insert into TM_SYS_USERS ([ACCOUNT_ID], [ACCOUNT_NAME], [INVENTORY_ID], [WORKING_DEPT_ID], [HOSPITAL_ID])            values ( @param0 ,  @param4 ,  @param2 ,  @param3 ,  @param1 )            END]
2020-07-16 15:39:50,877 [1] DEBUG - Statement Id: [DAO00008_UpdateUserIdPhongBanKhoDuoc] Parameters: [@param0=[ACCOUNT_ID,113], @param1=[HOSPITAL_ID,01819], @param2=[INVENTORY_ID,null], @param3=[WORKING_DEPT_ID,97], @param4=[ACCOUNT_NAME,admin]]
2020-07-16 15:39:50,877 [1] DEBUG - Statement Id: [DAO00008_UpdateUserIdPhongBanKhoDuoc] Types: [@param0=[String, System.String], @param1=[String, System.String], @param2=[System.DBNull, null], @param3=[String, System.String], @param4=[String, System.String]]
2020-07-16 15:39:50,998 [1] DEBUG - Statement Id: [DAO00087_GetServiceParams] PreparedStatement : [select CODE, VALUE              from TM_SYS_APPSETTINGS              where LOCKED = '0' and BENHVIEN_ID = '01819']
2020-07-16 15:39:51,161 [1] DEBUG - Statement Id: [DAO00030_CheckLoaiPhongBan] PreparedStatement : [select pb.*  from TM_PHONGBAN pb          join LST_DICTIONARY dic on pb.LOAIPHONGBAN_ID = dic.DICTIONARY_ID          where          pb.PHONGBAN_ID = 97          and dic.DICTIONARY_CODE = '']
2020-07-16 15:39:53,881 [1] DEBUG - Statement Id: [DAO00012_GetList] PreparedStatement : [select        DICTIONARY_ID,        DICTIONARY_CODE,        DICTIONARY_NAME,        ATTRIBUTE1,        ATTRIBUTE2,        DICTIONARY_NAME_EN,        DICTIONARY_TYPE_CODE        from LST_DICTIONARY        where LST_DICTIONARY.Enabled = '1'         AND           LST_DICTIONARY.DICTIONARY_TYPE_CODE = 'PhanLoaiTiepNhan'                 order by LST_DICTIONARY.IDX]
2020-07-16 15:39:53,908 [1] DEBUG - Statement Id: [DAO00012_GetList] PreparedStatement : [select        DICTIONARY_ID,        DICTIONARY_CODE,        DICTIONARY_NAME,        ATTRIBUTE1,        ATTRIBUTE2,        DICTIONARY_NAME_EN,        DICTIONARY_TYPE_CODE        from LST_DICTIONARY        where LST_DICTIONARY.Enabled = '1'         AND           LST_DICTIONARY.DICTIONARY_TYPE_CODE = 'NguonBN'                 order by LST_DICTIONARY.IDX]
2020-07-16 15:39:53,933 [1] DEBUG - Statement Id: [DAO00019_GetListCongTyChiTra] PreparedStatement : [select *        from TM_CONGTYCHITRA        where        BENHVIEN_ID = '01819' AND TAMNGUNG = '0']
2020-07-16 15:39:53,962 [1] DEBUG - Statement Id: [DAO00019_GetQuanHam_TinhTrangBN] PreparedStatement : [select * from LST_DICTIONARY where DICTIONARY_TYPE_CODE = 'QuanHamBenhNhan' and ENABLED = '1']
2020-07-16 15:39:53,993 [1] DEBUG - Statement Id: [DAO00019_GetQuanHam_TinhTrangBN] PreparedStatement : [select * from LST_DICTIONARY where DICTIONARY_TYPE_CODE = 'TinhTrangBenhNhan' and ENABLED = '1']
2020-07-16 15:39:54,021 [1] DEBUG - Statement Id: [DAO00019_GetQuanHam_TinhTrangBN] PreparedStatement : [select * from LST_DICTIONARY where DICTIONARY_TYPE_CODE = 'DonViCongTac' and ENABLED = '1']
2020-07-16 15:39:54,194 [1] DEBUG - Statement Id: [DAO00403_QMS002_GetDSHangDoi_COMPUTERNAME] PreparedStatement : [SELECT B.ID,B.DEPARTMENT_ID,C.DEPARTMENT_NAME, C.DEPT_CODE, B.[NAME] as QUEUENAME,B.ID as QUEUE_ID     FROM QMS_QUEUE B     INNER JOIN QMS_DEPARTMENT C ON B.DEPARTMENT_ID=C.DEPARTMENT_ID     JOIN (SELECT DISTINCT XX.SECTION_ID FROM QMS_QUEUE XX JOIN QMS_CLIENT YY ON YY.QUEUE_ID = XX.ID     WHERE XX.DEPARTMENT_ID='97' AND (YY.COMPUTERNAME = 'DESKTOP-89GE5BA' OR YY.IPADDRESS = '10.15.167.38')) A ON A.SECTION_ID = B.SECTION_ID     WHERE B.BENHVIEN_ID = '01819' AND B.STATE = 1]
2020-07-16 15:39:54,260 [1] DEBUG - Statement Id: [DAO00017_GetListPhongKham] PreparedStatement : [select pb.PHONGBAN_ID, pb.TENPHONGBAN, case when dv.ATTRIBUTE5 is null then 'TT' else 'KTC' end as LOAI_CHIPHI              from [TM_PHONGBAN_DICHVU] as pb_dv              inner join [TM_PHONGBAN] as pb on pb.PHONGBAN_ID = pb_dv.PHONGBAN_ID and pb.BENHVIEN_ID = '01819'              inner join [TM_DICHVU] dv on dv.DICHVU_ID = pb_dv.DICHVU_ID and dv.MADICHVU = '' and dv.BENHVIEN_ID = '01819'              where pb_dv.BENHVIEN_ID = '01819']
2020-07-16 15:39:54,294 [1] DEBUG - Statement Id: [DAO00019_GetListPhongKham_REG13] PreparedStatement : [select pb.PHONGBAN_ID, pb.TENPHONGBAN, case when dv.ATTRIBUTE5 is null then 'TT' else 'KTC' end as LOAI_CHIPHI        from TM_PHONGBAN pb        left join TM_PHONGBAN_DICHVU pb_dv on pb_dv.PHONGBAN_ID = pb.PHONGBAN_ID and pb_dv.BENHVIEN_ID = pb.BENHVIEN_ID        left join TM_DICHVU dv on dv.DICHVU_ID = pb_dv.DICHVU_ID and dv.BENHVIEN_ID = pb_dv.BENHVIEN_ID        left join TM_NHOMDICHVU ndv on ndv.NHOMDICHVU_ID = dv.NHOMDICHVU_ID and ndv.BENHVIEN_ID = dv.BENHVIEN_ID        where pb.BENHVIEN_ID = '01819' and ndv.MANHOMDICHVU = '04' and dv.DICHVU_ID IS NOT NULL]
2020-07-16 15:39:54,365 [1] DEBUG - Statement Id: [DAO00019_LayThongTinSoluongDichVuPhongKham_REG13] PreparedStatement : [select PHONGBAN_ID, TENPHONGBAN, NOITHUCHIEN_ID, SUM(CHUAKETQUA) AS CHUAKETQUA, SUM(HOANTAT) AS HOANTAT, SUM(DANGTHUCHIEN) AS DANGTHUCHIEN        , SUM(BHYT) as BHYT, SUM(VIENPHI) as VIENPHI        from (        select B.PHONGBAN_ID, B.TENPHONGBAN, A.NOITHUCHIEN_ID,        case when A.TRANGTHAI = 'CHUAKETQUA' then 1 else 0 end AS CHUAKETQUA,        case when A.TRANGTHAI not in ('CHUAKETQUA','DANGTHUCHIEN','CHOXACNHAN') then 1 else 0 end AS HOANTAT,        case when A.TRANGTHAI = 'DANGTHUCHIEN' then 1 else 0 end AS DANGTHUCHIEN,        case when len(tn.SOBHYT) > 1 then 1 else 0 end as BHYT,        case when len(tn.SOBHYT) = 0 then 1 else 0 end as VIENPHI        from TM_PHONGBAN B        left join TT_DVYEUCAU A on A.NOITHUCHIEN_ID = B.PHONGBAN_ID and A.BENHVIEN_ID = B.BENHVIEN_ID and A.NGAYYEUCAU = CONVERT(date, getdate())        inner join TT_TIEPNHAN tn on tn.TIEPNHAN_ID = A.TIEPNHAN_ID        left join TM_DICHVU dv on A.DICHVU_ID = dv.DICHVU_ID        left join TM_NHOMDICHVU ndv on ndv.NHOMDICHVU_ID = dv.NHOMDICHVU_ID        where B.BENHVIEN_ID ='01819' and Left(ndv.MANHOMDICHVU,2) = '04'        and B.PHONGBAN_ID in (60,62,64,66,67,69,71,72,73,74,75,55,55,56,56,57,57,54,12,80,80,63,76,1002,79,70,68,53,53,14,14,14,61,1001)        ) tmp        group by tmp.NOITHUCHIEN_ID, tmp.TENPHONGBAN, tmp.PHONGBAN_ID]
2020-07-16 15:39:54,518 [1] DEBUG - Statement Id: [DAO00403_QMS002_GetThongTinClient] PreparedStatement : [SELECT B.ID as QUEUE_ID, B.NAME AS QUEUE_NAME,A.ID AS CLIENT_ID , A.[NAME] AS CLIENT_NAME, ISNULL(A.[STATE],1) AS [STATE],(CASE C.NAME WHEN 'UT' THEN 1 ELSE 0 END) AS QUEUETYPE     , B.DEPARTMENT_ID,ISNULL(B.SECTION_ID,-1) AS SECTION_ID,A.IPSERVER,A.NAMEAUDIO,C.QUEUE_TYPE_CODE,C.QUEUE_TYPE_CODE_SOUND,S.[NAME] AS SECTIONNAME     FROM QMS_QUEUE B LEFT JOIN QMS_CLIENT A ON A.QUEUE_ID = B.ID     LEFT JOIN QMS_QUEUE_TYPE C ON B.QUEUETYPE_ID = C.ID     LEFT JOIN QMS_SECTION S ON B.SECTION_ID=S.ID     WHERE     (A.COMPUTERNAME = 'DESKTOP-89GE5BA' OR A.IPADDRESS = '10.15.167.38') AND A.[STATE] = 1 AND B.DEPARTMENT_ID='97'            AND B.BENHVIEN_ID = '01819']
2020-07-16 15:40:00,180 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = '01819'               AND                   TM_SYS_SCREEN.PAGE = 'REG05'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2020-07-16 15:40:00,280 [1] DEBUG - Statement Id: [DAO00019_GetTotalLichSuTiepNhan] PreparedStatement : [select count(*)        from (        select T.*        from TT_TIEPNHAN AS T        where        T.BENHVIEN_ID = '01819'         and           convert(date, T.NGAYTIEPNHAN) >= '7/16/2020 3:40:00 PM'         and           convert(date, T.NGAYTIEPNHAN) <= '7/16/2020 3:40:00 PM'                 ) as tn        inner join (select A.*, B.DESCRIPTION from TT_BENHNHAN A        left join TM_GENDER B on B.ID = A.GIOITINH) as bn on tn.BENHNHAN_ID = bn.BENHNHAN_ID                 where tn.BENHVIEN_ID = '01819']
2020-07-16 15:40:00,387 [1] DEBUG - Statement Id: [DAO00019_GetLichSuTiepNhan] PreparedStatement : [select * from (        select ROW_NUMBER() OVER(ORDER BY tn.THOIGIANTIEPNHAN desc) AS ROWNUMBER, tn.*, bn.MAYTE,        bn.TENBENHNHAN, isnull(convert(varchar, NGAYSINH, 103), convert(varchar, NAMSINH)) as NGAYSINH,        bn.DESCRIPTION as GIOITINH, isnull(bn.DIACHILIENLAC,bn.DIACHITHUONGTRU) as DIACHILIENLAC        from (        select T.*, LOAIBENHAN = CASE ISNULL(NB.LOAIBENHAN,ISNULL(NN.LOAIBENHAN,0)) WHEN 0 THEN '' WHEN 2 THEN 'DTNT' WHEN 1 THEN 'CC' ELSE 'NT' END        , DT.TENDOITUONG, NV.TENNHANVIEN        from TT_TIEPNHAN AS T        left join TT_NOITRU_NHAPVIEN AS NN ON NN.TIEPNHAN_ID = T.TIEPNHAN_ID        left join TT_NOITRU_BENHAN AS NB ON NB.BENHAN_ID = (SELECT TOP 1 BENHAN_ID FROM TT_NOITRU_BENHAN WHERE TIEPNHAN_ID = T.TIEPNHAN_ID ORDER BY BENHAN_ID DESC)        left join TM_DOITUONG AS DT ON DT.DOITUONG_ID = T.DOITUONG_ID        left join TM_NHANVIEN AS NV ON NV.NHANVIEN_ID = T.NGUOITAO_ID        where        T.BENHVIEN_ID = '01819'         and           convert(date, T.NGAYTIEPNHAN) >= '7/16/2020 3:40:00 PM'         and           convert(date, T.NGAYTIEPNHAN) <= '7/16/2020 3:40:00 PM'                 ) as tn        inner join (select A.*, B.DESCRIPTION from TT_BENHNHAN A        left join TM_GENDER B on B.ID = A.GIOITINH) as bn on tn.BENHNHAN_ID = bn.BENHNHAN_ID                 ) as tn        where (tn.RowNumber between 1 and 17) and tn.BENHVIEN_ID = '01819'        order by tn.THOIGIANTIEPNHAN desc]
2020-07-16 15:40:19,809 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = '01819'               AND                   TM_SYS_SCREEN.PAGE = 'REG07'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2020-07-16 15:40:46,131 [1] DEBUG - Statement Id: [DAO00095_GetDetailTrungBN] PreparedStatement : [select  TT_TIEPNHAN.NGAYTIEPNHAN AS NGAYTIEPNHAN ,TT_TIEPNHAN.SOBHYT AS SOTHE, TT_BENHNHAN.*, ISNULL(TT_BENHNHAN.NGAYSINH,TT_BENHNHAN.NAMSINH) AS NGAYNAMSINH          from TT_BENHNHAN          left join TT_TIEPNHAN  ON          TT_TIEPNHAN.TIEPNHAN_ID = (SELECT TOP 1 TIEPNHAN_ID FROM TT_TIEPNHAN WHERE BENHNHAN_ID = TT_BENHNHAN.BENHNHAN_ID ORDER BY THOIGIANTIEPNHAN DESC)           WHERE                TT_BENHNHAN.TENBENHNHAN = N'Fpt Test'             AND               TT_BENHNHAN.NAMSINH = '1988'             AND               TT_BENHNHAN.GIOITINH = '1']
2020-07-16 15:40:57,269 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = '01819'               AND                   TM_SYS_SCREEN.PAGE = 'REG13'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2020-07-16 15:41:38,084 [1] DEBUG - Statement Id: [DAO00095_GetDetailTrungBN] PreparedStatement : [select  TT_TIEPNHAN.NGAYTIEPNHAN AS NGAYTIEPNHAN ,TT_TIEPNHAN.SOBHYT AS SOTHE, TT_BENHNHAN.*, ISNULL(TT_BENHNHAN.NGAYSINH,TT_BENHNHAN.NAMSINH) AS NGAYNAMSINH          from TT_BENHNHAN          left join TT_TIEPNHAN  ON          TT_TIEPNHAN.TIEPNHAN_ID = (SELECT TOP 1 TIEPNHAN_ID FROM TT_TIEPNHAN WHERE BENHNHAN_ID = TT_BENHNHAN.BENHNHAN_ID ORDER BY THOIGIANTIEPNHAN DESC)           WHERE                TT_BENHNHAN.TENBENHNHAN = N'Fpt Test'             AND               convert(varchar(10),TT_BENHNHAN.NGAYSINH, 103) = convert(varchar(10),'01/01/1998', 103)               AND               TT_BENHNHAN.GIOITINH = '1']
2020-07-16 15:41:43,154 [1] DEBUG - Statement Id: [DAO00095_GetDetailTrungBN] PreparedStatement : [select  TT_TIEPNHAN.NGAYTIEPNHAN AS NGAYTIEPNHAN ,TT_TIEPNHAN.SOBHYT AS SOTHE, TT_BENHNHAN.*, ISNULL(TT_BENHNHAN.NGAYSINH,TT_BENHNHAN.NAMSINH) AS NGAYNAMSINH          from TT_BENHNHAN          left join TT_TIEPNHAN  ON          TT_TIEPNHAN.TIEPNHAN_ID = (SELECT TOP 1 TIEPNHAN_ID FROM TT_TIEPNHAN WHERE BENHNHAN_ID = TT_BENHNHAN.BENHNHAN_ID ORDER BY THOIGIANTIEPNHAN DESC)           WHERE                TT_BENHNHAN.TENBENHNHAN = N'Fpt Test'             AND               convert(varchar(10),TT_BENHNHAN.NGAYSINH, 103) = convert(varchar(10),'01/01/1988', 103)               AND               TT_BENHNHAN.GIOITINH = '1']
2020-07-16 15:41:46,300 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = '01819'               AND                   TM_SYS_SCREEN.PAGE = 'MPI01'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2020-07-16 15:41:46,476 [1] DEBUG - Statement Id: [DAO00012_GetList] PreparedStatement : [select        DICTIONARY_ID,        DICTIONARY_CODE,        DICTIONARY_NAME,        ATTRIBUTE1,        ATTRIBUTE2,        DICTIONARY_NAME_EN,        DICTIONARY_TYPE_CODE        from LST_DICTIONARY        where LST_DICTIONARY.Enabled = '1'         AND           LST_DICTIONARY.DICTIONARY_TYPE_CODE = 'QuanHeGiaDinh'                 order by LST_DICTIONARY.IDX]
2020-07-16 15:41:46,567 [1] DEBUG - Statement Id: [DAO00012_GetList] PreparedStatement : [select        DICTIONARY_ID,        DICTIONARY_CODE,        DICTIONARY_NAME,        ATTRIBUTE1,        ATTRIBUTE2,        DICTIONARY_NAME_EN,        DICTIONARY_TYPE_CODE        from LST_DICTIONARY        where LST_DICTIONARY.Enabled = '1'         AND           LST_DICTIONARY.DICTIONARY_TYPE_CODE in ('TinhTrangGiaDinh', 'TrinhDoVanHoa')                 order by LST_DICTIONARY.IDX]
2020-07-16 15:42:23,542 [1] DEBUG - Statement Id: [DAO00019_GetLoaiGiaLoaiKhachHang] PreparedStatement : [select A.*, B.DICTIONARY_CODE MAKHACHHANG, C.TENLOAIGIA        from TM_NGUONKHACHHANG_LOAIGIA A        left join LST_DICTIONARY B on A.NGUONKHACHHANG_BENHNHAN_ID = B.DICTIONARY_ID        inner join TM_LOAIGIA C on C.LOAIGIA_ID = A.LOAIGIA_ID and CAPTREN_ID  = (select LOAIGIA_ID from TM_LOAIGIA where MALOAIGIA = 'GiaDichVu')        left join TM_DICHVU_DONGIA dvdg on dvdg.LOAIGIA_ID = A.LOAIGIA_ID        where B.DICTIONARY_TYPE_CODE = 'NguonKhachHang' and dvdg.DICHVU_ID  =  @param0]
2020-07-16 15:42:23,542 [1] DEBUG - Statement Id: [DAO00019_GetLoaiGiaLoaiKhachHang] Parameters: [@param0=[DICHVU_ID,3]]
2020-07-16 15:42:23,542 [1] DEBUG - Statement Id: [DAO00019_GetLoaiGiaLoaiKhachHang] Types: [@param0=[Int64, System.Int64]]
2020-07-16 15:42:23,571 [1] DEBUG - Statement Id: [DAO00017_GetLoaiGiaDoiTuongDichVu] PreparedStatement : [select a.LOAIGIA_ID, a.TENLOAIGIA, a.MALOAIGIA, a.CAPTREN_ID, MIN(a.UUTIEN_NGUON) AS UUTIEN_NGUON          , MAX(a.DOUUTIEN) AS DOUUTIEN, MIN(ISNULL(a.GIAHOTRO,0)) AS GIAHOTRO          from(                        select distinct A.LOAIGIA_ID, C.TENLOAIGIA, C.MALOAIGIA, 0 as UUTIEN_NGUON, isnull(B.DOUUTIEN,0) as DOUUTIEN, B.GIAHOTRO, C.CAPTREN_ID            from TM_DOITUONG_GIADICHVU A            left join TM_DOITUONG_LOAIGIA B on A.LOAIGIA_ID = B.LOAIGIA_ID and A.DOITUONG_ID = B.DOITUONG_ID and B.BENHVIEN_ID = '01819'            inner join TM_LOAIGIA C on A.LOAIGIA_ID = C.LOAIGIA_ID and C.BENHVIEN_ID = '01819'            where A.DOITUONG_ID = '1'                            and A.DICHVU_ID = '3'                         and A.BENHVIEN_ID = '01819'                     ) a          where a.DOUUTIEN != 0 and a.DOUUTIEN is not null          group by a.LOAIGIA_ID, a.TENLOAIGIA, a.MALOAIGIA, a.CAPTREN_ID          order by MAX(a.UUTIEN_NGUON) desc ,MAX(a.DOUUTIEN) asc]
2020-07-16 15:42:23,621 [1] DEBUG - Statement Id: [DAO00017_GetListPhongKham] PreparedStatement : [select pb.PHONGBAN_ID, pb.TENPHONGBAN, case when dv.ATTRIBUTE5 is null then 'TT' else 'KTC' end as LOAI_CHIPHI              from [TM_PHONGBAN_DICHVU] as pb_dv              inner join [TM_PHONGBAN] as pb on pb.PHONGBAN_ID = pb_dv.PHONGBAN_ID and pb.BENHVIEN_ID = '01819'              inner join [TM_DICHVU] dv on dv.DICHVU_ID = pb_dv.DICHVU_ID and dv.MADICHVU = '0003' and dv.BENHVIEN_ID = '01819'              where pb_dv.BENHVIEN_ID = '01819']
2020-07-16 15:42:23,671 [1] DEBUG - Statement Id: [DAO00019_GetListPhongKham_REG13] PreparedStatement : [select pb.PHONGBAN_ID, pb.TENPHONGBAN, case when dv.ATTRIBUTE5 is null then 'TT' else 'KTC' end as LOAI_CHIPHI        from TM_PHONGBAN pb        left join TM_PHONGBAN_DICHVU pb_dv on pb_dv.PHONGBAN_ID = pb.PHONGBAN_ID and pb_dv.BENHVIEN_ID = pb.BENHVIEN_ID        left join TM_DICHVU dv on dv.DICHVU_ID = pb_dv.DICHVU_ID and dv.BENHVIEN_ID = pb_dv.BENHVIEN_ID        left join TM_NHOMDICHVU ndv on ndv.NHOMDICHVU_ID = dv.NHOMDICHVU_ID and ndv.BENHVIEN_ID = dv.BENHVIEN_ID        where pb.BENHVIEN_ID = '01819' and ndv.MANHOMDICHVU = '04' and dv.DICHVU_ID IS NOT NULL]
2020-07-16 15:42:23,743 [1] DEBUG - Statement Id: [DAO00019_LayThongTinSoluongDichVuPhongKham_REG13] PreparedStatement : [select PHONGBAN_ID, TENPHONGBAN, NOITHUCHIEN_ID, SUM(CHUAKETQUA) AS CHUAKETQUA, SUM(HOANTAT) AS HOANTAT, SUM(DANGTHUCHIEN) AS DANGTHUCHIEN        , SUM(BHYT) as BHYT, SUM(VIENPHI) as VIENPHI        from (        select B.PHONGBAN_ID, B.TENPHONGBAN, A.NOITHUCHIEN_ID,        case when A.TRANGTHAI = 'CHUAKETQUA' then 1 else 0 end AS CHUAKETQUA,        case when A.TRANGTHAI not in ('CHUAKETQUA','DANGTHUCHIEN','CHOXACNHAN') then 1 else 0 end AS HOANTAT,        case when A.TRANGTHAI = 'DANGTHUCHIEN' then 1 else 0 end AS DANGTHUCHIEN,        case when len(tn.SOBHYT) > 1 then 1 else 0 end as BHYT,        case when len(tn.SOBHYT) = 0 then 1 else 0 end as VIENPHI        from TM_PHONGBAN B        left join TT_DVYEUCAU A on A.NOITHUCHIEN_ID = B.PHONGBAN_ID and A.BENHVIEN_ID = B.BENHVIEN_ID and A.NGAYYEUCAU = CONVERT(date, getdate())        inner join TT_TIEPNHAN tn on tn.TIEPNHAN_ID = A.TIEPNHAN_ID        left join TM_DICHVU dv on A.DICHVU_ID = dv.DICHVU_ID        left join TM_NHOMDICHVU ndv on ndv.NHOMDICHVU_ID = dv.NHOMDICHVU_ID        where B.BENHVIEN_ID ='01819' and Left(ndv.MANHOMDICHVU,2) = '04'        and B.PHONGBAN_ID in (60,62,64,66,67,69,71,72,73,74,75,55,55,56,56,57,57,54,12,80,80,63,76,1002,79,70,68,53,53,14,14,14,61,1001)        ) tmp        group by tmp.NOITHUCHIEN_ID, tmp.TENPHONGBAN, tmp.PHONGBAN_ID]
2020-07-16 15:42:23,828 [1] DEBUG - Statement Id: [DAO00000_GetDICHVU_DONGIA_LOAIGIA] PreparedStatement : [select A.LOAIGIA_ID, A.BANGGIA_ID, A.GIAVON, A.TYLEVAT  as TYLE_VAT, A.TYLE_LOINHUAN,            A.DONGIA as DONGIA_DOANHTHU, NULL as DONGIA_KHAC, isnull(D.MAPHANNHOMDICHVU, 'TT') as LOAI_CHIPHI            from TM_DICHVU_DONGIA A            inner join TM_BANGGIA B on B.LOAIGIA_ID = A.LOAIGIA_ID AND B.BENHVIEN_ID = '01819'            left join (select B.MAPHANNHOMDICHVU, A.* from TM_DICHVU_PHANNHOMDICHVU A            inner join TM_PHANNHOMDICHVU B on  B.PHANNHOMDICHVU_ID = A.PHANNHOMDICHVU_ID            where A.DICHVU_ID = '3' AND A.BENHVIEN_ID = '01819') D on A.DICHVU_ID = D.DICHVU_ID            where A.LOAIGIA_ID = '3' and A.DICHVU_ID = '3'            union            select A.LOAIGIA_ID, null as BANGGIA_ID, null as GIAVON, null as TYLE_VAT, null as TYLE_LOINHUAN,            null as DONGIA_DOANHTHU, C.DONGIA as DONGIA_KHAC, isnull(D.MAPHANNHOMDICHVU, 'TT') as LOAI_CHIPHI            from TM_DOITUONG_GIADICHVU A            left join TM_DICHVU dv on dv.DICHVU_ID = A.DICHVU_ID            inner join TM_BANGGIA B on B.LOAIGIA_ID = A.LOAIGIA_ID AND B.BENHVIEN_ID = '01819'            left join TM_DICHVU_DONGIA C on C.LOAIGIA_ID = A.LOAIGIA_ID AND C.BENHVIEN_ID = '01819'            and C.BANGGIA_ID = B.BANGGIA_ID and C.DICHVU_ID = A.DICHVU_ID            left join (select B.MAPHANNHOMDICHVU, A.* from TM_DICHVU_PHANNHOMDICHVU A            inner join TM_PHANNHOMDICHVU B on  B.PHANNHOMDICHVU_ID = A.PHANNHOMDICHVU_ID            where A.DICHVU_ID = '3' AND A.BENHVIEN_ID = '01819') D on A.DICHVU_ID = D.DICHVU_ID            where A.DOITUONG_ID = '1'  and A.DICHVU_ID = '3' and A.LOAIGIA_ID            in (select top 1 LOAIGIA_ID from TM_DOITUONG_LOAIGIA            where DOITUONG_ID = '1' and GIAHOTRO = '1'  AND BENHVIEN_ID = '01819'            and LOAIGIA_ID            in (select LOAIGIA_ID from TM_BANGGIA            where LOAIBANGGIA in            (select LOAIBANGGIA from TM_BANGGIA where LOAIGIA_ID = '3'  AND BENHVIEN_ID = '01819')            and TAMNGUNG = '0')  AND BENHVIEN_ID = '01819'            and isnull(dv.TAMNGUNG, '0') = '0' and isnull(dv.BHYT, '0') = '1'            )]
2020-07-16 15:42:23,868 [1] DEBUG - Statement Id: [DAO00024_TM_TIEPNHAN_BANGGIA_DICHVU_getlist] PreparedStatement : [select * from TM_TIEPNHAN_BANGGIA_DICHVU where TAMNGUNG != '1' and BENHVIEN_ID = '01819']
2020-07-16 15:42:29,582 [1] DEBUG - Statement Id: [DAO00013_Add_BenhNhan] PreparedStatement : [declare @keyValue int, @BenhVienId varchar(10), @yearNow int, @Mayte varchar(20), @SoVaoVien varchar(20), @fid varchar(20),        @Bnid int, @Manoisinh varchar(10), @Namsinh int, @Ngaysinh smalldatetime, @Gioitinh int, @Thangsinh int, @Daysinh int, @beginpatient int        declare @InsertedRows TABLE (BENHNHAN_ID INT, MAYTE varchar(20), MANOISINH varchar(10), NAMSINH int, NGAYSINH smalldatetime, GIOITINH int )        set @keyValue = 0;        set @Thangsinh = 0;        set @Daysinh = 0;        set @beginpatient = 0;        set @fid = 'F';        set @BenhVienId = '01819'        set @yearNow = YEAR(getdate())                select @beginpatient = isnull(VALUE, 0) from TM_SYS_APPSETTINGS where CODE = 'COM_FIRST_NUMBER_PATIENTCODE_INTHEYEAR'          select @keyValue = KEYVALUE from LST_KEYDATA        where KEYTYPE = 'MAYTE' and KEYYEAR = @yearNow                if @keyValue = 0        Insert into LST_KEYDATA values ('MAYTE', @yearNow, '0', '0', '0', '0', '0', @beginpatient, @BenhVienId);        Update LST_KEYDATA set KEYVALUE = KEYVALUE + 1, @keyValue = (KEYVALUE + 1) where KEYTYPE = 'MAYTE' and KEYYEAR = @yearNow                set @SoVaoVien = right('0000000'+convert(varchar(7), @keyValue), 7)        set @Mayte = RIGHT(@yearNow, 2) + @SoVaoVien                insert into TT_BENHNHAN (        MAYTE        , SOVAOVIEN        , TENBENHNHAN        , HO        , TEN        , GIOITINH        , NGAYSINH        , NAMSINH        , MANOISINH        , SONHA        , DIACHI        , SODIENTHOAI        , XAPHUONG_ID        , QUANHUYEN_ID        , TINHTHANH_ID        , DANTOC_ID        , QUOCTICH_ID        , SOLUUTRUNOITRU        , SOLUUTRUNGOAITRU        , NGHENGHIEP_ID        , CMND        , HOCHIEU        , VIETKIEU        , NGUOINUOCNGOAI        , DIACHITHUONGTRU        , DIACHILIENLAC        , DIACHICOQUAN        , EMAIL        , NHOMMAU_ID        , YEUTORH_ID        , TIENSUDIUNG        , TIENSUBENH        , TIENSUHUTTHUOCLA        , TUVONG        , NGAYTUVONG        , THOIGIANTUVONG        , NGUYENNHANTUVONG_ID        , NGUOIGHINHANTUVONG_ID        , THOIGIANGHINHANTUVONG        , NHANVIEN_ID        , DONVICONGTAC_ID        , DIENTHOAIBAN        , TINHTRANGHONNHAN_ID        , NGUOILIENHE_ID        , MOIQUANHE_ID        , NGUOILIENHE        , THONGTIN_NLH        , GHICHU        , HINHANH_DAIDIEN        , SITE_ID        , PID        , ACTIVE        , BENHVIEN_ID        , NGAYTAO        , NGUOITAO_ID        , NGAYGIOSINH        , TRINHDOVANHOA_ID        )                values (        @Mayte        , @SoVaoVien        ,  @param0         ,  @param1         ,  @param2         ,  @param3         ,  @param4         ,  @param5         ,  @param6         ,  @param7         ,  @param8         ,  @param9         ,  @param10         ,  @param11         ,  @param12         ,  @param13         ,  @param14         ,  @param15         ,  @param16         ,  @param17         ,  @param18         ,  @param19         ,  @param20         ,  @param21         ,  @param22         ,  @param23         ,  @param24         ,  @param25         ,  @param26         ,  @param27         ,  @param28         ,  @param29         ,  @param30         ,  @param31         ,  @param32         ,  @param33         ,  @param34         ,  @param35         ,  @param36         ,  @param37         ,  @param38         ,  @param39         ,  @param40         ,  @param41         ,  @param42         ,  @param43         ,  @param44         ,  @param45         ,  @param46         ,  @param47         ,  @param48         , '1'        ,  @param49         ,  @param50         ,  @param51         ,  @param52         ,  @param53         );        set @Bnid = SCOPE_IDENTITY()                select @Manoisinh = MANOISINH, @Namsinh = NAMSINH, @Ngaysinh = NGAYSINH, @Gioitinh = GIOITINH from @InsertedRows;        IF (@Ngaysinh is not Null)        BEGIN        set @Thangsinh = MONTH(@Ngaysinh);        set @Daysinh = DAY(@Ngaysinh);        END        IF (@Manoisinh is Null) set @Manoisinh = '0'        set @fid = right('000'+convert(varchar(3), @Manoisinh), 3) + convert(varchar(1), @Gioitinh) + RIGHT(@Namsinh, 2) + right('00'+convert(varchar(2), @Thangsinh), 2) + right('00'+convert(varchar(2), @Daysinh), 2) + right('000000000'+convert(varchar(9), @Bnid), 9) + convert(varchar(1), 'F');                update TT_BENHNHAN set FID = @fid where BENHNHAN_ID = @Bnid;                select @Bnid]
2020-07-16 15:42:29,583 [1] DEBUG - Statement Id: [DAO00013_Add_BenhNhan] Parameters: [@param0=[TENBENHNHAN,Fpt Test], @param1=[HO,Fpt], @param2=[TEN,Test], @param3=[GIOITINH,1], @param4=[NGAYSINH,1/1/1988 12:00:00 AM], @param5=[NAMSINH,1988], @param6=[MANOISINH,null], @param7=[SONHA,Số nhà 15], @param8=[DIACHI,null], @param9=[SODIENTHOAI,03523551233], @param10=[XAPHUONG_ID,00610], @param11=[QUANHUYEN_ID,null], @param12=[TINHTHANH_ID,null], @param13=[DANTOC_ID,332], @param14=[QUOCTICH_ID,291], @param15=[SOLUUTRUNOITRU,null], @param16=[SOLUUTRUNGOAITRU,null], @param17=[NGHENGHIEP_ID,null], @param18=[CMND,null], @param19=[HOCHIEU,null], @param20=[VIETKIEU,null], @param21=[NGUOINUOCNGOAI,null], @param22=[DIACHITHUONGTRU,Số nhà 15, Phường Xuân Đỉnh, Quận Bắc Từ Liêm, Thành phố Hà Nội], @param23=[DIACHILIENLAC,Số nhà 15, Phường Xuân Đỉnh, Quận Bắc Từ Liêm, Thành phố Hà Nội], @param24=[DIACHICOQUAN,null], @param25=[EMAIL,null], @param26=[NHOMMAU_ID,null], @param27=[YEUTORH_ID,null], @param28=[TIENSUDIUNG,null], @param29=[TIENSUBENH,null], @param30=[TIENSUHUTTHUOCLA,null], @param31=[TUVONG,null], @param32=[NGAYTUVONG,null], @param33=[THOIGIANTUVONG,null], @param34=[NGUYENNHANTUVONG_ID,null], @param35=[NGUOIGHINHANTUVONG_ID,null], @param36=[THOIGIANGHINHANTUVONG,null], @param37=[NHANVIEN_ID,null], @param38=[DONVICONGTAC_ID,null], @param39=[DIENTHOAIBAN,null], @param40=[TINHTRANGHONNHAN_ID,null], @param41=[NGUOILIENHE_ID,null], @param42=[MOIQUANHE_ID,null], @param43=[NGUOILIENHE,null], @param44=[THONGTIN_NLH,null], @param45=[GHICHU,null], @param46=[HINHANH_DAIDIEN,imgMale.png], @param47=[SITE_ID,105], @param48=[PID,null], @param49=[BENHVIEN_ID,01819], @param50=[NGAYTAO,7/16/2020 3:42:29 PM], @param51=[NGUOITAO_ID,1], @param52=[NGAYGIOSINH,null], @param53=[TRINHDOVANHOA_ID,null]]
2020-07-16 15:42:29,583 [1] DEBUG - Statement Id: [DAO00013_Add_BenhNhan] Types: [@param0=[String, System.String], @param1=[String, System.String], @param2=[String, System.String], @param3=[Int64, System.Int64], @param4=[DateTime, System.DateTime], @param5=[Int64, System.Int64], @param6=[System.DBNull, null], @param7=[String, System.String], @param8=[System.DBNull, null], @param9=[String, System.String], @param10=[String, System.String], @param11=[System.DBNull, null], @param12=[System.DBNull, null], @param13=[Int64, System.Int64], @param14=[Int64, System.Int64], @param15=[System.DBNull, null], @param16=[System.DBNull, null], @param17=[System.DBNull, null], @param18=[System.DBNull, null], @param19=[System.DBNull, null], @param20=[System.DBNull, null], @param21=[System.DBNull, null], @param22=[String, System.String], @param23=[String, System.String], @param24=[System.DBNull, null], @param25=[System.DBNull, null], @param26=[System.DBNull, null], @param27=[System.DBNull, null], @param28=[System.DBNull, null], @param29=[System.DBNull, null], @param30=[System.DBNull, null], @param31=[System.DBNull, null], @param32=[System.DBNull, null], @param33=[System.DBNull, null], @param34=[System.DBNull, null], @param35=[System.DBNull, null], @param36=[System.DBNull, null], @param37=[System.DBNull, null], @param38=[System.DBNull, null], @param39=[System.DBNull, null], @param40=[System.DBNull, null], @param41=[System.DBNull, null], @param42=[System.DBNull, null], @param43=[System.DBNull, null], @param44=[System.DBNull, null], @param45=[System.DBNull, null], @param46=[String, System.String], @param47=[String, System.String], @param48=[System.DBNull, null], @param49=[String, System.String], @param50=[DateTime, System.DateTime], @param51=[String, System.String], @param52=[System.DBNull, null], @param53=[System.DBNull, null]]
2020-07-16 15:42:29,684 [1] DEBUG - Statement Id: [DAO00013_GetTTBenhNhan_byBenhNhanId] PreparedStatement : [select *        from TT_BENHNHAN        where BENHNHAN_ID = '8731'        order by BENHNHAN_ID]
2020-07-16 15:42:29,727 [1] DEBUG - Statement Id: [DAO00013_GetBenhNhanToDB] PreparedStatement : [select ROW_NUMBER() OVER(order by a.MAYTE) as ROWNUMBER, *,        CASE        WHEN A.GIOITINH = 1 THEN 'Nam'        WHEN A.GIOITINH = 2 THEN N'Nữ'        END as TENGIOITINH        from TT_BENHNHAN A        where  ACTIVE = '1' and MAYTE = '200001812']
2020-07-16 15:42:30,000 [1] DEBUG - Statement Id: [DAO00118_Add_BenhNhan] PreparedStatement : [if not exists (select 1 from TT_BENHNHAN where BENHNHAN_ID = '8731')              insert into TT_BENHNHAN (              BENHNHAN_ID              , MAYTE              , SOVAOVIEN              , TENBENHNHAN              , HO              , TEN              , GIOITINH              , NGAYSINH              , NAMSINH              , SONHA              , DIACHI              , SODIENTHOAI              , XAPHUONG_ID              , QUANHUYEN_ID              , TINHTHANH_ID              , DANTOC_ID              , QUOCTICH_ID              , SOLUUTRUNOITRU              , SOLUUTRUNGOAITRU              , NGHENGHIEP_ID              , CMND              , HOCHIEU              , VIETKIEU              , NGUOINUOCNGOAI              , DIACHITHUONGTRU              , DIACHILIENLAC              , DIACHICOQUAN              , EMAIL              , NHOMMAU_ID              , YEUTORH_ID              , TIENSUDIUNG              , TIENSUBENH              , TIENSUHUTTHUOCLA              , TUVONG              , NGAYTUVONG              , THOIGIANTUVONG              , NGUYENNHANTUVONG_ID              , NGUOIGHINHANTUVONG_ID              , THOIGIANGHINHANTUVONG              , NHANVIEN_ID              , DONVICONGTAC_ID              , DIENTHOAIBAN              , TINHTRANGHONNHAN_ID              , NGUOILIENHE_ID              , MOIQUANHE_ID              , NGUOILIENHE              , THONGTIN_NLH              , GHICHU              , HINHANH_DAIDIEN              , BENHVIEN_ID              , NGAYTAO              , NGUOITAO_ID              , NGAYGIOSINH              ) values (               @param0               ,  @param1               ,  @param2               ,  @param3               ,  @param4               ,  @param5               ,  @param6               ,  @param7               ,  @param8               ,  @param9               ,  @param10               ,  @param11               ,  @param12               ,  @param13               ,  @param14               ,  @param15               ,  @param16               ,  @param17               ,  @param18               ,  @param19               ,  @param20               ,  @param21               ,  @param22               ,  @param23               ,  @param24               ,  @param25               ,  @param26               ,  @param27               ,  @param28               ,  @param29               ,  @param30               ,  @param31               ,  @param32               ,  @param33               ,  @param34               ,  @param35               ,  @param36               ,  @param37               ,  @param38               ,  @param39               ,  @param40               ,  @param41               ,  @param42               ,  @param43               ,  @param44               ,  @param45               ,  @param46               ,  @param47               ,  @param48               ,  @param49               ,  @param50               ,  @param51               ,  @param52               )              else              update TT_BENHNHAN set              MAYTE =  @param1                ,                   SOVAOVIEN =  @param2                ,                   TENBENHNHAN =  @param3                ,                   HO =  @param4                ,                   TEN =  @param5                ,                   GIOITINH =  @param6                ,                   NGAYSINH =  @param7                ,                   NAMSINH =  @param8                ,                   SONHA =  @param9                ,                   SODIENTHOAI =  @param11                ,                   XAPHUONG_ID =  @param12                ,                   DANTOC_ID =  @param15                ,                   QUOCTICH_ID =  @param16                ,                   NGHENGHIEP_ID =  @param19                ,                   NGUOINUOCNGOAI =  @param23                ,                   DIACHITHUONGTRU =  @param24                ,                   DIACHILIENLAC =  @param25                ,                   DONVICONGTAC_ID =  @param40                ,                   NGUOILIENHE_ID =  @param43                ,                   MOIQUANHE_ID =  @param44                ,                   NGUOILIENHE =  @param45                ,                   THONGTIN_NLH =  @param46                ,                   GHICHU =  @param47                ,                   BENHVIEN_ID =  @param49                ,                   NGUOICAPNHAT_ID =  @param53                              where              BENHNHAN_ID = '8731']
2020-07-16 15:42:30,000 [1] DEBUG - Statement Id: [DAO00118_Add_BenhNhan] Parameters: [@param0=[BENHNHAN_ID,8731], @param1=[MAYTE,200001812], @param2=[SOVAOVIEN,0001812], @param3=[TENBENHNHAN,Fpt Test], @param4=[HO,Fpt], @param5=[TEN,Test], @param6=[GIOITINH,1], @param7=[NGAYSINH,1/1/1988 12:00:00 AM], @param8=[NAMSINH,1988], @param9=[SONHA,Số nhà 15], @param10=[DIACHI,null], @param11=[SODIENTHOAI,03523551233], @param12=[XAPHUONG_ID,00610], @param13=[QUANHUYEN_ID,null], @param14=[TINHTHANH_ID,null], @param15=[DANTOC_ID,332], @param16=[QUOCTICH_ID,291], @param17=[SOLUUTRUNOITRU,null], @param18=[SOLUUTRUNGOAITRU,null], @param19=[NGHENGHIEP_ID,null], @param20=[CMND,null], @param21=[HOCHIEU,null], @param22=[VIETKIEU,null], @param23=[NGUOINUOCNGOAI,null], @param24=[DIACHITHUONGTRU,Số nhà 15, Phường Xuân Đỉnh, Quận Bắc Từ Liêm, Thành phố Hà Nội], @param25=[DIACHILIENLAC,Số nhà 15, Phường Xuân Đỉnh, Quận Bắc Từ Liêm, Thành phố Hà Nội], @param26=[DIACHICOQUAN,null], @param27=[EMAIL,null], @param28=[NHOMMAU_ID,null], @param29=[YEUTORH_ID,null], @param30=[TIENSUDIUNG,null], @param31=[TIENSUBENH,null], @param32=[TIENSUHUTTHUOCLA,null], @param33=[TUVONG,null], @param34=[NGAYTUVONG,null], @param35=[THOIGIANTUVONG,null], @param36=[NGUYENNHANTUVONG_ID,null], @param37=[NGUOIGHINHANTUVONG_ID,null], @param38=[THOIGIANGHINHANTUVONG,null], @param39=[NHANVIEN_ID,null], @param40=[DONVICONGTAC_ID,null], @param41=[DIENTHOAIBAN,null], @param42=[TINHTRANGHONNHAN_ID,null], @param43=[NGUOILIENHE_ID,null], @param44=[MOIQUANHE_ID,null], @param45=[NGUOILIENHE,null], @param46=[THONGTIN_NLH,null], @param47=[GHICHU,null], @param48=[HINHANH_DAIDIEN,imgMale.png], @param49=[BENHVIEN_ID,01819], @param50=[NGAYTAO,null], @param51=[NGUOITAO_ID,1], @param52=[NGAYGIOSINH,null], @param53=[NGUOICAPNHAT_ID,1]]
2020-07-16 15:42:30,000 [1] DEBUG - Statement Id: [DAO00118_Add_BenhNhan] Types: [@param0=[Int32, System.Int32], @param1=[String, System.String], @param2=[String, System.String], @param3=[String, System.String], @param4=[String, System.String], @param5=[String, System.String], @param6=[Int64, System.Int64], @param7=[DateTime, System.DateTime], @param8=[Int64, System.Int64], @param9=[String, System.String], @param10=[System.DBNull, null], @param11=[String, System.String], @param12=[String, System.String], @param13=[System.DBNull, null], @param14=[System.DBNull, null], @param15=[Int64, System.Int64], @param16=[Int64, System.Int64], @param17=[System.DBNull, null], @param18=[System.DBNull, null], @param19=[System.DBNull, null], @param20=[System.DBNull, null], @param21=[System.DBNull, null], @param22=[System.DBNull, null], @param23=[System.DBNull, null], @param24=[String, System.String], @param25=[String, System.String], @param26=[System.DBNull, null], @param27=[System.DBNull, null], @param28=[System.DBNull, null], @param29=[System.DBNull, null], @param30=[System.DBNull, null], @param31=[System.DBNull, null], @param32=[System.DBNull, null], @param33=[System.DBNull, null], @param34=[System.DBNull, null], @param35=[System.DBNull, null], @param36=[System.DBNull, null], @param37=[System.DBNull, null], @param38=[System.DBNull, null], @param39=[System.DBNull, null], @param40=[System.DBNull, null], @param41=[System.DBNull, null], @param42=[System.DBNull, null], @param43=[System.DBNull, null], @param44=[System.DBNull, null], @param45=[System.DBNull, null], @param46=[System.DBNull, null], @param47=[System.DBNull, null], @param48=[String, System.String], @param49=[String, System.String], @param50=[System.DBNull, null], @param51=[String, System.String], @param52=[System.DBNull, null], @param53=[String, System.String]]
2020-07-16 15:42:32,272 [1] DEBUG - Statement Id: [DAOWF001_Laythongtingateways] PreparedStatement : [select * from TM_PROCESS_GATEWAYS]
2020-07-16 15:42:32,339 [1] DEBUG - Statement Id: [DAO00019_Add] PreparedStatement : [declare        @keyValue int, @BenhVienId varchar(10),        @yearNow int, @monthNow varchar(2), @dayNow varchar(2),        @Sotiepnhan varchar(20), @SoThuTu varchar(20)        set @keyValue = 0;        set @BenhVienId = '01819'        set @yearNow = YEAR(getdate())        set @monthNow = RIGHT('00' + convert(varchar(2), MONTH(getdate())),2)        set @dayNow = RIGHT('00' + convert(varchar(2), DAY(getdate())),2)        BEGIN        select @keyValue = KEYVALUE from LST_KEYDATA        where KEYTYPE = 'SOTIEPNHAN' and KEYYEAR = @yearNow and KEYMONTH = @monthNow and KEYDAY = @dayNow        and BENHVIEN_ID = @BenhVienId        if @keyValue = 0        Insert into LST_KEYDATA values ('SOTIEPNHAN', @yearNow, @monthNow, @dayNow, '0', '0', '0', 0, @BenhVienId);        Update LST_KEYDATA set KEYVALUE = (KEYVALUE + 1), @keyValue = (KEYVALUE + 1) where KEYTYPE = 'SOTIEPNHAN' and KEYYEAR = @yearNow and KEYMONTH = @monthNow and KEYDAY = @dayNow and BENHVIEN_ID = @BenhVienId        set @SoThuTu = right('0000000'+convert(varchar(7), @keyValue), 7)        set @Sotiepnhan = 'TN' + RIGHT(@yearNow, 2) + @monthNow  + @dayNow + '.' + @SoThuTu                   insert into TT_TIEPNHAN (        SOTIEPNHAN        , UUTIEN        , BENHNHAN_ID        , BENHVIEN_ID        , TUYENKHAMBENH_ID        , NOITIEPNHAN_ID        , NGAYTIEPNHAN        , THOIGIANTIEPNHAN        , NAMTIEPNHAN        , THANGTIEPNHAN        , DOITUONG_ID        , LYDOTIEPNHAN_ID        , HINHTHUCDENKHAM_ID        , TINHTRANGHEN        , XACNHANCHIPHI_ID        , THUTIENTRUOC        , TAIKHAM        , SOBHYT        , BHYTTUNGAY        , BHYTDENNGAY        , BHYTNGAYCAP        , BHYTTREN3NAM        , BHYTTREN5NAM        , NGAYMIENDONGCHITRA        , LOAIBHYT        , NGAYBHYT2        , SOCHUYENVIEN        , HINHTHUCCHUYENVIEN_ID        , NOIGIOITHIEU_ID        , NGUOIGIOITHIEU_ID        , THOIGIANCHUYENTUYEN        , LYDOCHUYENVIEN_ID        , ICDNOIGIOITHIEU_ID        , CHANDOANNGT        , TRAITUYEN        , DIACHILIENHE        , XAPHUONG_ID        , QUANHUYEN_ID        , TINHTHANH_ID        , PROCESS_ID        , TRANGTHAI        , KHUVUCSONG_ID        , THANHVIEN_ID        , THE_ID        , LOAITHANHVIEN_ID        , SUDUNG_BHTN        , VIP        , GHICHU_TIEPNHAN        , BAOLANH_VIENPHI        , CONGTY_CHITRA_ID        , NGUON_BENHNHAN_ID        , LOAITIEPNHAN_ID        , THONGTIN_KCB_BHYT        , NGAYTAO        , NGUOITAO_ID        , LYDODENKHAM        , QUANHAM_ID        , TINHTRANGBENHNHAN_ID        , DONVICONGTAC_ID        , DONVICONGTAC         ,           NGOAIGIO         ,           NGUOINUOCNGOAI         ,           ISTHONGTUYEN                 , TENNGUOIGIOITHIEU        , GIOITHIEUBENNGOAI                 )        OUTPUT INSERTED.TIEPNHAN_ID, INSERTED.SOTIEPNHAN        values (        @Sotiepnhan        ,  @param0         ,  @param1         ,  @param2         ,  @param3         ,  @param4         ,  @param5         ,  @param6         ,  @param7         ,  @param8         ,  @param9         ,  @param10         ,  @param11         ,  @param12         ,  @param13         ,  @param14         ,  @param15         ,  @param16         ,  @param17         ,  @param18         ,  @param19         ,  @param20         ,  @param21         ,  @param22         ,  @param23         ,  @param24         ,  @param25         ,  @param26         ,  @param27         ,  @param28         ,  @param29         ,  @param30         ,  @param31         ,  @param32         ,  @param33         ,  @param34         ,  @param35         ,  @param36         ,  @param37         ,  @param38         ,  @param39         ,  @param40         ,  @param41         ,  @param42         ,  @param43         ,  @param44         ,  @param45         ,  @param46         ,  @param47         ,  @param48         ,  @param49         ,  @param50         ,  @param51         ,  @param52         ,  @param53         ,  @param54         ,  @param55         ,  @param56         ,  @param57         ,  @param58          ,            @param59          ,            @param60          ,            @param61                  ,  @param62         ,  @param63                  )        end]
2020-07-16 15:42:32,339 [1] DEBUG - Statement Id: [DAO00019_Add] Parameters: [@param0=[UUTIEN,0], @param1=[BENHNHAN_ID,8731], @param2=[BENHVIEN_ID,01819], @param3=[TUYENKHAMBENH_ID,null], @param4=[NOITIEPNHAN_ID,97], @param5=[NGAYTIEPNHAN,7/16/2020 12:00:00 AM], @param6=[THOIGIANTIEPNHAN,7/16/2020 3:39:54 PM], @param7=[NAMTIEPNHAN,2020], @param8=[THANGTIEPNHAN,7], @param9=[DOITUONG_ID,1], @param10=[LYDOTIEPNHAN_ID,null], @param11=[HINHTHUCDENKHAM_ID,461], @param12=[TINHTRANGHEN,null], @param13=[XACNHANCHIPHI_ID,null], @param14=[THUTIENTRUOC,null], @param15=[TAIKHAM,0], @param16=[SOBHYT,null], @param17=[BHYTTUNGAY,null], @param18=[BHYTDENNGAY,null], @param19=[BHYTNGAYCAP,null], @param20=[BHYTTREN3NAM,0], @param21=[BHYTTREN5NAM,0], @param22=[NGAYMIENDONGCHITRA,null], @param23=[LOAIBHYT,null], @param24=[NGAYBHYT2,null], @param25=[SOCHUYENVIEN,null], @param26=[HINHTHUCCHUYENVIEN_ID,null], @param27=[NOIGIOITHIEU_ID,null], @param28=[NGUOIGIOITHIEU_ID,null], @param29=[THOIGIANCHUYENTUYEN,null], @param30=[LYDOCHUYENVIEN_ID,null], @param31=[ICDNOIGIOITHIEU_ID,null], @param32=[CHANDOANNGT,null], @param33=[TRAITUYEN,0], @param34=[DIACHILIENHE,null], @param35=[XAPHUONG_ID,00610], @param36=[QUANHUYEN_ID,null], @param37=[TINHTHANH_ID,null], @param38=[PROCESS_ID,P01], @param39=[TRANGTHAI,DATIEPNHAN], @param40=[KHUVUCSONG_ID,null], @param41=[THANHVIEN_ID,null], @param42=[THE_ID,null], @param43=[LOAITHANHVIEN_ID,null], @param44=[SUDUNG_BHTN,0], @param45=[VIP,0], @param46=[GHICHU_TIEPNHAN,null], @param47=[BAOLANH_VIENPHI,0], @param48=[CONGTY_CHITRA_ID,null], @param49=[NGUON_BENHNHAN_ID,null], @param50=[LOAITIEPNHAN_ID,8351], @param51=[THONGTIN_KCB_BHYT,null], @param52=[NGAYTAO,7/16/2020 3:42:32 PM], @param53=[NGUOITAO_ID,1], @param54=[LYDODENKHAM,null], @param55=[QUANHAM_ID,null], @param56=[TINHTRANGBENHNHAN_ID,null], @param57=[DONVICONGTAC_ID,null], @param58=[DONVICONGTAC,null], @param59=[NGOAIGIO,null], @param60=[NGUOINUOCNGOAI,null], @param61=[ISTHONGTUYEN,0], @param62=[TENNGUOIGIOITHIEU,null], @param63=[GIOITHIEUBENNGOAI,null]]
2020-07-16 15:42:32,339 [1] DEBUG - Statement Id: [DAO00019_Add] Types: [@param0=[Int32, System.Int32], @param1=[Int32, System.Int32], @param2=[String, System.String], @param3=[System.DBNull, null], @param4=[String, System.String], @param5=[DateTime, System.DateTime], @param6=[DateTime, System.DateTime], @param7=[Int32, System.Int32], @param8=[Int32, System.Int32], @param9=[Int64, System.Int64], @param10=[System.DBNull, null], @param11=[Int64, System.Int64], @param12=[System.DBNull, null], @param13=[System.DBNull, null], @param14=[System.DBNull, null], @param15=[Int32, System.Int32], @param16=[System.DBNull, null], @param17=[System.DBNull, null], @param18=[System.DBNull, null], @param19=[System.DBNull, null], @param20=[String, System.String], @param21=[String, System.String], @param22=[System.DBNull, null], @param23=[System.DBNull, null], @param24=[System.DBNull, null], @param25=[System.DBNull, null], @param26=[System.DBNull, null], @param27=[System.DBNull, null], @param28=[System.DBNull, null], @param29=[System.DBNull, null], @param30=[System.DBNull, null], @param31=[System.DBNull, null], @param32=[System.DBNull, null], @param33=[String, System.String], @param34=[System.DBNull, null], @param35=[String, System.String], @param36=[System.DBNull, null], @param37=[System.DBNull, null], @param38=[String, System.String], @param39=[String, System.String], @param40=[System.DBNull, null], @param41=[System.DBNull, null], @param42=[System.DBNull, null], @param43=[System.DBNull, null], @param44=[String, System.String], @param45=[String, System.String], @param46=[System.DBNull, null], @param47=[String, System.String], @param48=[System.DBNull, null], @param49=[System.DBNull, null], @param50=[Int64, System.Int64], @param51=[System.DBNull, null], @param52=[DateTime, System.DateTime], @param53=[String, System.String], @param54=[System.DBNull, null], @param55=[System.DBNull, null], @param56=[System.DBNull, null], @param57=[System.DBNull, null], @param58=[System.DBNull, null], @param59=[System.DBNull, null], @param60=[System.DBNull, null], @param61=[String, System.String], @param62=[System.DBNull, null], @param63=[System.DBNull, null]]
2020-07-16 15:42:32,393 [1] DEBUG - Statement Id: [DAO00019_GetTTTiepNhan_byTiepNhanId] PreparedStatement : [select *        from TT_TIEPNHAN        where TIEPNHAN_ID = '8747'        order by TIEPNHAN_ID]
2020-07-16 15:42:32,416 [1] DEBUG - Statement Id: [DAO00080_Add_KhamBenh_CapCuu] PreparedStatement : [insert into TT_KHAMBENH_VAOVIEN (        SOPHIEU        , TIEPNHAN_ID        , KHAMBENH_ID        , BENHNHAN_ID        , NGUOILIENHE        , DIENTHOAILIENHE        , NOILAMVIEC        , CHANDOANNOIGIOITHIEU        , NGAYKHAM        , THOIGIANKHAM        , LYDOVAOVIEN        , QUATRINHBENHLY        , TIENSUBANTHAN        , TIENSUGIADINH        , KHAMXETTOANTHAN        , KHAMXETCACBOPHAN        , KHAMXETKQLS        , CHANDOANVAO        , ICDKHAMXET_ID        , DAXULY        , NGAYRA        , THOIGIANRA        , NHAPKHOA_ID        , CHUYENVIEN_ID        , CHUY        , MACH        , NHIETDO        , HUYETAPCAO        , HUYETAPTHAP        , NHIPTHO        , CANNANG        , CHIEUCAO        , BACSI_ID        , XUTRUKHAMBENH_ID        , CAPCUU        , NGAYTAINAN        , THOIGIANTAINAN        , NOITAINAN_TINHTHANH_ID        , NOITAINAN_QUANHUYEN_ID        , NOITAINAN_PHUONGXA_ID        , NOITAINAN_DIACHI        , DIADIEMTAINAN_ID        , BOPHANBITHUONG_ID        , MUCDO_ID        , DIENBIENSAUTN_ID        , XUTRISAUTN_ID        , NGUYENNHAN_ID        , NGUYENNHANCHITIET_ID        , ICD_NGUYENNHAN        , NGAYTAO        , NGUOITAO_ID        , NGAYCAPNHAT        , NGUOICAPNHAT_ID        , BENHANCHUYENKHOA        , CHANDOANVAOVIEN        , CHANDOANRAVIEN        , DIEUTRITUNGAY        , DIEUTRIDENNGAY        , DIENBIENLS        , KQXETNGHIEM        , PHAUTHUAT        , THUTHUAT        , TINHTRANGNGUOIBENH        , HUONGDIEUTRI        , NGUOIGIAO_ID        , NGUOINHAN_ID        , XQUANG        , CTSCANNER        , SIEUAM        , XETNGHIEM        , KHAC        , TOANBOHS        , LOAICHUYENKHOA        , CONGANCANTHIEP        , CDRR_BENHCHINH        , CDRR_BENHKEM        , ICD_BENHCHINH        , ICD_BENHKEMTHEO        , PHUONGPHAPDIEUTRI        , FIELD_1        , FIELD_2        , FIELD_3        , FIELD_4        , FIELD_5        , FIELD_6        , FIELD_7        , FIELD_8        , FIELD_9        , FIELD_10        , FIELD_11        , FIELD_12        , FIELD_13        , FIELD_14        , FIELD_15        , FIELD_27        , FIELD_28        , FIELD_29        , FIELD_30        , FIELD_31        , FIELD_32        , FIELD_33        , FIELD_34        , FIELD_35        , FIELD_36        , FIELD_37        , FIELD_38        , FIELD_39        , FIELD_40        , FIELD_41        , FIELD_42        , FIELD_43        , FIELD_44        , FIELD_45        , FIELD_46        , FIELD_47        , FIELD_48        , FIELD_49        , FIELD_50        , FIELD_51        , FIELD_52        , FIELD_53        , FIELD_54        , FIELD_55        , FIELD_56        , BENHVIEN_ID        ) values (         @param0         ,  @param1         ,  @param2         ,  @param3         ,  @param4         ,  @param5         ,  @param6         ,  @param7         ,  @param8         ,  @param9         ,  @param10         ,  @param11         ,  @param12         ,  @param13         ,  @param14         ,  @param15         ,  @param16         ,  @param17         ,  @param18         ,  @param19         ,  @param20         ,  @param21         ,  @param22         ,  @param23         ,  @param24         ,  @param25         ,  @param26         ,  @param27         ,  @param28         ,  @param29         ,  @param30         ,  @param31         ,  @param32         ,  @param33         ,  @param34         ,  @param35         ,  @param36         ,  @param37         ,  @param38         ,  @param39         ,  @param40         ,  @param41         ,  @param42         ,  @param43         ,  @param44         ,  @param45         ,  @param46         ,  @param47         ,  @param48         ,  @param49         ,  @param50         ,  @param51         ,  @param52         ,  @param53         ,  @param54         ,  @param55         ,  @param56         ,  @param57         ,  @param58         ,  @param59         ,  @param60         ,  @param61         ,  @param62         ,  @param63         ,  @param64         ,  @param65         ,  @param66         ,  @param67         ,  @param68         ,  @param69         ,  @param70         ,  @param71         ,  @param72         ,  @param73         ,  @param74         ,  @param75         ,  @param76         ,  @param77         ,  @param78         ,  @param79         ,  @param80         ,  @param81         ,  @param82         ,  @param83         ,  @param84         ,  @param85         ,  @param86         ,  @param87         ,  @param88         ,  @param89         ,  @param90         ,  @param91         ,  @param92         ,  @param93         ,  @param94         ,  @param95         ,  @param96         ,  @param97         ,  @param98         ,  @param99         ,  @param100         ,  @param101         ,  @param102         ,  @param103         ,  @param104         ,  @param105         ,  @param106         ,  @param107         ,  @param108         ,  @param109         ,  @param110         ,  @param111         ,  @param112         ,  @param113         ,  @param114         ,  @param115         ,  @param116         ,  @param117         ,  @param118         ,  @param119         ,  @param120         ,  @param121         ,  @param122         ,  @param123         ,  @param124         )]
2020-07-16 15:42:32,418 [1] DEBUG - Statement Id: [DAO00080_Add_KhamBenh_CapCuu] Parameters: [@param0=[SOPHIEU,null], @param1=[TIEPNHAN_ID,8747], @param2=[KHAMBENH_ID,null], @param3=[BENHNHAN_ID,8731], @param4=[NGUOILIENHE,null], @param5=[DIENTHOAILIENHE,null], @param6=[NOILAMVIEC,null], @param7=[CHANDOANNOIGIOITHIEU,null], @param8=[NGAYKHAM,7/16/2020 12:00:00 AM], @param9=[THOIGIANKHAM,7/16/2020 3:39:54 PM], @param10=[LYDOVAOVIEN,null], @param11=[QUATRINHBENHLY,null], @param12=[TIENSUBANTHAN,null], @param13=[TIENSUGIADINH,null], @param14=[KHAMXETTOANTHAN,null], @param15=[KHAMXETCACBOPHAN,null], @param16=[KHAMXETKQLS,null], @param17=[CHANDOANVAO,null], @param18=[ICDKHAMXET_ID,null], @param19=[DAXULY,null], @param20=[NGAYRA,null], @param21=[THOIGIANRA,null], @param22=[NHAPKHOA_ID,97], @param23=[CHUYENVIEN_ID,null], @param24=[CHUY,null], @param25=[MACH,null], @param26=[NHIETDO,null], @param27=[HUYETAPCAO,null], @param28=[HUYETAPTHAP,null], @param29=[NHIPTHO,null], @param30=[CANNANG,null], @param31=[CHIEUCAO,null], @param32=[BACSI_ID,null], @param33=[XUTRUKHAMBENH_ID,null], @param34=[CAPCUU,null], @param35=[NGAYTAINAN,null], @param36=[THOIGIANTAINAN,null], @param37=[NOITAINAN_TINHTHANH_ID,null], @param38=[NOITAINAN_QUANHUYEN_ID,null], @param39=[NOITAINAN_PHUONGXA_ID,null], @param40=[NOITAINAN_DIACHI,null], @param41=[DIADIEMTAINAN_ID,null], @param42=[BOPHANBITHUONG_ID,null], @param43=[MUCDO_ID,null], @param44=[DIENBIENSAUTN_ID,null], @param45=[XUTRISAUTN_ID,null], @param46=[NGUYENNHAN_ID,null], @param47=[NGUYENNHANCHITIET_ID,null], @param48=[ICD_NGUYENNHAN,null], @param49=[NGAYTAO,7/16/2020 3:42:32 PM], @param50=[NGUOITAO_ID,1], @param51=[NGAYCAPNHAT,7/16/2020 3:42:32 PM], @param52=[NGUOICAPNHAT_ID,1], @param53=[BENHANCHUYENKHOA,null], @param54=[CHANDOANVAOVIEN,null], @param55=[CHANDOANRAVIEN,null], @param56=[DIEUTRITUNGAY,null], @param57=[DIEUTRIDENNGAY,null], @param58=[DIENBIENLS,null], @param59=[KQXETNGHIEM,null], @param60=[PHAUTHUAT,null], @param61=[THUTHUAT,null], @param62=[TINHTRANGNGUOIBENH,null], @param63=[HUONGDIEUTRI,null], @param64=[NGUOIGIAO_ID,null], @param65=[NGUOINHAN_ID,null], @param66=[XQUANG,null], @param67=[CTSCANNER,null], @param68=[SIEUAM,null], @param69=[XETNGHIEM,null], @param70=[KHAC,null], @param71=[TOANBOHS,null], @param72=[LOAICHUYENKHOA,null], @param73=[CONGANCANTHIEP,null], @param74=[CDRR_BENHCHINH,null], @param75=[CDRR_BENHKEM,null], @param76=[ICD_BENHCHINH,null], @param77=[ICD_BENHKEMTHEO,null], @param78=[PHUONGPHAPDIEUTRI,null], @param79=[FIELD_1,null], @param80=[FIELD_2,null], @param81=[FIELD_3,null], @param82=[FIELD_4,null], @param83=[FIELD_5,null], @param84=[FIELD_6,null], @param85=[FIELD_7,null], @param86=[FIELD_8,null], @param87=[FIELD_9,null], @param88=[FIELD_10,null], @param89=[FIELD_11,null], @param90=[FIELD_12,null], @param91=[FIELD_13,null], @param92=[FIELD_14,null], @param93=[FIELD_15,null], @param94=[FIELD_27,null], @param95=[FIELD_28,null], @param96=[FIELD_29,null], @param97=[FIELD_30,null], @param98=[FIELD_31,null], @param99=[FIELD_32,null], @param100=[FIELD_33,null], @param101=[FIELD_34,null], @param102=[FIELD_35,null], @param103=[FIELD_36,null], @param104=[FIELD_37,null], @param105=[FIELD_38,null], @param106=[FIELD_39,null], @param107=[FIELD_40,null], @param108=[FIELD_41,null], @param109=[FIELD_42,null], @param110=[FIELD_43,null], @param111=[FIELD_44,null], @param112=[FIELD_45,null], @param113=[FIELD_46,null], @param114=[FIELD_47,null], @param115=[FIELD_48,null], @param116=[FIELD_49,null], @param117=[FIELD_50,null], @param118=[FIELD_51,null], @param119=[FIELD_52,null], @param120=[FIELD_53,null], @param121=[FIELD_54,null], @param122=[FIELD_55,null], @param123=[FIELD_56,null], @param124=[BENHVIEN_ID,01819]]
2020-07-16 15:42:32,418 [1] DEBUG - Statement Id: [DAO00080_Add_KhamBenh_CapCuu] Types: [@param0=[System.DBNull, null], @param1=[Int32, System.Int32], @param2=[System.DBNull, null], @param3=[Int32, System.Int32], @param4=[System.DBNull, null], @param5=[System.DBNull, null], @param6=[System.DBNull, null], @param7=[System.DBNull, null], @param8=[DateTime, System.DateTime], @param9=[DateTime, System.DateTime], @param10=[System.DBNull, null], @param11=[System.DBNull, null], @param12=[System.DBNull, null], @param13=[System.DBNull, null], @param14=[System.DBNull, null], @param15=[System.DBNull, null], @param16=[System.DBNull, null], @param17=[System.DBNull, null], @param18=[System.DBNull, null], @param19=[System.DBNull, null], @param20=[System.DBNull, null], @param21=[System.DBNull, null], @param22=[String, System.String], @param23=[System.DBNull, null], @param24=[System.DBNull, null], @param25=[System.DBNull, null], @param26=[System.DBNull, null], @param27=[System.DBNull, null], @param28=[System.DBNull, null], @param29=[System.DBNull, null], @param30=[System.DBNull, null], @param31=[System.DBNull, null], @param32=[System.DBNull, null], @param33=[System.DBNull, null], @param34=[System.DBNull, null], @param35=[System.DBNull, null], @param36=[System.DBNull, null], @param37=[System.DBNull, null], @param38=[System.DBNull, null], @param39=[System.DBNull, null], @param40=[System.DBNull, null], @param41=[System.DBNull, null], @param42=[System.DBNull, null], @param43=[System.DBNull, null], @param44=[System.DBNull, null], @param45=[System.DBNull, null], @param46=[System.DBNull, null], @param47=[System.DBNull, null], @param48=[System.DBNull, null], @param49=[DateTime, System.DateTime], @param50=[String, System.String], @param51=[DateTime, System.DateTime], @param52=[String, System.String], @param53=[System.DBNull, null], @param54=[System.DBNull, null], @param55=[System.DBNull, null], @param56=[System.DBNull, null], @param57=[System.DBNull, null], @param58=[System.DBNull, null], @param59=[System.DBNull, null], @param60=[System.DBNull, null], @param61=[System.DBNull, null], @param62=[System.DBNull, null], @param63=[System.DBNull, null], @param64=[System.DBNull, null], @param65=[System.DBNull, null], @param66=[System.DBNull, null], @param67=[System.DBNull, null], @param68=[System.DBNull, null], @param69=[System.DBNull, null], @param70=[System.DBNull, null], @param71=[System.DBNull, null], @param72=[System.DBNull, null], @param73=[System.DBNull, null], @param74=[System.DBNull, null], @param75=[System.DBNull, null], @param76=[System.DBNull, null], @param77=[System.DBNull, null], @param78=[System.DBNull, null], @param79=[System.DBNull, null], @param80=[System.DBNull, null], @param81=[System.DBNull, null], @param82=[System.DBNull, null], @param83=[System.DBNull, null], @param84=[System.DBNull, null], @param85=[System.DBNull, null], @param86=[System.DBNull, null], @param87=[System.DBNull, null], @param88=[System.DBNull, null], @param89=[System.DBNull, null], @param90=[System.DBNull, null], @param91=[System.DBNull, null], @param92=[System.DBNull, null], @param93=[System.DBNull, null], @param94=[System.DBNull, null], @param95=[System.DBNull, null], @param96=[System.DBNull, null], @param97=[System.DBNull, null], @param98=[System.DBNull, null], @param99=[System.DBNull, null], @param100=[System.DBNull, null], @param101=[System.DBNull, null], @param102=[System.DBNull, null], @param103=[System.DBNull, null], @param104=[System.DBNull, null], @param105=[System.DBNull, null], @param106=[System.DBNull, null], @param107=[System.DBNull, null], @param108=[System.DBNull, null], @param109=[System.DBNull, null], @param110=[System.DBNull, null], @param111=[System.DBNull, null], @param112=[System.DBNull, null], @param113=[System.DBNull, null], @param114=[System.DBNull, null], @param115=[System.DBNull, null], @param116=[System.DBNull, null], @param117=[System.DBNull, null], @param118=[System.DBNull, null], @param119=[System.DBNull, null], @param120=[System.DBNull, null], @param121=[System.DBNull, null], @param122=[System.DBNull, null], @param123=[System.DBNull, null], @param124=[String, System.String]]
2020-07-16 15:42:32,445 [1] DEBUG - Statement Id: [DAO00019_Add_TT_TIEPNHAN_SOTHEBHYT] PreparedStatement : [INSERT INTO TT_TIEPNHAN_SOTHEBHYT        (TIEPNHAN_ID        ,BENHNHAN_ID        ,BENHAN_ID        ,DOITUONG_ID        ,SOBHYT        ,BHYTTUNGAY        ,BHYTDENNGAY        ,BHYTNGAYCAP        ,BHYTTREN3NAM        ,BHYTTREN5NAM        ,NGAYMIENDONGCHITRA        ,TRAITUYEN        ,BENHVIEN_ID        ,NOITAO_ID        ,NGAYTAO        ,NGUOITAO_ID        ,NGAYCAPNHAT        ,NGUOICAPNHAT_ID        ,TYLE_VUOT_LCB        ,TYLE_TRAITUYEN        ,GIOIHAN_VUOT_LCB        ,LUONG_COSO        ,TYLE_THUOC_UT        ,MADOITUONG)        VALUES        ( @param0         , @param1         , @param2         , @param3         , @param4         , @param5         , @param6         , @param7         , @param8         , @param9         , @param10         , @param11         , @param12         , @param13         , @param14         , @param15         , @param16         , @param17         , @param18         , @param19         , @param20         , @param21         , @param22         , @param23 )]
2020-07-16 15:42:32,445 [1] DEBUG - Statement Id: [DAO00019_Add_TT_TIEPNHAN_SOTHEBHYT] Parameters: [@param0=[TIEPNHAN_ID,8747], @param1=[BENHNHAN_ID,8731], @param2=[BENHAN_ID,null], @param3=[DOITUONG_ID,1], @param4=[SOBHYT,null], @param5=[BHYTTUNGAY,null], @param6=[BHYTDENNGAY,null], @param7=[BHYTNGAYCAP,null], @param8=[BHYTTREN3NAM,0], @param9=[BHYTTREN5NAM,0], @param10=[NGAYMIENDONGCHITRA,null], @param11=[TRAITUYEN,0], @param12=[BENHVIEN_ID,01819], @param13=[NOITAO_ID,97], @param14=[NGAYTAO,7/16/2020 3:42:32 PM], @param15=[NGUOITAO_ID,1], @param16=[NGAYCAPNHAT,7/16/2020 3:42:32 PM], @param17=[NGUOICAPNHAT_ID,1], @param18=[TYLE_VUOT_LCB,null], @param19=[TYLE_TRAITUYEN,null], @param20=[GIOIHAN_VUOT_LCB,null], @param21=[LUONG_COSO,null], @param22=[TYLE_THUOC_UT,null], @param23=[MADOITUONG,VP]]
2020-07-16 15:42:32,445 [1] DEBUG - Statement Id: [DAO00019_Add_TT_TIEPNHAN_SOTHEBHYT] Types: [@param0=[Int32, System.Int32], @param1=[Int32, System.Int32], @param2=[System.DBNull, null], @param3=[Int64, System.Int64], @param4=[System.DBNull, null], @param5=[System.DBNull, null], @param6=[System.DBNull, null], @param7=[System.DBNull, null], @param8=[String, System.String], @param9=[String, System.String], @param10=[System.DBNull, null], @param11=[String, System.String], @param12=[String, System.String], @param13=[String, System.String], @param14=[DateTime, System.DateTime], @param15=[String, System.String], @param16=[DateTime, System.DateTime], @param17=[String, System.String], @param18=[System.DBNull, null], @param19=[System.DBNull, null], @param20=[System.DBNull, null], @param21=[System.DBNull, null], @param22=[System.DBNull, null], @param23=[String, System.String]]
2020-07-16 15:42:32,507 [1] DEBUG - Statement Id: [DAO00027_GetListTiepNhanAllCOM30] PreparedStatement : [select distinct A.SOTIEPNHAN, A.TRAITUYEN, A.NGAYMIENDONGCHITRA, A.TIEPNHAN_ID, A.DOITUONG_ID, isnull(C.SOBENHAN,NULL) as SOBENHAN,        A.LOAITHANHVIEN_ID, A.SUDUNG_BHTN, A.THE_ID, A.THANHVIEN_ID, A.VIP, A.NGUON_BENHNHAN_ID, A.BAOLANH_VIENPHI, A.SOBHYT, CONVERT(VARCHAR(11),A.NGAYTIEPNHAN,103) as NGAYTIEPNHAN,        B.*        , A.UUTIEN, A.NGOAIGIO        from TT_TIEPNHAN A        inner join (select * from TT_BENHNHAN where MAYTE = '200001812' and ACTIVE = '1') B on B.BENHNHAN_ID = A.BENHNHAN_ID  and B.ACTIVE = '1'        left join TT_NOITRU_BENHAN C on C.TIEPNHAN_ID = A.TIEPNHAN_ID        where A.TIEPNHAN_ID = '8747' and A.BENHVIEN_ID = '01819' and (A.TRANGTHAI not in ('HUY','CAPCUU', 'NOITRU', 'NGOAITRU'))]
2020-07-16 15:42:32,693 [1] DEBUG - Statement Id: [DAOWF001_LaythongtinProcess] PreparedStatement : [select * from TM_PROCESS        where        PROCESS_CODE = 'P01']
2020-07-16 15:42:32,722 [1] DEBUG - Statement Id: [DAOWF001_Kiemtrathongtindayeucau] PreparedStatement : [select * from TT_REQUEST        where        PROCESS_CODE = 'P01'        AND PARA = '{"HOSPITAL_ID":"01819","SOTIEPNHAN":"TN200716.0000004"}'        AND CURR_STATE_CODE = '6'        AND ISACTIVE = '1']
2020-07-16 15:42:32,747 [1] DEBUG - Statement Id: [DAOWF002_Add] PreparedStatement : [DECLARE @IDRequestOld int        DECLARE @IDRequestNew int        select top 1 @IDRequestOld = ID from TT_REQUEST where PARA =  @param0  order by ID desc          insert into TT_REQUEST (        PROCESS_CODE        , PARA        , CURR_STATE_CODE        ) values (         @param1         ,  @param0         ,  @param2         )        SELECT @IDRequestNew = SCOPE_IDENTITY()        if (@IDRequestOld is not null)        begin        update TT_REQUEST_SERVICE set REQUEST_ID = @IDRequestNew, PROCESS_CODE =  @param1  where REQUEST_ID = @IDRequestOld        update TT_REQUEST set ISACTIVE = '0' where ID = @IDRequestOld        update TT_REQUEST_SERVICE_DETAIL set REQUEST_ID = @IDRequestNew where REQUEST_ID = @IDRequestOld        end          select @IDRequestNew]
2020-07-16 15:42:32,747 [1] DEBUG - Statement Id: [DAOWF002_Add] Parameters: [@param0=[PARA,{"HOSPITAL_ID":"01819","SOTIEPNHAN":"TN200716.0000004"}], @param1=[PROCESS_CODE,P01], @param2=[CURR_STATE_CODE,6]]
2020-07-16 15:42:32,747 [1] DEBUG - Statement Id: [DAOWF002_Add] Types: [@param0=[String, System.String], @param1=[String, System.String], @param2=[String, System.String]]
2020-07-16 15:42:32,781 [1] DEBUG - Statement Id: [DAO00020_GetNhomdichvuIDByManhom] PreparedStatement : [select NHOMDICHVU_ID from TM_NHOMDICHVU where MANHOMDICHVU = '04']
2020-07-16 15:42:32,807 [1] DEBUG - Statement Id: [DAO00020_Add] PreparedStatement : [declare        @keyValue int, @BenhVienId varchar(10), @yearNow int, @SoPhieuYeu varchar(20), @SoRender varchar(20), @MaNhomDichVu varchar(20)        set @keyValue = 0;        set @BenhVienId = '01819'        set @yearNow = YEAR(getdate())        set @MaNhomDichVu = '5'                 select @keyValue = KEYVALUE from LST_KEYDATA        where KEYTYPE = 'SOPHIEUYEUCAU' and KEYYEAR = @yearNow and SEGMENT_1 = @MaNhomDichVu and BENHVIEN_ID = @BenhVienId        if @keyValue = 0        Insert into LST_KEYDATA values ('SOPHIEUYEUCAU', @yearNow, '0', '0', @MaNhomDichVu, '0', '0', 0, @BenhVienId);          Update LST_KEYDATA set KEYVALUE = KEYVALUE + 1, @keyValue = (KEYVALUE + 1) where KEYTYPE = 'SOPHIEUYEUCAU' and KEYYEAR = @yearNow and SEGMENT_1 = @MaNhomDichVu and BENHVIEN_ID = @BenhVienId        set @SoRender = right('000000'+convert(varchar(6), @keyValue), 6)        set @SoPhieuYeu = RIGHT(@yearNow, 2) + '.' + @MaNhomDichVu + '.' + @SoRender                 insert into TT_DVYEUCAU (        TIEPNHAN_ID        , BENHAN_ID        , KHAMBENH_ID        , SODICHVUYEUCAU        , KHAMBENH_NGOAITRU_ID        , SOPHIEUYEUCAU        , BENHNHAN_ID        , DOITUONG_ID        , DICHVU_ID         ,           NGUOICHIDINH_ID                 , BACSICHIDINH_ID        , GIOYEUCAU        , NGAYYEUCAU        , THANGYEUCAU        , NAMYEUCAU        , NGAYGIOYEUCAU        , THUTUYEUCAU        , NOIYEUCAU_ID        , NOITHUCHIEN_ID        , TRANGTHAI_HANGDOI        , NOIDUNGCHITIET        , CHANDOAN        , LUUTRU_ID        , SODICHVUDONGTIEN        , DICHVU_KHAMBENH_ID        , DALAYMAU        , SINHTHIET        , CLOTEST        , TIEMCANQUANG        , TRIEUCHUNG        , DAITHE        , VITHE        , BENHPHAM        , DANHANBENHPHAM        , NGAYNHANBENHPHAM        , THOIGIANNHANBENHPHAM        , NGUOINHANBENHPHAM_ID        , MANGUOINHAPBENHPHAM        , TENNGUOINHAPBENHPHAM        , KETQUAXNKHAC        , YEUCAUBENNGOAI        , THUCHIENBENNGOAI        , DONVIBENNGOAI_ID        , BACSIBENNGOAI_ID        , TENBACSIBENNGOAI        , KHOABENNGOAI_ID        , KHOABENNGOAI                 , NOITHUCHIENTHAYDOI_ID        , LOAIKHACHHANG_ID        , THE_ID        , BARCODEID        , HOPDONG_ID        , HOPDONG_BENHNHAN_ID        , HINHTHUCTHANHTOAN_ID        , DANGKY_ID        , DANGKY_CHITIET_ID        , LICHHEN_ID        , THOIGIANLICHHEN        , BNKHONGDENBV        , GHICHU        , THANHTOANTRUOC        , KHAN        , DUOCPHEPTHUCHIEN        , HUYYEUCAU        , LYDOHUY        , TRANGTHAI        , KHOADULIEU        , NGAYKHOADULIEU        , THOIGIANKHOADULIEU        , NGUOIKHOA_ID        , MANGUOIKHOA        , TENNGUOIKHOA        , BENHVIEN_ID        , NGAYTAO        , NGUOITAO_ID        , NGAYHENCLS        , CREATININEMAU        , VUNGCANKHAOSAT        , BHYTDONGTIEN        , THUTIENSAU                 , DVKEMTHEO        , DVKEMTHEO_KHACEKIP        , LIENCHUYENKHOA                 , VITRIKHAOSAT        )        OUTPUT INSERTED.DVYEUCAU_ID, INSERTED.SOPHIEUYEUCAU        values (         @param0         ,  @param1         ,  @param2         ,  @param3         ,  @param4         , @SoPhieuYeu        ,  @param5         ,  @param6         ,  @param7          ,            @param8                  ,  @param9         ,  @param10         ,  @param11         ,  @param12         ,  @param13         ,  @param14         ,  @param15         ,  @param16         ,  @param17         ,  @param18         ,  @param19         ,  @param20         ,  @param21         ,  @param22         ,  @param23         ,  @param24         ,  @param25         ,  @param26         ,  @param27         ,  @param28         ,  @param29         ,  @param30         ,  @param31         ,  @param32         ,  @param33         ,  @param34         ,  @param35         ,  @param36         ,  @param37         ,  @param38         ,  @param39         ,  @param40         ,  @param41         ,  @param42         ,  @param43         ,  @param44         ,  @param45                  ,  @param46         ,  @param47         ,  @param48         ,  @param49         ,  @param50         ,  @param51         ,  @param52         ,  @param53         ,  @param54         ,  @param55         ,  @param56         ,  @param57         ,  @param58         ,  @param59         ,  @param60         ,  @param61         ,  @param62         ,  @param63         ,  @param64         ,  @param65         ,  @param66         ,  @param67         ,  @param68         ,  @param69         ,  @param70         ,  @param71         ,  @param72         ,  @param73         ,  @param74         ,  @param75         ,  @param76         ,  @param77         ,  @param78                  ,  @param79         ,  @param80         ,  @param81                  ,  @param82         );]
2020-07-16 15:42:32,807 [1] DEBUG - Statement Id: [DAO00020_Add] Parameters: [@param0=[TIEPNHAN_ID,8747], @param1=[BENHAN_ID,null], @param2=[KHAMBENH_ID,null], @param3=[SODICHVUYEUCAU,1], @param4=[KHAMBENH_NGOAITRU_ID,null], @param5=[BENHNHAN_ID,8731], @param6=[DOITUONG_ID,1], @param7=[DICHVU_ID,3], @param8=[NGUOICHIDINH_ID,1], @param9=[BACSICHIDINH_ID,1], @param10=[GIOYEUCAU,15], @param11=[NGAYYEUCAU,7/16/2020 12:00:00 AM], @param12=[THANGYEUCAU,7], @param13=[NAMYEUCAU,2020], @param14=[NGAYGIOYEUCAU,7/16/2020 3:39:54 PM], @param15=[THUTUYEUCAU,1], @param16=[NOIYEUCAU_ID,97], @param17=[NOITHUCHIEN_ID,74], @param18=[TRANGTHAI_HANGDOI,null], @param19=[NOIDUNGCHITIET,null], @param20=[CHANDOAN,null], @param21=[LUUTRU_ID,null], @param22=[SODICHVUDONGTIEN,0], @param23=[DICHVU_KHAMBENH_ID,null], @param24=[DALAYMAU,null], @param25=[SINHTHIET,0], @param26=[CLOTEST,0], @param27=[TIEMCANQUANG,0], @param28=[TRIEUCHUNG,null], @param29=[DAITHE,null], @param30=[VITHE,null], @param31=[BENHPHAM,null], @param32=[DANHANBENHPHAM,0], @param33=[NGAYNHANBENHPHAM,null], @param34=[THOIGIANNHANBENHPHAM,null], @param35=[NGUOINHANBENHPHAM_ID,null], @param36=[MANGUOINHAPBENHPHAM,null], @param37=[TENNGUOINHAPBENHPHAM,null], @param38=[KETQUAXNKHAC,null], @param39=[YEUCAUBENNGOAI,0], @param40=[THUCHIENBENNGOAI,0], @param41=[DONVIBENNGOAI_ID,null], @param42=[BACSIBENNGOAI_ID,null], @param43=[TENBACSIBENNGOAI,null], @param44=[KHOABENNGOAI_ID,null], @param45=[KHOABENNGOAI,null], @param46=[NOITHUCHIENTHAYDOI_ID,null], @param47=[LOAIKHACHHANG_ID,null], @param48=[THE_ID,null], @param49=[BARCODEID,null], @param50=[HOPDONG_ID,null], @param51=[HOPDONG_BENHNHAN_ID,null], @param52=[HINHTHUCTHANHTOAN_ID,null], @param53=[DANGKY_ID,null], @param54=[DANGKY_CHITIET_ID,null], @param55=[LICHHEN_ID,null], @param56=[THOIGIANLICHHEN,null], @param57=[BNKHONGDENBV,null], @param58=[GHICHU,null], @param59=[THANHTOANTRUOC,1], @param60=[KHAN,0], @param61=[DUOCPHEPTHUCHIEN,0], @param62=[HUYYEUCAU,0], @param63=[LYDOHUY,null], @param64=[TRANGTHAI,CHUAKETQUA], @param65=[KHOADULIEU,null], @param66=[NGAYKHOADULIEU,null], @param67=[THOIGIANKHOADULIEU,null], @param68=[NGUOIKHOA_ID,null], @param69=[MANGUOIKHOA,null], @param70=[TENNGUOIKHOA,null], @param71=[BENHVIEN_ID,01819], @param72=[NGAYTAO,7/16/2020 3:42:32 PM], @param73=[NGUOITAO_ID,1], @param74=[NGAYHENCLS,null], @param75=[CREATININEMAU,null], @param76=[VUNGCANKHAOSAT,null], @param77=[BHYTDONGTIEN,null], @param78=[THUTIENSAU,0], @param79=[DVKEMTHEO,0], @param80=[DVKEMTHEO_KHACEKIP,null], @param81=[LIENCHUYENKHOA,null], @param82=[VITRIKHAOSAT,null]]
2020-07-16 15:42:32,807 [1] DEBUG - Statement Id: [DAO00020_Add] Types: [@param0=[String, System.String], @param1=[System.DBNull, null], @param2=[System.DBNull, null], @param3=[Int32, System.Int32], @param4=[System.DBNull, null], @param5=[Int32, System.Int32], @param6=[Int64, System.Int64], @param7=[Int64, System.Int64], @param8=[Int64, System.Int64], @param9=[Int64, System.Int64], @param10=[Int32, System.Int32], @param11=[DateTime, System.DateTime], @param12=[Int32, System.Int32], @param13=[Int32, System.Int32], @param14=[DateTime, System.DateTime], @param15=[Int32, System.Int32], @param16=[String, System.String], @param17=[Int64, System.Int64], @param18=[System.DBNull, null], @param19=[System.DBNull, null], @param20=[System.DBNull, null], @param21=[System.DBNull, null], @param22=[Int32, System.Int32], @param23=[System.DBNull, null], @param24=[System.DBNull, null], @param25=[Int32, System.Int32], @param26=[Int32, System.Int32], @param27=[Int32, System.Int32], @param28=[System.DBNull, null], @param29=[System.DBNull, null], @param30=[System.DBNull, null], @param31=[System.DBNull, null], @param32=[Int32, System.Int32], @param33=[System.DBNull, null], @param34=[System.DBNull, null], @param35=[System.DBNull, null], @param36=[System.DBNull, null], @param37=[System.DBNull, null], @param38=[System.DBNull, null], @param39=[Int32, System.Int32], @param40=[Int32, System.Int32], @param41=[System.DBNull, null], @param42=[System.DBNull, null], @param43=[System.DBNull, null], @param44=[System.DBNull, null], @param45=[System.DBNull, null], @param46=[System.DBNull, null], @param47=[System.DBNull, null], @param48=[System.DBNull, null], @param49=[System.DBNull, null], @param50=[System.DBNull, null], @param51=[System.DBNull, null], @param52=[System.DBNull, null], @param53=[System.DBNull, null], @param54=[System.DBNull, null], @param55=[System.DBNull, null], @param56=[System.DBNull, null], @param57=[System.DBNull, null], @param58=[System.DBNull, null], @param59=[Int32, System.Int32], @param60=[Int32, System.Int32], @param61=[Int32, System.Int32], @param62=[Int32, System.Int32], @param63=[System.DBNull, null], @param64=[String, System.String], @param65=[System.DBNull, null], @param66=[System.DBNull, null], @param67=[System.DBNull, null], @param68=[System.DBNull, null], @param69=[System.DBNull, null], @param70=[System.DBNull, null], @param71=[String, System.String], @param72=[DateTime, System.DateTime], @param73=[String, System.String], @param74=[System.DBNull, null], @param75=[System.DBNull, null], @param76=[System.DBNull, null], @param77=[System.DBNull, null], @param78=[String, System.String], @param79=[Int32, System.Int32], @param80=[System.DBNull, null], @param81=[System.DBNull, null], @param82=[System.DBNull, null]]
2020-07-16 15:42:33,132 [1] DEBUG - Statement Id: [DAO00027_ThongTinTiepNhanCOM006] PreparedStatement : [select distinct CONVERT(VARCHAR(11),A.NGAYTIEPNHAN,103) as NGAYYEUCAU, C.DICHVU_ID, C.DVYEUCAU_ID, D.TENDICHVU, C.NOITHUCHIEN_ID,        A.SOTIEPNHAN, A.TRAITUYEN, A.NGAYMIENDONGCHITRA, A.TIEPNHAN_ID, A.DOITUONG_ID, A.TRANGTHAI,        A.LOAITHANHVIEN_ID, A.SUDUNG_BHTN, A.THE_ID, A.THANHVIEN_ID, A.VIP, A.NGUON_BENHNHAN_ID, A.BAOLANH_VIENPHI,        CASE WHEN (A.TRANGTHAI = 'NOITRU' OR A.TRANGTHAI = 'CAPCUU'   or A.TRANGTHAI = 'NGOAITRU') THEN 'IN' ELSE 'OUT' END AS LOAIBENHAN,        CASE WHEN (C.TRANGTHAI = 'CHUAKETQUA') THEN 'CHUAKETQUA' ELSE 'HOANTAT' END AS TRANGTHAIDICHVU, A.SOBHYT,        B.*,        CASE WHEN Left(E.MANHOMDICHVU,2) = '03' THEN '02' ELSE Left(E.MANHOMDICHVU,2) END AS MANHOMDICHVU        , A.UUTIEN, A.NGOAIGIO        from TT_TIEPNHAN A        inner join TT_BENHNHAN B on B.BENHNHAN_ID = A.BENHNHAN_ID and (A.TRANGTHAI = 'DATIEPNHAN' or A.TRANGTHAI = 'NOITRU' or A.TRANGTHAI = 'CAPCUU'  or A.TRANGTHAI = 'NGOAITRU') and B.ACTIVE = '1'        inner join TT_DVYEUCAU C on C.TIEPNHAN_ID = A.TIEPNHAN_ID        left join TM_DICHVU D on D.DICHVU_ID = C.DICHVU_ID        left join TM_NHOMDICHVU E on E.NHOMDICHVU_ID = D.NHOMDICHVU_ID        where C.NGAYHENCLS is NULL and A.TIEPNHAN_ID = '8747' and C.DICHVU_ID = '3' and A.BENHVIEN_ID = '01819'         and           C.DVYEUCAU_ID = '13147']
2020-07-16 15:42:33,374 [1] DEBUG - Statement Id: [DAO00027_ThongTinTiepNhanCOM015] PreparedStatement : [declare @ManhomDSA varchar(10);        select top 1  @ManhomDSA = VALUE from TM_SYS_APPSETTINGS where CODE = 'MANHOM_DICHVU_DSA'        SELECT * FROM        (        SELECT        (A.SOTIEPNHAN + (CASE WHEN Left(E.MANHOMDICHVU,2) = '03' THEN '02' ELSE Left(E.MANHOMDICHVU,2) END) + LTRIM(C.NOITHUCHIEN_ID)) AS acss_lookupID,        ROW_NUMBER() OVER        (PARTITION BY (A.SOTIEPNHAN + (CASE WHEN Left(E.MANHOMDICHVU,2) = '03' THEN '02' ELSE Left(E.MANHOMDICHVU,2) END) + LTRIM(C.NOITHUCHIEN_ID))        ORDER BY (A.SOTIEPNHAN + (CASE WHEN Left(E.MANHOMDICHVU,2) = '03' THEN '02' ELSE Left(E.MANHOMDICHVU,2) END) + LTRIM(C.NOITHUCHIEN_ID)))        as num,        A.SOTIEPNHAN + (CASE WHEN Left(E.MANHOMDICHVU,2) = '03' THEN '02' ELSE Left(E.MANHOMDICHVU,2) END) + LTRIM(C.NOITHUCHIEN_ID) as KEYCOM15,        C.NOITHUCHIEN_ID, A.SOTIEPNHAN, A.TRAITUYEN, A.NGAYMIENDONGCHITRA, A.TIEPNHAN_ID, A.DOITUONG_ID, A.TRANGTHAI,        CASE WHEN (A.TRANGTHAI = 'NOITRU' OR A.TRANGTHAI = 'CAPCUU' or A.TRANGTHAI = 'NGOAITRU') THEN 'IN' ELSE 'OUT' END AS LOAIBENHAN,        CASE WHEN (C.TRANGTHAI = 'CHUAKETQUA') THEN 'CHUAKETQUA' ELSE 'HOANTAT' END AS TRANGTHAIDICHVU, A.SOBHYT,        B.*, F.TRANGTHAI as TRANGTHAI_BENHAN_NOITRU,        A.LOAITHANHVIEN_ID, A.SUDUNG_BHTN, A.THE_ID, A.THANHVIEN_ID, A.VIP, A.NGUON_BENHNHAN_ID, A.BAOLANH_VIENPHI,        CASE        WHEN @ManhomDSA is not null and E.MANHOMDICHVU in (@ManhomDSA) THEN E.MANHOMDICHVU        WHEN Left(E.MANHOMDICHVU,2) = '03' THEN '02' ELSE Left(E.MANHOMDICHVU,2) END AS MANHOMDICHVU        , A.UUTIEN, A.NGOAIGIO        from TT_TIEPNHAN A        inner join TT_BENHNHAN B on B.BENHNHAN_ID = A.BENHNHAN_ID and (A.TRANGTHAI = 'DATIEPNHAN' or A.TRANGTHAI = 'NOITRU' or A.TRANGTHAI = 'CAPCUU' or A.TRANGTHAI = 'NGOAITRU') and B.ACTIVE = '1'        inner join TT_DVYEUCAU C on C.TIEPNHAN_ID = A.TIEPNHAN_ID        left join TM_DICHVU D on D.DICHVU_ID = C.DICHVU_ID        left join TM_NHOMDICHVU E on E.NHOMDICHVU_ID = D.NHOMDICHVU_ID        left join TT_NOITRU_BENHAN F on F.TIEPNHAN_ID = A.TIEPNHAN_ID        where C.NGAYHENCLS is NULL and A.TIEPNHAN_ID = '8747' and A.BENHVIEN_ID = '01819'        ) a where a.num = 1]
2020-07-16 15:42:33,598 [1] DEBUG - Statement Id: [DAO00009_TT_TIEPNHAN_GetProcess] PreparedStatement : [select PROCESS_ID from TT_TIEPNHAN where SOTIEPNHAN = 'TN200716.0000004']
2020-07-16 15:42:33,632 [1] DEBUG - Statement Id: [DAOWF001_Kiemtrathongtindayeucaudacochua] PreparedStatement : [select * from TT_REQUEST        where        PARA = '{"HOSPITAL_ID":"01819","SOTIEPNHAN":"TN200716.0000004"}'        AND ISACTIVE = '1']
2020-07-16 15:42:33,658 [1] DEBUG - Statement Id: [DAOWF001_Kiemtrathongtindichvudayeucau] PreparedStatement : [select top 1 * from TT_REQUEST_SERVICE        where        PARA = '{"DICHVU_ID":"3","DVYEUCAU_ID":"13147"}'                AND ISACTIVE = '1' order by ID desc]
2020-07-16 15:42:33,686 [1] DEBUG - Statement Id: [DAOWF001_KiemtrathongtinchitietDichvuYeucau] PreparedStatement : [select * from TT_REQUEST_SERVICE_DETAIL        where        REQUEST_SERVICE_ID = '']
2020-07-16 15:42:33,711 [1] DEBUG - Statement Id: [DAOWF001_GetStartStateOfProcess] PreparedStatement : [select STATE_CODE from TM_STATE where TYPE_CODE = 'S' and PROCESS_CODE = 'P01']
2020-07-16 15:42:33,734 [1] DEBUG - Statement Id: [DAOWF001_Laythongtinwithstatecode] PreparedStatement : [select A.*, B.STATUS_CODE from        TM_STATE_ACTION A        left join TM_STATE B on B.STATE_CODE = A.NEXT_STATE_CODE and A.PROCESS_CODE = B.PROCESS_CODE        where        A.CURR_STATE_CODE = '6'        AND A.PROCESS_CODE = 'P01'        Order By ORDER_ID ASC]
2020-07-16 15:42:33,761 [1] DEBUG - Statement Id: [DAOWF003_Add] PreparedStatement : [insert into TT_REQUEST_SERVICE (        REQUEST_ID        , PARA        , CURR_STATE_CODE        , PROCESS_CODE        ) values (         @param0         ,  @param1         ,  @param2         ,  @param3         )        SELECT SCOPE_IDENTITY()]
2020-07-16 15:42:33,761 [1] DEBUG - Statement Id: [DAOWF003_Add] Parameters: [@param0=[REQUEST_ID,8751], @param1=[SERVICEPARA,{"DICHVU_ID":"3","DVYEUCAU_ID":"13147"}], @param2=[CURR_STATE_CODE,0], @param3=[PROCESS_CODE,P01]]
2020-07-16 15:42:33,761 [1] DEBUG - Statement Id: [DAOWF003_Add] Types: [@param0=[Int32, System.Int32], @param1=[String, System.String], @param2=[String, System.String], @param3=[String, System.String]]
2020-07-16 15:42:33,786 [1] DEBUG - Statement Id: [DAOWF005_Add] PreparedStatement : [insert into TT_REQUEST_SERVICE_DETAIL (        REQUEST_ID        ,REQUEST_SERVICE_ID        , OLD_STATE_CODE        , CURR_STATE_CODE        ) values (         @param0         , @param1         ,  @param2         ,  @param3         )        SELECT SCOPE_IDENTITY()]
2020-07-16 15:42:33,786 [1] DEBUG - Statement Id: [DAOWF005_Add] Parameters: [@param0=[REQUEST_ID,8751], @param1=[REQUEST_SERVICE_ID,11165], @param2=[OLD_STATE_CODE,null], @param3=[CURR_STATE_CODE,0]]
2020-07-16 15:42:33,786 [1] DEBUG - Statement Id: [DAOWF005_Add] Types: [@param0=[String, System.String], @param1=[Int64, System.Int64], @param2=[System.DBNull, null], @param3=[String, System.String]]
2020-07-16 15:42:33,810 [1] DEBUG - Statement Id: [DAOWF005_Add_History] PreparedStatement : [insert into TT_REQUEST_SERVICE_HISTORY (        REQUEST_ID        ,REQUEST_SERVICE_ID        , OLD_STATE_CODE        , CURR_STATE_CODE        ) values (         @param0         , @param1         ,  @param2         ,  @param3         )]
2020-07-16 15:42:33,810 [1] DEBUG - Statement Id: [DAOWF005_Add_History] Parameters: [@param0=[REQUEST_ID,8751], @param1=[REQUEST_SERVICE_ID,11165], @param2=[OLD_STATE_CODE,null], @param3=[CURR_STATE_CODE,0]]
2020-07-16 15:42:33,810 [1] DEBUG - Statement Id: [DAOWF005_Add_History] Types: [@param0=[String, System.String], @param1=[Int64, System.Int64], @param2=[System.DBNull, null], @param3=[String, System.String]]
2020-07-16 15:42:33,834 [1] DEBUG - Statement Id: [DAO00009_TT_DVYEUCAU_Update] PreparedStatement : [Update TT_DVYEUCAU set TRANGTHAI_WFL = 'CHODONGTIEN' where DVYEUCAU_ID = '13147']
2020-07-16 15:42:33,875 [1] DEBUG - Statement Id: [DAO00026_GetListDanhSachDichVuGhiNhanVTYT_COM25_WithTN] PreparedStatement : [select distinct CONVERT(VARCHAR(11),C.NGAYYEUCAU,103) as NGAYYEUCAU, C.DICHVU_ID, C.DVYEUCAU_ID, D.TENDICHVU, C.NOITHUCHIEN_ID, A.SOTIEPNHAN, A.TRAITUYEN, A.NGAYMIENDONGCHITRA, A.TIEPNHAN_ID, A.DOITUONG_ID, A.TRANGTHAI,            A.LOAITHANHVIEN_ID, A.SUDUNG_BHTN, A.THE_ID, A.THANHVIEN_ID, A.VIP, A.NGUON_BENHNHAN_ID, A.BAOLANH_VIENPHI,            CASE WHEN (A.TRANGTHAI = 'NOITRU' OR A.TRANGTHAI = 'CAPCUU') THEN 'IN' ELSE 'OUT' END AS LOAIBENHAN,            CASE WHEN (C.TRANGTHAI = 'CHUAKETQUA') THEN 'CHUAKETQUA' ELSE 'HOANTAT' END AS TRANGTHAIDICHVU,            B.*, isnull(ntba.SOBENHAN, '') SOBENHAN, isnull(ntba.BENHAN_ID, 0) BENHAN_ID,            CASE WHEN Left(E.MANHOMDICHVU,2) = '03' THEN '02' ELSE Left(E.MANHOMDICHVU,2) END AS MANHOMDICHVU            from TT_TIEPNHAN A            inner join TT_BENHNHAN B on B.BENHNHAN_ID = A.BENHNHAN_ID and B.ACTIVE = '1'            inner join TT_DVYEUCAU C on C.TIEPNHAN_ID = A.TIEPNHAN_ID                        left join TM_DICHVU D on D.DICHVU_ID = C.DICHVU_ID            left join TM_NHOMDICHVU E on E.NHOMDICHVU_ID = D.NHOMDICHVU_ID            left join TT_NOITRU_BENHAN ntba on ntba.BENHAN_ID = C.BENHAN_ID              where            C.NGAYHENCLS is NULL and A.BENHVIEN_ID = '01819'            and (A.TRANGTHAI = 'DATIEPNHAN' or A.TRANGTHAI = 'NOITRU' or A.TRANGTHAI = 'CAPCUU' or A.TRANGTHAI = 'NGOAITRU')            and (CASE WHEN Left(E.MANHOMDICHVU,2) = '03' THEN '02' ELSE Left(E.MANHOMDICHVU,2) END in ('02', '04'))            and A.TIEPNHAN_ID = '8747']
2020-07-16 15:42:34,124 [1] DEBUG - Statement Id: [DAO00023_GetSOBHYT_HUONG_ID] PreparedStatement : [select isnull(MAX(SOBHYT_HUONG_ID),0) SOBHYT_HUONG_ID        from TT_TIEPNHAN_SOTHEBHYT        where TIEPNHAN_ID = '8747']
2020-07-16 15:42:34,153 [1] DEBUG - Statement Id: [DAO00064_GetTopTT_TIEPNHAN_SOTHEBHYT] PreparedStatement : [select top 1 stbhyt.*, ba.SOBENHAN,        tn.SOTIEPNHAN, tn.LOAITHANHVIEN_ID, tn.THE_ID, tn.THANHVIEN_ID,        tn.SUDUNG_BHTN, tn.BAOLANH_VIENPHI, tn.VIP, tn.NGUOINUOCNGOAI        from TT_TIEPNHAN_SOTHEBHYT stbhyt        left join TT_TIEPNHAN tn on tn.TIEPNHAN_ID = stbhyt.TIEPNHAN_ID        left join TT_NOITRU_BENHAN ba on ba.TIEPNHAN_ID = stbhyt.TIEPNHAN_ID        where        stbhyt.TIEPNHAN_ID = '8747' and isnull(stbhyt.KHONGSUDUNG, '0') = '0'        order by SOBHYT_HUONG_ID desc]
2020-07-16 15:42:34,195 [1] DEBUG - Statement Id: [DAO00006_GetListDuocTyle] PreparedStatement : [select DUOC_ID, DOITUONG_ID, (TYLE/100) as TYLE, DONGIA MUCTRAN_THANHTOAN from TM_DOITUONG_GIADUOC_TYLE            where            BENHVIEN_ID = '01819'            and DOITUONG_ID = '0']
2020-07-16 15:42:34,219 [1] DEBUG - Statement Id: [DAO00027_GetListTuongTrinhDichVuPhauThuatCuaTiepNhan] PreparedStatement : [declare @ManhomDSA varchar(10);        declare @PhanLoaiNhomDV varchar(20) = '05';        select top 1  @ManhomDSA = VALUE from TM_SYS_APPSETTINGS where CODE = 'MANHOM_DICHVU_DSA'        if (@ManhomDSA is not null) set @PhanLoaiNhomDV += ',' + @ManhomDSA        select distinct ptyc.*        from TT_PHAUTHUAT_YEUCAU ptyc        inner join TM_DICHVU dv on dv.DICHVU_ID = ptyc.DICHVU_ID        inner join TM_NHOMDICHVU ndv on ndv.NHOMDICHVU_ID = dv.NHOMDICHVU_ID        inner join TT_PHAUTHUAT pt on pt.PHAUTHUAT_ID = ptyc.PHAUTHUAT_ID        where        pt.TIEPNHAN_ID = 8747        and (left(ndv.MANHOMDICHVU, 2) in (select * from STRING_SPLIT(@PhanLoaiNhomDV,',')) or ndv.MANHOMDICHVU in (select * from STRING_SPLIT(@PhanLoaiNhomDV,',')))]
2020-07-16 15:42:34,276 [1] DEBUG - Statement Id: [DAO00006_GetList] PreparedStatement : [select dv.*, loaiDV.MALOAIDICHVU, captren.NHOMDICHVU_ID as NHOMDICHVU_CAPTREN_ID, captren.TENNHOMDICHVU as NHOMDICHVU_CAPTREN,              nhom_dv.TENNHOMDICHVU as TENNHOMDICHVU, nhom_dv.MANHOMDICHVU,              case when dv.ATTRIBUTE5 is null then 'TT' else 'KTC' end as LOAI_CHIPHI              from TM_DICHVU as dv              left join TM_NHOMDICHVU as nhom_dv on nhom_dv.NHOMDICHVU_ID = dv.NHOMDICHVU_ID and nhom_dv.BENHVIEN_ID = '01819'              left join TM_NHOMDICHVU as captren on nhom_dv.CAPTREN_ID = captren.NHOMDICHVU_ID and captren.BENHVIEN_ID = '01819'              left join TM_LOAIDICHVU loaiDV on nhom_dv.LOAIDICHVU_ID = loaiDV.LOAIDICHVU_ID and loaiDV.BENHVIEN_ID = '01819'              where nhom_dv.TAMNGUNG = '0' and dv.BENHVIEN_ID = '01819'              and dv.TAMNGUNG = '0'               AND                   loaiDV.MALOAIDICHVU = 'KhamBenh']
2020-07-16 15:42:34,377 [1] DEBUG - Statement Id: [DAO00023_Add] PreparedStatement : [insert into TT_VIENPHI (        TIEPNHAN_ID        , BENHAN_ID         ,           BENHNHAN_ID         ,           DOTDIEUTRI_ID                 , KHAMBENH_ID        , REF_ID        , REF_TABLE        , DICHVU_ID        , DUOC_ID        , LOAI_CHIPHI        , LOAIGIA_ID        , SOLUONG        , DONGIA_DOANHTHU        , THANHTIEN_DOANHTHU        , BHYT_TL        , BHYT_DONGIA        , BHYT_THANHTIEN        , BHYT_DONGIA_CHITRA        , BHYT_THANHTIEN_CHITRA        , BENHNHAN_PHAITHANHTOAN        , GIATRI_HOADON        , GIATRI_HOADON_DATHANHTOAN        , GIATRI_BIENLAI        , GIATRI_BIENLAI_DATHANHTOAN        , GIATRI_BENHNHAN_DATHANHTOAN        , GIATRI_THATTHU        , MIENGIAM_TL        , MIENGIAM_GIATRI        , NGANSACH_TL        , NGANSACH_GIATRI        , TAITRO_TL        , TAITRO_GIATRI        , BHTN_TL        , BHTN_DONGIA        , BHTN_THANHTIEN        , BHTN_DONGIA_CHITRA        , BHTN_THANHTIEN_CHITRA         ,           DUOCPHEPTHUCHIEN         ,           HUY         ,           DATHANHTOAN         ,           DATHUCHIEN         ,           KHONGTHUTIEN         ,           BHYTDONGTIEN                 , DUYET        , HOADON_ID         ,           ACTIVE         ,           TYLE_VAT         ,           GIAVON         ,           BANGGIA_ID                 , BENHVIEN_ID        , NGUOITAO_ID        , NGAYTAO        , NGUOICAPNHAT_ID        , NGAYCAPNHAT        , DONGIA_BHYT_BANDAU        , DONGIADOANHTHU_BANDAU         ,           YEUCAUVP         ,           DOITUONG_HUONG_ID         ,           SOBHYT_HUONG_ID         ,           DICHVU_TL         ,           SOLONHAP_ID                 ) values (         @param0         ,  @param1          ,            @param2          ,            @param3                  ,  @param4         ,  @param5         ,  @param6         ,  @param7         ,  @param8         ,  @param9         ,  @param10         ,  @param11         ,  @param12         ,  @param13         ,  @param14         ,  @param15         ,  @param16         ,  @param17         ,  @param18         ,  @param19         ,  @param20         ,  @param21         ,  @param22         ,  @param23         ,  @param24         ,  @param25         ,  @param26         ,  @param27         ,  @param28         ,  @param29         ,  @param30         ,  @param31         ,  @param32         ,  @param33         ,  @param34         ,  @param35         ,  @param36          ,            @param37          ,            @param38          ,            @param39          ,            @param40          ,            @param41          ,            @param42                  ,  @param43         ,  @param44          ,            @param45          ,            @param46          ,            @param47          ,            @param48                  ,  @param49         ,  @param50         ,  @param51         ,  @param52         ,  @param53         ,  @param54         ,  @param55          ,            @param56          ,            @param57          ,            @param58          ,            @param59          ,            @param60                  )        SELECT SCOPE_IDENTITY()]
2020-07-16 15:42:34,377 [1] DEBUG - Statement Id: [DAO00023_Add] Parameters: [@param0=[TIEPNHAN_ID,8747], @param1=[BENHAN_ID,null], @param2=[BENHNHAN_ID,8731], @param3=[DOTDIEUTRI_ID,0], @param4=[KHAMBENH_ID,null], @param5=[REF_ID,13147], @param6=[REF_TABLE,TT_DVYEUCAU], @param7=[DICHVU_ID,3], @param8=[DUOC_ID,null], @param9=[LOAI_CHIPHI,TT], @param10=[LOAIGIA_ID,3], @param11=[SOLUONG,1], @param12=[DONGIA_DOANHTHU,38700], @param13=[THANHTIEN_DOANHTHU,38700], @param14=[BHYT_TL,0], @param15=[BHYT_DONGIA,0], @param16=[BHYT_THANHTIEN,0], @param17=[BHYT_DONGIA_CHITRA,0], @param18=[BHYT_THANHTIEN_CHITRA,0], @param19=[BENHNHAN_PHAITHANHTOAN,38700], @param20=[GIATRI_HOADON,0], @param21=[GIATRI_HOADON_DATHANHTOAN,0], @param22=[GIATRI_BIENLAI,0], @param23=[GIATRI_BIENLAI_DATHANHTOAN,0], @param24=[GIATRI_BENHNHAN_DATHANHTOAN,0], @param25=[GIATRI_THATTHU,0], @param26=[MIENGIAM_TL,0], @param27=[MIENGIAM_GIATRI,0], @param28=[NGANSACH_TL,0], @param29=[NGANSACH_GIATRI,0], @param30=[TAITRO_TL,0], @param31=[TAITRO_GIATRI,0], @param32=[BHTN_TL,0], @param33=[BHTN_DONGIA,0], @param34=[BHTN_THANHTIEN,0], @param35=[BHTN_DONGIA_CHITRA,0], @param36=[BHTN_THANHTIEN_CHITRA,0], @param37=[DUOCPHEPTHUCHIEN,0], @param38=[HUY,0], @param39=[DATHANHTOAN,0], @param40=[DATHUCHIEN,0], @param41=[KHONGTHUTIEN,0], @param42=[BHYTDONGTIEN,0], @param43=[DUYET,null], @param44=[HOADON_ID,null], @param45=[ACTIVE,1], @param46=[TYLE_VAT,0], @param47=[GIAVON,0], @param48=[BANGGIA_ID,2017], @param49=[BENHVIEN_ID,01819], @param50=[NGUOITAO_ID,1], @param51=[NGAYTAO,7/16/2020 3:42:34 PM], @param52=[NGUOICAPNHAT_ID,1], @param53=[NGAYCAPNHAT,7/16/2020 3:42:34 PM], @param54=[DONGIA_BHYT_BANDAU,0], @param55=[DONGIADOANHTHU_BANDAU,38700], @param56=[YEUCAUVP,0], @param57=[DOITUONG_HUONG_ID,1], @param58=[SOBHYT_HUONG_ID,8755], @param59=[DICHVU_TL,1], @param60=[SOLONHAP_ID,null]]
2020-07-16 15:42:34,377 [1] DEBUG - Statement Id: [DAO00023_Add] Types: [@param0=[Int32, System.Int32], @param1=[System.DBNull, null], @param2=[Int32, System.Int32], @param3=[Int32, System.Int32], @param4=[System.DBNull, null], @param5=[Int32, System.Int32], @param6=[String, System.String], @param7=[Int32, System.Int32], @param8=[System.DBNull, null], @param9=[String, System.String], @param10=[Int32, System.Int32], @param11=[Decimal, System.Decimal], @param12=[Decimal, System.Decimal], @param13=[Decimal, System.Decimal], @param14=[Decimal, System.Decimal], @param15=[Decimal, System.Decimal], @param16=[Decimal, System.Decimal], @param17=[Decimal, System.Decimal], @param18=[Decimal, System.Decimal], @param19=[Decimal, System.Decimal], @param20=[Decimal, System.Decimal], @param21=[Decimal, System.Decimal], @param22=[Decimal, System.Decimal], @param23=[Decimal, System.Decimal], @param24=[Decimal, System.Decimal], @param25=[Decimal, System.Decimal], @param26=[Decimal, System.Decimal], @param27=[Decimal, System.Decimal], @param28=[Decimal, System.Decimal], @param29=[Decimal, System.Decimal], @param30=[Decimal, System.Decimal], @param31=[Decimal, System.Decimal], @param32=[Decimal, System.Decimal], @param33=[Decimal, System.Decimal], @param34=[Decimal, System.Decimal], @param35=[Decimal, System.Decimal], @param36=[Decimal, System.Decimal], @param37=[Int32, System.Int32], @param38=[Int32, System.Int32], @param39=[Int32, System.Int32], @param40=[Int32, System.Int32], @param41=[String, System.String], @param42=[String, System.String], @param43=[System.DBNull, null], @param44=[System.DBNull, null], @param45=[Int32, System.Int32], @param46=[Int32, System.Int32], @param47=[Decimal, System.Decimal], @param48=[Int32, System.Int32], @param49=[String, System.String], @param50=[String, System.String], @param51=[DateTime, System.DateTime], @param52=[String, System.String], @param53=[DateTime, System.DateTime], @param54=[Decimal, System.Decimal], @param55=[Decimal, System.Decimal], @param56=[String, System.String], @param57=[Int32, System.Int32], @param58=[Int32, System.Int32], @param59=[Decimal, System.Decimal], @param60=[System.DBNull, null]]
2020-07-16 15:42:34,634 [1] DEBUG - Statement Id: [DAO00064_GetREGListVienphiTiepNhan] PreparedStatement : [select A.*, B.THUTIENSAU        from TT_VIENPHI A        left join TT_DVYEUCAU B on A.REF_ID =  B.DVYEUCAU_ID and A.REF_TABLE = 'TT_DVYEUCAU' and B.HUYYEUCAU = '0'        where        A.TIEPNHAN_ID = '8747' and A.BENHVIEN_ID = '01819' and (A.BENHAN_ID is NULL or A.BENHAN_ID = '')        and A.HUY = '0'        ORDER BY A.VIENPHI_ID]
2020-07-16 15:42:34,679 [1] DEBUG - Statement Id: [DAO00064_GetTopTT_TIEPNHAN_SOTHEBHYT] PreparedStatement : [select top 1 stbhyt.*, ba.SOBENHAN,        tn.SOTIEPNHAN, tn.LOAITHANHVIEN_ID, tn.THE_ID, tn.THANHVIEN_ID,        tn.SUDUNG_BHTN, tn.BAOLANH_VIENPHI, tn.VIP, tn.NGUOINUOCNGOAI        from TT_TIEPNHAN_SOTHEBHYT stbhyt        left join TT_TIEPNHAN tn on tn.TIEPNHAN_ID = stbhyt.TIEPNHAN_ID        left join TT_NOITRU_BENHAN ba on ba.TIEPNHAN_ID = stbhyt.TIEPNHAN_ID        where        stbhyt.TIEPNHAN_ID = '8747' and isnull(stbhyt.KHONGSUDUNG, '0') = '0'        order by SOBHYT_HUONG_ID desc]
2020-07-16 15:42:34,703 [1] DEBUG - Statement Id: [DAO00006_GetListDuocTyle] PreparedStatement : [select DUOC_ID, DOITUONG_ID, (TYLE/100) as TYLE, DONGIA MUCTRAN_THANHTOAN from TM_DOITUONG_GIADUOC_TYLE            where            BENHVIEN_ID = '01819'            and DOITUONG_ID = '0']
2020-07-16 15:42:34,726 [1] DEBUG - Statement Id: [DAO00027_GetListTuongTrinhDichVuPhauThuatCuaTiepNhan] PreparedStatement : [declare @ManhomDSA varchar(10);        declare @PhanLoaiNhomDV varchar(20) = '05';        select top 1  @ManhomDSA = VALUE from TM_SYS_APPSETTINGS where CODE = 'MANHOM_DICHVU_DSA'        if (@ManhomDSA is not null) set @PhanLoaiNhomDV += ',' + @ManhomDSA        select distinct ptyc.*        from TT_PHAUTHUAT_YEUCAU ptyc        inner join TM_DICHVU dv on dv.DICHVU_ID = ptyc.DICHVU_ID        inner join TM_NHOMDICHVU ndv on ndv.NHOMDICHVU_ID = dv.NHOMDICHVU_ID        inner join TT_PHAUTHUAT pt on pt.PHAUTHUAT_ID = ptyc.PHAUTHUAT_ID        where        pt.TIEPNHAN_ID = 8747        and (left(ndv.MANHOMDICHVU, 2) in (select * from STRING_SPLIT(@PhanLoaiNhomDV,',')) or ndv.MANHOMDICHVU in (select * from STRING_SPLIT(@PhanLoaiNhomDV,',')))]
2020-07-16 15:42:34,752 [1] DEBUG - Statement Id: [DAO00006_GetList] PreparedStatement : [select dv.*, loaiDV.MALOAIDICHVU, captren.NHOMDICHVU_ID as NHOMDICHVU_CAPTREN_ID, captren.TENNHOMDICHVU as NHOMDICHVU_CAPTREN,              nhom_dv.TENNHOMDICHVU as TENNHOMDICHVU, nhom_dv.MANHOMDICHVU,              case when dv.ATTRIBUTE5 is null then 'TT' else 'KTC' end as LOAI_CHIPHI              from TM_DICHVU as dv              left join TM_NHOMDICHVU as nhom_dv on nhom_dv.NHOMDICHVU_ID = dv.NHOMDICHVU_ID and nhom_dv.BENHVIEN_ID = '01819'              left join TM_NHOMDICHVU as captren on nhom_dv.CAPTREN_ID = captren.NHOMDICHVU_ID and captren.BENHVIEN_ID = '01819'              left join TM_LOAIDICHVU loaiDV on nhom_dv.LOAIDICHVU_ID = loaiDV.LOAIDICHVU_ID and loaiDV.BENHVIEN_ID = '01819'              where nhom_dv.TAMNGUNG = '0' and dv.BENHVIEN_ID = '01819'              and dv.TAMNGUNG = '0'               AND                   loaiDV.MALOAIDICHVU = 'KhamBenh']
2020-07-16 15:42:34,833 [1] DEBUG - Statement Id: [DAO00023_Update_VPTiepnhan] PreparedStatement : [update TT_VIENPHI set        TIEPNHAN_ID =  @param0                ,           BENHNHAN_ID =  @param1          ,           REF_ID =  @param2                  , REF_TABLE =  @param3         , DICHVU_ID =  @param4         , DUOC_ID =  @param5         , LOAI_CHIPHI =  @param6         , LOAIGIA_ID =  @param7         , SOLUONG =  @param8         , DONGIA_DOANHTHU =  @param9         , THANHTIEN_DOANHTHU =  @param10         , BHYT_TL =  @param11         , BHYT_DONGIA =  @param12         , BHYT_THANHTIEN =  @param13         , BHYT_DONGIA_CHITRA =  @param14         , BHYT_THANHTIEN_CHITRA =  @param15         , BENHNHAN_PHAITHANHTOAN =  @param16         , GIATRI_HOADON =  @param17         , GIATRI_HOADON_DATHANHTOAN =  @param18         , GIATRI_BIENLAI =  @param19         , GIATRI_BIENLAI_DATHANHTOAN =  @param20         , GIATRI_BENHNHAN_DATHANHTOAN =  @param21         , GIATRI_THATTHU =  @param22         , MIENGIAM_TL =  @param23         , NGANSACH_TL =  @param24         , NGANSACH_GIATRI =  @param25         , TAITRO_TL =  @param26         , TAITRO_GIATRI =  @param27         , BHTN_TL =  @param28         , BHTN_DONGIA =  @param29         , BHTN_THANHTIEN =  @param30         , BHTN_DONGIA_CHITRA =  @param31         , BHTN_THANHTIEN_CHITRA =  @param32          ,           TYLE_VAT =  @param33          ,           GIAVON =  @param34          ,           BANGGIA_ID =  @param35          ,           BHYTDONGTIEN =  @param36          ,           BHYT_DONGIA_CONGKHAM_DAU =  @param37          ,           BHYT_CONGKHAM_DAU_TYLE =  @param38                  , BENHVIEN_ID =  @param39         , NGUOICAPNHAT_ID =  @param40         , NGAYCAPNHAT =  @param41          ,           DONGIA_BHYT_BANDAU =  @param42          ,           DONGIADOANHTHU_BANDAU =  @param43          ,           YEUCAUVP =  @param44                        where                    VIENPHI_ID = '16000' and DATHANHTOAN = '0']
2020-07-16 15:42:34,833 [1] DEBUG - Statement Id: [DAO00023_Update_VPTiepnhan] Parameters: [@param0=[TIEPNHAN_ID,8747], @param1=[BENHNHAN_ID,8731], @param2=[REF_ID,13147], @param3=[REF_TABLE,TT_DVYEUCAU], @param4=[DICHVU_ID,3], @param5=[DUOC_ID,null], @param6=[LOAI_CHIPHI,TT], @param7=[LOAIGIA_ID,3], @param8=[SOLUONG,1.0000], @param9=[DONGIA_DOANHTHU,38700.0000], @param10=[THANHTIEN_DOANHTHU,38700.00], @param11=[BHYT_TL,0], @param12=[BHYT_DONGIA,0], @param13=[BHYT_THANHTIEN,0], @param14=[BHYT_DONGIA_CHITRA,0], @param15=[BHYT_THANHTIEN_CHITRA,0], @param16=[BENHNHAN_PHAITHANHTOAN,38700.00], @param17=[GIATRI_HOADON,0], @param18=[GIATRI_HOADON_DATHANHTOAN,0], @param19=[GIATRI_BIENLAI,0], @param20=[GIATRI_BIENLAI_DATHANHTOAN,0], @param21=[GIATRI_BENHNHAN_DATHANHTOAN,0], @param22=[GIATRI_THATTHU,0], @param23=[MIENGIAM_TL,0], @param24=[NGANSACH_TL,0], @param25=[NGANSACH_GIATRI,0], @param26=[TAITRO_TL,0], @param27=[TAITRO_GIATRI,0], @param28=[BHTN_TL,0], @param29=[BHTN_DONGIA,0], @param30=[BHTN_THANHTIEN,0], @param31=[BHTN_DONGIA_CHITRA,0], @param32=[BHTN_THANHTIEN_CHITRA,0], @param33=[TYLE_VAT,0], @param34=[GIAVON,0.0000], @param35=[BANGGIA_ID,2017], @param36=[BHYTDONGTIEN,0], @param37=[BHYT_DONGIA_CONGKHAM_DAU,0], @param38=[BHYT_CONGKHAM_DAU_TYLE,0], @param39=[BENHVIEN_ID,01819], @param40=[NGUOICAPNHAT_ID,1], @param41=[NGAYCAPNHAT,7/16/2020 3:42:34 PM], @param42=[DONGIA_BHYT_BANDAU,0.00], @param43=[DONGIADOANHTHU_BANDAU,38700.0000], @param44=[YEUCAUVP,0]]
2020-07-16 15:42:34,833 [1] DEBUG - Statement Id: [DAO00023_Update_VPTiepnhan] Types: [@param0=[Int32, System.Int32], @param1=[Int32, System.Int32], @param2=[Int32, System.Int32], @param3=[String, System.String], @param4=[Int32, System.Int32], @param5=[System.DBNull, null], @param6=[String, System.String], @param7=[Int32, System.Int32], @param8=[Decimal, System.Decimal], @param9=[Decimal, System.Decimal], @param10=[Decimal, System.Decimal], @param11=[Decimal, System.Decimal], @param12=[Decimal, System.Decimal], @param13=[Decimal, System.Decimal], @param14=[Decimal, System.Decimal], @param15=[Decimal, System.Decimal], @param16=[Decimal, System.Decimal], @param17=[Decimal, System.Decimal], @param18=[Decimal, System.Decimal], @param19=[Decimal, System.Decimal], @param20=[Decimal, System.Decimal], @param21=[Decimal, System.Decimal], @param22=[Decimal, System.Decimal], @param23=[Decimal, System.Decimal], @param24=[Decimal, System.Decimal], @param25=[Decimal, System.Decimal], @param26=[Decimal, System.Decimal], @param27=[Decimal, System.Decimal], @param28=[Decimal, System.Decimal], @param29=[Decimal, System.Decimal], @param30=[Decimal, System.Decimal], @param31=[Decimal, System.Decimal], @param32=[Decimal, System.Decimal], @param33=[Int32, System.Int32], @param34=[Decimal, System.Decimal], @param35=[Int32, System.Int32], @param36=[String, System.String], @param37=[Decimal, System.Decimal], @param38=[Decimal, System.Decimal], @param39=[String, System.String], @param40=[Int32, System.Int32], @param41=[DateTime, System.DateTime], @param42=[Decimal, System.Decimal], @param43=[Decimal, System.Decimal], @param44=[String, System.String]]
2020-07-16 15:42:34,922 [1] DEBUG - Statement Id: [DAO00019_GetDetails_TiepNhan] PreparedStatement : [select tn.TIEPNHAN_ID, tn.SOTIEPNHAN, tn.SOBHYT as SOTHE, tn.BHYTTUNGAY as NGAYHIEULUC,        tn.BHYTDENNGAY as NGAYHETHIEULUC, tn.BHYTNGAYCAP as NGAYCAP, tn.BHYTTREN3NAM as TREN3NAM, tn.KHUVUCSONG_ID,        tn.BHYTTREN5NAM as TREN5NAM,tn.NGAYMIENDONGCHITRA,tn.NOIGIOITHIEU_ID, tn.NGUOIGIOITHIEU_ID, tn.CHANDOANNGT,        tn.NOITIEPNHAN_ID, tn.DOITUONG_ID, tn.TRAITUYEN, tn.HINHTHUCDENKHAM_ID, tn.THOIGIANTIEPNHAN,        dv.DVYEUCAU_ID, dv.DICHVU_ID, dv.NOITHUCHIEN_ID as PHONGBAN_ID,        dv.NGUOITAO_ID as DV_NGUOITAO_ID, dv.NGAYTAO as DV_NGAYTAO, dv.THUTIENSAU, dv.BACSICHIDINH_ID, dv.NGUOICHIDINH_ID,        dv.NGUOICAPNHAT_ID as DV_NGUOICAPNHAT_ID, dv.NGAYCAPNHAT as DV_NGAYCAPNHAT,        vp.VIENPHI_ID, vp.KHONGTHUTIEN, vp.LOAI_CHIPHI, vp.LOAIGIA_ID as LOAIGIA,        vp.DATHUCHIEN, vp.DATHANHTOAN, vp.DONGIA_DOANHTHU,        dv.NOITHUCHIEN_ID, dv.TRANGTHAI,        vp.NGUOITAO_ID as VP_NGUOITAO_ID, vp.BHYT_DONGIA, vp.TYLE_VAT, vp.BANGGIA_ID, vp.GIAVON,        tn.NGAYTAO as TN_NGAYTAO,        vp.NGAYTAO as VP_NGAYTAO, vp.NGUOICAPNHAT_ID as VP_NGUOICAPNHAT_ID, vp.NGAYCAPNHAT as VP_NGAYCAPNHAT,        tn.SOCHUYENVIEN, tn.THOIGIANCHUYENTUYEN, tn.HINHTHUCCHUYENVIEN_ID, tn.LYDOCHUYENVIEN_ID, tn.ICDNOIGIOITHIEU_ID,        tn.SUDUNG_BHTN, tn.THE_ID, tn.LOAITHANHVIEN_ID, tn.THANHVIEN_ID, tn.VIP, tn.GHICHU_TIEPNHAN, tn.BAOLANH_VIENPHI        , tn.CONGTY_CHITRA_ID, tn.TRANGTHAI as TRANGTHAI_TIEPNHAN, tn.NGUOITAO_ID as TN_NGUOITAO_ID, tn.TINHTRANGHEN        , tn.NGUON_BENHNHAN_ID, tn.THONGTIN_KCB_BHYT, tn.LOAITIEPNHAN_ID, tn.LYDODENKHAM, vp.YEUCAUVP        , tn.TENNGUOIGIOITHIEU, tn.GIOITHIEUBENNGOAI, tn.UUTIEN, tn.KHOAHENTK, tn.NGUOINUOCNGOAI, tn.NGOAIGIO        , tn.QUANHAM_ID, tn.TINHTRANGBENHNHAN_ID        from (        select top 1 *        from TT_TIEPNHAN        where BENHVIEN_ID = '01819'                 order by                 SOTIEPNHAN desc        ) as tn        left join TT_DVYEUCAU dv on dv.TIEPNHAN_ID = tn.TIEPNHAN_ID and dv.HUYYEUCAU = '0'        left join TT_VIENPHI vp on vp.TIEPNHAN_ID = tn.TIEPNHAN_ID and vp.DICHVU_ID = dv.DICHVU_ID  and dv.DVYEUCAU_ID = vp.REF_ID]
2020-07-16 15:42:34,977 [1] DEBUG - Statement Id: [DAO00056_GetList] PreparedStatement : [select * from TM_LOAIGIA where BENHVIEN_ID = '01819']
2020-07-16 15:42:45,129 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = '01819'               AND                   TM_SYS_SCREEN.PAGE = 'RPT02'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2020-07-16 15:42:49,228 [1] DEBUG - Statement Id: [DAO00012_GetList] PreparedStatement : [select        DICTIONARY_ID,        DICTIONARY_CODE,        DICTIONARY_NAME,        ATTRIBUTE1,        ATTRIBUTE2,        DICTIONARY_NAME_EN,        DICTIONARY_TYPE_CODE        from LST_DICTIONARY        where LST_DICTIONARY.Enabled = '1'         AND           LST_DICTIONARY.DICTIONARY_TYPE_CODE = 'DM_PaperSize'                 order by LST_DICTIONARY.IDX]
2020-07-16 15:42:49,412 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = '01819'               AND                   TM_SYS_SCREEN.PAGE = 'RPT01'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2020-07-16 15:42:50,056 [1] DEBUG - Statement Id: [DAO00200_GetDetail] PreparedStatement : [select *              from TM_REPORT              where TM_REPORT.REPORT_CODE  = 'REG01P00101' AND TM_REPORT.BENHVIEN_ID = '01819']
2020-07-16 15:42:50,084 [1] DEBUG - Statement Id: [DAO00201_GetList] PreparedStatement : [select *              from TM_REPORT_DETAIL               where                             TM_REPORT_DETAIL.REPORT_CODE = 'REG01P00101'                       and                           TM_REPORT_DETAIL.BENHVIEN_ID = '01819'                                     order by PARAMETER_INDEX]
2020-07-16 15:42:50,148 [1] DEBUG - Statement Id: [DAO00203_GetList] PreparedStatement : [select *              from TM_REPORT_SUB_DEFINITION               where                             TM_REPORT_SUB_DEFINITION.REPORT_CODE = 'REG01P00101'                       and                           TM_REPORT_SUB_DEFINITION.BENHVIEN_ID = '01819'                                     order by REPORT_SUB_DEFINITION_ID]
2020-07-16 15:42:50,184 [1] DEBUG - Statement Id: [DAO00201_GetListByParentReportID] PreparedStatement : [select RD.*              from TM_REPORT AS R              INNER JOIN TM_REPORT_SUB_DEFINITION AS RS ON R.REPORT_CODE = RS.REPORT_CODE AND R.BENHVIEN_ID = RS.BENHVIEN_ID              INNER JOIN TM_REPORT_DETAIL AS RD ON RD.REPORT_CODE = RS.SUB_REPORT_CODE AND RD.BENHVIEN_ID = RS.BENHVIEN_ID              where R.REPORT_CODE  = 'REG01P00101' AND R.BENHVIEN_ID = '01819']
2020-07-16 15:42:50,219 [1] DEBUG - Statement Id: [DAO00012_GetList] PreparedStatement : [select        DICTIONARY_ID,        DICTIONARY_CODE,        DICTIONARY_NAME,        ATTRIBUTE1,        ATTRIBUTE2,        DICTIONARY_NAME_EN,        DICTIONARY_TYPE_CODE        from LST_DICTIONARY        where LST_DICTIONARY.Enabled = '1'         AND           LST_DICTIONARY.DICTIONARY_TYPE_CODE = 'DM_REPORT_DEFAULT_VALUE_TYPE'                 order by LST_DICTIONARY.IDX]
2020-07-16 15:42:50,283 [1] DEBUG - Statement Id: [DAO00203_GetListReportSubFileByReportID] PreparedStatement : [select R.*              from TM_REPORT_SUB_DEFINITION AS RS              inner join TM_REPORT AS R ON RS.SUB_REPORT_CODE = R.REPORT_CODE AND R.BENHVIEN_ID = RS.BENHVIEN_ID              where RS.REPORT_CODE = 'REG01P00101' AND RS.BENHVIEN_ID = '01819']
2020-07-16 15:42:50,336 [1] DEBUG - Statement Id: [DAO00204_GetListParameter] PreparedStatement : [SELECT SUBSTRING(p.name, 2, LEN(p.name) - 1) AS PARAMETER, p.parameter_id AS Idx, CONVERT(varchar(1),p.is_nullable) as Allow_Null              FROM sys.procedures sp              INNER JOIN sys.parameters p ON sp.object_id = p.object_id              WHERE sp.name = 'REG01P00101_PDKKB'              ORDER BY p.parameter_id]
2020-07-16 15:42:50,381 [1] DEBUG - Statement Id: [DAO00204_GetReportData] PreparedStatement : [REG01P00101_PDKKB]
2020-07-16 15:42:50,381 [1] DEBUG - Statement Id: [DAO00204_GetReportData] Parameters: [@SOTIEPNHAN=[PARAMETERS.SOTIEPNHAN,8747], @MABENHVIEN=[PARAMETERS.MABENHVIEN,01819]]
2020-07-16 15:42:50,381 [1] DEBUG - Statement Id: [DAO00204_GetReportData] Types: [@SOTIEPNHAN=[Int64, System.Int64], @MABENHVIEN=[String, System.String]]
2020-07-16 15:42:50,431 [1] DEBUG - Statement Id: [DAO00200_GetSettingReportPrinting] PreparedStatement : [SELECT DICTIONARY_CODE AS REPORT_CODE, DICTIONARY_NAME AS COMPUTER_NAME, DICTIONARY_NAME_EN AS NAME_PRINTER          FROM LST_DICTIONARY          WHERE BENHVIEN_ID = '01819' AND ENABLED = '1' AND DICTIONARY_TYPE_CODE = 'Report_Printer_Setting'          AND DICTIONARY_CODE = 'REG01P00101' AND DICTIONARY_NAME = 'DESKTOP-89GE5BA']
2020-07-16 15:43:12,330 [1] DEBUG - Statement Id: [DAO00020_ListKhoDuocOfPhongBan] PreparedStatement : [select B.* from TM_PHONGBAN_KHODUOC A        inner join TM_KHODUOC B on B.KHODUOC_ID = A.KHODUOC_ID        where        A.PHONGBAN_ID = ''        and A.BENHVIEN_ID = '01819']
2020-07-16 15:43:12,576 [1] DEBUG - Statement Id: [DAO00020_ListKhoDuocOfPhongBan] PreparedStatement : [select B.* from TM_PHONGBAN_KHODUOC A        inner join TM_KHODUOC B on B.KHODUOC_ID = A.KHODUOC_ID        where        A.PHONGBAN_ID = '97'        and A.BENHVIEN_ID = '01819']
2020-07-16 15:43:19,384 [1] DEBUG - Statement Id: [DAO00020_ListKhoDuocOfPhongBan] PreparedStatement : [select B.* from TM_PHONGBAN_KHODUOC A        inner join TM_KHODUOC B on B.KHODUOC_ID = A.KHODUOC_ID        where        A.PHONGBAN_ID = ''        and A.BENHVIEN_ID = '01819']
2020-07-16 15:43:22,608 [1] DEBUG - Statement Id: [DAO00012_GetList] PreparedStatement : [select        DICTIONARY_ID,        DICTIONARY_CODE,        DICTIONARY_NAME,        ATTRIBUTE1,        ATTRIBUTE2,        DICTIONARY_NAME_EN,        DICTIONARY_TYPE_CODE        from LST_DICTIONARY        where LST_DICTIONARY.Enabled = '1'         AND           LST_DICTIONARY.DICTIONARY_TYPE_CODE = 'PhanLoaiTiepNhan'                 order by LST_DICTIONARY.IDX]
2020-07-16 15:43:22,637 [1] DEBUG - Statement Id: [DAO00012_GetList] PreparedStatement : [select        DICTIONARY_ID,        DICTIONARY_CODE,        DICTIONARY_NAME,        ATTRIBUTE1,        ATTRIBUTE2,        DICTIONARY_NAME_EN,        DICTIONARY_TYPE_CODE        from LST_DICTIONARY        where LST_DICTIONARY.Enabled = '1'         AND           LST_DICTIONARY.DICTIONARY_TYPE_CODE = 'NguonBN'                 order by LST_DICTIONARY.IDX]
2020-07-16 15:43:22,662 [1] DEBUG - Statement Id: [DAO00019_GetListCongTyChiTra] PreparedStatement : [select *        from TM_CONGTYCHITRA        where        BENHVIEN_ID = '01819' AND TAMNGUNG = '0']
2020-07-16 15:43:22,685 [1] DEBUG - Statement Id: [DAO00019_GetQuanHam_TinhTrangBN] PreparedStatement : [select * from LST_DICTIONARY where DICTIONARY_TYPE_CODE = 'QuanHamBenhNhan' and ENABLED = '1']
2020-07-16 15:43:22,713 [1] DEBUG - Statement Id: [DAO00019_GetQuanHam_TinhTrangBN] PreparedStatement : [select * from LST_DICTIONARY where DICTIONARY_TYPE_CODE = 'TinhTrangBenhNhan' and ENABLED = '1']
2020-07-16 15:43:22,739 [1] DEBUG - Statement Id: [DAO00019_GetQuanHam_TinhTrangBN] PreparedStatement : [select * from LST_DICTIONARY where DICTIONARY_TYPE_CODE = 'DonViCongTac' and ENABLED = '1']
2020-07-16 15:43:22,900 [1] DEBUG - Statement Id: [DAO00403_QMS002_GetDSHangDoi_COMPUTERNAME] PreparedStatement : [SELECT B.ID,B.DEPARTMENT_ID,C.DEPARTMENT_NAME, C.DEPT_CODE, B.[NAME] as QUEUENAME,B.ID as QUEUE_ID     FROM QMS_QUEUE B     INNER JOIN QMS_DEPARTMENT C ON B.DEPARTMENT_ID=C.DEPARTMENT_ID     JOIN (SELECT DISTINCT XX.SECTION_ID FROM QMS_QUEUE XX JOIN QMS_CLIENT YY ON YY.QUEUE_ID = XX.ID     WHERE XX.DEPARTMENT_ID='97' AND (YY.COMPUTERNAME = 'DESKTOP-89GE5BA' OR YY.IPADDRESS = '10.15.167.38')) A ON A.SECTION_ID = B.SECTION_ID     WHERE B.BENHVIEN_ID = '01819' AND B.STATE = 1]
2020-07-16 15:43:22,966 [1] DEBUG - Statement Id: [DAO00017_GetListPhongKham] PreparedStatement : [select pb.PHONGBAN_ID, pb.TENPHONGBAN, case when dv.ATTRIBUTE5 is null then 'TT' else 'KTC' end as LOAI_CHIPHI              from [TM_PHONGBAN_DICHVU] as pb_dv              inner join [TM_PHONGBAN] as pb on pb.PHONGBAN_ID = pb_dv.PHONGBAN_ID and pb.BENHVIEN_ID = '01819'              inner join [TM_DICHVU] dv on dv.DICHVU_ID = pb_dv.DICHVU_ID and dv.MADICHVU = '' and dv.BENHVIEN_ID = '01819'              where pb_dv.BENHVIEN_ID = '01819']
2020-07-16 15:43:23,005 [1] DEBUG - Statement Id: [DAO00019_GetListPhongKham_REG13] PreparedStatement : [select pb.PHONGBAN_ID, pb.TENPHONGBAN, case when dv.ATTRIBUTE5 is null then 'TT' else 'KTC' end as LOAI_CHIPHI        from TM_PHONGBAN pb        left join TM_PHONGBAN_DICHVU pb_dv on pb_dv.PHONGBAN_ID = pb.PHONGBAN_ID and pb_dv.BENHVIEN_ID = pb.BENHVIEN_ID        left join TM_DICHVU dv on dv.DICHVU_ID = pb_dv.DICHVU_ID and dv.BENHVIEN_ID = pb_dv.BENHVIEN_ID        left join TM_NHOMDICHVU ndv on ndv.NHOMDICHVU_ID = dv.NHOMDICHVU_ID and ndv.BENHVIEN_ID = dv.BENHVIEN_ID        where pb.BENHVIEN_ID = '01819' and ndv.MANHOMDICHVU = '04' and dv.DICHVU_ID IS NOT NULL]
2020-07-16 15:43:23,065 [1] DEBUG - Statement Id: [DAO00019_LayThongTinSoluongDichVuPhongKham_REG13] PreparedStatement : [select PHONGBAN_ID, TENPHONGBAN, NOITHUCHIEN_ID, SUM(CHUAKETQUA) AS CHUAKETQUA, SUM(HOANTAT) AS HOANTAT, SUM(DANGTHUCHIEN) AS DANGTHUCHIEN        , SUM(BHYT) as BHYT, SUM(VIENPHI) as VIENPHI        from (        select B.PHONGBAN_ID, B.TENPHONGBAN, A.NOITHUCHIEN_ID,        case when A.TRANGTHAI = 'CHUAKETQUA' then 1 else 0 end AS CHUAKETQUA,        case when A.TRANGTHAI not in ('CHUAKETQUA','DANGTHUCHIEN','CHOXACNHAN') then 1 else 0 end AS HOANTAT,        case when A.TRANGTHAI = 'DANGTHUCHIEN' then 1 else 0 end AS DANGTHUCHIEN,        case when len(tn.SOBHYT) > 1 then 1 else 0 end as BHYT,        case when len(tn.SOBHYT) = 0 then 1 else 0 end as VIENPHI        from TM_PHONGBAN B        left join TT_DVYEUCAU A on A.NOITHUCHIEN_ID = B.PHONGBAN_ID and A.BENHVIEN_ID = B.BENHVIEN_ID and A.NGAYYEUCAU = CONVERT(date, getdate())        inner join TT_TIEPNHAN tn on tn.TIEPNHAN_ID = A.TIEPNHAN_ID        left join TM_DICHVU dv on A.DICHVU_ID = dv.DICHVU_ID        left join TM_NHOMDICHVU ndv on ndv.NHOMDICHVU_ID = dv.NHOMDICHVU_ID        where B.BENHVIEN_ID ='01819' and Left(ndv.MANHOMDICHVU,2) = '04'        and B.PHONGBAN_ID in (60,62,64,66,67,69,71,72,73,74,75,55,55,56,56,57,57,54,12,80,80,63,76,1002,79,70,68,53,53,14,14,14,61,1001)        ) tmp        group by tmp.NOITHUCHIEN_ID, tmp.TENPHONGBAN, tmp.PHONGBAN_ID]
2020-07-16 15:43:23,132 [1] DEBUG - Statement Id: [DAO00017_GetListPhongKham] PreparedStatement : [select pb.PHONGBAN_ID, pb.TENPHONGBAN, case when dv.ATTRIBUTE5 is null then 'TT' else 'KTC' end as LOAI_CHIPHI              from [TM_PHONGBAN_DICHVU] as pb_dv              inner join [TM_PHONGBAN] as pb on pb.PHONGBAN_ID = pb_dv.PHONGBAN_ID and pb.BENHVIEN_ID = '01819'              inner join [TM_DICHVU] dv on dv.DICHVU_ID = pb_dv.DICHVU_ID and dv.MADICHVU = '' and dv.BENHVIEN_ID = '01819'              where pb_dv.BENHVIEN_ID = '01819']
2020-07-16 15:43:23,159 [1] DEBUG - Statement Id: [DAO00019_GetListPhongKham_REG13] PreparedStatement : [select pb.PHONGBAN_ID, pb.TENPHONGBAN, case when dv.ATTRIBUTE5 is null then 'TT' else 'KTC' end as LOAI_CHIPHI        from TM_PHONGBAN pb        left join TM_PHONGBAN_DICHVU pb_dv on pb_dv.PHONGBAN_ID = pb.PHONGBAN_ID and pb_dv.BENHVIEN_ID = pb.BENHVIEN_ID        left join TM_DICHVU dv on dv.DICHVU_ID = pb_dv.DICHVU_ID and dv.BENHVIEN_ID = pb_dv.BENHVIEN_ID        left join TM_NHOMDICHVU ndv on ndv.NHOMDICHVU_ID = dv.NHOMDICHVU_ID and ndv.BENHVIEN_ID = dv.BENHVIEN_ID        where pb.BENHVIEN_ID = '01819' and ndv.MANHOMDICHVU = '04' and dv.DICHVU_ID IS NOT NULL]
2020-07-16 15:43:23,218 [1] DEBUG - Statement Id: [DAO00019_LayThongTinSoluongDichVuPhongKham_REG13] PreparedStatement : [select PHONGBAN_ID, TENPHONGBAN, NOITHUCHIEN_ID, SUM(CHUAKETQUA) AS CHUAKETQUA, SUM(HOANTAT) AS HOANTAT, SUM(DANGTHUCHIEN) AS DANGTHUCHIEN        , SUM(BHYT) as BHYT, SUM(VIENPHI) as VIENPHI        from (        select B.PHONGBAN_ID, B.TENPHONGBAN, A.NOITHUCHIEN_ID,        case when A.TRANGTHAI = 'CHUAKETQUA' then 1 else 0 end AS CHUAKETQUA,        case when A.TRANGTHAI not in ('CHUAKETQUA','DANGTHUCHIEN','CHOXACNHAN') then 1 else 0 end AS HOANTAT,        case when A.TRANGTHAI = 'DANGTHUCHIEN' then 1 else 0 end AS DANGTHUCHIEN,        case when len(tn.SOBHYT) > 1 then 1 else 0 end as BHYT,        case when len(tn.SOBHYT) = 0 then 1 else 0 end as VIENPHI        from TM_PHONGBAN B        left join TT_DVYEUCAU A on A.NOITHUCHIEN_ID = B.PHONGBAN_ID and A.BENHVIEN_ID = B.BENHVIEN_ID and A.NGAYYEUCAU = CONVERT(date, getdate())        inner join TT_TIEPNHAN tn on tn.TIEPNHAN_ID = A.TIEPNHAN_ID        left join TM_DICHVU dv on A.DICHVU_ID = dv.DICHVU_ID        left join TM_NHOMDICHVU ndv on ndv.NHOMDICHVU_ID = dv.NHOMDICHVU_ID        where B.BENHVIEN_ID ='01819' and Left(ndv.MANHOMDICHVU,2) = '04'        and B.PHONGBAN_ID in (60,62,64,66,67,69,71,72,73,74,75,55,55,56,56,57,57,54,12,80,80,63,76,1002,79,70,68,53,53,14,14,14,61,1001)        ) tmp        group by tmp.NOITHUCHIEN_ID, tmp.TENPHONGBAN, tmp.PHONGBAN_ID]
2020-07-16 15:43:23,304 [1] DEBUG - Statement Id: [DAO00403_QMS002_GetThongTinClient] PreparedStatement : [SELECT B.ID as QUEUE_ID, B.NAME AS QUEUE_NAME,A.ID AS CLIENT_ID , A.[NAME] AS CLIENT_NAME, ISNULL(A.[STATE],1) AS [STATE],(CASE C.NAME WHEN 'UT' THEN 1 ELSE 0 END) AS QUEUETYPE     , B.DEPARTMENT_ID,ISNULL(B.SECTION_ID,-1) AS SECTION_ID,A.IPSERVER,A.NAMEAUDIO,C.QUEUE_TYPE_CODE,C.QUEUE_TYPE_CODE_SOUND,S.[NAME] AS SECTIONNAME     FROM QMS_QUEUE B LEFT JOIN QMS_CLIENT A ON A.QUEUE_ID = B.ID     LEFT JOIN QMS_QUEUE_TYPE C ON B.QUEUETYPE_ID = C.ID     LEFT JOIN QMS_SECTION S ON B.SECTION_ID=S.ID     WHERE     (A.COMPUTERNAME = 'DESKTOP-89GE5BA' OR A.IPADDRESS = '10.15.167.38') AND A.[STATE] = 1 AND B.DEPARTMENT_ID='97'            AND B.BENHVIEN_ID = '01819']
2020-07-16 15:43:24,718 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = '01819'               AND                   TM_SYS_SCREEN.PAGE = 'REG09'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2020-07-16 15:43:24,913 [1] DEBUG - Statement Id: [DAO00019_GetCountListLichHen] PreparedStatement : [select COUNT(*) as TOTALROWS        from        (        select A.BENHNHAN_ID, A.DICHVU_ID, A.NOITHUCHIEN_ID, A.THOIGIANHEN_BATDAU as NGAYHEN, A.THOIGIANHEN_BATDAU as THOIGIANHEN, A.NGAYTAO AS NGAYTAOCUOCHEN,        'TT_LICHHEN' as REF_TABLE, 'LICHHEN_ID' as REF_COL, A.LICHHEN_ID as ID        from TT_LICHHEN A        INNER JOIN LST_DICTIONARY AS DIC ON DIC.DICTIONARY_ID = A.TRANGTHAI_ID AND DIC.DICTIONARY_TYPE_CODE = 'TrangThaiLichHen'        left join TT_BENHNHAN B on B.BENHNHAN_ID = A.BENHNHAN_ID        left join TM_DICHVU C on A.DICHVU_ID = C.DICHVU_ID and C.BENHVIEN_ID = '01819'        left join TM_PHONGBAN D on D.PHONGBAN_ID = A.NOITHUCHIEN_ID and D.BENHVIEN_ID = '01819'        where (A.DATIEPNHAN is null or A.DATIEPNHAN = '0') and A.BENHVIEN_ID = '01819'        and (DIC.DICTIONARY_CODE = 'MOI' or (DIC.DICTIONARY_CODE = 'DOI' and A.LICHHEN_PREV IS NOT NULL))         and           CONVERT (DATE, A.THOIGIANHEN_BATDAU) >= '7/16/2020 12:00:00 AM'         and           CONVERT (DATE, A.THOIGIANHEN_BATDAU) <= '7/23/2020 12:00:00 AM'                 ) lh]
2020-07-16 15:43:24,968 [1] DEBUG - Statement Id: [DAO00019_GetListLichHen] PreparedStatement : [select * from        (SELECT ROW_NUMBER() OVER(order by lh.NGAYHEN) as ROWNUMBER, *        from        (        select A.BENHNHAN_ID, A.DICHVU_ID, A.NOITHUCHIEN_ID, A.THOIGIANHEN_BATDAU as NGAYHEN, A.THOIGIANHEN_BATDAU as THOIGIANHEN, A.NGAYTAO AS NGAYTAOCUOCHEN,        'TT_LICHHEN' as REF_TABLE, 'LICHHEN_ID' as REF_COL, A.LICHHEN_ID as LICHHEN_ID, B.TENBENHNHAN, B.MAYTE, C.TENDICHVU, D.TENPHONGBAN, C.MADICHVU, 0 as TAIKHAM        , (ISNULL(B.MAYTE,N'Chưa có mã') + ' - ' + ISNULL(B.TENBENHNHAN,A.TENBENHNHAN)) AS CODE_TENBENHNHAN        , A.TENBENHNHAN AS TENBENHNHANHEN        from TT_LICHHEN A        INNER JOIN LST_DICTIONARY AS DIC ON DIC.DICTIONARY_ID = A.TRANGTHAI_ID AND DIC.DICTIONARY_TYPE_CODE = 'TrangThaiLichHen'        left join TT_BENHNHAN B on B.BENHNHAN_ID = A.BENHNHAN_ID        left join TM_DICHVU C on A.DICHVU_ID = C.DICHVU_ID and C.BENHVIEN_ID = '01819'        left join TM_PHONGBAN D on D.PHONGBAN_ID = A.NOITHUCHIEN_ID and D.BENHVIEN_ID = '01819'        where (A.DATIEPNHAN is null or A.DATIEPNHAN = '0') and A.BENHVIEN_ID = '01819'        and (DIC.DICTIONARY_CODE = 'MOI' or (DIC.DICTIONARY_CODE = 'DOI' and A.LICHHEN_PREV IS NULL))         and           CONVERT (DATE, A.THOIGIANHEN_BATDAU) >= '7/16/2020 12:00:00 AM'         and           CONVERT (DATE, A.THOIGIANHEN_BATDAU) <= '7/23/2020 12:00:00 AM'                 ) lh        ) lst                    where          lst.ROWNUMBER between 1 and 19                 order by lst.NGAYHEN asc]
2020-07-16 15:43:28,410 [1] DEBUG - Statement Id: [DAO00012_GetList] PreparedStatement : [select        DICTIONARY_ID,        DICTIONARY_CODE,        DICTIONARY_NAME,        ATTRIBUTE1,        ATTRIBUTE2,        DICTIONARY_NAME_EN,        DICTIONARY_TYPE_CODE        from LST_DICTIONARY        where LST_DICTIONARY.Enabled = '1'         AND           LST_DICTIONARY.DICTIONARY_TYPE_CODE = 'PhanLoaiTiepNhan'                 order by LST_DICTIONARY.IDX]
2020-07-16 15:43:28,437 [1] DEBUG - Statement Id: [DAO00012_GetList] PreparedStatement : [select        DICTIONARY_ID,        DICTIONARY_CODE,        DICTIONARY_NAME,        ATTRIBUTE1,        ATTRIBUTE2,        DICTIONARY_NAME_EN,        DICTIONARY_TYPE_CODE        from LST_DICTIONARY        where LST_DICTIONARY.Enabled = '1'         AND           LST_DICTIONARY.DICTIONARY_TYPE_CODE = 'NguonBN'                 order by LST_DICTIONARY.IDX]
2020-07-16 15:43:28,462 [1] DEBUG - Statement Id: [DAO00019_GetListCongTyChiTra] PreparedStatement : [select *        from TM_CONGTYCHITRA        where        BENHVIEN_ID = '01819' AND TAMNGUNG = '0']
2020-07-16 15:43:28,486 [1] DEBUG - Statement Id: [DAO00019_GetQuanHam_TinhTrangBN] PreparedStatement : [select * from LST_DICTIONARY where DICTIONARY_TYPE_CODE = 'QuanHamBenhNhan' and ENABLED = '1']
2020-07-16 15:43:28,516 [1] DEBUG - Statement Id: [DAO00019_GetQuanHam_TinhTrangBN] PreparedStatement : [select * from LST_DICTIONARY where DICTIONARY_TYPE_CODE = 'TinhTrangBenhNhan' and ENABLED = '1']
2020-07-16 15:43:28,545 [1] DEBUG - Statement Id: [DAO00019_GetQuanHam_TinhTrangBN] PreparedStatement : [select * from LST_DICTIONARY where DICTIONARY_TYPE_CODE = 'DonViCongTac' and ENABLED = '1']
2020-07-16 15:43:28,693 [1] DEBUG - Statement Id: [DAO00403_QMS002_GetDSHangDoi_COMPUTERNAME] PreparedStatement : [SELECT B.ID,B.DEPARTMENT_ID,C.DEPARTMENT_NAME, C.DEPT_CODE, B.[NAME] as QUEUENAME,B.ID as QUEUE_ID     FROM QMS_QUEUE B     INNER JOIN QMS_DEPARTMENT C ON B.DEPARTMENT_ID=C.DEPARTMENT_ID     JOIN (SELECT DISTINCT XX.SECTION_ID FROM QMS_QUEUE XX JOIN QMS_CLIENT YY ON YY.QUEUE_ID = XX.ID     WHERE XX.DEPARTMENT_ID='97' AND (YY.COMPUTERNAME = 'DESKTOP-89GE5BA' OR YY.IPADDRESS = '10.15.167.38')) A ON A.SECTION_ID = B.SECTION_ID     WHERE B.BENHVIEN_ID = '01819' AND B.STATE = 1]
2020-07-16 15:43:28,763 [1] DEBUG - Statement Id: [DAO00017_GetListPhongKham] PreparedStatement : [select pb.PHONGBAN_ID, pb.TENPHONGBAN, case when dv.ATTRIBUTE5 is null then 'TT' else 'KTC' end as LOAI_CHIPHI              from [TM_PHONGBAN_DICHVU] as pb_dv              inner join [TM_PHONGBAN] as pb on pb.PHONGBAN_ID = pb_dv.PHONGBAN_ID and pb.BENHVIEN_ID = '01819'              inner join [TM_DICHVU] dv on dv.DICHVU_ID = pb_dv.DICHVU_ID and dv.MADICHVU = '' and dv.BENHVIEN_ID = '01819'              where pb_dv.BENHVIEN_ID = '01819']
2020-07-16 15:43:28,791 [1] DEBUG - Statement Id: [DAO00019_GetListPhongKham_REG13] PreparedStatement : [select pb.PHONGBAN_ID, pb.TENPHONGBAN, case when dv.ATTRIBUTE5 is null then 'TT' else 'KTC' end as LOAI_CHIPHI        from TM_PHONGBAN pb        left join TM_PHONGBAN_DICHVU pb_dv on pb_dv.PHONGBAN_ID = pb.PHONGBAN_ID and pb_dv.BENHVIEN_ID = pb.BENHVIEN_ID        left join TM_DICHVU dv on dv.DICHVU_ID = pb_dv.DICHVU_ID and dv.BENHVIEN_ID = pb_dv.BENHVIEN_ID        left join TM_NHOMDICHVU ndv on ndv.NHOMDICHVU_ID = dv.NHOMDICHVU_ID and ndv.BENHVIEN_ID = dv.BENHVIEN_ID        where pb.BENHVIEN_ID = '01819' and ndv.MANHOMDICHVU = '04' and dv.DICHVU_ID IS NOT NULL]
2020-07-16 15:43:28,855 [1] DEBUG - Statement Id: [DAO00019_LayThongTinSoluongDichVuPhongKham_REG13] PreparedStatement : [select PHONGBAN_ID, TENPHONGBAN, NOITHUCHIEN_ID, SUM(CHUAKETQUA) AS CHUAKETQUA, SUM(HOANTAT) AS HOANTAT, SUM(DANGTHUCHIEN) AS DANGTHUCHIEN        , SUM(BHYT) as BHYT, SUM(VIENPHI) as VIENPHI        from (        select B.PHONGBAN_ID, B.TENPHONGBAN, A.NOITHUCHIEN_ID,        case when A.TRANGTHAI = 'CHUAKETQUA' then 1 else 0 end AS CHUAKETQUA,        case when A.TRANGTHAI not in ('CHUAKETQUA','DANGTHUCHIEN','CHOXACNHAN') then 1 else 0 end AS HOANTAT,        case when A.TRANGTHAI = 'DANGTHUCHIEN' then 1 else 0 end AS DANGTHUCHIEN,        case when len(tn.SOBHYT) > 1 then 1 else 0 end as BHYT,        case when len(tn.SOBHYT) = 0 then 1 else 0 end as VIENPHI        from TM_PHONGBAN B        left join TT_DVYEUCAU A on A.NOITHUCHIEN_ID = B.PHONGBAN_ID and A.BENHVIEN_ID = B.BENHVIEN_ID and A.NGAYYEUCAU = CONVERT(date, getdate())        inner join TT_TIEPNHAN tn on tn.TIEPNHAN_ID = A.TIEPNHAN_ID        left join TM_DICHVU dv on A.DICHVU_ID = dv.DICHVU_ID        left join TM_NHOMDICHVU ndv on ndv.NHOMDICHVU_ID = dv.NHOMDICHVU_ID        where B.BENHVIEN_ID ='01819' and Left(ndv.MANHOMDICHVU,2) = '04'        and B.PHONGBAN_ID in (60,62,64,66,67,69,71,72,73,74,75,55,55,56,56,57,57,54,12,80,80,63,76,1002,79,70,68,53,53,14,14,14,61,1001)        ) tmp        group by tmp.NOITHUCHIEN_ID, tmp.TENPHONGBAN, tmp.PHONGBAN_ID]
2020-07-16 15:43:28,916 [1] DEBUG - Statement Id: [DAO00403_QMS002_GetThongTinClient] PreparedStatement : [SELECT B.ID as QUEUE_ID, B.NAME AS QUEUE_NAME,A.ID AS CLIENT_ID , A.[NAME] AS CLIENT_NAME, ISNULL(A.[STATE],1) AS [STATE],(CASE C.NAME WHEN 'UT' THEN 1 ELSE 0 END) AS QUEUETYPE     , B.DEPARTMENT_ID,ISNULL(B.SECTION_ID,-1) AS SECTION_ID,A.IPSERVER,A.NAMEAUDIO,C.QUEUE_TYPE_CODE,C.QUEUE_TYPE_CODE_SOUND,S.[NAME] AS SECTIONNAME     FROM QMS_QUEUE B LEFT JOIN QMS_CLIENT A ON A.QUEUE_ID = B.ID     LEFT JOIN QMS_QUEUE_TYPE C ON B.QUEUETYPE_ID = C.ID     LEFT JOIN QMS_SECTION S ON B.SECTION_ID=S.ID     WHERE     (A.COMPUTERNAME = 'DESKTOP-89GE5BA' OR A.IPADDRESS = '10.15.167.38') AND A.[STATE] = 1 AND B.DEPARTMENT_ID='97'            AND B.BENHVIEN_ID = '01819']
2020-07-16 15:43:31,177 [1] DEBUG - Statement Id: [DAO00019_GetTotalLichSuTiepNhan] PreparedStatement : [select count(*)        from (        select T.*        from TT_TIEPNHAN AS T        where        T.BENHVIEN_ID = '01819'         and           convert(date, T.NGAYTIEPNHAN) >= '7/16/2020 3:43:31 PM'         and           convert(date, T.NGAYTIEPNHAN) <= '7/16/2020 3:43:31 PM'                 ) as tn        inner join (select A.*, B.DESCRIPTION from TT_BENHNHAN A        left join TM_GENDER B on B.ID = A.GIOITINH) as bn on tn.BENHNHAN_ID = bn.BENHNHAN_ID                 where tn.BENHVIEN_ID = '01819']
2020-07-16 15:43:31,263 [1] DEBUG - Statement Id: [DAO00019_GetLichSuTiepNhan] PreparedStatement : [select * from (        select ROW_NUMBER() OVER(ORDER BY tn.THOIGIANTIEPNHAN desc) AS ROWNUMBER, tn.*, bn.MAYTE,        bn.TENBENHNHAN, isnull(convert(varchar, NGAYSINH, 103), convert(varchar, NAMSINH)) as NGAYSINH,        bn.DESCRIPTION as GIOITINH, isnull(bn.DIACHILIENLAC,bn.DIACHITHUONGTRU) as DIACHILIENLAC        from (        select T.*, LOAIBENHAN = CASE ISNULL(NB.LOAIBENHAN,ISNULL(NN.LOAIBENHAN,0)) WHEN 0 THEN '' WHEN 2 THEN 'DTNT' WHEN 1 THEN 'CC' ELSE 'NT' END        , DT.TENDOITUONG, NV.TENNHANVIEN        from TT_TIEPNHAN AS T        left join TT_NOITRU_NHAPVIEN AS NN ON NN.TIEPNHAN_ID = T.TIEPNHAN_ID        left join TT_NOITRU_BENHAN AS NB ON NB.BENHAN_ID = (SELECT TOP 1 BENHAN_ID FROM TT_NOITRU_BENHAN WHERE TIEPNHAN_ID = T.TIEPNHAN_ID ORDER BY BENHAN_ID DESC)        left join TM_DOITUONG AS DT ON DT.DOITUONG_ID = T.DOITUONG_ID        left join TM_NHANVIEN AS NV ON NV.NHANVIEN_ID = T.NGUOITAO_ID        where        T.BENHVIEN_ID = '01819'         and           convert(date, T.NGAYTIEPNHAN) >= '7/16/2020 3:43:31 PM'         and           convert(date, T.NGAYTIEPNHAN) <= '7/16/2020 3:43:31 PM'                 ) as tn        inner join (select A.*, B.DESCRIPTION from TT_BENHNHAN A        left join TM_GENDER B on B.ID = A.GIOITINH) as bn on tn.BENHNHAN_ID = bn.BENHNHAN_ID                 ) as tn        where (tn.RowNumber between 1 and 17) and tn.BENHVIEN_ID = '01819'        order by tn.THOIGIANTIEPNHAN desc]
2020-07-16 15:43:32,651 [1] DEBUG - Statement Id: [DAO00013_GetListBenhNhan] PreparedStatement : [select B.*, isnull(convert(varchar, B.NGAYSINH, 103), convert(varchar, B.NAMSINH)) as NGAYTHANGNAMSINH             from TT_BENHNHAN AS B               where                 B.MAYTE = '200001812'                     order by B.BENHNHAN_ID]
2020-07-16 15:43:32,685 [1] DEBUG - Statement Id: [DAO00095_GetListNguoiLienHe] PreparedStatement : [SELECT BNN.*, D.DICTIONARY_NAME AS TENQUANHE          FROM TT_BENHNHAN AS BN          INNER JOIN TT_BENHNHAN_NGUOILIENHE AS BNN ON BNN.BENHNHAN_ID = BN.BENHNHAN_ID          LEFT JOIN LST_DICTIONARY AS D ON D.DICTIONARY_ID = BNN.QUANHE_ID AND D.DICTIONARY_TYPE_CODE = 'QuanHeGiaDinh'          WHERE BN.MAYTE = '200001812' AND BN.ACTIVE = '1' AND BN.BENHVIEN_ID = '01819']
2020-07-16 15:43:32,730 [1] DEBUG - Statement Id: [DAO00095_GetListBenhNhan] PreparedStatement : [select B.*, isnull(convert(varchar, B.NGAYSINH, 103), convert(varchar, B.NAMSINH)) as NGAYTHANGNAMSINH                        ,T.TIEPNHAN_ID AS TIEPNHAN_ID_L, T.SOBHYT AS SOTHE_L, T.BHYTTUNGAY AS NGAYHIEULUC_L, T.BHYTDENNGAY AS NGAYHETHIEULUC_L, T.KHUVUCSONG_ID AS KHUVUCSONG_ID_L            , T.NGAYMIENDONGCHITRA AS NGAYMIENDONGCHITRA_L, T.BHYTTREN5NAM AS TREN5NAM_L, T.TRAITUYEN AS TRAITUYEN_L                     from TT_BENHNHAN AS B                        left join TT_TIEPNHAN AS T ON T.TIEPNHAN_ID =            (SELECT TOP 1 TIEPNHAN_ID FROM TT_TIEPNHAN WHERE BENHNHAN_ID = B.BENHNHAN_ID ORDER BY THOIGIANTIEPNHAN DESC)           where                   B.MAYTE = '200001812'                         order by B.BENHNHAN_ID]
2020-07-16 15:43:32,832 [1] DEBUG - Statement Id: [DAO00019_LaySoTienCongNo] PreparedStatement : [select SOTIEN        from TT_BENHNHAN_CONGNO        where        MAYTE = '200001812'        and BENHVIEN_ID = '01819'        and ACTIVE = '1']
2020-07-16 15:43:32,858 [1] DEBUG - Statement Id: [DAO00019_GetDSTiepNhanByBenhNhan] PreparedStatement : [SELECT T.*, NN.SOBENHAN AS SOBENHAN_DTNT        FROM TT_TIEPNHAN AS T        LEFT JOIN TT_NOITRU_NHAPVIEN AS NN ON NN.TIEPNHAN_ID = T.TIEPNHAN_ID AND NN.LOAIBENHAN = '2'        WHERE T.BENHNHAN_ID = '8731' AND T.BENHVIEN_ID = '01819' AND T.TRANGTHAI != 'HOANTHANH'        AND (NN.NHAPVIEN_ID IS NULL AND convert(date, T.NGAYTAO) = convert(date, '7/16/2020 3:43:32 PM')        OR NN.NHAPVIEN_ID IS NOT NULL)        ORDER BY NN.SOBENHAN]
2020-07-16 15:43:32,907 [1] DEBUG - Statement Id: [DAO00019_GetDetails_TiepNhan] PreparedStatement : [select tn.TIEPNHAN_ID, tn.SOTIEPNHAN, tn.SOBHYT as SOTHE, tn.BHYTTUNGAY as NGAYHIEULUC,        tn.BHYTDENNGAY as NGAYHETHIEULUC, tn.BHYTNGAYCAP as NGAYCAP, tn.BHYTTREN3NAM as TREN3NAM, tn.KHUVUCSONG_ID,        tn.BHYTTREN5NAM as TREN5NAM,tn.NGAYMIENDONGCHITRA,tn.NOIGIOITHIEU_ID, tn.NGUOIGIOITHIEU_ID, tn.CHANDOANNGT,        tn.NOITIEPNHAN_ID, tn.DOITUONG_ID, tn.TRAITUYEN, tn.HINHTHUCDENKHAM_ID, tn.THOIGIANTIEPNHAN,        dv.DVYEUCAU_ID, dv.DICHVU_ID, dv.NOITHUCHIEN_ID as PHONGBAN_ID,        dv.NGUOITAO_ID as DV_NGUOITAO_ID, dv.NGAYTAO as DV_NGAYTAO, dv.THUTIENSAU, dv.BACSICHIDINH_ID, dv.NGUOICHIDINH_ID,        dv.NGUOICAPNHAT_ID as DV_NGUOICAPNHAT_ID, dv.NGAYCAPNHAT as DV_NGAYCAPNHAT,        vp.VIENPHI_ID, vp.KHONGTHUTIEN, vp.LOAI_CHIPHI, vp.LOAIGIA_ID as LOAIGIA,        vp.DATHUCHIEN, vp.DATHANHTOAN, vp.DONGIA_DOANHTHU,        dv.NOITHUCHIEN_ID, dv.TRANGTHAI,        vp.NGUOITAO_ID as VP_NGUOITAO_ID, vp.BHYT_DONGIA, vp.TYLE_VAT, vp.BANGGIA_ID, vp.GIAVON,        tn.NGAYTAO as TN_NGAYTAO,        vp.NGAYTAO as VP_NGAYTAO, vp.NGUOICAPNHAT_ID as VP_NGUOICAPNHAT_ID, vp.NGAYCAPNHAT as VP_NGAYCAPNHAT,        tn.SOCHUYENVIEN, tn.THOIGIANCHUYENTUYEN, tn.HINHTHUCCHUYENVIEN_ID, tn.LYDOCHUYENVIEN_ID, tn.ICDNOIGIOITHIEU_ID,        tn.SUDUNG_BHTN, tn.THE_ID, tn.LOAITHANHVIEN_ID, tn.THANHVIEN_ID, tn.VIP, tn.GHICHU_TIEPNHAN, tn.BAOLANH_VIENPHI        , tn.CONGTY_CHITRA_ID, tn.TRANGTHAI as TRANGTHAI_TIEPNHAN, tn.NGUOITAO_ID as TN_NGUOITAO_ID, tn.TINHTRANGHEN        , tn.NGUON_BENHNHAN_ID, tn.THONGTIN_KCB_BHYT, tn.LOAITIEPNHAN_ID, tn.LYDODENKHAM, vp.YEUCAUVP        , tn.TENNGUOIGIOITHIEU, tn.GIOITHIEUBENNGOAI, tn.UUTIEN, tn.KHOAHENTK, tn.NGUOINUOCNGOAI, tn.NGOAIGIO        , tn.QUANHAM_ID, tn.TINHTRANGBENHNHAN_ID        from (        select top 1 *        from TT_TIEPNHAN        where BENHVIEN_ID = '01819'         and           TIEPNHAN_ID = '8747'                   order by                 SOTIEPNHAN desc        ) as tn        left join TT_DVYEUCAU dv on dv.TIEPNHAN_ID = tn.TIEPNHAN_ID and dv.HUYYEUCAU = '0'        left join TT_VIENPHI vp on vp.TIEPNHAN_ID = tn.TIEPNHAN_ID and vp.DICHVU_ID = dv.DICHVU_ID  and dv.DVYEUCAU_ID = vp.REF_ID]
2020-07-16 15:43:32,961 [1] DEBUG - Statement Id: [DAO00019_GetTiepNhanMienGiamCLSThucHien] PreparedStatement : [select TIEPNHAN_ID from TT_MIENGIAM where TIEPNHAN_ID ='8747';]
2020-07-16 15:43:32,988 [1] DEBUG - Statement Id: [DAO00019_GetTiepNhanMienGiamCLSThucHien01] PreparedStatement : [select TIEPNHAN_ID from TT_DVYEUCAU where TIEPNHAN_ID ='8747' and TRANGTHAI != 'CHUAKETQUA']
2020-07-16 15:43:33,017 [1] DEBUG - Statement Id: [DAO00060_KiemtrabenhnhanCapcuuNoitruDaKhoaBenhAn] PreparedStatement : [select A.* , C.TRANGTHAI as STATUS, C.SOTIEPNHAN, A.ICD_BENHCHINH as ICD_NHAPVIEN              from TT_NOITRU_BENHAN A              inner join TT_TIEPNHAN C on C.TIEPNHAN_ID = A.TIEPNHAN_ID and convert(date, C.NGAYTAO) = convert(date, getdate())              inner join TT_BENHNHAN B on A.BENHNHAN_ID = B.BENHNHAN_ID and B.ACTIVE = '1' and B.MAYTE = '200001812'              where A.TRANGTHAI = 'DAKHOA' and A.BENHVIEN_ID = '01819']
2020-07-16 15:43:33,085 [1] DEBUG - Statement Id: [DAO00060_KiemtrabenhnhanCapcuuNoitru] PreparedStatement : [select A.* , C.TRANGTHAI as STATUS, C.SOTIEPNHAN, A.ICD_BENHCHINH as ICD_NHAPVIEN, C.SOBHYT, C.BHYTTUNGAY, C.BHYTDENNGAY              from TT_NOITRU_BENHAN A              inner join TT_TIEPNHAN C on C.TIEPNHAN_ID = A.TIEPNHAN_ID              inner join TT_BENHNHAN B on A.BENHNHAN_ID = B.BENHNHAN_ID and B.ACTIVE = '1' and B.MAYTE = '200001812'              where (A.TRANGTHAI = 'DANGDIEUTRI' OR A.TRANGTHAI = 'DAXUATVIEN' OR A.TRANGTHAI = 'DATHANHTOAN') and A.BENHVIEN_ID = '01819'               and                   A.TIEPNHAN_ID = '8747']
2020-07-16 15:43:33,136 [1] DEBUG - Statement Id: [DAO00014_GetTTNhapVien] PreparedStatement : [select *        from TT_NOITRU_NHAPVIEN        where TIEPNHAN_ID  = '8747']
2020-07-16 15:43:33,164 [1] DEBUG - Statement Id: [DAO00019_GetBenhNhanThanhVien] PreparedStatement : [select A.*, B.TENTHETHANHVIEN, convert(varchar, A.NGAYHIEULUC, 103) as NGAYHIEULUCTHE, B.SOTIEN        from TT_CSKH_THANHVIEN_CAPTHE A        left join TM_CSKH_THETHANHVIEN B on B.THETHANHVIEN_ID = A.THETHANHVIEN_ID        where   THANHVIEN_ID in (        select THANHVIEN_ID from TT_CSKH_THANHVIEN        where (BENHNHAN_ID = '8731' and TAMNGUNG is null or TAMNGUNG = '0')        and (DAXOA is null or DAXOA = '0'))        and A.KICHHOAT = '1' and (A.TAMNGUNG = '0' or A.TAMNGUNG is null)                 and A.BENHVIEN_ID = '01819'        order by THE_ID desc]
2020-07-16 15:43:33,204 [1] DEBUG - Statement Id: [DAO00095_Search_LichSuKhamChuaBenh] PreparedStatement : [select KB.THOIGIANKHAM, DV.TENDICHVU AS NOIDUNG, PB.TENPHONGBAN AS TENPHONGKHAM, NV.TENNHANVIEN AS TENBACSIKHAM,          KB.CHANDOANKHOAKHAM AS CHANDOAN, TN.SOBHYT          from TT_BENHNHAN BN          inner join TT_TIEPNHAN TN on TN.BENHNHAN_ID = BN.BENHNHAN_ID and TN.BENHVIEN_ID = BN.BENHVIEN_ID          inner join TT_NGOAITRU_KHAMBENH KB on KB.TIEPNHAN_ID = TN.TIEPNHAN_ID and KB.BENHVIEN_ID = TN.BENHVIEN_ID          left join TM_DICHVU DV on DV.DICHVU_ID = KB.DICHVU_ID and DV.BENHVIEN_ID = KB.BENHVIEN_ID          left join TM_PHONGBAN PB on PB.PHONGBAN_ID = KB.PHONGBAN_ID and PB.BENHVIEN_ID = KB.BENHVIEN_ID          left join TM_NHANVIEN NV on NV.NHANVIEN_ID = KB.BACSIKHAM_ID and NV.BENHVIEN_ID = KB.BENHVIEN_ID          where BN.BENHNHAN_ID = 8731          and BN.BENHVIEN_ID = '01819'          order by KB.THOIGIANKHAM]
2020-07-16 15:43:34,862 [1] DEBUG - Statement Id: [DAO00019_GetLoaiGiaLoaiKhachHang] PreparedStatement : [select A.*, B.DICTIONARY_CODE MAKHACHHANG, C.TENLOAIGIA        from TM_NGUONKHACHHANG_LOAIGIA A        left join LST_DICTIONARY B on A.NGUONKHACHHANG_BENHNHAN_ID = B.DICTIONARY_ID        inner join TM_LOAIGIA C on C.LOAIGIA_ID = A.LOAIGIA_ID and CAPTREN_ID  = (select LOAIGIA_ID from TM_LOAIGIA where MALOAIGIA = 'GiaDichVu')        left join TM_DICHVU_DONGIA dvdg on dvdg.LOAIGIA_ID = A.LOAIGIA_ID        where B.DICTIONARY_TYPE_CODE = 'NguonKhachHang' and dvdg.DICHVU_ID  =  @param0]
2020-07-16 15:43:34,862 [1] DEBUG - Statement Id: [DAO00019_GetLoaiGiaLoaiKhachHang] Parameters: [@param0=[DICHVU_ID,3]]
2020-07-16 15:43:34,862 [1] DEBUG - Statement Id: [DAO00019_GetLoaiGiaLoaiKhachHang] Types: [@param0=[Int64, System.Int64]]
2020-07-16 15:43:34,889 [1] DEBUG - Statement Id: [DAO00017_GetLoaiGiaDoiTuongDichVu] PreparedStatement : [select a.LOAIGIA_ID, a.TENLOAIGIA, a.MALOAIGIA, a.CAPTREN_ID, MIN(a.UUTIEN_NGUON) AS UUTIEN_NGUON          , MAX(a.DOUUTIEN) AS DOUUTIEN, MIN(ISNULL(a.GIAHOTRO,0)) AS GIAHOTRO          from(                        select distinct A.LOAIGIA_ID, C.TENLOAIGIA, C.MALOAIGIA, 0 as UUTIEN_NGUON, isnull(B.DOUUTIEN,0) as DOUUTIEN, B.GIAHOTRO, C.CAPTREN_ID            from TM_DOITUONG_GIADICHVU A            left join TM_DOITUONG_LOAIGIA B on A.LOAIGIA_ID = B.LOAIGIA_ID and A.DOITUONG_ID = B.DOITUONG_ID and B.BENHVIEN_ID = '01819'            inner join TM_LOAIGIA C on A.LOAIGIA_ID = C.LOAIGIA_ID and C.BENHVIEN_ID = '01819'            where A.DOITUONG_ID = '1'                            and A.DICHVU_ID = '3'                         and A.BENHVIEN_ID = '01819'                     ) a          where a.DOUUTIEN != 0 and a.DOUUTIEN is not null          group by a.LOAIGIA_ID, a.TENLOAIGIA, a.MALOAIGIA, a.CAPTREN_ID          order by MAX(a.UUTIEN_NGUON) desc ,MAX(a.DOUUTIEN) asc]
2020-07-16 15:43:34,927 [1] DEBUG - Statement Id: [DAO00017_GetListPhongKham] PreparedStatement : [select pb.PHONGBAN_ID, pb.TENPHONGBAN, case when dv.ATTRIBUTE5 is null then 'TT' else 'KTC' end as LOAI_CHIPHI              from [TM_PHONGBAN_DICHVU] as pb_dv              inner join [TM_PHONGBAN] as pb on pb.PHONGBAN_ID = pb_dv.PHONGBAN_ID and pb.BENHVIEN_ID = '01819'              inner join [TM_DICHVU] dv on dv.DICHVU_ID = pb_dv.DICHVU_ID and dv.MADICHVU = '0003' and dv.BENHVIEN_ID = '01819'              where pb_dv.BENHVIEN_ID = '01819']
2020-07-16 15:43:34,971 [1] DEBUG - Statement Id: [DAO00019_GetListPhongKham_REG13] PreparedStatement : [select pb.PHONGBAN_ID, pb.TENPHONGBAN, case when dv.ATTRIBUTE5 is null then 'TT' else 'KTC' end as LOAI_CHIPHI        from TM_PHONGBAN pb        left join TM_PHONGBAN_DICHVU pb_dv on pb_dv.PHONGBAN_ID = pb.PHONGBAN_ID and pb_dv.BENHVIEN_ID = pb.BENHVIEN_ID        left join TM_DICHVU dv on dv.DICHVU_ID = pb_dv.DICHVU_ID and dv.BENHVIEN_ID = pb_dv.BENHVIEN_ID        left join TM_NHOMDICHVU ndv on ndv.NHOMDICHVU_ID = dv.NHOMDICHVU_ID and ndv.BENHVIEN_ID = dv.BENHVIEN_ID        where pb.BENHVIEN_ID = '01819' and ndv.MANHOMDICHVU = '04' and dv.DICHVU_ID IS NOT NULL]
2020-07-16 15:43:35,045 [1] DEBUG - Statement Id: [DAO00019_LayThongTinSoluongDichVuPhongKham_REG13] PreparedStatement : [select PHONGBAN_ID, TENPHONGBAN, NOITHUCHIEN_ID, SUM(CHUAKETQUA) AS CHUAKETQUA, SUM(HOANTAT) AS HOANTAT, SUM(DANGTHUCHIEN) AS DANGTHUCHIEN        , SUM(BHYT) as BHYT, SUM(VIENPHI) as VIENPHI        from (        select B.PHONGBAN_ID, B.TENPHONGBAN, A.NOITHUCHIEN_ID,        case when A.TRANGTHAI = 'CHUAKETQUA' then 1 else 0 end AS CHUAKETQUA,        case when A.TRANGTHAI not in ('CHUAKETQUA','DANGTHUCHIEN','CHOXACNHAN') then 1 else 0 end AS HOANTAT,        case when A.TRANGTHAI = 'DANGTHUCHIEN' then 1 else 0 end AS DANGTHUCHIEN,        case when len(tn.SOBHYT) > 1 then 1 else 0 end as BHYT,        case when len(tn.SOBHYT) = 0 then 1 else 0 end as VIENPHI        from TM_PHONGBAN B        left join TT_DVYEUCAU A on A.NOITHUCHIEN_ID = B.PHONGBAN_ID and A.BENHVIEN_ID = B.BENHVIEN_ID and A.NGAYYEUCAU = CONVERT(date, getdate())        inner join TT_TIEPNHAN tn on tn.TIEPNHAN_ID = A.TIEPNHAN_ID        left join TM_DICHVU dv on A.DICHVU_ID = dv.DICHVU_ID        left join TM_NHOMDICHVU ndv on ndv.NHOMDICHVU_ID = dv.NHOMDICHVU_ID        where B.BENHVIEN_ID ='01819' and Left(ndv.MANHOMDICHVU,2) = '04'        and B.PHONGBAN_ID in (60,62,64,66,67,69,71,72,73,74,75,55,55,56,56,57,57,54,12,80,80,63,76,1002,79,70,68,53,53,14,14,14,61,1001)        ) tmp        group by tmp.NOITHUCHIEN_ID, tmp.TENPHONGBAN, tmp.PHONGBAN_ID]
2020-07-16 15:43:35,086 [1] DEBUG - Statement Id: [DAO00000_GetDICHVU_DONGIA_LOAIGIA] PreparedStatement : [select A.LOAIGIA_ID, A.BANGGIA_ID, A.GIAVON, A.TYLEVAT  as TYLE_VAT, A.TYLE_LOINHUAN,            A.DONGIA as DONGIA_DOANHTHU, NULL as DONGIA_KHAC, isnull(D.MAPHANNHOMDICHVU, 'TT') as LOAI_CHIPHI            from TM_DICHVU_DONGIA A            inner join TM_BANGGIA B on B.LOAIGIA_ID = A.LOAIGIA_ID AND B.BENHVIEN_ID = '01819'            left join (select B.MAPHANNHOMDICHVU, A.* from TM_DICHVU_PHANNHOMDICHVU A            inner join TM_PHANNHOMDICHVU B on  B.PHANNHOMDICHVU_ID = A.PHANNHOMDICHVU_ID            where A.DICHVU_ID = '3' AND A.BENHVIEN_ID = '01819') D on A.DICHVU_ID = D.DICHVU_ID            where A.LOAIGIA_ID = '3' and A.DICHVU_ID = '3'            union            select A.LOAIGIA_ID, null as BANGGIA_ID, null as GIAVON, null as TYLE_VAT, null as TYLE_LOINHUAN,            null as DONGIA_DOANHTHU, C.DONGIA as DONGIA_KHAC, isnull(D.MAPHANNHOMDICHVU, 'TT') as LOAI_CHIPHI            from TM_DOITUONG_GIADICHVU A            left join TM_DICHVU dv on dv.DICHVU_ID = A.DICHVU_ID            inner join TM_BANGGIA B on B.LOAIGIA_ID = A.LOAIGIA_ID AND B.BENHVIEN_ID = '01819'            left join TM_DICHVU_DONGIA C on C.LOAIGIA_ID = A.LOAIGIA_ID AND C.BENHVIEN_ID = '01819'            and C.BANGGIA_ID = B.BANGGIA_ID and C.DICHVU_ID = A.DICHVU_ID            left join (select B.MAPHANNHOMDICHVU, A.* from TM_DICHVU_PHANNHOMDICHVU A            inner join TM_PHANNHOMDICHVU B on  B.PHANNHOMDICHVU_ID = A.PHANNHOMDICHVU_ID            where A.DICHVU_ID = '3' AND A.BENHVIEN_ID = '01819') D on A.DICHVU_ID = D.DICHVU_ID            where A.DOITUONG_ID = '1'  and A.DICHVU_ID = '3' and A.LOAIGIA_ID            in (select top 1 LOAIGIA_ID from TM_DOITUONG_LOAIGIA            where DOITUONG_ID = '1' and GIAHOTRO = '1'  AND BENHVIEN_ID = '01819'            and LOAIGIA_ID            in (select LOAIGIA_ID from TM_BANGGIA            where LOAIBANGGIA in            (select LOAIBANGGIA from TM_BANGGIA where LOAIGIA_ID = '3'  AND BENHVIEN_ID = '01819')            and TAMNGUNG = '0')  AND BENHVIEN_ID = '01819'            and isnull(dv.TAMNGUNG, '0') = '0' and isnull(dv.BHYT, '0') = '1'            )]
2020-07-16 15:43:35,125 [1] DEBUG - Statement Id: [DAO00024_TM_TIEPNHAN_BANGGIA_DICHVU_getlist] PreparedStatement : [select * from TM_TIEPNHAN_BANGGIA_DICHVU where TAMNGUNG != '1' and BENHVIEN_ID = '01819']
2020-07-16 15:43:41,372 [1] DEBUG - Statement Id: [DAO00020_ListKhoDuocOfPhongBan] PreparedStatement : [select B.* from TM_PHONGBAN_KHODUOC A        inner join TM_KHODUOC B on B.KHODUOC_ID = A.KHODUOC_ID        where        A.PHONGBAN_ID = '97'        and A.BENHVIEN_ID = '01819']
2020-07-16 15:43:58,645 [1] DEBUG - Statement Id: [DAO00020_ListKhoDuocOfPhongBan] PreparedStatement : [select B.* from TM_PHONGBAN_KHODUOC A        inner join TM_KHODUOC B on B.KHODUOC_ID = A.KHODUOC_ID        where        A.PHONGBAN_ID = ''        and A.BENHVIEN_ID = '01819']
2020-07-16 15:44:00,137 [1] DEBUG - Statement Id: [DAO00012_GetList] PreparedStatement : [select        DICTIONARY_ID,        DICTIONARY_CODE,        DICTIONARY_NAME,        ATTRIBUTE1,        ATTRIBUTE2,        DICTIONARY_NAME_EN,        DICTIONARY_TYPE_CODE        from LST_DICTIONARY        where LST_DICTIONARY.Enabled = '1'         AND           LST_DICTIONARY.DICTIONARY_TYPE_CODE = 'PhanLoaiTiepNhan'                 order by LST_DICTIONARY.IDX]
2020-07-16 15:44:00,192 [1] DEBUG - Statement Id: [DAO00012_GetList] PreparedStatement : [select        DICTIONARY_ID,        DICTIONARY_CODE,        DICTIONARY_NAME,        ATTRIBUTE1,        ATTRIBUTE2,        DICTIONARY_NAME_EN,        DICTIONARY_TYPE_CODE        from LST_DICTIONARY        where LST_DICTIONARY.Enabled = '1'         AND           LST_DICTIONARY.DICTIONARY_TYPE_CODE = 'NguonBN'                 order by LST_DICTIONARY.IDX]
2020-07-16 15:44:00,244 [1] DEBUG - Statement Id: [DAO00019_GetListCongTyChiTra] PreparedStatement : [select *        from TM_CONGTYCHITRA        where        BENHVIEN_ID = '01819' AND TAMNGUNG = '0']
2020-07-16 15:44:00,299 [1] DEBUG - Statement Id: [DAO00019_GetQuanHam_TinhTrangBN] PreparedStatement : [select * from LST_DICTIONARY where DICTIONARY_TYPE_CODE = 'QuanHamBenhNhan' and ENABLED = '1']
2020-07-16 15:44:00,351 [1] DEBUG - Statement Id: [DAO00019_GetQuanHam_TinhTrangBN] PreparedStatement : [select * from LST_DICTIONARY where DICTIONARY_TYPE_CODE = 'TinhTrangBenhNhan' and ENABLED = '1']
2020-07-16 15:44:00,403 [1] DEBUG - Statement Id: [DAO00019_GetQuanHam_TinhTrangBN] PreparedStatement : [select * from LST_DICTIONARY where DICTIONARY_TYPE_CODE = 'DonViCongTac' and ENABLED = '1']
2020-07-16 15:44:00,586 [1] DEBUG - Statement Id: [DAO00403_QMS002_GetDSHangDoi_COMPUTERNAME] PreparedStatement : [SELECT B.ID,B.DEPARTMENT_ID,C.DEPARTMENT_NAME, C.DEPT_CODE, B.[NAME] as QUEUENAME,B.ID as QUEUE_ID     FROM QMS_QUEUE B     INNER JOIN QMS_DEPARTMENT C ON B.DEPARTMENT_ID=C.DEPARTMENT_ID     JOIN (SELECT DISTINCT XX.SECTION_ID FROM QMS_QUEUE XX JOIN QMS_CLIENT YY ON YY.QUEUE_ID = XX.ID     WHERE XX.DEPARTMENT_ID='97' AND (YY.COMPUTERNAME = 'DESKTOP-89GE5BA' OR YY.IPADDRESS = '10.15.167.38')) A ON A.SECTION_ID = B.SECTION_ID     WHERE B.BENHVIEN_ID = '01819' AND B.STATE = 1]
2020-07-16 15:44:00,682 [1] DEBUG - Statement Id: [DAO00017_GetListPhongKham] PreparedStatement : [select pb.PHONGBAN_ID, pb.TENPHONGBAN, case when dv.ATTRIBUTE5 is null then 'TT' else 'KTC' end as LOAI_CHIPHI              from [TM_PHONGBAN_DICHVU] as pb_dv              inner join [TM_PHONGBAN] as pb on pb.PHONGBAN_ID = pb_dv.PHONGBAN_ID and pb.BENHVIEN_ID = '01819'              inner join [TM_DICHVU] dv on dv.DICHVU_ID = pb_dv.DICHVU_ID and dv.MADICHVU = '' and dv.BENHVIEN_ID = '01819'              where pb_dv.BENHVIEN_ID = '01819']
2020-07-16 15:44:00,727 [1] DEBUG - Statement Id: [DAO00019_GetListPhongKham_REG13] PreparedStatement : [select pb.PHONGBAN_ID, pb.TENPHONGBAN, case when dv.ATTRIBUTE5 is null then 'TT' else 'KTC' end as LOAI_CHIPHI        from TM_PHONGBAN pb        left join TM_PHONGBAN_DICHVU pb_dv on pb_dv.PHONGBAN_ID = pb.PHONGBAN_ID and pb_dv.BENHVIEN_ID = pb.BENHVIEN_ID        left join TM_DICHVU dv on dv.DICHVU_ID = pb_dv.DICHVU_ID and dv.BENHVIEN_ID = pb_dv.BENHVIEN_ID        left join TM_NHOMDICHVU ndv on ndv.NHOMDICHVU_ID = dv.NHOMDICHVU_ID and ndv.BENHVIEN_ID = dv.BENHVIEN_ID        where pb.BENHVIEN_ID = '01819' and ndv.MANHOMDICHVU = '04' and dv.DICHVU_ID IS NOT NULL]
2020-07-16 15:44:00,812 [1] DEBUG - Statement Id: [DAO00019_LayThongTinSoluongDichVuPhongKham_REG13] PreparedStatement : [select PHONGBAN_ID, TENPHONGBAN, NOITHUCHIEN_ID, SUM(CHUAKETQUA) AS CHUAKETQUA, SUM(HOANTAT) AS HOANTAT, SUM(DANGTHUCHIEN) AS DANGTHUCHIEN        , SUM(BHYT) as BHYT, SUM(VIENPHI) as VIENPHI        from (        select B.PHONGBAN_ID, B.TENPHONGBAN, A.NOITHUCHIEN_ID,        case when A.TRANGTHAI = 'CHUAKETQUA' then 1 else 0 end AS CHUAKETQUA,        case when A.TRANGTHAI not in ('CHUAKETQUA','DANGTHUCHIEN','CHOXACNHAN') then 1 else 0 end AS HOANTAT,        case when A.TRANGTHAI = 'DANGTHUCHIEN' then 1 else 0 end AS DANGTHUCHIEN,        case when len(tn.SOBHYT) > 1 then 1 else 0 end as BHYT,        case when len(tn.SOBHYT) = 0 then 1 else 0 end as VIENPHI        from TM_PHONGBAN B        left join TT_DVYEUCAU A on A.NOITHUCHIEN_ID = B.PHONGBAN_ID and A.BENHVIEN_ID = B.BENHVIEN_ID and A.NGAYYEUCAU = CONVERT(date, getdate())        inner join TT_TIEPNHAN tn on tn.TIEPNHAN_ID = A.TIEPNHAN_ID        left join TM_DICHVU dv on A.DICHVU_ID = dv.DICHVU_ID        left join TM_NHOMDICHVU ndv on ndv.NHOMDICHVU_ID = dv.NHOMDICHVU_ID        where B.BENHVIEN_ID ='01819' and Left(ndv.MANHOMDICHVU,2) = '04'        and B.PHONGBAN_ID in (60,62,64,66,67,69,71,72,73,74,75,55,55,56,56,57,57,54,12,80,80,63,76,1002,79,70,68,53,53,14,14,14,61,1001)        ) tmp        group by tmp.NOITHUCHIEN_ID, tmp.TENPHONGBAN, tmp.PHONGBAN_ID]
2020-07-16 15:44:00,910 [1] DEBUG - Statement Id: [DAO00017_GetListPhongKham] PreparedStatement : [select pb.PHONGBAN_ID, pb.TENPHONGBAN, case when dv.ATTRIBUTE5 is null then 'TT' else 'KTC' end as LOAI_CHIPHI              from [TM_PHONGBAN_DICHVU] as pb_dv              inner join [TM_PHONGBAN] as pb on pb.PHONGBAN_ID = pb_dv.PHONGBAN_ID and pb.BENHVIEN_ID = '01819'              inner join [TM_DICHVU] dv on dv.DICHVU_ID = pb_dv.DICHVU_ID and dv.MADICHVU = '' and dv.BENHVIEN_ID = '01819'              where pb_dv.BENHVIEN_ID = '01819']
2020-07-16 15:44:00,961 [1] DEBUG - Statement Id: [DAO00019_GetListPhongKham_REG13] PreparedStatement : [select pb.PHONGBAN_ID, pb.TENPHONGBAN, case when dv.ATTRIBUTE5 is null then 'TT' else 'KTC' end as LOAI_CHIPHI        from TM_PHONGBAN pb        left join TM_PHONGBAN_DICHVU pb_dv on pb_dv.PHONGBAN_ID = pb.PHONGBAN_ID and pb_dv.BENHVIEN_ID = pb.BENHVIEN_ID        left join TM_DICHVU dv on dv.DICHVU_ID = pb_dv.DICHVU_ID and dv.BENHVIEN_ID = pb_dv.BENHVIEN_ID        left join TM_NHOMDICHVU ndv on ndv.NHOMDICHVU_ID = dv.NHOMDICHVU_ID and ndv.BENHVIEN_ID = dv.BENHVIEN_ID        where pb.BENHVIEN_ID = '01819' and ndv.MANHOMDICHVU = '04' and dv.DICHVU_ID IS NOT NULL]
2020-07-16 15:44:01,054 [1] DEBUG - Statement Id: [DAO00019_LayThongTinSoluongDichVuPhongKham_REG13] PreparedStatement : [select PHONGBAN_ID, TENPHONGBAN, NOITHUCHIEN_ID, SUM(CHUAKETQUA) AS CHUAKETQUA, SUM(HOANTAT) AS HOANTAT, SUM(DANGTHUCHIEN) AS DANGTHUCHIEN        , SUM(BHYT) as BHYT, SUM(VIENPHI) as VIENPHI        from (        select B.PHONGBAN_ID, B.TENPHONGBAN, A.NOITHUCHIEN_ID,        case when A.TRANGTHAI = 'CHUAKETQUA' then 1 else 0 end AS CHUAKETQUA,        case when A.TRANGTHAI not in ('CHUAKETQUA','DANGTHUCHIEN','CHOXACNHAN') then 1 else 0 end AS HOANTAT,        case when A.TRANGTHAI = 'DANGTHUCHIEN' then 1 else 0 end AS DANGTHUCHIEN,        case when len(tn.SOBHYT) > 1 then 1 else 0 end as BHYT,        case when len(tn.SOBHYT) = 0 then 1 else 0 end as VIENPHI        from TM_PHONGBAN B        left join TT_DVYEUCAU A on A.NOITHUCHIEN_ID = B.PHONGBAN_ID and A.BENHVIEN_ID = B.BENHVIEN_ID and A.NGAYYEUCAU = CONVERT(date, getdate())        inner join TT_TIEPNHAN tn on tn.TIEPNHAN_ID = A.TIEPNHAN_ID        left join TM_DICHVU dv on A.DICHVU_ID = dv.DICHVU_ID        left join TM_NHOMDICHVU ndv on ndv.NHOMDICHVU_ID = dv.NHOMDICHVU_ID        where B.BENHVIEN_ID ='01819' and Left(ndv.MANHOMDICHVU,2) = '04'        and B.PHONGBAN_ID in (60,62,64,66,67,69,71,72,73,74,75,55,55,56,56,57,57,54,12,80,80,63,76,1002,79,70,68,53,53,14,14,14,61,1001)        ) tmp        group by tmp.NOITHUCHIEN_ID, tmp.TENPHONGBAN, tmp.PHONGBAN_ID]
2020-07-16 15:44:01,154 [1] DEBUG - Statement Id: [DAO00403_QMS002_GetThongTinClient] PreparedStatement : [SELECT B.ID as QUEUE_ID, B.NAME AS QUEUE_NAME,A.ID AS CLIENT_ID , A.[NAME] AS CLIENT_NAME, ISNULL(A.[STATE],1) AS [STATE],(CASE C.NAME WHEN 'UT' THEN 1 ELSE 0 END) AS QUEUETYPE     , B.DEPARTMENT_ID,ISNULL(B.SECTION_ID,-1) AS SECTION_ID,A.IPSERVER,A.NAMEAUDIO,C.QUEUE_TYPE_CODE,C.QUEUE_TYPE_CODE_SOUND,S.[NAME] AS SECTIONNAME     FROM QMS_QUEUE B LEFT JOIN QMS_CLIENT A ON A.QUEUE_ID = B.ID     LEFT JOIN QMS_QUEUE_TYPE C ON B.QUEUETYPE_ID = C.ID     LEFT JOIN QMS_SECTION S ON B.SECTION_ID=S.ID     WHERE     (A.COMPUTERNAME = 'DESKTOP-89GE5BA' OR A.IPADDRESS = '10.15.167.38') AND A.[STATE] = 1 AND B.DEPARTMENT_ID='97'            AND B.BENHVIEN_ID = '01819']
2020-07-16 15:44:02,351 [1] DEBUG - Statement Id: [DAO00019_GetTotalLichSuTiepNhan] PreparedStatement : [select count(*)        from (        select T.*        from TT_TIEPNHAN AS T        where        T.BENHVIEN_ID = '01819'         and           convert(date, T.NGAYTIEPNHAN) >= '7/16/2020 3:44:02 PM'         and           convert(date, T.NGAYTIEPNHAN) <= '7/16/2020 3:44:02 PM'                 ) as tn        inner join (select A.*, B.DESCRIPTION from TT_BENHNHAN A        left join TM_GENDER B on B.ID = A.GIOITINH) as bn on tn.BENHNHAN_ID = bn.BENHNHAN_ID                 where tn.BENHVIEN_ID = '01819']
2020-07-16 15:44:02,454 [1] DEBUG - Statement Id: [DAO00019_GetLichSuTiepNhan] PreparedStatement : [select * from (        select ROW_NUMBER() OVER(ORDER BY tn.THOIGIANTIEPNHAN desc) AS ROWNUMBER, tn.*, bn.MAYTE,        bn.TENBENHNHAN, isnull(convert(varchar, NGAYSINH, 103), convert(varchar, NAMSINH)) as NGAYSINH,        bn.DESCRIPTION as GIOITINH, isnull(bn.DIACHILIENLAC,bn.DIACHITHUONGTRU) as DIACHILIENLAC        from (        select T.*, LOAIBENHAN = CASE ISNULL(NB.LOAIBENHAN,ISNULL(NN.LOAIBENHAN,0)) WHEN 0 THEN '' WHEN 2 THEN 'DTNT' WHEN 1 THEN 'CC' ELSE 'NT' END        , DT.TENDOITUONG, NV.TENNHANVIEN        from TT_TIEPNHAN AS T        left join TT_NOITRU_NHAPVIEN AS NN ON NN.TIEPNHAN_ID = T.TIEPNHAN_ID        left join TT_NOITRU_BENHAN AS NB ON NB.BENHAN_ID = (SELECT TOP 1 BENHAN_ID FROM TT_NOITRU_BENHAN WHERE TIEPNHAN_ID = T.TIEPNHAN_ID ORDER BY BENHAN_ID DESC)        left join TM_DOITUONG AS DT ON DT.DOITUONG_ID = T.DOITUONG_ID        left join TM_NHANVIEN AS NV ON NV.NHANVIEN_ID = T.NGUOITAO_ID        where        T.BENHVIEN_ID = '01819'         and           convert(date, T.NGAYTIEPNHAN) >= '7/16/2020 3:44:02 PM'         and           convert(date, T.NGAYTIEPNHAN) <= '7/16/2020 3:44:02 PM'                 ) as tn        inner join (select A.*, B.DESCRIPTION from TT_BENHNHAN A        left join TM_GENDER B on B.ID = A.GIOITINH) as bn on tn.BENHNHAN_ID = bn.BENHNHAN_ID                 ) as tn        where (tn.RowNumber between 1 and 17) and tn.BENHVIEN_ID = '01819'        order by tn.THOIGIANTIEPNHAN desc]
2020-07-16 15:44:03,600 [1] DEBUG - Statement Id: [DAO00013_GetListBenhNhan] PreparedStatement : [select B.*, isnull(convert(varchar, B.NGAYSINH, 103), convert(varchar, B.NAMSINH)) as NGAYTHANGNAMSINH             from TT_BENHNHAN AS B               where                 B.MAYTE = '200001812'                     order by B.BENHNHAN_ID]
2020-07-16 15:44:03,628 [1] DEBUG - Statement Id: [DAO00095_GetListNguoiLienHe] PreparedStatement : [SELECT BNN.*, D.DICTIONARY_NAME AS TENQUANHE          FROM TT_BENHNHAN AS BN          INNER JOIN TT_BENHNHAN_NGUOILIENHE AS BNN ON BNN.BENHNHAN_ID = BN.BENHNHAN_ID          LEFT JOIN LST_DICTIONARY AS D ON D.DICTIONARY_ID = BNN.QUANHE_ID AND D.DICTIONARY_TYPE_CODE = 'QuanHeGiaDinh'          WHERE BN.MAYTE = '200001812' AND BN.ACTIVE = '1' AND BN.BENHVIEN_ID = '01819']
2020-07-16 15:44:03,656 [1] DEBUG - Statement Id: [DAO00095_GetListBenhNhan] PreparedStatement : [select B.*, isnull(convert(varchar, B.NGAYSINH, 103), convert(varchar, B.NAMSINH)) as NGAYTHANGNAMSINH                        ,T.TIEPNHAN_ID AS TIEPNHAN_ID_L, T.SOBHYT AS SOTHE_L, T.BHYTTUNGAY AS NGAYHIEULUC_L, T.BHYTDENNGAY AS NGAYHETHIEULUC_L, T.KHUVUCSONG_ID AS KHUVUCSONG_ID_L            , T.NGAYMIENDONGCHITRA AS NGAYMIENDONGCHITRA_L, T.BHYTTREN5NAM AS TREN5NAM_L, T.TRAITUYEN AS TRAITUYEN_L                     from TT_BENHNHAN AS B                        left join TT_TIEPNHAN AS T ON T.TIEPNHAN_ID =            (SELECT TOP 1 TIEPNHAN_ID FROM TT_TIEPNHAN WHERE BENHNHAN_ID = B.BENHNHAN_ID ORDER BY THOIGIANTIEPNHAN DESC)           where                   B.MAYTE = '200001812'                         order by B.BENHNHAN_ID]
2020-07-16 15:44:03,767 [1] DEBUG - Statement Id: [DAO00019_LaySoTienCongNo] PreparedStatement : [select SOTIEN        from TT_BENHNHAN_CONGNO        where        MAYTE = '200001812'        and BENHVIEN_ID = '01819'        and ACTIVE = '1']
2020-07-16 15:44:03,798 [1] DEBUG - Statement Id: [DAO00019_GetDSTiepNhanByBenhNhan] PreparedStatement : [SELECT T.*, NN.SOBENHAN AS SOBENHAN_DTNT        FROM TT_TIEPNHAN AS T        LEFT JOIN TT_NOITRU_NHAPVIEN AS NN ON NN.TIEPNHAN_ID = T.TIEPNHAN_ID AND NN.LOAIBENHAN = '2'        WHERE T.BENHNHAN_ID = '8731' AND T.BENHVIEN_ID = '01819' AND T.TRANGTHAI != 'HOANTHANH'        AND (NN.NHAPVIEN_ID IS NULL AND convert(date, T.NGAYTAO) = convert(date, '7/16/2020 3:44:03 PM')        OR NN.NHAPVIEN_ID IS NOT NULL)        ORDER BY NN.SOBENHAN]
2020-07-16 15:44:03,854 [1] DEBUG - Statement Id: [DAO00019_GetDetails_TiepNhan] PreparedStatement : [select tn.TIEPNHAN_ID, tn.SOTIEPNHAN, tn.SOBHYT as SOTHE, tn.BHYTTUNGAY as NGAYHIEULUC,        tn.BHYTDENNGAY as NGAYHETHIEULUC, tn.BHYTNGAYCAP as NGAYCAP, tn.BHYTTREN3NAM as TREN3NAM, tn.KHUVUCSONG_ID,        tn.BHYTTREN5NAM as TREN5NAM,tn.NGAYMIENDONGCHITRA,tn.NOIGIOITHIEU_ID, tn.NGUOIGIOITHIEU_ID, tn.CHANDOANNGT,        tn.NOITIEPNHAN_ID, tn.DOITUONG_ID, tn.TRAITUYEN, tn.HINHTHUCDENKHAM_ID, tn.THOIGIANTIEPNHAN,        dv.DVYEUCAU_ID, dv.DICHVU_ID, dv.NOITHUCHIEN_ID as PHONGBAN_ID,        dv.NGUOITAO_ID as DV_NGUOITAO_ID, dv.NGAYTAO as DV_NGAYTAO, dv.THUTIENSAU, dv.BACSICHIDINH_ID, dv.NGUOICHIDINH_ID,        dv.NGUOICAPNHAT_ID as DV_NGUOICAPNHAT_ID, dv.NGAYCAPNHAT as DV_NGAYCAPNHAT,        vp.VIENPHI_ID, vp.KHONGTHUTIEN, vp.LOAI_CHIPHI, vp.LOAIGIA_ID as LOAIGIA,        vp.DATHUCHIEN, vp.DATHANHTOAN, vp.DONGIA_DOANHTHU,        dv.NOITHUCHIEN_ID, dv.TRANGTHAI,        vp.NGUOITAO_ID as VP_NGUOITAO_ID, vp.BHYT_DONGIA, vp.TYLE_VAT, vp.BANGGIA_ID, vp.GIAVON,        tn.NGAYTAO as TN_NGAYTAO,        vp.NGAYTAO as VP_NGAYTAO, vp.NGUOICAPNHAT_ID as VP_NGUOICAPNHAT_ID, vp.NGAYCAPNHAT as VP_NGAYCAPNHAT,        tn.SOCHUYENVIEN, tn.THOIGIANCHUYENTUYEN, tn.HINHTHUCCHUYENVIEN_ID, tn.LYDOCHUYENVIEN_ID, tn.ICDNOIGIOITHIEU_ID,        tn.SUDUNG_BHTN, tn.THE_ID, tn.LOAITHANHVIEN_ID, tn.THANHVIEN_ID, tn.VIP, tn.GHICHU_TIEPNHAN, tn.BAOLANH_VIENPHI        , tn.CONGTY_CHITRA_ID, tn.TRANGTHAI as TRANGTHAI_TIEPNHAN, tn.NGUOITAO_ID as TN_NGUOITAO_ID, tn.TINHTRANGHEN        , tn.NGUON_BENHNHAN_ID, tn.THONGTIN_KCB_BHYT, tn.LOAITIEPNHAN_ID, tn.LYDODENKHAM, vp.YEUCAUVP        , tn.TENNGUOIGIOITHIEU, tn.GIOITHIEUBENNGOAI, tn.UUTIEN, tn.KHOAHENTK, tn.NGUOINUOCNGOAI, tn.NGOAIGIO        , tn.QUANHAM_ID, tn.TINHTRANGBENHNHAN_ID        from (        select top 1 *        from TT_TIEPNHAN        where BENHVIEN_ID = '01819'         and           TIEPNHAN_ID = '8747'                   order by                 SOTIEPNHAN desc        ) as tn        left join TT_DVYEUCAU dv on dv.TIEPNHAN_ID = tn.TIEPNHAN_ID and dv.HUYYEUCAU = '0'        left join TT_VIENPHI vp on vp.TIEPNHAN_ID = tn.TIEPNHAN_ID and vp.DICHVU_ID = dv.DICHVU_ID  and dv.DVYEUCAU_ID = vp.REF_ID]
2020-07-16 15:44:03,887 [1] DEBUG - Statement Id: [DAO00019_GetTiepNhanMienGiamCLSThucHien] PreparedStatement : [select TIEPNHAN_ID from TT_MIENGIAM where TIEPNHAN_ID ='8747';]
2020-07-16 15:44:03,910 [1] DEBUG - Statement Id: [DAO00019_GetTiepNhanMienGiamCLSThucHien01] PreparedStatement : [select TIEPNHAN_ID from TT_DVYEUCAU where TIEPNHAN_ID ='8747' and TRANGTHAI != 'CHUAKETQUA']
2020-07-16 15:44:03,941 [1] DEBUG - Statement Id: [DAO00060_KiemtrabenhnhanCapcuuNoitruDaKhoaBenhAn] PreparedStatement : [select A.* , C.TRANGTHAI as STATUS, C.SOTIEPNHAN, A.ICD_BENHCHINH as ICD_NHAPVIEN              from TT_NOITRU_BENHAN A              inner join TT_TIEPNHAN C on C.TIEPNHAN_ID = A.TIEPNHAN_ID and convert(date, C.NGAYTAO) = convert(date, getdate())              inner join TT_BENHNHAN B on A.BENHNHAN_ID = B.BENHNHAN_ID and B.ACTIVE = '1' and B.MAYTE = '200001812'              where A.TRANGTHAI = 'DAKHOA' and A.BENHVIEN_ID = '01819']
2020-07-16 15:44:03,985 [1] DEBUG - Statement Id: [DAO00060_KiemtrabenhnhanCapcuuNoitru] PreparedStatement : [select A.* , C.TRANGTHAI as STATUS, C.SOTIEPNHAN, A.ICD_BENHCHINH as ICD_NHAPVIEN, C.SOBHYT, C.BHYTTUNGAY, C.BHYTDENNGAY              from TT_NOITRU_BENHAN A              inner join TT_TIEPNHAN C on C.TIEPNHAN_ID = A.TIEPNHAN_ID              inner join TT_BENHNHAN B on A.BENHNHAN_ID = B.BENHNHAN_ID and B.ACTIVE = '1' and B.MAYTE = '200001812'              where (A.TRANGTHAI = 'DANGDIEUTRI' OR A.TRANGTHAI = 'DAXUATVIEN' OR A.TRANGTHAI = 'DATHANHTOAN') and A.BENHVIEN_ID = '01819'               and                   A.TIEPNHAN_ID = '8747']
2020-07-16 15:44:04,017 [1] DEBUG - Statement Id: [DAO00014_GetTTNhapVien] PreparedStatement : [select *        from TT_NOITRU_NHAPVIEN        where TIEPNHAN_ID  = '8747']
2020-07-16 15:44:04,046 [1] DEBUG - Statement Id: [DAO00019_GetBenhNhanThanhVien] PreparedStatement : [select A.*, B.TENTHETHANHVIEN, convert(varchar, A.NGAYHIEULUC, 103) as NGAYHIEULUCTHE, B.SOTIEN        from TT_CSKH_THANHVIEN_CAPTHE A        left join TM_CSKH_THETHANHVIEN B on B.THETHANHVIEN_ID = A.THETHANHVIEN_ID        where   THANHVIEN_ID in (        select THANHVIEN_ID from TT_CSKH_THANHVIEN        where (BENHNHAN_ID = '8731' and TAMNGUNG is null or TAMNGUNG = '0')        and (DAXOA is null or DAXOA = '0'))        and A.KICHHOAT = '1' and (A.TAMNGUNG = '0' or A.TAMNGUNG is null)                 and A.BENHVIEN_ID = '01819'        order by THE_ID desc]
2020-07-16 15:44:04,079 [1] DEBUG - Statement Id: [DAO00095_Search_LichSuKhamChuaBenh] PreparedStatement : [select KB.THOIGIANKHAM, DV.TENDICHVU AS NOIDUNG, PB.TENPHONGBAN AS TENPHONGKHAM, NV.TENNHANVIEN AS TENBACSIKHAM,          KB.CHANDOANKHOAKHAM AS CHANDOAN, TN.SOBHYT          from TT_BENHNHAN BN          inner join TT_TIEPNHAN TN on TN.BENHNHAN_ID = BN.BENHNHAN_ID and TN.BENHVIEN_ID = BN.BENHVIEN_ID          inner join TT_NGOAITRU_KHAMBENH KB on KB.TIEPNHAN_ID = TN.TIEPNHAN_ID and KB.BENHVIEN_ID = TN.BENHVIEN_ID          left join TM_DICHVU DV on DV.DICHVU_ID = KB.DICHVU_ID and DV.BENHVIEN_ID = KB.BENHVIEN_ID          left join TM_PHONGBAN PB on PB.PHONGBAN_ID = KB.PHONGBAN_ID and PB.BENHVIEN_ID = KB.BENHVIEN_ID          left join TM_NHANVIEN NV on NV.NHANVIEN_ID = KB.BACSIKHAM_ID and NV.BENHVIEN_ID = KB.BENHVIEN_ID          where BN.BENHNHAN_ID = 8731          and BN.BENHVIEN_ID = '01819'          order by KB.THOIGIANKHAM]
2020-07-16 15:44:06,191 [1] DEBUG - Statement Id: [DAO00019_GetLoaiGiaLoaiKhachHang] PreparedStatement : [select A.*, B.DICTIONARY_CODE MAKHACHHANG, C.TENLOAIGIA        from TM_NGUONKHACHHANG_LOAIGIA A        left join LST_DICTIONARY B on A.NGUONKHACHHANG_BENHNHAN_ID = B.DICTIONARY_ID        inner join TM_LOAIGIA C on C.LOAIGIA_ID = A.LOAIGIA_ID and CAPTREN_ID  = (select LOAIGIA_ID from TM_LOAIGIA where MALOAIGIA = 'GiaDichVu')        left join TM_DICHVU_DONGIA dvdg on dvdg.LOAIGIA_ID = A.LOAIGIA_ID        where B.DICTIONARY_TYPE_CODE = 'NguonKhachHang' and dvdg.DICHVU_ID  =  @param0]
2020-07-16 15:44:06,191 [1] DEBUG - Statement Id: [DAO00019_GetLoaiGiaLoaiKhachHang] Parameters: [@param0=[DICHVU_ID,3]]
2020-07-16 15:44:06,191 [1] DEBUG - Statement Id: [DAO00019_GetLoaiGiaLoaiKhachHang] Types: [@param0=[Int64, System.Int64]]
2020-07-16 15:44:06,218 [1] DEBUG - Statement Id: [DAO00017_GetLoaiGiaDoiTuongDichVu] PreparedStatement : [select a.LOAIGIA_ID, a.TENLOAIGIA, a.MALOAIGIA, a.CAPTREN_ID, MIN(a.UUTIEN_NGUON) AS UUTIEN_NGUON          , MAX(a.DOUUTIEN) AS DOUUTIEN, MIN(ISNULL(a.GIAHOTRO,0)) AS GIAHOTRO          from(                        select distinct A.LOAIGIA_ID, C.TENLOAIGIA, C.MALOAIGIA, 0 as UUTIEN_NGUON, isnull(B.DOUUTIEN,0) as DOUUTIEN, B.GIAHOTRO, C.CAPTREN_ID            from TM_DOITUONG_GIADICHVU A            left join TM_DOITUONG_LOAIGIA B on A.LOAIGIA_ID = B.LOAIGIA_ID and A.DOITUONG_ID = B.DOITUONG_ID and B.BENHVIEN_ID = '01819'            inner join TM_LOAIGIA C on A.LOAIGIA_ID = C.LOAIGIA_ID and C.BENHVIEN_ID = '01819'            where A.DOITUONG_ID = '1'                            and A.DICHVU_ID = '3'                         and A.BENHVIEN_ID = '01819'                     ) a          where a.DOUUTIEN != 0 and a.DOUUTIEN is not null          group by a.LOAIGIA_ID, a.TENLOAIGIA, a.MALOAIGIA, a.CAPTREN_ID          order by MAX(a.UUTIEN_NGUON) desc ,MAX(a.DOUUTIEN) asc]
2020-07-16 15:44:06,261 [1] DEBUG - Statement Id: [DAO00017_GetListPhongKham] PreparedStatement : [select pb.PHONGBAN_ID, pb.TENPHONGBAN, case when dv.ATTRIBUTE5 is null then 'TT' else 'KTC' end as LOAI_CHIPHI              from [TM_PHONGBAN_DICHVU] as pb_dv              inner join [TM_PHONGBAN] as pb on pb.PHONGBAN_ID = pb_dv.PHONGBAN_ID and pb.BENHVIEN_ID = '01819'              inner join [TM_DICHVU] dv on dv.DICHVU_ID = pb_dv.DICHVU_ID and dv.MADICHVU = '0003' and dv.BENHVIEN_ID = '01819'              where pb_dv.BENHVIEN_ID = '01819']
2020-07-16 15:44:06,308 [1] DEBUG - Statement Id: [DAO00019_GetListPhongKham_REG13] PreparedStatement : [select pb.PHONGBAN_ID, pb.TENPHONGBAN, case when dv.ATTRIBUTE5 is null then 'TT' else 'KTC' end as LOAI_CHIPHI        from TM_PHONGBAN pb        left join TM_PHONGBAN_DICHVU pb_dv on pb_dv.PHONGBAN_ID = pb.PHONGBAN_ID and pb_dv.BENHVIEN_ID = pb.BENHVIEN_ID        left join TM_DICHVU dv on dv.DICHVU_ID = pb_dv.DICHVU_ID and dv.BENHVIEN_ID = pb_dv.BENHVIEN_ID        left join TM_NHOMDICHVU ndv on ndv.NHOMDICHVU_ID = dv.NHOMDICHVU_ID and ndv.BENHVIEN_ID = dv.BENHVIEN_ID        where pb.BENHVIEN_ID = '01819' and ndv.MANHOMDICHVU = '04' and dv.DICHVU_ID IS NOT NULL]
2020-07-16 15:44:06,382 [1] DEBUG - Statement Id: [DAO00019_LayThongTinSoluongDichVuPhongKham_REG13] PreparedStatement : [select PHONGBAN_ID, TENPHONGBAN, NOITHUCHIEN_ID, SUM(CHUAKETQUA) AS CHUAKETQUA, SUM(HOANTAT) AS HOANTAT, SUM(DANGTHUCHIEN) AS DANGTHUCHIEN        , SUM(BHYT) as BHYT, SUM(VIENPHI) as VIENPHI        from (        select B.PHONGBAN_ID, B.TENPHONGBAN, A.NOITHUCHIEN_ID,        case when A.TRANGTHAI = 'CHUAKETQUA' then 1 else 0 end AS CHUAKETQUA,        case when A.TRANGTHAI not in ('CHUAKETQUA','DANGTHUCHIEN','CHOXACNHAN') then 1 else 0 end AS HOANTAT,        case when A.TRANGTHAI = 'DANGTHUCHIEN' then 1 else 0 end AS DANGTHUCHIEN,        case when len(tn.SOBHYT) > 1 then 1 else 0 end as BHYT,        case when len(tn.SOBHYT) = 0 then 1 else 0 end as VIENPHI        from TM_PHONGBAN B        left join TT_DVYEUCAU A on A.NOITHUCHIEN_ID = B.PHONGBAN_ID and A.BENHVIEN_ID = B.BENHVIEN_ID and A.NGAYYEUCAU = CONVERT(date, getdate())        inner join TT_TIEPNHAN tn on tn.TIEPNHAN_ID = A.TIEPNHAN_ID        left join TM_DICHVU dv on A.DICHVU_ID = dv.DICHVU_ID        left join TM_NHOMDICHVU ndv on ndv.NHOMDICHVU_ID = dv.NHOMDICHVU_ID        where B.BENHVIEN_ID ='01819' and Left(ndv.MANHOMDICHVU,2) = '04'        and B.PHONGBAN_ID in (60,62,64,66,67,69,71,72,73,74,75,55,55,56,56,57,57,54,12,80,80,63,76,1002,79,70,68,53,53,14,14,14,61,1001)        ) tmp        group by tmp.NOITHUCHIEN_ID, tmp.TENPHONGBAN, tmp.PHONGBAN_ID]
2020-07-16 15:44:06,423 [1] DEBUG - Statement Id: [DAO00000_GetDICHVU_DONGIA_LOAIGIA] PreparedStatement : [select A.LOAIGIA_ID, A.BANGGIA_ID, A.GIAVON, A.TYLEVAT  as TYLE_VAT, A.TYLE_LOINHUAN,            A.DONGIA as DONGIA_DOANHTHU, NULL as DONGIA_KHAC, isnull(D.MAPHANNHOMDICHVU, 'TT') as LOAI_CHIPHI            from TM_DICHVU_DONGIA A            inner join TM_BANGGIA B on B.LOAIGIA_ID = A.LOAIGIA_ID AND B.BENHVIEN_ID = '01819'            left join (select B.MAPHANNHOMDICHVU, A.* from TM_DICHVU_PHANNHOMDICHVU A            inner join TM_PHANNHOMDICHVU B on  B.PHANNHOMDICHVU_ID = A.PHANNHOMDICHVU_ID            where A.DICHVU_ID = '3' AND A.BENHVIEN_ID = '01819') D on A.DICHVU_ID = D.DICHVU_ID            where A.LOAIGIA_ID = '3' and A.DICHVU_ID = '3'            union            select A.LOAIGIA_ID, null as BANGGIA_ID, null as GIAVON, null as TYLE_VAT, null as TYLE_LOINHUAN,            null as DONGIA_DOANHTHU, C.DONGIA as DONGIA_KHAC, isnull(D.MAPHANNHOMDICHVU, 'TT') as LOAI_CHIPHI            from TM_DOITUONG_GIADICHVU A            left join TM_DICHVU dv on dv.DICHVU_ID = A.DICHVU_ID            inner join TM_BANGGIA B on B.LOAIGIA_ID = A.LOAIGIA_ID AND B.BENHVIEN_ID = '01819'            left join TM_DICHVU_DONGIA C on C.LOAIGIA_ID = A.LOAIGIA_ID AND C.BENHVIEN_ID = '01819'            and C.BANGGIA_ID = B.BANGGIA_ID and C.DICHVU_ID = A.DICHVU_ID            left join (select B.MAPHANNHOMDICHVU, A.* from TM_DICHVU_PHANNHOMDICHVU A            inner join TM_PHANNHOMDICHVU B on  B.PHANNHOMDICHVU_ID = A.PHANNHOMDICHVU_ID            where A.DICHVU_ID = '3' AND A.BENHVIEN_ID = '01819') D on A.DICHVU_ID = D.DICHVU_ID            where A.DOITUONG_ID = '1'  and A.DICHVU_ID = '3' and A.LOAIGIA_ID            in (select top 1 LOAIGIA_ID from TM_DOITUONG_LOAIGIA            where DOITUONG_ID = '1' and GIAHOTRO = '1'  AND BENHVIEN_ID = '01819'            and LOAIGIA_ID            in (select LOAIGIA_ID from TM_BANGGIA            where LOAIBANGGIA in            (select LOAIBANGGIA from TM_BANGGIA where LOAIGIA_ID = '3'  AND BENHVIEN_ID = '01819')            and TAMNGUNG = '0')  AND BENHVIEN_ID = '01819'            and isnull(dv.TAMNGUNG, '0') = '0' and isnull(dv.BHYT, '0') = '1'            )]
2020-07-16 15:44:06,463 [1] DEBUG - Statement Id: [DAO00024_TM_TIEPNHAN_BANGGIA_DICHVU_getlist] PreparedStatement : [select * from TM_TIEPNHAN_BANGGIA_DICHVU where TAMNGUNG != '1' and BENHVIEN_ID = '01819']
2020-07-16 15:44:11,533 [1] DEBUG - Statement Id: [DAO00020_ListKhoDuocOfPhongBan] PreparedStatement : [select B.* from TM_PHONGBAN_KHODUOC A        inner join TM_KHODUOC B on B.KHODUOC_ID = A.KHODUOC_ID        where        A.PHONGBAN_ID = '97'        and A.BENHVIEN_ID = '01819']
2020-07-16 15:44:13,708 [1] DEBUG - Statement Id: [DAO00020_ListKhoDuocOfPhongBan] PreparedStatement : [select B.* from TM_PHONGBAN_KHODUOC A        inner join TM_KHODUOC B on B.KHODUOC_ID = A.KHODUOC_ID        where        A.PHONGBAN_ID = '74'        and A.BENHVIEN_ID = '01819']
2020-07-16 15:44:15,667 [1] DEBUG - Statement Id: [DAO00008_UpdateUserIdPhongBanKhoDuoc] PreparedStatement : [IF EXISTS            (SELECT ACCOUNT_ID FROM TM_SYS_USERS WHERE ACCOUNT_ID =  @param0  and HOSPITAL_ID =  @param1 )            BEGIN            update TM_SYS_USERS set INVENTORY_ID =  @param2 , WORKING_DEPT_ID =  @param3             WHERE ACCOUNT_ID =  @param0  and HOSPITAL_ID =  @param1             END            ELSE            BEGIN            insert into TM_SYS_USERS ([ACCOUNT_ID], [ACCOUNT_NAME], [INVENTORY_ID], [WORKING_DEPT_ID], [HOSPITAL_ID])            values ( @param0 ,  @param4 ,  @param2 ,  @param3 ,  @param1 )            END]
2020-07-16 15:44:15,667 [1] DEBUG - Statement Id: [DAO00008_UpdateUserIdPhongBanKhoDuoc] Parameters: [@param0=[ACCOUNT_ID,113], @param1=[HOSPITAL_ID,01819], @param2=[INVENTORY_ID,null], @param3=[WORKING_DEPT_ID,74], @param4=[ACCOUNT_NAME,admin]]
2020-07-16 15:44:15,667 [1] DEBUG - Statement Id: [DAO00008_UpdateUserIdPhongBanKhoDuoc] Types: [@param0=[String, System.String], @param1=[String, System.String], @param2=[System.DBNull, null], @param3=[String, System.String], @param4=[String, System.String]]
2020-07-16 15:44:15,738 [1] DEBUG - Statement Id: [DAO00030_CheckLoaiPhongBan] PreparedStatement : [select pb.*  from TM_PHONGBAN pb          join LST_DICTIONARY dic on pb.LOAIPHONGBAN_ID = dic.DICTIONARY_ID          where          pb.PHONGBAN_ID = 74          and dic.DICTIONARY_CODE = '']
2020-07-16 15:44:18,481 [1] DEBUG - Statement Id: [DAO00403_QMS002_GetThongTinClient] PreparedStatement : [SELECT B.ID as QUEUE_ID, B.NAME AS QUEUE_NAME,A.ID AS CLIENT_ID , A.[NAME] AS CLIENT_NAME, ISNULL(A.[STATE],1) AS [STATE],(CASE C.NAME WHEN 'UT' THEN 1 ELSE 0 END) AS QUEUETYPE     , B.DEPARTMENT_ID,ISNULL(B.SECTION_ID,-1) AS SECTION_ID,A.IPSERVER,A.NAMEAUDIO,C.QUEUE_TYPE_CODE,C.QUEUE_TYPE_CODE_SOUND,S.[NAME] AS SECTIONNAME     FROM QMS_QUEUE B LEFT JOIN QMS_CLIENT A ON A.QUEUE_ID = B.ID     LEFT JOIN QMS_QUEUE_TYPE C ON B.QUEUETYPE_ID = C.ID     LEFT JOIN QMS_SECTION S ON B.SECTION_ID=S.ID     WHERE     (A.COMPUTERNAME = 'DESKTOP-89GE5BA' OR A.IPADDRESS = '10.15.167.38') AND A.[STATE] = 1 AND B.DEPARTMENT_ID='74'            AND B.BENHVIEN_ID = '01819']
2020-07-16 15:44:18,551 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = '01819'               AND                   TM_SYS_SCREEN.PAGE = 'OPD02'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2020-07-16 15:44:21,359 [1] DEBUG - Statement Id: [DAO00017_GetLoaiGiaByDoiTuongId] PreparedStatement : [select dtlg.DOUUTIEN, dtlg.DOITUONG_ID, lg.LOAIGIA_ID, lg.TENLOAIGIA, lg.MALOAIGIA              from TM_LOAIGIA lg              left join TM_DOITUONG_LOAIGIA dtlg              on lg.LOAIGIA_ID = dtlg.LOAIGIA_ID and dtlg.BENHVIEN_ID = '01819'              where lg.TAMNGUNG = 0 and lg.BENHVIEN_ID = '01819'                             order by dtlg.DOUUTIEN]
2020-07-16 15:44:21,447 [1] DEBUG - Statement Id: [DAO00092_GetList_ToathuocNgoaitru] PreparedStatement : [select A.*, B.PHAMVI_ID, C.KHODUOC_ID from TM_TOATHUOC_NGOAITRU A        left join TM_DUOC_PHAMVISUDUNG B on B.MAPHAMVI = A.MAPHAMVI        left join (select distinct PHAMVI_ID, KHODUOC_ID from TM_DUOC_PHAMVISD_MAPPING) C on C.PHAMVI_ID = B.PHAMVI_ID        where A.TAMNGUNG != '1' and A.BENHVIEN_ID = '01819'        ORDER BY A.SAPXEP ASC]
2020-07-16 15:44:21,484 [1] DEBUG - Statement Id: [DAO00012_GetLoaiTCLS] PreparedStatement : [select DICTIONARY_ID, DICTIONARY_CODE, DICTIONARY_NAME, cast('0' as Bit) CHON        from LST_DICTIONARY              where DICTIONARY_TYPE_CODE = 'KHAMBENH_LOAI_TRIEUCHUNGLS'        order by LST_DICTIONARY.IDX]
2020-07-16 15:44:21,542 [1] DEBUG - Statement Id: [DAO00012_GetAllTCLS] PreparedStatement : [select MALOAITRIEUCHUNG DICTIONARY_TYPE_CODE, MALOAITRIEUCHUNG DICTIONARY_CODE,        TENTRIEUCHUNG DICTIONARY_NAME from TM_TRIEUCHUNGLS]
2020-07-16 15:44:21,711 [1] DEBUG - Statement Id: [DAO00305_GetListPhongBanKhoaNgoai] PreparedStatement : [select A.*, B.DICTIONARY_CODE from TM_PHONGBAN A        inner join LST_DICTIONARY B on A.LOAIPHONGBAN_ID = B.DICTIONARY_ID        and B.DICTIONARY_TYPE_CODE = 'LoaiPhongBan'        where A.TAMNGUNG = '0'        and B.DICTIONARY_CODE = 'KhoaNgoai'        order by A.TENPHONGBAN asc]
2020-07-16 15:44:25,659 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = '01819'               AND                   TM_SYS_SCREEN.PAGE = 'OPD22'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2020-07-16 15:44:25,860 [1] DEBUG - Statement Id: [DAO00403_QMS002_GetThongTinClient] PreparedStatement : [SELECT B.ID as QUEUE_ID, B.NAME AS QUEUE_NAME,A.ID AS CLIENT_ID , A.[NAME] AS CLIENT_NAME, ISNULL(A.[STATE],1) AS [STATE],(CASE C.NAME WHEN 'UT' THEN 1 ELSE 0 END) AS QUEUETYPE     , B.DEPARTMENT_ID,ISNULL(B.SECTION_ID,-1) AS SECTION_ID,A.IPSERVER,A.NAMEAUDIO,C.QUEUE_TYPE_CODE,C.QUEUE_TYPE_CODE_SOUND,S.[NAME] AS SECTIONNAME     FROM QMS_QUEUE B LEFT JOIN QMS_CLIENT A ON A.QUEUE_ID = B.ID     LEFT JOIN QMS_QUEUE_TYPE C ON B.QUEUETYPE_ID = C.ID     LEFT JOIN QMS_SECTION S ON B.SECTION_ID=S.ID     WHERE     (A.COMPUTERNAME = 'DESKTOP-89GE5BA' OR A.IPADDRESS = '10.15.167.38') AND A.[STATE] = 1 AND B.DEPARTMENT_ID='74'            AND B.BENHVIEN_ID = '01819']
2020-07-16 15:44:26,079 [1] DEBUG - Statement Id: [DAO00019_GetDanhsachKhambenh] PreparedStatement : [select *        from        (SELECT COUNT(*) OVER() as TOTALROWS, ROW_NUMBER() OVER(order by isnull(dv.SOTHUTU,'999999999'), dv.NGAYGIOYEUCAU) as ROWNUMBER,        bn.MAYTE, bn.TENBENHNHAN, bn.NAMSINH, bn.NGAYSINH as TUOI, ISNULL(CONVERT(VARCHAR(10), bn.NGAYSINH, 103),CAST(bn.NAMSINH AS varchar)) as NGAYSINH, bn.DIACHILIENLAC as DIACHI, bn.GIOITINH, GD.DESCRIPTION as TENGIOITINH,        tn.DOITUONG_ID, tn.THOIGIANTIEPNHAN, tn.BENHNHAN_ID, tn.TIEPNHAN_ID, tn.TRAITUYEN, tn.SOTIEPNHAN,        dv.DICHVU_ID, dv.NOITHUCHIEN_ID, isnull(dv.NGAYTAO, dv.NGAYCAPNHAT) as THOIGIANDKDICHVU,        dv.KHAN, dv.NOIYEUCAU_ID, dv.NGAYGIOYEUCAU, dv.BACSICHIDINH_ID, dv.DONVIGIOITHIEU_ID, dv.NGUOIGIOITHIEU_ID,        tn.NOIGIOITHIEU_ID, kbnt.HUONGGIAIQUYET_ID,        dv.DVYEUCAU_ID, dv.MARIS, dv.TRANGTHAI as TRANGTHAICODE, B.TENNHOMDICHVU, dv.SOPHIEUYEUCAU, dv.KHAMBENH_NGOAITRU_ID, dv.NGUOICAPNHAT_ID, dv.NGAYCAPNHAT,        CASE WHEN Left(B.MANHOMDICHVU,2) = '03' THEN '02' ELSE Left(B.MANHOMDICHVU,2) END AS MANHOMDICHVU, B.MANHOMDICHVU as MANHOMDICHVUCHITIET, tn.TRANGTHAI as TRANGTHAI_TIEPNHAN,        'False' as DAKHAM, isnull(dv.SOTHUTU,'999999999') as SOHANGDOI,        vp.DATHANHTOAN, dv.TRANGTHAI_WFL,        BA.SOBENHAN, dv.CHANDOAN, dt.TENDOITUONG, isnull(kbnt.THOIGIANKHAM, dv.NGAYCAPNHAT) as THOIGIANKHAM,        tn.SOBHYT          ,           tn.UUTIEN                 FROM TT_DVYEUCAU (NOLOCK) dv        inner join TT_TIEPNHAN (NOLOCK) tn on dv.TIEPNHAN_ID = tn.TIEPNHAN_ID        inner join TT_BENHNHAN (NOLOCK) bn on tn.BENHNHAN_ID = bn.BENHNHAN_ID        inner join TM_DICHVU A on A.DICHVU_ID = dv.DICHVU_ID        inner join TM_NHOMDICHVU B on B.NHOMDICHVU_ID = A.NHOMDICHVU_ID        inner join TT_VIENPHI(NOLOCK) VP on VP.TIEPNHAN_ID = tn.TIEPNHAN_ID and VP.DICHVU_ID = dv.DICHVU_ID and VP.REF_ID = dv.DVYEUCAU_ID        left join TT_NOITRU_BENHAN (NOLOCK) BA on BA.TIEPNHAN_ID = tn.TIEPNHAN_ID AND dv.BENHAN_ID = BA.BENHAN_ID        inner join TM_GENDER GD on GD.ID = bn.GIOITINH        left join TT_NGOAITRU_KHAMBENH (NOLOCK) kbnt on kbnt.KHAMBENH_ID = dv.KHAMBENH_NGOAITRU_ID        inner join TM_DOITUONG dt on dt.DOITUONG_ID = tn.DOITUONG_ID        where        dv.DICHVU_ID IS NOT NULL        and tn.BENHVIEN_ID = '01819'        and HUYYEUCAU = 0        and dv.NGAYHENCLS is NULL         and           dv.NGAYYEUCAU >= '7/16/2020 12:00:00 AM'         and           dv.NGAYYEUCAU <= '7/16/2020 12:00:00 AM'         and           dv.NOITHUCHIEN_ID = 74          AND             (                         ((dv.TRANGTHAI_WFL = 'CHUAKETQUA' or (dv.TRANGTHAI = 'CHUAKETQUA' and dv.TRANGTHAI_WFL = 'HOANTHANH')) and (isnull(kbnt.HUONGGIAIQUYET_ID, 0) = 0)))            and (tn.TRANGTHAI != 'HOANTHANH')           and           (CASE WHEN Left(B.MANHOMDICHVU,2) = '03' THEN '02' ELSE Left(B.MANHOMDICHVU,2) END) = '04'                 ) lst                    where          lst.ROWNUMBER between 1 and 19                 order by SOHANGDOI, NGAYGIOYEUCAU asc]
2020-07-16 15:44:27,497 [1] DEBUG - Statement Id: [DAO00017_GetLoaiGiaByDoiTuongId] PreparedStatement : [select dtlg.DOUUTIEN, dtlg.DOITUONG_ID, lg.LOAIGIA_ID, lg.TENLOAIGIA, lg.MALOAIGIA              from TM_LOAIGIA lg              left join TM_DOITUONG_LOAIGIA dtlg              on lg.LOAIGIA_ID = dtlg.LOAIGIA_ID and dtlg.BENHVIEN_ID = '01819'              where lg.TAMNGUNG = 0 and lg.BENHVIEN_ID = '01819'                             order by dtlg.DOUUTIEN]
2020-07-16 15:44:27,554 [1] DEBUG - Statement Id: [DAO00012_GetLoaiTCLS] PreparedStatement : [select DICTIONARY_ID, DICTIONARY_CODE, DICTIONARY_NAME, cast('0' as Bit) CHON        from LST_DICTIONARY              where DICTIONARY_TYPE_CODE = 'KHAMBENH_LOAI_TRIEUCHUNGLS'        order by LST_DICTIONARY.IDX]
2020-07-16 15:44:27,580 [1] DEBUG - Statement Id: [DAO00012_GetAllTCLS] PreparedStatement : [select MALOAITRIEUCHUNG DICTIONARY_TYPE_CODE, MALOAITRIEUCHUNG DICTIONARY_CODE,        TENTRIEUCHUNG DICTIONARY_NAME from TM_TRIEUCHUNGLS]
2020-07-16 15:44:27,608 [1] DEBUG - Statement Id: [DAO00019_ThongTinBenhNhanDvYeuCau] PreparedStatement : [select distinct A.SOTIEPNHAN, A.TIEPNHAN_ID, A.DOITUONG_ID, A.TRANGTHAI,        A.LOAITHANHVIEN_ID, A.SUDUNG_BHTN, A.THE_ID, A.THANHVIEN_ID, A.VIP, A.NGUON_BENHNHAN_ID, A.BAOLANH_VIENPHI, A.NGAYMIENDONGCHITRA,        B.*,  C.DICHVU_ID, C.DVYEUCAU_ID, C.NOITHUCHIEN_ID, A.SOBHYT        from TT_TIEPNHAN A        inner join TT_DVYEUCAU C on C.TIEPNHAN_ID = A.TIEPNHAN_ID        inner join TT_BENHNHAN B on B.BENHNHAN_ID = A.BENHNHAN_ID and B.ACTIVE = '1'        where                    C.DVYEUCAU_ID = '13144'                 and A.BENHVIEN_ID = '01819']
2020-07-16 15:44:27,729 [1] DEBUG - Statement Id: [DAO00017_GetLoaiGiaByDoiTuongId] PreparedStatement : [select dtlg.DOUUTIEN, dtlg.DOITUONG_ID, lg.LOAIGIA_ID, lg.TENLOAIGIA, lg.MALOAIGIA              from TM_LOAIGIA lg              left join TM_DOITUONG_LOAIGIA dtlg              on lg.LOAIGIA_ID = dtlg.LOAIGIA_ID and dtlg.BENHVIEN_ID = '01819'              where lg.TAMNGUNG = 0 and lg.BENHVIEN_ID = '01819'                             order by dtlg.DOUUTIEN]
2020-07-16 15:44:27,782 [1] DEBUG - Statement Id: [DAO00092_GetList_ToathuocNgoaitru] PreparedStatement : [select A.*, B.PHAMVI_ID, C.KHODUOC_ID from TM_TOATHUOC_NGOAITRU A        left join TM_DUOC_PHAMVISUDUNG B on B.MAPHAMVI = A.MAPHAMVI        left join (select distinct PHAMVI_ID, KHODUOC_ID from TM_DUOC_PHAMVISD_MAPPING) C on C.PHAMVI_ID = B.PHAMVI_ID        where A.TAMNGUNG != '1' and A.BENHVIEN_ID = '01819'        ORDER BY A.SAPXEP ASC]
2020-07-16 15:44:27,850 [1] DEBUG - Statement Id: [DAO00063_GetListDTPhamviToathuoc] PreparedStatement : [select B.*, C.KHODUOC_ID        from TM_PHAMVI_DOITUONG_TOATHUOC B        left join (select distinct PHAMVI_ID, KHODUOC_ID from TM_DUOC_PHAMVISD_MAPPING) C on C.PHAMVI_ID = B.PHAMVI_ID        where B.TAMNGUNG != '1' and B.DOITUONG_ID = '4']
2020-07-16 15:44:27,903 [1] DEBUG - Statement Id: [DAO00014_KiemTraDVYCCoGiaBHYT] PreparedStatement : [select *        from TT_VIENPHI        where REF_ID  = '13144' and REF_TABLE = 'TT_DVYEUCAU' and BHYT_DONGIA > 0]
2020-07-16 15:44:27,943 [1] DEBUG - Statement Id: [DAO00305_GetAllLoaiToaThuoc] PreparedStatement : [declare @LOAITOATHUOC varchar(200)        set @LOAITOATHUOC = (select top 1 LOAITOATHUOC = STUFF((SELECT ',' + LOAITOATHUOC FROM TM_TOATHUOC_NGOAITRU where BENHVIEN_ID = '01819' FOR XML PATH ('')), 1, 1, '')        from TM_TOATHUOC_NGOAITRU)        set @LOAITOATHUOC = '''' +  REPLACE(@LOAITOATHUOC,',',''',''') + ''''        select @LOAITOATHUOC as LOAITOATHUOC]
2020-07-16 15:44:28,019 [1] DEBUG - Statement Id: [DAO00040_LayListToaMau] PreparedStatement : [select A.*, dc.TENDUOCDAYDU, dc.BHYT DUOC_BHYT, ld.LOAIVATTU_ID, ld.MALOAIDUOC, dd.DICTIONARY_NAME DUONGDUNG, dc.TAMNGUNG            from TT_TOATHUOCMAU A            left join TM_DUOC dc on A.DUOC_ID = dc.DUOC_ID            left join TM_LOAIDUOC ld on dc.LOAIDUOC_ID = ld.LOAIDUOC_ID            left join (select * from LST_DICTIONARY where DICTIONARY_TYPE_CODE like 'DuongDung') dd on dd.DICTIONARY_ID = dc.DUONGDUNG_ID            where (1=1)             and               A.BACSI_ID  = 1             and               A.LOAITOATHUOC IN ('BV','MN','BV','KTBV','KTBV','BV')]
2020-07-16 15:44:28,115 [1] DEBUG - Statement Id: [DAO00305_GetAllLoaiToaThuoc] PreparedStatement : [declare @LOAITOATHUOC varchar(200)        set @LOAITOATHUOC = (select top 1 LOAITOATHUOC = STUFF((SELECT ',' + LOAITOATHUOC FROM TM_TOATHUOC_NGOAITRU where BENHVIEN_ID = '01819' FOR XML PATH ('')), 1, 1, '')        from TM_TOATHUOC_NGOAITRU)        set @LOAITOATHUOC = '''' +  REPLACE(@LOAITOATHUOC,',',''',''') + ''''        select @LOAITOATHUOC as LOAITOATHUOC]
2020-07-16 15:44:28,184 [1] DEBUG - Statement Id: [DAO00040_LayListToaMau] PreparedStatement : [select A.*, dc.TENDUOCDAYDU, dc.BHYT DUOC_BHYT, ld.LOAIVATTU_ID, ld.MALOAIDUOC, dd.DICTIONARY_NAME DUONGDUNG, dc.TAMNGUNG            from TT_TOATHUOCMAU A            left join TM_DUOC dc on A.DUOC_ID = dc.DUOC_ID            left join TM_LOAIDUOC ld on dc.LOAIDUOC_ID = ld.LOAIDUOC_ID            left join (select * from LST_DICTIONARY where DICTIONARY_TYPE_CODE like 'DuongDung') dd on dd.DICTIONARY_ID = dc.DUONGDUNG_ID            where (1=1)             and               A.BACSI_ID  = 1             and               A.LOAITOATHUOC IN ('BV','MN','BV','KTBV','KTBV','BV')]
2020-07-16 15:44:28,223 [1] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoVaBookingCOM23UpdateRedis_TheoPhamvi] PreparedStatement : [declare @TOAMUANGOAI int = 0;        select @TOAMUANGOAI = isnull(VALUE,0) from TM_SYS_APPSETTINGS where CODE = 'OPD_TOAMUANGOAI_DUNGDANHMUC_DUOC'                if @TOAMUANGOAI = 1        begin        select  distinct '0' + '_' + LTRIM(d.DUOC_ID) + '_' + '0' as DUOC_KEY, 999999999 as SOLUONG        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = '01819'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = '01819')        where  @param0  = 0        union all        select distinct tk.DUOC_KEY, tk.SOLUONG        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = '01819'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = '01819')        inner join        (        select  LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')) DUOC_KEY, (SUM(dtk.SOLUONG) - isnull(sum(A.SOLUONG),0) - isnull(sum(B.SOLUONG),0)) SOLUONG, pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        from (select sum(soluong) soluong,duoc_id,nguonduoc_id,khoduoc_id,benhvien_id from TT_DUOC_TONKHO  group by duoc_id,nguonduoc_id,khoduoc_id,benhvien_id) dtk        inner join TM_DUOC_PHAMVISD_MAPPING pvsd on dtk.KHODUOC_ID = pvsd.KHODUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NOITRU        where TRANGTHAI != 'HUY' and PHAMVI_ID =  @param0         group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) B on B.DUOC_ID = dtk.DUOC_ID and B.PHAMVI_ID = pvsd.PHAMVI_ID and B.NGUONHANG_ID = dtk.NGUONDUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NGOAITRU        where TRANGTHAI != 'HUY' and PHAMVI_ID =  @param0         group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) A on A.DUOC_ID = dtk.DUOC_ID and A.PHAMVI_ID = pvsd.PHAMVI_ID and A.NGUONHANG_ID = dtk.NGUONDUOC_ID        where dtk.BENHVIEN_ID = '01819'        group by LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')), pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        ) tk on tk.DUOC_ID = d.DUOC_ID        left join TM_DUOC_PHAMVISUDUNG kd on kd.PHAMVI_ID = tk.PHAMVI_ID and kd.BENHVIEN_ID = '01819'        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = tk.NGUONDUOC_ID and nh.BENHVIEN_ID = '01819'        where d.BENHVIEN_ID = '01819' and tk.PHAMVI_ID =  @param0         end        else        begin        select distinct tk.DUOC_KEY, tk.SOLUONG        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = '01819'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = '01819')        inner join        (        select  LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')) DUOC_KEY, (SUM(dtk.SOLUONG) - isnull(sum(A.SOLUONG),0) - isnull(sum(B.SOLUONG),0)) SOLUONG, pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        from (select sum(soluong) soluong,duoc_id,nguonduoc_id,khoduoc_id,benhvien_id from TT_DUOC_TONKHO        group by duoc_id,nguonduoc_id,khoduoc_id,benhvien_id) dtk        inner join TM_DUOC_PHAMVISD_MAPPING pvsd on dtk.KHODUOC_ID = pvsd.KHODUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NOITRU        where TRANGTHAI != 'HUY' and PHAMVI_ID =  @param0         group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) B on B.DUOC_ID = dtk.DUOC_ID and B.PHAMVI_ID = pvsd.PHAMVI_ID and B.NGUONHANG_ID = dtk.NGUONDUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NGOAITRU        where TRANGTHAI != 'HUY' and PHAMVI_ID =  @param0         group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) A on A.DUOC_ID = dtk.DUOC_ID and A.PHAMVI_ID = pvsd.PHAMVI_ID and A.NGUONHANG_ID = dtk.NGUONDUOC_ID        where dtk.BENHVIEN_ID = '01819'        group by LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')), pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        ) tk on tk.DUOC_ID = d.DUOC_ID        left join TM_DUOC_PHAMVISUDUNG kd on kd.PHAMVI_ID = tk.PHAMVI_ID and kd.BENHVIEN_ID = '01819'        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = tk.NGUONDUOC_ID and nh.BENHVIEN_ID = '01819'        where d.BENHVIEN_ID = '01819' and tk.PHAMVI_ID =  @param0         end]
2020-07-16 15:44:28,223 [1] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoVaBookingCOM23UpdateRedis_TheoPhamvi] Parameters: [@param0=[PHAMVI_ID,2]]
2020-07-16 15:44:28,223 [1] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoVaBookingCOM23UpdateRedis_TheoPhamvi] Types: [@param0=[Int64, System.Int64]]
2020-07-16 15:44:28,428 [1] DEBUG - Statement Id: [DAO00013_GetTienSuBenh] PreparedStatement : [select TIENSUBENH, TIENSUDIUNG        from TT_BENHNHAN        where TT_BENHNHAN.BENHNHAN_ID  = '8728']
2020-07-16 15:44:28,610 [1] DEBUG - Statement Id: [DAO00095_GetTTDiUngThuoc] PreparedStatement : [select *              from TT_BENHNHAN_DIUNG_THUOC              where BENHNHAN_ID = '8728'              and BENHVIEN_ID = '01819']
2020-07-16 15:44:28,647 [1] DEBUG - Statement Id: [DAO00014_GetTotalChiPhiDVByTiepNhan] PreparedStatement : [select sum(THANHTIEN_DOANHTHU) as THANHTIEN_DOANHTHU from TT_VIENPHI        where ACTIVE = '1'        and TIEPNHAN_ID = '8744'        and REF_TABLE = 'TT_DVYEUCAU'        and exists (select DVYEUCAU_ID from TT_DVYEUCAU where HUYYEUCAU = '0' and TIEPNHAN_ID = '8744' and TT_VIENPHI.REF_ID = DVYEUCAU_ID)]
2020-07-16 15:44:28,693 [1] DEBUG - Statement Id: [DAO00014_GetKhamBenhInfo] PreparedStatement : [select * from TT_NGOAITRU_KHAMBENH where KHAMBENH_ID =        (select KHAMBENH_NGOAITRU_ID from TT_DVYEUCAU where DVYEUCAU_ID = '13144')]
2020-07-16 15:44:28,725 [1] DEBUG - Statement Id: [DAO00014_GetSoCaKhamTrongNgay] PreparedStatement : [select Count(KB.KHAMBENH_ID) as SOCAKHAMTRONGNGAY        from TT_NGOAITRU_KHAMBENH KB        inner join TT_TIEPNHAN TN on TN.TIEPNHAN_ID = KB.TIEPNHAN_ID        where KB.NGAYKHAM = convert(date, GETDATE())        and KB.BACSIKHAM_ID = '1'        and KB.BENHVIEN_ID = '01819'        and TN.SOBHYT IS NOT NULL and TN.SOBHYT != '']
2020-07-16 15:44:28,806 [1] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoVaBookingCOM23UpdateRedis_TheoPhamvi] PreparedStatement : [declare @TOAMUANGOAI int = 0;        select @TOAMUANGOAI = isnull(VALUE,0) from TM_SYS_APPSETTINGS where CODE = 'OPD_TOAMUANGOAI_DUNGDANHMUC_DUOC'                if @TOAMUANGOAI = 1        begin        select  distinct '0' + '_' + LTRIM(d.DUOC_ID) + '_' + '0' as DUOC_KEY, 999999999 as SOLUONG        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = '01819'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = '01819')        where  @param0  = 0        union all        select distinct tk.DUOC_KEY, tk.SOLUONG        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = '01819'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = '01819')        inner join        (        select  LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')) DUOC_KEY, (SUM(dtk.SOLUONG) - isnull(sum(A.SOLUONG),0) - isnull(sum(B.SOLUONG),0)) SOLUONG, pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        from (select sum(soluong) soluong,duoc_id,nguonduoc_id,khoduoc_id,benhvien_id from TT_DUOC_TONKHO  group by duoc_id,nguonduoc_id,khoduoc_id,benhvien_id) dtk        inner join TM_DUOC_PHAMVISD_MAPPING pvsd on dtk.KHODUOC_ID = pvsd.KHODUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NOITRU        where TRANGTHAI != 'HUY' and PHAMVI_ID =  @param0         group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) B on B.DUOC_ID = dtk.DUOC_ID and B.PHAMVI_ID = pvsd.PHAMVI_ID and B.NGUONHANG_ID = dtk.NGUONDUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NGOAITRU        where TRANGTHAI != 'HUY' and PHAMVI_ID =  @param0         group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) A on A.DUOC_ID = dtk.DUOC_ID and A.PHAMVI_ID = pvsd.PHAMVI_ID and A.NGUONHANG_ID = dtk.NGUONDUOC_ID        where dtk.BENHVIEN_ID = '01819'        group by LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')), pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        ) tk on tk.DUOC_ID = d.DUOC_ID        left join TM_DUOC_PHAMVISUDUNG kd on kd.PHAMVI_ID = tk.PHAMVI_ID and kd.BENHVIEN_ID = '01819'        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = tk.NGUONDUOC_ID and nh.BENHVIEN_ID = '01819'        where d.BENHVIEN_ID = '01819' and tk.PHAMVI_ID =  @param0         end        else        begin        select distinct tk.DUOC_KEY, tk.SOLUONG        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = '01819'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = '01819')        inner join        (        select  LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')) DUOC_KEY, (SUM(dtk.SOLUONG) - isnull(sum(A.SOLUONG),0) - isnull(sum(B.SOLUONG),0)) SOLUONG, pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        from (select sum(soluong) soluong,duoc_id,nguonduoc_id,khoduoc_id,benhvien_id from TT_DUOC_TONKHO        group by duoc_id,nguonduoc_id,khoduoc_id,benhvien_id) dtk        inner join TM_DUOC_PHAMVISD_MAPPING pvsd on dtk.KHODUOC_ID = pvsd.KHODUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NOITRU        where TRANGTHAI != 'HUY' and PHAMVI_ID =  @param0         group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) B on B.DUOC_ID = dtk.DUOC_ID and B.PHAMVI_ID = pvsd.PHAMVI_ID and B.NGUONHANG_ID = dtk.NGUONDUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NGOAITRU        where TRANGTHAI != 'HUY' and PHAMVI_ID =  @param0         group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) A on A.DUOC_ID = dtk.DUOC_ID and A.PHAMVI_ID = pvsd.PHAMVI_ID and A.NGUONHANG_ID = dtk.NGUONDUOC_ID        where dtk.BENHVIEN_ID = '01819'        group by LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')), pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        ) tk on tk.DUOC_ID = d.DUOC_ID        left join TM_DUOC_PHAMVISUDUNG kd on kd.PHAMVI_ID = tk.PHAMVI_ID and kd.BENHVIEN_ID = '01819'        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = tk.NGUONDUOC_ID and nh.BENHVIEN_ID = '01819'        where d.BENHVIEN_ID = '01819' and tk.PHAMVI_ID =  @param0         end]
2020-07-16 15:44:28,806 [1] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoVaBookingCOM23UpdateRedis_TheoPhamvi] Parameters: [@param0=[PHAMVI_ID,2]]
2020-07-16 15:44:28,806 [1] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoVaBookingCOM23UpdateRedis_TheoPhamvi] Types: [@param0=[Int64, System.Int64]]
2020-07-16 15:44:28,948 [1] DEBUG - Statement Id: [DAO00019_ThongTinBenhNhanDvYeuCau] PreparedStatement : [select distinct A.SOTIEPNHAN, A.TIEPNHAN_ID, A.DOITUONG_ID, A.TRANGTHAI,        A.LOAITHANHVIEN_ID, A.SUDUNG_BHTN, A.THE_ID, A.THANHVIEN_ID, A.VIP, A.NGUON_BENHNHAN_ID, A.BAOLANH_VIENPHI, A.NGAYMIENDONGCHITRA,        B.*,  C.DICHVU_ID, C.DVYEUCAU_ID, C.NOITHUCHIEN_ID, A.SOBHYT        from TT_TIEPNHAN A        inner join TT_DVYEUCAU C on C.TIEPNHAN_ID = A.TIEPNHAN_ID        inner join TT_BENHNHAN B on B.BENHNHAN_ID = A.BENHNHAN_ID and B.ACTIVE = '1'        where                    C.DVYEUCAU_ID = '13144'                 and A.BENHVIEN_ID = '01819']
2020-07-16 15:44:29,027 [1] DEBUG - Statement Id: [DAO00017_GetLoaiGiaByDoiTuongId] PreparedStatement : [select dtlg.DOUUTIEN, dtlg.DOITUONG_ID, lg.LOAIGIA_ID, lg.TENLOAIGIA, lg.MALOAIGIA              from TM_LOAIGIA lg              left join TM_DOITUONG_LOAIGIA dtlg              on lg.LOAIGIA_ID = dtlg.LOAIGIA_ID and dtlg.BENHVIEN_ID = '01819'              where lg.TAMNGUNG = 0 and lg.BENHVIEN_ID = '01819'                             order by dtlg.DOUUTIEN]
2020-07-16 15:44:29,059 [1] DEBUG - Statement Id: [DAO00092_GetList_ToathuocNgoaitru] PreparedStatement : [select A.*, B.PHAMVI_ID, C.KHODUOC_ID from TM_TOATHUOC_NGOAITRU A        left join TM_DUOC_PHAMVISUDUNG B on B.MAPHAMVI = A.MAPHAMVI        left join (select distinct PHAMVI_ID, KHODUOC_ID from TM_DUOC_PHAMVISD_MAPPING) C on C.PHAMVI_ID = B.PHAMVI_ID        where A.TAMNGUNG != '1' and A.BENHVIEN_ID = '01819'        ORDER BY A.SAPXEP ASC]
2020-07-16 15:44:29,083 [1] DEBUG - Statement Id: [DAO00063_GetListDTPhamviToathuoc] PreparedStatement : [select B.*, C.KHODUOC_ID        from TM_PHAMVI_DOITUONG_TOATHUOC B        left join (select distinct PHAMVI_ID, KHODUOC_ID from TM_DUOC_PHAMVISD_MAPPING) C on C.PHAMVI_ID = B.PHAMVI_ID        where B.TAMNGUNG != '1' and B.DOITUONG_ID = '4']
2020-07-16 15:44:29,107 [1] DEBUG - Statement Id: [DAO00014_KiemTraDVYCCoGiaBHYT] PreparedStatement : [select *        from TT_VIENPHI        where REF_ID  = '13144' and REF_TABLE = 'TT_DVYEUCAU' and BHYT_DONGIA > 0]
2020-07-16 15:44:29,137 [1] DEBUG - Statement Id: [DAO00305_GetAllLoaiToaThuoc] PreparedStatement : [declare @LOAITOATHUOC varchar(200)        set @LOAITOATHUOC = (select top 1 LOAITOATHUOC = STUFF((SELECT ',' + LOAITOATHUOC FROM TM_TOATHUOC_NGOAITRU where BENHVIEN_ID = '01819' FOR XML PATH ('')), 1, 1, '')        from TM_TOATHUOC_NGOAITRU)        set @LOAITOATHUOC = '''' +  REPLACE(@LOAITOATHUOC,',',''',''') + ''''        select @LOAITOATHUOC as LOAITOATHUOC]
2020-07-16 15:44:29,205 [1] DEBUG - Statement Id: [DAO00040_LayListToaMau] PreparedStatement : [select A.*, dc.TENDUOCDAYDU, dc.BHYT DUOC_BHYT, ld.LOAIVATTU_ID, ld.MALOAIDUOC, dd.DICTIONARY_NAME DUONGDUNG, dc.TAMNGUNG            from TT_TOATHUOCMAU A            left join TM_DUOC dc on A.DUOC_ID = dc.DUOC_ID            left join TM_LOAIDUOC ld on dc.LOAIDUOC_ID = ld.LOAIDUOC_ID            left join (select * from LST_DICTIONARY where DICTIONARY_TYPE_CODE like 'DuongDung') dd on dd.DICTIONARY_ID = dc.DUONGDUNG_ID            where (1=1)             and               A.BACSI_ID  = 1             and               A.LOAITOATHUOC IN ('BV','MN','BV','KTBV','KTBV','BV')]
2020-07-16 15:44:29,257 [1] DEBUG - Statement Id: [DAO00305_GetAllLoaiToaThuoc] PreparedStatement : [declare @LOAITOATHUOC varchar(200)        set @LOAITOATHUOC = (select top 1 LOAITOATHUOC = STUFF((SELECT ',' + LOAITOATHUOC FROM TM_TOATHUOC_NGOAITRU where BENHVIEN_ID = '01819' FOR XML PATH ('')), 1, 1, '')        from TM_TOATHUOC_NGOAITRU)        set @LOAITOATHUOC = '''' +  REPLACE(@LOAITOATHUOC,',',''',''') + ''''        select @LOAITOATHUOC as LOAITOATHUOC]
2020-07-16 15:44:29,326 [1] DEBUG - Statement Id: [DAO00040_LayListToaMau] PreparedStatement : [select A.*, dc.TENDUOCDAYDU, dc.BHYT DUOC_BHYT, ld.LOAIVATTU_ID, ld.MALOAIDUOC, dd.DICTIONARY_NAME DUONGDUNG, dc.TAMNGUNG            from TT_TOATHUOCMAU A            left join TM_DUOC dc on A.DUOC_ID = dc.DUOC_ID            left join TM_LOAIDUOC ld on dc.LOAIDUOC_ID = ld.LOAIDUOC_ID            left join (select * from LST_DICTIONARY where DICTIONARY_TYPE_CODE like 'DuongDung') dd on dd.DICTIONARY_ID = dc.DUONGDUNG_ID            where (1=1)             and               A.BACSI_ID  = 1             and               A.LOAITOATHUOC IN ('BV','MN','BV','KTBV','KTBV','BV')]
2020-07-16 15:44:29,365 [1] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoVaBookingCOM23UpdateRedis_TheoPhamvi] PreparedStatement : [declare @TOAMUANGOAI int = 0;        select @TOAMUANGOAI = isnull(VALUE,0) from TM_SYS_APPSETTINGS where CODE = 'OPD_TOAMUANGOAI_DUNGDANHMUC_DUOC'                if @TOAMUANGOAI = 1        begin        select  distinct '0' + '_' + LTRIM(d.DUOC_ID) + '_' + '0' as DUOC_KEY, 999999999 as SOLUONG        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = '01819'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = '01819')        where  @param0  = 0        union all        select distinct tk.DUOC_KEY, tk.SOLUONG        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = '01819'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = '01819')        inner join        (        select  LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')) DUOC_KEY, (SUM(dtk.SOLUONG) - isnull(sum(A.SOLUONG),0) - isnull(sum(B.SOLUONG),0)) SOLUONG, pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        from (select sum(soluong) soluong,duoc_id,nguonduoc_id,khoduoc_id,benhvien_id from TT_DUOC_TONKHO  group by duoc_id,nguonduoc_id,khoduoc_id,benhvien_id) dtk        inner join TM_DUOC_PHAMVISD_MAPPING pvsd on dtk.KHODUOC_ID = pvsd.KHODUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NOITRU        where TRANGTHAI != 'HUY' and PHAMVI_ID =  @param0         group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) B on B.DUOC_ID = dtk.DUOC_ID and B.PHAMVI_ID = pvsd.PHAMVI_ID and B.NGUONHANG_ID = dtk.NGUONDUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NGOAITRU        where TRANGTHAI != 'HUY' and PHAMVI_ID =  @param0         group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) A on A.DUOC_ID = dtk.DUOC_ID and A.PHAMVI_ID = pvsd.PHAMVI_ID and A.NGUONHANG_ID = dtk.NGUONDUOC_ID        where dtk.BENHVIEN_ID = '01819'        group by LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')), pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        ) tk on tk.DUOC_ID = d.DUOC_ID        left join TM_DUOC_PHAMVISUDUNG kd on kd.PHAMVI_ID = tk.PHAMVI_ID and kd.BENHVIEN_ID = '01819'        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = tk.NGUONDUOC_ID and nh.BENHVIEN_ID = '01819'        where d.BENHVIEN_ID = '01819' and tk.PHAMVI_ID =  @param0         end        else        begin        select distinct tk.DUOC_KEY, tk.SOLUONG        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = '01819'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = '01819')        inner join        (        select  LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')) DUOC_KEY, (SUM(dtk.SOLUONG) - isnull(sum(A.SOLUONG),0) - isnull(sum(B.SOLUONG),0)) SOLUONG, pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        from (select sum(soluong) soluong,duoc_id,nguonduoc_id,khoduoc_id,benhvien_id from TT_DUOC_TONKHO        group by duoc_id,nguonduoc_id,khoduoc_id,benhvien_id) dtk        inner join TM_DUOC_PHAMVISD_MAPPING pvsd on dtk.KHODUOC_ID = pvsd.KHODUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NOITRU        where TRANGTHAI != 'HUY' and PHAMVI_ID =  @param0         group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) B on B.DUOC_ID = dtk.DUOC_ID and B.PHAMVI_ID = pvsd.PHAMVI_ID and B.NGUONHANG_ID = dtk.NGUONDUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NGOAITRU        where TRANGTHAI != 'HUY' and PHAMVI_ID =  @param0         group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) A on A.DUOC_ID = dtk.DUOC_ID and A.PHAMVI_ID = pvsd.PHAMVI_ID and A.NGUONHANG_ID = dtk.NGUONDUOC_ID        where dtk.BENHVIEN_ID = '01819'        group by LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')), pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        ) tk on tk.DUOC_ID = d.DUOC_ID        left join TM_DUOC_PHAMVISUDUNG kd on kd.PHAMVI_ID = tk.PHAMVI_ID and kd.BENHVIEN_ID = '01819'        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = tk.NGUONDUOC_ID and nh.BENHVIEN_ID = '01819'        where d.BENHVIEN_ID = '01819' and tk.PHAMVI_ID =  @param0         end]
2020-07-16 15:44:29,365 [1] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoVaBookingCOM23UpdateRedis_TheoPhamvi] Parameters: [@param0=[PHAMVI_ID,2]]
2020-07-16 15:44:29,365 [1] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoVaBookingCOM23UpdateRedis_TheoPhamvi] Types: [@param0=[Int64, System.Int64]]
2020-07-16 15:44:29,401 [1] DEBUG - Statement Id: [DAO00013_GetTienSuBenh] PreparedStatement : [select TIENSUBENH, TIENSUDIUNG        from TT_BENHNHAN        where TT_BENHNHAN.BENHNHAN_ID  = '8728']
2020-07-16 15:44:29,424 [1] DEBUG - Statement Id: [DAO00095_GetTTDiUngThuoc] PreparedStatement : [select *              from TT_BENHNHAN_DIUNG_THUOC              where BENHNHAN_ID = '8728'              and BENHVIEN_ID = '01819']
2020-07-16 15:44:29,447 [1] DEBUG - Statement Id: [DAO00014_GetTotalChiPhiDVByTiepNhan] PreparedStatement : [select sum(THANHTIEN_DOANHTHU) as THANHTIEN_DOANHTHU from TT_VIENPHI        where ACTIVE = '1'        and TIEPNHAN_ID = '8744'        and REF_TABLE = 'TT_DVYEUCAU'        and exists (select DVYEUCAU_ID from TT_DVYEUCAU where HUYYEUCAU = '0' and TIEPNHAN_ID = '8744' and TT_VIENPHI.REF_ID = DVYEUCAU_ID)]
2020-07-16 15:44:29,473 [1] DEBUG - Statement Id: [DAO00014_GetKhamBenhInfo] PreparedStatement : [select * from TT_NGOAITRU_KHAMBENH where KHAMBENH_ID =        (select KHAMBENH_NGOAITRU_ID from TT_DVYEUCAU where DVYEUCAU_ID = '13144')]
2020-07-16 15:44:29,498 [1] DEBUG - Statement Id: [DAO00014_GetSoCaKhamTrongNgay] PreparedStatement : [select Count(KB.KHAMBENH_ID) as SOCAKHAMTRONGNGAY        from TT_NGOAITRU_KHAMBENH KB        inner join TT_TIEPNHAN TN on TN.TIEPNHAN_ID = KB.TIEPNHAN_ID        where KB.NGAYKHAM = convert(date, GETDATE())        and KB.BACSIKHAM_ID = '1'        and KB.BENHVIEN_ID = '01819'        and TN.SOBHYT IS NOT NULL and TN.SOBHYT != '']
2020-07-16 15:44:29,547 [1] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoVaBookingCOM23UpdateRedis_TheoPhamvi] PreparedStatement : [declare @TOAMUANGOAI int = 0;        select @TOAMUANGOAI = isnull(VALUE,0) from TM_SYS_APPSETTINGS where CODE = 'OPD_TOAMUANGOAI_DUNGDANHMUC_DUOC'                if @TOAMUANGOAI = 1        begin        select  distinct '0' + '_' + LTRIM(d.DUOC_ID) + '_' + '0' as DUOC_KEY, 999999999 as SOLUONG        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = '01819'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = '01819')        where  @param0  = 0        union all        select distinct tk.DUOC_KEY, tk.SOLUONG        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = '01819'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = '01819')        inner join        (        select  LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')) DUOC_KEY, (SUM(dtk.SOLUONG) - isnull(sum(A.SOLUONG),0) - isnull(sum(B.SOLUONG),0)) SOLUONG, pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        from (select sum(soluong) soluong,duoc_id,nguonduoc_id,khoduoc_id,benhvien_id from TT_DUOC_TONKHO  group by duoc_id,nguonduoc_id,khoduoc_id,benhvien_id) dtk        inner join TM_DUOC_PHAMVISD_MAPPING pvsd on dtk.KHODUOC_ID = pvsd.KHODUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NOITRU        where TRANGTHAI != 'HUY' and PHAMVI_ID =  @param0         group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) B on B.DUOC_ID = dtk.DUOC_ID and B.PHAMVI_ID = pvsd.PHAMVI_ID and B.NGUONHANG_ID = dtk.NGUONDUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NGOAITRU        where TRANGTHAI != 'HUY' and PHAMVI_ID =  @param0         group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) A on A.DUOC_ID = dtk.DUOC_ID and A.PHAMVI_ID = pvsd.PHAMVI_ID and A.NGUONHANG_ID = dtk.NGUONDUOC_ID        where dtk.BENHVIEN_ID = '01819'        group by LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')), pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        ) tk on tk.DUOC_ID = d.DUOC_ID        left join TM_DUOC_PHAMVISUDUNG kd on kd.PHAMVI_ID = tk.PHAMVI_ID and kd.BENHVIEN_ID = '01819'        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = tk.NGUONDUOC_ID and nh.BENHVIEN_ID = '01819'        where d.BENHVIEN_ID = '01819' and tk.PHAMVI_ID =  @param0         end        else        begin        select distinct tk.DUOC_KEY, tk.SOLUONG        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = '01819'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = '01819')        inner join        (        select  LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')) DUOC_KEY, (SUM(dtk.SOLUONG) - isnull(sum(A.SOLUONG),0) - isnull(sum(B.SOLUONG),0)) SOLUONG, pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        from (select sum(soluong) soluong,duoc_id,nguonduoc_id,khoduoc_id,benhvien_id from TT_DUOC_TONKHO        group by duoc_id,nguonduoc_id,khoduoc_id,benhvien_id) dtk        inner join TM_DUOC_PHAMVISD_MAPPING pvsd on dtk.KHODUOC_ID = pvsd.KHODUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NOITRU        where TRANGTHAI != 'HUY' and PHAMVI_ID =  @param0         group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) B on B.DUOC_ID = dtk.DUOC_ID and B.PHAMVI_ID = pvsd.PHAMVI_ID and B.NGUONHANG_ID = dtk.NGUONDUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NGOAITRU        where TRANGTHAI != 'HUY' and PHAMVI_ID =  @param0         group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) A on A.DUOC_ID = dtk.DUOC_ID and A.PHAMVI_ID = pvsd.PHAMVI_ID and A.NGUONHANG_ID = dtk.NGUONDUOC_ID        where dtk.BENHVIEN_ID = '01819'        group by LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')), pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        ) tk on tk.DUOC_ID = d.DUOC_ID        left join TM_DUOC_PHAMVISUDUNG kd on kd.PHAMVI_ID = tk.PHAMVI_ID and kd.BENHVIEN_ID = '01819'        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = tk.NGUONDUOC_ID and nh.BENHVIEN_ID = '01819'        where d.BENHVIEN_ID = '01819' and tk.PHAMVI_ID =  @param0         end]
2020-07-16 15:44:29,547 [1] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoVaBookingCOM23UpdateRedis_TheoPhamvi] Parameters: [@param0=[PHAMVI_ID,2]]
2020-07-16 15:44:29,547 [1] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoVaBookingCOM23UpdateRedis_TheoPhamvi] Types: [@param0=[Int64, System.Int64]]
2020-07-16 15:44:37,345 [1] DEBUG - Statement Id: [DAO00305_GetListPhongBanKhoaNgoai] PreparedStatement : [select A.*, B.DICTIONARY_CODE from TM_PHONGBAN A        inner join LST_DICTIONARY B on A.LOAIPHONGBAN_ID = B.DICTIONARY_ID        and B.DICTIONARY_TYPE_CODE = 'LoaiPhongBan'        where A.TAMNGUNG = '0'        and B.DICTIONARY_CODE = 'KhoaNgoai'        order by A.TENPHONGBAN asc]
2020-07-16 15:44:37,371 [1] DEBUG - Statement Id: [DAO00068_GetLastedSinhHieuInfo] PreparedStatement : [select top (1) *, CHISOBMI as BMI              from TT_NGOAITRU_KHAMBENH_SINHHIEU              where BENHNHAN_ID = '8728'              order by KHAMBENH_SINHHIEU_ID desc]
2020-07-16 15:50:04,804 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = '01819'               AND                   TM_SYS_SCREEN.PAGE = 'BIL31'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2020-07-16 15:50:05,039 [1] DEBUG - Statement Id: [DAO00019_GetListDichVuDuocDongTien] PreparedStatement : [select * from        (        select COUNT(*) OVER() as TOTALROWS, ROW_NUMBER() OVER(order by tn.MAYTE, isnull(tn.SOTHUTU,'999999999')) as ROWNUMBER,        ISNULL(A.DUOC_ID, A.DICHVU_ID) as DICHVU_ID, ISNULL(B.TENDUOCDAYDU, C.TENDICHVU) as TENDICHVU,        (CASE WHEN A.DUOC_ID is null THEN E.NOITHUCHIEN_ID ELSE 0 END) as NOITHUCHIEN_ID,        0 as NOIYEUCAU_ID, 0 as NOIGIOITHIEU_ID, 0 as BACSICHIDINH_ID, isnull(E.NGAYTAO, E.NGAYCAPNHAT) as THOIGIANDKDICHVU,        tn.*, isnull(tn.SOTHUTU,'999999999') as SOHANGDOI, null as KHAN, '' as STATUS_CODE        from TT_VIENPHI A        left join TM_DUOC B on B.DUOC_ID = A.DUOC_ID and B.BENHVIEN_ID = '01819'        left join TM_DICHVU C on C.DICHVU_ID = A.DICHVU_ID and C.BENHVIEN_ID = '01819'        inner join        (        select A.TIEPNHAN_ID, A.SOTIEPNHAN, A.DOITUONG_ID, A.SOTHUTU, A.NGAYTIEPNHAN, B.*, C.TENDOITUONG from TT_TIEPNHAN A        inner join TT_BENHNHAN B on A.BENHNHAN_ID = B.BENHNHAN_ID        inner join TM_DOITUONG C on A.DOITUONG_ID = C.DOITUONG_ID        where A.TRANGTHAI in ('DATIEPNHAN', 'HOANTHANH') and A.BENHVIEN_ID = '01819'        ) tn on tn.TIEPNHAN_ID = A.TIEPNHAN_ID        left join TT_DVYEUCAU E on E.DVYEUCAU_ID = A.REF_ID        where        A.BENHAN_ID is null and        ((A.REF_TABLE = 'TT_DVYEUCAU' and E.HUYYEUCAU = '0') or (A.DUOC_ID is not null and A.DATHUCHIEN = '1')) and        ((A.DATHANHTOAN = '0' or A.DATHANHTOAN is null) and A.KHONGTHUTIEN = '0') and A.BENHVIEN_ID = '01819'           and               tn.NGAYTIEPNHAN >= '7/16/2020 12:00:00 AM'             and               tn.NGAYTIEPNHAN <= '7/16/2020 12:00:00 AM'                     ) lst                    where          lst.ROWNUMBER between 1 and 19                 order by MAYTE, SOHANGDOI asc]
2020-07-16 15:50:05,631 [1] DEBUG - Statement Id: [DAO00019_GetCountBenhNhanDichVuDuocDongTien] PreparedStatement : [select count(distinct tn.MAYTE) TOTAL_BENHNHAN        from TT_VIENPHI A        left join TM_DUOC B on B.DUOC_ID = A.DUOC_ID and B.BENHVIEN_ID = '01819'        left join TM_DICHVU C on C.DICHVU_ID = A.DICHVU_ID and C.BENHVIEN_ID = '01819'        inner join        (        select A.TIEPNHAN_ID, A.SOTIEPNHAN, A.DOITUONG_ID, A.SOTHUTU, A.NGAYTIEPNHAN, B.*, C.TENDOITUONG from TT_TIEPNHAN A        inner join TT_BENHNHAN B on A.BENHNHAN_ID = B.BENHNHAN_ID        inner join TM_DOITUONG C on A.DOITUONG_ID = C.DOITUONG_ID        where A.TRANGTHAI in ('DATIEPNHAN', 'HOANTHANH') and A.BENHVIEN_ID = '01819'        ) tn on tn.TIEPNHAN_ID = A.TIEPNHAN_ID        left join TT_DVYEUCAU E on E.DVYEUCAU_ID = A.REF_ID        where        A.BENHAN_ID is null and        ((A.REF_TABLE = 'TT_DVYEUCAU' and E.HUYYEUCAU = '0') or (A.DUOC_ID is not null and A.DATHUCHIEN = '1')) and        ((A.DATHANHTOAN = '0' or A.DATHANHTOAN is null) and A.KHONGTHUTIEN = '0') and A.BENHVIEN_ID = '01819'           and               tn.NGAYTIEPNHAN >= '7/16/2020 12:00:00 AM'             and               tn.NGAYTIEPNHAN <= '7/16/2020 12:00:00 AM']
2020-07-16 15:50:07,939 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = '01819'               AND                   TM_SYS_SCREEN.PAGE = 'BIL27'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2020-07-16 15:50:08,116 [1] DEBUG - Statement Id: [DAO00012_GetList] PreparedStatement : [select        DICTIONARY_ID,        DICTIONARY_CODE,        DICTIONARY_NAME,        ATTRIBUTE1,        ATTRIBUTE2,        DICTIONARY_NAME_EN,        DICTIONARY_TYPE_CODE        from LST_DICTIONARY        where LST_DICTIONARY.Enabled = '1'         AND           LST_DICTIONARY.DICTIONARY_TYPE_CODE = 'LoaiHoaDon'                 order by LST_DICTIONARY.IDX]
2020-07-16 15:50:08,440 [1] DEBUG - Statement Id: [DAO00119_GetDanhsachHTTT] PreparedStatement : [select * from LST_DICTIONARY where DICTIONARY_TYPE_CODE = 'HinhThucThanhToan' and ENABLED = '1' and BENHVIEN_ID = '01819']
2020-07-16 15:50:08,547 [1] DEBUG - Statement Id: [DAO00119_GetLichSuThanhToan] PreparedStatement : [select        SUM(THANHTOAN) AS TONGDATHANHTOAN, SUM(TAMUNG) AS TONGTAMUNG, SUM(HOANUNG) AS TONGHOANUNG,        SUM(MIENGIAM) AS TONGMIENGIAM, SUM(THATTHU) AS TONGTHATTHU, TIEPNHAN_ID        from (        select HD.TIEPNHAN_ID,        CASE WHEN LOAIHOADON = 'TU' then HD.GIATRIHOADON ELSE 0 END TAMUNG,        CASE WHEN LOAIHOADON = 'HU' then HD.GIATRIHOADON ELSE 0 END HOANUNG,        CASE WHEN LOAIHOADON = 'BL' then HD.GIATRIHOADON ELSE 0 END THANHTOAN,        0 MIENGIAM,        0 THATTHU        from TT_HOADON HD        where HD.DATHANHTOAN = '1' and HD.HUYHOADON = '0' and HD.HOANTRA = '0'        and HD.TIEPNHAN_ID = 8747        and HD.BENHVIEN_ID = '01819'          Union          select HD.TIEPNHAN_ID,        0 TAMUNG,        0 HOANUNG,        0 THANHTOAN,        SUM(hdct.MIENGIAM_GIATRI) AS MIENGIAM,        SUM(hdct.BENHNHAN_PHAITHANHTOAN) - SUM(hdct.GIATRI_HOADON_DATHANHTOAN) AS THATTHU        from TT_HOADON HD        join TT_HOADON_CHITIET_NGOAITRU hdct on HD.HOADON_ID = hdct.HOADON_ID        where HD.DATHANHTOAN = '1' and HD.HUYHOADON = '0' and HD.HOANTRA = '0'        and HD.TIEPNHAN_ID = 8747        and HD.BENHVIEN_ID = '01819'        group by TIEPNHAN_ID        ) temp        group by temp.TIEPNHAN_ID]
2020-07-16 15:50:08,628 [1] DEBUG - Statement Id: [DAO00021_GetListSoBienLai] PreparedStatement : [select            BLCT.BIENLAICHITIET_ID            ,BL.*                         ,BL.KYHIEU + '/' + SERIES AS 'KYHIEU_SOQUYEN'                         ,BLCT.START_NUMBER            ,BLCT.CURRENT_NUMBER            ,BLCT.HIEULUC            ,BLCT.NGUOISUDUNG_ID            from TT_BIENLAICHITIET BLCT            left join TT_BIENLAI BL on BL.BIENLAI_ID = BLCT.BIENLAI_ID            where            (bl.MAX_NUMBER > (select MAX(CURRENT_NUMBER) from TT_BIENLAICHITIET where BIENLAI_ID = BLCT.BIENLAI_ID) or BLCT.CURRENT_NUMBER is null)            and BLCT.HIEULUC = 1            and BLCT.NGUOISUDUNG_ID =   @param0             and BL.BENHVIEN_ID =  @param1                          order by BLCT.THOIGIANSUDUNG DESC]
2020-07-16 15:50:08,628 [1] DEBUG - Statement Id: [DAO00021_GetListSoBienLai] Parameters: [@param0=[NGUOISUDUNG_ID,1], @param1=[BENHVIEN_ID,01819]]
2020-07-16 15:50:08,628 [1] DEBUG - Statement Id: [DAO00021_GetListSoBienLai] Types: [@param0=[Int64, System.Int64], @param1=[String, System.String]]
2020-07-16 15:50:08,692 [1] DEBUG - Statement Id: [DAO00021_GetListSoBienLai] PreparedStatement : [select            BLCT.BIENLAICHITIET_ID            ,BL.*                         ,BL.KYHIEU + '/' + SERIES AS 'KYHIEU_SOQUYEN'                         ,BLCT.START_NUMBER            ,BLCT.CURRENT_NUMBER            ,BLCT.HIEULUC            ,BLCT.NGUOISUDUNG_ID            from TT_BIENLAICHITIET BLCT            left join TT_BIENLAI BL on BL.BIENLAI_ID = BLCT.BIENLAI_ID            where            (bl.MAX_NUMBER > (select MAX(CURRENT_NUMBER) from TT_BIENLAICHITIET where BIENLAI_ID = BLCT.BIENLAI_ID) or BLCT.CURRENT_NUMBER is null)            and BLCT.HIEULUC = 1            and BLCT.NGUOISUDUNG_ID =   @param0             and BL.BENHVIEN_ID =  @param1              and               BLCT.BIENLAICHITIET_ID = '2002'                         order by BLCT.THOIGIANSUDUNG DESC]
2020-07-16 15:50:08,692 [1] DEBUG - Statement Id: [DAO00021_GetListSoBienLai] Parameters: [@param0=[NGUOISUDUNG_ID,1], @param1=[BENHVIEN_ID,01819]]
2020-07-16 15:50:08,692 [1] DEBUG - Statement Id: [DAO00021_GetListSoBienLai] Types: [@param0=[Int64, System.Int64], @param1=[String, System.String]]
2020-07-16 15:50:08,743 [1] DEBUG - Statement Id: [DAO00064_GetlistTT_TIEPNHAN_SOTHEBHYT] PreparedStatement : [select stbhyt.*, ba.SOBENHAN,        tn.SOTIEPNHAN, tn.LOAITHANHVIEN_ID, tn.THE_ID, tn.THANHVIEN_ID,        tn.SUDUNG_BHTN, tn.BAOLANH_VIENPHI, tn.VIP, tn.NGUOINUOCNGOAI, tn.NGOAIGIO        from TT_TIEPNHAN_SOTHEBHYT stbhyt        left join TT_TIEPNHAN tn on tn.TIEPNHAN_ID = stbhyt.TIEPNHAN_ID        left join TT_NOITRU_BENHAN ba on ba.TIEPNHAN_ID = stbhyt.TIEPNHAN_ID        where        stbhyt.TIEPNHAN_ID = '8747' and isnull(stbhyt.KHONGSUDUNG, '0') = '0']
2020-07-16 15:50:08,779 [1] DEBUG - Statement Id: [DAO00064_GetListVienPhiByTiepNnan] PreparedStatement : [select distinct        B.DOITUONG_ID, B.NGAYMIENDONGCHITRA, B.BENHNHAN_ID as TIEPNHAN_BENHNHAN_ID, B.TRAITUYEN,        B.BHYTTREN3NAM as TREN3NAM, B.BHYTTREN5NAM as TREN5NAM, B.SOTIEPNHAN, B.SOBENHAN,        B.LOAITHANHVIEN_ID, B.SUDUNG_BHTN, B.THE_ID, B.THANHVIEN_ID, B.BAOLANH_VIENPHI, B.VIP, B.NGUOINUOCNGOAI,        C.GIATRIMIENGIAM as GIATRIMIENGIAM, D.GIATRIMIENGIAM as GIATRIMIENGIAM_BHTN, E.GIATRIMIENGIAM as GIATRIMIENGIAM_THANHVIEN,        F.GIATRIMIENGIAM as GIATRIMIENGIAM_CONGTY, DVYC.THE_ID as DVDUNGTHE, DVYC.TRANGTHAI as TRANGTHAIDICHVU, ndv.MANHOMDICHVU,        A.* from TT_VIENPHI A        left join        (select B.*, C.SOBENHAN, C.BENHAN_ID        from TT_TIEPNHAN B        left join TT_NOITRU_BENHAN C on B.TIEPNHAN_ID = C.TIEPNHAN_ID                 where B.TIEPNHAN_ID = '8747') B on B.TIEPNHAN_ID = A.TIEPNHAN_ID        left join (select sum(GIATRIMIENGIAM) as GIATRIMIENGIAM, VIENPHI_ID, REF_TABLE        from TT_MIENGIAM_CHITIET        where REF_TABLE = 'TT_MIENGIAM'        and exists (select MIENGIAM_ID from TT_MIENGIAM where TT_MIENGIAM_CHITIET.MIENGIAM_ID = MIENGIAM_ID and TINHTRANG = 1 and TIEPNHAN_ID = '8747')        group by VIENPHI_ID, REF_TABLE) C on C.REF_TABLE = 'TT_MIENGIAM' and C.VIENPHI_ID = A.VIENPHI_ID        left join (select sum(GIATRIMIENGIAM) as GIATRIMIENGIAM, VIENPHI_ID, REF_TABLE        from TT_MIENGIAM_CHITIET        where REF_TABLE = 'TT_MIENGIAM_BHTN'        and exists (select MIENGIAM_BHTN_ID from TT_MIENGIAM_BHTN where TT_MIENGIAM_CHITIET.MIENGIAM_ID = MIENGIAM_BHTN_ID and  TINHTRANG = 1 and TIEPNHAN_ID = '8747')        group by VIENPHI_ID, REF_TABLE) D on D.REF_TABLE = 'TT_MIENGIAM_BHTN' and D.VIENPHI_ID = A.VIENPHI_ID        left join (select sum(GIATRIMIENGIAM) as GIATRIMIENGIAM, VIENPHI_ID, REF_TABLE        from TT_MIENGIAM_CHITIET        where REF_TABLE = 'TT_MIENGIAM_THANHVIEN'        and exists (select MIENGIAM_THANHVIEN_ID from TT_MIENGIAM_THANHVIEN where TT_MIENGIAM_CHITIET.MIENGIAM_ID = MIENGIAM_THANHVIEN_ID and TINHTRANG = 1 and TIEPNHAN_ID = '8747')        group by VIENPHI_ID, REF_TABLE) E on E.REF_TABLE = 'TT_MIENGIAM_THANHVIEN' and E.VIENPHI_ID = A.VIENPHI_ID        left join (select sum(GIATRIMIENGIAM) as GIATRIMIENGIAM, VIENPHI_ID, REF_TABLE        from TT_MIENGIAM_CHITIET        where REF_TABLE = 'TT_MIENGIAM_CONGTY'        and exists (select MIENGIAM_CONGTY_ID from TT_MIENGIAM_CONGTY where TT_MIENGIAM_CHITIET.MIENGIAM_ID = MIENGIAM_CONGTY_ID and TINHTRANG = 1 and TIEPNHAN_ID = '8747')        group by VIENPHI_ID, REF_TABLE) F on F.REF_TABLE = 'TT_MIENGIAM_CONGTY' and F.VIENPHI_ID = A.VIENPHI_ID        left join TT_DVYEUCAU DVYC on DVYC.DVYEUCAU_ID = A.REF_ID and A.REF_TABLE = 'TT_DVYEUCAU'        left join TM_DICHVU DV on DVYC.DICHVU_ID = DV.DICHVU_ID and A.REF_TABLE = 'TT_DVYEUCAU'        left join TM_NHOMDICHVU ndv on ndv.NHOMDICHVU_ID = DV.NHOMDICHVU_ID and A.REF_TABLE = 'TT_DVYEUCAU'        where        A.TIEPNHAN_ID = '8747' and ((DVYC.HUYYEUCAU = '0' and A.DICHVU_ID is not null)        or A.DUOC_ID is not null or A.REF_TABLE = 'TT_NUT_XACNHANSUATAN_CHITIET')        and A.ACTIVE = '1'                 and A.BENHVIEN_ID = '01819'        order by A.VIENPHI_ID]
2020-07-16 15:50:08,962 [1] DEBUG - Statement Id: [DAO00006_GetListDuocTyle] PreparedStatement : [select DUOC_ID, DOITUONG_ID, (TYLE/100) as TYLE, DONGIA MUCTRAN_THANHTOAN from TM_DOITUONG_GIADUOC_TYLE            where            BENHVIEN_ID = '01819'            and DOITUONG_ID = '0']
2020-07-16 15:50:08,986 [1] DEBUG - Statement Id: [DAO00027_GetListTuongTrinhDichVuPhauThuatCuaTiepNhan] PreparedStatement : [declare @ManhomDSA varchar(10);        declare @PhanLoaiNhomDV varchar(20) = '05';        select top 1  @ManhomDSA = VALUE from TM_SYS_APPSETTINGS where CODE = 'MANHOM_DICHVU_DSA'        if (@ManhomDSA is not null) set @PhanLoaiNhomDV += ',' + @ManhomDSA        select distinct ptyc.*        from TT_PHAUTHUAT_YEUCAU ptyc        inner join TM_DICHVU dv on dv.DICHVU_ID = ptyc.DICHVU_ID        inner join TM_NHOMDICHVU ndv on ndv.NHOMDICHVU_ID = dv.NHOMDICHVU_ID        inner join TT_PHAUTHUAT pt on pt.PHAUTHUAT_ID = ptyc.PHAUTHUAT_ID        where        pt.TIEPNHAN_ID = 8747        and (left(ndv.MANHOMDICHVU, 2) in (select * from STRING_SPLIT(@PhanLoaiNhomDV,',')) or ndv.MANHOMDICHVU in (select * from STRING_SPLIT(@PhanLoaiNhomDV,',')))]
2020-07-16 15:50:09,011 [1] DEBUG - Statement Id: [DAO00006_GetList] PreparedStatement : [select dv.*, loaiDV.MALOAIDICHVU, captren.NHOMDICHVU_ID as NHOMDICHVU_CAPTREN_ID, captren.TENNHOMDICHVU as NHOMDICHVU_CAPTREN,              nhom_dv.TENNHOMDICHVU as TENNHOMDICHVU, nhom_dv.MANHOMDICHVU,              case when dv.ATTRIBUTE5 is null then 'TT' else 'KTC' end as LOAI_CHIPHI              from TM_DICHVU as dv              left join TM_NHOMDICHVU as nhom_dv on nhom_dv.NHOMDICHVU_ID = dv.NHOMDICHVU_ID and nhom_dv.BENHVIEN_ID = '01819'              left join TM_NHOMDICHVU as captren on nhom_dv.CAPTREN_ID = captren.NHOMDICHVU_ID and captren.BENHVIEN_ID = '01819'              left join TM_LOAIDICHVU loaiDV on nhom_dv.LOAIDICHVU_ID = loaiDV.LOAIDICHVU_ID and loaiDV.BENHVIEN_ID = '01819'              where nhom_dv.TAMNGUNG = '0' and dv.BENHVIEN_ID = '01819'              and dv.TAMNGUNG = '0'               AND                   loaiDV.MALOAIDICHVU = 'KhamBenh']
2020-07-16 15:50:09,168 [1] DEBUG - Statement Id: [DAO00023_UpdateNhieuVP] PreparedStatement : [declare @jsonVienPhi nvarchar(max) = N'[{"VIENPHI_ID":16000,"TIEPNHAN_ID":8747,"DICHVU_ID":3,"BENHAN_ID":0,"SOLUONG":1.0000,"DONGIA_DOANHTHU":38700.0000,"THANHTIEN_DOANHTHU":38700.00,"BHYT_TL":0.0,"BHYT_DONGIA":0.0,"BHYT_THANHTIEN":0.0,"BHYT_DONGIA_CONGKHAM_DAU":0.0,"BHYT_CONGKHAM_DAU_TYLE":0.0,"BHYT_DONGIA_CHITRA":0.0,"BHYT_THANHTIEN_CHITRA":0.0,"BENHNHAN_PHAITHANHTOAN":38700.00,"GIATRI_HOADON":0.0,"GIATRI_HOADON_DATHANHTOAN":0.0,"GIATRI_BIENLAI":0.0,"GIATRI_BIENLAI_DATHANHTOAN":0.0,"GIATRI_BENHNHAN_DATHANHTOAN":0.0,"DATHUCHIEN":"0","KHONGTHUTIEN":"0","BHYTDONGTIEN":"0","DICHVU_TL":1.0,"BHYT_DONGIA_DONGCT_DAU":0.0,"SOBHYT":null,"SOBHYT_HUONG_ID":8755,"GIATRIMIENGIAM":0.0,"GIATRIMIENGIAM_BHTN":0.0,"GIATRIMIENGIAM_THANHVIEN":0.0,"GIATRIMIENGIAM_CONGTY":0.0,"BHYT_CK2_KHONGTHANHTOAN":false,"SOLONHAP_ID":null,"DUOC_MUCTRAN_THANHTOAN":0.0,"DUOC_TYLE":0.0000}]';        begin        UPDATE TT_VIENPHI        SET        SOLUONG = json.SOLUONG,        DONGIA_DOANHTHU = json.DONGIA_DOANHTHU,        THANHTIEN_DOANHTHU = json.THANHTIEN_DOANHTHU,        BHYT_TL = json.BHYT_TL,        BHYT_DONGIA = json.BHYT_DONGIA,        BHYT_THANHTIEN = json.BHYT_THANHTIEN,        BHYT_DONGIA_CONGKHAM_DAU = json.BHYT_DONGIA_CONGKHAM_DAU,        BHYT_CONGKHAM_DAU_TYLE = json.BHYT_CONGKHAM_DAU_TYLE,        BHYT_DONGIA_CHITRA = json.BHYT_DONGIA_CHITRA,        BHYT_THANHTIEN_CHITRA = json.BHYT_THANHTIEN_CHITRA,        BENHNHAN_PHAITHANHTOAN = json.BENHNHAN_PHAITHANHTOAN,        GIATRI_HOADON = json.GIATRI_HOADON,        GIATRI_BIENLAI = json.GIATRI_BIENLAI,        DATHUCHIEN = json.DATHUCHIEN,        DICHVU_TL = json.DICHVU_TL,        BHYT_DONGIA_DONGCT_DAU = json.BHYT_DONGIA_DONGCT_DAU,        SOLONHAP_ID = json.SOLONHAP_ID,        DUOC_TYLE = json.DUOC_TYLE,        DUOC_MUCTRAN_THANHTOAN = json.DUOC_MUCTRAN_THANHTOAN,        NGAYCAPNHAT = GETDATE()        FROM OPENJSON (@jsonVienPhi)        WITH (        VIENPHI_ID int,        SOLUONG numeric(25, 4),        DONGIA_DOANHTHU numeric(25, 4),        THANHTIEN_DOANHTHU numeric(25, 4),        BHYT_TL numeric(25, 4),        BHYT_DONGIA numeric(25, 4),        BHYT_THANHTIEN numeric(25, 4),        BHYT_DONGIA_CONGKHAM_DAU numeric(25, 4),        BHYT_CONGKHAM_DAU_TYLE numeric(25, 4),        BHYT_DONGIA_CHITRA numeric(25, 4),        BHYT_THANHTIEN_CHITRA numeric(25, 4),        BENHNHAN_PHAITHANHTOAN numeric(25, 4),        GIATRI_HOADON numeric(25, 4),        GIATRI_BIENLAI numeric(25, 4),        DATHUCHIEN char(1),        KHONGTHUTIEN char(1),        BHYTDONGTIEN char(1),        DICHVU_TL numeric(25, 4),        BHYT_DONGIA_DONGCT_DAU numeric(25, 4),        SOLONHAP_ID int,        DUOC_TYLE numeric(25, 4),        DUOC_MUCTRAN_THANHTOAN numeric(25, 4))  json        WHERE TT_VIENPHI.VIENPHI_ID = json.VIENPHI_ID and json.DONGIA_DOANHTHU > 0                  insert into TT_TINH_VIENPHI_LOG        SELECT json.VIENPHI_ID, json.TIEPNHAN_ID, json.BENHAN_ID, json.SOLUONG, json.BHYT_TL, json.DONGIA_DOANHTHU,        json.THANHTIEN_DOANHTHU, json.BHYT_DONGIA, json.BHYT_THANHTIEN, json.BHYT_DONGIA_CHITRA, json.BHYT_THANHTIEN_CHITRA, json.BENHNHAN_PHAITHANHTOAN,        json.SOBHYT_HUONG_ID, json.SOBHYT, GETDATE(), -1, '01819'        FROM OPENJSON(@jsonVienPhi)        WITH (        VIENPHI_ID int,        TIEPNHAN_ID int,        BENHAN_ID int,        SOLUONG numeric(25, 4),        DONGIA_DOANHTHU numeric(25, 4),        THANHTIEN_DOANHTHU numeric(25, 4),        BHYT_TL numeric(25, 4),        BHYT_DONGIA numeric(25, 4),        BHYT_THANHTIEN numeric(25, 4),        BHYT_DONGIA_CHITRA numeric(25, 4),        BHYT_THANHTIEN_CHITRA numeric(25, 4),        BENHNHAN_PHAITHANHTOAN numeric(25, 4),        SOBHYT_HUONG_ID int,        SOBHYT nvarchar(30)) json        end]
2020-07-16 15:50:09,216 [1] DEBUG - Statement Id: [DAO00067_UpdateDataVienPhiDongiaBHYT] PreparedStatement : [update TT_VIENPHI          set BHYT_DONGIA_CHITRA = 0, BHYT_THANHTIEN = 0, BHYT_THANHTIEN_CHITRA = 0          where          TIEPNHAN_ID = 8747 and BHYT_DONGIA = 0          and (BHYT_DONGIA_CHITRA > 0 or BHYT_THANHTIEN > 0 or BHYT_THANHTIEN_CHITRA > 0)]
2020-07-16 15:50:09,255 [1] DEBUG - Statement Id: [DAO00067_CapnhatDataVienphiKhiHuyThanhtoanHoadon] PreparedStatement : [update TT_VIENPHI        set TT_VIENPHI.HOADON_ID = hdct.HOADON_ID, TT_VIENPHI.GIATRI_BENHNHAN_DATHANHTOAN = TT_VIENPHI.GIATRI_BENHNHAN_DATHANHTOAN + hdct.GIATRI_BENHNHAN_DATHANHTOAN        from (select CT.HOADON_ID, CT.VIENPHI_ID, CT.GIATRI_BENHNHAN_DATHANHTOAN        from TT_HOADON_CHITIET_NGOAITRU CT        join TT_HOADON HD on HD.HOADON_ID = CT.HOADON_ID        join TT_VIENPHI vp on vp.VIENPHI_ID = ct.VIENPHI_ID        where HD.DATHANHTOAN = 1 and HD.HUYHOADON = 0 and HD.HOANTRA = 0 and vp.TIEPNHAN_ID =  @param0 ) hdct        where        TT_VIENPHI.VIENPHI_ID = hdct.VIENPHI_ID and TT_VIENPHI.HOADON_ID is null and isnull(TT_VIENPHI.GIATRI_BENHNHAN_DATHANHTOAN,0) = 0        and TT_VIENPHI.TIEPNHAN_ID =  @param0           update TT_VIENPHI        set TT_VIENPHI.HOADON_ID = null, TT_VIENPHI.GIATRI_BENHNHAN_DATHANHTOAN = TT_VIENPHI.GIATRI_BENHNHAN_DATHANHTOAN - hdct.GIATRI_BENHNHAN_DATHANHTOAN,        TT_VIENPHI.DATHANHTOAN = '0'        from (select CT.HOADON_ID, CT.VIENPHI_ID, CT.GIATRI_BENHNHAN_DATHANHTOAN        from TT_HOADON_CHITIET_NGOAITRU CT        join TT_HOADON HD on HD.HOADON_ID = CT.HOADON_ID        join TT_VIENPHI vp on vp.VIENPHI_ID = ct.VIENPHI_ID and vp.HOADON_ID = ct.HOADON_ID        where HD.DATHANHTOAN = 0 and (HD.HUYHOADON = 1 or HD.HOANTRA = 1) and vp.TIEPNHAN_ID =  @param0 ) hdct        where        TT_VIENPHI.VIENPHI_ID = hdct.VIENPHI_ID and TT_VIENPHI.HOADON_ID = hdct.HOADON_ID        and TT_VIENPHI.TIEPNHAN_ID =  @param0]
2020-07-16 15:50:09,255 [1] DEBUG - Statement Id: [DAO00067_CapnhatDataVienphiKhiHuyThanhtoanHoadon] Parameters: [@param0=[TIEPNHAN_ID,8747]]
2020-07-16 15:50:09,255 [1] DEBUG - Statement Id: [DAO00067_CapnhatDataVienphiKhiHuyThanhtoanHoadon] Types: [@param0=[Int64, System.Int64]]
2020-07-16 15:50:09,284 [1] DEBUG - Statement Id: [DAO00119_TT_VIENPHI_GetList_TiepNhanPhaiThanhToan] PreparedStatement : [select distinct  a.*, b.GIATRIMIENGIAM_BH, c.GIATRIMIENGIAM_BHTN, f.GIATRIMIENGIAM_THANHVIEN, g.GIATRIMIENGIAM_CTCT,        isnull(dv.TENDICHVU, dc.TENDUOCDAYDU) NOIDUNG, isnull(dv.MADICHVU, dc.MADUOC) MADICHVU, dv.NORESULT, dc.DONVITINH, ld.MALOAIDUOC, dc.BHYT DUOC_BHYT, ld.LOAIVATTU_ID, ndv.MANHOMDICHVU        from        (select VP.*, isnull(c.TRANGTHAI, '') TRANGTHAI, c.THUTIENSAU, c.NOITHUCHIEN_ID,        CASE        when REF_TABLE = 'TT_NGOAITRU_TOATHUOC' then ntkb.PHONGBAN_ID        when REF_TABLE = 'TT_CLSKETQUA_VTYT' then clsvtyt.PHONGBAN_ID        when REF_TABLE = 'TT_NGOAITRU_KHAMBENH_VTYT' then kbd.PHONGBAN_ID        ELSE        c.NOIYEUCAU_ID        END NOIYEUCAU_ID,        CASE        when REF_TABLE = 'TT_NGOAITRU_TOATHUOC' then ngtd.KHOXUAT_ID        when REF_TABLE = 'TT_CLSKETQUA_VTYT' then clsvtyt.KHOTAO_ID        when REF_TABLE = 'TT_NGOAITRU_KHAMBENH_VTYT' then kbd.KHOTAO_ID        ELSE null        END KHODUOC_ID          from TT_VIENPHI VP        left join TT_DVYEUCAU c on c.DVYEUCAU_ID = VP.REF_ID  and vp.REF_TABLE = 'TT_DVYEUCAU'        left join TT_NGOAITRU_TOATHUOC nttt on nttt.TOATHUOC_ID = vp.REF_ID and vp.REF_TABLE = 'TT_NGOAITRU_TOATHUOC'        left join TT_NGOAITRU_KHAMBENH_TOATHUOC ngtd on ngtd.KHAMBENH_TOATHUOC_ID = nttt.KHAMBENH_TOATHUOC_ID        left join TT_CLSKETQUA_VTYT clsvtyt on clsvtyt.CLSKETQUA_ID = vp.REF_ID and REF_TABLE = 'TT_CLSKETQUA_VTYT'        left join TT_NGOAITRU_KHAMBENH_VTYT kbd on kbd.KHAMBENH_VTYT_ID = vp.REF_ID and REF_TABLE = 'TT_NGOAITRU_KHAMBENH_VTYT'        left join TT_NGOAITRU_KHAMBENH ntkb on ntkb.KHAMBENH_ID = vp.KHAMBENH_ID and REF_TABLE = 'TT_NGOAITRU_TOATHUOC'          where Vp.TIEPNHAN_ID = '8747' and Vp.ACTIVE = '1' and ((c.HUYYEUCAU != '1' and vp.DICHVU_ID is not null) or (vp.DUOC_ID is not null)) and        ((vp.DATHANHTOAN = '0') or (vp.BENHNHAN_PHAITHANHTOAN > vp.GIATRI_BENHNHAN_DATHANHTOAN and vp.DATHANHTOAN = '1')) and c.DANGKY_CHITIET_ID is null        and vp.REF_TABLE != 'TT_MAU_CHUNGTU_CHITIET'        and vp.REF_TABLE != 'TT_DUOC_CHUNGTU_CHITIET'          AND             VP.KHONGTHUTIEN != '1'                   ) a        left join TM_DUOC dc on a.DUOC_ID = dc.DUOC_ID        left join TM_LOAIDUOC ld on dc.LOAIDUOC_ID = ld.LOAIDUOC_ID        left join TM_DICHVU dv on a.DICHVU_ID = dv.DICHVU_ID and a.REF_TABLE = 'TT_DVYEUCAU'        left join TM_NHOMDICHVU ndv on ndv.NHOMDICHVU_ID = dv.NHOMDICHVU_ID        left join (select VIENPHI_ID,        sum(MGCT.GIATRIMIENGIAM) AS GIATRIMIENGIAM_BH from TT_MIENGIAM MG        INNER JOIN TT_MIENGIAM_CHITIET MGCT ON MG.MIENGIAM_ID = MGCT.MIENGIAM_ID        where MG.TIEPNHAN_ID= '8747' and MGCT.REF_TABLE = 'TT_MIENGIAM' and MG.TINHTRANG = 1 group by VIENPHI_ID        ) b on a.VIENPHI_ID = b.VIENPHI_ID          left join (select VIENPHI_ID, sum(MGCT.GIATRIMIENGIAM) AS GIATRIMIENGIAM_BHTN        from TT_MIENGIAM_BHTN MG        INNER JOIN TT_MIENGIAM_CHITIET MGCT ON MG.MIENGIAM_BHTN_ID = MGCT.MIENGIAM_ID        where  MG.TIEPNHAN_ID= '8747' and MGCT.REF_TABLE = 'TT_MIENGIAM_BHTN' and MG.TINHTRANG = 1 group by VIENPHI_ID        )c on a.VIENPHI_ID = c.VIENPHI_ID          left join (select VIENPHI_ID, sum(MGCT.GIATRIMIENGIAM) AS GIATRIMIENGIAM_THANHVIEN        from TT_MIENGIAM_THANHVIEN MG        INNER JOIN TT_MIENGIAM_CHITIET MGCT ON MG.MIENGIAM_THANHVIEN_ID = MGCT.MIENGIAM_ID        where MG.TIEPNHAN_ID= '8747' and MGCT.REF_TABLE = 'TT_MIENGIAM_THANHVIEN' and MG.TINHTRANG = 1 group by VIENPHI_ID        )f on a.VIENPHI_ID = f.VIENPHI_ID          left join(select VIENPHI_ID, sum(MGCT.GIATRIMIENGIAM) AS GIATRIMIENGIAM_CTCT        from TT_MIENGIAM_CONGTY MG        INNER JOIN TT_MIENGIAM_CHITIET MGCT ON MG.MIENGIAM_CONGTY_ID = MGCT.MIENGIAM_ID        where MG.TIEPNHAN_ID= '8747' and MGCT.REF_TABLE = 'TT_MIENGIAM_CONGTY' and MG.TINHTRANG = 1 group by VIENPHI_ID        )g on a.VIENPHI_ID = g.VIENPHI_ID]
2020-07-16 15:50:09,545 [1] DEBUG - Statement Id: [DAO00330_TT_VIENPHI_GetList_TiepNhanPhaiThanhToan] PreparedStatement : [select distinct  a.*, b.GIATRIMIENGIAM_BH, c.GIATRIMIENGIAM_BHTN, f.GIATRIMIENGIAM_THANHVIEN, g.GIATRIMIENGIAM_CTCT        from        (select VP.*,NULL AS NOITHUCHIEN_ID, DK.NOICHIDINH_ID as NOIYEUCAU_ID, NULL AS THUTIENSAU, isnull(DK.TRANGTHAI, '') TRANGTHAI,        M.TENMAU AS NOIDUNG, M.MAMAU AS MADICHVU, NULL AS NORESULT, DVT.TENDONVITINH AS DONVITINH, LM.MALOAIMAU AS MALOAIDUOC, M.BHYT AS DUOC_BHYT, 'M' AS LOAIVATTU_ID, NM.TENNHOMMAU AS MANHOMDICHVU        from TT_VIENPHI VP        INNER JOIN TT_MAU_CHUNGTU_CHITIET CT ON VP.REF_ID=CT.CHUNGTUCHITIET_ID AND VP.REF_TABLE='TT_MAU_CHUNGTU_CHITIET' AND CT.BENHVIEN_ID='01819'        INNER JOIN TT_MAU_CHUNGTU CTU ON CT.CHUNGTU_ID=CTU.CHUNGTU_ID AND CTU.CHUNGTULIENQUAN_ID IS NULL        INNER join TM_MAU M on CT.MAU_ID = M.MAU_ID        LEFT JOIN TM_MAU_DONVITINH DVT ON M.DONVITINH_ID = DVT.DONVITINH_ID        LEFT JOIN TT_MAU_DANGKYMAU_CHITIET DKCT ON DKCT.CHUNGTU_ID = CTU.CHUNGTU_ID AND DKCT.BENHVIEN_ID='01819'        LEFT JOIN TT_MAU_DANGKYMAU DK ON DK.DANGKYMAU_ID = DKCT.DANGKYMAU_ID        LEFT JOIN TM_MAU_LOAIMAU LM ON LM.LOAIMAU_ID = M.LOAIMAU_ID        LEFT JOIN TM_MAU_NHOMMAU NM ON NM.NHOMMAU_ID = LM.NHOMMAU_ID        where Vp.TIEPNHAN_ID = '8747' and Vp.ACTIVE = '1' and vp.DUOC_ID is not null and        ((vp.DATHANHTOAN = '0') or (vp.BENHNHAN_PHAITHANHTOAN > vp.GIATRI_BENHNHAN_DATHANHTOAN and vp.DATHANHTOAN = '1'))   AND             VP.KHONGTHUTIEN != '1'                   ) a        left join (select VIENPHI_ID,        sum(MGCT.GIATRIMIENGIAM) AS GIATRIMIENGIAM_BH from TT_MIENGIAM MG        INNER JOIN TT_MIENGIAM_CHITIET MGCT ON MG.MIENGIAM_ID = MGCT.MIENGIAM_ID        where MG.TIEPNHAN_ID= '8747' and MGCT.REF_TABLE = 'TT_MIENGIAM' and MG.TINHTRANG = 1 group by VIENPHI_ID        ) b on a.VIENPHI_ID = b.VIENPHI_ID          left join (select VIENPHI_ID, sum(MGCT.GIATRIMIENGIAM) AS GIATRIMIENGIAM_BHTN        from TT_MIENGIAM_BHTN MG        INNER JOIN TT_MIENGIAM_CHITIET MGCT ON MG.MIENGIAM_BHTN_ID = MGCT.MIENGIAM_ID        where  MG.TIEPNHAN_ID= '8747' and MGCT.REF_TABLE = 'TT_MIENGIAM_BHTN' and MG.TINHTRANG = 1 group by VIENPHI_ID        )c on a.VIENPHI_ID = c.VIENPHI_ID          left join (select VIENPHI_ID, sum(MGCT.GIATRIMIENGIAM) AS GIATRIMIENGIAM_THANHVIEN        from TT_MIENGIAM_THANHVIEN MG        INNER JOIN TT_MIENGIAM_CHITIET MGCT ON MG.MIENGIAM_THANHVIEN_ID = MGCT.MIENGIAM_ID        where MG.TIEPNHAN_ID= '8747' and MGCT.REF_TABLE = 'TT_MIENGIAM_THANHVIEN' and MG.TINHTRANG = 1 group by VIENPHI_ID        )f on a.VIENPHI_ID = f.VIENPHI_ID          left join(select VIENPHI_ID, sum(MGCT.GIATRIMIENGIAM) AS GIATRIMIENGIAM_CTCT        from TT_MIENGIAM_CONGTY MG        INNER JOIN TT_MIENGIAM_CHITIET MGCT ON MG.MIENGIAM_CONGTY_ID = MGCT.MIENGIAM_ID        where MG.TIEPNHAN_ID= '8747' and MGCT.REF_TABLE = 'TT_MIENGIAM_CONGTY' and MG.TINHTRANG = 1 group by VIENPHI_ID        )g on a.VIENPHI_ID = g.VIENPHI_ID]
2020-07-16 15:50:09,721 [1] DEBUG - Statement Id: [DAO00091_GetList] PreparedStatement : [select DICHVU_ID from TM_DICHVU_PHANNHOMDICHVU        where PHANNHOMDICHVU_ID in (select PHANNHOMDICHVU_ID                                    from TM_PHANNHOMDICHVU                                    where MAPHANNHOMDICHVU = 'KTC')        and BENHVIEN_ID = '01819']
2020-07-16 15:50:09,753 [1] DEBUG - Statement Id: [DAO00194_GetList] PreparedStatement : [select A.* from TM_PHONGBAN A        inner join LST_DICTIONARY B on A.LOAIPHONGBAN_ID = B.DICTIONARY_ID        and B.DICTIONARY_TYPE_CODE = 'LoaiPhongBan' and B.DICTIONARY_CODE not in ('PhongMo','PhongBenh')        where A.BENHVIEN_ID = '01819' order by A.TENPHONGBAN asc]
2020-07-16 15:50:09,868 [1] DEBUG - Statement Id: [DAO00119_GetDataTamUng_HoaUng] PreparedStatement : [select SUM(TAMUNG) AS TONGTIEN_TU, SUM(HOANUNG) AS TONGTIEN_HU, TIEPNHAN_ID        from (        select HD.TIEPNHAN_ID,        CASE WHEN LOAIHOADON = 'TU' then HD.GIATRIHOADON ELSE 0 END TAMUNG,        CASE WHEN LOAIHOADON = 'HU' then HD.GIATRIHOADON ELSE 0 END HOANUNG        from TT_HOADON HD        where HD.DATHANHTOAN = '1' and HD.HUYHOADON = '0' and HD.HOANTRA = '0'        and HD.TIEPNHAN_ID = 8747        and HD.BENHVIEN_ID = '01819'        ) temp        group by temp.TIEPNHAN_ID]
2020-07-16 15:50:09,902 [1] DEBUG - Statement Id: [DAO00119_TT_VIENPHI_GetList_TiepNhanPhaiThanhToan] PreparedStatement : [select distinct  a.*, b.GIATRIMIENGIAM_BH, c.GIATRIMIENGIAM_BHTN, f.GIATRIMIENGIAM_THANHVIEN, g.GIATRIMIENGIAM_CTCT,        isnull(dv.TENDICHVU, dc.TENDUOCDAYDU) NOIDUNG, isnull(dv.MADICHVU, dc.MADUOC) MADICHVU, dv.NORESULT, dc.DONVITINH, ld.MALOAIDUOC, dc.BHYT DUOC_BHYT, ld.LOAIVATTU_ID, ndv.MANHOMDICHVU        from        (select VP.*, isnull(c.TRANGTHAI, '') TRANGTHAI, c.THUTIENSAU, c.NOITHUCHIEN_ID,        CASE        when REF_TABLE = 'TT_NGOAITRU_TOATHUOC' then ntkb.PHONGBAN_ID        when REF_TABLE = 'TT_CLSKETQUA_VTYT' then clsvtyt.PHONGBAN_ID        when REF_TABLE = 'TT_NGOAITRU_KHAMBENH_VTYT' then kbd.PHONGBAN_ID        ELSE        c.NOIYEUCAU_ID        END NOIYEUCAU_ID,        CASE        when REF_TABLE = 'TT_NGOAITRU_TOATHUOC' then ngtd.KHOXUAT_ID        when REF_TABLE = 'TT_CLSKETQUA_VTYT' then clsvtyt.KHOTAO_ID        when REF_TABLE = 'TT_NGOAITRU_KHAMBENH_VTYT' then kbd.KHOTAO_ID        ELSE null        END KHODUOC_ID          from TT_VIENPHI VP        left join TT_DVYEUCAU c on c.DVYEUCAU_ID = VP.REF_ID  and vp.REF_TABLE = 'TT_DVYEUCAU'        left join TT_NGOAITRU_TOATHUOC nttt on nttt.TOATHUOC_ID = vp.REF_ID and vp.REF_TABLE = 'TT_NGOAITRU_TOATHUOC'        left join TT_NGOAITRU_KHAMBENH_TOATHUOC ngtd on ngtd.KHAMBENH_TOATHUOC_ID = nttt.KHAMBENH_TOATHUOC_ID        left join TT_CLSKETQUA_VTYT clsvtyt on clsvtyt.CLSKETQUA_ID = vp.REF_ID and REF_TABLE = 'TT_CLSKETQUA_VTYT'        left join TT_NGOAITRU_KHAMBENH_VTYT kbd on kbd.KHAMBENH_VTYT_ID = vp.REF_ID and REF_TABLE = 'TT_NGOAITRU_KHAMBENH_VTYT'        left join TT_NGOAITRU_KHAMBENH ntkb on ntkb.KHAMBENH_ID = vp.KHAMBENH_ID and REF_TABLE = 'TT_NGOAITRU_TOATHUOC'          where Vp.TIEPNHAN_ID = '8747' and Vp.ACTIVE = '1' and ((c.HUYYEUCAU != '1' and vp.DICHVU_ID is not null) or (vp.DUOC_ID is not null)) and        ((vp.DATHANHTOAN = '0') or (vp.BENHNHAN_PHAITHANHTOAN > vp.GIATRI_BENHNHAN_DATHANHTOAN and vp.DATHANHTOAN = '1')) and c.DANGKY_CHITIET_ID is null        and vp.REF_TABLE != 'TT_MAU_CHUNGTU_CHITIET'        and vp.REF_TABLE != 'TT_DUOC_CHUNGTU_CHITIET'          AND             VP.KHONGTHUTIEN != '1'                   ) a        left join TM_DUOC dc on a.DUOC_ID = dc.DUOC_ID        left join TM_LOAIDUOC ld on dc.LOAIDUOC_ID = ld.LOAIDUOC_ID        left join TM_DICHVU dv on a.DICHVU_ID = dv.DICHVU_ID and a.REF_TABLE = 'TT_DVYEUCAU'        left join TM_NHOMDICHVU ndv on ndv.NHOMDICHVU_ID = dv.NHOMDICHVU_ID        left join (select VIENPHI_ID,        sum(MGCT.GIATRIMIENGIAM) AS GIATRIMIENGIAM_BH from TT_MIENGIAM MG        INNER JOIN TT_MIENGIAM_CHITIET MGCT ON MG.MIENGIAM_ID = MGCT.MIENGIAM_ID        where MG.TIEPNHAN_ID= '8747' and MGCT.REF_TABLE = 'TT_MIENGIAM' and MG.TINHTRANG = 1 group by VIENPHI_ID        ) b on a.VIENPHI_ID = b.VIENPHI_ID          left join (select VIENPHI_ID, sum(MGCT.GIATRIMIENGIAM) AS GIATRIMIENGIAM_BHTN        from TT_MIENGIAM_BHTN MG        INNER JOIN TT_MIENGIAM_CHITIET MGCT ON MG.MIENGIAM_BHTN_ID = MGCT.MIENGIAM_ID        where  MG.TIEPNHAN_ID= '8747' and MGCT.REF_TABLE = 'TT_MIENGIAM_BHTN' and MG.TINHTRANG = 1 group by VIENPHI_ID        )c on a.VIENPHI_ID = c.VIENPHI_ID          left join (select VIENPHI_ID, sum(MGCT.GIATRIMIENGIAM) AS GIATRIMIENGIAM_THANHVIEN        from TT_MIENGIAM_THANHVIEN MG        INNER JOIN TT_MIENGIAM_CHITIET MGCT ON MG.MIENGIAM_THANHVIEN_ID = MGCT.MIENGIAM_ID        where MG.TIEPNHAN_ID= '8747' and MGCT.REF_TABLE = 'TT_MIENGIAM_THANHVIEN' and MG.TINHTRANG = 1 group by VIENPHI_ID        )f on a.VIENPHI_ID = f.VIENPHI_ID          left join(select VIENPHI_ID, sum(MGCT.GIATRIMIENGIAM) AS GIATRIMIENGIAM_CTCT        from TT_MIENGIAM_CONGTY MG        INNER JOIN TT_MIENGIAM_CHITIET MGCT ON MG.MIENGIAM_CONGTY_ID = MGCT.MIENGIAM_ID        where MG.TIEPNHAN_ID= '8747' and MGCT.REF_TABLE = 'TT_MIENGIAM_CONGTY' and MG.TINHTRANG = 1 group by VIENPHI_ID        )g on a.VIENPHI_ID = g.VIENPHI_ID]
2020-07-16 15:50:09,927 [1] DEBUG - Statement Id: [DAO00330_TT_VIENPHI_GetList_TiepNhanPhaiThanhToan] PreparedStatement : [select distinct  a.*, b.GIATRIMIENGIAM_BH, c.GIATRIMIENGIAM_BHTN, f.GIATRIMIENGIAM_THANHVIEN, g.GIATRIMIENGIAM_CTCT        from        (select VP.*,NULL AS NOITHUCHIEN_ID, DK.NOICHIDINH_ID as NOIYEUCAU_ID, NULL AS THUTIENSAU, isnull(DK.TRANGTHAI, '') TRANGTHAI,        M.TENMAU AS NOIDUNG, M.MAMAU AS MADICHVU, NULL AS NORESULT, DVT.TENDONVITINH AS DONVITINH, LM.MALOAIMAU AS MALOAIDUOC, M.BHYT AS DUOC_BHYT, 'M' AS LOAIVATTU_ID, NM.TENNHOMMAU AS MANHOMDICHVU        from TT_VIENPHI VP        INNER JOIN TT_MAU_CHUNGTU_CHITIET CT ON VP.REF_ID=CT.CHUNGTUCHITIET_ID AND VP.REF_TABLE='TT_MAU_CHUNGTU_CHITIET' AND CT.BENHVIEN_ID='01819'        INNER JOIN TT_MAU_CHUNGTU CTU ON CT.CHUNGTU_ID=CTU.CHUNGTU_ID AND CTU.CHUNGTULIENQUAN_ID IS NULL        INNER join TM_MAU M on CT.MAU_ID = M.MAU_ID        LEFT JOIN TM_MAU_DONVITINH DVT ON M.DONVITINH_ID = DVT.DONVITINH_ID        LEFT JOIN TT_MAU_DANGKYMAU_CHITIET DKCT ON DKCT.CHUNGTU_ID = CTU.CHUNGTU_ID AND DKCT.BENHVIEN_ID='01819'        LEFT JOIN TT_MAU_DANGKYMAU DK ON DK.DANGKYMAU_ID = DKCT.DANGKYMAU_ID        LEFT JOIN TM_MAU_LOAIMAU LM ON LM.LOAIMAU_ID = M.LOAIMAU_ID        LEFT JOIN TM_MAU_NHOMMAU NM ON NM.NHOMMAU_ID = LM.NHOMMAU_ID        where Vp.TIEPNHAN_ID = '8747' and Vp.ACTIVE = '1' and vp.DUOC_ID is not null and        ((vp.DATHANHTOAN = '0') or (vp.BENHNHAN_PHAITHANHTOAN > vp.GIATRI_BENHNHAN_DATHANHTOAN and vp.DATHANHTOAN = '1'))   AND             VP.KHONGTHUTIEN != '1'                   ) a        left join (select VIENPHI_ID,        sum(MGCT.GIATRIMIENGIAM) AS GIATRIMIENGIAM_BH from TT_MIENGIAM MG        INNER JOIN TT_MIENGIAM_CHITIET MGCT ON MG.MIENGIAM_ID = MGCT.MIENGIAM_ID        where MG.TIEPNHAN_ID= '8747' and MGCT.REF_TABLE = 'TT_MIENGIAM' and MG.TINHTRANG = 1 group by VIENPHI_ID        ) b on a.VIENPHI_ID = b.VIENPHI_ID          left join (select VIENPHI_ID, sum(MGCT.GIATRIMIENGIAM) AS GIATRIMIENGIAM_BHTN        from TT_MIENGIAM_BHTN MG        INNER JOIN TT_MIENGIAM_CHITIET MGCT ON MG.MIENGIAM_BHTN_ID = MGCT.MIENGIAM_ID        where  MG.TIEPNHAN_ID= '8747' and MGCT.REF_TABLE = 'TT_MIENGIAM_BHTN' and MG.TINHTRANG = 1 group by VIENPHI_ID        )c on a.VIENPHI_ID = c.VIENPHI_ID          left join (select VIENPHI_ID, sum(MGCT.GIATRIMIENGIAM) AS GIATRIMIENGIAM_THANHVIEN        from TT_MIENGIAM_THANHVIEN MG        INNER JOIN TT_MIENGIAM_CHITIET MGCT ON MG.MIENGIAM_THANHVIEN_ID = MGCT.MIENGIAM_ID        where MG.TIEPNHAN_ID= '8747' and MGCT.REF_TABLE = 'TT_MIENGIAM_THANHVIEN' and MG.TINHTRANG = 1 group by VIENPHI_ID        )f on a.VIENPHI_ID = f.VIENPHI_ID          left join(select VIENPHI_ID, sum(MGCT.GIATRIMIENGIAM) AS GIATRIMIENGIAM_CTCT        from TT_MIENGIAM_CONGTY MG        INNER JOIN TT_MIENGIAM_CHITIET MGCT ON MG.MIENGIAM_CONGTY_ID = MGCT.MIENGIAM_ID        where MG.TIEPNHAN_ID= '8747' and MGCT.REF_TABLE = 'TT_MIENGIAM_CONGTY' and MG.TINHTRANG = 1 group by VIENPHI_ID        )g on a.VIENPHI_ID = g.VIENPHI_ID]
2020-07-16 15:50:09,959 [1] DEBUG - Statement Id: [DAO00119_GetDataTamUng_HoaUng] PreparedStatement : [select SUM(TAMUNG) AS TONGTIEN_TU, SUM(HOANUNG) AS TONGTIEN_HU, TIEPNHAN_ID        from (        select HD.TIEPNHAN_ID,        CASE WHEN LOAIHOADON = 'TU' then HD.GIATRIHOADON ELSE 0 END TAMUNG,        CASE WHEN LOAIHOADON = 'HU' then HD.GIATRIHOADON ELSE 0 END HOANUNG        from TT_HOADON HD        where HD.DATHANHTOAN = '1' and HD.HUYHOADON = '0' and HD.HOANTRA = '0'        and HD.TIEPNHAN_ID = 8747        and HD.BENHVIEN_ID = '01819'        ) temp        group by temp.TIEPNHAN_ID]
2020-07-16 15:50:10,121 [1] DEBUG - Statement Id: [DAO00403_QMS002_GetThongTinClient] PreparedStatement : [SELECT B.ID as QUEUE_ID, B.NAME AS QUEUE_NAME,A.ID AS CLIENT_ID , A.[NAME] AS CLIENT_NAME, ISNULL(A.[STATE],1) AS [STATE],(CASE C.NAME WHEN 'UT' THEN 1 ELSE 0 END) AS QUEUETYPE     , B.DEPARTMENT_ID,ISNULL(B.SECTION_ID,-1) AS SECTION_ID,A.IPSERVER,A.NAMEAUDIO,C.QUEUE_TYPE_CODE,C.QUEUE_TYPE_CODE_SOUND,S.[NAME] AS SECTIONNAME     FROM QMS_QUEUE B LEFT JOIN QMS_CLIENT A ON A.QUEUE_ID = B.ID     LEFT JOIN QMS_QUEUE_TYPE C ON B.QUEUETYPE_ID = C.ID     LEFT JOIN QMS_SECTION S ON B.SECTION_ID=S.ID     WHERE     (A.COMPUTERNAME = 'DESKTOP-89GE5BA' OR A.IPADDRESS = '10.15.167.38') AND A.[STATE] = 1 AND B.DEPARTMENT_ID='74'            AND B.BENHVIEN_ID = '01819']
2020-07-16 15:50:10,179 [1] DEBUG - Statement Id: [DAO00101_GetListSuatAn] PreparedStatement : [SELECT        kP.KHAUPHANAN_ID,        kP.MAKHAUPHANAN,        kP.TENKHAUPHANAN,        LKP.LOAIKHAUPHANAN_ID,        LKP.MALOAIKHAUPHANAN,        LKP.TENLOAIKHAUPHANAN,        DG.DONGIA,        kP.HANGMUC_ID        FROM TM_NUT_KHAUPHANAN kP        INNER JOIN TM_NUT_LOAIKHAUPHANAN LKP ON  kP.LOAIKHAUPHANAN_ID = LKP.LOAIKHAUPHANAN_ID        INNER JOIN TM_NUT_KHAUPHANAN_DONGIA DG ON DG.KHAUPHANAN_ID = kP.KHAUPHANAN_ID        WHERE DG.DONGIA IS NOT NULL]
2020-07-16 15:50:35,131 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = '01819'               AND                   TM_SYS_SCREEN.PAGE = 'BIL02'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2020-07-16 15:50:35,334 [1] DEBUG - Statement Id: [DAO00012_GetList] PreparedStatement : [select        DICTIONARY_ID,        DICTIONARY_CODE,        DICTIONARY_NAME,        ATTRIBUTE1,        ATTRIBUTE2,        DICTIONARY_NAME_EN,        DICTIONARY_TYPE_CODE        from LST_DICTIONARY        where LST_DICTIONARY.Enabled = '1'         AND           LST_DICTIONARY.DICTIONARY_TYPE_CODE = 'LoaiBienLai'                 order by LST_DICTIONARY.IDX]
2020-07-16 15:50:35,529 [1] DEBUG - Statement Id: [DAO00012_GetList] PreparedStatement : [select        DICTIONARY_ID,        DICTIONARY_CODE,        DICTIONARY_NAME,        ATTRIBUTE1,        ATTRIBUTE2,        DICTIONARY_NAME_EN,        DICTIONARY_TYPE_CODE        from LST_DICTIONARY        where LST_DICTIONARY.Enabled = '1'         AND           LST_DICTIONARY.DICTIONARY_TYPE_CODE = 'ChucDanh'                 order by LST_DICTIONARY.IDX]
2020-07-16 15:50:35,579 [1] DEBUG - Statement Id: [DAO00012_GetList] PreparedStatement : [select        DICTIONARY_ID,        DICTIONARY_CODE,        DICTIONARY_NAME,        ATTRIBUTE1,        ATTRIBUTE2,        DICTIONARY_NAME_EN,        DICTIONARY_TYPE_CODE        from LST_DICTIONARY        where LST_DICTIONARY.Enabled = '1'         AND           LST_DICTIONARY.DICTIONARY_TYPE_CODE = 'ChucVu'                 order by LST_DICTIONARY.IDX]
2020-07-16 15:50:35,643 [1] DEBUG - Statement Id: [DAO00021_GetDSBienLai] PreparedStatement : [select *              from TT_BIENLAI              where  BENHVIEN_ID = '01819'              order by BIENLAI_ID]
2020-07-16 15:50:35,670 [1] DEBUG - Statement Id: [DAO00021_GetDSBLChiTiet] PreparedStatement : [select *              from TT_BIENLAICHITIET              where              BIENLAI_ID = '1'              and BENHVIEN_ID = '01819']
2020-07-16 15:50:35,696 [1] DEBUG - Statement Id: [DAO00021_GetDSBLChiTiet] PreparedStatement : [select *              from TT_BIENLAICHITIET              where              BIENLAI_ID = '1002'              and BENHVIEN_ID = '01819']
2020-07-16 15:50:35,719 [1] DEBUG - Statement Id: [DAO00021_GetDSBLChiTiet] PreparedStatement : [select *              from TT_BIENLAICHITIET              where              BIENLAI_ID = '1003'              and BENHVIEN_ID = '01819']
2020-07-16 15:50:35,743 [1] DEBUG - Statement Id: [DAO00021_GetDSBLChiTiet] PreparedStatement : [select *              from TT_BIENLAICHITIET              where              BIENLAI_ID = '2002'              and BENHVIEN_ID = '01819']
2020-07-16 15:50:35,766 [1] DEBUG - Statement Id: [DAO00021_GetDSBLChiTiet] PreparedStatement : [select *              from TT_BIENLAICHITIET              where              BIENLAI_ID = '2003'              and BENHVIEN_ID = '01819']
2020-07-16 15:50:35,790 [1] DEBUG - Statement Id: [DAO00021_GetDSBLChiTiet] PreparedStatement : [select *              from TT_BIENLAICHITIET              where              BIENLAI_ID = '2004'              and BENHVIEN_ID = '01819']
2020-07-16 15:50:35,812 [1] DEBUG - Statement Id: [DAO00021_GetDSBLChiTiet] PreparedStatement : [select *              from TT_BIENLAICHITIET              where              BIENLAI_ID = '2005'              and BENHVIEN_ID = '01819']
2020-07-16 15:50:35,836 [1] DEBUG - Statement Id: [DAO00021_GetDSBLChiTiet] PreparedStatement : [select *              from TT_BIENLAICHITIET              where              BIENLAI_ID = '2006'              and BENHVIEN_ID = '01819']
2020-07-16 15:50:35,859 [1] DEBUG - Statement Id: [DAO00021_GetDSBLChiTiet] PreparedStatement : [select *              from TT_BIENLAICHITIET              where              BIENLAI_ID = '2007'              and BENHVIEN_ID = '01819']
2020-07-16 15:50:35,883 [1] DEBUG - Statement Id: [DAO00021_GetDSBLChiTiet] PreparedStatement : [select *              from TT_BIENLAICHITIET              where              BIENLAI_ID = '2010'              and BENHVIEN_ID = '01819']
2020-07-16 15:50:35,906 [1] DEBUG - Statement Id: [DAO00021_GetDSBLChiTiet] PreparedStatement : [select *              from TT_BIENLAICHITIET              where              BIENLAI_ID = '2011'              and BENHVIEN_ID = '01819']
2020-07-16 15:50:35,929 [1] DEBUG - Statement Id: [DAO00021_GetDSBLChiTiet] PreparedStatement : [select *              from TT_BIENLAICHITIET              where              BIENLAI_ID = '2012'              and BENHVIEN_ID = '01819']
2020-07-16 15:50:35,953 [1] DEBUG - Statement Id: [DAO00021_GetDSBLChiTiet] PreparedStatement : [select *              from TT_BIENLAICHITIET              where              BIENLAI_ID = '2013'              and BENHVIEN_ID = '01819']
2020-07-16 15:50:35,976 [1] DEBUG - Statement Id: [DAO00021_GetDSBLChiTiet] PreparedStatement : [select *              from TT_BIENLAICHITIET              where              BIENLAI_ID = '2014'              and BENHVIEN_ID = '01819']
2020-07-16 15:50:35,999 [1] DEBUG - Statement Id: [DAO00021_GetDSBLChiTiet] PreparedStatement : [select *              from TT_BIENLAICHITIET              where              BIENLAI_ID = '2018'              and BENHVIEN_ID = '01819']
2020-07-16 15:50:36,022 [1] DEBUG - Statement Id: [DAO00021_GetDSBLChiTiet] PreparedStatement : [select *              from TT_BIENLAICHITIET              where              BIENLAI_ID = '2020'              and BENHVIEN_ID = '01819']
2020-07-16 15:50:36,045 [1] DEBUG - Statement Id: [DAO00021_GetDSBLChiTiet] PreparedStatement : [select *              from TT_BIENLAICHITIET              where              BIENLAI_ID = '2021'              and BENHVIEN_ID = '01819']
2020-07-16 15:50:36,146 [1] DEBUG - Statement Id: [DAO00021_GetDSBienLai] PreparedStatement : [select *              from TT_BIENLAI              where  BENHVIEN_ID = '01819'              order by BIENLAI_ID]
2020-07-16 15:50:36,171 [1] DEBUG - Statement Id: [DAO00021_GetDSBLChiTiet] PreparedStatement : [select *              from TT_BIENLAICHITIET              where              BIENLAI_ID = '1'              and BENHVIEN_ID = '01819']
2020-07-16 15:50:36,194 [1] DEBUG - Statement Id: [DAO00021_GetDSBLChiTiet] PreparedStatement : [select *              from TT_BIENLAICHITIET              where              BIENLAI_ID = '1002'              and BENHVIEN_ID = '01819']
2020-07-16 15:50:36,216 [1] DEBUG - Statement Id: [DAO00021_GetDSBLChiTiet] PreparedStatement : [select *              from TT_BIENLAICHITIET              where              BIENLAI_ID = '1003'              and BENHVIEN_ID = '01819']
2020-07-16 15:50:36,239 [1] DEBUG - Statement Id: [DAO00021_GetDSBLChiTiet] PreparedStatement : [select *              from TT_BIENLAICHITIET              where              BIENLAI_ID = '2002'              and BENHVIEN_ID = '01819']
2020-07-16 15:50:36,262 [1] DEBUG - Statement Id: [DAO00021_GetDSBLChiTiet] PreparedStatement : [select *              from TT_BIENLAICHITIET              where              BIENLAI_ID = '2003'              and BENHVIEN_ID = '01819']
2020-07-16 15:50:36,286 [1] DEBUG - Statement Id: [DAO00021_GetDSBLChiTiet] PreparedStatement : [select *              from TT_BIENLAICHITIET              where              BIENLAI_ID = '2004'              and BENHVIEN_ID = '01819']
2020-07-16 15:50:36,308 [1] DEBUG - Statement Id: [DAO00021_GetDSBLChiTiet] PreparedStatement : [select *              from TT_BIENLAICHITIET              where              BIENLAI_ID = '2005'              and BENHVIEN_ID = '01819']
2020-07-16 15:50:36,332 [1] DEBUG - Statement Id: [DAO00021_GetDSBLChiTiet] PreparedStatement : [select *              from TT_BIENLAICHITIET              where              BIENLAI_ID = '2006'              and BENHVIEN_ID = '01819']
2020-07-16 15:50:36,355 [1] DEBUG - Statement Id: [DAO00021_GetDSBLChiTiet] PreparedStatement : [select *              from TT_BIENLAICHITIET              where              BIENLAI_ID = '2007'              and BENHVIEN_ID = '01819']
2020-07-16 15:50:36,380 [1] DEBUG - Statement Id: [DAO00021_GetDSBLChiTiet] PreparedStatement : [select *              from TT_BIENLAICHITIET              where              BIENLAI_ID = '2010'              and BENHVIEN_ID = '01819']
2020-07-16 15:50:36,403 [1] DEBUG - Statement Id: [DAO00021_GetDSBLChiTiet] PreparedStatement : [select *              from TT_BIENLAICHITIET              where              BIENLAI_ID = '2011'              and BENHVIEN_ID = '01819']
2020-07-16 15:50:36,426 [1] DEBUG - Statement Id: [DAO00021_GetDSBLChiTiet] PreparedStatement : [select *              from TT_BIENLAICHITIET              where              BIENLAI_ID = '2012'              and BENHVIEN_ID = '01819']
2020-07-16 15:50:36,448 [1] DEBUG - Statement Id: [DAO00021_GetDSBLChiTiet] PreparedStatement : [select *              from TT_BIENLAICHITIET              where              BIENLAI_ID = '2013'              and BENHVIEN_ID = '01819']
2020-07-16 15:50:36,471 [1] DEBUG - Statement Id: [DAO00021_GetDSBLChiTiet] PreparedStatement : [select *              from TT_BIENLAICHITIET              where              BIENLAI_ID = '2014'              and BENHVIEN_ID = '01819']
2020-07-16 15:50:36,494 [1] DEBUG - Statement Id: [DAO00021_GetDSBLChiTiet] PreparedStatement : [select *              from TT_BIENLAICHITIET              where              BIENLAI_ID = '2018'              and BENHVIEN_ID = '01819']
2020-07-16 15:50:36,516 [1] DEBUG - Statement Id: [DAO00021_GetDSBLChiTiet] PreparedStatement : [select *              from TT_BIENLAICHITIET              where              BIENLAI_ID = '2020'              and BENHVIEN_ID = '01819']
2020-07-16 15:50:36,539 [1] DEBUG - Statement Id: [DAO00021_GetDSBLChiTiet] PreparedStatement : [select *              from TT_BIENLAICHITIET              where              BIENLAI_ID = '2021'              and BENHVIEN_ID = '01819']
2020-07-16 15:50:50,904 [1] DEBUG - Statement Id: [DAO00021_LuuBienLai] PreparedStatement : [insert into TT_BIENLAI (            LOAIBIENLAI_ID            , LOAIBIENLAI            , NGAYPHATHANH            , THOIGIANPHATHANH            , KYHIEU            , SERIES            , MIN_NUMBER            , MAX_NUMBER            , BENHVIEN_ID            , NGUOITAO_ID            , NGAYTAO            , MACHINE_NAME                         ) values (             @param0             ,  @param1             ,  @param2             ,  @param3             ,  @param4             ,  @param5             ,  @param6             ,  @param7             ,  @param8             ,  @param9             ,  @param10             ,  @param11                            )              SELECT SCOPE_IDENTITY()]
2020-07-16 15:50:50,905 [1] DEBUG - Statement Id: [DAO00021_LuuBienLai] Parameters: [@param0=[LOAIBIENLAI_ID,5048], @param1=[LOAIBIENLAI,HD], @param2=[NGAYPHATHANH,7/16/2020 3:50:35 PM], @param3=[THOIGIANPHATHANH,null], @param4=[KYHIEU,sa], @param5=[SERIES,1], @param6=[MIN_NUMBER,1], @param7=[MAX_NUMBER,100], @param8=[BENHVIEN_ID,01819], @param9=[NGUOITAO_ID,1], @param10=[NGAYTAO,7/16/2020 3:50:50 PM], @param11=[MACHINE_NAME,null]]
2020-07-16 15:50:50,905 [1] DEBUG - Statement Id: [DAO00021_LuuBienLai] Types: [@param0=[Int64, System.Int64], @param1=[String, System.String], @param2=[DateTime, System.DateTime], @param3=[System.DBNull, null], @param4=[String, System.String], @param5=[String, System.String], @param6=[Int64, System.Int64], @param7=[Int64, System.Int64], @param8=[String, System.String], @param9=[Int64, System.Int64], @param10=[DateTime, System.DateTime], @param11=[System.DBNull, null]]
2020-07-16 15:51:02,289 [1] DEBUG - Statement Id: [DAO00019_GetListDichVuDuocDongTien] PreparedStatement : [select * from        (        select COUNT(*) OVER() as TOTALROWS, ROW_NUMBER() OVER(order by tn.MAYTE, isnull(tn.SOTHUTU,'999999999')) as ROWNUMBER,        ISNULL(A.DUOC_ID, A.DICHVU_ID) as DICHVU_ID, ISNULL(B.TENDUOCDAYDU, C.TENDICHVU) as TENDICHVU,        (CASE WHEN A.DUOC_ID is null THEN E.NOITHUCHIEN_ID ELSE 0 END) as NOITHUCHIEN_ID,        0 as NOIYEUCAU_ID, 0 as NOIGIOITHIEU_ID, 0 as BACSICHIDINH_ID, isnull(E.NGAYTAO, E.NGAYCAPNHAT) as THOIGIANDKDICHVU,        tn.*, isnull(tn.SOTHUTU,'999999999') as SOHANGDOI, null as KHAN, '' as STATUS_CODE        from TT_VIENPHI A        left join TM_DUOC B on B.DUOC_ID = A.DUOC_ID and B.BENHVIEN_ID = '01819'        left join TM_DICHVU C on C.DICHVU_ID = A.DICHVU_ID and C.BENHVIEN_ID = '01819'        inner join        (        select A.TIEPNHAN_ID, A.SOTIEPNHAN, A.DOITUONG_ID, A.SOTHUTU, A.NGAYTIEPNHAN, B.*, C.TENDOITUONG from TT_TIEPNHAN A        inner join TT_BENHNHAN B on A.BENHNHAN_ID = B.BENHNHAN_ID        inner join TM_DOITUONG C on A.DOITUONG_ID = C.DOITUONG_ID        where A.TRANGTHAI in ('DATIEPNHAN', 'HOANTHANH') and A.BENHVIEN_ID = '01819'        ) tn on tn.TIEPNHAN_ID = A.TIEPNHAN_ID        left join TT_DVYEUCAU E on E.DVYEUCAU_ID = A.REF_ID        where        A.BENHAN_ID is null and        ((A.REF_TABLE = 'TT_DVYEUCAU' and E.HUYYEUCAU = '0') or (A.DUOC_ID is not null and A.DATHUCHIEN = '1')) and        ((A.DATHANHTOAN = '0' or A.DATHANHTOAN is null) and A.KHONGTHUTIEN = '0') and A.BENHVIEN_ID = '01819'           and               tn.NGAYTIEPNHAN >= '7/16/2020 12:00:00 AM'             and               tn.NGAYTIEPNHAN <= '7/16/2020 12:00:00 AM'                     ) lst                    where          lst.ROWNUMBER between 1 and 19                 order by MAYTE, SOHANGDOI asc]
2020-07-16 15:51:02,330 [1] DEBUG - Statement Id: [DAO00019_GetCountBenhNhanDichVuDuocDongTien] PreparedStatement : [select count(distinct tn.MAYTE) TOTAL_BENHNHAN        from TT_VIENPHI A        left join TM_DUOC B on B.DUOC_ID = A.DUOC_ID and B.BENHVIEN_ID = '01819'        left join TM_DICHVU C on C.DICHVU_ID = A.DICHVU_ID and C.BENHVIEN_ID = '01819'        inner join        (        select A.TIEPNHAN_ID, A.SOTIEPNHAN, A.DOITUONG_ID, A.SOTHUTU, A.NGAYTIEPNHAN, B.*, C.TENDOITUONG from TT_TIEPNHAN A        inner join TT_BENHNHAN B on A.BENHNHAN_ID = B.BENHNHAN_ID        inner join TM_DOITUONG C on A.DOITUONG_ID = C.DOITUONG_ID        where A.TRANGTHAI in ('DATIEPNHAN', 'HOANTHANH') and A.BENHVIEN_ID = '01819'        ) tn on tn.TIEPNHAN_ID = A.TIEPNHAN_ID        left join TT_DVYEUCAU E on E.DVYEUCAU_ID = A.REF_ID        where        A.BENHAN_ID is null and        ((A.REF_TABLE = 'TT_DVYEUCAU' and E.HUYYEUCAU = '0') or (A.DUOC_ID is not null and A.DATHUCHIEN = '1')) and        ((A.DATHANHTOAN = '0' or A.DATHANHTOAN is null) and A.KHONGTHUTIEN = '0') and A.BENHVIEN_ID = '01819'           and               tn.NGAYTIEPNHAN >= '7/16/2020 12:00:00 AM'             and               tn.NGAYTIEPNHAN <= '7/16/2020 12:00:00 AM']
2020-07-16 15:51:03,284 [1] DEBUG - Statement Id: [DAO00119_GetDanhsachHTTT] PreparedStatement : [select * from LST_DICTIONARY where DICTIONARY_TYPE_CODE = 'HinhThucThanhToan' and ENABLED = '1' and BENHVIEN_ID = '01819']
2020-07-16 15:51:03,340 [1] DEBUG - Statement Id: [DAO00021_GetListSoBienLai] PreparedStatement : [select            BLCT.BIENLAICHITIET_ID            ,BL.*                         ,BL.KYHIEU + '/' + SERIES AS 'KYHIEU_SOQUYEN'                         ,BLCT.START_NUMBER            ,BLCT.CURRENT_NUMBER            ,BLCT.HIEULUC            ,BLCT.NGUOISUDUNG_ID            from TT_BIENLAICHITIET BLCT            left join TT_BIENLAI BL on BL.BIENLAI_ID = BLCT.BIENLAI_ID            where            (bl.MAX_NUMBER > (select MAX(CURRENT_NUMBER) from TT_BIENLAICHITIET where BIENLAI_ID = BLCT.BIENLAI_ID) or BLCT.CURRENT_NUMBER is null)            and BLCT.HIEULUC = 1            and BLCT.NGUOISUDUNG_ID =   @param0             and BL.BENHVIEN_ID =  @param1              and               BLCT.BIENLAICHITIET_ID = '2002'                         order by BLCT.THOIGIANSUDUNG DESC]
2020-07-16 15:51:03,341 [1] DEBUG - Statement Id: [DAO00021_GetListSoBienLai] Parameters: [@param0=[NGUOISUDUNG_ID,1], @param1=[BENHVIEN_ID,01819]]
2020-07-16 15:51:03,341 [1] DEBUG - Statement Id: [DAO00021_GetListSoBienLai] Types: [@param0=[Int64, System.Int64], @param1=[String, System.String]]
2020-07-16 15:51:03,366 [1] DEBUG - Statement Id: [DAO00119_GetDanhsachHTTT] PreparedStatement : [select * from LST_DICTIONARY where DICTIONARY_TYPE_CODE = 'HinhThucThanhToan' and ENABLED = '1' and BENHVIEN_ID = '01819']
2020-07-16 15:51:03,413 [1] DEBUG - Statement Id: [DAO00119_GetLichSuThanhToan] PreparedStatement : [select        SUM(THANHTOAN) AS TONGDATHANHTOAN, SUM(TAMUNG) AS TONGTAMUNG, SUM(HOANUNG) AS TONGHOANUNG,        SUM(MIENGIAM) AS TONGMIENGIAM, SUM(THATTHU) AS TONGTHATTHU, TIEPNHAN_ID        from (        select HD.TIEPNHAN_ID,        CASE WHEN LOAIHOADON = 'TU' then HD.GIATRIHOADON ELSE 0 END TAMUNG,        CASE WHEN LOAIHOADON = 'HU' then HD.GIATRIHOADON ELSE 0 END HOANUNG,        CASE WHEN LOAIHOADON = 'BL' then HD.GIATRIHOADON ELSE 0 END THANHTOAN,        0 MIENGIAM,        0 THATTHU        from TT_HOADON HD        where HD.DATHANHTOAN = '1' and HD.HUYHOADON = '0' and HD.HOANTRA = '0'        and HD.TIEPNHAN_ID = 8747        and HD.BENHVIEN_ID = '01819'          Union          select HD.TIEPNHAN_ID,        0 TAMUNG,        0 HOANUNG,        0 THANHTOAN,        SUM(hdct.MIENGIAM_GIATRI) AS MIENGIAM,        SUM(hdct.BENHNHAN_PHAITHANHTOAN) - SUM(hdct.GIATRI_HOADON_DATHANHTOAN) AS THATTHU        from TT_HOADON HD        join TT_HOADON_CHITIET_NGOAITRU hdct on HD.HOADON_ID = hdct.HOADON_ID        where HD.DATHANHTOAN = '1' and HD.HUYHOADON = '0' and HD.HOANTRA = '0'        and HD.TIEPNHAN_ID = 8747        and HD.BENHVIEN_ID = '01819'        group by TIEPNHAN_ID        ) temp        group by temp.TIEPNHAN_ID]
2020-07-16 15:51:03,439 [1] DEBUG - Statement Id: [DAO00021_GetListSoBienLai] PreparedStatement : [select            BLCT.BIENLAICHITIET_ID            ,BL.*                         ,BL.KYHIEU + '/' + SERIES AS 'KYHIEU_SOQUYEN'                         ,BLCT.START_NUMBER            ,BLCT.CURRENT_NUMBER            ,BLCT.HIEULUC            ,BLCT.NGUOISUDUNG_ID            from TT_BIENLAICHITIET BLCT            left join TT_BIENLAI BL on BL.BIENLAI_ID = BLCT.BIENLAI_ID            where            (bl.MAX_NUMBER > (select MAX(CURRENT_NUMBER) from TT_BIENLAICHITIET where BIENLAI_ID = BLCT.BIENLAI_ID) or BLCT.CURRENT_NUMBER is null)            and BLCT.HIEULUC = 1            and BLCT.NGUOISUDUNG_ID =   @param0             and BL.BENHVIEN_ID =  @param1                          order by BLCT.THOIGIANSUDUNG DESC]
2020-07-16 15:51:03,439 [1] DEBUG - Statement Id: [DAO00021_GetListSoBienLai] Parameters: [@param0=[NGUOISUDUNG_ID,1], @param1=[BENHVIEN_ID,01819]]
2020-07-16 15:51:03,439 [1] DEBUG - Statement Id: [DAO00021_GetListSoBienLai] Types: [@param0=[Int64, System.Int64], @param1=[String, System.String]]
2020-07-16 15:51:03,467 [1] DEBUG - Statement Id: [DAO00021_GetListSoBienLai] PreparedStatement : [select            BLCT.BIENLAICHITIET_ID            ,BL.*                         ,BL.KYHIEU + '/' + SERIES AS 'KYHIEU_SOQUYEN'                         ,BLCT.START_NUMBER            ,BLCT.CURRENT_NUMBER            ,BLCT.HIEULUC            ,BLCT.NGUOISUDUNG_ID            from TT_BIENLAICHITIET BLCT            left join TT_BIENLAI BL on BL.BIENLAI_ID = BLCT.BIENLAI_ID            where            (bl.MAX_NUMBER > (select MAX(CURRENT_NUMBER) from TT_BIENLAICHITIET where BIENLAI_ID = BLCT.BIENLAI_ID) or BLCT.CURRENT_NUMBER is null)            and BLCT.HIEULUC = 1            and BLCT.NGUOISUDUNG_ID =   @param0             and BL.BENHVIEN_ID =  @param1                          order by BLCT.THOIGIANSUDUNG DESC]
2020-07-16 15:51:03,467 [1] DEBUG - Statement Id: [DAO00021_GetListSoBienLai] Parameters: [@param0=[NGUOISUDUNG_ID,1], @param1=[BENHVIEN_ID,01819]]
2020-07-16 15:51:03,467 [1] DEBUG - Statement Id: [DAO00021_GetListSoBienLai] Types: [@param0=[Int64, System.Int64], @param1=[String, System.String]]
2020-07-16 15:51:03,493 [1] DEBUG - Statement Id: [DAO00021_GetListSoBienLai] PreparedStatement : [select            BLCT.BIENLAICHITIET_ID            ,BL.*                         ,BL.KYHIEU + '/' + SERIES AS 'KYHIEU_SOQUYEN'                         ,BLCT.START_NUMBER            ,BLCT.CURRENT_NUMBER            ,BLCT.HIEULUC            ,BLCT.NGUOISUDUNG_ID            from TT_BIENLAICHITIET BLCT            left join TT_BIENLAI BL on BL.BIENLAI_ID = BLCT.BIENLAI_ID            where            (bl.MAX_NUMBER > (select MAX(CURRENT_NUMBER) from TT_BIENLAICHITIET where BIENLAI_ID = BLCT.BIENLAI_ID) or BLCT.CURRENT_NUMBER is null)            and BLCT.HIEULUC = 1            and BLCT.NGUOISUDUNG_ID =   @param0             and BL.BENHVIEN_ID =  @param1              and               BLCT.BIENLAICHITIET_ID = '2002'                         order by BLCT.THOIGIANSUDUNG DESC]
2020-07-16 15:51:03,493 [1] DEBUG - Statement Id: [DAO00021_GetListSoBienLai] Parameters: [@param0=[NGUOISUDUNG_ID,1], @param1=[BENHVIEN_ID,01819]]
2020-07-16 15:51:03,493 [1] DEBUG - Statement Id: [DAO00021_GetListSoBienLai] Types: [@param0=[Int64, System.Int64], @param1=[String, System.String]]
2020-07-16 15:51:03,526 [1] DEBUG - Statement Id: [DAO00064_GetlistTT_TIEPNHAN_SOTHEBHYT] PreparedStatement : [select stbhyt.*, ba.SOBENHAN,        tn.SOTIEPNHAN, tn.LOAITHANHVIEN_ID, tn.THE_ID, tn.THANHVIEN_ID,        tn.SUDUNG_BHTN, tn.BAOLANH_VIENPHI, tn.VIP, tn.NGUOINUOCNGOAI, tn.NGOAIGIO        from TT_TIEPNHAN_SOTHEBHYT stbhyt        left join TT_TIEPNHAN tn on tn.TIEPNHAN_ID = stbhyt.TIEPNHAN_ID        left join TT_NOITRU_BENHAN ba on ba.TIEPNHAN_ID = stbhyt.TIEPNHAN_ID        where        stbhyt.TIEPNHAN_ID = '8747' and isnull(stbhyt.KHONGSUDUNG, '0') = '0']
2020-07-16 15:51:03,554 [1] DEBUG - Statement Id: [DAO00064_GetListVienPhiByTiepNnan] PreparedStatement : [select distinct        B.DOITUONG_ID, B.NGAYMIENDONGCHITRA, B.BENHNHAN_ID as TIEPNHAN_BENHNHAN_ID, B.TRAITUYEN,        B.BHYTTREN3NAM as TREN3NAM, B.BHYTTREN5NAM as TREN5NAM, B.SOTIEPNHAN, B.SOBENHAN,        B.LOAITHANHVIEN_ID, B.SUDUNG_BHTN, B.THE_ID, B.THANHVIEN_ID, B.BAOLANH_VIENPHI, B.VIP, B.NGUOINUOCNGOAI,        C.GIATRIMIENGIAM as GIATRIMIENGIAM, D.GIATRIMIENGIAM as GIATRIMIENGIAM_BHTN, E.GIATRIMIENGIAM as GIATRIMIENGIAM_THANHVIEN,        F.GIATRIMIENGIAM as GIATRIMIENGIAM_CONGTY, DVYC.THE_ID as DVDUNGTHE, DVYC.TRANGTHAI as TRANGTHAIDICHVU, ndv.MANHOMDICHVU,        A.* from TT_VIENPHI A        left join        (select B.*, C.SOBENHAN, C.BENHAN_ID        from TT_TIEPNHAN B        left join TT_NOITRU_BENHAN C on B.TIEPNHAN_ID = C.TIEPNHAN_ID                 where B.TIEPNHAN_ID = '8747') B on B.TIEPNHAN_ID = A.TIEPNHAN_ID        left join (select sum(GIATRIMIENGIAM) as GIATRIMIENGIAM, VIENPHI_ID, REF_TABLE        from TT_MIENGIAM_CHITIET        where REF_TABLE = 'TT_MIENGIAM'        and exists (select MIENGIAM_ID from TT_MIENGIAM where TT_MIENGIAM_CHITIET.MIENGIAM_ID = MIENGIAM_ID and TINHTRANG = 1 and TIEPNHAN_ID = '8747')        group by VIENPHI_ID, REF_TABLE) C on C.REF_TABLE = 'TT_MIENGIAM' and C.VIENPHI_ID = A.VIENPHI_ID        left join (select sum(GIATRIMIENGIAM) as GIATRIMIENGIAM, VIENPHI_ID, REF_TABLE        from TT_MIENGIAM_CHITIET        where REF_TABLE = 'TT_MIENGIAM_BHTN'        and exists (select MIENGIAM_BHTN_ID from TT_MIENGIAM_BHTN where TT_MIENGIAM_CHITIET.MIENGIAM_ID = MIENGIAM_BHTN_ID and  TINHTRANG = 1 and TIEPNHAN_ID = '8747')        group by VIENPHI_ID, REF_TABLE) D on D.REF_TABLE = 'TT_MIENGIAM_BHTN' and D.VIENPHI_ID = A.VIENPHI_ID        left join (select sum(GIATRIMIENGIAM) as GIATRIMIENGIAM, VIENPHI_ID, REF_TABLE        from TT_MIENGIAM_CHITIET        where REF_TABLE = 'TT_MIENGIAM_THANHVIEN'        and exists (select MIENGIAM_THANHVIEN_ID from TT_MIENGIAM_THANHVIEN where TT_MIENGIAM_CHITIET.MIENGIAM_ID = MIENGIAM_THANHVIEN_ID and TINHTRANG = 1 and TIEPNHAN_ID = '8747')        group by VIENPHI_ID, REF_TABLE) E on E.REF_TABLE = 'TT_MIENGIAM_THANHVIEN' and E.VIENPHI_ID = A.VIENPHI_ID        left join (select sum(GIATRIMIENGIAM) as GIATRIMIENGIAM, VIENPHI_ID, REF_TABLE        from TT_MIENGIAM_CHITIET        where REF_TABLE = 'TT_MIENGIAM_CONGTY'        and exists (select MIENGIAM_CONGTY_ID from TT_MIENGIAM_CONGTY where TT_MIENGIAM_CHITIET.MIENGIAM_ID = MIENGIAM_CONGTY_ID and TINHTRANG = 1 and TIEPNHAN_ID = '8747')        group by VIENPHI_ID, REF_TABLE) F on F.REF_TABLE = 'TT_MIENGIAM_CONGTY' and F.VIENPHI_ID = A.VIENPHI_ID        left join TT_DVYEUCAU DVYC on DVYC.DVYEUCAU_ID = A.REF_ID and A.REF_TABLE = 'TT_DVYEUCAU'        left join TM_DICHVU DV on DVYC.DICHVU_ID = DV.DICHVU_ID and A.REF_TABLE = 'TT_DVYEUCAU'        left join TM_NHOMDICHVU ndv on ndv.NHOMDICHVU_ID = DV.NHOMDICHVU_ID and A.REF_TABLE = 'TT_DVYEUCAU'        where        A.TIEPNHAN_ID = '8747' and ((DVYC.HUYYEUCAU = '0' and A.DICHVU_ID is not null)        or A.DUOC_ID is not null or A.REF_TABLE = 'TT_NUT_XACNHANSUATAN_CHITIET')        and A.ACTIVE = '1'                 and A.BENHVIEN_ID = '01819'        order by A.VIENPHI_ID]
2020-07-16 15:51:03,581 [1] DEBUG - Statement Id: [DAO00006_GetListDuocTyle] PreparedStatement : [select DUOC_ID, DOITUONG_ID, (TYLE/100) as TYLE, DONGIA MUCTRAN_THANHTOAN from TM_DOITUONG_GIADUOC_TYLE            where            BENHVIEN_ID = '01819'            and DOITUONG_ID = '0']
2020-07-16 15:51:03,604 [1] DEBUG - Statement Id: [DAO00027_GetListTuongTrinhDichVuPhauThuatCuaTiepNhan] PreparedStatement : [declare @ManhomDSA varchar(10);        declare @PhanLoaiNhomDV varchar(20) = '05';        select top 1  @ManhomDSA = VALUE from TM_SYS_APPSETTINGS where CODE = 'MANHOM_DICHVU_DSA'        if (@ManhomDSA is not null) set @PhanLoaiNhomDV += ',' + @ManhomDSA        select distinct ptyc.*        from TT_PHAUTHUAT_YEUCAU ptyc        inner join TM_DICHVU dv on dv.DICHVU_ID = ptyc.DICHVU_ID        inner join TM_NHOMDICHVU ndv on ndv.NHOMDICHVU_ID = dv.NHOMDICHVU_ID        inner join TT_PHAUTHUAT pt on pt.PHAUTHUAT_ID = ptyc.PHAUTHUAT_ID        where        pt.TIEPNHAN_ID = 8747        and (left(ndv.MANHOMDICHVU, 2) in (select * from STRING_SPLIT(@PhanLoaiNhomDV,',')) or ndv.MANHOMDICHVU in (select * from STRING_SPLIT(@PhanLoaiNhomDV,',')))]
2020-07-16 15:51:03,630 [1] DEBUG - Statement Id: [DAO00006_GetList] PreparedStatement : [select dv.*, loaiDV.MALOAIDICHVU, captren.NHOMDICHVU_ID as NHOMDICHVU_CAPTREN_ID, captren.TENNHOMDICHVU as NHOMDICHVU_CAPTREN,              nhom_dv.TENNHOMDICHVU as TENNHOMDICHVU, nhom_dv.MANHOMDICHVU,              case when dv.ATTRIBUTE5 is null then 'TT' else 'KTC' end as LOAI_CHIPHI              from TM_DICHVU as dv              left join TM_NHOMDICHVU as nhom_dv on nhom_dv.NHOMDICHVU_ID = dv.NHOMDICHVU_ID and nhom_dv.BENHVIEN_ID = '01819'              left join TM_NHOMDICHVU as captren on nhom_dv.CAPTREN_ID = captren.NHOMDICHVU_ID and captren.BENHVIEN_ID = '01819'              left join TM_LOAIDICHVU loaiDV on nhom_dv.LOAIDICHVU_ID = loaiDV.LOAIDICHVU_ID and loaiDV.BENHVIEN_ID = '01819'              where nhom_dv.TAMNGUNG = '0' and dv.BENHVIEN_ID = '01819'              and dv.TAMNGUNG = '0'               AND                   loaiDV.MALOAIDICHVU = 'KhamBenh']
2020-07-16 15:51:03,699 [1] DEBUG - Statement Id: [DAO00023_UpdateNhieuVP] PreparedStatement : [declare @jsonVienPhi nvarchar(max) = N'[{"VIENPHI_ID":16000,"TIEPNHAN_ID":8747,"DICHVU_ID":3,"BENHAN_ID":0,"SOLUONG":1.0000,"DONGIA_DOANHTHU":38700.0000,"THANHTIEN_DOANHTHU":38700.00,"BHYT_TL":0.0,"BHYT_DONGIA":0.0,"BHYT_THANHTIEN":0.0,"BHYT_DONGIA_CONGKHAM_DAU":0.0,"BHYT_CONGKHAM_DAU_TYLE":0.0,"BHYT_DONGIA_CHITRA":0.0,"BHYT_THANHTIEN_CHITRA":0.0,"BENHNHAN_PHAITHANHTOAN":38700.00,"GIATRI_HOADON":0.0,"GIATRI_HOADON_DATHANHTOAN":0.0,"GIATRI_BIENLAI":0.0,"GIATRI_BIENLAI_DATHANHTOAN":0.0,"GIATRI_BENHNHAN_DATHANHTOAN":0.0,"DATHUCHIEN":"0","KHONGTHUTIEN":"0","BHYTDONGTIEN":"0","DICHVU_TL":1.0,"BHYT_DONGIA_DONGCT_DAU":0.0,"SOBHYT":null,"SOBHYT_HUONG_ID":8755,"GIATRIMIENGIAM":0.0,"GIATRIMIENGIAM_BHTN":0.0,"GIATRIMIENGIAM_THANHVIEN":0.0,"GIATRIMIENGIAM_CONGTY":0.0,"BHYT_CK2_KHONGTHANHTOAN":false,"SOLONHAP_ID":null,"DUOC_MUCTRAN_THANHTOAN":0.0,"DUOC_TYLE":0.0000}]';        begin        UPDATE TT_VIENPHI        SET        SOLUONG = json.SOLUONG,        DONGIA_DOANHTHU = json.DONGIA_DOANHTHU,        THANHTIEN_DOANHTHU = json.THANHTIEN_DOANHTHU,        BHYT_TL = json.BHYT_TL,        BHYT_DONGIA = json.BHYT_DONGIA,        BHYT_THANHTIEN = json.BHYT_THANHTIEN,        BHYT_DONGIA_CONGKHAM_DAU = json.BHYT_DONGIA_CONGKHAM_DAU,        BHYT_CONGKHAM_DAU_TYLE = json.BHYT_CONGKHAM_DAU_TYLE,        BHYT_DONGIA_CHITRA = json.BHYT_DONGIA_CHITRA,        BHYT_THANHTIEN_CHITRA = json.BHYT_THANHTIEN_CHITRA,        BENHNHAN_PHAITHANHTOAN = json.BENHNHAN_PHAITHANHTOAN,        GIATRI_HOADON = json.GIATRI_HOADON,        GIATRI_BIENLAI = json.GIATRI_BIENLAI,        DATHUCHIEN = json.DATHUCHIEN,        DICHVU_TL = json.DICHVU_TL,        BHYT_DONGIA_DONGCT_DAU = json.BHYT_DONGIA_DONGCT_DAU,        SOLONHAP_ID = json.SOLONHAP_ID,        DUOC_TYLE = json.DUOC_TYLE,        DUOC_MUCTRAN_THANHTOAN = json.DUOC_MUCTRAN_THANHTOAN,        NGAYCAPNHAT = GETDATE()        FROM OPENJSON (@jsonVienPhi)        WITH (        VIENPHI_ID int,        SOLUONG numeric(25, 4),        DONGIA_DOANHTHU numeric(25, 4),        THANHTIEN_DOANHTHU numeric(25, 4),        BHYT_TL numeric(25, 4),        BHYT_DONGIA numeric(25, 4),        BHYT_THANHTIEN numeric(25, 4),        BHYT_DONGIA_CONGKHAM_DAU numeric(25, 4),        BHYT_CONGKHAM_DAU_TYLE numeric(25, 4),        BHYT_DONGIA_CHITRA numeric(25, 4),        BHYT_THANHTIEN_CHITRA numeric(25, 4),        BENHNHAN_PHAITHANHTOAN numeric(25, 4),        GIATRI_HOADON numeric(25, 4),        GIATRI_BIENLAI numeric(25, 4),        DATHUCHIEN char(1),        KHONGTHUTIEN char(1),        BHYTDONGTIEN char(1),        DICHVU_TL numeric(25, 4),        BHYT_DONGIA_DONGCT_DAU numeric(25, 4),        SOLONHAP_ID int,        DUOC_TYLE numeric(25, 4),        DUOC_MUCTRAN_THANHTOAN numeric(25, 4))  json        WHERE TT_VIENPHI.VIENPHI_ID = json.VIENPHI_ID and json.DONGIA_DOANHTHU > 0                  insert into TT_TINH_VIENPHI_LOG        SELECT json.VIENPHI_ID, json.TIEPNHAN_ID, json.BENHAN_ID, json.SOLUONG, json.BHYT_TL, json.DONGIA_DOANHTHU,        json.THANHTIEN_DOANHTHU, json.BHYT_DONGIA, json.BHYT_THANHTIEN, json.BHYT_DONGIA_CHITRA, json.BHYT_THANHTIEN_CHITRA, json.BENHNHAN_PHAITHANHTOAN,        json.SOBHYT_HUONG_ID, json.SOBHYT, GETDATE(), -1, '01819'        FROM OPENJSON(@jsonVienPhi)        WITH (        VIENPHI_ID int,        TIEPNHAN_ID int,        BENHAN_ID int,        SOLUONG numeric(25, 4),        DONGIA_DOANHTHU numeric(25, 4),        THANHTIEN_DOANHTHU numeric(25, 4),        BHYT_TL numeric(25, 4),        BHYT_DONGIA numeric(25, 4),        BHYT_THANHTIEN numeric(25, 4),        BHYT_DONGIA_CHITRA numeric(25, 4),        BHYT_THANHTIEN_CHITRA numeric(25, 4),        BENHNHAN_PHAITHANHTOAN numeric(25, 4),        SOBHYT_HUONG_ID int,        SOBHYT nvarchar(30)) json        end]
2020-07-16 15:51:03,725 [1] DEBUG - Statement Id: [DAO00067_UpdateDataVienPhiDongiaBHYT] PreparedStatement : [update TT_VIENPHI          set BHYT_DONGIA_CHITRA = 0, BHYT_THANHTIEN = 0, BHYT_THANHTIEN_CHITRA = 0          where          TIEPNHAN_ID = 8747 and BHYT_DONGIA = 0          and (BHYT_DONGIA_CHITRA > 0 or BHYT_THANHTIEN > 0 or BHYT_THANHTIEN_CHITRA > 0)]
2020-07-16 15:51:03,748 [1] DEBUG - Statement Id: [DAO00067_CapnhatDataVienphiKhiHuyThanhtoanHoadon] PreparedStatement : [update TT_VIENPHI        set TT_VIENPHI.HOADON_ID = hdct.HOADON_ID, TT_VIENPHI.GIATRI_BENHNHAN_DATHANHTOAN = TT_VIENPHI.GIATRI_BENHNHAN_DATHANHTOAN + hdct.GIATRI_BENHNHAN_DATHANHTOAN        from (select CT.HOADON_ID, CT.VIENPHI_ID, CT.GIATRI_BENHNHAN_DATHANHTOAN        from TT_HOADON_CHITIET_NGOAITRU CT        join TT_HOADON HD on HD.HOADON_ID = CT.HOADON_ID        join TT_VIENPHI vp on vp.VIENPHI_ID = ct.VIENPHI_ID        where HD.DATHANHTOAN = 1 and HD.HUYHOADON = 0 and HD.HOANTRA = 0 and vp.TIEPNHAN_ID =  @param0 ) hdct        where        TT_VIENPHI.VIENPHI_ID = hdct.VIENPHI_ID and TT_VIENPHI.HOADON_ID is null and isnull(TT_VIENPHI.GIATRI_BENHNHAN_DATHANHTOAN,0) = 0        and TT_VIENPHI.TIEPNHAN_ID =  @param0           update TT_VIENPHI        set TT_VIENPHI.HOADON_ID = null, TT_VIENPHI.GIATRI_BENHNHAN_DATHANHTOAN = TT_VIENPHI.GIATRI_BENHNHAN_DATHANHTOAN - hdct.GIATRI_BENHNHAN_DATHANHTOAN,        TT_VIENPHI.DATHANHTOAN = '0'        from (select CT.HOADON_ID, CT.VIENPHI_ID, CT.GIATRI_BENHNHAN_DATHANHTOAN        from TT_HOADON_CHITIET_NGOAITRU CT        join TT_HOADON HD on HD.HOADON_ID = CT.HOADON_ID        join TT_VIENPHI vp on vp.VIENPHI_ID = ct.VIENPHI_ID and vp.HOADON_ID = ct.HOADON_ID        where HD.DATHANHTOAN = 0 and (HD.HUYHOADON = 1 or HD.HOANTRA = 1) and vp.TIEPNHAN_ID =  @param0 ) hdct        where        TT_VIENPHI.VIENPHI_ID = hdct.VIENPHI_ID and TT_VIENPHI.HOADON_ID = hdct.HOADON_ID        and TT_VIENPHI.TIEPNHAN_ID =  @param0]
2020-07-16 15:51:03,748 [1] DEBUG - Statement Id: [DAO00067_CapnhatDataVienphiKhiHuyThanhtoanHoadon] Parameters: [@param0=[TIEPNHAN_ID,8747]]
2020-07-16 15:51:03,748 [1] DEBUG - Statement Id: [DAO00067_CapnhatDataVienphiKhiHuyThanhtoanHoadon] Types: [@param0=[Int64, System.Int64]]
2020-07-16 15:51:03,778 [1] DEBUG - Statement Id: [DAO00119_TT_VIENPHI_GetList_TiepNhanPhaiThanhToan] PreparedStatement : [select distinct  a.*, b.GIATRIMIENGIAM_BH, c.GIATRIMIENGIAM_BHTN, f.GIATRIMIENGIAM_THANHVIEN, g.GIATRIMIENGIAM_CTCT,        isnull(dv.TENDICHVU, dc.TENDUOCDAYDU) NOIDUNG, isnull(dv.MADICHVU, dc.MADUOC) MADICHVU, dv.NORESULT, dc.DONVITINH, ld.MALOAIDUOC, dc.BHYT DUOC_BHYT, ld.LOAIVATTU_ID, ndv.MANHOMDICHVU        from        (select VP.*, isnull(c.TRANGTHAI, '') TRANGTHAI, c.THUTIENSAU, c.NOITHUCHIEN_ID,        CASE        when REF_TABLE = 'TT_NGOAITRU_TOATHUOC' then ntkb.PHONGBAN_ID        when REF_TABLE = 'TT_CLSKETQUA_VTYT' then clsvtyt.PHONGBAN_ID        when REF_TABLE = 'TT_NGOAITRU_KHAMBENH_VTYT' then kbd.PHONGBAN_ID        ELSE        c.NOIYEUCAU_ID        END NOIYEUCAU_ID,        CASE        when REF_TABLE = 'TT_NGOAITRU_TOATHUOC' then ngtd.KHOXUAT_ID        when REF_TABLE = 'TT_CLSKETQUA_VTYT' then clsvtyt.KHOTAO_ID        when REF_TABLE = 'TT_NGOAITRU_KHAMBENH_VTYT' then kbd.KHOTAO_ID        ELSE null        END KHODUOC_ID          from TT_VIENPHI VP        left join TT_DVYEUCAU c on c.DVYEUCAU_ID = VP.REF_ID  and vp.REF_TABLE = 'TT_DVYEUCAU'        left join TT_NGOAITRU_TOATHUOC nttt on nttt.TOATHUOC_ID = vp.REF_ID and vp.REF_TABLE = 'TT_NGOAITRU_TOATHUOC'        left join TT_NGOAITRU_KHAMBENH_TOATHUOC ngtd on ngtd.KHAMBENH_TOATHUOC_ID = nttt.KHAMBENH_TOATHUOC_ID        left join TT_CLSKETQUA_VTYT clsvtyt on clsvtyt.CLSKETQUA_ID = vp.REF_ID and REF_TABLE = 'TT_CLSKETQUA_VTYT'        left join TT_NGOAITRU_KHAMBENH_VTYT kbd on kbd.KHAMBENH_VTYT_ID = vp.REF_ID and REF_TABLE = 'TT_NGOAITRU_KHAMBENH_VTYT'        left join TT_NGOAITRU_KHAMBENH ntkb on ntkb.KHAMBENH_ID = vp.KHAMBENH_ID and REF_TABLE = 'TT_NGOAITRU_TOATHUOC'          where Vp.TIEPNHAN_ID = '8747' and Vp.ACTIVE = '1' and ((c.HUYYEUCAU != '1' and vp.DICHVU_ID is not null) or (vp.DUOC_ID is not null)) and        ((vp.DATHANHTOAN = '0') or (vp.BENHNHAN_PHAITHANHTOAN > vp.GIATRI_BENHNHAN_DATHANHTOAN and vp.DATHANHTOAN = '1')) and c.DANGKY_CHITIET_ID is null        and vp.REF_TABLE != 'TT_MAU_CHUNGTU_CHITIET'        and vp.REF_TABLE != 'TT_DUOC_CHUNGTU_CHITIET'          AND             VP.KHONGTHUTIEN != '1'                   ) a        left join TM_DUOC dc on a.DUOC_ID = dc.DUOC_ID        left join TM_LOAIDUOC ld on dc.LOAIDUOC_ID = ld.LOAIDUOC_ID        left join TM_DICHVU dv on a.DICHVU_ID = dv.DICHVU_ID and a.REF_TABLE = 'TT_DVYEUCAU'        left join TM_NHOMDICHVU ndv on ndv.NHOMDICHVU_ID = dv.NHOMDICHVU_ID        left join (select VIENPHI_ID,        sum(MGCT.GIATRIMIENGIAM) AS GIATRIMIENGIAM_BH from TT_MIENGIAM MG        INNER JOIN TT_MIENGIAM_CHITIET MGCT ON MG.MIENGIAM_ID = MGCT.MIENGIAM_ID        where MG.TIEPNHAN_ID= '8747' and MGCT.REF_TABLE = 'TT_MIENGIAM' and MG.TINHTRANG = 1 group by VIENPHI_ID        ) b on a.VIENPHI_ID = b.VIENPHI_ID          left join (select VIENPHI_ID, sum(MGCT.GIATRIMIENGIAM) AS GIATRIMIENGIAM_BHTN        from TT_MIENGIAM_BHTN MG        INNER JOIN TT_MIENGIAM_CHITIET MGCT ON MG.MIENGIAM_BHTN_ID = MGCT.MIENGIAM_ID        where  MG.TIEPNHAN_ID= '8747' and MGCT.REF_TABLE = 'TT_MIENGIAM_BHTN' and MG.TINHTRANG = 1 group by VIENPHI_ID        )c on a.VIENPHI_ID = c.VIENPHI_ID          left join (select VIENPHI_ID, sum(MGCT.GIATRIMIENGIAM) AS GIATRIMIENGIAM_THANHVIEN        from TT_MIENGIAM_THANHVIEN MG        INNER JOIN TT_MIENGIAM_CHITIET MGCT ON MG.MIENGIAM_THANHVIEN_ID = MGCT.MIENGIAM_ID        where MG.TIEPNHAN_ID= '8747' and MGCT.REF_TABLE = 'TT_MIENGIAM_THANHVIEN' and MG.TINHTRANG = 1 group by VIENPHI_ID        )f on a.VIENPHI_ID = f.VIENPHI_ID          left join(select VIENPHI_ID, sum(MGCT.GIATRIMIENGIAM) AS GIATRIMIENGIAM_CTCT        from TT_MIENGIAM_CONGTY MG        INNER JOIN TT_MIENGIAM_CHITIET MGCT ON MG.MIENGIAM_CONGTY_ID = MGCT.MIENGIAM_ID        where MG.TIEPNHAN_ID= '8747' and MGCT.REF_TABLE = 'TT_MIENGIAM_CONGTY' and MG.TINHTRANG = 1 group by VIENPHI_ID        )g on a.VIENPHI_ID = g.VIENPHI_ID]
2020-07-16 15:51:03,805 [1] DEBUG - Statement Id: [DAO00330_TT_VIENPHI_GetList_TiepNhanPhaiThanhToan] PreparedStatement : [select distinct  a.*, b.GIATRIMIENGIAM_BH, c.GIATRIMIENGIAM_BHTN, f.GIATRIMIENGIAM_THANHVIEN, g.GIATRIMIENGIAM_CTCT        from        (select VP.*,NULL AS NOITHUCHIEN_ID, DK.NOICHIDINH_ID as NOIYEUCAU_ID, NULL AS THUTIENSAU, isnull(DK.TRANGTHAI, '') TRANGTHAI,        M.TENMAU AS NOIDUNG, M.MAMAU AS MADICHVU, NULL AS NORESULT, DVT.TENDONVITINH AS DONVITINH, LM.MALOAIMAU AS MALOAIDUOC, M.BHYT AS DUOC_BHYT, 'M' AS LOAIVATTU_ID, NM.TENNHOMMAU AS MANHOMDICHVU        from TT_VIENPHI VP        INNER JOIN TT_MAU_CHUNGTU_CHITIET CT ON VP.REF_ID=CT.CHUNGTUCHITIET_ID AND VP.REF_TABLE='TT_MAU_CHUNGTU_CHITIET' AND CT.BENHVIEN_ID='01819'        INNER JOIN TT_MAU_CHUNGTU CTU ON CT.CHUNGTU_ID=CTU.CHUNGTU_ID AND CTU.CHUNGTULIENQUAN_ID IS NULL        INNER join TM_MAU M on CT.MAU_ID = M.MAU_ID        LEFT JOIN TM_MAU_DONVITINH DVT ON M.DONVITINH_ID = DVT.DONVITINH_ID        LEFT JOIN TT_MAU_DANGKYMAU_CHITIET DKCT ON DKCT.CHUNGTU_ID = CTU.CHUNGTU_ID AND DKCT.BENHVIEN_ID='01819'        LEFT JOIN TT_MAU_DANGKYMAU DK ON DK.DANGKYMAU_ID = DKCT.DANGKYMAU_ID        LEFT JOIN TM_MAU_LOAIMAU LM ON LM.LOAIMAU_ID = M.LOAIMAU_ID        LEFT JOIN TM_MAU_NHOMMAU NM ON NM.NHOMMAU_ID = LM.NHOMMAU_ID        where Vp.TIEPNHAN_ID = '8747' and Vp.ACTIVE = '1' and vp.DUOC_ID is not null and        ((vp.DATHANHTOAN = '0') or (vp.BENHNHAN_PHAITHANHTOAN > vp.GIATRI_BENHNHAN_DATHANHTOAN and vp.DATHANHTOAN = '1'))   AND             VP.KHONGTHUTIEN != '1'                   ) a        left join (select VIENPHI_ID,        sum(MGCT.GIATRIMIENGIAM) AS GIATRIMIENGIAM_BH from TT_MIENGIAM MG        INNER JOIN TT_MIENGIAM_CHITIET MGCT ON MG.MIENGIAM_ID = MGCT.MIENGIAM_ID        where MG.TIEPNHAN_ID= '8747' and MGCT.REF_TABLE = 'TT_MIENGIAM' and MG.TINHTRANG = 1 group by VIENPHI_ID        ) b on a.VIENPHI_ID = b.VIENPHI_ID          left join (select VIENPHI_ID, sum(MGCT.GIATRIMIENGIAM) AS GIATRIMIENGIAM_BHTN        from TT_MIENGIAM_BHTN MG        INNER JOIN TT_MIENGIAM_CHITIET MGCT ON MG.MIENGIAM_BHTN_ID = MGCT.MIENGIAM_ID        where  MG.TIEPNHAN_ID= '8747' and MGCT.REF_TABLE = 'TT_MIENGIAM_BHTN' and MG.TINHTRANG = 1 group by VIENPHI_ID        )c on a.VIENPHI_ID = c.VIENPHI_ID          left join (select VIENPHI_ID, sum(MGCT.GIATRIMIENGIAM) AS GIATRIMIENGIAM_THANHVIEN        from TT_MIENGIAM_THANHVIEN MG        INNER JOIN TT_MIENGIAM_CHITIET MGCT ON MG.MIENGIAM_THANHVIEN_ID = MGCT.MIENGIAM_ID        where MG.TIEPNHAN_ID= '8747' and MGCT.REF_TABLE = 'TT_MIENGIAM_THANHVIEN' and MG.TINHTRANG = 1 group by VIENPHI_ID        )f on a.VIENPHI_ID = f.VIENPHI_ID          left join(select VIENPHI_ID, sum(MGCT.GIATRIMIENGIAM) AS GIATRIMIENGIAM_CTCT        from TT_MIENGIAM_CONGTY MG        INNER JOIN TT_MIENGIAM_CHITIET MGCT ON MG.MIENGIAM_CONGTY_ID = MGCT.MIENGIAM_ID        where MG.TIEPNHAN_ID= '8747' and MGCT.REF_TABLE = 'TT_MIENGIAM_CONGTY' and MG.TINHTRANG = 1 group by VIENPHI_ID        )g on a.VIENPHI_ID = g.VIENPHI_ID]
2020-07-16 15:51:03,852 [1] DEBUG - Statement Id: [DAO00119_GetDataTamUng_HoaUng] PreparedStatement : [select SUM(TAMUNG) AS TONGTIEN_TU, SUM(HOANUNG) AS TONGTIEN_HU, TIEPNHAN_ID        from (        select HD.TIEPNHAN_ID,        CASE WHEN LOAIHOADON = 'TU' then HD.GIATRIHOADON ELSE 0 END TAMUNG,        CASE WHEN LOAIHOADON = 'HU' then HD.GIATRIHOADON ELSE 0 END HOANUNG        from TT_HOADON HD        where HD.DATHANHTOAN = '1' and HD.HUYHOADON = '0' and HD.HOANTRA = '0'        and HD.TIEPNHAN_ID = 8747        and HD.BENHVIEN_ID = '01819'        ) temp        group by temp.TIEPNHAN_ID]
2020-07-16 15:51:03,879 [1] DEBUG - Statement Id: [DAO00119_TT_VIENPHI_GetList_TiepNhanPhaiThanhToan] PreparedStatement : [select distinct  a.*, b.GIATRIMIENGIAM_BH, c.GIATRIMIENGIAM_BHTN, f.GIATRIMIENGIAM_THANHVIEN, g.GIATRIMIENGIAM_CTCT,        isnull(dv.TENDICHVU, dc.TENDUOCDAYDU) NOIDUNG, isnull(dv.MADICHVU, dc.MADUOC) MADICHVU, dv.NORESULT, dc.DONVITINH, ld.MALOAIDUOC, dc.BHYT DUOC_BHYT, ld.LOAIVATTU_ID, ndv.MANHOMDICHVU        from        (select VP.*, isnull(c.TRANGTHAI, '') TRANGTHAI, c.THUTIENSAU, c.NOITHUCHIEN_ID,        CASE        when REF_TABLE = 'TT_NGOAITRU_TOATHUOC' then ntkb.PHONGBAN_ID        when REF_TABLE = 'TT_CLSKETQUA_VTYT' then clsvtyt.PHONGBAN_ID        when REF_TABLE = 'TT_NGOAITRU_KHAMBENH_VTYT' then kbd.PHONGBAN_ID        ELSE        c.NOIYEUCAU_ID        END NOIYEUCAU_ID,        CASE        when REF_TABLE = 'TT_NGOAITRU_TOATHUOC' then ngtd.KHOXUAT_ID        when REF_TABLE = 'TT_CLSKETQUA_VTYT' then clsvtyt.KHOTAO_ID        when REF_TABLE = 'TT_NGOAITRU_KHAMBENH_VTYT' then kbd.KHOTAO_ID        ELSE null        END KHODUOC_ID          from TT_VIENPHI VP        left join TT_DVYEUCAU c on c.DVYEUCAU_ID = VP.REF_ID  and vp.REF_TABLE = 'TT_DVYEUCAU'        left join TT_NGOAITRU_TOATHUOC nttt on nttt.TOATHUOC_ID = vp.REF_ID and vp.REF_TABLE = 'TT_NGOAITRU_TOATHUOC'        left join TT_NGOAITRU_KHAMBENH_TOATHUOC ngtd on ngtd.KHAMBENH_TOATHUOC_ID = nttt.KHAMBENH_TOATHUOC_ID        left join TT_CLSKETQUA_VTYT clsvtyt on clsvtyt.CLSKETQUA_ID = vp.REF_ID and REF_TABLE = 'TT_CLSKETQUA_VTYT'        left join TT_NGOAITRU_KHAMBENH_VTYT kbd on kbd.KHAMBENH_VTYT_ID = vp.REF_ID and REF_TABLE = 'TT_NGOAITRU_KHAMBENH_VTYT'        left join TT_NGOAITRU_KHAMBENH ntkb on ntkb.KHAMBENH_ID = vp.KHAMBENH_ID and REF_TABLE = 'TT_NGOAITRU_TOATHUOC'          where Vp.TIEPNHAN_ID = '8747' and Vp.ACTIVE = '1' and ((c.HUYYEUCAU != '1' and vp.DICHVU_ID is not null) or (vp.DUOC_ID is not null)) and        ((vp.DATHANHTOAN = '0') or (vp.BENHNHAN_PHAITHANHTOAN > vp.GIATRI_BENHNHAN_DATHANHTOAN and vp.DATHANHTOAN = '1')) and c.DANGKY_CHITIET_ID is null        and vp.REF_TABLE != 'TT_MAU_CHUNGTU_CHITIET'        and vp.REF_TABLE != 'TT_DUOC_CHUNGTU_CHITIET'          AND             VP.KHONGTHUTIEN != '1'                   ) a        left join TM_DUOC dc on a.DUOC_ID = dc.DUOC_ID        left join TM_LOAIDUOC ld on dc.LOAIDUOC_ID = ld.LOAIDUOC_ID        left join TM_DICHVU dv on a.DICHVU_ID = dv.DICHVU_ID and a.REF_TABLE = 'TT_DVYEUCAU'        left join TM_NHOMDICHVU ndv on ndv.NHOMDICHVU_ID = dv.NHOMDICHVU_ID        left join (select VIENPHI_ID,        sum(MGCT.GIATRIMIENGIAM) AS GIATRIMIENGIAM_BH from TT_MIENGIAM MG        INNER JOIN TT_MIENGIAM_CHITIET MGCT ON MG.MIENGIAM_ID = MGCT.MIENGIAM_ID        where MG.TIEPNHAN_ID= '8747' and MGCT.REF_TABLE = 'TT_MIENGIAM' and MG.TINHTRANG = 1 group by VIENPHI_ID        ) b on a.VIENPHI_ID = b.VIENPHI_ID          left join (select VIENPHI_ID, sum(MGCT.GIATRIMIENGIAM) AS GIATRIMIENGIAM_BHTN        from TT_MIENGIAM_BHTN MG        INNER JOIN TT_MIENGIAM_CHITIET MGCT ON MG.MIENGIAM_BHTN_ID = MGCT.MIENGIAM_ID        where  MG.TIEPNHAN_ID= '8747' and MGCT.REF_TABLE = 'TT_MIENGIAM_BHTN' and MG.TINHTRANG = 1 group by VIENPHI_ID        )c on a.VIENPHI_ID = c.VIENPHI_ID          left join (select VIENPHI_ID, sum(MGCT.GIATRIMIENGIAM) AS GIATRIMIENGIAM_THANHVIEN        from TT_MIENGIAM_THANHVIEN MG        INNER JOIN TT_MIENGIAM_CHITIET MGCT ON MG.MIENGIAM_THANHVIEN_ID = MGCT.MIENGIAM_ID        where MG.TIEPNHAN_ID= '8747' and MGCT.REF_TABLE = 'TT_MIENGIAM_THANHVIEN' and MG.TINHTRANG = 1 group by VIENPHI_ID        )f on a.VIENPHI_ID = f.VIENPHI_ID          left join(select VIENPHI_ID, sum(MGCT.GIATRIMIENGIAM) AS GIATRIMIENGIAM_CTCT        from TT_MIENGIAM_CONGTY MG        INNER JOIN TT_MIENGIAM_CHITIET MGCT ON MG.MIENGIAM_CONGTY_ID = MGCT.MIENGIAM_ID        where MG.TIEPNHAN_ID= '8747' and MGCT.REF_TABLE = 'TT_MIENGIAM_CONGTY' and MG.TINHTRANG = 1 group by VIENPHI_ID        )g on a.VIENPHI_ID = g.VIENPHI_ID]
2020-07-16 15:51:03,906 [1] DEBUG - Statement Id: [DAO00330_TT_VIENPHI_GetList_TiepNhanPhaiThanhToan] PreparedStatement : [select distinct  a.*, b.GIATRIMIENGIAM_BH, c.GIATRIMIENGIAM_BHTN, f.GIATRIMIENGIAM_THANHVIEN, g.GIATRIMIENGIAM_CTCT        from        (select VP.*,NULL AS NOITHUCHIEN_ID, DK.NOICHIDINH_ID as NOIYEUCAU_ID, NULL AS THUTIENSAU, isnull(DK.TRANGTHAI, '') TRANGTHAI,        M.TENMAU AS NOIDUNG, M.MAMAU AS MADICHVU, NULL AS NORESULT, DVT.TENDONVITINH AS DONVITINH, LM.MALOAIMAU AS MALOAIDUOC, M.BHYT AS DUOC_BHYT, 'M' AS LOAIVATTU_ID, NM.TENNHOMMAU AS MANHOMDICHVU        from TT_VIENPHI VP        INNER JOIN TT_MAU_CHUNGTU_CHITIET CT ON VP.REF_ID=CT.CHUNGTUCHITIET_ID AND VP.REF_TABLE='TT_MAU_CHUNGTU_CHITIET' AND CT.BENHVIEN_ID='01819'        INNER JOIN TT_MAU_CHUNGTU CTU ON CT.CHUNGTU_ID=CTU.CHUNGTU_ID AND CTU.CHUNGTULIENQUAN_ID IS NULL        INNER join TM_MAU M on CT.MAU_ID = M.MAU_ID        LEFT JOIN TM_MAU_DONVITINH DVT ON M.DONVITINH_ID = DVT.DONVITINH_ID        LEFT JOIN TT_MAU_DANGKYMAU_CHITIET DKCT ON DKCT.CHUNGTU_ID = CTU.CHUNGTU_ID AND DKCT.BENHVIEN_ID='01819'        LEFT JOIN TT_MAU_DANGKYMAU DK ON DK.DANGKYMAU_ID = DKCT.DANGKYMAU_ID        LEFT JOIN TM_MAU_LOAIMAU LM ON LM.LOAIMAU_ID = M.LOAIMAU_ID        LEFT JOIN TM_MAU_NHOMMAU NM ON NM.NHOMMAU_ID = LM.NHOMMAU_ID        where Vp.TIEPNHAN_ID = '8747' and Vp.ACTIVE = '1' and vp.DUOC_ID is not null and        ((vp.DATHANHTOAN = '0') or (vp.BENHNHAN_PHAITHANHTOAN > vp.GIATRI_BENHNHAN_DATHANHTOAN and vp.DATHANHTOAN = '1'))   AND             VP.KHONGTHUTIEN != '1'                   ) a        left join (select VIENPHI_ID,        sum(MGCT.GIATRIMIENGIAM) AS GIATRIMIENGIAM_BH from TT_MIENGIAM MG        INNER JOIN TT_MIENGIAM_CHITIET MGCT ON MG.MIENGIAM_ID = MGCT.MIENGIAM_ID        where MG.TIEPNHAN_ID= '8747' and MGCT.REF_TABLE = 'TT_MIENGIAM' and MG.TINHTRANG = 1 group by VIENPHI_ID        ) b on a.VIENPHI_ID = b.VIENPHI_ID          left join (select VIENPHI_ID, sum(MGCT.GIATRIMIENGIAM) AS GIATRIMIENGIAM_BHTN        from TT_MIENGIAM_BHTN MG        INNER JOIN TT_MIENGIAM_CHITIET MGCT ON MG.MIENGIAM_BHTN_ID = MGCT.MIENGIAM_ID        where  MG.TIEPNHAN_ID= '8747' and MGCT.REF_TABLE = 'TT_MIENGIAM_BHTN' and MG.TINHTRANG = 1 group by VIENPHI_ID        )c on a.VIENPHI_ID = c.VIENPHI_ID          left join (select VIENPHI_ID, sum(MGCT.GIATRIMIENGIAM) AS GIATRIMIENGIAM_THANHVIEN        from TT_MIENGIAM_THANHVIEN MG        INNER JOIN TT_MIENGIAM_CHITIET MGCT ON MG.MIENGIAM_THANHVIEN_ID = MGCT.MIENGIAM_ID        where MG.TIEPNHAN_ID= '8747' and MGCT.REF_TABLE = 'TT_MIENGIAM_THANHVIEN' and MG.TINHTRANG = 1 group by VIENPHI_ID        )f on a.VIENPHI_ID = f.VIENPHI_ID          left join(select VIENPHI_ID, sum(MGCT.GIATRIMIENGIAM) AS GIATRIMIENGIAM_CTCT        from TT_MIENGIAM_CONGTY MG        INNER JOIN TT_MIENGIAM_CHITIET MGCT ON MG.MIENGIAM_CONGTY_ID = MGCT.MIENGIAM_ID        where MG.TIEPNHAN_ID= '8747' and MGCT.REF_TABLE = 'TT_MIENGIAM_CONGTY' and MG.TINHTRANG = 1 group by VIENPHI_ID        )g on a.VIENPHI_ID = g.VIENPHI_ID]
2020-07-16 15:51:03,938 [1] DEBUG - Statement Id: [DAO00119_GetDataTamUng_HoaUng] PreparedStatement : [select SUM(TAMUNG) AS TONGTIEN_TU, SUM(HOANUNG) AS TONGTIEN_HU, TIEPNHAN_ID        from (        select HD.TIEPNHAN_ID,        CASE WHEN LOAIHOADON = 'TU' then HD.GIATRIHOADON ELSE 0 END TAMUNG,        CASE WHEN LOAIHOADON = 'HU' then HD.GIATRIHOADON ELSE 0 END HOANUNG        from TT_HOADON HD        where HD.DATHANHTOAN = '1' and HD.HUYHOADON = '0' and HD.HOANTRA = '0'        and HD.TIEPNHAN_ID = 8747        and HD.BENHVIEN_ID = '01819'        ) temp        group by temp.TIEPNHAN_ID]
2020-07-16 15:51:03,993 [1] DEBUG - Statement Id: [DAO00403_QMS002_GetThongTinClient] PreparedStatement : [SELECT B.ID as QUEUE_ID, B.NAME AS QUEUE_NAME,A.ID AS CLIENT_ID , A.[NAME] AS CLIENT_NAME, ISNULL(A.[STATE],1) AS [STATE],(CASE C.NAME WHEN 'UT' THEN 1 ELSE 0 END) AS QUEUETYPE     , B.DEPARTMENT_ID,ISNULL(B.SECTION_ID,-1) AS SECTION_ID,A.IPSERVER,A.NAMEAUDIO,C.QUEUE_TYPE_CODE,C.QUEUE_TYPE_CODE_SOUND,S.[NAME] AS SECTIONNAME     FROM QMS_QUEUE B LEFT JOIN QMS_CLIENT A ON A.QUEUE_ID = B.ID     LEFT JOIN QMS_QUEUE_TYPE C ON B.QUEUETYPE_ID = C.ID     LEFT JOIN QMS_SECTION S ON B.SECTION_ID=S.ID     WHERE     (A.COMPUTERNAME = 'DESKTOP-89GE5BA' OR A.IPADDRESS = '10.15.167.38') AND A.[STATE] = 1 AND B.DEPARTMENT_ID='74'            AND B.BENHVIEN_ID = '01819']
2020-07-16 15:51:04,016 [1] DEBUG - Statement Id: [DAO00101_GetListSuatAn] PreparedStatement : [SELECT        kP.KHAUPHANAN_ID,        kP.MAKHAUPHANAN,        kP.TENKHAUPHANAN,        LKP.LOAIKHAUPHANAN_ID,        LKP.MALOAIKHAUPHANAN,        LKP.TENLOAIKHAUPHANAN,        DG.DONGIA,        kP.HANGMUC_ID        FROM TM_NUT_KHAUPHANAN kP        INNER JOIN TM_NUT_LOAIKHAUPHANAN LKP ON  kP.LOAIKHAUPHANAN_ID = LKP.LOAIKHAUPHANAN_ID        INNER JOIN TM_NUT_KHAUPHANAN_DONGIA DG ON DG.KHAUPHANAN_ID = kP.KHAUPHANAN_ID        WHERE DG.DONGIA IS NOT NULL]
2020-07-16 15:51:08,177 [1] DEBUG - Statement Id: [DAO00021_GetListSoBienLai] PreparedStatement : [select            BLCT.BIENLAICHITIET_ID            ,BL.*                         ,BL.KYHIEU + '/' + SERIES AS 'KYHIEU_SOQUYEN'                         ,BLCT.START_NUMBER            ,BLCT.CURRENT_NUMBER            ,BLCT.HIEULUC            ,BLCT.NGUOISUDUNG_ID            from TT_BIENLAICHITIET BLCT            left join TT_BIENLAI BL on BL.BIENLAI_ID = BLCT.BIENLAI_ID            where            (bl.MAX_NUMBER > (select MAX(CURRENT_NUMBER) from TT_BIENLAICHITIET where BIENLAI_ID = BLCT.BIENLAI_ID) or BLCT.CURRENT_NUMBER is null)            and BLCT.HIEULUC = 1            and BLCT.NGUOISUDUNG_ID =   @param0             and BL.BENHVIEN_ID =  @param1              and               BLCT.BIENLAICHITIET_ID = '2002'                         order by BLCT.THOIGIANSUDUNG DESC]
2020-07-16 15:51:08,177 [1] DEBUG - Statement Id: [DAO00021_GetListSoBienLai] Parameters: [@param0=[NGUOISUDUNG_ID,1], @param1=[BENHVIEN_ID,01819]]
2020-07-16 15:51:08,177 [1] DEBUG - Statement Id: [DAO00021_GetListSoBienLai] Types: [@param0=[Int64, System.Int64], @param1=[String, System.String]]
2020-07-16 15:51:13,961 [1] DEBUG - Statement Id: [DAO00014_GetPatientStatus] PreparedStatement : [select        CASE        when tn.TRANGTHAI = 'HOANTHANH' Then tn.TRANGTHAI        WHEN xncp.XACNHANCHIPHI_ID is not null THEN 'XACNHANCHIPHI'        WHEN (tn.KHOADULIEU = '1') THEN 'KHOADULIEU'        ELSE tn.TRANGTHAI        END        as TRANGTHAI        from TT_TIEPNHAN tn        left join TT_XACNHANCHIPHI xncp on tn.TIEPNHAN_ID = xncp.TIEPNHAN_ID        where tn.TIEPNHAN_ID = '8747'        and tn.BENHVIEN_ID = '01819']
2020-07-16 15:51:14,036 [1] DEBUG - Statement Id: [DAO00119_TT_VIENPHI_GetList_TiepNhanPhaiThanhToanWithVienphiId] PreparedStatement : [select  a.*, b.GIATRIMIENGIAM_BH, c.GIATRIMIENGIAM_BHTN, f.GIATRIMIENGIAM_THANHVIEN, g.GIATRIMIENGIAM_CTCT        from        (select VP.*, c.NOITHUCHIEN_ID, c.NOIYEUCAU_ID, c.HUYYEUCAU        from TT_VIENPHI VP        left join TT_DVYEUCAU c on c.DVYEUCAU_ID = VP.REF_ID  and vp.REF_TABLE = 'TT_DVYEUCAU'        where        VP.REF_TABLE != 'TT_MAU_CHUNGTU_CHITIET' and        Vp.TIEPNHAN_ID = '8747' and Vp.ACTIVE = '1' and ((c.HUYYEUCAU != '1' and vp.DICHVU_ID is not null) or (vp.DUOC_ID is not null)) and        ((vp.DATHANHTOAN = '0') or (vp.BENHNHAN_PHAITHANHTOAN > vp.GIATRI_BENHNHAN_DATHANHTOAN and vp.DATHANHTOAN = '1')) and c.DANGKY_CHITIET_ID is null        and vp.VIENPHI_ID in (16000)) a          left join (select VIENPHI_ID,        sum(MGCT.GIATRIMIENGIAM) AS GIATRIMIENGIAM_BH from TT_MIENGIAM MG        INNER JOIN TT_MIENGIAM_CHITIET MGCT ON MG.MIENGIAM_ID = MGCT.MIENGIAM_ID        where MG.TIEPNHAN_ID= '8747' and MGCT.REF_TABLE = 'TT_MIENGIAM' and MG.TINHTRANG = 1 group by VIENPHI_ID        ) b on a.VIENPHI_ID = b.VIENPHI_ID          left join (select VIENPHI_ID, sum(MGCT.GIATRIMIENGIAM) AS GIATRIMIENGIAM_BHTN        from TT_MIENGIAM_BHTN MG        INNER JOIN TT_MIENGIAM_CHITIET MGCT ON MG.MIENGIAM_BHTN_ID = MGCT.MIENGIAM_ID        where  MG.TIEPNHAN_ID= '8747' and MGCT.REF_TABLE = 'TT_MIENGIAM_BHTN' and MG.TINHTRANG = 1 group by VIENPHI_ID        )c on a.VIENPHI_ID = c.VIENPHI_ID          left join (select VIENPHI_ID, sum(MGCT.GIATRIMIENGIAM) AS GIATRIMIENGIAM_THANHVIEN        from TT_MIENGIAM_THANHVIEN MG        INNER JOIN TT_MIENGIAM_CHITIET MGCT ON MG.MIENGIAM_THANHVIEN_ID = MGCT.MIENGIAM_ID        where MG.TIEPNHAN_ID= '8747' and MGCT.REF_TABLE = 'TT_MIENGIAM_THANHVIEN' and MG.TINHTRANG = 1 group by VIENPHI_ID        )f on a.VIENPHI_ID = f.VIENPHI_ID          left join(select VIENPHI_ID, sum(MGCT.GIATRIMIENGIAM) AS GIATRIMIENGIAM_CTCT        from TT_MIENGIAM_CONGTY MG        INNER JOIN TT_MIENGIAM_CHITIET MGCT ON MG.MIENGIAM_CONGTY_ID = MGCT.MIENGIAM_ID        where MG.TIEPNHAN_ID= '8747' and MGCT.REF_TABLE = 'TT_MIENGIAM_CONGTY' and MG.TINHTRANG = 1 group by VIENPHI_ID        )g on a.VIENPHI_ID = g.VIENPHI_ID        WHERE a.REF_TABLE!='TT_MAU_CHUNGTU_CHITIET']
2020-07-16 15:51:14,086 [1] DEBUG - Statement Id: [DAO00330_TT_VIENPHI_GetList_TiepNhanPhaiThanhToanWithVienphiId] PreparedStatement : [select  a.*, b.GIATRIMIENGIAM_BH, c.GIATRIMIENGIAM_BHTN, f.GIATRIMIENGIAM_THANHVIEN, g.GIATRIMIENGIAM_CTCT        from        (select VP.*, null NOITHUCHIEN_ID, dk.NOICHIDINH_ID as NOIYEUCAU_ID, '0' as HUYYEUCAU        from TT_VIENPHI VP        INNER JOIN TT_MAU_CHUNGTU_CHITIET CT ON VP.REF_ID=CT.CHUNGTUCHITIET_ID AND VP.REF_TABLE='TT_MAU_CHUNGTU_CHITIET' AND CT.BENHVIEN_ID='01819'        INNER JOIN TT_MAU_CHUNGTU CTU ON CT.CHUNGTU_ID=CTU.CHUNGTU_ID AND CTU.CHUNGTULIENQUAN_ID IS NULL        LEFT JOIN TT_MAU_DANGKYMAU_CHITIET DKCT ON DKCT.CHUNGTU_ID = CTU.CHUNGTU_ID AND DKCT.BENHVIEN_ID='01819'        LEFT JOIN TT_MAU_DANGKYMAU DK ON DK.DANGKYMAU_ID = DKCT.DANGKYMAU_ID        where Vp.TIEPNHAN_ID = '8747' and Vp.ACTIVE = '1' and vp.DUOC_ID is not null and        ((vp.DATHANHTOAN = '0') or (vp.BENHNHAN_PHAITHANHTOAN > vp.GIATRI_BENHNHAN_DATHANHTOAN and vp.DATHANHTOAN = '1'))        and vp.VIENPHI_ID in (16000)) a          left join (select VIENPHI_ID,        sum(MGCT.GIATRIMIENGIAM) AS GIATRIMIENGIAM_BH from TT_MIENGIAM MG        INNER JOIN TT_MIENGIAM_CHITIET MGCT ON MG.MIENGIAM_ID = MGCT.MIENGIAM_ID        where MG.TIEPNHAN_ID= '8747' and MGCT.REF_TABLE = 'TT_MIENGIAM' and MG.TINHTRANG = 1 group by VIENPHI_ID        ) b on a.VIENPHI_ID = b.VIENPHI_ID          left join (select VIENPHI_ID, sum(MGCT.GIATRIMIENGIAM) AS GIATRIMIENGIAM_BHTN        from TT_MIENGIAM_BHTN MG        INNER JOIN TT_MIENGIAM_CHITIET MGCT ON MG.MIENGIAM_BHTN_ID = MGCT.MIENGIAM_ID        where  MG.TIEPNHAN_ID= '8747' and MGCT.REF_TABLE = 'TT_MIENGIAM_BHTN' and MG.TINHTRANG = 1 group by VIENPHI_ID        )c on a.VIENPHI_ID = c.VIENPHI_ID          left join (select VIENPHI_ID, sum(MGCT.GIATRIMIENGIAM) AS GIATRIMIENGIAM_THANHVIEN        from TT_MIENGIAM_THANHVIEN MG        INNER JOIN TT_MIENGIAM_CHITIET MGCT ON MG.MIENGIAM_THANHVIEN_ID = MGCT.MIENGIAM_ID        where MG.TIEPNHAN_ID= '8747' and MGCT.REF_TABLE = 'TT_MIENGIAM_THANHVIEN' and MG.TINHTRANG = 1 group by VIENPHI_ID        )f on a.VIENPHI_ID = f.VIENPHI_ID          left join(select VIENPHI_ID, sum(MGCT.GIATRIMIENGIAM) AS GIATRIMIENGIAM_CTCT        from TT_MIENGIAM_CONGTY MG        INNER JOIN TT_MIENGIAM_CHITIET MGCT ON MG.MIENGIAM_CONGTY_ID = MGCT.MIENGIAM_ID        where MG.TIEPNHAN_ID= '8747' and MGCT.REF_TABLE = 'TT_MIENGIAM_CONGTY' and MG.TINHTRANG = 1 group by VIENPHI_ID        )g on a.VIENPHI_ID = g.VIENPHI_ID]
2020-07-16 15:51:14,142 [1] DEBUG - Statement Id: [DAO00119_TT_VIENPHI_GetList_VPHienTai] PreparedStatement : [select * from TT_VIENPHI vp        where        ((vp.DATHANHTOAN = '0') or (vp.BENHNHAN_PHAITHANHTOAN > vp.GIATRI_BENHNHAN_DATHANHTOAN and vp.DATHANHTOAN = '1'))        and VIENPHI_ID in (16000)         and           TIEPNHAN_ID = '8747']
2020-07-16 15:51:14,168 [1] DEBUG - Statement Id: [DAO00021_GetListSoBienLai] PreparedStatement : [select            BLCT.BIENLAICHITIET_ID            ,BL.*                         ,BL.KYHIEU + '/' + SERIES AS 'KYHIEU_SOQUYEN'                         ,BLCT.START_NUMBER            ,BLCT.CURRENT_NUMBER            ,BLCT.HIEULUC            ,BLCT.NGUOISUDUNG_ID            from TT_BIENLAICHITIET BLCT            left join TT_BIENLAI BL on BL.BIENLAI_ID = BLCT.BIENLAI_ID            where            (bl.MAX_NUMBER > (select MAX(CURRENT_NUMBER) from TT_BIENLAICHITIET where BIENLAI_ID = BLCT.BIENLAI_ID) or BLCT.CURRENT_NUMBER is null)            and BLCT.HIEULUC = 1            and BLCT.NGUOISUDUNG_ID =   @param0             and BL.BENHVIEN_ID =  @param1                          order by BLCT.THOIGIANSUDUNG DESC]
2020-07-16 15:51:14,168 [1] DEBUG - Statement Id: [DAO00021_GetListSoBienLai] Parameters: [@param0=[NGUOISUDUNG_ID,1], @param1=[BENHVIEN_ID,01819]]
2020-07-16 15:51:14,168 [1] DEBUG - Statement Id: [DAO00021_GetListSoBienLai] Types: [@param0=[Int64, System.Int64], @param1=[String, System.String]]
2020-07-16 15:51:14,195 [1] DEBUG - Statement Id: [DAO00021_GetListSoBienLai] PreparedStatement : [select            BLCT.BIENLAICHITIET_ID            ,BL.*                         ,BL.KYHIEU + '/' + SERIES AS 'KYHIEU_SOQUYEN'                         ,BLCT.START_NUMBER            ,BLCT.CURRENT_NUMBER            ,BLCT.HIEULUC            ,BLCT.NGUOISUDUNG_ID            from TT_BIENLAICHITIET BLCT            left join TT_BIENLAI BL on BL.BIENLAI_ID = BLCT.BIENLAI_ID            where            (bl.MAX_NUMBER > (select MAX(CURRENT_NUMBER) from TT_BIENLAICHITIET where BIENLAI_ID = BLCT.BIENLAI_ID) or BLCT.CURRENT_NUMBER is null)            and BLCT.HIEULUC = 1            and BLCT.NGUOISUDUNG_ID =   @param0             and BL.BENHVIEN_ID =  @param1                          order by BLCT.THOIGIANSUDUNG DESC]
2020-07-16 15:51:14,195 [1] DEBUG - Statement Id: [DAO00021_GetListSoBienLai] Parameters: [@param0=[NGUOISUDUNG_ID,1], @param1=[BENHVIEN_ID,01819]]
2020-07-16 15:51:14,195 [1] DEBUG - Statement Id: [DAO00021_GetListSoBienLai] Types: [@param0=[Int64, System.Int64], @param1=[String, System.String]]
2020-07-16 15:51:14,225 [1] DEBUG - Statement Id: [DAO00021_GetListSoBienLai] PreparedStatement : [select            BLCT.BIENLAICHITIET_ID            ,BL.*                         ,BL.KYHIEU + '/' + SERIES AS 'KYHIEU_SOQUYEN'                         ,BLCT.START_NUMBER            ,BLCT.CURRENT_NUMBER            ,BLCT.HIEULUC            ,BLCT.NGUOISUDUNG_ID            from TT_BIENLAICHITIET BLCT            left join TT_BIENLAI BL on BL.BIENLAI_ID = BLCT.BIENLAI_ID            where            (bl.MAX_NUMBER > (select MAX(CURRENT_NUMBER) from TT_BIENLAICHITIET where BIENLAI_ID = BLCT.BIENLAI_ID) or BLCT.CURRENT_NUMBER is null)            and BLCT.HIEULUC = 1            and BLCT.NGUOISUDUNG_ID =   @param0             and BL.BENHVIEN_ID =  @param1              and               BLCT.BIENLAICHITIET_ID = '2002'                         order by BLCT.THOIGIANSUDUNG DESC]
2020-07-16 15:51:14,225 [1] DEBUG - Statement Id: [DAO00021_GetListSoBienLai] Parameters: [@param0=[NGUOISUDUNG_ID,1], @param1=[BENHVIEN_ID,01819]]
2020-07-16 15:51:14,225 [1] DEBUG - Statement Id: [DAO00021_GetListSoBienLai] Types: [@param0=[Int64, System.Int64], @param1=[String, System.String]]
2020-07-16 15:51:14,404 [1] DEBUG - Statement Id: [DAO00119_TT_VIENPHI_XoaBienLaiTamNgoaiTru] PreparedStatement : [delete from TT_HOADON_HINHTHUCTHANHTOAN        where HOADON_ID = ''          delete from TT_HOADON_CHITIET_NGOAITRU        where HOADON_ID = ''          delete from TT_HOADON        where HOADON_ID = '' and TRANGTHAI in ('CHUATHUTIEN', 'CHODUYETCONGNO', 'CHOXACNHANTTVIDT')          update TT_VIENPHI set HOADON_ID = null where HOADON_ID = '']
2020-07-16 15:51:14,499 [1] DEBUG - Statement Id: [DAO00055_GetDetail] PreparedStatement : [select *              from LST_KEYDATA_VIENPHI               where                             LST_KEYDATA_VIENPHI.KEYTYPE = 'BL'                       and                           LST_KEYDATA_VIENPHI.KEYYEAR = '2020'                       and                           LST_KEYDATA_VIENPHI.KEYMONTH = '7'                       and                           LST_KEYDATA_VIENPHI.KEYDAY = '0'                       and                           LST_KEYDATA_VIENPHI.SEGMENT_1 = '0'                       and                           LST_KEYDATA_VIENPHI.SEGMENT_2 = '0'                       and                           LST_KEYDATA_VIENPHI.SEGMENT_3 = '0'                                     order by KEYTYPE]
2020-07-16 15:51:14,536 [1] DEBUG - Statement Id: [DAO00055_Add] PreparedStatement : [insert into LST_KEYDATA_VIENPHI (            KEYTYPE            , KEYYEAR            , KEYMONTH            , KEYDAY            , SEGMENT_1            , SEGMENT_2            , SEGMENT_3            , KEYVALUE            , BENHVIEN_ID            ) values (             @param0             ,  @param1             ,  @param2             ,  @param3             ,  @param4             ,  @param5             ,  @param6             ,  @param7             ,  @param8             )]
2020-07-16 15:51:14,536 [1] DEBUG - Statement Id: [DAO00055_Add] Parameters: [@param0=[KEYTYPE,BL], @param1=[KEYYEAR,2020], @param2=[KEYMONTH,7], @param3=[KEYDAY,0], @param4=[SEGMENT_1,0], @param5=[SEGMENT_2,0], @param6=[SEGMENT_3,0], @param7=[KEYVALUE,000001], @param8=[BENHVIEN_ID,01819]]
2020-07-16 15:51:14,536 [1] DEBUG - Statement Id: [DAO00055_Add] Types: [@param0=[String, System.String], @param1=[Int32, System.Int32], @param2=[Int32, System.Int32], @param3=[Int32, System.Int32], @param4=[String, System.String], @param5=[String, System.String], @param6=[String, System.String], @param7=[String, System.String], @param8=[String, System.String]]
2020-07-16 15:51:14,563 [1] DEBUG - Statement Id: [DAO00024_TT_HOADON_Add] PreparedStatement : [insert into TT_HOADON (              SOHOADON              , LOAIHOADON              , TIEPNHAN_ID              , BENHNHAN_ID              , BENHAN_ID              , DOITUONG_ID              , BENHAN_NGOAITRU_ID              , NGAYPHATSINH              , NGAYHOADON              , NOIPHATSINH_ID              , NGUOILAP_ID              , NOITHUTIEN_ID              , NGUOITHUTIEN_ID              , NOITRA_ID              , NGUOITRA_ID              , NGAYTRA              , GIATRIHOADON              , GIATRITHUCTHU              , TIENTE_ID              , TYGIA              , GIATRIVND              , DANGKYHOADON_ID              , SOSERIEVAT              , SOHOADONVAT              , GIATRIVAT              , NGOAIGIO              , THUHD_BL              , GHICHU              , TRANGTHAI              , DATHANHTOAN              , HUYHOADON              , LYDOHUY_ID              , HOANTRA              , IDCHUYEN              , IDCHUYENHUY              , IDCHUYENHOAN              , HOADONLIENQUAN_ID              , TRANSFER_VIENPHI_ID              , NGAYKHOAGOI              , NHOMTHANHTOAN_ID              , HOADONDOIUNG              , CHUYENCHUNGTUID              , CHUYENCHUNGTUHOANID              , CHUYENCHUNGTUHUYID              , CHUYENDOANHTHUID              , CHUYENDOANHTHUHOANID              , CHUYENDOANHTHUHUYID              , KH_TENCONGTY              , KH_MASOTHUE              , KH_DIACHI              , KH_NGUOIDAIDIEN              , INLAI              , INLAI_USER_ID                           , BENHVIEN_ID            , NGAYTAO            , NGUOITAO_ID            , NGAYCAPNHAT            , NGUOICAPNHAT_ID                            , YEUCAUVP                            , MACHINENAME                         , DOTDIEUTRI_ID              ) values (               @param0               ,  @param1               ,  @param2               ,  @param3               ,  @param4               ,  @param5               ,  @param6               ,  @param7               ,  @param8               ,  @param9               ,  @param10               ,  @param11               ,  @param12               ,  @param13               ,  @param14               ,  @param15               ,  @param16               ,  @param17               ,  @param18               ,  @param19               ,  @param20               ,  @param21               ,  @param22               ,  @param23               ,  @param24               ,  @param25               ,  @param26               ,  @param27               ,  @param28               ,  @param29               ,  @param30               ,  @param31               ,  @param32               ,  @param33               ,  @param34               ,  @param35               ,  @param36               ,  @param37               ,  @param38               ,  @param39               ,  @param40               ,  @param41               ,  @param42               ,  @param43               ,  @param44               ,  @param45               ,  @param46               ,  @param47               ,  @param48               ,  @param49               ,  @param50               ,  @param51               ,  @param52                            ,  @param53             ,  @param54             ,  @param55             ,  @param56             ,  @param57                             , @param58                             ,  @param59                          ,  @param60             )            SELECT SCOPE_IDENTITY()]
2020-07-16 15:51:14,563 [1] DEBUG - Statement Id: [DAO00024_TT_HOADON_Add] Parameters: [@param0=[SOHOADON,BL.2007000001], @param1=[LOAIHOADON,BL], @param2=[TIEPNHAN_ID,8747], @param3=[BENHNHAN_ID,8731], @param4=[BENHAN_ID,null], @param5=[DOITUONG_ID,1], @param6=[BENHAN_NGOAITRU_ID,null], @param7=[NGAYPHATSINH,7/16/2020 3:51:14 PM], @param8=[NGAYHOADON,7/16/2020 3:51:14 PM], @param9=[NOIPHATSINH_ID,74], @param10=[NGUOILAP_ID,1], @param11=[NOITHUTIEN_ID,74], @param12=[NGUOITHUTIEN_ID,1], @param13=[NOITRA_ID,null], @param14=[NGUOITRA_ID,null], @param15=[NGAYTRA,null], @param16=[GIATRIHOADON,38700], @param17=[GIATRITHUCTHU,38700], @param18=[TIENTE_ID,VND], @param19=[TYGIA,1], @param20=[GIATRIVND,38700], @param21=[DANGKYHOADON_ID,null], @param22=[SOSERIEVAT,null], @param23=[SOHOADONVAT,null], @param24=[GIATRIVAT,null], @param25=[NGOAIGIO,null], @param26=[THUHD_BL,HD], @param27=[GHICHU,null], @param28=[TRANGTHAI,CHUATHUTIEN], @param29=[DATHANHTOAN,0], @param30=[HUYHOADON,0], @param31=[LYDOHUY_ID,null], @param32=[HOANTRA,0], @param33=[IDCHUYEN,null], @param34=[IDCHUYENHUY,null], @param35=[IDCHUYENHOAN,null], @param36=[HOADONLIENQUAN_ID,null], @param37=[TRANSFER_VIENPHI_ID,null], @param38=[NGAYKHOAGOI,null], @param39=[NHOMTHANHTOAN_ID,null], @param40=[HOADONDOIUNG,null], @param41=[CHUYENCHUNGTUID,null], @param42=[CHUYENCHUNGTUHOANID,null], @param43=[CHUYENCHUNGTUHUYID,null], @param44=[CHUYENDOANHTHUID,null], @param45=[CHUYENDOANHTHUHOANID,null], @param46=[CHUYENDOANHTHUHUYID,null], @param47=[KH_TENCONGTY,null], @param48=[KH_MASOTHUE,null], @param49=[KH_DIACHI,null], @param50=[KH_NGUOIDAIDIEN,null], @param51=[INLAI,null], @param52=[INLAI_USER_ID,null], @param53=[BENHVIEN_ID,01819], @param54=[NGAYTAO,7/16/2020 3:51:14 PM], @param55=[NGUOITAO_ID,1], @param56=[NGAYCAPNHAT,7/16/2020 3:51:14 PM], @param57=[NGUOICAPNHAT_ID,1], @param58=[YEUCAUVP,False], @param59=[MACHINENAME,DESKTOP-89GE5BA], @param60=[DOTDIEUTRI_ID,null]]
2020-07-16 15:51:14,563 [1] DEBUG - Statement Id: [DAO00024_TT_HOADON_Add] Types: [@param0=[String, System.String], @param1=[String, System.String], @param2=[Int64, System.Int64], @param3=[Int64, System.Int64], @param4=[System.DBNull, null], @param5=[Int64, System.Int64], @param6=[System.DBNull, null], @param7=[DateTime, System.DateTime], @param8=[DateTime, System.DateTime], @param9=[Int64, System.Int64], @param10=[Int64, System.Int64], @param11=[Int64, System.Int64], @param12=[Int64, System.Int64], @param13=[System.DBNull, null], @param14=[System.DBNull, null], @param15=[System.DBNull, null], @param16=[Double, System.Double], @param17=[Double, System.Double], @param18=[String, System.String], @param19=[Double, System.Double], @param20=[Double, System.Double], @param21=[System.DBNull, null], @param22=[System.DBNull, null], @param23=[System.DBNull, null], @param24=[System.DBNull, null], @param25=[System.DBNull, null], @param26=[String, System.String], @param27=[System.DBNull, null], @param28=[String, System.String], @param29=[String, System.String], @param30=[String, System.String], @param31=[System.DBNull, null], @param32=[String, System.String], @param33=[System.DBNull, null], @param34=[System.DBNull, null], @param35=[System.DBNull, null], @param36=[System.DBNull, null], @param37=[System.DBNull, null], @param38=[System.DBNull, null], @param39=[System.DBNull, null], @param40=[System.DBNull, null], @param41=[System.DBNull, null], @param42=[System.DBNull, null], @param43=[System.DBNull, null], @param44=[System.DBNull, null], @param45=[System.DBNull, null], @param46=[System.DBNull, null], @param47=[System.DBNull, null], @param48=[System.DBNull, null], @param49=[System.DBNull, null], @param50=[System.DBNull, null], @param51=[System.DBNull, null], @param52=[System.DBNull, null], @param53=[String, System.String], @param54=[DateTime, System.DateTime], @param55=[Int64, System.Int64], @param56=[DateTime, System.DateTime], @param57=[Int64, System.Int64], @param58=[Boolean, System.Boolean], @param59=[String, System.String], @param60=[System.DBNull, null]]
2020-07-16 15:51:14,607 [1] DEBUG - Statement Id: [DAO00024_TT_HOADON_HINHTHUCTHANHTOAN_Add] PreparedStatement : [insert into TT_HOADON_HINHTHUCTHANHTOAN (              HOADON_ID              , HINHTHUCTHANHTOAN_ID              , TENHINHTHUCTHANHTOAN              , GIATRITHUCTHU              , TIENTE              , TIENTE_ID              , TYGIA              , GIATRIVND              , BENHVIEN_ID              ) values (               @param0               ,  @param1               ,  @param2               ,  @param3               ,  @param4               ,  @param5               ,  @param6               ,  @param7               ,  @param8               )]
2020-07-16 15:51:14,607 [1] DEBUG - Statement Id: [DAO00024_TT_HOADON_HINHTHUCTHANHTOAN_Add] Parameters: [@param0=[HOADON_ID,5591], @param1=[HINHTHUCTHANHTOAN_ID,443], @param2=[TENHINHTHUCTHANHTOAN,Tiền mặt], @param3=[GIATRITHUCTHU,38700], @param4=[TIENTE,VND], @param5=[TIENTE_ID,8047], @param6=[TYGIA,1], @param7=[GIATRIVND,38700], @param8=[BENHVIEN_ID,01819]]
2020-07-16 15:51:14,608 [1] DEBUG - Statement Id: [DAO00024_TT_HOADON_HINHTHUCTHANHTOAN_Add] Types: [@param0=[Int64, System.Int64], @param1=[Int64, System.Int64], @param2=[String, System.String], @param3=[Double, System.Double], @param4=[String, System.String], @param5=[String, System.String], @param6=[Double, System.Double], @param7=[Double, System.Double], @param8=[String, System.String]]
2020-07-16 15:51:14,639 [1] DEBUG - Statement Id: [DAO00024_TT_VIENPHI_Ngoaitru_Thanhtoan_Json] PreparedStatement : [declare @jsonVienPhi nvarchar(max) = N'[{"TIEPNHAN_ID":8747,"SOTIEPNHAN":"TN200716.0000004","HOADONCHITIET_ID":0,"HOADON_ID":5591,"VIENPHI_ID":16000,"REF_ID":13147,"REF_TABLE":"TT_DVYEUCAU","DICHVU_ID":3,"DUOC_ID":null,"LOAI_CHIPHI":"TT","LOAIGIA_ID":3,"SOLUONG":1.0,"DONGIA_DOANHTHU":38700.0,"THANHTIEN_DOANHTHU":38700.0,"BHYT_TL":0.0,"BHYT_DONGIA":0.0,"BHYT_THANHTIEN":0.0,"BHYT_DONGIA_CHITRA":0.0,"BHYT_THANHTIEN_CHITRA":0.0,"BENHNHAN_PHAITHANHTOAN":38700.0,"GIATRI_HOADON":0.0,"GIATRI_HOADON_DATHANHTOAN":0.0,"GIATRI_BIENLAI":0.0,"GIATRI_BIENLAI_DATHANHTOAN":0.0,"GIATRI_BENHNHAN_DATHANHTOAN":0.0,"TYLE_THATTHU":null,"GIATRI_THATTHU":0.0,"MIENGIAM_TL":0.0,"MIENGIAM_GIATRI":0.0,"NGANSACH_TL":0.0,"NGANSACH_GIATRI":0.0,"TAITRO_TL":0.0,"TAITRO_GIATRI":0.0,"BHTN_GIATRI":null,"NOIDUNGTHU":null,"CHUNGTUXUATBN_ID":null,"TYLEVAT":null,"GIATRIVAT":null,"MASOTHUE":null,"SOCHUNGTUKETOAN":null,"DAHOANTRA":"0","TRANGTHAI":"CHUATHUCHIEN","PHONGBAN_ID":null,"PHONGBAN_THAYDOI_ID":null,"BENHVIEN_ID":"01819","NGAYTAO":"2020-07-16T15:42:34.377","NGUOITAO_ID":1,"NGAYCAPNHAT":"2020-07-16T15:43:59.317","NGUOICAPNHAT_ID":1,"CONGTYCHITRA_GIATRI":0.0,"HOIVIEN_GIATRI":0.0,"CHON":true}]';          begin                        update TT_VIENPHI            set            GIATRI_BENHNHAN_DATHANHTOAN = 0,            GIATRI_HOADON_DATHANHTOAN = 0,            GIATRI_BIENLAI_DATHANHTOAN = 0            where GIATRI_BENHNHAN_DATHANHTOAN is null and TIEPNHAN_ID =  @param0 ;                     INSERT INTO TT_HOADON_CHITIET_NGOAITRU          (HOADON_ID, VIENPHI_ID, REF_ID, REF_TABLE, DICHVU_ID, DUOC_ID, LOAI_CHIPHI, LOAIGIA_ID, SOLUONG, DONGIA_DOANHTHU, THANHTIEN_DOANHTHU, BHYT_TL,          BHYT_DONGIA, BHYT_THANHTIEN, BHYT_DONGIA_CHITRA, BHYT_THANHTIEN_CHITRA, BENHNHAN_PHAITHANHTOAN, GIATRI_HOADON, GIATRI_HOADON_DATHANHTOAN,          GIATRI_BIENLAI, GIATRI_BIENLAI_DATHANHTOAN, GIATRI_BENHNHAN_DATHANHTOAN, MIENGIAM_GIATRI, BHTN_GIATRI,          CONGTYCHITRA_GIATRI, HOIVIEN_GIATRI, BENHVIEN_ID, NGAYTAO, NGUOITAO_ID, NGAYCAPNHAT, NGUOICAPNHAT_ID)          SELECT          HOADON_ID, VIENPHI_ID, REF_ID, REF_TABLE, DICHVU_ID, DUOC_ID, LOAI_CHIPHI, LOAIGIA_ID, SOLUONG, DONGIA_DOANHTHU, THANHTIEN_DOANHTHU,BHYT_TL,          BHYT_DONGIA, BHYT_THANHTIEN, BHYT_DONGIA_CHITRA, BHYT_THANHTIEN_CHITRA, BENHNHAN_PHAITHANHTOAN, GIATRI_HOADON, GIATRI_HOADON_DATHANHTOAN,          GIATRI_BIENLAI, GIATRI_BIENLAI_DATHANHTOAN, GIATRI_BENHNHAN_DATHANHTOAN, MIENGIAM_GIATRI, BHTN_GIATRI,          CONGTYCHITRA_GIATRI, HOIVIEN_GIATRI, BENHVIEN_ID, GETDATE(), NGUOITAO_ID, GETDATE(), NGUOICAPNHAT_ID          FROM OPENJSON(@jsonVienPhi)          WITH (          HOADON_ID int , VIENPHI_ID int , REF_ID int , REF_TABLE varchar(50) , DICHVU_ID int , DUOC_ID int , LOAI_CHIPHI varchar(20)          , LOAIGIA_ID int , SOLUONG numeric(25,4) , DONGIA_DOANHTHU numeric(25,4) , THANHTIEN_DOANHTHU numeric(25,4)          , BHYT_TL numeric(25,4) , BHYT_DONGIA numeric(25,4) , BHYT_THANHTIEN numeric(25,4) , BHYT_DONGIA_CHITRA numeric(25,4)          , BHYT_THANHTIEN_CHITRA numeric(25,4) , BENHNHAN_PHAITHANHTOAN numeric(25,4) , GIATRI_HOADON numeric(25,4)          , GIATRI_HOADON_DATHANHTOAN numeric(25,4) , GIATRI_BIENLAI numeric(25,4) , GIATRI_BIENLAI_DATHANHTOAN numeric(25,4)          , GIATRI_BENHNHAN_DATHANHTOAN numeric(25,4) , MIENGIAM_GIATRI numeric(25,4) , BHTN_GIATRI numeric(25,4)          , CONGTYCHITRA_GIATRI numeric(25,4) , HOIVIEN_GIATRI numeric(25,4) , BENHVIEN_ID varchar(10)          , NGUOITAO_ID int , NGUOICAPNHAT_ID int)            update TT_VIENPHI          set DATHANHTOAN = '1'          , DUOCPHEPTHUCHIEN = '1'          , HUY = '0'          , ACTIVE = '1'          , TT_VIENPHI.GIATRI_BENHNHAN_DATHANHTOAN = isnull(TT_VIENPHI.GIATRI_BENHNHAN_DATHANHTOAN,0) + json.BENHNHAN_PHAITHANHTOAN          , TT_VIENPHI.GIATRI_HOADON_DATHANHTOAN = isnull(TT_VIENPHI.GIATRI_HOADON_DATHANHTOAN,0) + json.BENHNHAN_PHAITHANHTOAN          , TT_VIENPHI.GIATRI_BIENLAI_DATHANHTOAN = isnull(TT_VIENPHI.GIATRI_BIENLAI_DATHANHTOAN,0) + json.BENHNHAN_PHAITHANHTOAN          , HOADON_ID = json.HOADON_ID          FROM OPENJSON (@jsonVienPhi)          WITH (          VIENPHI_ID int,          HOADON_ID int,          GIATRI_HOADON_DATHANHTOAN numeric(25, 4),          GIATRI_BIENLAI_DATHANHTOAN numeric(25, 4),          GIATRI_BENHNHAN_DATHANHTOAN numeric(25, 4),          BENHNHAN_PHAITHANHTOAN numeric(25, 4))  json          WHERE TT_VIENPHI.VIENPHI_ID = json.VIENPHI_ID          end]
2020-07-16 15:51:14,639 [1] DEBUG - Statement Id: [DAO00024_TT_VIENPHI_Ngoaitru_Thanhtoan_Json] Parameters: [@param0=[TIEPNHAN_ID,8747]]
2020-07-16 15:51:14,639 [1] DEBUG - Statement Id: [DAO00024_TT_VIENPHI_Ngoaitru_Thanhtoan_Json] Types: [@param0=[Int64, System.Int64]]
2020-07-16 15:51:14,702 [1] DEBUG - Statement Id: [DAO00024_TT_VIENPHI_Update] PreparedStatement : [update TT_VIENPHI set            TIEPNHAN_ID =  @param0                          , REF_ID =  @param1             , REF_TABLE =  @param2             , DICHVU_ID =  @param3             , DUOC_ID =  @param4             , LOAI_CHIPHI =  @param5             , LOAIGIA_ID =  @param6             , SOLUONG =  @param7             , DONGIA_DOANHTHU =  @param8             , THANHTIEN_DOANHTHU =  @param9             , BHYT_TL =  @param10             , BHYT_DONGIA =  @param11             , BHYT_THANHTIEN =  @param12             , BHYT_DONGIA_CHITRA =  @param13             , BHYT_THANHTIEN_CHITRA =  @param14             , BENHNHAN_PHAITHANHTOAN =  @param15             , GIATRI_HOADON =  @param16             , GIATRI_HOADON_DATHANHTOAN =  @param17             , GIATRI_BIENLAI =  @param18             , GIATRI_BIENLAI_DATHANHTOAN =  @param19             , GIATRI_BENHNHAN_DATHANHTOAN =  @param20             , GIATRI_THATTHU =  @param21             , MIENGIAM_TL =  @param22             , MIENGIAM_GIATRI =  @param23             , NGANSACH_TL =  @param24             , NGANSACH_GIATRI =  @param25             , TAITRO_TL =  @param26             , TAITRO_GIATRI =  @param27             , BHTN_TL =  @param28             , BHTN_DONGIA =  @param29             , BHTN_THANHTIEN =  @param30             , BHTN_DONGIA_CHITRA =  @param31             , BHTN_THANHTIEN_CHITRA =  @param32                           , DUOCPHEPTHUCHIEN =  @param33                             , HUY =  @param34                             , DATHANHTOAN =  @param35                             , DATHUCHIEN =  @param36                             , KHONGTHUTIEN =  @param37                          , HOADON_ID =  @param38                           , ACTIVE =  @param39                           , YEUCAUVP =  @param40                          , NGUOICAPNHAT_ID =  @param41             , NGAYCAPNHAT =  @param42             where            VIENPHI_ID = '16000']
2020-07-16 15:51:14,702 [1] DEBUG - Statement Id: [DAO00024_TT_VIENPHI_Update] Parameters: [@param0=[TIEPNHAN_ID,8747], @param1=[REF_ID,13147], @param2=[REF_TABLE,TT_DVYEUCAU], @param3=[DICHVU_ID,3], @param4=[DUOC_ID,null], @param5=[LOAI_CHIPHI,TT], @param6=[LOAIGIA_ID,3], @param7=[SOLUONG,1], @param8=[DONGIA_DOANHTHU,38700], @param9=[THANHTIEN_DOANHTHU,38700], @param10=[BHYT_TL,0], @param11=[BHYT_DONGIA,0], @param12=[BHYT_THANHTIEN,0], @param13=[BHYT_DONGIA_CHITRA,0], @param14=[BHYT_THANHTIEN_CHITRA,0], @param15=[BENHNHAN_PHAITHANHTOAN,38700], @param16=[GIATRI_HOADON,0], @param17=[GIATRI_HOADON_DATHANHTOAN,0], @param18=[GIATRI_BIENLAI,0], @param19=[GIATRI_BIENLAI_DATHANHTOAN,0], @param20=[GIATRI_BENHNHAN_DATHANHTOAN,0], @param21=[GIATRI_THATTHU,0], @param22=[MIENGIAM_TL,0], @param23=[MIENGIAM_GIATRI,0], @param24=[NGANSACH_TL,0], @param25=[NGANSACH_GIATRI,0], @param26=[TAITRO_TL,0], @param27=[TAITRO_GIATRI,0], @param28=[BHTN_TL,0], @param29=[BHTN_DONGIA,0], @param30=[BHTN_THANHTIEN,0], @param31=[BHTN_DONGIA_CHITRA,0], @param32=[BHTN_THANHTIEN_CHITRA,0], @param33=[DUOCPHEPTHUCHIEN,0], @param34=[HUY,0], @param35=[DATHANHTOAN,0], @param36=[DATHUCHIEN,0], @param37=[KHONGTHUTIEN,0], @param38=[HOADON_ID,5591], @param39=[ACTIVE,1], @param40=[YEUCAUVP,0], @param41=[NGUOICAPNHAT_ID,1], @param42=[NGAYCAPNHAT,7/16/2020 3:51:14 PM]]
2020-07-16 15:51:14,702 [1] DEBUG - Statement Id: [DAO00024_TT_VIENPHI_Update] Types: [@param0=[Int64, System.Int64], @param1=[Int64, System.Int64], @param2=[String, System.String], @param3=[Int64, System.Int64], @param4=[System.DBNull, null], @param5=[String, System.String], @param6=[Int64, System.Int64], @param7=[Double, System.Double], @param8=[Double, System.Double], @param9=[Double, System.Double], @param10=[Double, System.Double], @param11=[Double, System.Double], @param12=[Double, System.Double], @param13=[Double, System.Double], @param14=[Double, System.Double], @param15=[Double, System.Double], @param16=[Double, System.Double], @param17=[Double, System.Double], @param18=[Double, System.Double], @param19=[Double, System.Double], @param20=[Double, System.Double], @param21=[Double, System.Double], @param22=[Double, System.Double], @param23=[Double, System.Double], @param24=[Double, System.Double], @param25=[Double, System.Double], @param26=[Double, System.Double], @param27=[Double, System.Double], @param28=[Double, System.Double], @param29=[Double, System.Double], @param30=[Double, System.Double], @param31=[Double, System.Double], @param32=[Double, System.Double], @param33=[String, System.String], @param34=[String, System.String], @param35=[String, System.String], @param36=[String, System.String], @param37=[String, System.String], @param38=[Int64, System.Int64], @param39=[String, System.String], @param40=[String, System.String], @param41=[Int64, System.Int64], @param42=[DateTime, System.DateTime]]
2020-07-16 15:51:21,299 [1] DEBUG - Statement Id: [DAO00403_QMS002_GetThongTinClient] PreparedStatement : [SELECT B.ID as QUEUE_ID, B.NAME AS QUEUE_NAME,A.ID AS CLIENT_ID , A.[NAME] AS CLIENT_NAME, ISNULL(A.[STATE],1) AS [STATE],(CASE C.NAME WHEN 'UT' THEN 1 ELSE 0 END) AS QUEUETYPE     , B.DEPARTMENT_ID,ISNULL(B.SECTION_ID,-1) AS SECTION_ID,A.IPSERVER,A.NAMEAUDIO,C.QUEUE_TYPE_CODE,C.QUEUE_TYPE_CODE_SOUND,S.[NAME] AS SECTIONNAME     FROM QMS_QUEUE B LEFT JOIN QMS_CLIENT A ON A.QUEUE_ID = B.ID     LEFT JOIN QMS_QUEUE_TYPE C ON B.QUEUETYPE_ID = C.ID     LEFT JOIN QMS_SECTION S ON B.SECTION_ID=S.ID     WHERE     (A.COMPUTERNAME = 'DESKTOP-89GE5BA' OR A.IPADDRESS = '10.15.167.38') AND A.[STATE] = 1 AND B.DEPARTMENT_ID='74'            AND B.BENHVIEN_ID = '01819']
2020-07-16 15:51:21,436 [1] DEBUG - Statement Id: [DAO00019_GetDanhsachKhambenh] PreparedStatement : [select *        from        (SELECT COUNT(*) OVER() as TOTALROWS, ROW_NUMBER() OVER(order by isnull(dv.SOTHUTU,'999999999'), dv.NGAYGIOYEUCAU) as ROWNUMBER,        bn.MAYTE, bn.TENBENHNHAN, bn.NAMSINH, bn.NGAYSINH as TUOI, ISNULL(CONVERT(VARCHAR(10), bn.NGAYSINH, 103),CAST(bn.NAMSINH AS varchar)) as NGAYSINH, bn.DIACHILIENLAC as DIACHI, bn.GIOITINH, GD.DESCRIPTION as TENGIOITINH,        tn.DOITUONG_ID, tn.THOIGIANTIEPNHAN, tn.BENHNHAN_ID, tn.TIEPNHAN_ID, tn.TRAITUYEN, tn.SOTIEPNHAN,        dv.DICHVU_ID, dv.NOITHUCHIEN_ID, isnull(dv.NGAYTAO, dv.NGAYCAPNHAT) as THOIGIANDKDICHVU,        dv.KHAN, dv.NOIYEUCAU_ID, dv.NGAYGIOYEUCAU, dv.BACSICHIDINH_ID, dv.DONVIGIOITHIEU_ID, dv.NGUOIGIOITHIEU_ID,        tn.NOIGIOITHIEU_ID, kbnt.HUONGGIAIQUYET_ID,        dv.DVYEUCAU_ID, dv.MARIS, dv.TRANGTHAI as TRANGTHAICODE, B.TENNHOMDICHVU, dv.SOPHIEUYEUCAU, dv.KHAMBENH_NGOAITRU_ID, dv.NGUOICAPNHAT_ID, dv.NGAYCAPNHAT,        CASE WHEN Left(B.MANHOMDICHVU,2) = '03' THEN '02' ELSE Left(B.MANHOMDICHVU,2) END AS MANHOMDICHVU, B.MANHOMDICHVU as MANHOMDICHVUCHITIET, tn.TRANGTHAI as TRANGTHAI_TIEPNHAN,        'False' as DAKHAM, isnull(dv.SOTHUTU,'999999999') as SOHANGDOI,        vp.DATHANHTOAN, dv.TRANGTHAI_WFL,        BA.SOBENHAN, dv.CHANDOAN, dt.TENDOITUONG, isnull(kbnt.THOIGIANKHAM, dv.NGAYCAPNHAT) as THOIGIANKHAM,        tn.SOBHYT          ,           tn.UUTIEN                 FROM TT_DVYEUCAU (NOLOCK) dv        inner join TT_TIEPNHAN (NOLOCK) tn on dv.TIEPNHAN_ID = tn.TIEPNHAN_ID        inner join TT_BENHNHAN (NOLOCK) bn on tn.BENHNHAN_ID = bn.BENHNHAN_ID        inner join TM_DICHVU A on A.DICHVU_ID = dv.DICHVU_ID        inner join TM_NHOMDICHVU B on B.NHOMDICHVU_ID = A.NHOMDICHVU_ID        inner join TT_VIENPHI(NOLOCK) VP on VP.TIEPNHAN_ID = tn.TIEPNHAN_ID and VP.DICHVU_ID = dv.DICHVU_ID and VP.REF_ID = dv.DVYEUCAU_ID        left join TT_NOITRU_BENHAN (NOLOCK) BA on BA.TIEPNHAN_ID = tn.TIEPNHAN_ID AND dv.BENHAN_ID = BA.BENHAN_ID        inner join TM_GENDER GD on GD.ID = bn.GIOITINH        left join TT_NGOAITRU_KHAMBENH (NOLOCK) kbnt on kbnt.KHAMBENH_ID = dv.KHAMBENH_NGOAITRU_ID        inner join TM_DOITUONG dt on dt.DOITUONG_ID = tn.DOITUONG_ID        where        dv.DICHVU_ID IS NOT NULL        and tn.BENHVIEN_ID = '01819'        and HUYYEUCAU = 0        and dv.NGAYHENCLS is NULL         and           dv.NGAYYEUCAU >= '7/16/2020 12:00:00 AM'         and           dv.NGAYYEUCAU <= '7/16/2020 12:00:00 AM'         and           dv.NOITHUCHIEN_ID = 74          AND             (                         ((dv.TRANGTHAI_WFL = 'CHUAKETQUA' or (dv.TRANGTHAI = 'CHUAKETQUA' and dv.TRANGTHAI_WFL = 'HOANTHANH')) and (isnull(kbnt.HUONGGIAIQUYET_ID, 0) = 0)))            and (tn.TRANGTHAI != 'HOANTHANH')           and           (CASE WHEN Left(B.MANHOMDICHVU,2) = '03' THEN '02' ELSE Left(B.MANHOMDICHVU,2) END) = '04'                 ) lst                    where          lst.ROWNUMBER between 1 and 19                 order by SOHANGDOI, NGAYGIOYEUCAU asc]
2020-07-16 15:51:30,851 [1] DEBUG - Statement Id: [DAO00017_GetLoaiGiaByDoiTuongId] PreparedStatement : [select dtlg.DOUUTIEN, dtlg.DOITUONG_ID, lg.LOAIGIA_ID, lg.TENLOAIGIA, lg.MALOAIGIA              from TM_LOAIGIA lg              left join TM_DOITUONG_LOAIGIA dtlg              on lg.LOAIGIA_ID = dtlg.LOAIGIA_ID and dtlg.BENHVIEN_ID = '01819'              where lg.TAMNGUNG = 0 and lg.BENHVIEN_ID = '01819'                             order by dtlg.DOUUTIEN]
2020-07-16 15:51:30,904 [1] DEBUG - Statement Id: [DAO00014_KiemTraDVYCCoGiaBHYT] PreparedStatement : [select *        from TT_VIENPHI        where REF_ID  = '' and REF_TABLE = 'TT_DVYEUCAU' and BHYT_DONGIA > 0]
2020-07-16 15:51:30,940 [1] DEBUG - Statement Id: [DAO00305_GetAllLoaiToaThuoc] PreparedStatement : [declare @LOAITOATHUOC varchar(200)        set @LOAITOATHUOC = (select top 1 LOAITOATHUOC = STUFF((SELECT ',' + LOAITOATHUOC FROM TM_TOATHUOC_NGOAITRU where BENHVIEN_ID = '01819' FOR XML PATH ('')), 1, 1, '')        from TM_TOATHUOC_NGOAITRU)        set @LOAITOATHUOC = '''' +  REPLACE(@LOAITOATHUOC,',',''',''') + ''''        select @LOAITOATHUOC as LOAITOATHUOC]
2020-07-16 15:51:31,009 [1] DEBUG - Statement Id: [DAO00040_LayListToaMau] PreparedStatement : [select A.*, dc.TENDUOCDAYDU, dc.BHYT DUOC_BHYT, ld.LOAIVATTU_ID, ld.MALOAIDUOC, dd.DICTIONARY_NAME DUONGDUNG, dc.TAMNGUNG            from TT_TOATHUOCMAU A            left join TM_DUOC dc on A.DUOC_ID = dc.DUOC_ID            left join TM_LOAIDUOC ld on dc.LOAIDUOC_ID = ld.LOAIDUOC_ID            left join (select * from LST_DICTIONARY where DICTIONARY_TYPE_CODE like 'DuongDung') dd on dd.DICTIONARY_ID = dc.DUONGDUNG_ID            where (1=1)             and               A.BACSI_ID  = 1             and               A.LOAITOATHUOC IN ('BV','MN','BV','KTBV','KTBV','BV')]
2020-07-16 15:51:31,070 [1] DEBUG - Statement Id: [DAO00305_GetAllLoaiToaThuoc] PreparedStatement : [declare @LOAITOATHUOC varchar(200)        set @LOAITOATHUOC = (select top 1 LOAITOATHUOC = STUFF((SELECT ',' + LOAITOATHUOC FROM TM_TOATHUOC_NGOAITRU where BENHVIEN_ID = '01819' FOR XML PATH ('')), 1, 1, '')        from TM_TOATHUOC_NGOAITRU)        set @LOAITOATHUOC = '''' +  REPLACE(@LOAITOATHUOC,',',''',''') + ''''        select @LOAITOATHUOC as LOAITOATHUOC]
2020-07-16 15:51:31,139 [1] DEBUG - Statement Id: [DAO00040_LayListToaMau] PreparedStatement : [select A.*, dc.TENDUOCDAYDU, dc.BHYT DUOC_BHYT, ld.LOAIVATTU_ID, ld.MALOAIDUOC, dd.DICTIONARY_NAME DUONGDUNG, dc.TAMNGUNG            from TT_TOATHUOCMAU A            left join TM_DUOC dc on A.DUOC_ID = dc.DUOC_ID            left join TM_LOAIDUOC ld on dc.LOAIDUOC_ID = ld.LOAIDUOC_ID            left join (select * from LST_DICTIONARY where DICTIONARY_TYPE_CODE like 'DuongDung') dd on dd.DICTIONARY_ID = dc.DUONGDUNG_ID            where (1=1)             and               A.BACSI_ID  = 1             and               A.LOAITOATHUOC IN ('BV','MN','BV','KTBV','KTBV','BV')]
2020-07-16 15:51:31,191 [1] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoVaBookingCOM23UpdateRedis_TheoPhamvi] PreparedStatement : [declare @TOAMUANGOAI int = 0;        select @TOAMUANGOAI = isnull(VALUE,0) from TM_SYS_APPSETTINGS where CODE = 'OPD_TOAMUANGOAI_DUNGDANHMUC_DUOC'                if @TOAMUANGOAI = 1        begin        select  distinct '0' + '_' + LTRIM(d.DUOC_ID) + '_' + '0' as DUOC_KEY, 999999999 as SOLUONG        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = '01819'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = '01819')        where  @param0  = 0        union all        select distinct tk.DUOC_KEY, tk.SOLUONG        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = '01819'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = '01819')        inner join        (        select  LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')) DUOC_KEY, (SUM(dtk.SOLUONG) - isnull(sum(A.SOLUONG),0) - isnull(sum(B.SOLUONG),0)) SOLUONG, pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        from (select sum(soluong) soluong,duoc_id,nguonduoc_id,khoduoc_id,benhvien_id from TT_DUOC_TONKHO  group by duoc_id,nguonduoc_id,khoduoc_id,benhvien_id) dtk        inner join TM_DUOC_PHAMVISD_MAPPING pvsd on dtk.KHODUOC_ID = pvsd.KHODUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NOITRU        where TRANGTHAI != 'HUY' and PHAMVI_ID =  @param0         group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) B on B.DUOC_ID = dtk.DUOC_ID and B.PHAMVI_ID = pvsd.PHAMVI_ID and B.NGUONHANG_ID = dtk.NGUONDUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NGOAITRU        where TRANGTHAI != 'HUY' and PHAMVI_ID =  @param0         group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) A on A.DUOC_ID = dtk.DUOC_ID and A.PHAMVI_ID = pvsd.PHAMVI_ID and A.NGUONHANG_ID = dtk.NGUONDUOC_ID        where dtk.BENHVIEN_ID = '01819'        group by LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')), pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        ) tk on tk.DUOC_ID = d.DUOC_ID        left join TM_DUOC_PHAMVISUDUNG kd on kd.PHAMVI_ID = tk.PHAMVI_ID and kd.BENHVIEN_ID = '01819'        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = tk.NGUONDUOC_ID and nh.BENHVIEN_ID = '01819'        where d.BENHVIEN_ID = '01819' and tk.PHAMVI_ID =  @param0         end        else        begin        select distinct tk.DUOC_KEY, tk.SOLUONG        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = '01819'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = '01819')        inner join        (        select  LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')) DUOC_KEY, (SUM(dtk.SOLUONG) - isnull(sum(A.SOLUONG),0) - isnull(sum(B.SOLUONG),0)) SOLUONG, pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        from (select sum(soluong) soluong,duoc_id,nguonduoc_id,khoduoc_id,benhvien_id from TT_DUOC_TONKHO        group by duoc_id,nguonduoc_id,khoduoc_id,benhvien_id) dtk        inner join TM_DUOC_PHAMVISD_MAPPING pvsd on dtk.KHODUOC_ID = pvsd.KHODUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NOITRU        where TRANGTHAI != 'HUY' and PHAMVI_ID =  @param0         group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) B on B.DUOC_ID = dtk.DUOC_ID and B.PHAMVI_ID = pvsd.PHAMVI_ID and B.NGUONHANG_ID = dtk.NGUONDUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NGOAITRU        where TRANGTHAI != 'HUY' and PHAMVI_ID =  @param0         group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) A on A.DUOC_ID = dtk.DUOC_ID and A.PHAMVI_ID = pvsd.PHAMVI_ID and A.NGUONHANG_ID = dtk.NGUONDUOC_ID        where dtk.BENHVIEN_ID = '01819'        group by LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')), pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        ) tk on tk.DUOC_ID = d.DUOC_ID        left join TM_DUOC_PHAMVISUDUNG kd on kd.PHAMVI_ID = tk.PHAMVI_ID and kd.BENHVIEN_ID = '01819'        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = tk.NGUONDUOC_ID and nh.BENHVIEN_ID = '01819'        where d.BENHVIEN_ID = '01819' and tk.PHAMVI_ID =  @param0         end]
2020-07-16 15:51:31,191 [1] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoVaBookingCOM23UpdateRedis_TheoPhamvi] Parameters: [@param0=[PHAMVI_ID,8]]
2020-07-16 15:51:31,191 [1] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoVaBookingCOM23UpdateRedis_TheoPhamvi] Types: [@param0=[Int64, System.Int64]]
2020-07-16 15:51:31,222 [1] DEBUG - Statement Id: [DAO00012_GetLoaiTCLS] PreparedStatement : [select DICTIONARY_ID, DICTIONARY_CODE, DICTIONARY_NAME, cast('0' as Bit) CHON        from LST_DICTIONARY              where DICTIONARY_TYPE_CODE = 'KHAMBENH_LOAI_TRIEUCHUNGLS'        order by LST_DICTIONARY.IDX]
2020-07-16 15:51:31,246 [1] DEBUG - Statement Id: [DAO00012_GetAllTCLS] PreparedStatement : [select MALOAITRIEUCHUNG DICTIONARY_TYPE_CODE, MALOAITRIEUCHUNG DICTIONARY_CODE,        TENTRIEUCHUNG DICTIONARY_NAME from TM_TRIEUCHUNGLS]
2020-07-16 15:51:31,318 [1] DEBUG - Statement Id: [DAO00305_GetListPhongBanKhoaNgoai] PreparedStatement : [select A.*, B.DICTIONARY_CODE from TM_PHONGBAN A        inner join LST_DICTIONARY B on A.LOAIPHONGBAN_ID = B.DICTIONARY_ID        and B.DICTIONARY_TYPE_CODE = 'LoaiPhongBan'        where A.TAMNGUNG = '0'        and B.DICTIONARY_CODE = 'KhoaNgoai'        order by A.TENPHONGBAN asc]
2020-07-16 15:51:33,618 [1] DEBUG - Statement Id: [DAO00403_QMS002_GetThongTinClient] PreparedStatement : [SELECT B.ID as QUEUE_ID, B.NAME AS QUEUE_NAME,A.ID AS CLIENT_ID , A.[NAME] AS CLIENT_NAME, ISNULL(A.[STATE],1) AS [STATE],(CASE C.NAME WHEN 'UT' THEN 1 ELSE 0 END) AS QUEUETYPE     , B.DEPARTMENT_ID,ISNULL(B.SECTION_ID,-1) AS SECTION_ID,A.IPSERVER,A.NAMEAUDIO,C.QUEUE_TYPE_CODE,C.QUEUE_TYPE_CODE_SOUND,S.[NAME] AS SECTIONNAME     FROM QMS_QUEUE B LEFT JOIN QMS_CLIENT A ON A.QUEUE_ID = B.ID     LEFT JOIN QMS_QUEUE_TYPE C ON B.QUEUETYPE_ID = C.ID     LEFT JOIN QMS_SECTION S ON B.SECTION_ID=S.ID     WHERE     (A.COMPUTERNAME = 'DESKTOP-89GE5BA' OR A.IPADDRESS = '10.15.167.38') AND A.[STATE] = 1 AND B.DEPARTMENT_ID='74'            AND B.BENHVIEN_ID = '01819']
2020-07-16 15:51:33,749 [1] DEBUG - Statement Id: [DAO00019_GetDanhsachKhambenh] PreparedStatement : [select *        from        (SELECT COUNT(*) OVER() as TOTALROWS, ROW_NUMBER() OVER(order by isnull(dv.SOTHUTU,'999999999'), dv.NGAYGIOYEUCAU) as ROWNUMBER,        bn.MAYTE, bn.TENBENHNHAN, bn.NAMSINH, bn.NGAYSINH as TUOI, ISNULL(CONVERT(VARCHAR(10), bn.NGAYSINH, 103),CAST(bn.NAMSINH AS varchar)) as NGAYSINH, bn.DIACHILIENLAC as DIACHI, bn.GIOITINH, GD.DESCRIPTION as TENGIOITINH,        tn.DOITUONG_ID, tn.THOIGIANTIEPNHAN, tn.BENHNHAN_ID, tn.TIEPNHAN_ID, tn.TRAITUYEN, tn.SOTIEPNHAN,        dv.DICHVU_ID, dv.NOITHUCHIEN_ID, isnull(dv.NGAYTAO, dv.NGAYCAPNHAT) as THOIGIANDKDICHVU,        dv.KHAN, dv.NOIYEUCAU_ID, dv.NGAYGIOYEUCAU, dv.BACSICHIDINH_ID, dv.DONVIGIOITHIEU_ID, dv.NGUOIGIOITHIEU_ID,        tn.NOIGIOITHIEU_ID, kbnt.HUONGGIAIQUYET_ID,        dv.DVYEUCAU_ID, dv.MARIS, dv.TRANGTHAI as TRANGTHAICODE, B.TENNHOMDICHVU, dv.SOPHIEUYEUCAU, dv.KHAMBENH_NGOAITRU_ID, dv.NGUOICAPNHAT_ID, dv.NGAYCAPNHAT,        CASE WHEN Left(B.MANHOMDICHVU,2) = '03' THEN '02' ELSE Left(B.MANHOMDICHVU,2) END AS MANHOMDICHVU, B.MANHOMDICHVU as MANHOMDICHVUCHITIET, tn.TRANGTHAI as TRANGTHAI_TIEPNHAN,        'False' as DAKHAM, isnull(dv.SOTHUTU,'999999999') as SOHANGDOI,        vp.DATHANHTOAN, dv.TRANGTHAI_WFL,        BA.SOBENHAN, dv.CHANDOAN, dt.TENDOITUONG, isnull(kbnt.THOIGIANKHAM, dv.NGAYCAPNHAT) as THOIGIANKHAM,        tn.SOBHYT          ,           tn.UUTIEN                 FROM TT_DVYEUCAU (NOLOCK) dv        inner join TT_TIEPNHAN (NOLOCK) tn on dv.TIEPNHAN_ID = tn.TIEPNHAN_ID        inner join TT_BENHNHAN (NOLOCK) bn on tn.BENHNHAN_ID = bn.BENHNHAN_ID        inner join TM_DICHVU A on A.DICHVU_ID = dv.DICHVU_ID        inner join TM_NHOMDICHVU B on B.NHOMDICHVU_ID = A.NHOMDICHVU_ID        inner join TT_VIENPHI(NOLOCK) VP on VP.TIEPNHAN_ID = tn.TIEPNHAN_ID and VP.DICHVU_ID = dv.DICHVU_ID and VP.REF_ID = dv.DVYEUCAU_ID        left join TT_NOITRU_BENHAN (NOLOCK) BA on BA.TIEPNHAN_ID = tn.TIEPNHAN_ID AND dv.BENHAN_ID = BA.BENHAN_ID        inner join TM_GENDER GD on GD.ID = bn.GIOITINH        left join TT_NGOAITRU_KHAMBENH (NOLOCK) kbnt on kbnt.KHAMBENH_ID = dv.KHAMBENH_NGOAITRU_ID        inner join TM_DOITUONG dt on dt.DOITUONG_ID = tn.DOITUONG_ID        where        dv.DICHVU_ID IS NOT NULL        and tn.BENHVIEN_ID = '01819'        and HUYYEUCAU = 0        and dv.NGAYHENCLS is NULL         and           dv.NGAYYEUCAU >= '7/16/2020 12:00:00 AM'         and           dv.NGAYYEUCAU <= '7/16/2020 12:00:00 AM'         and           dv.NOITHUCHIEN_ID = 74          AND             (                         ((dv.TRANGTHAI_WFL = 'CHUAKETQUA' or (dv.TRANGTHAI = 'CHUAKETQUA' and dv.TRANGTHAI_WFL = 'HOANTHANH')) and (isnull(kbnt.HUONGGIAIQUYET_ID, 0) = 0)))            and (tn.TRANGTHAI != 'HOANTHANH')           and           (CASE WHEN Left(B.MANHOMDICHVU,2) = '03' THEN '02' ELSE Left(B.MANHOMDICHVU,2) END) = '04'                 ) lst                    where          lst.ROWNUMBER between 1 and 19                 order by SOHANGDOI, NGAYGIOYEUCAU asc]
2020-07-16 15:51:41,369 [1] DEBUG - Statement Id: [DAO00019_GetListDichVuDuocDongTien] PreparedStatement : [select * from        (        select COUNT(*) OVER() as TOTALROWS, ROW_NUMBER() OVER(order by tn.MAYTE, isnull(tn.SOTHUTU,'999999999')) as ROWNUMBER,        ISNULL(A.DUOC_ID, A.DICHVU_ID) as DICHVU_ID, ISNULL(B.TENDUOCDAYDU, C.TENDICHVU) as TENDICHVU,        (CASE WHEN A.DUOC_ID is null THEN E.NOITHUCHIEN_ID ELSE 0 END) as NOITHUCHIEN_ID,        0 as NOIYEUCAU_ID, 0 as NOIGIOITHIEU_ID, 0 as BACSICHIDINH_ID, isnull(E.NGAYTAO, E.NGAYCAPNHAT) as THOIGIANDKDICHVU,        tn.*, isnull(tn.SOTHUTU,'999999999') as SOHANGDOI, null as KHAN, '' as STATUS_CODE        from TT_VIENPHI A        left join TM_DUOC B on B.DUOC_ID = A.DUOC_ID and B.BENHVIEN_ID = '01819'        left join TM_DICHVU C on C.DICHVU_ID = A.DICHVU_ID and C.BENHVIEN_ID = '01819'        inner join        (        select A.TIEPNHAN_ID, A.SOTIEPNHAN, A.DOITUONG_ID, A.SOTHUTU, A.NGAYTIEPNHAN, B.*, C.TENDOITUONG from TT_TIEPNHAN A        inner join TT_BENHNHAN B on A.BENHNHAN_ID = B.BENHNHAN_ID        inner join TM_DOITUONG C on A.DOITUONG_ID = C.DOITUONG_ID        where A.TRANGTHAI in ('DATIEPNHAN', 'HOANTHANH') and A.BENHVIEN_ID = '01819'        ) tn on tn.TIEPNHAN_ID = A.TIEPNHAN_ID        left join TT_DVYEUCAU E on E.DVYEUCAU_ID = A.REF_ID        where        A.BENHAN_ID is null and        ((A.REF_TABLE = 'TT_DVYEUCAU' and E.HUYYEUCAU = '0') or (A.DUOC_ID is not null and A.DATHUCHIEN = '1')) and        ((A.DATHANHTOAN = '0' or A.DATHANHTOAN is null) and A.KHONGTHUTIEN = '0') and A.BENHVIEN_ID = '01819'           and               tn.NGAYTIEPNHAN >= '7/16/2020 12:00:00 AM'             and               tn.NGAYTIEPNHAN <= '7/16/2020 12:00:00 AM'                     ) lst                    where          lst.ROWNUMBER between 1 and 19                 order by MAYTE, SOHANGDOI asc]
2020-07-16 15:51:41,408 [1] DEBUG - Statement Id: [DAO00019_GetCountBenhNhanDichVuDuocDongTien] PreparedStatement : [select count(distinct tn.MAYTE) TOTAL_BENHNHAN        from TT_VIENPHI A        left join TM_DUOC B on B.DUOC_ID = A.DUOC_ID and B.BENHVIEN_ID = '01819'        left join TM_DICHVU C on C.DICHVU_ID = A.DICHVU_ID and C.BENHVIEN_ID = '01819'        inner join        (        select A.TIEPNHAN_ID, A.SOTIEPNHAN, A.DOITUONG_ID, A.SOTHUTU, A.NGAYTIEPNHAN, B.*, C.TENDOITUONG from TT_TIEPNHAN A        inner join TT_BENHNHAN B on A.BENHNHAN_ID = B.BENHNHAN_ID        inner join TM_DOITUONG C on A.DOITUONG_ID = C.DOITUONG_ID        where A.TRANGTHAI in ('DATIEPNHAN', 'HOANTHANH') and A.BENHVIEN_ID = '01819'        ) tn on tn.TIEPNHAN_ID = A.TIEPNHAN_ID        left join TT_DVYEUCAU E on E.DVYEUCAU_ID = A.REF_ID        where        A.BENHAN_ID is null and        ((A.REF_TABLE = 'TT_DVYEUCAU' and E.HUYYEUCAU = '0') or (A.DUOC_ID is not null and A.DATHUCHIEN = '1')) and        ((A.DATHANHTOAN = '0' or A.DATHANHTOAN is null) and A.KHONGTHUTIEN = '0') and A.BENHVIEN_ID = '01819'           and               tn.NGAYTIEPNHAN >= '7/16/2020 12:00:00 AM'             and               tn.NGAYTIEPNHAN <= '7/16/2020 12:00:00 AM']
2020-07-16 15:51:42,804 [1] DEBUG - Statement Id: [DAO00119_GetDanhsachHTTT] PreparedStatement : [select * from LST_DICTIONARY where DICTIONARY_TYPE_CODE = 'HinhThucThanhToan' and ENABLED = '1' and BENHVIEN_ID = '01819']
2020-07-16 15:51:42,845 [1] DEBUG - Statement Id: [DAO00021_GetListSoBienLai] PreparedStatement : [select            BLCT.BIENLAICHITIET_ID            ,BL.*                         ,BL.KYHIEU + '/' + SERIES AS 'KYHIEU_SOQUYEN'                         ,BLCT.START_NUMBER            ,BLCT.CURRENT_NUMBER            ,BLCT.HIEULUC            ,BLCT.NGUOISUDUNG_ID            from TT_BIENLAICHITIET BLCT            left join TT_BIENLAI BL on BL.BIENLAI_ID = BLCT.BIENLAI_ID            where            (bl.MAX_NUMBER > (select MAX(CURRENT_NUMBER) from TT_BIENLAICHITIET where BIENLAI_ID = BLCT.BIENLAI_ID) or BLCT.CURRENT_NUMBER is null)            and BLCT.HIEULUC = 1            and BLCT.NGUOISUDUNG_ID =   @param0             and BL.BENHVIEN_ID =  @param1                          order by BLCT.THOIGIANSUDUNG DESC]
2020-07-16 15:51:42,845 [1] DEBUG - Statement Id: [DAO00021_GetListSoBienLai] Parameters: [@param0=[NGUOISUDUNG_ID,1], @param1=[BENHVIEN_ID,01819]]
2020-07-16 15:51:42,845 [1] DEBUG - Statement Id: [DAO00021_GetListSoBienLai] Types: [@param0=[Int64, System.Int64], @param1=[String, System.String]]
2020-07-16 15:51:42,881 [1] DEBUG - Statement Id: [DAO00021_GetListSoBienLai] PreparedStatement : [select            BLCT.BIENLAICHITIET_ID            ,BL.*                         ,BL.KYHIEU + '/' + SERIES AS 'KYHIEU_SOQUYEN'                         ,BLCT.START_NUMBER            ,BLCT.CURRENT_NUMBER            ,BLCT.HIEULUC            ,BLCT.NGUOISUDUNG_ID            from TT_BIENLAICHITIET BLCT            left join TT_BIENLAI BL on BL.BIENLAI_ID = BLCT.BIENLAI_ID            where            (bl.MAX_NUMBER > (select MAX(CURRENT_NUMBER) from TT_BIENLAICHITIET where BIENLAI_ID = BLCT.BIENLAI_ID) or BLCT.CURRENT_NUMBER is null)            and BLCT.HIEULUC = 1            and BLCT.NGUOISUDUNG_ID =   @param0             and BL.BENHVIEN_ID =  @param1              and               BLCT.BIENLAICHITIET_ID = '2002'                         order by BLCT.THOIGIANSUDUNG DESC]
2020-07-16 15:51:42,881 [1] DEBUG - Statement Id: [DAO00021_GetListSoBienLai] Parameters: [@param0=[NGUOISUDUNG_ID,1], @param1=[BENHVIEN_ID,01819]]
2020-07-16 15:51:42,881 [1] DEBUG - Statement Id: [DAO00021_GetListSoBienLai] Types: [@param0=[Int64, System.Int64], @param1=[String, System.String]]
2020-07-16 15:51:42,908 [1] DEBUG - Statement Id: [DAO00119_GetDanhsachHTTT] PreparedStatement : [select * from LST_DICTIONARY where DICTIONARY_TYPE_CODE = 'HinhThucThanhToan' and ENABLED = '1' and BENHVIEN_ID = '01819']
2020-07-16 15:51:42,959 [1] DEBUG - Statement Id: [DAO00119_GetLichSuThanhToan] PreparedStatement : [select        SUM(THANHTOAN) AS TONGDATHANHTOAN, SUM(TAMUNG) AS TONGTAMUNG, SUM(HOANUNG) AS TONGHOANUNG,        SUM(MIENGIAM) AS TONGMIENGIAM, SUM(THATTHU) AS TONGTHATTHU, TIEPNHAN_ID        from (        select HD.TIEPNHAN_ID,        CASE WHEN LOAIHOADON = 'TU' then HD.GIATRIHOADON ELSE 0 END TAMUNG,        CASE WHEN LOAIHOADON = 'HU' then HD.GIATRIHOADON ELSE 0 END HOANUNG,        CASE WHEN LOAIHOADON = 'BL' then HD.GIATRIHOADON ELSE 0 END THANHTOAN,        0 MIENGIAM,        0 THATTHU        from TT_HOADON HD        where HD.DATHANHTOAN = '1' and HD.HUYHOADON = '0' and HD.HOANTRA = '0'        and HD.TIEPNHAN_ID = 8747        and HD.BENHVIEN_ID = '01819'          Union          select HD.TIEPNHAN_ID,        0 TAMUNG,        0 HOANUNG,        0 THANHTOAN,        SUM(hdct.MIENGIAM_GIATRI) AS MIENGIAM,        SUM(hdct.BENHNHAN_PHAITHANHTOAN) - SUM(hdct.GIATRI_HOADON_DATHANHTOAN) AS THATTHU        from TT_HOADON HD        join TT_HOADON_CHITIET_NGOAITRU hdct on HD.HOADON_ID = hdct.HOADON_ID        where HD.DATHANHTOAN = '1' and HD.HUYHOADON = '0' and HD.HOANTRA = '0'        and HD.TIEPNHAN_ID = 8747        and HD.BENHVIEN_ID = '01819'        group by TIEPNHAN_ID        ) temp        group by temp.TIEPNHAN_ID]
2020-07-16 15:51:42,993 [1] DEBUG - Statement Id: [DAO00021_GetListSoBienLai] PreparedStatement : [select            BLCT.BIENLAICHITIET_ID            ,BL.*                         ,BL.KYHIEU + '/' + SERIES AS 'KYHIEU_SOQUYEN'                         ,BLCT.START_NUMBER            ,BLCT.CURRENT_NUMBER            ,BLCT.HIEULUC            ,BLCT.NGUOISUDUNG_ID            from TT_BIENLAICHITIET BLCT            left join TT_BIENLAI BL on BL.BIENLAI_ID = BLCT.BIENLAI_ID            where            (bl.MAX_NUMBER > (select MAX(CURRENT_NUMBER) from TT_BIENLAICHITIET where BIENLAI_ID = BLCT.BIENLAI_ID) or BLCT.CURRENT_NUMBER is null)            and BLCT.HIEULUC = 1            and BLCT.NGUOISUDUNG_ID =   @param0             and BL.BENHVIEN_ID =  @param1                          order by BLCT.THOIGIANSUDUNG DESC]
2020-07-16 15:51:42,993 [1] DEBUG - Statement Id: [DAO00021_GetListSoBienLai] Parameters: [@param0=[NGUOISUDUNG_ID,1], @param1=[BENHVIEN_ID,01819]]
2020-07-16 15:51:42,993 [1] DEBUG - Statement Id: [DAO00021_GetListSoBienLai] Types: [@param0=[Int64, System.Int64], @param1=[String, System.String]]
2020-07-16 15:51:43,018 [1] DEBUG - Statement Id: [DAO00021_GetListSoBienLai] PreparedStatement : [select            BLCT.BIENLAICHITIET_ID            ,BL.*                         ,BL.KYHIEU + '/' + SERIES AS 'KYHIEU_SOQUYEN'                         ,BLCT.START_NUMBER            ,BLCT.CURRENT_NUMBER            ,BLCT.HIEULUC            ,BLCT.NGUOISUDUNG_ID            from TT_BIENLAICHITIET BLCT            left join TT_BIENLAI BL on BL.BIENLAI_ID = BLCT.BIENLAI_ID            where            (bl.MAX_NUMBER > (select MAX(CURRENT_NUMBER) from TT_BIENLAICHITIET where BIENLAI_ID = BLCT.BIENLAI_ID) or BLCT.CURRENT_NUMBER is null)            and BLCT.HIEULUC = 1            and BLCT.NGUOISUDUNG_ID =   @param0             and BL.BENHVIEN_ID =  @param1                          order by BLCT.THOIGIANSUDUNG DESC]
2020-07-16 15:51:43,018 [1] DEBUG - Statement Id: [DAO00021_GetListSoBienLai] Parameters: [@param0=[NGUOISUDUNG_ID,1], @param1=[BENHVIEN_ID,01819]]
2020-07-16 15:51:43,018 [1] DEBUG - Statement Id: [DAO00021_GetListSoBienLai] Types: [@param0=[Int64, System.Int64], @param1=[String, System.String]]
2020-07-16 15:51:43,044 [1] DEBUG - Statement Id: [DAO00021_GetListSoBienLai] PreparedStatement : [select            BLCT.BIENLAICHITIET_ID            ,BL.*                         ,BL.KYHIEU + '/' + SERIES AS 'KYHIEU_SOQUYEN'                         ,BLCT.START_NUMBER            ,BLCT.CURRENT_NUMBER            ,BLCT.HIEULUC            ,BLCT.NGUOISUDUNG_ID            from TT_BIENLAICHITIET BLCT            left join TT_BIENLAI BL on BL.BIENLAI_ID = BLCT.BIENLAI_ID            where            (bl.MAX_NUMBER > (select MAX(CURRENT_NUMBER) from TT_BIENLAICHITIET where BIENLAI_ID = BLCT.BIENLAI_ID) or BLCT.CURRENT_NUMBER is null)            and BLCT.HIEULUC = 1            and BLCT.NGUOISUDUNG_ID =   @param0             and BL.BENHVIEN_ID =  @param1              and               BLCT.BIENLAICHITIET_ID = '2002'                         order by BLCT.THOIGIANSUDUNG DESC]
2020-07-16 15:51:43,044 [1] DEBUG - Statement Id: [DAO00021_GetListSoBienLai] Parameters: [@param0=[NGUOISUDUNG_ID,1], @param1=[BENHVIEN_ID,01819]]
2020-07-16 15:51:43,044 [1] DEBUG - Statement Id: [DAO00021_GetListSoBienLai] Types: [@param0=[Int64, System.Int64], @param1=[String, System.String]]
2020-07-16 15:51:43,085 [1] DEBUG - Statement Id: [DAO00064_GetlistTT_TIEPNHAN_SOTHEBHYT] PreparedStatement : [select stbhyt.*, ba.SOBENHAN,        tn.SOTIEPNHAN, tn.LOAITHANHVIEN_ID, tn.THE_ID, tn.THANHVIEN_ID,        tn.SUDUNG_BHTN, tn.BAOLANH_VIENPHI, tn.VIP, tn.NGUOINUOCNGOAI, tn.NGOAIGIO        from TT_TIEPNHAN_SOTHEBHYT stbhyt        left join TT_TIEPNHAN tn on tn.TIEPNHAN_ID = stbhyt.TIEPNHAN_ID        left join TT_NOITRU_BENHAN ba on ba.TIEPNHAN_ID = stbhyt.TIEPNHAN_ID        where        stbhyt.TIEPNHAN_ID = '8747' and isnull(stbhyt.KHONGSUDUNG, '0') = '0']
2020-07-16 15:51:43,110 [1] DEBUG - Statement Id: [DAO00064_GetListVienPhiByTiepNnan] PreparedStatement : [select distinct        B.DOITUONG_ID, B.NGAYMIENDONGCHITRA, B.BENHNHAN_ID as TIEPNHAN_BENHNHAN_ID, B.TRAITUYEN,        B.BHYTTREN3NAM as TREN3NAM, B.BHYTTREN5NAM as TREN5NAM, B.SOTIEPNHAN, B.SOBENHAN,        B.LOAITHANHVIEN_ID, B.SUDUNG_BHTN, B.THE_ID, B.THANHVIEN_ID, B.BAOLANH_VIENPHI, B.VIP, B.NGUOINUOCNGOAI,        C.GIATRIMIENGIAM as GIATRIMIENGIAM, D.GIATRIMIENGIAM as GIATRIMIENGIAM_BHTN, E.GIATRIMIENGIAM as GIATRIMIENGIAM_THANHVIEN,        F.GIATRIMIENGIAM as GIATRIMIENGIAM_CONGTY, DVYC.THE_ID as DVDUNGTHE, DVYC.TRANGTHAI as TRANGTHAIDICHVU, ndv.MANHOMDICHVU,        A.* from TT_VIENPHI A        left join        (select B.*, C.SOBENHAN, C.BENHAN_ID        from TT_TIEPNHAN B        left join TT_NOITRU_BENHAN C on B.TIEPNHAN_ID = C.TIEPNHAN_ID                 where B.TIEPNHAN_ID = '8747') B on B.TIEPNHAN_ID = A.TIEPNHAN_ID        left join (select sum(GIATRIMIENGIAM) as GIATRIMIENGIAM, VIENPHI_ID, REF_TABLE        from TT_MIENGIAM_CHITIET        where REF_TABLE = 'TT_MIENGIAM'        and exists (select MIENGIAM_ID from TT_MIENGIAM where TT_MIENGIAM_CHITIET.MIENGIAM_ID = MIENGIAM_ID and TINHTRANG = 1 and TIEPNHAN_ID = '8747')        group by VIENPHI_ID, REF_TABLE) C on C.REF_TABLE = 'TT_MIENGIAM' and C.VIENPHI_ID = A.VIENPHI_ID        left join (select sum(GIATRIMIENGIAM) as GIATRIMIENGIAM, VIENPHI_ID, REF_TABLE        from TT_MIENGIAM_CHITIET        where REF_TABLE = 'TT_MIENGIAM_BHTN'        and exists (select MIENGIAM_BHTN_ID from TT_MIENGIAM_BHTN where TT_MIENGIAM_CHITIET.MIENGIAM_ID = MIENGIAM_BHTN_ID and  TINHTRANG = 1 and TIEPNHAN_ID = '8747')        group by VIENPHI_ID, REF_TABLE) D on D.REF_TABLE = 'TT_MIENGIAM_BHTN' and D.VIENPHI_ID = A.VIENPHI_ID        left join (select sum(GIATRIMIENGIAM) as GIATRIMIENGIAM, VIENPHI_ID, REF_TABLE        from TT_MIENGIAM_CHITIET        where REF_TABLE = 'TT_MIENGIAM_THANHVIEN'        and exists (select MIENGIAM_THANHVIEN_ID from TT_MIENGIAM_THANHVIEN where TT_MIENGIAM_CHITIET.MIENGIAM_ID = MIENGIAM_THANHVIEN_ID and TINHTRANG = 1 and TIEPNHAN_ID = '8747')        group by VIENPHI_ID, REF_TABLE) E on E.REF_TABLE = 'TT_MIENGIAM_THANHVIEN' and E.VIENPHI_ID = A.VIENPHI_ID        left join (select sum(GIATRIMIENGIAM) as GIATRIMIENGIAM, VIENPHI_ID, REF_TABLE        from TT_MIENGIAM_CHITIET        where REF_TABLE = 'TT_MIENGIAM_CONGTY'        and exists (select MIENGIAM_CONGTY_ID from TT_MIENGIAM_CONGTY where TT_MIENGIAM_CHITIET.MIENGIAM_ID = MIENGIAM_CONGTY_ID and TINHTRANG = 1 and TIEPNHAN_ID = '8747')        group by VIENPHI_ID, REF_TABLE) F on F.REF_TABLE = 'TT_MIENGIAM_CONGTY' and F.VIENPHI_ID = A.VIENPHI_ID        left join TT_DVYEUCAU DVYC on DVYC.DVYEUCAU_ID = A.REF_ID and A.REF_TABLE = 'TT_DVYEUCAU'        left join TM_DICHVU DV on DVYC.DICHVU_ID = DV.DICHVU_ID and A.REF_TABLE = 'TT_DVYEUCAU'        left join TM_NHOMDICHVU ndv on ndv.NHOMDICHVU_ID = DV.NHOMDICHVU_ID and A.REF_TABLE = 'TT_DVYEUCAU'        where        A.TIEPNHAN_ID = '8747' and ((DVYC.HUYYEUCAU = '0' and A.DICHVU_ID is not null)        or A.DUOC_ID is not null or A.REF_TABLE = 'TT_NUT_XACNHANSUATAN_CHITIET')        and A.ACTIVE = '1'                 and A.BENHVIEN_ID = '01819'        order by A.VIENPHI_ID]
2020-07-16 15:51:43,136 [1] DEBUG - Statement Id: [DAO00006_GetListDuocTyle] PreparedStatement : [select DUOC_ID, DOITUONG_ID, (TYLE/100) as TYLE, DONGIA MUCTRAN_THANHTOAN from TM_DOITUONG_GIADUOC_TYLE            where            BENHVIEN_ID = '01819'            and DOITUONG_ID = '0']
2020-07-16 15:51:43,160 [1] DEBUG - Statement Id: [DAO00027_GetListTuongTrinhDichVuPhauThuatCuaTiepNhan] PreparedStatement : [declare @ManhomDSA varchar(10);        declare @PhanLoaiNhomDV varchar(20) = '05';        select top 1  @ManhomDSA = VALUE from TM_SYS_APPSETTINGS where CODE = 'MANHOM_DICHVU_DSA'        if (@ManhomDSA is not null) set @PhanLoaiNhomDV += ',' + @ManhomDSA        select distinct ptyc.*        from TT_PHAUTHUAT_YEUCAU ptyc        inner join TM_DICHVU dv on dv.DICHVU_ID = ptyc.DICHVU_ID        inner join TM_NHOMDICHVU ndv on ndv.NHOMDICHVU_ID = dv.NHOMDICHVU_ID        inner join TT_PHAUTHUAT pt on pt.PHAUTHUAT_ID = ptyc.PHAUTHUAT_ID        where        pt.TIEPNHAN_ID = 8747        and (left(ndv.MANHOMDICHVU, 2) in (select * from STRING_SPLIT(@PhanLoaiNhomDV,',')) or ndv.MANHOMDICHVU in (select * from STRING_SPLIT(@PhanLoaiNhomDV,',')))]
2020-07-16 15:51:43,187 [1] DEBUG - Statement Id: [DAO00006_GetList] PreparedStatement : [select dv.*, loaiDV.MALOAIDICHVU, captren.NHOMDICHVU_ID as NHOMDICHVU_CAPTREN_ID, captren.TENNHOMDICHVU as NHOMDICHVU_CAPTREN,              nhom_dv.TENNHOMDICHVU as TENNHOMDICHVU, nhom_dv.MANHOMDICHVU,              case when dv.ATTRIBUTE5 is null then 'TT' else 'KTC' end as LOAI_CHIPHI              from TM_DICHVU as dv              left join TM_NHOMDICHVU as nhom_dv on nhom_dv.NHOMDICHVU_ID = dv.NHOMDICHVU_ID and nhom_dv.BENHVIEN_ID = '01819'              left join TM_NHOMDICHVU as captren on nhom_dv.CAPTREN_ID = captren.NHOMDICHVU_ID and captren.BENHVIEN_ID = '01819'              left join TM_LOAIDICHVU loaiDV on nhom_dv.LOAIDICHVU_ID = loaiDV.LOAIDICHVU_ID and loaiDV.BENHVIEN_ID = '01819'              where nhom_dv.TAMNGUNG = '0' and dv.BENHVIEN_ID = '01819'              and dv.TAMNGUNG = '0'               AND                   loaiDV.MALOAIDICHVU = 'KhamBenh']
2020-07-16 15:51:43,263 [1] DEBUG - Statement Id: [DAO00023_UpdateNhieuVP] PreparedStatement : [declare @jsonVienPhi nvarchar(max) = N'[{"VIENPHI_ID":16000,"TIEPNHAN_ID":8747,"DICHVU_ID":3,"BENHAN_ID":0,"SOLUONG":1.0000,"DONGIA_DOANHTHU":38700.0000,"THANHTIEN_DOANHTHU":38700.00,"BHYT_TL":0.0,"BHYT_DONGIA":0.0,"BHYT_THANHTIEN":0.0,"BHYT_DONGIA_CONGKHAM_DAU":0.0,"BHYT_CONGKHAM_DAU_TYLE":0.0,"BHYT_DONGIA_CHITRA":0.0,"BHYT_THANHTIEN_CHITRA":0.0,"BENHNHAN_PHAITHANHTOAN":38700.00,"GIATRI_HOADON":0.0,"GIATRI_HOADON_DATHANHTOAN":0.0,"GIATRI_BIENLAI":0.0,"GIATRI_BIENLAI_DATHANHTOAN":0.0,"GIATRI_BENHNHAN_DATHANHTOAN":0.0,"DATHUCHIEN":"0","KHONGTHUTIEN":"0","BHYTDONGTIEN":"0","DICHVU_TL":1.0,"BHYT_DONGIA_DONGCT_DAU":0.0,"SOBHYT":null,"SOBHYT_HUONG_ID":8755,"GIATRIMIENGIAM":0.0,"GIATRIMIENGIAM_BHTN":0.0,"GIATRIMIENGIAM_THANHVIEN":0.0,"GIATRIMIENGIAM_CONGTY":0.0,"BHYT_CK2_KHONGTHANHTOAN":false,"SOLONHAP_ID":null,"DUOC_MUCTRAN_THANHTOAN":0.0,"DUOC_TYLE":0.0000}]';        begin        UPDATE TT_VIENPHI        SET        SOLUONG = json.SOLUONG,        DONGIA_DOANHTHU = json.DONGIA_DOANHTHU,        THANHTIEN_DOANHTHU = json.THANHTIEN_DOANHTHU,        BHYT_TL = json.BHYT_TL,        BHYT_DONGIA = json.BHYT_DONGIA,        BHYT_THANHTIEN = json.BHYT_THANHTIEN,        BHYT_DONGIA_CONGKHAM_DAU = json.BHYT_DONGIA_CONGKHAM_DAU,        BHYT_CONGKHAM_DAU_TYLE = json.BHYT_CONGKHAM_DAU_TYLE,        BHYT_DONGIA_CHITRA = json.BHYT_DONGIA_CHITRA,        BHYT_THANHTIEN_CHITRA = json.BHYT_THANHTIEN_CHITRA,        BENHNHAN_PHAITHANHTOAN = json.BENHNHAN_PHAITHANHTOAN,        GIATRI_HOADON = json.GIATRI_HOADON,        GIATRI_BIENLAI = json.GIATRI_BIENLAI,        DATHUCHIEN = json.DATHUCHIEN,        DICHVU_TL = json.DICHVU_TL,        BHYT_DONGIA_DONGCT_DAU = json.BHYT_DONGIA_DONGCT_DAU,        SOLONHAP_ID = json.SOLONHAP_ID,        DUOC_TYLE = json.DUOC_TYLE,        DUOC_MUCTRAN_THANHTOAN = json.DUOC_MUCTRAN_THANHTOAN,        NGAYCAPNHAT = GETDATE()        FROM OPENJSON (@jsonVienPhi)        WITH (        VIENPHI_ID int,        SOLUONG numeric(25, 4),        DONGIA_DOANHTHU numeric(25, 4),        THANHTIEN_DOANHTHU numeric(25, 4),        BHYT_TL numeric(25, 4),        BHYT_DONGIA numeric(25, 4),        BHYT_THANHTIEN numeric(25, 4),        BHYT_DONGIA_CONGKHAM_DAU numeric(25, 4),        BHYT_CONGKHAM_DAU_TYLE numeric(25, 4),        BHYT_DONGIA_CHITRA numeric(25, 4),        BHYT_THANHTIEN_CHITRA numeric(25, 4),        BENHNHAN_PHAITHANHTOAN numeric(25, 4),        GIATRI_HOADON numeric(25, 4),        GIATRI_BIENLAI numeric(25, 4),        DATHUCHIEN char(1),        KHONGTHUTIEN char(1),        BHYTDONGTIEN char(1),        DICHVU_TL numeric(25, 4),        BHYT_DONGIA_DONGCT_DAU numeric(25, 4),        SOLONHAP_ID int,        DUOC_TYLE numeric(25, 4),        DUOC_MUCTRAN_THANHTOAN numeric(25, 4))  json        WHERE TT_VIENPHI.VIENPHI_ID = json.VIENPHI_ID and json.DONGIA_DOANHTHU > 0                  insert into TT_TINH_VIENPHI_LOG        SELECT json.VIENPHI_ID, json.TIEPNHAN_ID, json.BENHAN_ID, json.SOLUONG, json.BHYT_TL, json.DONGIA_DOANHTHU,        json.THANHTIEN_DOANHTHU, json.BHYT_DONGIA, json.BHYT_THANHTIEN, json.BHYT_DONGIA_CHITRA, json.BHYT_THANHTIEN_CHITRA, json.BENHNHAN_PHAITHANHTOAN,        json.SOBHYT_HUONG_ID, json.SOBHYT, GETDATE(), -1, '01819'        FROM OPENJSON(@jsonVienPhi)        WITH (        VIENPHI_ID int,        TIEPNHAN_ID int,        BENHAN_ID int,        SOLUONG numeric(25, 4),        DONGIA_DOANHTHU numeric(25, 4),        THANHTIEN_DOANHTHU numeric(25, 4),        BHYT_TL numeric(25, 4),        BHYT_DONGIA numeric(25, 4),        BHYT_THANHTIEN numeric(25, 4),        BHYT_DONGIA_CHITRA numeric(25, 4),        BHYT_THANHTIEN_CHITRA numeric(25, 4),        BENHNHAN_PHAITHANHTOAN numeric(25, 4),        SOBHYT_HUONG_ID int,        SOBHYT nvarchar(30)) json        end]
2020-07-16 15:51:43,300 [1] DEBUG - Statement Id: [DAO00067_UpdateDataVienPhiDongiaBHYT] PreparedStatement : [update TT_VIENPHI          set BHYT_DONGIA_CHITRA = 0, BHYT_THANHTIEN = 0, BHYT_THANHTIEN_CHITRA = 0          where          TIEPNHAN_ID = 8747 and BHYT_DONGIA = 0          and (BHYT_DONGIA_CHITRA > 0 or BHYT_THANHTIEN > 0 or BHYT_THANHTIEN_CHITRA > 0)]
2020-07-16 15:51:43,328 [1] DEBUG - Statement Id: [DAO00067_CapnhatDataVienphiKhiHuyThanhtoanHoadon] PreparedStatement : [update TT_VIENPHI        set TT_VIENPHI.HOADON_ID = hdct.HOADON_ID, TT_VIENPHI.GIATRI_BENHNHAN_DATHANHTOAN = TT_VIENPHI.GIATRI_BENHNHAN_DATHANHTOAN + hdct.GIATRI_BENHNHAN_DATHANHTOAN        from (select CT.HOADON_ID, CT.VIENPHI_ID, CT.GIATRI_BENHNHAN_DATHANHTOAN        from TT_HOADON_CHITIET_NGOAITRU CT        join TT_HOADON HD on HD.HOADON_ID = CT.HOADON_ID        join TT_VIENPHI vp on vp.VIENPHI_ID = ct.VIENPHI_ID        where HD.DATHANHTOAN = 1 and HD.HUYHOADON = 0 and HD.HOANTRA = 0 and vp.TIEPNHAN_ID =  @param0 ) hdct        where        TT_VIENPHI.VIENPHI_ID = hdct.VIENPHI_ID and TT_VIENPHI.HOADON_ID is null and isnull(TT_VIENPHI.GIATRI_BENHNHAN_DATHANHTOAN,0) = 0        and TT_VIENPHI.TIEPNHAN_ID =  @param0           update TT_VIENPHI        set TT_VIENPHI.HOADON_ID = null, TT_VIENPHI.GIATRI_BENHNHAN_DATHANHTOAN = TT_VIENPHI.GIATRI_BENHNHAN_DATHANHTOAN - hdct.GIATRI_BENHNHAN_DATHANHTOAN,        TT_VIENPHI.DATHANHTOAN = '0'        from (select CT.HOADON_ID, CT.VIENPHI_ID, CT.GIATRI_BENHNHAN_DATHANHTOAN        from TT_HOADON_CHITIET_NGOAITRU CT        join TT_HOADON HD on HD.HOADON_ID = CT.HOADON_ID        join TT_VIENPHI vp on vp.VIENPHI_ID = ct.VIENPHI_ID and vp.HOADON_ID = ct.HOADON_ID        where HD.DATHANHTOAN = 0 and (HD.HUYHOADON = 1 or HD.HOANTRA = 1) and vp.TIEPNHAN_ID =  @param0 ) hdct        where        TT_VIENPHI.VIENPHI_ID = hdct.VIENPHI_ID and TT_VIENPHI.HOADON_ID = hdct.HOADON_ID        and TT_VIENPHI.TIEPNHAN_ID =  @param0]
2020-07-16 15:51:43,328 [1] DEBUG - Statement Id: [DAO00067_CapnhatDataVienphiKhiHuyThanhtoanHoadon] Parameters: [@param0=[TIEPNHAN_ID,8747]]
2020-07-16 15:51:43,328 [1] DEBUG - Statement Id: [DAO00067_CapnhatDataVienphiKhiHuyThanhtoanHoadon] Types: [@param0=[Int64, System.Int64]]
2020-07-16 15:51:43,355 [1] DEBUG - Statement Id: [DAO00119_TT_VIENPHI_GetList_TiepNhanPhaiThanhToan] PreparedStatement : [select distinct  a.*, b.GIATRIMIENGIAM_BH, c.GIATRIMIENGIAM_BHTN, f.GIATRIMIENGIAM_THANHVIEN, g.GIATRIMIENGIAM_CTCT,        isnull(dv.TENDICHVU, dc.TENDUOCDAYDU) NOIDUNG, isnull(dv.MADICHVU, dc.MADUOC) MADICHVU, dv.NORESULT, dc.DONVITINH, ld.MALOAIDUOC, dc.BHYT DUOC_BHYT, ld.LOAIVATTU_ID, ndv.MANHOMDICHVU        from        (select VP.*, isnull(c.TRANGTHAI, '') TRANGTHAI, c.THUTIENSAU, c.NOITHUCHIEN_ID,        CASE        when REF_TABLE = 'TT_NGOAITRU_TOATHUOC' then ntkb.PHONGBAN_ID        when REF_TABLE = 'TT_CLSKETQUA_VTYT' then clsvtyt.PHONGBAN_ID        when REF_TABLE = 'TT_NGOAITRU_KHAMBENH_VTYT' then kbd.PHONGBAN_ID        ELSE        c.NOIYEUCAU_ID        END NOIYEUCAU_ID,        CASE        when REF_TABLE = 'TT_NGOAITRU_TOATHUOC' then ngtd.KHOXUAT_ID        when REF_TABLE = 'TT_CLSKETQUA_VTYT' then clsvtyt.KHOTAO_ID        when REF_TABLE = 'TT_NGOAITRU_KHAMBENH_VTYT' then kbd.KHOTAO_ID        ELSE null        END KHODUOC_ID          from TT_VIENPHI VP        left join TT_DVYEUCAU c on c.DVYEUCAU_ID = VP.REF_ID  and vp.REF_TABLE = 'TT_DVYEUCAU'        left join TT_NGOAITRU_TOATHUOC nttt on nttt.TOATHUOC_ID = vp.REF_ID and vp.REF_TABLE = 'TT_NGOAITRU_TOATHUOC'        left join TT_NGOAITRU_KHAMBENH_TOATHUOC ngtd on ngtd.KHAMBENH_TOATHUOC_ID = nttt.KHAMBENH_TOATHUOC_ID        left join TT_CLSKETQUA_VTYT clsvtyt on clsvtyt.CLSKETQUA_ID = vp.REF_ID and REF_TABLE = 'TT_CLSKETQUA_VTYT'        left join TT_NGOAITRU_KHAMBENH_VTYT kbd on kbd.KHAMBENH_VTYT_ID = vp.REF_ID and REF_TABLE = 'TT_NGOAITRU_KHAMBENH_VTYT'        left join TT_NGOAITRU_KHAMBENH ntkb on ntkb.KHAMBENH_ID = vp.KHAMBENH_ID and REF_TABLE = 'TT_NGOAITRU_TOATHUOC'          where Vp.TIEPNHAN_ID = '8747' and Vp.ACTIVE = '1' and ((c.HUYYEUCAU != '1' and vp.DICHVU_ID is not null) or (vp.DUOC_ID is not null)) and        ((vp.DATHANHTOAN = '0') or (vp.BENHNHAN_PHAITHANHTOAN > vp.GIATRI_BENHNHAN_DATHANHTOAN and vp.DATHANHTOAN = '1')) and c.DANGKY_CHITIET_ID is null        and vp.REF_TABLE != 'TT_MAU_CHUNGTU_CHITIET'        and vp.REF_TABLE != 'TT_DUOC_CHUNGTU_CHITIET'          AND             VP.KHONGTHUTIEN != '1'                   ) a        left join TM_DUOC dc on a.DUOC_ID = dc.DUOC_ID        left join TM_LOAIDUOC ld on dc.LOAIDUOC_ID = ld.LOAIDUOC_ID        left join TM_DICHVU dv on a.DICHVU_ID = dv.DICHVU_ID and a.REF_TABLE = 'TT_DVYEUCAU'        left join TM_NHOMDICHVU ndv on ndv.NHOMDICHVU_ID = dv.NHOMDICHVU_ID        left join (select VIENPHI_ID,        sum(MGCT.GIATRIMIENGIAM) AS GIATRIMIENGIAM_BH from TT_MIENGIAM MG        INNER JOIN TT_MIENGIAM_CHITIET MGCT ON MG.MIENGIAM_ID = MGCT.MIENGIAM_ID        where MG.TIEPNHAN_ID= '8747' and MGCT.REF_TABLE = 'TT_MIENGIAM' and MG.TINHTRANG = 1 group by VIENPHI_ID        ) b on a.VIENPHI_ID = b.VIENPHI_ID          left join (select VIENPHI_ID, sum(MGCT.GIATRIMIENGIAM) AS GIATRIMIENGIAM_BHTN        from TT_MIENGIAM_BHTN MG        INNER JOIN TT_MIENGIAM_CHITIET MGCT ON MG.MIENGIAM_BHTN_ID = MGCT.MIENGIAM_ID        where  MG.TIEPNHAN_ID= '8747' and MGCT.REF_TABLE = 'TT_MIENGIAM_BHTN' and MG.TINHTRANG = 1 group by VIENPHI_ID        )c on a.VIENPHI_ID = c.VIENPHI_ID          left join (select VIENPHI_ID, sum(MGCT.GIATRIMIENGIAM) AS GIATRIMIENGIAM_THANHVIEN        from TT_MIENGIAM_THANHVIEN MG        INNER JOIN TT_MIENGIAM_CHITIET MGCT ON MG.MIENGIAM_THANHVIEN_ID = MGCT.MIENGIAM_ID        where MG.TIEPNHAN_ID= '8747' and MGCT.REF_TABLE = 'TT_MIENGIAM_THANHVIEN' and MG.TINHTRANG = 1 group by VIENPHI_ID        )f on a.VIENPHI_ID = f.VIENPHI_ID          left join(select VIENPHI_ID, sum(MGCT.GIATRIMIENGIAM) AS GIATRIMIENGIAM_CTCT        from TT_MIENGIAM_CONGTY MG        INNER JOIN TT_MIENGIAM_CHITIET MGCT ON MG.MIENGIAM_CONGTY_ID = MGCT.MIENGIAM_ID        where MG.TIEPNHAN_ID= '8747' and MGCT.REF_TABLE = 'TT_MIENGIAM_CONGTY' and MG.TINHTRANG = 1 group by VIENPHI_ID        )g on a.VIENPHI_ID = g.VIENPHI_ID]
2020-07-16 15:51:43,383 [1] DEBUG - Statement Id: [DAO00330_TT_VIENPHI_GetList_TiepNhanPhaiThanhToan] PreparedStatement : [select distinct  a.*, b.GIATRIMIENGIAM_BH, c.GIATRIMIENGIAM_BHTN, f.GIATRIMIENGIAM_THANHVIEN, g.GIATRIMIENGIAM_CTCT        from        (select VP.*,NULL AS NOITHUCHIEN_ID, DK.NOICHIDINH_ID as NOIYEUCAU_ID, NULL AS THUTIENSAU, isnull(DK.TRANGTHAI, '') TRANGTHAI,        M.TENMAU AS NOIDUNG, M.MAMAU AS MADICHVU, NULL AS NORESULT, DVT.TENDONVITINH AS DONVITINH, LM.MALOAIMAU AS MALOAIDUOC, M.BHYT AS DUOC_BHYT, 'M' AS LOAIVATTU_ID, NM.TENNHOMMAU AS MANHOMDICHVU        from TT_VIENPHI VP        INNER JOIN TT_MAU_CHUNGTU_CHITIET CT ON VP.REF_ID=CT.CHUNGTUCHITIET_ID AND VP.REF_TABLE='TT_MAU_CHUNGTU_CHITIET' AND CT.BENHVIEN_ID='01819'        INNER JOIN TT_MAU_CHUNGTU CTU ON CT.CHUNGTU_ID=CTU.CHUNGTU_ID AND CTU.CHUNGTULIENQUAN_ID IS NULL        INNER join TM_MAU M on CT.MAU_ID = M.MAU_ID        LEFT JOIN TM_MAU_DONVITINH DVT ON M.DONVITINH_ID = DVT.DONVITINH_ID        LEFT JOIN TT_MAU_DANGKYMAU_CHITIET DKCT ON DKCT.CHUNGTU_ID = CTU.CHUNGTU_ID AND DKCT.BENHVIEN_ID='01819'        LEFT JOIN TT_MAU_DANGKYMAU DK ON DK.DANGKYMAU_ID = DKCT.DANGKYMAU_ID        LEFT JOIN TM_MAU_LOAIMAU LM ON LM.LOAIMAU_ID = M.LOAIMAU_ID        LEFT JOIN TM_MAU_NHOMMAU NM ON NM.NHOMMAU_ID = LM.NHOMMAU_ID        where Vp.TIEPNHAN_ID = '8747' and Vp.ACTIVE = '1' and vp.DUOC_ID is not null and        ((vp.DATHANHTOAN = '0') or (vp.BENHNHAN_PHAITHANHTOAN > vp.GIATRI_BENHNHAN_DATHANHTOAN and vp.DATHANHTOAN = '1'))   AND             VP.KHONGTHUTIEN != '1'                   ) a        left join (select VIENPHI_ID,        sum(MGCT.GIATRIMIENGIAM) AS GIATRIMIENGIAM_BH from TT_MIENGIAM MG        INNER JOIN TT_MIENGIAM_CHITIET MGCT ON MG.MIENGIAM_ID = MGCT.MIENGIAM_ID        where MG.TIEPNHAN_ID= '8747' and MGCT.REF_TABLE = 'TT_MIENGIAM' and MG.TINHTRANG = 1 group by VIENPHI_ID        ) b on a.VIENPHI_ID = b.VIENPHI_ID          left join (select VIENPHI_ID, sum(MGCT.GIATRIMIENGIAM) AS GIATRIMIENGIAM_BHTN        from TT_MIENGIAM_BHTN MG        INNER JOIN TT_MIENGIAM_CHITIET MGCT ON MG.MIENGIAM_BHTN_ID = MGCT.MIENGIAM_ID        where  MG.TIEPNHAN_ID= '8747' and MGCT.REF_TABLE = 'TT_MIENGIAM_BHTN' and MG.TINHTRANG = 1 group by VIENPHI_ID        )c on a.VIENPHI_ID = c.VIENPHI_ID          left join (select VIENPHI_ID, sum(MGCT.GIATRIMIENGIAM) AS GIATRIMIENGIAM_THANHVIEN        from TT_MIENGIAM_THANHVIEN MG        INNER JOIN TT_MIENGIAM_CHITIET MGCT ON MG.MIENGIAM_THANHVIEN_ID = MGCT.MIENGIAM_ID        where MG.TIEPNHAN_ID= '8747' and MGCT.REF_TABLE = 'TT_MIENGIAM_THANHVIEN' and MG.TINHTRANG = 1 group by VIENPHI_ID        )f on a.VIENPHI_ID = f.VIENPHI_ID          left join(select VIENPHI_ID, sum(MGCT.GIATRIMIENGIAM) AS GIATRIMIENGIAM_CTCT        from TT_MIENGIAM_CONGTY MG        INNER JOIN TT_MIENGIAM_CHITIET MGCT ON MG.MIENGIAM_CONGTY_ID = MGCT.MIENGIAM_ID        where MG.TIEPNHAN_ID= '8747' and MGCT.REF_TABLE = 'TT_MIENGIAM_CONGTY' and MG.TINHTRANG = 1 group by VIENPHI_ID        )g on a.VIENPHI_ID = g.VIENPHI_ID]
2020-07-16 15:51:43,413 [1] DEBUG - Statement Id: [DAO00119_GetDataTamUng_HoaUng] PreparedStatement : [select SUM(TAMUNG) AS TONGTIEN_TU, SUM(HOANUNG) AS TONGTIEN_HU, TIEPNHAN_ID        from (        select HD.TIEPNHAN_ID,        CASE WHEN LOAIHOADON = 'TU' then HD.GIATRIHOADON ELSE 0 END TAMUNG,        CASE WHEN LOAIHOADON = 'HU' then HD.GIATRIHOADON ELSE 0 END HOANUNG        from TT_HOADON HD        where HD.DATHANHTOAN = '1' and HD.HUYHOADON = '0' and HD.HOANTRA = '0'        and HD.TIEPNHAN_ID = 8747        and HD.BENHVIEN_ID = '01819'        ) temp        group by temp.TIEPNHAN_ID]
2020-07-16 15:51:43,439 [1] DEBUG - Statement Id: [DAO00119_TT_VIENPHI_GetList_TiepNhanPhaiThanhToan] PreparedStatement : [select distinct  a.*, b.GIATRIMIENGIAM_BH, c.GIATRIMIENGIAM_BHTN, f.GIATRIMIENGIAM_THANHVIEN, g.GIATRIMIENGIAM_CTCT,        isnull(dv.TENDICHVU, dc.TENDUOCDAYDU) NOIDUNG, isnull(dv.MADICHVU, dc.MADUOC) MADICHVU, dv.NORESULT, dc.DONVITINH, ld.MALOAIDUOC, dc.BHYT DUOC_BHYT, ld.LOAIVATTU_ID, ndv.MANHOMDICHVU        from        (select VP.*, isnull(c.TRANGTHAI, '') TRANGTHAI, c.THUTIENSAU, c.NOITHUCHIEN_ID,        CASE        when REF_TABLE = 'TT_NGOAITRU_TOATHUOC' then ntkb.PHONGBAN_ID        when REF_TABLE = 'TT_CLSKETQUA_VTYT' then clsvtyt.PHONGBAN_ID        when REF_TABLE = 'TT_NGOAITRU_KHAMBENH_VTYT' then kbd.PHONGBAN_ID        ELSE        c.NOIYEUCAU_ID        END NOIYEUCAU_ID,        CASE        when REF_TABLE = 'TT_NGOAITRU_TOATHUOC' then ngtd.KHOXUAT_ID        when REF_TABLE = 'TT_CLSKETQUA_VTYT' then clsvtyt.KHOTAO_ID        when REF_TABLE = 'TT_NGOAITRU_KHAMBENH_VTYT' then kbd.KHOTAO_ID        ELSE null        END KHODUOC_ID          from TT_VIENPHI VP        left join TT_DVYEUCAU c on c.DVYEUCAU_ID = VP.REF_ID  and vp.REF_TABLE = 'TT_DVYEUCAU'        left join TT_NGOAITRU_TOATHUOC nttt on nttt.TOATHUOC_ID = vp.REF_ID and vp.REF_TABLE = 'TT_NGOAITRU_TOATHUOC'        left join TT_NGOAITRU_KHAMBENH_TOATHUOC ngtd on ngtd.KHAMBENH_TOATHUOC_ID = nttt.KHAMBENH_TOATHUOC_ID        left join TT_CLSKETQUA_VTYT clsvtyt on clsvtyt.CLSKETQUA_ID = vp.REF_ID and REF_TABLE = 'TT_CLSKETQUA_VTYT'        left join TT_NGOAITRU_KHAMBENH_VTYT kbd on kbd.KHAMBENH_VTYT_ID = vp.REF_ID and REF_TABLE = 'TT_NGOAITRU_KHAMBENH_VTYT'        left join TT_NGOAITRU_KHAMBENH ntkb on ntkb.KHAMBENH_ID = vp.KHAMBENH_ID and REF_TABLE = 'TT_NGOAITRU_TOATHUOC'          where Vp.TIEPNHAN_ID = '8747' and Vp.ACTIVE = '1' and ((c.HUYYEUCAU != '1' and vp.DICHVU_ID is not null) or (vp.DUOC_ID is not null)) and        ((vp.DATHANHTOAN = '0') or (vp.BENHNHAN_PHAITHANHTOAN > vp.GIATRI_BENHNHAN_DATHANHTOAN and vp.DATHANHTOAN = '1')) and c.DANGKY_CHITIET_ID is null        and vp.REF_TABLE != 'TT_MAU_CHUNGTU_CHITIET'        and vp.REF_TABLE != 'TT_DUOC_CHUNGTU_CHITIET'          AND             VP.KHONGTHUTIEN != '1'                   ) a        left join TM_DUOC dc on a.DUOC_ID = dc.DUOC_ID        left join TM_LOAIDUOC ld on dc.LOAIDUOC_ID = ld.LOAIDUOC_ID        left join TM_DICHVU dv on a.DICHVU_ID = dv.DICHVU_ID and a.REF_TABLE = 'TT_DVYEUCAU'        left join TM_NHOMDICHVU ndv on ndv.NHOMDICHVU_ID = dv.NHOMDICHVU_ID        left join (select VIENPHI_ID,        sum(MGCT.GIATRIMIENGIAM) AS GIATRIMIENGIAM_BH from TT_MIENGIAM MG        INNER JOIN TT_MIENGIAM_CHITIET MGCT ON MG.MIENGIAM_ID = MGCT.MIENGIAM_ID        where MG.TIEPNHAN_ID= '8747' and MGCT.REF_TABLE = 'TT_MIENGIAM' and MG.TINHTRANG = 1 group by VIENPHI_ID        ) b on a.VIENPHI_ID = b.VIENPHI_ID          left join (select VIENPHI_ID, sum(MGCT.GIATRIMIENGIAM) AS GIATRIMIENGIAM_BHTN        from TT_MIENGIAM_BHTN MG        INNER JOIN TT_MIENGIAM_CHITIET MGCT ON MG.MIENGIAM_BHTN_ID = MGCT.MIENGIAM_ID        where  MG.TIEPNHAN_ID= '8747' and MGCT.REF_TABLE = 'TT_MIENGIAM_BHTN' and MG.TINHTRANG = 1 group by VIENPHI_ID        )c on a.VIENPHI_ID = c.VIENPHI_ID          left join (select VIENPHI_ID, sum(MGCT.GIATRIMIENGIAM) AS GIATRIMIENGIAM_THANHVIEN        from TT_MIENGIAM_THANHVIEN MG        INNER JOIN TT_MIENGIAM_CHITIET MGCT ON MG.MIENGIAM_THANHVIEN_ID = MGCT.MIENGIAM_ID        where MG.TIEPNHAN_ID= '8747' and MGCT.REF_TABLE = 'TT_MIENGIAM_THANHVIEN' and MG.TINHTRANG = 1 group by VIENPHI_ID        )f on a.VIENPHI_ID = f.VIENPHI_ID          left join(select VIENPHI_ID, sum(MGCT.GIATRIMIENGIAM) AS GIATRIMIENGIAM_CTCT        from TT_MIENGIAM_CONGTY MG        INNER JOIN TT_MIENGIAM_CHITIET MGCT ON MG.MIENGIAM_CONGTY_ID = MGCT.MIENGIAM_ID        where MG.TIEPNHAN_ID= '8747' and MGCT.REF_TABLE = 'TT_MIENGIAM_CONGTY' and MG.TINHTRANG = 1 group by VIENPHI_ID        )g on a.VIENPHI_ID = g.VIENPHI_ID]
2020-07-16 15:51:43,465 [1] DEBUG - Statement Id: [DAO00330_TT_VIENPHI_GetList_TiepNhanPhaiThanhToan] PreparedStatement : [select distinct  a.*, b.GIATRIMIENGIAM_BH, c.GIATRIMIENGIAM_BHTN, f.GIATRIMIENGIAM_THANHVIEN, g.GIATRIMIENGIAM_CTCT        from        (select VP.*,NULL AS NOITHUCHIEN_ID, DK.NOICHIDINH_ID as NOIYEUCAU_ID, NULL AS THUTIENSAU, isnull(DK.TRANGTHAI, '') TRANGTHAI,        M.TENMAU AS NOIDUNG, M.MAMAU AS MADICHVU, NULL AS NORESULT, DVT.TENDONVITINH AS DONVITINH, LM.MALOAIMAU AS MALOAIDUOC, M.BHYT AS DUOC_BHYT, 'M' AS LOAIVATTU_ID, NM.TENNHOMMAU AS MANHOMDICHVU        from TT_VIENPHI VP        INNER JOIN TT_MAU_CHUNGTU_CHITIET CT ON VP.REF_ID=CT.CHUNGTUCHITIET_ID AND VP.REF_TABLE='TT_MAU_CHUNGTU_CHITIET' AND CT.BENHVIEN_ID='01819'        INNER JOIN TT_MAU_CHUNGTU CTU ON CT.CHUNGTU_ID=CTU.CHUNGTU_ID AND CTU.CHUNGTULIENQUAN_ID IS NULL        INNER join TM_MAU M on CT.MAU_ID = M.MAU_ID        LEFT JOIN TM_MAU_DONVITINH DVT ON M.DONVITINH_ID = DVT.DONVITINH_ID        LEFT JOIN TT_MAU_DANGKYMAU_CHITIET DKCT ON DKCT.CHUNGTU_ID = CTU.CHUNGTU_ID AND DKCT.BENHVIEN_ID='01819'        LEFT JOIN TT_MAU_DANGKYMAU DK ON DK.DANGKYMAU_ID = DKCT.DANGKYMAU_ID        LEFT JOIN TM_MAU_LOAIMAU LM ON LM.LOAIMAU_ID = M.LOAIMAU_ID        LEFT JOIN TM_MAU_NHOMMAU NM ON NM.NHOMMAU_ID = LM.NHOMMAU_ID        where Vp.TIEPNHAN_ID = '8747' and Vp.ACTIVE = '1' and vp.DUOC_ID is not null and        ((vp.DATHANHTOAN = '0') or (vp.BENHNHAN_PHAITHANHTOAN > vp.GIATRI_BENHNHAN_DATHANHTOAN and vp.DATHANHTOAN = '1'))   AND             VP.KHONGTHUTIEN != '1'                   ) a        left join (select VIENPHI_ID,        sum(MGCT.GIATRIMIENGIAM) AS GIATRIMIENGIAM_BH from TT_MIENGIAM MG        INNER JOIN TT_MIENGIAM_CHITIET MGCT ON MG.MIENGIAM_ID = MGCT.MIENGIAM_ID        where MG.TIEPNHAN_ID= '8747' and MGCT.REF_TABLE = 'TT_MIENGIAM' and MG.TINHTRANG = 1 group by VIENPHI_ID        ) b on a.VIENPHI_ID = b.VIENPHI_ID          left join (select VIENPHI_ID, sum(MGCT.GIATRIMIENGIAM) AS GIATRIMIENGIAM_BHTN        from TT_MIENGIAM_BHTN MG        INNER JOIN TT_MIENGIAM_CHITIET MGCT ON MG.MIENGIAM_BHTN_ID = MGCT.MIENGIAM_ID        where  MG.TIEPNHAN_ID= '8747' and MGCT.REF_TABLE = 'TT_MIENGIAM_BHTN' and MG.TINHTRANG = 1 group by VIENPHI_ID        )c on a.VIENPHI_ID = c.VIENPHI_ID          left join (select VIENPHI_ID, sum(MGCT.GIATRIMIENGIAM) AS GIATRIMIENGIAM_THANHVIEN        from TT_MIENGIAM_THANHVIEN MG        INNER JOIN TT_MIENGIAM_CHITIET MGCT ON MG.MIENGIAM_THANHVIEN_ID = MGCT.MIENGIAM_ID        where MG.TIEPNHAN_ID= '8747' and MGCT.REF_TABLE = 'TT_MIENGIAM_THANHVIEN' and MG.TINHTRANG = 1 group by VIENPHI_ID        )f on a.VIENPHI_ID = f.VIENPHI_ID          left join(select VIENPHI_ID, sum(MGCT.GIATRIMIENGIAM) AS GIATRIMIENGIAM_CTCT        from TT_MIENGIAM_CONGTY MG        INNER JOIN TT_MIENGIAM_CHITIET MGCT ON MG.MIENGIAM_CONGTY_ID = MGCT.MIENGIAM_ID        where MG.TIEPNHAN_ID= '8747' and MGCT.REF_TABLE = 'TT_MIENGIAM_CONGTY' and MG.TINHTRANG = 1 group by VIENPHI_ID        )g on a.VIENPHI_ID = g.VIENPHI_ID]
2020-07-16 15:51:43,501 [1] DEBUG - Statement Id: [DAO00119_GetDataTamUng_HoaUng] PreparedStatement : [select SUM(TAMUNG) AS TONGTIEN_TU, SUM(HOANUNG) AS TONGTIEN_HU, TIEPNHAN_ID        from (        select HD.TIEPNHAN_ID,        CASE WHEN LOAIHOADON = 'TU' then HD.GIATRIHOADON ELSE 0 END TAMUNG,        CASE WHEN LOAIHOADON = 'HU' then HD.GIATRIHOADON ELSE 0 END HOANUNG        from TT_HOADON HD        where HD.DATHANHTOAN = '1' and HD.HUYHOADON = '0' and HD.HOANTRA = '0'        and HD.TIEPNHAN_ID = 8747        and HD.BENHVIEN_ID = '01819'        ) temp        group by temp.TIEPNHAN_ID]
2020-07-16 15:51:43,575 [1] DEBUG - Statement Id: [DAO00403_QMS002_GetThongTinClient] PreparedStatement : [SELECT B.ID as QUEUE_ID, B.NAME AS QUEUE_NAME,A.ID AS CLIENT_ID , A.[NAME] AS CLIENT_NAME, ISNULL(A.[STATE],1) AS [STATE],(CASE C.NAME WHEN 'UT' THEN 1 ELSE 0 END) AS QUEUETYPE     , B.DEPARTMENT_ID,ISNULL(B.SECTION_ID,-1) AS SECTION_ID,A.IPSERVER,A.NAMEAUDIO,C.QUEUE_TYPE_CODE,C.QUEUE_TYPE_CODE_SOUND,S.[NAME] AS SECTIONNAME     FROM QMS_QUEUE B LEFT JOIN QMS_CLIENT A ON A.QUEUE_ID = B.ID     LEFT JOIN QMS_QUEUE_TYPE C ON B.QUEUETYPE_ID = C.ID     LEFT JOIN QMS_SECTION S ON B.SECTION_ID=S.ID     WHERE     (A.COMPUTERNAME = 'DESKTOP-89GE5BA' OR A.IPADDRESS = '10.15.167.38') AND A.[STATE] = 1 AND B.DEPARTMENT_ID='74'            AND B.BENHVIEN_ID = '01819']
2020-07-16 15:51:43,599 [1] DEBUG - Statement Id: [DAO00101_GetListSuatAn] PreparedStatement : [SELECT        kP.KHAUPHANAN_ID,        kP.MAKHAUPHANAN,        kP.TENKHAUPHANAN,        LKP.LOAIKHAUPHANAN_ID,        LKP.MALOAIKHAUPHANAN,        LKP.TENLOAIKHAUPHANAN,        DG.DONGIA,        kP.HANGMUC_ID        FROM TM_NUT_KHAUPHANAN kP        INNER JOIN TM_NUT_LOAIKHAUPHANAN LKP ON  kP.LOAIKHAUPHANAN_ID = LKP.LOAIKHAUPHANAN_ID        INNER JOIN TM_NUT_KHAUPHANAN_DONGIA DG ON DG.KHAUPHANAN_ID = kP.KHAUPHANAN_ID        WHERE DG.DONGIA IS NOT NULL]
2020-07-16 15:52:03,112 [1] DEBUG - Statement Id: [DAO00014_GetPatientStatus] PreparedStatement : [select        CASE        when tn.TRANGTHAI = 'HOANTHANH' Then tn.TRANGTHAI        WHEN xncp.XACNHANCHIPHI_ID is not null THEN 'XACNHANCHIPHI'        WHEN (tn.KHOADULIEU = '1') THEN 'KHOADULIEU'        ELSE tn.TRANGTHAI        END        as TRANGTHAI        from TT_TIEPNHAN tn        left join TT_XACNHANCHIPHI xncp on tn.TIEPNHAN_ID = xncp.TIEPNHAN_ID        where tn.TIEPNHAN_ID = '8747'        and tn.BENHVIEN_ID = '01819']
2020-07-16 15:52:03,179 [1] DEBUG - Statement Id: [DAO00119_TT_VIENPHI_GetList_TiepNhanPhaiThanhToanWithVienphiId] PreparedStatement : [select  a.*, b.GIATRIMIENGIAM_BH, c.GIATRIMIENGIAM_BHTN, f.GIATRIMIENGIAM_THANHVIEN, g.GIATRIMIENGIAM_CTCT        from        (select VP.*, c.NOITHUCHIEN_ID, c.NOIYEUCAU_ID, c.HUYYEUCAU        from TT_VIENPHI VP        left join TT_DVYEUCAU c on c.DVYEUCAU_ID = VP.REF_ID  and vp.REF_TABLE = 'TT_DVYEUCAU'        where        VP.REF_TABLE != 'TT_MAU_CHUNGTU_CHITIET' and        Vp.TIEPNHAN_ID = '8747' and Vp.ACTIVE = '1' and ((c.HUYYEUCAU != '1' and vp.DICHVU_ID is not null) or (vp.DUOC_ID is not null)) and        ((vp.DATHANHTOAN = '0') or (vp.BENHNHAN_PHAITHANHTOAN > vp.GIATRI_BENHNHAN_DATHANHTOAN and vp.DATHANHTOAN = '1')) and c.DANGKY_CHITIET_ID is null        and vp.VIENPHI_ID in (16000)) a          left join (select VIENPHI_ID,        sum(MGCT.GIATRIMIENGIAM) AS GIATRIMIENGIAM_BH from TT_MIENGIAM MG        INNER JOIN TT_MIENGIAM_CHITIET MGCT ON MG.MIENGIAM_ID = MGCT.MIENGIAM_ID        where MG.TIEPNHAN_ID= '8747' and MGCT.REF_TABLE = 'TT_MIENGIAM' and MG.TINHTRANG = 1 group by VIENPHI_ID        ) b on a.VIENPHI_ID = b.VIENPHI_ID          left join (select VIENPHI_ID, sum(MGCT.GIATRIMIENGIAM) AS GIATRIMIENGIAM_BHTN        from TT_MIENGIAM_BHTN MG        INNER JOIN TT_MIENGIAM_CHITIET MGCT ON MG.MIENGIAM_BHTN_ID = MGCT.MIENGIAM_ID        where  MG.TIEPNHAN_ID= '8747' and MGCT.REF_TABLE = 'TT_MIENGIAM_BHTN' and MG.TINHTRANG = 1 group by VIENPHI_ID        )c on a.VIENPHI_ID = c.VIENPHI_ID          left join (select VIENPHI_ID, sum(MGCT.GIATRIMIENGIAM) AS GIATRIMIENGIAM_THANHVIEN        from TT_MIENGIAM_THANHVIEN MG        INNER JOIN TT_MIENGIAM_CHITIET MGCT ON MG.MIENGIAM_THANHVIEN_ID = MGCT.MIENGIAM_ID        where MG.TIEPNHAN_ID= '8747' and MGCT.REF_TABLE = 'TT_MIENGIAM_THANHVIEN' and MG.TINHTRANG = 1 group by VIENPHI_ID        )f on a.VIENPHI_ID = f.VIENPHI_ID          left join(select VIENPHI_ID, sum(MGCT.GIATRIMIENGIAM) AS GIATRIMIENGIAM_CTCT        from TT_MIENGIAM_CONGTY MG        INNER JOIN TT_MIENGIAM_CHITIET MGCT ON MG.MIENGIAM_CONGTY_ID = MGCT.MIENGIAM_ID        where MG.TIEPNHAN_ID= '8747' and MGCT.REF_TABLE = 'TT_MIENGIAM_CONGTY' and MG.TINHTRANG = 1 group by VIENPHI_ID        )g on a.VIENPHI_ID = g.VIENPHI_ID        WHERE a.REF_TABLE!='TT_MAU_CHUNGTU_CHITIET']
2020-07-16 15:52:03,205 [1] DEBUG - Statement Id: [DAO00330_TT_VIENPHI_GetList_TiepNhanPhaiThanhToanWithVienphiId] PreparedStatement : [select  a.*, b.GIATRIMIENGIAM_BH, c.GIATRIMIENGIAM_BHTN, f.GIATRIMIENGIAM_THANHVIEN, g.GIATRIMIENGIAM_CTCT        from        (select VP.*, null NOITHUCHIEN_ID, dk.NOICHIDINH_ID as NOIYEUCAU_ID, '0' as HUYYEUCAU        from TT_VIENPHI VP        INNER JOIN TT_MAU_CHUNGTU_CHITIET CT ON VP.REF_ID=CT.CHUNGTUCHITIET_ID AND VP.REF_TABLE='TT_MAU_CHUNGTU_CHITIET' AND CT.BENHVIEN_ID='01819'        INNER JOIN TT_MAU_CHUNGTU CTU ON CT.CHUNGTU_ID=CTU.CHUNGTU_ID AND CTU.CHUNGTULIENQUAN_ID IS NULL        LEFT JOIN TT_MAU_DANGKYMAU_CHITIET DKCT ON DKCT.CHUNGTU_ID = CTU.CHUNGTU_ID AND DKCT.BENHVIEN_ID='01819'        LEFT JOIN TT_MAU_DANGKYMAU DK ON DK.DANGKYMAU_ID = DKCT.DANGKYMAU_ID        where Vp.TIEPNHAN_ID = '8747' and Vp.ACTIVE = '1' and vp.DUOC_ID is not null and        ((vp.DATHANHTOAN = '0') or (vp.BENHNHAN_PHAITHANHTOAN > vp.GIATRI_BENHNHAN_DATHANHTOAN and vp.DATHANHTOAN = '1'))        and vp.VIENPHI_ID in (16000)) a          left join (select VIENPHI_ID,        sum(MGCT.GIATRIMIENGIAM) AS GIATRIMIENGIAM_BH from TT_MIENGIAM MG        INNER JOIN TT_MIENGIAM_CHITIET MGCT ON MG.MIENGIAM_ID = MGCT.MIENGIAM_ID        where MG.TIEPNHAN_ID= '8747' and MGCT.REF_TABLE = 'TT_MIENGIAM' and MG.TINHTRANG = 1 group by VIENPHI_ID        ) b on a.VIENPHI_ID = b.VIENPHI_ID          left join (select VIENPHI_ID, sum(MGCT.GIATRIMIENGIAM) AS GIATRIMIENGIAM_BHTN        from TT_MIENGIAM_BHTN MG        INNER JOIN TT_MIENGIAM_CHITIET MGCT ON MG.MIENGIAM_BHTN_ID = MGCT.MIENGIAM_ID        where  MG.TIEPNHAN_ID= '8747' and MGCT.REF_TABLE = 'TT_MIENGIAM_BHTN' and MG.TINHTRANG = 1 group by VIENPHI_ID        )c on a.VIENPHI_ID = c.VIENPHI_ID          left join (select VIENPHI_ID, sum(MGCT.GIATRIMIENGIAM) AS GIATRIMIENGIAM_THANHVIEN        from TT_MIENGIAM_THANHVIEN MG        INNER JOIN TT_MIENGIAM_CHITIET MGCT ON MG.MIENGIAM_THANHVIEN_ID = MGCT.MIENGIAM_ID        where MG.TIEPNHAN_ID= '8747' and MGCT.REF_TABLE = 'TT_MIENGIAM_THANHVIEN' and MG.TINHTRANG = 1 group by VIENPHI_ID        )f on a.VIENPHI_ID = f.VIENPHI_ID          left join(select VIENPHI_ID, sum(MGCT.GIATRIMIENGIAM) AS GIATRIMIENGIAM_CTCT        from TT_MIENGIAM_CONGTY MG        INNER JOIN TT_MIENGIAM_CHITIET MGCT ON MG.MIENGIAM_CONGTY_ID = MGCT.MIENGIAM_ID        where MG.TIEPNHAN_ID= '8747' and MGCT.REF_TABLE = 'TT_MIENGIAM_CONGTY' and MG.TINHTRANG = 1 group by VIENPHI_ID        )g on a.VIENPHI_ID = g.VIENPHI_ID]
2020-07-16 15:52:03,230 [1] DEBUG - Statement Id: [DAO00119_TT_VIENPHI_GetList_VPHienTai] PreparedStatement : [select * from TT_VIENPHI vp        where        ((vp.DATHANHTOAN = '0') or (vp.BENHNHAN_PHAITHANHTOAN > vp.GIATRI_BENHNHAN_DATHANHTOAN and vp.DATHANHTOAN = '1'))        and VIENPHI_ID in (16000)         and           TIEPNHAN_ID = '8747']
2020-07-16 15:52:03,255 [1] DEBUG - Statement Id: [DAO00021_GetListSoBienLai] PreparedStatement : [select            BLCT.BIENLAICHITIET_ID            ,BL.*                         ,BL.KYHIEU + '/' + SERIES AS 'KYHIEU_SOQUYEN'                         ,BLCT.START_NUMBER            ,BLCT.CURRENT_NUMBER            ,BLCT.HIEULUC            ,BLCT.NGUOISUDUNG_ID            from TT_BIENLAICHITIET BLCT            left join TT_BIENLAI BL on BL.BIENLAI_ID = BLCT.BIENLAI_ID            where            (bl.MAX_NUMBER > (select MAX(CURRENT_NUMBER) from TT_BIENLAICHITIET where BIENLAI_ID = BLCT.BIENLAI_ID) or BLCT.CURRENT_NUMBER is null)            and BLCT.HIEULUC = 1            and BLCT.NGUOISUDUNG_ID =   @param0             and BL.BENHVIEN_ID =  @param1                          order by BLCT.THOIGIANSUDUNG DESC]
2020-07-16 15:52:03,255 [1] DEBUG - Statement Id: [DAO00021_GetListSoBienLai] Parameters: [@param0=[NGUOISUDUNG_ID,1], @param1=[BENHVIEN_ID,01819]]
2020-07-16 15:52:03,255 [1] DEBUG - Statement Id: [DAO00021_GetListSoBienLai] Types: [@param0=[Int64, System.Int64], @param1=[String, System.String]]
2020-07-16 15:52:03,283 [1] DEBUG - Statement Id: [DAO00021_GetListSoBienLai] PreparedStatement : [select            BLCT.BIENLAICHITIET_ID            ,BL.*                         ,BL.KYHIEU + '/' + SERIES AS 'KYHIEU_SOQUYEN'                         ,BLCT.START_NUMBER            ,BLCT.CURRENT_NUMBER            ,BLCT.HIEULUC            ,BLCT.NGUOISUDUNG_ID            from TT_BIENLAICHITIET BLCT            left join TT_BIENLAI BL on BL.BIENLAI_ID = BLCT.BIENLAI_ID            where            (bl.MAX_NUMBER > (select MAX(CURRENT_NUMBER) from TT_BIENLAICHITIET where BIENLAI_ID = BLCT.BIENLAI_ID) or BLCT.CURRENT_NUMBER is null)            and BLCT.HIEULUC = 1            and BLCT.NGUOISUDUNG_ID =   @param0             and BL.BENHVIEN_ID =  @param1                          order by BLCT.THOIGIANSUDUNG DESC]
2020-07-16 15:52:03,283 [1] DEBUG - Statement Id: [DAO00021_GetListSoBienLai] Parameters: [@param0=[NGUOISUDUNG_ID,1], @param1=[BENHVIEN_ID,01819]]
2020-07-16 15:52:03,283 [1] DEBUG - Statement Id: [DAO00021_GetListSoBienLai] Types: [@param0=[Int64, System.Int64], @param1=[String, System.String]]
2020-07-16 15:52:03,310 [1] DEBUG - Statement Id: [DAO00021_GetListSoBienLai] PreparedStatement : [select            BLCT.BIENLAICHITIET_ID            ,BL.*                         ,BL.KYHIEU + '/' + SERIES AS 'KYHIEU_SOQUYEN'                         ,BLCT.START_NUMBER            ,BLCT.CURRENT_NUMBER            ,BLCT.HIEULUC            ,BLCT.NGUOISUDUNG_ID            from TT_BIENLAICHITIET BLCT            left join TT_BIENLAI BL on BL.BIENLAI_ID = BLCT.BIENLAI_ID            where            (bl.MAX_NUMBER > (select MAX(CURRENT_NUMBER) from TT_BIENLAICHITIET where BIENLAI_ID = BLCT.BIENLAI_ID) or BLCT.CURRENT_NUMBER is null)            and BLCT.HIEULUC = 1            and BLCT.NGUOISUDUNG_ID =   @param0             and BL.BENHVIEN_ID =  @param1              and               BLCT.BIENLAICHITIET_ID = '2002'                         order by BLCT.THOIGIANSUDUNG DESC]
2020-07-16 15:52:03,310 [1] DEBUG - Statement Id: [DAO00021_GetListSoBienLai] Parameters: [@param0=[NGUOISUDUNG_ID,1], @param1=[BENHVIEN_ID,01819]]
2020-07-16 15:52:03,310 [1] DEBUG - Statement Id: [DAO00021_GetListSoBienLai] Types: [@param0=[Int64, System.Int64], @param1=[String, System.String]]
2020-07-16 15:52:03,337 [1] DEBUG - Statement Id: [DAO00119_TT_VIENPHI_XoaBienLaiTamNgoaiTru] PreparedStatement : [delete from TT_HOADON_HINHTHUCTHANHTOAN        where HOADON_ID = ''          delete from TT_HOADON_CHITIET_NGOAITRU        where HOADON_ID = ''          delete from TT_HOADON        where HOADON_ID = '' and TRANGTHAI in ('CHUATHUTIEN', 'CHODUYETCONGNO', 'CHOXACNHANTTVIDT')          update TT_VIENPHI set HOADON_ID = null where HOADON_ID = '']
2020-07-16 15:52:03,383 [1] DEBUG - Statement Id: [DAO00055_GetDetail] PreparedStatement : [select *              from LST_KEYDATA_VIENPHI               where                             LST_KEYDATA_VIENPHI.KEYTYPE = 'BL'                       and                           LST_KEYDATA_VIENPHI.KEYYEAR = '2020'                       and                           LST_KEYDATA_VIENPHI.KEYMONTH = '7'                       and                           LST_KEYDATA_VIENPHI.KEYDAY = '0'                       and                           LST_KEYDATA_VIENPHI.SEGMENT_1 = '0'                       and                           LST_KEYDATA_VIENPHI.SEGMENT_2 = '0'                       and                           LST_KEYDATA_VIENPHI.SEGMENT_3 = '0'                                     order by KEYTYPE]
2020-07-16 15:52:03,407 [1] DEBUG - Statement Id: [DAO00055_Update] PreparedStatement : [update LST_KEYDATA_VIENPHI set              KEYVALUE =  @param0               where              KEYTYPE = 'BL'              AND KEYYEAR = '2020'              AND KEYMONTH = '7'              AND KEYDAY = '0'              AND SEGMENT_1 = '0'              AND SEGMENT_2 = '0'              AND SEGMENT_3 = '0']
2020-07-16 15:52:03,407 [1] DEBUG - Statement Id: [DAO00055_Update] Parameters: [@param0=[KEYVALUE,000002]]
2020-07-16 15:52:03,407 [1] DEBUG - Statement Id: [DAO00055_Update] Types: [@param0=[String, System.String]]
2020-07-16 15:52:03,435 [1] DEBUG - Statement Id: [DAO00024_TT_HOADON_Add] PreparedStatement : [insert into TT_HOADON (              SOHOADON              , LOAIHOADON              , TIEPNHAN_ID              , BENHNHAN_ID              , BENHAN_ID              , DOITUONG_ID              , BENHAN_NGOAITRU_ID              , NGAYPHATSINH              , NGAYHOADON              , NOIPHATSINH_ID              , NGUOILAP_ID              , NOITHUTIEN_ID              , NGUOITHUTIEN_ID              , NOITRA_ID              , NGUOITRA_ID              , NGAYTRA              , GIATRIHOADON              , GIATRITHUCTHU              , TIENTE_ID              , TYGIA              , GIATRIVND              , DANGKYHOADON_ID              , SOSERIEVAT              , SOHOADONVAT              , GIATRIVAT              , NGOAIGIO              , THUHD_BL              , GHICHU              , TRANGTHAI              , DATHANHTOAN              , HUYHOADON              , LYDOHUY_ID              , HOANTRA              , IDCHUYEN              , IDCHUYENHUY              , IDCHUYENHOAN              , HOADONLIENQUAN_ID              , TRANSFER_VIENPHI_ID              , NGAYKHOAGOI              , NHOMTHANHTOAN_ID              , HOADONDOIUNG              , CHUYENCHUNGTUID              , CHUYENCHUNGTUHOANID              , CHUYENCHUNGTUHUYID              , CHUYENDOANHTHUID              , CHUYENDOANHTHUHOANID              , CHUYENDOANHTHUHUYID              , KH_TENCONGTY              , KH_MASOTHUE              , KH_DIACHI              , KH_NGUOIDAIDIEN              , INLAI              , INLAI_USER_ID                           , BENHVIEN_ID            , NGAYTAO            , NGUOITAO_ID            , NGAYCAPNHAT            , NGUOICAPNHAT_ID                            , YEUCAUVP                            , MACHINENAME                         , DOTDIEUTRI_ID              ) values (               @param0               ,  @param1               ,  @param2               ,  @param3               ,  @param4               ,  @param5               ,  @param6               ,  @param7               ,  @param8               ,  @param9               ,  @param10               ,  @param11               ,  @param12               ,  @param13               ,  @param14               ,  @param15               ,  @param16               ,  @param17               ,  @param18               ,  @param19               ,  @param20               ,  @param21               ,  @param22               ,  @param23               ,  @param24               ,  @param25               ,  @param26               ,  @param27               ,  @param28               ,  @param29               ,  @param30               ,  @param31               ,  @param32               ,  @param33               ,  @param34               ,  @param35               ,  @param36               ,  @param37               ,  @param38               ,  @param39               ,  @param40               ,  @param41               ,  @param42               ,  @param43               ,  @param44               ,  @param45               ,  @param46               ,  @param47               ,  @param48               ,  @param49               ,  @param50               ,  @param51               ,  @param52                            ,  @param53             ,  @param54             ,  @param55             ,  @param56             ,  @param57                             , @param58                             ,  @param59                          ,  @param60             )            SELECT SCOPE_IDENTITY()]
2020-07-16 15:52:03,435 [1] DEBUG - Statement Id: [DAO00024_TT_HOADON_Add] Parameters: [@param0=[SOHOADON,BL.2007000002], @param1=[LOAIHOADON,BL], @param2=[TIEPNHAN_ID,8747], @param3=[BENHNHAN_ID,8731], @param4=[BENHAN_ID,null], @param5=[DOITUONG_ID,1], @param6=[BENHAN_NGOAITRU_ID,null], @param7=[NGAYPHATSINH,7/16/2020 3:52:03 PM], @param8=[NGAYHOADON,7/16/2020 3:52:03 PM], @param9=[NOIPHATSINH_ID,74], @param10=[NGUOILAP_ID,1], @param11=[NOITHUTIEN_ID,74], @param12=[NGUOITHUTIEN_ID,1], @param13=[NOITRA_ID,null], @param14=[NGUOITRA_ID,null], @param15=[NGAYTRA,null], @param16=[GIATRIHOADON,38700], @param17=[GIATRITHUCTHU,38700], @param18=[TIENTE_ID,VND], @param19=[TYGIA,1], @param20=[GIATRIVND,38700], @param21=[DANGKYHOADON_ID,null], @param22=[SOSERIEVAT,null], @param23=[SOHOADONVAT,null], @param24=[GIATRIVAT,null], @param25=[NGOAIGIO,null], @param26=[THUHD_BL,HD], @param27=[GHICHU,null], @param28=[TRANGTHAI,CHUATHUTIEN], @param29=[DATHANHTOAN,0], @param30=[HUYHOADON,0], @param31=[LYDOHUY_ID,null], @param32=[HOANTRA,0], @param33=[IDCHUYEN,null], @param34=[IDCHUYENHUY,null], @param35=[IDCHUYENHOAN,null], @param36=[HOADONLIENQUAN_ID,null], @param37=[TRANSFER_VIENPHI_ID,null], @param38=[NGAYKHOAGOI,null], @param39=[NHOMTHANHTOAN_ID,null], @param40=[HOADONDOIUNG,null], @param41=[CHUYENCHUNGTUID,null], @param42=[CHUYENCHUNGTUHOANID,null], @param43=[CHUYENCHUNGTUHUYID,null], @param44=[CHUYENDOANHTHUID,null], @param45=[CHUYENDOANHTHUHOANID,null], @param46=[CHUYENDOANHTHUHUYID,null], @param47=[KH_TENCONGTY,null], @param48=[KH_MASOTHUE,null], @param49=[KH_DIACHI,null], @param50=[KH_NGUOIDAIDIEN,null], @param51=[INLAI,null], @param52=[INLAI_USER_ID,null], @param53=[BENHVIEN_ID,01819], @param54=[NGAYTAO,7/16/2020 3:52:03 PM], @param55=[NGUOITAO_ID,1], @param56=[NGAYCAPNHAT,7/16/2020 3:52:03 PM], @param57=[NGUOICAPNHAT_ID,1], @param58=[YEUCAUVP,False], @param59=[MACHINENAME,DESKTOP-89GE5BA], @param60=[DOTDIEUTRI_ID,null]]
2020-07-16 15:52:03,435 [1] DEBUG - Statement Id: [DAO00024_TT_HOADON_Add] Types: [@param0=[String, System.String], @param1=[String, System.String], @param2=[Int64, System.Int64], @param3=[Int64, System.Int64], @param4=[System.DBNull, null], @param5=[Int64, System.Int64], @param6=[System.DBNull, null], @param7=[DateTime, System.DateTime], @param8=[DateTime, System.DateTime], @param9=[Int64, System.Int64], @param10=[Int64, System.Int64], @param11=[Int64, System.Int64], @param12=[Int64, System.Int64], @param13=[System.DBNull, null], @param14=[System.DBNull, null], @param15=[System.DBNull, null], @param16=[Double, System.Double], @param17=[Double, System.Double], @param18=[String, System.String], @param19=[Double, System.Double], @param20=[Double, System.Double], @param21=[System.DBNull, null], @param22=[System.DBNull, null], @param23=[System.DBNull, null], @param24=[System.DBNull, null], @param25=[System.DBNull, null], @param26=[String, System.String], @param27=[System.DBNull, null], @param28=[String, System.String], @param29=[String, System.String], @param30=[String, System.String], @param31=[System.DBNull, null], @param32=[String, System.String], @param33=[System.DBNull, null], @param34=[System.DBNull, null], @param35=[System.DBNull, null], @param36=[System.DBNull, null], @param37=[System.DBNull, null], @param38=[System.DBNull, null], @param39=[System.DBNull, null], @param40=[System.DBNull, null], @param41=[System.DBNull, null], @param42=[System.DBNull, null], @param43=[System.DBNull, null], @param44=[System.DBNull, null], @param45=[System.DBNull, null], @param46=[System.DBNull, null], @param47=[System.DBNull, null], @param48=[System.DBNull, null], @param49=[System.DBNull, null], @param50=[System.DBNull, null], @param51=[System.DBNull, null], @param52=[System.DBNull, null], @param53=[String, System.String], @param54=[DateTime, System.DateTime], @param55=[Int64, System.Int64], @param56=[DateTime, System.DateTime], @param57=[Int64, System.Int64], @param58=[Boolean, System.Boolean], @param59=[String, System.String], @param60=[System.DBNull, null]]
2020-07-16 15:52:03,460 [1] DEBUG - Statement Id: [DAO00024_TT_HOADON_HINHTHUCTHANHTOAN_Add] PreparedStatement : [insert into TT_HOADON_HINHTHUCTHANHTOAN (              HOADON_ID              , HINHTHUCTHANHTOAN_ID              , TENHINHTHUCTHANHTOAN              , GIATRITHUCTHU              , TIENTE              , TIENTE_ID              , TYGIA              , GIATRIVND              , BENHVIEN_ID              ) values (               @param0               ,  @param1               ,  @param2               ,  @param3               ,  @param4               ,  @param5               ,  @param6               ,  @param7               ,  @param8               )]
2020-07-16 15:52:03,460 [1] DEBUG - Statement Id: [DAO00024_TT_HOADON_HINHTHUCTHANHTOAN_Add] Parameters: [@param0=[HOADON_ID,5592], @param1=[HINHTHUCTHANHTOAN_ID,443], @param2=[TENHINHTHUCTHANHTOAN,Tiền mặt], @param3=[GIATRITHUCTHU,38700], @param4=[TIENTE,VND], @param5=[TIENTE_ID,8047], @param6=[TYGIA,1], @param7=[GIATRIVND,38700], @param8=[BENHVIEN_ID,01819]]
2020-07-16 15:52:03,460 [1] DEBUG - Statement Id: [DAO00024_TT_HOADON_HINHTHUCTHANHTOAN_Add] Types: [@param0=[Int64, System.Int64], @param1=[Int64, System.Int64], @param2=[String, System.String], @param3=[Double, System.Double], @param4=[String, System.String], @param5=[String, System.String], @param6=[Double, System.Double], @param7=[Double, System.Double], @param8=[String, System.String]]
2020-07-16 15:52:03,486 [1] DEBUG - Statement Id: [DAO00024_TT_VIENPHI_Ngoaitru_Thanhtoan_Json] PreparedStatement : [declare @jsonVienPhi nvarchar(max) = N'[{"TIEPNHAN_ID":8747,"SOTIEPNHAN":"TN200716.0000004","HOADONCHITIET_ID":0,"HOADON_ID":5592,"VIENPHI_ID":16000,"REF_ID":13147,"REF_TABLE":"TT_DVYEUCAU","DICHVU_ID":3,"DUOC_ID":null,"LOAI_CHIPHI":"TT","LOAIGIA_ID":3,"SOLUONG":1.0,"DONGIA_DOANHTHU":38700.0,"THANHTIEN_DOANHTHU":38700.0,"BHYT_TL":0.0,"BHYT_DONGIA":0.0,"BHYT_THANHTIEN":0.0,"BHYT_DONGIA_CHITRA":0.0,"BHYT_THANHTIEN_CHITRA":0.0,"BENHNHAN_PHAITHANHTOAN":38700.0,"GIATRI_HOADON":0.0,"GIATRI_HOADON_DATHANHTOAN":0.0,"GIATRI_BIENLAI":0.0,"GIATRI_BIENLAI_DATHANHTOAN":0.0,"GIATRI_BENHNHAN_DATHANHTOAN":0.0,"TYLE_THATTHU":null,"GIATRI_THATTHU":0.0,"MIENGIAM_TL":0.0,"MIENGIAM_GIATRI":0.0,"NGANSACH_TL":0.0,"NGANSACH_GIATRI":0.0,"TAITRO_TL":0.0,"TAITRO_GIATRI":0.0,"BHTN_GIATRI":null,"NOIDUNGTHU":null,"CHUNGTUXUATBN_ID":null,"TYLEVAT":null,"GIATRIVAT":null,"MASOTHUE":null,"SOCHUNGTUKETOAN":null,"DAHOANTRA":"0","TRANGTHAI":"CHUATHUCHIEN","PHONGBAN_ID":null,"PHONGBAN_THAYDOI_ID":null,"BENHVIEN_ID":"01819","NGAYTAO":"2020-07-16T15:42:34.377","NGUOITAO_ID":1,"NGAYCAPNHAT":"2020-07-16T15:44:38.897","NGUOICAPNHAT_ID":1,"CONGTYCHITRA_GIATRI":0.0,"HOIVIEN_GIATRI":0.0,"CHON":true}]';          begin                        update TT_VIENPHI            set            GIATRI_BENHNHAN_DATHANHTOAN = 0,            GIATRI_HOADON_DATHANHTOAN = 0,            GIATRI_BIENLAI_DATHANHTOAN = 0            where GIATRI_BENHNHAN_DATHANHTOAN is null and TIEPNHAN_ID =  @param0 ;                     INSERT INTO TT_HOADON_CHITIET_NGOAITRU          (HOADON_ID, VIENPHI_ID, REF_ID, REF_TABLE, DICHVU_ID, DUOC_ID, LOAI_CHIPHI, LOAIGIA_ID, SOLUONG, DONGIA_DOANHTHU, THANHTIEN_DOANHTHU, BHYT_TL,          BHYT_DONGIA, BHYT_THANHTIEN, BHYT_DONGIA_CHITRA, BHYT_THANHTIEN_CHITRA, BENHNHAN_PHAITHANHTOAN, GIATRI_HOADON, GIATRI_HOADON_DATHANHTOAN,          GIATRI_BIENLAI, GIATRI_BIENLAI_DATHANHTOAN, GIATRI_BENHNHAN_DATHANHTOAN, MIENGIAM_GIATRI, BHTN_GIATRI,          CONGTYCHITRA_GIATRI, HOIVIEN_GIATRI, BENHVIEN_ID, NGAYTAO, NGUOITAO_ID, NGAYCAPNHAT, NGUOICAPNHAT_ID)          SELECT          HOADON_ID, VIENPHI_ID, REF_ID, REF_TABLE, DICHVU_ID, DUOC_ID, LOAI_CHIPHI, LOAIGIA_ID, SOLUONG, DONGIA_DOANHTHU, THANHTIEN_DOANHTHU,BHYT_TL,          BHYT_DONGIA, BHYT_THANHTIEN, BHYT_DONGIA_CHITRA, BHYT_THANHTIEN_CHITRA, BENHNHAN_PHAITHANHTOAN, GIATRI_HOADON, GIATRI_HOADON_DATHANHTOAN,          GIATRI_BIENLAI, GIATRI_BIENLAI_DATHANHTOAN, GIATRI_BENHNHAN_DATHANHTOAN, MIENGIAM_GIATRI, BHTN_GIATRI,          CONGTYCHITRA_GIATRI, HOIVIEN_GIATRI, BENHVIEN_ID, GETDATE(), NGUOITAO_ID, GETDATE(), NGUOICAPNHAT_ID          FROM OPENJSON(@jsonVienPhi)          WITH (          HOADON_ID int , VIENPHI_ID int , REF_ID int , REF_TABLE varchar(50) , DICHVU_ID int , DUOC_ID int , LOAI_CHIPHI varchar(20)          , LOAIGIA_ID int , SOLUONG numeric(25,4) , DONGIA_DOANHTHU numeric(25,4) , THANHTIEN_DOANHTHU numeric(25,4)          , BHYT_TL numeric(25,4) , BHYT_DONGIA numeric(25,4) , BHYT_THANHTIEN numeric(25,4) , BHYT_DONGIA_CHITRA numeric(25,4)          , BHYT_THANHTIEN_CHITRA numeric(25,4) , BENHNHAN_PHAITHANHTOAN numeric(25,4) , GIATRI_HOADON numeric(25,4)          , GIATRI_HOADON_DATHANHTOAN numeric(25,4) , GIATRI_BIENLAI numeric(25,4) , GIATRI_BIENLAI_DATHANHTOAN numeric(25,4)          , GIATRI_BENHNHAN_DATHANHTOAN numeric(25,4) , MIENGIAM_GIATRI numeric(25,4) , BHTN_GIATRI numeric(25,4)          , CONGTYCHITRA_GIATRI numeric(25,4) , HOIVIEN_GIATRI numeric(25,4) , BENHVIEN_ID varchar(10)          , NGUOITAO_ID int , NGUOICAPNHAT_ID int)            update TT_VIENPHI          set DATHANHTOAN = '1'          , DUOCPHEPTHUCHIEN = '1'          , HUY = '0'          , ACTIVE = '1'          , TT_VIENPHI.GIATRI_BENHNHAN_DATHANHTOAN = isnull(TT_VIENPHI.GIATRI_BENHNHAN_DATHANHTOAN,0) + json.BENHNHAN_PHAITHANHTOAN          , TT_VIENPHI.GIATRI_HOADON_DATHANHTOAN = isnull(TT_VIENPHI.GIATRI_HOADON_DATHANHTOAN,0) + json.BENHNHAN_PHAITHANHTOAN          , TT_VIENPHI.GIATRI_BIENLAI_DATHANHTOAN = isnull(TT_VIENPHI.GIATRI_BIENLAI_DATHANHTOAN,0) + json.BENHNHAN_PHAITHANHTOAN          , HOADON_ID = json.HOADON_ID          FROM OPENJSON (@jsonVienPhi)          WITH (          VIENPHI_ID int,          HOADON_ID int,          GIATRI_HOADON_DATHANHTOAN numeric(25, 4),          GIATRI_BIENLAI_DATHANHTOAN numeric(25, 4),          GIATRI_BENHNHAN_DATHANHTOAN numeric(25, 4),          BENHNHAN_PHAITHANHTOAN numeric(25, 4))  json          WHERE TT_VIENPHI.VIENPHI_ID = json.VIENPHI_ID          end]
2020-07-16 15:52:03,486 [1] DEBUG - Statement Id: [DAO00024_TT_VIENPHI_Ngoaitru_Thanhtoan_Json] Parameters: [@param0=[TIEPNHAN_ID,8747]]
2020-07-16 15:52:03,486 [1] DEBUG - Statement Id: [DAO00024_TT_VIENPHI_Ngoaitru_Thanhtoan_Json] Types: [@param0=[Int64, System.Int64]]
2020-07-16 15:52:03,547 [1] DEBUG - Statement Id: [DAO00024_TT_VIENPHI_Update] PreparedStatement : [update TT_VIENPHI set            TIEPNHAN_ID =  @param0                          , REF_ID =  @param1             , REF_TABLE =  @param2             , DICHVU_ID =  @param3             , DUOC_ID =  @param4             , LOAI_CHIPHI =  @param5             , LOAIGIA_ID =  @param6             , SOLUONG =  @param7             , DONGIA_DOANHTHU =  @param8             , THANHTIEN_DOANHTHU =  @param9             , BHYT_TL =  @param10             , BHYT_DONGIA =  @param11             , BHYT_THANHTIEN =  @param12             , BHYT_DONGIA_CHITRA =  @param13             , BHYT_THANHTIEN_CHITRA =  @param14             , BENHNHAN_PHAITHANHTOAN =  @param15             , GIATRI_HOADON =  @param16             , GIATRI_HOADON_DATHANHTOAN =  @param17             , GIATRI_BIENLAI =  @param18             , GIATRI_BIENLAI_DATHANHTOAN =  @param19             , GIATRI_BENHNHAN_DATHANHTOAN =  @param20             , GIATRI_THATTHU =  @param21             , MIENGIAM_TL =  @param22             , MIENGIAM_GIATRI =  @param23             , NGANSACH_TL =  @param24             , NGANSACH_GIATRI =  @param25             , TAITRO_TL =  @param26             , TAITRO_GIATRI =  @param27             , BHTN_TL =  @param28             , BHTN_DONGIA =  @param29             , BHTN_THANHTIEN =  @param30             , BHTN_DONGIA_CHITRA =  @param31             , BHTN_THANHTIEN_CHITRA =  @param32                           , DUOCPHEPTHUCHIEN =  @param33                             , HUY =  @param34                             , DATHANHTOAN =  @param35                             , DATHUCHIEN =  @param36                             , KHONGTHUTIEN =  @param37                          , HOADON_ID =  @param38                           , ACTIVE =  @param39                           , YEUCAUVP =  @param40                          , NGUOICAPNHAT_ID =  @param41             , NGAYCAPNHAT =  @param42             where            VIENPHI_ID = '16000']
2020-07-16 15:52:03,547 [1] DEBUG - Statement Id: [DAO00024_TT_VIENPHI_Update] Parameters: [@param0=[TIEPNHAN_ID,8747], @param1=[REF_ID,13147], @param2=[REF_TABLE,TT_DVYEUCAU], @param3=[DICHVU_ID,3], @param4=[DUOC_ID,null], @param5=[LOAI_CHIPHI,TT], @param6=[LOAIGIA_ID,3], @param7=[SOLUONG,1], @param8=[DONGIA_DOANHTHU,38700], @param9=[THANHTIEN_DOANHTHU,38700], @param10=[BHYT_TL,0], @param11=[BHYT_DONGIA,0], @param12=[BHYT_THANHTIEN,0], @param13=[BHYT_DONGIA_CHITRA,0], @param14=[BHYT_THANHTIEN_CHITRA,0], @param15=[BENHNHAN_PHAITHANHTOAN,38700], @param16=[GIATRI_HOADON,0], @param17=[GIATRI_HOADON_DATHANHTOAN,0], @param18=[GIATRI_BIENLAI,0], @param19=[GIATRI_BIENLAI_DATHANHTOAN,0], @param20=[GIATRI_BENHNHAN_DATHANHTOAN,0], @param21=[GIATRI_THATTHU,0], @param22=[MIENGIAM_TL,0], @param23=[MIENGIAM_GIATRI,0], @param24=[NGANSACH_TL,0], @param25=[NGANSACH_GIATRI,0], @param26=[TAITRO_TL,0], @param27=[TAITRO_GIATRI,0], @param28=[BHTN_TL,0], @param29=[BHTN_DONGIA,0], @param30=[BHTN_THANHTIEN,0], @param31=[BHTN_DONGIA_CHITRA,0], @param32=[BHTN_THANHTIEN_CHITRA,0], @param33=[DUOCPHEPTHUCHIEN,0], @param34=[HUY,0], @param35=[DATHANHTOAN,0], @param36=[DATHUCHIEN,0], @param37=[KHONGTHUTIEN,0], @param38=[HOADON_ID,5592], @param39=[ACTIVE,1], @param40=[YEUCAUVP,0], @param41=[NGUOICAPNHAT_ID,1], @param42=[NGAYCAPNHAT,7/16/2020 3:52:03 PM]]
2020-07-16 15:52:03,547 [1] DEBUG - Statement Id: [DAO00024_TT_VIENPHI_Update] Types: [@param0=[Int64, System.Int64], @param1=[Int64, System.Int64], @param2=[String, System.String], @param3=[Int64, System.Int64], @param4=[System.DBNull, null], @param5=[String, System.String], @param6=[Int64, System.Int64], @param7=[Double, System.Double], @param8=[Double, System.Double], @param9=[Double, System.Double], @param10=[Double, System.Double], @param11=[Double, System.Double], @param12=[Double, System.Double], @param13=[Double, System.Double], @param14=[Double, System.Double], @param15=[Double, System.Double], @param16=[Double, System.Double], @param17=[Double, System.Double], @param18=[Double, System.Double], @param19=[Double, System.Double], @param20=[Double, System.Double], @param21=[Double, System.Double], @param22=[Double, System.Double], @param23=[Double, System.Double], @param24=[Double, System.Double], @param25=[Double, System.Double], @param26=[Double, System.Double], @param27=[Double, System.Double], @param28=[Double, System.Double], @param29=[Double, System.Double], @param30=[Double, System.Double], @param31=[Double, System.Double], @param32=[Double, System.Double], @param33=[String, System.String], @param34=[String, System.String], @param35=[String, System.String], @param36=[String, System.String], @param37=[String, System.String], @param38=[Int64, System.Int64], @param39=[String, System.String], @param40=[String, System.String], @param41=[Int64, System.Int64], @param42=[DateTime, System.DateTime]]
2020-07-16 15:52:12,705 [1] DEBUG - Statement Id: [DAO00119_TT_VIENPHI_GetList_TiepNhanPhaiThanhToan] PreparedStatement : [select distinct  a.*, b.GIATRIMIENGIAM_BH, c.GIATRIMIENGIAM_BHTN, f.GIATRIMIENGIAM_THANHVIEN, g.GIATRIMIENGIAM_CTCT,        isnull(dv.TENDICHVU, dc.TENDUOCDAYDU) NOIDUNG, isnull(dv.MADICHVU, dc.MADUOC) MADICHVU, dv.NORESULT, dc.DONVITINH, ld.MALOAIDUOC, dc.BHYT DUOC_BHYT, ld.LOAIVATTU_ID, ndv.MANHOMDICHVU        from        (select VP.*, isnull(c.TRANGTHAI, '') TRANGTHAI, c.THUTIENSAU, c.NOITHUCHIEN_ID,        CASE        when REF_TABLE = 'TT_NGOAITRU_TOATHUOC' then ntkb.PHONGBAN_ID        when REF_TABLE = 'TT_CLSKETQUA_VTYT' then clsvtyt.PHONGBAN_ID        when REF_TABLE = 'TT_NGOAITRU_KHAMBENH_VTYT' then kbd.PHONGBAN_ID        ELSE        c.NOIYEUCAU_ID        END NOIYEUCAU_ID,        CASE        when REF_TABLE = 'TT_NGOAITRU_TOATHUOC' then ngtd.KHOXUAT_ID        when REF_TABLE = 'TT_CLSKETQUA_VTYT' then clsvtyt.KHOTAO_ID        when REF_TABLE = 'TT_NGOAITRU_KHAMBENH_VTYT' then kbd.KHOTAO_ID        ELSE null        END KHODUOC_ID          from TT_VIENPHI VP        left join TT_DVYEUCAU c on c.DVYEUCAU_ID = VP.REF_ID  and vp.REF_TABLE = 'TT_DVYEUCAU'        left join TT_NGOAITRU_TOATHUOC nttt on nttt.TOATHUOC_ID = vp.REF_ID and vp.REF_TABLE = 'TT_NGOAITRU_TOATHUOC'        left join TT_NGOAITRU_KHAMBENH_TOATHUOC ngtd on ngtd.KHAMBENH_TOATHUOC_ID = nttt.KHAMBENH_TOATHUOC_ID        left join TT_CLSKETQUA_VTYT clsvtyt on clsvtyt.CLSKETQUA_ID = vp.REF_ID and REF_TABLE = 'TT_CLSKETQUA_VTYT'        left join TT_NGOAITRU_KHAMBENH_VTYT kbd on kbd.KHAMBENH_VTYT_ID = vp.REF_ID and REF_TABLE = 'TT_NGOAITRU_KHAMBENH_VTYT'        left join TT_NGOAITRU_KHAMBENH ntkb on ntkb.KHAMBENH_ID = vp.KHAMBENH_ID and REF_TABLE = 'TT_NGOAITRU_TOATHUOC'          where Vp.TIEPNHAN_ID = '8747' and Vp.ACTIVE = '1' and ((c.HUYYEUCAU != '1' and vp.DICHVU_ID is not null) or (vp.DUOC_ID is not null)) and        ((vp.DATHANHTOAN = '0') or (vp.BENHNHAN_PHAITHANHTOAN > vp.GIATRI_BENHNHAN_DATHANHTOAN and vp.DATHANHTOAN = '1')) and c.DANGKY_CHITIET_ID is null        and vp.REF_TABLE != 'TT_MAU_CHUNGTU_CHITIET'        and vp.REF_TABLE != 'TT_DUOC_CHUNGTU_CHITIET'          AND             VP.KHONGTHUTIEN != '1'                   ) a        left join TM_DUOC dc on a.DUOC_ID = dc.DUOC_ID        left join TM_LOAIDUOC ld on dc.LOAIDUOC_ID = ld.LOAIDUOC_ID        left join TM_DICHVU dv on a.DICHVU_ID = dv.DICHVU_ID and a.REF_TABLE = 'TT_DVYEUCAU'        left join TM_NHOMDICHVU ndv on ndv.NHOMDICHVU_ID = dv.NHOMDICHVU_ID        left join (select VIENPHI_ID,        sum(MGCT.GIATRIMIENGIAM) AS GIATRIMIENGIAM_BH from TT_MIENGIAM MG        INNER JOIN TT_MIENGIAM_CHITIET MGCT ON MG.MIENGIAM_ID = MGCT.MIENGIAM_ID        where MG.TIEPNHAN_ID= '8747' and MGCT.REF_TABLE = 'TT_MIENGIAM' and MG.TINHTRANG = 1 group by VIENPHI_ID        ) b on a.VIENPHI_ID = b.VIENPHI_ID          left join (select VIENPHI_ID, sum(MGCT.GIATRIMIENGIAM) AS GIATRIMIENGIAM_BHTN        from TT_MIENGIAM_BHTN MG        INNER JOIN TT_MIENGIAM_CHITIET MGCT ON MG.MIENGIAM_BHTN_ID = MGCT.MIENGIAM_ID        where  MG.TIEPNHAN_ID= '8747' and MGCT.REF_TABLE = 'TT_MIENGIAM_BHTN' and MG.TINHTRANG = 1 group by VIENPHI_ID        )c on a.VIENPHI_ID = c.VIENPHI_ID          left join (select VIENPHI_ID, sum(MGCT.GIATRIMIENGIAM) AS GIATRIMIENGIAM_THANHVIEN        from TT_MIENGIAM_THANHVIEN MG        INNER JOIN TT_MIENGIAM_CHITIET MGCT ON MG.MIENGIAM_THANHVIEN_ID = MGCT.MIENGIAM_ID        where MG.TIEPNHAN_ID= '8747' and MGCT.REF_TABLE = 'TT_MIENGIAM_THANHVIEN' and MG.TINHTRANG = 1 group by VIENPHI_ID        )f on a.VIENPHI_ID = f.VIENPHI_ID          left join(select VIENPHI_ID, sum(MGCT.GIATRIMIENGIAM) AS GIATRIMIENGIAM_CTCT        from TT_MIENGIAM_CONGTY MG        INNER JOIN TT_MIENGIAM_CHITIET MGCT ON MG.MIENGIAM_CONGTY_ID = MGCT.MIENGIAM_ID        where MG.TIEPNHAN_ID= '8747' and MGCT.REF_TABLE = 'TT_MIENGIAM_CONGTY' and MG.TINHTRANG = 1 group by VIENPHI_ID        )g on a.VIENPHI_ID = g.VIENPHI_ID]
2020-07-16 15:52:12,731 [1] DEBUG - Statement Id: [DAO00330_TT_VIENPHI_GetList_TiepNhanPhaiThanhToan] PreparedStatement : [select distinct  a.*, b.GIATRIMIENGIAM_BH, c.GIATRIMIENGIAM_BHTN, f.GIATRIMIENGIAM_THANHVIEN, g.GIATRIMIENGIAM_CTCT        from        (select VP.*,NULL AS NOITHUCHIEN_ID, DK.NOICHIDINH_ID as NOIYEUCAU_ID, NULL AS THUTIENSAU, isnull(DK.TRANGTHAI, '') TRANGTHAI,        M.TENMAU AS NOIDUNG, M.MAMAU AS MADICHVU, NULL AS NORESULT, DVT.TENDONVITINH AS DONVITINH, LM.MALOAIMAU AS MALOAIDUOC, M.BHYT AS DUOC_BHYT, 'M' AS LOAIVATTU_ID, NM.TENNHOMMAU AS MANHOMDICHVU        from TT_VIENPHI VP        INNER JOIN TT_MAU_CHUNGTU_CHITIET CT ON VP.REF_ID=CT.CHUNGTUCHITIET_ID AND VP.REF_TABLE='TT_MAU_CHUNGTU_CHITIET' AND CT.BENHVIEN_ID='01819'        INNER JOIN TT_MAU_CHUNGTU CTU ON CT.CHUNGTU_ID=CTU.CHUNGTU_ID AND CTU.CHUNGTULIENQUAN_ID IS NULL        INNER join TM_MAU M on CT.MAU_ID = M.MAU_ID        LEFT JOIN TM_MAU_DONVITINH DVT ON M.DONVITINH_ID = DVT.DONVITINH_ID        LEFT JOIN TT_MAU_DANGKYMAU_CHITIET DKCT ON DKCT.CHUNGTU_ID = CTU.CHUNGTU_ID AND DKCT.BENHVIEN_ID='01819'        LEFT JOIN TT_MAU_DANGKYMAU DK ON DK.DANGKYMAU_ID = DKCT.DANGKYMAU_ID        LEFT JOIN TM_MAU_LOAIMAU LM ON LM.LOAIMAU_ID = M.LOAIMAU_ID        LEFT JOIN TM_MAU_NHOMMAU NM ON NM.NHOMMAU_ID = LM.NHOMMAU_ID        where Vp.TIEPNHAN_ID = '8747' and Vp.ACTIVE = '1' and vp.DUOC_ID is not null and        ((vp.DATHANHTOAN = '0') or (vp.BENHNHAN_PHAITHANHTOAN > vp.GIATRI_BENHNHAN_DATHANHTOAN and vp.DATHANHTOAN = '1'))   AND             VP.KHONGTHUTIEN != '1'                   ) a        left join (select VIENPHI_ID,        sum(MGCT.GIATRIMIENGIAM) AS GIATRIMIENGIAM_BH from TT_MIENGIAM MG        INNER JOIN TT_MIENGIAM_CHITIET MGCT ON MG.MIENGIAM_ID = MGCT.MIENGIAM_ID        where MG.TIEPNHAN_ID= '8747' and MGCT.REF_TABLE = 'TT_MIENGIAM' and MG.TINHTRANG = 1 group by VIENPHI_ID        ) b on a.VIENPHI_ID = b.VIENPHI_ID          left join (select VIENPHI_ID, sum(MGCT.GIATRIMIENGIAM) AS GIATRIMIENGIAM_BHTN        from TT_MIENGIAM_BHTN MG        INNER JOIN TT_MIENGIAM_CHITIET MGCT ON MG.MIENGIAM_BHTN_ID = MGCT.MIENGIAM_ID        where  MG.TIEPNHAN_ID= '8747' and MGCT.REF_TABLE = 'TT_MIENGIAM_BHTN' and MG.TINHTRANG = 1 group by VIENPHI_ID        )c on a.VIENPHI_ID = c.VIENPHI_ID          left join (select VIENPHI_ID, sum(MGCT.GIATRIMIENGIAM) AS GIATRIMIENGIAM_THANHVIEN        from TT_MIENGIAM_THANHVIEN MG        INNER JOIN TT_MIENGIAM_CHITIET MGCT ON MG.MIENGIAM_THANHVIEN_ID = MGCT.MIENGIAM_ID        where MG.TIEPNHAN_ID= '8747' and MGCT.REF_TABLE = 'TT_MIENGIAM_THANHVIEN' and MG.TINHTRANG = 1 group by VIENPHI_ID        )f on a.VIENPHI_ID = f.VIENPHI_ID          left join(select VIENPHI_ID, sum(MGCT.GIATRIMIENGIAM) AS GIATRIMIENGIAM_CTCT        from TT_MIENGIAM_CONGTY MG        INNER JOIN TT_MIENGIAM_CHITIET MGCT ON MG.MIENGIAM_CONGTY_ID = MGCT.MIENGIAM_ID        where MG.TIEPNHAN_ID= '8747' and MGCT.REF_TABLE = 'TT_MIENGIAM_CONGTY' and MG.TINHTRANG = 1 group by VIENPHI_ID        )g on a.VIENPHI_ID = g.VIENPHI_ID]
2020-07-16 15:52:12,765 [1] DEBUG - Statement Id: [DAO00119_GetDataTamUng_HoaUng] PreparedStatement : [select SUM(TAMUNG) AS TONGTIEN_TU, SUM(HOANUNG) AS TONGTIEN_HU, TIEPNHAN_ID        from (        select HD.TIEPNHAN_ID,        CASE WHEN LOAIHOADON = 'TU' then HD.GIATRIHOADON ELSE 0 END TAMUNG,        CASE WHEN LOAIHOADON = 'HU' then HD.GIATRIHOADON ELSE 0 END HOANUNG        from TT_HOADON HD        where HD.DATHANHTOAN = '1' and HD.HUYHOADON = '0' and HD.HOANTRA = '0'        and HD.TIEPNHAN_ID = 8747        and HD.BENHVIEN_ID = '01819'        ) temp        group by temp.TIEPNHAN_ID]
2020-07-16 15:52:12,790 [1] DEBUG - Statement Id: [DAO00119_GetDanhsachHTTT] PreparedStatement : [select * from LST_DICTIONARY where DICTIONARY_TYPE_CODE = 'HinhThucThanhToan' and ENABLED = '1' and BENHVIEN_ID = '01819']
2020-07-16 15:52:12,820 [1] DEBUG - Statement Id: [DAO00021_GetListSoBienLai] PreparedStatement : [select            BLCT.BIENLAICHITIET_ID            ,BL.*                         ,BL.KYHIEU + '/' + SERIES AS 'KYHIEU_SOQUYEN'                         ,BLCT.START_NUMBER            ,BLCT.CURRENT_NUMBER            ,BLCT.HIEULUC            ,BLCT.NGUOISUDUNG_ID            from TT_BIENLAICHITIET BLCT            left join TT_BIENLAI BL on BL.BIENLAI_ID = BLCT.BIENLAI_ID            where            (bl.MAX_NUMBER > (select MAX(CURRENT_NUMBER) from TT_BIENLAICHITIET where BIENLAI_ID = BLCT.BIENLAI_ID) or BLCT.CURRENT_NUMBER is null)            and BLCT.HIEULUC = 1            and BLCT.NGUOISUDUNG_ID =   @param0             and BL.BENHVIEN_ID =  @param1                          order by BLCT.THOIGIANSUDUNG DESC]
2020-07-16 15:52:12,820 [1] DEBUG - Statement Id: [DAO00021_GetListSoBienLai] Parameters: [@param0=[NGUOISUDUNG_ID,1], @param1=[BENHVIEN_ID,01819]]
2020-07-16 15:52:12,820 [1] DEBUG - Statement Id: [DAO00021_GetListSoBienLai] Types: [@param0=[Int64, System.Int64], @param1=[String, System.String]]
2020-07-16 15:52:12,848 [1] DEBUG - Statement Id: [DAO00021_GetListSoBienLai] PreparedStatement : [select            BLCT.BIENLAICHITIET_ID            ,BL.*                         ,BL.KYHIEU + '/' + SERIES AS 'KYHIEU_SOQUYEN'                         ,BLCT.START_NUMBER            ,BLCT.CURRENT_NUMBER            ,BLCT.HIEULUC            ,BLCT.NGUOISUDUNG_ID            from TT_BIENLAICHITIET BLCT            left join TT_BIENLAI BL on BL.BIENLAI_ID = BLCT.BIENLAI_ID            where            (bl.MAX_NUMBER > (select MAX(CURRENT_NUMBER) from TT_BIENLAICHITIET where BIENLAI_ID = BLCT.BIENLAI_ID) or BLCT.CURRENT_NUMBER is null)            and BLCT.HIEULUC = 1            and BLCT.NGUOISUDUNG_ID =   @param0             and BL.BENHVIEN_ID =  @param1                          order by BLCT.THOIGIANSUDUNG DESC]
2020-07-16 15:52:12,848 [1] DEBUG - Statement Id: [DAO00021_GetListSoBienLai] Parameters: [@param0=[NGUOISUDUNG_ID,1], @param1=[BENHVIEN_ID,01819]]
2020-07-16 15:52:12,848 [1] DEBUG - Statement Id: [DAO00021_GetListSoBienLai] Types: [@param0=[Int64, System.Int64], @param1=[String, System.String]]
2020-07-16 15:52:12,875 [1] DEBUG - Statement Id: [DAO00021_GetListSoBienLai] PreparedStatement : [select            BLCT.BIENLAICHITIET_ID            ,BL.*                         ,BL.KYHIEU + '/' + SERIES AS 'KYHIEU_SOQUYEN'                         ,BLCT.START_NUMBER            ,BLCT.CURRENT_NUMBER            ,BLCT.HIEULUC            ,BLCT.NGUOISUDUNG_ID            from TT_BIENLAICHITIET BLCT            left join TT_BIENLAI BL on BL.BIENLAI_ID = BLCT.BIENLAI_ID            where            (bl.MAX_NUMBER > (select MAX(CURRENT_NUMBER) from TT_BIENLAICHITIET where BIENLAI_ID = BLCT.BIENLAI_ID) or BLCT.CURRENT_NUMBER is null)            and BLCT.HIEULUC = 1            and BLCT.NGUOISUDUNG_ID =   @param0             and BL.BENHVIEN_ID =  @param1              and               BLCT.BIENLAICHITIET_ID = '2002'                         order by BLCT.THOIGIANSUDUNG DESC]
2020-07-16 15:52:12,875 [1] DEBUG - Statement Id: [DAO00021_GetListSoBienLai] Parameters: [@param0=[NGUOISUDUNG_ID,1], @param1=[BENHVIEN_ID,01819]]
2020-07-16 15:52:12,875 [1] DEBUG - Statement Id: [DAO00021_GetListSoBienLai] Types: [@param0=[Int64, System.Int64], @param1=[String, System.String]]
2020-07-16 15:52:12,945 [1] DEBUG - Statement Id: [DAO00119_GetDanhsachHTTT] PreparedStatement : [select * from LST_DICTIONARY where DICTIONARY_TYPE_CODE = 'HinhThucThanhToan' and ENABLED = '1' and BENHVIEN_ID = '01819']
2020-07-16 15:52:13,019 [1] DEBUG - Statement Id: [DAO00119_GetDanhsachHTTT] PreparedStatement : [select * from LST_DICTIONARY where DICTIONARY_TYPE_CODE = 'HinhThucThanhToan' and ENABLED = '1' and BENHVIEN_ID = '01819']
2020-07-16 15:52:16,151 [1] DEBUG - Statement Id: [DAO00019_GetListDichVuDuocDongTien] PreparedStatement : [select * from        (        select COUNT(*) OVER() as TOTALROWS, ROW_NUMBER() OVER(order by tn.MAYTE, isnull(tn.SOTHUTU,'999999999')) as ROWNUMBER,        ISNULL(A.DUOC_ID, A.DICHVU_ID) as DICHVU_ID, ISNULL(B.TENDUOCDAYDU, C.TENDICHVU) as TENDICHVU,        (CASE WHEN A.DUOC_ID is null THEN E.NOITHUCHIEN_ID ELSE 0 END) as NOITHUCHIEN_ID,        0 as NOIYEUCAU_ID, 0 as NOIGIOITHIEU_ID, 0 as BACSICHIDINH_ID, isnull(E.NGAYTAO, E.NGAYCAPNHAT) as THOIGIANDKDICHVU,        tn.*, isnull(tn.SOTHUTU,'999999999') as SOHANGDOI, null as KHAN, '' as STATUS_CODE        from TT_VIENPHI A        left join TM_DUOC B on B.DUOC_ID = A.DUOC_ID and B.BENHVIEN_ID = '01819'        left join TM_DICHVU C on C.DICHVU_ID = A.DICHVU_ID and C.BENHVIEN_ID = '01819'        inner join        (        select A.TIEPNHAN_ID, A.SOTIEPNHAN, A.DOITUONG_ID, A.SOTHUTU, A.NGAYTIEPNHAN, B.*, C.TENDOITUONG from TT_TIEPNHAN A        inner join TT_BENHNHAN B on A.BENHNHAN_ID = B.BENHNHAN_ID        inner join TM_DOITUONG C on A.DOITUONG_ID = C.DOITUONG_ID        where A.TRANGTHAI in ('DATIEPNHAN', 'HOANTHANH') and A.BENHVIEN_ID = '01819'        ) tn on tn.TIEPNHAN_ID = A.TIEPNHAN_ID        left join TT_DVYEUCAU E on E.DVYEUCAU_ID = A.REF_ID        where        A.BENHAN_ID is null and        ((A.REF_TABLE = 'TT_DVYEUCAU' and E.HUYYEUCAU = '0') or (A.DUOC_ID is not null and A.DATHUCHIEN = '1')) and        ((A.DATHANHTOAN = '0' or A.DATHANHTOAN is null) and A.KHONGTHUTIEN = '0') and A.BENHVIEN_ID = '01819'           and               tn.NGAYTIEPNHAN >= '7/16/2020 12:00:00 AM'             and               tn.NGAYTIEPNHAN <= '7/16/2020 12:00:00 AM'                     ) lst                    where          lst.ROWNUMBER between 1 and 19                 order by MAYTE, SOHANGDOI asc]
2020-07-16 15:52:16,189 [1] DEBUG - Statement Id: [DAO00019_GetCountBenhNhanDichVuDuocDongTien] PreparedStatement : [select count(distinct tn.MAYTE) TOTAL_BENHNHAN        from TT_VIENPHI A        left join TM_DUOC B on B.DUOC_ID = A.DUOC_ID and B.BENHVIEN_ID = '01819'        left join TM_DICHVU C on C.DICHVU_ID = A.DICHVU_ID and C.BENHVIEN_ID = '01819'        inner join        (        select A.TIEPNHAN_ID, A.SOTIEPNHAN, A.DOITUONG_ID, A.SOTHUTU, A.NGAYTIEPNHAN, B.*, C.TENDOITUONG from TT_TIEPNHAN A        inner join TT_BENHNHAN B on A.BENHNHAN_ID = B.BENHNHAN_ID        inner join TM_DOITUONG C on A.DOITUONG_ID = C.DOITUONG_ID        where A.TRANGTHAI in ('DATIEPNHAN', 'HOANTHANH') and A.BENHVIEN_ID = '01819'        ) tn on tn.TIEPNHAN_ID = A.TIEPNHAN_ID        left join TT_DVYEUCAU E on E.DVYEUCAU_ID = A.REF_ID        where        A.BENHAN_ID is null and        ((A.REF_TABLE = 'TT_DVYEUCAU' and E.HUYYEUCAU = '0') or (A.DUOC_ID is not null and A.DATHUCHIEN = '1')) and        ((A.DATHANHTOAN = '0' or A.DATHANHTOAN is null) and A.KHONGTHUTIEN = '0') and A.BENHVIEN_ID = '01819'           and               tn.NGAYTIEPNHAN >= '7/16/2020 12:00:00 AM'             and               tn.NGAYTIEPNHAN <= '7/16/2020 12:00:00 AM']
2020-07-16 15:52:17,414 [1] DEBUG - Statement Id: [DAO00021_GetListSoBienLai] PreparedStatement : [select            BLCT.BIENLAICHITIET_ID            ,BL.*                         ,BL.KYHIEU + '/' + SERIES AS 'KYHIEU_SOQUYEN'                         ,BLCT.START_NUMBER            ,BLCT.CURRENT_NUMBER            ,BLCT.HIEULUC            ,BLCT.NGUOISUDUNG_ID            from TT_BIENLAICHITIET BLCT            left join TT_BIENLAI BL on BL.BIENLAI_ID = BLCT.BIENLAI_ID            where            (bl.MAX_NUMBER > (select MAX(CURRENT_NUMBER) from TT_BIENLAICHITIET where BIENLAI_ID = BLCT.BIENLAI_ID) or BLCT.CURRENT_NUMBER is null)            and BLCT.HIEULUC = 1            and BLCT.NGUOISUDUNG_ID =   @param0             and BL.BENHVIEN_ID =  @param1                          order by BLCT.THOIGIANSUDUNG DESC]
2020-07-16 15:52:17,414 [1] DEBUG - Statement Id: [DAO00021_GetListSoBienLai] Parameters: [@param0=[NGUOISUDUNG_ID,1], @param1=[BENHVIEN_ID,01819]]
2020-07-16 15:52:17,414 [1] DEBUG - Statement Id: [DAO00021_GetListSoBienLai] Types: [@param0=[Int64, System.Int64], @param1=[String, System.String]]
2020-07-16 15:52:17,453 [1] DEBUG - Statement Id: [DAO00021_GetListSoBienLai] PreparedStatement : [select            BLCT.BIENLAICHITIET_ID            ,BL.*                         ,BL.KYHIEU + '/' + SERIES AS 'KYHIEU_SOQUYEN'                         ,BLCT.START_NUMBER            ,BLCT.CURRENT_NUMBER            ,BLCT.HIEULUC            ,BLCT.NGUOISUDUNG_ID            from TT_BIENLAICHITIET BLCT            left join TT_BIENLAI BL on BL.BIENLAI_ID = BLCT.BIENLAI_ID            where            (bl.MAX_NUMBER > (select MAX(CURRENT_NUMBER) from TT_BIENLAICHITIET where BIENLAI_ID = BLCT.BIENLAI_ID) or BLCT.CURRENT_NUMBER is null)            and BLCT.HIEULUC = 1            and BLCT.NGUOISUDUNG_ID =   @param0             and BL.BENHVIEN_ID =  @param1              and               BLCT.BIENLAICHITIET_ID = '2002'                         order by BLCT.THOIGIANSUDUNG DESC]
2020-07-16 15:52:17,453 [1] DEBUG - Statement Id: [DAO00021_GetListSoBienLai] Parameters: [@param0=[NGUOISUDUNG_ID,1], @param1=[BENHVIEN_ID,01819]]
2020-07-16 15:52:17,453 [1] DEBUG - Statement Id: [DAO00021_GetListSoBienLai] Types: [@param0=[Int64, System.Int64], @param1=[String, System.String]]
2020-07-16 15:52:17,480 [1] DEBUG - Statement Id: [DAO00119_GetDanhsachHTTT] PreparedStatement : [select * from LST_DICTIONARY where DICTIONARY_TYPE_CODE = 'HinhThucThanhToan' and ENABLED = '1' and BENHVIEN_ID = '01819']
2020-07-16 15:52:17,542 [1] DEBUG - Statement Id: [DAO00119_GetLichSuThanhToan] PreparedStatement : [select        SUM(THANHTOAN) AS TONGDATHANHTOAN, SUM(TAMUNG) AS TONGTAMUNG, SUM(HOANUNG) AS TONGHOANUNG,        SUM(MIENGIAM) AS TONGMIENGIAM, SUM(THATTHU) AS TONGTHATTHU, TIEPNHAN_ID        from (        select HD.TIEPNHAN_ID,        CASE WHEN LOAIHOADON = 'TU' then HD.GIATRIHOADON ELSE 0 END TAMUNG,        CASE WHEN LOAIHOADON = 'HU' then HD.GIATRIHOADON ELSE 0 END HOANUNG,        CASE WHEN LOAIHOADON = 'BL' then HD.GIATRIHOADON ELSE 0 END THANHTOAN,        0 MIENGIAM,        0 THATTHU        from TT_HOADON HD        where HD.DATHANHTOAN = '1' and HD.HUYHOADON = '0' and HD.HOANTRA = '0'        and HD.TIEPNHAN_ID = 8747        and HD.BENHVIEN_ID = '01819'          Union          select HD.TIEPNHAN_ID,        0 TAMUNG,        0 HOANUNG,        0 THANHTOAN,        SUM(hdct.MIENGIAM_GIATRI) AS MIENGIAM,        SUM(hdct.BENHNHAN_PHAITHANHTOAN) - SUM(hdct.GIATRI_HOADON_DATHANHTOAN) AS THATTHU        from TT_HOADON HD        join TT_HOADON_CHITIET_NGOAITRU hdct on HD.HOADON_ID = hdct.HOADON_ID        where HD.DATHANHTOAN = '1' and HD.HUYHOADON = '0' and HD.HOANTRA = '0'        and HD.TIEPNHAN_ID = 8747        and HD.BENHVIEN_ID = '01819'        group by TIEPNHAN_ID        ) temp        group by temp.TIEPNHAN_ID]
2020-07-16 15:52:17,569 [1] DEBUG - Statement Id: [DAO00021_GetListSoBienLai] PreparedStatement : [select            BLCT.BIENLAICHITIET_ID            ,BL.*                         ,BL.KYHIEU + '/' + SERIES AS 'KYHIEU_SOQUYEN'                         ,BLCT.START_NUMBER            ,BLCT.CURRENT_NUMBER            ,BLCT.HIEULUC            ,BLCT.NGUOISUDUNG_ID            from TT_BIENLAICHITIET BLCT            left join TT_BIENLAI BL on BL.BIENLAI_ID = BLCT.BIENLAI_ID            where            (bl.MAX_NUMBER > (select MAX(CURRENT_NUMBER) from TT_BIENLAICHITIET where BIENLAI_ID = BLCT.BIENLAI_ID) or BLCT.CURRENT_NUMBER is null)            and BLCT.HIEULUC = 1            and BLCT.NGUOISUDUNG_ID =   @param0             and BL.BENHVIEN_ID =  @param1                          order by BLCT.THOIGIANSUDUNG DESC]
2020-07-16 15:52:17,569 [1] DEBUG - Statement Id: [DAO00021_GetListSoBienLai] Parameters: [@param0=[NGUOISUDUNG_ID,1], @param1=[BENHVIEN_ID,01819]]
2020-07-16 15:52:17,569 [1] DEBUG - Statement Id: [DAO00021_GetListSoBienLai] Types: [@param0=[Int64, System.Int64], @param1=[String, System.String]]
2020-07-16 15:52:17,595 [1] DEBUG - Statement Id: [DAO00021_GetListSoBienLai] PreparedStatement : [select            BLCT.BIENLAICHITIET_ID            ,BL.*                         ,BL.KYHIEU + '/' + SERIES AS 'KYHIEU_SOQUYEN'                         ,BLCT.START_NUMBER            ,BLCT.CURRENT_NUMBER            ,BLCT.HIEULUC            ,BLCT.NGUOISUDUNG_ID            from TT_BIENLAICHITIET BLCT            left join TT_BIENLAI BL on BL.BIENLAI_ID = BLCT.BIENLAI_ID            where            (bl.MAX_NUMBER > (select MAX(CURRENT_NUMBER) from TT_BIENLAICHITIET where BIENLAI_ID = BLCT.BIENLAI_ID) or BLCT.CURRENT_NUMBER is null)            and BLCT.HIEULUC = 1            and BLCT.NGUOISUDUNG_ID =   @param0             and BL.BENHVIEN_ID =  @param1                          order by BLCT.THOIGIANSUDUNG DESC]
2020-07-16 15:52:17,595 [1] DEBUG - Statement Id: [DAO00021_GetListSoBienLai] Parameters: [@param0=[NGUOISUDUNG_ID,1], @param1=[BENHVIEN_ID,01819]]
2020-07-16 15:52:17,595 [1] DEBUG - Statement Id: [DAO00021_GetListSoBienLai] Types: [@param0=[Int64, System.Int64], @param1=[String, System.String]]
2020-07-16 15:52:17,622 [1] DEBUG - Statement Id: [DAO00021_GetListSoBienLai] PreparedStatement : [select            BLCT.BIENLAICHITIET_ID            ,BL.*                         ,BL.KYHIEU + '/' + SERIES AS 'KYHIEU_SOQUYEN'                         ,BLCT.START_NUMBER            ,BLCT.CURRENT_NUMBER            ,BLCT.HIEULUC            ,BLCT.NGUOISUDUNG_ID            from TT_BIENLAICHITIET BLCT            left join TT_BIENLAI BL on BL.BIENLAI_ID = BLCT.BIENLAI_ID            where            (bl.MAX_NUMBER > (select MAX(CURRENT_NUMBER) from TT_BIENLAICHITIET where BIENLAI_ID = BLCT.BIENLAI_ID) or BLCT.CURRENT_NUMBER is null)            and BLCT.HIEULUC = 1            and BLCT.NGUOISUDUNG_ID =   @param0             and BL.BENHVIEN_ID =  @param1              and               BLCT.BIENLAICHITIET_ID = '2002'                         order by BLCT.THOIGIANSUDUNG DESC]
2020-07-16 15:52:17,622 [1] DEBUG - Statement Id: [DAO00021_GetListSoBienLai] Parameters: [@param0=[NGUOISUDUNG_ID,1], @param1=[BENHVIEN_ID,01819]]
2020-07-16 15:52:17,622 [1] DEBUG - Statement Id: [DAO00021_GetListSoBienLai] Types: [@param0=[Int64, System.Int64], @param1=[String, System.String]]
2020-07-16 15:52:17,655 [1] DEBUG - Statement Id: [DAO00064_GetlistTT_TIEPNHAN_SOTHEBHYT] PreparedStatement : [select stbhyt.*, ba.SOBENHAN,        tn.SOTIEPNHAN, tn.LOAITHANHVIEN_ID, tn.THE_ID, tn.THANHVIEN_ID,        tn.SUDUNG_BHTN, tn.BAOLANH_VIENPHI, tn.VIP, tn.NGUOINUOCNGOAI, tn.NGOAIGIO        from TT_TIEPNHAN_SOTHEBHYT stbhyt        left join TT_TIEPNHAN tn on tn.TIEPNHAN_ID = stbhyt.TIEPNHAN_ID        left join TT_NOITRU_BENHAN ba on ba.TIEPNHAN_ID = stbhyt.TIEPNHAN_ID        where        stbhyt.TIEPNHAN_ID = '8747' and isnull(stbhyt.KHONGSUDUNG, '0') = '0']
2020-07-16 15:52:17,679 [1] DEBUG - Statement Id: [DAO00064_GetListVienPhiByTiepNnan] PreparedStatement : [select distinct        B.DOITUONG_ID, B.NGAYMIENDONGCHITRA, B.BENHNHAN_ID as TIEPNHAN_BENHNHAN_ID, B.TRAITUYEN,        B.BHYTTREN3NAM as TREN3NAM, B.BHYTTREN5NAM as TREN5NAM, B.SOTIEPNHAN, B.SOBENHAN,        B.LOAITHANHVIEN_ID, B.SUDUNG_BHTN, B.THE_ID, B.THANHVIEN_ID, B.BAOLANH_VIENPHI, B.VIP, B.NGUOINUOCNGOAI,        C.GIATRIMIENGIAM as GIATRIMIENGIAM, D.GIATRIMIENGIAM as GIATRIMIENGIAM_BHTN, E.GIATRIMIENGIAM as GIATRIMIENGIAM_THANHVIEN,        F.GIATRIMIENGIAM as GIATRIMIENGIAM_CONGTY, DVYC.THE_ID as DVDUNGTHE, DVYC.TRANGTHAI as TRANGTHAIDICHVU, ndv.MANHOMDICHVU,        A.* from TT_VIENPHI A        left join        (select B.*, C.SOBENHAN, C.BENHAN_ID        from TT_TIEPNHAN B        left join TT_NOITRU_BENHAN C on B.TIEPNHAN_ID = C.TIEPNHAN_ID                 where B.TIEPNHAN_ID = '8747') B on B.TIEPNHAN_ID = A.TIEPNHAN_ID        left join (select sum(GIATRIMIENGIAM) as GIATRIMIENGIAM, VIENPHI_ID, REF_TABLE        from TT_MIENGIAM_CHITIET        where REF_TABLE = 'TT_MIENGIAM'        and exists (select MIENGIAM_ID from TT_MIENGIAM where TT_MIENGIAM_CHITIET.MIENGIAM_ID = MIENGIAM_ID and TINHTRANG = 1 and TIEPNHAN_ID = '8747')        group by VIENPHI_ID, REF_TABLE) C on C.REF_TABLE = 'TT_MIENGIAM' and C.VIENPHI_ID = A.VIENPHI_ID        left join (select sum(GIATRIMIENGIAM) as GIATRIMIENGIAM, VIENPHI_ID, REF_TABLE        from TT_MIENGIAM_CHITIET        where REF_TABLE = 'TT_MIENGIAM_BHTN'        and exists (select MIENGIAM_BHTN_ID from TT_MIENGIAM_BHTN where TT_MIENGIAM_CHITIET.MIENGIAM_ID = MIENGIAM_BHTN_ID and  TINHTRANG = 1 and TIEPNHAN_ID = '8747')        group by VIENPHI_ID, REF_TABLE) D on D.REF_TABLE = 'TT_MIENGIAM_BHTN' and D.VIENPHI_ID = A.VIENPHI_ID        left join (select sum(GIATRIMIENGIAM) as GIATRIMIENGIAM, VIENPHI_ID, REF_TABLE        from TT_MIENGIAM_CHITIET        where REF_TABLE = 'TT_MIENGIAM_THANHVIEN'        and exists (select MIENGIAM_THANHVIEN_ID from TT_MIENGIAM_THANHVIEN where TT_MIENGIAM_CHITIET.MIENGIAM_ID = MIENGIAM_THANHVIEN_ID and TINHTRANG = 1 and TIEPNHAN_ID = '8747')        group by VIENPHI_ID, REF_TABLE) E on E.REF_TABLE = 'TT_MIENGIAM_THANHVIEN' and E.VIENPHI_ID = A.VIENPHI_ID        left join (select sum(GIATRIMIENGIAM) as GIATRIMIENGIAM, VIENPHI_ID, REF_TABLE        from TT_MIENGIAM_CHITIET        where REF_TABLE = 'TT_MIENGIAM_CONGTY'        and exists (select MIENGIAM_CONGTY_ID from TT_MIENGIAM_CONGTY where TT_MIENGIAM_CHITIET.MIENGIAM_ID = MIENGIAM_CONGTY_ID and TINHTRANG = 1 and TIEPNHAN_ID = '8747')        group by VIENPHI_ID, REF_TABLE) F on F.REF_TABLE = 'TT_MIENGIAM_CONGTY' and F.VIENPHI_ID = A.VIENPHI_ID        left join TT_DVYEUCAU DVYC on DVYC.DVYEUCAU_ID = A.REF_ID and A.REF_TABLE = 'TT_DVYEUCAU'        left join TM_DICHVU DV on DVYC.DICHVU_ID = DV.DICHVU_ID and A.REF_TABLE = 'TT_DVYEUCAU'        left join TM_NHOMDICHVU ndv on ndv.NHOMDICHVU_ID = DV.NHOMDICHVU_ID and A.REF_TABLE = 'TT_DVYEUCAU'        where        A.TIEPNHAN_ID = '8747' and ((DVYC.HUYYEUCAU = '0' and A.DICHVU_ID is not null)        or A.DUOC_ID is not null or A.REF_TABLE = 'TT_NUT_XACNHANSUATAN_CHITIET')        and A.ACTIVE = '1'                 and A.BENHVIEN_ID = '01819'        order by A.VIENPHI_ID]
2020-07-16 15:52:17,705 [1] DEBUG - Statement Id: [DAO00006_GetListDuocTyle] PreparedStatement : [select DUOC_ID, DOITUONG_ID, (TYLE/100) as TYLE, DONGIA MUCTRAN_THANHTOAN from TM_DOITUONG_GIADUOC_TYLE            where            BENHVIEN_ID = '01819'            and DOITUONG_ID = '0']
2020-07-16 15:52:17,727 [1] DEBUG - Statement Id: [DAO00027_GetListTuongTrinhDichVuPhauThuatCuaTiepNhan] PreparedStatement : [declare @ManhomDSA varchar(10);        declare @PhanLoaiNhomDV varchar(20) = '05';        select top 1  @ManhomDSA = VALUE from TM_SYS_APPSETTINGS where CODE = 'MANHOM_DICHVU_DSA'        if (@ManhomDSA is not null) set @PhanLoaiNhomDV += ',' + @ManhomDSA        select distinct ptyc.*        from TT_PHAUTHUAT_YEUCAU ptyc        inner join TM_DICHVU dv on dv.DICHVU_ID = ptyc.DICHVU_ID        inner join TM_NHOMDICHVU ndv on ndv.NHOMDICHVU_ID = dv.NHOMDICHVU_ID        inner join TT_PHAUTHUAT pt on pt.PHAUTHUAT_ID = ptyc.PHAUTHUAT_ID        where        pt.TIEPNHAN_ID = 8747        and (left(ndv.MANHOMDICHVU, 2) in (select * from STRING_SPLIT(@PhanLoaiNhomDV,',')) or ndv.MANHOMDICHVU in (select * from STRING_SPLIT(@PhanLoaiNhomDV,',')))]
2020-07-16 15:52:17,754 [1] DEBUG - Statement Id: [DAO00006_GetList] PreparedStatement : [select dv.*, loaiDV.MALOAIDICHVU, captren.NHOMDICHVU_ID as NHOMDICHVU_CAPTREN_ID, captren.TENNHOMDICHVU as NHOMDICHVU_CAPTREN,              nhom_dv.TENNHOMDICHVU as TENNHOMDICHVU, nhom_dv.MANHOMDICHVU,              case when dv.ATTRIBUTE5 is null then 'TT' else 'KTC' end as LOAI_CHIPHI              from TM_DICHVU as dv              left join TM_NHOMDICHVU as nhom_dv on nhom_dv.NHOMDICHVU_ID = dv.NHOMDICHVU_ID and nhom_dv.BENHVIEN_ID = '01819'              left join TM_NHOMDICHVU as captren on nhom_dv.CAPTREN_ID = captren.NHOMDICHVU_ID and captren.BENHVIEN_ID = '01819'              left join TM_LOAIDICHVU loaiDV on nhom_dv.LOAIDICHVU_ID = loaiDV.LOAIDICHVU_ID and loaiDV.BENHVIEN_ID = '01819'              where nhom_dv.TAMNGUNG = '0' and dv.BENHVIEN_ID = '01819'              and dv.TAMNGUNG = '0'               AND                   loaiDV.MALOAIDICHVU = 'KhamBenh']
2020-07-16 15:52:17,821 [1] DEBUG - Statement Id: [DAO00023_UpdateNhieuVP] PreparedStatement : [declare @jsonVienPhi nvarchar(max) = N'[{"VIENPHI_ID":16000,"TIEPNHAN_ID":8747,"DICHVU_ID":3,"BENHAN_ID":0,"SOLUONG":1.0000,"DONGIA_DOANHTHU":38700.0000,"THANHTIEN_DOANHTHU":38700.00,"BHYT_TL":0.0,"BHYT_DONGIA":0.0,"BHYT_THANHTIEN":0.0,"BHYT_DONGIA_CONGKHAM_DAU":0.0,"BHYT_CONGKHAM_DAU_TYLE":0.0,"BHYT_DONGIA_CHITRA":0.0,"BHYT_THANHTIEN_CHITRA":0.0,"BENHNHAN_PHAITHANHTOAN":38700.00,"GIATRI_HOADON":0.0,"GIATRI_HOADON_DATHANHTOAN":0.0,"GIATRI_BIENLAI":0.0,"GIATRI_BIENLAI_DATHANHTOAN":0.0,"GIATRI_BENHNHAN_DATHANHTOAN":0.0,"DATHUCHIEN":"0","KHONGTHUTIEN":"0","BHYTDONGTIEN":"0","DICHVU_TL":1.0,"BHYT_DONGIA_DONGCT_DAU":0.0,"SOBHYT":null,"SOBHYT_HUONG_ID":8755,"GIATRIMIENGIAM":0.0,"GIATRIMIENGIAM_BHTN":0.0,"GIATRIMIENGIAM_THANHVIEN":0.0,"GIATRIMIENGIAM_CONGTY":0.0,"BHYT_CK2_KHONGTHANHTOAN":false,"SOLONHAP_ID":null,"DUOC_MUCTRAN_THANHTOAN":0.0,"DUOC_TYLE":0.0000}]';        begin        UPDATE TT_VIENPHI        SET        SOLUONG = json.SOLUONG,        DONGIA_DOANHTHU = json.DONGIA_DOANHTHU,        THANHTIEN_DOANHTHU = json.THANHTIEN_DOANHTHU,        BHYT_TL = json.BHYT_TL,        BHYT_DONGIA = json.BHYT_DONGIA,        BHYT_THANHTIEN = json.BHYT_THANHTIEN,        BHYT_DONGIA_CONGKHAM_DAU = json.BHYT_DONGIA_CONGKHAM_DAU,        BHYT_CONGKHAM_DAU_TYLE = json.BHYT_CONGKHAM_DAU_TYLE,        BHYT_DONGIA_CHITRA = json.BHYT_DONGIA_CHITRA,        BHYT_THANHTIEN_CHITRA = json.BHYT_THANHTIEN_CHITRA,        BENHNHAN_PHAITHANHTOAN = json.BENHNHAN_PHAITHANHTOAN,        GIATRI_HOADON = json.GIATRI_HOADON,        GIATRI_BIENLAI = json.GIATRI_BIENLAI,        DATHUCHIEN = json.DATHUCHIEN,        DICHVU_TL = json.DICHVU_TL,        BHYT_DONGIA_DONGCT_DAU = json.BHYT_DONGIA_DONGCT_DAU,        SOLONHAP_ID = json.SOLONHAP_ID,        DUOC_TYLE = json.DUOC_TYLE,        DUOC_MUCTRAN_THANHTOAN = json.DUOC_MUCTRAN_THANHTOAN,        NGAYCAPNHAT = GETDATE()        FROM OPENJSON (@jsonVienPhi)        WITH (        VIENPHI_ID int,        SOLUONG numeric(25, 4),        DONGIA_DOANHTHU numeric(25, 4),        THANHTIEN_DOANHTHU numeric(25, 4),        BHYT_TL numeric(25, 4),        BHYT_DONGIA numeric(25, 4),        BHYT_THANHTIEN numeric(25, 4),        BHYT_DONGIA_CONGKHAM_DAU numeric(25, 4),        BHYT_CONGKHAM_DAU_TYLE numeric(25, 4),        BHYT_DONGIA_CHITRA numeric(25, 4),        BHYT_THANHTIEN_CHITRA numeric(25, 4),        BENHNHAN_PHAITHANHTOAN numeric(25, 4),        GIATRI_HOADON numeric(25, 4),        GIATRI_BIENLAI numeric(25, 4),        DATHUCHIEN char(1),        KHONGTHUTIEN char(1),        BHYTDONGTIEN char(1),        DICHVU_TL numeric(25, 4),        BHYT_DONGIA_DONGCT_DAU numeric(25, 4),        SOLONHAP_ID int,        DUOC_TYLE numeric(25, 4),        DUOC_MUCTRAN_THANHTOAN numeric(25, 4))  json        WHERE TT_VIENPHI.VIENPHI_ID = json.VIENPHI_ID and json.DONGIA_DOANHTHU > 0                  insert into TT_TINH_VIENPHI_LOG        SELECT json.VIENPHI_ID, json.TIEPNHAN_ID, json.BENHAN_ID, json.SOLUONG, json.BHYT_TL, json.DONGIA_DOANHTHU,        json.THANHTIEN_DOANHTHU, json.BHYT_DONGIA, json.BHYT_THANHTIEN, json.BHYT_DONGIA_CHITRA, json.BHYT_THANHTIEN_CHITRA, json.BENHNHAN_PHAITHANHTOAN,        json.SOBHYT_HUONG_ID, json.SOBHYT, GETDATE(), -1, '01819'        FROM OPENJSON(@jsonVienPhi)        WITH (        VIENPHI_ID int,        TIEPNHAN_ID int,        BENHAN_ID int,        SOLUONG numeric(25, 4),        DONGIA_DOANHTHU numeric(25, 4),        THANHTIEN_DOANHTHU numeric(25, 4),        BHYT_TL numeric(25, 4),        BHYT_DONGIA numeric(25, 4),        BHYT_THANHTIEN numeric(25, 4),        BHYT_DONGIA_CHITRA numeric(25, 4),        BHYT_THANHTIEN_CHITRA numeric(25, 4),        BENHNHAN_PHAITHANHTOAN numeric(25, 4),        SOBHYT_HUONG_ID int,        SOBHYT nvarchar(30)) json        end]
2020-07-16 15:52:17,848 [1] DEBUG - Statement Id: [DAO00067_UpdateDataVienPhiDongiaBHYT] PreparedStatement : [update TT_VIENPHI          set BHYT_DONGIA_CHITRA = 0, BHYT_THANHTIEN = 0, BHYT_THANHTIEN_CHITRA = 0          where          TIEPNHAN_ID = 8747 and BHYT_DONGIA = 0          and (BHYT_DONGIA_CHITRA > 0 or BHYT_THANHTIEN > 0 or BHYT_THANHTIEN_CHITRA > 0)]
2020-07-16 15:52:17,872 [1] DEBUG - Statement Id: [DAO00067_CapnhatDataVienphiKhiHuyThanhtoanHoadon] PreparedStatement : [update TT_VIENPHI        set TT_VIENPHI.HOADON_ID = hdct.HOADON_ID, TT_VIENPHI.GIATRI_BENHNHAN_DATHANHTOAN = TT_VIENPHI.GIATRI_BENHNHAN_DATHANHTOAN + hdct.GIATRI_BENHNHAN_DATHANHTOAN        from (select CT.HOADON_ID, CT.VIENPHI_ID, CT.GIATRI_BENHNHAN_DATHANHTOAN        from TT_HOADON_CHITIET_NGOAITRU CT        join TT_HOADON HD on HD.HOADON_ID = CT.HOADON_ID        join TT_VIENPHI vp on vp.VIENPHI_ID = ct.VIENPHI_ID        where HD.DATHANHTOAN = 1 and HD.HUYHOADON = 0 and HD.HOANTRA = 0 and vp.TIEPNHAN_ID =  @param0 ) hdct        where        TT_VIENPHI.VIENPHI_ID = hdct.VIENPHI_ID and TT_VIENPHI.HOADON_ID is null and isnull(TT_VIENPHI.GIATRI_BENHNHAN_DATHANHTOAN,0) = 0        and TT_VIENPHI.TIEPNHAN_ID =  @param0           update TT_VIENPHI        set TT_VIENPHI.HOADON_ID = null, TT_VIENPHI.GIATRI_BENHNHAN_DATHANHTOAN = TT_VIENPHI.GIATRI_BENHNHAN_DATHANHTOAN - hdct.GIATRI_BENHNHAN_DATHANHTOAN,        TT_VIENPHI.DATHANHTOAN = '0'        from (select CT.HOADON_ID, CT.VIENPHI_ID, CT.GIATRI_BENHNHAN_DATHANHTOAN        from TT_HOADON_CHITIET_NGOAITRU CT        join TT_HOADON HD on HD.HOADON_ID = CT.HOADON_ID        join TT_VIENPHI vp on vp.VIENPHI_ID = ct.VIENPHI_ID and vp.HOADON_ID = ct.HOADON_ID        where HD.DATHANHTOAN = 0 and (HD.HUYHOADON = 1 or HD.HOANTRA = 1) and vp.TIEPNHAN_ID =  @param0 ) hdct        where        TT_VIENPHI.VIENPHI_ID = hdct.VIENPHI_ID and TT_VIENPHI.HOADON_ID = hdct.HOADON_ID        and TT_VIENPHI.TIEPNHAN_ID =  @param0]
2020-07-16 15:52:17,872 [1] DEBUG - Statement Id: [DAO00067_CapnhatDataVienphiKhiHuyThanhtoanHoadon] Parameters: [@param0=[TIEPNHAN_ID,8747]]
2020-07-16 15:52:17,872 [1] DEBUG - Statement Id: [DAO00067_CapnhatDataVienphiKhiHuyThanhtoanHoadon] Types: [@param0=[Int64, System.Int64]]
2020-07-16 15:52:17,900 [1] DEBUG - Statement Id: [DAO00119_TT_VIENPHI_GetList_TiepNhanPhaiThanhToan] PreparedStatement : [select distinct  a.*, b.GIATRIMIENGIAM_BH, c.GIATRIMIENGIAM_BHTN, f.GIATRIMIENGIAM_THANHVIEN, g.GIATRIMIENGIAM_CTCT,        isnull(dv.TENDICHVU, dc.TENDUOCDAYDU) NOIDUNG, isnull(dv.MADICHVU, dc.MADUOC) MADICHVU, dv.NORESULT, dc.DONVITINH, ld.MALOAIDUOC, dc.BHYT DUOC_BHYT, ld.LOAIVATTU_ID, ndv.MANHOMDICHVU        from        (select VP.*, isnull(c.TRANGTHAI, '') TRANGTHAI, c.THUTIENSAU, c.NOITHUCHIEN_ID,        CASE        when REF_TABLE = 'TT_NGOAITRU_TOATHUOC' then ntkb.PHONGBAN_ID        when REF_TABLE = 'TT_CLSKETQUA_VTYT' then clsvtyt.PHONGBAN_ID        when REF_TABLE = 'TT_NGOAITRU_KHAMBENH_VTYT' then kbd.PHONGBAN_ID        ELSE        c.NOIYEUCAU_ID        END NOIYEUCAU_ID,        CASE        when REF_TABLE = 'TT_NGOAITRU_TOATHUOC' then ngtd.KHOXUAT_ID        when REF_TABLE = 'TT_CLSKETQUA_VTYT' then clsvtyt.KHOTAO_ID        when REF_TABLE = 'TT_NGOAITRU_KHAMBENH_VTYT' then kbd.KHOTAO_ID        ELSE null        END KHODUOC_ID          from TT_VIENPHI VP        left join TT_DVYEUCAU c on c.DVYEUCAU_ID = VP.REF_ID  and vp.REF_TABLE = 'TT_DVYEUCAU'        left join TT_NGOAITRU_TOATHUOC nttt on nttt.TOATHUOC_ID = vp.REF_ID and vp.REF_TABLE = 'TT_NGOAITRU_TOATHUOC'        left join TT_NGOAITRU_KHAMBENH_TOATHUOC ngtd on ngtd.KHAMBENH_TOATHUOC_ID = nttt.KHAMBENH_TOATHUOC_ID        left join TT_CLSKETQUA_VTYT clsvtyt on clsvtyt.CLSKETQUA_ID = vp.REF_ID and REF_TABLE = 'TT_CLSKETQUA_VTYT'        left join TT_NGOAITRU_KHAMBENH_VTYT kbd on kbd.KHAMBENH_VTYT_ID = vp.REF_ID and REF_TABLE = 'TT_NGOAITRU_KHAMBENH_VTYT'        left join TT_NGOAITRU_KHAMBENH ntkb on ntkb.KHAMBENH_ID = vp.KHAMBENH_ID and REF_TABLE = 'TT_NGOAITRU_TOATHUOC'          where Vp.TIEPNHAN_ID = '8747' and Vp.ACTIVE = '1' and ((c.HUYYEUCAU != '1' and vp.DICHVU_ID is not null) or (vp.DUOC_ID is not null)) and        ((vp.DATHANHTOAN = '0') or (vp.BENHNHAN_PHAITHANHTOAN > vp.GIATRI_BENHNHAN_DATHANHTOAN and vp.DATHANHTOAN = '1')) and c.DANGKY_CHITIET_ID is null        and vp.REF_TABLE != 'TT_MAU_CHUNGTU_CHITIET'        and vp.REF_TABLE != 'TT_DUOC_CHUNGTU_CHITIET'          AND             VP.KHONGTHUTIEN != '1'                   ) a        left join TM_DUOC dc on a.DUOC_ID = dc.DUOC_ID        left join TM_LOAIDUOC ld on dc.LOAIDUOC_ID = ld.LOAIDUOC_ID        left join TM_DICHVU dv on a.DICHVU_ID = dv.DICHVU_ID and a.REF_TABLE = 'TT_DVYEUCAU'        left join TM_NHOMDICHVU ndv on ndv.NHOMDICHVU_ID = dv.NHOMDICHVU_ID        left join (select VIENPHI_ID,        sum(MGCT.GIATRIMIENGIAM) AS GIATRIMIENGIAM_BH from TT_MIENGIAM MG        INNER JOIN TT_MIENGIAM_CHITIET MGCT ON MG.MIENGIAM_ID = MGCT.MIENGIAM_ID        where MG.TIEPNHAN_ID= '8747' and MGCT.REF_TABLE = 'TT_MIENGIAM' and MG.TINHTRANG = 1 group by VIENPHI_ID        ) b on a.VIENPHI_ID = b.VIENPHI_ID          left join (select VIENPHI_ID, sum(MGCT.GIATRIMIENGIAM) AS GIATRIMIENGIAM_BHTN        from TT_MIENGIAM_BHTN MG        INNER JOIN TT_MIENGIAM_CHITIET MGCT ON MG.MIENGIAM_BHTN_ID = MGCT.MIENGIAM_ID        where  MG.TIEPNHAN_ID= '8747' and MGCT.REF_TABLE = 'TT_MIENGIAM_BHTN' and MG.TINHTRANG = 1 group by VIENPHI_ID        )c on a.VIENPHI_ID = c.VIENPHI_ID          left join (select VIENPHI_ID, sum(MGCT.GIATRIMIENGIAM) AS GIATRIMIENGIAM_THANHVIEN        from TT_MIENGIAM_THANHVIEN MG        INNER JOIN TT_MIENGIAM_CHITIET MGCT ON MG.MIENGIAM_THANHVIEN_ID = MGCT.MIENGIAM_ID        where MG.TIEPNHAN_ID= '8747' and MGCT.REF_TABLE = 'TT_MIENGIAM_THANHVIEN' and MG.TINHTRANG = 1 group by VIENPHI_ID        )f on a.VIENPHI_ID = f.VIENPHI_ID          left join(select VIENPHI_ID, sum(MGCT.GIATRIMIENGIAM) AS GIATRIMIENGIAM_CTCT        from TT_MIENGIAM_CONGTY MG        INNER JOIN TT_MIENGIAM_CHITIET MGCT ON MG.MIENGIAM_CONGTY_ID = MGCT.MIENGIAM_ID        where MG.TIEPNHAN_ID= '8747' and MGCT.REF_TABLE = 'TT_MIENGIAM_CONGTY' and MG.TINHTRANG = 1 group by VIENPHI_ID        )g on a.VIENPHI_ID = g.VIENPHI_ID]
2020-07-16 15:52:17,926 [1] DEBUG - Statement Id: [DAO00330_TT_VIENPHI_GetList_TiepNhanPhaiThanhToan] PreparedStatement : [select distinct  a.*, b.GIATRIMIENGIAM_BH, c.GIATRIMIENGIAM_BHTN, f.GIATRIMIENGIAM_THANHVIEN, g.GIATRIMIENGIAM_CTCT        from        (select VP.*,NULL AS NOITHUCHIEN_ID, DK.NOICHIDINH_ID as NOIYEUCAU_ID, NULL AS THUTIENSAU, isnull(DK.TRANGTHAI, '') TRANGTHAI,        M.TENMAU AS NOIDUNG, M.MAMAU AS MADICHVU, NULL AS NORESULT, DVT.TENDONVITINH AS DONVITINH, LM.MALOAIMAU AS MALOAIDUOC, M.BHYT AS DUOC_BHYT, 'M' AS LOAIVATTU_ID, NM.TENNHOMMAU AS MANHOMDICHVU        from TT_VIENPHI VP        INNER JOIN TT_MAU_CHUNGTU_CHITIET CT ON VP.REF_ID=CT.CHUNGTUCHITIET_ID AND VP.REF_TABLE='TT_MAU_CHUNGTU_CHITIET' AND CT.BENHVIEN_ID='01819'        INNER JOIN TT_MAU_CHUNGTU CTU ON CT.CHUNGTU_ID=CTU.CHUNGTU_ID AND CTU.CHUNGTULIENQUAN_ID IS NULL        INNER join TM_MAU M on CT.MAU_ID = M.MAU_ID        LEFT JOIN TM_MAU_DONVITINH DVT ON M.DONVITINH_ID = DVT.DONVITINH_ID        LEFT JOIN TT_MAU_DANGKYMAU_CHITIET DKCT ON DKCT.CHUNGTU_ID = CTU.CHUNGTU_ID AND DKCT.BENHVIEN_ID='01819'        LEFT JOIN TT_MAU_DANGKYMAU DK ON DK.DANGKYMAU_ID = DKCT.DANGKYMAU_ID        LEFT JOIN TM_MAU_LOAIMAU LM ON LM.LOAIMAU_ID = M.LOAIMAU_ID        LEFT JOIN TM_MAU_NHOMMAU NM ON NM.NHOMMAU_ID = LM.NHOMMAU_ID        where Vp.TIEPNHAN_ID = '8747' and Vp.ACTIVE = '1' and vp.DUOC_ID is not null and        ((vp.DATHANHTOAN = '0') or (vp.BENHNHAN_PHAITHANHTOAN > vp.GIATRI_BENHNHAN_DATHANHTOAN and vp.DATHANHTOAN = '1'))   AND             VP.KHONGTHUTIEN != '1'                   ) a        left join (select VIENPHI_ID,        sum(MGCT.GIATRIMIENGIAM) AS GIATRIMIENGIAM_BH from TT_MIENGIAM MG        INNER JOIN TT_MIENGIAM_CHITIET MGCT ON MG.MIENGIAM_ID = MGCT.MIENGIAM_ID        where MG.TIEPNHAN_ID= '8747' and MGCT.REF_TABLE = 'TT_MIENGIAM' and MG.TINHTRANG = 1 group by VIENPHI_ID        ) b on a.VIENPHI_ID = b.VIENPHI_ID          left join (select VIENPHI_ID, sum(MGCT.GIATRIMIENGIAM) AS GIATRIMIENGIAM_BHTN        from TT_MIENGIAM_BHTN MG        INNER JOIN TT_MIENGIAM_CHITIET MGCT ON MG.MIENGIAM_BHTN_ID = MGCT.MIENGIAM_ID        where  MG.TIEPNHAN_ID= '8747' and MGCT.REF_TABLE = 'TT_MIENGIAM_BHTN' and MG.TINHTRANG = 1 group by VIENPHI_ID        )c on a.VIENPHI_ID = c.VIENPHI_ID          left join (select VIENPHI_ID, sum(MGCT.GIATRIMIENGIAM) AS GIATRIMIENGIAM_THANHVIEN        from TT_MIENGIAM_THANHVIEN MG        INNER JOIN TT_MIENGIAM_CHITIET MGCT ON MG.MIENGIAM_THANHVIEN_ID = MGCT.MIENGIAM_ID        where MG.TIEPNHAN_ID= '8747' and MGCT.REF_TABLE = 'TT_MIENGIAM_THANHVIEN' and MG.TINHTRANG = 1 group by VIENPHI_ID        )f on a.VIENPHI_ID = f.VIENPHI_ID          left join(select VIENPHI_ID, sum(MGCT.GIATRIMIENGIAM) AS GIATRIMIENGIAM_CTCT        from TT_MIENGIAM_CONGTY MG        INNER JOIN TT_MIENGIAM_CHITIET MGCT ON MG.MIENGIAM_CONGTY_ID = MGCT.MIENGIAM_ID        where MG.TIEPNHAN_ID= '8747' and MGCT.REF_TABLE = 'TT_MIENGIAM_CONGTY' and MG.TINHTRANG = 1 group by VIENPHI_ID        )g on a.VIENPHI_ID = g.VIENPHI_ID]
2020-07-16 15:52:17,959 [1] DEBUG - Statement Id: [DAO00119_GetDataTamUng_HoaUng] PreparedStatement : [select SUM(TAMUNG) AS TONGTIEN_TU, SUM(HOANUNG) AS TONGTIEN_HU, TIEPNHAN_ID        from (        select HD.TIEPNHAN_ID,        CASE WHEN LOAIHOADON = 'TU' then HD.GIATRIHOADON ELSE 0 END TAMUNG,        CASE WHEN LOAIHOADON = 'HU' then HD.GIATRIHOADON ELSE 0 END HOANUNG        from TT_HOADON HD        where HD.DATHANHTOAN = '1' and HD.HUYHOADON = '0' and HD.HOANTRA = '0'        and HD.TIEPNHAN_ID = 8747        and HD.BENHVIEN_ID = '01819'        ) temp        group by temp.TIEPNHAN_ID]
2020-07-16 15:52:17,985 [1] DEBUG - Statement Id: [DAO00119_TT_VIENPHI_GetList_TiepNhanPhaiThanhToan] PreparedStatement : [select distinct  a.*, b.GIATRIMIENGIAM_BH, c.GIATRIMIENGIAM_BHTN, f.GIATRIMIENGIAM_THANHVIEN, g.GIATRIMIENGIAM_CTCT,        isnull(dv.TENDICHVU, dc.TENDUOCDAYDU) NOIDUNG, isnull(dv.MADICHVU, dc.MADUOC) MADICHVU, dv.NORESULT, dc.DONVITINH, ld.MALOAIDUOC, dc.BHYT DUOC_BHYT, ld.LOAIVATTU_ID, ndv.MANHOMDICHVU        from        (select VP.*, isnull(c.TRANGTHAI, '') TRANGTHAI, c.THUTIENSAU, c.NOITHUCHIEN_ID,        CASE        when REF_TABLE = 'TT_NGOAITRU_TOATHUOC' then ntkb.PHONGBAN_ID        when REF_TABLE = 'TT_CLSKETQUA_VTYT' then clsvtyt.PHONGBAN_ID        when REF_TABLE = 'TT_NGOAITRU_KHAMBENH_VTYT' then kbd.PHONGBAN_ID        ELSE        c.NOIYEUCAU_ID        END NOIYEUCAU_ID,        CASE        when REF_TABLE = 'TT_NGOAITRU_TOATHUOC' then ngtd.KHOXUAT_ID        when REF_TABLE = 'TT_CLSKETQUA_VTYT' then clsvtyt.KHOTAO_ID        when REF_TABLE = 'TT_NGOAITRU_KHAMBENH_VTYT' then kbd.KHOTAO_ID        ELSE null        END KHODUOC_ID          from TT_VIENPHI VP        left join TT_DVYEUCAU c on c.DVYEUCAU_ID = VP.REF_ID  and vp.REF_TABLE = 'TT_DVYEUCAU'        left join TT_NGOAITRU_TOATHUOC nttt on nttt.TOATHUOC_ID = vp.REF_ID and vp.REF_TABLE = 'TT_NGOAITRU_TOATHUOC'        left join TT_NGOAITRU_KHAMBENH_TOATHUOC ngtd on ngtd.KHAMBENH_TOATHUOC_ID = nttt.KHAMBENH_TOATHUOC_ID        left join TT_CLSKETQUA_VTYT clsvtyt on clsvtyt.CLSKETQUA_ID = vp.REF_ID and REF_TABLE = 'TT_CLSKETQUA_VTYT'        left join TT_NGOAITRU_KHAMBENH_VTYT kbd on kbd.KHAMBENH_VTYT_ID = vp.REF_ID and REF_TABLE = 'TT_NGOAITRU_KHAMBENH_VTYT'        left join TT_NGOAITRU_KHAMBENH ntkb on ntkb.KHAMBENH_ID = vp.KHAMBENH_ID and REF_TABLE = 'TT_NGOAITRU_TOATHUOC'          where Vp.TIEPNHAN_ID = '8747' and Vp.ACTIVE = '1' and ((c.HUYYEUCAU != '1' and vp.DICHVU_ID is not null) or (vp.DUOC_ID is not null)) and        ((vp.DATHANHTOAN = '0') or (vp.BENHNHAN_PHAITHANHTOAN > vp.GIATRI_BENHNHAN_DATHANHTOAN and vp.DATHANHTOAN = '1')) and c.DANGKY_CHITIET_ID is null        and vp.REF_TABLE != 'TT_MAU_CHUNGTU_CHITIET'        and vp.REF_TABLE != 'TT_DUOC_CHUNGTU_CHITIET'          AND             VP.KHONGTHUTIEN != '1'                   ) a        left join TM_DUOC dc on a.DUOC_ID = dc.DUOC_ID        left join TM_LOAIDUOC ld on dc.LOAIDUOC_ID = ld.LOAIDUOC_ID        left join TM_DICHVU dv on a.DICHVU_ID = dv.DICHVU_ID and a.REF_TABLE = 'TT_DVYEUCAU'        left join TM_NHOMDICHVU ndv on ndv.NHOMDICHVU_ID = dv.NHOMDICHVU_ID        left join (select VIENPHI_ID,        sum(MGCT.GIATRIMIENGIAM) AS GIATRIMIENGIAM_BH from TT_MIENGIAM MG        INNER JOIN TT_MIENGIAM_CHITIET MGCT ON MG.MIENGIAM_ID = MGCT.MIENGIAM_ID        where MG.TIEPNHAN_ID= '8747' and MGCT.REF_TABLE = 'TT_MIENGIAM' and MG.TINHTRANG = 1 group by VIENPHI_ID        ) b on a.VIENPHI_ID = b.VIENPHI_ID          left join (select VIENPHI_ID, sum(MGCT.GIATRIMIENGIAM) AS GIATRIMIENGIAM_BHTN        from TT_MIENGIAM_BHTN MG        INNER JOIN TT_MIENGIAM_CHITIET MGCT ON MG.MIENGIAM_BHTN_ID = MGCT.MIENGIAM_ID        where  MG.TIEPNHAN_ID= '8747' and MGCT.REF_TABLE = 'TT_MIENGIAM_BHTN' and MG.TINHTRANG = 1 group by VIENPHI_ID        )c on a.VIENPHI_ID = c.VIENPHI_ID          left join (select VIENPHI_ID, sum(MGCT.GIATRIMIENGIAM) AS GIATRIMIENGIAM_THANHVIEN        from TT_MIENGIAM_THANHVIEN MG        INNER JOIN TT_MIENGIAM_CHITIET MGCT ON MG.MIENGIAM_THANHVIEN_ID = MGCT.MIENGIAM_ID        where MG.TIEPNHAN_ID= '8747' and MGCT.REF_TABLE = 'TT_MIENGIAM_THANHVIEN' and MG.TINHTRANG = 1 group by VIENPHI_ID        )f on a.VIENPHI_ID = f.VIENPHI_ID          left join(select VIENPHI_ID, sum(MGCT.GIATRIMIENGIAM) AS GIATRIMIENGIAM_CTCT        from TT_MIENGIAM_CONGTY MG        INNER JOIN TT_MIENGIAM_CHITIET MGCT ON MG.MIENGIAM_CONGTY_ID = MGCT.MIENGIAM_ID        where MG.TIEPNHAN_ID= '8747' and MGCT.REF_TABLE = 'TT_MIENGIAM_CONGTY' and MG.TINHTRANG = 1 group by VIENPHI_ID        )g on a.VIENPHI_ID = g.VIENPHI_ID]
2020-07-16 15:52:18,011 [1] DEBUG - Statement Id: [DAO00330_TT_VIENPHI_GetList_TiepNhanPhaiThanhToan] PreparedStatement : [select distinct  a.*, b.GIATRIMIENGIAM_BH, c.GIATRIMIENGIAM_BHTN, f.GIATRIMIENGIAM_THANHVIEN, g.GIATRIMIENGIAM_CTCT        from        (select VP.*,NULL AS NOITHUCHIEN_ID, DK.NOICHIDINH_ID as NOIYEUCAU_ID, NULL AS THUTIENSAU, isnull(DK.TRANGTHAI, '') TRANGTHAI,        M.TENMAU AS NOIDUNG, M.MAMAU AS MADICHVU, NULL AS NORESULT, DVT.TENDONVITINH AS DONVITINH, LM.MALOAIMAU AS MALOAIDUOC, M.BHYT AS DUOC_BHYT, 'M' AS LOAIVATTU_ID, NM.TENNHOMMAU AS MANHOMDICHVU        from TT_VIENPHI VP        INNER JOIN TT_MAU_CHUNGTU_CHITIET CT ON VP.REF_ID=CT.CHUNGTUCHITIET_ID AND VP.REF_TABLE='TT_MAU_CHUNGTU_CHITIET' AND CT.BENHVIEN_ID='01819'        INNER JOIN TT_MAU_CHUNGTU CTU ON CT.CHUNGTU_ID=CTU.CHUNGTU_ID AND CTU.CHUNGTULIENQUAN_ID IS NULL        INNER join TM_MAU M on CT.MAU_ID = M.MAU_ID        LEFT JOIN TM_MAU_DONVITINH DVT ON M.DONVITINH_ID = DVT.DONVITINH_ID        LEFT JOIN TT_MAU_DANGKYMAU_CHITIET DKCT ON DKCT.CHUNGTU_ID = CTU.CHUNGTU_ID AND DKCT.BENHVIEN_ID='01819'        LEFT JOIN TT_MAU_DANGKYMAU DK ON DK.DANGKYMAU_ID = DKCT.DANGKYMAU_ID        LEFT JOIN TM_MAU_LOAIMAU LM ON LM.LOAIMAU_ID = M.LOAIMAU_ID        LEFT JOIN TM_MAU_NHOMMAU NM ON NM.NHOMMAU_ID = LM.NHOMMAU_ID        where Vp.TIEPNHAN_ID = '8747' and Vp.ACTIVE = '1' and vp.DUOC_ID is not null and        ((vp.DATHANHTOAN = '0') or (vp.BENHNHAN_PHAITHANHTOAN > vp.GIATRI_BENHNHAN_DATHANHTOAN and vp.DATHANHTOAN = '1'))   AND             VP.KHONGTHUTIEN != '1'                   ) a        left join (select VIENPHI_ID,        sum(MGCT.GIATRIMIENGIAM) AS GIATRIMIENGIAM_BH from TT_MIENGIAM MG        INNER JOIN TT_MIENGIAM_CHITIET MGCT ON MG.MIENGIAM_ID = MGCT.MIENGIAM_ID        where MG.TIEPNHAN_ID= '8747' and MGCT.REF_TABLE = 'TT_MIENGIAM' and MG.TINHTRANG = 1 group by VIENPHI_ID        ) b on a.VIENPHI_ID = b.VIENPHI_ID          left join (select VIENPHI_ID, sum(MGCT.GIATRIMIENGIAM) AS GIATRIMIENGIAM_BHTN        from TT_MIENGIAM_BHTN MG        INNER JOIN TT_MIENGIAM_CHITIET MGCT ON MG.MIENGIAM_BHTN_ID = MGCT.MIENGIAM_ID        where  MG.TIEPNHAN_ID= '8747' and MGCT.REF_TABLE = 'TT_MIENGIAM_BHTN' and MG.TINHTRANG = 1 group by VIENPHI_ID        )c on a.VIENPHI_ID = c.VIENPHI_ID          left join (select VIENPHI_ID, sum(MGCT.GIATRIMIENGIAM) AS GIATRIMIENGIAM_THANHVIEN        from TT_MIENGIAM_THANHVIEN MG        INNER JOIN TT_MIENGIAM_CHITIET MGCT ON MG.MIENGIAM_THANHVIEN_ID = MGCT.MIENGIAM_ID        where MG.TIEPNHAN_ID= '8747' and MGCT.REF_TABLE = 'TT_MIENGIAM_THANHVIEN' and MG.TINHTRANG = 1 group by VIENPHI_ID        )f on a.VIENPHI_ID = f.VIENPHI_ID          left join(select VIENPHI_ID, sum(MGCT.GIATRIMIENGIAM) AS GIATRIMIENGIAM_CTCT        from TT_MIENGIAM_CONGTY MG        INNER JOIN TT_MIENGIAM_CHITIET MGCT ON MG.MIENGIAM_CONGTY_ID = MGCT.MIENGIAM_ID        where MG.TIEPNHAN_ID= '8747' and MGCT.REF_TABLE = 'TT_MIENGIAM_CONGTY' and MG.TINHTRANG = 1 group by VIENPHI_ID        )g on a.VIENPHI_ID = g.VIENPHI_ID]
2020-07-16 15:52:18,044 [1] DEBUG - Statement Id: [DAO00119_GetDataTamUng_HoaUng] PreparedStatement : [select SUM(TAMUNG) AS TONGTIEN_TU, SUM(HOANUNG) AS TONGTIEN_HU, TIEPNHAN_ID        from (        select HD.TIEPNHAN_ID,        CASE WHEN LOAIHOADON = 'TU' then HD.GIATRIHOADON ELSE 0 END TAMUNG,        CASE WHEN LOAIHOADON = 'HU' then HD.GIATRIHOADON ELSE 0 END HOANUNG        from TT_HOADON HD        where HD.DATHANHTOAN = '1' and HD.HUYHOADON = '0' and HD.HOANTRA = '0'        and HD.TIEPNHAN_ID = 8747        and HD.BENHVIEN_ID = '01819'        ) temp        group by temp.TIEPNHAN_ID]
2020-07-16 15:52:18,099 [1] DEBUG - Statement Id: [DAO00403_QMS002_GetThongTinClient] PreparedStatement : [SELECT B.ID as QUEUE_ID, B.NAME AS QUEUE_NAME,A.ID AS CLIENT_ID , A.[NAME] AS CLIENT_NAME, ISNULL(A.[STATE],1) AS [STATE],(CASE C.NAME WHEN 'UT' THEN 1 ELSE 0 END) AS QUEUETYPE     , B.DEPARTMENT_ID,ISNULL(B.SECTION_ID,-1) AS SECTION_ID,A.IPSERVER,A.NAMEAUDIO,C.QUEUE_TYPE_CODE,C.QUEUE_TYPE_CODE_SOUND,S.[NAME] AS SECTIONNAME     FROM QMS_QUEUE B LEFT JOIN QMS_CLIENT A ON A.QUEUE_ID = B.ID     LEFT JOIN QMS_QUEUE_TYPE C ON B.QUEUETYPE_ID = C.ID     LEFT JOIN QMS_SECTION S ON B.SECTION_ID=S.ID     WHERE     (A.COMPUTERNAME = 'DESKTOP-89GE5BA' OR A.IPADDRESS = '10.15.167.38') AND A.[STATE] = 1 AND B.DEPARTMENT_ID='74'            AND B.BENHVIEN_ID = '01819']
2020-07-16 15:52:18,122 [1] DEBUG - Statement Id: [DAO00101_GetListSuatAn] PreparedStatement : [SELECT        kP.KHAUPHANAN_ID,        kP.MAKHAUPHANAN,        kP.TENKHAUPHANAN,        LKP.LOAIKHAUPHANAN_ID,        LKP.MALOAIKHAUPHANAN,        LKP.TENLOAIKHAUPHANAN,        DG.DONGIA,        kP.HANGMUC_ID        FROM TM_NUT_KHAUPHANAN kP        INNER JOIN TM_NUT_LOAIKHAUPHANAN LKP ON  kP.LOAIKHAUPHANAN_ID = LKP.LOAIKHAUPHANAN_ID        INNER JOIN TM_NUT_KHAUPHANAN_DONGIA DG ON DG.KHAUPHANAN_ID = kP.KHAUPHANAN_ID        WHERE DG.DONGIA IS NOT NULL]
2020-07-16 15:52:26,587 [1] DEBUG - Statement Id: [DAO00119_TT_VIENPHI_GetList_TiepNhanPhaiThanhToan] PreparedStatement : [select distinct  a.*, b.GIATRIMIENGIAM_BH, c.GIATRIMIENGIAM_BHTN, f.GIATRIMIENGIAM_THANHVIEN, g.GIATRIMIENGIAM_CTCT,        isnull(dv.TENDICHVU, dc.TENDUOCDAYDU) NOIDUNG, isnull(dv.MADICHVU, dc.MADUOC) MADICHVU, dv.NORESULT, dc.DONVITINH, ld.MALOAIDUOC, dc.BHYT DUOC_BHYT, ld.LOAIVATTU_ID, ndv.MANHOMDICHVU        from        (select VP.*, isnull(c.TRANGTHAI, '') TRANGTHAI, c.THUTIENSAU, c.NOITHUCHIEN_ID,        CASE        when REF_TABLE = 'TT_NGOAITRU_TOATHUOC' then ntkb.PHONGBAN_ID        when REF_TABLE = 'TT_CLSKETQUA_VTYT' then clsvtyt.PHONGBAN_ID        when REF_TABLE = 'TT_NGOAITRU_KHAMBENH_VTYT' then kbd.PHONGBAN_ID        ELSE        c.NOIYEUCAU_ID        END NOIYEUCAU_ID,        CASE        when REF_TABLE = 'TT_NGOAITRU_TOATHUOC' then ngtd.KHOXUAT_ID        when REF_TABLE = 'TT_CLSKETQUA_VTYT' then clsvtyt.KHOTAO_ID        when REF_TABLE = 'TT_NGOAITRU_KHAMBENH_VTYT' then kbd.KHOTAO_ID        ELSE null        END KHODUOC_ID          from TT_VIENPHI VP        left join TT_DVYEUCAU c on c.DVYEUCAU_ID = VP.REF_ID  and vp.REF_TABLE = 'TT_DVYEUCAU'        left join TT_NGOAITRU_TOATHUOC nttt on nttt.TOATHUOC_ID = vp.REF_ID and vp.REF_TABLE = 'TT_NGOAITRU_TOATHUOC'        left join TT_NGOAITRU_KHAMBENH_TOATHUOC ngtd on ngtd.KHAMBENH_TOATHUOC_ID = nttt.KHAMBENH_TOATHUOC_ID        left join TT_CLSKETQUA_VTYT clsvtyt on clsvtyt.CLSKETQUA_ID = vp.REF_ID and REF_TABLE = 'TT_CLSKETQUA_VTYT'        left join TT_NGOAITRU_KHAMBENH_VTYT kbd on kbd.KHAMBENH_VTYT_ID = vp.REF_ID and REF_TABLE = 'TT_NGOAITRU_KHAMBENH_VTYT'        left join TT_NGOAITRU_KHAMBENH ntkb on ntkb.KHAMBENH_ID = vp.KHAMBENH_ID and REF_TABLE = 'TT_NGOAITRU_TOATHUOC'          where Vp.TIEPNHAN_ID = '8747' and Vp.ACTIVE = '1' and ((c.HUYYEUCAU != '1' and vp.DICHVU_ID is not null) or (vp.DUOC_ID is not null)) and        ((vp.DATHANHTOAN = '0') or (vp.BENHNHAN_PHAITHANHTOAN > vp.GIATRI_BENHNHAN_DATHANHTOAN and vp.DATHANHTOAN = '1')) and c.DANGKY_CHITIET_ID is null        and vp.REF_TABLE != 'TT_MAU_CHUNGTU_CHITIET'        and vp.REF_TABLE != 'TT_DUOC_CHUNGTU_CHITIET'          AND             VP.KHONGTHUTIEN != '1'                   ) a        left join TM_DUOC dc on a.DUOC_ID = dc.DUOC_ID        left join TM_LOAIDUOC ld on dc.LOAIDUOC_ID = ld.LOAIDUOC_ID        left join TM_DICHVU dv on a.DICHVU_ID = dv.DICHVU_ID and a.REF_TABLE = 'TT_DVYEUCAU'        left join TM_NHOMDICHVU ndv on ndv.NHOMDICHVU_ID = dv.NHOMDICHVU_ID        left join (select VIENPHI_ID,        sum(MGCT.GIATRIMIENGIAM) AS GIATRIMIENGIAM_BH from TT_MIENGIAM MG        INNER JOIN TT_MIENGIAM_CHITIET MGCT ON MG.MIENGIAM_ID = MGCT.MIENGIAM_ID        where MG.TIEPNHAN_ID= '8747' and MGCT.REF_TABLE = 'TT_MIENGIAM' and MG.TINHTRANG = 1 group by VIENPHI_ID        ) b on a.VIENPHI_ID = b.VIENPHI_ID          left join (select VIENPHI_ID, sum(MGCT.GIATRIMIENGIAM) AS GIATRIMIENGIAM_BHTN        from TT_MIENGIAM_BHTN MG        INNER JOIN TT_MIENGIAM_CHITIET MGCT ON MG.MIENGIAM_BHTN_ID = MGCT.MIENGIAM_ID        where  MG.TIEPNHAN_ID= '8747' and MGCT.REF_TABLE = 'TT_MIENGIAM_BHTN' and MG.TINHTRANG = 1 group by VIENPHI_ID        )c on a.VIENPHI_ID = c.VIENPHI_ID          left join (select VIENPHI_ID, sum(MGCT.GIATRIMIENGIAM) AS GIATRIMIENGIAM_THANHVIEN        from TT_MIENGIAM_THANHVIEN MG        INNER JOIN TT_MIENGIAM_CHITIET MGCT ON MG.MIENGIAM_THANHVIEN_ID = MGCT.MIENGIAM_ID        where MG.TIEPNHAN_ID= '8747' and MGCT.REF_TABLE = 'TT_MIENGIAM_THANHVIEN' and MG.TINHTRANG = 1 group by VIENPHI_ID        )f on a.VIENPHI_ID = f.VIENPHI_ID          left join(select VIENPHI_ID, sum(MGCT.GIATRIMIENGIAM) AS GIATRIMIENGIAM_CTCT        from TT_MIENGIAM_CONGTY MG        INNER JOIN TT_MIENGIAM_CHITIET MGCT ON MG.MIENGIAM_CONGTY_ID = MGCT.MIENGIAM_ID        where MG.TIEPNHAN_ID= '8747' and MGCT.REF_TABLE = 'TT_MIENGIAM_CONGTY' and MG.TINHTRANG = 1 group by VIENPHI_ID        )g on a.VIENPHI_ID = g.VIENPHI_ID]
2020-07-16 15:52:26,613 [1] DEBUG - Statement Id: [DAO00330_TT_VIENPHI_GetList_TiepNhanPhaiThanhToan] PreparedStatement : [select distinct  a.*, b.GIATRIMIENGIAM_BH, c.GIATRIMIENGIAM_BHTN, f.GIATRIMIENGIAM_THANHVIEN, g.GIATRIMIENGIAM_CTCT        from        (select VP.*,NULL AS NOITHUCHIEN_ID, DK.NOICHIDINH_ID as NOIYEUCAU_ID, NULL AS THUTIENSAU, isnull(DK.TRANGTHAI, '') TRANGTHAI,        M.TENMAU AS NOIDUNG, M.MAMAU AS MADICHVU, NULL AS NORESULT, DVT.TENDONVITINH AS DONVITINH, LM.MALOAIMAU AS MALOAIDUOC, M.BHYT AS DUOC_BHYT, 'M' AS LOAIVATTU_ID, NM.TENNHOMMAU AS MANHOMDICHVU        from TT_VIENPHI VP        INNER JOIN TT_MAU_CHUNGTU_CHITIET CT ON VP.REF_ID=CT.CHUNGTUCHITIET_ID AND VP.REF_TABLE='TT_MAU_CHUNGTU_CHITIET' AND CT.BENHVIEN_ID='01819'        INNER JOIN TT_MAU_CHUNGTU CTU ON CT.CHUNGTU_ID=CTU.CHUNGTU_ID AND CTU.CHUNGTULIENQUAN_ID IS NULL        INNER join TM_MAU M on CT.MAU_ID = M.MAU_ID        LEFT JOIN TM_MAU_DONVITINH DVT ON M.DONVITINH_ID = DVT.DONVITINH_ID        LEFT JOIN TT_MAU_DANGKYMAU_CHITIET DKCT ON DKCT.CHUNGTU_ID = CTU.CHUNGTU_ID AND DKCT.BENHVIEN_ID='01819'        LEFT JOIN TT_MAU_DANGKYMAU DK ON DK.DANGKYMAU_ID = DKCT.DANGKYMAU_ID        LEFT JOIN TM_MAU_LOAIMAU LM ON LM.LOAIMAU_ID = M.LOAIMAU_ID        LEFT JOIN TM_MAU_NHOMMAU NM ON NM.NHOMMAU_ID = LM.NHOMMAU_ID        where Vp.TIEPNHAN_ID = '8747' and Vp.ACTIVE = '1' and vp.DUOC_ID is not null and        ((vp.DATHANHTOAN = '0') or (vp.BENHNHAN_PHAITHANHTOAN > vp.GIATRI_BENHNHAN_DATHANHTOAN and vp.DATHANHTOAN = '1'))   AND             VP.KHONGTHUTIEN != '1'                   ) a        left join (select VIENPHI_ID,        sum(MGCT.GIATRIMIENGIAM) AS GIATRIMIENGIAM_BH from TT_MIENGIAM MG        INNER JOIN TT_MIENGIAM_CHITIET MGCT ON MG.MIENGIAM_ID = MGCT.MIENGIAM_ID        where MG.TIEPNHAN_ID= '8747' and MGCT.REF_TABLE = 'TT_MIENGIAM' and MG.TINHTRANG = 1 group by VIENPHI_ID        ) b on a.VIENPHI_ID = b.VIENPHI_ID          left join (select VIENPHI_ID, sum(MGCT.GIATRIMIENGIAM) AS GIATRIMIENGIAM_BHTN        from TT_MIENGIAM_BHTN MG        INNER JOIN TT_MIENGIAM_CHITIET MGCT ON MG.MIENGIAM_BHTN_ID = MGCT.MIENGIAM_ID        where  MG.TIEPNHAN_ID= '8747' and MGCT.REF_TABLE = 'TT_MIENGIAM_BHTN' and MG.TINHTRANG = 1 group by VIENPHI_ID        )c on a.VIENPHI_ID = c.VIENPHI_ID          left join (select VIENPHI_ID, sum(MGCT.GIATRIMIENGIAM) AS GIATRIMIENGIAM_THANHVIEN        from TT_MIENGIAM_THANHVIEN MG        INNER JOIN TT_MIENGIAM_CHITIET MGCT ON MG.MIENGIAM_THANHVIEN_ID = MGCT.MIENGIAM_ID        where MG.TIEPNHAN_ID= '8747' and MGCT.REF_TABLE = 'TT_MIENGIAM_THANHVIEN' and MG.TINHTRANG = 1 group by VIENPHI_ID        )f on a.VIENPHI_ID = f.VIENPHI_ID          left join(select VIENPHI_ID, sum(MGCT.GIATRIMIENGIAM) AS GIATRIMIENGIAM_CTCT        from TT_MIENGIAM_CONGTY MG        INNER JOIN TT_MIENGIAM_CHITIET MGCT ON MG.MIENGIAM_CONGTY_ID = MGCT.MIENGIAM_ID        where MG.TIEPNHAN_ID= '8747' and MGCT.REF_TABLE = 'TT_MIENGIAM_CONGTY' and MG.TINHTRANG = 1 group by VIENPHI_ID        )g on a.VIENPHI_ID = g.VIENPHI_ID]
2020-07-16 15:52:26,648 [1] DEBUG - Statement Id: [DAO00119_GetDataTamUng_HoaUng] PreparedStatement : [select SUM(TAMUNG) AS TONGTIEN_TU, SUM(HOANUNG) AS TONGTIEN_HU, TIEPNHAN_ID        from (        select HD.TIEPNHAN_ID,        CASE WHEN LOAIHOADON = 'TU' then HD.GIATRIHOADON ELSE 0 END TAMUNG,        CASE WHEN LOAIHOADON = 'HU' then HD.GIATRIHOADON ELSE 0 END HOANUNG        from TT_HOADON HD        where HD.DATHANHTOAN = '1' and HD.HUYHOADON = '0' and HD.HOANTRA = '0'        and HD.TIEPNHAN_ID = 8747        and HD.BENHVIEN_ID = '01819'        ) temp        group by temp.TIEPNHAN_ID]
2020-07-16 15:52:28,769 [1] DEBUG - Statement Id: [DAO00021_GetListSoBienLai] PreparedStatement : [select            BLCT.BIENLAICHITIET_ID            ,BL.*                         ,BL.KYHIEU + '/' + SERIES AS 'KYHIEU_SOQUYEN'                         ,BLCT.START_NUMBER            ,BLCT.CURRENT_NUMBER            ,BLCT.HIEULUC            ,BLCT.NGUOISUDUNG_ID            from TT_BIENLAICHITIET BLCT            left join TT_BIENLAI BL on BL.BIENLAI_ID = BLCT.BIENLAI_ID            where            (bl.MAX_NUMBER > (select MAX(CURRENT_NUMBER) from TT_BIENLAICHITIET where BIENLAI_ID = BLCT.BIENLAI_ID) or BLCT.CURRENT_NUMBER is null)            and BLCT.HIEULUC = 1            and BLCT.NGUOISUDUNG_ID =   @param0             and BL.BENHVIEN_ID =  @param1              and               BLCT.BIENLAICHITIET_ID = '2002'                         order by BLCT.THOIGIANSUDUNG DESC]
2020-07-16 15:52:28,769 [1] DEBUG - Statement Id: [DAO00021_GetListSoBienLai] Parameters: [@param0=[NGUOISUDUNG_ID,1], @param1=[BENHVIEN_ID,01819]]
2020-07-16 15:52:28,769 [1] DEBUG - Statement Id: [DAO00021_GetListSoBienLai] Types: [@param0=[Int64, System.Int64], @param1=[String, System.String]]
2020-07-16 15:52:49,673 [1] DEBUG - Statement Id: [DAO00119_CanhBaoSoBienLai_Conlai] PreparedStatement : [declare @intSohdConlai int = null;        declare @intCanhbanSohdConlai int = null;          begin        select @intCanhbanSohdConlai = VALUE from TM_SYS_APPSETTINGS where CODE = 'BIL_SOLUONG_CANHBAO_SAPHET_HOADON'        if @intCanhbanSohdConlai is null set @intCanhbanSohdConlai = 0          select top 1        BLCT.CURRENT_NUMBER, BLCT.START_NUMBER        , BL.MAX_NUMBER, (BL.KYHIEU + '/' + SERIES) KYHIEU_SOQUYEN, (BL.MAX_NUMBER - BLCT.CURRENT_NUMBER) SOCONLAI        from        TT_BIENLAI BL,TT_BIENLAICHITIET BLCT        where        BL.BIENLAI_ID = BLCT.BIENLAI_ID        and BLCT.HIEULUC = 1        and exists (select BIENLAI_ID from TT_BIENLAICHITIET where BIENLAICHITIET_ID = '2002' and BLCT.BIENLAI_ID = BIENLAI_ID)        and @intCanhbanSohdConlai >= (BL.MAX_NUMBER - BLCT.CURRENT_NUMBER)        order by CURRENT_NUMBER DESC        end]
2020-07-16 15:52:49,724 [1] DEBUG - Statement Id: [DAO00014_GetPatientStatus] PreparedStatement : [select        CASE        when tn.TRANGTHAI = 'HOANTHANH' Then tn.TRANGTHAI        WHEN xncp.XACNHANCHIPHI_ID is not null THEN 'XACNHANCHIPHI'        WHEN (tn.KHOADULIEU = '1') THEN 'KHOADULIEU'        ELSE tn.TRANGTHAI        END        as TRANGTHAI        from TT_TIEPNHAN tn        left join TT_XACNHANCHIPHI xncp on tn.TIEPNHAN_ID = xncp.TIEPNHAN_ID        where tn.TIEPNHAN_ID = '8747'        and tn.BENHVIEN_ID = '01819']
2020-07-16 15:52:49,803 [1] DEBUG - Statement Id: [DAO00119_TT_VIENPHI_GetList_TiepNhanPhaiThanhToanWithVienphiId] PreparedStatement : [select  a.*, b.GIATRIMIENGIAM_BH, c.GIATRIMIENGIAM_BHTN, f.GIATRIMIENGIAM_THANHVIEN, g.GIATRIMIENGIAM_CTCT        from        (select VP.*, c.NOITHUCHIEN_ID, c.NOIYEUCAU_ID, c.HUYYEUCAU        from TT_VIENPHI VP        left join TT_DVYEUCAU c on c.DVYEUCAU_ID = VP.REF_ID  and vp.REF_TABLE = 'TT_DVYEUCAU'        where        VP.REF_TABLE != 'TT_MAU_CHUNGTU_CHITIET' and        Vp.TIEPNHAN_ID = '8747' and Vp.ACTIVE = '1' and ((c.HUYYEUCAU != '1' and vp.DICHVU_ID is not null) or (vp.DUOC_ID is not null)) and        ((vp.DATHANHTOAN = '0') or (vp.BENHNHAN_PHAITHANHTOAN > vp.GIATRI_BENHNHAN_DATHANHTOAN and vp.DATHANHTOAN = '1')) and c.DANGKY_CHITIET_ID is null        and vp.VIENPHI_ID in (16000)) a          left join (select VIENPHI_ID,        sum(MGCT.GIATRIMIENGIAM) AS GIATRIMIENGIAM_BH from TT_MIENGIAM MG        INNER JOIN TT_MIENGIAM_CHITIET MGCT ON MG.MIENGIAM_ID = MGCT.MIENGIAM_ID        where MG.TIEPNHAN_ID= '8747' and MGCT.REF_TABLE = 'TT_MIENGIAM' and MG.TINHTRANG = 1 group by VIENPHI_ID        ) b on a.VIENPHI_ID = b.VIENPHI_ID          left join (select VIENPHI_ID, sum(MGCT.GIATRIMIENGIAM) AS GIATRIMIENGIAM_BHTN        from TT_MIENGIAM_BHTN MG        INNER JOIN TT_MIENGIAM_CHITIET MGCT ON MG.MIENGIAM_BHTN_ID = MGCT.MIENGIAM_ID        where  MG.TIEPNHAN_ID= '8747' and MGCT.REF_TABLE = 'TT_MIENGIAM_BHTN' and MG.TINHTRANG = 1 group by VIENPHI_ID        )c on a.VIENPHI_ID = c.VIENPHI_ID          left join (select VIENPHI_ID, sum(MGCT.GIATRIMIENGIAM) AS GIATRIMIENGIAM_THANHVIEN        from TT_MIENGIAM_THANHVIEN MG        INNER JOIN TT_MIENGIAM_CHITIET MGCT ON MG.MIENGIAM_THANHVIEN_ID = MGCT.MIENGIAM_ID        where MG.TIEPNHAN_ID= '8747' and MGCT.REF_TABLE = 'TT_MIENGIAM_THANHVIEN' and MG.TINHTRANG = 1 group by VIENPHI_ID        )f on a.VIENPHI_ID = f.VIENPHI_ID          left join(select VIENPHI_ID, sum(MGCT.GIATRIMIENGIAM) AS GIATRIMIENGIAM_CTCT        from TT_MIENGIAM_CONGTY MG        INNER JOIN TT_MIENGIAM_CHITIET MGCT ON MG.MIENGIAM_CONGTY_ID = MGCT.MIENGIAM_ID        where MG.TIEPNHAN_ID= '8747' and MGCT.REF_TABLE = 'TT_MIENGIAM_CONGTY' and MG.TINHTRANG = 1 group by VIENPHI_ID        )g on a.VIENPHI_ID = g.VIENPHI_ID        WHERE a.REF_TABLE!='TT_MAU_CHUNGTU_CHITIET']
2020-07-16 15:52:49,828 [1] DEBUG - Statement Id: [DAO00330_TT_VIENPHI_GetList_TiepNhanPhaiThanhToanWithVienphiId] PreparedStatement : [select  a.*, b.GIATRIMIENGIAM_BH, c.GIATRIMIENGIAM_BHTN, f.GIATRIMIENGIAM_THANHVIEN, g.GIATRIMIENGIAM_CTCT        from        (select VP.*, null NOITHUCHIEN_ID, dk.NOICHIDINH_ID as NOIYEUCAU_ID, '0' as HUYYEUCAU        from TT_VIENPHI VP        INNER JOIN TT_MAU_CHUNGTU_CHITIET CT ON VP.REF_ID=CT.CHUNGTUCHITIET_ID AND VP.REF_TABLE='TT_MAU_CHUNGTU_CHITIET' AND CT.BENHVIEN_ID='01819'        INNER JOIN TT_MAU_CHUNGTU CTU ON CT.CHUNGTU_ID=CTU.CHUNGTU_ID AND CTU.CHUNGTULIENQUAN_ID IS NULL        LEFT JOIN TT_MAU_DANGKYMAU_CHITIET DKCT ON DKCT.CHUNGTU_ID = CTU.CHUNGTU_ID AND DKCT.BENHVIEN_ID='01819'        LEFT JOIN TT_MAU_DANGKYMAU DK ON DK.DANGKYMAU_ID = DKCT.DANGKYMAU_ID        where Vp.TIEPNHAN_ID = '8747' and Vp.ACTIVE = '1' and vp.DUOC_ID is not null and        ((vp.DATHANHTOAN = '0') or (vp.BENHNHAN_PHAITHANHTOAN > vp.GIATRI_BENHNHAN_DATHANHTOAN and vp.DATHANHTOAN = '1'))        and vp.VIENPHI_ID in (16000)) a          left join (select VIENPHI_ID,        sum(MGCT.GIATRIMIENGIAM) AS GIATRIMIENGIAM_BH from TT_MIENGIAM MG        INNER JOIN TT_MIENGIAM_CHITIET MGCT ON MG.MIENGIAM_ID = MGCT.MIENGIAM_ID        where MG.TIEPNHAN_ID= '8747' and MGCT.REF_TABLE = 'TT_MIENGIAM' and MG.TINHTRANG = 1 group by VIENPHI_ID        ) b on a.VIENPHI_ID = b.VIENPHI_ID          left join (select VIENPHI_ID, sum(MGCT.GIATRIMIENGIAM) AS GIATRIMIENGIAM_BHTN        from TT_MIENGIAM_BHTN MG        INNER JOIN TT_MIENGIAM_CHITIET MGCT ON MG.MIENGIAM_BHTN_ID = MGCT.MIENGIAM_ID        where  MG.TIEPNHAN_ID= '8747' and MGCT.REF_TABLE = 'TT_MIENGIAM_BHTN' and MG.TINHTRANG = 1 group by VIENPHI_ID        )c on a.VIENPHI_ID = c.VIENPHI_ID          left join (select VIENPHI_ID, sum(MGCT.GIATRIMIENGIAM) AS GIATRIMIENGIAM_THANHVIEN        from TT_MIENGIAM_THANHVIEN MG        INNER JOIN TT_MIENGIAM_CHITIET MGCT ON MG.MIENGIAM_THANHVIEN_ID = MGCT.MIENGIAM_ID        where MG.TIEPNHAN_ID= '8747' and MGCT.REF_TABLE = 'TT_MIENGIAM_THANHVIEN' and MG.TINHTRANG = 1 group by VIENPHI_ID        )f on a.VIENPHI_ID = f.VIENPHI_ID          left join(select VIENPHI_ID, sum(MGCT.GIATRIMIENGIAM) AS GIATRIMIENGIAM_CTCT        from TT_MIENGIAM_CONGTY MG        INNER JOIN TT_MIENGIAM_CHITIET MGCT ON MG.MIENGIAM_CONGTY_ID = MGCT.MIENGIAM_ID        where MG.TIEPNHAN_ID= '8747' and MGCT.REF_TABLE = 'TT_MIENGIAM_CONGTY' and MG.TINHTRANG = 1 group by VIENPHI_ID        )g on a.VIENPHI_ID = g.VIENPHI_ID]
2020-07-16 15:52:49,853 [1] DEBUG - Statement Id: [DAO00119_TT_VIENPHI_GetList_VPHienTai] PreparedStatement : [select * from TT_VIENPHI vp        where        ((vp.DATHANHTOAN = '0') or (vp.BENHNHAN_PHAITHANHTOAN > vp.GIATRI_BENHNHAN_DATHANHTOAN and vp.DATHANHTOAN = '1'))        and VIENPHI_ID in (16000)         and           TIEPNHAN_ID = '8747']
2020-07-16 15:52:49,878 [1] DEBUG - Statement Id: [DAO00021_GetListSoBienLai] PreparedStatement : [select            BLCT.BIENLAICHITIET_ID            ,BL.*                         ,BL.KYHIEU + '/' + SERIES AS 'KYHIEU_SOQUYEN'                         ,BLCT.START_NUMBER            ,BLCT.CURRENT_NUMBER            ,BLCT.HIEULUC            ,BLCT.NGUOISUDUNG_ID            from TT_BIENLAICHITIET BLCT            left join TT_BIENLAI BL on BL.BIENLAI_ID = BLCT.BIENLAI_ID            where            (bl.MAX_NUMBER > (select MAX(CURRENT_NUMBER) from TT_BIENLAICHITIET where BIENLAI_ID = BLCT.BIENLAI_ID) or BLCT.CURRENT_NUMBER is null)            and BLCT.HIEULUC = 1            and BLCT.NGUOISUDUNG_ID =   @param0             and BL.BENHVIEN_ID =  @param1                          order by BLCT.THOIGIANSUDUNG DESC]
2020-07-16 15:52:49,878 [1] DEBUG - Statement Id: [DAO00021_GetListSoBienLai] Parameters: [@param0=[NGUOISUDUNG_ID,1], @param1=[BENHVIEN_ID,01819]]
2020-07-16 15:52:49,878 [1] DEBUG - Statement Id: [DAO00021_GetListSoBienLai] Types: [@param0=[Int64, System.Int64], @param1=[String, System.String]]
2020-07-16 15:52:49,905 [1] DEBUG - Statement Id: [DAO00021_GetListSoBienLai] PreparedStatement : [select            BLCT.BIENLAICHITIET_ID            ,BL.*                         ,BL.KYHIEU + '/' + SERIES AS 'KYHIEU_SOQUYEN'                         ,BLCT.START_NUMBER            ,BLCT.CURRENT_NUMBER            ,BLCT.HIEULUC            ,BLCT.NGUOISUDUNG_ID            from TT_BIENLAICHITIET BLCT            left join TT_BIENLAI BL on BL.BIENLAI_ID = BLCT.BIENLAI_ID            where            (bl.MAX_NUMBER > (select MAX(CURRENT_NUMBER) from TT_BIENLAICHITIET where BIENLAI_ID = BLCT.BIENLAI_ID) or BLCT.CURRENT_NUMBER is null)            and BLCT.HIEULUC = 1            and BLCT.NGUOISUDUNG_ID =   @param0             and BL.BENHVIEN_ID =  @param1                          order by BLCT.THOIGIANSUDUNG DESC]
2020-07-16 15:52:49,905 [1] DEBUG - Statement Id: [DAO00021_GetListSoBienLai] Parameters: [@param0=[NGUOISUDUNG_ID,1], @param1=[BENHVIEN_ID,01819]]
2020-07-16 15:52:49,905 [1] DEBUG - Statement Id: [DAO00021_GetListSoBienLai] Types: [@param0=[Int64, System.Int64], @param1=[String, System.String]]
2020-07-16 15:52:49,933 [1] DEBUG - Statement Id: [DAO00021_GetListSoBienLai] PreparedStatement : [select            BLCT.BIENLAICHITIET_ID            ,BL.*                         ,BL.KYHIEU + '/' + SERIES AS 'KYHIEU_SOQUYEN'                         ,BLCT.START_NUMBER            ,BLCT.CURRENT_NUMBER            ,BLCT.HIEULUC            ,BLCT.NGUOISUDUNG_ID            from TT_BIENLAICHITIET BLCT            left join TT_BIENLAI BL on BL.BIENLAI_ID = BLCT.BIENLAI_ID            where            (bl.MAX_NUMBER > (select MAX(CURRENT_NUMBER) from TT_BIENLAICHITIET where BIENLAI_ID = BLCT.BIENLAI_ID) or BLCT.CURRENT_NUMBER is null)            and BLCT.HIEULUC = 1            and BLCT.NGUOISUDUNG_ID =   @param0             and BL.BENHVIEN_ID =  @param1              and               BLCT.BIENLAICHITIET_ID = '2002'                         order by BLCT.THOIGIANSUDUNG DESC]
2020-07-16 15:52:49,933 [1] DEBUG - Statement Id: [DAO00021_GetListSoBienLai] Parameters: [@param0=[NGUOISUDUNG_ID,1], @param1=[BENHVIEN_ID,01819]]
2020-07-16 15:52:49,933 [1] DEBUG - Statement Id: [DAO00021_GetListSoBienLai] Types: [@param0=[Int64, System.Int64], @param1=[String, System.String]]
2020-07-16 15:52:49,961 [1] DEBUG - Statement Id: [DAO00021_GetListSoBienLai] PreparedStatement : [select            BLCT.BIENLAICHITIET_ID            ,BL.*                         ,BL.KYHIEU + '/' + SERIES AS 'KYHIEU_SOQUYEN'                         ,BLCT.START_NUMBER            ,BLCT.CURRENT_NUMBER            ,BLCT.HIEULUC            ,BLCT.NGUOISUDUNG_ID            from TT_BIENLAICHITIET BLCT            left join TT_BIENLAI BL on BL.BIENLAI_ID = BLCT.BIENLAI_ID            where            (bl.MAX_NUMBER > (select MAX(CURRENT_NUMBER) from TT_BIENLAICHITIET where BIENLAI_ID = BLCT.BIENLAI_ID) or BLCT.CURRENT_NUMBER is null)            and BLCT.HIEULUC = 1            and BLCT.NGUOISUDUNG_ID =   @param0             and BL.BENHVIEN_ID =  @param1              and               BLCT.BIENLAICHITIET_ID = '2002'                         order by BLCT.THOIGIANSUDUNG DESC]
2020-07-16 15:52:49,961 [1] DEBUG - Statement Id: [DAO00021_GetListSoBienLai] Parameters: [@param0=[NGUOISUDUNG_ID,1], @param1=[BENHVIEN_ID,01819]]
2020-07-16 15:52:49,961 [1] DEBUG - Statement Id: [DAO00021_GetListSoBienLai] Types: [@param0=[Int64, System.Int64], @param1=[String, System.String]]
2020-07-16 15:52:49,991 [1] DEBUG - Statement Id: [DAO00021_GetAndInsertSoBienLaiKhiThanhToan] PreparedStatement : [declare @currentHD int = 1          declare @BienlaiId int = 0          declare @Sohoadon varchar(100)          begin                  select top 1          @currentHD = isnull(BLCT.CURRENT_NUMBER, BLCT.START_NUMBER)          ,@BienlaiId = BL.BIENLAI_ID          , @Sohoadon = (BL.KYHIEU + '/' + SERIES + '-' + convert(varchar(50),isnull(BLCT.CURRENT_NUMBER, BLCT.START_NUMBER)))          from          TT_BIENLAICHITIET BLCT          left join TT_BIENLAI BL on BLCT.BIENLAI_ID = BL.BIENLAI_ID          where                    exists (select BIENLAI_ID from TT_BIENLAICHITIET where BLCT.BIENLAI_ID = BIENLAI_ID and BIENLAICHITIET_ID = '2002')          order by BLCT.CURRENT_NUMBER desc            update TT_BIENLAICHITIET set CURRENT_NUMBER = @currentHD + 1, MACHINENAME = 'DESKTOP-89GE5BA', THOIGIANSUDUNG = getdate()  where BIENLAICHITIET_ID = '2002'          select @Sohoadon as SOHOADON          end]
2020-07-16 15:52:50,053 [1] DEBUG - Statement Id: [DAO00024_TT_HOADON_Add] PreparedStatement : [insert into TT_HOADON (              SOHOADON              , LOAIHOADON              , TIEPNHAN_ID              , BENHNHAN_ID              , BENHAN_ID              , DOITUONG_ID              , BENHAN_NGOAITRU_ID              , NGAYPHATSINH              , NGAYHOADON              , NOIPHATSINH_ID              , NGUOILAP_ID              , NOITHUTIEN_ID              , NGUOITHUTIEN_ID              , NOITRA_ID              , NGUOITRA_ID              , NGAYTRA              , GIATRIHOADON              , GIATRITHUCTHU              , TIENTE_ID              , TYGIA              , GIATRIVND              , DANGKYHOADON_ID              , SOSERIEVAT              , SOHOADONVAT              , GIATRIVAT              , NGOAIGIO              , THUHD_BL              , GHICHU              , TRANGTHAI              , DATHANHTOAN              , HUYHOADON              , LYDOHUY_ID              , HOANTRA              , IDCHUYEN              , IDCHUYENHUY              , IDCHUYENHOAN              , HOADONLIENQUAN_ID              , TRANSFER_VIENPHI_ID              , NGAYKHOAGOI              , NHOMTHANHTOAN_ID              , HOADONDOIUNG              , CHUYENCHUNGTUID              , CHUYENCHUNGTUHOANID              , CHUYENCHUNGTUHUYID              , CHUYENDOANHTHUID              , CHUYENDOANHTHUHOANID              , CHUYENDOANHTHUHUYID              , KH_TENCONGTY              , KH_MASOTHUE              , KH_DIACHI              , KH_NGUOIDAIDIEN              , INLAI              , INLAI_USER_ID                              , NGUOITHANHTOAN_ID              , THOIGIANTHANHTOAN                         , BENHVIEN_ID            , NGAYTAO            , NGUOITAO_ID            , NGAYCAPNHAT            , NGUOICAPNHAT_ID                            , YEUCAUVP                            , MACHINENAME                         , DOTDIEUTRI_ID              ) values (               @param0               ,  @param1               ,  @param2               ,  @param3               ,  @param4               ,  @param5               ,  @param6               ,  @param7               ,  @param8               ,  @param9               ,  @param10               ,  @param11               ,  @param12               ,  @param13               ,  @param14               ,  @param15               ,  @param16               ,  @param17               ,  @param18               ,  @param19               ,  @param20               ,  @param21               ,  @param22               ,  @param23               ,  @param24               ,  @param25               ,  @param26               ,  @param27               ,  @param28               ,  @param29               ,  @param30               ,  @param31               ,  @param32               ,  @param33               ,  @param34               ,  @param35               ,  @param36               ,  @param37               ,  @param38               ,  @param39               ,  @param40               ,  @param41               ,  @param42               ,  @param43               ,  @param44               ,  @param45               ,  @param46               ,  @param47               ,  @param48               ,  @param49               ,  @param50               ,  @param51               ,  @param52                               ,  @param53               ,  @param54                          ,  @param55             ,  @param56             ,  @param57             ,  @param58             ,  @param59                             , @param60                             ,  @param61                          ,  @param62             )            SELECT SCOPE_IDENTITY()]
2020-07-16 15:52:50,053 [1] DEBUG - Statement Id: [DAO00024_TT_HOADON_Add] Parameters: [@param0=[SOHOADON,BL_01/1-23], @param1=[LOAIHOADON,HD], @param2=[TIEPNHAN_ID,8747], @param3=[BENHNHAN_ID,8731], @param4=[BENHAN_ID,null], @param5=[DOITUONG_ID,1], @param6=[BENHAN_NGOAITRU_ID,null], @param7=[NGAYPHATSINH,7/16/2020 3:52:50 PM], @param8=[NGAYHOADON,7/16/2020 3:52:50 PM], @param9=[NOIPHATSINH_ID,74], @param10=[NGUOILAP_ID,1], @param11=[NOITHUTIEN_ID,74], @param12=[NGUOITHUTIEN_ID,1], @param13=[NOITRA_ID,null], @param14=[NGUOITRA_ID,null], @param15=[NGAYTRA,null], @param16=[GIATRIHOADON,38700], @param17=[GIATRITHUCTHU,38700], @param18=[TIENTE_ID,VND], @param19=[TYGIA,1], @param20=[GIATRIVND,38700], @param21=[DANGKYHOADON_ID,null], @param22=[SOSERIEVAT,null], @param23=[SOHOADONVAT,null], @param24=[GIATRIVAT,null], @param25=[NGOAIGIO,null], @param26=[THUHD_BL,HD], @param27=[GHICHU,null], @param28=[TRANGTHAI,DATHUTIEN], @param29=[DATHANHTOAN,1], @param30=[HUYHOADON,0], @param31=[LYDOHUY_ID,null], @param32=[HOANTRA,0], @param33=[IDCHUYEN,null], @param34=[IDCHUYENHUY,null], @param35=[IDCHUYENHOAN,null], @param36=[HOADONLIENQUAN_ID,null], @param37=[TRANSFER_VIENPHI_ID,null], @param38=[NGAYKHOAGOI,null], @param39=[NHOMTHANHTOAN_ID,null], @param40=[HOADONDOIUNG,null], @param41=[CHUYENCHUNGTUID,null], @param42=[CHUYENCHUNGTUHOANID,null], @param43=[CHUYENCHUNGTUHUYID,null], @param44=[CHUYENDOANHTHUID,null], @param45=[CHUYENDOANHTHUHOANID,null], @param46=[CHUYENDOANHTHUHUYID,null], @param47=[KH_TENCONGTY,null], @param48=[KH_MASOTHUE,null], @param49=[KH_DIACHI,null], @param50=[KH_NGUOIDAIDIEN,null], @param51=[INLAI,null], @param52=[INLAI_USER_ID,null], @param53=[NGUOITHANHTOAN_ID,1], @param54=[THOIGIANTHANHTOAN,7/16/2020 3:52:50 PM], @param55=[BENHVIEN_ID,01819], @param56=[NGAYTAO,7/16/2020 3:52:50 PM], @param57=[NGUOITAO_ID,1], @param58=[NGAYCAPNHAT,7/16/2020 3:52:50 PM], @param59=[NGUOICAPNHAT_ID,1], @param60=[YEUCAUVP,0], @param61=[MACHINENAME,DESKTOP-89GE5BA], @param62=[DOTDIEUTRI_ID,null]]
2020-07-16 15:52:50,053 [1] DEBUG - Statement Id: [DAO00024_TT_HOADON_Add] Types: [@param0=[String, System.String], @param1=[String, System.String], @param2=[Int64, System.Int64], @param3=[Int64, System.Int64], @param4=[System.DBNull, null], @param5=[Int64, System.Int64], @param6=[System.DBNull, null], @param7=[DateTime, System.DateTime], @param8=[DateTime, System.DateTime], @param9=[Int64, System.Int64], @param10=[Int64, System.Int64], @param11=[Int64, System.Int64], @param12=[Int64, System.Int64], @param13=[System.DBNull, null], @param14=[System.DBNull, null], @param15=[System.DBNull, null], @param16=[Double, System.Double], @param17=[Double, System.Double], @param18=[String, System.String], @param19=[Double, System.Double], @param20=[Double, System.Double], @param21=[System.DBNull, null], @param22=[System.DBNull, null], @param23=[System.DBNull, null], @param24=[System.DBNull, null], @param25=[System.DBNull, null], @param26=[String, System.String], @param27=[System.DBNull, null], @param28=[String, System.String], @param29=[String, System.String], @param30=[String, System.String], @param31=[System.DBNull, null], @param32=[String, System.String], @param33=[System.DBNull, null], @param34=[System.DBNull, null], @param35=[System.DBNull, null], @param36=[System.DBNull, null], @param37=[System.DBNull, null], @param38=[System.DBNull, null], @param39=[System.DBNull, null], @param40=[System.DBNull, null], @param41=[System.DBNull, null], @param42=[System.DBNull, null], @param43=[System.DBNull, null], @param44=[System.DBNull, null], @param45=[System.DBNull, null], @param46=[System.DBNull, null], @param47=[System.DBNull, null], @param48=[System.DBNull, null], @param49=[System.DBNull, null], @param50=[System.DBNull, null], @param51=[System.DBNull, null], @param52=[System.DBNull, null], @param53=[Int64, System.Int64], @param54=[DateTime, System.DateTime], @param55=[String, System.String], @param56=[DateTime, System.DateTime], @param57=[Int64, System.Int64], @param58=[DateTime, System.DateTime], @param59=[Int64, System.Int64], @param60=[String, System.String], @param61=[String, System.String], @param62=[System.DBNull, null]]
2020-07-16 15:52:50,089 [1] DEBUG - Statement Id: [DAO00024_TT_HOADON_HINHTHUCTHANHTOAN_Add] PreparedStatement : [insert into TT_HOADON_HINHTHUCTHANHTOAN (              HOADON_ID              , HINHTHUCTHANHTOAN_ID              , TENHINHTHUCTHANHTOAN              , GIATRITHUCTHU              , TIENTE              , TIENTE_ID              , TYGIA              , GIATRIVND              , BENHVIEN_ID              ) values (               @param0               ,  @param1               ,  @param2               ,  @param3               ,  @param4               ,  @param5               ,  @param6               ,  @param7               ,  @param8               )]
2020-07-16 15:52:50,089 [1] DEBUG - Statement Id: [DAO00024_TT_HOADON_HINHTHUCTHANHTOAN_Add] Parameters: [@param0=[HOADON_ID,5593], @param1=[HINHTHUCTHANHTOAN_ID,443], @param2=[TENHINHTHUCTHANHTOAN,Tiền mặt], @param3=[GIATRITHUCTHU,38700], @param4=[TIENTE,VND], @param5=[TIENTE_ID,8047], @param6=[TYGIA,1], @param7=[GIATRIVND,38700], @param8=[BENHVIEN_ID,01819]]
2020-07-16 15:52:50,089 [1] DEBUG - Statement Id: [DAO00024_TT_HOADON_HINHTHUCTHANHTOAN_Add] Types: [@param0=[Int64, System.Int64], @param1=[Int64, System.Int64], @param2=[String, System.String], @param3=[Double, System.Double], @param4=[String, System.String], @param5=[String, System.String], @param6=[Double, System.Double], @param7=[Double, System.Double], @param8=[String, System.String]]
2020-07-16 15:52:50,114 [1] DEBUG - Statement Id: [DAO00024_TT_VIENPHI_Ngoaitru_Thanhtoan_Json] PreparedStatement : [declare @jsonVienPhi nvarchar(max) = N'[{"TIEPNHAN_ID":8747,"SOTIEPNHAN":"TN200716.0000004","HOADONCHITIET_ID":0,"HOADON_ID":5593,"VIENPHI_ID":16000,"REF_ID":13147,"REF_TABLE":"TT_DVYEUCAU","DICHVU_ID":3,"DUOC_ID":null,"LOAI_CHIPHI":"TT","LOAIGIA_ID":3,"SOLUONG":1.0,"DONGIA_DOANHTHU":38700.0,"THANHTIEN_DOANHTHU":38700.0,"BHYT_TL":0.0,"BHYT_DONGIA":0.0,"BHYT_THANHTIEN":0.0,"BHYT_DONGIA_CHITRA":0.0,"BHYT_THANHTIEN_CHITRA":0.0,"BENHNHAN_PHAITHANHTOAN":38700.0,"GIATRI_HOADON":38700.0,"GIATRI_HOADON_DATHANHTOAN":38700.0,"GIATRI_BIENLAI":38700.0,"GIATRI_BIENLAI_DATHANHTOAN":0.0,"GIATRI_BENHNHAN_DATHANHTOAN":38700.0,"TYLE_THATTHU":null,"GIATRI_THATTHU":0.0,"MIENGIAM_TL":0.0,"MIENGIAM_GIATRI":0.0,"NGANSACH_TL":0.0,"NGANSACH_GIATRI":0.0,"TAITRO_TL":0.0,"TAITRO_GIATRI":0.0,"BHTN_GIATRI":null,"NOIDUNGTHU":null,"CHUNGTUXUATBN_ID":null,"TYLEVAT":null,"GIATRIVAT":null,"MASOTHUE":null,"SOCHUNGTUKETOAN":null,"DAHOANTRA":"0","TRANGTHAI":"CHUATHUCHIEN","PHONGBAN_ID":null,"PHONGBAN_THAYDOI_ID":null,"BENHVIEN_ID":"01819","NGAYTAO":"2020-07-16T15:42:34.377","NGUOITAO_ID":1,"NGAYCAPNHAT":"2020-07-16T15:45:13.45","NGUOICAPNHAT_ID":1,"CONGTYCHITRA_GIATRI":0.0,"HOIVIEN_GIATRI":0.0,"CHON":true}]';          begin                        update TT_VIENPHI            set            GIATRI_BENHNHAN_DATHANHTOAN = 0,            GIATRI_HOADON_DATHANHTOAN = 0,            GIATRI_BIENLAI_DATHANHTOAN = 0            where GIATRI_BENHNHAN_DATHANHTOAN is null and TIEPNHAN_ID =  @param0 ;                     INSERT INTO TT_HOADON_CHITIET_NGOAITRU          (HOADON_ID, VIENPHI_ID, REF_ID, REF_TABLE, DICHVU_ID, DUOC_ID, LOAI_CHIPHI, LOAIGIA_ID, SOLUONG, DONGIA_DOANHTHU, THANHTIEN_DOANHTHU, BHYT_TL,          BHYT_DONGIA, BHYT_THANHTIEN, BHYT_DONGIA_CHITRA, BHYT_THANHTIEN_CHITRA, BENHNHAN_PHAITHANHTOAN, GIATRI_HOADON, GIATRI_HOADON_DATHANHTOAN,          GIATRI_BIENLAI, GIATRI_BIENLAI_DATHANHTOAN, GIATRI_BENHNHAN_DATHANHTOAN, MIENGIAM_GIATRI, BHTN_GIATRI,          CONGTYCHITRA_GIATRI, HOIVIEN_GIATRI, BENHVIEN_ID, NGAYTAO, NGUOITAO_ID, NGAYCAPNHAT, NGUOICAPNHAT_ID)          SELECT          HOADON_ID, VIENPHI_ID, REF_ID, REF_TABLE, DICHVU_ID, DUOC_ID, LOAI_CHIPHI, LOAIGIA_ID, SOLUONG, DONGIA_DOANHTHU, THANHTIEN_DOANHTHU,BHYT_TL,          BHYT_DONGIA, BHYT_THANHTIEN, BHYT_DONGIA_CHITRA, BHYT_THANHTIEN_CHITRA, BENHNHAN_PHAITHANHTOAN, GIATRI_HOADON, GIATRI_HOADON_DATHANHTOAN,          GIATRI_BIENLAI, GIATRI_BIENLAI_DATHANHTOAN, GIATRI_BENHNHAN_DATHANHTOAN, MIENGIAM_GIATRI, BHTN_GIATRI,          CONGTYCHITRA_GIATRI, HOIVIEN_GIATRI, BENHVIEN_ID, GETDATE(), NGUOITAO_ID, GETDATE(), NGUOICAPNHAT_ID          FROM OPENJSON(@jsonVienPhi)          WITH (          HOADON_ID int , VIENPHI_ID int , REF_ID int , REF_TABLE varchar(50) , DICHVU_ID int , DUOC_ID int , LOAI_CHIPHI varchar(20)          , LOAIGIA_ID int , SOLUONG numeric(25,4) , DONGIA_DOANHTHU numeric(25,4) , THANHTIEN_DOANHTHU numeric(25,4)          , BHYT_TL numeric(25,4) , BHYT_DONGIA numeric(25,4) , BHYT_THANHTIEN numeric(25,4) , BHYT_DONGIA_CHITRA numeric(25,4)          , BHYT_THANHTIEN_CHITRA numeric(25,4) , BENHNHAN_PHAITHANHTOAN numeric(25,4) , GIATRI_HOADON numeric(25,4)          , GIATRI_HOADON_DATHANHTOAN numeric(25,4) , GIATRI_BIENLAI numeric(25,4) , GIATRI_BIENLAI_DATHANHTOAN numeric(25,4)          , GIATRI_BENHNHAN_DATHANHTOAN numeric(25,4) , MIENGIAM_GIATRI numeric(25,4) , BHTN_GIATRI numeric(25,4)          , CONGTYCHITRA_GIATRI numeric(25,4) , HOIVIEN_GIATRI numeric(25,4) , BENHVIEN_ID varchar(10)          , NGUOITAO_ID int , NGUOICAPNHAT_ID int)            update TT_VIENPHI          set DATHANHTOAN = '1'          , DUOCPHEPTHUCHIEN = '1'          , HUY = '0'          , ACTIVE = '1'          , TT_VIENPHI.GIATRI_BENHNHAN_DATHANHTOAN = isnull(TT_VIENPHI.GIATRI_BENHNHAN_DATHANHTOAN,0) + json.BENHNHAN_PHAITHANHTOAN          , TT_VIENPHI.GIATRI_HOADON_DATHANHTOAN = isnull(TT_VIENPHI.GIATRI_HOADON_DATHANHTOAN,0) + json.BENHNHAN_PHAITHANHTOAN          , TT_VIENPHI.GIATRI_BIENLAI_DATHANHTOAN = isnull(TT_VIENPHI.GIATRI_BIENLAI_DATHANHTOAN,0) + json.BENHNHAN_PHAITHANHTOAN          , HOADON_ID = json.HOADON_ID          FROM OPENJSON (@jsonVienPhi)          WITH (          VIENPHI_ID int,          HOADON_ID int,          GIATRI_HOADON_DATHANHTOAN numeric(25, 4),          GIATRI_BIENLAI_DATHANHTOAN numeric(25, 4),          GIATRI_BENHNHAN_DATHANHTOAN numeric(25, 4),          BENHNHAN_PHAITHANHTOAN numeric(25, 4))  json          WHERE TT_VIENPHI.VIENPHI_ID = json.VIENPHI_ID          end]
2020-07-16 15:52:50,114 [1] DEBUG - Statement Id: [DAO00024_TT_VIENPHI_Ngoaitru_Thanhtoan_Json] Parameters: [@param0=[TIEPNHAN_ID,8747]]
2020-07-16 15:52:50,114 [1] DEBUG - Statement Id: [DAO00024_TT_VIENPHI_Ngoaitru_Thanhtoan_Json] Types: [@param0=[Int64, System.Int64]]
2020-07-16 15:52:50,197 [1] DEBUG - Statement Id: [DAO00049_KiemtraloaiDV] PreparedStatement : [select DICHVU_ID AS HA, '' AS XN, '' as TDCN, '' as TT, '' as KB from TM_DICHVU            left join TM_NHOMDICHVU ndv on ndv.NHOMDICHVU_ID = TM_DICHVU.NHOMDICHVU_ID            where DICHVU_ID = '3' and left(ndv.MANHOMDICHVU, 2) = '02'            union            select  '' as HA, DICHVU_ID AS XN, '' as TDCN, '' as TT, '' as KB from TM_DICHVU            left join TM_NHOMDICHVU ndv on ndv.NHOMDICHVU_ID = TM_DICHVU.NHOMDICHVU_ID            where DICHVU_ID = '3' and left(ndv.MANHOMDICHVU, 2) = '01'            union            select  '' as HA, '' AS XN, DICHVU_ID as TDCN, '' as TT, '' as KB from TM_DICHVU            left join TM_NHOMDICHVU ndv on ndv.NHOMDICHVU_ID = TM_DICHVU.NHOMDICHVU_ID            where DICHVU_ID = '3' and left(ndv.MANHOMDICHVU, 2) = '03'            union            select  '' as HA, '' AS XN, '' as TDCN, DICHVU_ID as TT, '' as KB from TM_DICHVU            left join TM_NHOMDICHVU ndv on ndv.NHOMDICHVU_ID = TM_DICHVU.NHOMDICHVU_ID            where DICHVU_ID = '3' and left(ndv.MANHOMDICHVU, 2) = '05'            union            select  '' as HA, '' AS XN, '' as TDCN, DICHVU_ID as TT, '' as KB from TM_DICHVU            left join TM_NHOMDICHVU ndv on ndv.NHOMDICHVU_ID = TM_DICHVU.NHOMDICHVU_ID            where DICHVU_ID = '3' and left(ndv.MANHOMDICHVU, 2) = '06'            union            select  '' as HA, '' AS XN, '' as TDCN, '' as TT, DICHVU_ID as KB from TM_DICHVU            left join TM_NHOMDICHVU ndv on ndv.NHOMDICHVU_ID = TM_DICHVU.NHOMDICHVU_ID            where DICHVU_ID = '3' and left(ndv.MANHOMDICHVU, 2) = '04']
2020-07-16 15:52:50,251 [1] DEBUG - Statement Id: [DAO00009_GetTiepNhanDoiTuong] PreparedStatement : [select distinct A.DOITUONG_ID, C.MADOITUONG as DOITUONGBHYT        from TT_TIEPNHAN A        left join TM_DOITUONG C on C.DOITUONG_ID = A.DOITUONG_ID and NHOMDICHVU in (SELECT [DICTIONARY_ID]        FROM [LST_DICTIONARY]        where DICTIONARY_TYPE_CODE = 'nhomdoituong' and DICTIONARY_CODE = 'BHYT')        where A.TIEPNHAN_ID = '8747']
2020-07-16 15:52:50,285 [1] DEBUG - Statement Id: [DAO00009_TT_TIEPNHAN_GetProcess] PreparedStatement : [select PROCESS_ID from TT_TIEPNHAN where SOTIEPNHAN = 'TN200716.0000004']
2020-07-16 15:52:50,311 [1] DEBUG - Statement Id: [DAOWF001_Kiemtrathongtindayeucaudacochua] PreparedStatement : [select * from TT_REQUEST        where        PARA = '{"HOSPITAL_ID":"01819","SOTIEPNHAN":"TN200716.0000004"}'        AND ISACTIVE = '1']
2020-07-16 15:52:50,336 [1] DEBUG - Statement Id: [DAOWF001_Kiemtrathongtindichvudayeucau] PreparedStatement : [select top 1 * from TT_REQUEST_SERVICE        where        PARA = '{"DICHVU_ID":"3","DVYEUCAU_ID":"13147"}'                AND ISACTIVE = '1' order by ID desc]
2020-07-16 15:52:50,360 [1] DEBUG - Statement Id: [DAOWF001_KiemtrathongtinchitietDichvuYeucau] PreparedStatement : [select * from TT_REQUEST_SERVICE_DETAIL        where        REQUEST_SERVICE_ID = '11165']
2020-07-16 15:52:50,385 [1] DEBUG - Statement Id: [DAOWF001_Laythongtinwithstatecode] PreparedStatement : [select A.*, B.STATUS_CODE from        TM_STATE_ACTION A        left join TM_STATE B on B.STATE_CODE = A.NEXT_STATE_CODE and A.PROCESS_CODE = B.PROCESS_CODE        where        A.CURR_STATE_CODE = '0     '        AND A.PROCESS_CODE = 'P01'        Order By ORDER_ID ASC]
2020-07-16 15:52:50,422 [1] DEBUG - Statement Id: [DAOWF003_Update] PreparedStatement : [update TT_REQUEST_SERVICE set        CURR_STATE_CODE =  @param0                   , ISACTIVE =  @param1                     , ISCOMPLETE =  @param2                        where        ID = '11165']
2020-07-16 15:52:50,422 [1] DEBUG - Statement Id: [DAOWF003_Update] Parameters: [@param0=[CURR_STATE_CODE,3], @param1=[ISACTIVE,1], @param2=[ISCOMPLETE,0]]
2020-07-16 15:52:50,422 [1] DEBUG - Statement Id: [DAOWF003_Update] Types: [@param0=[String, System.String], @param1=[String, System.String], @param2=[String, System.String]]
2020-07-16 15:52:50,450 [1] DEBUG - Statement Id: [DAOWF005_Add] PreparedStatement : [insert into TT_REQUEST_SERVICE_DETAIL (        REQUEST_ID        ,REQUEST_SERVICE_ID        , OLD_STATE_CODE        , CURR_STATE_CODE        ) values (         @param0         , @param1         ,  @param2         ,  @param3         )        SELECT SCOPE_IDENTITY()]
2020-07-16 15:52:50,450 [1] DEBUG - Statement Id: [DAOWF005_Add] Parameters: [@param0=[REQUEST_ID,8751], @param1=[REQUEST_SERVICE_ID,11165], @param2=[OLD_STATE_CODE,0     ], @param3=[CURR_STATE_CODE,3]]
2020-07-16 15:52:50,450 [1] DEBUG - Statement Id: [DAOWF005_Add] Types: [@param0=[String, System.String], @param1=[Int32, System.Int32], @param2=[String, System.String], @param3=[String, System.String]]
2020-07-16 15:52:50,476 [1] DEBUG - Statement Id: [DAOWF005_Add_History] PreparedStatement : [insert into TT_REQUEST_SERVICE_HISTORY (        REQUEST_ID        ,REQUEST_SERVICE_ID        , OLD_STATE_CODE        , CURR_STATE_CODE        ) values (         @param0         , @param1         ,  @param2         ,  @param3         )]
2020-07-16 15:52:50,476 [1] DEBUG - Statement Id: [DAOWF005_Add_History] Parameters: [@param0=[REQUEST_ID,8751], @param1=[REQUEST_SERVICE_ID,11165], @param2=[OLD_STATE_CODE,0     ], @param3=[CURR_STATE_CODE,3]]
2020-07-16 15:52:50,476 [1] DEBUG - Statement Id: [DAOWF005_Add_History] Types: [@param0=[String, System.String], @param1=[Int32, System.Int32], @param2=[String, System.String], @param3=[String, System.String]]
2020-07-16 15:52:50,503 [1] DEBUG - Statement Id: [DAO00009_TT_DVYEUCAU_Update] PreparedStatement : [Update TT_DVYEUCAU set TRANGTHAI_WFL = 'CHUAKETQUA' where DVYEUCAU_ID = '13147']
2020-07-16 15:52:50,526 [1] DEBUG - Statement Id: [DAO00064_TT_NGOAITRU_KHAMBENH_TOATHUOC_GetListToaThuocBHYT] PreparedStatement : [select * from TT_NGOAITRU_KHAMBENH_TOATHUOC        where (exists (select KHAMBENH_NGOAITRU_ID from TT_DVYEUCAU        where TT_NGOAITRU_KHAMBENH_TOATHUOC.KHAMBENH_ID = KHAMBENH_NGOAITRU_ID and TIEPNHAN_ID = '8747'))        and TIEPNHAN_ID = '8747' and (LOAITOATHUOC = 'BV' or LOAITOATHUOC = 'KTBV'                 )]
2020-07-16 15:52:50,570 [1] DEBUG - Statement Id: [DAO00064_KiemtraBHYTNgoaitruDaThanhtoan] PreparedStatement : [select COUNT(*)        from TT_VIENPHI A        left join (select * from TT_DVYEUCAU where TIEPNHAN_ID = '8747') C on C.TIEPNHAN_ID = A.TIEPNHAN_ID and C.DICHVU_ID = A.DICHVU_ID  and C.DVYEUCAU_ID = A.REF_ID        left join (select * from TT_NGOAITRU_KHAMBENH where TIEPNHAN_ID = '8747') D on D.TIEPNHAN_ID = A.TIEPNHAN_ID and D.DICHVU_ID = A.DICHVU_ID and C.KHAMBENH_NGOAITRU_ID = D.KHAMBENH_ID        left join (select * from TT_NGOAITRU_TOATHUOC where TIEPNHAN_ID = '8747') E on E.DUOC_ID = A.DUOC_ID and E.TOATHUOC_ID = A.REF_ID and A.REF_TABLE = 'TT_NGOAITRU_TOATHUOC'        left join TT_NGOAITRU_KHAMBENH_TOATHUOC tk on tk.KHAMBENH_TOATHUOC_ID = e.KHAMBENH_TOATHUOC_ID        left join TT_PHAUTHUAT_VTYT vtyt on vtyt.PHAUTHUAT_VTYT_ID = a.REF_ID and a.REF_TABLE = 'TT_PHAUTHUAT_VTYT'        where        A.TIEPNHAN_ID = '8747' and (A.BENHAN_ID is NULL or A.BENHAN_ID = '')        and A.REF_TABLE != 'TT_DUOC_CHUNGTU_CHITIET' and A.KHONGTHUTIEN != '1'        and (exists (select KHAMBENH_ID from TT_NGOAITRU_KHAMBENH where A.KHAMBENH_ID = KHAMBENH_ID and TIEPNHAN_ID = '8747') or A.KHAMBENH_ID is null)        and (C.HUYYEUCAU = '0' or C.HUYYEUCAU is null)         and        (        (A.DICHVU_ID is not null and C.HUYYEUCAU != '1') or (A.DICHVU_ID is null and A.DUOC_ID is not null and A.REF_TABLE != 'TT_DUOC_CHUNGTU_CHITIET')        )        and A.BENHNHAN_PHAITHANHTOAN > A.GIATRI_BENHNHAN_DATHANHTOAN]
2020-07-16 15:52:50,650 [1] DEBUG - Statement Id: [DAO00064_GetDanhsachXacnhanChiphiChitiet] PreparedStatement : [select A.*        from TT_XACNHANCHIPHICHITIET A        left join TT_XACNHANCHIPHI B on A.XACNHANCHIPHI_ID = B.XACNHANCHIPHI_ID        where B.TIEPNHAN_ID = '8747']
2020-07-16 15:52:50,722 [1] DEBUG - Statement Id: [DAO00021_GetListSoBienLai] PreparedStatement : [select            BLCT.BIENLAICHITIET_ID            ,BL.*                         ,BL.KYHIEU + '/' + SERIES AS 'KYHIEU_SOQUYEN'                         ,BLCT.START_NUMBER            ,BLCT.CURRENT_NUMBER            ,BLCT.HIEULUC            ,BLCT.NGUOISUDUNG_ID            from TT_BIENLAICHITIET BLCT            left join TT_BIENLAI BL on BL.BIENLAI_ID = BLCT.BIENLAI_ID            where            (bl.MAX_NUMBER > (select MAX(CURRENT_NUMBER) from TT_BIENLAICHITIET where BIENLAI_ID = BLCT.BIENLAI_ID) or BLCT.CURRENT_NUMBER is null)            and BLCT.HIEULUC = 1            and BLCT.NGUOISUDUNG_ID =   @param0             and BL.BENHVIEN_ID =  @param1                          order by BLCT.THOIGIANSUDUNG DESC]
2020-07-16 15:52:50,722 [1] DEBUG - Statement Id: [DAO00021_GetListSoBienLai] Parameters: [@param0=[NGUOISUDUNG_ID,1], @param1=[BENHVIEN_ID,01819]]
2020-07-16 15:52:50,722 [1] DEBUG - Statement Id: [DAO00021_GetListSoBienLai] Types: [@param0=[Int64, System.Int64], @param1=[String, System.String]]
2020-07-16 15:52:50,750 [1] DEBUG - Statement Id: [DAO00021_GetListSoBienLai] PreparedStatement : [select            BLCT.BIENLAICHITIET_ID            ,BL.*                         ,BL.KYHIEU + '/' + SERIES AS 'KYHIEU_SOQUYEN'                         ,BLCT.START_NUMBER            ,BLCT.CURRENT_NUMBER            ,BLCT.HIEULUC            ,BLCT.NGUOISUDUNG_ID            from TT_BIENLAICHITIET BLCT            left join TT_BIENLAI BL on BL.BIENLAI_ID = BLCT.BIENLAI_ID            where            (bl.MAX_NUMBER > (select MAX(CURRENT_NUMBER) from TT_BIENLAICHITIET where BIENLAI_ID = BLCT.BIENLAI_ID) or BLCT.CURRENT_NUMBER is null)            and BLCT.HIEULUC = 1            and BLCT.NGUOISUDUNG_ID =   @param0             and BL.BENHVIEN_ID =  @param1                          order by BLCT.THOIGIANSUDUNG DESC]
2020-07-16 15:52:50,750 [1] DEBUG - Statement Id: [DAO00021_GetListSoBienLai] Parameters: [@param0=[NGUOISUDUNG_ID,1], @param1=[BENHVIEN_ID,01819]]
2020-07-16 15:52:50,750 [1] DEBUG - Statement Id: [DAO00021_GetListSoBienLai] Types: [@param0=[Int64, System.Int64], @param1=[String, System.String]]
2020-07-16 15:52:50,780 [1] DEBUG - Statement Id: [DAO00021_GetListSoBienLai] PreparedStatement : [select            BLCT.BIENLAICHITIET_ID            ,BL.*                         ,BL.KYHIEU + '/' + SERIES AS 'KYHIEU_SOQUYEN'                         ,BLCT.START_NUMBER            ,BLCT.CURRENT_NUMBER            ,BLCT.HIEULUC            ,BLCT.NGUOISUDUNG_ID            from TT_BIENLAICHITIET BLCT            left join TT_BIENLAI BL on BL.BIENLAI_ID = BLCT.BIENLAI_ID            where            (bl.MAX_NUMBER > (select MAX(CURRENT_NUMBER) from TT_BIENLAICHITIET where BIENLAI_ID = BLCT.BIENLAI_ID) or BLCT.CURRENT_NUMBER is null)            and BLCT.HIEULUC = 1            and BLCT.NGUOISUDUNG_ID =   @param0             and BL.BENHVIEN_ID =  @param1              and               BLCT.BIENLAICHITIET_ID = '2002'                         order by BLCT.THOIGIANSUDUNG DESC]
2020-07-16 15:52:50,780 [1] DEBUG - Statement Id: [DAO00021_GetListSoBienLai] Parameters: [@param0=[NGUOISUDUNG_ID,1], @param1=[BENHVIEN_ID,01819]]
2020-07-16 15:52:50,780 [1] DEBUG - Statement Id: [DAO00021_GetListSoBienLai] Types: [@param0=[Int64, System.Int64], @param1=[String, System.String]]
2020-07-16 15:52:50,807 [1] DEBUG - Statement Id: [DAO00119_TT_VIENPHI_GetList_TiepNhanByHoadon] PreparedStatement : [select  a.*, a.MIENGIAM_GIATRI as GIATRIMIENGIAM_BH, a.BHTN_GIATRI as GIATRIMIENGIAM_BHTN, a.HOIVIEN_GIATRI as GIATRIMIENGIAM_THANHVIEN, a.CONGTYCHITRA_GIATRI as GIATRIMIENGIAM_CTCT,        isnull(dv.TENDICHVU, dc.TENDUOCDAYDU) NOIDUNG, isnull(dv.MADICHVU, dc.MADUOC) MADICHVU, dv.NORESULT, dc.DONVITINH, ld.MALOAIDUOC, dc.BHYT DUOC_BHYT, ld.LOAIVATTU_ID, ndv.MANHOMDICHVU        from        (select        vp.HOADONCHITIET_ID, vp.HOADON_ID, vp.VIENPHI_ID, vp.REF_ID, vp.REF_TABLE, vp.DICHVU_ID, vp.DUOC_ID        , vp.LOAI_CHIPHI, vp.LOAIGIA_ID, vp.SOLUONG, vp.DONGIA_DOANHTHU, vp.THANHTIEN_DOANHTHU, vp.BHYT_TL, vpp.BHYT_DONGIA, vpp.BHYT_THANHTIEN, vpp.BHYT_DONGIA_CHITRA        , vp.BHYT_THANHTIEN_CHITRA, vp.BENHNHAN_PHAITHANHTOAN, vp.GIATRI_HOADON, vp.GIATRI_HOADON_DATHANHTOAN, vp.GIATRI_BIENLAI        , vp.GIATRI_BIENLAI_DATHANHTOAN, vp.GIATRI_BENHNHAN_DATHANHTOAN, vp.TYLE_THATTHU, vp.GIATRI_THATTHU, vp.MIENGIAM_TL, vp.MIENGIAM_GIATRI, vp.NGANSACH_TL, vp.NGANSACH_GIATRI        , vp.TAITRO_TL, vp.TAITRO_GIATRI, vp.BHTN_GIATRI, vp.NOIDUNGTHU, vp.CHUNGTUXUATBN_ID, vp.TYLEVAT, vp.GIATRIVAT, vp.MASOTHUE, vp.SOCHUNGTUKETOAN, vp.DAHOANTRA, c.TRANGTHAI        , vp.PHONGBAN_ID, vp.PHONGBAN_THAYDOI_ID, vp.CONGTYCHITRA_GIATRI, vp.HOIVIEN_GIATRI, vp.BENHVIEN_ID, isnull(c.NGAYGIOYEUCAU, vp.NGAYTAO) NGAYTAO, vp.NGUOITAO_ID, vp.NGAYCAPNHAT, vp.NGUOICAPNHAT_ID        , c.NOITHUCHIEN_ID, c.NOIYEUCAU_ID, vpp.DATHUCHIEN, vpp.TIEPNHAN_ID, vpp.BENHAN_ID        from TT_HOADON_CHITIET_NGOAITRU VP        left join TT_VIENPHI vpp on vpp.VIENPHI_ID = VP.VIENPHI_ID        left join TT_DVYEUCAU c on c.DVYEUCAU_ID = VP.REF_ID        where        vp.HOADON_ID = '5593'        ) a        left join TM_DUOC dc on a.DUOC_ID = dc.DUOC_ID        left join TM_LOAIDUOC ld on dc.LOAIDUOC_ID = ld.LOAIDUOC_ID        left join TM_DICHVU dv on a.DICHVU_ID = dv.DICHVU_ID and a.REF_TABLE = 'TT_DVYEUCAU'        left join TM_NHOMDICHVU ndv on ndv.NHOMDICHVU_ID = dv.NHOMDICHVU_ID        WHERE a.REF_TABLE!='TT_MAU_CHUNGTU_CHITIET']
2020-07-16 15:52:50,862 [1] DEBUG - Statement Id: [DAO00330_TT_VIENPHI_GetList_TiepNhanByHoadon] PreparedStatement : [select  a.*, a.MIENGIAM_GIATRI as GIATRIMIENGIAM_BH, a.BHTN_GIATRI as GIATRIMIENGIAM_BHTN, a.HOIVIEN_GIATRI as GIATRIMIENGIAM_THANHVIEN, a.CONGTYCHITRA_GIATRI as GIATRIMIENGIAM_CTCT        from        (select        vp.HOADONCHITIET_ID, vp.HOADON_ID, vp.VIENPHI_ID, vp.REF_ID, vp.REF_TABLE, vp.DICHVU_ID, vp.DUOC_ID        , vp.LOAI_CHIPHI, vp.LOAIGIA_ID, vp.SOLUONG, vp.DONGIA_DOANHTHU, vp.THANHTIEN_DOANHTHU, vp.BHYT_TL, vpp.BHYT_DONGIA, vpp.BHYT_THANHTIEN, vpp.BHYT_DONGIA_CHITRA        , vp.BHYT_THANHTIEN_CHITRA, vp.BENHNHAN_PHAITHANHTOAN, vp.GIATRI_HOADON, vp.GIATRI_HOADON_DATHANHTOAN, vp.GIATRI_BIENLAI        , vp.GIATRI_BIENLAI_DATHANHTOAN, vp.GIATRI_BENHNHAN_DATHANHTOAN, vp.TYLE_THATTHU, vp.GIATRI_THATTHU, vp.MIENGIAM_TL, vp.MIENGIAM_GIATRI, vp.NGANSACH_TL, vp.NGANSACH_GIATRI        , vp.TAITRO_TL, vp.TAITRO_GIATRI, vp.BHTN_GIATRI, vp.NOIDUNGTHU, vp.CHUNGTUXUATBN_ID, vp.TYLEVAT, vp.GIATRIVAT, vp.MASOTHUE, vp.SOCHUNGTUKETOAN, vp.DAHOANTRA, vp.TRANGTHAI        , vp.PHONGBAN_ID, vp.PHONGBAN_THAYDOI_ID, vp.CONGTYCHITRA_GIATRI, vp.HOIVIEN_GIATRI, vp.BENHVIEN_ID, vp.NGAYTAO, vp.NGUOITAO_ID, vp.NGAYCAPNHAT, vp.NGUOICAPNHAT_ID        , NULL AS NOITHUCHIEN_ID, dk.NOICHIDINH_ID as NOIYEUCAU_ID, vpp.DATHUCHIEN, vpp.TIEPNHAN_ID, vpp.BENHAN_ID        ,M.TENMAU AS NOIDUNG, M.MAMAU AS MADICHVU, NULL AS NORESULT, DVT.TENDONVITINH AS DONVITINH, LM.MALOAIMAU AS MALOAIDUOC, M.BHYT AS DUOC_BHYT, 'M' AS LOAIVATTU_ID, NM.TENNHOMMAU AS MANHOMDICHVU        from TT_HOADON_CHITIET_NGOAITRU VP        join TT_VIENPHI vpp on vpp.VIENPHI_ID = VP.VIENPHI_ID        INNER JOIN TT_MAU_CHUNGTU_CHITIET CT ON VP.REF_ID=CT.CHUNGTUCHITIET_ID AND VP.REF_TABLE='TT_MAU_CHUNGTU_CHITIET' AND CT.BENHVIEN_ID='01819'        INNER JOIN TT_MAU_CHUNGTU CTU ON CT.CHUNGTU_ID=CTU.CHUNGTU_ID AND CTU.CHUNGTULIENQUAN_ID IS NULL        INNER join TM_MAU M on CT.MAU_ID = M.MAU_ID        LEFT JOIN TM_MAU_DONVITINH DVT ON M.DONVITINH_ID = DVT.DONVITINH_ID        LEFT JOIN TT_MAU_DANGKYMAU_CHITIET DKCT ON DKCT.CHUNGTU_ID = CTU.CHUNGTU_ID AND DKCT.BENHVIEN_ID='01819'        LEFT JOIN TT_MAU_DANGKYMAU DK ON DK.DANGKYMAU_ID = DKCT.DANGKYMAU_ID        LEFT JOIN TM_MAU_LOAIMAU LM ON LM.LOAIMAU_ID = M.LOAIMAU_ID        LEFT JOIN TM_MAU_NHOMMAU NM ON NM.NHOMMAU_ID = LM.NHOMMAU_ID        where        vp.HOADON_ID = '5593'        ) a]
2020-07-16 15:52:50,930 [1] DEBUG - Statement Id: [DAO00024_TT_HOADON_HINHTHUCTHANHTOAN_GetList] PreparedStatement : [select TT_HOADON_HINHTHUCTHANHTOAN.*, htttCode.DICTIONARY_CODE HINHTHUCTHANHTOAN_CODE            from TT_HOADON_HINHTHUCTHANHTOAN TT_HOADON_HINHTHUCTHANHTOAN            left join (select DICTIONARY_ID, DICTIONARY_CODE from LST_DICTIONARY where DICTIONARY_TYPE_CODE like 'HinhThucThanhToan') htttCode on htttCode.DICTIONARY_ID = TT_HOADON_HINHTHUCTHANHTOAN.HINHTHUCTHANHTOAN_ID             where                             TT_HOADON_HINHTHUCTHANHTOAN.HOADON_ID = '5593'                       and                           TT_HOADON_HINHTHUCTHANHTOAN.BENHVIEN_ID = '01819'                                     order by HOADON_HTTT_ID]
2020-07-16 15:52:51,043 [1] DEBUG - Statement Id: [DAO00119_GetLichSuThanhToan] PreparedStatement : [select        SUM(THANHTOAN) AS TONGDATHANHTOAN, SUM(TAMUNG) AS TONGTAMUNG, SUM(HOANUNG) AS TONGHOANUNG,        SUM(MIENGIAM) AS TONGMIENGIAM, SUM(THATTHU) AS TONGTHATTHU, TIEPNHAN_ID        from (        select HD.TIEPNHAN_ID,        CASE WHEN LOAIHOADON = 'TU' then HD.GIATRIHOADON ELSE 0 END TAMUNG,        CASE WHEN LOAIHOADON = 'HU' then HD.GIATRIHOADON ELSE 0 END HOANUNG,        CASE WHEN LOAIHOADON = 'BL' then HD.GIATRIHOADON ELSE 0 END THANHTOAN,        0 MIENGIAM,        0 THATTHU        from TT_HOADON HD        where HD.DATHANHTOAN = '1' and HD.HUYHOADON = '0' and HD.HOANTRA = '0'        and HD.TIEPNHAN_ID = 8747        and HD.BENHVIEN_ID = '01819'          Union          select HD.TIEPNHAN_ID,        0 TAMUNG,        0 HOANUNG,        0 THANHTOAN,        SUM(hdct.MIENGIAM_GIATRI) AS MIENGIAM,        SUM(hdct.BENHNHAN_PHAITHANHTOAN) - SUM(hdct.GIATRI_HOADON_DATHANHTOAN) AS THATTHU        from TT_HOADON HD        join TT_HOADON_CHITIET_NGOAITRU hdct on HD.HOADON_ID = hdct.HOADON_ID        where HD.DATHANHTOAN = '1' and HD.HUYHOADON = '0' and HD.HOANTRA = '0'        and HD.TIEPNHAN_ID = 8747        and HD.BENHVIEN_ID = '01819'        group by TIEPNHAN_ID        ) temp        group by temp.TIEPNHAN_ID]
2020-07-16 15:52:58,016 [1] DEBUG - Statement Id: [DAO00119_GetDanhsachHTTT] PreparedStatement : [select * from LST_DICTIONARY where DICTIONARY_TYPE_CODE = 'HinhThucThanhToan' and ENABLED = '1' and BENHVIEN_ID = '01819']
2020-07-16 15:52:59,218 [1] DEBUG - Statement Id: [DAO00019_GetListDichVuDuocDongTien] PreparedStatement : [select * from        (        select COUNT(*) OVER() as TOTALROWS, ROW_NUMBER() OVER(order by tn.MAYTE, isnull(tn.SOTHUTU,'999999999')) as ROWNUMBER,        ISNULL(A.DUOC_ID, A.DICHVU_ID) as DICHVU_ID, ISNULL(B.TENDUOCDAYDU, C.TENDICHVU) as TENDICHVU,        (CASE WHEN A.DUOC_ID is null THEN E.NOITHUCHIEN_ID ELSE 0 END) as NOITHUCHIEN_ID,        0 as NOIYEUCAU_ID, 0 as NOIGIOITHIEU_ID, 0 as BACSICHIDINH_ID, isnull(E.NGAYTAO, E.NGAYCAPNHAT) as THOIGIANDKDICHVU,        tn.*, isnull(tn.SOTHUTU,'999999999') as SOHANGDOI, null as KHAN, '' as STATUS_CODE        from TT_VIENPHI A        left join TM_DUOC B on B.DUOC_ID = A.DUOC_ID and B.BENHVIEN_ID = '01819'        left join TM_DICHVU C on C.DICHVU_ID = A.DICHVU_ID and C.BENHVIEN_ID = '01819'        inner join        (        select A.TIEPNHAN_ID, A.SOTIEPNHAN, A.DOITUONG_ID, A.SOTHUTU, A.NGAYTIEPNHAN, B.*, C.TENDOITUONG from TT_TIEPNHAN A        inner join TT_BENHNHAN B on A.BENHNHAN_ID = B.BENHNHAN_ID        inner join TM_DOITUONG C on A.DOITUONG_ID = C.DOITUONG_ID        where A.TRANGTHAI in ('DATIEPNHAN', 'HOANTHANH') and A.BENHVIEN_ID = '01819'        ) tn on tn.TIEPNHAN_ID = A.TIEPNHAN_ID        left join TT_DVYEUCAU E on E.DVYEUCAU_ID = A.REF_ID        where        A.BENHAN_ID is null and        ((A.REF_TABLE = 'TT_DVYEUCAU' and E.HUYYEUCAU = '0') or (A.DUOC_ID is not null and A.DATHUCHIEN = '1')) and        ((A.DATHANHTOAN = '0' or A.DATHANHTOAN is null) and A.KHONGTHUTIEN = '0') and A.BENHVIEN_ID = '01819'           and               tn.NGAYTIEPNHAN >= '7/16/2020 12:00:00 AM'             and               tn.NGAYTIEPNHAN <= '7/16/2020 12:00:00 AM'                     ) lst                    where          lst.ROWNUMBER between 1 and 19                 order by MAYTE, SOHANGDOI asc]
2020-07-16 15:52:59,258 [1] DEBUG - Statement Id: [DAO00019_GetCountBenhNhanDichVuDuocDongTien] PreparedStatement : [select count(distinct tn.MAYTE) TOTAL_BENHNHAN        from TT_VIENPHI A        left join TM_DUOC B on B.DUOC_ID = A.DUOC_ID and B.BENHVIEN_ID = '01819'        left join TM_DICHVU C on C.DICHVU_ID = A.DICHVU_ID and C.BENHVIEN_ID = '01819'        inner join        (        select A.TIEPNHAN_ID, A.SOTIEPNHAN, A.DOITUONG_ID, A.SOTHUTU, A.NGAYTIEPNHAN, B.*, C.TENDOITUONG from TT_TIEPNHAN A        inner join TT_BENHNHAN B on A.BENHNHAN_ID = B.BENHNHAN_ID        inner join TM_DOITUONG C on A.DOITUONG_ID = C.DOITUONG_ID        where A.TRANGTHAI in ('DATIEPNHAN', 'HOANTHANH') and A.BENHVIEN_ID = '01819'        ) tn on tn.TIEPNHAN_ID = A.TIEPNHAN_ID        left join TT_DVYEUCAU E on E.DVYEUCAU_ID = A.REF_ID        where        A.BENHAN_ID is null and        ((A.REF_TABLE = 'TT_DVYEUCAU' and E.HUYYEUCAU = '0') or (A.DUOC_ID is not null and A.DATHUCHIEN = '1')) and        ((A.DATHANHTOAN = '0' or A.DATHANHTOAN is null) and A.KHONGTHUTIEN = '0') and A.BENHVIEN_ID = '01819'           and               tn.NGAYTIEPNHAN >= '7/16/2020 12:00:00 AM'             and               tn.NGAYTIEPNHAN <= '7/16/2020 12:00:00 AM']
2020-07-16 15:53:03,320 [1] DEBUG - Statement Id: [DAO00403_QMS002_GetThongTinClient] PreparedStatement : [SELECT B.ID as QUEUE_ID, B.NAME AS QUEUE_NAME,A.ID AS CLIENT_ID , A.[NAME] AS CLIENT_NAME, ISNULL(A.[STATE],1) AS [STATE],(CASE C.NAME WHEN 'UT' THEN 1 ELSE 0 END) AS QUEUETYPE     , B.DEPARTMENT_ID,ISNULL(B.SECTION_ID,-1) AS SECTION_ID,A.IPSERVER,A.NAMEAUDIO,C.QUEUE_TYPE_CODE,C.QUEUE_TYPE_CODE_SOUND,S.[NAME] AS SECTIONNAME     FROM QMS_QUEUE B LEFT JOIN QMS_CLIENT A ON A.QUEUE_ID = B.ID     LEFT JOIN QMS_QUEUE_TYPE C ON B.QUEUETYPE_ID = C.ID     LEFT JOIN QMS_SECTION S ON B.SECTION_ID=S.ID     WHERE     (A.COMPUTERNAME = 'DESKTOP-89GE5BA' OR A.IPADDRESS = '10.15.167.38') AND A.[STATE] = 1 AND B.DEPARTMENT_ID='74'            AND B.BENHVIEN_ID = '01819']
2020-07-16 15:53:03,463 [1] DEBUG - Statement Id: [DAO00019_GetDanhsachKhambenh] PreparedStatement : [select *        from        (SELECT COUNT(*) OVER() as TOTALROWS, ROW_NUMBER() OVER(order by isnull(dv.SOTHUTU,'999999999'), dv.NGAYGIOYEUCAU) as ROWNUMBER,        bn.MAYTE, bn.TENBENHNHAN, bn.NAMSINH, bn.NGAYSINH as TUOI, ISNULL(CONVERT(VARCHAR(10), bn.NGAYSINH, 103),CAST(bn.NAMSINH AS varchar)) as NGAYSINH, bn.DIACHILIENLAC as DIACHI, bn.GIOITINH, GD.DESCRIPTION as TENGIOITINH,        tn.DOITUONG_ID, tn.THOIGIANTIEPNHAN, tn.BENHNHAN_ID, tn.TIEPNHAN_ID, tn.TRAITUYEN, tn.SOTIEPNHAN,        dv.DICHVU_ID, dv.NOITHUCHIEN_ID, isnull(dv.NGAYTAO, dv.NGAYCAPNHAT) as THOIGIANDKDICHVU,        dv.KHAN, dv.NOIYEUCAU_ID, dv.NGAYGIOYEUCAU, dv.BACSICHIDINH_ID, dv.DONVIGIOITHIEU_ID, dv.NGUOIGIOITHIEU_ID,        tn.NOIGIOITHIEU_ID, kbnt.HUONGGIAIQUYET_ID,        dv.DVYEUCAU_ID, dv.MARIS, dv.TRANGTHAI as TRANGTHAICODE, B.TENNHOMDICHVU, dv.SOPHIEUYEUCAU, dv.KHAMBENH_NGOAITRU_ID, dv.NGUOICAPNHAT_ID, dv.NGAYCAPNHAT,        CASE WHEN Left(B.MANHOMDICHVU,2) = '03' THEN '02' ELSE Left(B.MANHOMDICHVU,2) END AS MANHOMDICHVU, B.MANHOMDICHVU as MANHOMDICHVUCHITIET, tn.TRANGTHAI as TRANGTHAI_TIEPNHAN,        'False' as DAKHAM, isnull(dv.SOTHUTU,'999999999') as SOHANGDOI,        vp.DATHANHTOAN, dv.TRANGTHAI_WFL,        BA.SOBENHAN, dv.CHANDOAN, dt.TENDOITUONG, isnull(kbnt.THOIGIANKHAM, dv.NGAYCAPNHAT) as THOIGIANKHAM,        tn.SOBHYT          ,           tn.UUTIEN                 FROM TT_DVYEUCAU (NOLOCK) dv        inner join TT_TIEPNHAN (NOLOCK) tn on dv.TIEPNHAN_ID = tn.TIEPNHAN_ID        inner join TT_BENHNHAN (NOLOCK) bn on tn.BENHNHAN_ID = bn.BENHNHAN_ID        inner join TM_DICHVU A on A.DICHVU_ID = dv.DICHVU_ID        inner join TM_NHOMDICHVU B on B.NHOMDICHVU_ID = A.NHOMDICHVU_ID        inner join TT_VIENPHI(NOLOCK) VP on VP.TIEPNHAN_ID = tn.TIEPNHAN_ID and VP.DICHVU_ID = dv.DICHVU_ID and VP.REF_ID = dv.DVYEUCAU_ID        left join TT_NOITRU_BENHAN (NOLOCK) BA on BA.TIEPNHAN_ID = tn.TIEPNHAN_ID AND dv.BENHAN_ID = BA.BENHAN_ID        inner join TM_GENDER GD on GD.ID = bn.GIOITINH        left join TT_NGOAITRU_KHAMBENH (NOLOCK) kbnt on kbnt.KHAMBENH_ID = dv.KHAMBENH_NGOAITRU_ID        inner join TM_DOITUONG dt on dt.DOITUONG_ID = tn.DOITUONG_ID        where        dv.DICHVU_ID IS NOT NULL        and tn.BENHVIEN_ID = '01819'        and HUYYEUCAU = 0        and dv.NGAYHENCLS is NULL         and           dv.NGAYYEUCAU >= '7/16/2020 12:00:00 AM'         and           dv.NGAYYEUCAU <= '7/16/2020 12:00:00 AM'         and           dv.NOITHUCHIEN_ID = 74          AND             (                         ((dv.TRANGTHAI_WFL = 'CHUAKETQUA' or (dv.TRANGTHAI = 'CHUAKETQUA' and dv.TRANGTHAI_WFL = 'HOANTHANH')) and (isnull(kbnt.HUONGGIAIQUYET_ID, 0) = 0)))            and (tn.TRANGTHAI != 'HOANTHANH')           and           (CASE WHEN Left(B.MANHOMDICHVU,2) = '03' THEN '02' ELSE Left(B.MANHOMDICHVU,2) END) = '04'                 ) lst                    where          lst.ROWNUMBER between 1 and 19                 order by SOHANGDOI, NGAYGIOYEUCAU asc]
2020-07-16 15:53:04,481 [1] DEBUG - Statement Id: [DAO00017_GetLoaiGiaByDoiTuongId] PreparedStatement : [select dtlg.DOUUTIEN, dtlg.DOITUONG_ID, lg.LOAIGIA_ID, lg.TENLOAIGIA, lg.MALOAIGIA              from TM_LOAIGIA lg              left join TM_DOITUONG_LOAIGIA dtlg              on lg.LOAIGIA_ID = dtlg.LOAIGIA_ID and dtlg.BENHVIEN_ID = '01819'              where lg.TAMNGUNG = 0 and lg.BENHVIEN_ID = '01819'                             order by dtlg.DOUUTIEN]
2020-07-16 15:53:04,540 [1] DEBUG - Statement Id: [DAO00014_KiemTraDVYCCoGiaBHYT] PreparedStatement : [select *        from TT_VIENPHI        where REF_ID  = '' and REF_TABLE = 'TT_DVYEUCAU' and BHYT_DONGIA > 0]
2020-07-16 15:53:04,567 [1] DEBUG - Statement Id: [DAO00305_GetAllLoaiToaThuoc] PreparedStatement : [declare @LOAITOATHUOC varchar(200)        set @LOAITOATHUOC = (select top 1 LOAITOATHUOC = STUFF((SELECT ',' + LOAITOATHUOC FROM TM_TOATHUOC_NGOAITRU where BENHVIEN_ID = '01819' FOR XML PATH ('')), 1, 1, '')        from TM_TOATHUOC_NGOAITRU)        set @LOAITOATHUOC = '''' +  REPLACE(@LOAITOATHUOC,',',''',''') + ''''        select @LOAITOATHUOC as LOAITOATHUOC]
2020-07-16 15:53:04,635 [1] DEBUG - Statement Id: [DAO00040_LayListToaMau] PreparedStatement : [select A.*, dc.TENDUOCDAYDU, dc.BHYT DUOC_BHYT, ld.LOAIVATTU_ID, ld.MALOAIDUOC, dd.DICTIONARY_NAME DUONGDUNG, dc.TAMNGUNG            from TT_TOATHUOCMAU A            left join TM_DUOC dc on A.DUOC_ID = dc.DUOC_ID            left join TM_LOAIDUOC ld on dc.LOAIDUOC_ID = ld.LOAIDUOC_ID            left join (select * from LST_DICTIONARY where DICTIONARY_TYPE_CODE like 'DuongDung') dd on dd.DICTIONARY_ID = dc.DUONGDUNG_ID            where (1=1)             and               A.BACSI_ID  = 1             and               A.LOAITOATHUOC IN ('BV','MN','BV','KTBV','KTBV','BV')]
2020-07-16 15:53:04,685 [1] DEBUG - Statement Id: [DAO00305_GetAllLoaiToaThuoc] PreparedStatement : [declare @LOAITOATHUOC varchar(200)        set @LOAITOATHUOC = (select top 1 LOAITOATHUOC = STUFF((SELECT ',' + LOAITOATHUOC FROM TM_TOATHUOC_NGOAITRU where BENHVIEN_ID = '01819' FOR XML PATH ('')), 1, 1, '')        from TM_TOATHUOC_NGOAITRU)        set @LOAITOATHUOC = '''' +  REPLACE(@LOAITOATHUOC,',',''',''') + ''''        select @LOAITOATHUOC as LOAITOATHUOC]
2020-07-16 15:53:04,755 [1] DEBUG - Statement Id: [DAO00040_LayListToaMau] PreparedStatement : [select A.*, dc.TENDUOCDAYDU, dc.BHYT DUOC_BHYT, ld.LOAIVATTU_ID, ld.MALOAIDUOC, dd.DICTIONARY_NAME DUONGDUNG, dc.TAMNGUNG            from TT_TOATHUOCMAU A            left join TM_DUOC dc on A.DUOC_ID = dc.DUOC_ID            left join TM_LOAIDUOC ld on dc.LOAIDUOC_ID = ld.LOAIDUOC_ID            left join (select * from LST_DICTIONARY where DICTIONARY_TYPE_CODE like 'DuongDung') dd on dd.DICTIONARY_ID = dc.DUONGDUNG_ID            where (1=1)             and               A.BACSI_ID  = 1             and               A.LOAITOATHUOC IN ('BV','MN','BV','KTBV','KTBV','BV')]
2020-07-16 15:53:04,791 [1] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoVaBookingCOM23UpdateRedis_TheoPhamvi] PreparedStatement : [declare @TOAMUANGOAI int = 0;        select @TOAMUANGOAI = isnull(VALUE,0) from TM_SYS_APPSETTINGS where CODE = 'OPD_TOAMUANGOAI_DUNGDANHMUC_DUOC'                if @TOAMUANGOAI = 1        begin        select  distinct '0' + '_' + LTRIM(d.DUOC_ID) + '_' + '0' as DUOC_KEY, 999999999 as SOLUONG        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = '01819'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = '01819')        where  @param0  = 0        union all        select distinct tk.DUOC_KEY, tk.SOLUONG        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = '01819'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = '01819')        inner join        (        select  LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')) DUOC_KEY, (SUM(dtk.SOLUONG) - isnull(sum(A.SOLUONG),0) - isnull(sum(B.SOLUONG),0)) SOLUONG, pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        from (select sum(soluong) soluong,duoc_id,nguonduoc_id,khoduoc_id,benhvien_id from TT_DUOC_TONKHO  group by duoc_id,nguonduoc_id,khoduoc_id,benhvien_id) dtk        inner join TM_DUOC_PHAMVISD_MAPPING pvsd on dtk.KHODUOC_ID = pvsd.KHODUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NOITRU        where TRANGTHAI != 'HUY' and PHAMVI_ID =  @param0         group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) B on B.DUOC_ID = dtk.DUOC_ID and B.PHAMVI_ID = pvsd.PHAMVI_ID and B.NGUONHANG_ID = dtk.NGUONDUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NGOAITRU        where TRANGTHAI != 'HUY' and PHAMVI_ID =  @param0         group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) A on A.DUOC_ID = dtk.DUOC_ID and A.PHAMVI_ID = pvsd.PHAMVI_ID and A.NGUONHANG_ID = dtk.NGUONDUOC_ID        where dtk.BENHVIEN_ID = '01819'        group by LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')), pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        ) tk on tk.DUOC_ID = d.DUOC_ID        left join TM_DUOC_PHAMVISUDUNG kd on kd.PHAMVI_ID = tk.PHAMVI_ID and kd.BENHVIEN_ID = '01819'        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = tk.NGUONDUOC_ID and nh.BENHVIEN_ID = '01819'        where d.BENHVIEN_ID = '01819' and tk.PHAMVI_ID =  @param0         end        else        begin        select distinct tk.DUOC_KEY, tk.SOLUONG        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = '01819'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = '01819')        inner join        (        select  LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')) DUOC_KEY, (SUM(dtk.SOLUONG) - isnull(sum(A.SOLUONG),0) - isnull(sum(B.SOLUONG),0)) SOLUONG, pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        from (select sum(soluong) soluong,duoc_id,nguonduoc_id,khoduoc_id,benhvien_id from TT_DUOC_TONKHO        group by duoc_id,nguonduoc_id,khoduoc_id,benhvien_id) dtk        inner join TM_DUOC_PHAMVISD_MAPPING pvsd on dtk.KHODUOC_ID = pvsd.KHODUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NOITRU        where TRANGTHAI != 'HUY' and PHAMVI_ID =  @param0         group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) B on B.DUOC_ID = dtk.DUOC_ID and B.PHAMVI_ID = pvsd.PHAMVI_ID and B.NGUONHANG_ID = dtk.NGUONDUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NGOAITRU        where TRANGTHAI != 'HUY' and PHAMVI_ID =  @param0         group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) A on A.DUOC_ID = dtk.DUOC_ID and A.PHAMVI_ID = pvsd.PHAMVI_ID and A.NGUONHANG_ID = dtk.NGUONDUOC_ID        where dtk.BENHVIEN_ID = '01819'        group by LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')), pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        ) tk on tk.DUOC_ID = d.DUOC_ID        left join TM_DUOC_PHAMVISUDUNG kd on kd.PHAMVI_ID = tk.PHAMVI_ID and kd.BENHVIEN_ID = '01819'        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = tk.NGUONDUOC_ID and nh.BENHVIEN_ID = '01819'        where d.BENHVIEN_ID = '01819' and tk.PHAMVI_ID =  @param0         end]
2020-07-16 15:53:04,791 [1] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoVaBookingCOM23UpdateRedis_TheoPhamvi] Parameters: [@param0=[PHAMVI_ID,8]]
2020-07-16 15:53:04,791 [1] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoVaBookingCOM23UpdateRedis_TheoPhamvi] Types: [@param0=[Int64, System.Int64]]
2020-07-16 15:53:04,821 [1] DEBUG - Statement Id: [DAO00012_GetLoaiTCLS] PreparedStatement : [select DICTIONARY_ID, DICTIONARY_CODE, DICTIONARY_NAME, cast('0' as Bit) CHON        from LST_DICTIONARY              where DICTIONARY_TYPE_CODE = 'KHAMBENH_LOAI_TRIEUCHUNGLS'        order by LST_DICTIONARY.IDX]
2020-07-16 15:53:04,846 [1] DEBUG - Statement Id: [DAO00012_GetAllTCLS] PreparedStatement : [select MALOAITRIEUCHUNG DICTIONARY_TYPE_CODE, MALOAITRIEUCHUNG DICTIONARY_CODE,        TENTRIEUCHUNG DICTIONARY_NAME from TM_TRIEUCHUNGLS]
2020-07-16 15:53:04,870 [1] DEBUG - Statement Id: [DAO00019_ThongTinBenhNhanDvYeuCau] PreparedStatement : [select distinct A.SOTIEPNHAN, A.TIEPNHAN_ID, A.DOITUONG_ID, A.TRANGTHAI,        A.LOAITHANHVIEN_ID, A.SUDUNG_BHTN, A.THE_ID, A.THANHVIEN_ID, A.VIP, A.NGUON_BENHNHAN_ID, A.BAOLANH_VIENPHI, A.NGAYMIENDONGCHITRA,        B.*,  C.DICHVU_ID, C.DVYEUCAU_ID, C.NOITHUCHIEN_ID, A.SOBHYT        from TT_TIEPNHAN A        inner join TT_DVYEUCAU C on C.TIEPNHAN_ID = A.TIEPNHAN_ID        inner join TT_BENHNHAN B on B.BENHNHAN_ID = A.BENHNHAN_ID and B.ACTIVE = '1'        where                    C.DVYEUCAU_ID = '13147'                 and A.BENHVIEN_ID = '01819']
2020-07-16 15:53:04,964 [1] DEBUG - Statement Id: [DAO00017_GetLoaiGiaByDoiTuongId] PreparedStatement : [select dtlg.DOUUTIEN, dtlg.DOITUONG_ID, lg.LOAIGIA_ID, lg.TENLOAIGIA, lg.MALOAIGIA              from TM_LOAIGIA lg              left join TM_DOITUONG_LOAIGIA dtlg              on lg.LOAIGIA_ID = dtlg.LOAIGIA_ID and dtlg.BENHVIEN_ID = '01819'              where lg.TAMNGUNG = 0 and lg.BENHVIEN_ID = '01819'                             order by dtlg.DOUUTIEN]
2020-07-16 15:53:05,000 [1] DEBUG - Statement Id: [DAO00092_GetList_ToathuocNgoaitru] PreparedStatement : [select A.*, B.PHAMVI_ID, C.KHODUOC_ID from TM_TOATHUOC_NGOAITRU A        left join TM_DUOC_PHAMVISUDUNG B on B.MAPHAMVI = A.MAPHAMVI        left join (select distinct PHAMVI_ID, KHODUOC_ID from TM_DUOC_PHAMVISD_MAPPING) C on C.PHAMVI_ID = B.PHAMVI_ID        where A.TAMNGUNG != '1' and A.BENHVIEN_ID = '01819'        ORDER BY A.SAPXEP ASC]
2020-07-16 15:53:05,024 [1] DEBUG - Statement Id: [DAO00063_GetListDTPhamviToathuoc] PreparedStatement : [select B.*, C.KHODUOC_ID        from TM_PHAMVI_DOITUONG_TOATHUOC B        left join (select distinct PHAMVI_ID, KHODUOC_ID from TM_DUOC_PHAMVISD_MAPPING) C on C.PHAMVI_ID = B.PHAMVI_ID        where B.TAMNGUNG != '1' and B.DOITUONG_ID = '1']
2020-07-16 15:53:05,060 [1] DEBUG - Statement Id: [DAO00305_GetAllLoaiToaThuoc] PreparedStatement : [declare @LOAITOATHUOC varchar(200)        set @LOAITOATHUOC = (select top 1 LOAITOATHUOC = STUFF((SELECT ',' + LOAITOATHUOC FROM TM_TOATHUOC_NGOAITRU where BENHVIEN_ID = '01819' FOR XML PATH ('')), 1, 1, '')        from TM_TOATHUOC_NGOAITRU)        set @LOAITOATHUOC = '''' +  REPLACE(@LOAITOATHUOC,',',''',''') + ''''        select @LOAITOATHUOC as LOAITOATHUOC]
2020-07-16 15:53:05,130 [1] DEBUG - Statement Id: [DAO00040_LayListToaMau] PreparedStatement : [select A.*, dc.TENDUOCDAYDU, dc.BHYT DUOC_BHYT, ld.LOAIVATTU_ID, ld.MALOAIDUOC, dd.DICTIONARY_NAME DUONGDUNG, dc.TAMNGUNG            from TT_TOATHUOCMAU A            left join TM_DUOC dc on A.DUOC_ID = dc.DUOC_ID            left join TM_LOAIDUOC ld on dc.LOAIDUOC_ID = ld.LOAIDUOC_ID            left join (select * from LST_DICTIONARY where DICTIONARY_TYPE_CODE like 'DuongDung') dd on dd.DICTIONARY_ID = dc.DUONGDUNG_ID            where (1=1)             and               A.BACSI_ID  = 1             and               A.LOAITOATHUOC IN ('BV','MN','BV','KTBV','KTBV','BV')]
2020-07-16 15:53:05,199 [1] DEBUG - Statement Id: [DAO00305_GetAllLoaiToaThuoc] PreparedStatement : [declare @LOAITOATHUOC varchar(200)        set @LOAITOATHUOC = (select top 1 LOAITOATHUOC = STUFF((SELECT ',' + LOAITOATHUOC FROM TM_TOATHUOC_NGOAITRU where BENHVIEN_ID = '01819' FOR XML PATH ('')), 1, 1, '')        from TM_TOATHUOC_NGOAITRU)        set @LOAITOATHUOC = '''' +  REPLACE(@LOAITOATHUOC,',',''',''') + ''''        select @LOAITOATHUOC as LOAITOATHUOC]
2020-07-16 15:53:05,270 [1] DEBUG - Statement Id: [DAO00040_LayListToaMau] PreparedStatement : [select A.*, dc.TENDUOCDAYDU, dc.BHYT DUOC_BHYT, ld.LOAIVATTU_ID, ld.MALOAIDUOC, dd.DICTIONARY_NAME DUONGDUNG, dc.TAMNGUNG            from TT_TOATHUOCMAU A            left join TM_DUOC dc on A.DUOC_ID = dc.DUOC_ID            left join TM_LOAIDUOC ld on dc.LOAIDUOC_ID = ld.LOAIDUOC_ID            left join (select * from LST_DICTIONARY where DICTIONARY_TYPE_CODE like 'DuongDung') dd on dd.DICTIONARY_ID = dc.DUONGDUNG_ID            where (1=1)             and               A.BACSI_ID  = 1             and               A.LOAITOATHUOC IN ('BV','MN','BV','KTBV','KTBV','BV')]
2020-07-16 15:53:05,315 [1] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoVaBookingCOM23UpdateRedis_TheoPhamvi] PreparedStatement : [declare @TOAMUANGOAI int = 0;        select @TOAMUANGOAI = isnull(VALUE,0) from TM_SYS_APPSETTINGS where CODE = 'OPD_TOAMUANGOAI_DUNGDANHMUC_DUOC'                if @TOAMUANGOAI = 1        begin        select  distinct '0' + '_' + LTRIM(d.DUOC_ID) + '_' + '0' as DUOC_KEY, 999999999 as SOLUONG        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = '01819'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = '01819')        where  @param0  = 0        union all        select distinct tk.DUOC_KEY, tk.SOLUONG        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = '01819'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = '01819')        inner join        (        select  LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')) DUOC_KEY, (SUM(dtk.SOLUONG) - isnull(sum(A.SOLUONG),0) - isnull(sum(B.SOLUONG),0)) SOLUONG, pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        from (select sum(soluong) soluong,duoc_id,nguonduoc_id,khoduoc_id,benhvien_id from TT_DUOC_TONKHO  group by duoc_id,nguonduoc_id,khoduoc_id,benhvien_id) dtk        inner join TM_DUOC_PHAMVISD_MAPPING pvsd on dtk.KHODUOC_ID = pvsd.KHODUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NOITRU        where TRANGTHAI != 'HUY' and PHAMVI_ID =  @param0         group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) B on B.DUOC_ID = dtk.DUOC_ID and B.PHAMVI_ID = pvsd.PHAMVI_ID and B.NGUONHANG_ID = dtk.NGUONDUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NGOAITRU        where TRANGTHAI != 'HUY' and PHAMVI_ID =  @param0         group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) A on A.DUOC_ID = dtk.DUOC_ID and A.PHAMVI_ID = pvsd.PHAMVI_ID and A.NGUONHANG_ID = dtk.NGUONDUOC_ID        where dtk.BENHVIEN_ID = '01819'        group by LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')), pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        ) tk on tk.DUOC_ID = d.DUOC_ID        left join TM_DUOC_PHAMVISUDUNG kd on kd.PHAMVI_ID = tk.PHAMVI_ID and kd.BENHVIEN_ID = '01819'        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = tk.NGUONDUOC_ID and nh.BENHVIEN_ID = '01819'        where d.BENHVIEN_ID = '01819' and tk.PHAMVI_ID =  @param0         end        else        begin        select distinct tk.DUOC_KEY, tk.SOLUONG        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = '01819'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = '01819')        inner join        (        select  LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')) DUOC_KEY, (SUM(dtk.SOLUONG) - isnull(sum(A.SOLUONG),0) - isnull(sum(B.SOLUONG),0)) SOLUONG, pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        from (select sum(soluong) soluong,duoc_id,nguonduoc_id,khoduoc_id,benhvien_id from TT_DUOC_TONKHO        group by duoc_id,nguonduoc_id,khoduoc_id,benhvien_id) dtk        inner join TM_DUOC_PHAMVISD_MAPPING pvsd on dtk.KHODUOC_ID = pvsd.KHODUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NOITRU        where TRANGTHAI != 'HUY' and PHAMVI_ID =  @param0         group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) B on B.DUOC_ID = dtk.DUOC_ID and B.PHAMVI_ID = pvsd.PHAMVI_ID and B.NGUONHANG_ID = dtk.NGUONDUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NGOAITRU        where TRANGTHAI != 'HUY' and PHAMVI_ID =  @param0         group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) A on A.DUOC_ID = dtk.DUOC_ID and A.PHAMVI_ID = pvsd.PHAMVI_ID and A.NGUONHANG_ID = dtk.NGUONDUOC_ID        where dtk.BENHVIEN_ID = '01819'        group by LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')), pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        ) tk on tk.DUOC_ID = d.DUOC_ID        left join TM_DUOC_PHAMVISUDUNG kd on kd.PHAMVI_ID = tk.PHAMVI_ID and kd.BENHVIEN_ID = '01819'        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = tk.NGUONDUOC_ID and nh.BENHVIEN_ID = '01819'        where d.BENHVIEN_ID = '01819' and tk.PHAMVI_ID =  @param0         end]
2020-07-16 15:53:05,315 [1] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoVaBookingCOM23UpdateRedis_TheoPhamvi] Parameters: [@param0=[PHAMVI_ID,8]]
2020-07-16 15:53:05,315 [1] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoVaBookingCOM23UpdateRedis_TheoPhamvi] Types: [@param0=[Int64, System.Int64]]
2020-07-16 15:53:05,369 [1] DEBUG - Statement Id: [DAO00013_GetTienSuBenh] PreparedStatement : [select TIENSUBENH, TIENSUDIUNG        from TT_BENHNHAN        where TT_BENHNHAN.BENHNHAN_ID  = '8731']
2020-07-16 15:53:05,392 [1] DEBUG - Statement Id: [DAO00095_GetTTDiUngThuoc] PreparedStatement : [select *              from TT_BENHNHAN_DIUNG_THUOC              where BENHNHAN_ID = '8731'              and BENHVIEN_ID = '01819']
2020-07-16 15:53:05,415 [1] DEBUG - Statement Id: [DAO00014_GetTotalChiPhiDVByTiepNhan] PreparedStatement : [select sum(THANHTIEN_DOANHTHU) as THANHTIEN_DOANHTHU from TT_VIENPHI        where ACTIVE = '1'        and TIEPNHAN_ID = '8747'        and REF_TABLE = 'TT_DVYEUCAU'        and exists (select DVYEUCAU_ID from TT_DVYEUCAU where HUYYEUCAU = '0' and TIEPNHAN_ID = '8747' and TT_VIENPHI.REF_ID = DVYEUCAU_ID)]
2020-07-16 15:53:05,462 [1] DEBUG - Statement Id: [DAO00014_GetKhamBenhInfo] PreparedStatement : [select * from TT_NGOAITRU_KHAMBENH where KHAMBENH_ID =        (select KHAMBENH_NGOAITRU_ID from TT_DVYEUCAU where DVYEUCAU_ID = '13147')]
2020-07-16 15:53:05,493 [1] DEBUG - Statement Id: [DAO00014_GetSoCaKhamTrongNgay] PreparedStatement : [select Count(KB.KHAMBENH_ID) as SOCAKHAMTRONGNGAY        from TT_NGOAITRU_KHAMBENH KB        inner join TT_TIEPNHAN TN on TN.TIEPNHAN_ID = KB.TIEPNHAN_ID        where KB.NGAYKHAM = convert(date, GETDATE())        and KB.BACSIKHAM_ID = '1'        and KB.BENHVIEN_ID = '01819'        and TN.SOBHYT IS NOT NULL and TN.SOBHYT != '']
2020-07-16 15:53:05,541 [1] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoVaBookingCOM23UpdateRedis_TheoPhamvi] PreparedStatement : [declare @TOAMUANGOAI int = 0;        select @TOAMUANGOAI = isnull(VALUE,0) from TM_SYS_APPSETTINGS where CODE = 'OPD_TOAMUANGOAI_DUNGDANHMUC_DUOC'                if @TOAMUANGOAI = 1        begin        select  distinct '0' + '_' + LTRIM(d.DUOC_ID) + '_' + '0' as DUOC_KEY, 999999999 as SOLUONG        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = '01819'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = '01819')        where  @param0  = 0        union all        select distinct tk.DUOC_KEY, tk.SOLUONG        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = '01819'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = '01819')        inner join        (        select  LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')) DUOC_KEY, (SUM(dtk.SOLUONG) - isnull(sum(A.SOLUONG),0) - isnull(sum(B.SOLUONG),0)) SOLUONG, pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        from (select sum(soluong) soluong,duoc_id,nguonduoc_id,khoduoc_id,benhvien_id from TT_DUOC_TONKHO  group by duoc_id,nguonduoc_id,khoduoc_id,benhvien_id) dtk        inner join TM_DUOC_PHAMVISD_MAPPING pvsd on dtk.KHODUOC_ID = pvsd.KHODUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NOITRU        where TRANGTHAI != 'HUY' and PHAMVI_ID =  @param0         group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) B on B.DUOC_ID = dtk.DUOC_ID and B.PHAMVI_ID = pvsd.PHAMVI_ID and B.NGUONHANG_ID = dtk.NGUONDUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NGOAITRU        where TRANGTHAI != 'HUY' and PHAMVI_ID =  @param0         group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) A on A.DUOC_ID = dtk.DUOC_ID and A.PHAMVI_ID = pvsd.PHAMVI_ID and A.NGUONHANG_ID = dtk.NGUONDUOC_ID        where dtk.BENHVIEN_ID = '01819'        group by LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')), pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        ) tk on tk.DUOC_ID = d.DUOC_ID        left join TM_DUOC_PHAMVISUDUNG kd on kd.PHAMVI_ID = tk.PHAMVI_ID and kd.BENHVIEN_ID = '01819'        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = tk.NGUONDUOC_ID and nh.BENHVIEN_ID = '01819'        where d.BENHVIEN_ID = '01819' and tk.PHAMVI_ID =  @param0         end        else        begin        select distinct tk.DUOC_KEY, tk.SOLUONG        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = '01819'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = '01819')        inner join        (        select  LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')) DUOC_KEY, (SUM(dtk.SOLUONG) - isnull(sum(A.SOLUONG),0) - isnull(sum(B.SOLUONG),0)) SOLUONG, pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        from (select sum(soluong) soluong,duoc_id,nguonduoc_id,khoduoc_id,benhvien_id from TT_DUOC_TONKHO        group by duoc_id,nguonduoc_id,khoduoc_id,benhvien_id) dtk        inner join TM_DUOC_PHAMVISD_MAPPING pvsd on dtk.KHODUOC_ID = pvsd.KHODUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NOITRU        where TRANGTHAI != 'HUY' and PHAMVI_ID =  @param0         group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) B on B.DUOC_ID = dtk.DUOC_ID and B.PHAMVI_ID = pvsd.PHAMVI_ID and B.NGUONHANG_ID = dtk.NGUONDUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NGOAITRU        where TRANGTHAI != 'HUY' and PHAMVI_ID =  @param0         group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) A on A.DUOC_ID = dtk.DUOC_ID and A.PHAMVI_ID = pvsd.PHAMVI_ID and A.NGUONHANG_ID = dtk.NGUONDUOC_ID        where dtk.BENHVIEN_ID = '01819'        group by LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')), pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        ) tk on tk.DUOC_ID = d.DUOC_ID        left join TM_DUOC_PHAMVISUDUNG kd on kd.PHAMVI_ID = tk.PHAMVI_ID and kd.BENHVIEN_ID = '01819'        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = tk.NGUONDUOC_ID and nh.BENHVIEN_ID = '01819'        where d.BENHVIEN_ID = '01819' and tk.PHAMVI_ID =  @param0         end]
2020-07-16 15:53:05,541 [1] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoVaBookingCOM23UpdateRedis_TheoPhamvi] Parameters: [@param0=[PHAMVI_ID,8]]
2020-07-16 15:53:05,541 [1] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoVaBookingCOM23UpdateRedis_TheoPhamvi] Types: [@param0=[Int64, System.Int64]]
2020-07-16 15:53:05,642 [1] DEBUG - Statement Id: [DAO00019_ThongTinBenhNhanDvYeuCau] PreparedStatement : [select distinct A.SOTIEPNHAN, A.TIEPNHAN_ID, A.DOITUONG_ID, A.TRANGTHAI,        A.LOAITHANHVIEN_ID, A.SUDUNG_BHTN, A.THE_ID, A.THANHVIEN_ID, A.VIP, A.NGUON_BENHNHAN_ID, A.BAOLANH_VIENPHI, A.NGAYMIENDONGCHITRA,        B.*,  C.DICHVU_ID, C.DVYEUCAU_ID, C.NOITHUCHIEN_ID, A.SOBHYT        from TT_TIEPNHAN A        inner join TT_DVYEUCAU C on C.TIEPNHAN_ID = A.TIEPNHAN_ID        inner join TT_BENHNHAN B on B.BENHNHAN_ID = A.BENHNHAN_ID and B.ACTIVE = '1'        where                    C.DVYEUCAU_ID = '13147'                 and A.BENHVIEN_ID = '01819']
2020-07-16 15:53:05,720 [1] DEBUG - Statement Id: [DAO00017_GetLoaiGiaByDoiTuongId] PreparedStatement : [select dtlg.DOUUTIEN, dtlg.DOITUONG_ID, lg.LOAIGIA_ID, lg.TENLOAIGIA, lg.MALOAIGIA              from TM_LOAIGIA lg              left join TM_DOITUONG_LOAIGIA dtlg              on lg.LOAIGIA_ID = dtlg.LOAIGIA_ID and dtlg.BENHVIEN_ID = '01819'              where lg.TAMNGUNG = 0 and lg.BENHVIEN_ID = '01819'                             order by dtlg.DOUUTIEN]
2020-07-16 15:53:05,750 [1] DEBUG - Statement Id: [DAO00092_GetList_ToathuocNgoaitru] PreparedStatement : [select A.*, B.PHAMVI_ID, C.KHODUOC_ID from TM_TOATHUOC_NGOAITRU A        left join TM_DUOC_PHAMVISUDUNG B on B.MAPHAMVI = A.MAPHAMVI        left join (select distinct PHAMVI_ID, KHODUOC_ID from TM_DUOC_PHAMVISD_MAPPING) C on C.PHAMVI_ID = B.PHAMVI_ID        where A.TAMNGUNG != '1' and A.BENHVIEN_ID = '01819'        ORDER BY A.SAPXEP ASC]
2020-07-16 15:53:05,774 [1] DEBUG - Statement Id: [DAO00063_GetListDTPhamviToathuoc] PreparedStatement : [select B.*, C.KHODUOC_ID        from TM_PHAMVI_DOITUONG_TOATHUOC B        left join (select distinct PHAMVI_ID, KHODUOC_ID from TM_DUOC_PHAMVISD_MAPPING) C on C.PHAMVI_ID = B.PHAMVI_ID        where B.TAMNGUNG != '1' and B.DOITUONG_ID = '1']
2020-07-16 15:53:05,799 [1] DEBUG - Statement Id: [DAO00305_GetAllLoaiToaThuoc] PreparedStatement : [declare @LOAITOATHUOC varchar(200)        set @LOAITOATHUOC = (select top 1 LOAITOATHUOC = STUFF((SELECT ',' + LOAITOATHUOC FROM TM_TOATHUOC_NGOAITRU where BENHVIEN_ID = '01819' FOR XML PATH ('')), 1, 1, '')        from TM_TOATHUOC_NGOAITRU)        set @LOAITOATHUOC = '''' +  REPLACE(@LOAITOATHUOC,',',''',''') + ''''        select @LOAITOATHUOC as LOAITOATHUOC]
2020-07-16 15:53:05,870 [1] DEBUG - Statement Id: [DAO00040_LayListToaMau] PreparedStatement : [select A.*, dc.TENDUOCDAYDU, dc.BHYT DUOC_BHYT, ld.LOAIVATTU_ID, ld.MALOAIDUOC, dd.DICTIONARY_NAME DUONGDUNG, dc.TAMNGUNG            from TT_TOATHUOCMAU A            left join TM_DUOC dc on A.DUOC_ID = dc.DUOC_ID            left join TM_LOAIDUOC ld on dc.LOAIDUOC_ID = ld.LOAIDUOC_ID            left join (select * from LST_DICTIONARY where DICTIONARY_TYPE_CODE like 'DuongDung') dd on dd.DICTIONARY_ID = dc.DUONGDUNG_ID            where (1=1)             and               A.BACSI_ID  = 1             and               A.LOAITOATHUOC IN ('BV','MN','BV','KTBV','KTBV','BV')]
2020-07-16 15:53:05,917 [1] DEBUG - Statement Id: [DAO00305_GetAllLoaiToaThuoc] PreparedStatement : [declare @LOAITOATHUOC varchar(200)        set @LOAITOATHUOC = (select top 1 LOAITOATHUOC = STUFF((SELECT ',' + LOAITOATHUOC FROM TM_TOATHUOC_NGOAITRU where BENHVIEN_ID = '01819' FOR XML PATH ('')), 1, 1, '')        from TM_TOATHUOC_NGOAITRU)        set @LOAITOATHUOC = '''' +  REPLACE(@LOAITOATHUOC,',',''',''') + ''''        select @LOAITOATHUOC as LOAITOATHUOC]
2020-07-16 15:53:05,987 [1] DEBUG - Statement Id: [DAO00040_LayListToaMau] PreparedStatement : [select A.*, dc.TENDUOCDAYDU, dc.BHYT DUOC_BHYT, ld.LOAIVATTU_ID, ld.MALOAIDUOC, dd.DICTIONARY_NAME DUONGDUNG, dc.TAMNGUNG            from TT_TOATHUOCMAU A            left join TM_DUOC dc on A.DUOC_ID = dc.DUOC_ID            left join TM_LOAIDUOC ld on dc.LOAIDUOC_ID = ld.LOAIDUOC_ID            left join (select * from LST_DICTIONARY where DICTIONARY_TYPE_CODE like 'DuongDung') dd on dd.DICTIONARY_ID = dc.DUONGDUNG_ID            where (1=1)             and               A.BACSI_ID  = 1             and               A.LOAITOATHUOC IN ('BV','MN','BV','KTBV','KTBV','BV')]
2020-07-16 15:53:06,050 [1] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoVaBookingCOM23UpdateRedis_TheoPhamvi] PreparedStatement : [declare @TOAMUANGOAI int = 0;        select @TOAMUANGOAI = isnull(VALUE,0) from TM_SYS_APPSETTINGS where CODE = 'OPD_TOAMUANGOAI_DUNGDANHMUC_DUOC'                if @TOAMUANGOAI = 1        begin        select  distinct '0' + '_' + LTRIM(d.DUOC_ID) + '_' + '0' as DUOC_KEY, 999999999 as SOLUONG        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = '01819'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = '01819')        where  @param0  = 0        union all        select distinct tk.DUOC_KEY, tk.SOLUONG        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = '01819'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = '01819')        inner join        (        select  LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')) DUOC_KEY, (SUM(dtk.SOLUONG) - isnull(sum(A.SOLUONG),0) - isnull(sum(B.SOLUONG),0)) SOLUONG, pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        from (select sum(soluong) soluong,duoc_id,nguonduoc_id,khoduoc_id,benhvien_id from TT_DUOC_TONKHO  group by duoc_id,nguonduoc_id,khoduoc_id,benhvien_id) dtk        inner join TM_DUOC_PHAMVISD_MAPPING pvsd on dtk.KHODUOC_ID = pvsd.KHODUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NOITRU        where TRANGTHAI != 'HUY' and PHAMVI_ID =  @param0         group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) B on B.DUOC_ID = dtk.DUOC_ID and B.PHAMVI_ID = pvsd.PHAMVI_ID and B.NGUONHANG_ID = dtk.NGUONDUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NGOAITRU        where TRANGTHAI != 'HUY' and PHAMVI_ID =  @param0         group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) A on A.DUOC_ID = dtk.DUOC_ID and A.PHAMVI_ID = pvsd.PHAMVI_ID and A.NGUONHANG_ID = dtk.NGUONDUOC_ID        where dtk.BENHVIEN_ID = '01819'        group by LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')), pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        ) tk on tk.DUOC_ID = d.DUOC_ID        left join TM_DUOC_PHAMVISUDUNG kd on kd.PHAMVI_ID = tk.PHAMVI_ID and kd.BENHVIEN_ID = '01819'        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = tk.NGUONDUOC_ID and nh.BENHVIEN_ID = '01819'        where d.BENHVIEN_ID = '01819' and tk.PHAMVI_ID =  @param0         end        else        begin        select distinct tk.DUOC_KEY, tk.SOLUONG        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = '01819'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = '01819')        inner join        (        select  LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')) DUOC_KEY, (SUM(dtk.SOLUONG) - isnull(sum(A.SOLUONG),0) - isnull(sum(B.SOLUONG),0)) SOLUONG, pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        from (select sum(soluong) soluong,duoc_id,nguonduoc_id,khoduoc_id,benhvien_id from TT_DUOC_TONKHO        group by duoc_id,nguonduoc_id,khoduoc_id,benhvien_id) dtk        inner join TM_DUOC_PHAMVISD_MAPPING pvsd on dtk.KHODUOC_ID = pvsd.KHODUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NOITRU        where TRANGTHAI != 'HUY' and PHAMVI_ID =  @param0         group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) B on B.DUOC_ID = dtk.DUOC_ID and B.PHAMVI_ID = pvsd.PHAMVI_ID and B.NGUONHANG_ID = dtk.NGUONDUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NGOAITRU        where TRANGTHAI != 'HUY' and PHAMVI_ID =  @param0         group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) A on A.DUOC_ID = dtk.DUOC_ID and A.PHAMVI_ID = pvsd.PHAMVI_ID and A.NGUONHANG_ID = dtk.NGUONDUOC_ID        where dtk.BENHVIEN_ID = '01819'        group by LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')), pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        ) tk on tk.DUOC_ID = d.DUOC_ID        left join TM_DUOC_PHAMVISUDUNG kd on kd.PHAMVI_ID = tk.PHAMVI_ID and kd.BENHVIEN_ID = '01819'        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = tk.NGUONDUOC_ID and nh.BENHVIEN_ID = '01819'        where d.BENHVIEN_ID = '01819' and tk.PHAMVI_ID =  @param0         end]
2020-07-16 15:53:06,050 [1] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoVaBookingCOM23UpdateRedis_TheoPhamvi] Parameters: [@param0=[PHAMVI_ID,8]]
2020-07-16 15:53:06,050 [1] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoVaBookingCOM23UpdateRedis_TheoPhamvi] Types: [@param0=[Int64, System.Int64]]
2020-07-16 15:53:06,083 [1] DEBUG - Statement Id: [DAO00013_GetTienSuBenh] PreparedStatement : [select TIENSUBENH, TIENSUDIUNG        from TT_BENHNHAN        where TT_BENHNHAN.BENHNHAN_ID  = '8731']
2020-07-16 15:53:06,105 [1] DEBUG - Statement Id: [DAO00095_GetTTDiUngThuoc] PreparedStatement : [select *              from TT_BENHNHAN_DIUNG_THUOC              where BENHNHAN_ID = '8731'              and BENHVIEN_ID = '01819']
2020-07-16 15:53:06,129 [1] DEBUG - Statement Id: [DAO00014_GetTotalChiPhiDVByTiepNhan] PreparedStatement : [select sum(THANHTIEN_DOANHTHU) as THANHTIEN_DOANHTHU from TT_VIENPHI        where ACTIVE = '1'        and TIEPNHAN_ID = '8747'        and REF_TABLE = 'TT_DVYEUCAU'        and exists (select DVYEUCAU_ID from TT_DVYEUCAU where HUYYEUCAU = '0' and TIEPNHAN_ID = '8747' and TT_VIENPHI.REF_ID = DVYEUCAU_ID)]
2020-07-16 15:53:06,154 [1] DEBUG - Statement Id: [DAO00014_GetKhamBenhInfo] PreparedStatement : [select * from TT_NGOAITRU_KHAMBENH where KHAMBENH_ID =        (select KHAMBENH_NGOAITRU_ID from TT_DVYEUCAU where DVYEUCAU_ID = '13147')]
2020-07-16 15:53:06,178 [1] DEBUG - Statement Id: [DAO00014_GetSoCaKhamTrongNgay] PreparedStatement : [select Count(KB.KHAMBENH_ID) as SOCAKHAMTRONGNGAY        from TT_NGOAITRU_KHAMBENH KB        inner join TT_TIEPNHAN TN on TN.TIEPNHAN_ID = KB.TIEPNHAN_ID        where KB.NGAYKHAM = convert(date, GETDATE())        and KB.BACSIKHAM_ID = '1'        and KB.BENHVIEN_ID = '01819'        and TN.SOBHYT IS NOT NULL and TN.SOBHYT != '']
2020-07-16 15:53:06,225 [1] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoVaBookingCOM23UpdateRedis_TheoPhamvi] PreparedStatement : [declare @TOAMUANGOAI int = 0;        select @TOAMUANGOAI = isnull(VALUE,0) from TM_SYS_APPSETTINGS where CODE = 'OPD_TOAMUANGOAI_DUNGDANHMUC_DUOC'                if @TOAMUANGOAI = 1        begin        select  distinct '0' + '_' + LTRIM(d.DUOC_ID) + '_' + '0' as DUOC_KEY, 999999999 as SOLUONG        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = '01819'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = '01819')        where  @param0  = 0        union all        select distinct tk.DUOC_KEY, tk.SOLUONG        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = '01819'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = '01819')        inner join        (        select  LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')) DUOC_KEY, (SUM(dtk.SOLUONG) - isnull(sum(A.SOLUONG),0) - isnull(sum(B.SOLUONG),0)) SOLUONG, pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        from (select sum(soluong) soluong,duoc_id,nguonduoc_id,khoduoc_id,benhvien_id from TT_DUOC_TONKHO  group by duoc_id,nguonduoc_id,khoduoc_id,benhvien_id) dtk        inner join TM_DUOC_PHAMVISD_MAPPING pvsd on dtk.KHODUOC_ID = pvsd.KHODUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NOITRU        where TRANGTHAI != 'HUY' and PHAMVI_ID =  @param0         group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) B on B.DUOC_ID = dtk.DUOC_ID and B.PHAMVI_ID = pvsd.PHAMVI_ID and B.NGUONHANG_ID = dtk.NGUONDUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NGOAITRU        where TRANGTHAI != 'HUY' and PHAMVI_ID =  @param0         group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) A on A.DUOC_ID = dtk.DUOC_ID and A.PHAMVI_ID = pvsd.PHAMVI_ID and A.NGUONHANG_ID = dtk.NGUONDUOC_ID        where dtk.BENHVIEN_ID = '01819'        group by LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')), pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        ) tk on tk.DUOC_ID = d.DUOC_ID        left join TM_DUOC_PHAMVISUDUNG kd on kd.PHAMVI_ID = tk.PHAMVI_ID and kd.BENHVIEN_ID = '01819'        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = tk.NGUONDUOC_ID and nh.BENHVIEN_ID = '01819'        where d.BENHVIEN_ID = '01819' and tk.PHAMVI_ID =  @param0         end        else        begin        select distinct tk.DUOC_KEY, tk.SOLUONG        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = '01819'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = '01819')        inner join        (        select  LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')) DUOC_KEY, (SUM(dtk.SOLUONG) - isnull(sum(A.SOLUONG),0) - isnull(sum(B.SOLUONG),0)) SOLUONG, pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        from (select sum(soluong) soluong,duoc_id,nguonduoc_id,khoduoc_id,benhvien_id from TT_DUOC_TONKHO        group by duoc_id,nguonduoc_id,khoduoc_id,benhvien_id) dtk        inner join TM_DUOC_PHAMVISD_MAPPING pvsd on dtk.KHODUOC_ID = pvsd.KHODUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NOITRU        where TRANGTHAI != 'HUY' and PHAMVI_ID =  @param0         group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) B on B.DUOC_ID = dtk.DUOC_ID and B.PHAMVI_ID = pvsd.PHAMVI_ID and B.NGUONHANG_ID = dtk.NGUONDUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NGOAITRU        where TRANGTHAI != 'HUY' and PHAMVI_ID =  @param0         group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) A on A.DUOC_ID = dtk.DUOC_ID and A.PHAMVI_ID = pvsd.PHAMVI_ID and A.NGUONHANG_ID = dtk.NGUONDUOC_ID        where dtk.BENHVIEN_ID = '01819'        group by LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')), pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        ) tk on tk.DUOC_ID = d.DUOC_ID        left join TM_DUOC_PHAMVISUDUNG kd on kd.PHAMVI_ID = tk.PHAMVI_ID and kd.BENHVIEN_ID = '01819'        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = tk.NGUONDUOC_ID and nh.BENHVIEN_ID = '01819'        where d.BENHVIEN_ID = '01819' and tk.PHAMVI_ID =  @param0         end]
2020-07-16 15:53:06,225 [1] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoVaBookingCOM23UpdateRedis_TheoPhamvi] Parameters: [@param0=[PHAMVI_ID,8]]
2020-07-16 15:53:06,225 [1] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoVaBookingCOM23UpdateRedis_TheoPhamvi] Types: [@param0=[Int64, System.Int64]]
2020-07-16 15:53:09,126 [1] DEBUG - Statement Id: [DAO00017_GetLoaiGiaByDoiTuongId] PreparedStatement : [select dtlg.DOUUTIEN, dtlg.DOITUONG_ID, lg.LOAIGIA_ID, lg.TENLOAIGIA, lg.MALOAIGIA              from TM_LOAIGIA lg              left join TM_DOITUONG_LOAIGIA dtlg              on lg.LOAIGIA_ID = dtlg.LOAIGIA_ID and dtlg.BENHVIEN_ID = '01819'              where lg.TAMNGUNG = 0 and lg.BENHVIEN_ID = '01819'                             order by dtlg.DOUUTIEN]
2020-07-16 15:53:09,185 [1] DEBUG - Statement Id: [DAO00305_GetAllLoaiToaThuoc] PreparedStatement : [declare @LOAITOATHUOC varchar(200)        set @LOAITOATHUOC = (select top 1 LOAITOATHUOC = STUFF((SELECT ',' + LOAITOATHUOC FROM TM_TOATHUOC_NGOAITRU where BENHVIEN_ID = '01819' FOR XML PATH ('')), 1, 1, '')        from TM_TOATHUOC_NGOAITRU)        set @LOAITOATHUOC = '''' +  REPLACE(@LOAITOATHUOC,',',''',''') + ''''        select @LOAITOATHUOC as LOAITOATHUOC]
2020-07-16 15:53:09,255 [1] DEBUG - Statement Id: [DAO00040_LayListToaMau] PreparedStatement : [select A.*, dc.TENDUOCDAYDU, dc.BHYT DUOC_BHYT, ld.LOAIVATTU_ID, ld.MALOAIDUOC, dd.DICTIONARY_NAME DUONGDUNG, dc.TAMNGUNG            from TT_TOATHUOCMAU A            left join TM_DUOC dc on A.DUOC_ID = dc.DUOC_ID            left join TM_LOAIDUOC ld on dc.LOAIDUOC_ID = ld.LOAIDUOC_ID            left join (select * from LST_DICTIONARY where DICTIONARY_TYPE_CODE like 'DuongDung') dd on dd.DICTIONARY_ID = dc.DUONGDUNG_ID            where (1=1)             and               A.BACSI_ID  = 1             and               A.LOAITOATHUOC IN ('BV','MN','BV','KTBV','KTBV','BV')]
2020-07-16 15:53:09,304 [1] DEBUG - Statement Id: [DAO00305_GetAllLoaiToaThuoc] PreparedStatement : [declare @LOAITOATHUOC varchar(200)        set @LOAITOATHUOC = (select top 1 LOAITOATHUOC = STUFF((SELECT ',' + LOAITOATHUOC FROM TM_TOATHUOC_NGOAITRU where BENHVIEN_ID = '01819' FOR XML PATH ('')), 1, 1, '')        from TM_TOATHUOC_NGOAITRU)        set @LOAITOATHUOC = '''' +  REPLACE(@LOAITOATHUOC,',',''',''') + ''''        select @LOAITOATHUOC as LOAITOATHUOC]
2020-07-16 15:53:09,372 [1] DEBUG - Statement Id: [DAO00040_LayListToaMau] PreparedStatement : [select A.*, dc.TENDUOCDAYDU, dc.BHYT DUOC_BHYT, ld.LOAIVATTU_ID, ld.MALOAIDUOC, dd.DICTIONARY_NAME DUONGDUNG, dc.TAMNGUNG            from TT_TOATHUOCMAU A            left join TM_DUOC dc on A.DUOC_ID = dc.DUOC_ID            left join TM_LOAIDUOC ld on dc.LOAIDUOC_ID = ld.LOAIDUOC_ID            left join (select * from LST_DICTIONARY where DICTIONARY_TYPE_CODE like 'DuongDung') dd on dd.DICTIONARY_ID = dc.DUONGDUNG_ID            where (1=1)             and               A.BACSI_ID  = 1             and               A.LOAITOATHUOC IN ('BV','MN','BV','KTBV','KTBV','BV')]
2020-07-16 15:53:09,411 [1] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoVaBookingCOM23UpdateRedis_TheoPhamvi] PreparedStatement : [declare @TOAMUANGOAI int = 0;        select @TOAMUANGOAI = isnull(VALUE,0) from TM_SYS_APPSETTINGS where CODE = 'OPD_TOAMUANGOAI_DUNGDANHMUC_DUOC'                if @TOAMUANGOAI = 1        begin        select  distinct '0' + '_' + LTRIM(d.DUOC_ID) + '_' + '0' as DUOC_KEY, 999999999 as SOLUONG        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = '01819'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = '01819')        where  @param0  = 0        union all        select distinct tk.DUOC_KEY, tk.SOLUONG        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = '01819'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = '01819')        inner join        (        select  LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')) DUOC_KEY, (SUM(dtk.SOLUONG) - isnull(sum(A.SOLUONG),0) - isnull(sum(B.SOLUONG),0)) SOLUONG, pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        from (select sum(soluong) soluong,duoc_id,nguonduoc_id,khoduoc_id,benhvien_id from TT_DUOC_TONKHO  group by duoc_id,nguonduoc_id,khoduoc_id,benhvien_id) dtk        inner join TM_DUOC_PHAMVISD_MAPPING pvsd on dtk.KHODUOC_ID = pvsd.KHODUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NOITRU        where TRANGTHAI != 'HUY' and PHAMVI_ID =  @param0         group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) B on B.DUOC_ID = dtk.DUOC_ID and B.PHAMVI_ID = pvsd.PHAMVI_ID and B.NGUONHANG_ID = dtk.NGUONDUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NGOAITRU        where TRANGTHAI != 'HUY' and PHAMVI_ID =  @param0         group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) A on A.DUOC_ID = dtk.DUOC_ID and A.PHAMVI_ID = pvsd.PHAMVI_ID and A.NGUONHANG_ID = dtk.NGUONDUOC_ID        where dtk.BENHVIEN_ID = '01819'        group by LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')), pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        ) tk on tk.DUOC_ID = d.DUOC_ID        left join TM_DUOC_PHAMVISUDUNG kd on kd.PHAMVI_ID = tk.PHAMVI_ID and kd.BENHVIEN_ID = '01819'        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = tk.NGUONDUOC_ID and nh.BENHVIEN_ID = '01819'        where d.BENHVIEN_ID = '01819' and tk.PHAMVI_ID =  @param0         end        else        begin        select distinct tk.DUOC_KEY, tk.SOLUONG        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = '01819'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = '01819')        inner join        (        select  LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')) DUOC_KEY, (SUM(dtk.SOLUONG) - isnull(sum(A.SOLUONG),0) - isnull(sum(B.SOLUONG),0)) SOLUONG, pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        from (select sum(soluong) soluong,duoc_id,nguonduoc_id,khoduoc_id,benhvien_id from TT_DUOC_TONKHO        group by duoc_id,nguonduoc_id,khoduoc_id,benhvien_id) dtk        inner join TM_DUOC_PHAMVISD_MAPPING pvsd on dtk.KHODUOC_ID = pvsd.KHODUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NOITRU        where TRANGTHAI != 'HUY' and PHAMVI_ID =  @param0         group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) B on B.DUOC_ID = dtk.DUOC_ID and B.PHAMVI_ID = pvsd.PHAMVI_ID and B.NGUONHANG_ID = dtk.NGUONDUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NGOAITRU        where TRANGTHAI != 'HUY' and PHAMVI_ID =  @param0         group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) A on A.DUOC_ID = dtk.DUOC_ID and A.PHAMVI_ID = pvsd.PHAMVI_ID and A.NGUONHANG_ID = dtk.NGUONDUOC_ID        where dtk.BENHVIEN_ID = '01819'        group by LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')), pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        ) tk on tk.DUOC_ID = d.DUOC_ID        left join TM_DUOC_PHAMVISUDUNG kd on kd.PHAMVI_ID = tk.PHAMVI_ID and kd.BENHVIEN_ID = '01819'        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = tk.NGUONDUOC_ID and nh.BENHVIEN_ID = '01819'        where d.BENHVIEN_ID = '01819' and tk.PHAMVI_ID =  @param0         end]
2020-07-16 15:53:09,411 [1] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoVaBookingCOM23UpdateRedis_TheoPhamvi] Parameters: [@param0=[PHAMVI_ID,8]]
2020-07-16 15:53:09,411 [1] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoVaBookingCOM23UpdateRedis_TheoPhamvi] Types: [@param0=[Int64, System.Int64]]
2020-07-16 15:53:09,441 [1] DEBUG - Statement Id: [DAO00012_GetLoaiTCLS] PreparedStatement : [select DICTIONARY_ID, DICTIONARY_CODE, DICTIONARY_NAME, cast('0' as Bit) CHON        from LST_DICTIONARY              where DICTIONARY_TYPE_CODE = 'KHAMBENH_LOAI_TRIEUCHUNGLS'        order by LST_DICTIONARY.IDX]
2020-07-16 15:53:09,466 [1] DEBUG - Statement Id: [DAO00012_GetAllTCLS] PreparedStatement : [select MALOAITRIEUCHUNG DICTIONARY_TYPE_CODE, MALOAITRIEUCHUNG DICTIONARY_CODE,        TENTRIEUCHUNG DICTIONARY_NAME from TM_TRIEUCHUNGLS]
2020-07-16 15:53:09,489 [1] DEBUG - Statement Id: [DAO00019_ThongTinBenhNhanDvYeuCau] PreparedStatement : [select distinct A.SOTIEPNHAN, A.TIEPNHAN_ID, A.DOITUONG_ID, A.TRANGTHAI,        A.LOAITHANHVIEN_ID, A.SUDUNG_BHTN, A.THE_ID, A.THANHVIEN_ID, A.VIP, A.NGUON_BENHNHAN_ID, A.BAOLANH_VIENPHI, A.NGAYMIENDONGCHITRA,        B.*,  C.DICHVU_ID, C.DVYEUCAU_ID, C.NOITHUCHIEN_ID, A.SOBHYT        from TT_TIEPNHAN A        inner join TT_DVYEUCAU C on C.TIEPNHAN_ID = A.TIEPNHAN_ID        inner join TT_BENHNHAN B on B.BENHNHAN_ID = A.BENHNHAN_ID and B.ACTIVE = '1'        where                    C.DVYEUCAU_ID = '13147'                 and A.BENHVIEN_ID = '01819']
2020-07-16 15:53:09,566 [1] DEBUG - Statement Id: [DAO00017_GetLoaiGiaByDoiTuongId] PreparedStatement : [select dtlg.DOUUTIEN, dtlg.DOITUONG_ID, lg.LOAIGIA_ID, lg.TENLOAIGIA, lg.MALOAIGIA              from TM_LOAIGIA lg              left join TM_DOITUONG_LOAIGIA dtlg              on lg.LOAIGIA_ID = dtlg.LOAIGIA_ID and dtlg.BENHVIEN_ID = '01819'              where lg.TAMNGUNG = 0 and lg.BENHVIEN_ID = '01819'                             order by dtlg.DOUUTIEN]
2020-07-16 15:53:09,597 [1] DEBUG - Statement Id: [DAO00092_GetList_ToathuocNgoaitru] PreparedStatement : [select A.*, B.PHAMVI_ID, C.KHODUOC_ID from TM_TOATHUOC_NGOAITRU A        left join TM_DUOC_PHAMVISUDUNG B on B.MAPHAMVI = A.MAPHAMVI        left join (select distinct PHAMVI_ID, KHODUOC_ID from TM_DUOC_PHAMVISD_MAPPING) C on C.PHAMVI_ID = B.PHAMVI_ID        where A.TAMNGUNG != '1' and A.BENHVIEN_ID = '01819'        ORDER BY A.SAPXEP ASC]
2020-07-16 15:53:09,622 [1] DEBUG - Statement Id: [DAO00063_GetListDTPhamviToathuoc] PreparedStatement : [select B.*, C.KHODUOC_ID        from TM_PHAMVI_DOITUONG_TOATHUOC B        left join (select distinct PHAMVI_ID, KHODUOC_ID from TM_DUOC_PHAMVISD_MAPPING) C on C.PHAMVI_ID = B.PHAMVI_ID        where B.TAMNGUNG != '1' and B.DOITUONG_ID = '1']
2020-07-16 15:53:09,647 [1] DEBUG - Statement Id: [DAO00305_GetAllLoaiToaThuoc] PreparedStatement : [declare @LOAITOATHUOC varchar(200)        set @LOAITOATHUOC = (select top 1 LOAITOATHUOC = STUFF((SELECT ',' + LOAITOATHUOC FROM TM_TOATHUOC_NGOAITRU where BENHVIEN_ID = '01819' FOR XML PATH ('')), 1, 1, '')        from TM_TOATHUOC_NGOAITRU)        set @LOAITOATHUOC = '''' +  REPLACE(@LOAITOATHUOC,',',''',''') + ''''        select @LOAITOATHUOC as LOAITOATHUOC]
2020-07-16 15:53:09,717 [1] DEBUG - Statement Id: [DAO00040_LayListToaMau] PreparedStatement : [select A.*, dc.TENDUOCDAYDU, dc.BHYT DUOC_BHYT, ld.LOAIVATTU_ID, ld.MALOAIDUOC, dd.DICTIONARY_NAME DUONGDUNG, dc.TAMNGUNG            from TT_TOATHUOCMAU A            left join TM_DUOC dc on A.DUOC_ID = dc.DUOC_ID            left join TM_LOAIDUOC ld on dc.LOAIDUOC_ID = ld.LOAIDUOC_ID            left join (select * from LST_DICTIONARY where DICTIONARY_TYPE_CODE like 'DuongDung') dd on dd.DICTIONARY_ID = dc.DUONGDUNG_ID            where (1=1)             and               A.BACSI_ID  = 1             and               A.LOAITOATHUOC IN ('BV','MN','BV','KTBV','KTBV','BV')]
2020-07-16 15:53:09,767 [1] DEBUG - Statement Id: [DAO00305_GetAllLoaiToaThuoc] PreparedStatement : [declare @LOAITOATHUOC varchar(200)        set @LOAITOATHUOC = (select top 1 LOAITOATHUOC = STUFF((SELECT ',' + LOAITOATHUOC FROM TM_TOATHUOC_NGOAITRU where BENHVIEN_ID = '01819' FOR XML PATH ('')), 1, 1, '')        from TM_TOATHUOC_NGOAITRU)        set @LOAITOATHUOC = '''' +  REPLACE(@LOAITOATHUOC,',',''',''') + ''''        select @LOAITOATHUOC as LOAITOATHUOC]
2020-07-16 15:53:09,837 [1] DEBUG - Statement Id: [DAO00040_LayListToaMau] PreparedStatement : [select A.*, dc.TENDUOCDAYDU, dc.BHYT DUOC_BHYT, ld.LOAIVATTU_ID, ld.MALOAIDUOC, dd.DICTIONARY_NAME DUONGDUNG, dc.TAMNGUNG            from TT_TOATHUOCMAU A            left join TM_DUOC dc on A.DUOC_ID = dc.DUOC_ID            left join TM_LOAIDUOC ld on dc.LOAIDUOC_ID = ld.LOAIDUOC_ID            left join (select * from LST_DICTIONARY where DICTIONARY_TYPE_CODE like 'DuongDung') dd on dd.DICTIONARY_ID = dc.DUONGDUNG_ID            where (1=1)             and               A.BACSI_ID  = 1             and               A.LOAITOATHUOC IN ('BV','MN','BV','KTBV','KTBV','BV')]
2020-07-16 15:53:09,883 [1] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoVaBookingCOM23UpdateRedis_TheoPhamvi] PreparedStatement : [declare @TOAMUANGOAI int = 0;        select @TOAMUANGOAI = isnull(VALUE,0) from TM_SYS_APPSETTINGS where CODE = 'OPD_TOAMUANGOAI_DUNGDANHMUC_DUOC'                if @TOAMUANGOAI = 1        begin        select  distinct '0' + '_' + LTRIM(d.DUOC_ID) + '_' + '0' as DUOC_KEY, 999999999 as SOLUONG        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = '01819'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = '01819')        where  @param0  = 0        union all        select distinct tk.DUOC_KEY, tk.SOLUONG        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = '01819'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = '01819')        inner join        (        select  LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')) DUOC_KEY, (SUM(dtk.SOLUONG) - isnull(sum(A.SOLUONG),0) - isnull(sum(B.SOLUONG),0)) SOLUONG, pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        from (select sum(soluong) soluong,duoc_id,nguonduoc_id,khoduoc_id,benhvien_id from TT_DUOC_TONKHO  group by duoc_id,nguonduoc_id,khoduoc_id,benhvien_id) dtk        inner join TM_DUOC_PHAMVISD_MAPPING pvsd on dtk.KHODUOC_ID = pvsd.KHODUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NOITRU        where TRANGTHAI != 'HUY' and PHAMVI_ID =  @param0         group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) B on B.DUOC_ID = dtk.DUOC_ID and B.PHAMVI_ID = pvsd.PHAMVI_ID and B.NGUONHANG_ID = dtk.NGUONDUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NGOAITRU        where TRANGTHAI != 'HUY' and PHAMVI_ID =  @param0         group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) A on A.DUOC_ID = dtk.DUOC_ID and A.PHAMVI_ID = pvsd.PHAMVI_ID and A.NGUONHANG_ID = dtk.NGUONDUOC_ID        where dtk.BENHVIEN_ID = '01819'        group by LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')), pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        ) tk on tk.DUOC_ID = d.DUOC_ID        left join TM_DUOC_PHAMVISUDUNG kd on kd.PHAMVI_ID = tk.PHAMVI_ID and kd.BENHVIEN_ID = '01819'        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = tk.NGUONDUOC_ID and nh.BENHVIEN_ID = '01819'        where d.BENHVIEN_ID = '01819' and tk.PHAMVI_ID =  @param0         end        else        begin        select distinct tk.DUOC_KEY, tk.SOLUONG        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = '01819'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = '01819')        inner join        (        select  LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')) DUOC_KEY, (SUM(dtk.SOLUONG) - isnull(sum(A.SOLUONG),0) - isnull(sum(B.SOLUONG),0)) SOLUONG, pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        from (select sum(soluong) soluong,duoc_id,nguonduoc_id,khoduoc_id,benhvien_id from TT_DUOC_TONKHO        group by duoc_id,nguonduoc_id,khoduoc_id,benhvien_id) dtk        inner join TM_DUOC_PHAMVISD_MAPPING pvsd on dtk.KHODUOC_ID = pvsd.KHODUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NOITRU        where TRANGTHAI != 'HUY' and PHAMVI_ID =  @param0         group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) B on B.DUOC_ID = dtk.DUOC_ID and B.PHAMVI_ID = pvsd.PHAMVI_ID and B.NGUONHANG_ID = dtk.NGUONDUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NGOAITRU        where TRANGTHAI != 'HUY' and PHAMVI_ID =  @param0         group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) A on A.DUOC_ID = dtk.DUOC_ID and A.PHAMVI_ID = pvsd.PHAMVI_ID and A.NGUONHANG_ID = dtk.NGUONDUOC_ID        where dtk.BENHVIEN_ID = '01819'        group by LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')), pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        ) tk on tk.DUOC_ID = d.DUOC_ID        left join TM_DUOC_PHAMVISUDUNG kd on kd.PHAMVI_ID = tk.PHAMVI_ID and kd.BENHVIEN_ID = '01819'        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = tk.NGUONDUOC_ID and nh.BENHVIEN_ID = '01819'        where d.BENHVIEN_ID = '01819' and tk.PHAMVI_ID =  @param0         end]
2020-07-16 15:53:09,883 [1] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoVaBookingCOM23UpdateRedis_TheoPhamvi] Parameters: [@param0=[PHAMVI_ID,8]]
2020-07-16 15:53:09,883 [1] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoVaBookingCOM23UpdateRedis_TheoPhamvi] Types: [@param0=[Int64, System.Int64]]
2020-07-16 15:53:09,913 [1] DEBUG - Statement Id: [DAO00013_GetTienSuBenh] PreparedStatement : [select TIENSUBENH, TIENSUDIUNG        from TT_BENHNHAN        where TT_BENHNHAN.BENHNHAN_ID  = '8731']
2020-07-16 15:53:09,937 [1] DEBUG - Statement Id: [DAO00095_GetTTDiUngThuoc] PreparedStatement : [select *              from TT_BENHNHAN_DIUNG_THUOC              where BENHNHAN_ID = '8731'              and BENHVIEN_ID = '01819']
2020-07-16 15:53:09,961 [1] DEBUG - Statement Id: [DAO00014_GetTotalChiPhiDVByTiepNhan] PreparedStatement : [select sum(THANHTIEN_DOANHTHU) as THANHTIEN_DOANHTHU from TT_VIENPHI        where ACTIVE = '1'        and TIEPNHAN_ID = '8747'        and REF_TABLE = 'TT_DVYEUCAU'        and exists (select DVYEUCAU_ID from TT_DVYEUCAU where HUYYEUCAU = '0' and TIEPNHAN_ID = '8747' and TT_VIENPHI.REF_ID = DVYEUCAU_ID)]
2020-07-16 15:53:09,990 [1] DEBUG - Statement Id: [DAO00014_GetKhamBenhInfo] PreparedStatement : [select * from TT_NGOAITRU_KHAMBENH where KHAMBENH_ID =        (select KHAMBENH_NGOAITRU_ID from TT_DVYEUCAU where DVYEUCAU_ID = '13147')]
2020-07-16 15:53:10,014 [1] DEBUG - Statement Id: [DAO00014_GetSoCaKhamTrongNgay] PreparedStatement : [select Count(KB.KHAMBENH_ID) as SOCAKHAMTRONGNGAY        from TT_NGOAITRU_KHAMBENH KB        inner join TT_TIEPNHAN TN on TN.TIEPNHAN_ID = KB.TIEPNHAN_ID        where KB.NGAYKHAM = convert(date, GETDATE())        and KB.BACSIKHAM_ID = '1'        and KB.BENHVIEN_ID = '01819'        and TN.SOBHYT IS NOT NULL and TN.SOBHYT != '']
2020-07-16 15:53:10,063 [1] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoVaBookingCOM23UpdateRedis_TheoPhamvi] PreparedStatement : [declare @TOAMUANGOAI int = 0;        select @TOAMUANGOAI = isnull(VALUE,0) from TM_SYS_APPSETTINGS where CODE = 'OPD_TOAMUANGOAI_DUNGDANHMUC_DUOC'                if @TOAMUANGOAI = 1        begin        select  distinct '0' + '_' + LTRIM(d.DUOC_ID) + '_' + '0' as DUOC_KEY, 999999999 as SOLUONG        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = '01819'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = '01819')        where  @param0  = 0        union all        select distinct tk.DUOC_KEY, tk.SOLUONG        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = '01819'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = '01819')        inner join        (        select  LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')) DUOC_KEY, (SUM(dtk.SOLUONG) - isnull(sum(A.SOLUONG),0) - isnull(sum(B.SOLUONG),0)) SOLUONG, pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        from (select sum(soluong) soluong,duoc_id,nguonduoc_id,khoduoc_id,benhvien_id from TT_DUOC_TONKHO  group by duoc_id,nguonduoc_id,khoduoc_id,benhvien_id) dtk        inner join TM_DUOC_PHAMVISD_MAPPING pvsd on dtk.KHODUOC_ID = pvsd.KHODUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NOITRU        where TRANGTHAI != 'HUY' and PHAMVI_ID =  @param0         group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) B on B.DUOC_ID = dtk.DUOC_ID and B.PHAMVI_ID = pvsd.PHAMVI_ID and B.NGUONHANG_ID = dtk.NGUONDUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NGOAITRU        where TRANGTHAI != 'HUY' and PHAMVI_ID =  @param0         group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) A on A.DUOC_ID = dtk.DUOC_ID and A.PHAMVI_ID = pvsd.PHAMVI_ID and A.NGUONHANG_ID = dtk.NGUONDUOC_ID        where dtk.BENHVIEN_ID = '01819'        group by LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')), pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        ) tk on tk.DUOC_ID = d.DUOC_ID        left join TM_DUOC_PHAMVISUDUNG kd on kd.PHAMVI_ID = tk.PHAMVI_ID and kd.BENHVIEN_ID = '01819'        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = tk.NGUONDUOC_ID and nh.BENHVIEN_ID = '01819'        where d.BENHVIEN_ID = '01819' and tk.PHAMVI_ID =  @param0         end        else        begin        select distinct tk.DUOC_KEY, tk.SOLUONG        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = '01819'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = '01819')        inner join        (        select  LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')) DUOC_KEY, (SUM(dtk.SOLUONG) - isnull(sum(A.SOLUONG),0) - isnull(sum(B.SOLUONG),0)) SOLUONG, pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        from (select sum(soluong) soluong,duoc_id,nguonduoc_id,khoduoc_id,benhvien_id from TT_DUOC_TONKHO        group by duoc_id,nguonduoc_id,khoduoc_id,benhvien_id) dtk        inner join TM_DUOC_PHAMVISD_MAPPING pvsd on dtk.KHODUOC_ID = pvsd.KHODUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NOITRU        where TRANGTHAI != 'HUY' and PHAMVI_ID =  @param0         group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) B on B.DUOC_ID = dtk.DUOC_ID and B.PHAMVI_ID = pvsd.PHAMVI_ID and B.NGUONHANG_ID = dtk.NGUONDUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NGOAITRU        where TRANGTHAI != 'HUY' and PHAMVI_ID =  @param0         group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) A on A.DUOC_ID = dtk.DUOC_ID and A.PHAMVI_ID = pvsd.PHAMVI_ID and A.NGUONHANG_ID = dtk.NGUONDUOC_ID        where dtk.BENHVIEN_ID = '01819'        group by LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')), pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        ) tk on tk.DUOC_ID = d.DUOC_ID        left join TM_DUOC_PHAMVISUDUNG kd on kd.PHAMVI_ID = tk.PHAMVI_ID and kd.BENHVIEN_ID = '01819'        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = tk.NGUONDUOC_ID and nh.BENHVIEN_ID = '01819'        where d.BENHVIEN_ID = '01819' and tk.PHAMVI_ID =  @param0         end]
2020-07-16 15:53:10,063 [1] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoVaBookingCOM23UpdateRedis_TheoPhamvi] Parameters: [@param0=[PHAMVI_ID,8]]
2020-07-16 15:53:10,063 [1] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoVaBookingCOM23UpdateRedis_TheoPhamvi] Types: [@param0=[Int64, System.Int64]]
2020-07-16 15:53:10,166 [1] DEBUG - Statement Id: [DAO00019_ThongTinBenhNhanDvYeuCau] PreparedStatement : [select distinct A.SOTIEPNHAN, A.TIEPNHAN_ID, A.DOITUONG_ID, A.TRANGTHAI,        A.LOAITHANHVIEN_ID, A.SUDUNG_BHTN, A.THE_ID, A.THANHVIEN_ID, A.VIP, A.NGUON_BENHNHAN_ID, A.BAOLANH_VIENPHI, A.NGAYMIENDONGCHITRA,        B.*,  C.DICHVU_ID, C.DVYEUCAU_ID, C.NOITHUCHIEN_ID, A.SOBHYT        from TT_TIEPNHAN A        inner join TT_DVYEUCAU C on C.TIEPNHAN_ID = A.TIEPNHAN_ID        inner join TT_BENHNHAN B on B.BENHNHAN_ID = A.BENHNHAN_ID and B.ACTIVE = '1'        where                    C.DVYEUCAU_ID = '13147'                 and A.BENHVIEN_ID = '01819']
2020-07-16 15:53:10,285 [1] DEBUG - Statement Id: [DAO00017_GetLoaiGiaByDoiTuongId] PreparedStatement : [select dtlg.DOUUTIEN, dtlg.DOITUONG_ID, lg.LOAIGIA_ID, lg.TENLOAIGIA, lg.MALOAIGIA              from TM_LOAIGIA lg              left join TM_DOITUONG_LOAIGIA dtlg              on lg.LOAIGIA_ID = dtlg.LOAIGIA_ID and dtlg.BENHVIEN_ID = '01819'              where lg.TAMNGUNG = 0 and lg.BENHVIEN_ID = '01819'                             order by dtlg.DOUUTIEN]
2020-07-16 15:53:10,317 [1] DEBUG - Statement Id: [DAO00092_GetList_ToathuocNgoaitru] PreparedStatement : [select A.*, B.PHAMVI_ID, C.KHODUOC_ID from TM_TOATHUOC_NGOAITRU A        left join TM_DUOC_PHAMVISUDUNG B on B.MAPHAMVI = A.MAPHAMVI        left join (select distinct PHAMVI_ID, KHODUOC_ID from TM_DUOC_PHAMVISD_MAPPING) C on C.PHAMVI_ID = B.PHAMVI_ID        where A.TAMNGUNG != '1' and A.BENHVIEN_ID = '01819'        ORDER BY A.SAPXEP ASC]
2020-07-16 15:53:10,345 [1] DEBUG - Statement Id: [DAO00063_GetListDTPhamviToathuoc] PreparedStatement : [select B.*, C.KHODUOC_ID        from TM_PHAMVI_DOITUONG_TOATHUOC B        left join (select distinct PHAMVI_ID, KHODUOC_ID from TM_DUOC_PHAMVISD_MAPPING) C on C.PHAMVI_ID = B.PHAMVI_ID        where B.TAMNGUNG != '1' and B.DOITUONG_ID = '1']
2020-07-16 15:53:10,372 [1] DEBUG - Statement Id: [DAO00305_GetAllLoaiToaThuoc] PreparedStatement : [declare @LOAITOATHUOC varchar(200)        set @LOAITOATHUOC = (select top 1 LOAITOATHUOC = STUFF((SELECT ',' + LOAITOATHUOC FROM TM_TOATHUOC_NGOAITRU where BENHVIEN_ID = '01819' FOR XML PATH ('')), 1, 1, '')        from TM_TOATHUOC_NGOAITRU)        set @LOAITOATHUOC = '''' +  REPLACE(@LOAITOATHUOC,',',''',''') + ''''        select @LOAITOATHUOC as LOAITOATHUOC]
2020-07-16 15:53:10,441 [1] DEBUG - Statement Id: [DAO00040_LayListToaMau] PreparedStatement : [select A.*, dc.TENDUOCDAYDU, dc.BHYT DUOC_BHYT, ld.LOAIVATTU_ID, ld.MALOAIDUOC, dd.DICTIONARY_NAME DUONGDUNG, dc.TAMNGUNG            from TT_TOATHUOCMAU A            left join TM_DUOC dc on A.DUOC_ID = dc.DUOC_ID            left join TM_LOAIDUOC ld on dc.LOAIDUOC_ID = ld.LOAIDUOC_ID            left join (select * from LST_DICTIONARY where DICTIONARY_TYPE_CODE like 'DuongDung') dd on dd.DICTIONARY_ID = dc.DUONGDUNG_ID            where (1=1)             and               A.BACSI_ID  = 1             and               A.LOAITOATHUOC IN ('BV','MN','BV','KTBV','KTBV','BV')]
2020-07-16 15:53:10,489 [1] DEBUG - Statement Id: [DAO00305_GetAllLoaiToaThuoc] PreparedStatement : [declare @LOAITOATHUOC varchar(200)        set @LOAITOATHUOC = (select top 1 LOAITOATHUOC = STUFF((SELECT ',' + LOAITOATHUOC FROM TM_TOATHUOC_NGOAITRU where BENHVIEN_ID = '01819' FOR XML PATH ('')), 1, 1, '')        from TM_TOATHUOC_NGOAITRU)        set @LOAITOATHUOC = '''' +  REPLACE(@LOAITOATHUOC,',',''',''') + ''''        select @LOAITOATHUOC as LOAITOATHUOC]
2020-07-16 15:53:10,562 [1] DEBUG - Statement Id: [DAO00040_LayListToaMau] PreparedStatement : [select A.*, dc.TENDUOCDAYDU, dc.BHYT DUOC_BHYT, ld.LOAIVATTU_ID, ld.MALOAIDUOC, dd.DICTIONARY_NAME DUONGDUNG, dc.TAMNGUNG            from TT_TOATHUOCMAU A            left join TM_DUOC dc on A.DUOC_ID = dc.DUOC_ID            left join TM_LOAIDUOC ld on dc.LOAIDUOC_ID = ld.LOAIDUOC_ID            left join (select * from LST_DICTIONARY where DICTIONARY_TYPE_CODE like 'DuongDung') dd on dd.DICTIONARY_ID = dc.DUONGDUNG_ID            where (1=1)             and               A.BACSI_ID  = 1             and               A.LOAITOATHUOC IN ('BV','MN','BV','KTBV','KTBV','BV')]
2020-07-16 15:53:10,599 [1] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoVaBookingCOM23UpdateRedis_TheoPhamvi] PreparedStatement : [declare @TOAMUANGOAI int = 0;        select @TOAMUANGOAI = isnull(VALUE,0) from TM_SYS_APPSETTINGS where CODE = 'OPD_TOAMUANGOAI_DUNGDANHMUC_DUOC'                if @TOAMUANGOAI = 1        begin        select  distinct '0' + '_' + LTRIM(d.DUOC_ID) + '_' + '0' as DUOC_KEY, 999999999 as SOLUONG        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = '01819'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = '01819')        where  @param0  = 0        union all        select distinct tk.DUOC_KEY, tk.SOLUONG        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = '01819'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = '01819')        inner join        (        select  LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')) DUOC_KEY, (SUM(dtk.SOLUONG) - isnull(sum(A.SOLUONG),0) - isnull(sum(B.SOLUONG),0)) SOLUONG, pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        from (select sum(soluong) soluong,duoc_id,nguonduoc_id,khoduoc_id,benhvien_id from TT_DUOC_TONKHO  group by duoc_id,nguonduoc_id,khoduoc_id,benhvien_id) dtk        inner join TM_DUOC_PHAMVISD_MAPPING pvsd on dtk.KHODUOC_ID = pvsd.KHODUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NOITRU        where TRANGTHAI != 'HUY' and PHAMVI_ID =  @param0         group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) B on B.DUOC_ID = dtk.DUOC_ID and B.PHAMVI_ID = pvsd.PHAMVI_ID and B.NGUONHANG_ID = dtk.NGUONDUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NGOAITRU        where TRANGTHAI != 'HUY' and PHAMVI_ID =  @param0         group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) A on A.DUOC_ID = dtk.DUOC_ID and A.PHAMVI_ID = pvsd.PHAMVI_ID and A.NGUONHANG_ID = dtk.NGUONDUOC_ID        where dtk.BENHVIEN_ID = '01819'        group by LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')), pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        ) tk on tk.DUOC_ID = d.DUOC_ID        left join TM_DUOC_PHAMVISUDUNG kd on kd.PHAMVI_ID = tk.PHAMVI_ID and kd.BENHVIEN_ID = '01819'        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = tk.NGUONDUOC_ID and nh.BENHVIEN_ID = '01819'        where d.BENHVIEN_ID = '01819' and tk.PHAMVI_ID =  @param0         end        else        begin        select distinct tk.DUOC_KEY, tk.SOLUONG        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = '01819'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = '01819')        inner join        (        select  LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')) DUOC_KEY, (SUM(dtk.SOLUONG) - isnull(sum(A.SOLUONG),0) - isnull(sum(B.SOLUONG),0)) SOLUONG, pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        from (select sum(soluong) soluong,duoc_id,nguonduoc_id,khoduoc_id,benhvien_id from TT_DUOC_TONKHO        group by duoc_id,nguonduoc_id,khoduoc_id,benhvien_id) dtk        inner join TM_DUOC_PHAMVISD_MAPPING pvsd on dtk.KHODUOC_ID = pvsd.KHODUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NOITRU        where TRANGTHAI != 'HUY' and PHAMVI_ID =  @param0         group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) B on B.DUOC_ID = dtk.DUOC_ID and B.PHAMVI_ID = pvsd.PHAMVI_ID and B.NGUONHANG_ID = dtk.NGUONDUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NGOAITRU        where TRANGTHAI != 'HUY' and PHAMVI_ID =  @param0         group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) A on A.DUOC_ID = dtk.DUOC_ID and A.PHAMVI_ID = pvsd.PHAMVI_ID and A.NGUONHANG_ID = dtk.NGUONDUOC_ID        where dtk.BENHVIEN_ID = '01819'        group by LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')), pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        ) tk on tk.DUOC_ID = d.DUOC_ID        left join TM_DUOC_PHAMVISUDUNG kd on kd.PHAMVI_ID = tk.PHAMVI_ID and kd.BENHVIEN_ID = '01819'        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = tk.NGUONDUOC_ID and nh.BENHVIEN_ID = '01819'        where d.BENHVIEN_ID = '01819' and tk.PHAMVI_ID =  @param0         end]
2020-07-16 15:53:10,599 [1] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoVaBookingCOM23UpdateRedis_TheoPhamvi] Parameters: [@param0=[PHAMVI_ID,8]]
2020-07-16 15:53:10,599 [1] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoVaBookingCOM23UpdateRedis_TheoPhamvi] Types: [@param0=[Int64, System.Int64]]
2020-07-16 15:53:10,629 [1] DEBUG - Statement Id: [DAO00013_GetTienSuBenh] PreparedStatement : [select TIENSUBENH, TIENSUDIUNG        from TT_BENHNHAN        where TT_BENHNHAN.BENHNHAN_ID  = '8731']
2020-07-16 15:53:10,652 [1] DEBUG - Statement Id: [DAO00095_GetTTDiUngThuoc] PreparedStatement : [select *              from TT_BENHNHAN_DIUNG_THUOC              where BENHNHAN_ID = '8731'              and BENHVIEN_ID = '01819']
2020-07-16 15:53:10,676 [1] DEBUG - Statement Id: [DAO00014_GetTotalChiPhiDVByTiepNhan] PreparedStatement : [select sum(THANHTIEN_DOANHTHU) as THANHTIEN_DOANHTHU from TT_VIENPHI        where ACTIVE = '1'        and TIEPNHAN_ID = '8747'        and REF_TABLE = 'TT_DVYEUCAU'        and exists (select DVYEUCAU_ID from TT_DVYEUCAU where HUYYEUCAU = '0' and TIEPNHAN_ID = '8747' and TT_VIENPHI.REF_ID = DVYEUCAU_ID)]
2020-07-16 15:53:10,703 [1] DEBUG - Statement Id: [DAO00014_GetKhamBenhInfo] PreparedStatement : [select * from TT_NGOAITRU_KHAMBENH where KHAMBENH_ID =        (select KHAMBENH_NGOAITRU_ID from TT_DVYEUCAU where DVYEUCAU_ID = '13147')]
2020-07-16 15:53:10,728 [1] DEBUG - Statement Id: [DAO00014_GetSoCaKhamTrongNgay] PreparedStatement : [select Count(KB.KHAMBENH_ID) as SOCAKHAMTRONGNGAY        from TT_NGOAITRU_KHAMBENH KB        inner join TT_TIEPNHAN TN on TN.TIEPNHAN_ID = KB.TIEPNHAN_ID        where KB.NGAYKHAM = convert(date, GETDATE())        and KB.BACSIKHAM_ID = '1'        and KB.BENHVIEN_ID = '01819'        and TN.SOBHYT IS NOT NULL and TN.SOBHYT != '']
2020-07-16 15:53:10,779 [1] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoVaBookingCOM23UpdateRedis_TheoPhamvi] PreparedStatement : [declare @TOAMUANGOAI int = 0;        select @TOAMUANGOAI = isnull(VALUE,0) from TM_SYS_APPSETTINGS where CODE = 'OPD_TOAMUANGOAI_DUNGDANHMUC_DUOC'                if @TOAMUANGOAI = 1        begin        select  distinct '0' + '_' + LTRIM(d.DUOC_ID) + '_' + '0' as DUOC_KEY, 999999999 as SOLUONG        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = '01819'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = '01819')        where  @param0  = 0        union all        select distinct tk.DUOC_KEY, tk.SOLUONG        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = '01819'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = '01819')        inner join        (        select  LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')) DUOC_KEY, (SUM(dtk.SOLUONG) - isnull(sum(A.SOLUONG),0) - isnull(sum(B.SOLUONG),0)) SOLUONG, pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        from (select sum(soluong) soluong,duoc_id,nguonduoc_id,khoduoc_id,benhvien_id from TT_DUOC_TONKHO  group by duoc_id,nguonduoc_id,khoduoc_id,benhvien_id) dtk        inner join TM_DUOC_PHAMVISD_MAPPING pvsd on dtk.KHODUOC_ID = pvsd.KHODUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NOITRU        where TRANGTHAI != 'HUY' and PHAMVI_ID =  @param0         group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) B on B.DUOC_ID = dtk.DUOC_ID and B.PHAMVI_ID = pvsd.PHAMVI_ID and B.NGUONHANG_ID = dtk.NGUONDUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NGOAITRU        where TRANGTHAI != 'HUY' and PHAMVI_ID =  @param0         group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) A on A.DUOC_ID = dtk.DUOC_ID and A.PHAMVI_ID = pvsd.PHAMVI_ID and A.NGUONHANG_ID = dtk.NGUONDUOC_ID        where dtk.BENHVIEN_ID = '01819'        group by LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')), pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        ) tk on tk.DUOC_ID = d.DUOC_ID        left join TM_DUOC_PHAMVISUDUNG kd on kd.PHAMVI_ID = tk.PHAMVI_ID and kd.BENHVIEN_ID = '01819'        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = tk.NGUONDUOC_ID and nh.BENHVIEN_ID = '01819'        where d.BENHVIEN_ID = '01819' and tk.PHAMVI_ID =  @param0         end        else        begin        select distinct tk.DUOC_KEY, tk.SOLUONG        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = '01819'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = '01819')        inner join        (        select  LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')) DUOC_KEY, (SUM(dtk.SOLUONG) - isnull(sum(A.SOLUONG),0) - isnull(sum(B.SOLUONG),0)) SOLUONG, pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        from (select sum(soluong) soluong,duoc_id,nguonduoc_id,khoduoc_id,benhvien_id from TT_DUOC_TONKHO        group by duoc_id,nguonduoc_id,khoduoc_id,benhvien_id) dtk        inner join TM_DUOC_PHAMVISD_MAPPING pvsd on dtk.KHODUOC_ID = pvsd.KHODUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NOITRU        where TRANGTHAI != 'HUY' and PHAMVI_ID =  @param0         group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) B on B.DUOC_ID = dtk.DUOC_ID and B.PHAMVI_ID = pvsd.PHAMVI_ID and B.NGUONHANG_ID = dtk.NGUONDUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NGOAITRU        where TRANGTHAI != 'HUY' and PHAMVI_ID =  @param0         group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) A on A.DUOC_ID = dtk.DUOC_ID and A.PHAMVI_ID = pvsd.PHAMVI_ID and A.NGUONHANG_ID = dtk.NGUONDUOC_ID        where dtk.BENHVIEN_ID = '01819'        group by LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')), pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        ) tk on tk.DUOC_ID = d.DUOC_ID        left join TM_DUOC_PHAMVISUDUNG kd on kd.PHAMVI_ID = tk.PHAMVI_ID and kd.BENHVIEN_ID = '01819'        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = tk.NGUONDUOC_ID and nh.BENHVIEN_ID = '01819'        where d.BENHVIEN_ID = '01819' and tk.PHAMVI_ID =  @param0         end]
2020-07-16 15:53:10,780 [1] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoVaBookingCOM23UpdateRedis_TheoPhamvi] Parameters: [@param0=[PHAMVI_ID,8]]
2020-07-16 15:53:10,780 [1] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoVaBookingCOM23UpdateRedis_TheoPhamvi] Types: [@param0=[Int64, System.Int64]]
2020-07-16 15:53:15,722 [1] DEBUG - Statement Id: [DAO00305_GetListPhongBanKhoaNgoai] PreparedStatement : [select A.*, B.DICTIONARY_CODE from TM_PHONGBAN A        inner join LST_DICTIONARY B on A.LOAIPHONGBAN_ID = B.DICTIONARY_ID        and B.DICTIONARY_TYPE_CODE = 'LoaiPhongBan'        where A.TAMNGUNG = '0'        and B.DICTIONARY_CODE = 'KhoaNgoai'        order by A.TENPHONGBAN asc]
2020-07-16 15:53:15,750 [1] DEBUG - Statement Id: [DAO00068_GetLastedSinhHieuInfo] PreparedStatement : [select top (1) *, CHISOBMI as BMI              from TT_NGOAITRU_KHAMBENH_SINHHIEU              where BENHNHAN_ID = '8731'              order by KHAMBENH_SINHHIEU_ID desc]
2020-07-16 15:53:20,525 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = '01819'               AND                   TM_SYS_SCREEN.PAGE = 'COM58'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2020-07-16 15:53:20,623 [1] DEBUG - Statement Id: [DAO00105_GetList] PreparedStatement : [select * from TM_ICD_NHOM              where TAMNGUNG = 0              and BENHVIEN_ID = '01819']
2020-07-16 15:53:27,580 [1] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoVaBookingCOM23UpdateRedis_TheoPhamvi] PreparedStatement : [declare @TOAMUANGOAI int = 0;        select @TOAMUANGOAI = isnull(VALUE,0) from TM_SYS_APPSETTINGS where CODE = 'OPD_TOAMUANGOAI_DUNGDANHMUC_DUOC'                if @TOAMUANGOAI = 1        begin        select  distinct '0' + '_' + LTRIM(d.DUOC_ID) + '_' + '0' as DUOC_KEY, 999999999 as SOLUONG        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = '01819'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = '01819')        where  @param0  = 0        union all        select distinct tk.DUOC_KEY, tk.SOLUONG        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = '01819'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = '01819')        inner join        (        select  LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')) DUOC_KEY, (SUM(dtk.SOLUONG) - isnull(sum(A.SOLUONG),0) - isnull(sum(B.SOLUONG),0)) SOLUONG, pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        from (select sum(soluong) soluong,duoc_id,nguonduoc_id,khoduoc_id,benhvien_id from TT_DUOC_TONKHO  group by duoc_id,nguonduoc_id,khoduoc_id,benhvien_id) dtk        inner join TM_DUOC_PHAMVISD_MAPPING pvsd on dtk.KHODUOC_ID = pvsd.KHODUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NOITRU        where TRANGTHAI != 'HUY' and PHAMVI_ID =  @param0         group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) B on B.DUOC_ID = dtk.DUOC_ID and B.PHAMVI_ID = pvsd.PHAMVI_ID and B.NGUONHANG_ID = dtk.NGUONDUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NGOAITRU        where TRANGTHAI != 'HUY' and PHAMVI_ID =  @param0         group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) A on A.DUOC_ID = dtk.DUOC_ID and A.PHAMVI_ID = pvsd.PHAMVI_ID and A.NGUONHANG_ID = dtk.NGUONDUOC_ID        where dtk.BENHVIEN_ID = '01819'        group by LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')), pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        ) tk on tk.DUOC_ID = d.DUOC_ID        left join TM_DUOC_PHAMVISUDUNG kd on kd.PHAMVI_ID = tk.PHAMVI_ID and kd.BENHVIEN_ID = '01819'        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = tk.NGUONDUOC_ID and nh.BENHVIEN_ID = '01819'        where d.BENHVIEN_ID = '01819' and tk.PHAMVI_ID =  @param0         end        else        begin        select distinct tk.DUOC_KEY, tk.SOLUONG        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = '01819'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = '01819')        inner join        (        select  LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')) DUOC_KEY, (SUM(dtk.SOLUONG) - isnull(sum(A.SOLUONG),0) - isnull(sum(B.SOLUONG),0)) SOLUONG, pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        from (select sum(soluong) soluong,duoc_id,nguonduoc_id,khoduoc_id,benhvien_id from TT_DUOC_TONKHO        group by duoc_id,nguonduoc_id,khoduoc_id,benhvien_id) dtk        inner join TM_DUOC_PHAMVISD_MAPPING pvsd on dtk.KHODUOC_ID = pvsd.KHODUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NOITRU        where TRANGTHAI != 'HUY' and PHAMVI_ID =  @param0         group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) B on B.DUOC_ID = dtk.DUOC_ID and B.PHAMVI_ID = pvsd.PHAMVI_ID and B.NGUONHANG_ID = dtk.NGUONDUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NGOAITRU        where TRANGTHAI != 'HUY' and PHAMVI_ID =  @param0         group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) A on A.DUOC_ID = dtk.DUOC_ID and A.PHAMVI_ID = pvsd.PHAMVI_ID and A.NGUONHANG_ID = dtk.NGUONDUOC_ID        where dtk.BENHVIEN_ID = '01819'        group by LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')), pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        ) tk on tk.DUOC_ID = d.DUOC_ID        left join TM_DUOC_PHAMVISUDUNG kd on kd.PHAMVI_ID = tk.PHAMVI_ID and kd.BENHVIEN_ID = '01819'        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = tk.NGUONDUOC_ID and nh.BENHVIEN_ID = '01819'        where d.BENHVIEN_ID = '01819' and tk.PHAMVI_ID =  @param0         end]
2020-07-16 15:53:27,580 [1] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoVaBookingCOM23UpdateRedis_TheoPhamvi] Parameters: [@param0=[PHAMVI_ID,8]]
2020-07-16 15:53:27,580 [1] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoVaBookingCOM23UpdateRedis_TheoPhamvi] Types: [@param0=[Int64, System.Int64]]
2020-07-16 15:53:44,506 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = '01819'               AND                   TM_SYS_SCREEN.PAGE = 'OPD19'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2020-07-16 15:53:44,638 [1] DEBUG - Statement Id: [DAO00000_GetDoiTuongIsBHYT] PreparedStatement : [select * from TM_DOITUONG Where DOITUONG_ID = 1 and MADOITUONG like '%BHYT%']
2020-07-16 15:53:44,713 [1] DEBUG - Statement Id: [DAO00068_GetDSSinhHieuByBenhNhanID] PreparedStatement : [select *              from TT_NGOAITRU_KHAMBENH_SINHHIEU              where BENHNHAN_ID = '8731'              and BENHVIEN_ID = '01819'                             order by THOIGIANDO desc]
2020-07-16 15:53:44,751 [1] DEBUG - Statement Id: [DAO00068_GetTTBenhAnByBenhNhanID] PreparedStatement : [select TOP (1) tn.TIEPNHAN_ID, BENHAN_ID, ba.TRANGTHAI              from TT_TIEPNHAN tn              left join TT_NOITRU_BENHAN ba              on tn.TIEPNHAN_ID = ba.TIEPNHAN_ID              where tn.BENHNHAN_ID = '8731'              order by tn.NGAYTAO desc]
2020-07-16 15:53:44,829 [1] DEBUG - Statement Id: [DAO00014_GetTrangThaiTiepNhan] PreparedStatement : [select tn.TIEPNHAN_ID, tn.KHOADULIEU, xncp.XACNHANCHIPHI_ID from TT_TIEPNHAN tn        left join TT_XACNHANCHIPHI xncp        on tn.TIEPNHAN_ID = xncp.TIEPNHAN_ID        where tn.TIEPNHAN_ID = '8747'        and tn.BENHVIEN_ID = '01819']
2020-07-16 15:58:23,178 [1] DEBUG - Statement Id: [DAO00014_GetPatientStatus] PreparedStatement : [select        CASE        when tn.TRANGTHAI = 'HOANTHANH' Then tn.TRANGTHAI        WHEN xncp.XACNHANCHIPHI_ID is not null THEN 'XACNHANCHIPHI'        WHEN (tn.KHOADULIEU = '1') THEN 'KHOADULIEU'        ELSE tn.TRANGTHAI        END        as TRANGTHAI        from TT_TIEPNHAN tn        left join TT_XACNHANCHIPHI xncp on tn.TIEPNHAN_ID = xncp.TIEPNHAN_ID        where tn.TIEPNHAN_ID = '8747'        and tn.BENHVIEN_ID = '01819']
2020-07-16 15:58:23,251 [1] DEBUG - Statement Id: [DAO00014_GetTTDVYeucauOPD] PreparedStatement : [select A.KHAMBENH_NGOAITRU_ID, B.KHAMBENH_ID        from TT_DVYEUCAU A        left join TT_NGOAITRU_KHAMBENH B on A.KHAMBENH_NGOAITRU_ID = B.KHAMBENH_ID        where A.DVYEUCAU_ID = '13147' and A.TIEPNHAN_ID =  @param0]
2020-07-16 15:58:23,251 [1] DEBUG - Statement Id: [DAO00014_GetTTDVYeucauOPD] Parameters: [@param0=[TIEPNHAN_ID,8747]]
2020-07-16 15:58:23,251 [1] DEBUG - Statement Id: [DAO00014_GetTTDVYeucauOPD] Types: [@param0=[Int64, System.Int64]]
2020-07-16 15:58:23,328 [1] DEBUG - Statement Id: [DAO00014_GetThongtinKhamsuckhoeTheoDVyc] PreparedStatement : [select HOPDONG_ID, HOPDONG_BENHNHAN_ID from TT_DVYEUCAU where DVYEUCAU_ID =  @param0]
2020-07-16 15:58:23,329 [1] DEBUG - Statement Id: [DAO00014_GetThongtinKhamsuckhoeTheoDVyc] Parameters: [@param0=[DVYEUCAU_ID,13147]]
2020-07-16 15:58:23,329 [1] DEBUG - Statement Id: [DAO00014_GetThongtinKhamsuckhoeTheoDVyc] Types: [@param0=[Int64, System.Int64]]
2020-07-16 15:58:23,357 [1] DEBUG - Statement Id: [DAO00009_TT_TIEPNHAN_GetProcess] PreparedStatement : [select PROCESS_ID from TT_TIEPNHAN where SOTIEPNHAN = 'TN200716.0000004']
2020-07-16 15:58:23,387 [1] DEBUG - Statement Id: [DAOWF004_laytrangthaiDV] PreparedStatement : [select top 1 A.CURR_STATE_CODE as STATE_CODE, isNull(C.SHORT_NAME,C.NAME) as TRANGTHAI, C.NAME as TRANGTHAI_CHITIET, C.STATUS_CODE, D.ISACTIVE as ACTIVE, E.STATUS_CODE  as OLD_STATUSCODE        from TT_REQUEST_SERVICE_DETAIL A                left join (select * from TT_REQUEST_SERVICE where PARA = '{"DICHVU_ID":"3","DVYEUCAU_ID":"13147"}') D on D.ID = A.REQUEST_SERVICE_ID        left join TM_STATE C on A.CURR_STATE_CODE = C.STATE_CODE and C.PROCESS_CODE = D.PROCESS_CODE        left join TM_STATE E on A.OLD_STATE_CODE = E.STATE_CODE and E.PROCESS_CODE = D.PROCESS_CODE        where        A.REQUEST_SERVICE_ID = (select top 1 ID from TT_REQUEST_SERVICE where PARA = '{"DICHVU_ID":"3","DVYEUCAU_ID":"13147"}' order by ID desc)        order by A.ID desc]
2020-07-16 15:58:23,454 [1] DEBUG - Statement Id: [DAO00014_CheckExistNhapVien] PreparedStatement : [select NHAPVIEN_ID        from TT_NOITRU_NHAPVIEN        where TIEPNHAN_ID  = '8747'        and TRANGTHAI != 'CHOXACNHAN']
2020-07-16 15:58:23,483 [1] DEBUG - Statement Id: [DAO00014_CheckExistCapCuu] PreparedStatement : [select THONGTINCAPCUU_ID        from TT_TIEPNHAN_THONGTINCAPCUU        where TIEPNHAN_ID  = '8747' and BENHVIEN_ID = '01819']
2020-07-16 15:58:23,521 [1] DEBUG - Statement Id: [DAO00014_CheckExistChuyenVien] PreparedStatement : [select CHUYENVIEN_ID        from TT_CHUYENVIEN        where TIEPNHAN_ID  = '8747']
2020-07-16 15:58:23,556 [1] DEBUG - Statement Id: [DAO00014_GetTrangThaiTiepNhan] PreparedStatement : [select tn.TIEPNHAN_ID, tn.KHOADULIEU, xncp.XACNHANCHIPHI_ID from TT_TIEPNHAN tn        left join TT_XACNHANCHIPHI xncp        on tn.TIEPNHAN_ID = xncp.TIEPNHAN_ID        where tn.TIEPNHAN_ID = '8747'        and tn.BENHVIEN_ID = '01819']
2020-07-16 15:58:28,319 [1] DEBUG - Statement Id: [DAO00014_GetPatientStatus] PreparedStatement : [select        CASE        when tn.TRANGTHAI = 'HOANTHANH' Then tn.TRANGTHAI        WHEN xncp.XACNHANCHIPHI_ID is not null THEN 'XACNHANCHIPHI'        WHEN (tn.KHOADULIEU = '1') THEN 'KHOADULIEU'        ELSE tn.TRANGTHAI        END        as TRANGTHAI        from TT_TIEPNHAN tn        left join TT_XACNHANCHIPHI xncp on tn.TIEPNHAN_ID = xncp.TIEPNHAN_ID        where tn.TIEPNHAN_ID = '8747'        and tn.BENHVIEN_ID = '01819']
2020-07-16 15:58:28,388 [1] DEBUG - Statement Id: [DAO00014_GetTTDVYeucauOPD] PreparedStatement : [select A.KHAMBENH_NGOAITRU_ID, B.KHAMBENH_ID        from TT_DVYEUCAU A        left join TT_NGOAITRU_KHAMBENH B on A.KHAMBENH_NGOAITRU_ID = B.KHAMBENH_ID        where A.DVYEUCAU_ID = '13147' and A.TIEPNHAN_ID =  @param0]
2020-07-16 15:58:28,388 [1] DEBUG - Statement Id: [DAO00014_GetTTDVYeucauOPD] Parameters: [@param0=[TIEPNHAN_ID,8747]]
2020-07-16 15:58:28,388 [1] DEBUG - Statement Id: [DAO00014_GetTTDVYeucauOPD] Types: [@param0=[Int64, System.Int64]]
2020-07-16 15:58:28,457 [1] DEBUG - Statement Id: [DAO00014_GetThongtinKhamsuckhoeTheoDVyc] PreparedStatement : [select HOPDONG_ID, HOPDONG_BENHNHAN_ID from TT_DVYEUCAU where DVYEUCAU_ID =  @param0]
2020-07-16 15:58:28,457 [1] DEBUG - Statement Id: [DAO00014_GetThongtinKhamsuckhoeTheoDVyc] Parameters: [@param0=[DVYEUCAU_ID,13147]]
2020-07-16 15:58:28,457 [1] DEBUG - Statement Id: [DAO00014_GetThongtinKhamsuckhoeTheoDVyc] Types: [@param0=[Int64, System.Int64]]
2020-07-16 15:58:28,486 [1] DEBUG - Statement Id: [DAO00009_TT_TIEPNHAN_GetProcess] PreparedStatement : [select PROCESS_ID from TT_TIEPNHAN where SOTIEPNHAN = 'TN200716.0000004']
2020-07-16 15:58:28,512 [1] DEBUG - Statement Id: [DAOWF004_laytrangthaiDV] PreparedStatement : [select top 1 A.CURR_STATE_CODE as STATE_CODE, isNull(C.SHORT_NAME,C.NAME) as TRANGTHAI, C.NAME as TRANGTHAI_CHITIET, C.STATUS_CODE, D.ISACTIVE as ACTIVE, E.STATUS_CODE  as OLD_STATUSCODE        from TT_REQUEST_SERVICE_DETAIL A                left join (select * from TT_REQUEST_SERVICE where PARA = '{"DICHVU_ID":"3","DVYEUCAU_ID":"13147"}') D on D.ID = A.REQUEST_SERVICE_ID        left join TM_STATE C on A.CURR_STATE_CODE = C.STATE_CODE and C.PROCESS_CODE = D.PROCESS_CODE        left join TM_STATE E on A.OLD_STATE_CODE = E.STATE_CODE and E.PROCESS_CODE = D.PROCESS_CODE        where        A.REQUEST_SERVICE_ID = (select top 1 ID from TT_REQUEST_SERVICE where PARA = '{"DICHVU_ID":"3","DVYEUCAU_ID":"13147"}' order by ID desc)        order by A.ID desc]
2020-07-16 15:58:28,536 [1] DEBUG - Statement Id: [DAO00014_CheckExistNhapVien] PreparedStatement : [select NHAPVIEN_ID        from TT_NOITRU_NHAPVIEN        where TIEPNHAN_ID  = '8747'        and TRANGTHAI != 'CHOXACNHAN']
2020-07-16 15:58:28,560 [1] DEBUG - Statement Id: [DAO00014_CheckExistCapCuu] PreparedStatement : [select THONGTINCAPCUU_ID        from TT_TIEPNHAN_THONGTINCAPCUU        where TIEPNHAN_ID  = '8747' and BENHVIEN_ID = '01819']
2020-07-16 15:58:28,586 [1] DEBUG - Statement Id: [DAO00014_CheckExistChuyenVien] PreparedStatement : [select CHUYENVIEN_ID        from TT_CHUYENVIEN        where TIEPNHAN_ID  = '8747']
2020-07-16 15:58:28,610 [1] DEBUG - Statement Id: [DAO00014_GetTrangThaiTiepNhan] PreparedStatement : [select tn.TIEPNHAN_ID, tn.KHOADULIEU, xncp.XACNHANCHIPHI_ID from TT_TIEPNHAN tn        left join TT_XACNHANCHIPHI xncp        on tn.TIEPNHAN_ID = xncp.TIEPNHAN_ID        where tn.TIEPNHAN_ID = '8747'        and tn.BENHVIEN_ID = '01819']
2020-07-16 15:58:28,708 [1] DEBUG - Statement Id: [DAOLOG01_LockBegin] PreparedStatement : [INSERT into TT_LOG_UPDATE ( REF_TABLE , REF_ID , BENHVIEN_ID )         values ( @param0 ,  @param1 ,  @param2 );]
2020-07-16 15:58:28,708 [1] DEBUG - Statement Id: [DAOLOG01_LockBegin] Parameters: [@param0=[REF_TABLE,TT_NGOAITRU_KHAMBENH], @param1=[REF_ID,8747], @param2=[BENHVIEN_ID,01819]]
2020-07-16 15:58:28,708 [1] DEBUG - Statement Id: [DAOLOG01_LockBegin] Types: [@param0=[String, System.String], @param1=[Int64, System.Int64], @param2=[String, System.String]]
2020-07-16 15:58:28,754 [1] DEBUG - Statement Id: [DAO00014_GetTTNhapVien] PreparedStatement : [select *        from TT_NOITRU_NHAPVIEN        where TIEPNHAN_ID  = '8747']
2020-07-16 15:58:28,801 [1] DEBUG - Statement Id: [DAO00014_GetTTDVYeucauOPD] PreparedStatement : [select A.KHAMBENH_NGOAITRU_ID, B.KHAMBENH_ID        from TT_DVYEUCAU A        left join TT_NGOAITRU_KHAMBENH B on A.KHAMBENH_NGOAITRU_ID = B.KHAMBENH_ID        where A.DVYEUCAU_ID = '13147' and A.TIEPNHAN_ID =  @param0]
2020-07-16 15:58:28,801 [1] DEBUG - Statement Id: [DAO00014_GetTTDVYeucauOPD] Parameters: [@param0=[TIEPNHAN_ID,8747]]
2020-07-16 15:58:28,801 [1] DEBUG - Statement Id: [DAO00014_GetTTDVYeucauOPD] Types: [@param0=[String, System.String]]
2020-07-16 15:58:28,833 [1] DEBUG - Statement Id: [DAO00014_Add] PreparedStatement : [insert into TT_NGOAITRU_KHAMBENH (        BENHNHAN_ID        , TIEPNHAN_ID        , BENHAN_ID        , DICHVU_ID        , PHONGBAN_ID        , NGAYKHAM        , THOIGIANKHAM        , BACSIKHAM_ID        , DIEUDUONG_ID        , DOITUONG_ID        , CHANDOANICD_ID        , CHANDOANPHUICD_ID        , CHANDOANICD        , BENHMANTINH_ID        , HUONGGIAIQUYET_ID        , YEUCAUCHITIET_ID        , CHANDOANKHOAKHAM        , TLDG_MT        , TLDG_MP        , TKLT_MP        , TKLT_MT        , TLDG_MT_TEXT        , TLDG_MP_TEXT        , TKLT_MP_TEXT        , TKLT_MT_TEXT        , NHANAP_MT        , NHANAP_MP        , MACH        , CANNANG        , CHIEUCAO        , HUYETAPTHAP        , HUYETAPCAO        , NHIPTHO        , NHIETDO        , BMI        , TYLEMO        , VONGBUNG        , SIEUHIENVI        , SOIDAYMAT        , TRIEUCHUNGLAMSANG        , CHANDOANSOBOICD_ID        , CHANDOANSOBO        , CHUYENDENBENHVIEN_ID        , LYDONHAPVIEN_ID        , THOIGIANNHAPVIENDUKIEN        , KHAMBENHLANDAU_ID        , KHAMBENH_CHUYENKHOA_ID        , NHAPKHOA_ID        , CHUYENKHOA_ID        , NGHIOM_TUNGAY        , NGHIOM_DENNGAY        , HUONGDIEUTRI_ID        , CHEDOANUONG_ID        , CHEDOCHAMSOC_ID        , DIEUTRIDUPHONG        , SONGAYDIEUTRI        , GIAIDOANBENH        , TOATHUOCMUANGOAI        , TACDUNGPHU        , TUANTHUCUABN        , SONGAYHENTAIKHAM        , SOBENHANNGOAITRU_ID        , KHAMCAPCUU        , GHICHU        , KHOADULIEU        , NGUOIKHOA_ID        , NGAYKHOA        , THOIGIANKHOA        , BENHVIEN_ID        , NGAYTAO        , NGUOITAO_ID        , NGAYCAPNHAT        , NGUOICAPNHAT_ID        , KHAMBENH_SINHHIEU_ID        ) values (         @param0         ,  @param1         ,  @param2         ,  @param3         ,  @param4         ,  @param5         ,  @param6         ,  @param7         ,  @param8         ,  @param9         ,  @param10         ,  @param11         ,  @param12         ,  @param13         ,  @param14         ,  @param15         ,  @param16         ,  @param17         ,  @param18         ,  @param19         ,  @param20         ,  @param21         ,  @param22         ,  @param23         ,  @param24         ,  @param25         ,  @param26         ,  @param27         ,  @param28         ,  @param29         ,  @param30         ,  @param31         ,  @param32         ,  @param33         ,  @param34         ,  @param35         ,  @param36         ,  @param37         ,  @param38         ,  @param39         ,  @param40         ,  @param41         ,  @param42         ,  @param43         ,  @param44         ,  @param45         ,  @param46         ,  @param47         ,  @param48         ,  @param49         ,  @param50         ,  @param51         ,  @param52         ,  @param53         ,  @param54         ,  @param55         ,  @param56         ,  @param57         ,  @param58         ,  @param59         ,  @param60         ,  @param61         ,  @param62         ,  @param63         ,  @param64         ,  @param65         ,  @param66         ,  @param67         ,  @param68         ,  @param69         ,  @param70         ,  @param71         ,  @param72         ,  @param73         )        SELECT SCOPE_IDENTITY()]
2020-07-16 15:58:28,833 [1] DEBUG - Statement Id: [DAO00014_Add] Parameters: [@param0=[BENHNHAN_ID,8731], @param1=[TIEPNHAN_ID,8747], @param2=[BENHAN_ID,null], @param3=[DICHVU_ID,3], @param4=[PHONGBAN_ID,74], @param5=[NGAYKHAM,7/16/2020 12:00:00 AM], @param6=[THOIGIANKHAM,7/16/2020 3:53:10 PM], @param7=[BACSIKHAM_ID,1], @param8=[DIEUDUONG_ID,null], @param9=[DOITUONG_ID,1], @param10=[CHANDOANICD_ID,7928], @param11=[CHANDOANPHUICD_ID,null], @param12=[CHANDOANICD,null], @param13=[BENHMANTINH_ID,null], @param14=[HUONGGIAIQUYET_ID,8343], @param15=[YEUCAUCHITIET_ID,null], @param16=[CHANDOANKHOAKHAM,Tổn thương nông của da đầu(S00.0)], @param17=[TLDG_MT,null], @param18=[TLDG_MP,null], @param19=[TKLT_MP,null], @param20=[TKLT_MT,null], @param21=[TLDG_MT_TEXT,], @param22=[TLDG_MP_TEXT,], @param23=[TKLT_MP_TEXT,], @param24=[TKLT_MT_TEXT,], @param25=[NHANAP_MT,null], @param26=[NHANAP_MP,null], @param27=[MACH,null], @param28=[CANNANG,null], @param29=[CHIEUCAO,null], @param30=[HUYETAPTHAP,null], @param31=[HUYETAPCAO,null], @param32=[NHIPTHO,null], @param33=[NHIETDO,null], @param34=[BMI,null], @param35=[TYLEMO,null], @param36=[VONGBUNG,null], @param37=[SIEUHIENVI,], @param38=[SOIDAYMAT,], @param39=[TRIEUCHUNGLAMSANG,o], @param40=[CHANDOANSOBOICD_ID,null], @param41=[CHANDOANSOBO,], @param42=[CHUYENDENBENHVIEN_ID,null], @param43=[LYDONHAPVIEN_ID,null], @param44=[THOIGIANNHAPVIENDUKIEN,null], @param45=[KHAMBENHLANDAU_ID,null], @param46=[KHAMBENH_CHUYENKHOA_ID,null], @param47=[NHAPKHOA_ID,null], @param48=[CHUYENKHOA_ID,null], @param49=[NGHIOM_TUNGAY,null], @param50=[NGHIOM_DENNGAY,null], @param51=[HUONGDIEUTRI_ID,null], @param52=[CHEDOANUONG_ID,null], @param53=[CHEDOCHAMSOC_ID,null], @param54=[DIEUTRIDUPHONG,null], @param55=[SONGAYDIEUTRI,null], @param56=[GIAIDOANBENH,null], @param57=[TOATHUOCMUANGOAI,null], @param58=[TACDUNGPHU,null], @param59=[TUANTHUCUABN,null], @param60=[SONGAYHENTAIKHAM,null], @param61=[SOBENHANNGOAITRU_ID,null], @param62=[KHAMCAPCUU,null], @param63=[GHICHU,], @param64=[KHOADULIEU,0], @param65=[NGUOIKHOA_ID,null], @param66=[NGAYKHOA,null], @param67=[THOIGIANKHOA,null], @param68=[BENHVIEN_ID,01819], @param69=[NGAYTAO,7/16/2020 3:58:28 PM], @param70=[NGUOITAO_ID,1], @param71=[NGAYCAPNHAT,7/16/2020 3:58:28 PM], @param72=[NGUOICAPNHAT_ID,1], @param73=[KHAMBENH_SINHHIEU_ID,0]]
2020-07-16 15:58:28,833 [1] DEBUG - Statement Id: [DAO00014_Add] Types: [@param0=[Int64, System.Int64], @param1=[String, System.String], @param2=[System.DBNull, null], @param3=[Int64, System.Int64], @param4=[String, System.String], @param5=[DateTime, System.DateTime], @param6=[DateTime, System.DateTime], @param7=[Int64, System.Int64], @param8=[System.DBNull, null], @param9=[Int64, System.Int64], @param10=[String, System.String], @param11=[System.DBNull, null], @param12=[System.DBNull, null], @param13=[System.DBNull, null], @param14=[String, System.String], @param15=[System.DBNull, null], @param16=[String, System.String], @param17=[System.DBNull, null], @param18=[System.DBNull, null], @param19=[System.DBNull, null], @param20=[System.DBNull, null], @param21=[String, System.String], @param22=[String, System.String], @param23=[String, System.String], @param24=[String, System.String], @param25=[System.DBNull, null], @param26=[System.DBNull, null], @param27=[System.DBNull, null], @param28=[System.DBNull, null], @param29=[System.DBNull, null], @param30=[System.DBNull, null], @param31=[System.DBNull, null], @param32=[System.DBNull, null], @param33=[System.DBNull, null], @param34=[System.DBNull, null], @param35=[System.DBNull, null], @param36=[System.DBNull, null], @param37=[String, System.String], @param38=[String, System.String], @param39=[String, System.String], @param40=[System.DBNull, null], @param41=[String, System.String], @param42=[System.DBNull, null], @param43=[System.DBNull, null], @param44=[System.DBNull, null], @param45=[System.DBNull, null], @param46=[System.DBNull, null], @param47=[System.DBNull, null], @param48=[System.DBNull, null], @param49=[System.DBNull, null], @param50=[System.DBNull, null], @param51=[System.DBNull, null], @param52=[System.DBNull, null], @param53=[System.DBNull, null], @param54=[System.DBNull, null], @param55=[System.DBNull, null], @param56=[System.DBNull, null], @param57=[System.DBNull, null], @param58=[System.DBNull, null], @param59=[System.DBNull, null], @param60=[System.DBNull, null], @param61=[System.DBNull, null], @param62=[System.DBNull, null], @param63=[String, System.String], @param64=[String, System.String], @param65=[System.DBNull, null], @param66=[System.DBNull, null], @param67=[System.DBNull, null], @param68=[String, System.String], @param69=[DateTime, System.DateTime], @param70=[String, System.String], @param71=[DateTime, System.DateTime], @param72=[String, System.String], @param73=[Int64, System.Int64]]
2020-07-16 15:58:28,883 [1] DEBUG - Statement Id: [DAO00014_CheckExistHenTaiKHam] PreparedStatement : [select KHAMBENH_HENTAIKHAM        from TT_NGOAITRU_KHAMBENH_HENTK        where KHAMBENH_ID  = '8012']
2020-07-16 15:58:28,919 [1] DEBUG - Statement Id: [DAO00020_UpdateKhamBenhIDInDVYC] PreparedStatement : [update TT_DVYEUCAU        set KHAMBENH_NGOAITRU_ID =  @param0                 , TRANGTHAI =  @param1         , NGUOICAPNHAT_ID =  @param2         , NGAYCAPNHAT =  @param3         where TIEPNHAN_ID = 8747        and DVYEUCAU_ID = 13147                update TT_VIENPHI        set DATHUCHIEN =  @param4         , NGUOICAPNHAT_ID =  @param2         , NGAYCAPNHAT =  @param3         where REF_ID = 13147        and REF_TABLE = 'TT_DVYEUCAU']
2020-07-16 15:58:28,919 [1] DEBUG - Statement Id: [DAO00020_UpdateKhamBenhIDInDVYC] Parameters: [@param0=[KHAMBENH_ID,8012], @param1=[TRANGTHAI,DANGTHUCHIEN], @param2=[NGUOICAPNHAT_ID,1], @param3=[NGAYCAPNHAT,7/16/2020 3:58:28 PM], @param4=[DATHUCHIEN,1]]
2020-07-16 15:58:28,919 [1] DEBUG - Statement Id: [DAO00020_UpdateKhamBenhIDInDVYC] Types: [@param0=[Int64, System.Int64], @param1=[String, System.String], @param2=[Int64, System.Int64], @param3=[DateTime, System.DateTime], @param4=[Int32, System.Int32]]
2020-07-16 15:58:28,958 [1] DEBUG - Statement Id: [DAO00023_GetSOBHYT_HUONG_ID] PreparedStatement : [select isnull(MAX(SOBHYT_HUONG_ID),0) SOBHYT_HUONG_ID        from TT_TIEPNHAN_SOTHEBHYT        where TIEPNHAN_ID = '8747']
2020-07-16 15:58:28,982 [1] DEBUG - Statement Id: [DAO00062_GetAllPhamviKhoDuoc] PreparedStatement : [select distinct dmap.*        from TM_DUOC_PHAMVISD_MAPPING dmap        left join TM_DUOC_PHAMVISUDUNG dpv on dpv.PHAMVI_ID = dmap.PHAMVI_ID]
2020-07-16 15:58:29,010 [1] DEBUG - Statement Id: [DAO00062_GetKhoDuocNhaThuoc] PreparedStatement : [select * from TM_KHODUOC where MAKHO = 'KHO_NT']
2020-07-16 15:58:29,037 [1] DEBUG - Statement Id: [DAO00049_KiemtraloaiDV] PreparedStatement : [select DICHVU_ID AS HA, '' AS XN, '' as TDCN, '' as TT, '' as KB from TM_DICHVU            left join TM_NHOMDICHVU ndv on ndv.NHOMDICHVU_ID = TM_DICHVU.NHOMDICHVU_ID            where DICHVU_ID = '3' and left(ndv.MANHOMDICHVU, 2) = '02'            union            select  '' as HA, DICHVU_ID AS XN, '' as TDCN, '' as TT, '' as KB from TM_DICHVU            left join TM_NHOMDICHVU ndv on ndv.NHOMDICHVU_ID = TM_DICHVU.NHOMDICHVU_ID            where DICHVU_ID = '3' and left(ndv.MANHOMDICHVU, 2) = '01'            union            select  '' as HA, '' AS XN, DICHVU_ID as TDCN, '' as TT, '' as KB from TM_DICHVU            left join TM_NHOMDICHVU ndv on ndv.NHOMDICHVU_ID = TM_DICHVU.NHOMDICHVU_ID            where DICHVU_ID = '3' and left(ndv.MANHOMDICHVU, 2) = '03'            union            select  '' as HA, '' AS XN, '' as TDCN, DICHVU_ID as TT, '' as KB from TM_DICHVU            left join TM_NHOMDICHVU ndv on ndv.NHOMDICHVU_ID = TM_DICHVU.NHOMDICHVU_ID            where DICHVU_ID = '3' and left(ndv.MANHOMDICHVU, 2) = '05'            union            select  '' as HA, '' AS XN, '' as TDCN, DICHVU_ID as TT, '' as KB from TM_DICHVU            left join TM_NHOMDICHVU ndv on ndv.NHOMDICHVU_ID = TM_DICHVU.NHOMDICHVU_ID            where DICHVU_ID = '3' and left(ndv.MANHOMDICHVU, 2) = '06'            union            select  '' as HA, '' AS XN, '' as TDCN, '' as TT, DICHVU_ID as KB from TM_DICHVU            left join TM_NHOMDICHVU ndv on ndv.NHOMDICHVU_ID = TM_DICHVU.NHOMDICHVU_ID            where DICHVU_ID = '3' and left(ndv.MANHOMDICHVU, 2) = '04']
2020-07-16 15:58:29,062 [1] DEBUG - Statement Id: [DAO00009_GetThutiensauDVThuthuat] PreparedStatement : [select A.THUTIENSAU, B.SOTIEPNHAN, A.DICHVU_ID, A.DVYEUCAU_ID        from TT_DVYEUCAU A        inner join TT_TIEPNHAN B on B.TIEPNHAN_ID = A.TIEPNHAN_ID        where        A.DVYEUCAU_ID = '13147']
2020-07-16 15:58:29,091 [1] DEBUG - Statement Id: [DAO00009_TT_TIEPNHAN_GetProcess] PreparedStatement : [select PROCESS_ID from TT_TIEPNHAN where SOTIEPNHAN = 'TN200716.0000004']
2020-07-16 15:58:29,118 [1] DEBUG - Statement Id: [DAOWF001_Kiemtrathongtindayeucaudacochua] PreparedStatement : [select * from TT_REQUEST        where        PARA = '{"HOSPITAL_ID":"01819","SOTIEPNHAN":"TN200716.0000004"}'        AND ISACTIVE = '1']
2020-07-16 15:58:29,143 [1] DEBUG - Statement Id: [DAOWF001_Kiemtrathongtindichvudayeucau] PreparedStatement : [select top 1 * from TT_REQUEST_SERVICE        where        PARA = '{"DICHVU_ID":"3","DVYEUCAU_ID":"13147"}'                AND ISACTIVE = '1' order by ID desc]
2020-07-16 15:58:29,166 [1] DEBUG - Statement Id: [DAOWF001_KiemtrathongtinchitietDichvuYeucau] PreparedStatement : [select * from TT_REQUEST_SERVICE_DETAIL        where        REQUEST_SERVICE_ID = '11165']
2020-07-16 15:58:29,190 [1] DEBUG - Statement Id: [DAOWF001_Laythongtinwithstatecode] PreparedStatement : [select A.*, B.STATUS_CODE from        TM_STATE_ACTION A        left join TM_STATE B on B.STATE_CODE = A.NEXT_STATE_CODE and A.PROCESS_CODE = B.PROCESS_CODE        where        A.CURR_STATE_CODE = '3     '        AND A.PROCESS_CODE = 'P01'        Order By ORDER_ID ASC]
2020-07-16 15:58:29,223 [1] DEBUG - Statement Id: [DAOWF003_Update] PreparedStatement : [update TT_REQUEST_SERVICE set        CURR_STATE_CODE =  @param0                   , ISACTIVE =  @param1                     , ISCOMPLETE =  @param2                        where        ID = '11165']
2020-07-16 15:58:29,223 [1] DEBUG - Statement Id: [DAOWF003_Update] Parameters: [@param0=[CURR_STATE_CODE,4], @param1=[ISACTIVE,1], @param2=[ISCOMPLETE,0]]
2020-07-16 15:58:29,223 [1] DEBUG - Statement Id: [DAOWF003_Update] Types: [@param0=[String, System.String], @param1=[String, System.String], @param2=[String, System.String]]
2020-07-16 15:58:29,247 [1] DEBUG - Statement Id: [DAOWF005_Add] PreparedStatement : [insert into TT_REQUEST_SERVICE_DETAIL (        REQUEST_ID        ,REQUEST_SERVICE_ID        , OLD_STATE_CODE        , CURR_STATE_CODE        ) values (         @param0         , @param1         ,  @param2         ,  @param3         )        SELECT SCOPE_IDENTITY()]
2020-07-16 15:58:29,247 [1] DEBUG - Statement Id: [DAOWF005_Add] Parameters: [@param0=[REQUEST_ID,8751], @param1=[REQUEST_SERVICE_ID,11165], @param2=[OLD_STATE_CODE,3     ], @param3=[CURR_STATE_CODE,4]]
2020-07-16 15:58:29,247 [1] DEBUG - Statement Id: [DAOWF005_Add] Types: [@param0=[String, System.String], @param1=[Int32, System.Int32], @param2=[String, System.String], @param3=[String, System.String]]
2020-07-16 15:58:29,271 [1] DEBUG - Statement Id: [DAOWF005_Add_History] PreparedStatement : [insert into TT_REQUEST_SERVICE_HISTORY (        REQUEST_ID        ,REQUEST_SERVICE_ID        , OLD_STATE_CODE        , CURR_STATE_CODE        ) values (         @param0         , @param1         ,  @param2         ,  @param3         )]
2020-07-16 15:58:29,271 [1] DEBUG - Statement Id: [DAOWF005_Add_History] Parameters: [@param0=[REQUEST_ID,8751], @param1=[REQUEST_SERVICE_ID,11165], @param2=[OLD_STATE_CODE,3     ], @param3=[CURR_STATE_CODE,4]]
2020-07-16 15:58:29,271 [1] DEBUG - Statement Id: [DAOWF005_Add_History] Types: [@param0=[String, System.String], @param1=[Int32, System.Int32], @param2=[String, System.String], @param3=[String, System.String]]
2020-07-16 15:58:29,294 [1] DEBUG - Statement Id: [DAO00009_TT_DVYEUCAU_Update] PreparedStatement : [Update TT_DVYEUCAU set TRANGTHAI_WFL = 'DANGTHUCHIEN' where DVYEUCAU_ID = '13147']
2020-07-16 15:58:29,320 [1] DEBUG - Statement Id: [DAO00026_GetListDanhSachDichVuGhiNhanVTYT_COM25_WithTN] PreparedStatement : [select distinct CONVERT(VARCHAR(11),C.NGAYYEUCAU,103) as NGAYYEUCAU, C.DICHVU_ID, C.DVYEUCAU_ID, D.TENDICHVU, C.NOITHUCHIEN_ID, A.SOTIEPNHAN, A.TRAITUYEN, A.NGAYMIENDONGCHITRA, A.TIEPNHAN_ID, A.DOITUONG_ID, A.TRANGTHAI,            A.LOAITHANHVIEN_ID, A.SUDUNG_BHTN, A.THE_ID, A.THANHVIEN_ID, A.VIP, A.NGUON_BENHNHAN_ID, A.BAOLANH_VIENPHI,            CASE WHEN (A.TRANGTHAI = 'NOITRU' OR A.TRANGTHAI = 'CAPCUU') THEN 'IN' ELSE 'OUT' END AS LOAIBENHAN,            CASE WHEN (C.TRANGTHAI = 'CHUAKETQUA') THEN 'CHUAKETQUA' ELSE 'HOANTAT' END AS TRANGTHAIDICHVU,            B.*, isnull(ntba.SOBENHAN, '') SOBENHAN, isnull(ntba.BENHAN_ID, 0) BENHAN_ID,            CASE WHEN Left(E.MANHOMDICHVU,2) = '03' THEN '02' ELSE Left(E.MANHOMDICHVU,2) END AS MANHOMDICHVU            from TT_TIEPNHAN A            inner join TT_BENHNHAN B on B.BENHNHAN_ID = A.BENHNHAN_ID and B.ACTIVE = '1'            inner join TT_DVYEUCAU C on C.TIEPNHAN_ID = A.TIEPNHAN_ID                        left join TM_DICHVU D on D.DICHVU_ID = C.DICHVU_ID            left join TM_NHOMDICHVU E on E.NHOMDICHVU_ID = D.NHOMDICHVU_ID            left join TT_NOITRU_BENHAN ntba on ntba.BENHAN_ID = C.BENHAN_ID              where            C.NGAYHENCLS is NULL and A.BENHVIEN_ID = '01819'            and (A.TRANGTHAI = 'DATIEPNHAN' or A.TRANGTHAI = 'NOITRU' or A.TRANGTHAI = 'CAPCUU' or A.TRANGTHAI = 'NGOAITRU')            and (CASE WHEN Left(E.MANHOMDICHVU,2) = '03' THEN '02' ELSE Left(E.MANHOMDICHVU,2) END in ('02', '04'))            and A.TIEPNHAN_ID = '8747']
2020-07-16 15:58:29,771 [1] DEBUG - Statement Id: [DAOLOG01_LockEnd] PreparedStatement : [DELETE TT_LOG_UPDATE        where REF_TABLE = 'TT_NGOAITRU_KHAMBENH' and REF_ID = '8747' and BENHVIEN_ID = '01819']
2020-07-16 15:58:29,798 [1] DEBUG - Statement Id: [DAO00067_UpdateThuocNgoaiVienPhi_Noref] PreparedStatement : [update TT_VIENPHI set SOLUONG = 0, THANHTIEN_DOANHTHU = 0, BHYT_THANHTIEN = 0, BHYT_THANHTIEN_CHITRA = 0        , GIATRI_BENHNHAN_DATHANHTOAN = 0, BENHNHAN_PHAITHANHTOAN = 0        where REF_TABLE = 'TT_NGOAITRU_TOATHUOC'        and TIEPNHAN_ID =  @param0         and HOADON_ID is null and TIEPNHAN_ID =  @param0         and not exists (select TOATHUOC_ID from TT_NGOAITRU_TOATHUOC where TT_VIENPHI.REF_ID = TOATHUOC_ID and TIEPNHAN_ID =  @param0 )]
2020-07-16 15:58:29,798 [1] DEBUG - Statement Id: [DAO00067_UpdateThuocNgoaiVienPhi_Noref] Parameters: [@param0=[TIEPNHAN_ID,8747]]
2020-07-16 15:58:29,798 [1] DEBUG - Statement Id: [DAO00067_UpdateThuocNgoaiVienPhi_Noref] Types: [@param0=[String, System.String]]
2020-07-16 15:58:29,839 [1] DEBUG - Statement Id: [DAO00014_Clear_1ToaThuocKhambenh] PreparedStatement : [DELETE FROM TT_DUOC_TONKHO_BOOK_NGOAITRU where REF_TABLE = 'TT_NGOAITRU_TOATHUOC'        and REF_ID in (        select TOATHUOC_ID from TT_NGOAITRU_TOATHUOC        where             KHAMBENH_TOATHUOC_ID in (select KHAMBENH_TOATHUOC_ID from TT_NGOAITRU_KHAMBENH_TOATHUOC        where TIEPNHAN_ID = '8747' and                   KHAMBENH_ID not in (select KHAMBENH_ID from TT_NGOAITRU_KHAMBENH where  TIEPNHAN_ID = '8747'))        and TIEPNHAN_ID = '8747')          DELETE FROM TT_VIENPHI where REF_TABLE = 'TT_NGOAITRU_TOATHUOC'        and REF_ID in (        select TOATHUOC_ID from TT_NGOAITRU_TOATHUOC        where KHAMBENH_TOATHUOC_ID in (select KHAMBENH_TOATHUOC_ID from TT_NGOAITRU_KHAMBENH_TOATHUOC        where TIEPNHAN_ID = '8747' and KHAMBENH_ID not in (select KHAMBENH_ID from TT_NGOAITRU_KHAMBENH where TIEPNHAN_ID = '8747'))        and TIEPNHAN_ID = '8747')          delete from TT_NGOAITRU_TOATHUOC        where KHAMBENH_TOATHUOC_ID in (select KHAMBENH_TOATHUOC_ID from TT_NGOAITRU_KHAMBENH_TOATHUOC        where TIEPNHAN_ID = '8747' and KHAMBENH_ID not in (select KHAMBENH_ID from TT_NGOAITRU_KHAMBENH where TIEPNHAN_ID = '8747')        and TIEPNHAN_ID = '8747')          delete from TT_NGOAITRU_KHAMBENH_TOATHUOC where TIEPNHAN_ID = '8747'        and KHAMBENH_ID not in (select KHAMBENH_ID from TT_NGOAITRU_KHAMBENH where TIEPNHAN_ID = '8747') and TIEPNHAN_ID = '8747']
2020-07-16 15:58:30,040 [1] DEBUG - Statement Id: [DAO00014_GetKhamBenhInfo] PreparedStatement : [select * from TT_NGOAITRU_KHAMBENH where KHAMBENH_ID =        (select KHAMBENH_NGOAITRU_ID from TT_DVYEUCAU where DVYEUCAU_ID = '13147')]
2020-07-16 15:58:30,070 [1] DEBUG - Statement Id: [DAO00068_GetSinhHieuBySinhHieuID] PreparedStatement : [select top (1) *            from TT_NGOAITRU_KHAMBENH_SINHHIEU            where KHAMBENH_SINHHIEU_ID = '0'            and BENHVIEN_ID = '01819'             and               BENHNHAN_ID = '8731'                           order by KHAMBENH_SINHHIEU_ID]
2020-07-16 15:58:30,102 [1] DEBUG - Statement Id: [DAO00014_GetKhamBenhICDInfo] PreparedStatement : [select *        from TT_NGOAITRU_KHAMBENH_ICD        where KHAMBENH_ID  = '8012']
2020-07-16 15:58:30,130 [1] DEBUG - Statement Id: [DAO00014_GetListToaThuoc] PreparedStatement : [select A.*        from TT_NGOAITRU_KHAMBENH_TOATHUOC A        where A.KHAMBENH_ID = '8012']
2020-07-16 15:58:30,165 [1] DEBUG - Statement Id: [DAO00305_GetAllLoaiToaThuoc] PreparedStatement : [declare @LOAITOATHUOC varchar(200)        set @LOAITOATHUOC = (select top 1 LOAITOATHUOC = STUFF((SELECT ',' + LOAITOATHUOC FROM TM_TOATHUOC_NGOAITRU where BENHVIEN_ID = '01819' FOR XML PATH ('')), 1, 1, '')        from TM_TOATHUOC_NGOAITRU)        set @LOAITOATHUOC = '''' +  REPLACE(@LOAITOATHUOC,',',''',''') + ''''        select @LOAITOATHUOC as LOAITOATHUOC]
2020-07-16 15:58:30,240 [1] DEBUG - Statement Id: [DAO00040_LayListToaMau] PreparedStatement : [select A.*, dc.TENDUOCDAYDU, dc.BHYT DUOC_BHYT, ld.LOAIVATTU_ID, ld.MALOAIDUOC, dd.DICTIONARY_NAME DUONGDUNG, dc.TAMNGUNG            from TT_TOATHUOCMAU A            left join TM_DUOC dc on A.DUOC_ID = dc.DUOC_ID            left join TM_LOAIDUOC ld on dc.LOAIDUOC_ID = ld.LOAIDUOC_ID            left join (select * from LST_DICTIONARY where DICTIONARY_TYPE_CODE like 'DuongDung') dd on dd.DICTIONARY_ID = dc.DUONGDUNG_ID            where (1=1)             and               A.BACSI_ID  = 1             and               A.LOAITOATHUOC IN ('BV','MN','BV','KTBV','KTBV','BV')]
2020-07-16 15:58:30,303 [1] DEBUG - Statement Id: [DAO00305_GetAllLoaiToaThuoc] PreparedStatement : [declare @LOAITOATHUOC varchar(200)        set @LOAITOATHUOC = (select top 1 LOAITOATHUOC = STUFF((SELECT ',' + LOAITOATHUOC FROM TM_TOATHUOC_NGOAITRU where BENHVIEN_ID = '01819' FOR XML PATH ('')), 1, 1, '')        from TM_TOATHUOC_NGOAITRU)        set @LOAITOATHUOC = '''' +  REPLACE(@LOAITOATHUOC,',',''',''') + ''''        select @LOAITOATHUOC as LOAITOATHUOC]
2020-07-16 15:58:30,382 [1] DEBUG - Statement Id: [DAO00040_LayListToaMau] PreparedStatement : [select A.*, dc.TENDUOCDAYDU, dc.BHYT DUOC_BHYT, ld.LOAIVATTU_ID, ld.MALOAIDUOC, dd.DICTIONARY_NAME DUONGDUNG, dc.TAMNGUNG            from TT_TOATHUOCMAU A            left join TM_DUOC dc on A.DUOC_ID = dc.DUOC_ID            left join TM_LOAIDUOC ld on dc.LOAIDUOC_ID = ld.LOAIDUOC_ID            left join (select * from LST_DICTIONARY where DICTIONARY_TYPE_CODE like 'DuongDung') dd on dd.DICTIONARY_ID = dc.DUONGDUNG_ID            where (1=1)             and               A.BACSI_ID  = 1             and               A.LOAITOATHUOC IN ('BV','MN','BV','KTBV','KTBV','BV')]
2020-07-16 15:58:30,429 [1] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoVaBookingCOM23UpdateRedis_TheoPhamvi] PreparedStatement : [declare @TOAMUANGOAI int = 0;        select @TOAMUANGOAI = isnull(VALUE,0) from TM_SYS_APPSETTINGS where CODE = 'OPD_TOAMUANGOAI_DUNGDANHMUC_DUOC'                if @TOAMUANGOAI = 1        begin        select  distinct '0' + '_' + LTRIM(d.DUOC_ID) + '_' + '0' as DUOC_KEY, 999999999 as SOLUONG        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = '01819'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = '01819')        where  @param0  = 0        union all        select distinct tk.DUOC_KEY, tk.SOLUONG        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = '01819'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = '01819')        inner join        (        select  LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')) DUOC_KEY, (SUM(dtk.SOLUONG) - isnull(sum(A.SOLUONG),0) - isnull(sum(B.SOLUONG),0)) SOLUONG, pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        from (select sum(soluong) soluong,duoc_id,nguonduoc_id,khoduoc_id,benhvien_id from TT_DUOC_TONKHO  group by duoc_id,nguonduoc_id,khoduoc_id,benhvien_id) dtk        inner join TM_DUOC_PHAMVISD_MAPPING pvsd on dtk.KHODUOC_ID = pvsd.KHODUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NOITRU        where TRANGTHAI != 'HUY' and PHAMVI_ID =  @param0         group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) B on B.DUOC_ID = dtk.DUOC_ID and B.PHAMVI_ID = pvsd.PHAMVI_ID and B.NGUONHANG_ID = dtk.NGUONDUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NGOAITRU        where TRANGTHAI != 'HUY' and PHAMVI_ID =  @param0         group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) A on A.DUOC_ID = dtk.DUOC_ID and A.PHAMVI_ID = pvsd.PHAMVI_ID and A.NGUONHANG_ID = dtk.NGUONDUOC_ID        where dtk.BENHVIEN_ID = '01819'        group by LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')), pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        ) tk on tk.DUOC_ID = d.DUOC_ID        left join TM_DUOC_PHAMVISUDUNG kd on kd.PHAMVI_ID = tk.PHAMVI_ID and kd.BENHVIEN_ID = '01819'        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = tk.NGUONDUOC_ID and nh.BENHVIEN_ID = '01819'        where d.BENHVIEN_ID = '01819' and tk.PHAMVI_ID =  @param0         end        else        begin        select distinct tk.DUOC_KEY, tk.SOLUONG        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = '01819'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = '01819')        inner join        (        select  LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')) DUOC_KEY, (SUM(dtk.SOLUONG) - isnull(sum(A.SOLUONG),0) - isnull(sum(B.SOLUONG),0)) SOLUONG, pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        from (select sum(soluong) soluong,duoc_id,nguonduoc_id,khoduoc_id,benhvien_id from TT_DUOC_TONKHO        group by duoc_id,nguonduoc_id,khoduoc_id,benhvien_id) dtk        inner join TM_DUOC_PHAMVISD_MAPPING pvsd on dtk.KHODUOC_ID = pvsd.KHODUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NOITRU        where TRANGTHAI != 'HUY' and PHAMVI_ID =  @param0         group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) B on B.DUOC_ID = dtk.DUOC_ID and B.PHAMVI_ID = pvsd.PHAMVI_ID and B.NGUONHANG_ID = dtk.NGUONDUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NGOAITRU        where TRANGTHAI != 'HUY' and PHAMVI_ID =  @param0         group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) A on A.DUOC_ID = dtk.DUOC_ID and A.PHAMVI_ID = pvsd.PHAMVI_ID and A.NGUONHANG_ID = dtk.NGUONDUOC_ID        where dtk.BENHVIEN_ID = '01819'        group by LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')), pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        ) tk on tk.DUOC_ID = d.DUOC_ID        left join TM_DUOC_PHAMVISUDUNG kd on kd.PHAMVI_ID = tk.PHAMVI_ID and kd.BENHVIEN_ID = '01819'        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = tk.NGUONDUOC_ID and nh.BENHVIEN_ID = '01819'        where d.BENHVIEN_ID = '01819' and tk.PHAMVI_ID =  @param0         end]
2020-07-16 15:58:30,429 [1] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoVaBookingCOM23UpdateRedis_TheoPhamvi] Parameters: [@param0=[PHAMVI_ID,8]]
2020-07-16 15:58:30,429 [1] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoVaBookingCOM23UpdateRedis_TheoPhamvi] Types: [@param0=[Int64, System.Int64]]
2020-07-16 15:58:30,515 [1] DEBUG - Statement Id: [DAO00064_GetlistTT_TIEPNHAN_SOTHEBHYT] PreparedStatement : [select stbhyt.*, ba.SOBENHAN,        tn.SOTIEPNHAN, tn.LOAITHANHVIEN_ID, tn.THE_ID, tn.THANHVIEN_ID,        tn.SUDUNG_BHTN, tn.BAOLANH_VIENPHI, tn.VIP, tn.NGUOINUOCNGOAI, tn.NGOAIGIO        from TT_TIEPNHAN_SOTHEBHYT stbhyt        left join TT_TIEPNHAN tn on tn.TIEPNHAN_ID = stbhyt.TIEPNHAN_ID        left join TT_NOITRU_BENHAN ba on ba.TIEPNHAN_ID = stbhyt.TIEPNHAN_ID        where        stbhyt.TIEPNHAN_ID = '8747' and isnull(stbhyt.KHONGSUDUNG, '0') = '0']
2020-07-16 15:58:30,542 [1] DEBUG - Statement Id: [DAO00064_GetListVienPhiByTiepNnan] PreparedStatement : [select distinct        B.DOITUONG_ID, B.NGAYMIENDONGCHITRA, B.BENHNHAN_ID as TIEPNHAN_BENHNHAN_ID, B.TRAITUYEN,        B.BHYTTREN3NAM as TREN3NAM, B.BHYTTREN5NAM as TREN5NAM, B.SOTIEPNHAN, B.SOBENHAN,        B.LOAITHANHVIEN_ID, B.SUDUNG_BHTN, B.THE_ID, B.THANHVIEN_ID, B.BAOLANH_VIENPHI, B.VIP, B.NGUOINUOCNGOAI,        C.GIATRIMIENGIAM as GIATRIMIENGIAM, D.GIATRIMIENGIAM as GIATRIMIENGIAM_BHTN, E.GIATRIMIENGIAM as GIATRIMIENGIAM_THANHVIEN,        F.GIATRIMIENGIAM as GIATRIMIENGIAM_CONGTY, DVYC.THE_ID as DVDUNGTHE, DVYC.TRANGTHAI as TRANGTHAIDICHVU, ndv.MANHOMDICHVU,        A.* from TT_VIENPHI A        left join        (select B.*, C.SOBENHAN, C.BENHAN_ID        from TT_TIEPNHAN B        left join TT_NOITRU_BENHAN C on B.TIEPNHAN_ID = C.TIEPNHAN_ID                 where B.TIEPNHAN_ID = '8747') B on B.TIEPNHAN_ID = A.TIEPNHAN_ID        left join (select sum(GIATRIMIENGIAM) as GIATRIMIENGIAM, VIENPHI_ID, REF_TABLE        from TT_MIENGIAM_CHITIET        where REF_TABLE = 'TT_MIENGIAM'        and exists (select MIENGIAM_ID from TT_MIENGIAM where TT_MIENGIAM_CHITIET.MIENGIAM_ID = MIENGIAM_ID and TINHTRANG = 1 and TIEPNHAN_ID = '8747')        group by VIENPHI_ID, REF_TABLE) C on C.REF_TABLE = 'TT_MIENGIAM' and C.VIENPHI_ID = A.VIENPHI_ID        left join (select sum(GIATRIMIENGIAM) as GIATRIMIENGIAM, VIENPHI_ID, REF_TABLE        from TT_MIENGIAM_CHITIET        where REF_TABLE = 'TT_MIENGIAM_BHTN'        and exists (select MIENGIAM_BHTN_ID from TT_MIENGIAM_BHTN where TT_MIENGIAM_CHITIET.MIENGIAM_ID = MIENGIAM_BHTN_ID and  TINHTRANG = 1 and TIEPNHAN_ID = '8747')        group by VIENPHI_ID, REF_TABLE) D on D.REF_TABLE = 'TT_MIENGIAM_BHTN' and D.VIENPHI_ID = A.VIENPHI_ID        left join (select sum(GIATRIMIENGIAM) as GIATRIMIENGIAM, VIENPHI_ID, REF_TABLE        from TT_MIENGIAM_CHITIET        where REF_TABLE = 'TT_MIENGIAM_THANHVIEN'        and exists (select MIENGIAM_THANHVIEN_ID from TT_MIENGIAM_THANHVIEN where TT_MIENGIAM_CHITIET.MIENGIAM_ID = MIENGIAM_THANHVIEN_ID and TINHTRANG = 1 and TIEPNHAN_ID = '8747')        group by VIENPHI_ID, REF_TABLE) E on E.REF_TABLE = 'TT_MIENGIAM_THANHVIEN' and E.VIENPHI_ID = A.VIENPHI_ID        left join (select sum(GIATRIMIENGIAM) as GIATRIMIENGIAM, VIENPHI_ID, REF_TABLE        from TT_MIENGIAM_CHITIET        where REF_TABLE = 'TT_MIENGIAM_CONGTY'        and exists (select MIENGIAM_CONGTY_ID from TT_MIENGIAM_CONGTY where TT_MIENGIAM_CHITIET.MIENGIAM_ID = MIENGIAM_CONGTY_ID and TINHTRANG = 1 and TIEPNHAN_ID = '8747')        group by VIENPHI_ID, REF_TABLE) F on F.REF_TABLE = 'TT_MIENGIAM_CONGTY' and F.VIENPHI_ID = A.VIENPHI_ID        left join TT_DVYEUCAU DVYC on DVYC.DVYEUCAU_ID = A.REF_ID and A.REF_TABLE = 'TT_DVYEUCAU'        left join TM_DICHVU DV on DVYC.DICHVU_ID = DV.DICHVU_ID and A.REF_TABLE = 'TT_DVYEUCAU'        left join TM_NHOMDICHVU ndv on ndv.NHOMDICHVU_ID = DV.NHOMDICHVU_ID and A.REF_TABLE = 'TT_DVYEUCAU'        where        A.TIEPNHAN_ID = '8747' and ((DVYC.HUYYEUCAU = '0' and A.DICHVU_ID is not null)        or A.DUOC_ID is not null or A.REF_TABLE = 'TT_NUT_XACNHANSUATAN_CHITIET')        and A.ACTIVE = '1'                 and A.BENHVIEN_ID = '01819'        order by A.VIENPHI_ID]
2020-07-16 15:58:30,569 [1] DEBUG - Statement Id: [DAO00006_GetListDuocTyle] PreparedStatement : [select DUOC_ID, DOITUONG_ID, (TYLE/100) as TYLE, DONGIA MUCTRAN_THANHTOAN from TM_DOITUONG_GIADUOC_TYLE            where            BENHVIEN_ID = '01819'            and DOITUONG_ID = '0']
2020-07-16 15:58:30,593 [1] DEBUG - Statement Id: [DAO00027_GetListTuongTrinhDichVuPhauThuatCuaTiepNhan] PreparedStatement : [declare @ManhomDSA varchar(10);        declare @PhanLoaiNhomDV varchar(20) = '05';        select top 1  @ManhomDSA = VALUE from TM_SYS_APPSETTINGS where CODE = 'MANHOM_DICHVU_DSA'        if (@ManhomDSA is not null) set @PhanLoaiNhomDV += ',' + @ManhomDSA        select distinct ptyc.*        from TT_PHAUTHUAT_YEUCAU ptyc        inner join TM_DICHVU dv on dv.DICHVU_ID = ptyc.DICHVU_ID        inner join TM_NHOMDICHVU ndv on ndv.NHOMDICHVU_ID = dv.NHOMDICHVU_ID        inner join TT_PHAUTHUAT pt on pt.PHAUTHUAT_ID = ptyc.PHAUTHUAT_ID        where        pt.TIEPNHAN_ID = 8747        and (left(ndv.MANHOMDICHVU, 2) in (select * from STRING_SPLIT(@PhanLoaiNhomDV,',')) or ndv.MANHOMDICHVU in (select * from STRING_SPLIT(@PhanLoaiNhomDV,',')))]
2020-07-16 15:58:30,618 [1] DEBUG - Statement Id: [DAO00006_GetList] PreparedStatement : [select dv.*, loaiDV.MALOAIDICHVU, captren.NHOMDICHVU_ID as NHOMDICHVU_CAPTREN_ID, captren.TENNHOMDICHVU as NHOMDICHVU_CAPTREN,              nhom_dv.TENNHOMDICHVU as TENNHOMDICHVU, nhom_dv.MANHOMDICHVU,              case when dv.ATTRIBUTE5 is null then 'TT' else 'KTC' end as LOAI_CHIPHI              from TM_DICHVU as dv              left join TM_NHOMDICHVU as nhom_dv on nhom_dv.NHOMDICHVU_ID = dv.NHOMDICHVU_ID and nhom_dv.BENHVIEN_ID = '01819'              left join TM_NHOMDICHVU as captren on nhom_dv.CAPTREN_ID = captren.NHOMDICHVU_ID and captren.BENHVIEN_ID = '01819'              left join TM_LOAIDICHVU loaiDV on nhom_dv.LOAIDICHVU_ID = loaiDV.LOAIDICHVU_ID and loaiDV.BENHVIEN_ID = '01819'              where nhom_dv.TAMNGUNG = '0' and dv.BENHVIEN_ID = '01819'              and dv.TAMNGUNG = '0'               AND                   loaiDV.MALOAIDICHVU = 'KhamBenh']
2020-07-16 15:58:30,685 [1] DEBUG - Statement Id: [DAO00023_UpdateNhieuVP] PreparedStatement : [declare @jsonVienPhi nvarchar(max) = N'[{"VIENPHI_ID":16000,"TIEPNHAN_ID":8747,"DICHVU_ID":3,"BENHAN_ID":0,"SOLUONG":1.0000,"DONGIA_DOANHTHU":38700.0000,"THANHTIEN_DOANHTHU":38700.00,"BHYT_TL":0.0,"BHYT_DONGIA":0.0,"BHYT_THANHTIEN":0.0,"BHYT_DONGIA_CONGKHAM_DAU":0.0,"BHYT_CONGKHAM_DAU_TYLE":0.0,"BHYT_DONGIA_CHITRA":0.0,"BHYT_THANHTIEN_CHITRA":0.0,"BENHNHAN_PHAITHANHTOAN":38700.00,"GIATRI_HOADON":0.0,"GIATRI_HOADON_DATHANHTOAN":38700.0000,"GIATRI_BIENLAI":0.0,"GIATRI_BIENLAI_DATHANHTOAN":38700.0000,"GIATRI_BENHNHAN_DATHANHTOAN":38700.0000,"DATHUCHIEN":"1","KHONGTHUTIEN":"0","BHYTDONGTIEN":"0","DICHVU_TL":1.0,"BHYT_DONGIA_DONGCT_DAU":0.0,"SOBHYT":null,"SOBHYT_HUONG_ID":8755,"GIATRIMIENGIAM":0.0,"GIATRIMIENGIAM_BHTN":0.0,"GIATRIMIENGIAM_THANHVIEN":0.0,"GIATRIMIENGIAM_CONGTY":0.0,"BHYT_CK2_KHONGTHANHTOAN":false,"SOLONHAP_ID":null,"DUOC_MUCTRAN_THANHTOAN":0.0,"DUOC_TYLE":0.0000}]';        begin        UPDATE TT_VIENPHI        SET        SOLUONG = json.SOLUONG,        DONGIA_DOANHTHU = json.DONGIA_DOANHTHU,        THANHTIEN_DOANHTHU = json.THANHTIEN_DOANHTHU,        BHYT_TL = json.BHYT_TL,        BHYT_DONGIA = json.BHYT_DONGIA,        BHYT_THANHTIEN = json.BHYT_THANHTIEN,        BHYT_DONGIA_CONGKHAM_DAU = json.BHYT_DONGIA_CONGKHAM_DAU,        BHYT_CONGKHAM_DAU_TYLE = json.BHYT_CONGKHAM_DAU_TYLE,        BHYT_DONGIA_CHITRA = json.BHYT_DONGIA_CHITRA,        BHYT_THANHTIEN_CHITRA = json.BHYT_THANHTIEN_CHITRA,        BENHNHAN_PHAITHANHTOAN = json.BENHNHAN_PHAITHANHTOAN,        GIATRI_HOADON = json.GIATRI_HOADON,        GIATRI_BIENLAI = json.GIATRI_BIENLAI,        DATHUCHIEN = json.DATHUCHIEN,        DICHVU_TL = json.DICHVU_TL,        BHYT_DONGIA_DONGCT_DAU = json.BHYT_DONGIA_DONGCT_DAU,        SOLONHAP_ID = json.SOLONHAP_ID,        DUOC_TYLE = json.DUOC_TYLE,        DUOC_MUCTRAN_THANHTOAN = json.DUOC_MUCTRAN_THANHTOAN,        NGAYCAPNHAT = GETDATE()        FROM OPENJSON (@jsonVienPhi)        WITH (        VIENPHI_ID int,        SOLUONG numeric(25, 4),        DONGIA_DOANHTHU numeric(25, 4),        THANHTIEN_DOANHTHU numeric(25, 4),        BHYT_TL numeric(25, 4),        BHYT_DONGIA numeric(25, 4),        BHYT_THANHTIEN numeric(25, 4),        BHYT_DONGIA_CONGKHAM_DAU numeric(25, 4),        BHYT_CONGKHAM_DAU_TYLE numeric(25, 4),        BHYT_DONGIA_CHITRA numeric(25, 4),        BHYT_THANHTIEN_CHITRA numeric(25, 4),        BENHNHAN_PHAITHANHTOAN numeric(25, 4),        GIATRI_HOADON numeric(25, 4),        GIATRI_BIENLAI numeric(25, 4),        DATHUCHIEN char(1),        KHONGTHUTIEN char(1),        BHYTDONGTIEN char(1),        DICHVU_TL numeric(25, 4),        BHYT_DONGIA_DONGCT_DAU numeric(25, 4),        SOLONHAP_ID int,        DUOC_TYLE numeric(25, 4),        DUOC_MUCTRAN_THANHTOAN numeric(25, 4))  json        WHERE TT_VIENPHI.VIENPHI_ID = json.VIENPHI_ID and json.DONGIA_DOANHTHU > 0                  insert into TT_TINH_VIENPHI_LOG        SELECT json.VIENPHI_ID, json.TIEPNHAN_ID, json.BENHAN_ID, json.SOLUONG, json.BHYT_TL, json.DONGIA_DOANHTHU,        json.THANHTIEN_DOANHTHU, json.BHYT_DONGIA, json.BHYT_THANHTIEN, json.BHYT_DONGIA_CHITRA, json.BHYT_THANHTIEN_CHITRA, json.BENHNHAN_PHAITHANHTOAN,        json.SOBHYT_HUONG_ID, json.SOBHYT, GETDATE(), -1, '01819'        FROM OPENJSON(@jsonVienPhi)        WITH (        VIENPHI_ID int,        TIEPNHAN_ID int,        BENHAN_ID int,        SOLUONG numeric(25, 4),        DONGIA_DOANHTHU numeric(25, 4),        THANHTIEN_DOANHTHU numeric(25, 4),        BHYT_TL numeric(25, 4),        BHYT_DONGIA numeric(25, 4),        BHYT_THANHTIEN numeric(25, 4),        BHYT_DONGIA_CHITRA numeric(25, 4),        BHYT_THANHTIEN_CHITRA numeric(25, 4),        BENHNHAN_PHAITHANHTOAN numeric(25, 4),        SOBHYT_HUONG_ID int,        SOBHYT nvarchar(30)) json        end]
2020-07-16 15:58:30,734 [1] DEBUG - Statement Id: [DAO00067_UpdateDataVienPhiDongiaBHYT] PreparedStatement : [update TT_VIENPHI          set BHYT_DONGIA_CHITRA = 0, BHYT_THANHTIEN = 0, BHYT_THANHTIEN_CHITRA = 0          where          TIEPNHAN_ID = 8747 and BHYT_DONGIA = 0          and (BHYT_DONGIA_CHITRA > 0 or BHYT_THANHTIEN > 0 or BHYT_THANHTIEN_CHITRA > 0)]
2020-07-16 15:58:30,758 [1] DEBUG - Statement Id: [DAO00067_CapnhatDataVienphiKhiHuyThanhtoanHoadon] PreparedStatement : [update TT_VIENPHI        set TT_VIENPHI.HOADON_ID = hdct.HOADON_ID, TT_VIENPHI.GIATRI_BENHNHAN_DATHANHTOAN = TT_VIENPHI.GIATRI_BENHNHAN_DATHANHTOAN + hdct.GIATRI_BENHNHAN_DATHANHTOAN        from (select CT.HOADON_ID, CT.VIENPHI_ID, CT.GIATRI_BENHNHAN_DATHANHTOAN        from TT_HOADON_CHITIET_NGOAITRU CT        join TT_HOADON HD on HD.HOADON_ID = CT.HOADON_ID        join TT_VIENPHI vp on vp.VIENPHI_ID = ct.VIENPHI_ID        where HD.DATHANHTOAN = 1 and HD.HUYHOADON = 0 and HD.HOANTRA = 0 and vp.TIEPNHAN_ID =  @param0 ) hdct        where        TT_VIENPHI.VIENPHI_ID = hdct.VIENPHI_ID and TT_VIENPHI.HOADON_ID is null and isnull(TT_VIENPHI.GIATRI_BENHNHAN_DATHANHTOAN,0) = 0        and TT_VIENPHI.TIEPNHAN_ID =  @param0           update TT_VIENPHI        set TT_VIENPHI.HOADON_ID = null, TT_VIENPHI.GIATRI_BENHNHAN_DATHANHTOAN = TT_VIENPHI.GIATRI_BENHNHAN_DATHANHTOAN - hdct.GIATRI_BENHNHAN_DATHANHTOAN,        TT_VIENPHI.DATHANHTOAN = '0'        from (select CT.HOADON_ID, CT.VIENPHI_ID, CT.GIATRI_BENHNHAN_DATHANHTOAN        from TT_HOADON_CHITIET_NGOAITRU CT        join TT_HOADON HD on HD.HOADON_ID = CT.HOADON_ID        join TT_VIENPHI vp on vp.VIENPHI_ID = ct.VIENPHI_ID and vp.HOADON_ID = ct.HOADON_ID        where HD.DATHANHTOAN = 0 and (HD.HUYHOADON = 1 or HD.HOANTRA = 1) and vp.TIEPNHAN_ID =  @param0 ) hdct        where        TT_VIENPHI.VIENPHI_ID = hdct.VIENPHI_ID and TT_VIENPHI.HOADON_ID = hdct.HOADON_ID        and TT_VIENPHI.TIEPNHAN_ID =  @param0]
2020-07-16 15:58:30,758 [1] DEBUG - Statement Id: [DAO00067_CapnhatDataVienphiKhiHuyThanhtoanHoadon] Parameters: [@param0=[TIEPNHAN_ID,8747]]
2020-07-16 15:58:30,758 [1] DEBUG - Statement Id: [DAO00067_CapnhatDataVienphiKhiHuyThanhtoanHoadon] Types: [@param0=[Int64, System.Int64]]
2020-07-16 15:58:30,787 [1] DEBUG - Statement Id: [DAO00403_QMS002_GetIsNext] PreparedStatement : [SELECT VALUE     FROM QMS_PARAMETER     WHERE BENHVIEN_ID = '01819' AND CODE = 'DoneAndNext']
2020-07-16 15:58:30,822 [1] DEBUG - Statement Id: [DAO00403_QMS002_GetDisplaytext] PreparedStatement : [SELECT DISPLAYTEXT, PRIORITY, [ORDER], [SEQUENCE]        FROM QMS_QUEUE_ITEM        WHERE QUEUE_ID = '' AND (PATIENTCODE = '200001812' OR [DISPLAYTEXT] = '') AND BENHVIEN_ID = '01819']
2020-07-16 15:58:41,775 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = '01819'               AND                   TM_SYS_SCREEN.PAGE = 'COM11'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2020-07-16 15:58:41,875 [1] DEBUG - Statement Id: [DAO00043_GetList] PreparedStatement : [select * from TM_NHOMDICHVU            where exists (select NHOMDICHVU_ID from TM_DICHVU where TM_NHOMDICHVU.NHOMDICHVU_ID = NHOMDICHVU_ID) And BENHVIEN_ID = '01819']
2020-07-16 15:58:42,259 [1] DEBUG - Statement Id: [DAO00064_GetBHYTTylethanhtoan] PreparedStatement : [select * from TM_BHYT_TYLETHANHTOAN        where        BENHVIEN_ID = '01819']
2020-07-16 15:58:42,467 [1] DEBUG - Statement Id: [DAO00052_GetList] PreparedStatement : [select *              from TM_NHOMBENH where NHOMBENH_ID in (select NHOMBENH_ID from TM_NHOMBENH_DICHVU) and BENHVIEN_ID = '01819' and TAMNGUNG='0']
2020-07-16 15:58:42,647 [1] DEBUG - Statement Id: [DAO00017_GetDanhSachNoiThucHien] PreparedStatement : [select pb.PHONGBAN_ID, pb.TENPHONGBAN              from [TM_PHONGBAN] as pb              left join LST_DICTIONARY dic on pb.LOAIPHONGBAN_ID = dic.DICTIONARY_ID              where pb.BENHVIEN_ID = '01819'                          and dic.DICTIONARY_TYPE_CODE = 'LoaiPhongBan'            and dic.DICTIONARY_CODE in ('KhamBenh','PhongBenh','KhoaNoi','PhongMo','KhoaDuoc','KhoaCLS', 'KhoaNgoai')]
2020-07-16 15:58:42,708 [1] DEBUG - Statement Id: [DAO00012_GetList] PreparedStatement : [select        DICTIONARY_ID,        DICTIONARY_CODE,        DICTIONARY_NAME,        ATTRIBUTE1,        ATTRIBUTE2,        DICTIONARY_NAME_EN,        DICTIONARY_TYPE_CODE        from LST_DICTIONARY        where LST_DICTIONARY.Enabled = '1'         AND           LST_DICTIONARY.DICTIONARY_TYPE_CODE = 'NguonBN'                 order by LST_DICTIONARY.IDX]
2020-07-16 15:58:42,880 [1] DEBUG - Statement Id: [DAO00000_CheckBHYT] PreparedStatement : [select * from TT_TIEPNHAN Where TIEPNHAN_ID = 8747 and (SOBHYT is not null or SOBHYT != '')]
2020-07-16 15:58:42,956 [1] DEBUG - Statement Id: [DAO00014_GetPatientStatus] PreparedStatement : [select        CASE        when tn.TRANGTHAI = 'HOANTHANH' Then tn.TRANGTHAI        WHEN xncp.XACNHANCHIPHI_ID is not null THEN 'XACNHANCHIPHI'        WHEN (tn.KHOADULIEU = '1') THEN 'KHOADULIEU'        ELSE tn.TRANGTHAI        END        as TRANGTHAI        from TT_TIEPNHAN tn        left join TT_XACNHANCHIPHI xncp on tn.TIEPNHAN_ID = xncp.TIEPNHAN_ID        where tn.TIEPNHAN_ID = '8747'        and tn.BENHVIEN_ID = '01819']
2020-07-16 15:58:43,026 [1] DEBUG - Statement Id: [DAO00013_GetTienSuBenh] PreparedStatement : [select TIENSUBENH, TIENSUDIUNG        from TT_BENHNHAN        where TT_BENHNHAN.BENHNHAN_ID  = '8731']
2020-07-16 15:58:43,050 [1] DEBUG - Statement Id: [DAO00095_GetTTDiUngThuoc] PreparedStatement : [select *              from TT_BENHNHAN_DIUNG_THUOC              where BENHNHAN_ID = '8731'              and BENHVIEN_ID = '01819']
2020-07-16 15:58:43,075 [1] DEBUG - Statement Id: [DAO00017_GetLoaiGiaByDoiTuongId] PreparedStatement : [select dtlg.DOUUTIEN, dtlg.DOITUONG_ID, lg.LOAIGIA_ID, lg.TENLOAIGIA, lg.MALOAIGIA              from TM_LOAIGIA lg              left join TM_DOITUONG_LOAIGIA dtlg              on lg.LOAIGIA_ID = dtlg.LOAIGIA_ID and dtlg.BENHVIEN_ID = '01819'              where lg.TAMNGUNG = 0 and lg.BENHVIEN_ID = '01819'               AND                   dtlg.DOITUONG_ID = '1'                             order by dtlg.DOUUTIEN]
2020-07-16 15:58:43,201 [1] DEBUG - Statement Id: [DAO00099_TT_CSKH_GOI_DANGKY_Service_GetList_01] PreparedStatement : [select GDV.*, GOI.TENGOI, GOI.LOAIGOI_ID from TT_CSKH_GOI_DANGKY GDV        left join TM_CSKH_GOI GOI on GOI.GOI_ID = GDV.GOI_ID        where LOAIGOI_ID in (select DICTIONARY_ID from LST_DICTIONARY where DICTIONARY_CODE = 'NgoaiTru'                              and DICTIONARY_TYPE_CODE = 'LoaiGoiDV')                 and             GDV.BENHNHAN_ID = '8731'           and             GDV.TRANGTHAI in ('DAKICHHOAT','FOLLOWUP')           and             GDV.BENHVIEN_ID = '01819']
2020-07-16 15:58:43,239 [1] DEBUG - Statement Id: [DAO00085_GetDSDichVuThe] PreparedStatement : [select *        from TT_CSKH_THETHANHVIEN_SUDUNG        where THE_ID = '0'        and BENHVIEN_ID = '01819']
2020-07-16 15:58:43,268 [1] DEBUG - Statement Id: [DAO00020_GetDSDichVuYC] PreparedStatement : [select dvyc.*,        dv.TENDICHVU, dv.MADICHVU, dv.NORESULT, ndv.MANHOMDICHVU, ndv.TENNHOMDICHVU, vp.KHONGTHUTIEN,        nv.TENNHANVIEN,PB.TENPHONGBAN as NOITHUCHIEN        from TT_DVYEUCAU dvyc        left join TM_DICHVU dv on dvyc.DICHVU_ID = dv.DICHVU_ID        left join TM_NHOMDICHVU ndv on ndv.NHOMDICHVU_ID = dv.NHOMDICHVU_ID        left join TM_NHANVIEN nv on nv.NHANVIEN_ID = dvyc.NGUOITAO_ID        left join TM_PHONGBAN PB ON DVYC.NOITHUCHIEN_ID=PB.PHONGBAN_ID        left join (select * from TT_VIENPHI where TIEPNHAN_ID = '8747') vp on dvyc.DVYEUCAU_ID = vp.REF_ID                 where        dvyc.TIEPNHAN_ID = 8747        and REF_TABLE = 'TT_DVYEUCAU'                 order by DVYEUCAU_ID desc]
2020-07-16 15:58:43,341 [1] DEBUG - Statement Id: [DAO00020_GetDanhsachVPCuaDichvuYeucau] PreparedStatement : [select V.*, CASE WHEN A.VIENPHI_ID IS NULL AND B.VIENPHI_ID IS NULL THEN '0' ELSE '1' END AS EXIST_HOADON_HUY,        dv.TENDICHVU, dv.MADICHVU, dv.NORESULT, ndv.MANHOMDICHVU, ndv.TENNHOMDICHVU        from TT_VIENPHI AS V        left join TM_DICHVU dv on V.DICHVU_ID = dv.DICHVU_ID and V.REF_TABLE = 'TT_DVYEUCAU'        left join TM_NHOMDICHVU ndv on ndv.NHOMDICHVU_ID = dv.NHOMDICHVU_ID        left join (select DISTINCT HD.VIENPHI_ID from TT_HOADON_CHITIET_NGOAITRU AS HD        inner join TT_HOADON AS H ON H.HOADON_ID = HD.HOADON_ID AND H.HUYHOADON = '1'        where H.TIEPNHAN_ID = '8747'        ) AS A ON A.VIENPHI_ID = V.VIENPHI_ID        left join (select DISTINCT HD.VIENPHI_ID from TT_HOADON_CHITIET_NOITRU AS HD        inner join TT_HOADON AS H ON H.HOADON_ID = HD.HOADON_ID AND H.HUYHOADON = '1'        where H.TIEPNHAN_ID = 8747                 ) AS B ON B.VIENPHI_ID = V.VIENPHI_ID                 where        V.TIEPNHAN_ID = 8747 and V.REF_TABLE = 'TT_DVYEUCAU']
2020-07-16 15:58:43,709 [1] DEBUG - Statement Id: [DAO00064_GetNguonDichvu] PreparedStatement : [select * from TM_NGUONDICHVU        where        BENHVIEN_ID = '01819']
2020-07-16 15:58:47,180 [1] DEBUG - Statement Id: [DAO00014_GetTotalChiPhiDVByTiepNhan] PreparedStatement : [select sum(THANHTIEN_DOANHTHU) as THANHTIEN_DOANHTHU from TT_VIENPHI        where ACTIVE = '1'        and TIEPNHAN_ID = '8747'        and REF_TABLE = 'TT_DVYEUCAU'        and exists (select DVYEUCAU_ID from TT_DVYEUCAU where HUYYEUCAU = '0' and TIEPNHAN_ID = '8747' and TT_VIENPHI.REF_ID = DVYEUCAU_ID)]
2020-07-16 15:58:59,870 [1] DEBUG - Statement Id: [DAO00403_QMS002_GetThongTinClient] PreparedStatement : [SELECT B.ID as QUEUE_ID, B.NAME AS QUEUE_NAME,A.ID AS CLIENT_ID , A.[NAME] AS CLIENT_NAME, ISNULL(A.[STATE],1) AS [STATE],(CASE C.NAME WHEN 'UT' THEN 1 ELSE 0 END) AS QUEUETYPE     , B.DEPARTMENT_ID,ISNULL(B.SECTION_ID,-1) AS SECTION_ID,A.IPSERVER,A.NAMEAUDIO,C.QUEUE_TYPE_CODE,C.QUEUE_TYPE_CODE_SOUND,S.[NAME] AS SECTIONNAME     FROM QMS_QUEUE B LEFT JOIN QMS_CLIENT A ON A.QUEUE_ID = B.ID     LEFT JOIN QMS_QUEUE_TYPE C ON B.QUEUETYPE_ID = C.ID     LEFT JOIN QMS_SECTION S ON B.SECTION_ID=S.ID     WHERE     (A.COMPUTERNAME = 'DESKTOP-89GE5BA' OR A.IPADDRESS = '10.15.167.38') AND A.[STATE] = 1 AND B.DEPARTMENT_ID='74'            AND B.BENHVIEN_ID = '01819']
2020-07-16 15:59:00,014 [1] DEBUG - Statement Id: [DAO00019_GetDanhsachKhambenh] PreparedStatement : [select *        from        (SELECT COUNT(*) OVER() as TOTALROWS, ROW_NUMBER() OVER(order by isnull(dv.SOTHUTU,'999999999'), dv.NGAYGIOYEUCAU) as ROWNUMBER,        bn.MAYTE, bn.TENBENHNHAN, bn.NAMSINH, bn.NGAYSINH as TUOI, ISNULL(CONVERT(VARCHAR(10), bn.NGAYSINH, 103),CAST(bn.NAMSINH AS varchar)) as NGAYSINH, bn.DIACHILIENLAC as DIACHI, bn.GIOITINH, GD.DESCRIPTION as TENGIOITINH,        tn.DOITUONG_ID, tn.THOIGIANTIEPNHAN, tn.BENHNHAN_ID, tn.TIEPNHAN_ID, tn.TRAITUYEN, tn.SOTIEPNHAN,        dv.DICHVU_ID, dv.NOITHUCHIEN_ID, isnull(dv.NGAYTAO, dv.NGAYCAPNHAT) as THOIGIANDKDICHVU,        dv.KHAN, dv.NOIYEUCAU_ID, dv.NGAYGIOYEUCAU, dv.BACSICHIDINH_ID, dv.DONVIGIOITHIEU_ID, dv.NGUOIGIOITHIEU_ID,        tn.NOIGIOITHIEU_ID, kbnt.HUONGGIAIQUYET_ID,        dv.DVYEUCAU_ID, dv.MARIS, dv.TRANGTHAI as TRANGTHAICODE, B.TENNHOMDICHVU, dv.SOPHIEUYEUCAU, dv.KHAMBENH_NGOAITRU_ID, dv.NGUOICAPNHAT_ID, dv.NGAYCAPNHAT,        CASE WHEN Left(B.MANHOMDICHVU,2) = '03' THEN '02' ELSE Left(B.MANHOMDICHVU,2) END AS MANHOMDICHVU, B.MANHOMDICHVU as MANHOMDICHVUCHITIET, tn.TRANGTHAI as TRANGTHAI_TIEPNHAN,        'False' as DAKHAM, isnull(dv.SOTHUTU,'999999999') as SOHANGDOI,        vp.DATHANHTOAN, dv.TRANGTHAI_WFL,        BA.SOBENHAN, dv.CHANDOAN, dt.TENDOITUONG, isnull(kbnt.THOIGIANKHAM, dv.NGAYCAPNHAT) as THOIGIANKHAM,        tn.SOBHYT          ,           tn.UUTIEN                 FROM TT_DVYEUCAU (NOLOCK) dv        inner join TT_TIEPNHAN (NOLOCK) tn on dv.TIEPNHAN_ID = tn.TIEPNHAN_ID        inner join TT_BENHNHAN (NOLOCK) bn on tn.BENHNHAN_ID = bn.BENHNHAN_ID        inner join TM_DICHVU A on A.DICHVU_ID = dv.DICHVU_ID        inner join TM_NHOMDICHVU B on B.NHOMDICHVU_ID = A.NHOMDICHVU_ID        inner join TT_VIENPHI(NOLOCK) VP on VP.TIEPNHAN_ID = tn.TIEPNHAN_ID and VP.DICHVU_ID = dv.DICHVU_ID and VP.REF_ID = dv.DVYEUCAU_ID        left join TT_NOITRU_BENHAN (NOLOCK) BA on BA.TIEPNHAN_ID = tn.TIEPNHAN_ID AND dv.BENHAN_ID = BA.BENHAN_ID        inner join TM_GENDER GD on GD.ID = bn.GIOITINH        left join TT_NGOAITRU_KHAMBENH (NOLOCK) kbnt on kbnt.KHAMBENH_ID = dv.KHAMBENH_NGOAITRU_ID        inner join TM_DOITUONG dt on dt.DOITUONG_ID = tn.DOITUONG_ID        where        dv.DICHVU_ID IS NOT NULL        and tn.BENHVIEN_ID = '01819'        and HUYYEUCAU = 0        and dv.NGAYHENCLS is NULL         and           dv.NGAYYEUCAU >= '7/16/2020 12:00:00 AM'         and           dv.NGAYYEUCAU <= '7/16/2020 12:00:00 AM'         and           dv.NOITHUCHIEN_ID = 74          AND             (                         ((dv.TRANGTHAI_WFL = 'CHUAKETQUA' or (dv.TRANGTHAI = 'CHUAKETQUA' and dv.TRANGTHAI_WFL = 'HOANTHANH')) and (isnull(kbnt.HUONGGIAIQUYET_ID, 0) = 0)))            and (tn.TRANGTHAI != 'HOANTHANH')           and           (CASE WHEN Left(B.MANHOMDICHVU,2) = '03' THEN '02' ELSE Left(B.MANHOMDICHVU,2) END) = '04'                 ) lst                    where          lst.ROWNUMBER between 1 and 19                 order by SOHANGDOI, NGAYGIOYEUCAU asc]
2020-07-16 15:59:01,196 [1] DEBUG - Statement Id: [DAO00017_GetLoaiGiaByDoiTuongId] PreparedStatement : [select dtlg.DOUUTIEN, dtlg.DOITUONG_ID, lg.LOAIGIA_ID, lg.TENLOAIGIA, lg.MALOAIGIA              from TM_LOAIGIA lg              left join TM_DOITUONG_LOAIGIA dtlg              on lg.LOAIGIA_ID = dtlg.LOAIGIA_ID and dtlg.BENHVIEN_ID = '01819'              where lg.TAMNGUNG = 0 and lg.BENHVIEN_ID = '01819'                             order by dtlg.DOUUTIEN]
2020-07-16 15:59:01,261 [1] DEBUG - Statement Id: [DAO00305_GetAllLoaiToaThuoc] PreparedStatement : [declare @LOAITOATHUOC varchar(200)        set @LOAITOATHUOC = (select top 1 LOAITOATHUOC = STUFF((SELECT ',' + LOAITOATHUOC FROM TM_TOATHUOC_NGOAITRU where BENHVIEN_ID = '01819' FOR XML PATH ('')), 1, 1, '')        from TM_TOATHUOC_NGOAITRU)        set @LOAITOATHUOC = '''' +  REPLACE(@LOAITOATHUOC,',',''',''') + ''''        select @LOAITOATHUOC as LOAITOATHUOC]
2020-07-16 15:59:01,330 [1] DEBUG - Statement Id: [DAO00040_LayListToaMau] PreparedStatement : [select A.*, dc.TENDUOCDAYDU, dc.BHYT DUOC_BHYT, ld.LOAIVATTU_ID, ld.MALOAIDUOC, dd.DICTIONARY_NAME DUONGDUNG, dc.TAMNGUNG            from TT_TOATHUOCMAU A            left join TM_DUOC dc on A.DUOC_ID = dc.DUOC_ID            left join TM_LOAIDUOC ld on dc.LOAIDUOC_ID = ld.LOAIDUOC_ID            left join (select * from LST_DICTIONARY where DICTIONARY_TYPE_CODE like 'DuongDung') dd on dd.DICTIONARY_ID = dc.DUONGDUNG_ID            where (1=1)             and               A.BACSI_ID  = 1             and               A.LOAITOATHUOC IN ('BV','MN','BV','KTBV','KTBV','BV')]
2020-07-16 15:59:01,381 [1] DEBUG - Statement Id: [DAO00305_GetAllLoaiToaThuoc] PreparedStatement : [declare @LOAITOATHUOC varchar(200)        set @LOAITOATHUOC = (select top 1 LOAITOATHUOC = STUFF((SELECT ',' + LOAITOATHUOC FROM TM_TOATHUOC_NGOAITRU where BENHVIEN_ID = '01819' FOR XML PATH ('')), 1, 1, '')        from TM_TOATHUOC_NGOAITRU)        set @LOAITOATHUOC = '''' +  REPLACE(@LOAITOATHUOC,',',''',''') + ''''        select @LOAITOATHUOC as LOAITOATHUOC]
2020-07-16 15:59:01,452 [1] DEBUG - Statement Id: [DAO00040_LayListToaMau] PreparedStatement : [select A.*, dc.TENDUOCDAYDU, dc.BHYT DUOC_BHYT, ld.LOAIVATTU_ID, ld.MALOAIDUOC, dd.DICTIONARY_NAME DUONGDUNG, dc.TAMNGUNG            from TT_TOATHUOCMAU A            left join TM_DUOC dc on A.DUOC_ID = dc.DUOC_ID            left join TM_LOAIDUOC ld on dc.LOAIDUOC_ID = ld.LOAIDUOC_ID            left join (select * from LST_DICTIONARY where DICTIONARY_TYPE_CODE like 'DuongDung') dd on dd.DICTIONARY_ID = dc.DUONGDUNG_ID            where (1=1)             and               A.BACSI_ID  = 1             and               A.LOAITOATHUOC IN ('BV','MN','BV','KTBV','KTBV','BV')]
2020-07-16 15:59:01,488 [1] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoVaBookingCOM23UpdateRedis_TheoPhamvi] PreparedStatement : [declare @TOAMUANGOAI int = 0;        select @TOAMUANGOAI = isnull(VALUE,0) from TM_SYS_APPSETTINGS where CODE = 'OPD_TOAMUANGOAI_DUNGDANHMUC_DUOC'                if @TOAMUANGOAI = 1        begin        select  distinct '0' + '_' + LTRIM(d.DUOC_ID) + '_' + '0' as DUOC_KEY, 999999999 as SOLUONG        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = '01819'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = '01819')        where  @param0  = 0        union all        select distinct tk.DUOC_KEY, tk.SOLUONG        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = '01819'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = '01819')        inner join        (        select  LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')) DUOC_KEY, (SUM(dtk.SOLUONG) - isnull(sum(A.SOLUONG),0) - isnull(sum(B.SOLUONG),0)) SOLUONG, pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        from (select sum(soluong) soluong,duoc_id,nguonduoc_id,khoduoc_id,benhvien_id from TT_DUOC_TONKHO  group by duoc_id,nguonduoc_id,khoduoc_id,benhvien_id) dtk        inner join TM_DUOC_PHAMVISD_MAPPING pvsd on dtk.KHODUOC_ID = pvsd.KHODUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NOITRU        where TRANGTHAI != 'HUY' and PHAMVI_ID =  @param0         group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) B on B.DUOC_ID = dtk.DUOC_ID and B.PHAMVI_ID = pvsd.PHAMVI_ID and B.NGUONHANG_ID = dtk.NGUONDUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NGOAITRU        where TRANGTHAI != 'HUY' and PHAMVI_ID =  @param0         group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) A on A.DUOC_ID = dtk.DUOC_ID and A.PHAMVI_ID = pvsd.PHAMVI_ID and A.NGUONHANG_ID = dtk.NGUONDUOC_ID        where dtk.BENHVIEN_ID = '01819'        group by LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')), pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        ) tk on tk.DUOC_ID = d.DUOC_ID        left join TM_DUOC_PHAMVISUDUNG kd on kd.PHAMVI_ID = tk.PHAMVI_ID and kd.BENHVIEN_ID = '01819'        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = tk.NGUONDUOC_ID and nh.BENHVIEN_ID = '01819'        where d.BENHVIEN_ID = '01819' and tk.PHAMVI_ID =  @param0         end        else        begin        select distinct tk.DUOC_KEY, tk.SOLUONG        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = '01819'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = '01819')        inner join        (        select  LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')) DUOC_KEY, (SUM(dtk.SOLUONG) - isnull(sum(A.SOLUONG),0) - isnull(sum(B.SOLUONG),0)) SOLUONG, pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        from (select sum(soluong) soluong,duoc_id,nguonduoc_id,khoduoc_id,benhvien_id from TT_DUOC_TONKHO        group by duoc_id,nguonduoc_id,khoduoc_id,benhvien_id) dtk        inner join TM_DUOC_PHAMVISD_MAPPING pvsd on dtk.KHODUOC_ID = pvsd.KHODUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NOITRU        where TRANGTHAI != 'HUY' and PHAMVI_ID =  @param0         group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) B on B.DUOC_ID = dtk.DUOC_ID and B.PHAMVI_ID = pvsd.PHAMVI_ID and B.NGUONHANG_ID = dtk.NGUONDUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NGOAITRU        where TRANGTHAI != 'HUY' and PHAMVI_ID =  @param0         group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) A on A.DUOC_ID = dtk.DUOC_ID and A.PHAMVI_ID = pvsd.PHAMVI_ID and A.NGUONHANG_ID = dtk.NGUONDUOC_ID        where dtk.BENHVIEN_ID = '01819'        group by LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')), pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        ) tk on tk.DUOC_ID = d.DUOC_ID        left join TM_DUOC_PHAMVISUDUNG kd on kd.PHAMVI_ID = tk.PHAMVI_ID and kd.BENHVIEN_ID = '01819'        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = tk.NGUONDUOC_ID and nh.BENHVIEN_ID = '01819'        where d.BENHVIEN_ID = '01819' and tk.PHAMVI_ID =  @param0         end]
2020-07-16 15:59:01,488 [1] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoVaBookingCOM23UpdateRedis_TheoPhamvi] Parameters: [@param0=[PHAMVI_ID,8]]
2020-07-16 15:59:01,488 [1] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoVaBookingCOM23UpdateRedis_TheoPhamvi] Types: [@param0=[Int64, System.Int64]]
2020-07-16 15:59:01,520 [1] DEBUG - Statement Id: [DAO00012_GetLoaiTCLS] PreparedStatement : [select DICTIONARY_ID, DICTIONARY_CODE, DICTIONARY_NAME, cast('0' as Bit) CHON        from LST_DICTIONARY              where DICTIONARY_TYPE_CODE = 'KHAMBENH_LOAI_TRIEUCHUNGLS'        order by LST_DICTIONARY.IDX]
2020-07-16 15:59:01,544 [1] DEBUG - Statement Id: [DAO00012_GetAllTCLS] PreparedStatement : [select MALOAITRIEUCHUNG DICTIONARY_TYPE_CODE, MALOAITRIEUCHUNG DICTIONARY_CODE,        TENTRIEUCHUNG DICTIONARY_NAME from TM_TRIEUCHUNGLS]
2020-07-16 15:59:01,568 [1] DEBUG - Statement Id: [DAO00019_ThongTinBenhNhanDvYeuCau] PreparedStatement : [select distinct A.SOTIEPNHAN, A.TIEPNHAN_ID, A.DOITUONG_ID, A.TRANGTHAI,        A.LOAITHANHVIEN_ID, A.SUDUNG_BHTN, A.THE_ID, A.THANHVIEN_ID, A.VIP, A.NGUON_BENHNHAN_ID, A.BAOLANH_VIENPHI, A.NGAYMIENDONGCHITRA,        B.*,  C.DICHVU_ID, C.DVYEUCAU_ID, C.NOITHUCHIEN_ID, A.SOBHYT        from TT_TIEPNHAN A        inner join TT_DVYEUCAU C on C.TIEPNHAN_ID = A.TIEPNHAN_ID        inner join TT_BENHNHAN B on B.BENHNHAN_ID = A.BENHNHAN_ID and B.ACTIVE = '1'        where                    C.DVYEUCAU_ID = '13144'                 and A.BENHVIEN_ID = '01819']
2020-07-16 15:59:01,643 [1] DEBUG - Statement Id: [DAO00017_GetLoaiGiaByDoiTuongId] PreparedStatement : [select dtlg.DOUUTIEN, dtlg.DOITUONG_ID, lg.LOAIGIA_ID, lg.TENLOAIGIA, lg.MALOAIGIA              from TM_LOAIGIA lg              left join TM_DOITUONG_LOAIGIA dtlg              on lg.LOAIGIA_ID = dtlg.LOAIGIA_ID and dtlg.BENHVIEN_ID = '01819'              where lg.TAMNGUNG = 0 and lg.BENHVIEN_ID = '01819'                             order by dtlg.DOUUTIEN]
2020-07-16 15:59:01,677 [1] DEBUG - Statement Id: [DAO00092_GetList_ToathuocNgoaitru] PreparedStatement : [select A.*, B.PHAMVI_ID, C.KHODUOC_ID from TM_TOATHUOC_NGOAITRU A        left join TM_DUOC_PHAMVISUDUNG B on B.MAPHAMVI = A.MAPHAMVI        left join (select distinct PHAMVI_ID, KHODUOC_ID from TM_DUOC_PHAMVISD_MAPPING) C on C.PHAMVI_ID = B.PHAMVI_ID        where A.TAMNGUNG != '1' and A.BENHVIEN_ID = '01819'        ORDER BY A.SAPXEP ASC]
2020-07-16 15:59:01,701 [1] DEBUG - Statement Id: [DAO00063_GetListDTPhamviToathuoc] PreparedStatement : [select B.*, C.KHODUOC_ID        from TM_PHAMVI_DOITUONG_TOATHUOC B        left join (select distinct PHAMVI_ID, KHODUOC_ID from TM_DUOC_PHAMVISD_MAPPING) C on C.PHAMVI_ID = B.PHAMVI_ID        where B.TAMNGUNG != '1' and B.DOITUONG_ID = '4']
2020-07-16 15:59:01,726 [1] DEBUG - Statement Id: [DAO00014_KiemTraDVYCCoGiaBHYT] PreparedStatement : [select *        from TT_VIENPHI        where REF_ID  = '13144' and REF_TABLE = 'TT_DVYEUCAU' and BHYT_DONGIA > 0]
2020-07-16 15:59:01,756 [1] DEBUG - Statement Id: [DAO00305_GetAllLoaiToaThuoc] PreparedStatement : [declare @LOAITOATHUOC varchar(200)        set @LOAITOATHUOC = (select top 1 LOAITOATHUOC = STUFF((SELECT ',' + LOAITOATHUOC FROM TM_TOATHUOC_NGOAITRU where BENHVIEN_ID = '01819' FOR XML PATH ('')), 1, 1, '')        from TM_TOATHUOC_NGOAITRU)        set @LOAITOATHUOC = '''' +  REPLACE(@LOAITOATHUOC,',',''',''') + ''''        select @LOAITOATHUOC as LOAITOATHUOC]
2020-07-16 15:59:01,826 [1] DEBUG - Statement Id: [DAO00040_LayListToaMau] PreparedStatement : [select A.*, dc.TENDUOCDAYDU, dc.BHYT DUOC_BHYT, ld.LOAIVATTU_ID, ld.MALOAIDUOC, dd.DICTIONARY_NAME DUONGDUNG, dc.TAMNGUNG            from TT_TOATHUOCMAU A            left join TM_DUOC dc on A.DUOC_ID = dc.DUOC_ID            left join TM_LOAIDUOC ld on dc.LOAIDUOC_ID = ld.LOAIDUOC_ID            left join (select * from LST_DICTIONARY where DICTIONARY_TYPE_CODE like 'DuongDung') dd on dd.DICTIONARY_ID = dc.DUONGDUNG_ID            where (1=1)             and               A.BACSI_ID  = 1             and               A.LOAITOATHUOC IN ('BV','MN','BV','KTBV','KTBV','BV')]
2020-07-16 15:59:01,875 [1] DEBUG - Statement Id: [DAO00305_GetAllLoaiToaThuoc] PreparedStatement : [declare @LOAITOATHUOC varchar(200)        set @LOAITOATHUOC = (select top 1 LOAITOATHUOC = STUFF((SELECT ',' + LOAITOATHUOC FROM TM_TOATHUOC_NGOAITRU where BENHVIEN_ID = '01819' FOR XML PATH ('')), 1, 1, '')        from TM_TOATHUOC_NGOAITRU)        set @LOAITOATHUOC = '''' +  REPLACE(@LOAITOATHUOC,',',''',''') + ''''        select @LOAITOATHUOC as LOAITOATHUOC]
2020-07-16 15:59:01,954 [1] DEBUG - Statement Id: [DAO00040_LayListToaMau] PreparedStatement : [select A.*, dc.TENDUOCDAYDU, dc.BHYT DUOC_BHYT, ld.LOAIVATTU_ID, ld.MALOAIDUOC, dd.DICTIONARY_NAME DUONGDUNG, dc.TAMNGUNG            from TT_TOATHUOCMAU A            left join TM_DUOC dc on A.DUOC_ID = dc.DUOC_ID            left join TM_LOAIDUOC ld on dc.LOAIDUOC_ID = ld.LOAIDUOC_ID            left join (select * from LST_DICTIONARY where DICTIONARY_TYPE_CODE like 'DuongDung') dd on dd.DICTIONARY_ID = dc.DUONGDUNG_ID            where (1=1)             and               A.BACSI_ID  = 1             and               A.LOAITOATHUOC IN ('BV','MN','BV','KTBV','KTBV','BV')]
2020-07-16 15:59:02,015 [1] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoVaBookingCOM23UpdateRedis_TheoPhamvi] PreparedStatement : [declare @TOAMUANGOAI int = 0;        select @TOAMUANGOAI = isnull(VALUE,0) from TM_SYS_APPSETTINGS where CODE = 'OPD_TOAMUANGOAI_DUNGDANHMUC_DUOC'                if @TOAMUANGOAI = 1        begin        select  distinct '0' + '_' + LTRIM(d.DUOC_ID) + '_' + '0' as DUOC_KEY, 999999999 as SOLUONG        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = '01819'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = '01819')        where  @param0  = 0        union all        select distinct tk.DUOC_KEY, tk.SOLUONG        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = '01819'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = '01819')        inner join        (        select  LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')) DUOC_KEY, (SUM(dtk.SOLUONG) - isnull(sum(A.SOLUONG),0) - isnull(sum(B.SOLUONG),0)) SOLUONG, pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        from (select sum(soluong) soluong,duoc_id,nguonduoc_id,khoduoc_id,benhvien_id from TT_DUOC_TONKHO  group by duoc_id,nguonduoc_id,khoduoc_id,benhvien_id) dtk        inner join TM_DUOC_PHAMVISD_MAPPING pvsd on dtk.KHODUOC_ID = pvsd.KHODUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NOITRU        where TRANGTHAI != 'HUY' and PHAMVI_ID =  @param0         group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) B on B.DUOC_ID = dtk.DUOC_ID and B.PHAMVI_ID = pvsd.PHAMVI_ID and B.NGUONHANG_ID = dtk.NGUONDUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NGOAITRU        where TRANGTHAI != 'HUY' and PHAMVI_ID =  @param0         group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) A on A.DUOC_ID = dtk.DUOC_ID and A.PHAMVI_ID = pvsd.PHAMVI_ID and A.NGUONHANG_ID = dtk.NGUONDUOC_ID        where dtk.BENHVIEN_ID = '01819'        group by LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')), pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        ) tk on tk.DUOC_ID = d.DUOC_ID        left join TM_DUOC_PHAMVISUDUNG kd on kd.PHAMVI_ID = tk.PHAMVI_ID and kd.BENHVIEN_ID = '01819'        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = tk.NGUONDUOC_ID and nh.BENHVIEN_ID = '01819'        where d.BENHVIEN_ID = '01819' and tk.PHAMVI_ID =  @param0         end        else        begin        select distinct tk.DUOC_KEY, tk.SOLUONG        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = '01819'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = '01819')        inner join        (        select  LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')) DUOC_KEY, (SUM(dtk.SOLUONG) - isnull(sum(A.SOLUONG),0) - isnull(sum(B.SOLUONG),0)) SOLUONG, pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        from (select sum(soluong) soluong,duoc_id,nguonduoc_id,khoduoc_id,benhvien_id from TT_DUOC_TONKHO        group by duoc_id,nguonduoc_id,khoduoc_id,benhvien_id) dtk        inner join TM_DUOC_PHAMVISD_MAPPING pvsd on dtk.KHODUOC_ID = pvsd.KHODUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NOITRU        where TRANGTHAI != 'HUY' and PHAMVI_ID =  @param0         group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) B on B.DUOC_ID = dtk.DUOC_ID and B.PHAMVI_ID = pvsd.PHAMVI_ID and B.NGUONHANG_ID = dtk.NGUONDUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NGOAITRU        where TRANGTHAI != 'HUY' and PHAMVI_ID =  @param0         group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) A on A.DUOC_ID = dtk.DUOC_ID and A.PHAMVI_ID = pvsd.PHAMVI_ID and A.NGUONHANG_ID = dtk.NGUONDUOC_ID        where dtk.BENHVIEN_ID = '01819'        group by LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')), pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        ) tk on tk.DUOC_ID = d.DUOC_ID        left join TM_DUOC_PHAMVISUDUNG kd on kd.PHAMVI_ID = tk.PHAMVI_ID and kd.BENHVIEN_ID = '01819'        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = tk.NGUONDUOC_ID and nh.BENHVIEN_ID = '01819'        where d.BENHVIEN_ID = '01819' and tk.PHAMVI_ID =  @param0         end]
2020-07-16 15:59:02,015 [1] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoVaBookingCOM23UpdateRedis_TheoPhamvi] Parameters: [@param0=[PHAMVI_ID,2]]
2020-07-16 15:59:02,015 [1] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoVaBookingCOM23UpdateRedis_TheoPhamvi] Types: [@param0=[Int64, System.Int64]]
2020-07-16 15:59:02,056 [1] DEBUG - Statement Id: [DAO00013_GetTienSuBenh] PreparedStatement : [select TIENSUBENH, TIENSUDIUNG        from TT_BENHNHAN        where TT_BENHNHAN.BENHNHAN_ID  = '8728']
2020-07-16 15:59:02,079 [1] DEBUG - Statement Id: [DAO00095_GetTTDiUngThuoc] PreparedStatement : [select *              from TT_BENHNHAN_DIUNG_THUOC              where BENHNHAN_ID = '8728'              and BENHVIEN_ID = '01819']
2020-07-16 15:59:02,102 [1] DEBUG - Statement Id: [DAO00014_GetTotalChiPhiDVByTiepNhan] PreparedStatement : [select sum(THANHTIEN_DOANHTHU) as THANHTIEN_DOANHTHU from TT_VIENPHI        where ACTIVE = '1'        and TIEPNHAN_ID = '8744'        and REF_TABLE = 'TT_DVYEUCAU'        and exists (select DVYEUCAU_ID from TT_DVYEUCAU where HUYYEUCAU = '0' and TIEPNHAN_ID = '8744' and TT_VIENPHI.REF_ID = DVYEUCAU_ID)]
2020-07-16 15:59:02,127 [1] DEBUG - Statement Id: [DAO00014_GetKhamBenhInfo] PreparedStatement : [select * from TT_NGOAITRU_KHAMBENH where KHAMBENH_ID =        (select KHAMBENH_NGOAITRU_ID from TT_DVYEUCAU where DVYEUCAU_ID = '13144')]
2020-07-16 15:59:02,152 [1] DEBUG - Statement Id: [DAO00014_GetSoCaKhamTrongNgay] PreparedStatement : [select Count(KB.KHAMBENH_ID) as SOCAKHAMTRONGNGAY        from TT_NGOAITRU_KHAMBENH KB        inner join TT_TIEPNHAN TN on TN.TIEPNHAN_ID = KB.TIEPNHAN_ID        where KB.NGAYKHAM = convert(date, GETDATE())        and KB.BACSIKHAM_ID = '1'        and KB.BENHVIEN_ID = '01819'        and TN.SOBHYT IS NOT NULL and TN.SOBHYT != '']
2020-07-16 15:59:02,206 [1] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoVaBookingCOM23UpdateRedis_TheoPhamvi] PreparedStatement : [declare @TOAMUANGOAI int = 0;        select @TOAMUANGOAI = isnull(VALUE,0) from TM_SYS_APPSETTINGS where CODE = 'OPD_TOAMUANGOAI_DUNGDANHMUC_DUOC'                if @TOAMUANGOAI = 1        begin        select  distinct '0' + '_' + LTRIM(d.DUOC_ID) + '_' + '0' as DUOC_KEY, 999999999 as SOLUONG        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = '01819'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = '01819')        where  @param0  = 0        union all        select distinct tk.DUOC_KEY, tk.SOLUONG        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = '01819'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = '01819')        inner join        (        select  LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')) DUOC_KEY, (SUM(dtk.SOLUONG) - isnull(sum(A.SOLUONG),0) - isnull(sum(B.SOLUONG),0)) SOLUONG, pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        from (select sum(soluong) soluong,duoc_id,nguonduoc_id,khoduoc_id,benhvien_id from TT_DUOC_TONKHO  group by duoc_id,nguonduoc_id,khoduoc_id,benhvien_id) dtk        inner join TM_DUOC_PHAMVISD_MAPPING pvsd on dtk.KHODUOC_ID = pvsd.KHODUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NOITRU        where TRANGTHAI != 'HUY' and PHAMVI_ID =  @param0         group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) B on B.DUOC_ID = dtk.DUOC_ID and B.PHAMVI_ID = pvsd.PHAMVI_ID and B.NGUONHANG_ID = dtk.NGUONDUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NGOAITRU        where TRANGTHAI != 'HUY' and PHAMVI_ID =  @param0         group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) A on A.DUOC_ID = dtk.DUOC_ID and A.PHAMVI_ID = pvsd.PHAMVI_ID and A.NGUONHANG_ID = dtk.NGUONDUOC_ID        where dtk.BENHVIEN_ID = '01819'        group by LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')), pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        ) tk on tk.DUOC_ID = d.DUOC_ID        left join TM_DUOC_PHAMVISUDUNG kd on kd.PHAMVI_ID = tk.PHAMVI_ID and kd.BENHVIEN_ID = '01819'        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = tk.NGUONDUOC_ID and nh.BENHVIEN_ID = '01819'        where d.BENHVIEN_ID = '01819' and tk.PHAMVI_ID =  @param0         end        else        begin        select distinct tk.DUOC_KEY, tk.SOLUONG        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = '01819'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = '01819')        inner join        (        select  LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')) DUOC_KEY, (SUM(dtk.SOLUONG) - isnull(sum(A.SOLUONG),0) - isnull(sum(B.SOLUONG),0)) SOLUONG, pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        from (select sum(soluong) soluong,duoc_id,nguonduoc_id,khoduoc_id,benhvien_id from TT_DUOC_TONKHO        group by duoc_id,nguonduoc_id,khoduoc_id,benhvien_id) dtk        inner join TM_DUOC_PHAMVISD_MAPPING pvsd on dtk.KHODUOC_ID = pvsd.KHODUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NOITRU        where TRANGTHAI != 'HUY' and PHAMVI_ID =  @param0         group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) B on B.DUOC_ID = dtk.DUOC_ID and B.PHAMVI_ID = pvsd.PHAMVI_ID and B.NGUONHANG_ID = dtk.NGUONDUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NGOAITRU        where TRANGTHAI != 'HUY' and PHAMVI_ID =  @param0         group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) A on A.DUOC_ID = dtk.DUOC_ID and A.PHAMVI_ID = pvsd.PHAMVI_ID and A.NGUONHANG_ID = dtk.NGUONDUOC_ID        where dtk.BENHVIEN_ID = '01819'        group by LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')), pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        ) tk on tk.DUOC_ID = d.DUOC_ID        left join TM_DUOC_PHAMVISUDUNG kd on kd.PHAMVI_ID = tk.PHAMVI_ID and kd.BENHVIEN_ID = '01819'        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = tk.NGUONDUOC_ID and nh.BENHVIEN_ID = '01819'        where d.BENHVIEN_ID = '01819' and tk.PHAMVI_ID =  @param0         end]
2020-07-16 15:59:02,206 [1] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoVaBookingCOM23UpdateRedis_TheoPhamvi] Parameters: [@param0=[PHAMVI_ID,2]]
2020-07-16 15:59:02,206 [1] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoVaBookingCOM23UpdateRedis_TheoPhamvi] Types: [@param0=[Int64, System.Int64]]
2020-07-16 15:59:02,326 [1] DEBUG - Statement Id: [DAO00019_ThongTinBenhNhanDvYeuCau] PreparedStatement : [select distinct A.SOTIEPNHAN, A.TIEPNHAN_ID, A.DOITUONG_ID, A.TRANGTHAI,        A.LOAITHANHVIEN_ID, A.SUDUNG_BHTN, A.THE_ID, A.THANHVIEN_ID, A.VIP, A.NGUON_BENHNHAN_ID, A.BAOLANH_VIENPHI, A.NGAYMIENDONGCHITRA,        B.*,  C.DICHVU_ID, C.DVYEUCAU_ID, C.NOITHUCHIEN_ID, A.SOBHYT        from TT_TIEPNHAN A        inner join TT_DVYEUCAU C on C.TIEPNHAN_ID = A.TIEPNHAN_ID        inner join TT_BENHNHAN B on B.BENHNHAN_ID = A.BENHNHAN_ID and B.ACTIVE = '1'        where                    C.DVYEUCAU_ID = '13144'                 and A.BENHVIEN_ID = '01819']
2020-07-16 15:59:02,408 [1] DEBUG - Statement Id: [DAO00017_GetLoaiGiaByDoiTuongId] PreparedStatement : [select dtlg.DOUUTIEN, dtlg.DOITUONG_ID, lg.LOAIGIA_ID, lg.TENLOAIGIA, lg.MALOAIGIA              from TM_LOAIGIA lg              left join TM_DOITUONG_LOAIGIA dtlg              on lg.LOAIGIA_ID = dtlg.LOAIGIA_ID and dtlg.BENHVIEN_ID = '01819'              where lg.TAMNGUNG = 0 and lg.BENHVIEN_ID = '01819'                             order by dtlg.DOUUTIEN]
2020-07-16 15:59:02,439 [1] DEBUG - Statement Id: [DAO00092_GetList_ToathuocNgoaitru] PreparedStatement : [select A.*, B.PHAMVI_ID, C.KHODUOC_ID from TM_TOATHUOC_NGOAITRU A        left join TM_DUOC_PHAMVISUDUNG B on B.MAPHAMVI = A.MAPHAMVI        left join (select distinct PHAMVI_ID, KHODUOC_ID from TM_DUOC_PHAMVISD_MAPPING) C on C.PHAMVI_ID = B.PHAMVI_ID        where A.TAMNGUNG != '1' and A.BENHVIEN_ID = '01819'        ORDER BY A.SAPXEP ASC]
2020-07-16 15:59:02,464 [1] DEBUG - Statement Id: [DAO00063_GetListDTPhamviToathuoc] PreparedStatement : [select B.*, C.KHODUOC_ID        from TM_PHAMVI_DOITUONG_TOATHUOC B        left join (select distinct PHAMVI_ID, KHODUOC_ID from TM_DUOC_PHAMVISD_MAPPING) C on C.PHAMVI_ID = B.PHAMVI_ID        where B.TAMNGUNG != '1' and B.DOITUONG_ID = '4']
2020-07-16 15:59:02,488 [1] DEBUG - Statement Id: [DAO00014_KiemTraDVYCCoGiaBHYT] PreparedStatement : [select *        from TT_VIENPHI        where REF_ID  = '13144' and REF_TABLE = 'TT_DVYEUCAU' and BHYT_DONGIA > 0]
2020-07-16 15:59:02,515 [1] DEBUG - Statement Id: [DAO00305_GetAllLoaiToaThuoc] PreparedStatement : [declare @LOAITOATHUOC varchar(200)        set @LOAITOATHUOC = (select top 1 LOAITOATHUOC = STUFF((SELECT ',' + LOAITOATHUOC FROM TM_TOATHUOC_NGOAITRU where BENHVIEN_ID = '01819' FOR XML PATH ('')), 1, 1, '')        from TM_TOATHUOC_NGOAITRU)        set @LOAITOATHUOC = '''' +  REPLACE(@LOAITOATHUOC,',',''',''') + ''''        select @LOAITOATHUOC as LOAITOATHUOC]
2020-07-16 15:59:02,584 [1] DEBUG - Statement Id: [DAO00040_LayListToaMau] PreparedStatement : [select A.*, dc.TENDUOCDAYDU, dc.BHYT DUOC_BHYT, ld.LOAIVATTU_ID, ld.MALOAIDUOC, dd.DICTIONARY_NAME DUONGDUNG, dc.TAMNGUNG            from TT_TOATHUOCMAU A            left join TM_DUOC dc on A.DUOC_ID = dc.DUOC_ID            left join TM_LOAIDUOC ld on dc.LOAIDUOC_ID = ld.LOAIDUOC_ID            left join (select * from LST_DICTIONARY where DICTIONARY_TYPE_CODE like 'DuongDung') dd on dd.DICTIONARY_ID = dc.DUONGDUNG_ID            where (1=1)             and               A.BACSI_ID  = 1             and               A.LOAITOATHUOC IN ('BV','MN','BV','KTBV','KTBV','BV')]
2020-07-16 15:59:02,633 [1] DEBUG - Statement Id: [DAO00305_GetAllLoaiToaThuoc] PreparedStatement : [declare @LOAITOATHUOC varchar(200)        set @LOAITOATHUOC = (select top 1 LOAITOATHUOC = STUFF((SELECT ',' + LOAITOATHUOC FROM TM_TOATHUOC_NGOAITRU where BENHVIEN_ID = '01819' FOR XML PATH ('')), 1, 1, '')        from TM_TOATHUOC_NGOAITRU)        set @LOAITOATHUOC = '''' +  REPLACE(@LOAITOATHUOC,',',''',''') + ''''        select @LOAITOATHUOC as LOAITOATHUOC]
2020-07-16 15:59:02,702 [1] DEBUG - Statement Id: [DAO00040_LayListToaMau] PreparedStatement : [select A.*, dc.TENDUOCDAYDU, dc.BHYT DUOC_BHYT, ld.LOAIVATTU_ID, ld.MALOAIDUOC, dd.DICTIONARY_NAME DUONGDUNG, dc.TAMNGUNG            from TT_TOATHUOCMAU A            left join TM_DUOC dc on A.DUOC_ID = dc.DUOC_ID            left join TM_LOAIDUOC ld on dc.LOAIDUOC_ID = ld.LOAIDUOC_ID            left join (select * from LST_DICTIONARY where DICTIONARY_TYPE_CODE like 'DuongDung') dd on dd.DICTIONARY_ID = dc.DUONGDUNG_ID            where (1=1)             and               A.BACSI_ID  = 1             and               A.LOAITOATHUOC IN ('BV','MN','BV','KTBV','KTBV','BV')]
2020-07-16 15:59:02,739 [1] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoVaBookingCOM23UpdateRedis_TheoPhamvi] PreparedStatement : [declare @TOAMUANGOAI int = 0;        select @TOAMUANGOAI = isnull(VALUE,0) from TM_SYS_APPSETTINGS where CODE = 'OPD_TOAMUANGOAI_DUNGDANHMUC_DUOC'                if @TOAMUANGOAI = 1        begin        select  distinct '0' + '_' + LTRIM(d.DUOC_ID) + '_' + '0' as DUOC_KEY, 999999999 as SOLUONG        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = '01819'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = '01819')        where  @param0  = 0        union all        select distinct tk.DUOC_KEY, tk.SOLUONG        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = '01819'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = '01819')        inner join        (        select  LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')) DUOC_KEY, (SUM(dtk.SOLUONG) - isnull(sum(A.SOLUONG),0) - isnull(sum(B.SOLUONG),0)) SOLUONG, pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        from (select sum(soluong) soluong,duoc_id,nguonduoc_id,khoduoc_id,benhvien_id from TT_DUOC_TONKHO  group by duoc_id,nguonduoc_id,khoduoc_id,benhvien_id) dtk        inner join TM_DUOC_PHAMVISD_MAPPING pvsd on dtk.KHODUOC_ID = pvsd.KHODUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NOITRU        where TRANGTHAI != 'HUY' and PHAMVI_ID =  @param0         group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) B on B.DUOC_ID = dtk.DUOC_ID and B.PHAMVI_ID = pvsd.PHAMVI_ID and B.NGUONHANG_ID = dtk.NGUONDUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NGOAITRU        where TRANGTHAI != 'HUY' and PHAMVI_ID =  @param0         group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) A on A.DUOC_ID = dtk.DUOC_ID and A.PHAMVI_ID = pvsd.PHAMVI_ID and A.NGUONHANG_ID = dtk.NGUONDUOC_ID        where dtk.BENHVIEN_ID = '01819'        group by LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')), pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        ) tk on tk.DUOC_ID = d.DUOC_ID        left join TM_DUOC_PHAMVISUDUNG kd on kd.PHAMVI_ID = tk.PHAMVI_ID and kd.BENHVIEN_ID = '01819'        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = tk.NGUONDUOC_ID and nh.BENHVIEN_ID = '01819'        where d.BENHVIEN_ID = '01819' and tk.PHAMVI_ID =  @param0         end        else        begin        select distinct tk.DUOC_KEY, tk.SOLUONG        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = '01819'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = '01819')        inner join        (        select  LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')) DUOC_KEY, (SUM(dtk.SOLUONG) - isnull(sum(A.SOLUONG),0) - isnull(sum(B.SOLUONG),0)) SOLUONG, pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        from (select sum(soluong) soluong,duoc_id,nguonduoc_id,khoduoc_id,benhvien_id from TT_DUOC_TONKHO        group by duoc_id,nguonduoc_id,khoduoc_id,benhvien_id) dtk        inner join TM_DUOC_PHAMVISD_MAPPING pvsd on dtk.KHODUOC_ID = pvsd.KHODUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NOITRU        where TRANGTHAI != 'HUY' and PHAMVI_ID =  @param0         group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) B on B.DUOC_ID = dtk.DUOC_ID and B.PHAMVI_ID = pvsd.PHAMVI_ID and B.NGUONHANG_ID = dtk.NGUONDUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NGOAITRU        where TRANGTHAI != 'HUY' and PHAMVI_ID =  @param0         group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) A on A.DUOC_ID = dtk.DUOC_ID and A.PHAMVI_ID = pvsd.PHAMVI_ID and A.NGUONHANG_ID = dtk.NGUONDUOC_ID        where dtk.BENHVIEN_ID = '01819'        group by LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')), pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        ) tk on tk.DUOC_ID = d.DUOC_ID        left join TM_DUOC_PHAMVISUDUNG kd on kd.PHAMVI_ID = tk.PHAMVI_ID and kd.BENHVIEN_ID = '01819'        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = tk.NGUONDUOC_ID and nh.BENHVIEN_ID = '01819'        where d.BENHVIEN_ID = '01819' and tk.PHAMVI_ID =  @param0         end]
2020-07-16 15:59:02,739 [1] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoVaBookingCOM23UpdateRedis_TheoPhamvi] Parameters: [@param0=[PHAMVI_ID,2]]
2020-07-16 15:59:02,739 [1] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoVaBookingCOM23UpdateRedis_TheoPhamvi] Types: [@param0=[Int64, System.Int64]]
2020-07-16 15:59:02,778 [1] DEBUG - Statement Id: [DAO00013_GetTienSuBenh] PreparedStatement : [select TIENSUBENH, TIENSUDIUNG        from TT_BENHNHAN        where TT_BENHNHAN.BENHNHAN_ID  = '8728']
2020-07-16 15:59:02,805 [1] DEBUG - Statement Id: [DAO00095_GetTTDiUngThuoc] PreparedStatement : [select *              from TT_BENHNHAN_DIUNG_THUOC              where BENHNHAN_ID = '8728'              and BENHVIEN_ID = '01819']
2020-07-16 15:59:02,829 [1] DEBUG - Statement Id: [DAO00014_GetTotalChiPhiDVByTiepNhan] PreparedStatement : [select sum(THANHTIEN_DOANHTHU) as THANHTIEN_DOANHTHU from TT_VIENPHI        where ACTIVE = '1'        and TIEPNHAN_ID = '8744'        and REF_TABLE = 'TT_DVYEUCAU'        and exists (select DVYEUCAU_ID from TT_DVYEUCAU where HUYYEUCAU = '0' and TIEPNHAN_ID = '8744' and TT_VIENPHI.REF_ID = DVYEUCAU_ID)]
2020-07-16 15:59:02,855 [1] DEBUG - Statement Id: [DAO00014_GetKhamBenhInfo] PreparedStatement : [select * from TT_NGOAITRU_KHAMBENH where KHAMBENH_ID =        (select KHAMBENH_NGOAITRU_ID from TT_DVYEUCAU where DVYEUCAU_ID = '13144')]
2020-07-16 15:59:02,880 [1] DEBUG - Statement Id: [DAO00014_GetSoCaKhamTrongNgay] PreparedStatement : [select Count(KB.KHAMBENH_ID) as SOCAKHAMTRONGNGAY        from TT_NGOAITRU_KHAMBENH KB        inner join TT_TIEPNHAN TN on TN.TIEPNHAN_ID = KB.TIEPNHAN_ID        where KB.NGAYKHAM = convert(date, GETDATE())        and KB.BACSIKHAM_ID = '1'        and KB.BENHVIEN_ID = '01819'        and TN.SOBHYT IS NOT NULL and TN.SOBHYT != '']
2020-07-16 15:59:02,928 [1] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoVaBookingCOM23UpdateRedis_TheoPhamvi] PreparedStatement : [declare @TOAMUANGOAI int = 0;        select @TOAMUANGOAI = isnull(VALUE,0) from TM_SYS_APPSETTINGS where CODE = 'OPD_TOAMUANGOAI_DUNGDANHMUC_DUOC'                if @TOAMUANGOAI = 1        begin        select  distinct '0' + '_' + LTRIM(d.DUOC_ID) + '_' + '0' as DUOC_KEY, 999999999 as SOLUONG        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = '01819'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = '01819')        where  @param0  = 0        union all        select distinct tk.DUOC_KEY, tk.SOLUONG        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = '01819'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = '01819')        inner join        (        select  LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')) DUOC_KEY, (SUM(dtk.SOLUONG) - isnull(sum(A.SOLUONG),0) - isnull(sum(B.SOLUONG),0)) SOLUONG, pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        from (select sum(soluong) soluong,duoc_id,nguonduoc_id,khoduoc_id,benhvien_id from TT_DUOC_TONKHO  group by duoc_id,nguonduoc_id,khoduoc_id,benhvien_id) dtk        inner join TM_DUOC_PHAMVISD_MAPPING pvsd on dtk.KHODUOC_ID = pvsd.KHODUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NOITRU        where TRANGTHAI != 'HUY' and PHAMVI_ID =  @param0         group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) B on B.DUOC_ID = dtk.DUOC_ID and B.PHAMVI_ID = pvsd.PHAMVI_ID and B.NGUONHANG_ID = dtk.NGUONDUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NGOAITRU        where TRANGTHAI != 'HUY' and PHAMVI_ID =  @param0         group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) A on A.DUOC_ID = dtk.DUOC_ID and A.PHAMVI_ID = pvsd.PHAMVI_ID and A.NGUONHANG_ID = dtk.NGUONDUOC_ID        where dtk.BENHVIEN_ID = '01819'        group by LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')), pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        ) tk on tk.DUOC_ID = d.DUOC_ID        left join TM_DUOC_PHAMVISUDUNG kd on kd.PHAMVI_ID = tk.PHAMVI_ID and kd.BENHVIEN_ID = '01819'        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = tk.NGUONDUOC_ID and nh.BENHVIEN_ID = '01819'        where d.BENHVIEN_ID = '01819' and tk.PHAMVI_ID =  @param0         end        else        begin        select distinct tk.DUOC_KEY, tk.SOLUONG        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = '01819'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = '01819')        inner join        (        select  LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')) DUOC_KEY, (SUM(dtk.SOLUONG) - isnull(sum(A.SOLUONG),0) - isnull(sum(B.SOLUONG),0)) SOLUONG, pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        from (select sum(soluong) soluong,duoc_id,nguonduoc_id,khoduoc_id,benhvien_id from TT_DUOC_TONKHO        group by duoc_id,nguonduoc_id,khoduoc_id,benhvien_id) dtk        inner join TM_DUOC_PHAMVISD_MAPPING pvsd on dtk.KHODUOC_ID = pvsd.KHODUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NOITRU        where TRANGTHAI != 'HUY' and PHAMVI_ID =  @param0         group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) B on B.DUOC_ID = dtk.DUOC_ID and B.PHAMVI_ID = pvsd.PHAMVI_ID and B.NGUONHANG_ID = dtk.NGUONDUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NGOAITRU        where TRANGTHAI != 'HUY' and PHAMVI_ID =  @param0         group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) A on A.DUOC_ID = dtk.DUOC_ID and A.PHAMVI_ID = pvsd.PHAMVI_ID and A.NGUONHANG_ID = dtk.NGUONDUOC_ID        where dtk.BENHVIEN_ID = '01819'        group by LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')), pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        ) tk on tk.DUOC_ID = d.DUOC_ID        left join TM_DUOC_PHAMVISUDUNG kd on kd.PHAMVI_ID = tk.PHAMVI_ID and kd.BENHVIEN_ID = '01819'        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = tk.NGUONDUOC_ID and nh.BENHVIEN_ID = '01819'        where d.BENHVIEN_ID = '01819' and tk.PHAMVI_ID =  @param0         end]
2020-07-16 15:59:02,928 [1] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoVaBookingCOM23UpdateRedis_TheoPhamvi] Parameters: [@param0=[PHAMVI_ID,2]]
2020-07-16 15:59:02,928 [1] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoVaBookingCOM23UpdateRedis_TheoPhamvi] Types: [@param0=[Int64, System.Int64]]
2020-07-16 15:59:43,127 [1] DEBUG - Statement Id: [DAO00017_GetLoaiGiaByDoiTuongId] PreparedStatement : [select dtlg.DOUUTIEN, dtlg.DOITUONG_ID, lg.LOAIGIA_ID, lg.TENLOAIGIA, lg.MALOAIGIA              from TM_LOAIGIA lg              left join TM_DOITUONG_LOAIGIA dtlg              on lg.LOAIGIA_ID = dtlg.LOAIGIA_ID and dtlg.BENHVIEN_ID = '01819'              where lg.TAMNGUNG = 0 and lg.BENHVIEN_ID = '01819'                             order by dtlg.DOUUTIEN]
2020-07-16 15:59:43,185 [1] DEBUG - Statement Id: [DAO00014_KiemTraDVYCCoGiaBHYT] PreparedStatement : [select *        from TT_VIENPHI        where REF_ID  = '' and REF_TABLE = 'TT_DVYEUCAU' and BHYT_DONGIA > 0]
2020-07-16 15:59:43,213 [1] DEBUG - Statement Id: [DAO00305_GetAllLoaiToaThuoc] PreparedStatement : [declare @LOAITOATHUOC varchar(200)        set @LOAITOATHUOC = (select top 1 LOAITOATHUOC = STUFF((SELECT ',' + LOAITOATHUOC FROM TM_TOATHUOC_NGOAITRU where BENHVIEN_ID = '01819' FOR XML PATH ('')), 1, 1, '')        from TM_TOATHUOC_NGOAITRU)        set @LOAITOATHUOC = '''' +  REPLACE(@LOAITOATHUOC,',',''',''') + ''''        select @LOAITOATHUOC as LOAITOATHUOC]
2020-07-16 15:59:43,283 [1] DEBUG - Statement Id: [DAO00040_LayListToaMau] PreparedStatement : [select A.*, dc.TENDUOCDAYDU, dc.BHYT DUOC_BHYT, ld.LOAIVATTU_ID, ld.MALOAIDUOC, dd.DICTIONARY_NAME DUONGDUNG, dc.TAMNGUNG            from TT_TOATHUOCMAU A            left join TM_DUOC dc on A.DUOC_ID = dc.DUOC_ID            left join TM_LOAIDUOC ld on dc.LOAIDUOC_ID = ld.LOAIDUOC_ID            left join (select * from LST_DICTIONARY where DICTIONARY_TYPE_CODE like 'DuongDung') dd on dd.DICTIONARY_ID = dc.DUONGDUNG_ID            where (1=1)             and               A.BACSI_ID  = 1             and               A.LOAITOATHUOC IN ('BV','MN','BV','KTBV','KTBV','BV')]
2020-07-16 15:59:43,333 [1] DEBUG - Statement Id: [DAO00305_GetAllLoaiToaThuoc] PreparedStatement : [declare @LOAITOATHUOC varchar(200)        set @LOAITOATHUOC = (select top 1 LOAITOATHUOC = STUFF((SELECT ',' + LOAITOATHUOC FROM TM_TOATHUOC_NGOAITRU where BENHVIEN_ID = '01819' FOR XML PATH ('')), 1, 1, '')        from TM_TOATHUOC_NGOAITRU)        set @LOAITOATHUOC = '''' +  REPLACE(@LOAITOATHUOC,',',''',''') + ''''        select @LOAITOATHUOC as LOAITOATHUOC]
2020-07-16 15:59:43,412 [1] DEBUG - Statement Id: [DAO00040_LayListToaMau] PreparedStatement : [select A.*, dc.TENDUOCDAYDU, dc.BHYT DUOC_BHYT, ld.LOAIVATTU_ID, ld.MALOAIDUOC, dd.DICTIONARY_NAME DUONGDUNG, dc.TAMNGUNG            from TT_TOATHUOCMAU A            left join TM_DUOC dc on A.DUOC_ID = dc.DUOC_ID            left join TM_LOAIDUOC ld on dc.LOAIDUOC_ID = ld.LOAIDUOC_ID            left join (select * from LST_DICTIONARY where DICTIONARY_TYPE_CODE like 'DuongDung') dd on dd.DICTIONARY_ID = dc.DUONGDUNG_ID            where (1=1)             and               A.BACSI_ID  = 1             and               A.LOAITOATHUOC IN ('BV','MN','BV','KTBV','KTBV','BV')]
2020-07-16 15:59:43,453 [1] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoVaBookingCOM23UpdateRedis_TheoPhamvi] PreparedStatement : [declare @TOAMUANGOAI int = 0;        select @TOAMUANGOAI = isnull(VALUE,0) from TM_SYS_APPSETTINGS where CODE = 'OPD_TOAMUANGOAI_DUNGDANHMUC_DUOC'                if @TOAMUANGOAI = 1        begin        select  distinct '0' + '_' + LTRIM(d.DUOC_ID) + '_' + '0' as DUOC_KEY, 999999999 as SOLUONG        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = '01819'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = '01819')        where  @param0  = 0        union all        select distinct tk.DUOC_KEY, tk.SOLUONG        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = '01819'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = '01819')        inner join        (        select  LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')) DUOC_KEY, (SUM(dtk.SOLUONG) - isnull(sum(A.SOLUONG),0) - isnull(sum(B.SOLUONG),0)) SOLUONG, pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        from (select sum(soluong) soluong,duoc_id,nguonduoc_id,khoduoc_id,benhvien_id from TT_DUOC_TONKHO  group by duoc_id,nguonduoc_id,khoduoc_id,benhvien_id) dtk        inner join TM_DUOC_PHAMVISD_MAPPING pvsd on dtk.KHODUOC_ID = pvsd.KHODUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NOITRU        where TRANGTHAI != 'HUY' and PHAMVI_ID =  @param0         group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) B on B.DUOC_ID = dtk.DUOC_ID and B.PHAMVI_ID = pvsd.PHAMVI_ID and B.NGUONHANG_ID = dtk.NGUONDUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NGOAITRU        where TRANGTHAI != 'HUY' and PHAMVI_ID =  @param0         group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) A on A.DUOC_ID = dtk.DUOC_ID and A.PHAMVI_ID = pvsd.PHAMVI_ID and A.NGUONHANG_ID = dtk.NGUONDUOC_ID        where dtk.BENHVIEN_ID = '01819'        group by LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')), pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        ) tk on tk.DUOC_ID = d.DUOC_ID        left join TM_DUOC_PHAMVISUDUNG kd on kd.PHAMVI_ID = tk.PHAMVI_ID and kd.BENHVIEN_ID = '01819'        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = tk.NGUONDUOC_ID and nh.BENHVIEN_ID = '01819'        where d.BENHVIEN_ID = '01819' and tk.PHAMVI_ID =  @param0         end        else        begin        select distinct tk.DUOC_KEY, tk.SOLUONG        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = '01819'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = '01819')        inner join        (        select  LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')) DUOC_KEY, (SUM(dtk.SOLUONG) - isnull(sum(A.SOLUONG),0) - isnull(sum(B.SOLUONG),0)) SOLUONG, pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        from (select sum(soluong) soluong,duoc_id,nguonduoc_id,khoduoc_id,benhvien_id from TT_DUOC_TONKHO        group by duoc_id,nguonduoc_id,khoduoc_id,benhvien_id) dtk        inner join TM_DUOC_PHAMVISD_MAPPING pvsd on dtk.KHODUOC_ID = pvsd.KHODUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NOITRU        where TRANGTHAI != 'HUY' and PHAMVI_ID =  @param0         group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) B on B.DUOC_ID = dtk.DUOC_ID and B.PHAMVI_ID = pvsd.PHAMVI_ID and B.NGUONHANG_ID = dtk.NGUONDUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NGOAITRU        where TRANGTHAI != 'HUY' and PHAMVI_ID =  @param0         group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) A on A.DUOC_ID = dtk.DUOC_ID and A.PHAMVI_ID = pvsd.PHAMVI_ID and A.NGUONHANG_ID = dtk.NGUONDUOC_ID        where dtk.BENHVIEN_ID = '01819'        group by LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')), pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        ) tk on tk.DUOC_ID = d.DUOC_ID        left join TM_DUOC_PHAMVISUDUNG kd on kd.PHAMVI_ID = tk.PHAMVI_ID and kd.BENHVIEN_ID = '01819'        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = tk.NGUONDUOC_ID and nh.BENHVIEN_ID = '01819'        where d.BENHVIEN_ID = '01819' and tk.PHAMVI_ID =  @param0         end]
2020-07-16 15:59:43,453 [1] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoVaBookingCOM23UpdateRedis_TheoPhamvi] Parameters: [@param0=[PHAMVI_ID,8]]
2020-07-16 15:59:43,453 [1] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoVaBookingCOM23UpdateRedis_TheoPhamvi] Types: [@param0=[Int64, System.Int64]]
2020-07-16 15:59:43,485 [1] DEBUG - Statement Id: [DAO00012_GetLoaiTCLS] PreparedStatement : [select DICTIONARY_ID, DICTIONARY_CODE, DICTIONARY_NAME, cast('0' as Bit) CHON        from LST_DICTIONARY              where DICTIONARY_TYPE_CODE = 'KHAMBENH_LOAI_TRIEUCHUNGLS'        order by LST_DICTIONARY.IDX]
2020-07-16 15:59:43,509 [1] DEBUG - Statement Id: [DAO00012_GetAllTCLS] PreparedStatement : [select MALOAITRIEUCHUNG DICTIONARY_TYPE_CODE, MALOAITRIEUCHUNG DICTIONARY_CODE,        TENTRIEUCHUNG DICTIONARY_NAME from TM_TRIEUCHUNGLS]
2020-07-16 15:59:43,533 [1] DEBUG - Statement Id: [DAO00019_ThongTinBenhNhanDvYeuCau] PreparedStatement : [select distinct A.SOTIEPNHAN, A.TIEPNHAN_ID, A.DOITUONG_ID, A.TRANGTHAI,        A.LOAITHANHVIEN_ID, A.SUDUNG_BHTN, A.THE_ID, A.THANHVIEN_ID, A.VIP, A.NGUON_BENHNHAN_ID, A.BAOLANH_VIENPHI, A.NGAYMIENDONGCHITRA,        B.*,  C.DICHVU_ID, C.DVYEUCAU_ID, C.NOITHUCHIEN_ID, A.SOBHYT        from TT_TIEPNHAN A        inner join TT_DVYEUCAU C on C.TIEPNHAN_ID = A.TIEPNHAN_ID        inner join TT_BENHNHAN B on B.BENHNHAN_ID = A.BENHNHAN_ID and B.ACTIVE = '1'        where                    C.DVYEUCAU_ID = '13144'                 and A.BENHVIEN_ID = '01819']
2020-07-16 15:59:43,623 [1] DEBUG - Statement Id: [DAO00017_GetLoaiGiaByDoiTuongId] PreparedStatement : [select dtlg.DOUUTIEN, dtlg.DOITUONG_ID, lg.LOAIGIA_ID, lg.TENLOAIGIA, lg.MALOAIGIA              from TM_LOAIGIA lg              left join TM_DOITUONG_LOAIGIA dtlg              on lg.LOAIGIA_ID = dtlg.LOAIGIA_ID and dtlg.BENHVIEN_ID = '01819'              where lg.TAMNGUNG = 0 and lg.BENHVIEN_ID = '01819'                             order by dtlg.DOUUTIEN]
2020-07-16 15:59:43,659 [1] DEBUG - Statement Id: [DAO00092_GetList_ToathuocNgoaitru] PreparedStatement : [select A.*, B.PHAMVI_ID, C.KHODUOC_ID from TM_TOATHUOC_NGOAITRU A        left join TM_DUOC_PHAMVISUDUNG B on B.MAPHAMVI = A.MAPHAMVI        left join (select distinct PHAMVI_ID, KHODUOC_ID from TM_DUOC_PHAMVISD_MAPPING) C on C.PHAMVI_ID = B.PHAMVI_ID        where A.TAMNGUNG != '1' and A.BENHVIEN_ID = '01819'        ORDER BY A.SAPXEP ASC]
2020-07-16 15:59:43,688 [1] DEBUG - Statement Id: [DAO00063_GetListDTPhamviToathuoc] PreparedStatement : [select B.*, C.KHODUOC_ID        from TM_PHAMVI_DOITUONG_TOATHUOC B        left join (select distinct PHAMVI_ID, KHODUOC_ID from TM_DUOC_PHAMVISD_MAPPING) C on C.PHAMVI_ID = B.PHAMVI_ID        where B.TAMNGUNG != '1' and B.DOITUONG_ID = '4']
2020-07-16 15:59:43,711 [1] DEBUG - Statement Id: [DAO00014_KiemTraDVYCCoGiaBHYT] PreparedStatement : [select *        from TT_VIENPHI        where REF_ID  = '13144' and REF_TABLE = 'TT_DVYEUCAU' and BHYT_DONGIA > 0]
2020-07-16 15:59:43,748 [1] DEBUG - Statement Id: [DAO00305_GetAllLoaiToaThuoc] PreparedStatement : [declare @LOAITOATHUOC varchar(200)        set @LOAITOATHUOC = (select top 1 LOAITOATHUOC = STUFF((SELECT ',' + LOAITOATHUOC FROM TM_TOATHUOC_NGOAITRU where BENHVIEN_ID = '01819' FOR XML PATH ('')), 1, 1, '')        from TM_TOATHUOC_NGOAITRU)        set @LOAITOATHUOC = '''' +  REPLACE(@LOAITOATHUOC,',',''',''') + ''''        select @LOAITOATHUOC as LOAITOATHUOC]
2020-07-16 15:59:43,837 [1] DEBUG - Statement Id: [DAO00040_LayListToaMau] PreparedStatement : [select A.*, dc.TENDUOCDAYDU, dc.BHYT DUOC_BHYT, ld.LOAIVATTU_ID, ld.MALOAIDUOC, dd.DICTIONARY_NAME DUONGDUNG, dc.TAMNGUNG            from TT_TOATHUOCMAU A            left join TM_DUOC dc on A.DUOC_ID = dc.DUOC_ID            left join TM_LOAIDUOC ld on dc.LOAIDUOC_ID = ld.LOAIDUOC_ID            left join (select * from LST_DICTIONARY where DICTIONARY_TYPE_CODE like 'DuongDung') dd on dd.DICTIONARY_ID = dc.DUONGDUNG_ID            where (1=1)             and               A.BACSI_ID  = 1             and               A.LOAITOATHUOC IN ('BV','MN','BV','KTBV','KTBV','BV')]
2020-07-16 15:59:43,889 [1] DEBUG - Statement Id: [DAO00305_GetAllLoaiToaThuoc] PreparedStatement : [declare @LOAITOATHUOC varchar(200)        set @LOAITOATHUOC = (select top 1 LOAITOATHUOC = STUFF((SELECT ',' + LOAITOATHUOC FROM TM_TOATHUOC_NGOAITRU where BENHVIEN_ID = '01819' FOR XML PATH ('')), 1, 1, '')        from TM_TOATHUOC_NGOAITRU)        set @LOAITOATHUOC = '''' +  REPLACE(@LOAITOATHUOC,',',''',''') + ''''        select @LOAITOATHUOC as LOAITOATHUOC]
2020-07-16 15:59:43,965 [1] DEBUG - Statement Id: [DAO00040_LayListToaMau] PreparedStatement : [select A.*, dc.TENDUOCDAYDU, dc.BHYT DUOC_BHYT, ld.LOAIVATTU_ID, ld.MALOAIDUOC, dd.DICTIONARY_NAME DUONGDUNG, dc.TAMNGUNG            from TT_TOATHUOCMAU A            left join TM_DUOC dc on A.DUOC_ID = dc.DUOC_ID            left join TM_LOAIDUOC ld on dc.LOAIDUOC_ID = ld.LOAIDUOC_ID            left join (select * from LST_DICTIONARY where DICTIONARY_TYPE_CODE like 'DuongDung') dd on dd.DICTIONARY_ID = dc.DUONGDUNG_ID            where (1=1)             and               A.BACSI_ID  = 1             and               A.LOAITOATHUOC IN ('BV','MN','BV','KTBV','KTBV','BV')]
2020-07-16 15:59:44,007 [1] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoVaBookingCOM23UpdateRedis_TheoPhamvi] PreparedStatement : [declare @TOAMUANGOAI int = 0;        select @TOAMUANGOAI = isnull(VALUE,0) from TM_SYS_APPSETTINGS where CODE = 'OPD_TOAMUANGOAI_DUNGDANHMUC_DUOC'                if @TOAMUANGOAI = 1        begin        select  distinct '0' + '_' + LTRIM(d.DUOC_ID) + '_' + '0' as DUOC_KEY, 999999999 as SOLUONG        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = '01819'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = '01819')        where  @param0  = 0        union all        select distinct tk.DUOC_KEY, tk.SOLUONG        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = '01819'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = '01819')        inner join        (        select  LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')) DUOC_KEY, (SUM(dtk.SOLUONG) - isnull(sum(A.SOLUONG),0) - isnull(sum(B.SOLUONG),0)) SOLUONG, pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        from (select sum(soluong) soluong,duoc_id,nguonduoc_id,khoduoc_id,benhvien_id from TT_DUOC_TONKHO  group by duoc_id,nguonduoc_id,khoduoc_id,benhvien_id) dtk        inner join TM_DUOC_PHAMVISD_MAPPING pvsd on dtk.KHODUOC_ID = pvsd.KHODUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NOITRU        where TRANGTHAI != 'HUY' and PHAMVI_ID =  @param0         group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) B on B.DUOC_ID = dtk.DUOC_ID and B.PHAMVI_ID = pvsd.PHAMVI_ID and B.NGUONHANG_ID = dtk.NGUONDUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NGOAITRU        where TRANGTHAI != 'HUY' and PHAMVI_ID =  @param0         group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) A on A.DUOC_ID = dtk.DUOC_ID and A.PHAMVI_ID = pvsd.PHAMVI_ID and A.NGUONHANG_ID = dtk.NGUONDUOC_ID        where dtk.BENHVIEN_ID = '01819'        group by LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')), pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        ) tk on tk.DUOC_ID = d.DUOC_ID        left join TM_DUOC_PHAMVISUDUNG kd on kd.PHAMVI_ID = tk.PHAMVI_ID and kd.BENHVIEN_ID = '01819'        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = tk.NGUONDUOC_ID and nh.BENHVIEN_ID = '01819'        where d.BENHVIEN_ID = '01819' and tk.PHAMVI_ID =  @param0         end        else        begin        select distinct tk.DUOC_KEY, tk.SOLUONG        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = '01819'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = '01819')        inner join        (        select  LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')) DUOC_KEY, (SUM(dtk.SOLUONG) - isnull(sum(A.SOLUONG),0) - isnull(sum(B.SOLUONG),0)) SOLUONG, pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        from (select sum(soluong) soluong,duoc_id,nguonduoc_id,khoduoc_id,benhvien_id from TT_DUOC_TONKHO        group by duoc_id,nguonduoc_id,khoduoc_id,benhvien_id) dtk        inner join TM_DUOC_PHAMVISD_MAPPING pvsd on dtk.KHODUOC_ID = pvsd.KHODUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NOITRU        where TRANGTHAI != 'HUY' and PHAMVI_ID =  @param0         group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) B on B.DUOC_ID = dtk.DUOC_ID and B.PHAMVI_ID = pvsd.PHAMVI_ID and B.NGUONHANG_ID = dtk.NGUONDUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NGOAITRU        where TRANGTHAI != 'HUY' and PHAMVI_ID =  @param0         group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) A on A.DUOC_ID = dtk.DUOC_ID and A.PHAMVI_ID = pvsd.PHAMVI_ID and A.NGUONHANG_ID = dtk.NGUONDUOC_ID        where dtk.BENHVIEN_ID = '01819'        group by LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')), pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        ) tk on tk.DUOC_ID = d.DUOC_ID        left join TM_DUOC_PHAMVISUDUNG kd on kd.PHAMVI_ID = tk.PHAMVI_ID and kd.BENHVIEN_ID = '01819'        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = tk.NGUONDUOC_ID and nh.BENHVIEN_ID = '01819'        where d.BENHVIEN_ID = '01819' and tk.PHAMVI_ID =  @param0         end]
2020-07-16 15:59:44,007 [1] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoVaBookingCOM23UpdateRedis_TheoPhamvi] Parameters: [@param0=[PHAMVI_ID,2]]
2020-07-16 15:59:44,007 [1] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoVaBookingCOM23UpdateRedis_TheoPhamvi] Types: [@param0=[Int64, System.Int64]]
2020-07-16 15:59:44,047 [1] DEBUG - Statement Id: [DAO00013_GetTienSuBenh] PreparedStatement : [select TIENSUBENH, TIENSUDIUNG        from TT_BENHNHAN        where TT_BENHNHAN.BENHNHAN_ID  = '8728']
2020-07-16 15:59:44,071 [1] DEBUG - Statement Id: [DAO00095_GetTTDiUngThuoc] PreparedStatement : [select *              from TT_BENHNHAN_DIUNG_THUOC              where BENHNHAN_ID = '8728'              and BENHVIEN_ID = '01819']
2020-07-16 15:59:44,100 [1] DEBUG - Statement Id: [DAO00014_GetTotalChiPhiDVByTiepNhan] PreparedStatement : [select sum(THANHTIEN_DOANHTHU) as THANHTIEN_DOANHTHU from TT_VIENPHI        where ACTIVE = '1'        and TIEPNHAN_ID = '8744'        and REF_TABLE = 'TT_DVYEUCAU'        and exists (select DVYEUCAU_ID from TT_DVYEUCAU where HUYYEUCAU = '0' and TIEPNHAN_ID = '8744' and TT_VIENPHI.REF_ID = DVYEUCAU_ID)]
2020-07-16 15:59:44,125 [1] DEBUG - Statement Id: [DAO00014_GetKhamBenhInfo] PreparedStatement : [select * from TT_NGOAITRU_KHAMBENH where KHAMBENH_ID =        (select KHAMBENH_NGOAITRU_ID from TT_DVYEUCAU where DVYEUCAU_ID = '13144')]
2020-07-16 15:59:44,149 [1] DEBUG - Statement Id: [DAO00014_GetSoCaKhamTrongNgay] PreparedStatement : [select Count(KB.KHAMBENH_ID) as SOCAKHAMTRONGNGAY        from TT_NGOAITRU_KHAMBENH KB        inner join TT_TIEPNHAN TN on TN.TIEPNHAN_ID = KB.TIEPNHAN_ID        where KB.NGAYKHAM = convert(date, GETDATE())        and KB.BACSIKHAM_ID = '1'        and KB.BENHVIEN_ID = '01819'        and TN.SOBHYT IS NOT NULL and TN.SOBHYT != '']
2020-07-16 15:59:44,199 [1] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoVaBookingCOM23UpdateRedis_TheoPhamvi] PreparedStatement : [declare @TOAMUANGOAI int = 0;        select @TOAMUANGOAI = isnull(VALUE,0) from TM_SYS_APPSETTINGS where CODE = 'OPD_TOAMUANGOAI_DUNGDANHMUC_DUOC'                if @TOAMUANGOAI = 1        begin        select  distinct '0' + '_' + LTRIM(d.DUOC_ID) + '_' + '0' as DUOC_KEY, 999999999 as SOLUONG        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = '01819'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = '01819')        where  @param0  = 0        union all        select distinct tk.DUOC_KEY, tk.SOLUONG        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = '01819'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = '01819')        inner join        (        select  LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')) DUOC_KEY, (SUM(dtk.SOLUONG) - isnull(sum(A.SOLUONG),0) - isnull(sum(B.SOLUONG),0)) SOLUONG, pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        from (select sum(soluong) soluong,duoc_id,nguonduoc_id,khoduoc_id,benhvien_id from TT_DUOC_TONKHO  group by duoc_id,nguonduoc_id,khoduoc_id,benhvien_id) dtk        inner join TM_DUOC_PHAMVISD_MAPPING pvsd on dtk.KHODUOC_ID = pvsd.KHODUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NOITRU        where TRANGTHAI != 'HUY' and PHAMVI_ID =  @param0         group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) B on B.DUOC_ID = dtk.DUOC_ID and B.PHAMVI_ID = pvsd.PHAMVI_ID and B.NGUONHANG_ID = dtk.NGUONDUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NGOAITRU        where TRANGTHAI != 'HUY' and PHAMVI_ID =  @param0         group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) A on A.DUOC_ID = dtk.DUOC_ID and A.PHAMVI_ID = pvsd.PHAMVI_ID and A.NGUONHANG_ID = dtk.NGUONDUOC_ID        where dtk.BENHVIEN_ID = '01819'        group by LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')), pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        ) tk on tk.DUOC_ID = d.DUOC_ID        left join TM_DUOC_PHAMVISUDUNG kd on kd.PHAMVI_ID = tk.PHAMVI_ID and kd.BENHVIEN_ID = '01819'        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = tk.NGUONDUOC_ID and nh.BENHVIEN_ID = '01819'        where d.BENHVIEN_ID = '01819' and tk.PHAMVI_ID =  @param0         end        else        begin        select distinct tk.DUOC_KEY, tk.SOLUONG        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = '01819'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = '01819')        inner join        (        select  LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')) DUOC_KEY, (SUM(dtk.SOLUONG) - isnull(sum(A.SOLUONG),0) - isnull(sum(B.SOLUONG),0)) SOLUONG, pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        from (select sum(soluong) soluong,duoc_id,nguonduoc_id,khoduoc_id,benhvien_id from TT_DUOC_TONKHO        group by duoc_id,nguonduoc_id,khoduoc_id,benhvien_id) dtk        inner join TM_DUOC_PHAMVISD_MAPPING pvsd on dtk.KHODUOC_ID = pvsd.KHODUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NOITRU        where TRANGTHAI != 'HUY' and PHAMVI_ID =  @param0         group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) B on B.DUOC_ID = dtk.DUOC_ID and B.PHAMVI_ID = pvsd.PHAMVI_ID and B.NGUONHANG_ID = dtk.NGUONDUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NGOAITRU        where TRANGTHAI != 'HUY' and PHAMVI_ID =  @param0         group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) A on A.DUOC_ID = dtk.DUOC_ID and A.PHAMVI_ID = pvsd.PHAMVI_ID and A.NGUONHANG_ID = dtk.NGUONDUOC_ID        where dtk.BENHVIEN_ID = '01819'        group by LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')), pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        ) tk on tk.DUOC_ID = d.DUOC_ID        left join TM_DUOC_PHAMVISUDUNG kd on kd.PHAMVI_ID = tk.PHAMVI_ID and kd.BENHVIEN_ID = '01819'        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = tk.NGUONDUOC_ID and nh.BENHVIEN_ID = '01819'        where d.BENHVIEN_ID = '01819' and tk.PHAMVI_ID =  @param0         end]
2020-07-16 15:59:44,199 [1] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoVaBookingCOM23UpdateRedis_TheoPhamvi] Parameters: [@param0=[PHAMVI_ID,2]]
2020-07-16 15:59:44,199 [1] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoVaBookingCOM23UpdateRedis_TheoPhamvi] Types: [@param0=[Int64, System.Int64]]
2020-07-16 15:59:44,433 [1] DEBUG - Statement Id: [DAO00019_ThongTinBenhNhanDvYeuCau] PreparedStatement : [select distinct A.SOTIEPNHAN, A.TIEPNHAN_ID, A.DOITUONG_ID, A.TRANGTHAI,        A.LOAITHANHVIEN_ID, A.SUDUNG_BHTN, A.THE_ID, A.THANHVIEN_ID, A.VIP, A.NGUON_BENHNHAN_ID, A.BAOLANH_VIENPHI, A.NGAYMIENDONGCHITRA,        B.*,  C.DICHVU_ID, C.DVYEUCAU_ID, C.NOITHUCHIEN_ID, A.SOBHYT        from TT_TIEPNHAN A        inner join TT_DVYEUCAU C on C.TIEPNHAN_ID = A.TIEPNHAN_ID        inner join TT_BENHNHAN B on B.BENHNHAN_ID = A.BENHNHAN_ID and B.ACTIVE = '1'        where                    C.DVYEUCAU_ID = '13144'                 and A.BENHVIEN_ID = '01819']
2020-07-16 15:59:44,514 [1] DEBUG - Statement Id: [DAO00017_GetLoaiGiaByDoiTuongId] PreparedStatement : [select dtlg.DOUUTIEN, dtlg.DOITUONG_ID, lg.LOAIGIA_ID, lg.TENLOAIGIA, lg.MALOAIGIA              from TM_LOAIGIA lg              left join TM_DOITUONG_LOAIGIA dtlg              on lg.LOAIGIA_ID = dtlg.LOAIGIA_ID and dtlg.BENHVIEN_ID = '01819'              where lg.TAMNGUNG = 0 and lg.BENHVIEN_ID = '01819'                             order by dtlg.DOUUTIEN]
2020-07-16 15:59:44,545 [1] DEBUG - Statement Id: [DAO00092_GetList_ToathuocNgoaitru] PreparedStatement : [select A.*, B.PHAMVI_ID, C.KHODUOC_ID from TM_TOATHUOC_NGOAITRU A        left join TM_DUOC_PHAMVISUDUNG B on B.MAPHAMVI = A.MAPHAMVI        left join (select distinct PHAMVI_ID, KHODUOC_ID from TM_DUOC_PHAMVISD_MAPPING) C on C.PHAMVI_ID = B.PHAMVI_ID        where A.TAMNGUNG != '1' and A.BENHVIEN_ID = '01819'        ORDER BY A.SAPXEP ASC]
2020-07-16 15:59:44,569 [1] DEBUG - Statement Id: [DAO00063_GetListDTPhamviToathuoc] PreparedStatement : [select B.*, C.KHODUOC_ID        from TM_PHAMVI_DOITUONG_TOATHUOC B        left join (select distinct PHAMVI_ID, KHODUOC_ID from TM_DUOC_PHAMVISD_MAPPING) C on C.PHAMVI_ID = B.PHAMVI_ID        where B.TAMNGUNG != '1' and B.DOITUONG_ID = '4']
2020-07-16 15:59:44,594 [1] DEBUG - Statement Id: [DAO00014_KiemTraDVYCCoGiaBHYT] PreparedStatement : [select *        from TT_VIENPHI        where REF_ID  = '13144' and REF_TABLE = 'TT_DVYEUCAU' and BHYT_DONGIA > 0]
2020-07-16 15:59:44,628 [1] DEBUG - Statement Id: [DAO00305_GetAllLoaiToaThuoc] PreparedStatement : [declare @LOAITOATHUOC varchar(200)        set @LOAITOATHUOC = (select top 1 LOAITOATHUOC = STUFF((SELECT ',' + LOAITOATHUOC FROM TM_TOATHUOC_NGOAITRU where BENHVIEN_ID = '01819' FOR XML PATH ('')), 1, 1, '')        from TM_TOATHUOC_NGOAITRU)        set @LOAITOATHUOC = '''' +  REPLACE(@LOAITOATHUOC,',',''',''') + ''''        select @LOAITOATHUOC as LOAITOATHUOC]
2020-07-16 15:59:44,697 [1] DEBUG - Statement Id: [DAO00040_LayListToaMau] PreparedStatement : [select A.*, dc.TENDUOCDAYDU, dc.BHYT DUOC_BHYT, ld.LOAIVATTU_ID, ld.MALOAIDUOC, dd.DICTIONARY_NAME DUONGDUNG, dc.TAMNGUNG            from TT_TOATHUOCMAU A            left join TM_DUOC dc on A.DUOC_ID = dc.DUOC_ID            left join TM_LOAIDUOC ld on dc.LOAIDUOC_ID = ld.LOAIDUOC_ID            left join (select * from LST_DICTIONARY where DICTIONARY_TYPE_CODE like 'DuongDung') dd on dd.DICTIONARY_ID = dc.DUONGDUNG_ID            where (1=1)             and               A.BACSI_ID  = 1             and               A.LOAITOATHUOC IN ('BV','MN','BV','KTBV','KTBV','BV')]
2020-07-16 15:59:44,747 [1] DEBUG - Statement Id: [DAO00305_GetAllLoaiToaThuoc] PreparedStatement : [declare @LOAITOATHUOC varchar(200)        set @LOAITOATHUOC = (select top 1 LOAITOATHUOC = STUFF((SELECT ',' + LOAITOATHUOC FROM TM_TOATHUOC_NGOAITRU where BENHVIEN_ID = '01819' FOR XML PATH ('')), 1, 1, '')        from TM_TOATHUOC_NGOAITRU)        set @LOAITOATHUOC = '''' +  REPLACE(@LOAITOATHUOC,',',''',''') + ''''        select @LOAITOATHUOC as LOAITOATHUOC]
2020-07-16 15:59:44,816 [1] DEBUG - Statement Id: [DAO00040_LayListToaMau] PreparedStatement : [select A.*, dc.TENDUOCDAYDU, dc.BHYT DUOC_BHYT, ld.LOAIVATTU_ID, ld.MALOAIDUOC, dd.DICTIONARY_NAME DUONGDUNG, dc.TAMNGUNG            from TT_TOATHUOCMAU A            left join TM_DUOC dc on A.DUOC_ID = dc.DUOC_ID            left join TM_LOAIDUOC ld on dc.LOAIDUOC_ID = ld.LOAIDUOC_ID            left join (select * from LST_DICTIONARY where DICTIONARY_TYPE_CODE like 'DuongDung') dd on dd.DICTIONARY_ID = dc.DUONGDUNG_ID            where (1=1)             and               A.BACSI_ID  = 1             and               A.LOAITOATHUOC IN ('BV','MN','BV','KTBV','KTBV','BV')]
2020-07-16 15:59:44,853 [1] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoVaBookingCOM23UpdateRedis_TheoPhamvi] PreparedStatement : [declare @TOAMUANGOAI int = 0;        select @TOAMUANGOAI = isnull(VALUE,0) from TM_SYS_APPSETTINGS where CODE = 'OPD_TOAMUANGOAI_DUNGDANHMUC_DUOC'                if @TOAMUANGOAI = 1        begin        select  distinct '0' + '_' + LTRIM(d.DUOC_ID) + '_' + '0' as DUOC_KEY, 999999999 as SOLUONG        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = '01819'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = '01819')        where  @param0  = 0        union all        select distinct tk.DUOC_KEY, tk.SOLUONG        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = '01819'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = '01819')        inner join        (        select  LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')) DUOC_KEY, (SUM(dtk.SOLUONG) - isnull(sum(A.SOLUONG),0) - isnull(sum(B.SOLUONG),0)) SOLUONG, pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        from (select sum(soluong) soluong,duoc_id,nguonduoc_id,khoduoc_id,benhvien_id from TT_DUOC_TONKHO  group by duoc_id,nguonduoc_id,khoduoc_id,benhvien_id) dtk        inner join TM_DUOC_PHAMVISD_MAPPING pvsd on dtk.KHODUOC_ID = pvsd.KHODUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NOITRU        where TRANGTHAI != 'HUY' and PHAMVI_ID =  @param0         group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) B on B.DUOC_ID = dtk.DUOC_ID and B.PHAMVI_ID = pvsd.PHAMVI_ID and B.NGUONHANG_ID = dtk.NGUONDUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NGOAITRU        where TRANGTHAI != 'HUY' and PHAMVI_ID =  @param0         group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) A on A.DUOC_ID = dtk.DUOC_ID and A.PHAMVI_ID = pvsd.PHAMVI_ID and A.NGUONHANG_ID = dtk.NGUONDUOC_ID        where dtk.BENHVIEN_ID = '01819'        group by LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')), pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        ) tk on tk.DUOC_ID = d.DUOC_ID        left join TM_DUOC_PHAMVISUDUNG kd on kd.PHAMVI_ID = tk.PHAMVI_ID and kd.BENHVIEN_ID = '01819'        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = tk.NGUONDUOC_ID and nh.BENHVIEN_ID = '01819'        where d.BENHVIEN_ID = '01819' and tk.PHAMVI_ID =  @param0         end        else        begin        select distinct tk.DUOC_KEY, tk.SOLUONG        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = '01819'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = '01819')        inner join        (        select  LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')) DUOC_KEY, (SUM(dtk.SOLUONG) - isnull(sum(A.SOLUONG),0) - isnull(sum(B.SOLUONG),0)) SOLUONG, pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        from (select sum(soluong) soluong,duoc_id,nguonduoc_id,khoduoc_id,benhvien_id from TT_DUOC_TONKHO        group by duoc_id,nguonduoc_id,khoduoc_id,benhvien_id) dtk        inner join TM_DUOC_PHAMVISD_MAPPING pvsd on dtk.KHODUOC_ID = pvsd.KHODUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NOITRU        where TRANGTHAI != 'HUY' and PHAMVI_ID =  @param0         group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) B on B.DUOC_ID = dtk.DUOC_ID and B.PHAMVI_ID = pvsd.PHAMVI_ID and B.NGUONHANG_ID = dtk.NGUONDUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NGOAITRU        where TRANGTHAI != 'HUY' and PHAMVI_ID =  @param0         group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) A on A.DUOC_ID = dtk.DUOC_ID and A.PHAMVI_ID = pvsd.PHAMVI_ID and A.NGUONHANG_ID = dtk.NGUONDUOC_ID        where dtk.BENHVIEN_ID = '01819'        group by LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')), pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        ) tk on tk.DUOC_ID = d.DUOC_ID        left join TM_DUOC_PHAMVISUDUNG kd on kd.PHAMVI_ID = tk.PHAMVI_ID and kd.BENHVIEN_ID = '01819'        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = tk.NGUONDUOC_ID and nh.BENHVIEN_ID = '01819'        where d.BENHVIEN_ID = '01819' and tk.PHAMVI_ID =  @param0         end]
2020-07-16 15:59:44,853 [1] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoVaBookingCOM23UpdateRedis_TheoPhamvi] Parameters: [@param0=[PHAMVI_ID,2]]
2020-07-16 15:59:44,853 [1] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoVaBookingCOM23UpdateRedis_TheoPhamvi] Types: [@param0=[Int64, System.Int64]]
2020-07-16 15:59:44,890 [1] DEBUG - Statement Id: [DAO00013_GetTienSuBenh] PreparedStatement : [select TIENSUBENH, TIENSUDIUNG        from TT_BENHNHAN        where TT_BENHNHAN.BENHNHAN_ID  = '8728']
2020-07-16 15:59:44,913 [1] DEBUG - Statement Id: [DAO00095_GetTTDiUngThuoc] PreparedStatement : [select *              from TT_BENHNHAN_DIUNG_THUOC              where BENHNHAN_ID = '8728'              and BENHVIEN_ID = '01819']
2020-07-16 15:59:44,937 [1] DEBUG - Statement Id: [DAO00014_GetTotalChiPhiDVByTiepNhan] PreparedStatement : [select sum(THANHTIEN_DOANHTHU) as THANHTIEN_DOANHTHU from TT_VIENPHI        where ACTIVE = '1'        and TIEPNHAN_ID = '8744'        and REF_TABLE = 'TT_DVYEUCAU'        and exists (select DVYEUCAU_ID from TT_DVYEUCAU where HUYYEUCAU = '0' and TIEPNHAN_ID = '8744' and TT_VIENPHI.REF_ID = DVYEUCAU_ID)]
2020-07-16 15:59:44,961 [1] DEBUG - Statement Id: [DAO00014_GetKhamBenhInfo] PreparedStatement : [select * from TT_NGOAITRU_KHAMBENH where KHAMBENH_ID =        (select KHAMBENH_NGOAITRU_ID from TT_DVYEUCAU where DVYEUCAU_ID = '13144')]
2020-07-16 15:59:44,985 [1] DEBUG - Statement Id: [DAO00014_GetSoCaKhamTrongNgay] PreparedStatement : [select Count(KB.KHAMBENH_ID) as SOCAKHAMTRONGNGAY        from TT_NGOAITRU_KHAMBENH KB        inner join TT_TIEPNHAN TN on TN.TIEPNHAN_ID = KB.TIEPNHAN_ID        where KB.NGAYKHAM = convert(date, GETDATE())        and KB.BACSIKHAM_ID = '1'        and KB.BENHVIEN_ID = '01819'        and TN.SOBHYT IS NOT NULL and TN.SOBHYT != '']
2020-07-16 15:59:45,034 [1] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoVaBookingCOM23UpdateRedis_TheoPhamvi] PreparedStatement : [declare @TOAMUANGOAI int = 0;        select @TOAMUANGOAI = isnull(VALUE,0) from TM_SYS_APPSETTINGS where CODE = 'OPD_TOAMUANGOAI_DUNGDANHMUC_DUOC'                if @TOAMUANGOAI = 1        begin        select  distinct '0' + '_' + LTRIM(d.DUOC_ID) + '_' + '0' as DUOC_KEY, 999999999 as SOLUONG        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = '01819'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = '01819')        where  @param0  = 0        union all        select distinct tk.DUOC_KEY, tk.SOLUONG        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = '01819'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = '01819')        inner join        (        select  LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')) DUOC_KEY, (SUM(dtk.SOLUONG) - isnull(sum(A.SOLUONG),0) - isnull(sum(B.SOLUONG),0)) SOLUONG, pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        from (select sum(soluong) soluong,duoc_id,nguonduoc_id,khoduoc_id,benhvien_id from TT_DUOC_TONKHO  group by duoc_id,nguonduoc_id,khoduoc_id,benhvien_id) dtk        inner join TM_DUOC_PHAMVISD_MAPPING pvsd on dtk.KHODUOC_ID = pvsd.KHODUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NOITRU        where TRANGTHAI != 'HUY' and PHAMVI_ID =  @param0         group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) B on B.DUOC_ID = dtk.DUOC_ID and B.PHAMVI_ID = pvsd.PHAMVI_ID and B.NGUONHANG_ID = dtk.NGUONDUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NGOAITRU        where TRANGTHAI != 'HUY' and PHAMVI_ID =  @param0         group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) A on A.DUOC_ID = dtk.DUOC_ID and A.PHAMVI_ID = pvsd.PHAMVI_ID and A.NGUONHANG_ID = dtk.NGUONDUOC_ID        where dtk.BENHVIEN_ID = '01819'        group by LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')), pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        ) tk on tk.DUOC_ID = d.DUOC_ID        left join TM_DUOC_PHAMVISUDUNG kd on kd.PHAMVI_ID = tk.PHAMVI_ID and kd.BENHVIEN_ID = '01819'        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = tk.NGUONDUOC_ID and nh.BENHVIEN_ID = '01819'        where d.BENHVIEN_ID = '01819' and tk.PHAMVI_ID =  @param0         end        else        begin        select distinct tk.DUOC_KEY, tk.SOLUONG        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = '01819'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = '01819')        inner join        (        select  LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')) DUOC_KEY, (SUM(dtk.SOLUONG) - isnull(sum(A.SOLUONG),0) - isnull(sum(B.SOLUONG),0)) SOLUONG, pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        from (select sum(soluong) soluong,duoc_id,nguonduoc_id,khoduoc_id,benhvien_id from TT_DUOC_TONKHO        group by duoc_id,nguonduoc_id,khoduoc_id,benhvien_id) dtk        inner join TM_DUOC_PHAMVISD_MAPPING pvsd on dtk.KHODUOC_ID = pvsd.KHODUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NOITRU        where TRANGTHAI != 'HUY' and PHAMVI_ID =  @param0         group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) B on B.DUOC_ID = dtk.DUOC_ID and B.PHAMVI_ID = pvsd.PHAMVI_ID and B.NGUONHANG_ID = dtk.NGUONDUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NGOAITRU        where TRANGTHAI != 'HUY' and PHAMVI_ID =  @param0         group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) A on A.DUOC_ID = dtk.DUOC_ID and A.PHAMVI_ID = pvsd.PHAMVI_ID and A.NGUONHANG_ID = dtk.NGUONDUOC_ID        where dtk.BENHVIEN_ID = '01819'        group by LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')), pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        ) tk on tk.DUOC_ID = d.DUOC_ID        left join TM_DUOC_PHAMVISUDUNG kd on kd.PHAMVI_ID = tk.PHAMVI_ID and kd.BENHVIEN_ID = '01819'        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = tk.NGUONDUOC_ID and nh.BENHVIEN_ID = '01819'        where d.BENHVIEN_ID = '01819' and tk.PHAMVI_ID =  @param0         end]
2020-07-16 15:59:45,034 [1] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoVaBookingCOM23UpdateRedis_TheoPhamvi] Parameters: [@param0=[PHAMVI_ID,2]]
2020-07-16 15:59:45,034 [1] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoVaBookingCOM23UpdateRedis_TheoPhamvi] Types: [@param0=[Int64, System.Int64]]
2020-07-16 15:59:51,767 [1] DEBUG - Statement Id: [DAO00017_GetLoaiGiaByDoiTuongId] PreparedStatement : [select dtlg.DOUUTIEN, dtlg.DOITUONG_ID, lg.LOAIGIA_ID, lg.TENLOAIGIA, lg.MALOAIGIA              from TM_LOAIGIA lg              left join TM_DOITUONG_LOAIGIA dtlg              on lg.LOAIGIA_ID = dtlg.LOAIGIA_ID and dtlg.BENHVIEN_ID = '01819'              where lg.TAMNGUNG = 0 and lg.BENHVIEN_ID = '01819'                             order by dtlg.DOUUTIEN]
2020-07-16 15:59:51,827 [1] DEBUG - Statement Id: [DAO00014_KiemTraDVYCCoGiaBHYT] PreparedStatement : [select *        from TT_VIENPHI        where REF_ID  = '' and REF_TABLE = 'TT_DVYEUCAU' and BHYT_DONGIA > 0]
2020-07-16 15:59:51,854 [1] DEBUG - Statement Id: [DAO00305_GetAllLoaiToaThuoc] PreparedStatement : [declare @LOAITOATHUOC varchar(200)        set @LOAITOATHUOC = (select top 1 LOAITOATHUOC = STUFF((SELECT ',' + LOAITOATHUOC FROM TM_TOATHUOC_NGOAITRU where BENHVIEN_ID = '01819' FOR XML PATH ('')), 1, 1, '')        from TM_TOATHUOC_NGOAITRU)        set @LOAITOATHUOC = '''' +  REPLACE(@LOAITOATHUOC,',',''',''') + ''''        select @LOAITOATHUOC as LOAITOATHUOC]
2020-07-16 15:59:51,922 [1] DEBUG - Statement Id: [DAO00040_LayListToaMau] PreparedStatement : [select A.*, dc.TENDUOCDAYDU, dc.BHYT DUOC_BHYT, ld.LOAIVATTU_ID, ld.MALOAIDUOC, dd.DICTIONARY_NAME DUONGDUNG, dc.TAMNGUNG            from TT_TOATHUOCMAU A            left join TM_DUOC dc on A.DUOC_ID = dc.DUOC_ID            left join TM_LOAIDUOC ld on dc.LOAIDUOC_ID = ld.LOAIDUOC_ID            left join (select * from LST_DICTIONARY where DICTIONARY_TYPE_CODE like 'DuongDung') dd on dd.DICTIONARY_ID = dc.DUONGDUNG_ID            where (1=1)             and               A.BACSI_ID  = 1             and               A.LOAITOATHUOC IN ('BV','MN','BV','KTBV','KTBV','BV')]
2020-07-16 15:59:51,973 [1] DEBUG - Statement Id: [DAO00305_GetAllLoaiToaThuoc] PreparedStatement : [declare @LOAITOATHUOC varchar(200)        set @LOAITOATHUOC = (select top 1 LOAITOATHUOC = STUFF((SELECT ',' + LOAITOATHUOC FROM TM_TOATHUOC_NGOAITRU where BENHVIEN_ID = '01819' FOR XML PATH ('')), 1, 1, '')        from TM_TOATHUOC_NGOAITRU)        set @LOAITOATHUOC = '''' +  REPLACE(@LOAITOATHUOC,',',''',''') + ''''        select @LOAITOATHUOC as LOAITOATHUOC]
2020-07-16 15:59:52,418 [1] DEBUG - Statement Id: [DAO00040_LayListToaMau] PreparedStatement : [select A.*, dc.TENDUOCDAYDU, dc.BHYT DUOC_BHYT, ld.LOAIVATTU_ID, ld.MALOAIDUOC, dd.DICTIONARY_NAME DUONGDUNG, dc.TAMNGUNG            from TT_TOATHUOCMAU A            left join TM_DUOC dc on A.DUOC_ID = dc.DUOC_ID            left join TM_LOAIDUOC ld on dc.LOAIDUOC_ID = ld.LOAIDUOC_ID            left join (select * from LST_DICTIONARY where DICTIONARY_TYPE_CODE like 'DuongDung') dd on dd.DICTIONARY_ID = dc.DUONGDUNG_ID            where (1=1)             and               A.BACSI_ID  = 1             and               A.LOAITOATHUOC IN ('BV','MN','BV','KTBV','KTBV','BV')]
2020-07-16 15:59:52,518 [1] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoVaBookingCOM23UpdateRedis_TheoPhamvi] PreparedStatement : [declare @TOAMUANGOAI int = 0;        select @TOAMUANGOAI = isnull(VALUE,0) from TM_SYS_APPSETTINGS where CODE = 'OPD_TOAMUANGOAI_DUNGDANHMUC_DUOC'                if @TOAMUANGOAI = 1        begin        select  distinct '0' + '_' + LTRIM(d.DUOC_ID) + '_' + '0' as DUOC_KEY, 999999999 as SOLUONG        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = '01819'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = '01819')        where  @param0  = 0        union all        select distinct tk.DUOC_KEY, tk.SOLUONG        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = '01819'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = '01819')        inner join        (        select  LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')) DUOC_KEY, (SUM(dtk.SOLUONG) - isnull(sum(A.SOLUONG),0) - isnull(sum(B.SOLUONG),0)) SOLUONG, pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        from (select sum(soluong) soluong,duoc_id,nguonduoc_id,khoduoc_id,benhvien_id from TT_DUOC_TONKHO  group by duoc_id,nguonduoc_id,khoduoc_id,benhvien_id) dtk        inner join TM_DUOC_PHAMVISD_MAPPING pvsd on dtk.KHODUOC_ID = pvsd.KHODUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NOITRU        where TRANGTHAI != 'HUY' and PHAMVI_ID =  @param0         group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) B on B.DUOC_ID = dtk.DUOC_ID and B.PHAMVI_ID = pvsd.PHAMVI_ID and B.NGUONHANG_ID = dtk.NGUONDUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NGOAITRU        where TRANGTHAI != 'HUY' and PHAMVI_ID =  @param0         group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) A on A.DUOC_ID = dtk.DUOC_ID and A.PHAMVI_ID = pvsd.PHAMVI_ID and A.NGUONHANG_ID = dtk.NGUONDUOC_ID        where dtk.BENHVIEN_ID = '01819'        group by LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')), pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        ) tk on tk.DUOC_ID = d.DUOC_ID        left join TM_DUOC_PHAMVISUDUNG kd on kd.PHAMVI_ID = tk.PHAMVI_ID and kd.BENHVIEN_ID = '01819'        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = tk.NGUONDUOC_ID and nh.BENHVIEN_ID = '01819'        where d.BENHVIEN_ID = '01819' and tk.PHAMVI_ID =  @param0         end        else        begin        select distinct tk.DUOC_KEY, tk.SOLUONG        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = '01819'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = '01819')        inner join        (        select  LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')) DUOC_KEY, (SUM(dtk.SOLUONG) - isnull(sum(A.SOLUONG),0) - isnull(sum(B.SOLUONG),0)) SOLUONG, pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        from (select sum(soluong) soluong,duoc_id,nguonduoc_id,khoduoc_id,benhvien_id from TT_DUOC_TONKHO        group by duoc_id,nguonduoc_id,khoduoc_id,benhvien_id) dtk        inner join TM_DUOC_PHAMVISD_MAPPING pvsd on dtk.KHODUOC_ID = pvsd.KHODUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NOITRU        where TRANGTHAI != 'HUY' and PHAMVI_ID =  @param0         group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) B on B.DUOC_ID = dtk.DUOC_ID and B.PHAMVI_ID = pvsd.PHAMVI_ID and B.NGUONHANG_ID = dtk.NGUONDUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NGOAITRU        where TRANGTHAI != 'HUY' and PHAMVI_ID =  @param0         group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) A on A.DUOC_ID = dtk.DUOC_ID and A.PHAMVI_ID = pvsd.PHAMVI_ID and A.NGUONHANG_ID = dtk.NGUONDUOC_ID        where dtk.BENHVIEN_ID = '01819'        group by LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')), pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        ) tk on tk.DUOC_ID = d.DUOC_ID        left join TM_DUOC_PHAMVISUDUNG kd on kd.PHAMVI_ID = tk.PHAMVI_ID and kd.BENHVIEN_ID = '01819'        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = tk.NGUONDUOC_ID and nh.BENHVIEN_ID = '01819'        where d.BENHVIEN_ID = '01819' and tk.PHAMVI_ID =  @param0         end]
2020-07-16 15:59:52,518 [1] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoVaBookingCOM23UpdateRedis_TheoPhamvi] Parameters: [@param0=[PHAMVI_ID,8]]
2020-07-16 15:59:52,518 [1] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoVaBookingCOM23UpdateRedis_TheoPhamvi] Types: [@param0=[Int64, System.Int64]]
2020-07-16 15:59:52,549 [1] DEBUG - Statement Id: [DAO00012_GetLoaiTCLS] PreparedStatement : [select DICTIONARY_ID, DICTIONARY_CODE, DICTIONARY_NAME, cast('0' as Bit) CHON        from LST_DICTIONARY              where DICTIONARY_TYPE_CODE = 'KHAMBENH_LOAI_TRIEUCHUNGLS'        order by LST_DICTIONARY.IDX]
2020-07-16 15:59:52,574 [1] DEBUG - Statement Id: [DAO00012_GetAllTCLS] PreparedStatement : [select MALOAITRIEUCHUNG DICTIONARY_TYPE_CODE, MALOAITRIEUCHUNG DICTIONARY_CODE,        TENTRIEUCHUNG DICTIONARY_NAME from TM_TRIEUCHUNGLS]
2020-07-16 15:59:52,644 [1] DEBUG - Statement Id: [DAO00305_GetListPhongBanKhoaNgoai] PreparedStatement : [select A.*, B.DICTIONARY_CODE from TM_PHONGBAN A        inner join LST_DICTIONARY B on A.LOAIPHONGBAN_ID = B.DICTIONARY_ID        and B.DICTIONARY_TYPE_CODE = 'LoaiPhongBan'        where A.TAMNGUNG = '0'        and B.DICTIONARY_CODE = 'KhoaNgoai'        order by A.TENPHONGBAN asc]
2020-07-16 15:59:54,473 [1] DEBUG - Statement Id: [DAO00403_QMS002_GetThongTinClient] PreparedStatement : [SELECT B.ID as QUEUE_ID, B.NAME AS QUEUE_NAME,A.ID AS CLIENT_ID , A.[NAME] AS CLIENT_NAME, ISNULL(A.[STATE],1) AS [STATE],(CASE C.NAME WHEN 'UT' THEN 1 ELSE 0 END) AS QUEUETYPE     , B.DEPARTMENT_ID,ISNULL(B.SECTION_ID,-1) AS SECTION_ID,A.IPSERVER,A.NAMEAUDIO,C.QUEUE_TYPE_CODE,C.QUEUE_TYPE_CODE_SOUND,S.[NAME] AS SECTIONNAME     FROM QMS_QUEUE B LEFT JOIN QMS_CLIENT A ON A.QUEUE_ID = B.ID     LEFT JOIN QMS_QUEUE_TYPE C ON B.QUEUETYPE_ID = C.ID     LEFT JOIN QMS_SECTION S ON B.SECTION_ID=S.ID     WHERE     (A.COMPUTERNAME = 'DESKTOP-89GE5BA' OR A.IPADDRESS = '10.15.167.38') AND A.[STATE] = 1 AND B.DEPARTMENT_ID='74'            AND B.BENHVIEN_ID = '01819']
2020-07-16 15:59:54,615 [1] DEBUG - Statement Id: [DAO00019_GetDanhsachKhambenh] PreparedStatement : [select *        from        (SELECT COUNT(*) OVER() as TOTALROWS, ROW_NUMBER() OVER(order by isnull(dv.SOTHUTU,'999999999'), dv.NGAYGIOYEUCAU) as ROWNUMBER,        bn.MAYTE, bn.TENBENHNHAN, bn.NAMSINH, bn.NGAYSINH as TUOI, ISNULL(CONVERT(VARCHAR(10), bn.NGAYSINH, 103),CAST(bn.NAMSINH AS varchar)) as NGAYSINH, bn.DIACHILIENLAC as DIACHI, bn.GIOITINH, GD.DESCRIPTION as TENGIOITINH,        tn.DOITUONG_ID, tn.THOIGIANTIEPNHAN, tn.BENHNHAN_ID, tn.TIEPNHAN_ID, tn.TRAITUYEN, tn.SOTIEPNHAN,        dv.DICHVU_ID, dv.NOITHUCHIEN_ID, isnull(dv.NGAYTAO, dv.NGAYCAPNHAT) as THOIGIANDKDICHVU,        dv.KHAN, dv.NOIYEUCAU_ID, dv.NGAYGIOYEUCAU, dv.BACSICHIDINH_ID, dv.DONVIGIOITHIEU_ID, dv.NGUOIGIOITHIEU_ID,        tn.NOIGIOITHIEU_ID, kbnt.HUONGGIAIQUYET_ID,        dv.DVYEUCAU_ID, dv.MARIS, dv.TRANGTHAI as TRANGTHAICODE, B.TENNHOMDICHVU, dv.SOPHIEUYEUCAU, dv.KHAMBENH_NGOAITRU_ID, dv.NGUOICAPNHAT_ID, dv.NGAYCAPNHAT,        CASE WHEN Left(B.MANHOMDICHVU,2) = '03' THEN '02' ELSE Left(B.MANHOMDICHVU,2) END AS MANHOMDICHVU, B.MANHOMDICHVU as MANHOMDICHVUCHITIET, tn.TRANGTHAI as TRANGTHAI_TIEPNHAN,        'False' as DAKHAM, isnull(dv.SOTHUTU,'999999999') as SOHANGDOI,        vp.DATHANHTOAN, dv.TRANGTHAI_WFL,        BA.SOBENHAN, dv.CHANDOAN, dt.TENDOITUONG, isnull(kbnt.THOIGIANKHAM, dv.NGAYCAPNHAT) as THOIGIANKHAM,        tn.SOBHYT          ,           tn.UUTIEN                 FROM TT_DVYEUCAU (NOLOCK) dv        inner join TT_TIEPNHAN (NOLOCK) tn on dv.TIEPNHAN_ID = tn.TIEPNHAN_ID        inner join TT_BENHNHAN (NOLOCK) bn on tn.BENHNHAN_ID = bn.BENHNHAN_ID        inner join TM_DICHVU A on A.DICHVU_ID = dv.DICHVU_ID        inner join TM_NHOMDICHVU B on B.NHOMDICHVU_ID = A.NHOMDICHVU_ID        inner join TT_VIENPHI(NOLOCK) VP on VP.TIEPNHAN_ID = tn.TIEPNHAN_ID and VP.DICHVU_ID = dv.DICHVU_ID and VP.REF_ID = dv.DVYEUCAU_ID        left join TT_NOITRU_BENHAN (NOLOCK) BA on BA.TIEPNHAN_ID = tn.TIEPNHAN_ID AND dv.BENHAN_ID = BA.BENHAN_ID        inner join TM_GENDER GD on GD.ID = bn.GIOITINH        left join TT_NGOAITRU_KHAMBENH (NOLOCK) kbnt on kbnt.KHAMBENH_ID = dv.KHAMBENH_NGOAITRU_ID        inner join TM_DOITUONG dt on dt.DOITUONG_ID = tn.DOITUONG_ID        where        dv.DICHVU_ID IS NOT NULL        and tn.BENHVIEN_ID = '01819'        and HUYYEUCAU = 0        and dv.NGAYHENCLS is NULL         and           dv.NGAYYEUCAU >= '7/16/2020 12:00:00 AM'         and           dv.NGAYYEUCAU <= '7/16/2020 12:00:00 AM'         and           dv.NOITHUCHIEN_ID = 74          AND             (                         ((dv.TRANGTHAI_WFL = 'CHUAKETQUA' or (dv.TRANGTHAI = 'CHUAKETQUA' and dv.TRANGTHAI_WFL = 'HOANTHANH')) and (isnull(kbnt.HUONGGIAIQUYET_ID, 0) = 0)))            and (tn.TRANGTHAI != 'HOANTHANH')           and           (CASE WHEN Left(B.MANHOMDICHVU,2) = '03' THEN '02' ELSE Left(B.MANHOMDICHVU,2) END) = '04'                 ) lst                    where          lst.ROWNUMBER between 1 and 19                 order by SOHANGDOI, NGAYGIOYEUCAU asc]
2020-07-16 15:59:55,629 [1] DEBUG - Statement Id: [DAO00017_GetLoaiGiaByDoiTuongId] PreparedStatement : [select dtlg.DOUUTIEN, dtlg.DOITUONG_ID, lg.LOAIGIA_ID, lg.TENLOAIGIA, lg.MALOAIGIA              from TM_LOAIGIA lg              left join TM_DOITUONG_LOAIGIA dtlg              on lg.LOAIGIA_ID = dtlg.LOAIGIA_ID and dtlg.BENHVIEN_ID = '01819'              where lg.TAMNGUNG = 0 and lg.BENHVIEN_ID = '01819'                             order by dtlg.DOUUTIEN]
2020-07-16 15:59:55,688 [1] DEBUG - Statement Id: [DAO00014_KiemTraDVYCCoGiaBHYT] PreparedStatement : [select *        from TT_VIENPHI        where REF_ID  = '' and REF_TABLE = 'TT_DVYEUCAU' and BHYT_DONGIA > 0]
2020-07-16 15:59:55,714 [1] DEBUG - Statement Id: [DAO00305_GetAllLoaiToaThuoc] PreparedStatement : [declare @LOAITOATHUOC varchar(200)        set @LOAITOATHUOC = (select top 1 LOAITOATHUOC = STUFF((SELECT ',' + LOAITOATHUOC FROM TM_TOATHUOC_NGOAITRU where BENHVIEN_ID = '01819' FOR XML PATH ('')), 1, 1, '')        from TM_TOATHUOC_NGOAITRU)        set @LOAITOATHUOC = '''' +  REPLACE(@LOAITOATHUOC,',',''',''') + ''''        select @LOAITOATHUOC as LOAITOATHUOC]
2020-07-16 15:59:55,783 [1] DEBUG - Statement Id: [DAO00040_LayListToaMau] PreparedStatement : [select A.*, dc.TENDUOCDAYDU, dc.BHYT DUOC_BHYT, ld.LOAIVATTU_ID, ld.MALOAIDUOC, dd.DICTIONARY_NAME DUONGDUNG, dc.TAMNGUNG            from TT_TOATHUOCMAU A            left join TM_DUOC dc on A.DUOC_ID = dc.DUOC_ID            left join TM_LOAIDUOC ld on dc.LOAIDUOC_ID = ld.LOAIDUOC_ID            left join (select * from LST_DICTIONARY where DICTIONARY_TYPE_CODE like 'DuongDung') dd on dd.DICTIONARY_ID = dc.DUONGDUNG_ID            where (1=1)             and               A.BACSI_ID  = 1             and               A.LOAITOATHUOC IN ('BV','MN','BV','KTBV','KTBV','BV')]
2020-07-16 15:59:55,832 [1] DEBUG - Statement Id: [DAO00305_GetAllLoaiToaThuoc] PreparedStatement : [declare @LOAITOATHUOC varchar(200)        set @LOAITOATHUOC = (select top 1 LOAITOATHUOC = STUFF((SELECT ',' + LOAITOATHUOC FROM TM_TOATHUOC_NGOAITRU where BENHVIEN_ID = '01819' FOR XML PATH ('')), 1, 1, '')        from TM_TOATHUOC_NGOAITRU)        set @LOAITOATHUOC = '''' +  REPLACE(@LOAITOATHUOC,',',''',''') + ''''        select @LOAITOATHUOC as LOAITOATHUOC]
2020-07-16 15:59:55,900 [1] DEBUG - Statement Id: [DAO00040_LayListToaMau] PreparedStatement : [select A.*, dc.TENDUOCDAYDU, dc.BHYT DUOC_BHYT, ld.LOAIVATTU_ID, ld.MALOAIDUOC, dd.DICTIONARY_NAME DUONGDUNG, dc.TAMNGUNG            from TT_TOATHUOCMAU A            left join TM_DUOC dc on A.DUOC_ID = dc.DUOC_ID            left join TM_LOAIDUOC ld on dc.LOAIDUOC_ID = ld.LOAIDUOC_ID            left join (select * from LST_DICTIONARY where DICTIONARY_TYPE_CODE like 'DuongDung') dd on dd.DICTIONARY_ID = dc.DUONGDUNG_ID            where (1=1)             and               A.BACSI_ID  = 1             and               A.LOAITOATHUOC IN ('BV','MN','BV','KTBV','KTBV','BV')]
2020-07-16 15:59:55,935 [1] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoVaBookingCOM23UpdateRedis_TheoPhamvi] PreparedStatement : [declare @TOAMUANGOAI int = 0;        select @TOAMUANGOAI = isnull(VALUE,0) from TM_SYS_APPSETTINGS where CODE = 'OPD_TOAMUANGOAI_DUNGDANHMUC_DUOC'                if @TOAMUANGOAI = 1        begin        select  distinct '0' + '_' + LTRIM(d.DUOC_ID) + '_' + '0' as DUOC_KEY, 999999999 as SOLUONG        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = '01819'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = '01819')        where  @param0  = 0        union all        select distinct tk.DUOC_KEY, tk.SOLUONG        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = '01819'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = '01819')        inner join        (        select  LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')) DUOC_KEY, (SUM(dtk.SOLUONG) - isnull(sum(A.SOLUONG),0) - isnull(sum(B.SOLUONG),0)) SOLUONG, pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        from (select sum(soluong) soluong,duoc_id,nguonduoc_id,khoduoc_id,benhvien_id from TT_DUOC_TONKHO  group by duoc_id,nguonduoc_id,khoduoc_id,benhvien_id) dtk        inner join TM_DUOC_PHAMVISD_MAPPING pvsd on dtk.KHODUOC_ID = pvsd.KHODUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NOITRU        where TRANGTHAI != 'HUY' and PHAMVI_ID =  @param0         group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) B on B.DUOC_ID = dtk.DUOC_ID and B.PHAMVI_ID = pvsd.PHAMVI_ID and B.NGUONHANG_ID = dtk.NGUONDUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NGOAITRU        where TRANGTHAI != 'HUY' and PHAMVI_ID =  @param0         group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) A on A.DUOC_ID = dtk.DUOC_ID and A.PHAMVI_ID = pvsd.PHAMVI_ID and A.NGUONHANG_ID = dtk.NGUONDUOC_ID        where dtk.BENHVIEN_ID = '01819'        group by LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')), pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        ) tk on tk.DUOC_ID = d.DUOC_ID        left join TM_DUOC_PHAMVISUDUNG kd on kd.PHAMVI_ID = tk.PHAMVI_ID and kd.BENHVIEN_ID = '01819'        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = tk.NGUONDUOC_ID and nh.BENHVIEN_ID = '01819'        where d.BENHVIEN_ID = '01819' and tk.PHAMVI_ID =  @param0         end        else        begin        select distinct tk.DUOC_KEY, tk.SOLUONG        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = '01819'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = '01819')        inner join        (        select  LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')) DUOC_KEY, (SUM(dtk.SOLUONG) - isnull(sum(A.SOLUONG),0) - isnull(sum(B.SOLUONG),0)) SOLUONG, pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        from (select sum(soluong) soluong,duoc_id,nguonduoc_id,khoduoc_id,benhvien_id from TT_DUOC_TONKHO        group by duoc_id,nguonduoc_id,khoduoc_id,benhvien_id) dtk        inner join TM_DUOC_PHAMVISD_MAPPING pvsd on dtk.KHODUOC_ID = pvsd.KHODUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NOITRU        where TRANGTHAI != 'HUY' and PHAMVI_ID =  @param0         group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) B on B.DUOC_ID = dtk.DUOC_ID and B.PHAMVI_ID = pvsd.PHAMVI_ID and B.NGUONHANG_ID = dtk.NGUONDUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NGOAITRU        where TRANGTHAI != 'HUY' and PHAMVI_ID =  @param0         group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) A on A.DUOC_ID = dtk.DUOC_ID and A.PHAMVI_ID = pvsd.PHAMVI_ID and A.NGUONHANG_ID = dtk.NGUONDUOC_ID        where dtk.BENHVIEN_ID = '01819'        group by LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')), pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        ) tk on tk.DUOC_ID = d.DUOC_ID        left join TM_DUOC_PHAMVISUDUNG kd on kd.PHAMVI_ID = tk.PHAMVI_ID and kd.BENHVIEN_ID = '01819'        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = tk.NGUONDUOC_ID and nh.BENHVIEN_ID = '01819'        where d.BENHVIEN_ID = '01819' and tk.PHAMVI_ID =  @param0         end]
2020-07-16 15:59:55,935 [1] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoVaBookingCOM23UpdateRedis_TheoPhamvi] Parameters: [@param0=[PHAMVI_ID,8]]
2020-07-16 15:59:55,935 [1] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoVaBookingCOM23UpdateRedis_TheoPhamvi] Types: [@param0=[Int64, System.Int64]]
2020-07-16 15:59:55,966 [1] DEBUG - Statement Id: [DAO00012_GetLoaiTCLS] PreparedStatement : [select DICTIONARY_ID, DICTIONARY_CODE, DICTIONARY_NAME, cast('0' as Bit) CHON        from LST_DICTIONARY              where DICTIONARY_TYPE_CODE = 'KHAMBENH_LOAI_TRIEUCHUNGLS'        order by LST_DICTIONARY.IDX]
2020-07-16 15:59:55,990 [1] DEBUG - Statement Id: [DAO00012_GetAllTCLS] PreparedStatement : [select MALOAITRIEUCHUNG DICTIONARY_TYPE_CODE, MALOAITRIEUCHUNG DICTIONARY_CODE,        TENTRIEUCHUNG DICTIONARY_NAME from TM_TRIEUCHUNGLS]
2020-07-16 15:59:56,015 [1] DEBUG - Statement Id: [DAO00019_ThongTinBenhNhanDvYeuCau] PreparedStatement : [select distinct A.SOTIEPNHAN, A.TIEPNHAN_ID, A.DOITUONG_ID, A.TRANGTHAI,        A.LOAITHANHVIEN_ID, A.SUDUNG_BHTN, A.THE_ID, A.THANHVIEN_ID, A.VIP, A.NGUON_BENHNHAN_ID, A.BAOLANH_VIENPHI, A.NGAYMIENDONGCHITRA,        B.*,  C.DICHVU_ID, C.DVYEUCAU_ID, C.NOITHUCHIEN_ID, A.SOBHYT        from TT_TIEPNHAN A        inner join TT_DVYEUCAU C on C.TIEPNHAN_ID = A.TIEPNHAN_ID        inner join TT_BENHNHAN B on B.BENHNHAN_ID = A.BENHNHAN_ID and B.ACTIVE = '1'        where                    C.DVYEUCAU_ID = '13144'                 and A.BENHVIEN_ID = '01819']
2020-07-16 15:59:56,121 [1] DEBUG - Statement Id: [DAO00017_GetLoaiGiaByDoiTuongId] PreparedStatement : [select dtlg.DOUUTIEN, dtlg.DOITUONG_ID, lg.LOAIGIA_ID, lg.TENLOAIGIA, lg.MALOAIGIA              from TM_LOAIGIA lg              left join TM_DOITUONG_LOAIGIA dtlg              on lg.LOAIGIA_ID = dtlg.LOAIGIA_ID and dtlg.BENHVIEN_ID = '01819'              where lg.TAMNGUNG = 0 and lg.BENHVIEN_ID = '01819'                             order by dtlg.DOUUTIEN]
2020-07-16 15:59:56,154 [1] DEBUG - Statement Id: [DAO00092_GetList_ToathuocNgoaitru] PreparedStatement : [select A.*, B.PHAMVI_ID, C.KHODUOC_ID from TM_TOATHUOC_NGOAITRU A        left join TM_DUOC_PHAMVISUDUNG B on B.MAPHAMVI = A.MAPHAMVI        left join (select distinct PHAMVI_ID, KHODUOC_ID from TM_DUOC_PHAMVISD_MAPPING) C on C.PHAMVI_ID = B.PHAMVI_ID        where A.TAMNGUNG != '1' and A.BENHVIEN_ID = '01819'        ORDER BY A.SAPXEP ASC]
2020-07-16 15:59:56,178 [1] DEBUG - Statement Id: [DAO00063_GetListDTPhamviToathuoc] PreparedStatement : [select B.*, C.KHODUOC_ID        from TM_PHAMVI_DOITUONG_TOATHUOC B        left join (select distinct PHAMVI_ID, KHODUOC_ID from TM_DUOC_PHAMVISD_MAPPING) C on C.PHAMVI_ID = B.PHAMVI_ID        where B.TAMNGUNG != '1' and B.DOITUONG_ID = '4']
2020-07-16 15:59:56,201 [1] DEBUG - Statement Id: [DAO00014_KiemTraDVYCCoGiaBHYT] PreparedStatement : [select *        from TT_VIENPHI        where REF_ID  = '13144' and REF_TABLE = 'TT_DVYEUCAU' and BHYT_DONGIA > 0]
2020-07-16 15:59:56,233 [1] DEBUG - Statement Id: [DAO00305_GetAllLoaiToaThuoc] PreparedStatement : [declare @LOAITOATHUOC varchar(200)        set @LOAITOATHUOC = (select top 1 LOAITOATHUOC = STUFF((SELECT ',' + LOAITOATHUOC FROM TM_TOATHUOC_NGOAITRU where BENHVIEN_ID = '01819' FOR XML PATH ('')), 1, 1, '')        from TM_TOATHUOC_NGOAITRU)        set @LOAITOATHUOC = '''' +  REPLACE(@LOAITOATHUOC,',',''',''') + ''''        select @LOAITOATHUOC as LOAITOATHUOC]
2020-07-16 15:59:56,302 [1] DEBUG - Statement Id: [DAO00040_LayListToaMau] PreparedStatement : [select A.*, dc.TENDUOCDAYDU, dc.BHYT DUOC_BHYT, ld.LOAIVATTU_ID, ld.MALOAIDUOC, dd.DICTIONARY_NAME DUONGDUNG, dc.TAMNGUNG            from TT_TOATHUOCMAU A            left join TM_DUOC dc on A.DUOC_ID = dc.DUOC_ID            left join TM_LOAIDUOC ld on dc.LOAIDUOC_ID = ld.LOAIDUOC_ID            left join (select * from LST_DICTIONARY where DICTIONARY_TYPE_CODE like 'DuongDung') dd on dd.DICTIONARY_ID = dc.DUONGDUNG_ID            where (1=1)             and               A.BACSI_ID  = 1             and               A.LOAITOATHUOC IN ('BV','MN','BV','KTBV','KTBV','BV')]
2020-07-16 15:59:56,356 [1] DEBUG - Statement Id: [DAO00305_GetAllLoaiToaThuoc] PreparedStatement : [declare @LOAITOATHUOC varchar(200)        set @LOAITOATHUOC = (select top 1 LOAITOATHUOC = STUFF((SELECT ',' + LOAITOATHUOC FROM TM_TOATHUOC_NGOAITRU where BENHVIEN_ID = '01819' FOR XML PATH ('')), 1, 1, '')        from TM_TOATHUOC_NGOAITRU)        set @LOAITOATHUOC = '''' +  REPLACE(@LOAITOATHUOC,',',''',''') + ''''        select @LOAITOATHUOC as LOAITOATHUOC]
2020-07-16 15:59:56,426 [1] DEBUG - Statement Id: [DAO00040_LayListToaMau] PreparedStatement : [select A.*, dc.TENDUOCDAYDU, dc.BHYT DUOC_BHYT, ld.LOAIVATTU_ID, ld.MALOAIDUOC, dd.DICTIONARY_NAME DUONGDUNG, dc.TAMNGUNG            from TT_TOATHUOCMAU A            left join TM_DUOC dc on A.DUOC_ID = dc.DUOC_ID            left join TM_LOAIDUOC ld on dc.LOAIDUOC_ID = ld.LOAIDUOC_ID            left join (select * from LST_DICTIONARY where DICTIONARY_TYPE_CODE like 'DuongDung') dd on dd.DICTIONARY_ID = dc.DUONGDUNG_ID            where (1=1)             and               A.BACSI_ID  = 1             and               A.LOAITOATHUOC IN ('BV','MN','BV','KTBV','KTBV','BV')]
2020-07-16 15:59:56,465 [1] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoVaBookingCOM23UpdateRedis_TheoPhamvi] PreparedStatement : [declare @TOAMUANGOAI int = 0;        select @TOAMUANGOAI = isnull(VALUE,0) from TM_SYS_APPSETTINGS where CODE = 'OPD_TOAMUANGOAI_DUNGDANHMUC_DUOC'                if @TOAMUANGOAI = 1        begin        select  distinct '0' + '_' + LTRIM(d.DUOC_ID) + '_' + '0' as DUOC_KEY, 999999999 as SOLUONG        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = '01819'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = '01819')        where  @param0  = 0        union all        select distinct tk.DUOC_KEY, tk.SOLUONG        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = '01819'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = '01819')        inner join        (        select  LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')) DUOC_KEY, (SUM(dtk.SOLUONG) - isnull(sum(A.SOLUONG),0) - isnull(sum(B.SOLUONG),0)) SOLUONG, pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        from (select sum(soluong) soluong,duoc_id,nguonduoc_id,khoduoc_id,benhvien_id from TT_DUOC_TONKHO  group by duoc_id,nguonduoc_id,khoduoc_id,benhvien_id) dtk        inner join TM_DUOC_PHAMVISD_MAPPING pvsd on dtk.KHODUOC_ID = pvsd.KHODUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NOITRU        where TRANGTHAI != 'HUY' and PHAMVI_ID =  @param0         group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) B on B.DUOC_ID = dtk.DUOC_ID and B.PHAMVI_ID = pvsd.PHAMVI_ID and B.NGUONHANG_ID = dtk.NGUONDUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NGOAITRU        where TRANGTHAI != 'HUY' and PHAMVI_ID =  @param0         group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) A on A.DUOC_ID = dtk.DUOC_ID and A.PHAMVI_ID = pvsd.PHAMVI_ID and A.NGUONHANG_ID = dtk.NGUONDUOC_ID        where dtk.BENHVIEN_ID = '01819'        group by LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')), pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        ) tk on tk.DUOC_ID = d.DUOC_ID        left join TM_DUOC_PHAMVISUDUNG kd on kd.PHAMVI_ID = tk.PHAMVI_ID and kd.BENHVIEN_ID = '01819'        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = tk.NGUONDUOC_ID and nh.BENHVIEN_ID = '01819'        where d.BENHVIEN_ID = '01819' and tk.PHAMVI_ID =  @param0         end        else        begin        select distinct tk.DUOC_KEY, tk.SOLUONG        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = '01819'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = '01819')        inner join        (        select  LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')) DUOC_KEY, (SUM(dtk.SOLUONG) - isnull(sum(A.SOLUONG),0) - isnull(sum(B.SOLUONG),0)) SOLUONG, pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        from (select sum(soluong) soluong,duoc_id,nguonduoc_id,khoduoc_id,benhvien_id from TT_DUOC_TONKHO        group by duoc_id,nguonduoc_id,khoduoc_id,benhvien_id) dtk        inner join TM_DUOC_PHAMVISD_MAPPING pvsd on dtk.KHODUOC_ID = pvsd.KHODUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NOITRU        where TRANGTHAI != 'HUY' and PHAMVI_ID =  @param0         group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) B on B.DUOC_ID = dtk.DUOC_ID and B.PHAMVI_ID = pvsd.PHAMVI_ID and B.NGUONHANG_ID = dtk.NGUONDUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NGOAITRU        where TRANGTHAI != 'HUY' and PHAMVI_ID =  @param0         group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) A on A.DUOC_ID = dtk.DUOC_ID and A.PHAMVI_ID = pvsd.PHAMVI_ID and A.NGUONHANG_ID = dtk.NGUONDUOC_ID        where dtk.BENHVIEN_ID = '01819'        group by LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')), pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        ) tk on tk.DUOC_ID = d.DUOC_ID        left join TM_DUOC_PHAMVISUDUNG kd on kd.PHAMVI_ID = tk.PHAMVI_ID and kd.BENHVIEN_ID = '01819'        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = tk.NGUONDUOC_ID and nh.BENHVIEN_ID = '01819'        where d.BENHVIEN_ID = '01819' and tk.PHAMVI_ID =  @param0         end]
2020-07-16 15:59:56,465 [1] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoVaBookingCOM23UpdateRedis_TheoPhamvi] Parameters: [@param0=[PHAMVI_ID,2]]
2020-07-16 15:59:56,465 [1] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoVaBookingCOM23UpdateRedis_TheoPhamvi] Types: [@param0=[Int64, System.Int64]]
2020-07-16 15:59:56,503 [1] DEBUG - Statement Id: [DAO00013_GetTienSuBenh] PreparedStatement : [select TIENSUBENH, TIENSUDIUNG        from TT_BENHNHAN        where TT_BENHNHAN.BENHNHAN_ID  = '8728']
2020-07-16 15:59:56,526 [1] DEBUG - Statement Id: [DAO00095_GetTTDiUngThuoc] PreparedStatement : [select *              from TT_BENHNHAN_DIUNG_THUOC              where BENHNHAN_ID = '8728'              and BENHVIEN_ID = '01819']
2020-07-16 15:59:56,549 [1] DEBUG - Statement Id: [DAO00014_GetTotalChiPhiDVByTiepNhan] PreparedStatement : [select sum(THANHTIEN_DOANHTHU) as THANHTIEN_DOANHTHU from TT_VIENPHI        where ACTIVE = '1'        and TIEPNHAN_ID = '8744'        and REF_TABLE = 'TT_DVYEUCAU'        and exists (select DVYEUCAU_ID from TT_DVYEUCAU where HUYYEUCAU = '0' and TIEPNHAN_ID = '8744' and TT_VIENPHI.REF_ID = DVYEUCAU_ID)]
2020-07-16 15:59:56,577 [1] DEBUG - Statement Id: [DAO00014_GetKhamBenhInfo] PreparedStatement : [select * from TT_NGOAITRU_KHAMBENH where KHAMBENH_ID =        (select KHAMBENH_NGOAITRU_ID from TT_DVYEUCAU where DVYEUCAU_ID = '13144')]
2020-07-16 15:59:56,601 [1] DEBUG - Statement Id: [DAO00014_GetSoCaKhamTrongNgay] PreparedStatement : [select Count(KB.KHAMBENH_ID) as SOCAKHAMTRONGNGAY        from TT_NGOAITRU_KHAMBENH KB        inner join TT_TIEPNHAN TN on TN.TIEPNHAN_ID = KB.TIEPNHAN_ID        where KB.NGAYKHAM = convert(date, GETDATE())        and KB.BACSIKHAM_ID = '1'        and KB.BENHVIEN_ID = '01819'        and TN.SOBHYT IS NOT NULL and TN.SOBHYT != '']
2020-07-16 15:59:56,648 [1] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoVaBookingCOM23UpdateRedis_TheoPhamvi] PreparedStatement : [declare @TOAMUANGOAI int = 0;        select @TOAMUANGOAI = isnull(VALUE,0) from TM_SYS_APPSETTINGS where CODE = 'OPD_TOAMUANGOAI_DUNGDANHMUC_DUOC'                if @TOAMUANGOAI = 1        begin        select  distinct '0' + '_' + LTRIM(d.DUOC_ID) + '_' + '0' as DUOC_KEY, 999999999 as SOLUONG        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = '01819'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = '01819')        where  @param0  = 0        union all        select distinct tk.DUOC_KEY, tk.SOLUONG        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = '01819'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = '01819')        inner join        (        select  LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')) DUOC_KEY, (SUM(dtk.SOLUONG) - isnull(sum(A.SOLUONG),0) - isnull(sum(B.SOLUONG),0)) SOLUONG, pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        from (select sum(soluong) soluong,duoc_id,nguonduoc_id,khoduoc_id,benhvien_id from TT_DUOC_TONKHO  group by duoc_id,nguonduoc_id,khoduoc_id,benhvien_id) dtk        inner join TM_DUOC_PHAMVISD_MAPPING pvsd on dtk.KHODUOC_ID = pvsd.KHODUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NOITRU        where TRANGTHAI != 'HUY' and PHAMVI_ID =  @param0         group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) B on B.DUOC_ID = dtk.DUOC_ID and B.PHAMVI_ID = pvsd.PHAMVI_ID and B.NGUONHANG_ID = dtk.NGUONDUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NGOAITRU        where TRANGTHAI != 'HUY' and PHAMVI_ID =  @param0         group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) A on A.DUOC_ID = dtk.DUOC_ID and A.PHAMVI_ID = pvsd.PHAMVI_ID and A.NGUONHANG_ID = dtk.NGUONDUOC_ID        where dtk.BENHVIEN_ID = '01819'        group by LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')), pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        ) tk on tk.DUOC_ID = d.DUOC_ID        left join TM_DUOC_PHAMVISUDUNG kd on kd.PHAMVI_ID = tk.PHAMVI_ID and kd.BENHVIEN_ID = '01819'        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = tk.NGUONDUOC_ID and nh.BENHVIEN_ID = '01819'        where d.BENHVIEN_ID = '01819' and tk.PHAMVI_ID =  @param0         end        else        begin        select distinct tk.DUOC_KEY, tk.SOLUONG        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = '01819'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = '01819')        inner join        (        select  LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')) DUOC_KEY, (SUM(dtk.SOLUONG) - isnull(sum(A.SOLUONG),0) - isnull(sum(B.SOLUONG),0)) SOLUONG, pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        from (select sum(soluong) soluong,duoc_id,nguonduoc_id,khoduoc_id,benhvien_id from TT_DUOC_TONKHO        group by duoc_id,nguonduoc_id,khoduoc_id,benhvien_id) dtk        inner join TM_DUOC_PHAMVISD_MAPPING pvsd on dtk.KHODUOC_ID = pvsd.KHODUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NOITRU        where TRANGTHAI != 'HUY' and PHAMVI_ID =  @param0         group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) B on B.DUOC_ID = dtk.DUOC_ID and B.PHAMVI_ID = pvsd.PHAMVI_ID and B.NGUONHANG_ID = dtk.NGUONDUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NGOAITRU        where TRANGTHAI != 'HUY' and PHAMVI_ID =  @param0         group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) A on A.DUOC_ID = dtk.DUOC_ID and A.PHAMVI_ID = pvsd.PHAMVI_ID and A.NGUONHANG_ID = dtk.NGUONDUOC_ID        where dtk.BENHVIEN_ID = '01819'        group by LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')), pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        ) tk on tk.DUOC_ID = d.DUOC_ID        left join TM_DUOC_PHAMVISUDUNG kd on kd.PHAMVI_ID = tk.PHAMVI_ID and kd.BENHVIEN_ID = '01819'        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = tk.NGUONDUOC_ID and nh.BENHVIEN_ID = '01819'        where d.BENHVIEN_ID = '01819' and tk.PHAMVI_ID =  @param0         end]
2020-07-16 15:59:56,648 [1] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoVaBookingCOM23UpdateRedis_TheoPhamvi] Parameters: [@param0=[PHAMVI_ID,2]]
2020-07-16 15:59:56,648 [1] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoVaBookingCOM23UpdateRedis_TheoPhamvi] Types: [@param0=[Int64, System.Int64]]
2020-07-16 15:59:56,759 [1] DEBUG - Statement Id: [DAO00019_ThongTinBenhNhanDvYeuCau] PreparedStatement : [select distinct A.SOTIEPNHAN, A.TIEPNHAN_ID, A.DOITUONG_ID, A.TRANGTHAI,        A.LOAITHANHVIEN_ID, A.SUDUNG_BHTN, A.THE_ID, A.THANHVIEN_ID, A.VIP, A.NGUON_BENHNHAN_ID, A.BAOLANH_VIENPHI, A.NGAYMIENDONGCHITRA,        B.*,  C.DICHVU_ID, C.DVYEUCAU_ID, C.NOITHUCHIEN_ID, A.SOBHYT        from TT_TIEPNHAN A        inner join TT_DVYEUCAU C on C.TIEPNHAN_ID = A.TIEPNHAN_ID        inner join TT_BENHNHAN B on B.BENHNHAN_ID = A.BENHNHAN_ID and B.ACTIVE = '1'        where                    C.DVYEUCAU_ID = '13144'                 and A.BENHVIEN_ID = '01819']
2020-07-16 15:59:56,837 [1] DEBUG - Statement Id: [DAO00017_GetLoaiGiaByDoiTuongId] PreparedStatement : [select dtlg.DOUUTIEN, dtlg.DOITUONG_ID, lg.LOAIGIA_ID, lg.TENLOAIGIA, lg.MALOAIGIA              from TM_LOAIGIA lg              left join TM_DOITUONG_LOAIGIA dtlg              on lg.LOAIGIA_ID = dtlg.LOAIGIA_ID and dtlg.BENHVIEN_ID = '01819'              where lg.TAMNGUNG = 0 and lg.BENHVIEN_ID = '01819'                             order by dtlg.DOUUTIEN]
2020-07-16 15:59:56,871 [1] DEBUG - Statement Id: [DAO00092_GetList_ToathuocNgoaitru] PreparedStatement : [select A.*, B.PHAMVI_ID, C.KHODUOC_ID from TM_TOATHUOC_NGOAITRU A        left join TM_DUOC_PHAMVISUDUNG B on B.MAPHAMVI = A.MAPHAMVI        left join (select distinct PHAMVI_ID, KHODUOC_ID from TM_DUOC_PHAMVISD_MAPPING) C on C.PHAMVI_ID = B.PHAMVI_ID        where A.TAMNGUNG != '1' and A.BENHVIEN_ID = '01819'        ORDER BY A.SAPXEP ASC]
2020-07-16 15:59:56,898 [1] DEBUG - Statement Id: [DAO00063_GetListDTPhamviToathuoc] PreparedStatement : [select B.*, C.KHODUOC_ID        from TM_PHAMVI_DOITUONG_TOATHUOC B        left join (select distinct PHAMVI_ID, KHODUOC_ID from TM_DUOC_PHAMVISD_MAPPING) C on C.PHAMVI_ID = B.PHAMVI_ID        where B.TAMNGUNG != '1' and B.DOITUONG_ID = '4']
2020-07-16 15:59:56,923 [1] DEBUG - Statement Id: [DAO00014_KiemTraDVYCCoGiaBHYT] PreparedStatement : [select *        from TT_VIENPHI        where REF_ID  = '13144' and REF_TABLE = 'TT_DVYEUCAU' and BHYT_DONGIA > 0]
2020-07-16 15:59:56,961 [1] DEBUG - Statement Id: [DAO00305_GetAllLoaiToaThuoc] PreparedStatement : [declare @LOAITOATHUOC varchar(200)        set @LOAITOATHUOC = (select top 1 LOAITOATHUOC = STUFF((SELECT ',' + LOAITOATHUOC FROM TM_TOATHUOC_NGOAITRU where BENHVIEN_ID = '01819' FOR XML PATH ('')), 1, 1, '')        from TM_TOATHUOC_NGOAITRU)        set @LOAITOATHUOC = '''' +  REPLACE(@LOAITOATHUOC,',',''',''') + ''''        select @LOAITOATHUOC as LOAITOATHUOC]
2020-07-16 15:59:57,030 [1] DEBUG - Statement Id: [DAO00040_LayListToaMau] PreparedStatement : [select A.*, dc.TENDUOCDAYDU, dc.BHYT DUOC_BHYT, ld.LOAIVATTU_ID, ld.MALOAIDUOC, dd.DICTIONARY_NAME DUONGDUNG, dc.TAMNGUNG            from TT_TOATHUOCMAU A            left join TM_DUOC dc on A.DUOC_ID = dc.DUOC_ID            left join TM_LOAIDUOC ld on dc.LOAIDUOC_ID = ld.LOAIDUOC_ID            left join (select * from LST_DICTIONARY where DICTIONARY_TYPE_CODE like 'DuongDung') dd on dd.DICTIONARY_ID = dc.DUONGDUNG_ID            where (1=1)             and               A.BACSI_ID  = 1             and               A.LOAITOATHUOC IN ('BV','MN','BV','KTBV','KTBV','BV')]
2020-07-16 15:59:57,088 [1] DEBUG - Statement Id: [DAO00305_GetAllLoaiToaThuoc] PreparedStatement : [declare @LOAITOATHUOC varchar(200)        set @LOAITOATHUOC = (select top 1 LOAITOATHUOC = STUFF((SELECT ',' + LOAITOATHUOC FROM TM_TOATHUOC_NGOAITRU where BENHVIEN_ID = '01819' FOR XML PATH ('')), 1, 1, '')        from TM_TOATHUOC_NGOAITRU)        set @LOAITOATHUOC = '''' +  REPLACE(@LOAITOATHUOC,',',''',''') + ''''        select @LOAITOATHUOC as LOAITOATHUOC]
2020-07-16 15:59:57,165 [1] DEBUG - Statement Id: [DAO00040_LayListToaMau] PreparedStatement : [select A.*, dc.TENDUOCDAYDU, dc.BHYT DUOC_BHYT, ld.LOAIVATTU_ID, ld.MALOAIDUOC, dd.DICTIONARY_NAME DUONGDUNG, dc.TAMNGUNG            from TT_TOATHUOCMAU A            left join TM_DUOC dc on A.DUOC_ID = dc.DUOC_ID            left join TM_LOAIDUOC ld on dc.LOAIDUOC_ID = ld.LOAIDUOC_ID            left join (select * from LST_DICTIONARY where DICTIONARY_TYPE_CODE like 'DuongDung') dd on dd.DICTIONARY_ID = dc.DUONGDUNG_ID            where (1=1)             and               A.BACSI_ID  = 1             and               A.LOAITOATHUOC IN ('BV','MN','BV','KTBV','KTBV','BV')]
2020-07-16 15:59:57,215 [1] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoVaBookingCOM23UpdateRedis_TheoPhamvi] PreparedStatement : [declare @TOAMUANGOAI int = 0;        select @TOAMUANGOAI = isnull(VALUE,0) from TM_SYS_APPSETTINGS where CODE = 'OPD_TOAMUANGOAI_DUNGDANHMUC_DUOC'                if @TOAMUANGOAI = 1        begin        select  distinct '0' + '_' + LTRIM(d.DUOC_ID) + '_' + '0' as DUOC_KEY, 999999999 as SOLUONG        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = '01819'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = '01819')        where  @param0  = 0        union all        select distinct tk.DUOC_KEY, tk.SOLUONG        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = '01819'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = '01819')        inner join        (        select  LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')) DUOC_KEY, (SUM(dtk.SOLUONG) - isnull(sum(A.SOLUONG),0) - isnull(sum(B.SOLUONG),0)) SOLUONG, pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        from (select sum(soluong) soluong,duoc_id,nguonduoc_id,khoduoc_id,benhvien_id from TT_DUOC_TONKHO  group by duoc_id,nguonduoc_id,khoduoc_id,benhvien_id) dtk        inner join TM_DUOC_PHAMVISD_MAPPING pvsd on dtk.KHODUOC_ID = pvsd.KHODUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NOITRU        where TRANGTHAI != 'HUY' and PHAMVI_ID =  @param0         group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) B on B.DUOC_ID = dtk.DUOC_ID and B.PHAMVI_ID = pvsd.PHAMVI_ID and B.NGUONHANG_ID = dtk.NGUONDUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NGOAITRU        where TRANGTHAI != 'HUY' and PHAMVI_ID =  @param0         group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) A on A.DUOC_ID = dtk.DUOC_ID and A.PHAMVI_ID = pvsd.PHAMVI_ID and A.NGUONHANG_ID = dtk.NGUONDUOC_ID        where dtk.BENHVIEN_ID = '01819'        group by LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')), pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        ) tk on tk.DUOC_ID = d.DUOC_ID        left join TM_DUOC_PHAMVISUDUNG kd on kd.PHAMVI_ID = tk.PHAMVI_ID and kd.BENHVIEN_ID = '01819'        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = tk.NGUONDUOC_ID and nh.BENHVIEN_ID = '01819'        where d.BENHVIEN_ID = '01819' and tk.PHAMVI_ID =  @param0         end        else        begin        select distinct tk.DUOC_KEY, tk.SOLUONG        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = '01819'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = '01819')        inner join        (        select  LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')) DUOC_KEY, (SUM(dtk.SOLUONG) - isnull(sum(A.SOLUONG),0) - isnull(sum(B.SOLUONG),0)) SOLUONG, pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        from (select sum(soluong) soluong,duoc_id,nguonduoc_id,khoduoc_id,benhvien_id from TT_DUOC_TONKHO        group by duoc_id,nguonduoc_id,khoduoc_id,benhvien_id) dtk        inner join TM_DUOC_PHAMVISD_MAPPING pvsd on dtk.KHODUOC_ID = pvsd.KHODUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NOITRU        where TRANGTHAI != 'HUY' and PHAMVI_ID =  @param0         group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) B on B.DUOC_ID = dtk.DUOC_ID and B.PHAMVI_ID = pvsd.PHAMVI_ID and B.NGUONHANG_ID = dtk.NGUONDUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NGOAITRU        where TRANGTHAI != 'HUY' and PHAMVI_ID =  @param0         group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) A on A.DUOC_ID = dtk.DUOC_ID and A.PHAMVI_ID = pvsd.PHAMVI_ID and A.NGUONHANG_ID = dtk.NGUONDUOC_ID        where dtk.BENHVIEN_ID = '01819'        group by LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')), pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        ) tk on tk.DUOC_ID = d.DUOC_ID        left join TM_DUOC_PHAMVISUDUNG kd on kd.PHAMVI_ID = tk.PHAMVI_ID and kd.BENHVIEN_ID = '01819'        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = tk.NGUONDUOC_ID and nh.BENHVIEN_ID = '01819'        where d.BENHVIEN_ID = '01819' and tk.PHAMVI_ID =  @param0         end]
2020-07-16 15:59:57,215 [1] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoVaBookingCOM23UpdateRedis_TheoPhamvi] Parameters: [@param0=[PHAMVI_ID,2]]
2020-07-16 15:59:57,215 [1] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoVaBookingCOM23UpdateRedis_TheoPhamvi] Types: [@param0=[Int64, System.Int64]]
2020-07-16 15:59:57,277 [1] DEBUG - Statement Id: [DAO00013_GetTienSuBenh] PreparedStatement : [select TIENSUBENH, TIENSUDIUNG        from TT_BENHNHAN        where TT_BENHNHAN.BENHNHAN_ID  = '8728']
2020-07-16 15:59:57,300 [1] DEBUG - Statement Id: [DAO00095_GetTTDiUngThuoc] PreparedStatement : [select *              from TT_BENHNHAN_DIUNG_THUOC              where BENHNHAN_ID = '8728'              and BENHVIEN_ID = '01819']
2020-07-16 15:59:57,324 [1] DEBUG - Statement Id: [DAO00014_GetTotalChiPhiDVByTiepNhan] PreparedStatement : [select sum(THANHTIEN_DOANHTHU) as THANHTIEN_DOANHTHU from TT_VIENPHI        where ACTIVE = '1'        and TIEPNHAN_ID = '8744'        and REF_TABLE = 'TT_DVYEUCAU'        and exists (select DVYEUCAU_ID from TT_DVYEUCAU where HUYYEUCAU = '0' and TIEPNHAN_ID = '8744' and TT_VIENPHI.REF_ID = DVYEUCAU_ID)]
2020-07-16 15:59:57,351 [1] DEBUG - Statement Id: [DAO00014_GetKhamBenhInfo] PreparedStatement : [select * from TT_NGOAITRU_KHAMBENH where KHAMBENH_ID =        (select KHAMBENH_NGOAITRU_ID from TT_DVYEUCAU where DVYEUCAU_ID = '13144')]
2020-07-16 15:59:57,375 [1] DEBUG - Statement Id: [DAO00014_GetSoCaKhamTrongNgay] PreparedStatement : [select Count(KB.KHAMBENH_ID) as SOCAKHAMTRONGNGAY        from TT_NGOAITRU_KHAMBENH KB        inner join TT_TIEPNHAN TN on TN.TIEPNHAN_ID = KB.TIEPNHAN_ID        where KB.NGAYKHAM = convert(date, GETDATE())        and KB.BACSIKHAM_ID = '1'        and KB.BENHVIEN_ID = '01819'        and TN.SOBHYT IS NOT NULL and TN.SOBHYT != '']
2020-07-16 15:59:57,424 [1] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoVaBookingCOM23UpdateRedis_TheoPhamvi] PreparedStatement : [declare @TOAMUANGOAI int = 0;        select @TOAMUANGOAI = isnull(VALUE,0) from TM_SYS_APPSETTINGS where CODE = 'OPD_TOAMUANGOAI_DUNGDANHMUC_DUOC'                if @TOAMUANGOAI = 1        begin        select  distinct '0' + '_' + LTRIM(d.DUOC_ID) + '_' + '0' as DUOC_KEY, 999999999 as SOLUONG        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = '01819'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = '01819')        where  @param0  = 0        union all        select distinct tk.DUOC_KEY, tk.SOLUONG        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = '01819'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = '01819')        inner join        (        select  LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')) DUOC_KEY, (SUM(dtk.SOLUONG) - isnull(sum(A.SOLUONG),0) - isnull(sum(B.SOLUONG),0)) SOLUONG, pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        from (select sum(soluong) soluong,duoc_id,nguonduoc_id,khoduoc_id,benhvien_id from TT_DUOC_TONKHO  group by duoc_id,nguonduoc_id,khoduoc_id,benhvien_id) dtk        inner join TM_DUOC_PHAMVISD_MAPPING pvsd on dtk.KHODUOC_ID = pvsd.KHODUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NOITRU        where TRANGTHAI != 'HUY' and PHAMVI_ID =  @param0         group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) B on B.DUOC_ID = dtk.DUOC_ID and B.PHAMVI_ID = pvsd.PHAMVI_ID and B.NGUONHANG_ID = dtk.NGUONDUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NGOAITRU        where TRANGTHAI != 'HUY' and PHAMVI_ID =  @param0         group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) A on A.DUOC_ID = dtk.DUOC_ID and A.PHAMVI_ID = pvsd.PHAMVI_ID and A.NGUONHANG_ID = dtk.NGUONDUOC_ID        where dtk.BENHVIEN_ID = '01819'        group by LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')), pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        ) tk on tk.DUOC_ID = d.DUOC_ID        left join TM_DUOC_PHAMVISUDUNG kd on kd.PHAMVI_ID = tk.PHAMVI_ID and kd.BENHVIEN_ID = '01819'        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = tk.NGUONDUOC_ID and nh.BENHVIEN_ID = '01819'        where d.BENHVIEN_ID = '01819' and tk.PHAMVI_ID =  @param0         end        else        begin        select distinct tk.DUOC_KEY, tk.SOLUONG        from TM_DUOC d        left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID        left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID        left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = '01819'        left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = '01819')        inner join        (        select  LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')) DUOC_KEY, (SUM(dtk.SOLUONG) - isnull(sum(A.SOLUONG),0) - isnull(sum(B.SOLUONG),0)) SOLUONG, pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        from (select sum(soluong) soluong,duoc_id,nguonduoc_id,khoduoc_id,benhvien_id from TT_DUOC_TONKHO        group by duoc_id,nguonduoc_id,khoduoc_id,benhvien_id) dtk        inner join TM_DUOC_PHAMVISD_MAPPING pvsd on dtk.KHODUOC_ID = pvsd.KHODUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NOITRU        where TRANGTHAI != 'HUY' and PHAMVI_ID =  @param0         group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) B on B.DUOC_ID = dtk.DUOC_ID and B.PHAMVI_ID = pvsd.PHAMVI_ID and B.NGUONHANG_ID = dtk.NGUONDUOC_ID        left join (select sum(SOLUONG) SOLUONG, PHAMVI_ID, DUOC_ID, NGUONHANG_ID from  TT_DUOC_TONKHO_BOOK_NGOAITRU        where TRANGTHAI != 'HUY' and PHAMVI_ID =  @param0         group by  PHAMVI_ID, DUOC_ID, NGUONHANG_ID) A on A.DUOC_ID = dtk.DUOC_ID and A.PHAMVI_ID = pvsd.PHAMVI_ID and A.NGUONHANG_ID = dtk.NGUONDUOC_ID        where dtk.BENHVIEN_ID = '01819'        group by LTRIM(pvsd.PHAMVI_ID)  + '_' + LTRIM(dtk.DUOC_ID) + '_' + LTRIM(ISNULL(dtk.NGUONDUOC_ID,'')), pvsd.PHAMVI_ID, dtk.NGUONDUOC_ID, dtk.DUOC_ID        ) tk on tk.DUOC_ID = d.DUOC_ID        left join TM_DUOC_PHAMVISUDUNG kd on kd.PHAMVI_ID = tk.PHAMVI_ID and kd.BENHVIEN_ID = '01819'        left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = tk.NGUONDUOC_ID and nh.BENHVIEN_ID = '01819'        where d.BENHVIEN_ID = '01819' and tk.PHAMVI_ID =  @param0         end]
2020-07-16 15:59:57,424 [1] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoVaBookingCOM23UpdateRedis_TheoPhamvi] Parameters: [@param0=[PHAMVI_ID,2]]
2020-07-16 15:59:57,424 [1] DEBUG - Statement Id: [DAO00027_GetListDuocTonKhoVaBookingCOM23UpdateRedis_TheoPhamvi] Types: [@param0=[Int64, System.Int64]]
2020-07-16 16:01:57,816 [1] DEBUG - Statement Id: [DAO00403_QMS002_GetThongTinClient] PreparedStatement : [SELECT B.ID as QUEUE_ID, B.NAME AS QUEUE_NAME,A.ID AS CLIENT_ID , A.[NAME] AS CLIENT_NAME, ISNULL(A.[STATE],1) AS [STATE],(CASE C.NAME WHEN 'UT' THEN 1 ELSE 0 END) AS QUEUETYPE     , B.DEPARTMENT_ID,ISNULL(B.SECTION_ID,-1) AS SECTION_ID,A.IPSERVER,A.NAMEAUDIO,C.QUEUE_TYPE_CODE,C.QUEUE_TYPE_CODE_SOUND,S.[NAME] AS SECTIONNAME     FROM QMS_QUEUE B LEFT JOIN QMS_CLIENT A ON A.QUEUE_ID = B.ID     LEFT JOIN QMS_QUEUE_TYPE C ON B.QUEUETYPE_ID = C.ID     LEFT JOIN QMS_SECTION S ON B.SECTION_ID=S.ID     WHERE     (A.COMPUTERNAME = 'DESKTOP-89GE5BA' OR A.IPADDRESS = '10.15.167.38') AND A.[STATE] = 1 AND B.DEPARTMENT_ID='74'            AND B.BENHVIEN_ID = '01819']
2020-07-16 16:01:57,872 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = '01819'               AND                   TM_SYS_SCREEN.PAGE = 'PHA34'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2020-07-16 16:01:57,996 [1] DEBUG - Statement Id: [DAO00030_GetDanhSachToaThuoc] PreparedStatement : [declare @tungay datetime = CONVERT(date, '7/16/2020 4:01:57 PM')            declare @denngay datetime = CONVERT(date, DATEADD(day, 1, '7/16/2020 4:01:57 PM'))                        select * from            (select * , COUNT(*) OVER() as TOTALROWS,  ROW_NUMBER() OVER(order by ds.CHUNGTU_ID asc) as ROWNUMBER            from            (            SELECT distinct CT.CHUNGTU_ID, CT.TIEPNHAN_ID,KB.DICHVU_ID,YC.DVYEUCAU_ID , KBTT.BACSI_ID,KBTT.KHAMBENH_TOATHUOC_ID   ,BN.TENBENHNHAN,BN.BENHNHAN_ID            ,BN.MAYTE,BN.NAMSINH,BN.GIOITINH AS GIOITINH_ID,TN.SOTIEPNHAN,ISNULL(CT.DAXACNHAN,'0') DAXACNHAN,CONVERT(nvarchar(10), KBTT.NGAYTOATHUOC, 103) NGAYTOATHUOC,            tn.SOBHYT, TN.NGAYTIEPNHAN, CT.NGAYCHUNGTU, ttnt.TENTOATHUOC, pb.TENPHONGBAN            FROM TT_DUOC_CHUNGTU CT            INNER JOIN TT_NGOAITRU_KHAMBENH_TOATHUOC KBTT ON (CT.CHUNGTU_ID =KBTT.CHUNGTUPHATTHUOC_ID AND KBTT.LOAITOATHUOC = 'BV')            INNER JOIN TT_NGOAITRU_TOATHUOC TT ON KBTT.KHAMBENH_TOATHUOC_ID = TT.KHAMBENH_TOATHUOC_ID            INNER JOIN TT_TIEPNHAN TN ON CT.TIEPNHAN_ID =TN.TIEPNHAN_ID            INNER JOIN TT_BENHNHAN BN ON TN.BENHNHAN_ID =BN.BENHNHAN_ID            INNER JOIN TT_XACNHANCHIPHI xncp ON xncp.TIEPNHAN_ID =TN.TIEPNHAN_ID            LEFT JOIN TT_NGOAITRU_KHAMBENH KB ON TT.KHAMBENH_ID=KB.KHAMBENH_ID            LEFT JOIN TT_DVYEUCAU YC ON KB.KHAMBENH_ID =YC.KHAMBENH_NGOAITRU_ID            left join TM_TOATHUOC_NGOAITRU ttnt on ttnt.MATOATHUOC = KBTT.MATOATHUOC            left join TM_PHONGBAN pb on pb.PHONGBAN_ID = KB.PHONGBAN_ID             where                           isnull(CT.DAXACNHAN,'0') = '0'                       and                         xncp.NGAYXACNHAN >= @tungay                       and                         xncp.NGAYXACNHAN < @denngay                       and                           CT.BENHVIEN_ID = '01819'                                                   AND Ct.KHOXUAT_ID = ''                                     ) ds            ) ls                            where              ls.ROWNUMBER between 1 and 19]
2020-07-16 16:04:05,960 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = '01819'               AND                   TM_SYS_SCREEN.PAGE = 'COM31'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2020-07-16 16:04:06,053 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = '01819'               AND                   TM_SYS_SCREEN.PAGE = 'NUT03'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2020-07-16 16:04:06,120 [1] DEBUG - Statement Id: [DAO00103_GetList] PreparedStatement : [SELECT BENH_ID, MABENH, TENBENH, GHICHU        FROM [dbo].[TM_NUT_BENH]         WHERE BENHVIEN_ID = '01819']
2020-07-16 16:04:06,172 [1] DEBUG - Statement Id: [DAO00102_GetList] PreparedStatement : [SELECT        kP.KHAUPHANAN_ID,        kP.MAKHAUPHANAN,        kP.TENKHAUPHANAN,        LKP.LOAIKHAUPHANAN_ID,        LKP.MALOAIKHAUPHANAN,        LKP.TENLOAIKHAUPHANAN,        DG.DONGIA,        kP.HANGMUC_ID        FROM TM_NUT_KHAUPHANAN kP        INNER JOIN TM_NUT_LOAIKHAUPHANAN LKP ON  kP.LOAIKHAUPHANAN_ID = LKP.LOAIKHAUPHANAN_ID        INNER JOIN TM_NUT_KHAUPHANAN_DONGIA DG ON DG.KHAUPHANAN_ID = kP.KHAUPHANAN_ID        WHERE  kP.TAMNGUNG = '0' AND DG.DONGIA IS NOT NULL]
2020-07-16 16:04:06,219 [1] DEBUG - Statement Id: [DAO00104_GetList] PreparedStatement : [SELECT CALORIE_ID, MACALORIE, TENCALORIE     FROM [dbo].[TM_NUT_CALORIE]         WHERE BENHVIEN_ID = '01819']
2020-07-16 16:04:06,321 [1] DEBUG - Statement Id: [DAO00101_GetBuoiAn] PreparedStatement : [SELECT [BUOIAN_ID],[MABUOIAN],[TENBUOIAN],[TUGIO],[DENGIO],[GIOTONGHOP]        FROM  TM_NUT_BUOIAN        WHERE BENHVIEN_ID = '01819' AND LOAI = '1']
2020-07-16 16:04:06,365 [1] DEBUG - Statement Id: [DAO00101_GetBuoiAn] PreparedStatement : [SELECT [BUOIAN_ID],[MABUOIAN],[TENBUOIAN],[TUGIO],[DENGIO],[GIOTONGHOP]        FROM  TM_NUT_BUOIAN        WHERE BENHVIEN_ID = '01819' AND LOAI = '0']
2020-07-16 16:04:06,470 [1] DEBUG - Statement Id: [DAO00101_GetBuoiAn] PreparedStatement : [SELECT [BUOIAN_ID],[MABUOIAN],[TENBUOIAN],[TUGIO],[DENGIO],[GIOTONGHOP]        FROM  TM_NUT_BUOIAN        WHERE BENHVIEN_ID = '01819' AND LOAI = '0']
2020-07-16 16:04:11,444 [1] DEBUG - Statement Id: [DAO00101_GetFirstHangMucBuoiAn] PreparedStatement : [select TOP 1 DICTIONARY_CODE        from LST_DICTIONARY        where DICTIONARY_ID = '8557' and BENHVIEN_ID='01819']
2020-07-16 16:04:11,475 [1] DEBUG - Statement Id: [DAO00101_GetFirstHangMucBuoiAn] PreparedStatement : [select TOP 1 DICTIONARY_CODE        from LST_DICTIONARY        where DICTIONARY_ID = '8557' and BENHVIEN_ID='01819']
2020-07-16 16:04:18,069 [1] DEBUG - Statement Id: [DAO00101_GetBuoiAn] PreparedStatement : [SELECT [BUOIAN_ID],[MABUOIAN],[TENBUOIAN],[TUGIO],[DENGIO],[GIOTONGHOP]        FROM  TM_NUT_BUOIAN        WHERE BENHVIEN_ID = '01819' AND LOAI = '0']
2020-07-16 16:05:39,348 [1] DEBUG - Statement Id: [DAO00101_GetBuoiAn] PreparedStatement : [SELECT [BUOIAN_ID],[MABUOIAN],[TENBUOIAN],[TUGIO],[DENGIO],[GIOTONGHOP]        FROM  TM_NUT_BUOIAN        WHERE BENHVIEN_ID = '01819' AND LOAI = '0']
2020-07-16 16:05:47,349 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = '01819'               AND                   TM_SYS_SCREEN.PAGE = 'BBM02'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2020-07-16 16:05:47,513 [1] DEBUG - Statement Id: [DAO00323_GetList] PreparedStatement : [select *              from TM_NGUONMAU              where              TAMNGUNG = '0'              and BENHVIEN_ID = '01819']
2020-07-16 16:05:47,615 [1] DEBUG - Statement Id: [DAO00324_GetList] PreparedStatement : [SELECT *,KHO_ID KHONHAP_ID,KHO_ID AS KHOXUAT_ID,KHO_ID AS KHOMAU_ID FROM TM_KHO WHERE KHOQUANLY_ID=1 AND TAMNGUNG = '0'            and BENHVIEN_ID = '01819'            order by TENKHO]
2020-07-16 16:05:47,653 [1] DEBUG - Statement Id: [DAO00319_GetList] PreparedStatement : [select *              from TM_NHACUNGCAP_MAU              where              TAMNGUNG = '0'              and BENHVIEN_ID = '01819'                          order by TENNHACUNGCAP]
2020-07-16 16:06:08,204 [1] DEBUG - Statement Id: [DAO00322_GetGiaNhapMauGanNhat] PreparedStatement : [SELECT TOP 1 DONGIAMUA        FROM        TT_MAU_CHUNGTU_SOLONHAP        WHERE        MAU_ID = '2'        and BENHVIEN_ID = '01819'        ORDER BY SOLONHAP_ID DESC]
2020-07-16 16:06:14,951 [1] DEBUG - Statement Id: [DAO00322_GetSoKiemSoat] PreparedStatement : [select CHUNGTUCHITIET_ID, CHUNGTU_ID, MAU_ID, TENMAU, SOLONHAP_ID, SOKIEMSOAT        from TT_MAU_CHUNGTU_CHITIET        where BENHVIEN_ID = '01819'         and           SOKIEMSOAT='23']
2020-07-16 16:06:15,000 [1] DEBUG - Statement Id: [DAO00322_GetGiaNhapMauGanNhat] PreparedStatement : [SELECT TOP 1 DONGIAMUA        FROM        TT_MAU_CHUNGTU_SOLONHAP        WHERE        MAU_ID = ''        and BENHVIEN_ID = '01819'        ORDER BY SOLONHAP_ID DESC]
2020-07-16 16:11:14,667 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = '01819'               AND                   TM_SYS_SCREEN.PAGE = 'UTL03'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2020-07-16 16:11:14,761 [1] DEBUG - Statement Id: [DAO00095_GetlistCacheDynamic] PreparedStatement : [select * from TM_SYS_CACHE          where TYPE = '2' and ACTIVE = '1' and HOSPITAL_ID = '01819'          order by ID]
2020-07-16 16:11:31,644 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = '01819'               AND                   TM_SYS_SCREEN.PAGE = 'HIX20'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2020-07-16 16:11:31,981 [1] DEBUG - Statement Id: [DAO09820_GetListAll] PreparedStatement : [select distinct X.ID, X.BENHVIEN_ID, X.BENHNHAN_ID, X.TIEPNHAN_ID, X.SOTHE, BN.TENBENHNHAN, pb.TENPHONGBAN        , CASE WHEN X.LOAIBANGKE = 'BangKe01' then N'Bảng kê 01'        WHEN X.LOAIBANGKE = 'BangKe02' then N'Bảng kê 02'        ELSE N'' END AS LOAIBANGKE        , xn.thoigianxacnhan AS NGAYXACNHAN        , X.THOIGIANBATDAU, X.THOIGIANKETTHUC        , CASE WHEN X.TRANGTHAI = 'CHOXULY' THEN N'Chờ xử lý'        WHEN X.TRANGTHAI = 'LOIDULIEU' THEN N'Lỗi dữ liệu'        WHEN X.TRANGTHAI = 'CHOUPLOAD' THEN N'Đã xuất'        WHEN X.TRANGTHAI = 'UPLOADTHANHCONG' THEN N'Upload thành công'        WHEN X.TRANGTHAI = 'UPLOADTHATBAI' THEN N'Upload thất bại'        WHEN X.TRANGTHAI = 'CHOXUATLAI' THEN N'Chờ xuất lại'        ELSE NULL END AS TRANGTHAI        , X.LYDO, X.SOLANRETRY, X.TENFILE, X.XUATLAI, BN.MAYTE, BA.SOBENHAN, X.XUATLAI AS XUATLAI_ORG, X.VALID_MSG, X.LOAIBANGKE AS LOAIBANGKE_CODE, BA.BENHAN_ID        , TN.THOIGIANTIEPNHAN AS NGAYVAO        , CASE WHEN X.LOAIBANGKE = 'BangKe01' THEN XN.THOIGIANXACNHAN        ELSE BA.THOIGIANRAVIEN        END AS NGAYRA        from TM_SYS_UPLOAD_BHYT_XML X        left join TT_BENHNHAN BN on BN.BENHNHAN_ID = X.BENHNHAN_ID and X.BENHVIEN_ID = BN.BENHVIEN_ID        left join TT_NOITRU_BENHAN BA on BA.TIEPNHAN_ID = X.TIEPNHAN_ID and BA.BENHVIEN_ID = X.BENHVIEN_ID        left join TM_PHONGBAN pb on pb.PHONGBAN_ID = isnull(ba.KHOACHUYENDEN_ID, ba.KHOAVAO_ID)        left join tt_xacnhanchiphi xn on x.tiepnhan_id = xn.tiepnhan_id        left join TT_TIEPNHAN TN ON TN.TIEPNHAN_ID = X.TIEPNHAN_ID          WHERE ((CAST( @param0  AS BIT) = 1 AND X.LOAIBANGKE = 'BangKe02') OR CAST( @param1  AS BIT) = 1 AND X.LOAIBANGKE = 'BangKe01')        and xn.xacnhanchiphi_id is not null        AND X.BENHVIEN_ID = '01819'        AND XN.XACNHANCHIPHI_ID IS NOT NULL           AND                 CAST(XN.thoigianxacnhan AS DATE) BETWEEN CAST('7/16/2020 12:00:00 AM' AS DATE) AND CAST('7/16/2020 12:00:00 AM' AS DATE)                   ORDER BY X.THOIGIANBATDAU DESC]
2020-07-16 16:11:31,981 [1] DEBUG - Statement Id: [DAO09820_GetListAll] Parameters: [@param0=[ISNOITRU,True], @param1=[ISNGOAITRU,True]]
2020-07-16 16:11:31,981 [1] DEBUG - Statement Id: [DAO09820_GetListAll] Types: [@param0=[Boolean, System.Boolean], @param1=[Boolean, System.Boolean]]
2020-07-16 16:11:34,141 [1] DEBUG - Statement Id: [DAO09820_GetListAll] PreparedStatement : [select distinct X.ID, X.BENHVIEN_ID, X.BENHNHAN_ID, X.TIEPNHAN_ID, X.SOTHE, BN.TENBENHNHAN, pb.TENPHONGBAN        , CASE WHEN X.LOAIBANGKE = 'BangKe01' then N'Bảng kê 01'        WHEN X.LOAIBANGKE = 'BangKe02' then N'Bảng kê 02'        ELSE N'' END AS LOAIBANGKE        , xn.thoigianxacnhan AS NGAYXACNHAN        , X.THOIGIANBATDAU, X.THOIGIANKETTHUC        , CASE WHEN X.TRANGTHAI = 'CHOXULY' THEN N'Chờ xử lý'        WHEN X.TRANGTHAI = 'LOIDULIEU' THEN N'Lỗi dữ liệu'        WHEN X.TRANGTHAI = 'CHOUPLOAD' THEN N'Đã xuất'        WHEN X.TRANGTHAI = 'UPLOADTHANHCONG' THEN N'Upload thành công'        WHEN X.TRANGTHAI = 'UPLOADTHATBAI' THEN N'Upload thất bại'        WHEN X.TRANGTHAI = 'CHOXUATLAI' THEN N'Chờ xuất lại'        ELSE NULL END AS TRANGTHAI        , X.LYDO, X.SOLANRETRY, X.TENFILE, X.XUATLAI, BN.MAYTE, BA.SOBENHAN, X.XUATLAI AS XUATLAI_ORG, X.VALID_MSG, X.LOAIBANGKE AS LOAIBANGKE_CODE, BA.BENHAN_ID        , TN.THOIGIANTIEPNHAN AS NGAYVAO        , CASE WHEN X.LOAIBANGKE = 'BangKe01' THEN XN.THOIGIANXACNHAN        ELSE BA.THOIGIANRAVIEN        END AS NGAYRA        from TM_SYS_UPLOAD_BHYT_XML X        left join TT_BENHNHAN BN on BN.BENHNHAN_ID = X.BENHNHAN_ID and X.BENHVIEN_ID = BN.BENHVIEN_ID        left join TT_NOITRU_BENHAN BA on BA.TIEPNHAN_ID = X.TIEPNHAN_ID and BA.BENHVIEN_ID = X.BENHVIEN_ID        left join TM_PHONGBAN pb on pb.PHONGBAN_ID = isnull(ba.KHOACHUYENDEN_ID, ba.KHOAVAO_ID)        left join tt_xacnhanchiphi xn on x.tiepnhan_id = xn.tiepnhan_id        left join TT_TIEPNHAN TN ON TN.TIEPNHAN_ID = X.TIEPNHAN_ID          WHERE ((CAST( @param0  AS BIT) = 1 AND X.LOAIBANGKE = 'BangKe02') OR CAST( @param1  AS BIT) = 1 AND X.LOAIBANGKE = 'BangKe01')        and xn.xacnhanchiphi_id is not null        AND X.BENHVIEN_ID = '01819'        AND XN.XACNHANCHIPHI_ID IS NOT NULL           AND                 CAST(XN.thoigianxacnhan AS DATE) BETWEEN CAST('7/16/2020 12:00:00 AM' AS DATE) AND CAST('7/16/2020 12:00:00 AM' AS DATE)                   ORDER BY X.THOIGIANBATDAU DESC]
2020-07-16 16:11:34,141 [1] DEBUG - Statement Id: [DAO09820_GetListAll] Parameters: [@param0=[ISNOITRU,True], @param1=[ISNGOAITRU,True]]
2020-07-16 16:11:34,141 [1] DEBUG - Statement Id: [DAO09820_GetListAll] Types: [@param0=[Boolean, System.Boolean], @param1=[Boolean, System.Boolean]]
2020-07-16 16:11:41,391 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = '01819'               AND                   TM_SYS_SCREEN.PAGE = 'ADM13'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2020-07-16 16:12:05,322 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = '01819'               AND                   TM_SYS_SCREEN.PAGE = 'APT01'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2020-07-16 16:14:21,382 [1] DEBUG - Statement Id: [DAO00017_GetDanhSachNoiThucHien] PreparedStatement : [select pb.PHONGBAN_ID, pb.TENPHONGBAN              from [TM_PHONGBAN] as pb              left join LST_DICTIONARY dic on pb.LOAIPHONGBAN_ID = dic.DICTIONARY_ID              where pb.BENHVIEN_ID = '01819'                          and dic.DICTIONARY_TYPE_CODE = 'LoaiPhongBan'            and dic.DICTIONARY_CODE in ('KhamBenh','PhongBenh','KhoaNoi','PhongMo','KhoaDuoc','KhoaCLS', 'KhoaNgoai')]
2020-07-16 16:14:21,439 [1] DEBUG - Statement Id: [DAO00012_GetList] PreparedStatement : [select        DICTIONARY_ID,        DICTIONARY_CODE,        DICTIONARY_NAME,        ATTRIBUTE1,        ATTRIBUTE2,        DICTIONARY_NAME_EN,        DICTIONARY_TYPE_CODE        from LST_DICTIONARY        where LST_DICTIONARY.Enabled = '1'         AND           LST_DICTIONARY.DICTIONARY_TYPE_CODE = 'NguonBN'                 order by LST_DICTIONARY.IDX]
2020-07-16 16:14:28,606 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = '01819'               AND                   TM_SYS_SCREEN.PAGE = 'EMR04'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2020-07-16 16:14:28,933 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = '01819'               AND                   TM_SYS_SCREEN.PAGE = 'EMR05'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2020-07-16 16:14:29,206 [1] DEBUG - Statement Id: [DAO00217_GetEmployeeAll] PreparedStatement : [select * from TM_NHANVIEN]
2020-07-16 16:14:29,281 [1] DEBUG - Statement Id: [DAO00217_GetDepartmentAll] PreparedStatement : [select * from TM_PHONGBAN]
2020-07-16 16:14:29,392 [1] DEBUG - Statement Id: [DAO00045_GetList] PreparedStatement : [SELECT            TM_DICHVU.DICHVU_ID, TM_NHOMDICHVU.NHOMDICHVU_ID, TM_NHOMDICHVU.MANHOMDICHVU, TM_DICHVU.MADICHVU, TM_NHOMDICHVU.TENNHOMDICHVU,            TM_NHOMDICHVU.TENNHOMDICHVU_EN, TM_NHOMDICHVU.TENNHOMDICHVU_RU, TM_NHOMDICHVU.CAP, TM_NHOMDICHVU.CAPTREN_ID, TM_DICHVU.TENDICHVU,            TM_DICHVU.BENHVIEN_ID, TM_DICHVU.CHONHETCAPDUOI, TM_DICHVU.CAPTREN_ID AS DICHVU_CAPTREN_ID            FROM            TM_DICHVU            INNER JOIN            TM_NHOMDICHVU ON TM_DICHVU.NHOMDICHVU_ID = TM_NHOMDICHVU.NHOMDICHVU_ID AND TM_DICHVU.BENHVIEN_ID = TM_NHOMDICHVU.BENHVIEN_ID            where left(MANHOMDICHVU,2) in ('01')            and TM_DICHVU.BENHVIEN_ID = '01819']
2020-07-16 16:14:29,704 [1] DEBUG - Statement Id: [DAO00013_GetTTBenhNhanByMaYTe] PreparedStatement : [select *        from TT_BENHNHAN        where MAYTE  = '']
2020-07-16 16:14:29,758 [1] DEBUG - Statement Id: [DAO00014_GetTTinKhamBenhByBenhNhanID] PreparedStatement : [select KB.*, TN.SOBHYT, DT.TENDOITUONG, nv.TENNHANVIEN        from TT_NGOAITRU_KHAMBENH KB        inner join TT_TIEPNHAN TN ON TN.TIEPNHAN_ID = KB.TIEPNHAN_ID        inner join TM_DOITUONG DT ON DT.DOITUONG_ID = TN.DOITUONG_ID        left join TM_NHANVIEN nv on nv.NHANVIEN_ID = KB.BACSIKHAM_ID        where KB.BENHNHAN_ID  =  @param0         and KB.BENHVIEN_ID = '01819'                    and KB.NGAYKHAM >= '1/16/2020 12:00:00 AM'                  and KB.NGAYKHAM <= '7/16/2020 12:00:00 AM'               order by KB.THOIGIANKHAM desc]
2020-07-16 16:14:29,758 [1] DEBUG - Statement Id: [DAO00014_GetTTinKhamBenhByBenhNhanID] Parameters: [@param0=[BENHNHAN_ID,null]]
2020-07-16 16:14:29,758 [1] DEBUG - Statement Id: [DAO00014_GetTTinKhamBenhByBenhNhanID] Types: [@param0=[System.DBNull, null]]
2020-07-16 16:14:29,855 [1] DEBUG - Statement Id: [DAO00013_GetTTBenhNhanByMaYTe] PreparedStatement : [select *        from TT_BENHNHAN        where MAYTE  = '']
2020-07-16 16:14:29,902 [1] DEBUG - Statement Id: [DAO00014_GetTTinKhamBenhByBenhNhanID] PreparedStatement : [select KB.*, TN.SOBHYT, DT.TENDOITUONG, nv.TENNHANVIEN        from TT_NGOAITRU_KHAMBENH KB        inner join TT_TIEPNHAN TN ON TN.TIEPNHAN_ID = KB.TIEPNHAN_ID        inner join TM_DOITUONG DT ON DT.DOITUONG_ID = TN.DOITUONG_ID        left join TM_NHANVIEN nv on nv.NHANVIEN_ID = KB.BACSIKHAM_ID        where KB.BENHNHAN_ID  =  @param0         and KB.BENHVIEN_ID = '01819'                    and KB.NGAYKHAM >= '1/16/2020 12:00:00 AM'                  and KB.NGAYKHAM <= '7/16/2020 12:00:00 AM'               order by KB.THOIGIANKHAM desc]
2020-07-16 16:14:29,902 [1] DEBUG - Statement Id: [DAO00014_GetTTinKhamBenhByBenhNhanID] Parameters: [@param0=[BENHNHAN_ID,null]]
2020-07-16 16:14:29,902 [1] DEBUG - Statement Id: [DAO00014_GetTTinKhamBenhByBenhNhanID] Types: [@param0=[System.DBNull, null]]
2020-07-16 16:14:30,063 [1] DEBUG - Statement Id: [DAO00013_GetTTBenhNhanByMaYTe] PreparedStatement : [select *        from TT_BENHNHAN        where MAYTE  = '']
2020-07-16 16:14:30,110 [1] DEBUG - Statement Id: [DAO00014_GetTTinKhamBenhByBenhNhanID] PreparedStatement : [select KB.*, TN.SOBHYT, DT.TENDOITUONG, nv.TENNHANVIEN        from TT_NGOAITRU_KHAMBENH KB        inner join TT_TIEPNHAN TN ON TN.TIEPNHAN_ID = KB.TIEPNHAN_ID        inner join TM_DOITUONG DT ON DT.DOITUONG_ID = TN.DOITUONG_ID        left join TM_NHANVIEN nv on nv.NHANVIEN_ID = KB.BACSIKHAM_ID        where KB.BENHNHAN_ID  =  @param0         and KB.BENHVIEN_ID = '01819'                    and KB.NGAYKHAM >= '1/16/2020 12:00:00 AM'                  and KB.NGAYKHAM <= '7/16/2020 12:00:00 AM'               order by KB.THOIGIANKHAM desc]
2020-07-16 16:14:30,110 [1] DEBUG - Statement Id: [DAO00014_GetTTinKhamBenhByBenhNhanID] Parameters: [@param0=[BENHNHAN_ID,null]]
2020-07-16 16:14:30,110 [1] DEBUG - Statement Id: [DAO00014_GetTTinKhamBenhByBenhNhanID] Types: [@param0=[System.DBNull, null]]
2020-07-16 16:14:36,732 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = '01819'               AND                   TM_SYS_SCREEN.PAGE = 'EMR06'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2020-07-16 16:14:37,121 [1] DEBUG - Statement Id: [DAO00217_GetEmployeeAll] PreparedStatement : [select * from TM_NHANVIEN]
2020-07-16 16:14:37,198 [1] DEBUG - Statement Id: [DAO00217_GetDepartmentAll] PreparedStatement : [select * from TM_PHONGBAN]
2020-07-16 16:14:57,893 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = '01819'               AND                   TM_SYS_SCREEN.PAGE = 'OPD05'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2020-07-16 16:15:15,311 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = '01819'               AND                   TM_SYS_SCREEN.PAGE = 'ADM04'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2020-07-16 16:15:16,020 [1] DEBUG - Statement Id: [DAO00208_GetList] PreparedStatement : [SELECT NAME FROM Sys.Tables              WHERE NAME NOT IN              (              SELECT DICTIONARY_CODE              FROM LST_DICTIONARY              WHERE DICTIONARY_TYPE_ID = '2361' AND ENABLED = '1'              )              ORDER BY NAME]
2020-07-16 16:15:16,579 [1] DEBUG - Statement Id: [DAO00208_GetFolderHierarchy] PreparedStatement : [WITH CategoryRec AS              (              SELECT 0 AS CATEGORY_ID, NULL AS PARENT_ID, CONVERT(nvarchar(100),'ROOT') AS CATEGORY_CODE              , CONVERT(nvarchar(250),'ROOT') AS CATEGORY_NAME, 0 AS [LEVEL]              UNION ALL              SELECT c.CATEGORY_ID, c.PARENT_ID, c.CATEGORY_CODE, c.CATEGORY_NAME, cr.[LEVEL] + 1              FROM CategoryRec AS cr              INNER JOIN dbo.TM_CATEGORY AS c ON cr.CATEGORY_ID = c.PARENT_ID AND c.CATEGORY_ID != 0              WHERE c.PARENT_ID IS NOT NULL AND c.IS_FOLDER = '1'              )              SELECT DISTINCT CATEGORY_ID, PARENT_ID, CATEGORY_CODE, CATEGORY_NAME, [LEVEL]              FROM  CategoryRec]
2020-07-16 16:15:16,629 [1] DEBUG - Statement Id: [DAO00205_GetAllWithCodeAndParentID] PreparedStatement : [SELECT C.CATEGORY_ID AS CATEGORY_ID, ISNULL(C.PARENT_ID,0) AS PARENT_ID, C.CATEGORY_CODE, C.CATEGORY_NAME AS CATEGORY_NAME, C.FOLDER_LEVEL, C.IS_FOLDER, C.FOLDER_CODE, C.CATEGORY_TYPE              FROM TM_CATEGORY AS C              WHERE C.CATEGORY_ID != 0 AND C.BENHVIEN_ID = '01819'              ORDER BY C.CATEGORY_ID]
2020-07-16 16:15:16,742 [1] DEBUG - Statement Id: [DAO00205_GetDetail] PreparedStatement : [select *              from TM_CATEGORY              where TM_CATEGORY.CATEGORY_ID  = '10'              order by CATEGORY_ID]
2020-07-16 16:15:16,790 [1] DEBUG - Statement Id: [DAO00206_GetList] PreparedStatement : [select *              from TM_CATEGORY_DETAIL               where                             TM_CATEGORY_DETAIL.CATEGORY_ID = '10'                       and                           TM_CATEGORY_DETAIL.BENHVIEN_ID = '01819'                                     order by FIELD_INDEX]
2020-07-16 16:20:29,070 [1] DEBUG - Statement Id: [DAO00205_GetDetail] PreparedStatement : [select *              from TM_CATEGORY              where TM_CATEGORY.CATEGORY_ID  = '64'              order by CATEGORY_ID]
2020-07-16 16:20:29,213 [1] DEBUG - Statement Id: [DAO00206_GetList] PreparedStatement : [select *              from TM_CATEGORY_DETAIL               where                             TM_CATEGORY_DETAIL.CATEGORY_ID = '64'                       and                           TM_CATEGORY_DETAIL.BENHVIEN_ID = '01819'                                     order by FIELD_INDEX]
2020-07-16 16:20:29,996 [1] DEBUG - Statement Id: [DAO00205_GetDetail] PreparedStatement : [select *              from TM_CATEGORY              where TM_CATEGORY.CATEGORY_ID  = '263'              order by CATEGORY_ID]
2020-07-16 16:20:30,044 [1] DEBUG - Statement Id: [DAO00206_GetList] PreparedStatement : [select *              from TM_CATEGORY_DETAIL               where                             TM_CATEGORY_DETAIL.CATEGORY_ID = '263'                       and                           TM_CATEGORY_DETAIL.BENHVIEN_ID = '01819'                                     order by FIELD_INDEX]
2020-07-16 16:20:50,457 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = '01819'               AND                   TM_SYS_SCREEN.PAGE = 'MRA60'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2020-07-16 16:20:50,836 [1] DEBUG - Statement Id: [DAO00093_GetDanhSachHoSoBenhAn] PreparedStatement : [SELECT A.HOSO_ID, A.MABENHAN, A.MABENHNHAN, A.TENBENHNHAN, A.NAMSINH, F.DESCRIPTION AS GENDER,        A.SOLUUTRU, A.TRANGTHAILUUTRU_ID, E.DICTIONARY_NAME AS TRANGTHAILUUTRU, C.TENPHONGBAN,        A.CHANDOAN, A.LOAIBENHAN_ID, convert(date,A.NGAYVAOVIEN) NGAYVAOVIEN, convert(date,A.NGAYRAVIEN) NGAYRAVIEN, CT.LYDOVAOVIEN AS LYDONHAPVIEN_ID, L.DICTIONARY_NAME AS TENLOAIBENHAN        FROM TT_BENHAN_LUUTRU A        LEFT JOIN TT_NOITRU_BENHAN B ON B.BENHAN_ID = A.BENHAN_ID        LEFT JOIN TT_NOITRU_BENHAN_CHITIET CT ON CT.BENHAN_ID = B.BENHAN_ID        LEFT JOIN TM_PHONGBAN C ON C.PHONGBAN_ID = A.PHONGBAN_ID        LEFT JOIN TM_GENDER F ON F.ID = A.GIOITINH        LEFT JOIN LST_DICTIONARY E ON E.DICTIONARY_ID = A.TRANGTHAILUUTRU_ID        LEFT JOIN LST_DICTIONARY L ON L.DICTIONARY_ID = A.LOAIBENHAN_ID        where E.DICTIONARY_CODE = 'NhapKho'                 ORDER BY A.NGAYRAVIEN DESC]
2020-07-16 16:20:55,883 [1] DEBUG - Statement Id: [DAO00012_GetList] PreparedStatement : [select        DICTIONARY_ID,        DICTIONARY_CODE,        DICTIONARY_NAME,        ATTRIBUTE1,        ATTRIBUTE2,        DICTIONARY_NAME_EN,        DICTIONARY_TYPE_CODE        from LST_DICTIONARY        where LST_DICTIONARY.Enabled = '1'         AND           LST_DICTIONARY.DICTIONARY_TYPE_CODE in ('TinhTrangGiaDinh', 'TrinhDoVanHoa')                 order by LST_DICTIONARY.IDX]
2020-07-16 16:22:26,510 [1] DEBUG - Statement Id: [DAO00200_GetListWithoutPhieu] PreparedStatement : [SELECT R.REPORT_ID AS REPORT_ID, ISNULL(RS.REPORT_ID,0) AS PARENT_ID, R.REPORT_CODE, R.REPORT_NAME, R.FOLDER_LEVEL, R.IS_FOLDER, R.FOLDER_CODE              , RS.REPORT_CODE AS PARENT_CODE              FROM TM_REPORT AS R              LEFT JOIN TM_REPORT_SUB_DEFINITION AS RS ON R.REPORT_CODE = RS.SUB_REPORT_CODE AND RS.BENHVIEN_ID = R.BENHVIEN_ID              LEFT JOIN TM_REPORT AS R2 ON R2.REPORT_CODE = RS.REPORT_CODE AND R2.BENHVIEN_ID = RS.BENHVIEN_ID              WHERE R.REPORT_ID != 0 AND R.IS_PHIEU != '1' AND R.ENABLED = '1' AND R.BENHVIEN_ID = '01819'              AND (RS.REPORT_ID IS NULL OR R2.IS_FOLDER = '1')              ORDER BY R.REPORT_NAME]
2020-07-16 16:22:26,700 [1] DEBUG - Statement Id: [DAO00200_GetDetail] PreparedStatement : [select *              from TM_REPORT              where TM_REPORT.REPORT_CODE  = 'REG' AND TM_REPORT.BENHVIEN_ID = '01819']
2020-07-16 16:22:26,726 [1] DEBUG - Statement Id: [DAO00201_GetList] PreparedStatement : [select *              from TM_REPORT_DETAIL               where                             TM_REPORT_DETAIL.REPORT_CODE = 'REG'                       and                           TM_REPORT_DETAIL.BENHVIEN_ID = '01819'                                     order by PARAMETER_INDEX]
2020-07-16 16:22:26,756 [1] DEBUG - Statement Id: [DAO00203_GetList] PreparedStatement : [select *              from TM_REPORT_SUB_DEFINITION               where                             TM_REPORT_SUB_DEFINITION.REPORT_CODE = 'REG'                       and                           TM_REPORT_SUB_DEFINITION.BENHVIEN_ID = '01819'                                     order by REPORT_SUB_DEFINITION_ID]
2020-07-16 16:22:26,780 [1] DEBUG - Statement Id: [DAO00201_GetListByParentReportID] PreparedStatement : [select RD.*              from TM_REPORT AS R              INNER JOIN TM_REPORT_SUB_DEFINITION AS RS ON R.REPORT_CODE = RS.REPORT_CODE AND R.BENHVIEN_ID = RS.BENHVIEN_ID              INNER JOIN TM_REPORT_DETAIL AS RD ON RD.REPORT_CODE = RS.SUB_REPORT_CODE AND RD.BENHVIEN_ID = RS.BENHVIEN_ID              where R.REPORT_CODE  = 'REG' AND R.BENHVIEN_ID = '01819']
2020-07-16 16:22:26,939 [1] DEBUG - Statement Id: [DAO00212_GetDataGroup] PreparedStatement : [select *        from TM_DATAGROUP]
2020-07-16 16:22:28,333 [1] DEBUG - Statement Id: [DAO00200_GetDetail] PreparedStatement : [select *              from TM_REPORT              where TM_REPORT.REPORT_CODE  = 'EME' AND TM_REPORT.BENHVIEN_ID = '01819']
2020-07-16 16:22:28,358 [1] DEBUG - Statement Id: [DAO00201_GetList] PreparedStatement : [select *              from TM_REPORT_DETAIL               where                             TM_REPORT_DETAIL.REPORT_CODE = 'EME'                       and                           TM_REPORT_DETAIL.BENHVIEN_ID = '01819'                                     order by PARAMETER_INDEX]
2020-07-16 16:22:28,388 [1] DEBUG - Statement Id: [DAO00203_GetList] PreparedStatement : [select *              from TM_REPORT_SUB_DEFINITION               where                             TM_REPORT_SUB_DEFINITION.REPORT_CODE = 'EME'                       and                           TM_REPORT_SUB_DEFINITION.BENHVIEN_ID = '01819'                                     order by REPORT_SUB_DEFINITION_ID]
2020-07-16 16:22:28,411 [1] DEBUG - Statement Id: [DAO00201_GetListByParentReportID] PreparedStatement : [select RD.*              from TM_REPORT AS R              INNER JOIN TM_REPORT_SUB_DEFINITION AS RS ON R.REPORT_CODE = RS.REPORT_CODE AND R.BENHVIEN_ID = RS.BENHVIEN_ID              INNER JOIN TM_REPORT_DETAIL AS RD ON RD.REPORT_CODE = RS.SUB_REPORT_CODE AND RD.BENHVIEN_ID = RS.BENHVIEN_ID              where R.REPORT_CODE  = 'EME' AND R.BENHVIEN_ID = '01819']
2020-07-16 16:22:30,221 [1] DEBUG - Statement Id: [DAO00200_GetDetail] PreparedStatement : [select *              from TM_REPORT              where TM_REPORT.REPORT_CODE  = 'EME00B00301' AND TM_REPORT.BENHVIEN_ID = '01819']
2020-07-16 16:22:30,247 [1] DEBUG - Statement Id: [DAO00201_GetList] PreparedStatement : [select *              from TM_REPORT_DETAIL               where                             TM_REPORT_DETAIL.REPORT_CODE = 'EME00B00301'                       and                           TM_REPORT_DETAIL.BENHVIEN_ID = '01819'                                     order by PARAMETER_INDEX]
2020-07-16 16:22:30,301 [1] DEBUG - Statement Id: [DAO00203_GetList] PreparedStatement : [select *              from TM_REPORT_SUB_DEFINITION               where                             TM_REPORT_SUB_DEFINITION.REPORT_CODE = 'EME00B00301'                       and                           TM_REPORT_SUB_DEFINITION.BENHVIEN_ID = '01819'                                     order by REPORT_SUB_DEFINITION_ID]
2020-07-16 16:22:30,328 [1] DEBUG - Statement Id: [DAO00201_GetListByParentReportID] PreparedStatement : [select RD.*              from TM_REPORT AS R              INNER JOIN TM_REPORT_SUB_DEFINITION AS RS ON R.REPORT_CODE = RS.REPORT_CODE AND R.BENHVIEN_ID = RS.BENHVIEN_ID              INNER JOIN TM_REPORT_DETAIL AS RD ON RD.REPORT_CODE = RS.SUB_REPORT_CODE AND RD.BENHVIEN_ID = RS.BENHVIEN_ID              where R.REPORT_CODE  = 'EME00B00301' AND R.BENHVIEN_ID = '01819']
2020-07-16 16:22:30,469 [1] DEBUG - Statement Id: [DAO00012_GetList] PreparedStatement : [select        DICTIONARY_ID,        DICTIONARY_CODE,        DICTIONARY_NAME,        ATTRIBUTE1,        ATTRIBUTE2,        DICTIONARY_NAME_EN,        DICTIONARY_TYPE_CODE        from LST_DICTIONARY        where LST_DICTIONARY.Enabled = '1'         AND           LST_DICTIONARY.DICTIONARY_TYPE_CODE = 'DM_Report_Parameter_Auto'                 order by LST_DICTIONARY.IDX]
2020-07-16 16:22:47,180 [1] DEBUG - Statement Id: [DAO00002_ScreenList] PreparedStatement : [select TM_SYS_SCREEN.*                             from TM_SYS_SCREEN                             where TM_SYS_SCREEN.HOSPITAL_ID = '01819'               AND                   TM_SYS_SCREEN.PAGE = 'RPT06'                             order by TM_SYS_SCREEN.ID, TM_SYS_SCREEN.PARENTNAME, TM_SYS_SCREEN.TABINDEX]
2020-07-16 16:22:47,305 [1] DEBUG - Statement Id: [DAO00203_GetListReportSubFileByReportID] PreparedStatement : [select R.*              from TM_REPORT_SUB_DEFINITION AS RS              inner join TM_REPORT AS R ON RS.SUB_REPORT_CODE = R.REPORT_CODE AND R.BENHVIEN_ID = RS.BENHVIEN_ID              where RS.REPORT_CODE = 'EME00B00301' AND RS.BENHVIEN_ID = '01819']
2020-07-16 16:22:47,358 [1] DEBUG - Statement Id: [DAO00218_GetListParameter] PreparedStatement : [SELECT SUBSTRING(p.name, 2, LEN(p.name) - 1) AS PARAMETER, p.parameter_id AS Idx, CONVERT(varchar(1),p.is_nullable) as Allow_Null              FROM sys.procedures sp              INNER JOIN sys.parameters p ON sp.object_id = p.object_id              WHERE sp.name = 'EME00B00301_CKCC'              ORDER BY p.parameter_id]
2020-07-16 16:22:47,398 [1] DEBUG - Statement Id: [DAO00218_GetReportData] PreparedStatement : [EME00B00301_CKCC]
2020-07-16 16:22:47,398 [1] DEBUG - Statement Id: [DAO00218_GetReportData] Parameters: [@TUNGAY=[PARAMETERS.TUNGAY,7/16/2020 12:00:00 AM], @DENNGAY=[PARAMETERS.DENNGAY,7/16/2020 12:00:00 AM], @MABENHVIEN=[PARAMETERS.MABENHVIEN,01819]]
2020-07-16 16:22:47,398 [1] DEBUG - Statement Id: [DAO00218_GetReportData] Types: [@TUNGAY=[DateTime, System.DateTime], @DENNGAY=[DateTime, System.DateTime], @MABENHVIEN=[String, System.String]]
2020-07-16 16:22:50,053 [1] DEBUG - Statement Id: [DAO00200_GetDetail] PreparedStatement : [select *              from TM_REPORT              where TM_REPORT.REPORT_CODE  = 'EME00B00401' AND TM_REPORT.BENHVIEN_ID = '01819']
2020-07-16 16:22:50,079 [1] DEBUG - Statement Id: [DAO00201_GetList] PreparedStatement : [select *              from TM_REPORT_DETAIL               where                             TM_REPORT_DETAIL.REPORT_CODE = 'EME00B00401'                       and                           TM_REPORT_DETAIL.BENHVIEN_ID = '01819'                                     order by PARAMETER_INDEX]
2020-07-16 16:22:50,109 [1] DEBUG - Statement Id: [DAO00203_GetList] PreparedStatement : [select *              from TM_REPORT_SUB_DEFINITION               where                             TM_REPORT_SUB_DEFINITION.REPORT_CODE = 'EME00B00401'                       and                           TM_REPORT_SUB_DEFINITION.BENHVIEN_ID = '01819'                                     order by REPORT_SUB_DEFINITION_ID]
2020-07-16 16:22:50,132 [1] DEBUG - Statement Id: [DAO00201_GetListByParentReportID] PreparedStatement : [select RD.*              from TM_REPORT AS R              INNER JOIN TM_REPORT_SUB_DEFINITION AS RS ON R.REPORT_CODE = RS.REPORT_CODE AND R.BENHVIEN_ID = RS.BENHVIEN_ID              INNER JOIN TM_REPORT_DETAIL AS RD ON RD.REPORT_CODE = RS.SUB_REPORT_CODE AND RD.BENHVIEN_ID = RS.BENHVIEN_ID              where R.REPORT_CODE  = 'EME00B00401' AND R.BENHVIEN_ID = '01819']
2020-07-16 16:22:54,620 [1] DEBUG - Statement Id: [DAO00203_GetListReportSubFileByReportID] PreparedStatement : [select R.*              from TM_REPORT_SUB_DEFINITION AS RS              inner join TM_REPORT AS R ON RS.SUB_REPORT_CODE = R.REPORT_CODE AND R.BENHVIEN_ID = RS.BENHVIEN_ID              where RS.REPORT_CODE = 'EME00B00401' AND RS.BENHVIEN_ID = '01819']
2020-07-16 16:22:54,677 [1] DEBUG - Statement Id: [DAO00218_GetListParameter] PreparedStatement : [SELECT SUBSTRING(p.name, 2, LEN(p.name) - 1) AS PARAMETER, p.parameter_id AS Idx, CONVERT(varchar(1),p.is_nullable) as Allow_Null              FROM sys.procedures sp              INNER JOIN sys.parameters p ON sp.object_id = p.object_id              WHERE sp.name = 'EME00B00401_BNTNTT'              ORDER BY p.parameter_id]
2020-07-16 16:22:54,726 [1] DEBUG - Statement Id: [DAO00218_GetReportData] PreparedStatement : [EME00B00401_BNTNTT]
2020-07-16 16:22:54,726 [1] DEBUG - Statement Id: [DAO00218_GetReportData] Parameters: [@TUNGAY=[PARAMETERS.TUNGAY,7/16/2020 12:00:00 AM], @DENNGAY=[PARAMETERS.DENNGAY,7/16/2020 12:00:00 AM], @MABENHVIEN=[PARAMETERS.MABENHVIEN,01819]]
2020-07-16 16:22:54,726 [1] DEBUG - Statement Id: [DAO00218_GetReportData] Types: [@TUNGAY=[DateTime, System.DateTime], @DENNGAY=[DateTime, System.DateTime], @MABENHVIEN=[String, System.String]]
2020-07-16 16:23:03,661 [1] DEBUG - Statement Id: [DAO00200_GetDetail] PreparedStatement : [select *              from TM_REPORT              where TM_REPORT.REPORT_CODE  = 'EME00B00101' AND TM_REPORT.BENHVIEN_ID = '01819']
2020-07-16 16:23:03,693 [1] DEBUG - Statement Id: [DAO00201_GetList] PreparedStatement : [select *              from TM_REPORT_DETAIL               where                             TM_REPORT_DETAIL.REPORT_CODE = 'EME00B00101'                       and                           TM_REPORT_DETAIL.BENHVIEN_ID = '01819'                                     order by PARAMETER_INDEX]
2020-07-16 16:23:03,723 [1] DEBUG - Statement Id: [DAO00203_GetList] PreparedStatement : [select *              from TM_REPORT_SUB_DEFINITION               where                             TM_REPORT_SUB_DEFINITION.REPORT_CODE = 'EME00B00101'                       and                           TM_REPORT_SUB_DEFINITION.BENHVIEN_ID = '01819'                                     order by REPORT_SUB_DEFINITION_ID]
2020-07-16 16:23:03,747 [1] DEBUG - Statement Id: [DAO00201_GetListByParentReportID] PreparedStatement : [select RD.*              from TM_REPORT AS R              INNER JOIN TM_REPORT_SUB_DEFINITION AS RS ON R.REPORT_CODE = RS.REPORT_CODE AND R.BENHVIEN_ID = RS.BENHVIEN_ID              INNER JOIN TM_REPORT_DETAIL AS RD ON RD.REPORT_CODE = RS.SUB_REPORT_CODE AND RD.BENHVIEN_ID = RS.BENHVIEN_ID              where R.REPORT_CODE  = 'EME00B00101' AND R.BENHVIEN_ID = '01819']
2020-07-16 16:23:04,138 [1] DEBUG - Statement Id: [DAO00200_GetDetail] PreparedStatement : [select *              from TM_REPORT              where TM_REPORT.REPORT_CODE  = 'EME00B00201' AND TM_REPORT.BENHVIEN_ID = '01819']
2020-07-16 16:23:04,181 [1] DEBUG - Statement Id: [DAO00201_GetList] PreparedStatement : [select *              from TM_REPORT_DETAIL               where                             TM_REPORT_DETAIL.REPORT_CODE = 'EME00B00201'                       and                           TM_REPORT_DETAIL.BENHVIEN_ID = '01819'                                     order by PARAMETER_INDEX]
2020-07-16 16:23:04,218 [1] DEBUG - Statement Id: [DAO00203_GetList] PreparedStatement : [select *              from TM_REPORT_SUB_DEFINITION               where                             TM_REPORT_SUB_DEFINITION.REPORT_CODE = 'EME00B00201'                       and                           TM_REPORT_SUB_DEFINITION.BENHVIEN_ID = '01819'                                     order by REPORT_SUB_DEFINITION_ID]
2020-07-16 16:23:04,242 [1] DEBUG - Statement Id: [DAO00201_GetListByParentReportID] PreparedStatement : [select RD.*              from TM_REPORT AS R              INNER JOIN TM_REPORT_SUB_DEFINITION AS RS ON R.REPORT_CODE = RS.REPORT_CODE AND R.BENHVIEN_ID = RS.BENHVIEN_ID              INNER JOIN TM_REPORT_DETAIL AS RD ON RD.REPORT_CODE = RS.SUB_REPORT_CODE AND RD.BENHVIEN_ID = RS.BENHVIEN_ID              where R.REPORT_CODE  = 'EME00B00201' AND R.BENHVIEN_ID = '01819']
