<?xml version="1.0" encoding="utf-8" ?>
<!--============================================================================
//	CAUTION: This file is generated by IBatisNetGen.3.SQLMap.cst at 10/19/2015 7:57:18 AM
//				Any manual editing will be lost in re-generation.
//===========================================================================-->
<sqlMap namespace="eHospital" xmlns="http://ibatis.apache.org/mapping" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" >
  <statements>
    <statement id="DAOWF002_Add" parameterClass="System.Collections.IDictionary" resultClass="System.Int64">
      DECLARE @IDRequestOld int
      DECLARE @IDRequestNew int
      select top 1 @IDRequestOld = ID from TT_REQUEST where PARA = #PARA# order by ID desc

      insert into TT_REQUEST (
      PROCESS_CODE
      , PARA
      , CURR_STATE_CODE
      ) values (
      #PROCESS_CODE#
      , #PARA#
      , #CURR_STATE_CODE#
      )
      SELECT @IDRequestNew = SCOPE_IDENTITY()
      if (@IDRequestOld is not null)
      begin
      update TT_REQUEST_SERVICE set REQUEST_ID = @IDRequestNew, PROCESS_CODE = #PROCESS_CODE# where REQUEST_ID = @IDRequestOld
      update TT_REQUEST set ISACTIVE = '0' where ID = @IDRequestOld
      update TT_REQUEST_SERVICE_DETAIL set REQUEST_ID = @IDRequestNew where REQUEST_ID = @IDRequestOld
      end

      select @IDRequestNew
      <!--<selectKey resultClass="System.Int64" type="post" >
      SELECT @@IDENTITY as value
    </selectKey>-->
    </statement>
    <update id="DAOWF002_Update" parameterClass="System.Collections.IDictionary">
      update TT_REQUEST set
      CURR_STATE_CODE = #CURR_STATE_CODE#
      <isNotEmpty prepend="" property="ISACTIVE">
        , ISACTIVE = #ISACTIVE#
      </isNotEmpty>
      <isNotEmpty prepend="" property="ISCOMPLETE">
        , ISCOMPLETE = #ISCOMPLETE#
      </isNotEmpty>
      where
      ID = '$ID$'
    </update>
  </statements>
</sqlMap>