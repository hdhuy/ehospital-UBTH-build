<?xml version="1.0" encoding="utf-8" ?>
<!--============================================================================
//	CAUTION: This file is generated by IBatisNetGen.3.SQLMap.cst at 10/3/2016 10:12:54 AM
//				Any manual editing will be lost in re-generation.
//===========================================================================-->
<sqlMap namespace="eHospital" xmlns="http://ibatis.apache.org/mapping" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
  <statements>
    <statement id="DAO00305_GetList" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
      select DOTDIEUTRI_ID, MADOTDIEUTRI, TENDOTDIEUTRI, BENHAN_ID
      from TT_NOITRU_DOTDIEUTRI
    </statement>
    <statement id="DAO00305_GetDotDieuTri_ByBenhAn" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
      select DOTDIEUTRI_ID, MADOTDIEUTRI, TENDOTDIEUTRI, BENHAN_ID
      from TT_NOITRU_DOTDIEUTRI
      where BENHAN_ID = $BENHAN_ID$
    </statement>
    <statement id="DAO00305_GetChiTietVienphiBANTTheoDotDieuTri" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
      select distinct
      C.GIATRIMIENGIAM as GIATRIMIENGIAM, D.GIATRIMIENGIAM as GIATRIMIENGIAM_BHTN, E.GIATRIMIENGIAM as GIATRIMIENGIAM_THANHVIEN,
      A.*, dv.NGAYGIOYEUCAU, dv.NOIYEUCAU_ID, dv.NOITHUCHIEN_ID, dv.TRANGTHAI, dv.NGAYYEUCAU, hd.SOHOADON,
      mgct.GIATRIMIENGIAM as GIATRIMIENGIAM_CONGTY,
      isnull(dvyc.TENDICHVU, dc.TENDUOCDAYDU) NOIDUNG, isnull(dvyc.MADICHVU, dc.MADUOC) MADICHVU, dvyc.NORESULT, dc.DONVITINH, ld.MALOAIDUOC, dc.BHYT DUOC_BHYT, ld.LOAIVATTU_ID, ndv.MANHOMDICHVU
      from TT_VIENPHI A
      left join TM_DUOC dc on A.DUOC_ID = dc.DUOC_ID
      left join TM_LOAIDUOC ld on dc.LOAIDUOC_ID = ld.LOAIDUOC_ID
      left join TM_DICHVU dvyc on A.DICHVU_ID = dvyc.DICHVU_ID and A.REF_TABLE = 'TT_DVYEUCAU'
      left join TM_NHOMDICHVU ndv on ndv.NHOMDICHVU_ID = dvyc.NHOMDICHVU_ID
      left join TT_HOADON hd on hd.HOADON_ID = A.HOADON_ID and hd.BENHAN_ID is null
      <!--left join TT_NOITRU_DOTDIEUTRI_CHITIET dtct on dtct.VIENPHI_ID = a.VIENPHI_ID-->
      left join TT_NOITRU_DOTDIEUTRI ddt on ddt.DOTDIEUTRI_ID = A.DOTDIEUTRI_ID
      left join (select sum(GIATRIMIENGIAM) as GIATRIMIENGIAM, VIENPHI_ID, REF_TABLE
      from TT_MIENGIAM_CHITIET
      where REF_TABLE = 'TT_MIENGIAM'
      and MIENGIAM_ID in (select MIENGIAM_ID from TT_MIENGIAM where TINHTRANG = 1 and TIEPNHAN_ID = $TIEPNHAN_ID$)
      group by VIENPHI_ID, REF_TABLE) C on C.REF_TABLE = 'TT_MIENGIAM' and C.VIENPHI_ID = A.VIENPHI_ID
      left join (select sum(GIATRIMIENGIAM) as GIATRIMIENGIAM, VIENPHI_ID, REF_TABLE
      from TT_MIENGIAM_CHITIET
      where REF_TABLE = 'TT_MIENGIAM_BHTN'
      and MIENGIAM_ID in (select MIENGIAM_BHTN_ID from TT_MIENGIAM_BHTN where TINHTRANG = 1 and TIEPNHAN_ID = $TIEPNHAN_ID$)
      group by VIENPHI_ID, REF_TABLE) D on D.REF_TABLE = 'TT_MIENGIAM_BHTN' and D.VIENPHI_ID = A.VIENPHI_ID
      left join (select sum(GIATRIMIENGIAM) as GIATRIMIENGIAM, VIENPHI_ID, REF_TABLE
      from TT_MIENGIAM_CHITIET
      where REF_TABLE = 'TT_MIENGIAM_THANHVIEN'
      and MIENGIAM_ID in (select MIENGIAM_THANHVIEN_ID from TT_MIENGIAM_THANHVIEN where TINHTRANG = 1 and TIEPNHAN_ID = $TIEPNHAN_ID$)
      group by VIENPHI_ID, REF_TABLE) E on E.REF_TABLE = 'TT_MIENGIAM_THANHVIEN' and E.VIENPHI_ID = A.VIENPHI_ID
      left join (select sum(GIATRIMIENGIAM) as GIATRIMIENGIAM, VIENPHI_ID, REF_TABLE
      from TT_MIENGIAM_CHITIET
      where REF_TABLE = 'TT_MIENGIAM_CONGTY'
      and MIENGIAM_ID in (select MIENGIAM_CONGTY_ID from TT_MIENGIAM_CONGTY where  TIEPNHAN_ID = $TIEPNHAN_ID$)
      group by VIENPHI_ID, REF_TABLE) mgct on mgct.REF_TABLE = 'TT_MIENGIAM_CONGTY' and mgct.VIENPHI_ID = A.VIENPHI_ID
      left join (select DVYEUCAU_ID as REF_ID, DICHVU_ID, NGAYGIOYEUCAU, CONVERT(VARCHAR(10), NGAYGIOYEUCAU, 103) as NGAYYEUCAU, NOIYEUCAU_ID, NOITHUCHIEN_ID, TRANGTHAI, 'TT_DVYEUCAU' as REF_TABLE
      from TT_DVYEUCAU where TIEPNHAN_ID = $TIEPNHAN_ID$ and DANGKY_ID is null  and HUYYEUCAU = '0'
      union
      select A.TOATHUOC_ID as REF_ID, A.DUOC_ID as DICHVU_ID, B.THOIGIANKHAM as NGAYGIOYEUCAU, CONVERT(VARCHAR(10), B.THOIGIANKHAM, 103) as NGAYYEUCAU, A.PHONGBANRATOA_ID as NOIYEUCAU_ID, A.KHOPHAT_ID as NOITHUCHIEN_ID, CASE WHEN A.CHUNGTU_ID is null THEN 'CHUAXUAT' ELSE 'DAXUAT' END AS TRANGTHAI, 'TT_NOITRU_TOATHUOC' as REF_TABLE
      from TT_NOITRU_TOATHUOC A
      left join TT_NOITRU_KHAMBENH B on A.KHAMBENH_ID = B.KHAMBENH_ID
      where TIEPNHAN_ID = $TIEPNHAN_ID$
      union
      select CLSKETQUA_VTYT_ID as REF_ID, DUOC_ID as DICHVU_ID, NGAYTAO as NGAYGIOYEUCAU, CONVERT(VARCHAR(10), NGAYTAO, 103) as NGAYYEUCAU, PHONGBAN_ID as NOIYEUCAU_ID, KHOSUDUNG_ID as NOITHUCHIEN_ID, CASE WHEN CHUNGTU_ID is null THEN 'CHUAXUAT' ELSE 'DAXUAT' END AS TRANGTHAI, 'TT_CLSKETQUA_VTYT' as REF_TABLE
      from TT_CLSKETQUA_VTYT
      where CLSKETQUA_ID in (select CLSKETQUA_ID from TT_CLSKETQUA where TIEPNHAN_ID= $TIEPNHAN_ID$)
      union
      select B.PHAUTHUAT_VTYT_ID as REF_ID, B.DUOC_ID as DICHVU_ID, A.NGAYTHUCHIEN as NGAYGIOYEUCAU, CONVERT(VARCHAR(10), A.NGAYTHUCHIEN, 103) as NGAYYEUCAU, A.PHONGBANTHUCHIEN_ID as NOIYEUCAU_ID, B.KHOSUDUNG_ID, CASE WHEN B.CHUNGTU_ID is null THEN 'CHUAXUAT' ELSE 'DAXUAT' END AS TRANGTHAI, 'TT_PHAUTHUAT_VTYT' as REF_TABLE
      from TT_PHAUTHUAT A
      left join TT_PHAUTHUAT_VTYT B on A.PHAUTHUAT_ID = B.PHAUTHUAT_ID
      left join TT_PHAUTHUAT_YEUCAU C on C.PHAUTHUAT_ID = A.PHAUTHUAT_ID
      left join TT_DVYEUCAU D on C.DVYEUCAU_ID = D.DVYEUCAU_ID and D.TIEPNHAN_ID= $TIEPNHAN_ID$ and D.DANGKY_ID is null
      where A.TIEPNHAN_ID= $TIEPNHAN_ID$ and B.DUOC_ID is not null) dv on dv.REF_TABLE = A.REF_TABLE and dv.REF_ID = A.REF_ID and dv.DICHVU_ID = isnull(A.DICHVU_ID, A.DUOC_ID)
      where
      A.TIEPNHAN_ID = $TIEPNHAN_ID$ and A.BENHVIEN_ID = '$BENHVIEN_ID$' and A.BENHAN_ID = $BENHAN_ID$
      and dv.NGAYYEUCAU is not null and A.ACTIVE = '1' and A.REF_ID > 0 and (A.KHONGTHUTIEN = '0' or A.KHONGTHUTIEN is null)
      <isNotEmpty prepend="and" property="DOTDIEUTRI_ID">
        ddt.DOTDIEUTRI_ID = $DOTDIEUTRI_ID$
      </isNotEmpty>
      ORDER BY A.VIENPHI_ID
    </statement>
    <statement id="DAO00305_CheckRaVien" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
      select isnull(KHOACHUYENDEN_ID, KHOAVAO_ID) as KHOAHIENTAI, *
      from TT_NOITRU_BENHAN where BENHAN_ID = $BENHAN_ID$
    </statement>
    <statement id="DAO00305_GetListBenhNhanNgoaiTru" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
      select * from
      (select COUNT(*) OVER() as TOTALROWS,  ROW_NUMBER() OVER(order by T.MADOTDIEUTRI desc) as ROWNUMBER, * from
      (select distinct
      E.CHANDOANKHAMBENH as CHANDOAN, E.KHOAVAO_ID  as PHONGBAN_ID,  E.BENHAN_ID,
      E.ICD_BENHCHINH as MABENH, E.ICD_BENHPHU as BENHKHAC, E.SOBENHAN, E.SOCAPCUU,
      B.SOBHYT, B.NGAYTIEPNHAN , B.THOIGIANTIEPNHAN as NGAYVAO, B.SOTIEPNHAN, B.DOITUONG_ID, B.TIEPNHAN_ID,
      C.MAYTE as MABN, C.TENBENHNHAN as TENBN, C.NAMSINH , C.BENHNHAN_ID, E.BENHVIEN_ID,
      E.TRANGTHAI,E.THOIGIANRAVIEN,
      F.NGAYCHUNGTU as NGAYXUATTHUOC, D.NGUOICAPNHAT_ID as NGUOIKHOABENHAN, E.LOAIBENHAN, N'Điều trị ngoại trú' + ' - ' + E.SOBENHAN as NOIDUNG2,
      dt.MADOTDIEUTRI, dt.TENDOTDIEUTRI, dt.DAXACNHAN_BHYT, dt.DOTDIEUTRI_ID, dt.THOIGIANDENNGAY,
      case when DAXACNHAN_BHYT is null then 0 else 1 end XACNHANBHYT,
      case when dt.DAXACNHAN_BHYT is not null then convert(varchar(10),D.NGAYXACNHAN,103) else '' end NGAYXACNHANBHYT, nv.TENNHANVIEN, pb.TENPHONGBAN
      from
      (
      select *
      from TT_NOITRU_BENHAN
      where TRANGTHAI = 'DANGDIEUTRI' or TRANGTHAI = 'DAKHOA' or TRANGTHAI = 'DAXUATVIEN' or TRANGTHAI = 'DATHANHTOAN'
      ) E
      inner join TT_TIEPNHAN B on B.TIEPNHAN_ID = E.TIEPNHAN_ID
      inner join TT_BENHNHAN C on E.BENHNHAN_ID = C.BENHNHAN_ID
      left join TT_XACNHANCHIPHI D on D.BENHAN_ID = E.BENHAN_ID
      left join TT_NOITRU_KHAMBENH A on E.BENHAN_ID = A.BENHAN_ID
      left join TT_DUOC_CHUNGTU F on F.KHAMBENH_ID = A.KHAMBENH_ID
      inner join TM_NHANVIEN nv on nv.NHANVIEN_ID = e.BACSIDIEUTRICHINH_ID
      inner join TM_PHONGBAN pb on pb.PHONGBAN_ID = e.KHOACHUYENDEN_ID
      left join
      (
      select vp.BENHAN_ID, SUM(GIATRI_BENHNHAN_DATHANHTOAN) as GIATRI_BENHNHAN_DATHANHTOAN
      from TT_VIENPHI vp
      where vp.BENHVIEN_ID = '$BENHVIEN_ID$' group by vp.BENHAN_ID
      ) G on E.BENHAN_ID = A.BENHAN_ID
      inner join TT_NOITRU_DOTDIEUTRI dt on dt.BENHAN_ID = e.BENHAN_ID
      where
      ((B.SOBHYT is not null and B.SOBHYT != '')	) AND E.LOAIBENHAN = 2
      and E.BENHVIEN_ID = '$BENHVIEN_ID$'
      <isNotEmpty prepend="and" property="OPT_KHO_RAVIEN_DUNG_KHO_OPD">
        <isEqual prepend="" property="OPT_KHO_RAVIEN_DUNG_KHO_OPD" compareValue="True">
          dt.TRANGTHAI='0'
        </isEqual>
        <isEqual prepend="" property="OPT_KHO_RAVIEN_DUNG_KHO_OPD" compareValue="False">
          dt.TRANGTHAI='1'
        </isEqual>
      </isNotEmpty>
      <isEqual prepend="" property="BIL86_FILLTER_NGAYRAVIEN" compareValue="True">
        <isNotEmpty prepend="and" property="TUNGAY">
          Convert(date,E.NGAYRAVIEN) &gt;= Convert(date,'$TUNGAY$')
        </isNotEmpty>
        <isNotEmpty prepend="and" property="DENNGAY">
          Convert(date,E.NGAYRAVIEN) &lt;= Convert(date,'$DENNGAY$')
        </isNotEmpty>
      </isEqual>
      <isEqual prepend="" property="BIL86_FILLTER_NGAYRAVIEN" compareValue="False">
        <isNotEmpty prepend="and" property="TUNGAY">
          Convert(date,dt.TUNGAY) &gt;= Convert(date,'$TUNGAY$')
        </isNotEmpty>
        <isNotEmpty prepend="and" property="DENNGAY">
          Convert(date,dt.DENNGAY) &lt;= Convert(date,'$DENNGAY$')
        </isNotEmpty>
      </isEqual>
      <isNotEmpty prepend="and" property="MABENHAN">
        (C.TENBENHNHAN LIKE '%' + #MABENHAN# + '%' OR C.MAYTE LIKE '%' + #MABENHAN# + '%' OR B.SOBHYT like '%' + #MABENHAN# + '%')
      </isNotEmpty>
      <isNotEmpty prepend="and" property="NGAYXACNHAN">
        D.NGAYXACNHAN = '$NGAYXACNHAN$'
      </isNotEmpty>
      <isNotEmpty prepend="" property="TRANGTHAI">
        <isEqual prepend="AND" property="TRANGTHAI" compareValue="2">
          D.XACNHANCHIPHI_ID is NULL
        </isEqual>
        <isEqual prepend="AND" property="TRANGTHAI" compareValue="3">
          D.XACNHANCHIPHI_ID is not NULL
        </isEqual>
        <isEqual prepend="AND" property="TRANGTHAI" compareValue="02">
          D.XACNHANCHIPHI_ID is NULL
        </isEqual>
        <isEqual prepend="AND" property="TRANGTHAI" compareValue="03">
          D.XACNHANCHIPHI_ID is not NULL
        </isEqual>
      </isNotEmpty>
      )T)LST where LST.ROWNUMBER between '$FROMROW$' and '$TOROW$'
    </statement>
    <statement id="DAO00305_GetVienphiBenhAnNgoaiTru" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
      <!--dich vu-->
      select
      D.KHOAVAO_ID  as PHONGBAN_ID,
      ISNULL(A.DICHVU_ID, A.DUOC_ID) as NOIDUNG_ID, A.REF_ID as IDREF, A.VIENPHI_ID,
      A.SOLUONG as SOLUONG, A.SOLUONG as SOLUONG_NEW, A.DICHVU_ID, A.DUOC_ID,
      A.DONGIA_DOANHTHU, A.DONGIA_DOANHTHU as DONGIADOANHTHU, A.BHYT_DONGIA_CHITRA,
      A.BHYT_DONGIA as DONGIAHOTRO, A.BHYT_THANHTIEN_CHITRA as DONGIAHOTROCHITRA,
      A.REF_TABLE as LOAI, A.BHYT_DONGIA, A.BHYT_THANHTIEN, A.BHYT_THANHTIEN_CHITRA, A.BENHNHAN_PHAITHANHTOAN,
      A.GIATRI_BENHNHAN_DATHANHTOAN, A.BENHVIEN_ID, A.THANHTIEN_DOANHTHU,
      A.LOAI_CHIPHI, A.LOAIGIA_ID, A.REF_TABLE, A.KHAMBENH_ID, A.REF_ID, A.DUOCPHEPTHUCHIEN,
      A.HUY, A.KHONGTHUTIEN, A.DATHANHTOAN, A.HOADON_ID, A.ACTIVE,
      DT.MADOTDIEUTRI + ' - ' + DT.TENDOTDIEUTRI AS TENDOT,
      dv.TENDICHVU NOIDUNG, dv.MADICHVU MADICHVU, dv.NORESULT, null DONVITINH, null MALOAIDUOC, null DUOC_BHYT, null LOAIVATTU_ID, ndv.MANHOMDICHVU
      from TT_VIENPHI A
      left join TM_DICHVU dv on A.DICHVU_ID = dv.DICHVU_ID and A.REF_TABLE = 'TT_DVYEUCAU'
      left join TM_NHOMDICHVU ndv on ndv.NHOMDICHVU_ID = dv.NHOMDICHVU_ID
      inner join TT_NOITRU_BENHAN D on D.BENHAN_ID = A.BENHAN_ID
      left join TT_NOITRU_DOTDIEUTRI DT ON A.DOTDIEUTRI_ID = DT.DOTDIEUTRI_ID
      inner join TT_DVYEUCAU dvyc on dvyc.DVYEUCAU_ID = A.REF_ID
      where A.BENHAN_ID = $BENHAN_ID$ and A.BENHVIEN_ID = '$BENHVIEN_ID$'
      and MADOTDIEUTRI = '$MADOTDIEUTRI$' and A.BHYT_DONGIA > 0
      and dvyc.HUYYEUCAU != '1' and A.REF_TABLE = 'TT_DVYEUCAU' and A.KHONGTHUTIEN = '0'
      <!--thuoc-->
      union
      select
      D.KHOAVAO_ID  as PHONGBAN_ID,
      ISNULL(A.DICHVU_ID, A.DUOC_ID) as NOIDUNG_ID, A.REF_ID as IDREF, A.VIENPHI_ID,
      A.SOLUONG as SOLUONG, A.SOLUONG as SOLUONG_NEW, A.DICHVU_ID, A.DUOC_ID,
      A.DONGIA_DOANHTHU, A.DONGIA_DOANHTHU as DONGIADOANHTHU, A.BHYT_DONGIA_CHITRA,
      A.BHYT_DONGIA as DONGIAHOTRO, A.BHYT_THANHTIEN_CHITRA as DONGIAHOTROCHITRA,
      A.REF_TABLE as LOAI, A.BHYT_DONGIA, A.BHYT_THANHTIEN, A.BHYT_THANHTIEN_CHITRA, A.BENHNHAN_PHAITHANHTOAN,
      A.GIATRI_BENHNHAN_DATHANHTOAN, A.BENHVIEN_ID, A.THANHTIEN_DOANHTHU,
      A.LOAI_CHIPHI, A.LOAIGIA_ID, A.REF_TABLE, A.KHAMBENH_ID, A.REF_ID, A.DUOCPHEPTHUCHIEN,
      A.HUY, A.KHONGTHUTIEN, A.DATHANHTOAN, A.HOADON_ID, A.ACTIVE,
      DT.MADOTDIEUTRI + ' - ' + DT.TENDOTDIEUTRI AS TENDOT,
      dc.TENDUOCDAYDU NOIDUNG, dc.MADUOC MADICHVU, null NORESULT, dc.DONVITINH, ld.MALOAIDUOC, dc.BHYT DUOC_BHYT, ld.LOAIVATTU_ID, null MANHOMDICHVU
      from TT_VIENPHI A
      left join TM_DUOC dc on A.DUOC_ID = dc.DUOC_ID
      left join TM_LOAIDUOC ld on dc.LOAIDUOC_ID = ld.LOAIDUOC_ID
      inner join TT_NOITRU_BENHAN D on D.BENHAN_ID = A.BENHAN_ID
      left join TT_NOITRU_DOTDIEUTRI DT ON A.DOTDIEUTRI_ID = DT.DOTDIEUTRI_ID
      inner join TT_NOITRU_TOATHUOC B on A.TIEPNHAN_ID = B.TIEPNHAN_ID and A.REF_ID = B.TOATHUOC_ID
      where A.BENHAN_ID = $BENHAN_ID$ and A.BENHVIEN_ID = '$BENHVIEN_ID$'
      and MADOTDIEUTRI = '$MADOTDIEUTRI$' and A.BHYT_DONGIA > 0
      and (A.DICHVU_ID is null and A.DUOC_ID is not null) and REF_TABLE = 'TT_NOITRU_TOATHUOC'
      and A.KHONGTHUTIEN = '0'
      <!--vtyt-->
      union
      select
      D.KHOAVAO_ID  as PHONGBAN_ID,
      ISNULL(A.DICHVU_ID, A.DUOC_ID) as NOIDUNG_ID, A.REF_ID as IDREF, A.VIENPHI_ID,
      A.SOLUONG as SOLUONG, A.SOLUONG as SOLUONG_NEW, A.DICHVU_ID, A.DUOC_ID,
      A.DONGIA_DOANHTHU, A.DONGIA_DOANHTHU as DONGIADOANHTHU, A.BHYT_DONGIA_CHITRA,
      A.BHYT_DONGIA as DONGIAHOTRO, A.BHYT_THANHTIEN_CHITRA as DONGIAHOTROCHITRA,
      A.REF_TABLE as LOAI, A.BHYT_DONGIA, A.BHYT_THANHTIEN, A.BHYT_THANHTIEN_CHITRA, A.BENHNHAN_PHAITHANHTOAN,
      A.GIATRI_BENHNHAN_DATHANHTOAN, A.BENHVIEN_ID, A.THANHTIEN_DOANHTHU,
      A.LOAI_CHIPHI, A.LOAIGIA_ID, A.REF_TABLE, A.KHAMBENH_ID, A.REF_ID, A.DUOCPHEPTHUCHIEN,
      A.HUY, A.KHONGTHUTIEN, A.DATHANHTOAN, A.HOADON_ID, A.ACTIVE,
      DT.MADOTDIEUTRI + ' - ' + DT.TENDOTDIEUTRI AS TENDOT,
      dc.TENDUOCDAYDU NOIDUNG, dc.MADUOC MADICHVU, null NORESULT, dc.DONVITINH, ld.MALOAIDUOC, dc.BHYT DUOC_BHYT, ld.LOAIVATTU_ID, null MANHOMDICHVU
      from TT_VIENPHI A
      left join TM_DUOC dc on A.DUOC_ID = dc.DUOC_ID
      left join TM_LOAIDUOC ld on dc.LOAIDUOC_ID = ld.LOAIDUOC_ID
      inner join TT_NOITRU_BENHAN D on D.BENHAN_ID = A.BENHAN_ID
      left join TT_NOITRU_DOTDIEUTRI DT ON A.DOTDIEUTRI_ID = DT.DOTDIEUTRI_ID
      where A.BENHAN_ID = $BENHAN_ID$ and A.BENHVIEN_ID = '$BENHVIEN_ID$'
      and MADOTDIEUTRI = '$MADOTDIEUTRI$' and A.BHYT_DONGIA > 0
      and (A.DICHVU_ID is null and A.DUOC_ID is not null) and REF_TABLE not in ('TT_DVYEUCAU', 'TT_NOITRU_TOATHUOC', 'TT_NUT_XACNHANSUATAN_CHITIET', 'TT_MAU_CHUNGTU_CHITIET')
      and A.KHONGTHUTIEN = '0'
    </statement>
    <statement id="DAO00305_GetDVChuaThanhToan" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
      select vp.*
      from TT_VIENPHI vp
      left join TT_DVYEUCAU dvyc on dvyc.DVYEUCAU_ID = vp.REF_ID
      where vp.BENHAN_ID = $BENHAN_ID$ and vp.DOTDIEUTRI_ID is not null AND vp.BENHVIEN_ID = '$BENHVIEN_ID$' and DATHANHTOAN='0' and dvyc.HUYYEUCAU = '0'
    </statement>
    <statement id="DAO00305_GetListBenhNhanNgoaiTruXacNhan" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
      select * from
      (select COUNT(*) OVER() as TOTALROWS,  ROW_NUMBER() OVER(order by T.SOTIEPNHAN desc) as ROWNUMBER, * from
      (select distinct
      E.CHANDOANKHAMBENH as CHANDOAN, E.KHOAVAO_ID  as PHONGBAN_ID,  E.BENHAN_ID,
      E.ICD_BENHCHINH as MABENH, E.ICD_BENHPHU as BENHKHAC, E.SOBENHAN, E.SOCAPCUU,
      B.SOBHYT, B.NGAYTIEPNHAN , B.THOIGIANTIEPNHAN as NGAYVAO, E.THOIGIANRAVIEN, B.SOTIEPNHAN, B.DOITUONG_ID, B.TIEPNHAN_ID,
      C.MAYTE as MABN, C.TENBENHNHAN as TENBN, isnull(cast(cast(C.NGAYSINH as date)as varchar),C.NAMSINH) as NGAYSINH, C.NAMSINH , C.BENHNHAN_ID, E.BENHVIEN_ID,
      E.TRANGTHAI,
      F.NGAYCHUNGTU as NGAYXUATTHUOC,
      gd.DESCRIPTION  as TENGIOITINH, pb.TENPHONGBAN, D.NGUOICAPNHAT_ID as NGUOIKHOABENHAN, C.DIACHILIENLAC,
      CASE WHEN balt.MABENHAN is null THEN 0 ELSE 1 END as CHUYENLUUTRU,
      E.LOAIBENHAN,
      case when E.TRANGTHAI = 'DAKHOA' then convert(varchar(10),E.NGAYCAPNHAT,103) else '' end NGAYXACNHAN
      from
      (
      select *
      from TT_NOITRU_BENHAN
      where TRANGTHAI = 'DANGDIEUTRI' or TRANGTHAI = 'DAKHOA' or TRANGTHAI = 'DAXUATVIEN' or TRANGTHAI = 'DATHANHTOAN'
      ) E
      inner join TT_TIEPNHAN B on B.TIEPNHAN_ID = E.TIEPNHAN_ID
      inner join TT_BENHNHAN C on E.BENHNHAN_ID = C.BENHNHAN_ID
      left join TT_XACNHANCHIPHI D on D.BENHAN_ID = E.BENHAN_ID
      left join TT_NOITRU_KHAMBENH A on E.BENHAN_ID = A.BENHAN_ID
      left join TT_DUOC_CHUNGTU F on F.KHAMBENH_ID = A.KHAMBENH_ID
      inner join TM_GENDER gd on gd.ID = C.GIOITINH
      left join TT_BENHAN_LUUTRU balt on balt.BENHAN_ID = E.BENHAN_ID and balt.REF_TABLE = 'TT_NOITRU_BENHAN'
      left join TM_PHONGBAN pb on pb.PHONGBAN_ID = isnull(E.KHOACHUYENDEN_ID, E.KHOAVAO_ID)
      left join (select BENHAN_ID, SUM(GIATRI_BENHNHAN_DATHANHTOAN) as GIATRI_BENHNHAN_DATHANHTOAN
      from TT_VIENPHI where BENHVIEN_ID = '$BENHVIEN_ID$' group by BENHAN_ID) G on E.BENHAN_ID = A.BENHAN_ID
      where
      E.LOAIBENHAN = 2 <!--and
      (E.TRANGTHAI = 'DANGDIEUTRI' or E.TRANGTHAI = 'DATHANHTOAN' or E.TRANGTHAI = 'DAKHOA' or E.TRANGTHAI = 'DAXUATVIEN')-->
      <isNotEmpty prepend="and" property="TUNGAY">
        E.NGAYRAVIEN &gt;= '$TUNGAY$'
      </isNotEmpty>
      <isNotEmpty prepend="and" property="DENNGAY">
        E.NGAYRAVIEN &lt;= '$DENNGAY$'
      </isNotEmpty>
      and E.BENHVIEN_ID = '$BENHVIEN_ID$'
      <isNotEmpty prepend="and" property="MABENHAN">
        (E.SOBENHAN LIKE '%' + #MABENHAN# + '%' or C.TENBENHNHAN LIKE '%' + #MABENHAN# + '%')
      </isNotEmpty>
      <isNotEmpty prepend="and" property="NGAYXACNHAN">
        D.NGAYXACNHAN = '$NGAYXACNHAN$'
      </isNotEmpty>
      <isNotEmpty prepend="" property="TRANGTHAI">
        <isEqual prepend="AND" property="TRANGTHAI" compareValue="2">
          D.XACNHANCHIPHI_ID is NULL
        </isEqual>
        <isEqual prepend="AND" property="TRANGTHAI" compareValue="3">
          D.XACNHANCHIPHI_ID is not NULL
        </isEqual>
        <isEqual prepend="AND" property="TRANGTHAI" compareValue="02">
          E.TRANGTHAI != 'DAKHOA'
        </isEqual>
        <isEqual prepend="AND" property="TRANGTHAI" compareValue="03">
          E.TRANGTHAI = 'DAKHOA'
        </isEqual>
      </isNotEmpty>
      )T
      )lst where lst.ROWNUMBER between '$FROMROW$' and '$TOROW$'
    </statement>
    <statement id="DAO00305_GetTrangThaiBenhAn" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
      select TRANGTHAI,LOAIBENHAN from TT_NOITRU_BENHAN where BENHAN_ID = $BENHAN_ID$ and BENHVIEN_ID = '$BENHVIEN_ID$'
    </statement>
    <statement id="DAO00305_XacNhanChiPhiExists" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
      select *
      from TT_XACNHANCHIPHI where BENHAN_ID = $BENHAN_ID$ and BENHVIEN_ID = '$BENHVIEN_ID$'
    </statement>
    <statement id="DAO00305_GetNhapVienByIdNgoaiTru" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
      select bn.TENBENHNHAN, bn.MAYTE, tn.SOTIEPNHAN, nv.*
      from TT_NOITRU_NHAPVIEN nv
      left join TT_BENHNHAN bn on bn.BENHNHAN_ID = nv.BENHNHAN_ID
      left join TT_TIEPNHAN tn on tn.TIEPNHAN_ID = nv.TIEPNHAN_ID
      where nv.BENHNHAN_ID  = $BENHNHAN_ID$ and tn.TRANGTHAI != 'HOANTHANH'
      and (nv.TRANGTHAI = 'CHOXACNHAN' or nv.TRANGTHAI = 'CHONHAPKHOA' or nv.TRANGTHAI = 'DAXACNHAN')
      and nv.LOAIBENHAN = '$LOAIBENHAN$'
      order by nv.NHAPVIEN_ID desc
    </statement>
    <statement id="DAO00305_GetXacNhanChiPhiId" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
      select distinct dt.DAXACNHAN_BHYT as XACNHANCHIPHI_ID
      from TT_NOITRU_DOTDIEUTRI dt
      <!--inner join TT_NOITRU_DOTDIEUTRI_CHITIET ct on dt.DOTDIEUTRI_ID = ct.DOTDIEUTRI_ID-->
      inner join TT_XACNHANCHIPHI xn on xn.BENHAN_ID = dt.BENHAN_ID
      where dt.MADOTDIEUTRI = '$MADOTDIEUTRI$' <!--and dt.DAXACNHAN_BHYT = '$DAXACNHAN_BHYT$'-->
      and xn.BENHVIEN_ID = '$BENHVIEN_ID$'
    </statement>
    <statement id="DAO00305_CheckHuyDot" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
      select dt.*
      from TT_NOITRU_DOTDIEUTRI dt
      inner join TT_NOITRU_BENHAN ct on ct.BENHAN_ID = dt.BENHAN_ID
      inner join TT_VIENPHI vp on vp.BENHAN_ID = ct.BENHAN_ID
      where vp.DATHANHTOAN = '1' and dt.MADOTDIEUTRI = '$MADOTDIEUTRI$'
      and dt.BENHAN_ID = $BENHAN_ID$ and vp.BENHVIEN_ID = '$BENHVIEN_ID$'
    </statement>
    <statement id="DAO00305_CheckNew" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
      select *
      from TT_NOITRU_DOTDIEUTRI
      where BENHAN_ID = $BENHAN_ID$
      <isNotEmpty prepend="and" property="TRANGTHAI">
        TRANGTHAI = '$TRANGTHAI$'
      </isNotEmpty>
    </statement>
    <statement id="DAO00305_MaxDot" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
      select max(DOTDIEUTRI_ID) as Max
      from TT_NOITRU_DOTDIEUTRI
      where BENHAN_ID = $BENHAN_ID$
    </statement>
    <statement id="DAO00305_GetDataDotDieuTriDangMo" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
      select *
      from TT_NOITRU_DOTDIEUTRI
      where BENHAN_ID = $BENHAN_ID$ and TRANGTHAI = '0'
    </statement>
    <statement id="DAO00305_CheckInFormationNhapVien" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
      select *
      from TT_NOITRU_NHAPVIEN
      where BENHNHAN_ID = $BENHNHAN_ID$ and TIEPNHAN_ID = $TIEPNHAN_ID$ and LOAIBENHAN = '$LOAIBENHAN$'
      and BENHVIEN_ID = '$BENHVIEN_ID$'
    </statement>
    <statement id="DAO00305_CheckOnDepartment" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
      select *
      from TT_NOITRU_BENHAN
      where BENHNHAN_ID = $BENHNHAN_ID$ and TIEPNHAN_ID = $TIEPNHAN_ID$ and LOAIBENHAN = '$LOAIBENHAN$'
      and BENHVIEN_ID = '$BENHVIEN_ID$'
    </statement>
    <statement id="DAO00305_KiemTraVTYTCuaBenhAn" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
      select A.* from TT_CLSKETQUA_VTYT A
      left join TT_DVYEUCAU B on A.DVYEUCAU_ID = B.DVYEUCAU_ID
      inner join TT_NOITRU_BENHAN C on C.BENHAN_ID = B.BENHAN_ID
      inner join TT_NOITRU_DOTDIEUTRI D on D.BENHAN_ID = C.BENHAN_ID
      where B.BENHAN_ID = $BENHAN_ID$ and A.CHUNGTU_ID is null and D.MADOTDIEUTRI = '$MADOTDIEUTRI$'
    </statement>
    <statement id="DAO00305_KiemThuThuatVTYT" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
      select * from TT_PHAUTHUAT_VTYT
      where
      PHAUTHUAT_ID in (select PHAUTHUAT_ID from TT_PHAUTHUAT pt
      inner join TT_NOITRU_BENHAN ba on ba.BENHAN_ID = pt.BENHAN_ID
      inner join TT_NOITRU_DOTDIEUTRI dt on dt.BENHAN_ID = ba.BENHAN_ID
      where pt.BENHAN_ID = $BENHAN_ID$ and dt.MADOTDIEUTRI = '$MADOTDIEUTRI$')
      and (CHUNGTU_ID is null or CHUNGTU_ID = 0)
    </statement>
    <statement id="DAO00305_CheckBilProvisional" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
      select vp.*
      from TT_VIENPHI as vp
      inner join TT_HOADON as hd on hd.HOADON_ID = vp.HOADON_ID
      inner join TT_NOITRU_DOTDIEUTRI_CHITIET as ct on ct.VIENPHI_ID = vp.VIENPHI_ID
      inner join TT_NOITRU_DOTDIEUTRI as dt on dt.DOTDIEUTRI_ID = ct.DOTDIEUTRI_ID
      where vp.BENHAN_ID = $BENHAN_ID$ and dt.MADOTDIEUTRI = '$MADOTDIEUTRI$' and hd.TRANGTHAI = 'CHUATHUTIEN'
    </statement>
    <statement id="DAO00305_CheckYLenhRaVien" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
      select VP.*
      from TT_NOITRU_KHAMBENH KB
      join TT_NOITRU_TOATHUOC TT on KB.KHAMBENH_ID = TT.KHAMBENH_ID
      join TT_VIENPHI VP on VP.REF_ID = TT.TOATHUOC_ID and VP.REF_TABLE = 'TT_NOITRU_TOATHUOC'
      join TT_XACNHANCHIPHICHITIET CT on CT.VIENPHI_ID = VP.VIENPHI_ID
      join TT_TIEPNHAN TN on TN.TIEPNHAN_ID = VP.TIEPNHAN_ID
      join TM_DOITUONG DT on DT.DOITUONG_ID = TN.DOITUONG_ID
      <dynamic prepend="where">
        <isParameterPresent>
          <isNotEmpty prepend="and" property="RAVIEN">
            KB.RAVIEN = '$RAVIEN$'
          </isNotEmpty>
          <isNotEmpty prepend="and" property="TRANGTHAI">
            TT.TRANGTHAI = '$TRANGTHAI$'
          </isNotEmpty>
          <isNotEmpty prepend="and" property="TIEPNHAN_ID">
            VP.TIEPNHAN_ID = $TIEPNHAN_ID$
          </isNotEmpty>
          <isNotEmpty prepend="and" property="BENHAN_ID">
            VP.BENHAN_ID = $BENHAN_ID$
          </isNotEmpty>
          <isNotEmpty prepend="and" property="DATHANHTOAN">
            VP.DATHANHTOAN = '$DATHANHTOAN$'
          </isNotEmpty>
          <isNotEmpty prepend="and" property="ACTIVE">
            VP.ACTIVE = '$ACTIVE$'
          </isNotEmpty>
          <isNotEmpty prepend="and" property="MADOITUONG">
            DT.MADOITUONG != '$MADOITUONG$'
          </isNotEmpty>
        </isParameterPresent>
      </dynamic>
    </statement>
    <statement id="DAO00305_GetChanDoanNgoaiTru" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
      select NT_KB.KHAMBENH_ID, isnull(icd_chinh.TENICD,'') + '(' + isnull(icd_chinh.MAICD,'') + ')' + '; ' + isnull(ICD_PHU.TENICDPHU,'') + '; ' + isnull(NT_KB.CHANDOANKHOAKHAM,'') as CHANDOANRAVIEN
      from TT_NGOAITRU_KHAMBENH NT_KB
      left join TM_ICD icd_chinh on icd_chinh.ICD_ID = NT_KB.CHANDOANICD_ID
      left join
      (
      SELECT tbl.KHAMBENH_ID, STUFF((
      SELECT '; ' + tbl2.TENICD
      FROM (
      SELECT NK.KHAMBENH_ID, I.TENICD + '(' + I.MAICD + ')' as TENICD
      FROM TT_NGOAITRU_KHAMBENH NK
      left join TT_NGOAITRU_KHAMBENH_ICD NKI on NK.KHAMBENH_ID = NKI.KHAMBENH_ID
      left join TM_ICD I ON I.ICD_ID = NKI.ICD_ID
      WHERE NK.TIEPNHAN_ID = $TIEPNHAN_ID$
      ) tbl2
      WHERE tbl2.KHAMBENH_ID = tbl.KHAMBENH_ID
      FOR XML PATH(''),TYPE).value('(./text())[1]','NVARCHAR(MAX)')
      ,1,2,'') AS TENICDPHU
      FROM
      (
      SELECT NK.KHAMBENH_ID, I.TENICD
      FROM TT_NGOAITRU_KHAMBENH NK
      left join TT_NGOAITRU_KHAMBENH_ICD NKI on NK.KHAMBENH_ID = NKI.KHAMBENH_ID
      left join TM_ICD I ON I.ICD_ID = NKI.ICD_ID
      WHERE NK.TIEPNHAN_ID = $TIEPNHAN_ID$
      ) tbl
      GROUP BY tbl.KHAMBENH_ID
      ) ICD_PHU ON ICD_PHU.KHAMBENH_ID = NT_KB.KHAMBENH_ID
      WHERE NT_KB.TIEPNHAN_ID = $TIEPNHAN_ID$
    </statement>
    <statement id="DAO00305_GetChanDoanNoiTru" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
      select NT_BA.BENHAN_ID, isnull(icd_chinh.TENICD,'') + '(' + isnull(icd_chinh.MAICD,'') + ')' + '; ' + isnull(ICD_PHU.TENICDPHU,'') + '; ' + isnull(NT_BA.CHANDOANRAVIEN,'') AS CHANDOANRAVIEN
      from TT_NOITRU_BENHAN NT_BA
      left join TM_ICD icd_chinh on icd_chinh.ICD_ID = NT_BA.ICD_BENHCHINH
      left join
      (
      SELECT tbl.BENHAN_ID, STUFF((
      SELECT '; ' + tbl2.TENICD
      FROM (
      SELECT A.BENHAN_ID, I.TENICD + '(' + I.MAICD + ')' as TENICD
      FROM TT_NOITRU_BENHAN A
      left join TM_ICD I ON I.MAICD = A.ICD_BENHPHU
      WHERE A.TIEPNHAN_ID = $TIEPNHAN_ID$ AND A.BENHAN_ID = '$BENHAN_ID$'
      ) tbl2
      WHERE tbl2.BENHAN_ID = tbl.BENHAN_ID
      FOR XML PATH(''),TYPE).value('(./text())[1]','NVARCHAR(MAX)')
      ,1,2,'') AS TENICDPHU
      FROM
      (
      SELECT B.BENHAN_ID, I.TENICD
      FROM TT_NOITRU_BENHAN B
      left join TM_ICD I ON I.MAICD = B.ICD_BENHPHU
      WHERE B.TIEPNHAN_ID = $TIEPNHAN_ID$ AND B.BENHAN_ID = $BENHAN_ID$
      ) tbl
      GROUP BY tbl.BENHAN_ID
      ) ICD_PHU ON ICD_PHU.BENHAN_ID = NT_BA.BENHAN_ID
      WHERE NT_BA.TIEPNHAN_ID = $TIEPNHAN_ID$ AND NT_BA.BENHAN_ID = $BENHAN_ID$
    </statement>
    <statement id="DAO00305_GetChanDoanCapCuu" parameterClass="System.Collections.IDictionary" resultClass="DataObject">

    </statement>
    <statement id="DAO00305_GetDichVuCap1" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
      SELECT D.DICHVU_ID, D.MADICHVU, ISNULL(D.INPUTCODE,'') AS INPUTCODE
      , D.TENDICHVU, N.TENNHOMDICHVU, L.TENLOAIDICHVU
      , CASE WHEN D.COGIADICHVU = '1' THEN N'Có' ELSE N'Không' END AS GIADICHVU
      , CASE WHEN D.COGIATRICHUAN = '1' THEN N'Có' ELSE N'Không' END AS GIATRICHUAN
      , ISNULL(D.ATTRIBUTE1,'') AS TT15
      , CASE WHEN D.BHYT = '1' THEN N'Có' ELSE N'Không' END AS BHYT
      , ISNULL(D.MA37,'') AS MA37
      , ISNULL(D.TEN_BHYT,'') AS TENTT43
      , ISNULL(D.THONGTUBOYTE,'') AS MATTBYT
      , ISNULL(C.TENCHUYENKHOA,'') AS CHUYENKHOA
      , ISNULL(NH.TENNHOMPHATHANHGIA,'') AS TENNHOMPHATHANHGIA
      , ISNULL(CAST(DD1.DONGIA AS decimal(18,2)),0) AS GIABHYT
      , ISNULL(CAST(DD2.DONGIA as decimal(18,2)),0) AS GIADV
      FROM TM_DICHVU AS D
      inner join TM_NHOMDICHVU AS N ON N.NHOMDICHVU_ID = D.NHOMDICHVU_ID
      inner join TM_LOAIDICHVU AS L ON L.LOAIDICHVU_ID = N.LOAIDICHVU_ID
      left join TM_CHUYENKHOA AS C ON C.CHUYENKHOA_ID = D.CHUYENKHOA_ID
      left join TM_NHOMPHATHANHGIA AS NH ON NH.NHOMPHATHANHGIA_ID = D.NHOMPHATHANHGIA_ID
      left join TM_DICHVU_DONGIA AS DD1 ON DD1.DICHVU_ID = D.DICHVU_ID AND DD1.LOAIGIA_ID = 53
      left join TM_DICHVU_DONGIA AS DD2 ON DD2.DICHVU_ID = D.DICHVU_ID AND DD2.LOAIGIA_ID = 54
      where D.TAMNGUNG != '1' and D.CAP = 1
    </statement>
    <statement id="DAO00305_GetListDotIsNull" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
      SELECT ROW_NUMBER() OVER(order by MAYTE) as STT, * FROM (
      select DISTINCT E.MAYTE, E.TENBENHNHAN, CASE WHEN E.GIOITINH = '1' THEN N'Nam' ELSE N'Nữ' END AS GIOITINH
      , CASE WHEN E.NGAYSINH IS NULL THEN CONVERT(VARCHAR(4),E.NAMSINH) ELSE CONVERT(VARCHAR(10),E.NGAYSINH,103) END AS NGAYSINH
      , E.DIACHILIENLAC, CONVERT(VARCHAR(10),D.NGAYTIEPNHAN,103) AS NGAYTIEPNHAN, B.DOTDIEUTRI_ID, C.BENHAN_ID
      from TT_NOITRU_BENHAN A
      join TT_NOITRU_DOTDIEUTRI B on B.BENHAN_ID = A.BENHAN_ID
      join TT_VIENPHI C on C.BENHAN_ID = A.BENHAN_ID
      join TT_TIEPNHAN D on D.TIEPNHAN_ID = A.TIEPNHAN_ID
      join TT_BENHNHAN E on E.BENHNHAN_ID = D.BENHNHAN_ID
      where A.LOAIBENHAN = 2 and C.DOTDIEUTRI_ID IS NULL
      )A
    </statement>
    <statement id="DAO00305_UpdateDotIsNull" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
      UPDATE TT_VIENPHI
      SET DOTDIEUTRI_ID = #DOTDIEUTRI_ID#
      WHERE BENHAN_ID = $BENHAN_ID$
    </statement>
    <statement id="DAO00305_GetPhamarcy" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
      select A.*
      from TT_DUOC_CHUNGTU A
      join TT_DUOC_CHUNGTU_CHITIET B on B.CHUNGTU_ID = A.CHUNGTU_ID
      where B.DUOC_ID = $DUOC_ID$ and A.BENHVIEN_ID = '$BENHVIEN_ID$'
    </statement>
    <statement id="DAO00305_GetDuocPhaCheBaoChe" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
      select TOP 1 *
      from TM_DUOC_TYLEPHACHE
      where
      THANHPHAM_ID = $DUOC_ID$  OR NGUYENLIEU_ID = $DUOC_ID$      
    </statement>
    <statement id="DAO00305_GetBenhPham" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
      select * from TT_QUANLYBENHPHAM where QUANLYBENHPHAM_ID = $QUANLYBENHPHAM_ID$
    </statement>
    <statement id="DAO00305_GetClsKetQua" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
      select a.*, b.SOPHIEUYEUCAU from TT_CLSKETQUA a
      left join TT_DVYEUCAU b on a.DVYEUCAU_ID = b.DVYEUCAU_ID where a.CLSKETQUA_ID = $CLSKETQUA_ID$
    </statement>
    <statement id="DAO00305_GetNoiTru_KhamBenh" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
      select TOP 1 A.*, B.SOTHUTUTOA from TT_NOITRU_KHAMBENH A JOIN TT_NOITRU_TOATHUOC B ON A.KHAMBENH_ID = B.KHAMBENH_ID where A.KHAMBENH_ID = $KHAMBENH_ID$
    </statement>
    <statement id="DAO00305_GetVienPhiCanUpdateVienPhi" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
      select * from (
      select COUNT(*) OVER() as TOTALROWS,  ROW_NUMBER() OVER(order by B.SOBENHAN) as ROWNUMBER, * from
      (
      select distinct
      B.SOBENHAN, D.MAYTE, D.TENBENHNHAN, C.THOIGIANTIEPNHAN, CASE WHEN D.GIOITINH='1' THEN N'Nam' else N'Nữ' end as GIOITINH,
      case when D.NGAYSINH is null then convert(varchar(4),D.NAMSINH) else convert(varchar(10),D.NGAYSINH,103) end as NGAYSINH
      , B.BENHAN_ID, C.TIEPNHAN_ID, C.SOTIEPNHAN, D.DIACHILIENLAC, C.SOBHYT
      from TT_VIENPHI A
      join TT_NOITRU_BENHAN B on B.BENHAN_ID = A.BENHAN_ID
      join TT_TIEPNHAN C on C.TIEPNHAN_ID = B.TIEPNHAN_ID
      join TT_BENHNHAN D on D.BENHNHAN_ID = C.BENHNHAN_ID
      join TT_HOADON E on E.HOADON_ID = A.HOADON_ID
      where A.BENHNHAN_PHAITHANHTOAN > A.GIATRI_BENHNHAN_DATHANHTOAN and A.KHONGTHUTIEN = '0'
      and B.NGAYRAVIEN is not null and B.THOIGIANRAVIEN is not null
      and E.HOADON_ID IS NOT NULL and A.ACTIVE = '1'
      <isNotEmpty prepend="and" property="KEY">
        (D.MAYTE LIKE '%' + #KEY# + '%' OR D.TENBENHNHAN LIKE '%' + #KEY# + '%' OR B.SOBENHAN LIKE '%' + #KEY# + '%')
      </isNotEmpty>
      )B
      )A
      where A.ROWNUMBER between '$FROMROW$' and '$TOROW$'
    </statement>
    <statement id="DAO00305_UpdateVienPhiKhoaBenhAn" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
      update TT_VIENPHI
      set DATHANHTOAN = '1',
      DATHUCHIEN = '1',
      GIATRI_BENHNHAN_DATHANHTOAN = BENHNHAN_PHAITHANHTOAN
      where BENHAN_ID = $BENHAN_ID$
    </statement>
    <statement id="DAO00305_GetDetailVienPhi" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
      select distinct B.MADICHVU as MA, B.TENDICHVU as TEN, A.*
      from TT_VIENPHI A
      join TM_DICHVU B on B.DICHVU_ID = A.DICHVU_ID
      join TT_NOITRU_BENHAN C on C.BENHAN_ID = A.BENHAN_ID
      where A.BENHAN_ID = $BENHAN_ID$ and A.HOADON_ID is not null
      and A.BENHNHAN_PHAITHANHTOAN > A.GIATRI_BENHNHAN_DATHANHTOAN and A.KHONGTHUTIEN = '0' and A.ACTIVE = '1'
      and C.NGAYRAVIEN is not null and C.THOIGIANRAVIEN is not null and A.REF_ID != '0'
      union all
      select distinct B.MADUOC as MA, B.TENDUOCDAYDU as TEN, A.*
      from TT_VIENPHI A
      join TM_DUOC B on B.DUOC_ID = A.DUOC_ID
      join TT_NOITRU_BENHAN C on C.BENHAN_ID = A.BENHAN_ID
      where A.BENHAN_ID = $BENHAN_ID$ and A.HOADON_ID is not null
      and A.BENHNHAN_PHAITHANHTOAN > A.GIATRI_BENHNHAN_DATHANHTOAN and A.KHONGTHUTIEN = '0' and A.ACTIVE = '1'
      and C.NGAYRAVIEN is not null and C.THOIGIANRAVIEN is not null and A.REF_ID != '0'
      union all
      select distinct B.MAKHAUPHANAN as MA, B.TENKHAUPHANAN as TEN, A.*
      from TT_VIENPHI A
      join TM_NUT_KHAUPHANAN B on B.KHAUPHANAN_ID = A.DICHVU_ID
      join TT_NOITRU_BENHAN C on C.BENHAN_ID = A.BENHAN_ID
      where A.BENHAN_ID = $BENHAN_ID$ and A.HOADON_ID is not null
      and A.BENHNHAN_PHAITHANHTOAN > A.GIATRI_BENHNHAN_DATHANHTOAN and A.KHONGTHUTIEN = '0' and A.ACTIVE = '1'
      and C.NGAYRAVIEN is not null and C.THOIGIANRAVIEN is not null and A.REF_ID != '0'
    </statement>
    <!--Kiểm tra xóa danh mục dịch vụ-->
    <statement id="DAO00305_GetChiDinhDichVu" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
      select * from TT_DVYEUCAU where DICHVU_ID = $DICHVU_ID$
    </statement>
    <statement id="DAO00305_GetDichVuDonGia" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
      select * from TM_DICHVU_DONGIA where DICHVU_ID = $DICHVU_ID$
    </statement>
    <statement id="DAO00305_PhatSinhGiaTriChuan" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
      select * from TM_DICHVU_GIATRICHUAN where DICHVU_ID = $DICHVU_ID$
    </statement>
    <statement id="DAO00305_GetPatientLock" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
      select C.*, A.BENHAN_ID, A.TIEPNHAN_ID, A.SOBENHAN, B.THOIGIANTIEPNHAN, A.THOIGIANLAP, A.THOIGIANRAVIEN
      , case when C.GIOITINH = '1' THEN N'Nam' else N'Nữ' end AS GENDER
      from TT_NOITRU_BENHAN A
      join TT_TIEPNHAN B on A.TIEPNHAN_ID = B.TIEPNHAN_ID
      join TT_BENHNHAN C on C.BENHNHAN_ID = B.BENHNHAN_ID
      where (C.MAYTE LIKE '%' + #SEARCH_CONDITIONS# + '%' OR C.TENBENHNHAN LIKE '%' + #SEARCH_CONDITIONS# + '%' OR A.SOBENHAN LIKE '%' + #SEARCH_CONDITIONS# + '%')
    </statement>
    <statement id="DAO00305_LockPatient" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
      update TT_NOITRU_BENHAN set TRANGTHAI = 'DAKHOA', KHOABENHAN='1' where BENHAN_ID = $BENHAN_ID$ and TIEPNHAN_ID = $TIEPNHAN_ID$
      update TT_TIEPNHAN set TRANGTHAI='HOANTHANH' where TIEPNHAN_ID = $TIEPNHAN_ID$
    </statement>
    <statement id="DAO00305_UpdateVienPhiTiepnhan2BenhanNgoaiTru" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
      update TT_VIENPHI set BENHAN_ID = #BENHAN_ID#, DOTDIEUTRI_ID = #DOTDIEUTRI_ID#, NGAYCAPNHAT = #NGAYCAPNHAT#, NGUOICAPNHAT_ID = #NGUOICAPNHAT_ID#
      where TIEPNHAN_ID = #TIEPNHAN_ID# and VIENPHI_ID in ($LST_VIENPHI$)
    </statement>
    <statement id="DAO00305_UpdateNoitruNhapVien" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
      update TT_NOITRU_NHAPVIEN set
      SOBENHAN = #SOBENHAN#
      where TIEPNHAN_ID = $TIEPNHAN_ID$
    </statement>
    <statement id="DAO00305_GetBenhAn" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
      select * from TT_NOITRU_BENHAN where BENHAN_ID = $BENHAN_ID$ and BENHVIEN_ID = '$BENHVIEN_ID$'
    </statement>
    <statement id="DAO00305_GetList_VienPhi_ChuaThanhToan" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
      select count(*) as TOTAL
      from TT_NOITRU_BENHAN A
      inner join TT_VIENPHI B on A.BENHAN_ID = B.BENHAN_ID
      left join TT_NOITRU_KHAMBENH kb on kb.KHAMBENH_ID = B.KHAMBENH_ID
      where (B.HOADON_ID = 0 or B.HOADON_ID is null) and B.BENHNHAN_PHAITHANHTOAN > 0 and A.BENHAN_ID = '$BENHAN_ID$'
      and B.ACTIVE = '1' and B.KHONGTHUTIEN = '0' and B.SOLUONG > 0
      <isNotEmpty prepend="" property="THANHTOANVPKHONGLAYTOAMUANGOAI_RAVIEN">
        <isEqual prepend="and" property="THANHTOANVPKHONGLAYTOAMUANGOAI_RAVIEN" compareValue="True">
          ((B.REF_TABLE = 'TT_NOITRU_TOATHUOC' and kb.RAVIEN='0') or (B.REF_TABLE != 'TT_NOITRU_TOATHUOC' and kb.RAVIEN is null))
        </isEqual>
      </isNotEmpty>
    </statement>
    <statement id="DAO00305_GetListPhongBanKhoaNgoai" resultClass="DataObject">
      select A.*, B.DICTIONARY_CODE from TM_PHONGBAN A
      inner join LST_DICTIONARY B on A.LOAIPHONGBAN_ID = B.DICTIONARY_ID
      and B.DICTIONARY_TYPE_CODE = 'LoaiPhongBan'
      where A.TAMNGUNG = '0'
      and B.DICTIONARY_CODE = 'KhoaNgoai'
      order by A.TENPHONGBAN asc
    </statement>
    <statement id="DAO00305_GetListPhongBan_LoaiBenhAn" resultClass="DataObject">
      select a.*, b.DICTIONARY_NAME as TENLOAIBENHAN, b.DICTIONARY_NAME_EN, b.DICTIONARY_CODE, b.DICTIONARY_NAME
      from TM_PHONGBAN_LOAIBENHAN a
      join LST_DICTIONARY b on a.LOAIBENHAN_ID = b.DICTIONARY_ID and b.DICTIONARY_TYPE_CODE = 'LoaiBenhAn' and b.Enabled = '1'
      where a.PHONGBAN_ID = '$PHONGBAN_ID$' and isnull(a.TAMNGUNG,'0') = '0'
    </statement>
    <statement id="DAO00305_GetListLoaiBenhAn" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
      select
      DICTIONARY_ID as LOAIBENHAN_ID
      , DICTIONARY_NAME as TENLOAIBENHAN
      , DICTIONARY_NAME_EN
      , DICTIONARY_CODE
      , DICTIONARY_NAME
      from LST_DICTIONARY
      where LST_DICTIONARY.Enabled = '1' and DICTIONARY_TYPE_CODE = 'LoaiBenhAn'
      order by LST_DICTIONARY.IDX
    </statement>
    <statement id="DAO00305_GetListPhongBanKhoaNgoai_DaLieu" resultClass="DataObject">
      select A.*, B.DICTIONARY_CODE from TM_PHONGBAN A
      inner join LST_DICTIONARY B on A.LOAIPHONGBAN_ID = B.DICTIONARY_ID
      left join TM_PHONGBAN tren on tren.phongban_id = a.captren_id
      left join LST_DICTIONARY D on tren.LOAIPHONGBAN_ID = d.DICTIONARY_ID
      and B.DICTIONARY_TYPE_CODE = 'LoaiPhongBan'
      where A.TAMNGUNG = '0'
      and B.DICTIONARY_CODE = 'KhamBenh' and D.DICTIONARY_CODE = 'KhoaNoi'
      order by A.TENPHONGBAN asc
    </statement>
    <statement id="DAO00305_GetAllLoaiToaThuoc" resultClass="DataObject">
      declare @LOAITOATHUOC varchar(200)
      set @LOAITOATHUOC = (select top 1 LOAITOATHUOC = STUFF((SELECT ',' + LOAITOATHUOC FROM TM_TOATHUOC_NGOAITRU where BENHVIEN_ID = '$BENHVIEN_ID$' FOR XML PATH ('')), 1, 1, '')
      from TM_TOATHUOC_NGOAITRU)
      set @LOAITOATHUOC = '''' +  REPLACE(@LOAITOATHUOC,',',''',''') + ''''
      select @LOAITOATHUOC as LOAITOATHUOC
    </statement>
    <statement id="DAO00305_GetImagePhauThuat" resultClass="DataObject">
      select * from TT_PHAUTHUAT_IMAGES where PHAUTHUAT_ID = '$PHAUTHUAT_ID$' and CHONINMACDINH = '1'
    </statement>
  </statements>
</sqlMap>