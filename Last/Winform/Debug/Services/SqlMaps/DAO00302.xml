<?xml version="1.0" encoding="utf-8" ?>
<!--============================================================================
//	CAUTION: This file is generated by IBatisNetGen.3.SQLMap.cst at 10/3/2016 10:12:54 AM
//				Any manual editing will be lost in re-generation.
//===========================================================================-->
<sqlMap namespace="eHospital" xmlns="http://ibatis.apache.org/mapping" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
  <statements>
    <statement id="DAO00302_GetListDotDieuTri" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
      select *
      from TT_NOITRU_DOTDIEUTRI
      <dynamic prepend="where">
        <isParameterPresent>
          <isNotEmpty prepend="and" property="THONGTINTIMKIEM">
            (TT_NOITRU_DOTDIEUTRI.MADOTDIEUTRI LIKE '%' + #THONGTINTIMKIEM# + '%' OR TT_NOITRU_DOTDIEUTRI.TENDOTDIEUTRI LIKE '%' + #THONGTINTIMKIEM# + '%')
          </isNotEmpty>
          <isNotEmpty prepend="and" property="TENDOTDIEUTRI">
            TT_NOITRU_DOTDIEUTRI.TENDOTDIEUTRI = '$TENDOTDIEUTRI$'
          </isNotEmpty>
          <isNotEmpty prepend="and" property="BENHAN_ID">
            TT_NOITRU_DOTDIEUTRI.BENHAN_ID = $BENHAN_ID$
          </isNotEmpty>
          <isNotEmpty prepend="and" property="TUNGAY">
            TT_NOITRU_DOTDIEUTRI.TUNGAY = '$TUNGAY$'
          </isNotEmpty>
          <isNotEmpty prepend="and" property="DENNGAY">
            TT_NOITRU_DOTDIEUTRI.DENNGAY = '$DENNGAY$'
          </isNotEmpty>
        </isParameterPresent>
      </dynamic>
    </statement>
    <statement id="DAO00302_GetDotDieuTriGanNhat" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
      select top 1 tn.SOTIEPNHAN, tn.TIEPNHAN_ID, dt.*
      from TT_NOITRU_DOTDIEUTRI dt
      inner join TT_TIEPNHAN tn on tn.BENHNHAN_ID = dt.BENHNHAN_ID
      where dt.BENHAN_ID = $BENHAN_ID$
      order by dt.DOTDIEUTRI_ID desc
    </statement>
    <statement id="DAO00302_DongDot" parameterClass="System.Collections.IDictionary">
      UPDATE TT_NOITRU_DOTDIEUTRI SET
      TRANGTHAI = #TRANGTHAI#,
      NGUOICAPNHAT_ID = #NGUOICAPNHAT_ID#,
      NGAYCAPNHAT = #NGAYCAPNHAT#,
      DENNGAY = #DENNGAY#,
      THOIGIANDENNGAY = #THOIGIANDENNGAY#,
      TINHTRANG_ID = #TINHTRANG_ID#,
      KETQUADIEUTRI_ID = #KETQUADIEUTRI_ID#
      WHERE
      MADOTDIEUTRI = '$MADOTDIEUTRI$'
    </statement>
    <statement id="DAO00302_HuyDongDot" parameterClass="System.Collections.IDictionary">
      UPDATE TT_NOITRU_DOTDIEUTRI SET
      TRANGTHAI = #TRANGTHAI#,
      NGUOICAPNHAT_ID = #NGUOICAPNHAT_ID#,
      NGAYCAPNHAT = #NGAYCAPNHAT#,
      TINHTRANG_ID = #TINHTRANG_ID#,
      KETQUADIEUTRI_ID = #KETQUADIEUTRI_ID#
      WHERE
      MADOTDIEUTRI = '$MADOTDIEUTRI$'
    </statement>
    <statement id="DAO00302_SaveDotDieuTri" parameterClass="System.Collections.IDictionary" resultClass="System.Int64">
      insert into TT_NOITRU_DOTDIEUTRI (
      MADOTDIEUTRI
      , TENDOTDIEUTRI
      , BENHAN_ID
      , BENHNHAN_ID
      , TUNGAY
      , THOIGIANTUNGAY
      , DENNGAY
      , THOIGIANDENNGAY
      , BACSYDIEUTRI_ID
      , KHOADIEUTRI_ID
      , ICD_ID_DIEUTRI
      , CHANDOANDIEUTRI
      , PHUONGPHAPDIEUTRI
      , LOIDANBACSI
      , ICD_ID_RA
      , CHANDOANRA
      , NGAYTAIKHAM
      , THOIGIANTAIKHAM
      , TRANGTHAI
      , NGAYTAO
      , NGUOITAO_ID
      , NGAYCAPNHAT
      , NGUOICAPNHAT_ID
      , TINHTRANG_ID
      , KETQUADIEUTRI_ID
      ) values (
      #MADOTDIEUTRI#
      , #TENDOTDIEUTRI#
      , #BENHAN_ID#
      , #BENHNHAN_ID#
      , #TUNGAY#
      , #THOIGIANTUNGAY#
      , #DENNGAY#
      , #THOIGIANDENNGAY#
      , #BACSYDIEUTRI_ID#
      , #KHOADIEUTRI_ID#
      , #ICD_ID_DIEUTRI#
      , #CHANDOANDIEUTRI#
      , #PHUONGPHAPDIEUTRI#
      , #LOIDANBACSI#
      , #ICD_ID_RA#
      , #CHANDOANRA#
      , #NGAYTAIKHAM#
      , #THOIGIANTAIKHAM#
      , #TRANGTHAI#
      , #NGAYTAO#
      , #NGUOITAO_ID#
      , #NGAYCAPNHAT#
      , #NGUOICAPNHAT_ID#
      , #TINHTRANG_ID#
      , #KETQUADIEUTRI_ID#
      )
      select SCOPE_identity() as value
    </statement>
    <statement id="DAO00302_UpdateDotDieuTri" parameterClass="System.Collections.IDictionary">
      update TT_NOITRU_DOTDIEUTRI set
      TENDOTDIEUTRI = #TENDOTDIEUTRI#
      , BENHAN_ID = #BENHAN_ID#
      , BENHNHAN_ID = #BENHNHAN_ID#
      , TUNGAY = #TUNGAY#
      , THOIGIANTUNGAY = #THOIGIANTUNGAY#
      , DENNGAY = #DENNGAY#
      , THOIGIANDENNGAY = #THOIGIANDENNGAY#
      , BACSYDIEUTRI_ID = #BACSYDIEUTRI_ID#
      , KHOADIEUTRI_ID = #KHOADIEUTRI_ID#
      , ICD_ID_DIEUTRI = #ICD_ID_DIEUTRI#
      , CHANDOANDIEUTRI = #CHANDOANDIEUTRI#
      , PHUONGPHAPDIEUTRI = #PHUONGPHAPDIEUTRI#
      , LOIDANBACSI = #LOIDANBACSI#
      , ICD_ID_RA = #ICD_ID_RA#
      , CHANDOANRA = #CHANDOANRA#
      , NGAYTAIKHAM = #NGAYTAIKHAM#
      , THOIGIANTAIKHAM = #THOIGIANTAIKHAM#
      , TRANGTHAI = #TRANGTHAI#
      , NGAYTAO = #NGAYTAO#
      , NGUOITAO_ID = #NGUOITAO_ID#
      , NGAYCAPNHAT = #NGAYCAPNHAT#
      , NGUOICAPNHAT_ID = #NGUOICAPNHAT_ID#
      , TINHTRANG_ID = #TINHTRANG_ID#
      , KETQUADIEUTRI_ID = #KETQUADIEUTRI_ID#
      where
      MADOTDIEUTRI = '$MADOTDIEUTRI$'
    </statement>
    <statement id="DAO00302_GetDotDieuTriDaDongGanNhat" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
      select top 1 *
      from TT_NOITRU_DOTDIEUTRI
      where BENHAN_ID = $BENHAN_ID$ and TRANGTHAI = '1'
      order by DOTDIEUTRI_ID desc
    </statement>
    <statement id="DAO00302_GetTrangThaiDotDieuTriGanNhat" parameterClass="System.Collections.IDictionary" resultClass="System.Int32">
      select top 1 isnull(TRANGTHAI, 0) TRANGTHAI
      from TT_NOITRU_DOTDIEUTRI
      where BENHAN_ID = $BENHAN_ID$
      order by DOTDIEUTRI_ID desc
    </statement>
    <statement id="DAO00302_UpdateXacNhanBHYT" parameterClass="System.Collections.IDictionary" resultClass="System.Int32">
      UPDATE TT_NOITRU_DOTDIEUTRI SET
      DAXACNHAN_BHYT = #DAXACNHAN_BHYT#,
      NGAYCAPNHAT = #NGAYCAPNHAT#,
      NGUOICAPNHAT_ID = #NGUOICAPNHAT_ID#
      WHERE
      MADOTDIEUTRI = '$MADOTDIEUTRI$'
    </statement>
    <statement id="DAO00302_KiemTraDaXacNhanBHYT" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
      select dt.MADOTDIEUTRI, dt.DAXACNHAN_BHYT
      from TT_NOITRU_DOTDIEUTRI dt
      inner join TT_NOITRU_BENHAN ba on ba.BENHAN_ID = dt.BENHAN_ID
      inner join TT_TIEPNHAN tn on tn.TIEPNHAN_ID = ba.TIEPNHAN_ID
      inner join TT_VIENPHI vp on vp.DOTDIEUTRI_ID = dt.DOTDIEUTRI_ID
      left join TT_DVYEUCAU dvyc on dvyc.DVYEUCAU_ID = vp.REF_ID
      where dt.BENHAN_ID = $BENHAN_ID$
      and (tn.SOBHYT is not null and tn.SOBHYT != '') and dt.DAXACNHAN_BHYT is null and vp.BHYT_THANHTIEN_CHITRA > 0
      and dvyc.HUYYEUCAU = '0'
      <isNotEmpty prepend="and" property="MADOTDIEUTRI">
        dt.MADOTDIEUTRI = '$MADOTDIEUTRI$'
      </isNotEmpty>
    </statement>
    <statement id="DAO00302_UpdateBenhAnRaVien" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
      UPDATE TT_NOITRU_BENHAN SET
      TRANGTHAI = #TRANGTHAIXUATVIEN#,
      NGAYRAVIEN = #NGAYRAVIEN#,
      THOIGIANVAOVIEN = #THOIGIANVAOVIEN#
      WHERE BENHAN_ID = $BENHAN_ID$
    </statement>
    <statement id="DAO00302_RaVienDongDot" parameterClass="System.Collections.IDictionary">
      UPDATE TT_NOITRU_DOTDIEUTRI SET
      TRANGTHAI = #TRANGTHAI#,
      DENNGAY = #DENNGAY#,
      THOIGIANDENNGAY = #THOIGIANDENNGAY#,
      NGUOICAPNHAT_ID = #NGUOICAPNHAT_ID#,
      NGAYCAPNHAT = #NGAYCAPNHAT#
      WHERE
      BENHAN_ID = '$BENHAN_ID$' and DOTDIEUTRI_ID = '$DOTDIEUTRI_ID$'
    </statement>
  </statements>
</sqlMap>
