<?xml version="1.0" encoding="utf-8" ?>
<sqlMap namespace="eHospital" xmlns="http://ibatis.apache.org/mapping" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
  <!--DuyTK8-->
  <statements>
    <statement id="DAO00329_GetList_BenhNhan_KSK" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
      select * from(select COUNT(*) OVER() as TOTALROWS,ROW_NUMBER() OVER (ORDER BY a.MAYTE) as ROWNUMBER, * from
      (SELECT distinct BN.MAYTE,BN.TENBENHNHAN,BN.BENHNHAN_ID,BNDV.TIEPNHAN_ID,DV.MADICHVU
      ,Case when BN.GIOITINH =1 then N'Nam' else N'Nữ' end as GIOITINH,BNDV.DVYEUCAU_ID,BNDV.PHONGBAN_ID as NOITHUCHIEN_ID
      ,CONVERT(varchar(20), BN.NGAYSINH, 103) AS NGAYSINH,DV.TENDICHVU,PB.TENPHONGBAN as TENPHONGKHAM,CT.TENCONGTY,BNDV.SOPHIEUYEUCAU
      ,HD.SO_HD,TN.SOTIEPNHAN,TN.NGUOITAO_ID,BNDV.DICHVU_ID
      FROM TT_KSK_CONGTY CT
      left join TT_KSK_HOPDONG HD ON HD.CONGTY_ID=CT.CONGTY_ID
      left join TT_KSK_HOPDONG_BENHNHAN BN ON BN.HOPDONG_ID=HD.HOPDONG_ID
      left join TT_KSK_HOPDONG_BENHNHAN_DICHVU BNDV ON BNDV.HOPDONG_BENHNHAN_ID=BN.HOPDONG_BENHNHAN_ID
      left join TT_KSK_HOPDONG_GOIDICHVU GDV ON GDV.HOPDONG_ID= BN.HOPDONG_ID
      left join TM_DICHVU DV ON DV.DICHVU_ID=BNDV.DICHVU_ID
      left join TM_PHONGBAN PB ON PB.PHONGBAN_ID=BNDV.PHONGBAN_ID
      join TT_TIEPNHAN TN ON TN.TIEPNHAN_ID=BNDV.TIEPNHAN_ID
      where BNDV.TRANGTHAI='DAXACNHAN' AND HD.BENHVIEN_ID = '$BENHVIEN_ID$' AND BNDV.PHONGBAN_ID='$PHONGBAN_ID$'
      AND (TN.NGAYTIEPNHAN BETWEEN CONVERT(DATE,'$TUNGAY$') AND CONVERT(DATE,'$DENNGAY$'))
      <!--AND BNDV.DATHUCHIEN IS NULL-->
      <isNotEmpty prepend="" property="TRANGTHAI">
        <isEqual prepend="AND" property="TRANGTHAI" compareValue="IS NOT NULL">
          BNDV.DATHUCHIEN IS NOT NULL
        </isEqual>
        <isEqual prepend="AND" property="TRANGTHAI" compareValue="IS NULL">
          BNDV.DATHUCHIEN IS NULL
        </isEqual>
      </isNotEmpty>
      )a )b
      where b.ROWNUMBER between '$FROMROW$' AND '$TOROW$'
    </statement>

    <statement id="DAO00329_Search_BenhNhan_KSK" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
      select * from(select COUNT(*) OVER() as TOTALROWS,ROW_NUMBER() OVER (ORDER BY a.MAYTE) as ROWNUMBER, * from
      (SELECT distinct BN.MAYTE,BN.TENBENHNHAN,BN.BENHNHAN_ID,BNDV.TIEPNHAN_ID,DV.MADICHVU,DV.DICHVU_ID,TN.SOTIEPNHAN
      ,BNDV.DVYEUCAU_ID,BNDV.PHONGBAN_ID AS NOITHUCHIEN_ID,BNDV.SOPHIEUYEUCAU
      ,Case when BN.GIOITINH =1 then N'Nam' else N'Nữ' end as GIOITINH
      ,CONVERT(varchar(20), BN.NGAYSINH, 103) AS NGAYSINH,DV.TENDICHVU,PB.TENPHONGBAN as TENPHONGKHAM,CT.TENCONGTY,HD.SO_HD
      FROM TT_KSK_CONGTY CT
      left join TT_KSK_HOPDONG HD ON HD.CONGTY_ID=CT.CONGTY_ID
      left join TT_KSK_HOPDONG_BENHNHAN BN ON BN.HOPDONG_ID=HD.HOPDONG_ID
      left join TT_KSK_HOPDONG_BENHNHAN_DICHVU BNDV ON BNDV.HOPDONG_BENHNHAN_ID=BN.HOPDONG_BENHNHAN_ID
      left join TT_KSK_HOPDONG_GOIDICHVU GDV ON GDV.HOPDONG_ID= BN.HOPDONG_ID
      left join TM_DICHVU DV ON DV.DICHVU_ID=BNDV.DICHVU_ID
      left join TM_PHONGBAN PB ON PB.PHONGBAN_ID=BNDV.PHONGBAN_ID
      join TT_TIEPNHAN TN ON TN.TIEPNHAN_ID= BNDV.TIEPNHAN_ID
      <dynamic prepend="where">
        (TN.NGAYTIEPNHAN BETWEEN CONVERT(DATE,'$TUNGAY$') AND CONVERT(DATE,'$DENNGAY$'))
        AND BNDV.PHONGBAN_ID='$PHONGBAN_ID$' AND
        <isParameterPresent>
          <isNotEmpty prepend="and" property="KEYHD">
            HD.SO_HD = '$KEYHD$'
          </isNotEmpty>
          <isNotEmpty prepend="and" property="KEYPK">
            BNDV.PHONGBAN_ID='$KEYPK$'
          </isNotEmpty>
          <isNotEmpty prepend="" property="TRANGTHAI">
            <isEqual prepend="AND" property="TRANGTHAI" compareValue="IS NOT NULL">
              BNDV.DATHUCHIEN IS NOT NULL
            </isEqual>
            <isEqual prepend="AND" property="TRANGTHAI" compareValue="IS NULL">
              BNDV.DATHUCHIEN IS NULL
            </isEqual>
          </isNotEmpty>
          <isNotEmpty prepend="and" property="TEN_BENHNHANID">
            BN.TENBENHNHAN like N'%$TEN_BENHNHANID$%'
          </isNotEmpty>
          <isNotEmpty prepend="OR" property="MAYTE">
            BN.MAYTE='$MAYTE$'
          </isNotEmpty>
        </isParameterPresent>
        )a )b  where b.ROWNUMBER between '$FROMROW$' AND '$TOROW$'
      </dynamic>
    </statement>

    <statement id="DAO00329_GetList_BenhNhan_KQ" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
      select * from(select COUNT(*) OVER() as TOTALROWS,ROW_NUMBER() OVER (ORDER BY a.TENBENHNHAN) as ROWNUMBER, * from
      (SELECT distinct BN.MAYTE,BN.TENBENHNHAN,BN.BENHNHAN_ID,BNDV.TIEPNHAN_ID
      ,Case when BN.GIOITINH =1 then N'Nam' else N'Nữ' end as GIOITINH
      ,CONVERT(varchar(20), BN.NGAYSINH, 103) AS NGAYSINH,CT.TENCONGTY
      ,HD.SO_HD,TN.SOTIEPNHAN
      FROM TT_KSK_CONGTY CT
      left join TT_KSK_HOPDONG HD ON HD.CONGTY_ID=CT.CONGTY_ID
      left join TT_KSK_HOPDONG_BENHNHAN BN ON BN.HOPDONG_ID=HD.HOPDONG_ID
      left join TT_KSK_HOPDONG_BENHNHAN_DICHVU BNDV ON BNDV.HOPDONG_BENHNHAN_ID=BN.HOPDONG_BENHNHAN_ID
      left join TT_KSK_HOPDONG_GOIDICHVU GDV ON GDV.HOPDONG_ID= BN.HOPDONG_ID
      left join TM_DICHVU DV ON DV.DICHVU_ID=BNDV.DICHVU_ID
      left join TM_PHONGBAN PB ON PB.PHONGBAN_ID=BNDV.PHONGBAN_ID
      left join TT_TIEPNHAN TN ON TN.TIEPNHAN_ID=BNDV.TIEPNHAN_ID
      left join TT_KSK_KETQUA KQ ON KQ.HOPDONG_BENHNHAN_ID=BNDV.HOPDONG_BENHNHAN_ID
      group by BN.MAYTE,BN.TENBENHNHAN,BN.BENHNHAN_ID,BNDV.TIEPNHAN_ID,BN.GIOITINH,BN.NGAYSINH,KQ.TRANGTHAI,BNDV.DATHUCHIEN
      ,CT.TENCONGTY,HD.SO_HD,TN.SOTIEPNHAN  HAVING KQ.TRANGTHAI $TRANGTHAI$ AND BNDV.DATHUCHIEN IS NOT NULL AND BNDV.TIEPNHAN_ID IS NOT NULL)a )b
      where b.ROWNUMBER between '$FROMROW$' AND '$TOROW$'
    </statement>

    <statement id="DAO00329_Search_BenhNhan_KQ" parameterClass="System.Collections.IDictionary" resultClass="DataObject">

      select * from(select COUNT(*) OVER() as TOTALROWS,ROW_NUMBER() OVER (ORDER BY a.TENBENHNHAN) as ROWNUMBER, * from
      (SELECT distinct BN.MAYTE,BN.TENBENHNHAN,BN.BENHNHAN_ID,BNDV.TIEPNHAN_ID
      ,Case when BN.GIOITINH =1 then N'Nam' else N'Nữ' end as GIOITINH
      ,CONVERT(varchar(20), BN.NGAYSINH, 103) AS NGAYSINH,CT.TENCONGTY
      ,HD.SO_HD,TN.SOTIEPNHAN
      FROM TT_KSK_CONGTY CT
      left join TT_KSK_HOPDONG HD ON HD.CONGTY_ID=CT.CONGTY_ID
      left join TT_KSK_HOPDONG_BENHNHAN BN ON BN.HOPDONG_ID=HD.HOPDONG_ID
      left join TT_KSK_HOPDONG_BENHNHAN_DICHVU BNDV ON BNDV.HOPDONG_BENHNHAN_ID=BN.HOPDONG_BENHNHAN_ID
      left join TT_KSK_HOPDONG_GOIDICHVU GDV ON GDV.HOPDONG_ID= BN.HOPDONG_ID
      left join TM_DICHVU DV ON DV.DICHVU_ID=BNDV.DICHVU_ID
      left join TM_PHONGBAN PB ON PB.PHONGBAN_ID=BNDV.PHONGBAN_ID
      left join TT_TIEPNHAN TN ON TN.TIEPNHAN_ID=BNDV.TIEPNHAN_ID
      left join TT_KSK_KETQUA KQ ON KQ.HOPDONG_BENHNHAN_ID=BNDV.HOPDONG_BENHNHAN_ID
      <dynamic prepend="where">
        CONVERT(DATE,TN.NGAYTIEPNHAN) BETWEEN CONVERT(DATE,'$TUNGAY$')
        AND CONVERT(DATE,'$DENNGAY$') AND
        <isParameterPresent>
          <isNotEmpty prepend="and" property="TEN_BENHNHANID">
            BN.TENBENHNHAN like N'%$TEN_BENHNHANID$%'
          </isNotEmpty>
          <isNotEmpty prepend="and" property="KEYHD">
            HD.SO_HD = '$KEYHD$'
          </isNotEmpty>
          <isNotEmpty prepend="and" property="BENHVIEN_ID">
            HD.BENHVIEN_ID = '$BENHVIEN_ID$'
          </isNotEmpty>
        </isParameterPresent>
        group by BN.MAYTE,BN.TENBENHNHAN,BN.BENHNHAN_ID,BNDV.TIEPNHAN_ID,BN.GIOITINH,BN.NGAYSINH,KQ.TRANGTHAI,BNDV.DATHUCHIEN
        ,CT.TENCONGTY,HD.SO_HD,TN.SOTIEPNHAN
        HAVING KQ.TRANGTHAI $TRANGTHAI$ AND BNDV.DATHUCHIEN IS NOT NULL AND BNDV.TIEPNHAN_ID IS NOT NULL)a )b
        where b.ROWNUMBER between '$FROMROW$' AND '$TOROW$'
      </dynamic>

    </statement>

    <statement id="DAO00329_Update_NoiThucHien" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
      UPDATE TT_KSK_HOPDONG_BENHNHAN_DICHVU  SET TT_KSK_HOPDONG_BENHNHAN_DICHVU.PHONGBAN_ID= $NOITHUCHIEN_ID$
      where TT_KSK_HOPDONG_BENHNHAN_DICHVU.BENHVIEN_ID= '$BENHVIEN_ID$' AND TT_KSK_HOPDONG_BENHNHAN_DICHVU.SOPHIEUYEUCAU='$SOPHIEUYEUCAU$' AND TT_KSK_HOPDONG_BENHNHAN_DICHVU.TIEPNHAN_ID= $TIEPNHAN_ID$
    </statement>

    <statement id="DAO00329_GETKETQUA_NOI" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
      SELECT * FROM TT_KSK_KETQUA_NOI
      where HOPDONG_ID=$HOPDONG_ID$ AND HOPDONG_BENHNHAN_ID=$HOPDONG_BENHNHAN_ID$ AND BENHVIEN_ID='$BENHVIEN_ID$'
    </statement>

    <statement id="DAO00329_Insert_KETQUA_NOI" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
      INSERT INTO TT_KSK_KETQUA_NOI
      (HOPDONG_ID,HOPDONG_BENHNHAN_ID,TUANHOAN,PLTUANHOAN_ID,HOHAP,PLHOHAP_ID,TIEUHOA,PLTIEUHOA_ID,
      THAN,PLTHAN_ID,NOITIET,PLNOITIET_ID,COXUONGKHOP,PLCOXUONGKHOP_ID,THANKINH,PLTHANKINH_ID,TAMTHAN,
      PLTAMTHAN_ID,BACSIKHAMNOI_ID,BENHVIEN_ID,NGAYTAO,NGUOITAO_ID,NGAYCAPNHAT,NGUOICAPNHAT_ID)
      VALUES
      (#HOPDONG_ID#,#HOPDONG_BENHNHAN_ID#,#TUANHOAN#,#PLTUANHOAN_ID#,#HOHAP#,#PLHOHAP_ID#,#TIEUHOA#
      ,#PLTIEUHOA_ID#,#THAN#,#PLTHAN_ID#,#NOITIET#,#PLNOITIET_ID#,#COXUONGKHOP#,#PLCOXUONGKHOP_ID#,#THANKINH#
      ,#PLTHANKINH_ID#,#TAMTHAN#,#PLTAMTHAN_ID#,#BACSIKHAMNOI_ID#,#BENHVIEN_ID#,#NGAYTAO#,#NGUOITAO_ID#,#NGAYCAPNHAT#,#NGUOICAPNHAT_ID#)
    </statement>

    <statement id="DAO00329_Update_KETQUA_NOI" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
      UPDATE TT_KSK_KETQUA_NOI
      SET HOPDONG_ID = #HOPDONG_ID#,HOPDONG_BENHNHAN_ID = #HOPDONG_BENHNHAN_ID#,TUANHOAN = #TUANHOAN#,PLTUANHOAN_ID = #PLTUANHOAN_ID#
      ,HOHAP = #HOHAP#,PLHOHAP_ID = #PLHOHAP_ID#,TIEUHOA = #TIEUHOA#,PLTIEUHOA_ID = #PLTIEUHOA_ID#,THAN = #THAN#
      ,PLTHAN_ID = #PLTHAN_ID#,NOITIET = #NOITIET#,PLNOITIET_ID = #PLNOITIET_ID#,COXUONGKHOP = #COXUONGKHOP#
      ,PLCOXUONGKHOP_ID = #PLCOXUONGKHOP_ID#,THANKINH = #THANKINH#,PLTHANKINH_ID = #PLTHANKINH_ID#,TAMTHAN = #TAMTHAN#
      ,PLTAMTHAN_ID = #PLTAMTHAN_ID#,BACSIKHAMNOI_ID = #BACSIKHAMNOI_ID#,BENHVIEN_ID = #BENHVIEN_ID#,NGAYTAO = #NGAYTAO#
      ,NGUOITAO_ID = #NGUOITAO_ID#,NGAYCAPNHAT = #NGAYCAPNHAT#,NGUOICAPNHAT_ID = #NGUOICAPNHAT_ID#
      WHERE HOPDONG_ID = $HOPDONG_ID$ AND HOPDONG_BENHNHAN_ID = $HOPDONG_BENHNHAN_ID$ AND BENHVIEN_ID='$BENHVIEN_ID$'
    </statement>

    <statement id="DAO00329_GETKETQUA_NGOAI" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
      SELECT * FROM TT_KSK_KETQUA_NGOAI
      where HOPDONG_ID=$HOPDONG_ID$ AND HOPDONG_BENHNHAN_ID=$HOPDONG_BENHNHAN_ID$ AND BENHVIEN_ID='$BENHVIEN_ID$'
    </statement>

    <statement id="DAO00329_Insert_KETQUA_NGOAI" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
      INSERT INTO TT_KSK_KETQUA_NGOAI
      (HOPDONG_ID,HOPDONG_BENHNHAN_ID,NGOAIKHOA,PLNGOAIKHOA_ID,BACSINGOAIKHOA_ID
      ,BENHVIEN_ID,NGAYTAO,NGUOITAO_ID,NGAYCAPNHAT,NGUOICAPNHAT_ID)
      VALUES
      (#HOPDONG_ID#,#HOPDONG_BENHNHAN_ID#,#NGOAIKHOA#,#PLNGOAIKHOA_ID#,#BACSINGOAIKHOA_ID#
      ,#BENHVIEN_ID#,#NGAYTAO#,#NGUOITAO_ID#,#NGAYCAPNHAT#,#NGUOICAPNHAT_ID#)
    </statement>

    <statement id="DAO00329_Update_KETQUA_NGOAI" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
      UPDATE TT_KSK_KETQUA_NGOAI
      SET HOPDONG_ID = #HOPDONG_ID#,HOPDONG_BENHNHAN_ID = #HOPDONG_BENHNHAN_ID#,NGOAIKHOA = #NGOAIKHOA#
      ,PLNGOAIKHOA_ID = #PLNGOAIKHOA_ID#,BACSINGOAIKHOA_ID = #BACSINGOAIKHOA_ID#,BENHVIEN_ID = #BENHVIEN_ID#
      ,NGAYTAO = #NGAYTAO#,NGUOITAO_ID = #NGUOITAO_ID#,NGAYCAPNHAT = #NGAYCAPNHAT#,NGUOICAPNHAT_ID = #NGUOICAPNHAT_ID#
      WHERE HOPDONG_ID = $HOPDONG_ID$ AND HOPDONG_BENHNHAN_ID = $HOPDONG_BENHNHAN_ID$ AND BENHVIEN_ID='$BENHVIEN_ID$'
    </statement>

    <statement id="DAO00329_GETKETQUA_PHUKHOA" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
      SELECT * FROM TT_KSK_KETQUA_PHUKHOA
      where HOPDONG_ID=$HOPDONG_ID$ AND HOPDONG_BENHNHAN_ID=$HOPDONG_BENHNHAN_ID$ AND BENHVIEN_ID='$BENHVIEN_ID$'
    </statement>

    <statement id="DAO00329_Insert_KETQUA_PHUKHOA" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
      INSERT INTO TT_KSK_KETQUA_PHUKHOA
      (HOPDONG_ID,HOPDONG_BENHNHAN_ID,SANPHUKHOA,PLSANPHUKHOA_ID,BACSISANPHUKHOA_ID, PHUKHOA, NHUBO, PLPHUKHOA_ID, PLNHUBO_ID
      ,BENHVIEN_ID,NGAYTAO,NGUOITAO_ID,NGAYCAPNHAT,NGUOICAPNHAT_ID)
      VALUES
      (#HOPDONG_ID#,#HOPDONG_BENHNHAN_ID#,#SANPHUKHOA#,#PLSANPHUKHOA_ID#,#BACSISANPHUKHOA_ID#, #PHUKHOA#, #NHUBO#, #PLPHUKHOA_ID#, #PLNHUBO_ID#
      ,#BENHVIEN_ID#,#NGAYTAO#,#NGUOITAO_ID#,#NGAYCAPNHAT#,#NGUOICAPNHAT_ID#)
    </statement>

    <statement id="DAO00329_Update_KETQUA_PHUKHOA" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
      UPDATE TT_KSK_KETQUA_PHUKHOA
      SET HOPDONG_ID = #HOPDONG_ID#,HOPDONG_BENHNHAN_ID = #HOPDONG_BENHNHAN_ID#,SANPHUKHOA = #SANPHUKHOA#
      ,PLSANPHUKHOA_ID = #PLSANPHUKHOA_ID#,BACSISANPHUKHOA_ID = #BACSISANPHUKHOA_ID#,BENHVIEN_ID = #BENHVIEN_ID#
      ,NGAYTAO = #NGAYTAO#,NGUOITAO_ID = #NGUOITAO_ID#,NGAYCAPNHAT = #NGAYCAPNHAT#,NGUOICAPNHAT_ID = #NGUOICAPNHAT_ID#
      , PHUKHOA = #PHUKHOA#, NHUBO = #NHUBO#, PLPHUKHOA_ID = #PLPHUKHOA_ID#, PLNHUBO_ID = #PLNHUBO_ID#
      WHERE HOPDONG_ID = $HOPDONG_ID$ AND HOPDONG_BENHNHAN_ID = $HOPDONG_BENHNHAN_ID$ AND BENHVIEN_ID='$BENHVIEN_ID$'
    </statement>

    <statement id="DAO00329_GETKETQUA_MAT" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
      SELECT * FROM TT_KSK_KETQUA_MAT
      where HOPDONG_ID=$HOPDONG_ID$ AND HOPDONG_BENHNHAN_ID=$HOPDONG_BENHNHAN_ID$ AND BENHVIEN_ID='$BENHVIEN_ID$'
    </statement>

    <statement id="DAO00329_Insert_KETQUA_MAT" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
      INSERT INTO TT_KSK_KETQUA_MAT
      (HOPDONG_ID,HOPDONG_BENHNHAN_ID,COKINHMATTRAI,COKINHMATPHAI,KHONGKINHMATTRAI
      ,KHONGKINHMATPHAI,CACBENHVEMAT,PLMAT_ID,BACSIMAT_ID,BENHVIEN_ID,NGAYTAO
      ,NGUOITAO_ID,NGAYCAPNHAT,NGUOICAPNHAT_ID)
      VALUES
      (#HOPDONG_ID#,#HOPDONG_BENHNHAN_ID#,#COKINHMATTRAI#,#COKINHMATPHAI#,#KHONGKINHMATTRAI#
      ,#KHONGKINHMATPHAI#,#CACBENHVEMAT#,#PLMAT_ID#,#BACSIMAT_ID#,#BENHVIEN_ID#
      ,#NGAYTAO#,#NGUOITAO_ID#,#NGAYCAPNHAT#,#NGUOICAPNHAT_ID#)
    </statement>

    <statement id="DAO00329_Update_KETQUA_MAT" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
      UPDATE TT_KSK_KETQUA_MAT
      SET HOPDONG_ID = #HOPDONG_ID#,HOPDONG_BENHNHAN_ID = #HOPDONG_BENHNHAN_ID#,COKINHMATTRAI = #COKINHMATTRAI#
      ,COKINHMATPHAI = #COKINHMATPHAI#,KHONGKINHMATTRAI = #KHONGKINHMATTRAI#,KHONGKINHMATPHAI = #KHONGKINHMATPHAI#
      ,CACBENHVEMAT = #CACBENHVEMAT#,PLMAT_ID = #PLMAT_ID#,BACSIMAT_ID = #BACSIMAT_ID#,BENHVIEN_ID = #BENHVIEN_ID#
      ,NGAYTAO = #NGAYTAO#,NGUOITAO_ID = #NGUOITAO_ID#,NGAYCAPNHAT = #NGAYCAPNHAT#,NGUOICAPNHAT_ID = #NGUOICAPNHAT_ID#
      WHERE HOPDONG_ID = $HOPDONG_ID$ AND HOPDONG_BENHNHAN_ID = $HOPDONG_BENHNHAN_ID$ AND BENHVIEN_ID='$BENHVIEN_ID$'
    </statement>

    <statement id="DAO00329_GETKETQUA_RHM" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
      SELECT * FROM TT_KSK_KETQUA_RHM
      where HOPDONG_ID=$HOPDONG_ID$ AND HOPDONG_BENHNHAN_ID=$HOPDONG_BENHNHAN_ID$ AND BENHVIEN_ID='$BENHVIEN_ID$'
    </statement>

    <statement id="DAO00329_Insert_KETQUA_RHM" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
      INSERT INTO TT_KSK_KETQUA_RHM
      (HOPDONG_ID,HOPDONG_BENHNHAN_ID,HAMTREN,HAMDUOI,CACBENHVERHM,PLRHM_ID
      ,BACSIRHM_ID,BENHVIEN_ID,NGAYTAO,NGUOITAO_ID,NGAYCAPNHAT,NGUOICAPNHAT_ID)
      VALUES
      (#HOPDONG_ID#,#HOPDONG_BENHNHAN_ID#,#HAMTREN#,#HAMDUOI#,#CACBENHVERHM#,#PLRHM_ID#
      ,#BACSIRHM_ID#,#BENHVIEN_ID#,#NGAYTAO#,#NGUOITAO_ID#,#NGAYCAPNHAT#,#NGUOICAPNHAT_ID#)
    </statement>

    <statement id="DAO00329_Update_KETQUA_RHM" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
      UPDATE TT_KSK_KETQUA_RHM
      SET HOPDONG_ID = #HOPDONG_ID#,HOPDONG_BENHNHAN_ID = #HOPDONG_BENHNHAN_ID#,HAMTREN = #HAMTREN#,HAMDUOI = #HAMDUOI#
      ,CACBENHVERHM = #CACBENHVERHM#,PLRHM_ID = #PLRHM_ID#,BACSIRHM_ID = #BACSIRHM_ID#,BENHVIEN_ID = #BENHVIEN_ID#
      ,NGAYTAO = #NGAYTAO#,NGUOITAO_ID = #NGUOITAO_ID#,NGAYCAPNHAT = #NGAYCAPNHAT#,NGUOICAPNHAT_ID = #NGUOICAPNHAT_ID#
      WHERE HOPDONG_ID = $HOPDONG_ID$ AND HOPDONG_BENHNHAN_ID = $HOPDONG_BENHNHAN_ID$ AND BENHVIEN_ID='$BENHVIEN_ID$'
    </statement>

    <statement id="DAO00329_GETKETQUA_TMH" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
      SELECT * FROM TT_KSK_KETQUA_TMH
      where HOPDONG_ID=$HOPDONG_ID$ AND HOPDONG_BENHNHAN_ID=$HOPDONG_BENHNHAN_ID$ AND BENHVIEN_ID='$BENHVIEN_ID$'
    </statement>

    <statement id="DAO00329_Insert_KETQUA_TMH" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
      INSERT INTO TT_KSK_KETQUA_TMH
      (HOPDONG_ID,HOPDONG_BENHNHAN_ID,TAITRAINOITHUONG,TAITRAINOITHAM,TAIPHAINOITHUONG,TAIPHAINOITHAM
      ,CACBENHVETAI,PLTAIMH_ID,BACSITMH_ID,BENHVIEN_ID,NGAYTAO,NGUOITAO_ID,NGAYCAPNHAT,NGUOICAPNHAT_ID)
      VALUES
      (#HOPDONG_ID#,#HOPDONG_BENHNHAN_ID#,#TAITRAINOITHUONG#,#TAITRAINOITHAM#,#TAIPHAINOITHUONG#,#TAIPHAINOITHAM#
      ,#CACBENHVETAI#,#PLTAIMH_ID#,#BACSITMH_ID#,#BENHVIEN_ID#,#NGAYTAO#,#NGUOITAO_ID#,#NGAYCAPNHAT#,#NGUOICAPNHAT_ID#)
    </statement>

    <statement id="DAO00329_Update_KETQUA_TMH" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
      UPDATE TT_KSK_KETQUA_TMH
      SET HOPDONG_ID = #HOPDONG_ID#,HOPDONG_BENHNHAN_ID = #HOPDONG_BENHNHAN_ID#,TAITRAINOITHUONG = #TAITRAINOITHUONG#,TAITRAINOITHAM = #TAITRAINOITHAM#
      ,TAIPHAINOITHUONG = #TAIPHAINOITHUONG#,TAIPHAINOITHAM = #TAIPHAINOITHAM#,CACBENHVETAI = #CACBENHVETAI#,PLTAIMH_ID = #PLTAIMH_ID#
      ,BACSITMH_ID = #BACSITMH_ID#,BENHVIEN_ID = #BENHVIEN_ID#,NGAYTAO = #NGAYTAO#,NGUOITAO_ID = #NGUOITAO_ID#,NGAYCAPNHAT = #NGAYCAPNHAT#,NGUOICAPNHAT_ID = #NGUOICAPNHAT_ID#
      WHERE HOPDONG_ID = $HOPDONG_ID$ AND HOPDONG_BENHNHAN_ID = $HOPDONG_BENHNHAN_ID$ AND BENHVIEN_ID='$BENHVIEN_ID$'
    </statement>

    <statement id="DAO00329_GETKETQUA_DALIEU" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
      SELECT * FROM TT_KSK_KETQUA_DALIEU
      where HOPDONG_ID=$HOPDONG_ID$ AND HOPDONG_BENHNHAN_ID=$HOPDONG_BENHNHAN_ID$ AND BENHVIEN_ID='$BENHVIEN_ID$'
    </statement>

    <statement id="DAO00329_Insert_KETQUA_DALIEU" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
      INSERT INTO TT_KSK_KETQUA_DALIEU
      (HOPDONG_ID,HOPDONG_BENHNHAN_ID,DALIEU,PLDALIEU_ID,BACSIDALIEU_ID,BENHVIEN_ID
      ,NGAYTAO,NGUOITAO_ID,NGAYCAPNHAT,NGUOICAPNHAT_ID)
      VALUES
      (#HOPDONG_ID#,#HOPDONG_BENHNHAN_ID#,#DALIEU#,#PLDALIEU_ID#,#BACSIDALIEU_ID#
      ,#BENHVIEN_ID#,#NGAYTAO#,#NGUOITAO_ID#,#NGAYCAPNHAT#,#NGUOICAPNHAT_ID#)
    </statement>

    <statement id="DAO00329_Update_KETQUA_DALIEU" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
      UPDATE TT_KSK_KETQUA_DALIEU
      SET HOPDONG_ID = #HOPDONG_ID#,HOPDONG_BENHNHAN_ID = #HOPDONG_BENHNHAN_ID#,DALIEU = #DALIEU#,PLDALIEU_ID = #PLDALIEU_ID#
      ,BACSIDALIEU_ID = #BACSIDALIEU_ID#,BENHVIEN_ID = #BENHVIEN_ID#,NGAYTAO = #NGAYTAO#,NGUOITAO_ID = #NGUOITAO_ID#
      ,NGAYCAPNHAT = #NGAYCAPNHAT#,NGUOICAPNHAT_ID = #NGUOICAPNHAT_ID#
      WHERE HOPDONG_ID = $HOPDONG_ID$ AND HOPDONG_BENHNHAN_ID = $HOPDONG_BENHNHAN_ID$ AND BENHVIEN_ID='$BENHVIEN_ID$'
    </statement>

    <statement id="DAO00329_GETKETQUA_KL" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
      SELECT * FROM TT_KSK_KETQUA
      where HOPDONG_ID=$HOPDONG_ID$ AND HOPDONG_BENHNHAN_ID=$HOPDONG_BENHNHAN_ID$ AND BENHVIEN_ID='$BENHVIEN_ID$'
    </statement>

    <statement id="DAO00329_Insert_KL" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
      INSERT INTO TT_KSK_KETQUA
      (TIEPNHAN_ID,HOPDONG_ID,HOPDONG_BENHNHAN_ID,MAICD,TENICD,BACSIKETLUAN_ID,XEPLOAI_ID,NHANXET
      ,TRANGTHAI,BENHVIEN_ID,NGAYTAO,NGUOITAO_ID,NGAYCAPNHAT,NGUOICAPNHAT_ID)
      VALUES
      (#TIEPNHAN_ID#,#HOPDONG_ID#,#HOPDONG_BENHNHAN_ID#,#MAICD#,#TENICD#,#BACSIKETLUAN_ID#,#XEPLOAI_ID#,#NHANXET#,'DAKETLUAN'
      ,#BENHVIEN_ID#,#NGAYTAO#,#NGUOITAO_ID#,#NGAYCAPNHAT#,#NGUOICAPNHAT_ID#)
    </statement>

    <statement id="DAO00329_Update_KL" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
      UPDATE TT_KSK_KETQUA
      SET TIEPNHAN_ID = #TIEPNHAN_ID#,HOPDONG_ID = #HOPDONG_ID#,HOPDONG_BENHNHAN_ID = #HOPDONG_BENHNHAN_ID#
      ,MAICD = #MAICD#,TENICD = #TENICD#,BACSIKETLUAN_ID = #BACSIKETLUAN_ID#,XEPLOAI_ID = #XEPLOAI_ID#
      ,NHANXET = #NHANXET#,TRANGTHAI = 'DAKETLUAN',BENHVIEN_ID = #BENHVIEN_ID#,NGAYTAO = #NGAYTAO#
      ,NGUOITAO_ID = #NGUOITAO_ID#,NGAYCAPNHAT = #NGAYCAPNHAT#,NGUOICAPNHAT_ID = #NGUOICAPNHAT_ID#
      WHERE  HOPDONG_ID = $HOPDONG_ID$ AND HOPDONG_BENHNHAN_ID = $HOPDONG_BENHNHAN_ID$ AND BENHVIEN_ID = '$BENHVIEN_ID$'
    </statement>

    <statement id="DAO00329_Update_KB" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
      UPDATE TT_KSK_HOPDONG_BENHNHAN_DICHVU SET DATHUCHIEN='DATHUCHIEN' where HOPDONG_BENHNHAN_ID= $HOPDONG_BENHNHAN_ID$ AND DICHVU_ID=$DICHVU_ID$ AND TRANGTHAI= 'DAXACNHAN'
    </statement>

    <statement id="DAO00329_Insert_Data" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
      DECLARE @CHECK int
      IF (SELECT COUNT(*) FROM TT_KSK_KETQUA WHERE HOPDONG_ID=$HOPDONG_ID$ AND HOPDONG_BENHNHAN_ID=$HOPDONG_BENHNHAN_ID$) = 0
      BEGIN
      INSERT INTO TT_KSK_KETQUA (TIEPNHAN_ID,HOPDONG_ID,HOPDONG_BENHNHAN_ID,BENHVIEN_ID) values(#TIEPNHAN_ID#,#HOPDONG_ID#,#HOPDONG_BENHNHAN_ID#,#BENHVIEN_ID#);
      SET @CHECK = (SELECT SCOPE_IDENTITY())
      INSERT INTO TT_KSK_KETQUA_NOI(KETQUA_ID,HOPDONG_ID,HOPDONG_BENHNHAN_ID,BENHVIEN_ID) values(@CHECK,#HOPDONG_ID#,#HOPDONG_BENHNHAN_ID#,#BENHVIEN_ID#);
      INSERT INTO TT_KSK_KETQUA_NGOAI(KETQUA_ID,HOPDONG_ID,HOPDONG_BENHNHAN_ID,BENHVIEN_ID) values(@CHECK,#HOPDONG_ID#,#HOPDONG_BENHNHAN_ID#,#BENHVIEN_ID#);
      INSERT INTO TT_KSK_KETQUA_DALIEU(KETQUA_ID,HOPDONG_ID,HOPDONG_BENHNHAN_ID,BENHVIEN_ID) values(@CHECK,#HOPDONG_ID#,#HOPDONG_BENHNHAN_ID#,#BENHVIEN_ID#);
      INSERT INTO TT_KSK_KETQUA_PHUKHOA(KETQUA_ID,HOPDONG_ID,HOPDONG_BENHNHAN_ID,BENHVIEN_ID) values(@CHECK,#HOPDONG_ID#,#HOPDONG_BENHNHAN_ID#,#BENHVIEN_ID#);
      INSERT INTO TT_KSK_KETQUA_RHM(KETQUA_ID,HOPDONG_ID,HOPDONG_BENHNHAN_ID,BENHVIEN_ID) values(@CHECK,#HOPDONG_ID#,#HOPDONG_BENHNHAN_ID#,#BENHVIEN_ID#);
      INSERT INTO TT_KSK_KETQUA_TMH(KETQUA_ID,HOPDONG_ID,HOPDONG_BENHNHAN_ID,BENHVIEN_ID) values(@CHECK,#HOPDONG_ID#,#HOPDONG_BENHNHAN_ID#,#BENHVIEN_ID#);
      INSERT INTO TT_KSK_KETQUA_MAT(KETQUA_ID,HOPDONG_ID,HOPDONG_BENHNHAN_ID,BENHVIEN_ID) values(@CHECK,#HOPDONG_ID#,#HOPDONG_BENHNHAN_ID#,#BENHVIEN_ID#);
      END
      ELSE
      BEGIN
      RETURN
      END;
    </statement>

  </statements>
</sqlMap>