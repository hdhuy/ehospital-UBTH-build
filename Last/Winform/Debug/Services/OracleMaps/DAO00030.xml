<?xml version="1.0" encoding="utf-8" ?>
<!--iBatis Map File-->
<sqlMap namespace="eHospital" xmlns="http://ibatis.apache.org/mapping" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
    <statements>
        <!--Revision:0-->
        <statement id="DAO00030_GetList" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
            select *
            from TT_DUOC_CHUNGTU
            where BENHVIEN_ID = '$BENHVIEN_ID$'
            <isParameterPresent>
                <isNotEmpty prepend="and" property="CHUNGTU_ID">
                    TT_DUOC_CHUNGTU.CHUNGTU_ID = '$CHUNGTU_ID$'
                </isNotEmpty>
                <isNotEmpty prepend="and" property="MACHUNGTU">
                    TT_DUOC_CHUNGTU.MACHUNGTU = '$MACHUNGTU$'
                </isNotEmpty>
                <isNotEmpty prepend="and" property="SOCHUNGTU">
                    TT_DUOC_CHUNGTU.SOCHUNGTU = '$SOCHUNGTU$'
                </isNotEmpty>
                <isNotEmpty prepend="and" property="LOAICHUNGTU">
                    TT_DUOC_CHUNGTU.LOAICHUNGTU = '$LOAICHUNGTU$'
                </isNotEmpty>
                <isNotEmpty prepend="and" property="MUCDICHCHUNGTU_ID">
                    TT_DUOC_CHUNGTU.MUCDICHCHUNGTU_ID = '$MUCDICHCHUNGTU_ID$'
                </isNotEmpty>
                <isNotEmpty prepend="and" property="MUCDICHCHUNGTU_CODE">
                    TT_DUOC_CHUNGTU.MUCDICHCHUNGTU_CODE = '$MUCDICHCHUNGTU_CODE$'
                </isNotEmpty>
                <isNotEmpty prepend="and" property="KHOXUAT_ID">
                    TT_DUOC_CHUNGTU.KHOXUAT_ID = '$KHOXUAT_ID$'
                </isNotEmpty>
                <isNotEmpty prepend="and" property="NGUOIGIAO_ID">
                    TT_DUOC_CHUNGTU.NGUOIGIAO_ID = '$NGUOIGIAO_ID$'
                </isNotEmpty>
                <isNotEmpty prepend="and" property="KHONHAP_ID">
                    TT_DUOC_CHUNGTU.KHONHAP_ID = '$KHONHAP_ID$'
                </isNotEmpty>
                <isNotEmpty prepend="and" property="SOCHUNGTUGOC">
                    TT_DUOC_CHUNGTU.SOCHUNGTUGOC = '$SOCHUNGTUGOC$'
                </isNotEmpty>
                <isNotEmpty prepend="and" property="NGAYCHUNGTUGOC">
                    TT_DUOC_CHUNGTU.NGAYCHUNGTUGOC = '$NGAYCHUNGTUGOC$'
                </isNotEmpty>
                <isNotEmpty prepend="and" property="NHACUNGCAP_ID">
                    TT_DUOC_CHUNGTU.NHACUNGCAP_ID = '$NHACUNGCAP_ID$'
                </isNotEmpty>
                <isNotEmpty prepend="and" property="CHUNGTULIENQUAN_ID">
                    TT_DUOC_CHUNGTU.CHUNGTULIENQUAN_ID = '$CHUNGTULIENQUAN_ID$'
                </isNotEmpty>
                <isNotEmpty prepend="and" property="KHAMBENH_ID">
                    TT_DUOC_CHUNGTU.KHAMBENH_ID = '$KHAMBENH_ID$'
                </isNotEmpty>
                <isNotEmpty prepend="and" property="TOATHUOCNOITRU_ID">
                    TT_DUOC_CHUNGTU.TOATHUOCNOITRU_ID = '$TOATHUOCNOITRU_ID$'
                </isNotEmpty>
                <isNotEmpty prepend="and" property="TIEPNHAN_ID">
                    TT_DUOC_CHUNGTU.TIEPNHAN_ID = '$TIEPNHAN_ID$'
                </isNotEmpty>
                <isNotEmpty prepend="and" property="BENHAN_ID">
                    TT_DUOC_CHUNGTU.BENHAN_ID = '$BENHAN_ID$'
                </isNotEmpty>
                <isNotEmpty prepend="and" property="DANHANTHUOC">
                    TT_DUOC_CHUNGTU.DANHANTHUOC = '$DANHANTHUOC$'
                </isNotEmpty>
                <isNotEmpty prepend="and" property="NGUOINHAP_ID">
                    TT_DUOC_CHUNGTU.NGUOINHAP_ID = '$NGUOINHAP_ID$'
                </isNotEmpty>
                <isNotEmpty prepend="and" property="NGAYNHAP">
                    TT_DUOC_CHUNGTU.NGAYNHAP = '$NGAYNHAP$'
                </isNotEmpty>
                <isNotEmpty prepend="and" property="TRANGTHAI">
                    TT_DUOC_CHUNGTU.TRANGTHAI = '$TRANGTHAI$'
                </isNotEmpty>
                <isNotEmpty prepend="and" property="PHIEULINH_ID">
                    TT_DUOC_CHUNGTU.PHIEULINH_ID = '$PHIEULINH_ID$'
                </isNotEmpty>
                <isNotEmpty prepend="and" property="DONVIGIAO_ID">
                    TT_DUOC_CHUNGTU.DONVIGIAO_ID = '$DONVIGIAO_ID$'
                </isNotEmpty>
                <isNotEmpty prepend="and" property="KHOSUDUNG_ID">
                    TT_DUOC_CHUNGTU.KHOSUDUNG_ID = '$KHOSUDUNG_ID$'
                </isNotEmpty>
                <isNotEmpty prepend="and" property="LOAIVATTU_ID">
                    TT_DUOC_CHUNGTU.LOAIVATTU_ID = '$LOAIVATTU_ID$'
                </isNotEmpty>
                <isNotEmpty prepend="and" property="BENHNHAN_ID">
                    TT_DUOC_CHUNGTU.BENHNHAN_ID = '$BENHNHAN_ID$'
                </isNotEmpty>
                <isNotEmpty prepend="and" property="TENBENHNHAN">
                    TT_DUOC_CHUNGTU.TENBENHNHAN = '$TENBENHNHAN$'
                </isNotEmpty>
                <isNotEmpty prepend="and" property="DOITUONG_ID">
                    TT_DUOC_CHUNGTU.DOITUONG_ID = '$DOITUONG_ID$'
                </isNotEmpty>
                <isNotEmpty prepend="and" property="NGUOITAO_ID">
                    TT_DUOC_CHUNGTU.NGUOITAO_ID = '$NGUOITAO_ID$'
                </isNotEmpty>
                <isNotEmpty prepend="and" property="NGUOICAPNHAT_ID">
                    TT_DUOC_CHUNGTU.NGUOICAPNHAT_ID = '$NGUOICAPNHAT_ID$'
                </isNotEmpty>
            </isParameterPresent>
            order by CHUNGTU_ID
        </statement>
        <!--Revision:0-->
        <statement id="DAO00030_Search" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
            select ct.*,
            CASE
            WHEN TRANGTHAI = 'PNCNK' THEN 'Chờ nhập kho'
            WHEN TRANGTHAI = 'PNDNK' THEN 'Đã nhập kho'
            WHEN TRANGTHAI = 'HUY' THEN 'Hủy'
            WHEN TRANGTHAI = 'DX' THEN 'Đã xác nhận'
            END  AS TRANGTHAI_TEXT
            from TT_DUOC_CHUNGTU ct
            <dynamic prepend="where">
                <isParameterPresent>
                    <isNotEmpty prepend="and" property="MACHUNGTU">
                        MACHUNGTU LIKE '%$MACHUNGTU$%'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="SOCHUNGTU">
                        SOCHUNGTU LIKE '%$SOCHUNGTU$%'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="LOAICHUNGTU">
                        LOAICHUNGTU = '$LOAICHUNGTU$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="MUCDICHCHUNGTU_ID">
                        MUCDICHCHUNGTU_ID = '$MUCDICHCHUNGTU_ID$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="KHOXUAT_ID">
                        KHOXUAT_ID = '$KHOXUAT_ID$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="NGUOIGIAO_ID">
                        NGUOIGIAO_ID = '$NGUOIGIAO_ID$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="NGUOIGIAO">
                        NGUOIGIAO = '$NGUOIGIAO$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="KHONHAP_ID">
                        KHONHAP_ID = '$KHONHAP_ID$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="NGUOINHAN_ID">
                        NGUOINHAN_ID = '$NGUOINHAN_ID$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="NGUOINHAN">
                        NGUOINHAN = '$NGUOINHAN$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="NGUOIKIEMTRA_ID">
                        NGUOIKIEMTRA_ID = '$NGUOIKIEMTRA_ID$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="NGUOIKIEMTRA">
                        NGUOIKIEMTRA = '$NGUOIKIEMTRA$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="NGUOIDUYET_ID">
                        NGUOIDUYET_ID = '$NGUOIDUYET_ID$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="NGUOIDUYET">
                        NGUOIDUYET = '$NGUOIDUYET$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="HOIDONGKIEMNHAP_ID">
                        HOIDONGKIEMNHAP_ID = '$HOIDONGKIEMNHAP_ID$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="KETOANTRUONG_ID">
                        KETOANTRUONG_ID = '$KETOANTRUONG_ID$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="KETOANTRUONG">
                        KETOANTRUONG = '$KETOANTRUONG$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="THUKHO_ID">
                        THUKHO_ID = '$THUKHO_ID$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="THUKHO">
                        THUKHO = '$THUKHO$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="SOSERI">
                        SOSERI = '$SOSERI$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="SOHOADON">
                        SOHOADON = '$SOHOADON$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="DIENGIAI">
                        DIENGIAI = '$DIENGIAI$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="GIATRI">
                        GIATRI = '$GIATRI$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="GIATRITHANHTOAN">
                        GIATRITHANHTOAN = '$GIATRITHANHTOAN$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="THUESUAT">
                        THUESUAT = '$THUESUAT$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="GIATRITHUE">
                        GIATRITHUE = '$GIATRITHUE$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="TYLECHIETKHAU">
                        TYLECHIETKHAU = '$TYLECHIETKHAU$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="GIATRICHIETKHAU">
                        GIATRICHIETKHAU = '$GIATRICHIETKHAU$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="TIENTE_ID">
                        TIENTE_ID = '$TIENTE_ID$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="TYGIA">
                        TYGIA = '$TYGIA$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="SOCHUNGTUGOC">
                        SOCHUNGTUGOC = '$SOCHUNGTUGOC$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="NGAYCHUNGTUGOC">
                        NGAYCHUNGTUGOC = '$NGAYCHUNGTUGOC$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="NHACUNGCAP_ID">
                        NHACUNGCAP_ID = '$NHACUNGCAP_ID$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="HINHTHUCTHANHTOAN_ID">
                        HINHTHUCTHANHTOAN_ID = '$HINHTHUCTHANHTOAN_ID$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="NGUONDUOC_ID">
                        NGUONDUOC_ID = '$NGUONDUOC_ID$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="CHUNGTULIENQUAN_ID">
                        CHUNGTULIENQUAN_ID is NULL
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="KHAMBENH_ID">
                        KHAMBENH_ID = '$KHAMBENH_ID$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="TOATHUOCNOITRU_ID">
                        TOATHUOCNOITRU_ID = '$TOATHUOCNOITRU_ID$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="TIEPNHAN_ID">
                        TIEPNHAN_ID = '$TIEPNHAN_ID$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="BENHAN_ID">
                        BENHAN_ID = '$BENHAN_ID$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="DANHANTHUOC">
                        DANHANTHUOC = '$DANHANTHUOC$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="NGUOINHAP_ID">
                        NGUOINHAP_ID = '$NGUOINHAP_ID$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="NGAYNHAP">
                        NGAYNHAP = '$NGAYNHAP$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="TRANGTHAI">
                        TRANGTHAI = '$TRANGTHAI$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="PHIEULINH_ID">
                        PHIEULINH_ID = '$PHIEULINH_ID$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="DIENGIAINGHIEPVUPHATSINH">
                        DIENGIAINGHIEPVUPHATSINH = '$DIENGIAINGHIEPVUPHATSINH$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="DONVIGIAO_ID">
                        DONVIGIAO_ID = '$DONVIGIAO_ID$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="TYLEVATNHAPKHAU">
                        TYLEVATNHAPKHAU = '$TYLEVATNHAPKHAU$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="GIATRIVATNHAPKHAU">
                        GIATRIVATNHAPKHAU = '$GIATRIVATNHAPKHAU$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="SOSERINUOCNGOAI">
                        SOSERINUOCNGOAI = '$SOSERINUOCNGOAI$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="SOHOADONNUOCNGOAI">
                        SOHOADONNUOCNGOAI = '$SOHOADONNUOCNGOAI$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="NGAYHOADONNUOCNGOAI">
                        NGAYHOADONNUOCNGOAI = '$NGAYHOADONNUOCNGOAI$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="KHOSUDUNG_ID">
                        KHOSUDUNG_ID = '$KHOSUDUNG_ID$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="LOAIVATTU_ID">
                        LOAIVATTU_ID = '$LOAIVATTU_ID$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="BENHNHAN_ID">
                        BENHNHAN_ID = '$BENHNHAN_ID$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="TENBENHNHAN">
                        TENBENHNHAN = '$TENBENHNHAN$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="GIOITINH">
                        GIOITINH = '$GIOITINH$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="NAMSINH">
                        NAMSINH = '$NAMSINH$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="DIACHI">
                        DIACHI = '$DIACHI$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="SODIENTHOAI">
                        SODIENTHOAI = '$SODIENTHOAI$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="BACSIGIOITHIEU_ID">
                        BACSIGIOITHIEU_ID = '$BACSIGIOITHIEU_ID$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="DOITUONG_ID">
                        DOITUONG_ID = '$DOITUONG_ID$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="IDCHUYEN">
                        IDCHUYEN = '$IDCHUYEN$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="CHUNGTUKETOAN">
                        CHUNGTUKETOAN = '$CHUNGTUKETOAN$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="STATUS">
                        STATUS = '$STATUS$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="TRANSFER_VIENPHI_ID">
                        TRANSFER_VIENPHI_ID = '$TRANSFER_VIENPHI_ID$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="PHONGBAN_ID">
                        PHONGBAN_ID = '$PHONGBAN_ID$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="BACSI_ID">
                        BACSI_ID = '$BACSI_ID$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="TKNO">
                        TKNO = '$TKNO$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="TKCO">
                        TKCO = '$TKCO$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="MACHUNGTUREF">
                        MACHUNGTUREF = '$MACHUNGTUREF$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="LOAICHUNGTUREF">
                        LOAICHUNGTUREF = '$LOAICHUNGTUREF$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="PHIEULINHCANTRU_ID">
                        PHIEULINHCANTRU_ID = '$PHIEULINHCANTRU_ID$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="KHOTHUCHIEN_ID">
                        KHOTHUCHIEN_ID = '$KHOTHUCHIEN_ID$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="KHODOIUNG_ID">
                        KHODOIUNG_ID = '$KHODOIUNG_ID$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="MENU_LOAIDUOC_ID">
                        MENU_LOAIDUOC_ID = '$MENU_LOAIDUOC_ID$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="NGUOISUDUNGMAY_ID">
                        NGUOISUDUNGMAY_ID = '$NGUOISUDUNGMAY_ID$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="GOITHAU_ID">
                        GOITHAU_ID = '$GOITHAU_ID$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="XUATTHUOCBANGOAITRU">
                        XUATTHUOCBANGOAITRU = '$XUATTHUOCBANGOAITRU$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="NGAYGIOCHUNGTU">
                        NGAYGIOCHUNGTU = '$NGAYGIOCHUNGTU$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="NOIDAKHAM">
                        NOIDAKHAM = '$NOIDAKHAM$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="CHUYENCHUNGTUID">
                        CHUYENCHUNGTUID = '$CHUYENCHUNGTUID$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="CHUYENDOANHTHUID">
                        CHUYENDOANHTHUID = '$CHUYENDOANHTHUID$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="BENHVIEN_ID">
                        BENHVIEN_ID = '$BENHVIEN_ID$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="NGUOITAO_ID">
                        NGUOITAO_ID = '$NGUOITAO_ID$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="NGAYCAPNHAT">
                        NGAYCAPNHAT = '$NGAYCAPNHAT$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="NGUOICAPNHAT_ID">
                        NGUOICAPNHAT_ID = '$NGUOICAPNHAT_ID$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="TUNGAY">                      
                      trunc(NGAYCHUNGTU) BETWEEN  trunc(#TUNGAY#) and  trunc(#DENNGAY#)
                    </isNotEmpty>
                </isParameterPresent>
            </dynamic>
            order by CHUNGTU_ID DESC
        </statement>
        <!--Revision:0-->
        <statement id="DAO00030_Search_NhapNCC" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
            select
            CHUNGTU_ID,
            SOCHUNGTU,
            MACHUNGTU,
            NGAYCHUNGTU,
            CT.NGAYTAO,
            SOCHUNGTUGOC,
            NGAYCHUNGTUGOC,
            CASE
            WHEN TRANGTHAI = 'PNCNK' THEN 'Chờ xác nhậ'
            WHEN TRANGTHAI = 'PNDNK' THEN 'Đã nhập kho'
            WHEN TRANGTHAI = 'HUY' THEN 'Đã hủy'
            END  AS TRANGTHAI,
            CASE
            WHEN TRANGTHAI = 'PNCNK' THEN null
            WHEN TRANGTHAI = 'PNDNK' THEN null
            WHEN TRANGTHAI = 'HUY' THEN CT.NGUOICAPNHAT_ID
            END  AS NGUOICAPNHAT_ID,
            CASE
            WHEN TRANGTHAI = 'PNCNK' THEN null
            WHEN TRANGTHAI = 'PNDNK' THEN null
            WHEN TRANGTHAI = 'HUY' THEN CT.NGAYCAPNHAT
            END  AS NGAYCAPNHAT,
            CASE
            WHEN TRANGTHAI = 'PNCNK' THEN null
            WHEN TRANGTHAI = 'PNDNK' THEN null
            WHEN TRANGTHAI = 'HUY' THEN NV.TENNHANVIEN
            END  AS TENNHANVIEN
            from TT_DUOC_CHUNGTU CT
            left join TM_NHANVIEN NV on CT.NGUOICAPNHAT_ID = NV.NHANVIEN_ID
            <dynamic prepend="where">
                <isParameterPresent>
                    <isNotEmpty prepend="and" property="TUKHOA">
                        CT.MACHUNGTU LIKE '%$TUKHOA$%'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="MUCDICHCHUNGTU_ID">
                        CT.MUCDICHCHUNGTU_ID = '$MUCDICHCHUNGTU_ID$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="BENHVIEN_ID">
                        CT.BENHVIEN_ID = '$BENHVIEN_ID$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="KHONHAP_ID">
                        CT.KHONHAP_ID = '$KHONHAP_ID$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="TUNGAY">                      
                      trunc(CT.NGAYTAO) BETWEEN  trunc(#TUNGAY#) and  trunc(#DENNGAY#)
                    </isNotEmpty>
                </isParameterPresent>
            </dynamic>
            order by CT.CHUNGTU_ID DESC
        </statement>
        <!--Revision:0-->
        <statement id="DAO00030_Search_PhieuXuatNB" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
            select
            CT.CHUNGTU_ID,
            CT.SOCHUNGTU,
            CT.MACHUNGTU,
            CT.NGAYCHUNGTU,
            CT.NGAYTAO,
            CT.KHOXUAT_ID,
            CT.NGUOIGIAO_ID,
            CT.KHONHAP_ID,
            CT.NGUOINHAN_ID,
            PL.MACHUNGTU as MAPHIEULINH,
            PL.NGAYCHUNGTU as NGAYPHIEULINH
            from TT_DUOC_CHUNGTU CT
            left join TT_DUOC_PHIEULINH PL on PL.CHUNGTU_ID = CT.PHIEULINH_ID
            <dynamic prepend="where">
                <isParameterPresent>
                    <isNotEmpty prepend="and" property="MACHUNGTU">
                        CT.MACHUNGTU LIKE '%$MACHUNGTU$%'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="SOCHUNGTU">
                        CT.SOCHUNGTU LIKE '%$SOCHUNGTU$%'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="MUCDICHCHUNGTU_ID">
                        CT.MUCDICHCHUNGTU_ID = '$MUCDICHCHUNGTU_ID$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="DANHANTHUOC">
                        CT.DANHANTHUOC = '$DANHANTHUOC$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="BENHVIEN_ID">
                        CT.BENHVIEN_ID = '$BENHVIEN_ID$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="CHUNGTULIENQUAN_ID">
                        CT.CHUNGTULIENQUAN_ID is null
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="BENHVIEN_ID">
                        CT.BENHVIEN_ID = '$BENHVIEN_ID$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="KHOXUAT_ID">
                        CT.KHOXUAT_ID = '$KHOXUAT_ID$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="KHONHAP_ID">
                        CT.KHONHAP_ID = '$KHONHAP_ID$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="TUNGAY">                      
                      trunc(CT.NGAYCHUNGTU) BETWEEN  trunc(#TUNGAY#) and  trunc(#DENNGAY#)
                    </isNotEmpty>
                </isParameterPresent>
            </dynamic>
            order by CT.CHUNGTU_ID DESC
        </statement>
        <!--Revision:0-->
        <statement id="DAO00030_Search_PhieuXuatThuoc" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
            select distinct
            CT.CHUNGTU_ID,
            CT.MACHUNGTU,
            CT.NGAYCHUNGTU,
            CT.KHOXUAT_ID,
            CT.NGUOIGIAO_ID,
            BN.MAYTE,
            BN.TENBENHNHAN
            from TT_DUOC_CHUNGTU CT
            inner join TT_BENHNHAN BN on BN.BENHNHAN_ID = CT.BENHNHAN_ID
            <dynamic prepend="where">
                <isParameterPresent>
                    <isNotEmpty prepend="and" property="TUKHOA">
                        (CT.MACHUNGTU LIKE '%$TUKHOA$%' or BN.MAYTE LIKE '%$TUKHOA$%'  or BN.TENBENHNHAN LIKE '%$TUKHOA$%')
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="MUCDICHCHUNGTU_ID">
                        CT.MUCDICHCHUNGTU_ID = '$MUCDICHCHUNGTU_ID$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="BENHVIEN_ID">
                        CT.BENHVIEN_ID = '$BENHVIEN_ID$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="KHOXUAT_ID">
                        CT.KHOXUAT_ID = '$KHOXUAT_ID$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="TUNGAY">                      
                      trunc(CT.NGAYCHUNGTU) BETWEEN  trunc(#TUNGAY#) and  trunc(#DENNGAY#)
                    </isNotEmpty>
                </isParameterPresent>
            </dynamic>
            order by CT.CHUNGTU_ID DESC
        </statement>
        <!--Revision:0-->
        <statement id="DAO00030_KiemTraToaThuocDaThanhToan" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
            select distinct
            KBTT.CHUNGTUPHATTHUOC_ID
            from
            TT_NGOAITRU_KHAMBENH_TOATHUOC KBTT
            inner join TT_NGOAITRU_TOATHUOC TT on  TT.KHAMBENH_TOATHUOC_ID = KBTT.KHAMBENH_TOATHUOC_ID
            inner join TT_VIENPHI VP on (TT.TOATHUOC_ID = VP.REF_ID AND VP.REF_TABLE = 'TT_NGOAITRU_TOATHUOC')
            where
            KBTT.CHUNGTUPHATTHUOC_ID = '$CHUNGTU_ID$'
            and KBTT.BENHVIEN_ID = '$BENHVIEN_ID$'
            AND vp.DATHANHTOAN = '1'
            AND vp.HUY = '0'
        </statement>
        <!--Revision:0-->
        <statement id="DAO00030_KiemTraBenhNhanXNBHYT" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
            select
            KB.TIEPNHAN_ID
            from
            TT_NGOAITRU_KHAMBENH KB
            inner join TT_DUOC_CHUNGTU CT on KB.KHAMBENH_ID = CT.KHAMBENH_ID
            inner join TT_XACNHANCHIPHI XN on XN.TIEPNHAN_ID = KB.TIEPNHAN_ID
            where
            CT.CHUNGTU_ID = $CHUNGTU_ID$
            and KB.BENHVIEN_ID = '$BENHVIEN_ID$'
        </statement>
        <!--Revision:0-->
        <statement id="DAO00030_KiemTraBenhNhanXuatVien" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
            select
            TT.TOATHUOC_ID
            from
            TT_NOITRU_TOATHUOC TT
            inner join TT_NOITRU_KHAMBENH KB on TT.KHAMBENH_ID = KB.KHAMBENH_ID
            inner join TT_NOITRU_BENHAN BA on BA.BENHAN_ID = KB.BENHAN_ID
            WHERE
            BA.TRANGTHAI = 'DAXUATVIE'
            AND TT.CHUNGTU_ID =  $CHUNGTU_ID$
            and TT.BENHVIEN_ID = '$BENHVIEN_ID$'
        </statement>
        <!--Revision:0-->
        <statement id="DAO00030_Search_PhieuLinhDaNhapKho" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
            select
            PL.CHUNGTU_ID,
            PL.MACHUNGTU,
            PL.NGAYCHUNGTU,
            PL.NGUOITAO_ID,
            CT.MACHUNGTU AS MAPHIEUNHAP
            from TT_DUOC_PHIEULINH PL
            inner join TT_DUOC_CHUNGTU CT on PL.CHUNGTU_ID = CT.PHIEULINH_ID
            where
            PL.DANHANTHUOC = 1
            AND PL.TRANGTHAI != 'DAHOANTRA'
            AND CT.LOAICHUNGTU = 'N'TO_DATE('$TUNGAY$', 'MM/DD/YYYY')
            <dynamic prepend="">
                <isParameterPresent>
                    <isNotEmpty prepend="and" property="MACHUNGTU">
                        PL.MACHUNGTU LIKE '%$MACHUNGTU$%'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="BENHVIEN_ID">
                        PL.BENHVIEN_ID = '$BENHVIEN_ID$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="KHONHAP_ID">
                        PL.KHONHAP_ID = '$KHONHAP_ID$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="TUNGAY">                      
                      trunc(PL.NGAYCHUNGTU) BETWEEN  trunc(#TUNGAY#) and  trunc(#DENNGAY#)
                    </isNotEmpty>
                </isParameterPresent>
            </dynamic>
        </statement>
        <!--Revision:0-->
        <statement id="DAO00030_SearchPhieuXuatNoiBo" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
          select *
          from TT_DUOC_CHUNGTU
          WHERE
          MUCDICHCHUNGTU_ID= '$MUCDICHCHUNGTU_ID$'
          and BENHVIEN_ID = '$BENHVIEN_ID$'
          AND KHONHAP_ID = '$KHONHAP_ID$'          
          AND trunc(NGAYCHUNGTU) BETWEEN  trunc(#TUNGAY#) and  trunc(#DENNGAY#)
          AND MACHUNGTU NOT IN (select SOCHUNGTUGOC from TT_DUOC_CHUNGTU WHERE SOCHUNGTUGOC IS NOT NULL)
          <isNotEmpty prepend="" property="MACHUNGTU">
                AND  TT_DUOC_CHUNGTU.MACHUNGTU LIKE '%$MACHUNGTU$%'
            </isNotEmpty>
            <isNotEmpty prepend="and" property="DANHANTHUOC">
                DANHANTHUOC = $DANHANTHUOC$
            </isNotEmpty>
            order by CHUNGTU_ID DESC
        </statement>
        <!--Revision:0-->
        <statement id="DAO00030_SearchToaMuaNgoai" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
          select DISTINCT CT.CHUNGTU_ID, MACHUNGTU, CT.NGAYCHUNGTU, CT.NGUOIGIAO_ID, CT.KHOXUAT_ID, CT.BENHNHAN_ID, CT.LOAITOATHUOC,
          '' AS MAYTE2, NM.TENNGUOIMUA TENBENHNHAN2, NM.SODIENTHOAI SODIENTHOAI2,
          BN.MAYTE, BN.TENBENHNHAN, BN.SODIENTHOAI
          FROM TT_DUOC_CHUNGTU CT
          inner join TT_DUOC_CHUNGTU_CHITIET CTCT on CTCT.CHUNGTU_ID = CT.CHUNGTU_ID
          left join TT_NGOAITRU_TOATHUOC_NGUOIMUA NM on NM.NGOAITRU_TOATHUOC_NGUOIMUA_ID = CT.NGOAITRU_TOATHUOC_NGUOIMUA_ID
          left join TT_BENHNHAN BN on BN.BENHNHAN_ID = CT.BENHNHAN_ID
          WHERE
          CT.MUCDICHCHUNGTU_ID= '$MUCDICHCHUNGTU_ID$'
          and CT.BENHVIEN_ID = '$BENHVIEN_ID$'
          AND CT.KHOXUAT_ID = '$KHOXUAT_ID$'          
          AND trunc(CT.NGAYCHUNGTU) BETWEEN  trunc(#TUNGAY#) and  trunc(#DENNGAY#)
          <isParameterPresent>
                <isNotEmpty prepend="and" property="KEYWORD">
                    (BN.TENBENHNHAN LIKE '%$KEYWORD$%' or BN.MAYTE LIKE '%$KEYWORD$%' or NM.TENNGUOIMUA LIKE '%$KEYWORD$%' OR CT.MACHUNGTU LIKE '%$KEYWORD$%')
                </isNotEmpty>
                <isNotEmpty prepend="and" property="TRANGTHAI">
                    CT.MACHUNGTU NOT IN (select SOCHUNGTUGOC from TT_DUOC_CHUNGTU WHERE SOCHUNGTUGOC IS NOT NULL)
                </isNotEmpty>
            </isParameterPresent>
            order by CHUNGTU_ID DESC
        </statement>
        <!--Revision:0-->
        <statement id="DAO00030_SearchToaMuaNgoaiDaThanhToan" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
          select distinct CT.CHUNGTU_ID, MACHUNGTU, CT.NGAYCHUNGTU, CT.NGUOIGIAO_ID, CT.KHOXUAT_ID, CT.BENHNHAN_ID,  CT.LOAITOATHUOC,
          '' AS MAYTE2, NM.TENNGUOIMUA TENBENHNHAN2, NM.SODIENTHOAI SODIENTHOAI2,
          BN.MAYTE, BN.TENBENHNHAN, BN.SODIENTHOAI
          FROM TT_DUOC_CHUNGTU CT
          inner join TT_DUOC_CHUNGTU_CHITIET CTCT on CTCT.CHUNGTU_ID = CT.CHUNGTU_ID
          inner join TT_VIENPHI vp on (vp.REF_TABLE = 'TT_DUOC_CHUNGTU_CHITIET' and vp.REF_ID = CTCT.CHUNGTUCHITIET_ID and vp.HOADON_ID IS NOT NULL and vp.DATHANHTOAN = '1' and vp.HUY = 0 )
          left join TT_NGOAITRU_TOATHUOC_NGUOIMUA NM on NM.NGOAITRU_TOATHUOC_NGUOIMUA_ID = CT.NGOAITRU_TOATHUOC_NGUOIMUA_ID
          left join TT_BENHNHAN BN on BN.BENHNHAN_ID = CT.BENHNHAN_ID
          WHERE
          CT.MUCDICHCHUNGTU_CODE = 'X08'
          and CT.BENHVIEN_ID = '$BENHVIEN_ID$'
          AND CT.KHOXUAT_ID = '$KHOXUAT_ID$'
          AND trunc(CT.NGAYCHUNGTU) BETWEEN  trunc(#TUNGAY#) and  trunc(#DENNGAY#)
          <isParameterPresent>
                <isNotEmpty prepend="and" property="KEYWORD">
                    (BN.TENBENHNHAN LIKE '%$KEYWORD$%' or BN.MAYTE LIKE '%$KEYWORD$%' or NM.TENNGUOIMUA LIKE '%$KEYWORD$%' OR CT.MACHUNGTU LIKE '%$KEYWORD$%')
                </isNotEmpty>
            </isParameterPresent>
            order by CHUNGTU_ID DESC
        </statement>
        <!--Revision:0-->
        <statement id="DAO00030_GetDetail" parameterClass="System.String" resultClass="DataObject">
            select *
            from TT_DUOC_CHUNGTU
            where TT_DUOC_CHUNGTU.CHUNGTU_ID  = '$value$'
            and BENHVIEN_ID = '$BENHVIEN_ID$'
            order by CHUNGTU_ID
        </statement>
        <!--Revision:0-->
        <statement id="DAO00030_GetDetailP" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
            select *
            from TT_DUOC_CHUNGTU
            where TT_DUOC_CHUNGTU.CHUNGTU_ID  = '$CHUNGTU_ID$'
            and BENHVIEN_ID = '$BENHVIEN_ID$'
            order by CHUNGTU_ID
        </statement>
        <!--Revision:0-->
        <insert id="DAO00030_Add" parameterClass="System.Collections.IDictionary" resultClass="System.Int64">
            <selectKey property="ID" type="pre" resultClass="System.Int64">
              select TT_DUOC_CHUNGTU_S.nextval as value from dual              
            </selectKey>            
            insert into TT_DUOC_CHUNGTU (
            CHUNGTU_ID
            , MACHUNGTU
            , SOCHUNGTU
            , NGAYCHUNGTU
            , LOAICHUNGTU
            , MUCDICHCHUNGTU_ID
            , MUCDICHCHUNGTU_CODE
            , KHOXUAT_ID
            , NGUOIGIAO_ID
            , NGUOIGIAO
            , KHONHAP_ID
            , NGUOINHAN_ID
            , NGUOINHAN
            , NGUOIKIEMTRA_ID
            , NGUOIKIEMTRA
            , NGUOIDUYET_ID
            , NGUOIDUYET
            , PHUONGPHAPXUAT
            , KETOANTRUONG_ID
            , KETOANTRUONG
            , THUKHO_ID
            , THUKHO
            , MAUHOADON
            , SOHOADON
            , SOSERI
            , NGAYHOADON
            , DIENGIAI
            , GIATRI
            , GIATRITHANHTOAN
            , TYLEVAT
            , GIATRIVAT
            , THUESUAT
            , GIATRITHUE
            , TYLECHIETKHAU
            , GIATRICHIETKHAU
            , TIENTE_ID
            , TYGIA
            , SOCHUNGTUGOC
            , NGAYCHUNGTUGOC
            , NHACUNGCAP_ID
            , HINHTHUCTHANHTOAN_ID
            , NGUONDUOC_ID
            , CHUNGTULIENQUAN_ID
            , KHAMBENH_ID
            , TOATHUOCNOITRU_ID
            , TIEPNHAN_ID
            , BENHAN_ID
            , DANHANTHUOC
            , NGUOINHAP_ID
            , NGAYNHAP
            , TRANGTHAI
            , LOAITOATHUOC
            , PHIEULINH_ID
            , DIENGIAINGHIEPVUPHATSINH
            , DONVIGIAO_ID
            , KHOSUDUNG_ID
            , LOAIVATTU_ID
            , BENHNHAN_ID
            , NGOAITRU_TOATHUOC_NGUOIMUA_ID
            , TENBENHNHAN
            , BACSIGIOITHIEU_ID
            , DOITUONG_ID
            , IDCHUYEN
            , CHUNGTUKETOAN
            , STATUS
            , TRANSFER_VIENPHI_ID
            , PHONGBAN_ID
            , BACSI_ID
            , TKNO
            , TKCO
            , MACHUNGTUREF
            , LOAICHUNGTUREF
            , PHIEULINHCANTRU_ID
            , KHOTHUCHIEN_ID
            , KHODOIUNG_ID
            , MENU_LOAIDUOC_ID
            , NGUOISUDUNGMAY_ID
            , GOITHAU_ID
            , XUATTHUOCBANGOAITRU
            , NGAYGIOCHUNGTU
            , NOIDAKHAM
            , HOIDONGKIEMNHAP_ID
            , HOIDONGTHANHLY_ID
            , CHUYENCHUNGTUID
            , CHUYENDOANHTHUID
            , LYDOXUATSUDUNG_ID
            , BENHVIEN_ID
            , NGAYTAO
            , NGUOITAO_ID
            , NGAYCAPNHAT
            , NGUOICAPNHAT_ID
            ) values (
            #ID#
            , #MACHUNGTU#
            , #SOCHUNGTU#
            , #NGAYCHUNGTU#
            , #LOAICHUNGTU#
            , #MUCDICHCHUNGTU_ID#
            , #MUCDICHCHUNGTU_CODE#
            , #KHOXUAT_ID#
            , #NGUOIGIAO_ID#
            , #NGUOIGIAO#
            , #KHONHAP_ID#
            , #NGUOINHAN_ID#
            , #NGUOINHAN#
            , #NGUOIKIEMTRA_ID#
            , #NGUOIKIEMTRA#
            , #NGUOIDUYET_ID#
            , #NGUOIDUYET#
            , #PHUONGPHAPXUAT#
            , #KETOANTRUONG_ID#
            , #KETOANTRUONG#
            , #THUKHO_ID#
            , #THUKHO#
            , #MAUHOADON#
            , #SOHOADON#
            , #SOSERI#
            , #NGAYHOADON#
            , #DIENGIAI#
            , #GIATRI#
            , #GIATRITHANHTOAN#
            , #TYLEVAT#
            , #GIATRIVAT#
            , #THUESUAT#
            , #GIATRITHUE#
            , #TYLECHIETKHAU#
            , #GIATRICHIETKHAU#
            , #TIENTE_ID#
            , #TYGIA#
            , #SOCHUNGTUGOC#
            , #NGAYCHUNGTUGOC#
            , #NHACUNGCAP_ID#
            , #HINHTHUCTHANHTOAN_ID#
            , #NGUONDUOC_ID#
            , #CHUNGTULIENQUAN_ID#
            , #KHAMBENH_ID#
            , #TOATHUOCNOITRU_ID#
            , #TIEPNHAN_ID#
            , #BENHAN_ID#
            , #DANHANTHUOC#
            , #NGUOINHAP_ID#
            , #NGAYNHAP#
            , #TRANGTHAI#
            , #LOAITOATHUOC#
            , #PHIEULINH_ID#
            , #DIENGIAINGHIEPVUPHATSINH#
            , #DONVIGIAO_ID#
            , #KHOSUDUNG_ID#
            , #LOAIVATTU_ID#
            , #BENHNHAN_ID#
            , #NGOAITRU_TOATHUOC_NGUOIMUA_ID#
            , #TENBENHNHAN#
            , #BACSIGIOITHIEU_ID#
            , #DOITUONG_ID#
            , #IDCHUYEN#
            , #CHUNGTUKETOAN#
            , #STATUS#
            , #TRANSFER_VIENPHI_ID#
            , #PHONGBAN_ID#
            , #BACSI_ID#
            , #TKNO#
            , #TKCO#
            , #MACHUNGTUREF#
            , #LOAICHUNGTUREF#
            , #PHIEULINHCANTRU_ID#
            , #KHOTHUCHIEN_ID#
            , #KHODOIUNG_ID#
            , #MENU_LOAIDUOC_ID#
            , #NGUOISUDUNGMAY_ID#
            , #GOITHAU_ID#
            , #XUATTHUOCBANGOAITRU#
            , #NGAYGIOCHUNGTU#
            , #NOIDAKHAM#
            , #HOIDONGKIEMNHAP_ID#
            , #HOIDONGTHANHLY_ID#
            , #CHUYENCHUNGTUID#
            , #CHUYENDOANHTHUID#
            , #LYDOXUATSUDUNG_ID#
            , #BENHVIEN_ID#
            , #NGAYCHUNGTU#
            , #NGUOITAO_ID#
            , #NGAYCAPNHAT#
            , #NGUOICAPNHAT_ID#
            )
        </insert>
        <!--Revision:0-->
        <update id="DAO00030_Update" parameterClass="System.Collections.IDictionary">
            update TT_DUOC_CHUNGTU set
            NGAYCHUNGTU = #NGAYCHUNGTU#
            , LOAICHUNGTU = #LOAICHUNGTU#
            , MUCDICHCHUNGTU_ID = #MUCDICHCHUNGTU_ID#
            , MUCDICHCHUNGTU_CODE = #MUCDICHCHUNGTU_CODE#
            , KHOXUAT_ID = #KHOXUAT_ID#
            , NGUOIGIAO_ID = #NGUOIGIAO_ID#
            , NGUOIGIAO = #NGUOIGIAO#
            , KHONHAP_ID = #KHONHAP_ID#
            , NGUOINHAN_ID = #NGUOINHAN_ID#
            , NGUOINHAN = #NGUOINHAN#
            , NGUOIKIEMTRA_ID = #NGUOIKIEMTRA_ID#
            , NGUOIKIEMTRA = #NGUOIKIEMTRA#
            , NGUOIDUYET_ID = #NGUOIDUYET_ID#
            , NGUOIDUYET = #NGUOIDUYET#
            , PHUONGPHAPXUAT = #PHUONGPHAPXUAT#
            , KETOANTRUONG_ID = #KETOANTRUONG_ID#
            , KETOANTRUONG = #KETOANTRUONG#
            , THUKHO_ID = #THUKHO_ID#
            , THUKHO = #THUKHO#
            , MAUHOADON = #MAUHOADON#
            , SOHOADON = #SOHOADON#
            , SOSERI = #SOSERI#
            , NGAYHOADON = #NGAYHOADON#
            , DIENGIAI = #DIENGIAI#
            , GIATRI = #GIATRI#
            , GIATRITHANHTOAN = #GIATRITHANHTOAN#
            , TYLEVAT = #TYLEVAT#
            , GIATRIVAT = #GIATRIVAT#
            , THUESUAT = #THUESUAT#
            , GIATRITHUE = #GIATRITHUE#
            , TYLECHIETKHAU = #TYLECHIETKHAU#
            , GIATRICHIETKHAU = #GIATRICHIETKHAU#
            , TIENTE_ID = #TIENTE_ID#
            , TYGIA = #TYGIA#
            , SOCHUNGTUGOC = #SOCHUNGTUGOC#
            , NGAYCHUNGTUGOC = #NGAYCHUNGTUGOC#
            , NHACUNGCAP_ID = #NHACUNGCAP_ID#
            , HINHTHUCTHANHTOAN_ID = #HINHTHUCTHANHTOAN_ID#
            , NGUONDUOC_ID = #NGUONDUOC_ID#
            , CHUNGTULIENQUAN_ID = #CHUNGTULIENQUAN_ID#
            , KHAMBENH_ID = #KHAMBENH_ID#
            , TOATHUOCNOITRU_ID = #TOATHUOCNOITRU_ID#
            , TIEPNHAN_ID = #TIEPNHAN_ID#
            , BENHAN_ID = #BENHAN_ID#
            , DANHANTHUOC = #DANHANTHUOC#
            , NGUOINHAP_ID = #NGUOINHAP_ID#
            , NGAYNHAP = #NGAYNHAP#
            , TRANGTHAI = #TRANGTHAI#
            , PHIEULINH_ID = #PHIEULINH_ID#
            , LOAITOATHUOC = #LOAITOATHUOC#
            , DIENGIAINGHIEPVUPHATSINH = #DIENGIAINGHIEPVUPHATSINH#
            , DONVIGIAO_ID = #DONVIGIAO_ID#
            , KHOSUDUNG_ID = #KHOSUDUNG_ID#
            , LOAIVATTU_ID = #LOAIVATTU_ID#
            , BENHNHAN_ID = #BENHNHAN_ID#
            , TENBENHNHAN = #TENBENHNHAN#
            , BACSIGIOITHIEU_ID = #BACSIGIOITHIEU_ID#
            , DOITUONG_ID = #DOITUONG_ID#
            , IDCHUYEN = #IDCHUYEN#
            , CHUNGTUKETOAN = #CHUNGTUKETOAN#
            , STATUS = #STATUS#
            , TRANSFER_VIENPHI_ID = #TRANSFER_VIENPHI_ID#
            , PHONGBAN_ID = #PHONGBAN_ID#
            , BACSI_ID = #BACSI_ID#
            , TKNO = #TKNO#
            , TKCO = #TKCO#
            , MACHUNGTUREF = #MACHUNGTUREF#
            , LOAICHUNGTUREF = #LOAICHUNGTUREF#
            , PHIEULINHCANTRU_ID = #PHIEULINHCANTRU_ID#
            , KHOTHUCHIEN_ID = #KHOTHUCHIEN_ID#
            , KHODOIUNG_ID = #KHODOIUNG_ID#
            , MENU_LOAIDUOC_ID = #MENU_LOAIDUOC_ID#
            , NGUOISUDUNGMAY_ID = #NGUOISUDUNGMAY_ID#
            , GOITHAU_ID = #GOITHAU_ID#
            , XUATTHUOCBANGOAITRU = #XUATTHUOCBANGOAITRU#
            , NGAYGIOCHUNGTU = #NGAYGIOCHUNGTU#
            , NOIDAKHAM = #NOIDAKHAM#
            , HOIDONGKIEMNHAP_ID = #HOIDONGKIEMNHAP_ID#
            , HOIDONGTHANHLY_ID = #HOIDONGTHANHLY_ID#
            , CHUYENCHUNGTUID = #CHUYENCHUNGTUID#
            , CHUYENDOANHTHUID = #CHUYENDOANHTHUID#
            , LYDOXUATSUDUNG_ID = #LYDOXUATSUDUNG_ID#
            <!--, BENHVIEN_ID = #BENHVIEN_ID#
      , NGAYTAO = #NGAYTAO#
      , NGUOITAO_ID = #NGUOITAO_ID#-->
            , NGAYCAPNHAT = #NGAYCAPNHAT#
            , NGUOICAPNHAT_ID = #NGUOICAPNHAT_ID#
            where
            CHUNGTU_ID = '$CHUNGTU_ID$'
        </update>
        <!--Revision:0-->
        <update id="DAO00030_UpdateChungTuLienQuan" parameterClass="System.Collections.IDictionary">
            update
            TT_DUOC_CHUNGTU
            set
            CHUNGTULIENQUAN_ID = #CHUNGTULIENQUAN_ID#
            where
            MACHUNGTU = '$MACHUNGTU$'
        </update>
        <!--Revision:0-->
        <update id="DAO00030_UpdateHoaDon" parameterClass="System.Collections.IDictionary">
            update
            TT_DUOC_CHUNGTU
            set
            MAUHOADON = #MAUHOADON#
            ,SOHOADON = #SOHOADON#
            ,SOSERI = #SOSERI#
            ,NGAYHOADON = #NGAYHOADON#
            ,NGAYCAPNHAT = #NGAYCAPNHAT#
            ,NGUOICAPNHAT_ID = #NGUOICAPNHAT_ID#
            where
            CHUNGTU_ID = '$CHUNGTU_ID$'
        </update>
        <!--Revision:0-->
        <statement id="DAO00030_Delete" parameterClass="System.Collections.IDictionary" resultClass="System.Int32">
            delete from TT_DUOC_CHUNGTU
            where
            CHUNGTU_ID = '$CHUNGTU_ID$'
        </statement>
        <!--Revision:0-->
        <statement id="DAO00030_DeleteP" parameterClass="System.Collections.IDictionary" resultClass="System.Int32">
            delete from TT_DUOC_CHUNGTU
            <dynamic prepend="where">
                <isParameterPresent>
                    <isNotEmpty prepend="and" property="CHUNGTU_ID">
                        TT_DUOC_CHUNGTU.CHUNGTU_ID = '$CHUNGTU_ID$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="MACHUNGTU">
                        TT_DUOC_CHUNGTU.MACHUNGTU = '$MACHUNGTU$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="SOCHUNGTU">
                        TT_DUOC_CHUNGTU.SOCHUNGTU = '$SOCHUNGTU$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="NGAYCHUNGTU">
                        TT_DUOC_CHUNGTU.NGAYCHUNGTU = '$NGAYCHUNGTU$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="LOAICHUNGTU">
                        TT_DUOC_CHUNGTU.LOAICHUNGTU = '$LOAICHUNGTU$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="MUCDICHCHUNGTU_ID">
                        TT_DUOC_CHUNGTU.MUCDICHCHUNGTU_ID = '$MUCDICHCHUNGTU_ID$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="KHOXUAT_ID">
                        TT_DUOC_CHUNGTU.KHOXUAT_ID = '$KHOXUAT_ID$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="NGUOIGIAO_ID">
                        TT_DUOC_CHUNGTU.NGUOIGIAO_ID = '$NGUOIGIAO_ID$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="NGUOIGIAO">
                        TT_DUOC_CHUNGTU.NGUOIGIAO = '$NGUOIGIAO$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="KHONHAP_ID">
                        TT_DUOC_CHUNGTU.KHONHAP_ID = '$KHONHAP_ID$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="NGUOINHAN_ID">
                        TT_DUOC_CHUNGTU.NGUOINHAN_ID = '$NGUOINHAN_ID$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="NGUOINHAN">
                        TT_DUOC_CHUNGTU.NGUOINHAN = '$NGUOINHAN$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="NGUOIKIEMTRA_ID">
                        TT_DUOC_CHUNGTU.NGUOIKIEMTRA_ID = '$NGUOIKIEMTRA_ID$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="NGUOIKIEMTRA">
                        TT_DUOC_CHUNGTU.NGUOIKIEMTRA = '$NGUOIKIEMTRA$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="NGUOIDUYET_ID">
                        TT_DUOC_CHUNGTU.NGUOIDUYET_ID = '$NGUOIDUYET_ID$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="NGUOIDUYET">
                        TT_DUOC_CHUNGTU.NGUOIDUYET = '$NGUOIDUYET$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="KETOANTRUONG_ID">
                        TT_DUOC_CHUNGTU.KETOANTRUONG_ID = '$KETOANTRUONG_ID$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="KETOANTRUONG">
                        TT_DUOC_CHUNGTU.KETOANTRUONG = '$KETOANTRUONG$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="THUKHO_ID">
                        TT_DUOC_CHUNGTU.THUKHO_ID = '$THUKHO_ID$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="THUKHO">
                        TT_DUOC_CHUNGTU.THUKHO = '$THUKHO$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="SOSERI">
                        TT_DUOC_CHUNGTU.SOSERI = '$SOSERI$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="MAUHOADON">
                        TT_DUOC_CHUNGTU.MAUHOADON = '$MAUHOADON$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="SOHOADON">
                        TT_DUOC_CHUNGTU.SOHOADON = '$SOHOADON$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="DIENGIAI">
                        TT_DUOC_CHUNGTU.DIENGIAI = '$DIENGIAI$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="GIATRI">
                        TT_DUOC_CHUNGTU.GIATRI = '$GIATRI$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="GIATRITHANHTOAN">
                        TT_DUOC_CHUNGTU.GIATRITHANHTOAN = '$GIATRITHANHTOAN$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="TYLEVAT">
                        TT_DUOC_CHUNGTU.TYLEVAT = '$TYLEVAT$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="GIATRIVAT">
                        TT_DUOC_CHUNGTU.GIATRIVAT = '$GIATRIVAT$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="THUESUAT">
                        TT_DUOC_CHUNGTU.THUESUAT = '$THUESUAT$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="GIATRITHUE">
                        TT_DUOC_CHUNGTU.GIATRITHUE = '$GIATRITHUE$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="TYLECHIETKHAU">
                        TT_DUOC_CHUNGTU.TYLECHIETKHAU = '$TYLECHIETKHAU$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="GIATRICHIETKHAU">
                        TT_DUOC_CHUNGTU.GIATRICHIETKHAU = '$GIATRICHIETKHAU$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="TIENTE_ID">
                        TT_DUOC_CHUNGTU.TIENTE_ID = '$TIENTE_ID$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="TYGIA">
                        TT_DUOC_CHUNGTU.TYGIA = '$TYGIA$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="SOCHUNGTUGOC">
                        TT_DUOC_CHUNGTU.SOCHUNGTUGOC = '$SOCHUNGTUGOC$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="NGAYCHUNGTUGOC">
                        TT_DUOC_CHUNGTU.NGAYCHUNGTUGOC = '$NGAYCHUNGTUGOC$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="NHACUNGCAP_ID">
                        TT_DUOC_CHUNGTU.NHACUNGCAP_ID = '$NHACUNGCAP_ID$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="HINHTHUCTHANHTOAN_ID">
                        TT_DUOC_CHUNGTU.HINHTHUCTHANHTOAN_ID = '$HINHTHUCTHANHTOAN_ID$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="NGUONDUOC_ID">
                        TT_DUOC_CHUNGTU.NGUONDUOC_ID = '$NGUONDUOC_ID$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="HOIDONGKIEMNHAP_ID">
                        TT_DUOC_CHUNGTU.HOIDONGKIEMNHAP_ID = '$HOIDONGKIEMNHAP_ID$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="CHUNGTULIENQUAN_ID">
                        TT_DUOC_CHUNGTU.CHUNGTULIENQUAN_ID = '$CHUNGTULIENQUAN_ID$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="KHAMBENH_ID">
                        TT_DUOC_CHUNGTU.KHAMBENH_ID = '$KHAMBENH_ID$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="TOATHUOCNOITRU_ID">
                        TT_DUOC_CHUNGTU.TOATHUOCNOITRU_ID = '$TOATHUOCNOITRU_ID$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="BENHAN_ID">
                        TT_DUOC_CHUNGTU.BENHAN_ID = '$BENHAN_ID$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="DANHANTHUOC">
                        TT_DUOC_CHUNGTU.DANHANTHUOC = '$DANHANTHUOC$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="NGUOINHAP_ID">
                        TT_DUOC_CHUNGTU.NGUOINHAP_ID = '$NGUOINHAP_ID$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="NGAYNHAP">
                        TT_DUOC_CHUNGTU.NGAYNHAP = '$NGAYNHAP$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="TRANGTHAI">
                        TT_DUOC_CHUNGTU.TRANGTHAI = '$TRANGTHAI$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="PHIEULINH_ID">
                        TT_DUOC_CHUNGTU.PHIEULINH_ID = '$PHIEULINH_ID$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="DIENGIAINGHIEPVUPHATSINH">
                        TT_DUOC_CHUNGTU.DIENGIAINGHIEPVUPHATSINH = '$DIENGIAINGHIEPVUPHATSINH$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="DONVIGIAO_ID">
                        TT_DUOC_CHUNGTU.DONVIGIAO_ID = '$DONVIGIAO_ID$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="TYLEVATNHAPKHAU">
                        TT_DUOC_CHUNGTU.TYLEVATNHAPKHAU = '$TYLEVATNHAPKHAU$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="GIATRIVATNHAPKHAU">
                        TT_DUOC_CHUNGTU.GIATRIVATNHAPKHAU = '$GIATRIVATNHAPKHAU$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="SOSERINUOCNGOAI">
                        TT_DUOC_CHUNGTU.SOSERINUOCNGOAI = '$SOSERINUOCNGOAI$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="SOHOADONNUOCNGOAI">
                        TT_DUOC_CHUNGTU.SOHOADONNUOCNGOAI = '$SOHOADONNUOCNGOAI$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="NGAYHOADONNUOCNGOAI">
                        TT_DUOC_CHUNGTU.NGAYHOADONNUOCNGOAI = '$NGAYHOADONNUOCNGOAI$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="KHOSUDUNG_ID">
                        TT_DUOC_CHUNGTU.KHOSUDUNG_ID = '$KHOSUDUNG_ID$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="LOAIVATTU_ID">
                        TT_DUOC_CHUNGTU.LOAIVATTU_ID = '$LOAIVATTU_ID$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="BENHNHAN_ID">
                        TT_DUOC_CHUNGTU.BENHNHAN_ID = '$BENHNHAN_ID$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="TENBENHNHAN">
                        TT_DUOC_CHUNGTU.TENBENHNHAN = '$TENBENHNHAN$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="GIOITINH">
                        TT_DUOC_CHUNGTU.GIOITINH = '$GIOITINH$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="NAMSINH">
                        TT_DUOC_CHUNGTU.NAMSINH = '$NAMSINH$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="DIACHI">
                        TT_DUOC_CHUNGTU.DIACHI = '$DIACHI$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="SODIENTHOAI">
                        TT_DUOC_CHUNGTU.SODIENTHOAI = '$SODIENTHOAI$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="BACSIGIOITHIEU_ID">
                        TT_DUOC_CHUNGTU.BACSIGIOITHIEU_ID = '$BACSIGIOITHIEU_ID$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="DOITUONG_ID">
                        TT_DUOC_CHUNGTU.DOITUONG_ID = '$DOITUONG_ID$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="IDCHUYEN">
                        TT_DUOC_CHUNGTU.IDCHUYEN = '$IDCHUYEN$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="CHUNGTUKETOAN">
                        TT_DUOC_CHUNGTU.CHUNGTUKETOAN = '$CHUNGTUKETOAN$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="STATUS">
                        TT_DUOC_CHUNGTU.STATUS = '$STATUS$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="TRANSFER_VIENPHI_ID">
                        TT_DUOC_CHUNGTU.TRANSFER_VIENPHI_ID = '$TRANSFER_VIENPHI_ID$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="PHONGBAN_ID">
                        TT_DUOC_CHUNGTU.PHONGBAN_ID = '$PHONGBAN_ID$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="BACSI_ID">
                        TT_DUOC_CHUNGTU.BACSI_ID = '$BACSI_ID$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="TKNO">
                        TT_DUOC_CHUNGTU.TKNO = '$TKNO$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="TKCO">
                        TT_DUOC_CHUNGTU.TKCO = '$TKCO$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="MACHUNGTUREF">
                        TT_DUOC_CHUNGTU.MACHUNGTUREF = '$MACHUNGTUREF$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="LOAICHUNGTUREF">
                        TT_DUOC_CHUNGTU.LOAICHUNGTUREF = '$LOAICHUNGTUREF$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="PHIEULINHCANTRU_ID">
                        TT_DUOC_CHUNGTU.PHIEULINHCANTRU_ID = '$PHIEULINHCANTRU_ID$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="KHOTHUCHIEN_ID">
                        TT_DUOC_CHUNGTU.KHOTHUCHIEN_ID = '$KHOTHUCHIEN_ID$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="KHODOIUNG_ID">
                        TT_DUOC_CHUNGTU.KHODOIUNG_ID = '$KHODOIUNG_ID$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="MENU_LOAIDUOC_ID">
                        TT_DUOC_CHUNGTU.MENU_LOAIDUOC_ID = '$MENU_LOAIDUOC_ID$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="NGUOISUDUNGMAY_ID">
                        TT_DUOC_CHUNGTU.NGUOISUDUNGMAY_ID = '$NGUOISUDUNGMAY_ID$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="GOITHAU_ID">
                        TT_DUOC_CHUNGTU.GOITHAU_ID = '$GOITHAU_ID$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="XUATTHUOCBANGOAITRU">
                        TT_DUOC_CHUNGTU.XUATTHUOCBANGOAITRU = '$XUATTHUOCBANGOAITRU$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="NGAYGIOCHUNGTU">
                        TT_DUOC_CHUNGTU.NGAYGIOCHUNGTU = '$NGAYGIOCHUNGTU$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="NOIDAKHAM">
                        TT_DUOC_CHUNGTU.NOIDAKHAM = '$NOIDAKHAM$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="CHUYENCHUNGTUID">
                        TT_DUOC_CHUNGTU.CHUYENCHUNGTUID = '$CHUYENCHUNGTUID$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="CHUYENDOANHTHUID">
                        TT_DUOC_CHUNGTU.CHUYENDOANHTHUID = '$CHUYENDOANHTHUID$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="BENHVIEN_ID">
                        TT_DUOC_CHUNGTU.BENHVIEN_ID = '$BENHVIEN_ID$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="NGAYTAO">
                        TT_DUOC_CHUNGTU.NGAYTAO = '$NGAYTAO$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="NGUOITAO_ID">
                        TT_DUOC_CHUNGTU.NGUOITAO_ID = '$NGUOITAO_ID$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="NGAYCAPNHAT">
                        TT_DUOC_CHUNGTU.NGAYCAPNHAT = '$NGAYCAPNHAT$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="NGUOICAPNHAT_ID">
                        TT_DUOC_CHUNGTU.NGUOICAPNHAT_ID = '$NGUOICAPNHAT_ID$'
                    </isNotEmpty>
                </isParameterPresent>
            </dynamic>
        </statement>
        <!--Revision:0-->
        <statement id="DAO00030_CHUNGTUCT_TON" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
            SELECT A.*, B.TONGTON FROM
            (
            SELECT
            CTCT.CHUNGTUCHITIET_ID, CTCT.CHUNGTU_ID, CTCT.SOLONHAP_ID, CTCT.DUOC_ID, CTCT.SOLUONGYEUCAU, CTCT.SOLUONGDAXUAT, CTCT.NGUONHANG_ID
            FROM
            TT_DUOC_CHUNGTU_CHITIET CTCT
            WHERE
            CTCT.CHUNGTU_ID = '$CHUNGTU_ID$'
            and CTCT.BENHVIEN_ID = '$BENHVIEN_ID$'
            )A,
            (
            SELECT
            CTCT.DUOC_ID AS DUOC_ID, SUM(SOLUONG) AS TONGTON
            FROM
            TT_DUOC_TONKHO TK, TT_DUOC_CHUNGTU_CHITIET CTCT, TT_DUOC_CHUNGTU CT
            WHERE
            TK.KHODUOC_ID = CT.KHOXUAT_ID
            and CT.BENHVIEN_ID = '$BENHVIEN_ID$'
            AND CT.CHUNGTU_ID = CTCT.CHUNGTU_ID
            AND CTCT.DUOC_ID = TK.DUOC_ID
            AND CTCT.CHUNGTU_ID = '$CHUNGTU_ID$'
            GROUP BY TK.KHODUOC_ID, CTCT.DUOC_ID
            ) B
            WHERE A.DUOC_ID = B.DUOC_ID
        </statement>
        <!--Revision:0-->
        <statement id="DAO00030_CHUNGTUCT_GetAll" resultClass="DataObject">
            select *
            from TT_DUOC_CHUNGTU_CHITIET
            WHERE BENHVIEN_ID = '$BENHVIEN_ID$'
            order by CHUNGTUCHITIET_ID
        </statement>
        <!--Revision:0-->
        <statement id="DAO00030_CHUNGTUXUAT_CHITIET_GetList" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
          SELECT
          ctct.*,
          d.MADUOC, d.TENHANG, TO_CHAR(D.TENDUOCDAYDU) TENDUOCDAYDU , dvt.TENDONVITINH as DONVITINH,
          n.TENNGUONDUOC as NGUONHANG,
          sln.SOLONHAP, sln.SOLOSANPHAM, sln.NGAYNHAP as NGAYNHAPLO, sln.HANDUNG as HANSUDUNG,
          tk.SOLUONG as SOLUONGTON,
          LTRIM(tk.KHODUOC_ID) || '_' || LTRIM(tk.DUOC_ID) || '_' || LTRIM(tk.NGUONDUOC_ID) as DUOC_KEY
          FROM
          TT_DUOC_CHUNGTU_CHITIET ctct
          INNER JOIN TT_DUOC_CHUNGTU ct ON (ct.CHUNGTU_ID = ctct.CHUNGTU_ID)
          INNER JOIN TT_DUOC_CHUNGTU_SOLONHAP sln ON (sln.SOLONHAP_ID = ctct.SOLONHAP_ID)
          INNER JOIN TT_DUOC_TONKHO tk ON (tk.SOLONHAP_ID = sln.SOLONHAP_ID AND tk.DUOC_ID = sln.DUOC_ID and tk.KHODUOC_ID = ct.KHOXUAT_ID)
          INNER JOIN TM_DUOC d ON (d.DUOC_ID = ctct.DUOC_ID)
          INNER JOIN TM_NGUONHANG n ON (n.NGUONDUOC_ID = ctct.NGUONHANG_ID)
          LEFT JOIN TM_DONVITINH dvt ON (dvt.DONVITINH_ID = ctct.DONVITINH_ID)
          <dynamic prepend="where">
                <isParameterPresent>
                    <isNotEmpty prepend="and" property="CHUNGTU_ID">
                        ct.CHUNGTU_ID = '$CHUNGTU_ID$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="BENHVIEN_ID">
                        ct.BENHVIEN_ID = '$BENHVIEN_ID$'
                    </isNotEmpty>
                </isParameterPresent>
            </dynamic>
            order by CHUNGTUCHITIET_ID
        </statement>
        <!--Revision:0-->
        <statement id="DAO00030_CHUNGTUNHAP_CHITIET_GetList" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
          SELECT
          ctct.*,
          d.MADUOC, d.TENHANG, TO_CHAR(D.TENDUOCDAYDU) TENDUOCDAYDU , d.DONVITINH,
          n.TENNGUONDUOC as NGUONHANG,
          sln.SOLONHAP, sln.SOLOSANPHAM, sln.NGAYNHAP as NGAYNHAPLO, sln.HANDUNG as HANSUDUNG,
          tk.SOLUONG as SOLUONGTON,
          LTRIM(tk.KHODUOC_ID) || '_' || LTRIM(tk.DUOC_ID) || '_' || LTRIM(tk.NGUONDUOC_ID) as DUOC_KEY
          FROM
          TT_DUOC_CHUNGTU_CHITIET ctct
          INNER JOIN TT_DUOC_CHUNGTU ct ON (ct.CHUNGTU_ID = ctct.CHUNGTU_ID)
          INNER JOIN TT_DUOC_CHUNGTU_SOLONHAP sln ON (sln.SOLONHAP_ID = ctct.SOLONHAP_ID)
          INNER JOIN TT_DUOC_TONKHO tk ON (tk.SOLONHAP_ID = sln.SOLONHAP_ID AND tk.DUOC_ID = sln.DUOC_ID and tk.KHODUOC_ID = ct.KHONHAP_ID)
          INNER JOIN TM_DUOC d ON (d.DUOC_ID = ctct.DUOC_ID)
          INNER JOIN TM_NGUONHANG n ON (n.NGUONDUOC_ID = ctct.NGUONHANG_ID)
          LEFT JOIN TM_DONVITINH dvt ON (dvt.DONVITINH_ID = ctct.DONVITINH_ID)
          <dynamic prepend="where">
                <isParameterPresent>
                    <isNotEmpty prepend="and" property="CHUNGTU_ID">
                        ct.CHUNGTU_ID = '$CHUNGTU_ID$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="BENHVIEN_ID">
                        ct.BENHVIEN_ID = '$BENHVIEN_ID$'
                    </isNotEmpty>
                </isParameterPresent>
            </dynamic>
            order by CHUNGTUCHITIET_ID
        </statement>
        <!--Revision:0-->
        <statement id="DAO00030_CHUNGTUCT_GetList" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
          select TT_DUOC_CHUNGTU_CHITIET.*, SLN.SOLONHAP, SLN.SOLOSANPHAM, D.TENDUOCDAYDU
          from TT_DUOC_CHUNGTU_CHITIET
          left join TT_DUOC_CHUNGTU_SOLONHAP SLN on SLN.SOLONHAP_ID = TT_DUOC_CHUNGTU_CHITIET.SOLONHAP_ID
          left join TM_DUOC D on D.DUOC_ID = TT_DUOC_CHUNGTU_CHITIET.DUOC_ID
          <dynamic prepend="where">
                <isParameterPresent>
                    <isNotEmpty prepend="and" property="CHUNGTUCHITIET_ID">
                        TT_DUOC_CHUNGTU_CHITIET.CHUNGTUCHITIET_ID = '$CHUNGTUCHITIET_ID$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="CHUNGTU_ID">
                        TT_DUOC_CHUNGTU_CHITIET.CHUNGTU_ID = '$CHUNGTU_ID$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="DUOC_ID">
                        TT_DUOC_CHUNGTU_CHITIET.DUOC_ID = '$DUOC_ID$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="SOLONHAP_ID">
                        TT_DUOC_CHUNGTU_CHITIET.SOLONHAP_ID = '$SOLONHAP_ID$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="SOKIEMSOAT">
                        TT_DUOC_CHUNGTU_CHITIET.SOKIEMSOAT = '$SOKIEMSOAT$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="SOVISA">
                        TT_DUOC_CHUNGTU_CHITIET.SOVISA = '$SOVISA$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="HANDUNG">
                        TT_DUOC_CHUNGTU_CHITIET.HANDUNG = '$HANDUNG$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="DONVITINH_ID">
                        TT_DUOC_CHUNGTU_CHITIET.DONVITINH_ID = '$DONVITINH_ID$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="SOLUONGYEUCAU">
                        TT_DUOC_CHUNGTU_CHITIET.SOLUONGYEUCAU = '$SOLUONGYEUCAU$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="SOLUONGTHUCTE">
                        TT_DUOC_CHUNGTU_CHITIET.SOLUONGTHUCTE = '$SOLUONGTHUCTE$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="SOLUONGDAXUAT">
                        TT_DUOC_CHUNGTU_CHITIET.SOLUONGDAXUAT = '$SOLUONGDAXUAT$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="TIENTE_ID">
                        TT_DUOC_CHUNGTU_CHITIET.TIENTE_ID = '$TIENTE_ID$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="TYGIA">
                        TT_DUOC_CHUNGTU_CHITIET.TYGIA = '$TYGIA$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="DONGIAMUA">
                        TT_DUOC_CHUNGTU_CHITIET.DONGIAMUA = '$DONGIAMUA$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="DONGIABAN">
                        TT_DUOC_CHUNGTU_CHITIET.DONGIABAN = '$DONGIABAN$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="DONGIAVON">
                        TT_DUOC_CHUNGTU_CHITIET.DONGIAVON = '$DONGIAVON$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="DONGIATHANHTOAN">
                        TT_DUOC_CHUNGTU_CHITIET.DONGIATHANHTOAN = '$DONGIATHANHTOAN$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="SOQUYEN">
                        TT_DUOC_CHUNGTU_CHITIET.SOQUYEN = '$SOQUYEN$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="SOHOADONVAT">
                        TT_DUOC_CHUNGTU_CHITIET.SOHOADONVAT = '$SOHOADONVAT$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="TYLEVAT">
                        TT_DUOC_CHUNGTU_CHITIET.TYLEVAT = '$TYLEVAT$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="GIATRIVAT">
                        TT_DUOC_CHUNGTU_CHITIET.GIATRIVAT = '$GIATRIVAT$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="MIENPHI">
                        TT_DUOC_CHUNGTU_CHITIET.MIENPHI = '$MIENPHI$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="LYDOMIENPHI_ID">
                        TT_DUOC_CHUNGTU_CHITIET.LYDOMIENPHI_ID = '$LYDOMIENPHI_ID$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="SOCHUNGTUKETOAN">
                        TT_DUOC_CHUNGTU_CHITIET.SOCHUNGTUKETOAN = '$SOCHUNGTUKETOAN$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="SOCHUNGTUTIENMAT">
                        TT_DUOC_CHUNGTU_CHITIET.SOCHUNGTUTIENMAT = '$SOCHUNGTUTIENMAT$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="TRANGTHAI">
                        TT_DUOC_CHUNGTU_CHITIET.TRANGTHAI = '$TRANGTHAI$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="DAPHATSINHPHIEUXUAT">
                        TT_DUOC_CHUNGTU_CHITIET.DAPHATSINHPHIEUXUAT = '$DAPHATSINHPHIEUXUAT$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="DAPHATSINHPHIEUHOANTRA">
                        TT_DUOC_CHUNGTU_CHITIET.DAPHATSINHPHIEUHOANTRA = '$DAPHATSINHPHIEUHOANTRA$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="KHUYENMAI">
                        TT_DUOC_CHUNGTU_CHITIET.KHUYENMAI = '$KHUYENMAI$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="DONDATHANG_ID">
                        TT_DUOC_CHUNGTU_CHITIET.DONDATHANG_ID = '$DONDATHANG_ID$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="GHICHUCHITIET">
                        TT_DUOC_CHUNGTU_CHITIET.GHICHUCHITIET = '$GHICHUCHITIET$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="NGUONHANG_ID">
                        TT_DUOC_CHUNGTU_CHITIET.NGUONHANG_ID = '$NGUONHANG_ID$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="DONGIAVONVAT">
                        TT_DUOC_CHUNGTU_CHITIET.DONGIAVONVAT = '$DONGIAVONVAT$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="THANHTIENMUA">
                        TT_DUOC_CHUNGTU_CHITIET.THANHTIENMUA = '$THANHTIENMUA$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="THANHTIENVON">
                        TT_DUOC_CHUNGTU_CHITIET.THANHTIENVON = '$THANHTIENVON$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="ISTACHLO">
                        TT_DUOC_CHUNGTU_CHITIET.ISTACHLO = '$ISTACHLO$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="DONVITINHBANDAU_ID">
                        TT_DUOC_CHUNGTU_CHITIET.DONVITINHBANDAU_ID = '$DONVITINHBANDAU_ID$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="SOLUONGBANDAU">
                        TT_DUOC_CHUNGTU_CHITIET.SOLUONGBANDAU = '$SOLUONGBANDAU$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="GOITHAU_ID">
                        TT_DUOC_CHUNGTU_CHITIET.GOITHAU_ID = '$GOITHAU_ID$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="DONGIATHAU">
                        TT_DUOC_CHUNGTU_CHITIET.DONGIATHAU = '$DONGIATHAU$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="TYLEQUIDOI">
                        TT_DUOC_CHUNGTU_CHITIET.TYLEQUIDOI = '$TYLEQUIDOI$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="BENHVIEN_ID">
                        TT_DUOC_CHUNGTU_CHITIET.BENHVIEN_ID = '$BENHVIEN_ID$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="NGAYTAO">
                        TT_DUOC_CHUNGTU_CHITIET.NGAYTAO = '$NGAYTAO$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="NGUOITAO_ID">
                        TT_DUOC_CHUNGTU_CHITIET.NGUOITAO_ID = '$NGUOITAO_ID$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="NGAYCAPNHAT">
                        TT_DUOC_CHUNGTU_CHITIET.NGAYCAPNHAT = '$NGAYCAPNHAT$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="NGUOICAPNHAT_ID">
                        TT_DUOC_CHUNGTU_CHITIET.NGUOICAPNHAT_ID = '$NGUOICAPNHAT_ID$'
                    </isNotEmpty>
                </isParameterPresent>
            </dynamic>
            order by CHUNGTUCHITIET_ID
        </statement>
        <!--Revision:0-->
        <statement id="DAO00030_CHUNGTUCT_GetDetail" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
            select *
            from TT_DUOC_CHUNGTU_CHITIET
            where CHUNGTUCHITIET_ID  = '$value$'
            and BENHVIEN_ID = '$BENHVIEN_ID$'
            order by CHUNGTUCHITIET_ID
        </statement>
        <!--Revision:0-->
        <statement id="DAO00030_CHUNGTUCT_GetDetailP" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
            select *
            from TT_DUOC_CHUNGTU_CHITIET
            where CHUNGTUCHITIET_ID  = '$CHUNGTUCHITIET_ID$'
            and BENHVIEN_ID = '$BENHVIEN_ID$'
            order by CHUNGTUCHITIET_ID
        </statement>
        <!--Revision:0-->
        <insert id="DAO00030_CHUNGTUCT_Add" parameterClass="System.Collections.IDictionary" resultClass="System.Int64">
            <selectKey property="CHUNGTUCHITIET_ID" type="pre" resultClass="System.Int64">
                select TT_DUOC_CHUNGTU_CHITIET_S.nextval as value from dual
            </selectKey>
            insert into TT_DUOC_CHUNGTU_CHITIET (
            CHUNGTUCHITIET_ID
            , CHUNGTU_ID
            , DUOC_ID
            , SOLONHAP_ID
            , SOKIEMSOAT
            , SOVISA
            , HANDUNG
            , DONVITINH_ID
            , SOLUONGYEUCAU
            , SOLUONGTHUCTE
            , SOLUONGDAXUAT
            , TIENTE_ID
            , TYGIA
            , DONGIAMUA
            , DONGIA_BHYT
            , DONGIABAN
            , DONGIABAN_VAT
            , DONGIAVON
            , DONGIATHANHTOAN
            , SOQUYEN
            , SOHOADONVAT
            , TYLEVAT
            , GIATRIVAT
            , TYLECHIETKHAU
            , GIATRICHIETKHAU
            , MIENPHI
            , LYDOMIENPHI_ID
            , SOCHUNGTUKETOAN
            , SOCHUNGTUTIENMAT
            , TRANGTHAI
            , DAPHATSINHPHIEUXUAT
            , DAPHATSINHPHIEUHOANTRA
            , KHUYENMAI
            , PHUONGPHAPXUAT
            , DONDATHANG_ID
            , GHICHUCHITIET
            , NGUONHANG_ID
            , DONGIAVONVAT
            , THANHTIENMUA
            , THANHTIENVON
            , THANHTIENHOPDONG
            , ISTACHLO
            , DONVITINHBANDAU_ID
            , SOLUONGBANDAU
            , GOITHAU_ID
            , DONGIATHAU
            , TYLEQUIDOI
            , TOATHUOCNOITRU_ID
            , KHAMBENH_VTYT_ID
            , PHAUTHUAT_VTYT_ID
            , CLSKETQUA_VTYT_ID
            , TOATHUOCNGOAITRU_ID
            , BENHNHAN
            , YLENH
            , BENHVIEN_ID
            , NGAYTAO
            , NGUOITAO_ID
            , NGAYCAPNHAT
            , NGUOICAPNHAT_ID
            ) values (
            #CHUNGTUCHITIET_ID#
            , #CHUNGTU_ID#
            , #DUOC_ID#
            , #SOLONHAP_ID#
            , #SOKIEMSOAT#
            , #SOVISA#
            , #HANDUNG#
            , #DONVITINH_ID#
            , #SOLUONGYEUCAU#
            , #SOLUONGTHUCTE#
            , #SOLUONGDAXUAT#
            , #TIENTE_ID#
            , #TYGIA#
            , #DONGIAMUA#
            , #DONGIA_BHYT#
            , #DONGIABAN#
            , #DONGIABAN_VAT#
            , #DONGIAVON#
            , #DONGIATHANHTOAN#
            , #SOQUYEN#
            , #SOHOADONVAT#
            , #TYLEVAT#
            , #GIATRIVAT#
            , #TYLECHIETKHAU#
            , #GIATRICHIETKHAU#
            , #MIENPHI#
            , #LYDOMIENPHI_ID#
            , #SOCHUNGTUKETOAN#
            , #SOCHUNGTUTIENMAT#
            , #TRANGTHAI#
            , #DAPHATSINHPHIEUXUAT#
            , #DAPHATSINHPHIEUHOANTRA#
            , #KHUYENMAI#
            , #PHUONGPHAPXUAT#
            , #DONDATHANG_ID#
            , #GHICHUCHITIET#
            , #NGUONHANG_ID#
            , #DONGIAVONVAT#
            , #THANHTIENMUA#
            , #THANHTIENVON#
            , #THANHTIENHOPDONG#
            , #ISTACHLO#
            , #DONVITINHBANDAU_ID#
            , #SOLUONGBANDAU#
            , #GOITHAU_ID#
            , #DONGIATHAU#
            , #TYLEQUIDOI#
            , #TOATHUOCNOITRU_ID#
            , #KHAMBENH_VTYT_ID#
            , #PHAUTHUAT_VTYT_ID#
            , #CLSKETQUA_VTYT_ID#
            , #TOATHUOCNGOAITRU_ID#
            , #BENHNHAN#
            , #YLENH#
            , #BENHVIEN_ID#
            , #NGAYTAO#
            , #NGUOITAO_ID#
            , #NGAYCAPNHAT#
            , #NGUOICAPNHAT_ID#
            )
        </insert>
        <!--Revision:0-->
        <update id="DAO00030_CHUNGTUCT_Update" parameterClass="System.Collections.IDictionary">
          update TT_DUOC_CHUNGTU_CHITIET set
          CHUNGTU_ID = #CHUNGTU_ID#
          , DUOC_ID = #DUOC_ID#
          , SOLONHAP_ID = #SOLONHAP_ID#
          , SOKIEMSOAT = #SOKIEMSOAT#
          , SOVISA = #SOVISA#
          , HANDUNG = #HANDUNG#
          , DONVITINH_ID = #DONVITINH_ID#
          , SOLUONGYEUCAU = #SOLUONGYEUCAU#
          , SOLUONGTHUCTE = #SOLUONGTHUCTE#
          , SOLUONGDAXUAT = #SOLUONGDAXUAT#
          , TIENTE_ID = #TIENTE_ID#
          , TYGIA = #TYGIA#
          , DONGIAMUA = #DONGIAMUA#
          , DONGIA_BHYT = #DONGIA_BHYT#
          , DONGIABAN = #DONGIABAN#
          , DONGIABAN_VAT = #DONGIABAN_VAT#
          , DONGIAVON = #DONGIAVON#
          , DONGIATHANHTOAN = #DONGIATHANHTOAN#
          , SOQUYEN = #SOQUYEN#
          , SOHOADONVAT = #SOHOADONVAT#
          , TYLEVAT = #TYLEVAT#
          , GIATRIVAT = #GIATRIVAT#
          , MIENPHI = #MIENPHI#
          , LYDOMIENPHI_ID = #LYDOMIENPHI_ID#
          , SOCHUNGTUKETOAN = #SOCHUNGTUKETOAN#
          , SOCHUNGTUTIENMAT = #SOCHUNGTUTIENMAT#
          , TRANGTHAI = #TRANGTHAI#
          , DAPHATSINHPHIEUXUAT = #DAPHATSINHPHIEUXUAT#
          , DAPHATSINHPHIEUHOANTRA = #DAPHATSINHPHIEUHOANTRA#
          , KHUYENMAI = #KHUYENMAI#
          , PHUONGPHAPXUAT = #PHUONGPHAPXUAT#
          , DONDATHANG_ID = #DONDATHANG_ID#
          , GHICHUCHITIET = #GHICHUCHITIET#
          , NGUONHANG_ID = #NGUONHANG_ID#
          , DONGIAVONVAT = #DONGIAVONVAT#
          , THANHTIENMUA = #THANHTIENMUA#
          , THANHTIENVON = #THANHTIENVON#
          , THANHTIENHOPDONG = #THANHTIENHOPDONG#
          , ISTACHLO = #ISTACHLO#
          , DONVITINHBANDAU_ID = #DONVITINHBANDAU_ID#
          , SOLUONGBANDAU = #SOLUONGBANDAU#
          , GOITHAU_ID = #GOITHAU_ID#
          , DONGIATHAU = #DONGIATHAU#
          , TYLEQUIDOI = #TYLEQUIDOI#
          , TOATHUOCNOITRU_ID = #TOATHUOCNOITRU_ID#
          , KHAMBENH_VTYT_ID = #KHAMBENH_VTYT_ID#
          , PHAUTHUAT_VTYT_ID = #PHAUTHUAT_VTYT_ID#
          , CLSKETQUA_VTYT_ID = #CLSKETQUA_VTYT_ID#
          , BENHNHAN = #BENHNHAN#
          , YLENH = #YLENH#
          <!--, BENHVIEN_ID = #BENHVIEN_ID#
      , NGAYTAO = #NGAYTAO#
      , NGUOITAO_ID = #NGUOITAO_ID#-->
            , NGAYCAPNHAT = #NGAYCAPNHAT#
            , NGUOICAPNHAT_ID = #NGUOICAPNHAT_ID#
            where
            CHUNGTUCHITIET_ID = '$CHUNGTUCHITIET_ID$'
        </update>
        <!--Revision:0-->
        <statement id="DAO00030_CHUNGTUCT_Delete" parameterClass="System.Collections.IDictionary" resultClass="System.Int32">
            delete from TT_DUOC_CHUNGTU_CHITIET
            where
            CHUNGTUCHITIET_ID = '$CHUNGTUCHITIET_ID$'
        </statement>
        <!--Revision:0-->
        <statement id="DAO00030_CHUNGTUCT_DeleteP" parameterClass="System.Collections.IDictionary" resultClass="System.Int32">
            delete from TT_DUOC_CHUNGTU_CHITIET
            <dynamic prepend="where">
                <isParameterPresent>
                    <isNotEmpty prepend="and" property="CHUNGTUCHITIET_ID">
                        TT_DUOC_CHUNGTU_CHITIET.CHUNGTUCHITIET_ID = '$CHUNGTUCHITIET_ID$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="CHUNGTU_ID">
                        TT_DUOC_CHUNGTU_CHITIET.CHUNGTU_ID = '$CHUNGTU_ID$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="DUOC_ID">
                        TT_DUOC_CHUNGTU_CHITIET.DUOC_ID = '$DUOC_ID$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="SOLONHAP_ID">
                        TT_DUOC_CHUNGTU_CHITIET.SOLONHAP_ID = '$SOLONHAP_ID$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="SOKIEMSOAT">
                        TT_DUOC_CHUNGTU_CHITIET.SOKIEMSOAT = '$SOKIEMSOAT$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="SOVISA">
                        TT_DUOC_CHUNGTU_CHITIET.SOVISA = '$SOVISA$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="HANDUNG">
                        TT_DUOC_CHUNGTU_CHITIET.HANDUNG = '$HANDUNG$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="DONVITINH_ID">
                        TT_DUOC_CHUNGTU_CHITIET.DONVITINH_ID = '$DONVITINH_ID$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="SOLUONGYEUCAU">
                        TT_DUOC_CHUNGTU_CHITIET.SOLUONGYEUCAU = '$SOLUONGYEUCAU$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="SOLUONGTHUCTE">
                        TT_DUOC_CHUNGTU_CHITIET.SOLUONGTHUCTE = '$SOLUONGTHUCTE$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="SOLUONGDAXUAT">
                        TT_DUOC_CHUNGTU_CHITIET.SOLUONGDAXUAT = '$SOLUONGDAXUAT$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="TIENTE_ID">
                        TT_DUOC_CHUNGTU_CHITIET.TIENTE_ID = '$TIENTE_ID$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="TYGIA">
                        TT_DUOC_CHUNGTU_CHITIET.TYGIA = '$TYGIA$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="DONGIAMUA">
                        TT_DUOC_CHUNGTU_CHITIET.DONGIAMUA = '$DONGIAMUA$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="DONGIABAN">
                        TT_DUOC_CHUNGTU_CHITIET.DONGIABAN = '$DONGIABAN$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="DONGIAVON">
                        TT_DUOC_CHUNGTU_CHITIET.DONGIAVON = '$DONGIAVON$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="DONGIATHANHTOAN">
                        TT_DUOC_CHUNGTU_CHITIET.DONGIATHANHTOAN = '$DONGIATHANHTOAN$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="SOQUYEN">
                        TT_DUOC_CHUNGTU_CHITIET.SOQUYEN = '$SOQUYEN$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="SOHOADONVAT">
                        TT_DUOC_CHUNGTU_CHITIET.SOHOADONVAT = '$SOHOADONVAT$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="TYLEVAT">
                        TT_DUOC_CHUNGTU_CHITIET.TYLEVAT = '$TYLEVAT$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="GIATRIVAT">
                        TT_DUOC_CHUNGTU_CHITIET.GIATRIVAT = '$GIATRIVAT$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="MIENPHI">
                        TT_DUOC_CHUNGTU_CHITIET.MIENPHI = '$MIENPHI$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="LYDOMIENPHI_ID">
                        TT_DUOC_CHUNGTU_CHITIET.LYDOMIENPHI_ID = '$LYDOMIENPHI_ID$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="SOCHUNGTUKETOAN">
                        TT_DUOC_CHUNGTU_CHITIET.SOCHUNGTUKETOAN = '$SOCHUNGTUKETOAN$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="SOCHUNGTUTIENMAT">
                        TT_DUOC_CHUNGTU_CHITIET.SOCHUNGTUTIENMAT = '$SOCHUNGTUTIENMAT$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="TRANGTHAI">
                        TT_DUOC_CHUNGTU_CHITIET.TRANGTHAI = '$TRANGTHAI$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="DAPHATSINHPHIEUXUAT">
                        TT_DUOC_CHUNGTU_CHITIET.DAPHATSINHPHIEUXUAT = '$DAPHATSINHPHIEUXUAT$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="DAPHATSINHPHIEUHOANTRA">
                        TT_DUOC_CHUNGTU_CHITIET.DAPHATSINHPHIEUHOANTRA = '$DAPHATSINHPHIEUHOANTRA$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="KHUYENMAI">
                        TT_DUOC_CHUNGTU_CHITIET.KHUYENMAI = '$KHUYENMAI$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="DONDATHANG_ID">
                        TT_DUOC_CHUNGTU_CHITIET.DONDATHANG_ID = '$DONDATHANG_ID$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="GHICHUCHITIET">
                        TT_DUOC_CHUNGTU_CHITIET.GHICHUCHITIET = '$GHICHUCHITIET$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="NGUONHANG_ID">
                        TT_DUOC_CHUNGTU_CHITIET.NGUONHANG_ID = '$NGUONHANG_ID$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="DONGIAVONVAT">
                        TT_DUOC_CHUNGTU_CHITIET.DONGIAVONVAT = '$DONGIAVONVAT$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="THANHTIENMUA">
                        TT_DUOC_CHUNGTU_CHITIET.THANHTIENMUA = '$THANHTIENMUA$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="THANHTIENVON">
                        TT_DUOC_CHUNGTU_CHITIET.THANHTIENVON = '$THANHTIENVON$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="ISTACHLO">
                        TT_DUOC_CHUNGTU_CHITIET.ISTACHLO = '$ISTACHLO$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="DONVITINHBANDAU_ID">
                        TT_DUOC_CHUNGTU_CHITIET.DONVITINHBANDAU_ID = '$DONVITINHBANDAU_ID$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="SOLUONGBANDAU">
                        TT_DUOC_CHUNGTU_CHITIET.SOLUONGBANDAU = '$SOLUONGBANDAU$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="GOITHAU_ID">
                        TT_DUOC_CHUNGTU_CHITIET.GOITHAU_ID = '$GOITHAU_ID$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="DONGIATHAU">
                        TT_DUOC_CHUNGTU_CHITIET.DONGIATHAU = '$DONGIATHAU$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="TYLEQUIDOI">
                        TT_DUOC_CHUNGTU_CHITIET.TYLEQUIDOI = '$TYLEQUIDOI$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="BENHVIEN_ID">
                        TT_DUOC_CHUNGTU_CHITIET.BENHVIEN_ID = '$BENHVIEN_ID$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="NGAYTAO">
                        TT_DUOC_CHUNGTU_CHITIET.NGAYTAO = '$NGAYTAO$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="NGUOITAO_ID">
                        TT_DUOC_CHUNGTU_CHITIET.NGUOITAO_ID = '$NGUOITAO_ID$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="NGAYCAPNHAT">
                        TT_DUOC_CHUNGTU_CHITIET.NGAYCAPNHAT = '$NGAYCAPNHAT$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="NGUOICAPNHAT_ID">
                        TT_DUOC_CHUNGTU_CHITIET.NGUOICAPNHAT_ID = '$NGUOICAPNHAT_ID$'
                    </isNotEmpty>
                </isParameterPresent>
            </dynamic>
        </statement>
        <!--Revision:0-->
        <update id="DAO00030_Update_PhieuXuatNoiBo" parameterClass="System.Collections.IDictionary">
            update
            TT_DUOC_CHUNGTU
            set DANHANTHUOC = '$DANHANTHUOC$'
            where
            MACHUNGTU = '$MACHUNGTU$'
        </update>
        <!--Revision:0-->
        <statement id="DAO00030_GetPhieuTaiQuay" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
            select
            CT.*,
            NM.TENNGUOIMUA TENBENHNHAN2, NM.GIOITINH GIOITINH2, NM.NGAYSINH AS NGAYTHANGNAMSINH2, NM.NAMSINH AS NAMSINH2, NM.SONHA SONHA2, NM.XAPHUONG_ID XAPHUONG_ID2, NM.SODIENTHOAI SODIENTHOAI2, NM.NGHENGHIEP_ID NGHENGHIEP_ID2,
            BN.TENBENHNHAN as TENBENHNHAN1, BN.GIOITINH, BN.NGAYSINH AS NGAYTHANGNAMSINH, BN.NAMSINH, BN.SONHA, BN.XAPHUONG_ID, BN.SODIENTHOAI, BN.NGHENGHIEP_ID
            FROM TT_DUOC_CHUNGTU CT
            left join TT_NGOAITRU_TOATHUOC_NGUOIMUA NM on NM.NGOAITRU_TOATHUOC_NGUOIMUA_ID = CT.NGOAITRU_TOATHUOC_NGUOIMUA_ID
            left join TT_BENHNHAN BN on BN.BENHNHAN_ID = CT.BENHNHAN_ID
            where CT.BENHVIEN_ID = '$BENHVIEN_ID$'
            <isParameterPresent>
                <isNotEmpty prepend="and" property="CHUNGTU_ID">
                    CT.CHUNGTU_ID = '$CHUNGTU_ID$'
                </isNotEmpty>
            </isParameterPresent>
        </statement>
        <!--Revision:0-->
        <statement id="DAO00030_CTSOLONHAP_GetAll" resultClass="DataObject">
            select *
            from TT_DUOC_CHUNGTU_SOLONHAP
            WHERE BENHVIEN_ID = '$BENHVIEN_ID$'
            order by SOLONHAP_ID
        </statement>
        <!--Revision:0-->
        <statement id="DAO00030_CTSOLONHAP_GetList" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
            select *
            from TT_DUOC_CHUNGTU_SOLONHAP
            <dynamic prepend="where">
                <isParameterPresent>
                    <isNotEmpty prepend="and" property="SOLONHAP_ID">
                        TT_DUOC_CHUNGTU_SOLONHAP.SOLONHAP_ID = '$SOLONHAP_ID$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="SOLONHAP">
                        TT_DUOC_CHUNGTU_SOLONHAP.SOLONHAP = '$SOLONHAP$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="DUOC_ID">
                        TT_DUOC_CHUNGTU_SOLONHAP.DUOC_ID = '$DUOC_ID$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="NGAYNHAP">
                        TT_DUOC_CHUNGTU_SOLONHAP.NGAYNHAP = '$NGAYNHAP$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="HANSUDUNG">
                        TT_DUOC_CHUNGTU_SOLONHAP.HANSUDUNG = '$HANSUDUNG$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="NGUONDUOC_ID">
                        TT_DUOC_CHUNGTU_SOLONHAP.NGUONDUOC_ID = '$NGUONDUOC_ID$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="DONGIAMUA">
                        TT_DUOC_CHUNGTU_SOLONHAP.DONGIAMUA = '$DONGIAMUA$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="DONGIAVON">
                        TT_DUOC_CHUNGTU_SOLONHAP.DONGIAVON = '$DONGIAVON$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="TIENTE_ID">
                        TT_DUOC_CHUNGTU_SOLONHAP.TIENTE_ID = '$TIENTE_ID$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="TYGIA">
                        TT_DUOC_CHUNGTU_SOLONHAP.TYGIA = '$TYGIA$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="THANG">
                        TT_DUOC_CHUNGTU_SOLONHAP.THANG = '$THANG$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="NAM">
                        TT_DUOC_CHUNGTU_SOLONHAP.NAM = '$NAM$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="SOKIEMSOAT">
                        TT_DUOC_CHUNGTU_SOLONHAP.SOKIEMSOAT = '$SOKIEMSOAT$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="SOVISA">
                        TT_DUOC_CHUNGTU_SOLONHAP.SOVISA = '$SOVISA$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="NGUONHANG_ID">
                        TT_DUOC_CHUNGTU_SOLONHAP.NGUONHANG_ID = '$NGUONHANG_ID$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="DONGIATHAU">
                        TT_DUOC_CHUNGTU_SOLONHAP.DONGIATHAU = '$DONGIATHAU$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="BENHVIEN_ID">
                        TT_DUOC_CHUNGTU_SOLONHAP.BENHVIEN_ID = '$BENHVIEN_ID$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="NGAYTAO">
                        TT_DUOC_CHUNGTU_SOLONHAP.NGAYTAO = '$NGAYTAO$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="NGUOITAO_ID">
                        TT_DUOC_CHUNGTU_SOLONHAP.NGUOITAO_ID = '$NGUOITAO_ID$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="NGAYCAPNHAT">
                        TT_DUOC_CHUNGTU_SOLONHAP.NGAYCAPNHAT = '$NGAYCAPNHAT$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="NGUOICAPNHAT_ID">
                        TT_DUOC_CHUNGTU_SOLONHAP.NGUOICAPNHAT_ID = '$NGUOICAPNHAT_ID$'
                    </isNotEmpty>
                </isParameterPresent>
            </dynamic>
            order by SOLONHAP_ID
        </statement>
        <!--Revision:0-->
        <statement id="DAO00030_CTSOLONHAP_GetDetail" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
            select *
            from TT_DUOC_CHUNGTU_SOLONHAP
            where SOLONHAP_ID  = '$value$'
            and BENHVIEN_ID = '$BENHVIEN_ID$'
            order by SOLONHAP_ID
        </statement>
        <!--Revision:0-->
        <statement id="DAO00030_CTSOLONHAP_GetDetailP" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
            select *
            from TT_DUOC_CHUNGTU_SOLONHAP
            where TT_DUOC_CHUNGTU_SOLONHAP.SOLONHAP_ID  = '$SOLONHAP_ID$'
            and BENHVIEN_ID = '$BENHVIEN_ID$'
            order by SOLONHAP_ID
        </statement>
        <!--Revision:0-->
        <insert id="DAO00030_CTSOLONHAP_Add" parameterClass="System.Collections.IDictionary" resultClass="System.Int64">
            <selectKey property="ID" type="pre" resultClass="System.Int64">
                select TT_DUOC_CHUNGTU_SOLONHAP_S.nextval as value from dual
            </selectKey>
            insert into TT_DUOC_CHUNGTU_SOLONHAP (
            SOLONHAP_ID
            , SOLONHAP
            , SOLOSANPHAM
            , DUOC_ID
            , NGAYNHAP
            , HANDUNG
            , NGUONDUOC_ID
            , DONGIAMUA
            , DONGIAVON
            , TIENTE_ID
            , TYGIA
            , THANG
            , NAM
            , SOKIEMSOAT
            , SOVISA
            , NGUONHANG_ID
            , DONGIATHAU
            , BENHVIEN_ID
            , NGAYTAO
            , NGUOITAO_ID
            , NGAYCAPNHAT
            , NGUOICAPNHAT_ID
            ) values (
            #ID#
            , #SOLONHAP#
            , #SOLOSANPHAM#
            , #DUOC_ID#
            , #NGAYNHAP#
            , #HANDUNG#
            , #NGUONDUOC_ID#
            , #DONGIAMUA#
            , #DONGIAVON#
            , #TIENTE_ID#
            , #TYGIA#
            , #THANG#
            , #NAM#
            , #SOKIEMSOAT#
            , #SOVISA#
            , #NGUONHANG_ID#
            , #DONGIATHAU#
            , #BENHVIEN_ID#
            , #NGAYTAO#
            , #NGUOITAO_ID#
            , #NGAYCAPNHAT#
            , #NGUOICAPNHAT_ID#
            )
        </insert>
        <!--Revision:0-->
        <update id="DAO00030_CTSOLONHAP_Update" parameterClass="System.Collections.IDictionary">
            update TT_DUOC_CHUNGTU_SOLONHAP set
            SOLONHAP = #SOLONHAP#
            , SOLOSANPHAM = #SOLOSANPHAM#
            , DUOC_ID = #DUOC_ID#
            , NGAYNHAP = #NGAYNHAP#
            , HANDUNG = #HANDUNG#
            , NGUONDUOC_ID = #NGUONDUOC_ID#
            , DONGIAMUA = #DONGIAMUA#
            , DONGIAVON = #DONGIAVON#
            , TIENTE_ID = #TIENTE_ID#
            , TYGIA = #TYGIA#
            , THANG = #THANG#
            , NAM = #NAM#
            , SOKIEMSOAT = #SOKIEMSOAT#
            , SOVISA = #SOVISA#
            , NGUONHANG_ID = #NGUONHANG_ID#
            , DONGIATHAU = #DONGIATHAU#
            <!--, BENHVIEN_ID = #BENHVIEN_ID#
				, NGAYTAO = #NGAYTAO#
				, NGUOITAO_ID = #NGUOITAO_ID#-->
            , NGAYCAPNHAT = #NGAYCAPNHAT#
            , NGUOICAPNHAT_ID = #NGUOICAPNHAT_ID#
            where
            SOLONHAP_ID = '$SOLONHAP_ID$'
        </update>
        <!--Revision:0-->
        <statement id="DAO00030_CTSOLONHAP_Delete" parameterClass="System.Collections.IDictionary" resultClass="System.Int32">
            delete from TT_DUOC_CHUNGTU_SOLONHAP
            where
            SOLONHAP_ID = '$SOLONHAP_ID$'
        </statement>
        <!--Revision:0-->
        <statement id="DAO00030_CTSOLONHAP_DeleteP" parameterClass="System.Collections.IDictionary" resultClass="System.Int32">
            delete from TT_DUOC_CHUNGTU_SOLONHAP
            <dynamic prepend="where">
                <isParameterPresent>
                    <isNotEmpty prepend="and" property="SOLONHAP_ID">
                        TT_DUOC_CHUNGTU_SOLONHAP.SOLONHAP_ID = '$SOLONHAP_ID$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="SOLONHAP">
                        TT_DUOC_CHUNGTU_SOLONHAP.SOLONHAP = '$SOLONHAP$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="DUOC_ID">
                        TT_DUOC_CHUNGTU_SOLONHAP.DUOC_ID = '$DUOC_ID$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="NGAYNHAP">
                        TT_DUOC_CHUNGTU_SOLONHAP.NGAYNHAP = '$NGAYNHAP$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="HANSUDUNG">
                        TT_DUOC_CHUNGTU_SOLONHAP.HANSUDUNG = '$HANSUDUNG$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="NGUONDUOC_ID">
                        TT_DUOC_CHUNGTU_SOLONHAP.NGUONDUOC_ID = '$NGUONDUOC_ID$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="DONGIAMUA">
                        TT_DUOC_CHUNGTU_SOLONHAP.DONGIAMUA = '$DONGIAMUA$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="DONGIAVON">
                        TT_DUOC_CHUNGTU_SOLONHAP.DONGIAVON = '$DONGIAVON$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="TIENTE_ID">
                        TT_DUOC_CHUNGTU_SOLONHAP.TIENTE_ID = '$TIENTE_ID$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="TYGIA">
                        TT_DUOC_CHUNGTU_SOLONHAP.TYGIA = '$TYGIA$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="THANG">
                        TT_DUOC_CHUNGTU_SOLONHAP.THANG = '$THANG$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="NAM">
                        TT_DUOC_CHUNGTU_SOLONHAP.NAM = '$NAM$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="SOKIEMSOAT">
                        TT_DUOC_CHUNGTU_SOLONHAP.SOKIEMSOAT = '$SOKIEMSOAT$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="SOVISA">
                        TT_DUOC_CHUNGTU_SOLONHAP.SOVISA = '$SOVISA$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="NGUONHANG_ID">
                        TT_DUOC_CHUNGTU_SOLONHAP.NGUONHANG_ID = '$NGUONHANG_ID$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="DONGIATHAU">
                        TT_DUOC_CHUNGTU_SOLONHAP.DONGIATHAU = '$DONGIATHAU$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="BENHVIEN_ID">
                        TT_DUOC_CHUNGTU_SOLONHAP.BENHVIEN_ID = '$BENHVIEN_ID$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="NGAYTAO">
                        TT_DUOC_CHUNGTU_SOLONHAP.NGAYTAO = '$NGAYTAO$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="NGUOITAO_ID">
                        TT_DUOC_CHUNGTU_SOLONHAP.NGUOITAO_ID = '$NGUOITAO_ID$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="NGAYCAPNHAT">
                        TT_DUOC_CHUNGTU_SOLONHAP.NGAYCAPNHAT = '$NGAYCAPNHAT$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="NGUOICAPNHAT_ID">
                        TT_DUOC_CHUNGTU_SOLONHAP.NGUOICAPNHAT_ID = '$NGUOICAPNHAT_ID$'
                    </isNotEmpty>
                </isParameterPresent>
            </dynamic>
        </statement>
        <!--Revision:0-->
        <statement id="DAO00030_DUOCTONKHO_GetAll" resultClass="DataObject">
            select *
            from TT_DUOC_TONKHO
            WHERE BENHVIEN_ID = '$BENHVIEN_ID$'
            order by DUOCTONKHO_ID
        </statement>
        <!--Revision:0-->
        <statement id="DAO00030_DUOCTONKHO_GetList" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
            select *
            from TT_DUOC_TONKHO
            <dynamic prepend="where">
                <isParameterPresent>
                    <isNotEmpty prepend="and" property="DUOCTONKHO_ID">
                        TT_DUOC_TONKHO.DUOCTONKHO_ID = '$DUOCTONKHO_ID$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="KHODUOC_ID">
                        TT_DUOC_TONKHO.KHODUOC_ID = '$KHODUOC_ID$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="DUOC_ID">
                        TT_DUOC_TONKHO.DUOC_ID = '$DUOC_ID$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="NGUONDUOC_ID">
                        TT_DUOC_TONKHO.NGUONDUOC_ID = '$NGUONDUOC_ID$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="SOLONHAP_ID">
                        TT_DUOC_TONKHO.SOLONHAP_ID = '$SOLONHAP_ID$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="DONGIAMUA">
                        TT_DUOC_TONKHO.DONGIAMUA = '$DONGIAMUA$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="SOLUONG">
                        TT_DUOC_TONKHO.SOLUONG = '$SOLUONG$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="BENHVIEN_ID">
                        TT_DUOC_TONKHO.BENHVIEN_ID = '$BENHVIEN_ID$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="NGAYTAO">
                        TT_DUOC_TONKHO.NGAYTAO = '$NGAYTAO$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="NGUOITAO_ID">
                        TT_DUOC_TONKHO.NGUOITAO_ID = '$NGUOITAO_ID$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="NGAYCAPNHAT">
                        TT_DUOC_TONKHO.NGAYCAPNHAT = '$NGAYCAPNHAT$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="NGUOICAPNHAT_ID">
                        TT_DUOC_TONKHO.NGUOICAPNHAT_ID = '$NGUOICAPNHAT_ID$'
                    </isNotEmpty>
                </isParameterPresent>
            </dynamic>
            order by DUOCTONKHO_ID
        </statement>
        <!--Revision:0-->
        <statement id="DAO00030_DUOCTONKHO_GetDetail" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
            select *
            from TT_DUOC_TONKHO
            where DUOCTONKHO_ID  = '$value$'
            and BENHVIEN_ID = '$BENHVIEN_ID$'
            order by DUOCTONKHO_ID
        </statement>
        <!--Revision:0-->
        <statement id="DAO00030_DUOCTONKHO_GetDetailP" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
            select *
            from TT_DUOC_TONKHO
            where TT_DUOC_TONKHO.DUOCTONKHO_ID  = '$DUOCTONKHO_ID$'
            and BENHVIEN_ID = '$BENHVIEN_ID$'
            order by DUOCTONKHO_ID
        </statement>
        <!--Revision:0-->
      <statement id="DAO00030_DUOCTONKHO_Add" parameterClass="HashTable" resultClass="System.Int64">        
          insert into TT_DUOC_TONKHO (          
            KHODUOC_ID
          , DUOC_ID
          , NGUONDUOC_ID
          , SOLONHAP_ID
          , DONGIAMUA
          , SOLUONG
          , BENHVIEN_ID
          , NGAYTAO
          , NGUOITAO_ID
          , NGAYCAPNHAT
          , NGUOICAPNHAT_ID
          ) values (          
            #KHODUOC_ID#
          , #DUOC_ID#
          , #NGUONDUOC_ID#
          , #SOLONHAP_ID#
          , #DONGIAMUA#
          , #SOLUONG#
          , #BENHVIEN_ID#
          , #NGAYTAO#
          , #NGUOITAO_ID#
          , #NGAYCAPNHAT#
          , #NGUOICAPNHAT_ID#
          )
          </statement>
        <!--Revision:0-->
        <update id="DAO00030_DUOCTONKHO_Update" parameterClass="System.Collections.IDictionary">
            update TT_DUOC_TONKHO set
            KHODUOC_ID = #KHODUOC_ID#
            , DUOC_ID = #DUOC_ID#
            , NGUONDUOC_ID = #NGUONDUOC_ID#
            , SOLONHAP_ID = #SOLONHAP_ID#
            , DONGIAMUA = #DONGIAMUA#
            , SOLUONG = #SOLUONG#
            , NGAYCAPNHAT = #NGAYCAPNHAT#
            , NGUOICAPNHAT_ID = #NGUOICAPNHAT_ID#
            where
            DUOCTONKHO_ID = '$DUOCTONKHO_ID$'
        </update>
        <!--Revision:0-->
        <update id="DAO00030_DUOCTONKHO_Tang" parameterClass="System.Collections.IDictionary">
          DECLARE vCOUNT NUMBER:= 0;

          BEGIN

          SELECT COUNT(*) INTO vCOUNT
          FROM TT_DUOC_TONKHO
          WHERE
          KHODUOC_ID = #KHODUOC_ID#
          AND DUOC_ID = #DUOC_ID#
          AND  SOLONHAP_ID = #SOLONHAP_ID#;


          IF vCOUNT > 0 THEN
          update TT_DUOC_TONKHO set
          SOLUONG = SOLUONG +  #SOLUONGTHAYDOI#
          , NGAYCAPNHAT = #NGAYCAPNHAT#
          , NGUOICAPNHAT_ID = #NGUOICAPNHAT_ID#
          where
          KHODUOC_ID = #KHODUOC_ID#
          AND DUOC_ID = #DUOC_ID#
          AND  SOLONHAP_ID = #SOLONHAP_ID#;

          ELSE

          insert into TT_DUOC_TONKHO (
          KHODUOC_ID
          , DUOC_ID
          , NGUONDUOC_ID
          , SOLONHAP_ID
          , DONGIAMUA
          , SOLUONG
          , BENHVIEN_ID
          , NGAYTAO
          , NGUOITAO_ID
          , NGAYCAPNHAT
          , NGUOICAPNHAT_ID
          ) values (
          #KHODUOC_ID#
          , #DUOC_ID#
          , #NGUONDUOC_ID#
          , #SOLONHAP_ID#
          , #DONGIAMUA#
          , #SOLUONG#
          , #BENHVIEN_ID#
          , #NGAYTAO#
          , #NGUOITAO_ID#
          , #NGAYCAPNHAT#
          , #NGUOICAPNHAT_ID#
          );

          END IF;
          END;
        </update>
        <!--Revision:0-->
        <update id="DAO00030_DUOCTONKHO_Giam" parameterClass="System.Collections.IDictionary">
            update TT_DUOC_TONKHO set
            SOLUONG = SOLUONG - #SOLUONGTHAYDOI#
            , NGAYCAPNHAT = #NGAYCAPNHAT#
            , NGUOICAPNHAT_ID = #NGUOICAPNHAT_ID#
            where
            KHODUOC_ID = #KHODUOC_ID#
            AND DUOC_ID = #DUOC_ID#
            AND  SOLONHAP_ID = #SOLONHAP_ID#
        </update>
        <!--Revision:0-->
        <update id="DAO00030_DUOC_TONKHO_BOOKING_NOITRU_Giam" parameterClass="System.Collections.IDictionary">
            update TT_DUOC_TONKHO_BOOK_NOITRU
            set
            SOLUONG = SOLUONG - #SOLUONGTHAYDOI#
            , NGUOICAPNHAT_ID =  #NGUOICAPNHAT_ID#
            , NGAYCAPNHAT = SYSTIMESTAMP
            where
            REF_TABLE = '$REF_TABLE$'
            AND REF_ID = #REF_ID#
            AND KHODUOC_ID = #KHODUOC_ID#
            AND DUOC_ID = #DUOC_ID#
            AND BENHVIEN_ID = '$BENHVIEN_ID$'
            AND SOLUONG &gt;=  #SOLUONGTHAYDOI#
        </update>
        <!--Revision:0-->
        <update id="DAO00030_DUOC_TONKHO_BOOKING_NOITRU_Tang" parameterClass="System.Collections.IDictionary">
          DECLARE vCOUNT NUMBER:= 0;

          BEGIN

          SELECT COUNT(*) INTO vCOUNT
          from TT_DUOC_TONKHO_BOOK_NOITRU
          where
          REF_TABLE = '$REF_TABLE$'
          AND REF_ID = #REF_ID#
          AND DUOC_ID = #DUOC_ID#
          AND KHODUOC_ID = #KHODUOC_ID#
          AND BENHVIEN_ID = '$BENHVIEN_ID$';

          IF vCOUNT > 0 THEN
          update TT_DUOC_TONKHO_BOOK_NOITRU
          set
          SOLUONG = SOLUONG + #SOLUONGTHAYDOI#
          , NGUOICAPNHAT_ID =  #NGUOICAPNHAT_ID#
          , NGAYCAPNHAT = SYSTIMESTAMP
          where
          REF_TABLE = '$REF_TABLE$'
          AND REF_ID = #REF_ID#
          AND KHODUOC_ID = #KHODUOC_ID#
          AND DUOC_ID = #DUOC_ID#
          AND BENHVIEN_ID = #BENHVIEN_ID#;

          ELSE

          insert into TT_DUOC_TONKHO_BOOK_NOITRU (
          REF_TABLE
          , REF_ID
          , KHODUOC_ID
          , DUOC_ID
          , SOLUONG
          , NGAYHIEULUC
          , NGUONHANG_ID
          , CHUYENKHOA_ID
          , TRANGTHAI
          , BENHVIEN_ID
          , NGAYTAO
          , NGUOITAO_ID
          ) values (
          #REF_TABLE#
          , #REF_ID#
          , #KHODUOC_ID#
          , #DUOC_ID#
          , #SOLUONGTHAYDOI#
          , SYSTIMESTAMP
          , #NGUONHANG_ID#
          , #CHUYENKHOA_ID#
          , 'HIEULUC'
          , #BENHVIEN_ID#
          , #NGAYTAO#
          , #NGUOITAO_ID#
          );

          END IF;
          END;
        </update>
        <!--Revision:0-->
        <update id="DAO00030_DUOC_TONKHO_BOOKING_NOITRU_Update" parameterClass="System.Collections.IDictionary">
            update TT_DUOC_TONKHO_BOOK_NOITRU
            set
            TRANGTHAI =  #TRANGTHAI#,
            NGAYCAPNHAT = SYSTIMESTAMP,
            NGUOICAPNHAT_ID = #NGUOICAPNHAT_ID#
            where
            BOOKING_ID = #BOOKING_ID#
        </update>
        <!--Revision:0-->
        <update id="DAO00030_DUOC_TONKHO_BOOKING_NGOAITRU_Update" parameterClass="System.Collections.IDictionary">
            update TT_DUOC_TONKHO_BOOK_NGOAITRU
            set
            TRANGTHAI =  #TRANGTHAI#,
            NGAYCAPNHAT = SYSTIMESTAMP,
            NGUOICAPNHAT_ID = #NGUOICAPNHAT_ID#
            where
            BOOKING_ID = #BOOKING_ID#
        </update>
        <!--Revision:0-->
        <statement id="DAO00030_DUOC_TONKHO_BOOKING_NOITRU_Delete" parameterClass="System.Collections.IDictionary" resultClass="System.Int32">
            delete from TT_DUOC_TONKHO_BOOK_NOITRU
            where
            BOOKING_ID = #BOOKING_ID#
        </statement>
        <!--Revision:0-->
        <update id="DAO00030_DUOC_TONKHO_BOOKING_NGOAITRU_Giam" parameterClass="System.Collections.IDictionary">
            update TT_DUOC_TONKHO_BOOK_NGOAITRU
            set
            SOLUONG = SOLUONG - #SOLUONGTHAYDOI#
            , NGUOICAPNHAT_ID = #NGUOICAPNHAT_ID#
            , NGAYCAPNHAT = SYSTIMESTAMP
            where
            REF_TABLE = #REF_TABLE#
            AND REF_ID = #REF_ID#
            AND KHODUOC_ID = #KHODUOC_ID#
            AND DUOC_ID = #DUOC_ID#
            AND BENHVIEN_ID = '$BENHVIEN_ID$'
            AND SOLUONG &gt;=  #SOLUONGTHAYDOI#
        </update>
        <!--Revision:0-->
        <update id="DAO00030_DUOC_TONKHO_BOOKING_NGOAITRU_Tang" parameterClass="System.Collections.IDictionary">
            update TT_DUOC_TONKHO_BOOK_NGOAITRU
            set
            SOLUONG = SOLUONG + #SOLUONGTHAYDOI#
            , NGUOICAPNHAT_ID = #NGUOICAPNHAT_ID#
            , NGAYCAPNHAT = SYSTIMESTAMP
            where
            REF_TABLE = #REF_TABLE#
            AND REF_ID = #REF_ID#
            AND KHODUOC_ID = #KHODUOC_ID#
            AND DUOC_ID = #DUOC_ID#
            AND BENHVIEN_ID = '$BENHVIEN_ID$'
        </update>
        <!--Revision:0-->
        <statement id="DAO00030_DUOCTONKHO_Delete" parameterClass="System.Collections.IDictionary" resultClass="System.Int32">
            delete from TT_DUOC_TONKHO
            where
            DUOCTONKHO_ID = '$DUOCTONKHO_ID$'
        </statement>
        <!--Revision:0-->
        <statement id="DAO00030_DUOCTONKHO_DeleteP" parameterClass="System.Collections.IDictionary" resultClass="System.Int32">
            delete from TT_DUOC_TONKHO
            <dynamic prepend="where">
                <isParameterPresent>
                    <isNotEmpty prepend="and" property="DUOCTONKHO_ID">
                        TT_DUOC_TONKHO.DUOCTONKHO_ID = '$DUOCTONKHO_ID$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="KHODUOC_ID">
                        TT_DUOC_TONKHO.KHODUOC_ID = '$KHODUOC_ID$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="DUOC_ID">
                        TT_DUOC_TONKHO.DUOC_ID = '$DUOC_ID$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="NGUONDUOC_ID">
                        TT_DUOC_TONKHO.NGUONDUOC_ID = '$NGUONDUOC_ID$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="SOLONHAP_ID">
                        TT_DUOC_TONKHO.SOLONHAP_ID = '$SOLONHAP_ID$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="DONGIAMUA">
                        TT_DUOC_TONKHO.DONGIAMUA = '$DONGIAMUA$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="SOLUONG">
                        TT_DUOC_TONKHO.SOLUONG = '$SOLUONG$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="BENHVIEN_ID">
                        TT_DUOC_TONKHO.BENHVIEN_ID = '$BENHVIEN_ID$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="NGAYTAO">
                        TT_DUOC_TONKHO.NGAYTAO = '$NGAYTAO$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="NGUOITAO_ID">
                        TT_DUOC_TONKHO.NGUOITAO_ID = '$NGUOITAO_ID$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="NGAYCAPNHAT">
                        TT_DUOC_TONKHO.NGAYCAPNHAT = '$NGAYCAPNHAT$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="NGUOICAPNHAT_ID">
                        TT_DUOC_TONKHO.NGUOICAPNHAT_ID = '$NGUOICAPNHAT_ID$'
                    </isNotEmpty>
                </isParameterPresent>
            </dynamic>
        </statement>
        <!--Revision:0-->
        <statement id="DAO00030_DUOCTONKHO_GetTonTruBooking" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
            SELECT A.SOLUONGTON - B.SOLUONGBOOKING_NGOAITRU - C.SOLUONGBOOKING_NOITRU AS SOLUONG
            FROM(
            SELECT
            SUM(SOLUONG) AS SOLUONGTON FROM TT_DUOC_TONKHO
            WHERE
            DUOC_ID = '$DUOC_ID$'
            AND KHODUOC_ID = '$KHODUOC_ID$'
            and BENHVIEN_ID = '$BENHVIEN_ID$'
            <isNotEmpty prepend="and" property="NGUONDUOC_ID">
                NGUONDUOC_ID = '$NGUONDUOC_ID$'
            </isNotEmpty>
            )A,
            (
            SELECT
            NVL(SUM(SOLUONG),0) AS SOLUONGBOOKING_NGOAITRU FROM TT_DUOC_TONKHO_BOOK_NGOAITRU
            WHERE
            DUOC_ID = '$DUOC_ID$'
            AND KHODUOC_ID = '$KHODUOC_ID$'
            and BENHVIEN_ID = '$BENHVIEN_ID$'
            <isNotEmpty prepend="and" property="NGUONDUOC_ID">
                NGUONHANG_ID = '$NGUONDUOC_ID$'
            </isNotEmpty>
            ) B,
            (
            SELECT
            NVL(SUM(SOLUONG),0) AS SOLUONGBOOKING_NOITRU FROM TT_DUOC_TONKHO_BOOK_NOITRU
            WHERE
            DUOC_ID = '$DUOC_ID$'
            AND KHODUOC_ID = '$KHODUOC_ID$'
            and BENHVIEN_ID = '$BENHVIEN_ID$'
            <isNotEmpty prepend="and" property="NGUONDUOC_ID">
                NGUONHANG_ID = '$NGUONDUOC_ID$'
            </isNotEmpty>
            ) C
        </statement>
        <!--Revision:0-->
        <statement id="DAO00030_DUOCTONKHO_GetTonThucTeTheoLo" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
            SELECT
            SUM(SOLUONG) AS SOLUONG
            FROM
            TT_DUOC_TONKHO
            WHERE
            DUOC_ID = '$DUOC_ID$'
            AND KHODUOC_ID = '$KHODUOC_ID$'
            and BENHVIEN_ID = '$BENHVIEN_ID$'
            <isNotEmpty prepend="and" property="NGUONDUOC_ID">
                NGUONDUOC_ID = '$NGUONDUOC_ID$'
            </isNotEmpty>
            <isNotEmpty prepend="and" property="SOLONHAP_ID">
                SOLONHAP_ID = '$SOLONHAP_ID$'
            </isNotEmpty>
        </statement>
        <!--Revision:0-->
        <statement id="DAO00030_DUOCTONKHO_GetTonThucTe" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
            SELECT
            SUM(SOLUONG) AS SOLUONG
            FROM
            TT_DUOC_TONKHO
            WHERE
            DUOC_ID = '$DUOC_ID$'
            AND KHODUOC_ID = '$KHODUOC_ID$'
            and BENHVIEN_ID = '$BENHVIEN_ID$'
            <isNotEmpty prepend="and" property="NGUONDUOC_ID">
                <!-- NGUONDUOC_ID = '$NGUONDUOC_ID$' -->
            </isNotEmpty>
        </statement>
        <!--Revision:0-->
        <statement id="DAO00030_DUOCTONKHO_GetSoTonTheoDuoc" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
            SELECT
            DUOC_ID,
            SUM(SOLUONG) AS TONGTON
            FROM
            TT_DUOC_TONKHO
            WHERE
            KHODUOC_ID = '$KHODUOC_ID$'
            and BENHVIEN_ID = '$BENHVIEN_ID$'
            and DUOC_ID IN ($LIST_DUOC_ID$)
            GROUP BY DUOC_ID
        </statement>
        <!--Revision:0-->
        <statement id="DAO00030_DUOCTONKHO_GetSoTonTheoDuocTruBooking" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
            SELECT A.DUOC_ID,  NVL(A.SOLUONGTON,0) - NVL(B.SOLUONGBOOKING_NGOAITRU,0) - NVL(C.SOLUONGBOOKING_NOITRU,0) AS TONGTON
            FROM(
            SELECT DUOC_ID, KHODUOC_ID,
            SUM(SOLUONG) AS SOLUONGTON FROM TT_DUOC_TONKHO
            WHERE
            DUOC_ID IN ($LIST_DUOC_ID$)
            AND KHODUOC_ID = '$KHODUOC_ID$'
            AND BENHVIEN_ID = '$BENHVIEN_ID$'
            GROUP BY DUOC_ID, KHODUOC_ID
            )A LEFT JOIN
            (
            SELECT DUOC_ID, KHODUOC_ID,
            NVL(SUM(SOLUONG),0) AS SOLUONGBOOKING_NGOAITRU FROM TT_DUOC_TONKHO_BOOK_NGOAITRU
            WHERE
            DUOC_ID IN ($LIST_DUOC_ID$)
            AND KHODUOC_ID = '$KHODUOC_ID$'
            AND TRANGTHAI = 'HIEULUC'
            AND BENHVIEN_ID = '$BENHVIEN_ID$'
            GROUP BY DUOC_ID, KHODUOC_ID
            ) B on (A.DUOC_ID = B.DUOC_ID AND A.KHODUOC_ID = B.KHODUOC_ID)
            LEFT JOIN
            (
            SELECT DUOC_ID, KHODUOC_ID,
            NVL(SUM(SOLUONG),0) AS SOLUONGBOOKING_NOITRU FROM TT_DUOC_TONKHO_BOOK_NOITRU
            WHERE
            DUOC_ID IN ($LIST_DUOC_ID$)
            AND KHODUOC_ID = '$KHODUOC_ID$'
            AND TRANGTHAI = 'HIEULUC'
            AND BENHVIEN_ID = '$BENHVIEN_ID$'
            GROUP BY DUOC_ID, KHODUOC_ID
            ) C on (A.DUOC_ID = C.DUOC_ID AND A.KHODUOC_ID = C.KHODUOC_ID)
        </statement>
        <!--Revision:0-->
        <statement id="DAO00030_DUOCTONKHO_GetSoTonTheoDuocTheoLo" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
            SELECT
            DUOC_ID,SOLONHAP_ID,
            SUM(SOLUONG) AS SOLUONGTONLO
            FROM
            TT_DUOC_TONKHO
            WHERE
            KHODUOC_ID = '$KHODUOC_ID$'
            and BENHVIEN_ID = '$BENHVIEN_ID$'
            and DUOC_ID IN ($LIST_DUOC_ID$)
            and SOLONHAP_ID IN ($LIST_SOLONHAP_ID$)
            GROUP BY DUOC_ID, SOLONHAP_ID
        </statement>
        <!--Revision:0-->
        <statement id="DAO00030_DUOCTONKHO_GetTonKhoBySoLoNhap" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
            SELECT A.DONGIAMUA, A.HANSUDUNG, A.SOKIEMSOAT, B.*
            FROM
            (
            SELECT
            DUOC_ID,
            DONGIAMUA,
            HANSUDUNG,
            SOKIEMSOAT
            FROM
            TT_DUOC_CHUNGTU_SOLONHAP
            WHERE
            SOLONHAP = '$SOLONHAP$'
            and BENHVIEN_ID = '$BENHVIEN_ID$'
            )A left join
            (
            SELECT
            KHODUOC_ID,
            DUOC_ID,
            SUM(SOLUONG) AS TONGTON
            FROM
            TT_DUOC_TONKHO
            WHERE
            DUOC_ID = '$DUOC_ID$'
            AND KHODUOC_ID = '$KHODUOC_ID$'
            and BENHVIEN_ID = '$BENHVIEN_ID$'
            GROUP BY KHODUOC_ID, DUOC_ID
            )B on  A.DUOC_ID = B.DUOC_ID
        </statement>
        <!--Revision:0-->
        <statement id="DAO00030_GET_SOLONHAP" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
          SELECT
          SLN.SOLONHAP_ID, SLN.SOLONHAP, SLN.SOLOSANPHAM, SLN.SOKIEMSOAT, SLN.SOVISA, SLN.SOLOSANPHAM || '/' || TO_CHAR(TK.SOLUONG) AS SOLOSOTON,
          SLN.NGAYNHAP AS NGAYNHAPLO, SLN.HANDUNG AS HANSUDUNG,  SLN.HANDUNG, SLN.NGUONDUOC_ID, SLN.NGUONDUOC_ID as NGUONHANG_ID,
          SLNGB.DONGIAMUA, SLNGB.DONGIAVON, SLNGB.TYLEVAT_DAUVAO as TYLEVAT, d.TYLE_VAT, SLNGB.DONGIAVONVAT, SLNGB.DONGIABAN,
          ROUND(SLNGB.DONGIABAN + SLNGB.DONGIABAN*d.TYLE_VAT/100, 0) as DONGIABAN_VAT,
          TK.DUOCTONKHO_ID, TK.KHODUOC_ID, TK.DUOC_ID, TK.SOLUONG, TK.SOLUONG AS SOLUONGTON,
          TO_CHAR(D.TENDUOCDAYDU) TENDUOCDAYDU ,D.DONVITINH_ID, D.DONVITINH, D.BHYT, NH.TENNGUONDUOC AS NGUONHANG,
          LTRIM(tk.KHODUOC_ID) || '_' || LTRIM(tk.DUOC_ID) || '_' || LTRIM(tk.NGUONDUOC_ID) as DUOC_KEY
          FROM
          TT_DUOC_CHUNGTU_SOLONHAP SLN,
          TT_DUOC_TONKHO TK,
          TT_DUOC_SOLONHAP_GIABAN SLNGB,
          TM_DUOC D,
          TM_NGUONHANG NH
          WHERE
          SLN.SOLONHAP_ID = TK.SOLONHAP_ID
          AND SLN.SOLONHAP_ID = SLNGB.SOLONHAP_ID
          AND SLN.NGUONDUOC_ID = NH.NGUONDUOC_ID
          AND SLN.DUOC_ID = D.DUOC_ID
          AND TK.DUOC_ID = '$DUOC_ID$'
          AND TK.KHODUOC_ID = '$KHODUOC_ID$'
          AND SLN.BENHVIEN_ID = '$BENHVIEN_ID$'
          AND TK.SOLUONG &gt; 0
          <dynamic prepend="">
            <isParameterPresent>
              <isNotEmpty prepend="and" property="NGUONDUOC_ID">
                SLN.NGUONDUOC_ID = '$NGUONDUOC_ID$'
              </isNotEmpty>
              <isNotEmpty prepend="and" property="LST_SOLONHAP_ID">
                SLN.SOLONHAP_ID NOT IN ($LST_SOLONHAP_ID$)
              </isNotEmpty>
            </isParameterPresent>
          </dynamic>
          <isEqual prepend="" property="PHUONGPHAPXUAT" compareValue="0">
                ORDER BY NGAYNHAP
            </isEqual>
            <isEqual prepend="" property="PHUONGPHAPXUAT" compareValue="1">
                ORDER BY HANSUDUNG
            </isEqual>
        </statement>
        <!--Revision:0-->
        <statement id="DAO00030_GET_SOLONHAP_ZERO" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
          SELECT
          SLN.SOLONHAP_ID, SLN.SOLONHAP, SLN.SOLOSANPHAM, SLN.SOKIEMSOAT, SLN.SOVISA, SLN.SOLOSANPHAM || '/' || TO_CHAR(TK.SOLUONG) AS SOLOSOTON,
          SLN.NGAYNHAP AS NGAYNHAPLO, SLN.HANDUNG AS HANSUDUNG,  SLN.HANDUNG, SLN.NGUONDUOC_ID, SLN.NGUONDUOC_ID as NGUONHANG_ID,
          SLNGB.DONGIAMUA, SLNGB.DONGIAVON, SLNGB.TYLEVAT_DAUVAO as TYLEVAT, d.TYLE_VAT, SLNGB.DONGIAVONVAT, SLNGB.DONGIABAN,
          ROUND(SLNGB.DONGIABAN + SLNGB.DONGIABAN*d.TYLE_VAT/100, 0) as DONGIABAN_VAT,
          TK.DUOCTONKHO_ID, TK.KHODUOC_ID, TK.DUOC_ID, TK.SOLUONG, TK.SOLUONG AS SOLUONGTON,
          TO_CHAR(D.TENDUOCDAYDU) TENDUOCDAYDU ,D.DONVITINH_ID, D.DONVITINH, D.BHYT, NH.TENNGUONDUOC AS NGUONHANG,
          LTRIM(tk.KHODUOC_ID) || '_' || LTRIM(tk.DUOC_ID) || '_' || LTRIM(tk.NGUONDUOC_ID) as DUOC_KEY
          FROM
          TT_DUOC_CHUNGTU_SOLONHAP SLN,
          TT_DUOC_TONKHO TK,
          TT_DUOC_SOLONHAP_GIABAN SLNGB,
          TM_DUOC D,
          TM_NGUONHANG NH
          WHERE
          SLN.SOLONHAP_ID = TK.SOLONHAP_ID
          AND SLN.SOLONHAP_ID = SLNGB.SOLONHAP_ID
          AND SLN.NGUONDUOC_ID = NH.NGUONDUOC_ID
          AND SLN.DUOC_ID = D.DUOC_ID
          AND TK.KHODUOC_ID = '$KHODUOC_ID$'
          AND TK.DUOC_ID = '$DUOC_ID$'
          AND SLN.BENHVIEN_ID = '$BENHVIEN_ID$'
          <!--AND TK.SOLUONG &gt;= 0-->
          <dynamic prepend="">
            <isParameterPresent>
              <isNotEmpty prepend="and" property="NGUONDUOC_ID">
                SLN.NGUONDUOC_ID = '$NGUONDUOC_ID$'
              </isNotEmpty>
              <isNotEmpty prepend="and" property="LST_SOLONHAP_ID">
                SLN.SOLONHAP_ID NOT IN ($LST_SOLONHAP_ID$)
              </isNotEmpty>
            </isParameterPresent>
          </dynamic>
          <isEqual prepend="" property="PHUONGPHAPXUAT" compareValue="0">
                ORDER BY NGAYNHAP
            </isEqual>
            <isEqual prepend="" property="PHUONGPHAPXUAT" compareValue="1">
                ORDER BY HANSUDUNG
            </isEqual>
        </statement>
        <!--Revision:0-->
      <statement id="DAO00030_CHECK_BANGGIA_BHYT" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
        SELECT
        D.DUOC_ID
        FROM
        TM_DUOC D
        INNER JOIN TM_DUOC_DONGIA dg on dg.DUOC_ID = D.DUOC_ID
        INNER JOIN TM_LOAIGIA lg on (lg.LOAIGIA_ID = dg.LOAIGIA_ID AND lg.MALOAIGIA = 'GiaduocBHYT')
        WHERE
        dg.DUOC_ID = '$DUOC_ID$'
        AND d.BHYT = '1'
        AND dg.BENHVIEN_ID = '$BENHVIEN_ID$'
      </statement>
      <statement id="DAO00030_CHECK_BANGGIA_NHATHUOC" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
        SELECT
        D.DUOC_ID
        FROM
        TM_DUOC D
        INNER JOIN TM_DUOC_DONGIA dg on dg.DUOC_ID = D.DUOC_ID
        INNER JOIN TM_LOAIGIA lg on (lg.LOAIGIA_ID = dg.LOAIGIA_ID AND lg.MALOAIGIA = 'Gianhathuoc')
        WHERE
        dg.DUOC_ID = '$DUOC_ID$'
        AND dg.BENHVIEN_ID = '$BENHVIEN_ID$'
      </statement>
        <!--Revision:0-->
        <statement id="DAO00030_GET_SOLONHAP_DONGIABHYT" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
          SELECT
          SLN.SOLONHAP_ID, SLN.SOLONHAP, SLN.SOLOSANPHAM, SLN.SOKIEMSOAT, SLN.SOVISA, SLN.SOLOSANPHAM || '/' || TO_CHAR(TK.SOLUONG) AS SOLOSOTON,
          SLN.NGAYNHAP AS NGAYNHAPLO, SLN.HANDUNG AS HANSUDUNG,  SLN.HANDUNG, SLN.NGUONDUOC_ID, SLN.NGUONDUOC_ID as NGUONHANG_ID,
          SLNGB.DONGIAMUA, SLNGB.DONGIAVON, SLNGB.DONGIAVONVAT, dg.DONGIA AS DONGIATHAU,
          TK.KHODUOC_ID, TK.DUOC_ID, TK.SOLUONG, TK.SOLUONG AS SOLUONGTON,
          TO_CHAR(D.TENDUOCDAYDU) TENDUOCDAYDU ,D.DONVITINH_ID, D.DONVITINH, D.BHYT, NH.TENNGUONDUOC AS NGUONHANG,
          LTRIM(tk.KHODUOC_ID) || '_' || LTRIM(tk.DUOC_ID) || '_' || LTRIM(tk.NGUONDUOC_ID) as DUOC_KEY
          FROM
          TT_DUOC_CHUNGTU_SOLONHAP SLN
          INNER JOIN TT_DUOC_TONKHO TK on SLN.SOLONHAP_ID = TK.SOLONHAP_ID
          INNER JOIN TT_DUOC_SOLONHAP_GIABAN SLNGB on SLN.SOLONHAP_ID = SLNGB.SOLONHAP_ID
          INNER JOIN TM_NGUONHANG NH on SLN.NGUONDUOC_ID = NH.NGUONDUOC_ID
          INNER JOIN TM_DUOC D on SLN.DUOC_ID = D.DUOC_ID
          INNER JOIN TM_DUOC_DONGIA dg on dg.DUOC_ID = SLN.DUOC_ID
          INNER JOIN TM_BANGGIA bg on (bg.BANGGIA_ID = dg.BANGGIA_ID)
          INNER JOIN TM_LOAIGIA lg on (lg.LOAIGIA_ID = dg.LOAIGIA_ID AND lg.MALOAIGIA = 'GiaduocBHYT')
          WHERE
          SLN.DUOC_ID = '$DUOC_ID$'
          AND TK.KHODUOC_ID = '$KHODUOC_ID$'
          AND SLN.BENHVIEN_ID = '$BENHVIEN_ID$'
          AND TK.SOLUONG &gt; 0
           <dynamic prepend="">
            <isParameterPresent>
              <isNotEmpty prepend="and" property="NGUONDUOC_ID">
                SLN.NGUONDUOC_ID = '$NGUONDUOC_ID$'
              </isNotEmpty>
              <isNotEmpty prepend="and" property="LST_SOLONHAP_ID">
                SLN.SOLONHAP_ID NOT IN ($LST_SOLONHAP_ID$)
              </isNotEmpty>
            </isParameterPresent>
          </dynamic>            
            <isEqual prepend="" property="PHUONGPHAPXUAT" compareValue="0">
                ORDER BY NGAYNHAP
            </isEqual>
            <isEqual prepend="" property="PHUONGPHAPXUAT" compareValue="1">
                ORDER BY HANSUDUNG
            </isEqual>
        </statement>
        <!--Revision:0-->
        <statement id="DAO00030_GET_SOLONHAP_XUATSUDUNG" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
          SELECT
          SLN.SOLONHAP_ID, SLN.SOLONHAP, SLN.SOLOSANPHAM, SLN.SOKIEMSOAT, SLN.SOVISA, SLN.SOLOSANPHAM || '/' || TO_CHAR(TK.SOLUONG) AS SOLOSOTON,
          SLN.NGAYNHAP AS NGAYNHAPLO, SLN.HANDUNG AS HANSUDUNG,  SLN.HANDUNG, SLN.NGUONDUOC_ID, SLN.NGUONDUOC_ID as NGUONHANG_ID,
          SLNGB.DONGIAMUA, SLNGB.DONGIAVON, SLNGB.TYLEVAT_DAUVAO as TYLEVAT, d.TYLE_VAT, SLNGB.DONGIAVONVAT, SLNGB.DONGIABAN, SLNGB.DONGIABANVAT_DAUVAO,
          dg.DONGIA AS DONGIATHAU,
          ROUND(SLNGB.DONGIABAN + SLNGB.DONGIABAN*d.TYLE_VAT/100, 0) as DONGIABAN_VAT,
          TK.KHODUOC_ID, TK.DUOC_ID, TK.SOLUONG, TK.SOLUONG AS SOLUONGTON,
          TO_CHAR(D.TENDUOCDAYDU) TENDUOCDAYDU ,D.DONVITINH_ID, D.DONVITINH, D.BHYT, NH.TENNGUONDUOC AS NGUONHANG,
          LTRIM(tk.KHODUOC_ID) || '_' || LTRIM(tk.DUOC_ID) || '_' || LTRIM(tk.NGUONDUOC_ID) as DUOC_KEY
          FROM
          TT_DUOC_CHUNGTU_SOLONHAP SLN
          INNER JOIN TT_DUOC_TONKHO TK on SLN.SOLONHAP_ID = TK.SOLONHAP_ID
          INNER JOIN TT_DUOC_SOLONHAP_GIABAN SLNGB on SLN.SOLONHAP_ID = SLNGB.SOLONHAP_ID
          INNER JOIN TM_NGUONHANG NH on SLN.NGUONDUOC_ID = NH.NGUONDUOC_ID
          INNER JOIN TM_DUOC D on SLN.DUOC_ID = D.DUOC_ID
          LEFT JOIN TM_DUOC_DONGIA dg on dg.DUOC_ID = SLN.DUOC_ID
          LEFT JOIN TM_LOAIGIA lg on (lg.LOAIGIA_ID = dg.LOAIGIA_ID AND lg.MALOAIGIA = 'GiaduocBHYT')
          WHERE
          SLN.DUOC_ID = '$DUOC_ID$'
          AND TK.KHODUOC_ID = '$KHODUOC_ID$'
          AND SLN.BENHVIEN_ID = '$BENHVIEN_ID$'
          AND TK.SOLUONG &gt; 0
            <dynamic prepend="">
              <isParameterPresent>
                <isNotEmpty prepend="and" property="NGUONDUOC_ID">
                  SLN.NGUONDUOC_ID = '$NGUONDUOC_ID$'
                </isNotEmpty>
                <isNotEmpty prepend="and" property="LST_SOLONHAP_ID">
                  SLN.SOLONHAP_ID NOT IN ($LST_SOLONHAP_ID$)
                </isNotEmpty>
              </isParameterPresent>
            </dynamic>
            <isEqual prepend="" property="PHUONGPHAPXUAT" compareValue="0">
                ORDER BY NGAYNHAP
            </isEqual>
            <isEqual prepend="" property="PHUONGPHAPXUAT" compareValue="1">
                ORDER BY HANSUDUNG
            </isEqual>
        </statement>
      <statement id="DAO00030_GET_SOLONHAP_BANGGIA" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
        SELECT
        SLN.SOLONHAP_ID, SLN.SOLONHAP, SLN.SOLOSANPHAM, SLN.SOKIEMSOAT, SLN.SOVISA, CONVERT(varchar(20), SLN.SOLOSANPHAM) + '/' + CONVERT(varchar(20), TK.SOLUONG) AS SOLOSOTON,
        SLN.NGAYNHAP AS NGAYNHAPLO, SLN.HANDUNG AS HANSUDUNG,  SLN.HANDUNG, SLN.NGUONDUOC_ID, SLN.NGUONDUOC_ID as NGUONHANG_ID,
        SLNGB.DONGIAMUA, SLNGB.DONGIAVON, SLNGB.TYLEVAT_DAUVAO as TYLEVAT, d.TYLE_VAT, SLNGB.DONGIAVONVAT,
        dg.DONGIA AS DONGIABAN,dg.DONGIA AS DONGIABAN_VAT,
        <!--ROUND(dg.DONGIA + dg.DONGIA*dg.TYLEVAT/100, 0) as DONGIABAN_VAT,-->
        TK.KHODUOC_ID, TK.DUOC_ID, TK.SOLUONG, TK.SOLUONG AS SOLUONGTON,
        D.TENDUOCDAYDU,D.DONVITINH_ID, D.DONVITINH, D.BHYT, NH.TENNGUONDUOC AS NGUONHANG,
        LTRIM(tk.KHODUOC_ID) || '_' || LTRIM(tk.DUOC_ID) || '_' || LTRIM(tk.NGUONDUOC_ID) as DUOC_KEY
        FROM
        TT_DUOC_CHUNGTU_SOLONHAP SLN
        INNER JOIN TT_DUOC_TONKHO TK on SLN.SOLONHAP_ID = TK.SOLONHAP_ID
        INNER JOIN TT_DUOC_SOLONHAP_GIABAN SLNGB on SLN.SOLONHAP_ID = SLNGB.SOLONHAP_ID
        INNER JOIN TM_NGUONHANG NH on SLN.NGUONDUOC_ID = NH.NGUONDUOC_ID
        INNER JOIN TM_DUOC D on SLN.DUOC_ID = D.DUOC_ID
        INNER JOIN TM_DUOC_DONGIA dg on dg.DUOC_ID = SLN.DUOC_ID
        INNER JOIN TM_LOAIGIA lg on (lg.LOAIGIA_ID = dg.LOAIGIA_ID AND lg.MALOAIGIA = 'Gianhathuoc')
        WHERE
        SLN.DUOC_ID = '$DUOC_ID$'
        AND TK.KHODUOC_ID = '$KHODUOC_ID$'
        AND SLN.BENHVIEN_ID = '$BENHVIEN_ID$'
        AND TK.SOLUONG &gt; 0
        <dynamic prepend="">
          <isParameterPresent>
            <isNotEmpty prepend="and" property="NGUONDUOC_ID">
              SLN.NGUONDUOC_ID = '$NGUONDUOC_ID$'
            </isNotEmpty>
            <isNotEmpty prepend="and" property="LST_SOLONHAP_ID">
              SLN.SOLONHAP_ID NOT IN ($LST_SOLONHAP_ID$)
            </isNotEmpty>
          </isParameterPresent>
        </dynamic>
        <isEqual prepend="" property="PHUONGPHAPXUAT" compareValue="0">
          ORDER BY NGAYNHAP
        </isEqual>
        <isEqual prepend="" property="PHUONGPHAPXUAT" compareValue="1">
          ORDER BY HANSUDUNG
        </isEqual>
      </statement>
        <!--Revision:0-->
        <update id="DAO00030_Update_TrangThaiToaThuoc" parameterClass="System.Collections.IDictionary">
            update
            TT_NGOAITRU_KHAMBENH_TOATHUOC
            set
            CHUNGTUPHATTHUOC_ID = #CHUNGTUPHATTHUOC_ID#,
            TRANGTHAI = #TRANGTHAI#,
            NGAYCAPNHAT = SYSTIMESTAMP
            where
            KHAMBENH_TOATHUOC_ID = '$KHAMBENH_TOATHUOC_ID$'
        </update>
      <update id="DAO00030_Update_TrangThaiToaThuocNoiTruRaVien" parameterClass="System.Collections.IDictionary">
        update
        TT_NOITRU_TOATHUOC
        set
        CHUNGTU_ID = #CHUNGTU_ID#,
        TRANGTHAI = #TRANGTHAI#,
        NGAYCAPNHAT = SYSTIMESTAMP
        where
        TOATHUOC_ID IN ($LIST_TOATHUOC_ID$)
      </update>
        <!--Revision:0-->
        <statement id="DAO00030_GET_BOOKING_NOITRU" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
            SELECT
            BK.BOOKING_ID,
            BK.DUOC_ID,
            TO_CHAR(D.TENDUOCDAYDU) TENDUOCDAYDU ,
            DVT.TENDONVITINH,
            'NOITRU' LOAITOA,
            BK.REF_TABLE,
            BK.REF_ID,
            BK.SOLUONG,
            NVL(pb.TENPHONGBAN,'') || ' - ' || BN.MAYTE || ' - ' || BN.TENBENHNHAN || ' - ' || TO_CHAR(BN.NGAYSINH,'DD/MM/YYYY')  || ' - ' || dt.TENDOITUONG  as BENHNHAN,
            CASE
            WHEN (KB.RAVIEN = '1' and KB.ISTHUOCBV = '1' ) THEN 'Toa thuốc ra viện BHYT: ' || TO_CHAR(KB.THOIGIANKHAM,'DD/MM/YYYY')
            WHEN (KB.RAVIEN = '1' and KB.ISTHUOCBV = '0' ) THEN 'Toa thuốc ra viện: ' || TO_CHAR(KB.THOIGIANKHAM,'DD/MM/YYYY')
            WHEN (KB.RAVIEN = '0' and KB.ISYLENHVTYT = '0' ) THEN 'Y lệnh thuốc: ' || TO_CHAR(KB.THOIGIANKHAM,'DD/MM/YYYY')
            WHEN (KB.RAVIEN = '0' and KB.ISYLENHVTYT = '1' ) THEN 'Y lệnh VTYT: ' || TO_CHAR(KB.THOIGIANKHAM,'DD/MM/YYYY')
            END  AS YLENH ,
            nl.TENNHANVIEN as NGUOILAP,
            BK.TRANGTHAI,
            CASE
            WHEN BK.TRANGTHAI = 'HIEULUC' THEN 'Hiệu lực'
            ELSE 'Hủy'
            END  AS TENTRANGTHAI ,
            nh.TENNHANVIEN as NGUOIHUY,
            BK.NGAYCAPNHAT
            FROM
            TT_DUOC_TONKHO_BOOK_NOITRU BK
            inner join TT_NOITRU_TOATHUOC TT on (BK.REF_TABLE = 'TT_NOITRU_TOATHUOC' AND BK.REF_ID = TT.TOATHUOC_ID)
            left join TT_BENHNHAN BN on TT.BENHNHAN_ID = BN.BENHNHAN_ID
            left join TT_NOITRU_KHAMBENH KB on KB.KHAMBENH_ID = TT.KHAMBENH_ID
            left join TT_NOITRU_BENHAN BA on TT.TIEPNHAN_ID = BA.TIEPNHAN_ID
            left join TM_PHONGBAN pb on pb.PHONGBAN_ID = NVL(BA.KHOACHUYENDEN_ID, BA.KHOAVAO_ID)
            left join TT_TIEPNHAN TN on TN.TIEPNHAN_ID = BA.TIEPNHAN_ID
            left join TM_DOITUONG dt on DT.DOITUONG_ID = TN.DOITUONG_ID
            left join TM_DUOC d on d.DUOC_ID = BK.DUOC_ID
            left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID
            left join TM_NHANVIEN nl on nl.NHANVIEN_ID = TT.NGUOITAO_ID
            left join TM_NHANVIEN nh on nh.NHANVIEN_ID = BK.NGUOICAPNHAT_ID
            WHERE BK.SOLUONG &gt; 0
            <isParameterPresent>
                <isNotEmpty prepend="and" property="KHODUOC_ID">
                    BK.KHODUOC_ID = '$KHODUOC_ID$'
                </isNotEmpty>
                <isNotEmpty prepend="and" property="PHONGBAN_ID">
                    BK.CHUYENKHOA_ID = '$PHONGBAN_ID$'
                </isNotEmpty>
                <isNotEmpty prepend="and" property="TUNGAY">                  
                  trunc(BK.NGAYTAO) BETWEEN  trunc(#TUNGAY#) and  trunc(#DENNGAY#)
                </isNotEmpty>
                <isNotEmpty prepend="and" property="TUKHOA">
                    (BN.TENBENHNHAN LIKE '%$TUKHOA$%' or BN.MAYTE LIKE '%$TUKHOA$%' or d.TENDUOCDAYDU LIKE '%$TUKHOA$%')
                </isNotEmpty>
                <isNotEmpty prepend="and" property="BENHVIEN_ID">
                    BK.BENHVIEN_ID = '$BENHVIEN_ID$'
                </isNotEmpty>
            </isParameterPresent>
        </statement>
        <!--Revision:0-->
       <update id="DAO00030_DUOC_TONKHO_BOOKING_Clear" parameterClass="System.Collections.IDictionary">
            UPDATE
            TT_DUOC_TONKHO_BOOK_NGOAITRU
            SET
            SOLUONG = 0
            ,TRANGTHAI = 'HETHIEULUC'
            ,NGAYHIEULUC = NULL
            WHERE
            REF_TABLE = 'TT_NGOAITRU_TOATHUOC'
            and SOLUONG &gt; 0
            and TO_DATE(TO_CHAR(SYSDATE,'MM/DD/YYYY'), 'MM/DD/YYYY') &gt;  TO_DATE(TO_CHAR(NGAYTAO,'MM/DD/YYYY'), 'MM/DD/YYYY')
        </update>
        
        <statement id="DAO00030_GET_BOOKING_NGOAITRU_TOATHUOC" parameterClass="System.Collections.IDictionary" resultClass="DataObject">                      
            SELECT
            BK.BOOKING_ID,
            BK.DUOC_ID,
            TO_CHAR(D.TENDUOCDAYDU) TENDUOCDAYDU ,
            DVT.TENDONVITINH,
            'NGOAITRU' LOAITOA,
            BK.REF_TABLE,
            BK.REF_ID,
            BK.SOLUONG,
            pb.TENPHONGBAN || ' - ' || BN.MAYTE || ' - ' || BN.TENBENHNHAN || ' - ' || TO_CHAR(BN.NGAYSINH,'DD/MM/YYYY') || ' - ' || dt.TENDOITUONG  as BENHNHAN,
            CASE
            WHEN (KBTT.LOAITOATHUOC = 'BV') THEN 'Toa ngoại trú BHYT: ' || TO_CHAR(KB.THOIGIANKHAM,'DD/MM/YYYY')
            WHEN (KBTT.LOAITOATHUOC = 'MN') THEN 'Toa mua ngoài: ' || TO_CHAR(KB.THOIGIANKHAM,'DD/MM/YYYY')
            END  AS YLENH ,
            nl.TENNHANVIEN as NGUOILAP,
            BK.TRANGTHAI,
            CASE
            WHEN BK.TRANGTHAI = 'HIEULUC' THEN 'Hiệu lực'
            ELSE 'Hủy'
            END  AS TENTRANGTHAI ,
            nh.TENNHANVIEN as NGUOIHUY,
            BK.NGAYCAPNHAT
            FROM
            TT_DUOC_TONKHO_BOOK_NGOAITRU BK
            inner join TT_NGOAITRU_TOATHUOC TT on (BK.REF_TABLE = 'TT_NGOAITRU_TOATHUOC' AND BK.REF_ID = TT.TOATHUOC_ID)
            inner join TT_NGOAITRU_KHAMBENH_TOATHUOC KBTT on KBTT.KHAMBENH_TOATHUOC_ID = TT.KHAMBENH_TOATHUOC_ID
            left join TT_NGOAITRU_KHAMBENH KB on KB.KHAMBENH_ID = KBTT.KHAMBENH_ID
            left join TT_BENHNHAN BN on kb.BENHNHAN_ID = BN.BENHNHAN_ID
            left join TM_PHONGBAN pb on KB.PHONGBAN_ID = pb.PHONGBAN_ID
            left join TM_DOITUONG dt on KB.DOITUONG_ID = dt.DOITUONG_ID
            left join TM_DUOC d on d.DUOC_ID = BK.DUOC_ID
            left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID
            left join TM_NHANVIEN nl on nl.NHANVIEN_ID = TT.NGUOITAO_ID
            left join TM_NHANVIEN nh on nh.NHANVIEN_ID = BK.NGUOICAPNHAT_ID
            WHERE BK.SOLUONG &gt; 0
            <isParameterPresent>
                <isNotEmpty prepend="and" property="KHODUOC_ID">
                    BK.KHODUOC_ID = '$KHODUOC_ID$'
                </isNotEmpty>
                <isNotEmpty prepend="and" property="PHONGBAN_ID">
                    KB.PHONGBAN_ID = '$PHONGBAN_ID$'
                </isNotEmpty>
                <isNotEmpty prepend="and" property="TUNGAY">                  
                  trunc(BK.NGAYTAO) BETWEEN  trunc(#TUNGAY#) and  trunc(#DENNGAY#)
                </isNotEmpty>
                <isNotEmpty prepend="and" property="TUKHOA">
                    (BN.TENBENHNHAN LIKE '%$TUKHOA$%' or BN.MAYTE LIKE '%$TUKHOA$%' or d.TENDUOCDAYDU LIKE '%$TUKHOA$%')
                </isNotEmpty>
                <isNotEmpty prepend="and" property="BENHVIEN_ID">
                    BK.BENHVIEN_ID = '$BENHVIEN_ID$'
                </isNotEmpty>
            </isParameterPresent>
        </statement>
        <!--Revision:0-->
        <statement id="DAO00030_GET_BOOKING_NGOAITRU_VTYT" parameterClass="System.Collections.IDictionary" resultClass="DataObject">            
            SELECT
            BK.BOOKING_ID,
            BK.DUOC_ID,
            TO_CHAR(D.TENDUOCDAYDU) TENDUOCDAYDU ,
            DVT.TENDONVITINH,
            'NGOAITRU' LOAITOA,
            BK.REF_TABLE,
            BK.REF_ID,
            BK.SOLUONG,
            pb.TENPHONGBAN || ' - ' || BN.MAYTE || ' - ' || BN.TENBENHNHAN || ' - ' || TO_CHAR(BN.NGAYSINH,'DD/MM/YYYY') || ' - ' || NVL(dt.TENDOITUONG,'')  as BENHNHAN,
            'Khám bệnh VTYT: ' || TO_CHAR(VT.THOIGIANSUDUNG,'DD/MM/YYYY') AS YLENH,
            nl.TENNHANVIEN as NGUOILAP,
            BK.TRANGTHAI,
            CASE
            WHEN BK.TRANGTHAI = 'HIEULUC' THEN 'Hiệu lực'
            ELSE 'Hủy'
            END  AS TENTRANGTHAI ,
            nh.TENNHANVIEN as NGUOIHUY,
            bk.NGAYCAPNHAT
            FROM
            TT_DUOC_TONKHO_BOOK_NGOAITRU BK
            inner join TT_NGOAITRU_KHAMBENH_VTYT VT on (BK.REF_TABLE = 'TT_NGOAITRU_KHAMBENH_VTYT' AND BK.REF_ID = VT.KHAMBENH_VTYT_ID)
            inner join TT_DVYEUCAU DV on DV.DVYEUCAU_ID = VT.DVYEUCAU_ID
            left join TT_BENHNHAN BN on DV.BENHNHAN_ID = BN.BENHNHAN_ID
            left join TM_PHONGBAN pb on VT.PHONGBAN_ID = pb.PHONGBAN_ID
            left join TM_DOITUONG dt on DV.DOITUONG_ID = dt.DOITUONG_ID
            left join TM_DUOC d on d.DUOC_ID = BK.DUOC_ID
            left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID
            left join TM_NHANVIEN nl on nl.NHANVIEN_ID = VT.NGUOITAO_ID
            left join TM_NHANVIEN nh on nh.NHANVIEN_ID = BK.NGUOICAPNHAT_ID
            WHERE BK.SOLUONG &gt; 0
            <isParameterPresent>
                <isNotEmpty prepend="and" property="KHODUOC_ID">
                    BK.KHODUOC_ID = '$KHODUOC_ID$'
                </isNotEmpty>
                <isNotEmpty prepend="and" property="PHONGBAN_ID">
                    VT.PHONGBAN_ID = '$PHONGBAN_ID$'
                </isNotEmpty>
                <isNotEmpty prepend="and" property="TUNGAY">
                  trunc(BK.NGAYTAO) BETWEEN  trunc(#TUNGAY#) and  trunc(#DENNGAY#)
                </isNotEmpty>
                <isNotEmpty prepend="and" property="TUKHOA">
                    (BN.TENBENHNHAN LIKE '%$TUKHOA$%' or BN.MAYTE LIKE '%$TUKHOA$%' or d.TENDUOCDAYDU LIKE '%$TUKHOA$%')
                </isNotEmpty>
                <isNotEmpty prepend="and" property="BENHVIEN_ID">
                    BK.BENHVIEN_ID = '$BENHVIEN_ID$'
                </isNotEmpty>
            </isParameterPresent>
        </statement>
        <!--Revision:0-->
        <statement id="DAO00030_GET_BOOKING_NGOAITRU_PTTT_VTYT" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
            SELECT
            BK.BOOKING_ID,
            BK.DUOC_ID,
            TO_CHAR(D.TENDUOCDAYDU) TENDUOCDAYDU ,
            DVT.TENDONVITINH,
            'NGOAITRU' LOAITOA,
            BK.REF_TABLE,
            BK.REF_ID,
            BK.SOLUONG,
            pb.TENPHONGBAN || ' - ' || BN.MAYTE || ' - ' || BN.TENBENHNHAN || ' - ' || TO_CHAR(BN.NGAYSINH,'DD/MM/YYYY') || ' - ' || dt.TENDOITUONG  as BENHNHAN,
            CASE
            WHEN PT.LOAI = 'P' THEN 'Phẫu thuật VTYT: ' || TO_CHAR(VT.NGAYSUDUNG,'DD/MM/YYYY')
            ELSE 'Thủ thuật VTYT: ' || TO_CHAR(VT.NGAYSUDUNG,'DD/MM/YYYY')
            END  AS YLENH,
            nl.TENNHANVIEN as NGUOILAP,
            BK.TRANGTHAI,
            CASE
            WHEN BK.TRANGTHAI = 'HIEULUC' THEN 'Hiệu lực'
            ELSE 'Hủy'
            END  AS TENTRANGTHAI ,
            nh.TENNHANVIEN as NGUOIHUY,
            bk.NGAYCAPNHAT
            FROM
            TT_DUOC_TONKHO_BOOK_NGOAITRU BK
            inner join TT_PHAUTHUAT_VTYT VT on (BK.REF_TABLE = 'TT_PHAUTHUAT_VTYT' AND BK.REF_ID = VT.PHAUTHUAT_VTYT_ID)
            inner join TT_PHAUTHUAT PT on PT.PHAUTHUAT_ID = VT.PHAUTHUAT_ID
            left join TT_TIEPNHAN TN on TN.TIEPNHAN_ID = PT.TIEPNHAN_ID
            left join TT_BENHNHAN BN on TN.BENHNHAN_ID = BN.BENHNHAN_ID
            left join TM_PHONGBAN pb on PT.PHONGBANTHUCHIEN_ID = pb.PHONGBAN_ID
            left join TM_DOITUONG dt on TN.DOITUONG_ID = dt.DOITUONG_ID
            left join TM_DUOC d on d.DUOC_ID = BK.DUOC_ID
            left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID
            left join TM_NHANVIEN nl on nl.NHANVIEN_ID = VT.NGUOITAO_ID
            left join TM_NHANVIEN nh on nh.NHANVIEN_ID = BK.NGUOICAPNHAT_ID
            WHERE BK.SOLUONG &gt; 0
            <isParameterPresent>
                <isNotEmpty prepend="and" property="KHODUOC_ID">
                    BK.KHODUOC_ID = '$KHODUOC_ID$'
                </isNotEmpty>
                <isNotEmpty prepend="and" property="PHONGBAN_ID">
                    PT.PHONGBANTHUCHIEN_ID = '$PHONGBAN_ID$'
                </isNotEmpty>
                <isNotEmpty prepend="and" property="TUNGAY">
                  trunc(BK.NGAYTAO) BETWEEN  trunc(#TUNGAY#) and  trunc(#DENNGAY#)
                </isNotEmpty>
                <isNotEmpty prepend="and" property="TUKHOA">
                    (BN.TENBENHNHAN LIKE '%$TUKHOA$%' or BN.MAYTE LIKE '%$TUKHOA$%' or d.TENDUOCDAYDU LIKE '%$TUKHOA$%')
                </isNotEmpty>
                <isNotEmpty prepend="and" property="BENHVIEN_ID">
                    BK.BENHVIEN_ID = '$BENHVIEN_ID$'
                </isNotEmpty>
            </isParameterPresent>
        </statement>
        <!--Revision:0-->
        <statement id="DAO00030_GET_BOOKING_CLS_VTYT" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
            SELECT
            BK.BOOKING_ID,
            BK.DUOC_ID,
            TO_CHAR(D.TENDUOCDAYDU) TENDUOCDAYDU ,
            DVT.TENDONVITINH,
            'NGOAITRU' LOAITOA,
            BK.REF_TABLE,
            BK.REF_ID,
            BK.SOLUONG,
            pb.TENPHONGBAN || ' - ' || BN.MAYTE || ' - ' || BN.TENBENHNHAN || ' - ' || TO_CHAR(BN.NGAYSINH,'DD/MM/YYYY') || ' - ' || dt.TENDOITUONG  as BENHNHAN,
            'CLS VTYT: ' || TO_CHAR(VT.NGAYSUDUNG,'DD/MM/YYYY') AS YLENH,
            nl.TENNHANVIEN as NGUOILAP,
            BK.TRANGTHAI,
            CASE
            WHEN BK.TRANGTHAI = 'HIEULUC' THEN 'Hiệu lực'
            ELSE 'Hủy'
            END  AS TENTRANGTHAI ,
            nh.TENNHANVIEN as NGUOIHUY,
            bk.NGAYCAPNHAT
            FROM
            TT_DUOC_TONKHO_BOOK_NGOAITRU BK
            inner join TT_CLSKETQUA_VTYT VT on (BK.REF_TABLE = 'TT_CLSKETQUA_VTYT' AND BK.REF_ID = VT.CLSKETQUA_VTYT_ID)
            left join TT_DVYEUCAU DV on DV.DVYEUCAU_ID = VT.DVYEUCAU_ID
            left join TT_TIEPNHAN TN on TN.TIEPNHAN_ID = DV.TIEPNHAN_ID
            left join TT_BENHNHAN BN on TN.BENHNHAN_ID = BN.BENHNHAN_ID
            left join TM_PHONGBAN pb on VT.PHONGBAN_ID = pb.PHONGBAN_ID
            left join TM_DOITUONG dt on TN.DOITUONG_ID = dt.DOITUONG_ID
            left join TM_DUOC d on d.DUOC_ID = BK.DUOC_ID
            left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID
            left join TM_NHANVIEN nl on nl.NHANVIEN_ID = VT.NGUOITAO_ID
            left join TM_NHANVIEN nh on nh.NHANVIEN_ID = BK.NGUOICAPNHAT_ID
            WHERE BK.SOLUONG &gt; 0
            <isParameterPresent>
                <isNotEmpty prepend="and" property="KHODUOC_ID">
                    BK.KHODUOC_ID = '$KHODUOC_ID$'
                </isNotEmpty>
                <isNotEmpty prepend="and" property="PHONGBAN_ID">
                    VT.PHONGBAN_ID = '$PHONGBAN_ID$'
                </isNotEmpty>
                <isNotEmpty prepend="and" property="TUNGAY">                  
                  trunc(BK.NGAYTAO) BETWEEN  trunc(#TUNGAY#) and  trunc(#DENNGAY#)
                </isNotEmpty>
                <isNotEmpty prepend="and" property="TUKHOA">
                    (BN.TENBENHNHAN LIKE '%$TUKHOA$%' or BN.MAYTE LIKE '%$TUKHOA$%' or d.TENDUOCDAYDU LIKE '%$TUKHOA$%')
                </isNotEmpty>
                <isNotEmpty prepend="and" property="BENHVIEN_ID">
                    BK.BENHVIEN_ID = '$BENHVIEN_ID$'
                </isNotEmpty>
            </isParameterPresent>
        </statement>
        <!--Revision:0-->
        <statement id="DAO00030_GET_BOOKING_PHIEULINH" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
            SELECT
            BK.BOOKING_ID,
            BK.DUOC_ID,
            TO_CHAR(D.TENDUOCDAYDU) TENDUOCDAYDU ,
            DVT.TENDONVITINH,
            'NOITRU' LOAITOA,
            BK.REF_TABLE,
            BK.REF_ID,
            BK.SOLUONG,
            pb.TENPHONGBAN as BENHNHAN,
            'Mã phiếu lĩnh: ' || PL.MACHUNGTU || ' - ' || TO_CHAR(PL.NGAYCHUNGTU,'DD/MM/YYYY HH24:Mi') AS YLENH,
            nl.TENNHANVIEN as NGUOILAP,
            BK.TRANGTHAI,
            CASE
            WHEN BK.TRANGTHAI = 'HIEULUC' THEN 'Hiệu lực'
            ELSE 'Hủy'
            END  AS TENTRANGTHAI ,
            nh.TENNHANVIEN as NGUOIHUY,
            BK.NGAYCAPNHAT
            FROM
            TT_DUOC_TONKHO_BOOK_NOITRU BK
            inner join TT_DUOC_PHIEULINH PL on (BK.REF_TABLE = 'TT_DUOC_PHIEULINH' AND BK.REF_ID = PL.CHUNGTU_ID)
            left join TM_PHONGBAN pb on pb.PHONGBAN_ID = BK.CHUYENKHOA_ID
            left join TM_DUOC d on d.DUOC_ID = BK.DUOC_ID
            left join TM_DONVITINH dvt on dvt.DONVITINH_ID = d.DONVITINH_ID
            left join TM_NHANVIEN nl on nl.NHANVIEN_ID = PL.NGUOITAO_ID
            left join TM_NHANVIEN nh on nh.NHANVIEN_ID = BK.NGUOICAPNHAT_ID
            WHERE BK.SOLUONG &gt; 0
            <isParameterPresent>
                <isNotEmpty prepend="and" property="KHODUOC_ID">
                    BK.KHODUOC_ID = '$KHODUOC_ID$'
                </isNotEmpty>
                <isNotEmpty prepend="and" property="PHONGBAN_ID">
                    BK.CHUYENKHOA_ID = '$PHONGBAN_ID$'
                </isNotEmpty>
                <isNotEmpty prepend="and" property="TUNGAY">
                  trunc(BK.NGAYTAO) BETWEEN  trunc(#TUNGAY#) and  trunc(#DENNGAY#)                  
                </isNotEmpty>
                <isNotEmpty prepend="and" property="TUKHOA">
                    (PL.MACHUNGTU LIKE '%$TUKHOA$%' or d.TENDUOCDAYDU LIKE '%$TUKHOA$%')
                </isNotEmpty>
                <isNotEmpty prepend="and" property="BENHVIEN_ID">
                    BK.BENHVIEN_ID = '$BENHVIEN_ID$'
                </isNotEmpty>
            </isParameterPresent>
        </statement>
        <!--Revision:0-->
        <statement id="DAO00030_DUOCPHIEULINH_GetAll" resultClass="DataObject">
            select *
            from TT_DUOC_PHIEULINH
            where BENHVIEN_ID = '$BENHVIEN_ID$'
            order by CHUNGTU_ID
        </statement>
        <!--Revision:0-->
        <statement id="DAO00030_DUOCPHIEULINH_GetList" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
            select *
            from TT_DUOC_PHIEULINH
            <dynamic prepend="where">
                <isParameterPresent>
                    <isNotEmpty prepend="and" property="CHUNGTU_ID">
                        TT_DUOC_PHIEULINH.CHUNGTU_ID = '$CHUNGTU_ID$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="MACHUNGTU">
                        TT_DUOC_PHIEULINH.MACHUNGTU = '$MACHUNGTU$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="SOCHUNGTU">
                        TT_DUOC_PHIEULINH.SOCHUNGTU = '$SOCHUNGTU$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="NGAYCHUNGTU">
                        TT_DUOC_PHIEULINH.NGAYCHUNGTU = '$NGAYCHUNGTU$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="LOAICHUNGTU">
                        TT_DUOC_PHIEULINH.LOAICHUNGTU = '$LOAICHUNGTU$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="MUCDICHCHUNGTU_ID">
                        TT_DUOC_PHIEULINH.MUCDICHCHUNGTU_ID = '$MUCDICHCHUNGTU_ID$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="KHOXUAT_ID">
                        TT_DUOC_PHIEULINH.KHOXUAT_ID = '$KHOXUAT_ID$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="NGUOIGIAO_ID">
                        TT_DUOC_PHIEULINH.NGUOIGIAO_ID = '$NGUOIGIAO_ID$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="NGUOIGIAO">
                        TT_DUOC_PHIEULINH.NGUOIGIAO = '$NGUOIGIAO$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="KHONHAP_ID">
                        TT_DUOC_PHIEULINH.KHONHAP_ID = '$KHONHAP_ID$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="NGUOINHAN_ID">
                        TT_DUOC_PHIEULINH.NGUOINHAN_ID = '$NGUOINHAN_ID$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="NGUOINHAN">
                        TT_DUOC_PHIEULINH.NGUOINHAN = '$NGUOINHAN$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="NGUOIKIEMTRA">
                        TT_DUOC_PHIEULINH.NGUOIKIEMTRA = '$NGUOIKIEMTRA$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="NGUOIDUYET">
                        TT_DUOC_PHIEULINH.NGUOIDUYET = '$NGUOIDUYET$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="KETOANTRUONG">
                        TT_DUOC_PHIEULINH.KETOANTRUONG = '$KETOANTRUONG$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="THUKHO">
                        TT_DUOC_PHIEULINH.THUKHO = '$THUKHO$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="SOSERI">
                        TT_DUOC_PHIEULINH.SOSERI = '$SOSERI$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="SOHOADON">
                        TT_DUOC_PHIEULINH.SOHOADON = '$SOHOADON$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="DIENGIAI">
                        TT_DUOC_PHIEULINH.DIENGIAI = '$DIENGIAI$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="GIATRI">
                        TT_DUOC_PHIEULINH.GIATRI = '$GIATRI$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="GIATRITHANHTOAN">
                        TT_DUOC_PHIEULINH.GIATRITHANHTOAN = '$GIATRITHANHTOAN$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="TYLEVAT">
                        TT_DUOC_PHIEULINH.TYLEVAT = '$TYLEVAT$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="GIATRIVAT">
                        TT_DUOC_PHIEULINH.GIATRIVAT = '$GIATRIVAT$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="THUESUAT">
                        TT_DUOC_PHIEULINH.THUESUAT = '$THUESUAT$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="GIATRITHUE">
                        TT_DUOC_PHIEULINH.GIATRITHUE = '$GIATRITHUE$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="TYLECHIETKHAU">
                        TT_DUOC_PHIEULINH.TYLECHIETKHAU = '$TYLECHIETKHAU$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="GIATRICHIETKHAU">
                        TT_DUOC_PHIEULINH.GIATRICHIETKHAU = '$GIATRICHIETKHAU$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="TIENTE_ID">
                        TT_DUOC_PHIEULINH.TIENTE_ID = '$TIENTE_ID$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="TYGIA">
                        TT_DUOC_PHIEULINH.TYGIA = '$TYGIA$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="SOCHUNGTUGOC">
                        TT_DUOC_PHIEULINH.SOCHUNGTUGOC = '$SOCHUNGTUGOC$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="NGAYCHUNGTUGOC">
                        TT_DUOC_PHIEULINH.NGAYCHUNGTUGOC = '$NGAYCHUNGTUGOC$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="NHACUNGCAP_ID">
                        TT_DUOC_PHIEULINH.NHACUNGCAP_ID = '$NHACUNGCAP_ID$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="HINHTHUCTHANHTOAN_ID">
                        TT_DUOC_PHIEULINH.HINHTHUCTHANHTOAN_ID = '$HINHTHUCTHANHTOAN_ID$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="NGUONDUOC_ID">
                        TT_DUOC_PHIEULINH.NGUONDUOC_ID = '$NGUONDUOC_ID$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="CHUNGTULIENQUAN_ID">
                        TT_DUOC_PHIEULINH.CHUNGTULIENQUAN_ID = '$CHUNGTULIENQUAN_ID$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="TOATHUOC_ID">
                        TT_DUOC_PHIEULINH.TOATHUOC_ID = '$TOATHUOC_ID$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="TOATHUOCNOITRU_ID">
                        TT_DUOC_PHIEULINH.TOATHUOCNOITRU_ID = '$TOATHUOCNOITRU_ID$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="BENHAN_ID">
                        TT_DUOC_PHIEULINH.BENHAN_ID = '$BENHAN_ID$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="DANHANTHUOC">
                        TT_DUOC_PHIEULINH.DANHANTHUOC = '$DANHANTHUOC$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="NGUOINHAP_ID">
                        TT_DUOC_PHIEULINH.NGUOINHAP_ID = '$NGUOINHAP_ID$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="NGAYNHAP">
                        TT_DUOC_PHIEULINH.NGAYNHAP = '$NGAYNHAP$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="TRANGTHAI">
                        TT_DUOC_PHIEULINH.TRANGTHAI = '$TRANGTHAI$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="PHIEULINH_ID">
                        TT_DUOC_PHIEULINH.PHIEULINH_ID = '$PHIEULINH_ID$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="DIENGIAINGHIEPVUPHATSINH">
                        TT_DUOC_PHIEULINH.DIENGIAINGHIEPVUPHATSINH = '$DIENGIAINGHIEPVUPHATSINH$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="TONGHOP_TUNGAY">
                        TT_DUOC_PHIEULINH.TONGHOP_TUNGAY ='$TONGHOP_TUNGAY$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="TONGHOP_DENNGAY">
                        TT_DUOC_PHIEULINH.TONGHOP_DENNGAY = '$TONGHOP_DENNGAY$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="COSO">
                        TT_DUOC_PHIEULINH.COSO = '$COSO$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="TONGHOP">
                        TT_DUOC_PHIEULINH.TONGHOP = '$TONGHOP$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="PHANLOAIPHIEULINH">
                        TT_DUOC_PHIEULINH.PHANLOAIPHIEULINH = '$PHANLOAIPHIEULINH$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="DUYET">
                        TT_DUOC_PHIEULINH.DUYET = '$DUYET$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="NGAYDUYET">
                        TT_DUOC_PHIEULINH.NGAYDUYET = '$NGAYDUYET$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="THOIGIANDUYET">
                        TT_DUOC_PHIEULINH.THOIGIANDUYET = '$THOIGIANDUYET$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="NGUOIDUYET_ID">
                        TT_DUOC_PHIEULINH.NGUOIDUYET_ID = '$NGUOIDUYET_ID$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="LYDO">
                        TT_DUOC_PHIEULINH.LYDO = '$LYDO$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="BENHVIEN_ID">
                        TT_DUOC_PHIEULINH.BENHVIEN_ID = '$BENHVIEN_ID$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="NGAYTAO">
                        TT_DUOC_PHIEULINH.NGAYTAO = '$NGAYTAO$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="NGUOITAO_ID">
                        TT_DUOC_PHIEULINH.NGUOITAO_ID = '$NGUOITAO_ID$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="NGAYCAPNHAT">
                        TT_DUOC_PHIEULINH.NGAYCAPNHAT = '$NGAYCAPNHAT$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="NGUOICAPNHAT_ID">
                        TT_DUOC_PHIEULINH.NGUOICAPNHAT_ID = '$NGUOICAPNHAT_ID$'
                    </isNotEmpty>
                </isParameterPresent>
            </dynamic>
            order by CHUNGTU_ID
        </statement>
        <!--Revision:0-->
        <statement id="DAO00030_DUOCPHIEULINH_GetDetail" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
            select *
            from TT_DUOC_PHIEULINH
            where TT_DUOC_PHIEULINH.CHUNGTU_ID  = '$value$'
            and BENHVIEN_ID = '$BENHVIEN_ID$'
            order by CHUNGTU_ID
        </statement>
        <!--Revision:0-->
        <statement id="DAO00030_DUOCPHIEULINH_GetDetailP" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
            select *
            from TT_DUOC_PHIEULINH
            where TT_DUOC_PHIEULINH.CHUNGTU_ID  = '$CHUNGTU_ID$'
            and BENHVIEN_ID = '$BENHVIEN_ID$'
            order by CHUNGTU_ID
        </statement>
        <!--Revision:0-->
        <insert id="DAO00030_DUOCPHIEULINH_Add" parameterClass="System.Collections.IDictionary" resultClass="System.Int64">
            <selectKey property="CHUNGTU_ID" type="pre" resultClass="System.Int64">
                select TT_DUOC_PHIEULINH_S.nextval as value from dual
            </selectKey>
            insert into TT_DUOC_PHIEULINH (
            CHUNGTU_ID
            , MACHUNGTU
            , SOCHUNGTU
            , NGAYCHUNGTU
            , LOAICHUNGTU
            , MUCDICHCHUNGTU_ID
            , KHOXUAT_ID
            , NGUOIGIAO_ID
            , NGUOIGIAO
            , KHONHAP_ID
            , NGUOINHAN_ID
            , NGUOINHAN
            , NGUOIKIEMTRA
            , NGUOIDUYET
            , KETOANTRUONG
            , THUKHO
            , SOSERI
            , SOHOADON
            , DIENGIAI
            , GIATRI
            , GIATRITHANHTOAN
            , TYLEVAT
            , GIATRIVAT
            , THUESUAT
            , GIATRITHUE
            , TYLECHIETKHAU
            , GIATRICHIETKHAU
            , TIENTE_ID
            , TYGIA
            , SOCHUNGTUGOC
            , NGAYCHUNGTUGOC
            , NHACUNGCAP_ID
            , HINHTHUCTHANHTOAN_ID
            , NGUONDUOC_ID
            , CHUNGTULIENQUAN_ID
            , TOATHUOC_ID
            , TOATHUOCNOITRU_ID
            , BENHAN_ID
            , DANHANTHUOC
            , NGUOINHAP_ID
            , NGAYNHAP
            , TRANGTHAI
            , PHIEULINH_ID
            , DIENGIAINGHIEPVUPHATSINH
            , TONGHOP_TUNGAY
            , TONGHOP_DENNGAY
            , COSO
            , TONGHOP
            , PHANLOAIPHIEULINH
            , DUYET
            , NGAYDUYET
            , THOIGIANDUYET
            , NGUOIDUYET_ID
            , LYDO
            , BENHVIEN_ID
            , NGAYTAO
            , NGUOITAO_ID
            , NGAYCAPNHAT
            , NGUOICAPNHAT_ID
            ) values (
            #CHUNGTU_ID#
            , #MACHUNGTU#
            , #SOCHUNGTU#
            , #NGAYCHUNGTU#
            , #LOAICHUNGTU#
            , #MUCDICHCHUNGTU_ID#
            , #KHOXUAT_ID#
            , #NGUOIGIAO_ID#
            , #NGUOIGIAO#
            , #KHONHAP_ID#
            , #NGUOINHAN_ID#
            , #NGUOINHAN#
            , #NGUOIKIEMTRA#
            , #NGUOIDUYET#
            , #KETOANTRUONG#
            , #THUKHO#
            , #SOSERI#
            , #SOHOADON#
            , #DIENGIAI#
            , #GIATRI#
            , #GIATRITHANHTOAN#
            , #TYLEVAT#
            , #GIATRIVAT#
            , #THUESUAT#
            , #GIATRITHUE#
            , #TYLECHIETKHAU#
            , #GIATRICHIETKHAU#
            , #TIENTE_ID#
            , #TYGIA#
            , #SOCHUNGTUGOC#
            , #NGAYCHUNGTUGOC#
            , #NHACUNGCAP_ID#
            , #HINHTHUCTHANHTOAN_ID#
            , #NGUONDUOC_ID#
            , #CHUNGTULIENQUAN_ID#
            , #TOATHUOC_ID#
            , #TOATHUOCNOITRU_ID#
            , #BENHAN_ID#
            , #DANHANTHUOC#
            , #NGUOINHAP_ID#
            , #NGAYNHAP#
            , #TRANGTHAI#
            , #PHIEULINH_ID#
            , #DIENGIAINGHIEPVUPHATSINH#
            , #TONGHOP_TUNGAY#
            , #TONGHOP_DENNGAY#
            , #COSO#
            , #TONGHOP#
            , #PHANLOAIPHIEULINH#
            , #DUYET#
            , #NGAYDUYET#
            , #THOIGIANDUYET#
            , #NGUOIDUYET_ID#
            , #LYDO#
            , #BENHVIEN_ID#
            , #NGAYCHUNGTU#
            , #NGUOITAO_ID#
            , #NGAYCAPNHAT#
            , #NGUOICAPNHAT_ID#
            )
        </insert>
        <!--Revision:0-->
        <update id="DAO00030_DUOCPHIEULINH_Update" parameterClass="System.Collections.IDictionary">
            update TT_DUOC_PHIEULINH set
            MACHUNGTU = #MACHUNGTU#
            , SOCHUNGTU = #SOCHUNGTU#
            , NGAYCHUNGTU = #NGAYCHUNGTU#
            , LOAICHUNGTU = #LOAICHUNGTU#
            , MUCDICHCHUNGTU_ID = #MUCDICHCHUNGTU_ID#
            , KHOXUAT_ID = #KHOXUAT_ID#
            , NGUOIGIAO_ID = #NGUOIGIAO_ID#
            , NGUOIGIAO = #NGUOIGIAO#
            , KHONHAP_ID = #KHONHAP_ID#
            , NGUOINHAN_ID = #NGUOINHAN_ID#
            , NGUOINHAN = #NGUOINHAN#
            , NGUOIKIEMTRA = #NGUOIKIEMTRA#
            , NGUOIDUYET = #NGUOIDUYET#
            , KETOANTRUONG = #KETOANTRUONG#
            , THUKHO = #THUKHO#
            , SOSERI = #SOSERI#
            , SOHOADON = #SOHOADON#
            , DIENGIAI = #DIENGIAI#
            , GIATRI = #GIATRI#
            , GIATRITHANHTOAN = #GIATRITHANHTOAN#
            , TYLEVAT = #TYLEVAT#
            , GIATRIVAT = #GIATRIVAT#
            , THUESUAT = #THUESUAT#
            , GIATRITHUE = #GIATRITHUE#
            , TYLECHIETKHAU = #TYLECHIETKHAU#
            , GIATRICHIETKHAU = #GIATRICHIETKHAU#
            , TIENTE_ID = #TIENTE_ID#
            , TYGIA = #TYGIA#
            , SOCHUNGTUGOC = #SOCHUNGTUGOC#
            , NGAYCHUNGTUGOC = #NGAYCHUNGTUGOC#
            , NHACUNGCAP_ID = #NHACUNGCAP_ID#
            , HINHTHUCTHANHTOAN_ID = #HINHTHUCTHANHTOAN_ID#
            , NGUONDUOC_ID = #NGUONDUOC_ID#
            , CHUNGTULIENQUAN_ID = #CHUNGTULIENQUAN_ID#
            , TOATHUOC_ID = #TOATHUOC_ID#
            , TOATHUOCNOITRU_ID = #TOATHUOCNOITRU_ID#
            , BENHAN_ID = #BENHAN_ID#
            , DANHANTHUOC = #DANHANTHUOC#
            , NGUOINHAP_ID = #NGUOINHAP_ID#
            , NGAYNHAP = #NGAYNHAP#
            , TRANGTHAI = #TRANGTHAI#
            , PHIEULINH_ID = #PHIEULINH_ID#
            , DIENGIAINGHIEPVUPHATSINH = #DIENGIAINGHIEPVUPHATSINH#
            , TONGHOP_TUNGAY = #TONGHOP_TUNGAY#
            , TONGHOP_DENNGAY = #TONGHOP_DENNGAY#
            , COSO = #COSO#
            , TONGHOP = #TONGHOP#
            , PHANLOAIPHIEULINH = #PHANLOAIPHIEULINH#
            , DUYET = #DUYET#
            , NGAYDUYET = #NGAYDUYET#
            , THOIGIANDUYET = #THOIGIANDUYET#
            , NGUOIDUYET_ID = #NGUOIDUYET_ID#
            , LYDO = #LYDO#
            <!--, BENHVIEN_ID = #BENHVIEN_ID#
				, NGAYTAO = #NGAYTAO#
				, NGUOITAO_ID = #NGUOITAO_ID#-->
            , NGAYCAPNHAT = #NGAYCAPNHAT#
            , NGUOICAPNHAT_ID = #NGUOICAPNHAT_ID#
            where
            CHUNGTU_ID = '$CHUNGTU_ID$'
        </update>
        <!--Revision:0-->
        <update id="DAO00030_DUOCPHIEULINH_Update_TinhTrang" parameterClass="System.Collections.IDictionary">
            update TT_DUOC_PHIEULINH set
            DANHANTHUOC = #DANHANTHUOC#
            ,TRANGTHAI = #TRANGTHAI#
            where
            MACHUNGTU = '$MAPHIEULINH$'
        </update>
        <!--Revision:0-->
        <update id="DAO00030_DUOCPHIEULINH_Update_PhieuXuatNB" parameterClass="System.Collections.IDictionary">
            update TT_DUOC_PHIEULINH set
            TRANGTHAI = #TRANGTHAI#
            where
            MACHUNGTU = '$MAPHIEULINH$'
        </update>
        <!--Revision:0-->
        <statement id="DAO00030_DUOCPHIEULINH_Delete" parameterClass="System.Collections.IDictionary" resultClass="System.Int32">
            delete from TT_DUOC_PHIEULINH
            where
            CHUNGTU_ID = '$CHUNGTU_ID$'
        </statement>
        <!--Revision:0-->
        <statement id="DAO00030_DUOCPHIEULINH_DeleteP" parameterClass="System.Collections.IDictionary" resultClass="System.Int32">
            delete from TT_DUOC_PHIEULINH
            <dynamic prepend="where">
                <isParameterPresent>
                    <isNotEmpty prepend="and" property="CHUNGTU_ID">
                        TT_DUOC_PHIEULINH.CHUNGTU_ID = '$CHUNGTU_ID$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="MACHUNGTU">
                        TT_DUOC_PHIEULINH.MACHUNGTU = '$MACHUNGTU$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="SOCHUNGTU">
                        TT_DUOC_PHIEULINH.SOCHUNGTU = '$SOCHUNGTU$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="NGAYCHUNGTU">
                        TT_DUOC_PHIEULINH.NGAYCHUNGTU = '$NGAYCHUNGTU$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="LOAICHUNGTU">
                        TT_DUOC_PHIEULINH.LOAICHUNGTU = '$LOAICHUNGTU$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="MUCDICHCHUNGTU_ID">
                        TT_DUOC_PHIEULINH.MUCDICHCHUNGTU_ID = '$MUCDICHCHUNGTU_ID$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="KHOXUAT_ID">
                        TT_DUOC_PHIEULINH.KHOXUAT_ID = '$KHOXUAT_ID$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="NGUOIGIAO_ID">
                        TT_DUOC_PHIEULINH.NGUOIGIAO_ID = '$NGUOIGIAO_ID$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="NGUOIGIAO">
                        TT_DUOC_PHIEULINH.NGUOIGIAO = '$NGUOIGIAO$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="KHONHAP_ID">
                        TT_DUOC_PHIEULINH.KHONHAP_ID = '$KHONHAP_ID$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="NGUOINHAN_ID">
                        TT_DUOC_PHIEULINH.NGUOINHAN_ID = '$NGUOINHAN_ID$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="NGUOINHAN">
                        TT_DUOC_PHIEULINH.NGUOINHAN = '$NGUOINHAN$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="NGUOIKIEMTRA">
                        TT_DUOC_PHIEULINH.NGUOIKIEMTRA = '$NGUOIKIEMTRA$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="NGUOIDUYET">
                        TT_DUOC_PHIEULINH.NGUOIDUYET = '$NGUOIDUYET$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="KETOANTRUONG">
                        TT_DUOC_PHIEULINH.KETOANTRUONG = '$KETOANTRUONG$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="THUKHO">
                        TT_DUOC_PHIEULINH.THUKHO = '$THUKHO$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="SOSERI">
                        TT_DUOC_PHIEULINH.SOSERI = '$SOSERI$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="SOHOADON">
                        TT_DUOC_PHIEULINH.SOHOADON = '$SOHOADON$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="DIENGIAI">
                        TT_DUOC_PHIEULINH.DIENGIAI = '$DIENGIAI$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="GIATRI">
                        TT_DUOC_PHIEULINH.GIATRI = '$GIATRI$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="GIATRITHANHTOAN">
                        TT_DUOC_PHIEULINH.GIATRITHANHTOAN = '$GIATRITHANHTOAN$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="TYLEVAT">
                        TT_DUOC_PHIEULINH.TYLEVAT = '$TYLEVAT$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="GIATRIVAT">
                        TT_DUOC_PHIEULINH.GIATRIVAT = '$GIATRIVAT$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="THUESUAT">
                        TT_DUOC_PHIEULINH.THUESUAT = '$THUESUAT$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="GIATRITHUE">
                        TT_DUOC_PHIEULINH.GIATRITHUE = '$GIATRITHUE$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="TYLECHIETKHAU">
                        TT_DUOC_PHIEULINH.TYLECHIETKHAU = '$TYLECHIETKHAU$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="GIATRICHIETKHAU">
                        TT_DUOC_PHIEULINH.GIATRICHIETKHAU = '$GIATRICHIETKHAU$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="TIENTE_ID">
                        TT_DUOC_PHIEULINH.TIENTE_ID = '$TIENTE_ID$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="TYGIA">
                        TT_DUOC_PHIEULINH.TYGIA = '$TYGIA$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="SOCHUNGTUGOC">
                        TT_DUOC_PHIEULINH.SOCHUNGTUGOC = '$SOCHUNGTUGOC$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="NGAYCHUNGTUGOC">
                        TT_DUOC_PHIEULINH.NGAYCHUNGTUGOC = '$NGAYCHUNGTUGOC$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="NHACUNGCAP_ID">
                        TT_DUOC_PHIEULINH.NHACUNGCAP_ID = '$NHACUNGCAP_ID$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="HINHTHUCTHANHTOAN_ID">
                        TT_DUOC_PHIEULINH.HINHTHUCTHANHTOAN_ID = '$HINHTHUCTHANHTOAN_ID$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="NGUONDUOC_ID">
                        TT_DUOC_PHIEULINH.NGUONDUOC_ID = '$NGUONDUOC_ID$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="CHUNGTULIENQUAN_ID">
                        TT_DUOC_PHIEULINH.CHUNGTULIENQUAN_ID = '$CHUNGTULIENQUAN_ID$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="TOATHUOC_ID">
                        TT_DUOC_PHIEULINH.TOATHUOC_ID = '$TOATHUOC_ID$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="TOATHUOCNOITRU_ID">
                        TT_DUOC_PHIEULINH.TOATHUOCNOITRU_ID = '$TOATHUOCNOITRU_ID$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="BENHAN_ID">
                        TT_DUOC_PHIEULINH.BENHAN_ID = '$BENHAN_ID$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="DANHANTHUOC">
                        TT_DUOC_PHIEULINH.DANHANTHUOC = '$DANHANTHUOC$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="NGUOINHAP_ID">
                        TT_DUOC_PHIEULINH.NGUOINHAP_ID = '$NGUOINHAP_ID$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="NGAYNHAP">
                        TT_DUOC_PHIEULINH.NGAYNHAP = '$NGAYNHAP$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="TRANGTHAI">
                        TT_DUOC_PHIEULINH.TRANGTHAI = '$TRANGTHAI$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="PHIEULINH_ID">
                        TT_DUOC_PHIEULINH.PHIEULINH_ID = '$PHIEULINH_ID$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="DIENGIAINGHIEPVUPHATSINH">
                        TT_DUOC_PHIEULINH.DIENGIAINGHIEPVUPHATSINH = '$DIENGIAINGHIEPVUPHATSINH$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="TONGHOP_TUNGAY">
                        TT_DUOC_PHIEULINH.TONGHOP_TUNGAY ='$TONGHOP_TUNGAY$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="TONGHOP_DENNGAY">
                        TT_DUOC_PHIEULINH.TONGHOP_DENNGAY = '$TONGHOP_DENNGAY$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="COSO">
                        TT_DUOC_PHIEULINH.COSO = '$COSO$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="TONGHOP">
                        TT_DUOC_PHIEULINH.TONGHOP = '$TONGHOP$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="PHANLOAIPHIEULINH">
                        TT_DUOC_PHIEULINH.PHANLOAIPHIEULINH = '$PHANLOAIPHIEULINH$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="DUYET">
                        TT_DUOC_PHIEULINH.DUYET = '$DUYET$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="NGAYDUYET">
                        TT_DUOC_PHIEULINH.NGAYDUYET = '$NGAYDUYET$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="THOIGIANDUYET">
                        TT_DUOC_PHIEULINH.THOIGIANDUYET = '$THOIGIANDUYET$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="NGUOIDUYET_ID">
                        TT_DUOC_PHIEULINH.NGUOIDUYET_ID = '$NGUOIDUYET_ID$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="LYDO">
                        TT_DUOC_PHIEULINH.LYDO = '$LYDO$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="BENHVIEN_ID">
                        TT_DUOC_PHIEULINH.BENHVIEN_ID = '$BENHVIEN_ID$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="NGAYTAO">
                        TT_DUOC_PHIEULINH.NGAYTAO = '$NGAYTAO$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="NGUOITAO_ID">
                        TT_DUOC_PHIEULINH.NGUOITAO_ID = '$NGUOITAO_ID$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="NGAYCAPNHAT">
                        TT_DUOC_PHIEULINH.NGAYCAPNHAT = '$NGAYCAPNHAT$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="NGUOICAPNHAT_ID">
                        TT_DUOC_PHIEULINH.NGUOICAPNHAT_ID = '$NGUOICAPNHAT_ID$'
                    </isNotEmpty>
                </isParameterPresent>
            </dynamic>
        </statement>
        <!--Revision:0-->
        <statement id="DAO00030_PHIEULINH_SEARCH" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
            select *
            from TT_DUOC_PHIEULINH
            <dynamic prepend="where">
                <isParameterPresent>
                    <isNotEmpty prepend="and" property="CHUNGTU_ID">
                        TT_DUOC_PHIEULINH.CHUNGTU_ID = '$CHUNGTU_ID$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="MACHUNGTU">
                        TT_DUOC_PHIEULINH.MACHUNGTU like '%$MACHUNGTU$%'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="SOCHUNGTU">
                        TT_DUOC_PHIEULINH.SOCHUNGTU like '%$SOCHUNGTU$%'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="NGAYCHUNGTU">
                        TT_DUOC_PHIEULINH.NGAYCHUNGTU = '$NGAYCHUNGTU$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="LOAICHUNGTU">
                        TT_DUOC_PHIEULINH.LOAICHUNGTU = '$LOAICHUNGTU$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="COSO">
                        TT_DUOC_PHIEULINH.COSO = '$COSO$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="KHOXUAT_ID">
                        TT_DUOC_PHIEULINH.KHOXUAT_ID = '$KHOXUAT_ID$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="NGUOIGIAO_ID">
                        TT_DUOC_PHIEULINH.NGUOIGIAO_ID = '$NGUOIGIAO_ID$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="NGUOIGIAO">
                        TT_DUOC_PHIEULINH.NGUOIGIAO = '$NGUOIGIAO$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="KHONHAP_ID">
                        TT_DUOC_PHIEULINH.KHONHAP_ID = '$KHONHAP_ID$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="NGUOINHAN_ID">
                        TT_DUOC_PHIEULINH.NGUOINHAN_ID = '$NGUOINHAN_ID$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="NGUOINHAN">
                        TT_DUOC_PHIEULINH.NGUOINHAN = '$NGUOINHAN$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="NGUOIKIEMTRA">
                        TT_DUOC_PHIEULINH.NGUOIKIEMTRA = '$NGUOIKIEMTRA$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="NGUOIDUYET">
                        TT_DUOC_PHIEULINH.NGUOIDUYET = '$NGUOIDUYET$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="KETOANTRUONG">
                        TT_DUOC_PHIEULINH.KETOANTRUONG = '$KETOANTRUONG$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="THUKHO">
                        TT_DUOC_PHIEULINH.THUKHO = '$THUKHO$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="SOSERI">
                        TT_DUOC_PHIEULINH.SOSERI = '$SOSERI$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="SOHOADON">
                        TT_DUOC_PHIEULINH.SOHOADON = '$SOHOADON$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="DIENGIAI">
                        TT_DUOC_PHIEULINH.DIENGIAI = '$DIENGIAI$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="GIATRI">
                        TT_DUOC_PHIEULINH.GIATRI = '$GIATRI$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="GIATRITHANHTOAN">
                        TT_DUOC_PHIEULINH.GIATRITHANHTOAN = '$GIATRITHANHTOAN$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="TYLEVAT">
                        TT_DUOC_PHIEULINH.TYLEVAT = '$TYLEVAT$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="GIATRIVAT">
                        TT_DUOC_PHIEULINH.GIATRIVAT = '$GIATRIVAT$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="THUESUAT">
                        TT_DUOC_PHIEULINH.THUESUAT = '$THUESUAT$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="GIATRITHUE">
                        TT_DUOC_PHIEULINH.GIATRITHUE = '$GIATRITHUE$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="TYLECHIETKHAU">
                        TT_DUOC_PHIEULINH.TYLECHIETKHAU = '$TYLECHIETKHAU$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="GIATRICHIETKHAU">
                        TT_DUOC_PHIEULINH.GIATRICHIETKHAU = '$GIATRICHIETKHAU$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="TIENTE_ID">
                        TT_DUOC_PHIEULINH.TIENTE_ID = '$TIENTE_ID$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="TYGIA">
                        TT_DUOC_PHIEULINH.TYGIA = '$TYGIA$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="SOCHUNGTUGOC">
                        TT_DUOC_PHIEULINH.SOCHUNGTUGOC = '$SOCHUNGTUGOC$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="NGAYCHUNGTUGOC">
                        TT_DUOC_PHIEULINH.NGAYCHUNGTUGOC = '$NGAYCHUNGTUGOC$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="NHACUNGCAP_ID">
                        TT_DUOC_PHIEULINH.NHACUNGCAP_ID = '$NHACUNGCAP_ID$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="HINHTHUCTHANHTOAN_ID">
                        TT_DUOC_PHIEULINH.HINHTHUCTHANHTOAN_ID = '$HINHTHUCTHANHTOAN_ID$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="NGUONDUOC_ID">
                        TT_DUOC_PHIEULINH.NGUONDUOC_ID = '$NGUONDUOC_ID$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="CHUNGTULIENQUAN_ID">
                        TT_DUOC_PHIEULINH.CHUNGTULIENQUAN_ID = '$CHUNGTULIENQUAN_ID$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="TOATHUOC_ID">
                        TT_DUOC_PHIEULINH.TOATHUOC_ID = '$TOATHUOC_ID$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="TOATHUOCNOITRU_ID">
                        TT_DUOC_PHIEULINH.TOATHUOCNOITRU_ID = '$TOATHUOCNOITRU_ID$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="BENHAN_ID">
                        TT_DUOC_PHIEULINH.BENHAN_ID = '$BENHAN_ID$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="DANHANTHUOC">
                        TT_DUOC_PHIEULINH.DANHANTHUOC = '$DANHANTHUOC$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="NGUOINHAP_ID">
                        TT_DUOC_PHIEULINH.NGUOINHAP_ID = '$NGUOINHAP_ID$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="NGAYNHAP">
                        TT_DUOC_PHIEULINH.NGAYNHAP = '$NGAYNHAP$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="TRANGTHAI">
                        TT_DUOC_PHIEULINH.TRANGTHAI = '$TRANGTHAI$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="PHIEULINH_ID">
                        TT_DUOC_PHIEULINH.PHIEULINH_ID = '$PHIEULINH_ID$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="DIENGIAINGHIEPVUPHATSINH">
                        TT_DUOC_PHIEULINH.DIENGIAINGHIEPVUPHATSINH = '$DIENGIAINGHIEPVUPHATSINH$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="TONGHOP_TUNGAY">
                        TT_DUOC_PHIEULINH.TONGHOP_TUNGAY ='$TONGHOP_TUNGAY$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="TONGHOP_DENNGAY">
                        TT_DUOC_PHIEULINH.TONGHOP_DENNGAY = '$TONGHOP_DENNGAY$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="TONGHOP">
                        TT_DUOC_PHIEULINH.TONGHOP = '$TONGHOP$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="PHANLOAIPHIEULINH">
                        TT_DUOC_PHIEULINH.PHANLOAIPHIEULINH = '$PHANLOAIPHIEULINH$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="DUYET">
                        TT_DUOC_PHIEULINH.DUYET = '$DUYET$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="NGAYDUYET">
                        TT_DUOC_PHIEULINH.NGAYDUYET = '$NGAYDUYET$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="THOIGIANDUYET">
                        TT_DUOC_PHIEULINH.THOIGIANDUYET = '$THOIGIANDUYET$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="NGUOIDUYET_ID">
                        TT_DUOC_PHIEULINH.NGUOIDUYET_ID = '$NGUOIDUYET_ID$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="LYDO">
                        TT_DUOC_PHIEULINH.LYDO = '$LYDO$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="BENHVIEN_ID">
                        TT_DUOC_PHIEULINH.BENHVIEN_ID = '$BENHVIEN_ID$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="NGAYTAO">
                        TT_DUOC_PHIEULINH.NGAYTAO = '$NGAYTAO$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="NGUOITAO_ID">
                        TT_DUOC_PHIEULINH.NGUOITAO_ID = '$NGUOITAO_ID$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="NGAYCAPNHAT">
                        TT_DUOC_PHIEULINH.NGAYCAPNHAT = '$NGAYCAPNHAT$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="NGUOICAPNHAT_ID">
                        TT_DUOC_PHIEULINH.NGUOICAPNHAT_ID = '$NGUOICAPNHAT_ID$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="TUNGAY">                      
                      trunc(NGAYCHUNGTU) BETWEEN  trunc(#TUNGAY#) and  trunc(#DENNGAY#)
                    </isNotEmpty>
                </isParameterPresent>
            </dynamic>
            order by NGAYCHUNGTU DESC
        </statement>
        <!--Revision:0-->
        <statement id="DAO00030_LAPPHIEULINH_TOA_NOITRU" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
          SELECT
          TT.KHAMBENH_ID,
          TT.TOATHUOC_ID as TOATHUOC_ID,
          TT.SOTHUTUTOA as REF_ID,
          'Người bệnh: ' || BN.MAYTE || ' - ' || BN.TENBENHNHAN
          || CASE WHEN BN.GIOITINH = 1 THEN ' - Nam ' WHEN BN.GIOITINH = 2 THEN ' - Nữ ' END
          || CASE WHEN BN.NGAYSINH IS NOT NULL THEN ' - ' || TO_CHAR(BN.NGAYSINH,'DD/MM/YYYY') ELSE ' - ' || TO_CHAR(BN.NAMSINH) END
          || CASE WHEN BA.SOBENHAN IS NOT NULL THEN ' - Mã bệnh án: ' || BA.SOBENHAN  ELSE '' END
          || CASE WHEN dt.TENDOITUONG IS NOT NULL THEN ' - ' || dt.TENDOITUONG  ELSE '' END
          as BENHNHAN,
          'Y lệnh: ' || TT.SOTHUTUTOA || ' - ' || TO_CHAR(KB.NGAYKHAM,'DD/MM/YYYY HH24:Mi') || ' - Người lập: ' || NV.TENNHANVIEN  AS YLENH,
          TT.DUOC_ID,
          TO_CHAR(D.TENDUOCDAYDU) TENDUOCDAYDU ,
          D.DONVITINH,
          TT.SOLUONG as SOLUONGYEUCAU,
          NLD.TENNHOMLOAIDUOC,
          TT.KHOPHAT_ID,
          TT.NGAYTAO,
          'KHAMBENH' as LOAIPHIEU
          FROM
          TT_NOITRU_TOATHUOC TT
          left join TT_BENHNHAN BN on TT.BENHNHAN_ID = BN.BENHNHAN_ID
          left join TT_NOITRU_KHAMBENH KB on KB.KHAMBENH_ID = TT.KHAMBENH_ID
          left join TT_NOITRU_BENHAN BA on TT.TIEPNHAN_ID = BA.TIEPNHAN_ID
          left join TM_DOITUONG dt on BA.DOITUONG_ID = dt.DOITUONG_ID
          left join TM_DUOC D on D.DUOC_ID = TT.DUOC_ID
          left join TM_LOAIDUOC LD on LD.LOAIDUOC_ID = D.LOAIDUOC_ID
          left join TM_NHOMLOAIDUOC NLD on NLD.NHOMLOAIDUOC_ID = LD.NHOMLOAIDUOC_ID
          left join TM_NHANVIEN NV on TT.NGUOITAO_ID = NV.NHANVIEN_ID
          WHERE
          trunc(KB.NGAYKHAM) BETWEEN  trunc(#TONGHOP_TUNGAY#) and  trunc(#TONGHOP_DENNGAY#)
          AND TT.COSO = '$COSO$'
          <isNotEmpty prepend="and" property="KHOTAO_ID">
                TT.KHOTAO_ID ='$KHOTAO_ID$'
            </isNotEmpty>
            <isNotEmpty prepend="and" property="KHOPHAT_ID">
                TT.KHOPHAT_ID ='$KHOPHAT_ID$'
            </isNotEmpty>
            AND TT.PHONGBANRATOA_ID = '$PHONGBANRATOA_ID$'
            AND TT.BENHVIEN_ID = '$BENHVIEN_ID$'
            AND TT.PHIEULINH_ID is NULL
            AND (BN.TENBENHNHAN like '%$TUKHOA$%' OR BN.MAYTE like '%$TUKHOA$%' OR BA.SOBENHAN  like '%$TUKHOA$%' or D.TENDUOCDAYDU like '%$TUKHOA$%')
            <isNotEmpty prepend="and" property="LOAIVATTU_ID">
                LD.LOAIVATTU_ID = '$LOAIVATTU_ID$'
            </isNotEmpty>
            order by NGAYTAO DESC
        </statement>
        <!--Revision:0-->
        <statement id="DAO00030_LAPPHIEULINH_PTTT_VTYT" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
          SELECT DISTINCT
          VT.PHAUTHUAT_VTYT_ID AS TOATHUOC_ID,
          VT.PHAUTHUAT_ID as REF_ID,
          'Người bệnh: ' || BN.MAYTE || ' - ' || BN.TENBENHNHAN
          || CASE WHEN BN.GIOITINH = 1 THEN ' - Nam' WHEN BN.GIOITINH = 2 THEN ' - Nữ' END
          || CASE WHEN BN.NGAYSINH IS NOT NULL THEN ' - ' || TO_CHAR(BN.NGAYSINH,'DD/MM/YYYY') ELSE ' - ' || TO_CHAR(BN.NAMSINH) END
          || CASE WHEN BA.SOBENHAN IS NOT NULL THEN ' - Mã bệnh án: ' || BA.SOBENHAN  ELSE ' - Số tiếp nhận: ' || TN.SOTIEPNHAN END
          || CASE WHEN dt.TENDOITUONG IS NOT NULL THEN ' - ' || dt.TENDOITUONG  ELSE '' END
          as BENHNHAN,
          CASE WHEN PT.LOAI = 'P' THEN 'Số phiếu phẫu thuật: ' || NVL(PT.SOPHIEUPHAUTHUAT,'')  || ' - Ngày: ' || TO_CHAR(VT.NGAYTAO, 'DD/MM/YYYY HH24:Mi') ||
          CASE WHEN NV.TENNHANVIEN IS NOT NULL THEN  ' - Người lập: ' ||  NV.TENNHANVIEN ELSE '' END
          ELSE 'Số phiếu thủ thuật: ' ||  NVL(PT.SOPHIEUPHAUTHUAT,'')  || ' - Ngày: ' || TO_CHAR(VT.NGAYTAO, 'DD/MM/YYYY HH24:Mi') ||
          CASE WHEN NV.TENNHANVIEN IS NOT NULL THEN ' - Người lập: ' ||  NV.TENNHANVIEN ELSE '' END
          END AS YLENH,
          VT.DUOC_ID,
          TO_CHAR(D.TENDUOCDAYDU) TENDUOCDAYDU ,
          D.DONVITINH,
          VT.SOLUONG as SOLUONGYEUCAU,
          NLD.TENNHOMLOAIDUOC,
          VT.KHOSUDUNG_ID,
          VT.NGAYTAO,
          PT.LOAI as LOAIPHIEU
          FROM
          TT_PHAUTHUAT_VTYT VT
          left join TT_PHAUTHUAT PT on PT.PHAUTHUAT_ID = VT.PHAUTHUAT_ID
          left join TT_TIEPNHAN TN on TN.TIEPNHAN_ID = PT.TIEPNHAN_ID
          left join TT_NOITRU_BENHAN BA on TN.TIEPNHAN_ID = BA.TIEPNHAN_ID
          left join TM_DOITUONG dt on TN.DOITUONG_ID = dt.DOITUONG_ID
          left join TT_BENHNHAN BN on BN.BENHNHAN_ID = TN.BENHNHAN_ID
          left join TM_DUOC D on D.DUOC_ID = VT.DUOC_ID
          left join TM_LOAIDUOC LD on LD.LOAIDUOC_ID = D.LOAIDUOC_ID
          left join TM_NHOMLOAIDUOC NLD on NLD.NHOMLOAIDUOC_ID = LD.NHOMLOAIDUOC_ID
          left join TM_NHANVIEN NV on VT.NGUOITAO_ID = NV.NHANVIEN_ID
          WHERE          
          trunc(VT.NGAYTAO) BETWEEN  trunc(#TONGHOP_TUNGAY#) and  trunc(#TONGHOP_DENNGAY#)
          AND VT.KHOSUDUNG_ID = '$KHOPHAT_ID$'
          AND VT.BENHVIEN_ID = '$BENHVIEN_ID$'
          AND VT.CHUNGTUTONGHOP_ID is NULL
          AND LD.LOAIVATTU_ID = '$LOAIVATTU_ID$'
          AND PT.PHONGBANTHUCHIEN_ID = '$PHONGBANTHUCHIEN_ID$'
          AND (BN.TENBENHNHAN like '%$TUKHOA$%'  OR BN.MAYTE like '%$TUKHOA$%' OR  PT.SOPHIEUPHAUTHUAT  like '%$TUKHOA$%' or D.TENDUOCDAYDU like '%$TUKHOA$%')
          order by NGAYTAO DESC
        </statement>
        <!--Revision:0-->
        <statement id="DAO00030_LAPPHIEULINH_CLS_VTYT" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
          SELECT
          CLS.CLSKETQUA_VTYT_ID AS TOATHUOC_ID,
          DV.DVYEUCAU_ID as REF_ID,
          'Người bệnh: ' || BN.MAYTE || ' - ' || BN.TENBENHNHAN
          || CASE WHEN BN.GIOITINH = 1 THEN ' - Nam' WHEN BN.GIOITINH = 2 THEN ' - Nữ' END
          || CASE WHEN BN.NGAYSINH IS NOT NULL THEN ' - ' || TO_CHAR(BN.NGAYSINH,'DD/MM/YYYY') ELSE ' - ' || TO_CHAR(BN.NAMSINH) END
          || CASE WHEN BA.SOBENHAN IS NOT NULL THEN ' - Mã bệnh án: ' || BA.SOBENHAN  ELSE ' - Số tiếp nhận: ' || TN.SOTIEPNHAN END
          || CASE WHEN dt.TENDOITUONG IS NOT NULL THEN ' - ' || dt.TENDOITUONG  ELSE '' END
          as BENHNHAN,
          TO_CHAR(BN.NGAYSINH,'DD/MM/YYYY') as NGAYSINH,
          'Số phiếu CLS: ' ||  dv.SOPHIEUYEUCAU  || ' - Ngày: ' ||  TO_CHAR(CLS.NGAYTAO, 'DD/MM/YYYY HH24:Mi')
          || CASE WHEN NV.TENNHANVIEN IS NOT NULL THEN ' - Người lập: ' ||  NV.TENNHANVIEN ELSE '' END
          AS YLENH,
          CLS.DUOC_ID,
          TO_CHAR(D.TENDUOCDAYDU) TENDUOCDAYDU ,
          D.DONVITINH,
          CLS.SOLUONG as SOLUONGYEUCAU,
          NLD.TENNHOMLOAIDUOC,
          CLS.KHOSUDUNG_ID,
          CLS.NGAYTAO,
          'CLS' as LOAIPHIEU
          FROM
          TT_CLSKETQUA_VTYT CLS
          left join TT_DVYEUCAU DV on DV.DVYEUCAU_ID = CLS.DVYEUCAU_ID
          left join TT_BENHNHAN BN on DV.BENHNHAN_ID = BN.BENHNHAN_ID
          left join TT_TIEPNHAN TN on TN.TIEPNHAN_ID = DV.TIEPNHAN_ID
          left join TT_NOITRU_BENHAN BA on TN.TIEPNHAN_ID = BA.TIEPNHAN_ID
          left join TM_DOITUONG dt on TN.DOITUONG_ID = dt.DOITUONG_ID
          left join TM_DUOC D on D.DUOC_ID = CLS.DUOC_ID
          left join TM_LOAIDUOC LD on LD.LOAIDUOC_ID = D.LOAIDUOC_ID
          left join TM_NHOMLOAIDUOC NLD on NLD.NHOMLOAIDUOC_ID = LD.NHOMLOAIDUOC_ID
          left join TM_NHANVIEN NV on CLS.NGUOITAO_ID = NV.NHANVIEN_ID
          WHERE          
          trunc(CLS.NGAYTAO) BETWEEN  trunc(#TONGHOP_TUNGAY#) and  trunc(#TONGHOP_DENNGAY#)
          AND CLS.KHOSUDUNG_ID = '$KHOPHAT_ID$'
          AND CLS.BENHVIEN_ID = '$BENHVIEN_ID$'
          AND CLS.CHUNGTUTONGHOP_ID is NULL
          AND LD.LOAIVATTU_ID = '$LOAIVATTU_ID$'
          AND DV.NOITHUCHIEN_ID = '$PHONGBANTHUCHIEN_ID$'
          AND (BN.TENBENHNHAN like '%$TUKHOA$%'  OR BN.MAYTE like '%$TUKHOA$%' OR  DV.SOPHIEUYEUCAU  like '%$TUKHOA$%' or D.TENDUOCDAYDU like '%$TUKHOA$%')
          order by CLS.NGAYTAO DESC
        </statement>
        <!--Revision:0-->
        <statement id="DAO00030_LAPPHIEULINH_TONGHOPTUYLENH" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
          SELECT DISTINCT
          TT.TOATHUOC_ID,
          KB.KHAMBENH_ID AS MASTER_ID,
          TT.SOTHUTUTOA,
          LTRIM(TT.KHOPHAT_ID) || '_' + LTRIM(TT.DUOC_ID) || '_' + LTRIM(TT.NGUONDUOC_ID) as DUOC_KEY,
          TT.DUOC_ID,
          TT.SOLUONG as SOLUONGYEUCAU,
          NLD.TENNHOMLOAIDUOC,
          TN.SOTIEPNHAN,
          BN.TENBENHNHAN,
          'Người bệnh: ' || BN.MAYTE || ' - ' || BN.TENBENHNHAN || ' - ' || 'Thời gian Y lệnh: ' || TO_CHAR(TT.NGAYTAO,'DD/MM/YYYY HH24:Mi') as BENHNHAN,
          TT.NGAYTAO,
          'TT_NOITRU_TOATHUOC' as LOAIPHIEU,
          TT.NGAYCAPNHAT as REF_NGAYCAPNHAT
          FROM
          TT_NOITRU_TOATHUOC TT
          left join TT_NOITRU_KHAMBENH KB on TT.KHAMBENH_ID = KB.KHAMBENH_ID
          left join TT_NOITRU_BENHAN BA on  KB.BENHAN_ID = BA.BENHAN_ID
          left join TT_BENHNHAN BN on  TT.BENHNHAN_ID = BN.BENHNHAN_ID
          left join TT_TIEPNHAN TN on TT.TIEPNHAN_ID = TN.TIEPNHAN_ID
          left join TM_DUOC D on D.DUOC_ID = TT.DUOC_ID
          left join TM_LOAIDUOC LD on LD.LOAIDUOC_ID = D.LOAIDUOC_ID
          left join TM_NHOMLOAIDUOC NLD on NLD.NHOMLOAIDUOC_ID = LD.NHOMLOAIDUOC_ID
          WHERE
          TT.BENHVIEN_ID = '$BENHVIEN_ID$'
          AND TT.PHIEULINH_ID is NULL
          AND TT.TOATHUOC_ID IN ($LIST_TOATHUOC_ID$)
          AND TT.SOTHUTUTOA IN ($LIST_REF_ID$)

          union all

          SELECT DISTINCT
          VT.PHAUTHUAT_VTYT_ID AS TOATHUOC_ID,
          PT.PHAUTHUAT_ID AS MASTER_ID,
          '1' as SOTHUTUTOA,
          LTRIM(VT.KHOSUDUNG_ID) || '_' + LTRIM(VT.DUOC_ID) || '_' + LTRIM(VT.NGUONHANG_ID) as DUOC_KEY,
          VT.DUOC_ID,
          VT.SOLUONG as SOLUONGYEUCAU,
          NLD.TENNHOMLOAIDUOC,
          TN.SOTIEPNHAN,
          BN.TENBENHNHAN,
          'Người bệnh: ' || BN.MAYTE || ' - ' || BN.TENBENHNHAN || ' - '
          || 'Thời gian ghi nhận: ' || TO_CHAR(VT.NGAYTAO,'DD/MM/YYYY HH24:Mi') as BENHNHAN,
          VT.NGAYTAO,
          'TT_PHAUTHUAT_VTYT' as LOAIPHIEU,
          VT.NGAYCAPNHAT as REF_NGAYCAPNHAT
          FROM
          TT_PHAUTHUAT_VTYT VT
          left join TT_PHAUTHUAT PT on PT.PHAUTHUAT_ID = VT.PHAUTHUAT_ID
          left join TT_PHAUTHUAT_EKIP EK on PT.PHAUTHUAT_ID = EK.PHAUTHUAT_ID
          left join TT_TIEPNHAN TN on TN.TIEPNHAN_ID = PT.TIEPNHAN_ID
          left join TT_BENHNHAN BN on BN.BENHNHAN_ID = TN.BENHNHAN_ID
          left join TM_DUOC D on D.DUOC_ID = VT.DUOC_ID
          left join TM_LOAIDUOC LD on LD.LOAIDUOC_ID = D.LOAIDUOC_ID
          left join TM_NHOMLOAIDUOC NLD on NLD.NHOMLOAIDUOC_ID = LD.NHOMLOAIDUOC_ID
          WHERE
          VT.PHAUTHUAT_VTYT_ID IN ($LIST_TOATHUOC_ID$)
          AND PT.PHAUTHUAT_ID IN ($LIST_REF_ID$)
          AND VT.BENHVIEN_ID = '$BENHVIEN_ID$'

          union all

          SELECT DISTINCT
          CLS.CLSKETQUA_VTYT_ID AS TOATHUOC_ID,
          DV.DVYEUCAU_ID AS MASTER_ID,
          '0' as SOTHUTUTOA,
          LTRIM(VT.KHOSUDUNG_ID) || '_' + LTRIM(VT.DUOC_ID) || '_' + LTRIM(VT.NGUONHANG_ID) as DUOC_KEY,
          CLS.DUOC_ID,
          CLS.SOLUONG as SOLUONGYEUCAU,
          NLD.TENNHOMLOAIDUOC,
          TN.SOTIEPNHAN,
          BN.TENBENHNHAN,
          'Người bệnh: ' || BN.MAYTE || ' - ' || BN.TENBENHNHAN || ' - ' ||
          'Thời gian ghi nhận: ' ||  TO_CHAR(CLS.NGAYTAO,'DD/MM/YYYY HH24:Mi') AS BENHNHAN,
          CLS.NGAYTAO,
          'TT_CLSKETQUA_VTYT' as LOAIPHIEU,
          CLS.NGAYCAPNHAT as REF_NGAYCAPNHAT
          FROM
          TT_CLSKETQUA_VTYT CLS
          left join TT_CLSKETQUA KQ on KQ.CLSKETQUA_ID = CLS.CLSKETQUA_ID
          left join TT_DVYEUCAU DV on DV.DVYEUCAU_ID = CLS.DVYEUCAU_ID
          left join TT_BENHNHAN BN on DV.BENHNHAN_ID = BN.BENHNHAN_ID
          left join TT_TIEPNHAN TN on TN.TIEPNHAN_ID = DV.TIEPNHAN_ID
          left join TM_DUOC D on D.DUOC_ID = CLS.DUOC_ID
          left join TM_LOAIDUOC LD on LD.LOAIDUOC_ID = D.LOAIDUOC_ID
          left join TM_NHOMLOAIDUOC NLD on NLD.NHOMLOAIDUOC_ID = LD.NHOMLOAIDUOC_ID
          WHERE
          CLS.BENHVIEN_ID = '$BENHVIEN_ID$'
          AND CLS.CLSKETQUA_VTYT_ID IN ($LIST_TOATHUOC_ID$)
          AND DV.DVYEUCAU_ID IN ($LIST_REF_ID$)
        </statement>
        <!--Revision:0-->
        <statement id="DAO00030_YLENH_NOITRU_NGAYCAPNHAT" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
            SELECT
            TT.NGAYCAPNHAT
            FROM
            TT_NOITRU_TOATHUOC TT
            inner join TM_DUOC D on D.DUOC_ID = TT.DUOC_ID
            inner join TM_LOAIDUOC LD on LD.LOAIDUOC_ID = D.LOAIDUOC_ID
            WHERE
            tt.KHAMBENH_ID IN ($LIST_REF_ID$)
            AND tt.BENHVIEN_ID = '$BENHVIEN_ID$'
            <isNotEmpty prepend="and" property="LOAIVATTU_ID">
                LD.LOAIVATTU_ID = '$LOAIVATTU_ID$'
            </isNotEmpty>
        </statement>
        <!--Revision:0-->
        <statement id="DAO00030_VTYT_PHAUTHUAT_NGAYCAPNHAT" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
            SELECT
            NGAYCAPNHAT
            FROM
            TT_PHAUTHUAT_VTYT
            WHERE
            PHAUTHUAT_ID IN ($LIST_REF_ID$)
            AND BENHVIEN_ID = '$BENHVIEN_ID$'
        </statement>
        <!--Revision:0-->
        <statement id="DAO00030_VTYT_CLSKQ_NGAYCAPNHAT" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
            SELECT
            NGAYCAPNHAT
            FROM
            TT_CLSKETQUA_VTYT
            WHERE
            DVYEUCAU_ID IN ($LIST_REF_ID$)
            AND BENHVIEN_ID = '$BENHVIEN_ID$'
        </statement>
        <!--Revision:0-->
        <statement id="DAO00030_VTYT_NGOAITRU_NGAYCAPNHAT" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
            SELECT
            NGAYCAPNHAT
            FROM
            TT_NGOAITRU_KHAMBENH_VTYT
            WHERE
            DVYEUCAU_ID IN ($LIST_REF_ID$)
            AND BENHVIEN_ID = '$BENHVIEN_ID$'
        </statement>
        <!--Revision:0-->
        <statement id="DAO00030_XUATSUDUNG_TOANOITRU" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
          SELECT
          'Người bệnh: ' || BN.MAYTE || ' - ' || BN.TENBENHNHAN || ' - '  || 'Bệnh án: ' || BA.SOBENHAN  as BENHNHAN,
          CASE WHEN BN.GIOITINH = 1 THEN 'Nam' WHEN BN.GIOITINH = 2 THEN 'Nữ'  END  AS GIOITINH ,
          CASE WHEN BN.NGAYSINH IS NOT NULL THEN TO_CHAR(BN.NGAYSINH,'DD/MM/YYYY') ELSE TO_CHAR(BN.NAMSINH) END as NGAYSINH,
          CASE WHEN dt.TENDOITUONG IS NOT NULL THEN dt.TENDOITUONG  ELSE '' END as DOITUONG,
          'Y lệnh:' || TT.SOTHUTUTOA || ' - Ngày: ' || TO_CHAR(KB.NGAYKHAM,'DD/MM/YYYY HH24:Mi')
          || CASE WHEN NV.TENNHANVIEN IS NOT NULL THEN ' - Người lập: ' ||  NV.TENNHANVIEN ELSE '' END
          AS YLENH,
          TT.TOATHUOC_ID,
          TT.SOTHUTUTOA as REF_ID,
          PL.MACHUNGTU,
          TT.DUOC_ID,
          TT.SOLUONG as SOLUONGYEUCAU,
          trt.SOLUONG as SOLUONGTRA,
          TT.NGAYTAO
          FROM
          TT_NOITRU_TOATHUOC TT
          inner join TT_BENHNHAN BN on TT.BENHNHAN_ID = BN.BENHNHAN_ID
          inner join TT_NOITRU_KHAMBENH KB on KB.KHAMBENH_ID = TT.KHAMBENH_ID
          inner join TT_NOITRU_BENHAN BA on TT.TIEPNHAN_ID = BA.TIEPNHAN_ID
          inner join TM_DUOC D on D.DUOC_ID = TT.DUOC_ID
          inner join TM_LOAIDUOC LD on LD.LOAIDUOC_ID = D.LOAIDUOC_ID
          left join TM_DOITUONG dt on BA.DOITUONG_ID = dt.DOITUONG_ID
          left join TT_DUOC_PHIEULINH PL on PL.CHUNGTU_ID = TT.PHIEULINH_ID
          left join TT_NOITRU_TRATHUOC_CHITIET trt on (trt.TOATHUOC_ID = TT.TOATHUOC_ID)
          left join TM_NHANVIEN NV on TT.NGUOITAO_ID = NV.NHANVIEN_ID
          WHERE
          trunc(KB.NGAYKHAM) BETWEEN  trunc(#TONGHOP_TUNGAY#) and  trunc(#TONGHOP_DENNGAY#)
          AND TT.CHUNGTU_ID is null
          <!--AND TT.KHOTAO_ID = '$KHOTAO_ID$'-->
            AND TT.PHONGBANRATOA_ID = '$NOILAP_ID$'
            <isNotEmpty prepend="and" property="COSO">
                TT.COSO= '$COSO$'
            </isNotEmpty>
            AND TT.BENHVIEN_ID = '$BENHVIEN_ID$'
            AND (BN.TENBENHNHAN like '%$TUKHOA$%' OR BN.MAYTE like '%$TUKHOA$%'  OR  BA.SOBENHAN  like '%$TUKHOA$%'
            or D.TENDUOCDAYDU like '%$TUKHOA$%'
            OR PL.MACHUNGTU like '%$TUKHOA$%'
            )
            AND LD.LOAIVATTU_ID = '$LOAIVATTU_ID$'
            order by NGAYTAO DESC
        </statement>
        <!--Revision:0-->
        <statement id="DAO00030_XUATSUDUNG_KHAMBENH_NGOAITRU_VTYT" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
          SELECT
          'Người bệnh: ' || BN.MAYTE || ' - ' || BN.TENBENHNHAN || ' - ' || 'Số TN: ' || TN.SOTIEPNHAN  as BENHNHAN,
          CASE WHEN BN.GIOITINH = 1 THEN 'Nam' WHEN BN.GIOITINH = 2 THEN 'Nữ' END  AS GIOITINH ,
          CASE WHEN BN.NGAYSINH IS NOT NULL THEN TO_CHAR(BN.NGAYSINH,'DD/MM/YYYY') ELSE TO_CHAR(BN.NAMSINH) END as NGAYSINH,
          CASE WHEN dt.TENDOITUONG IS NOT NULL THEN dt.TENDOITUONG  ELSE '' END as DOITUONG,
          'VTYT Ngoại trú ngày: ' || TO_CHAR( VT.NGAYTAO, 'DD/MM/YYYY HH24:Mi')
          || CASE WHEN NV.TENNHANVIEN IS NOT NULL THEN ' - Người lập: ' ||  NV.TENNHANVIEN ELSE '' END
          AS YLENH,
          VT.KHAMBENH_VTYT_ID as TOATHUOC_ID,
          DV.DVYEUCAU_ID as REF_ID,
          PL.MACHUNGTU,
          VT.DUOC_ID,
          VT.SOLUONG as SOLUONGYEUCAU,
          VT.NGAYTAO
          FROM
          TT_NGOAITRU_KHAMBENH_VTYT VT
          inner join TT_DVYEUCAU DV on DV.DVYEUCAU_ID = VT.DVYEUCAU_ID
          inner join TT_BENHNHAN BN on DV.BENHNHAN_ID = BN.BENHNHAN_ID
          inner join TT_TIEPNHAN TN on TN.TIEPNHAN_ID = DV.TIEPNHAN_ID
          left join TM_DOITUONG dt on TN.DOITUONG_ID = dt.DOITUONG_ID
          left join TM_NHANVIEN NV on VT.NGUOITAO_ID = NV.NHANVIEN_ID
          inner join TM_DUOC D on D.DUOC_ID = VT.DUOC_ID
          inner join TM_LOAIDUOC LD on LD.LOAIDUOC_ID = D.LOAIDUOC_ID
          left join TT_DUOC_PHIEULINH PL on PL.CHUNGTU_ID = VT.PHIEULINH_ID
          WHERE          
          trunc(VT.NGAYTAO) BETWEEN  trunc(#TONGHOP_TUNGAY#) and  trunc(#TONGHOP_DENNGAY#)
          AND VT.CHUNGTU_ID is null
          AND VT.KHOTAO_ID = '$KHOTAO_ID$'
          AND VT.BENHVIEN_ID = '$BENHVIEN_ID$'
          AND (BN.TENBENHNHAN like '%$TUKHOA$%' OR BN.MAYTE like '%$TUKHOA$%'
          OR  TN.SOTIEPNHAN  like '%$TUKHOA$%' or D.TENDUOCDAYDU like '%$TUKHOA$%'
          OR PL.MACHUNGTU like '%$TUKHOA$%'
          )
          AND LD.LOAIVATTU_ID = '$LOAIVATTU_ID$'
          order by NGAYTAO DESC
        </statement>
        <!--Revision:0-->
        <statement id="DAO00030_XUATSUDUNG_PTTT_VTYT" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
          SELECT
          'Người bệnh: ' || BN.MAYTE || ' - ' || BN.TENBENHNHAN || ' - '  || 'Số TN: ' || TN.SOTIEPNHAN  as BENHNHAN,
          CASE WHEN BN.GIOITINH = 1 THEN 'Nam' WHEN BN.GIOITINH = 2 THEN 'Nữ' END  AS GIOITINH,
          CASE WHEN BN.NGAYSINH IS NOT NULL THEN TO_CHAR(BN.NGAYSINH,'DD/MM/YYYY') ELSE TO_CHAR(BN.NAMSINH) END as NGAYSINH,
          CASE WHEN dt.TENDOITUONG IS NOT NULL THEN dt.TENDOITUONG  ELSE '' END as DOITUONG,
          CASE
          WHEN PT.LOAI = 'P' THEN 'Số phiếu Phẫu thuật: ' ||  NVL(PT.SOPHIEUPHAUTHUAT,'')  || ' - Ngày: ' ||  TO_CHAR(VT.NGAYTAO, 'DD/MM/YYYY HH24:Mi') || CASE WHEN NV.TENNHANVIEN IS NOT NULL THEN  ' - Người lập: ' ||  NV.TENNHANVIEN ELSE '' END
          ELSE 'Số phiếu Thủ thuật: ' ||  NVL(PT.SOPHIEUPHAUTHUAT,'')  || ' - Ngày: ' ||  TO_CHAR( VT.NGAYTAO, 'DD/MM/YYYY HH24:Mi') || CASE WHEN NV.TENNHANVIEN IS NOT NULL THEN ' - Người lập: ' ||  NV.TENNHANVIEN ELSE '' END
          END  AS YLENH,
          VT.PHAUTHUAT_VTYT_ID as TOATHUOC_ID,
          VT.PHAUTHUAT_ID as REF_ID,
          PL.MACHUNGTU,
          VT.DUOC_ID,
          VT.SOLUONG as SOLUONGYEUCAU,
          VT.NGAYTAO
          FROM
          TT_PHAUTHUAT_VTYT VT
          inner join TT_PHAUTHUAT PT on PT.PHAUTHUAT_ID = VT.PHAUTHUAT_ID
          left join TT_TIEPNHAN TN on TN.TIEPNHAN_ID = PT.TIEPNHAN_ID
          left join TT_BENHNHAN BN on BN.BENHNHAN_ID = TN.BENHNHAN_ID
          left join TM_DOITUONG dt on TN.DOITUONG_ID = dt.DOITUONG_ID
          left join TM_DUOC D on D.DUOC_ID = VT.DUOC_ID
          left join TM_LOAIDUOC LD on LD.LOAIDUOC_ID = D.LOAIDUOC_ID
          left join TM_NHANVIEN NV on VT.NGUOITAO_ID = NV.NHANVIEN_ID
          left join TT_DUOC_PHIEULINH PL on PL.CHUNGTU_ID = VT.CHUNGTU_ID
          WHERE          
          trunc(VT.NGAYTAO) BETWEEN  trunc(#TONGHOP_TUNGAY#) and  trunc(#TONGHOP_DENNGAY#)
          AND VT.CHUNGTU_ID is null
          <!--AND VT.KHOTAO_ID = '$KHOTAO_ID$'-->
            AND PT.PHONGBANTHUCHIEN_ID = '$NOILAP_ID$'
            AND VT.BENHVIEN_ID = '$BENHVIEN_ID$'
            AND (BN.TENBENHNHAN like '%$TUKHOA$%' OR BN.MAYTE like '%$TUKHOA$%' OR  TN.SOTIEPNHAN  like '%$TUKHOA$%' or D.TENDUOCDAYDU like '%$TUKHOA$%'
            OR PL.MACHUNGTU like '%$TUKHOA$%'
            )
            AND LD.LOAIVATTU_ID = '$LOAIVATTU_ID$'
            order by NGAYTAO DESC
        </statement>
        <!--Revision:0-->
        <statement id="DAO00030_XUATSUDUNG_CLS_VTYT" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
          SELECT
          'Người bệnh: ' || BN.MAYTE || ' - ' || BN.TENBENHNHAN || ' - '  || 'Số TN: ' || TN.SOTIEPNHAN  as BENHNHAN,
          CASE WHEN BN.GIOITINH = 1 THEN 'Nam' WHEN BN.GIOITINH = 2 THEN 'Nữ' END  AS GIOITINH,
          CASE WHEN BN.NGAYSINH IS NOT NULL THEN TO_CHAR(BN.NGAYSINH,'DD/MM/YYYY') ELSE TO_CHAR(BN.NAMSINH) END as NGAYSINH,
          CASE WHEN dt.TENDOITUONG IS NOT NULL THEN dt.TENDOITUONG  ELSE '' END as DOITUONG,
          'Số phiếu CLS: ' ||  NVL(DV.SOPHIEUYEUCAU,'')  || ' - Ngày: ' ||  TO_CHAR(CLS_VT.NGAYTAO, 'DD/MM/YYYY HH24:Mi') || CASE WHEN NV.TENNHANVIEN IS NOT NULL THEN ' - Người lập: ' ||  NV.TENNHANVIEN ELSE '' END
          AS YLENH,
          CLS_VT.CLSKETQUA_VTYT_ID as TOATHUOC_ID,
          DV.DVYEUCAU_ID as REF_ID,
          PL.MACHUNGTU,
          CLS_VT.DUOC_ID,
          CLS_VT.SOLUONG as SOLUONGYEUCAU,
          CLS_VT.NGAYTAO
          FROM
          TT_CLSKETQUA_VTYT CLS_VT
          inner join TT_DVYEUCAU DV on DV.DVYEUCAU_ID = CLS_VT.DVYEUCAU_ID
          left join TT_CLSKETQUA CLS on CLS.CLSKETQUA_ID = CLS_VT.CLSKETQUA_ID
          left join TT_BENHNHAN BN on DV.BENHNHAN_ID = BN.BENHNHAN_ID
          left join TT_TIEPNHAN TN on TN.TIEPNHAN_ID = DV.TIEPNHAN_ID
          left join TM_PHONGBAN pb on pb.PHONGBAN_ID = CLS_VT.PHONGBAN_ID
          left join TM_DOITUONG dt on dt.DOITUONG_ID = DV.DOITUONG_ID
          left join TM_NHANVIEN NV on NV.NHANVIEN_ID = CLS_VT.NGUOITAO_ID
          left join TM_DUOC D on D.DUOC_ID = CLS_VT.DUOC_ID
          left join TM_LOAIDUOC LD on LD.LOAIDUOC_ID = D.LOAIDUOC_ID
          left join TT_DUOC_PHIEULINH PL on PL.CHUNGTU_ID = CLS_VT.CHUNGTU_ID
          WHERE          
          trunc(CLS_VT.NGAYTAO) BETWEEN  trunc(#TONGHOP_TUNGAY#) and  trunc(#TONGHOP_DENNGAY#)
          AND CLS_VT.CHUNGTU_ID is null
          <!--AND CLS_VT.KHOTAO_ID = '$KHOTAO_ID$'-->
            AND CLS_VT.PHONGBAN_ID = '$NOILAP_ID$'
            AND CLS_VT.BENHVIEN_ID = '$BENHVIEN_ID$'
            AND (BN.TENBENHNHAN like '%$TUKHOA$%' OR BN.MAYTE like '%$TUKHOA$%' OR  TN.SOTIEPNHAN  like '%$TUKHOA$%' or D.TENDUOCDAYDU like '%$TUKHOA$%'
            OR PL.MACHUNGTU like '%$TUKHOA$%'
            )
            AND LD.LOAIVATTU_ID = '$LOAIVATTU_ID$'
            order by NGAYTAO DESC
        </statement>
        <!--Revision:0-->
        <statement id="DAO00030_XUATSUDUNG_TONGHOPTUTUYLENH" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
            select
            TT.DUOC_ID,
            TT.TOATHUOC_ID,
            KB.KHAMBENH_ID as MASTER_ID,
            pb.TENPHONGBAN || ' - ' || BN.MAYTE || ' - ' || BN.TENBENHNHAN || ' - '
            || CASE WHEN BN.NGAYSINH IS NOT NULL THEN ' - ' || TO_CHAR(BN.NGAYSINH,'DD/MM/YYYY') ELSE ' - ' || TO_CHAR(BN.NAMSINH) END
            || CASE WHEN dt.TENDOITUONG IS NOT NULL THEN ' - ' || dt.TENDOITUONG  ELSE '' END
            as BENHNHAN,
            dt.MADOITUONG,
            TT.SOLUONG as SOLUONGYEUCAU,
            trt.SOLUONG as SOLUONGTRA,
            'NOITRU' as TOATHUOC,
            TT.NGAYCAPNHAT as REF_NGAYCAPNHAT
            from
            TT_NOITRU_TOATHUOC TT
            inner join TT_BENHNHAN BN on TT.BENHNHAN_ID = BN.BENHNHAN_ID
            inner join TT_NOITRU_KHAMBENH KB on KB.KHAMBENH_ID = TT.KHAMBENH_ID
            inner join TT_NOITRU_BENHAN BA on TT.TIEPNHAN_ID = BA.TIEPNHAN_ID
            left join TT_NOITRU_TRATHUOC_CHITIET trt on (trt.TOATHUOC_ID = TT.TOATHUOC_ID)
            left join TM_DOITUONG dt on BA.DOITUONG_ID = dt.DOITUONG_ID
            left join TM_PHONGBAN pb on (pb.PHONGBAN_ID = NVL(ba.KHOAVAO_ID,ba.KHOACHUYENDEN_ID))
            where
            tt.TOATHUOC_ID IN ($LIST_TOATHUOC_ID$)
            and tt.BENHVIEN_ID = '$BENHVIEN_ID$'
            and tt.SOTHUTUTOA IN ($LIST_REF_ID$)
            and 1 IN ($LIST_LOAIDUOC$)
            <!--GROUP BY tt.DUOC_ID, tt.TOATHUOC_ID, pb.TENPHONGBAN, BN.MAYTE, BN.TENBENHNHAN, BN.NGAYSINH, dt.TENDOITUONG, TT.NGAYCAPNHAT,dt.MADOITUONG, KB.KHAMBENH_ID-->
            UNION
            SELECT
            DUOC_ID,
            KHAMBENH_VTYT_ID AS TOATHUOC_ID,
            DV.DVYEUCAU_ID as MASTER_ID,
            pb.TENPHONGBAN || ' - ' || BN.MAYTE || ' - ' || BN.TENBENHNHAN || ' - '
            || CASE WHEN BN.NGAYSINH IS NOT NULL THEN ' - ' || TO_CHAR(BN.NGAYSINH,'DD/MM/YYYY') ELSE ' - ' || TO_CHAR(BN.NAMSINH) END
            || CASE WHEN dt.TENDOITUONG IS NOT NULL THEN ' - ' || dt.TENDOITUONG  ELSE '' END
            as BENHNHAN,
            dt.MADOITUONG,
            vt.SOLUONG as SOLUONGYEUCAU,
            0 as SOLUONGTRA,
            'NGOAITRU' as TOATHUOC,
            VT.NGAYCAPNHAT as REF_NGAYCAPNHAT
            FROM
            TT_NGOAITRU_KHAMBENH_VTYT vt
            inner join TT_DVYEUCAU DV on DV.DVYEUCAU_ID = vt.DVYEUCAU_ID
            left join TT_NGOAITRU_KHAMBENH kb on kb.KHAMBENH_ID = vt.KHAMBENH_ID
            left join TT_BENHNHAN BN on bn.BENHNHAN_ID = kb.BENHNHAN_ID
            left join TM_DOITUONG dt on kb.DOITUONG_ID = dt.DOITUONG_ID
            left join TM_PHONGBAN pb on vt.PHONGBAN_ID = pb.PHONGBAN_ID
            WHERE
            KHAMBENH_VTYT_ID IN ($LIST_TOATHUOC_ID$)
            and vt.DVYEUCAU_ID IN ($LIST_REF_ID$)
            and 2 IN ($LIST_LOAIDUOC$)
            and vt.BENHVIEN_ID = '$BENHVIEN_ID$'
            <!--GROUP BY DUOC_ID, KHAMBENH_VTYT_ID, pb.TENPHONGBAN, BN.MAYTE, BN.TENBENHNHAN, BN.NGAYSINH, dt.TENDOITUONG, VT.NGAYCAPNHAT, dt.MADOITUONG, DV.DVYEUCAU_ID-->
            UNION
            SELECT
            DUOC_ID,
            PHAUTHUAT_VTYT_ID AS TOATHUOC_ID,
            pt.PHAUTHUAT_ID as MASTER_ID,
            pb.TENPHONGBAN || ' - ' || BN.MAYTE || ' - ' || BN.TENBENHNHAN
            || CASE WHEN BN.NGAYSINH IS NOT NULL THEN ' - ' || TO_CHAR(BN.NGAYSINH,'DD/MM/YYYY') ELSE ' - ' || TO_CHAR(BN.NAMSINH) END
            || CASE WHEN dt.TENDOITUONG IS NOT NULL THEN ' - ' || dt.TENDOITUONG  ELSE '' END
            as BENHNHAN,
            dt.MADOITUONG,
            SOLUONG as SOLUONGYEUCAU,
            0 as SOLUONGTRA,
            'THUTHUAT' as TOATHUOC,
            VT.NGAYCAPNHAT AS REF_NGAYCAPNHAT
            FROM
            TT_PHAUTHUAT_VTYT vt
            inner join TT_PHAUTHUAT pt on pt.PHAUTHUAT_ID = vt.PHAUTHUAT_ID
            inner join TT_TIEPNHAN tn on tn.TIEPNHAN_ID = pt.TIEPNHAN_ID
            inner join TT_BENHNHAN bn on bn.BENHNHAN_ID = tn.BENHNHAN_ID
            left join TM_DOITUONG dt on dt.DOITUONG_ID = tn.DOITUONG_ID
            left join TM_PHONGBAN pb on pb.PHONGBAN_ID = pt.PHONGBANTHUCHIEN_ID
            WHERE
            PHAUTHUAT_VTYT_ID IN ($LIST_TOATHUOC_ID$)
            and pt.PHAUTHUAT_ID IN ($LIST_REF_ID$)
            and 3 IN ($LIST_LOAIDUOC$)
            and vt.BENHVIEN_ID = '$BENHVIEN_ID$'
            <!--GROUP BY DUOC_ID, PHAUTHUAT_VTYT_ID, pb.TENPHONGBAN, BN.MAYTE, BN.TENBENHNHAN, BN.NGAYSINH, dt.TENDOITUONG, VT.NGAYCAPNHAT, dt.MADOITUONG, pt.PHAUTHUAT_ID-->
            UNION
            SELECT
            DUOC_ID,
            CLSKETQUA_VTYT_ID AS TOATHUOC_ID,
            DV.DVYEUCAU_ID as MASTER_ID,
            pb.TENPHONGBAN || ' - ' || BN.MAYTE || ' - ' || BN.TENBENHNHAN
            || CASE WHEN BN.NGAYSINH IS NOT NULL THEN ' - ' || TO_CHAR(BN.NGAYSINH,'DD/MM/YYYY') ELSE ' - ' || TO_CHAR(BN.NAMSINH) END
            || CASE WHEN dt.TENDOITUONG IS NOT NULL THEN ' - ' || dt.TENDOITUONG  ELSE '' END
            as BENHNHAN,
            dt.MADOITUONG,
            SOLUONG as SOLUONGYEUCAU,
            0 as SOLUONGTRA,
            'CLS' as TOATHUOC,
            CLS.NGAYCAPNHAT as REF_NGAYCAPNHAT
            FROM
            TT_CLSKETQUA_VTYT cls
            left join TT_DVYEUCAU DV on DV.DVYEUCAU_ID = CLS.DVYEUCAU_ID
            left join TT_BENHNHAN BN on DV.BENHNHAN_ID = BN.BENHNHAN_ID
            left join TT_TIEPNHAN TN on TN.TIEPNHAN_ID = DV.TIEPNHAN_ID
            left join TM_PHONGBAN pb on pb.PHONGBAN_ID = cls.PHONGBAN_ID
            left join TM_DOITUONG dt on dt.DOITUONG_ID = DV.DOITUONG_ID
            WHERE
            cls.CLSKETQUA_VTYT_ID IN ($LIST_TOATHUOC_ID$)
            <!--and DV.DVYEUCAU_ID IN ($LIST_REF_ID$)-->
            and 4 IN ($LIST_LOAIDUOC$)
            and cls.BENHVIEN_ID = '$BENHVIEN_ID$'
            <!--GROUP BY DUOC_ID, CLSKETQUA_VTYT_ID, pb.TENPHONGBAN, BN.MAYTE, BN.TENBENHNHAN, BN.NGAYSINH, dt.TENDOITUONG, CLS.NGAYCAPNHAT, dt.MADOITUONG, DV.DVYEUCAU_ID-->
        </statement>
        <!--Revision:0-->
        <statement id="DAO00030_HOANTRANOIBO_TONGHOPYLENH_NGUNGSUDUNG" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
          SELECT
          pb.TENPHONGBAN || ' - ' || BN.MAYTE || ' - ' || BN.TENBENHNHAN
          || CASE WHEN BN.GIOITINH = 1 THEN ' - Nam' WHEN BN.GIOITINH = 2 THEN ' - Nữ' END
          || CASE WHEN BN.NGAYSINH IS NOT NULL THEN ' - ' || TO_CHAR(BN.NGAYSINH,'DD/MM/YYYY') ELSE ' - ' || TO_CHAR(BN.NAMSINH) END
          || CASE WHEN BA.SOBENHAN IS NOT NULL THEN ' - Mã bệnh án: ' || BA.SOBENHAN  ELSE ' - Số tiếp nhận: ' || TN.SOTIEPNHAN END
          || CASE WHEN dt.TENDOITUONG IS NOT NULL THEN ' - ' || dt.TENDOITUONG  ELSE '' END
          as BENHNHAN,
          'Y lệnh ngày: ' || TO_CHAR(TRCT.NGAYTAO, 'DD/MM/YYYY HH24:Mi')
          || CASE WHEN NV.TENNHANVIEN IS NOT NULL THEN ' - Người lập: ' ||  NV.TENNHANVIEN ELSE '' END
          AS YLENH,
          TT.TOATHUOC_ID,
          TT.SOTHUTUTOA as REF_ID,
          PL.MACHUNGTU,
          TRCT.DUOC_ID,
          D.MADUOC, TO_CHAR(D.TENDUOCDAYDU) TENDUOCDAYDU , D.DONVITINH,
          TRCT.SOLUONG as SOLUONGYEUCAU,
          TT.KHOPHAT_ID,
          TT.NGAYTAO
          FROM
          TT_NOITRU_TOATHUOC TT
          inner join TT_NOITRU_TRATHUOC_CHITIET TRCT on TRCT.TOATHUOC_ID = TT.TOATHUOC_ID
          inner join TT_NOITRU_TRATHUOC TR on TR.TRATHUOC_ID = TRCT.TRATHUOC_ID
          inner join TT_BENHNHAN BN on TT.BENHNHAN_ID = BN.BENHNHAN_ID
          inner join TT_NOITRU_KHAMBENH KB on KB.KHAMBENH_ID = TT.KHAMBENH_ID
          inner join TT_NOITRU_BENHAN BA on TT.TIEPNHAN_ID = BA.TIEPNHAN_ID
          left join TT_TIEPNHAN TN on TN.TIEPNHAN_ID = BA.TIEPNHAN_ID
          left join TM_NHANVIEN NV on TR.NGUOITAO_ID = NV.NHANVIEN_ID
          left join TM_DOITUONG dt on BA.DOITUONG_ID = dt.DOITUONG_ID
          inner join TM_PHONGBAN pb on pb.PHONGBAN_ID = NVL(ba.KHOAVAO_ID,ba.KHOACHUYENDEN_ID)
          inner join TM_DUOC D on D.DUOC_ID = TT.DUOC_ID
          inner join TM_LOAIDUOC LD on LD.LOAIDUOC_ID = D.LOAIDUOC_ID
          left join TT_DUOC_PHIEULINH PL on PL.CHUNGTU_ID = TT.PHIEULINH_ID
          WHERE          
          trunc(TR.NGAYTAO) BETWEEN  trunc(#TONGHOP_TUNGAY#) and  trunc(#TONGHOP_DENNGAY#)
          AND TRCT.DAHOANTRA = 0
          AND TT.KHOPHAT_ID = '$KHOXUAT_ID$'
          AND TT.PHONGBANRATOA_ID = '$PHONGBANRATOA_ID$'
          AND TT.BENHVIEN_ID = '$BENHVIEN_ID$'
          AND (BN.TENBENHNHAN like '%$TUKHOA$%' OR BN.MAYTE like '%$TUKHOA$%'  OR  BA.SOBENHAN  like '%$TUKHOA$%'
          or D.TENDUOCDAYDU like '%$TUKHOA$%'
          OR PL.MACHUNGTU like '%$TUKHOA$%')
          AND LD.LOAIVATTU_ID = '$LOAIVATTU_ID$'
          order by NGAYTAO DESC
        </statement>
        <!--Revision:0-->
        <statement id="DAO00030_HOANTRANOIBO_LAYTUYLENH_NGUNGSUDUNG" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
          select
          TRCT.DUOC_ID,
          TRCT.TOATHUOC_ID,
          pb.TENPHONGBAN || ' - ' || BN.MAYTE || ' - ' || BN.TENBENHNHAN
          || CASE WHEN BN.NGAYSINH IS NOT NULL THEN ' - ' || TO_CHAR(BN.NGAYSINH,'DD/MM/YYYY') ELSE ' - ' || TO_CHAR(BN.NAMSINH) END
          || CASE WHEN dt.TENDOITUONG IS NOT NULL THEN ' - ' || dt.TENDOITUONG  ELSE '' END
          as BENHNHAN,
          'NOITRU' as TOATHUOC,
          SUM(TRCT.SOLUONG) as SOLUONGTRA,
          TRCT.NGAYCAPNHAT as REF_NGAYCAPNHAT
          from
          TT_NOITRU_TOATHUOC tt
          inner join TT_NOITRU_TRATHUOC_CHITIET TRCT on TRCT.TOATHUOC_ID = TT.TOATHUOC_ID
          inner join TT_NOITRU_TRATHUOC TR on TR.TRATHUOC_ID = TRCT.TRATHUOC_ID
          inner join TT_BENHNHAN BN on TT.BENHNHAN_ID = BN.BENHNHAN_ID
          inner join TT_NOITRU_KHAMBENH KB on KB.KHAMBENH_ID = TT.KHAMBENH_ID
          inner join TT_NOITRU_BENHAN BA on TT.TIEPNHAN_ID = BA.TIEPNHAN_ID
          inner join TM_DOITUONG dt on BA.DOITUONG_ID = dt.DOITUONG_ID
          inner join TM_PHONGBAN pb on pb.PHONGBAN_ID = NVL(ba.KHOAVAO_ID,ba.KHOACHUYENDEN_ID)
          where
          TRCT.TOATHUOC_ID IN ($LIST_TOATHUOC_ID$)
          and TRCT.DAHOANTRA = 0
          and TRCT.BENHVIEN_ID = '$BENHVIEN_ID$'
          and tt.SOTHUTUTOA IN ($LIST_REF_ID$)
          GROUP BY TRCT.DUOC_ID,  TRCT.TOATHUOC_ID, pb.TENPHONGBAN, BN.MAYTE, BN.TENBENHNHAN, BN.NGAYSINH, BN.NAMSINH, dt.TENDOITUONG, TRCT.NGAYCAPNHAT
          ORDER BY TRCT.TOATHUOC_ID
        </statement>
        <!--Revision:0-->
        <statement id="DAO00030_HOANTRANOIBO_LAYTUYLENH_NGUNGSUDUNG_NGAYCAPNHAT" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
          select
          TRCT.NGAYCAPNHAT
          from
          TT_NOITRU_TRATHUOC_CHITIET TRCT
          inner join TT_NOITRU_TRATHUOC TR on TR.TRATHUOC_ID = TRCT.TRATHUOC_ID
          where
          TRCT.TOATHUOC_ID IN ($LIST_REF_ID$)
          ORDER BY TRCT.TOATHUOC_ID
        </statement>
        <!--Revision:0-->
        <update id="DAO00030_SetChungTuToaThuocNoiTru" parameterClass="System.Collections.IDictionary">
            BEGIN
            
            update TT_NOITRU_TOATHUOC set
            CHUNGTU_ID = #CHUNGTU_ID#,
            NGAYCAPNHAT = SYSTIMESTAMP
            where
            TOATHUOC_ID IN ($YLENH$);
            
            update TT_VIENPHI set
            DUYET = '1',
            DATHUCHIEN = '1'
            where
            REF_TABLE = 'TT_NOITRU_TOATHUOC'
            AND REF_ID  IN ($YLENH$);
            
            END;
        </update>
        <!--Revision:0-->
        <update id="DAO00030_RemoveChungTuToaThuocNoiTru" parameterClass="System.Collections.IDictionary">
            BEGIN
            
            update TT_NOITRU_TOATHUOC set
            CHUNGTU_ID = null,
            NGAYCAPNHAT = SYSTIMESTAMP
            where
            TOATHUOC_ID  IN ($YLENH$);
            
            update TT_VIENPHI set
            DUYET = '0',
            DATHUCHIEN = '0',
            NGAYCAPNHAT = SYSTIMESTAMP
            where
            REF_TABLE = 'TT_NOITRU_TOATHUOC'
            AND REF_ID IN ($YLENH$);
            END;
        </update>
        <!--Revision:0-->
        <update id="DAO00030_SetChungTuVTYTThuThuat" parameterClass="System.Collections.IDictionary">
            BEGIN
            update TT_PHAUTHUAT_VTYT set
            CHUNGTU_ID = #CHUNGTU_ID#
            where
            PHAUTHUAT_VTYT_ID IN ($YLENH$);
            
            update TT_VIENPHI
            SET
            DUYET = '1',
            DATHUCHIEN = '1'
            WHERE REF_TABLE = 'TT_PHAUTHUAT_VTYT'
            AND REF_ID IN ($YLENH$);
            
            END;
        </update>
        <!--Revision:0-->
        <update id="DAO00030_SetChungTuVTYTCLS" parameterClass="System.Collections.IDictionary">
            BEGIN
            update TT_CLSKETQUA_VTYT set
            CHUNGTU_ID = #CHUNGTU_ID#
            where
            CLSKETQUA_VTYT_ID IN ($YLENH$);
            
            update TT_VIENPHI
            SET
            DUYET = '1',
            DATHUCHIEN = '1'
            WHERE REF_TABLE = 'TT_CLSKETQUA_VTYT'
            AND REF_ID IN ($YLENH$);
            END;
        </update>
        <!--Revision:0-->
        <update id="DAO00030_RemoveChungTuVTYTThuThuat" parameterClass="System.Collections.IDictionary">
            BEGIN
            update TT_PHAUTHUAT_VTYT set
            CHUNGTU_ID = null
            where
            PHAUTHUAT_VTYT_ID IN ($YLENH$);
            
            
            update TT_VIENPHI
            SET
            DUYET = '0',
            DATHUCHIEN = '0'
            WHERE REF_TABLE = 'TT_PHAUTHUAT_VTYT'
            AND REF_ID IN ($YLENH$);
            END;
        </update>
        <!--Revision:0-->
        <update id="DAO00030_RemoveChungTuVTYTCLS" parameterClass="System.Collections.IDictionary">
            BEGIN
            
            update TT_CLSKETQUA_VTYT set
            CHUNGTU_ID = null
            where
            CLSKETQUA_VTYT_ID IN ($YLENH$);
            
            update TT_VIENPHI
            SET
            DUYET = '0',
            DATHUCHIEN = '0'
            WHERE REF_TABLE = 'TT_CLSKETQUA_VTYT'
            AND REF_ID IN ($YLENH$);
            
            END;
        </update>
        <!--Revision:0-->
        <update id="DAO00030_SetChungTuVTYTNgoaiTru" parameterClass="System.Collections.IDictionary">
            BEGIN
            
            update TT_NGOAITRU_KHAMBENH_VTYT set
            CHUNGTU_ID = #CHUNGTU_ID#,
            NGAYCAPNHAT = SYSTIMESTAMP
            where
            KHAMBENH_VTYT_ID IN ($YLENH$);
            
            update TT_VIENPHI set
            DUYET = '1',
            DATHUCHIEN = '1'
            where
            REF_TABLE = 'TT_NGOAITRU_KHAMBENH_VTYT'
            AND REF_ID IN ($YLENH$);
            
            END;
        </update>
        <!--Revision:0-->
        <update id="DAO00030_RemoveChungTuVTYTNgoaiTru" parameterClass="System.Collections.IDictionary">
            BEGIN
            update TT_NGOAITRU_KHAMBENH_VTYT set
            CHUNGTU_ID = null
            where
            KHAMBENH_VTYT_ID IN ($YLENH$);
            
            update TT_VIENPHI set
            DUYET = '0',
            DATHUCHIEN = '0'
            where
            REF_TABLE = 'TT_NGOAITRU_KHAMBENH_VTYT'
            AND REF_ID IN ($YLENH$);
            
            END;
        </update>
        <!--Revision:0-->
        <statement id="DAO00030_GetTrangThaiRaVien" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
            SELECT
            ba.TRANGTHAI
            FROM
            TT_NOITRU_BENHAN BA
            inner join TT_NOITRU_TOATHUOC TT on BA.TIEPNHAN_ID = TT.TIEPNHAN_ID
            WHERE
            TT.CHUNGTU_ID = #CHUNGTU_ID#
            and BA.BENHVIEN_ID = '$BENHVIEN_ID$'
            and BA.TRANGTHAI = 'DAXUATVIE'
            union all
            SELECT
            BA.TRANGTHAI
            FROM
            TT_NOITRU_BENHAN BA
            inner join TT_PHAUTHUAT PT on PT.BENHAN_ID = BA.BENHAN_ID
            inner join TT_PHAUTHUAT_VTYT VT on VT.PHAUTHUAT_ID = PT.PHAUTHUAT_ID
            WHERE
            VT.CHUNGTU_ID = #CHUNGTU_ID#
            and BA.BENHVIEN_ID = '$BENHVIEN_ID$'
            and BA.TRANGTHAI = 'DAXUATVIE'
            union all
            SELECT
            ba.TRANGTHAI
            FROM
            TT_NOITRU_BENHAN BA
            inner join TT_DVYEUCAU dv on dv.BENHAN_ID = ba.BENHAN_ID
            inner join TT_CLSKETQUA_VTYT VT on VT.DVYEUCAU_ID = dv.DVYEUCAU_ID
            WHERE
            VT.CHUNGTU_ID = #CHUNGTU_ID#
            and BA.BENHVIEN_ID = '$BENHVIEN_ID$'
            and BA.TRANGTHAI = 'DAXUATVIE'
        </statement>
        <!--Revision:0-->
        <update id="DAO00030_UpdateTrangThaiYLenhTamNgung" parameterClass="System.Collections.IDictionary">
            update TT_NOITRU_TRATHUOC_CHITIET
            set
            DAHOANTRA = #DAHOANTRA#,
            CHUNGTUTRA_ID = #CHUNGTUTRA_ID#,
            NGUOICAPNHAT_ID = #NGUOICAPNHAT_ID#
            where
            TOATHUOC_ID =  #TOATHUOC_ID#
            AND BENHVIEN_ID = '$BENHVIEN_ID$'
        </update>
        <!--Revision:0-->
        <statement id="DAO00030_DUOCPHIEULINHCT_GetAll" resultClass="DataObject">
            select *
            from TT_DUOC_PHIEULINH_CHITIET
            where BENHVIEN_ID = '$BENHVIEN_ID$'
            order by CHUNGTUCHITIET_ID
        </statement>
        <!--Revision:0-->
        <statement id="DAO00030_DUOCPHIEULINHCT_GetList" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
            select TT_DUOC_PHIEULINH_CHITIET.*, NLD.TENNHOMLOAIDUOC
            from TT_DUOC_PHIEULINH_CHITIET
            left join TM_DUOC D on D.DUOC_ID = TT_DUOC_PHIEULINH_CHITIET.DUOC_ID
            left join TM_LOAIDUOC LD on LD.LOAIDUOC_ID = D.LOAIDUOC_ID
            left join TM_NHOMLOAIDUOC NLD on NLD.NHOMLOAIDUOC_ID = LD.NHOMLOAIDUOC_ID
            <dynamic prepend="where">
                <isParameterPresent>
                    <isNotEmpty prepend="and" property="CHUNGTUCHITIET_ID">
                        TT_DUOC_PHIEULINH_CHITIET.CHUNGTUCHITIET_ID = '$CHUNGTUCHITIET_ID$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="CHUNGTU_ID">
                        TT_DUOC_PHIEULINH_CHITIET.CHUNGTU_ID = '$CHUNGTU_ID$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="DUOC_ID">
                        TT_DUOC_PHIEULINH_CHITIET.DUOC_ID = '$DUOC_ID$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="TOATHUOCNOITRU_ID">
                        TT_DUOC_PHIEULINH_CHITIET.TOATHUOCNOITRU_ID = '$TOATHUOCNOITRU_ID$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="SOLONHAP_ID">
                        TT_DUOC_PHIEULINH_CHITIET.SOLONHAP_ID = '$SOLONHAP_ID$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="SOKIEMSOAT">
                        TT_DUOC_PHIEULINH_CHITIET.SOKIEMSOAT = '$SOKIEMSOAT$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="SOVISA">
                        TT_DUOC_PHIEULINH_CHITIET.SOVISA = '$SOVISA$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="DONVITINH_ID">
                        TT_DUOC_PHIEULINH_CHITIET.DONVITINH_ID = '$DONVITINH_ID$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="SOLUONGYEUCAU">
                        TT_DUOC_PHIEULINH_CHITIET.SOLUONGYEUCAU = '$SOLUONGYEUCAU$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="SOLUONGTHUCTE">
                        TT_DUOC_PHIEULINH_CHITIET.SOLUONGTHUCTE = '$SOLUONGTHUCTE$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="SOLUONGDAXUAT">
                        TT_DUOC_PHIEULINH_CHITIET.SOLUONGDAXUAT = '$SOLUONGDAXUAT$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="TIENTE_ID">
                        TT_DUOC_PHIEULINH_CHITIET.TIENTE_ID = '$TIENTE_ID$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="TYGIA">
                        TT_DUOC_PHIEULINH_CHITIET.TYGIA = '$TYGIA$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="DONGIAMUA">
                        TT_DUOC_PHIEULINH_CHITIET.DONGIAMUA = '$DONGIAMUA$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="DONGIABAN">
                        TT_DUOC_PHIEULINH_CHITIET.DONGIABAN = '$DONGIABAN$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="DONGIAVON">
                        TT_DUOC_PHIEULINH_CHITIET.DONGIAVON = '$DONGIAVON$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="SOQUYEN">
                        TT_DUOC_PHIEULINH_CHITIET.SOQUYEN = '$SOQUYEN$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="SOHOADONVAT">
                        TT_DUOC_PHIEULINH_CHITIET.SOHOADONVAT = '$SOHOADONVAT$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="TYLEVAT">
                        TT_DUOC_PHIEULINH_CHITIET.TYLEVAT = '$TYLEVAT$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="GIATRIVAT">
                        TT_DUOC_PHIEULINH_CHITIET.GIATRIVAT = '$GIATRIVAT$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="MIENPHI">
                        TT_DUOC_PHIEULINH_CHITIET.MIENPHI = '$MIENPHI$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="LYDOMIENPHI_ID">
                        TT_DUOC_PHIEULINH_CHITIET.LYDOMIENPHI_ID = '$LYDOMIENPHI_ID$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="SOCHUNGTUKETOAN">
                        TT_DUOC_PHIEULINH_CHITIET.SOCHUNGTUKETOAN = '$SOCHUNGTUKETOAN$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="SOCHUNGTUTIENMAT">
                        TT_DUOC_PHIEULINH_CHITIET.SOCHUNGTUTIENMAT = '$SOCHUNGTUTIENMAT$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="TRANGTHAI">
                        TT_DUOC_PHIEULINH_CHITIET.TRANGTHAI = '$TRANGTHAI$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="DAPHATSINHPHIEUXUAT">
                        TT_DUOC_PHIEULINH_CHITIET.DAPHATSINHPHIEUXUAT = '$DAPHATSINHPHIEUXUAT$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="DAPHATSINHPHIEUHOANTRA">
                        TT_DUOC_PHIEULINH_CHITIET.DAPHATSINHPHIEUHOANTRA = '$DAPHATSINHPHIEUHOANTRA$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="NGUONHANG_ID">
                        TT_DUOC_PHIEULINH_CHITIET.NGUONHANG_ID = '$NGUONHANG_ID$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="CHUNGTUHOANTRA_LE_ID">
                        TT_DUOC_PHIEULINH_CHITIET.CHUNGTUHOANTRA_LE_ID = '$CHUNGTUHOANTRA_LE_ID$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="SOLUONGTHUCNHAN">
                        TT_DUOC_PHIEULINH_CHITIET.SOLUONGTHUCNHAN = '$SOLUONGTHUCNHAN$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="SOLUONGTONGHOPTHUCTE">
                        TT_DUOC_PHIEULINH_CHITIET.SOLUONGTONGHOPTHUCTE = '$SOLUONGTONGHOPTHUCTE$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="BENHVIEN_ID">
                        TT_DUOC_PHIEULINH_CHITIET.BENHVIEN_ID = '$BENHVIEN_ID$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="NGAYTAO">
                        TT_DUOC_PHIEULINH_CHITIET.NGAYTAO = '$NGAYTAO$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="NGUOITAO_ID">
                        TT_DUOC_PHIEULINH_CHITIET.NGUOITAO_ID = '$NGUOITAO_ID$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="NGAYCAPNHAT">
                        TT_DUOC_PHIEULINH_CHITIET.NGAYCAPNHAT = '$NGAYCAPNHAT$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="NGUOICAPNHAT_ID">
                        TT_DUOC_PHIEULINH_CHITIET.NGUOICAPNHAT_ID = '$NGUOICAPNHAT_ID$'
                    </isNotEmpty>
                </isParameterPresent>
            </dynamic>
            order by CHUNGTUCHITIET_ID
        </statement>
        <!--Revision:0-->
        <statement id="DAO00030_DUOCPHIEULINHCT_GetDetail" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
            select *
            from TT_DUOC_PHIEULINH_CHITIET
            where CHUNGTUCHITIET_ID  = '$value$'
            and BENHVIEN_ID = '$BENHVIEN_ID$'
            order by CHUNGTUCHITIET_ID
        </statement>
        <!--Revision:0-->
        <statement id="DAO00030_DUOCPHIEULINHCT_GetDetailP" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
            select *
            from TT_DUOC_PHIEULINH_CHITIET
            where TT_DUOC_PHIEULINH_CHITIET.CHUNGTUCHITIET_ID  = '$CHUNGTUCHITIET_ID$'
            and BENHVIEN_ID = '$BENHVIEN_ID$'
            order by CHUNGTUCHITIET_ID
        </statement>
        <!--Revision:0-->
        <insert id="DAO00030_DUOCPHIEULINHCT_Add" parameterClass="System.Collections.IDictionary" resultClass="System.Int64">
            <selectKey property="CHUNGTUCHITIET_ID" type="pre" resultClass="System.Int64">
                select TT_DUOC_PHIEULINH_CHITIET_S.nextval as value from dual
            </selectKey>
            insert into TT_DUOC_PHIEULINH_CHITIET (
            CHUNGTUCHITIET_ID
            , CHUNGTU_ID
            , DUOC_ID
            , SOLONHAP_ID
            , SOKIEMSOAT
            , SOVISA
            , DONVITINH_ID
            , SOLUONGYEUCAU
            , SOLUONGTHUCTE
            , SOLUONGDAXUAT
            , TIENTE_ID
            , TYGIA
            , DONGIAMUA
            , DONGIABAN
            , DONGIAVON
            , SOQUYEN
            , SOHOADONVAT
            , TYLEVAT
            , GIATRIVAT
            , MIENPHI
            , LYDOMIENPHI_ID
            , SOCHUNGTUKETOAN
            , SOCHUNGTUTIENMAT
            , TRANGTHAI
            , DAPHATSINHPHIEUXUAT
            , DAPHATSINHPHIEUHOANTRA
            , NGUONHANG_ID
            , REF_TABLE
            , TOATHUOCNOITRU_ID
            , BENHNHAN
            , YLENH
            , CHUNGTUHOANTRA_LE_ID
            , SOLUONGTHUCNHAN
            , SOLUONGTONGHOPTHUCTE
            , BENHVIEN_ID
            , NGAYTAO
            , NGUOITAO_ID
            , NGAYCAPNHAT
            , NGUOICAPNHAT_ID
            ) values (
            #CHUNGTUCHITIET_ID#
            , #CHUNGTU_ID#
            , #DUOC_ID#
            , #SOLONHAP_ID#
            , #SOKIEMSOAT#
            , #SOVISA#
            , #DONVITINH_ID#
            , #SOLUONGYEUCAU#
            , #SOLUONGTHUCTE#
            , #SOLUONGDAXUAT#
            , #TIENTE_ID#
            , #TYGIA#
            , #DONGIAMUA#
            , #DONGIABAN#
            , #DONGIAVON#
            , #SOQUYEN#
            , #SOHOADONVAT#
            , #TYLEVAT#
            , #GIATRIVAT#
            , #MIENPHI#
            , #LYDOMIENPHI_ID#
            , #SOCHUNGTUKETOAN#
            , #SOCHUNGTUTIENMAT#
            , #TRANGTHAI#
            , #DAPHATSINHPHIEUXUAT#
            , #DAPHATSINHPHIEUHOANTRA#
            , #NGUONHANG_ID#
            , #REF_TABLE#
            , #TOATHUOCNOITRU_ID#
            , #BENHNHAN#
            , #YLENH#
            , #CHUNGTUHOANTRA_LE_ID#
            , #SOLUONGTHUCNHAN#
            , #SOLUONGTONGHOPTHUCTE#
            , #BENHVIEN_ID#
            , #NGAYTAO#
            , #NGUOITAO_ID#
            , #NGAYCAPNHAT#
            , #NGUOICAPNHAT_ID#
            )
        </insert>
        <!--Revision:0-->
        <update id="DAO00030_DUOCPHIEULINHCT_Update" parameterClass="System.Collections.IDictionary">
            update TT_DUOC_PHIEULINH_CHITIET set
            CHUNGTU_ID = #CHUNGTU_ID#
            , DUOC_ID = #DUOC_ID#
            , SOLONHAP_ID = #SOLONHAP_ID#
            , SOKIEMSOAT = #SOKIEMSOAT#
            , SOVISA = #SOVISA#
            , DONVITINH_ID = #DONVITINH_ID#
            , SOLUONGYEUCAU = #SOLUONGYEUCAU#
            , SOLUONGTHUCTE = #SOLUONGTHUCTE#
            , SOLUONGDAXUAT = #SOLUONGDAXUAT#
            , TIENTE_ID = #TIENTE_ID#
            , TYGIA = #TYGIA#
            , DONGIAMUA = #DONGIAMUA#
            , DONGIABAN = #DONGIABAN#
            , DONGIAVON = #DONGIAVON#
            , SOQUYEN = #SOQUYEN#
            , SOHOADONVAT = #SOHOADONVAT#
            , TYLEVAT = #TYLEVAT#
            , GIATRIVAT = #GIATRIVAT#
            , MIENPHI = #MIENPHI#
            , LYDOMIENPHI_ID = #LYDOMIENPHI_ID#
            , SOCHUNGTUKETOAN = #SOCHUNGTUKETOAN#
            , SOCHUNGTUTIENMAT = #SOCHUNGTUTIENMAT#
            , TRANGTHAI = #TRANGTHAI#
            , DAPHATSINHPHIEUXUAT = #DAPHATSINHPHIEUXUAT#
            , DAPHATSINHPHIEUHOANTRA = #DAPHATSINHPHIEUHOANTRA#
            , NGUONHANG_ID = #NGUONHANG_ID#
            , BENHNHAN = #BENHNHAN#
            , YLENH = #YLENH#
            , CHUNGTUHOANTRA_LE_ID = #CHUNGTUHOANTRA_LE_ID#
            , SOLUONGTHUCNHAN = #SOLUONGTHUCNHAN#
            , SOLUONGTONGHOPTHUCTE = #SOLUONGTONGHOPTHUCTE#
            <!--, BENHVIEN_ID = #BENHVIEN_ID#
				, NGAYTAO = #NGAYTAO#
				, NGUOITAO_ID = #NGUOITAO_ID#-->
            , NGAYCAPNHAT = #NGAYCAPNHAT#
            , NGUOICAPNHAT_ID = #NGUOICAPNHAT_ID#
            where
            CHUNGTUCHITIET_ID = '$CHUNGTUCHITIET_ID$'
        </update>
        <!--Revision:0-->
        <update id="DAO00030_DUOCPHIEULINHCT_UpdateToaThuocNoiTru" parameterClass="System.Collections.IDictionary">
            update
            TT_NOITRU_TOATHUOC
            set
            PHIEULINH_ID = #CHUNGTU_ID#
            where
            TOATHUOC_ID = '$TOATHUOC_ID$'
        </update>
        <!--Revision:0-->
        <update id="DAO00030_DUOCPHIEULINHCT_UpdatePhauThuatVTYT" parameterClass="System.Collections.IDictionary">
            update
            TT_PHAUTHUAT_VTYT
            set
            CHUNGTUTONGHOP_ID = #CHUNGTU_ID#
            where
            PHAUTHUAT_VTYT_ID = '$TOATHUOC_ID$'
        </update>
        <!--Revision:0-->
        <update id="DAO00030_DUOCPHIEULINHCT_UpdateCLSVTYT" parameterClass="System.Collections.IDictionary">
            update
            TT_CLSKETQUA_VTYT
            set
            CHUNGTUTONGHOP_ID = #CHUNGTU_ID#
            where
            CLSKETQUA_VTYT_ID = '$TOATHUOC_ID$'
        </update>
        <!--Revision:0-->
        <update id="DAO00030_DUOCPHIEULINHCT_DeleteToaThuocNoiTru" parameterClass="System.Collections.IDictionary">
            update
            TT_NOITRU_TOATHUOC
            set
            PHIEULINH_ID = null
            where
            PHIEULINH_ID = '$CHUNGTU_ID$'
            and BENHVIEN_ID = '$BENHVIEN_ID$'
        </update>
        <!--Revision:0-->
        <update id="DAO00030_DUOCPHIEULINHCT_DeletePhauThuatVTYT" parameterClass="System.Collections.IDictionary">
            update
            TT_PHAUTHUAT_VTYT
            set
            CHUNGTUTONGHOP_ID = null
            where
            CHUNGTUTONGHOP_ID = '$CHUNGTU_ID$'
            and BENHVIEN_ID = '$BENHVIEN_ID$'
        </update>
        <!--Revision:0-->
        <update id="DAO00030_DUOCPHIEULINHCT_DeleteCLSVTYT" parameterClass="System.Collections.IDictionary">
            update
            TT_CLSKETQUA_VTYT
            set
            CHUNGTUTONGHOP_ID = null
            where
            CHUNGTUTONGHOP_ID = '$CHUNGTU_ID$'
            and BENHVIEN_ID = '$BENHVIEN_ID$'
        </update>
        <!--Revision:0-->
        <statement id="DAO00030_DUOCPHIEULINHCT_Delete" parameterClass="System.Collections.IDictionary" resultClass="System.Int32">
            delete from TT_DUOC_PHIEULINH_CHITIET
            where
            CHUNGTUCHITIET_ID = '$CHUNGTUCHITIET_ID$'
        </statement>
        <!--Revision:0-->
        <statement id="DAO00030_DUOCPHIEULINHCT_DeleteP" parameterClass="System.Collections.IDictionary" resultClass="System.Int32">
            delete from TT_DUOC_PHIEULINH_CHITIET
            <dynamic prepend="where">
                <isParameterPresent>
                    <isNotEmpty prepend="and" property="CHUNGTUCHITIET_ID">
                        TT_DUOC_PHIEULINH_CHITIET.CHUNGTUCHITIET_ID = '$CHUNGTUCHITIET_ID$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="CHUNGTU_ID">
                        TT_DUOC_PHIEULINH_CHITIET.CHUNGTU_ID = '$CHUNGTU_ID$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="DUOC_ID">
                        TT_DUOC_PHIEULINH_CHITIET.DUOC_ID = '$DUOC_ID$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="TOATHUOCNOITRU_ID">
                        TT_DUOC_PHIEULINH_CHITIET.TOATHUOCNOITRU_ID = '$TOATHUOCNOITRU_ID$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="SOLONHAP_ID">
                        TT_DUOC_PHIEULINH_CHITIET.SOLONHAP_ID = '$SOLONHAP_ID$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="SOKIEMSOAT">
                        TT_DUOC_PHIEULINH_CHITIET.SOKIEMSOAT = '$SOKIEMSOAT$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="SOVISA">
                        TT_DUOC_PHIEULINH_CHITIET.SOVISA = '$SOVISA$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="DONVITINH_ID">
                        TT_DUOC_PHIEULINH_CHITIET.DONVITINH_ID = '$DONVITINH_ID$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="SOLUONGYEUCAU">
                        TT_DUOC_PHIEULINH_CHITIET.SOLUONGYEUCAU = '$SOLUONGYEUCAU$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="SOLUONGTHUCTE">
                        TT_DUOC_PHIEULINH_CHITIET.SOLUONGTHUCTE = '$SOLUONGTHUCTE$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="SOLUONGDAXUAT">
                        TT_DUOC_PHIEULINH_CHITIET.SOLUONGDAXUAT = '$SOLUONGDAXUAT$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="TIENTE_ID">
                        TT_DUOC_PHIEULINH_CHITIET.TIENTE_ID = '$TIENTE_ID$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="TYGIA">
                        TT_DUOC_PHIEULINH_CHITIET.TYGIA = '$TYGIA$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="DONGIAMUA">
                        TT_DUOC_PHIEULINH_CHITIET.DONGIAMUA = '$DONGIAMUA$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="DONGIABAN">
                        TT_DUOC_PHIEULINH_CHITIET.DONGIABAN = '$DONGIABAN$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="DONGIAVON">
                        TT_DUOC_PHIEULINH_CHITIET.DONGIAVON = '$DONGIAVON$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="SOQUYEN">
                        TT_DUOC_PHIEULINH_CHITIET.SOQUYEN = '$SOQUYEN$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="SOHOADONVAT">
                        TT_DUOC_PHIEULINH_CHITIET.SOHOADONVAT = '$SOHOADONVAT$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="TYLEVAT">
                        TT_DUOC_PHIEULINH_CHITIET.TYLEVAT = '$TYLEVAT$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="GIATRIVAT">
                        TT_DUOC_PHIEULINH_CHITIET.GIATRIVAT = '$GIATRIVAT$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="MIENPHI">
                        TT_DUOC_PHIEULINH_CHITIET.MIENPHI = '$MIENPHI$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="LYDOMIENPHI_ID">
                        TT_DUOC_PHIEULINH_CHITIET.LYDOMIENPHI_ID = '$LYDOMIENPHI_ID$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="SOCHUNGTUKETOAN">
                        TT_DUOC_PHIEULINH_CHITIET.SOCHUNGTUKETOAN = '$SOCHUNGTUKETOAN$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="SOCHUNGTUTIENMAT">
                        TT_DUOC_PHIEULINH_CHITIET.SOCHUNGTUTIENMAT = '$SOCHUNGTUTIENMAT$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="TRANGTHAI">
                        TT_DUOC_PHIEULINH_CHITIET.TRANGTHAI = '$TRANGTHAI$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="DAPHATSINHPHIEUXUAT">
                        TT_DUOC_PHIEULINH_CHITIET.DAPHATSINHPHIEUXUAT = '$DAPHATSINHPHIEUXUAT$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="DAPHATSINHPHIEUHOANTRA">
                        TT_DUOC_PHIEULINH_CHITIET.DAPHATSINHPHIEUHOANTRA = '$DAPHATSINHPHIEUHOANTRA$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="NGUONHANG_ID">
                        TT_DUOC_PHIEULINH_CHITIET.NGUONHANG_ID = '$NGUONHANG_ID$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="CHUNGTUHOANTRA_LE_ID">
                        TT_DUOC_PHIEULINH_CHITIET.CHUNGTUHOANTRA_LE_ID = '$CHUNGTUHOANTRA_LE_ID$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="SOLUONGTHUCNHAN">
                        TT_DUOC_PHIEULINH_CHITIET.SOLUONGTHUCNHAN = '$SOLUONGTHUCNHAN$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="SOLUONGTONGHOPTHUCTE">
                        TT_DUOC_PHIEULINH_CHITIET.SOLUONGTONGHOPTHUCTE = '$SOLUONGTONGHOPTHUCTE$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="BENHVIEN_ID">
                        TT_DUOC_PHIEULINH_CHITIET.BENHVIEN_ID = '$BENHVIEN_ID$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="NGAYTAO">
                        TT_DUOC_PHIEULINH_CHITIET.NGAYTAO = '$NGAYTAO$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="NGUOITAO_ID">
                        TT_DUOC_PHIEULINH_CHITIET.NGUOITAO_ID = '$NGUOITAO_ID$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="NGAYCAPNHAT">
                        TT_DUOC_PHIEULINH_CHITIET.NGAYCAPNHAT = '$NGAYCAPNHAT$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="NGUOICAPNHAT_ID">
                        TT_DUOC_PHIEULINH_CHITIET.NGUOICAPNHAT_ID = '$NGUOICAPNHAT_ID$'
                    </isNotEmpty>
                </isParameterPresent>
            </dynamic>
        </statement>
        <!--Revision:0-->
        <statement id="DAO00030_PHIEULINHDEDUYET_GetList" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
            SELECT PL.*
            FROM
            TT_DUOC_PHIEULINH PL
            WHERE
            PL.DUYET = '$DUYET$'
            and PL.BENHVIEN_ID = '$BENHVIEN_ID$'
            and PL.MACHUNGTU LIKE '%$MACHUNGTU$%'
            <dynamic prepend="">
                <isParameterPresent>
                    <isNotEmpty prepend="and" property="KHOXUAT_ID">
                        PL.KHOXUAT_ID = '$KHOXUAT_ID$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="TONGHOP_TUNGAY">                      
                      trunc(PL.NGAYCHUNGTU) BETWEEN  trunc(#TONGHOP_TUNGAY#) and  trunc(#TONGHOP_DENNGAY#)
                    </isNotEmpty>
                </isParameterPresent>
            </dynamic>
            order by PL.NGAYCHUNGTU DESC
        </statement>
        <!--Revision:0-->
        <statement id="DAO00030_PHIEULINHDEDUYET_GetChiTietPhieuLinh" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
            SELECT
            PLCT.DUOC_ID,
            d.MADUOC,
            TO_CHAR(D.TENDUOCDAYDU) TENDUOCDAYDU ,
            d.DONVITINH,
            PLCT.SOLUONGYEUCAU,
            '' as BENHNHAN,
            '' as TENPHONGBAN
            FROM
            TT_DUOC_PHIEULINH PL
            inner join TT_DUOC_PHIEULINH_CHITIET PLCT on PL.CHUNGTU_ID = PLCT.CHUNGTU_ID
            inner join TM_DUOC D on D.DUOC_ID = PLCT.DUOC_ID
            WHERE
            PLCT.CHUNGTU_ID = '$CHUNGTU_ID$'
            and PLCT.BENHVIEN_ID = '$BENHVIEN_ID$'
            and PL.TONGHOP != '1'
            UNION ALL
            SELECT
            PLCT.DUOC_ID,
            d.MADUOC,
            TO_CHAR(D.TENDUOCDAYDU) TENDUOCDAYDU ,
            d.DONVITINH,
            PLCT.SOLUONGYEUCAU,
            PLCT.BENHNHAN,
            PB.TENPHONGBAN
            FROM
            TT_DUOC_PHIEULINH PL
            inner join TT_DUOC_PHIEULINH_CHITIET PLCT on PL.CHUNGTU_ID = PLCT.CHUNGTU_ID
            inner join TT_NOITRU_TOATHUOC TT on (TT.TOATHUOC_ID = PLCT.TOATHUOCNOITRU_ID AND PLCT.REF_TABLE = 'TT_NOITRU_TOATHUOC')
            left join TM_DUOC D on D.DUOC_ID = PLCT.DUOC_ID
            left join TM_PHONGBAN PB on PB.PHONGBAN_ID = TT.PHONGBANRATOA_ID
            WHERE
            PL.CHUNGTU_ID = '$CHUNGTU_ID$'
            and PL.BENHVIEN_ID = '$BENHVIEN_ID$'
            UNION ALL
            SELECT
            PLCT.DUOC_ID,
            d.MADUOC,
            TO_CHAR(D.TENDUOCDAYDU) TENDUOCDAYDU ,
            d.DONVITINH,
            PLCT.SOLUONGYEUCAU,
            PLCT.BENHNHAN,
            PB.TENPHONGBAN
            FROM
            TT_DUOC_PHIEULINH PL
            inner join TT_DUOC_PHIEULINH_CHITIET PLCT on PL.CHUNGTU_ID = PLCT.CHUNGTU_ID
            inner join TT_PHAUTHUAT_VTYT VTYT on (PLCT.TOATHUOCNOITRU_ID = VTYT.PHAUTHUAT_VTYT_ID  AND PLCT.REF_TABLE = 'TT_PHAUTHUAT_VTYT')
            left join TM_DUOC D on D.DUOC_ID = PLCT.DUOC_ID
            left join TT_PHAUTHUAT PT on PT.PHAUTHUAT_ID = VTYT.PHAUTHUAT_ID
            left join TM_PHONGBAN PB on PB.PHONGBAN_ID = PT.PHONGBANTHUCHIEN_ID
            WHERE
            PLCT.CHUNGTU_ID = '$CHUNGTU_ID$'
            and PLCT.BENHVIEN_ID = '$BENHVIEN_ID$'
            UNION ALL
            SELECT
            PLCT.DUOC_ID,
            d.MADUOC,
            TO_CHAR(D.TENDUOCDAYDU) TENDUOCDAYDU ,
            d.DONVITINH,
            PLCT.SOLUONGYEUCAU,
            PLCT.BENHNHAN,
            PB.TENPHONGBAN
            FROM
            TT_DUOC_PHIEULINH PL
            inner join TT_DUOC_PHIEULINH_CHITIET PLCT on PL.CHUNGTU_ID = PLCT.CHUNGTU_ID
            inner join TT_CLSKETQUA_VTYT VTYT on (PLCT.TOATHUOCNOITRU_ID = VTYT.CLSKETQUA_VTYT_ID  AND PLCT.REF_TABLE = 'TT_CLSKETQUA_VTYT')
            left join TM_DUOC D on D.DUOC_ID = PLCT.DUOC_ID
            left join TM_PHONGBAN PB on PB.PHONGBAN_ID = VTYT.PHONGBAN_ID
            WHERE
            PLCT.CHUNGTU_ID = '$CHUNGTU_ID$'
            and PLCT.BENHVIEN_ID = '$BENHVIEN_ID$'
        </statement>
        <!--Revision:0-->
        <update id="DAO00030_DUOCPHIEULINH_Duyet" parameterClass="System.Collections.IDictionary">
            BEGIN
            update TT_DUOC_PHIEULINH set
            DUYET = #DUYET#
            ,LYDO = #LYDO#
            ,NGUOIDUYET = #NGUOIDUYET#
            ,NGUOIDUYET_ID = #NGUOIDUYET_ID#
            ,NGAYDUYET = #NGAYDUYET#
            ,THOIGIANDUYET = #THOIGIANDUYET#
            where
            CHUNGTU_ID = '$CHUNGTU_ID$';
            UPDATE
            TT_VIENPHI
            SET
            DUYET = #DUYET#
            WHERE
            (REF_TABLE = 'TT_NOITRU_TOATHUOC' OR REF_TABLE = 'TT_PHAUTHUAT_VTYT')
            AND REF_ID IN (SELECT TOATHUOCNOITRU_ID FROM TT_DUOC_PHIEULINH_CHITIET WHERE CHUNGTU_ID = '$CHUNGTU_ID$');
            END;
        </update>
        <!--Revision:0-->
        <statement id="DAO00030_DUOCPHIEULINHCT_GetTaoPhieuXuat" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
            SELECT
            plct.DUOC_ID, plct.SOLUONGYEUCAU
            ,plct.TOATHUOCNOITRU_ID, plct.REF_TABLE, plct.YLENH
            ,plct.BENHNHAN
            FROM
            TT_DUOC_PHIEULINH_CHITIET plct
            inner join TT_DUOC_PHIEULINH pl on pl.CHUNGTU_ID = plct.CHUNGTU_ID
            WHERE
            plct.CHUNGTU_ID = '$CHUNGTU_ID$'
            and plct.BENHVIEN_ID = '$BENHVIEN_ID$'
        </statement>
        <!--Revision:0-->
        <statement id="DAO00030_TOATHUOC_GetDanhSachToaNgoaiTruDaXuat" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
            select KBTT.SOTHUTUTOA
            from
            TT_NGOAITRU_KHAMBENH_TOATHUOC KBTT
            where
            KBTT.KHAMBENH_TOATHUOC_ID  IN ($LIST_KHAMBENH_TOATHUOC_ID$)
            and KBTT.TRANGTHAI = 'DAXUAT'
            and KBTT.BENHVIEN_ID = '$BENHVIEN_ID$'
        </statement>
        <!--Revision:0-->
        <statement id="DAO00030_TOATHUOC_GetDanhSachToaNoiTruDaXuat" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
            SELECT
            TT.SOTHUTUTOA
            FROM
            TT_NOITRU_KHAMBENH KB
            INNER JOIN TT_NOITRU_TOATHUOC TT on KB.KHAMBENH_ID = TT.KHAMBENH_ID
            WHERE
            KB.KHAMBENH_ID IN ($LIST_KHAMBENH_TOATHUOC_ID$)
            and TT.TRANGTHAI = 'DAXUAT'
            and KB.BENHVIEN_ID = '$BENHVIEN_ID$'
        </statement>
        <!--Revision:0-->
        <statement id="DAO00030_TOATHUOC_GetThongTinDuyet" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
            SELECT
            BN.MAYTE,
            BN.TENBENHNHAN,
            BN.SOVAOVIEN,
            CASE
            WHEN BN.GIOITINH = 1 THEN 'Nam'
            WHEN BN.GIOITINH = 2 THEN 'Nữ'
            END  AS GIOITINH,
            BN.NAMSINH,
            TO_CHAR(BN.NGAYSINH,'DD/MM/YYYY') as NGAYSINH,
            DT.TENDOITUONG,
            BN.DIACHILIENLAC as DIACHI,
            KBTT.KHAMBENH_TOATHUOC_ID,
            KBTT.SOTHUTUTOA,
            KB.PHONGBAN_ID,
            KB.BACSIKHAM_ID,
            KBTT.NGUOIDUYET_ID,
            KBTT.NGAYDUYET,
            KBTT.THOIGIANDUYET,
            KBTT.TRANGTHAI,
            KBTT.LYDOHUY,
            'NGOAITRU' as MALOAITOA,
            'Ngoại trú' as TENLOAITOA
            FROM
            TT_BENHNHAN BN,
            TT_NGOAITRU_KHAMBENH KB,
            TT_NGOAITRU_KHAMBENH_TOATHUOC KBTT,
            TM_DOITUONG DT
            WHERE
            KB.KHAMBENH_ID = KBTT.KHAMBENH_ID
            AND KB.BENHNHAN_ID = BN.BENHNHAN_ID
            AND KB.DOITUONG_ID = DT.DOITUONG_ID
            AND KBTT.DUYET = '$DUYET$'
            AND KBTT.HUYTOATHUOC = '0'
            <!--AND KBTT.CHUNGTUPHATTHUOC_ID is NULL-->
            <isNotEmpty prepend="and" property="KHOXUAT_ID">
                KBTT.KHOXUAT_ID = '$KHOXUAT_ID$'
            </isNotEmpty>
          AND LOAITOATHUOC = '$LOAITOATHUOC$'
          AND KB.BENHVIEN_ID = '$BENHVIEN_ID$'
          AND trunc(KBTT.NGAYTAO) BETWEEN  trunc(#TUNGAY#) and  trunc(#DENNGAY#)
          AND (KBTT.SOTHUTUTOA LIKE '%$KEYWORD$%' or BN.TENBENHNHAN LIKE '%$KEYWORD$%' or BN.MAYTE LIKE '%$KEYWORD$%' or BN.SOVAOVIEN LIKE '%$KEYWORD$%')
          UNION ALL
          SELECT DISTINCT
          BN.MAYTE,
          BN.TENBENHNHAN,
          BN.SOVAOVIEN,
          CASE
          WHEN BN.GIOITINH = 1 THEN 'Nam'
          WHEN BN.GIOITINH = 2 THEN 'Nữ'
          END  AS GIOITINH,
          BN.NAMSINH,
          TO_CHAR(BN.NGAYSINH,'DD/MM/YYYY') as NGAYSINH,
          DT.TENDOITUONG,
          BN.DIACHILIENLAC as DIACHI,
          TT.KHAMBENH_ID as KHAMBENH_TOATHUOC_ID,
          TT.SOTHUTUTOA,
          KB.PHONGBAN_ID,
          KB.BACSIKHAM_ID,
          CASE
          WHEN TT.TRANGTHAI	= 'CHUAXUAT'  THEN NULL
          WHEN TT.TRANGTHAI	= 'DADUYET'  THEN KB.NGUOICAPNHAT_ID
          END  AS NGUOIDUYET_ID,
          null as NGAYDUYET,
          CASE
          WHEN TT.TRANGTHAI	= 'CHUAXUAT'  THEN NULL
          WHEN TT.TRANGTHAI	= 'DADUYET'  THEN KB.NGAYCAPNHAT
          END  AS THOIGIANDUYET,
          TT.TRANGTHAI AS TRANGTHAI,
          TT.GHICHU AS LYDOHUY,
          'NOITRU' as MALOAITOA,
          'Nội trú ra viện' as TENLOAITOA
          FROM
          TT_BENHNHAN BN,
          TT_NOITRU_KHAMBENH KB,
          TT_NOITRU_TOATHUOC TT,
          TT_NOITRU_BENHAN BA,
          TM_DOITUONG DT
          WHERE
          KB.KHAMBENH_ID = TT.KHAMBENH_ID
          AND BA.BENHAN_ID = KB.BENHAN_ID
          AND BA.BENHNHAN_ID = BN.BENHNHAN_ID
          AND BA.KHOAVAO_ID is NULL
          AND BA.DOITUONG_ID = DT.DOITUONG_ID
          AND KB.ISTHUOCBV = '$ISTHUOCBV$'
          AND TT.HUYTOATHUOC = '0'
          AND TT.KHOPHAT_ID = '$KHOXUAT_ID$'
          and TT.BENHVIEN_ID = '$BENHVIEN_ID$'
          <isNotEmpty prepend="and" property="TRANGTHAI_CHUAXUAT">
                TT.TRANGTHAI	= '$TRANGTHAI_CHUAXUAT$'
            </isNotEmpty>
            <isNotEmpty prepend="and" property="TRANGTHAI_DAXUAT">
                TT.TRANGTHAI	!= 'CHUAXUAT'
            </isNotEmpty>
          AND KB.RAVIEN = '1'
          AND trunc(KB.NGAYKHAM) BETWEEN  trunc(#TUNGAY#) and  trunc(#DENNGAY#)
          AND (TT.SOTHUTUTOA LIKE '%$KEYWORD$%' or BN.TENBENHNHAN LIKE '%$KEYWORD$%'  or BN.MAYTE LIKE '%$KEYWORD$%' or BN.SOVAOVIEN LIKE '%$KEYWORD$%')
        </statement>
        <!--Revision:0-->
        <statement id="DAO00030_TOATHUOC_NGOAITRU_ChiTiet" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
            SELECT
            TO_CHAR(KB.NGAYKHAM,'DD/MM/YYYY') as NGAYKHAM,
            KB.BACSIKHAM_ID,
            KB.PHONGBAN_ID,
            KB.CHANDOANKHOAKHAM,
            TT.DUOC_ID,
            TT.SOLUONG,
            TT.SONGAY,
            TT.SOLUONG_BUOISANG,
            TT.SOLUONG_BUOITRUA,
            TT.SOLUONG_BUOICHIEU,
            TT.SOLUONG_BUOITOI,
            TT.GHICHU
            FROM
            TT_NGOAITRU_KHAMBENH KB,
            TT_NGOAITRU_KHAMBENH_TOATHUOC KBTT,
            TT_NGOAITRU_TOATHUOC TT
            WHERE
            KB.KHAMBENH_ID = KBTT.KHAMBENH_ID
            AND KBTT.KHAMBENH_TOATHUOC_ID = TT.KHAMBENH_TOATHUOC_ID
            AND TT.KHAMBENH_TOATHUOC_ID = '$KHAMBENH_TOATHUOC_ID$'
            and KB.BENHVIEN_ID = '$BENHVIEN_ID$'
        </statement>
        <!--Revision:0-->
        <statement id="DAO00030_TOATHUOC_NOITRU_ChiTiet" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
            SELECT
            TO_CHAR(KB.NGAYKHAM,'DD/MM/YYYY') as NGAYKHAM,
            KB.BACSIKHAM_ID,
            LT.PHONGBAN_ID,
            KB.DINHBENH as CHANDOANKHOAKHAM,
            TT.DUOC_ID,
            TT.SOLUONG,
            TT.SONGAY,
            TT.SOLUONG_BUOISANG,
            TT.SOLUONG_BUOITRUA,
            TT.SOLUONG_BUOICHIEU,
            TT.SOLUONG_BUOITOI,
            TT.GHICHU
            FROM
            TT_NOITRU_KHAMBENH KB,
            TT_NOITRU_TOATHUOC TT,
            TT_NOITRU_LUUTRU LT
            WHERE
            KB.KHAMBENH_ID = TT.KHAMBENH_ID
            AND KB.KHAMBENH_ID = TT.KHAMBENH_ID
            AND KB.LUUTRU_ID = LT.LUUTRU_ID
            AND KB.KHAMBENH_ID = '$KHAMBENH_TOATHUOC_ID$'
            and KB.BENHVIEN_ID = '$BENHVIEN_ID$'
        </statement>
        <!--Revision:0-->
        <statement id="DAO00030_TT_NGOAITRU_TOATHUOC_GetList" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
            select *
            from TT_NGOAITRU_TOATHUOC
            <dynamic prepend="where">
                <isParameterPresent>
                    <isNotEmpty prepend="and" property="TOATHUOC_ID">
                        TT_NGOAITRU_TOATHUOC.TOATHUOC_ID = '$TOATHUOC_ID$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="KHAMBENH_TOATHUOC_ID">
                        TT_NGOAITRU_TOATHUOC.KHAMBENH_TOATHUOC_ID = '$KHAMBENH_TOATHUOC_ID$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="SOTHUTUTOA">
                        TT_NGOAITRU_TOATHUOC.SOTHUTUTOA = '$SOTHUTUTOA$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="KHAMBENH_ID">
                        TT_NGOAITRU_TOATHUOC.KHAMBENH_ID = '$KHAMBENH_ID$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="DUOC_ID">
                        TT_NGOAITRU_TOATHUOC.DUOC_ID = '$DUOC_ID$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="SOLUONG">
                        TT_NGOAITRU_TOATHUOC.SOLUONG = '$SOLUONG$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="SONGAY">
                        TT_NGOAITRU_TOATHUOC.SONGAY = '$SONGAY$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="SOLANTRENNGAY">
                        TT_NGOAITRU_TOATHUOC.SOLANTRENNGAY = '$SOLANTRENNGAY$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="SOLUONGTRENLAN">
                        TT_NGOAITRU_TOATHUOC.SOLUONGTRENLAN = '$SOLUONGTRENLAN$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="SOLUONG_BUOISANG">
                        TT_NGOAITRU_TOATHUOC.SOLUONG_BUOISANG = '$SOLUONG_BUOISANG$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="SOLUONG_BUOITRUA">
                        TT_NGOAITRU_TOATHUOC.SOLUONG_BUOITRUA = '$SOLUONG_BUOITRUA$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="SOLUONG_BUOICHIEU">
                        TT_NGOAITRU_TOATHUOC.SOLUONG_BUOICHIEU = '$SOLUONG_BUOICHIEU$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="SOLUONG_BUOITOI">
                        TT_NGOAITRU_TOATHUOC.SOLUONG_BUOITOI = '$SOLUONG_BUOITOI$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="DUONGDUNG_ID">
                        TT_NGOAITRU_TOATHUOC.DUONGDUNG_ID = '$DUONGDUNG_ID$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="HUYTOATHUOC">
                        TT_NGOAITRU_TOATHUOC.HUYTOATHUOC = '$HUYTOATHUOC$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="IDX">
                        TT_NGOAITRU_TOATHUOC.IDX = '$IDX$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="NGUONHANG_ID">
                        TT_NGOAITRU_TOATHUOC.NGUONHANG_ID = '$NGUONHANG_ID$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="PHATSINHHOADON">
                        TT_NGOAITRU_TOATHUOC.PHATSINHHOADON = '$PHATSINHHOADON$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="GHICHU">
                        TT_NGOAITRU_TOATHUOC.GHICHU = '$GHICHU$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="TRANGTHAI">
                        TT_NGOAITRU_TOATHUOC.TRANGTHAI = '$TRANGTHAI$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="BENHVIEN_ID">
                        TT_NGOAITRU_TOATHUOC.BENHVIEN_ID = '$BENHVIEN_ID$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="NGAYTAO">
                        TT_NGOAITRU_TOATHUOC.NGAYTAO = '$NGAYTAO$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="NGUOITAO_ID">
                        TT_NGOAITRU_TOATHUOC.NGUOITAO_ID = '$NGUOITAO_ID$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="NGAYCAPNHAT">
                        TT_NGOAITRU_TOATHUOC.NGAYCAPNHAT = '$NGAYCAPNHAT$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="NGUOICAPNHAT_ID">
                        TT_NGOAITRU_TOATHUOC.NGUOICAPNHAT_ID = '$NGUOICAPNHAT_ID$'
                    </isNotEmpty>
                </isParameterPresent>
            </dynamic>
            order by TOATHUOC_ID
        </statement>
        <!--Revision:0-->
        <update id="DAO00030_NGOAITRU_TOATHUOC_DUYET" parameterClass="System.Collections.IDictionary">
            BEGIN
            update
            TT_NGOAITRU_KHAMBENH_TOATHUOC
            set
            DUYET = #DUYET#
            , NGAYDUYET = SYSDATE
            , THOIGIANDUYET = SYSDATE
            , NGUOIDUYET_ID = #NGUOIDUYET_ID#
            , LYDOHUY = #LYDOHUY#
            where
            KHAMBENH_TOATHUOC_ID = '$KHAMBENH_TOATHUOC_ID$';
            UPDATE
            TT_VIENPHI
            SET
            DUYET = '$DUYET$'
            WHERE
            VIENPHI_ID IN
            (
            SELECT VIENPHI_ID
            FROM TT_VIENPHI VP, TT_NGOAITRU_KHAMBENH_TOATHUOC KBTT, TT_NGOAITRU_TOATHUOC TT
            WHERE
            TT.KHAMBENH_TOATHUOC_ID = KBTT.KHAMBENH_TOATHUOC_ID
            AND TT.TOATHUOC_ID = VP.REF_ID
            AND KBTT.KHAMBENH_TOATHUOC_ID = '$KHAMBENH_TOATHUOC_ID$'
            AND VP.REF_TABLE = 'TT_NGOAITRU_TOATHUOC'
            );
            END;
        </update>
        <!--Revision:0-->
        <update id="DAO00030_NGOAITRU_TOATHUOC_DUYET_TUDONG" parameterClass="System.Collections.IDictionary">
            BEGIN
            update
            TT_NGOAITRU_KHAMBENH_TOATHUOC
            set
            DUYET = #DUYET#
            , NGAYDUYET = #NGAYDUYET#
            , THOIGIANDUYET = #THOIGIANDUYET#
            , NGUOIDUYET_ID = #NGUOIDUYET_ID#
            , LYDOHUY = #LYDOHUY#
            where
            TIEPNHAN_ID = '$TIEPNHAN_ID$';
            update
            TT_VIENPHI
            set
            DUYET = '$DUYET$'
            FROM
            TT_VIENPHI VP
            WHERE
            VP.TIEPNHAN_ID = '$TIEPNHAN_ID$'
            AND VP.REF_TABLE = 'TT_NGOAITRU_TOATHUOC';
            END;
        </update>
        <!--Revision:0-->
        <update id="DAO00030_NOITRU_TOATHUOC_DUYET" parameterClass="System.Collections.IDictionary">
            BEGIN
            update
            TT_NOITRU_TOATHUOC
            set
            TRANGTHAI = #DUYET#
            , NGAYCAPNHAT = SYSDATE
            , NGUOICAPNHAT_ID = #NGUOIDUYET_ID#
            , GHICHU = #LYDOHUY#
            where
            KHAMBENH_ID = '$KHAMBENH_TOATHUOC_ID$';
            UPDATE
            TT_VIENPHI
            SET
            DUYET = '$VP_DUYET$'
            WHERE
            VIENPHI_ID IN
            (
            SELECT VP.VIENPHI_ID
            FROM
            TT_VIENPHI VP, TT_NOITRU_KHAMBENH KB, TT_NOITRU_TOATHUOC TT
            WHERE
            TT.KHAMBENH_ID = KB.KHAMBENH_ID
            AND TT.TOATHUOC_ID = VP.REF_ID
            AND KB.KHAMBENH_ID = '$KHAMBENH_TOATHUOC_ID$'
            AND VP.REF_TABLE = 'TT_NOITRU_TOATHUOC'
            and VP.BENHVIEN_ID = '$BENHVIEN_ID$';
            )
            END;
        </update>
        <!--Revision:0-->
        <statement id="DAO00030_TOATHUOC_GetDanhSachThuoc" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
            select  TOATHUOC_ID, DUOC_ID, sum(SOLUONG) as SOLUONG
            from
            TT_NGOAITRU_TOATHUOC
            where
            KHAMBENH_TOATHUOC_ID  IN ($LIST_KHAMBENH_TOATHUOC_ID$)
            and BENHVIEN_ID = '$BENHVIEN_ID$'
            group by TOATHUOC_ID, DUOC_ID
        </statement>
        <!--Revision:0-->
        <statement id="DAO00030_TOATHUOC_GetDanhSachThuocChuaDuyet" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
            select TT.TOATHUOC_ID, TT.DUOC_ID, TO_CHAR(D.TENDUOCDAYDU) TENDUOCDAYDU , D.DONVITINH, TT.SOLUONG
            from
            TT_NGOAITRU_TOATHUOC TT
            INNER JOIN TT_NGOAITRU_KHAMBENH_TOATHUOC KBTT on TT.KHAMBENH_TOATHUOC_ID = KBTT.KHAMBENH_TOATHUOC_ID
            INNER JOIN TM_DUOC D on D.DUOC_ID = TT.DUOC_ID
            where
            TT.KHAMBENH_TOATHUOC_ID  IN ($LIST_KHAMBENH_TOATHUOC_ID$)
            and KBTT.DUYET = '0'
            and TT.BENHVIEN_ID = '$BENHVIEN_ID$'
        </statement>
        <!--Revision:0-->
        <statement id="DAO00030_TOATHUOC_GetDanhSachThuoc_VP" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
            select  DUOC_ID, KHAMBENH_ID, sum(SOLUONG) as SOLUONG
            from
            TT_NGOAITRU_TOATHUOC
            where
            KHAMBENH_TOATHUOC_ID  IN ($LIST_KHAMBENH_TOATHUOC_ID$)
            and BENHVIEN_ID = '$BENHVIEN_ID$'
            group by DUOC_ID, KHAMBENH_ID
        </statement>
        <!--Revision:0-->
        <statement id="DAO00030_NOITRU_TOATHUOC_GetDanhSachThuoc" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
            select  TOATHUOC_ID, DUOC_ID, sum(SOLUONG) as SOLUONG
            from
            TT_NOITRU_TOATHUOC
            where
            SOTHUTUTOA  IN ($LIST_SOTHUTUTOA$)
            and BENHVIEN_ID = '$BENHVIEN_ID$'
            group by  TOATHUOC_ID, DUOC_ID
        </statement>
      <statement id="DAO00030_NOITRU_TOARAVIEN_GetDanhSachThuoc" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
        select  TOATHUOC_ID, DUOC_ID, NGUONDUOC_ID, sum(SOLUONG) as SOLUONG
        from
        TT_NOITRU_TOATHUOC
        where
        TOATHUOC_ID  IN ($LIST_TOATHUOC_ID$)
        and BENHVIEN_ID = '$BENHVIEN_ID$'
        group by  TOATHUOC_ID, DUOC_ID, NGUONDUOC_ID
      </statement>
        <!--Revision:0-->
        <statement id="DAO00030_NOITRU_TOATHUOC_GetDanhSachThuoc_VP" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
            select  DUOC_ID, KHAMBENH_ID, sum(SOLUONG) as SOLUONG
            from
            TT_NOITRU_TOATHUOC
            where
            TOATHUOC_ID  IN ($LIST_TOATHUOC_ID$)
            and BENHVIEN_ID = '$BENHVIEN_ID$'
            group by DUOC_ID, KHAMBENH_ID
        </statement>
        <!--Revision:0-->
        <statement id="DAO00030_TOATHUOC_GetThongTinDaDuyet" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
            SELECT
            KB.TIEPNHAN_ID,
            KB.KHAMBENH_ID,
            KBTT.KHAMBENH_TOATHUOC_ID,
            KBTT.SOTHUTUTOA,
            KBTT.NGAYTOATHUOC,
            CASE
            WHEN KBTT.LOAITOATHUOC = 'BV' THEN 'Bệnh việ'
            WHEN KBTT.LOAITOATHUOC = 'M' THEN 'Mua ngoài'
            END  AS LOAITOATHUOC,
            KB.PHONGBAN_ID,
            KB.BACSIKHAM_ID,
            KB.CHUYENKHOA_ID
            FROM
            TT_NGOAITRU_KHAMBENH KB
            inner join TT_NGOAITRU_KHAMBENH_TOATHUOC KBTT on KB.KHAMBENH_ID = KBTT.KHAMBENH_ID
            WHERE
            KB.TIEPNHAN_ID = '$TIEPNHAN_ID$'
            AND KBTT.LOAITOATHUOC = '$LOAITOATHUOC$'
            AND KBTT.TRANGTHAI = '$TRANGTHAI$'
            AND KBTT.DUYET = '1'
            and KB.BENHVIEN_ID = '$BENHVIEN_ID$'
            <isNotEmpty prepend="and" property="CHUNGTUPHATTHUOC_ID">
                KBTT.CHUNGTUPHATTHUOC_ID = '$CHUNGTUPHATTHUOC_ID$'
            </isNotEmpty>
            <isEqual prepend="and" property="LOAITOATHUOC" compareValue="BV">
                KBTT.KHOXUAT_ID = #KHOXUAT_ID#
            </isEqual>
        </statement>
        <!--Revision:0-->
        <statement id="DAO00030_TOATHUOC_RAVIEN_GetThongTinDaDuyet" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
            select
            distinct
            TT.TOATHUOC_ID,
            TT.SOTHUTUTOA,
            BA.TIEPNHAN_ID,
            KB.KHAMBENH_ID,
            KB.BACSIKHAM_ID,
            BA.KHOACHUYENDEN_ID,
            PB.TENPHONGBAN,
            TT.NGAYTAO as NGAYTOATHUOC
            from
            TT_NOITRU_KHAMBENH KB
            inner join TT_NOITRU_BENHAN BA on BA.BENHAN_ID = KB.BENHAN_ID
            inner join TT_NOITRU_TOATHUOC TT on KB.KHAMBENH_ID = TT.KHAMBENH_ID
            inner join TM_PHONGBAN pb on pb.PHONGBAN_ID = NVL(ba.KHOAVAO_ID, ba.KHOACHUYENDEN_ID)
            where
            BA.TIEPNHAN_ID = '$TIEPNHAN_ID$'
            AND KB.RAVIEN = '1'
            AND TT.KHOPHAT_ID =  #KHOXUAT_ID#
            AND TT.TRANGTHAI =  #TRANGTHAI#
            AND BA.BENHVIEN_ID = '$BENHVIEN_ID$'
            <isNotEmpty prepend="and" property="CHUNGTU_ID">
                TT.CHUNGTU_ID = '$CHUNGTU_ID$'
            </isNotEmpty>
        </statement>
        <!--Revision:0-->
        <update id="DAO00030_Update_ToaThuocChungTuAdd" parameterClass="System.Collections.IDictionary">
            update
            TT_NGOAITRU_KHAMBENH_TOATHUOC
            set
            CHUNGTUPHATTHUOC_ID = #CHUNGTUPHATTHUOC_ID#
            ,TRANGTHAI = '$TRANGTHAI$'
            where
            KHAMBENH_TOATHUOC_ID = '$KHAMBENH_TOATHUOC_ID$'
        </update>
        <!--Revision:0-->
        <update id="DAO00030_Update_ToaThuocChungTuRemove" parameterClass="System.Collections.IDictionary">
            update
            TT_NGOAITRU_KHAMBENH_TOATHUOC
            set
            CHUNGTUPHATTHUOC_ID = null
            ,TRANGTHAI = 'CHUAXUAT'
            where
            KHAMBENH_TOATHUOC_ID = '$KHAMBENH_TOATHUOC_ID$'
        </update>
        <!--Revision:0-->
        <update id="DAO00030_Update_NoiTru_ToaThuocChungTuAdd" parameterClass="System.Collections.IDictionary">
            update
            TT_NOITRU_TOATHUOC
            set
            CHUNGTU_ID = #CHUNGTU_ID#
            ,TRANGTHAI = '$TRANGTHAI$'
            where
            TOATHUOC_ID = '$TOATHUOC_ID$'
        </update>
        <!--Revision:0-->
        <update id="DAO00030_Update_NoiTru_ToaThuocChungTuRemove" parameterClass="System.Collections.IDictionary">
            update
            TT_NOITRU_TOATHUOC
            set
            CHUNGTU_ID = null
            ,TRANGTHAI = 'DADUYET'
            where
            TOATHUOC_ID = '$TOATHUOC_ID$'
        </update>
        <!--Revision:0-->
        <statement id="DAO00030_KTDaThanhToanVP" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
            SELECT
            HOADON_ID
            FROM
            TT_VIENPHI
            WHERE
            REF_ID ='$REF_ID$'
            AND REF_TABLE = '$REF_TABLE$'
            AND HOADON_ID is not NULL
            and BENHVIEN_ID = '$BENHVIEN_ID$'
        </statement>
        <!--Revision:0-->
        <statement id="DAO00030_KTDaPhatSinhPhieuBHTN" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
            SELECT vp.VIENPHI_ID
            FROM TT_VIENPHI vp
            INNER JOIN TT_MIENGIAM_CHITIET  mgct on mgct.VIENPHI_ID = vp.VIENPHI_ID
            INNER JOIN TT_DUOC_CHUNGTU ct on ct.TIEPNHAN_ID = vp.TIEPNHAN_ID
            WHERE
            ct.CHUNGTU_ID = '$CHUNGTU_ID$'
            AND vp.DUOC_ID is not null
            AND vp.BENHVIEN_ID = '$BENHVIEN_ID$'
        </statement>
        <!--Revision:0-->
        <statement id="DAO00030_KTDaPhatSinhBienLai" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
            SELECT CHUNGTU_ID
            FROM TT_NOITRU_TOATHUOC tt
            INNER JOIN TT_VIENPHI vp on (tt.TOATHUOC_ID = vp.REF_ID and REF_TABLE = 'TT_NOITRU_TOATHUOC')
            WHERE
            CHUNGTU_ID = '$CHUNGTU_ID$'
            AND tt.BENHVIEN_ID = '$BENHVIEN_ID$'
            AND HOADON_ID is not NULL
            AND vp.HUY = '0'
            union all
            SELECT  kbtt.CHUNGTUPHATTHUOC_ID as CHUNGTU_ID
            FROM TT_NGOAITRU_TOATHUOC tt
            INNER JOIN TT_NGOAITRU_KHAMBENH_TOATHUOC kbtt on (kbtt.KHAMBENH_TOATHUOC_ID = tt.KHAMBENH_TOATHUOC_ID)
            INNER JOIN TT_VIENPHI vp on (tt.TOATHUOC_ID = vp.REF_ID and REF_TABLE = 'TT_NGOAITRU_TOATHUOC')
            WHERE
            kbtt.CHUNGTUPHATTHUOC_ID = '$CHUNGTU_ID$'
            AND tt.BENHVIEN_ID = '$BENHVIEN_ID$'
            AND HOADON_ID is not NULL
            AND vp.HUY = '0'
            union all
            SELECT ctct.CHUNGTU_ID from
            TT_DUOC_CHUNGTU_CHITIET ctct
            INNER JOIN TT_HOADON_CHITIET_NGOAITRU hdct on (hdct.REF_ID = ctct.CHUNGTUCHITIET_ID and hdct.REF_TABLE = 'TT_DUOC_CHUNGTU_CHITIET')
            INNER JOIN TT_HOADON hd on hd.HOADON_ID = hdct.HOADON_ID
            WHERE
            ctct.CHUNGTU_ID = '$CHUNGTU_ID$'
            AND hd.HUYHOADON = '0'
            AND ctct.BENHVIEN_ID = '$BENHVIEN_ID$'
            union all
            SELECT CHUNGTU_ID
            FROM TT_NGOAITRU_KHAMBENH_VTYT tt
            INNER JOIN TT_VIENPHI vp on (tt.KHAMBENH_VTYT_ID = vp.REF_ID and REF_TABLE = 'TT_NGOAITRU_KHAMBENH_VTYT')
            WHERE
            CHUNGTU_ID = '$CHUNGTU_ID$'
            AND tt.BENHVIEN_ID = '$BENHVIEN_ID$'
            AND HOADON_ID is not NULL
            AND vp.HUY = '0'
            union all
            SELECT CHUNGTU_ID
            FROM TT_PHAUTHUAT_VTYT tt
            INNER JOIN TT_VIENPHI vp on (tt.PHAUTHUAT_VTYT_ID = vp.REF_ID and REF_TABLE = 'TT_PHAUTHUAT_VTYT')
            WHERE
            CHUNGTU_ID = '$CHUNGTU_ID$'
            AND tt.BENHVIEN_ID = '$BENHVIEN_ID$'
            AND HOADON_ID is not NULL
            AND vp.HUY = '0'
            union all
            SELECT CHUNGTU_ID
            FROM TT_CLSKETQUA_VTYT tt
            INNER JOIN TT_VIENPHI vp on (tt.CLSKETQUA_VTYT_ID = vp.REF_ID and REF_TABLE = 'TT_CLSKETQUA_VTYT')
            WHERE
            CHUNGTU_ID = '$CHUNGTU_ID$'
            AND tt.BENHVIEN_ID = '$BENHVIEN_ID$'
            AND HOADON_ID is not NULL
            AND vp.HUY = '0'
        </statement>
        <!--Revision:0-->
        <statement id="DAO00030_DUOC_SOLONHAP_GIABAN_GetAll" resultClass="DataObject">
            select *
            from TT_DUOC_SOLONHAP_GIABAN
            WHERE BENHVIEN_ID = '$BENHVIEN_ID$'
            order by DUOCSOLONHAPGIABAN_ID
        </statement>
        <!--Revision:0-->
        <statement id="DAO00030_DUOC_SOLONHAP_GIABAN_GetList" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
            select *
            from TT_DUOC_SOLONHAP_GIABAN
            <dynamic prepend="where">
                <isParameterPresent>
                    <isNotEmpty prepend="and" property="DUOCSOLONHAPGIABAN_ID">
                        TT_DUOC_SOLONHAP_GIABAN.DUOCSOLONHAPGIABAN_ID = '$DUOCSOLONHAPGIABAN_ID$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="SOLONHAP_ID">
                        TT_DUOC_SOLONHAP_GIABAN.SOLONHAP_ID = '$SOLONHAP_ID$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="DUOC_ID">
                        TT_DUOC_SOLONHAP_GIABAN.DUOC_ID = '$DUOC_ID$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="BENHVIEN_ID">
                        TT_DUOC_SOLONHAP_GIABAN.BENHVIEN_ID = '$BENHVIEN_ID$'
                    </isNotEmpty>
                </isParameterPresent>
            </dynamic>
            order by DUOCSOLONHAPGIABAN_ID
        </statement>
        <!--Revision:0-->
        <statement id="DAO00030_DUOC_SOLONHAP_GIABAN_GetDetail" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
            select *
            from TT_DUOC_SOLONHAP_GIABAN
            where TT_DUOC_SOLONHAP_GIABAN.DUOCSOLONHAPGIABAN_ID  = '$value$'
            and BENHVIEN_ID = '$BENHVIEN_ID$'
            order by DUOCSOLONHAPGIABAN_ID
        </statement>
        <!--Revision:0-->
        <statement id="DAO00030_DUOC_SOLONHAP_GIABAN_GetDetailP" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
            select *
            from TT_DUOC_SOLONHAP_GIABAN
            where TT_DUOC_SOLONHAP_GIABAN.DUOCSOLONHAPGIABAN_ID  = '$DUOCSOLONHAPGIABAN_ID$'
            and BENHVIEN_ID = '$BENHVIEN_ID$'
            order by DUOCSOLONHAPGIABAN_ID
        </statement>
        <!--Revision:0-->
        <statement id="DAO00030_DUOC_SOLONHAP_GIABAN_Add" parameterClass="System.Collections.IDictionary" resultClass="System.Int64">
            insert into TT_DUOC_SOLONHAP_GIABAN (
            SOLONHAP_ID
            , DUOC_ID
            , DONGIAMUA
            , DONGIAVON
            , TYLEVAT_DAUVAO
            , DONGIAVONVAT
            , DONGIABAN
            , DONGIABANVAT_DAUVAO
            , BENHVIEN_ID
            ) values (
            #SOLONHAP_ID#
            , #DUOC_ID#
            , #DONGIAMUA#
            , #DONGIAVON#
            , #TYLEVAT_DAUVAO#
            , #DONGIAVONVAT#
            , #DONGIABAN#
            , #DONGIABANVAT_DAUVAO#
            , #BENHVIEN_ID#
            )
        </statement>
        <!--Revision:0-->
        <update id="DAO00030_DUOC_SOLONHAP_GIABAN_Update" parameterClass="System.Collections.IDictionary">
            update TT_DUOC_SOLONHAP_GIABAN set
            SOLONHAP_ID = #SOLONHAP_ID#
            , DUOC_ID = #DUOC_ID#
            , DONGIAMUA = #DONGIAMUA#
            , DONGIAVON = #DONGIAVON#
            , TYLEVAT_DAUVAO = #TYLEVAT_DAUVAO#
            , DONGIAVONVAT = #DONGIAVONVAT#
            , DONGIABAN = #DONGIABAN#
            , DONGIABANVAT_DAUVAO = #DONGIABANVAT_DAUVAO#
            , BENHVIEN_ID = #BENHVIEN_ID#
            where
            DUOCSOLONHAPGIABAN_ID = '$DUOCSOLONHAPGIABAN_ID$'
        </update>
        <!--Revision:0-->
        <statement id="DAO00030_DUOC_SOLONHAP_GIABAN_Delete" parameterClass="System.Collections.IDictionary" resultClass="System.Int32">
            delete from TT_DUOC_SOLONHAP_GIABAN
            where
            DUOCSOLONHAPGIABAN_ID = '$DUOCSOLONHAPGIABAN_ID$'
        </statement>
        <!--Revision:0-->
        <statement id="DAO00030_DUOC_SOLONHAP_GIABAN_DeleteP" parameterClass="System.Collections.IDictionary" resultClass="System.Int32">
            delete from TT_DUOC_SOLONHAP_GIABAN
            <dynamic prepend="where">
                <isParameterPresent>
                    <isNotEmpty prepend="and" property="DUOCSOLONHAPGIABAN_ID">
                        TT_DUOC_SOLONHAP_GIABAN.DUOCSOLONHAPGIABAN_ID = '$DUOCSOLONHAPGIABAN_ID$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="SOLONHAP_ID">
                        TT_DUOC_SOLONHAP_GIABAN.SOLONHAP_ID = '$SOLONHAP_ID$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="DUOC_ID">
                        TT_DUOC_SOLONHAP_GIABAN.DUOC_ID = '$DUOC_ID$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="DONGIAVON">
                        TT_DUOC_SOLONHAP_GIABAN.DONGIAVON = '$DONGIAVON$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="TYLE_VAT">
                        TT_DUOC_SOLONHAP_GIABAN.TYLEVAT_DAUVAO = '$TYLEVAT_DAUVAO$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="DONGIAVON_VAT">
                        TT_DUOC_SOLONHAP_GIABAN.DONGIAVON_VAT = '$DONGIAVON_VAT$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="DONGIABAN">
                        TT_DUOC_SOLONHAP_GIABAN.DONGIABAN = '$DONGIABAN$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="DONGIABANVAT_DAUVAO">
                        TT_DUOC_SOLONHAP_GIABAN.DONGIABANVAT_DAUVAO = '$DONGIABANVAT_DAUVAO$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="BENHVIEN_ID">
                        TT_DUOC_SOLONHAP_GIABAN.BENHVIEN_ID = '$BENHVIEN_ID$'
                    </isNotEmpty>
                </isParameterPresent>
            </dynamic>
        </statement>
        <!--Revision:0-->
        <update id="DAO00030_DUOC_SOVISA_Upd" parameterClass="System.Collections.IDictionary">
            update TM_DUOC set
            SOVISA = '$SOVISA$',
            NGAYCAPNHAT = SYSDATE,
            NGUOICAPNHAT_ID = #NGUOICAPNHAT_ID#
            where
            DUOC_ID = '$DUOC_ID$'
            and BENHVIEN_ID = '$BENHVIEN_ID$'
        </update>
        <!--Revision:0-->
        <statement id="DAO00030_DUOC_SODANGKY_Get" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
            select *
            from TM_DUOC_SODANGKY
            where DUOC_ID  = '$DUOC_ID$'
            and  HIEULUC = '1'
            and BENHVIEN_ID = '$BENHVIEN_ID$'
            order by DUOC_ID
        </statement>
        <!--Revision:0-->
        <statement id="DAO00030_TT_DUOC_KYTONKHO_GetAll" resultClass="DataObject">
            select *
            from TT_DUOC_KYTONKHO
            BENHVIEN_ID = '$BENHVIEN_ID$'
            order by DUOCKYTONKHO_ID
        </statement>
        <!--Revision:0-->
        <statement id="DAO00030_TT_DUOC_KYTONKHO_GetList" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
            select *
            from TT_DUOC_KYTONKHO
            <dynamic prepend="where">
                <isParameterPresent>
                    <isNotEmpty prepend="and" property="DUOCKYTONKHO_ID">
                        TT_DUOC_KYTONKHO.DUOCKYTONKHO_ID = '$DUOCKYTONKHO_ID$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="MAKYTONKHO">
                        TT_DUOC_KYTONKHO.MAKYTONKHO = '$MAKYTONKHO$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="THANG">
                        TT_DUOC_KYTONKHO.THANG = '$THANG$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="NAM">
                        TT_DUOC_KYTONKHO.NAM = '$NAM$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="TUNGAY">
                        TT_DUOC_KYTONKHO.TUNGAY ='$TUNGAY$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="DENNGAY">
                        TT_DUOC_KYTONKHO.DENNGAY ='$DENNGAY$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="KHOASO">
                        TT_DUOC_KYTONKHO.KHOASO = '$KHOASO$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="BENHVIEN_ID">
                        TT_DUOC_KYTONKHO.BENHVIEN_ID = '$BENHVIEN_ID$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="NGAYTAO">
                        TT_DUOC_KYTONKHO.NGAYTAO = '$NGAYTAO$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="NGUOITAO_ID">
                        TT_DUOC_KYTONKHO.NGUOITAO_ID = '$NGUOITAO_ID$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="NGAYCAPNHAT">
                        TT_DUOC_KYTONKHO.NGAYCAPNHAT = '$NGAYCAPNHAT$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="NGUOICAPNHAT_ID">
                        TT_DUOC_KYTONKHO.NGUOICAPNHAT_ID = '$NGUOICAPNHAT_ID$'
                    </isNotEmpty>
                </isParameterPresent>
            </dynamic>
            order by DUOCKYTONKHO_ID
        </statement>
        <!--Revision:0-->
        <statement id="DAO00030_TT_DUOC_KYTONKHO_GetDetail" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
            select *
            from TT_DUOC_KYTONKHO
            where TT_DUOC_KYTONKHO.DUOCKYTONKHO_ID  = '$value$'
            and BENHVIEN_ID = '$BENHVIEN_ID$'
            order by DUOCKYTONKHO_ID
        </statement>
        <!--Revision:0-->
        <statement id="DAO00030_TT_DUOC_KYTONKHO_GetDetailP" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
            select *
            from TT_DUOC_KYTONKHO
            where TT_DUOC_KYTONKHO.DUOCKYTONKHO_ID  = '$DUOCKYTONKHO_ID$'
            and BENHVIEN_ID = '$BENHVIEN_ID$'
            order by DUOCKYTONKHO_ID
        </statement>
        <!--Revision:0-->
        <statement id="DAO00030_TT_DUOC_KYTONKHO_Add" parameterClass="System.Collections.IDictionary" resultClass="System.Int64">
          DECLARE vCOUNT NUMBER:= 0;
          BEGIN

          SELECT COUNT(*) INTO vCOUNT
          FROM TT_DUOC_KYTONKHO
          WHERE MAKYTONKHO = #MAKYTONKHO#
          and BENHVIEN_ID = '$BENHVIEN_ID$';

          IF vCOUNT = 0 THEN

          INSERT INTO TT_DUOC_KYTONKHO (
          MAKYTONKHO
          , THANG
          , NAM
          , TUNGAY
          , DENNGAY
          , KHOASO
          , BENHVIEN_ID
          , NGAYTAO
          , NGUOITAO_ID
          , NGAYCAPNHAT
          , NGUOICAPNHAT_ID
          ) values (
          #MAKYTONKHO#
          , #THANG#
          , #NAM#
          , #TUNGAY#
          , #DENNGAY#
          , #KHOASO#
          , #BENHVIEN_ID#
          , #NGAYTAO#
          , #NGUOITAO_ID#
          , #NGAYCAPNHAT#
          , #NGUOICAPNHAT_ID#
          );
          END IF;
          
          END;
        </statement>
        <!--Revision:0-->
        <update id="DAO00030_TT_DUOC_KYTONKHO_Update" parameterClass="System.Collections.IDictionary">
            update TT_DUOC_KYTONKHO set
            MAKYTONKHO = #MAKYTONKHO#
            , THANG = #THANG#
            , NAM = #NAM#
            , TUNGAY = #TUNGAY#
            , DENNGAY = #DENNGAY#
            , KHOASO = #KHOASO#        
            , NGAYCAPNHAT = #NGAYCAPNHAT#
            , NGUOICAPNHAT_ID = #NGUOICAPNHAT_ID#
            where
            DUOCKYTONKHO_ID = '$DUOCKYTONKHO_ID$'
        </update>
        <!--Revision:0-->
        <statement id="DAO00030_TT_DUOC_KYTONKHO_Delete" parameterClass="System.Collections.IDictionary" resultClass="System.Int32">
            delete from TT_DUOC_KYTONKHO
            where
            DUOCKYTONKHO_ID = '$DUOCKYTONKHO_ID$'
        </statement>
        <!--Revision:0-->
        <statement id="DAO00030_TT_DUOC_KYTONKHO_DeleteP" parameterClass="System.Collections.IDictionary" resultClass="System.Int32">
            delete from TT_DUOC_KYTONKHO
            <dynamic prepend="where">
                <isParameterPresent>
                    <isNotEmpty prepend="and" property="DUOCKYTONKHO_ID">
                        TT_DUOC_KYTONKHO.DUOCKYTONKHO_ID = '$DUOCKYTONKHO_ID$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="MAKYTONKHO">
                        TT_DUOC_KYTONKHO.MAKYTONKHO = '$MAKYTONKHO$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="THANG">
                        TT_DUOC_KYTONKHO.THANG = '$THANG$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="NAM">
                        TT_DUOC_KYTONKHO.NAM = '$NAM$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="TUNGAY">
                        TT_DUOC_KYTONKHO.TUNGAY ='$TUNGAY$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="DENNGAY">
                        TT_DUOC_KYTONKHO.DENNGAY ='$DENNGAY$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="KHOASO">
                        TT_DUOC_KYTONKHO.KHOASO = '$KHOASO$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="BENHVIEN_ID">
                        TT_DUOC_KYTONKHO.BENHVIEN_ID = '$BENHVIEN_ID$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="NGAYTAO">
                        TT_DUOC_KYTONKHO.NGAYTAO = '$NGAYTAO$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="NGUOITAO_ID">
                        TT_DUOC_KYTONKHO.NGUOITAO_ID = '$NGUOITAO_ID$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="NGAYCAPNHAT">
                        TT_DUOC_KYTONKHO.NGAYCAPNHAT = '$NGAYCAPNHAT$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="NGUOICAPNHAT_ID">
                        TT_DUOC_KYTONKHO.NGUOICAPNHAT_ID = '$NGUOICAPNHAT_ID$'
                    </isNotEmpty>
                </isParameterPresent>
            </dynamic>
        </statement>
        <!--Revision:0-->
        <statement id="DAO00030_TT_DUOC_TONDAUKY_KiemTraChuaThucHienLanNao" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
          SELECT
          EXTRACT(MONTH FROM NGAYCHUNGTU) AS THANG,  EXTRACT(YEAR FROM NGAYCHUNGTU) AS NAM
          FROM
          TT_DUOC_CHUNGTU
          WHERE
          ((KHONHAP_ID = '$KHODUOC_ID$' AND LOAICHUNGTU = 'N') OR (KHOXUAT_ID = '$KHODUOC_ID$' AND LOAICHUNGTU = 'X'))
          AND KHONHAP_ID NOT IN (SELECT DISTINCT KHODUOC_ID FROM TT_DUOC_TONDAUKY WHERE KHODUOC_ID = '$KHODUOC_ID$' and BENHVIEN_ID = '$BENHVIEN_ID$')
          AND KHOXUAT_ID NOT IN (SELECT DISTINCT KHODUOC_ID FROM TT_DUOC_TONDAUKY WHERE KHODUOC_ID = '$KHODUOC_ID$' and BENHVIEN_ID = '$BENHVIEN_ID$')
          AND ROWNUM = 1
          AND BENHVIEN_ID = '$BENHVIEN_ID$'
          ORDER BY NGAYCHUNGTU ASC
        </statement>
        <!--Revision:0-->
        <statement id="DAO00030_TT_DUOC_TONDAUKY_LayKyChuaChuaThucHien" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
            SELECT * FROM
            (
            SELECT
            KTK.THANG,
            KTK.NAM,
            '$THANG$' - KTK.THANG + (('$NAM$' - KTK.NAM)*12 ) as KHOANGCACHTHANG,
            '$NAM$' - KTK.NAM as KHOANGCACHNAM
            FROM
            TT_DUOC_TONDAUKY TDK
            inner join TT_DUOC_KYTONKHO KTK on TDK.DUOCKYTONKHO_ID = KTK.DUOCKYTONKHO_ID
            WHERE
            TDK.KHODUOC_ID = '$KHODUOC_ID$'
            AND TDK.BENHVIEN_ID = '$BENHVIEN_ID$'
            AND ROWNUM = 1
            ORDER BY KTK.DUOCKYTONKHO_ID DESC
            )a
            where
            KHOANGCACHTHANG &gt; 1
        </statement>
        <!--Revision:0-->
        <statement id="DAO00030_TT_DUOC_TONDAUKY_TinhTonDauKy" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
          SELECT TDK.KHODUOC_ID, TDK.DUOC_ID, TDK.SOLONHAP_ID,
          SUM(TDK.SOLUONGNHAP) as SOLUONGNHAP, SUM(TDK.SOLUONGXUAT) as SOLUONGXUAT,
          SUM(TDK.SOLUONGNHAP) - SUM(TDK.SOLUONGXUAT) AS SOLUONGTON,
          SUM(TDK.TONDAUKY) as TONDAUKY,
          SUM(TDK.TONDAUKY) || (SUM(TDK.SOLUONGNHAP) - SUM(TDK.SOLUONGXUAT)) AS TONCUOI
          FROM
          (
          SELECT TDK.KHODUOC_ID, TDK.DUOC_ID, TDK.SOLONHAP_ID,
          TDK.SOLUONG AS TONDAUKY, 0 as SOLUONGNHAP, 0 as SOLUONGXUAT
          FROM
          TT_DUOC_KYTONKHO KTK LEFT JOIN TT_DUOC_TONDAUKY TDK ON TDK.DUOCKYTONKHO_ID = KTK.DUOCKYTONKHO_ID
          WHERE
          KTK.NAM = EXTRACT(YEAR FROM trunc(#THANGTRUOC#))
          AND KTK.THANG = EXTRACT(MONTH FROM trunc(#THANGTRUOC#))
          AND TDK.KHODUOC_ID IN ($LIST_KHODUOC_ID$)
          AND TDK.BENHVIEN_ID = '$BENHVIEN_ID$'
          UNION ALL
          SELECT   CT.KHONHAP_ID AS KHODUOC_ID, CTCT.DUOC_ID, CTCT.SOLONHAP_ID,
          0 AS TONDAUKY, SUM(CTCT.SOLUONGTHUCTE * NVL(CTCT.TYLEQUIDOI,1)) as SOLUONGNHAP, 0 as SOLUONGXUAT
          FROM
          TT_DUOC_CHUNGTU CT INNER JOIN TT_DUOC_CHUNGTU_CHITIET CTCT ON CT.CHUNGTU_ID = CTCT.CHUNGTU_ID
          WHERE
          EXTRACT(MONTH FROM CT.NGAYCHUNGTU) = EXTRACT(MONTH FROM trunc(#THANGTRUOC#))
          AND EXTRACT(YEAR FROM CT.NGAYCHUNGTU) = EXTRACT(YEAR FROM trunc(#THANGTRUOC#))
          AND CT.LOAICHUNGTU = 'N'
          AND CTCT.SOLUONGTHUCTE &gt; 0
          AND CT.TRANGTHAI NOT IN ('PNCNK', 'HUY')
          AND CT.KHONHAP_ID IN ($LIST_KHODUOC_ID$)
          AND CT.BENHVIEN_ID = '$BENHVIEN_ID$'
          GROUP BY CT.KHONHAP_ID, CTCT.DUOC_ID, CTCT.SOLONHAP_ID
          UNION ALL
          SELECT  CT.KHOXUAT_ID AS KHODUOC_ID, CTCT.DUOC_ID, CTCT.SOLONHAP_ID,
          0 AS TONDAUKY, 0 AS SOLUONGNHAP, SUM(CTCT.SOLUONGDAXUAT) as SOLUONGXUAT
          FROM
          TT_DUOC_CHUNGTU CT INNER JOIN TT_DUOC_CHUNGTU_CHITIET CTCT ON CT.CHUNGTU_ID = CTCT.CHUNGTU_ID
          WHERE
          EXTRACT(MONTH FROM CT.NGAYCHUNGTU) = EXTRACT(MONTH FROM trunc(#THANGTRUOC#))
          AND EXTRACT(YEAR FROM CT.NGAYCHUNGTU) = EXTRACT(YEAR FROM trunc(#THANGTRUOC#))
          AND CT.LOAICHUNGTU = 'X'
          AND CTCT.SOLUONGDAXUAT &gt; 0
          AND CT.TRANGTHAI NOT IN ('CX')
          AND CT.KHOXUAT_ID IN ($LIST_KHODUOC_ID$)
          AND CT.BENHVIEN_ID = '$BENHVIEN_ID$'
          GROUP BY CT.KHOXUAT_ID, CTCT.DUOC_ID, CTCT.SOLONHAP_ID
          )TDK GROUP BY KHODUOC_ID, DUOC_ID, SOLONHAP_ID
        </statement>
        <!--Revision:0-->
      <statement id="DAO00030_BoSungTonKhoCacLoKyTruoc" parameterClass="System.Collections.IDictionary" resultClass="System.Int32">          
          insert into TT_DUOC_TONDAUKY(DUOCKYTONKHO_ID, KHODUOC_ID, DUOC_ID, SOLONHAP_ID, SOLUONG, DONGIAMUA, DONGIAVON, BENHVIEN_ID, NGAYTAO, NGUOITAO_ID, NGAYCAPNHAT, NGUOICAPNHAT_ID)
          select #DUOCKYTONKHO_ID# as DUOCKYTONKHO_ID, t1.KHODUOC_ID, t1.DUOC_ID, t1.SOLONHAP_ID, SOLUONG, DONGIAMUA, DONGIAVON, BENHVIEN_ID, SYSDATE, '$NGUOITAO_ID$', SYSDATE, '$NGUOICAPNHAT_ID$'
          from  TT_DUOC_TONDAUKY t1
          where
          t1.DUOCKYTONKHO_ID = #DUOCKYTONKHO_ID# -1
          and t1.KHODUOC_ID in ($LIST_KHODUOC_ID$)
          and 
          (t1.DUOCKYTONKHO_ID, t1.KHODUOC_ID, t1.DUOC_ID, t1.SOLONHAP_ID) NOT IN 
          (
          select t2.DUOCKYTONKHO_ID, t2.KHODUOC_ID, t2.DUOC_ID, t2.SOLONHAP_ID
          from TT_DUOC_TONDAUKY t2
          where t1.SOLONHAP_ID = t2.SOLONHAP_ID
          and t1.KHODUOC_ID = t2.KHODUOC_ID
          and t1.DUOC_ID = t2.DUOC_ID
          and t2.DUOCKYTONKHO_ID = #DUOCKYTONKHO_ID#
          and t2.KHODUOC_ID in ($LIST_KHODUOC_ID$)
          )
        </statement>
        <!--Revision:0-->
        <statement id="DAO00030_TT_DUOC_KYTONKHO_GetKyCuoi" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
            SELECT
            KTK.DUOCKYTONKHO_ID,
            KTK.THANG,
            KTK.NAM,
            TDK.NGAYCAPNHAT as NGAYTAO,
            NV.TENNHANVIEN as NGUOITAO,
            TO_CHAR(KTK.TUNGAY,'DD/MM/YYYY') AS TUNGAY,
            TO_CHAR(KTK.DENNGAY,'DD/MM/YYYY') AS DENNGAY,
            TDK.KHODUOC_ID,
            CASE
            WHEN KS.KHOASO = 1 THEN 'X'
            ELSE ''
            END  AS KHOASO
            FROM
            TT_DUOC_TONDAUKY TDK
            INNER JOIN TT_DUOC_KYTONKHO KTK on TDK.DUOCKYTONKHO_ID = KTK.DUOCKYTONKHO_ID
            LEFT JOIN TT_DUOC_KHOASOCHUNGTU KS on KS.DUOCKYTONKHO_ID = KTK.DUOCKYTONKHO_ID
            LEFT JOIN TM_NHANVIEN NV on TDK.NGUOICAPNHAT_ID = NV.NHANVIEN_ID
            WHERE
            TDK.KHODUOC_ID = '$KHODUOC_ID$'
            and TDK.BENHVIEN_ID = '$BENHVIEN_ID$'
            and ROWNUM = 1
            ORDER BY KTK.DENNGAY DESC
        </statement>
        <!--Revision:0-->
        <statement id="DAO00030_TT_DUOC_KHOASOCHUNGTU_GetTrangThaiKhoSo" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
            SELECT
            CASE
            WHEN KHOASO = 1 THEN 'X'
            ELSE ''
            END  AS KHOASO
            from TT_DUOC_KHOASOCHUNGTU
            where
            KHODUOC_ID = '$KHODUOC_ID$'
            and KYTONKHO ='$KYTONKHO$'
            and BENHVIEN_ID = '$BENHVIEN_ID$'
            and ROWNUM = 1
            ORDER BY DUOCKYTONKHO_ID DESC
        </statement>
        <!--Revision:0-->
        <statement id="DAO00030_TT_DUOC_KYTONKHO_Search" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
            SELECT
            KTK.DUOCKYTONKHO_ID,
            KTK.NGAYTAO,
            NV.TENNHANVIEN as NGUOITAO,
            TO_CHAR(KTK.TUNGAY,'MM/DD/YYYY') AS TUNGAY,
            TO_CHAR(KTK.DENNGAY,'MM/DD/YYYY') AS DENNGAY,
            TDK.KHODUOC_ID
            FROM
            TT_DUOC_TONDAUKY TDK
            INNER JOIN TT_DUOC_KYTONKHO KTK on TDK.DUOCKYTONKHO_ID = KTK.DUOCKYTONKHO_ID
            LEFT JOIN TM_NHANVIEN NV on KTK.NGUOITAO_ID = NV.NHANVIEN_ID
            WHERE
            TDK.KHODUOC_ID = '$KHODUOC_ID$'
            and KTK.THANG =  '$THANG$'
            and KTK.NAM =  '$NAM$'
            and TDK.BENHVIEN_ID = '$BENHVIEN_ID$'
            and ROWNUM = 1
            ORDER BY KTK.DENNGAY DESC
        </statement>
        <!--Revision:0-->
        <statement id="DAO00030_TT_DUOC_TONDAUKY_GetAll" resultClass="DataObject">
            select *
            from TT_DUOC_TONDAUKY
            where BENHVIEN_ID = '$BENHVIEN_ID$'
            order by DUOCTONDAUKY_ID
        </statement>
        <!--Revision:0-->
        <statement id="DAO00030_TT_DUOC_TONDAUKY_GetList" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
            select *
            from TT_DUOC_TONDAUKY
            <dynamic prepend="where">
                <isParameterPresent>
                    <isNotEmpty prepend="and" property="DUOCTONDAUKY_ID">
                        TT_DUOC_TONDAUKY.DUOCTONDAUKY_ID = '$DUOCTONDAUKY_ID$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="DUOCKYTONKHO_ID">
                        TT_DUOC_TONDAUKY.DUOCKYTONKHO_ID = '$DUOCKYTONKHO_ID$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="KHODUOC_ID">
                        TT_DUOC_TONDAUKY.KHODUOC_ID = '$KHODUOC_ID$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="DUOC_ID">
                        TT_DUOC_TONDAUKY.DUOC_ID = '$DUOC_ID$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="SOLONHAP_ID">
                        TT_DUOC_TONDAUKY.SOLONHAP_ID = '$SOLONHAP_ID$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="DONGIAMUA">
                        TT_DUOC_TONDAUKY.DONGIAMUA = '$DONGIAMUA$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="DONGIAVON">
                        TT_DUOC_TONDAUKY.DONGIAVON = '$DONGIAVON$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="SOLUONG">
                        TT_DUOC_TONDAUKY.SOLUONG = '$SOLUONG$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="BENHVIEN_ID">
                        TT_DUOC_TONDAUKY.BENHVIEN_ID = '$BENHVIEN_ID$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="NGAYTAO">
                        TT_DUOC_TONDAUKY.NGAYTAO = '$NGAYTAO$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="NGUOITAO_ID">
                        TT_DUOC_TONDAUKY.NGUOITAO_ID = '$NGUOITAO_ID$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="NGAYCAPNHAT">
                        TT_DUOC_TONDAUKY.NGAYCAPNHAT = '$NGAYCAPNHAT$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="NGUOICAPNHAT_ID">
                        TT_DUOC_TONDAUKY.NGUOICAPNHAT_ID = '$NGUOICAPNHAT_ID$'
                    </isNotEmpty>
                </isParameterPresent>
            </dynamic>
            order by DUOCTONDAUKY_ID
        </statement>
        <!--Revision:0-->
        <statement id="DAO00030_TT_DUOC_TONDAUKY_GetDetail" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
            select *
            from TT_DUOC_TONDAUKY
            where TT_DUOC_TONDAUKY.DUOCTONDAUKY_ID  = '$value$'
            and BENHVIEN_ID = '$BENHVIEN_ID$'
            order by DUOCTONDAUKY_ID
        </statement>
        <!--Revision:0-->
        <statement id="DAO00030_TT_DUOC_TONDAUKY_GetDetailP" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
            select *
            from TT_DUOC_TONDAUKY
            where TT_DUOC_TONDAUKY.DUOCTONDAUKY_ID  = '$DUOCTONDAUKY_ID$'
            and BENHVIEN_ID = '$BENHVIEN_ID$'
            order by DUOCTONDAUKY_ID
        </statement>
        <!--Revision:0-->
        <statement id="DAO00030_TT_DUOC_TONDAUKY_Add" parameterClass="System.Collections.IDictionary" resultClass="System.Int64">
            delete
            from TT_DUOC_TONDAUKY
            where
            DUOCKYTONKHO_ID = #DUOCKYTONKHO_ID#
            and KHODUOC_ID = #KHODUOC_ID#
            and DUOC_ID = #DUOC_ID#
            and SOLONHAP_ID = #SOLONHAP_ID#
            and BENHVIEN_ID = '$BENHVIEN_ID$'
            insert into TT_DUOC_TONDAUKY (
            DUOCKYTONKHO_ID
            , KHODUOC_ID
            , DUOC_ID
            , SOLONHAP_ID
            , DONGIAMUA
            , DONGIAVON
            , SOLUONG
            , BENHVIEN_ID
            , NGAYTAO
            , NGUOITAO_ID
            , NGAYCAPNHAT
            , NGUOICAPNHAT_ID
            ) values (
            #DUOCKYTONKHO_ID#
            , #KHODUOC_ID#
            , #DUOC_ID#
            , #SOLONHAP_ID#
            , #DONGIAMUA#
            , #DONGIAVON#
            , #SOLUONG#
            , #BENHVIEN_ID#
            , #NGAYTAO#
            , #NGUOITAO_ID#
            , #NGAYCAPNHAT#
            , #NGUOICAPNHAT_ID#
            )
        </statement>
        <!--Revision:0-->
        <update id="DAO00030_TT_DUOC_TONDAUKY_Update" parameterClass="System.Collections.IDictionary">
            update TT_DUOC_TONDAUKY set
            DUOCKYTONKHO_ID = #DUOCKYTONKHO_ID#
            , KHODUOC_ID = #KHODUOC_ID#
            , DUOC_ID = #DUOC_ID#
            , SOLONHAP_ID = #SOLONHAP_ID#
            , DONGIAMUA = #DONGIAMUA#
            , DONGIAVON = #DONGIAVON#
            , SOLUONG = #SOLUONG#
            <!--, BENHVIEN_ID = #BENHVIEN_ID#
    , NGAYTAO = #NGAYTAO#
    , NGUOITAO_ID = #NGUOITAO_ID#-->
            , NGAYCAPNHAT = #NGAYCAPNHAT#
            , NGUOICAPNHAT_ID = #NGUOICAPNHAT_ID#
            where
            DUOCTONDAUKY_ID = '$DUOCTONDAUKY_ID$'
        </update>
        <!--Revision:0-->
        <statement id="DAO00030_TT_DUOC_TONDAUKY_Delete" parameterClass="System.Collections.IDictionary" resultClass="System.Int32">
            delete from TT_DUOC_TONDAUKY
            where
            DUOCTONDAUKY_ID = '$DUOCTONDAUKY_ID$'
        </statement>
        <!--Revision:0-->
        <statement id="DAO00030_TT_DUOC_TONDAUKY_DeleteP" parameterClass="System.Collections.IDictionary" resultClass="System.Int32">
            delete from TT_DUOC_TONDAUKY
            <dynamic prepend="where">
                <isParameterPresent>
                    <isNotEmpty prepend="and" property="DUOCTONDAUKY_ID">
                        TT_DUOC_TONDAUKY.DUOCTONDAUKY_ID = '$DUOCTONDAUKY_ID$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="DUOCKYTONKHO_ID">
                        TT_DUOC_TONDAUKY.DUOCKYTONKHO_ID = '$DUOCKYTONKHO_ID$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="KHODUOC_ID">
                        TT_DUOC_TONDAUKY.KHODUOC_ID = '$KHODUOC_ID$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="DUOC_ID">
                        TT_DUOC_TONDAUKY.DUOC_ID = '$DUOC_ID$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="SOLONHAP_ID">
                        TT_DUOC_TONDAUKY.SOLONHAP_ID = '$SOLONHAP_ID$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="DONGIAMUA">
                        TT_DUOC_TONDAUKY.DONGIAMUA = '$DONGIAMUA$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="DONGIAVON">
                        TT_DUOC_TONDAUKY.DONGIAVON = '$DONGIAVON$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="SOLUONG">
                        TT_DUOC_TONDAUKY.SOLUONG = '$SOLUONG$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="BENHVIEN_ID">
                        TT_DUOC_TONDAUKY.BENHVIEN_ID = '$BENHVIEN_ID$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="NGAYTAO">
                        TT_DUOC_TONDAUKY.NGAYTAO = '$NGAYTAO$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="NGUOITAO_ID">
                        TT_DUOC_TONDAUKY.NGUOITAO_ID = '$NGUOITAO_ID$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="NGAYCAPNHAT">
                        TT_DUOC_TONDAUKY.NGAYCAPNHAT = '$NGAYCAPNHAT$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="NGUOICAPNHAT_ID">
                        TT_DUOC_TONDAUKY.NGUOICAPNHAT_ID = '$NGUOICAPNHAT_ID$'
                    </isNotEmpty>
                </isParameterPresent>
            </dynamic>
        </statement>
        <!--Revision:0-->
        <statement id="DAO00030_TT_DUOC_KHOASOCHUNGTU_GetKyCuoi" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
            SELECT
            KSCT.DUOCKHOASOCHUNGTU_ID,
            KTK.DUOCKYTONKHO_ID,
            KSCT.KHOASO,
            KTK.TUNGAY,
            KSCT.KHOADENNGAY as DENNGAY,
            KSCT.KHODUOC_ID,
            KSCT.NGUOIKHOA_ID,
            NVK.TENNHANVIEN as NGUOIKHOA,
            KSCT.NGAYKHOA,
            KSCT.NGUOIMO_ID,
            NVM.TENNHANVIEN as NGUOIMO,
            KSCT.NGAYMO
            FROM
            TT_DUOC_KHOASOCHUNGTU KSCT
            inner join TT_DUOC_KYTONKHO KTK on KSCT.DUOCKYTONKHO_ID = KTK.DUOCKYTONKHO_ID
            left join TM_NHANVIEN NVK on NVK.NHANVIEN_ID = KSCT.NGUOIKHOA_ID
            left join TM_NHANVIEN NVM on NVM.NHANVIEN_ID = KSCT.NGUOIMO_ID
            WHERE
            KHODUOC_ID = '$KHODUOC_ID$'
            AND KTK.THANG = '$THANG$'
            AND KTK.NAM = '$NAM$'
            AND KSCT.BENHVIEN_ID = '$BENHVIEN_ID$'
            AND ROWNUM = 1
            ORDER BY KTK.DENNGAY DESC
        </statement>
        <!--Revision:0-->
        <statement id="DAO00030_TT_DUOC_KHOASOCHUNGTU_LayKyChuaKhoaSo" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
            SELECT * FROM
            (
            SELECT
            KSCT.DUOCKHOASOCHUNGTU_ID,
            KSCT.KHODUOC_ID,
            KTK.THANG,
            KTK.NAM,
            EXTRACT(MONTH FROM trunc(#NGAYKIEMTRA#))	 - KTK.THANG + ((EXTRACT(YEAR FROM trunc(#NGAYKIEMTRA#) ) - KTK.NAM)*12 ) as KHOANGCACHTHANG,
            EXTRACT(YEAR FROM trunc(#NGAYKIEMTRA#))  - KTK.NAM as KHOANGCACHNAM
            FROM
            TT_DUOC_KHOASOCHUNGTU KSCT
            inner join TT_DUOC_KYTONKHO KTK on KSCT.DUOCKYTONKHO_ID = KTK.DUOCKYTONKHO_ID
            WHERE
            KHODUOC_ID = '$KHODUOC_ID$'                        
            AND trunc(KSCT.KHOADENNGAY) &lt;=  trunc(#NGAYKIEMTRA#) 
            AND KSCT.KHOASO = 1
            AND KSCT.BENHVIEN_ID = '$BENHVIEN_ID$'
            AND ROWNUM = 1
            ORDER BY KTK.DENNGAY DESC
          )a
          where
          KHOANGCACHTHANG &gt; 1
        </statement>
        <!--Revision:0-->
        <statement id="DAO00030_TT_DUOC_KHOASOCHUNGTU_LayKhoChuaTungKhoaSo" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
          SELECT
          EXTRACT(MONTH FROM NGAYCHUNGTU) AS THANG,  EXTRACT(YEAR FROM NGAYCHUNGTU) AS NAM
          FROM
          TT_DUOC_CHUNGTU
          WHERE
          ((KHONHAP_ID = '$KHODUOC_ID$' AND LOAICHUNGTU = 'N') OR (KHOXUAT_ID = '$KHODUOC_ID$' AND LOAICHUNGTU = 'X'))
          AND KHONHAP_ID NOT IN (SELECT DISTINCT KHODUOC_ID FROM TT_DUOC_KHOASOCHUNGTU WHERE KHODUOC_ID = '$KHODUOC_ID$' and BENHVIEN_ID = '$BENHVIEN_ID$')
          AND KHOXUAT_ID NOT IN (SELECT DISTINCT KHODUOC_ID FROM TT_DUOC_KHOASOCHUNGTU WHERE KHODUOC_ID = '$KHODUOC_ID$' and BENHVIEN_ID = '$BENHVIEN_ID$')
          AND ROWNUM = 1
          AND BENHVIEN_ID = '$BENHVIEN_ID$'
          ORDER BY NGAYCHUNGTU ASC
        </statement>
        <!--Revision:0-->
        <statement id="DAO00030_TT_DUOC_KHOASOCHUNGTU_LayKyDaKhoaSo" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
            SELECT * FROM
            (
            SELECT
            KSCT.DUOCKHOASOCHUNGTU_ID,
            KSCT.KHODUOC_ID,
            KTK.THANG,
            KTK.NAM,
            KTK.THANG - EXTRACT(MONTH FROM trunc(#NGAYKIEMTRA#)) + ((KTK.NAM - EXTRACT(YEAR FROM trunc(#NGAYKIEMTRA#)))*12 ) as KHOANGCACHTHANG,
            KTK.NAM - EXTRACT(YEAR FROM trunc(#NGAYKIEMTRA#)) as KHOANGCACHNAM
            FROM
            TT_DUOC_KHOASOCHUNGTU KSCT
            inner join TT_DUOC_KYTONKHO KTK on KSCT.DUOCKYTONKHO_ID = KTK.DUOCKYTONKHO_ID
            WHERE
            KHODUOC_ID = '$KHODUOC_ID$'                        
            AND trunc(KSCT.KHOADENNGAY) &lt;=  trunc(#NGAYKIEMTRA#)
            AND KSCT.KHOASO = 1
            AND KSCT.BENHVIEN_ID = '$BENHVIEN_ID$'
            AND ROWNUM = 1
            ORDER BY KTK.DENNGAY DESC
          )a
          where
          KHOANGCACHTHANG &gt; 0
        </statement>
        <!--Revision:0-->
        <statement id="DAO00030_TT_DUOC_KHOASOCHUNGTU_GetAll" resultClass="DataObject">
            select *
            from TT_DUOC_KHOASOCHUNGTU
            where BENHVIEN_ID = '$BENHVIEN_ID$'
            order by DUOCKHOASOCHUNGTU_ID
        </statement>
        <!--Revision:0-->
        <statement id="DAO00030_TT_DUOC_KHOASOCHUNGTU_GetList" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
            select *
            from TT_DUOC_KHOASOCHUNGTU
            <dynamic prepend="where">
                <isParameterPresent>
                    <isNotEmpty prepend="and" property="DUOCKHOASOCHUNGTU_ID">
                        TT_DUOC_KHOASOCHUNGTU.DUOCKHOASOCHUNGTU_ID = '$DUOCKHOASOCHUNGTU_ID$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="DUOCKYTONKHO_ID">
                        TT_DUOC_KHOASOCHUNGTU.DUOCKYTONKHO_ID = '$DUOCKYTONKHO_ID$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="KHODUOC_ID">
                        TT_DUOC_KHOASOCHUNGTU.KHODUOC_ID = '$KHODUOC_ID$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="KHOASO">
                        TT_DUOC_KHOASOCHUNGTU.KHOASO = '$KHOASO$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="NGAYKHOA">
                        TT_DUOC_KHOASOCHUNGTU.NGAYKHOA = '$NGAYKHOA$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="NGUOIKHOA_ID">
                        TT_DUOC_KHOASOCHUNGTU.NGUOIKHOA_ID = '$NGUOIKHOA_ID$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="NGAYMO">
                        TT_DUOC_KHOASOCHUNGTU.NGAYMO = '$NGAYMO$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="NGUOIMO_ID">
                        TT_DUOC_KHOASOCHUNGTU.NGUOIMO_ID = '$NGUOIMO_ID$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="NGAYTAO">
                        TT_DUOC_KHOASOCHUNGTU.NGAYTAO = '$NGAYTAO$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="NGUOITAO_ID">
                        TT_DUOC_KHOASOCHUNGTU.NGUOITAO_ID = '$NGUOITAO_ID$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="BENHVIEN_ID">
                        TT_DUOC_KHOASOCHUNGTU.BENHVIEN_ID = '$BENHVIEN_ID$'
                    </isNotEmpty>
                </isParameterPresent>
            </dynamic>
            order by DUOCKHOASOCHUNGTU_ID
        </statement>
        <!--Revision:0-->
        <statement id="DAO00030_TT_DUOC_KHOASOCHUNGTU_GetDetail" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
            select *
            from TT_DUOC_KHOASOCHUNGTU
            where TT_DUOC_KHOASOCHUNGTU.DUOCKHOASOCHUNGTU_ID  = '$value$'
            and BENHVIEN_ID = '$BENHVIEN_ID$'
            order by DUOCKHOASOCHUNGTU_ID
        </statement>
        <!--Revision:0-->
        <statement id="DAO00030_TT_DUOC_KHOASOCHUNGTU_GetDetailP" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
            select *
            from TT_DUOC_KHOASOCHUNGTU
            where TT_DUOC_KHOASOCHUNGTU.DUOCKHOASOCHUNGTU_ID  = '$DUOCKHOASOCHUNGTU_ID$'
            and BENHVIEN_ID = '$BENHVIEN_ID$'
            order by DUOCKHOASOCHUNGTU_ID
        </statement>
        <!--Revision:0-->
        <statement id="DAO00030_TT_DUOC_KHOASOCHUNGTU_Add" parameterClass="System.Collections.IDictionary" resultClass="System.Int64">
            insert into TT_DUOC_KHOASOCHUNGTU (
            DUOCKYTONKHO_ID
            , KHODUOC_ID
            , KYTONKHO
            , KHOADENNGAY
            , KHOASO
            , NGAYKHOA
            , NGUOIKHOA_ID
            , NGAYMO
            , NGUOIMO_ID
            , NGAYTAO
            , NGUOITAO_ID
            , BENHVIEN_ID
            ) values (
            #DUOCKYTONKHO_ID#
            , #KHODUOC_ID#
            , #KYTONKHO#
            , #KHOADENNGAY#
            , #KHOASO#
            , #NGAYKHOA#
            , #NGUOIKHOA_ID#
            , #NGAYMO#
            , #NGUOIMO_ID#
            , #NGAYTAO#
            , #NGUOITAO_ID#
            , #BENHVIEN_ID#
            )
        </statement>
        <!--Revision:0-->
        <update id="DAO00030_TT_DUOC_KHOASOCHUNGTU_Upd" parameterClass="System.Collections.IDictionary">
            update TT_DUOC_KHOASOCHUNGTU set
            KHOADENNGAY = #KHOADENNGAY#
            , KHOASO = #KHOASO#
            , NGAYKHOA = #NGAYKHOA#
            , NGUOIKHOA_ID = #NGUOIKHOA_ID#
            , NGAYMO = null
            , NGUOIMO_ID = null
            where
            DUOCKHOASOCHUNGTU_ID = '$DUOCKHOASOCHUNGTU_ID$'
        </update>
        <!--Revision:0-->
        <statement id="DAO00030_TT_DUOC_KHOASOCHUNGTU_MoSo" parameterClass="System.Collections.IDictionary" resultClass="System.Int32">
            update TT_DUOC_KHOASOCHUNGTU
            set
            KHOASO = '0'
            , NGAYMO = #NGAYMO#
            , NGUOIMO_ID = #NGUOIMO_ID#
            where
            DUOCKHOASOCHUNGTU_ID
            IN
            (
            select
            DUOCKHOASOCHUNGTU_ID
            from
            TT_DUOC_KHOASOCHUNGTU
            where
            KYTONKHO = '$KYTONKHO$'
            AND KHOASO = '1'
            and BENHVIEN_ID ='$BENHVIEN_ID$'
            AND KHODUOC_ID IN ($LIST_KHODUOC_ID$)
            )
        </statement>
        <!--Revision:0-->
        <statement id="DAO00030_CHUNGTUCT_GetChiTietThanhLy" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
            SELECT A.*, NVL(B.TONGTON, 0) TONGTON FROM
            (
            SELECT
            CT.KHOXUAT_ID, CT.KHONHAP_ID, CT.MACHUNGTU, CT.NGUOIGIAO_ID, CT.NGUOINHAN_ID, CT.SOCHUNGTUGOC,
            CTCT.DUOC_ID, CTCT.NGUONHANG_ID AS NGUONDUOC_ID, CTCT.SOLUONGTHUCTE, CTCT.SOLUONGDAXUAT, CTCT.GHICHUCHITIET, CTCT.THANHTIENMUA as THANHTIEN,
            SLN.SOLONHAP_ID, SLN.SOLONHAP, SLN.SOLOSANPHAM, SLN.SOKIEMSOAT, SLN.SOVISA, SLN.HANDUNG AS HANSUDUNG, SLN.NGAYNHAP,
            TK.SOLUONG, GB.DONGIAVON AS DONGIAMUA
            FROM
            TT_DUOC_CHUNGTU CT, TT_DUOC_CHUNGTU_CHITIET CTCT, TT_DUOC_TONKHO TK, TT_DUOC_CHUNGTU_SOLONHAP SLN, TT_DUOC_SOLONHAP_GIABAN GB
            WHERE
            CT.CHUNGTU_ID = CTCT.CHUNGTU_ID
            AND CTCT.DUOC_ID = TK.DUOC_ID
            AND CTCT.SOLONHAP_ID = SLN.SOLONHAP_ID
            AND SLN.SOLONHAP_ID = GB.SOLONHAP_ID
            AND TK.KHODUOC_ID = CT.KHOXUAT_ID
            AND TK.SOLONHAP_ID = SLN.SOLONHAP_ID
            AND CT.MACHUNGTU = '$MACHUNGTU$'
            AND CT.BENHVIEN_ID = '$BENHVIEN_ID$'
            )A left join
            (
            SELECT
            CTCT.DUOC_ID AS DUOC_ID, SUM(SOLUONG) AS TONGTON
            FROM
            TT_DUOC_TONKHO TK, TT_DUOC_CHUNGTU_CHITIET CTCT, TT_DUOC_CHUNGTU CT
            WHERE
            TK.KHODUOC_ID = CT.KHOXUAT_ID
            AND CT.CHUNGTU_ID = CTCT.CHUNGTU_ID
            AND CTCT.DUOC_ID = TK.DUOC_ID
            AND CT.MACHUNGTU = '$MACHUNGTU$'
            AND CT.BENHVIEN_ID = '$BENHVIEN_ID$'
            GROUP BY TK.KHODUOC_ID, CTCT.DUOC_ID
            ) B on A.DUOC_ID = B.DUOC_ID
            ORDER BY DUOC_ID
        </statement>
        <!--Revision:0-->
        <statement id="DAO00030_TT_DUOC_BenhNhanTra" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
            select CTCT.*
            from
            TT_DUOC_CHUNGTU CT, TT_DUOC_CHUNGTU_CHITIET CTCT
            where
            CT.CHUNGTU_ID = CTCT.CHUNGTU_ID
            AND CT.BENHVIEN_ID = '$BENHVIEN_ID$'
            and CT.CHUNGTU_ID IN ($LIST_CHUNGTU_ID$)
        </statement>
        <!--Revision:0-->
        <update id="DAO00030_Update_PhieuTraCuaBenhNhan" parameterClass="System.Collections.IDictionary">
            update TT_DUOC_CHUNGTU
            set
            TRANGTHAI = 'LAPPHIEUTRANOIBO'
            where
            CHUNGTU_ID IN ($LIST_CHUNGTU_ID$)
        </update>
        <!--Revision:0-->
        <statement id="DAO00030_TT_DUOC_XuatThuocVTYT" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
          SELECT TOATHUOC_NGOAITRU.DUOC_ID, NVL(TONKHO.SOLUONG,0) AS SOTON,
          NVL(TOATHUOC_NGOAITRU.SOLUONG,0) || NVL(TOATHUOC_NOITRU.SOLUONG,0) AS SOLUONGTONGHOP
          FROM
          (
          SELECT
          DUOC_ID,
          SUM(SOLUONG) AS SOLUONG
          FROM
          TT_NGOAITRU_TOATHUOC
          WHERE
          TRANGTHAI = 'CHUAXUAT'
          AND BENHVIEN_ID = '$BENHVIEN_ID$'
          AND trunc(NGAYTAO) BETWEEN  trunc(#TONGHOP_TUNGAY#) and  trunc(#TONGHOP_DENNGAY#)
          GROUP BY DUOC_ID
          )TOATHUOC_NGOAITRU
          LEFT JOIN
          (
          SELECT
          DUOC_ID,
          SUM(SOLUONG) AS SOLUONG
          FROM TT_NOITRU_TOATHUOC
          WHERE
          TRANGTHAI = 'CHUAXUAT'
          AND BENHVIEN_ID = '$BENHVIEN_ID$'          
          AND trunc(NGAYTAO) BETWEEN  trunc(#TONGHOP_TUNGAY#) and  trunc(#TONGHOP_DENNGAY#)
          GROUP BY DUOC_ID
          )TOATHUOC_NOITRU
          ON TOATHUOC_NGOAITRU.DUOC_ID = TOATHUOC_NOITRU.DUOC_ID
          LEFT JOIN
          (
          SELECT
          DUOC_ID,
          SUM(SOLUONG) AS SOLUONG
          FROM TT_DUOC_TONKHO
          WHERE
          KHODUOC_ID = '$KHODUOC_ID$'
          AND BENHVIEN_ID = '$BENHVIEN_ID$'
          GROUP BY
          DUOC_ID
          )TONKHO
          ON TONKHO.DUOC_ID = TOATHUOC_NOITRU.DUOC_ID OR TONKHO.DUOC_ID = TOATHUOC_NGOAITRU.DUOC_ID
        </statement>
        <!--Revision:0-->
        <statement id="DAO00030_TT_DUOC_TONKHO_GetListKiemKe" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
          select TK.DUOC_ID, TO_CHAR(D.TENDUOCDAYDU) TENDUOCDAYDU , D.DONVITINH, D.DONVITINH_ID, sum(TK.SOLUONG) as SOLUONG
          from TT_DUOC_TONKHO TK
          inner join TM_DUOC D on D.DUOC_ID =  TK.DUOC_ID
          WHERE
          TK.KHODUOC_ID =  '$KHODUOC_ID$'
          AND TK.BENHVIEN_ID = '$BENHVIEN_ID$'          
          AND trunc(TK.NGAYTAO) BETWEEN  trunc(#TUNGAY#) and  trunc(#DENNGAY#)
          GROUP BY TK.DUOC_ID, TO_CHAR(D.TENDUOCDAYDU)  , D.DONVITINH, D.DONVITINH_ID
          ORDER BY TENDUOCDAYDU
        </statement>
        <!--Revision:0-->
        <statement id="DAO00030_TT_DUOC_KIEMKE_CheckExist" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
            SELECT KK.*, TO_CHAR(D.TENDUOCDAYDU) TENDUOCDAYDU , D.DONVITINH
            FROM TT_DUOC_KIEMKE KK
            INNER JOIN TT_DUOC_KYTONKHO KTK ON KK.DUOCKYKIEMKE_ID = KTK.DUOCKYTONKHO_ID
            INNER JOIN TM_DUOC D on D.DUOC_ID =  KK.DUOC_ID
            WHERE
            KTK.MAKYTONKHO = '$MAKYTONKHO$'
            AND KK.KHODUOC_ID = '$KHODUOC_ID$'
            AND KK.BENHVIEN_ID = '$BENHVIEN_ID$'
            order by
            TENDUOCDAYDU
        </statement>
        <!--Revision:0-->
        <statement id="DAO00030_TT_DUOC_KIEMKE_GetAll" resultClass="DataObject">
            select *
            from TT_DUOC_KIEMKE
            where CT.BENHVIEN_ID = '$BENHVIEN_ID$'
            order by DUOCKIEMKE_ID
        </statement>
        <!--Revision:0-->
        <statement id="DAO00030_TT_DUOC_KIEMKE_GetList" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
            select *
            from TT_DUOC_KIEMKE
            <dynamic prepend="where">
                <isParameterPresent>
                    <isNotEmpty prepend="and" property="DUOCKIEMKE_ID">
                        TT_DUOC_KIEMKE.DUOCKIEMKE_ID = '$DUOCKIEMKE_ID$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="DUOCKYKIEMKE_ID">
                        TT_DUOC_KIEMKE.DUOCKYKIEMKE_ID = '$DUOCKYKIEMKE_ID$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="KHODUOC_ID">
                        TT_DUOC_KIEMKE.KHODUOC_ID = '$KHODUOC_ID$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="DUOC_ID">
                        TT_DUOC_KIEMKE.DUOC_ID = '$DUOC_ID$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="SOLONHAP_ID">
                        TT_DUOC_KIEMKE.SOLONHAP_ID = '$SOLONHAP_ID$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="DONGIAMUA">
                        TT_DUOC_KIEMKE.DONGIAMUA = '$DONGIAMUA$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="DONGIAVON">
                        TT_DUOC_KIEMKE.DONGIAVON = '$DONGIAVON$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="SOLUONG">
                        TT_DUOC_KIEMKE.SOLUONG = '$SOLUONG$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="TENDUOC">
                        TT_DUOC_KIEMKE.TENDUOC = '$TENDUOC$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="DONVITINH_ID">
                        TT_DUOC_KIEMKE.DONVITINH_ID = '$DONVITINH_ID$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="SOKIEMSOAT">
                        TT_DUOC_KIEMKE.SOKIEMSOAT = '$SOKIEMSOAT$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="NUOCSX">
                        TT_DUOC_KIEMKE.NUOCSX = '$NUOCSX$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="THANHTIEN">
                        TT_DUOC_KIEMKE.THANHTIEN = '$THANHTIEN$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="SOTHUCTE">
                        TT_DUOC_KIEMKE.SOTHUCTE = '$SOTHUCTE$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="THUA">
                        TT_DUOC_KIEMKE.THUA = '$THUA$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="THIEU">
                        TT_DUOC_KIEMKE.THIEU = '$THIEU$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="HONG">
                        TT_DUOC_KIEMKE.HONG = '$HONG$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="GHICHU">
                        TT_DUOC_KIEMKE.GHICHU = '$GHICHU$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="NGAYTAO">
                        TT_DUOC_KIEMKE.NGAYTAO = '$NGAYTAO$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="NGUOITAO_ID">
                        TT_DUOC_KIEMKE.NGUOITAO_ID = '$NGUOITAO_ID$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="NGAYCAPNHAT">
                        TT_DUOC_KIEMKE.NGAYCAPNHAT = '$NGAYCAPNHAT$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="NGUOICAPNHAT_ID">
                        TT_DUOC_KIEMKE.NGUOICAPNHAT_ID = '$NGUOICAPNHAT_ID$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="BENHVIEN_ID">
                        TT_DUOC_KIEMKE.BENHVIEN_ID = '$BENHVIEN_ID$'
                    </isNotEmpty>
                </isParameterPresent>
            </dynamic>
            order by DUOCKIEMKE_ID
        </statement>
        <!--Revision:0-->
        <statement id="DAO00030_TT_DUOC_KIEMKE_GetDetail" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
            select *
            from TT_DUOC_KIEMKE
            where TT_DUOC_KIEMKE.DUOCKIEMKE_ID  = '$value$'
            and BENHVIEN_ID = '$BENHVIEN_ID$'
            order by DUOCKIEMKE_ID
        </statement>
        <!--Revision:0-->
        <statement id="DAO00030_TT_DUOC_KIEMKE_GetDetailP" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
            select *
            from TT_DUOC_KIEMKE
            where TT_DUOC_KIEMKE.DUOCKIEMKE_ID  = '$DUOCKIEMKE_ID$'
            and BENHVIEN_ID = '$BENHVIEN_ID$'
            order by DUOCKIEMKE_ID
        </statement>
        <!--Revision:0-->
        <statement id="DAO00030_TT_DUOC_KIEMKE_Add" parameterClass="System.Collections.IDictionary" resultClass="System.Int64">
            insert into TT_DUOC_KIEMKE (
            DUOCKYKIEMKE_ID
            , HOIDONGKIEMKE_ID
            , KHODUOC_ID
            , DUOC_ID
            , SOLONHAP_ID
            , DONGIAMUA
            , DONGIAVON
            , SOLUONG
            , TENDUOC
            , DONVITINH_ID
            , SOKIEMSOAT
            , NUOCSX
            , THANHTIEN
            , SOTHUCTE
            , THUA
            , THIEU
            , HONG
            , KIEMKETUNGAY
            , KIEMKEDENNGAY
            , GHICHU
            , NGAYTAO
            , NGUOITAO_ID
            , NGAYCAPNHAT
            , NGUOICAPNHAT_ID
            , BENHVIEN_ID
            ) values (
            #DUOCKYKIEMKE_ID#
            , #HOIDONGKIEMKE_ID#
            , #KHODUOC_ID#
            , #DUOC_ID#
            , #SOLONHAP_ID#
            , #DONGIAMUA#
            , #DONGIAVON#
            , #SOLUONG#
            , #TENDUOC#
            , #DONVITINH_ID#
            , #SOKIEMSOAT#
            , #NUOCSX#
            , #THANHTIEN#
            , #SOTHUCTE#
            , #THUA#
            , #THIEU#
            , #HONG#
            , #KIEMKETUNGAY#
            , #KIEMKEDENNGAY#
            , #GHICHU#
            , #NGAYTAO#
            , #NGUOITAO_ID#
            , #NGAYCAPNHAT#
            , #NGUOICAPNHAT_ID#
            , #BENHVIEN_ID#
            )
        </statement>
        <!--Revision:0-->
        <update id="DAO00030_TT_DUOC_KIEMKE_Update" parameterClass="System.Collections.IDictionary">
            update TT_DUOC_KIEMKE set
            DUOCKYKIEMKE_ID = #DUOCKYKIEMKE_ID#
            , HOIDONGKIEMKE_ID = #HOIDONGKIEMKE_ID#
            , KHODUOC_ID = #KHODUOC_ID#
            , DUOC_ID = #DUOC_ID#
            , SOLONHAP_ID = #SOLONHAP_ID#
            , DONGIAMUA = #DONGIAMUA#
            , DONGIAVON = #DONGIAVON#
            , SOLUONG = #SOLUONG#
            , TENDUOC = #TENDUOC#
            , DONVITINH_ID = #DONVITINH_ID#
            , SOKIEMSOAT = #SOKIEMSOAT#
            , NUOCSX = #NUOCSX#
            , THANHTIEN = #THANHTIEN#
            , SOTHUCTE = #SOTHUCTE#
            , THUA = #THUA#
            , THIEU = #THIEU#
            , HONG = #HONG#
            , GHICHU = #GHICHU#
            , KIEMKETUNGAY = #KIEMKETUNGAY#
            , KIEMKEDENNGAY = #KIEMKEDENNGAY#
            <!--, NGAYTAO = #NGAYTAO#
      , NGUOITAO_ID = #NGUOITAO_ID#-->
            , NGAYCAPNHAT = #NGAYCAPNHAT#
            , NGUOICAPNHAT_ID = #NGUOICAPNHAT_ID#
            , BENHVIEN_ID = #BENHVIEN_ID#
            where
            DUOCKIEMKE_ID = '$DUOCKIEMKE_ID$'
        </update>
        <!--Revision:0-->
        <statement id="DAO00030_TT_DUOC_KIEMKE_Delete" parameterClass="System.Collections.IDictionary" resultClass="System.Int32">
            delete from TT_DUOC_KIEMKE
            where
            DUOCKIEMKE_ID = '$DUOCKIEMKE_ID$'
        </statement>
        <!--Revision:0-->
        <statement id="DAO00030_TT_DUOC_KIEMKE_DeleteP" parameterClass="System.Collections.IDictionary" resultClass="System.Int32">
            delete from TT_DUOC_KIEMKE
            <dynamic prepend="where">
                <isParameterPresent>
                    <isNotEmpty prepend="and" property="DUOCKIEMKE_ID">
                        TT_DUOC_KIEMKE.DUOCKIEMKE_ID = '$DUOCKIEMKE_ID$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="DUOCKYKIEMKE_ID">
                        TT_DUOC_KIEMKE.DUOCKYKIEMKE_ID = '$DUOCKYKIEMKE_ID$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="KHODUOC_ID">
                        TT_DUOC_KIEMKE.KHODUOC_ID = '$KHODUOC_ID$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="DUOC_ID">
                        TT_DUOC_KIEMKE.DUOC_ID = '$DUOC_ID$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="SOLONHAP_ID">
                        TT_DUOC_KIEMKE.SOLONHAP_ID = '$SOLONHAP_ID$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="DONGIAMUA">
                        TT_DUOC_KIEMKE.DONGIAMUA = '$DONGIAMUA$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="DONGIAVON">
                        TT_DUOC_KIEMKE.DONGIAVON = '$DONGIAVON$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="SOLUONG">
                        TT_DUOC_KIEMKE.SOLUONG = '$SOLUONG$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="TENDUOC">
                        TT_DUOC_KIEMKE.TENDUOC = '$TENDUOC$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="DONVITINH_ID">
                        TT_DUOC_KIEMKE.DONVITINH_ID = '$DONVITINH_ID$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="SOKIEMSOAT">
                        TT_DUOC_KIEMKE.SOKIEMSOAT = '$SOKIEMSOAT$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="NUOCSX">
                        TT_DUOC_KIEMKE.NUOCSX = '$NUOCSX$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="THANHTIEN">
                        TT_DUOC_KIEMKE.THANHTIEN = '$THANHTIEN$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="SOTHUCTE">
                        TT_DUOC_KIEMKE.SOTHUCTE = '$SOTHUCTE$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="THUA">
                        TT_DUOC_KIEMKE.THUA = '$THUA$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="THIEU">
                        TT_DUOC_KIEMKE.THIEU = '$THIEU$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="HONG">
                        TT_DUOC_KIEMKE.HONG = '$HONG$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="GHICHU">
                        TT_DUOC_KIEMKE.GHICHU = '$GHICHU$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="NGAYTAO">
                        TT_DUOC_KIEMKE.NGAYTAO = '$NGAYTAO$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="NGUOITAO_ID">
                        TT_DUOC_KIEMKE.NGUOITAO_ID = '$NGUOITAO_ID$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="NGAYCAPNHAT">
                        TT_DUOC_KIEMKE.NGAYCAPNHAT = '$NGAYCAPNHAT$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="NGUOICAPNHAT_ID">
                        TT_DUOC_KIEMKE.NGUOICAPNHAT_ID = '$NGUOICAPNHAT_ID$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="BENHVIEN_ID">
                        TT_DUOC_KIEMKE.BENHVIEN_ID = '$BENHVIEN_ID$'
                    </isNotEmpty>
                </isParameterPresent>
            </dynamic>
        </statement>
        <!--Revision:0-->
        <statement id="DAO00030_TT_DUOC_KIEMKE_GetKyTonKho_DieuChinhTang" resultClass="DataObject">
            SELECT distinct KTK.*, KK.KHODUOC_ID, KD.TENKHO
            FROM
            TT_DUOC_KYTONKHO KTK
            inner join TT_DUOC_KIEMKE KK on KTK.DUOCKYTONKHO_ID = KK.DUOCKYKIEMKE_ID
            inner join TM_KHODUOC KD on KD.KHODUOC_ID = KK.KHODUOC_ID
            WHERE
            KK.THIEU &gt; 0
            and KK.KHODUOC_ID = '$KHODUOC_ID$'
            and KTK.MAKYTONKHO like '%$MAKYTONKHO$%'
            AND KTK.BENHVIEN_ID = '$BENHVIEN_ID$'
            order by KTK.NGAYTAO DESC
        </statement>
        <!--Revision:0-->
        <statement id="DAO00030_TT_DUOC_KIEMKE_GetKyTonKho_DieuChinhGiam" resultClass="DataObject">
            SELECT distinct KTK.*, KK.KHODUOC_ID, KD.TENKHO
            FROM
            TT_DUOC_KYTONKHO KTK
            inner join TT_DUOC_KIEMKE KK on KTK.DUOCKYTONKHO_ID = KK.DUOCKYKIEMKE_ID
            inner join TM_KHODUOC KD on KD.KHODUOC_ID = KK.KHODUOC_ID
            WHERE
            KK.THUA &gt; 0
            and KTK.MAKYTONKHO like '%$MAKYTONKHO$%'
            and KK.KHODUOC_ID = '$KHODUOC_ID$'
            AND KK.BENHVIEN_ID = '$BENHVIEN_ID$'
            order by KTK.NGAYTAO DESC
        </statement>
        <!--Revision:0-->
        <statement id="DAO00030_TT_DUOC_KIEMKE_GetDuocThieu" resultClass="DataObject">
            SELECT
            KK.DUOC_ID, SLN.NGUONHANG_ID AS NGUONDUOC_ID,  SLN.SOKIEMSOAT,SLN.HANDUNG AS HANSUDUNG, SLN.NGAYNHAP,SLN.SOLONHAP, SLN.SOLONHAP_ID,
            KK.DONGIAMUA, KK.THIEU AS SOLUONGTHUCTE, KK.DONGIAMUA* KK.THIEU AS THANHTIEN,
            TK.SOLUONG
            FROM
            TT_DUOC_KIEMKE KK
            left join TT_DUOC_CHUNGTU_SOLONHAP SLN on (KK.SOLONHAP_ID = SLN.SOLONHAP_ID AND KK.DUOC_ID = SLN.DUOC_ID )
            left join TT_DUOC_TONKHO TK ON (KK.DUOC_ID = TK.DUOC_ID and TK.KHODUOC_ID = KK.KHODUOC_ID and TK.SOLONHAP_ID = SLN.SOLONHAP_ID)
            WHERE
            KK.DUOCKYKIEMKE_ID = '$DUOCKYKIEMKE_ID$'
            AND KK.BENHVIEN_ID = '$BENHVIEN_ID$'
            and KK.THIEU &gt; 0
        </statement>
        <!--Revision:0-->
        <statement id="DAO00030_TT_DUOC_KIEMKE_GetDuocThua" resultClass="DataObject">
            SELECT
            KK.DUOC_ID, SLN.NGUONHANG_ID AS NGUONDUOC_ID,  SLN.SOKIEMSOAT, SLN.HANDUNG AS HANSUDUNG, SLN.NGAYNHAP,SLN.SOLONHAP, SLN.SOLONHAP_ID,
            KK.DONGIAMUA, KK.THUA AS SOLUONGDAXUAT, KK.DONGIAMUA* KK.THUA AS THANHTIEN,
            TK.SOLUONG
            FROM
            TT_DUOC_KIEMKE KK
            left join TT_DUOC_CHUNGTU_SOLONHAP SLN on (KK.SOLONHAP_ID = SLN.SOLONHAP_ID AND KK.DUOC_ID = SLN.DUOC_ID )
            left join TT_DUOC_TONKHO TK ON (KK.DUOC_ID = TK.DUOC_ID and TK.KHODUOC_ID = KK.KHODUOC_ID and TK.SOLONHAP_ID = SLN.SOLONHAP_ID)
            WHERE
            KK.DUOCKYKIEMKE_ID = '$DUOCKYKIEMKE_ID$'
            AND KK.BENHVIEN_ID = '$BENHVIEN_ID$'
            and KK.THUA &gt; 0
        </statement>
        <!--Revision:0-->
        <insert id="DAO00030_TT_VIENPHI_Add" parameterClass="System.Collections.IDictionary" resultClass="System.Int64">
            <selectKey property="VIENPHI_ID" type="pre" resultClass="System.Int64">
              select TT_VIENPHI_S.nextval as value from dual
            </selectKey>
            INSERT INTO TT_VIENPHI (
            VIENPHI_ID
            , TIEPNHAN_ID
            , BENHNHAN_ID
            , REF_ID
            , REF_TABLE
            , DUOC_ID
            , SOLONHAP_ID
            , LOAI_CHIPHI
            , LOAIGIA_ID
            , SOLUONG
            , DONGIA_DOANHTHU
            , THANHTIEN_DOANHTHU
            , BHYT_TL
            , BENHNHAN_PHAITHANHTOAN
            , GIATRI_HOADON
            , GIATRI_HOADON_DATHANHTOAN
            , GIATRI_BIENLAI
            , GIATRI_BIENLAI_DATHANHTOAN
            , GIATRI_BENHNHAN_DATHANHTOAN
            , TYLE_VAT
            , GIAVON
            , BANGGIA_ID
            , DUOCPHEPTHUCHIEN
            , HUY
            , KHONGTHUTIEN
            , DATHANHTOAN
            , DATHUCHIEN
            , HOADON_ID
            , ACTIVE
            , DUYET
            , BENHVIEN_ID
            , NGUOITAO_ID
            , NGAYTAO
            , NGUOICAPNHAT_ID
            , NGAYCAPNHAT
            ) values (
            #VIENPHI_ID#
            , #TIEPNHAN_ID#
            , #BENHNHAN_ID#
            , #REF_ID#
            , #REF_TABLE#
            , #DUOC_ID#
            , #SOLONHAP_ID#
            , #LOAI_CHIPHI#
            , #LOAIGIA_ID#
            , #SOLUONG#
            , #DONGIA_DOANHTHU#
            , #THANHTIEN_DOANHTHU#
            , #BHYT_TL#
            , #BENHNHAN_PHAITHANHTOAN#
            , #GIATRI_HOADON#
            , #GIATRI_HOADON_DATHANHTOAN#
            , #GIATRI_BIENLAI#
            , #GIATRI_BIENLAI_DATHANHTOAN#
            , #GIATRI_BENHNHAN_DATHANHTOAN#
            , #TYLE_VAT#
            , #GIAVON#
            , #BANGGIA_ID#
            , #DUOCPHEPTHUCHIEN#
            , #HUY#
            , #KHONGTHUTIEN#
            , #DATHANHTOAN#
            , #DATHUCHIEN#
            , #HOADON_ID#
            , #ACTIVE#
            , #DUYET#
            , #BENHVIEN_ID#
            , #NGUOITAO_ID#
            , #NGAYTAO#
            , #NGUOICAPNHAT_ID#
            , #NGAYCAPNHAT#
            )
        </insert>
        <!--Revision:0-->
        <statement id="DAO00030_TT_VIENPHI_Delete" parameterClass="System.Collections.IDictionary" resultClass="System.Int32">           
            DELETE
            TT_VIENPHI
            WHERE
            REF_ID = #REF_ID#
            and REF_TABLE = '$REF_TABLE$'
            and BENHVIEN_ID = '$BENHVIEN_ID$'
        </statement>
        <!--Revision:0-->
        <statement id="DAO00030_File_GetAll" resultClass="DataObject">
            select *
            from TT_FILE_DINHKEM
            order by FILE_ID
        </statement>
        <!--Revision:0-->
        <statement id="DAO00030_File_GetList" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
            select *
            from TT_FILE_DINHKEM
            <dynamic prepend="where">
                <isParameterPresent>
                    <isNotEmpty prepend="and" property="LIST_FILE_ID">
                        FILE_ID IN ($LIST_FILE_ID$)
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="REF_TABLE">
                        TT_FILE_DINHKEM.REF_TABLE = '$REF_TABLE$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="REF_ID">
                        TT_FILE_DINHKEM.REF_ID = '$REF_ID$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="ORIGINAL_NAME">
                        TT_FILE_DINHKEM.ORIGINAL_NAME = '$ORIGINAL_NAME$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="UPLOAD_NAME">
                        TT_FILE_DINHKEM.UPLOAD_NAME = '$UPLOAD_NAME$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="UPLOAD_FOLDER">
                        TT_FILE_DINHKEM.UPLOAD_FOLDER = '$UPLOAD_FOLDER$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="TYPE">
                        TT_FILE_DINHKEM.TYPE = '$TYPE$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="SIZE">
                        TT_FILE_DINHKEM.SIZE = '$SIZE$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="BENHVIEN_ID">
                        TT_FILE_DINHKEM.BENHVIEN_ID = '$BENHVIEN_ID$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="NGAYTAO">
                        TT_FILE_DINHKEM.NGAYTAO = '$NGAYTAO$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="NGUOITAO_ID">
                        TT_FILE_DINHKEM.NGUOITAO_ID = '$NGUOITAO_ID$'
                    </isNotEmpty>
                </isParameterPresent>
            </dynamic>
            order by FILE_ID
        </statement>
        <!--Revision:0-->
        <statement id="DAO00030_File_GetDetail" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
            select *
            from TT_FILE_DINHKEM
            where TT_FILE_DINHKEM.FILE_ID  = '$value$'
            order by FILE_ID
        </statement>
        <!--Revision:0-->
        <statement id="DAO00030_File_GetDetailP" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
            select *
            from TT_FILE_DINHKEM
            where TT_FILE_DINHKEM.FILE_ID  = '$FILE_ID$'
            order by FILE_ID
        </statement>
        <!--Revision:0-->
        <insert id="DAO00030_File_Add" parameterClass="System.Collections.IDictionary" resultClass="System.Int64">
          <selectKey property="FILE_ID" type="pre" resultClass="System.Int64">
            select TT_FILE_DINHKEM_S.nextval as value from dual
          </selectKey>
          insert into TT_FILE_DINHKEM (
            FILE_ID
          , REF_TABLE
          , REF_ID
          , ORIGINAL_NAME
          , UPLOAD_NAME
          , UPLOAD_FOLDER
          , TYPE
          , SIZE
          , BENHVIEN_ID
          , NGAYTAO
          , NGUOITAO_ID
          ) values (
            #FILE_ID#
          , #REF_TABLE#
          , #REF_ID#
          , #ORIGINAL_NAME#
          , #UPLOAD_NAME#
          , #UPLOAD_FOLDER#
          , #TYPE#
          , #SIZE#
          , #BENHVIEN_ID#
          , #NGAYTAO#
          , #NGUOITAO_ID#
          )          
          </insert>
        <!--Revision:0-->
        <update id="DAO00030_File_Update" parameterClass="System.Collections.IDictionary">
            update TT_FILE_DINHKEM set
            REF_ID = #REF_ID#
            where
            FILE_ID IN ($LIST_FILE_ID$)
        </update>
        <!--Revision:0-->
        <statement id="DAO00030_File_Delete" parameterClass="System.Collections.IDictionary" resultClass="System.Int32">
            delete from TT_FILE_DINHKEM
            <dynamic prepend="where">
                <isParameterPresent>
                    <isNotEmpty prepend="and" property="FILE_ID">
                        FILE_ID = $FILE_ID$
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="LIST_FILE_ID">
                        FILE_ID IN ($LIST_FILE_ID$)
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="REF_TABLE">
                        REF_TABLE = '$REF_TABLE$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="REF_ID">
                        REF_ID = '$REF_ID$'
                    </isNotEmpty>
                </isParameterPresent>
            </dynamic>
        </statement>
        <!--Revision:0-->
        <statement id="DAO00030_Search_PhieuXuatThuocBHYT_Page" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
            select *
            from
            (select distinct
            ROW_NUMBER() OVER(order by CT.CHUNGTU_ID DESC) as ROWNUMBER,
            CT.CHUNGTU_ID,
            CT.MACHUNGTU,
            CT.NGAYCHUNGTU,
            CT.KHOXUAT_ID,
            CT.NGUOIGIAO_ID,
            BN.MAYTE,
            BN.TENBENHNHAN
            from TT_DUOC_CHUNGTU CT
            inner join TT_BENHNHAN BN on BN.BENHNHAN_ID = CT.BENHNHAN_ID
            <dynamic prepend="where">
                <isParameterPresent>
                    <isNotEmpty prepend="and" property="MACHUNGTU">
                        CT.MACHUNGTU LIKE '%$MACHUNGTU$%'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="MUCDICHCHUNGTU_ID">
                        CT.MUCDICHCHUNGTU_ID = '$MUCDICHCHUNGTU_ID$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="BENHVIEN_ID">
                        CT.BENHVIEN_ID = '$BENHVIEN_ID$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="KHOXUAT_ID">
                        CT.KHOXUAT_ID = '$KHOXUAT_ID$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="TUNGAY">                      
                      trunc(CT.NGAYCHUNGTU) BETWEEN  trunc(#TUNGAY#) and  trunc(#DENNGAY#)
                    </isNotEmpty>
                </isParameterPresent>
            </dynamic>
            )lst
            <isNotEmpty prepend="" property="FROMROW">
                where
                lst.ROWNUMBER between $FROMROW$ and $TOROW$
            </isNotEmpty>
            order by lst.CHUNGTU_ID DESC
        </statement>
        <!--Revision:0-->
        <statement id="DAO00030_Search_PhieuXuatThuocBHYT_CountList" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
            SELECT count(*) as TOTALROWS
            FROM (
            select distinct
            CT.CHUNGTU_ID,
            CT.MACHUNGTU,
            CT.NGAYCHUNGTU,
            CT.KHOXUAT_ID,
            CT.NGUOIGIAO_ID,
            BN.MAYTE,
            BN.TENBENHNHAN
            from TT_DUOC_CHUNGTU CT
            inner join TT_BENHNHAN BN on BN.BENHNHAN_ID = CT.BENHNHAN_ID
            <dynamic prepend="where">
                <isParameterPresent>
                    <isNotEmpty prepend="and" property="MACHUNGTU">
                        CT.MACHUNGTU LIKE '%$MACHUNGTU$%'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="MUCDICHCHUNGTU_ID">
                        CT.MUCDICHCHUNGTU_ID = '$MUCDICHCHUNGTU_ID$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="BENHVIEN_ID">
                        CT.BENHVIEN_ID = '$BENHVIEN_ID$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="KHOXUAT_ID">
                        CT.KHOXUAT_ID = '$KHOXUAT_ID$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="TUNGAY">                      
                      trunc(CT.NGAYCHUNGTU) BETWEEN  trunc(#TUNGAY#) and  trunc(#DENNGAY#)
                    </isNotEmpty>
                </isParameterPresent>
            </dynamic>
            ) lst
        </statement>
        <!--Revision:0-->
        <statement id="DAO00030_TOATHUOC_GetThongTinDuyet_NgoaiTru_CountList" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
          select count(*) as TOTALROWS
          from
          (
          SELECT
          BN.TENBENHNHAN,
          BN.MAYTE,
          BN.SOVAOVIEN,
          CASE
          WHEN BN.GIOITINH = 1 THEN 'Nam'
          WHEN BN.GIOITINH = 2 THEN 'Nữ'
          END  AS GIOITINH,
          BN.NAMSINH,
          BN.DIACHILIENLAC as DIACHI,
          KBTT.KHAMBENH_TOATHUOC_ID,
          KBTT.SOTHUTUTOA,
          KB.PHONGBAN_ID,
          KB.BACSIKHAM_ID,
          KBTT.NGUOIDUYET_ID,
          KBTT.NGAYDUYET,
          KBTT.THOIGIANDUYET,
          KBTT.TRANGTHAI,
          KBTT.LYDOHUY,
          'NGOAITRU' as MALOAITOA,
          'Ngoại trú BHYT' as TENLOAITOA
          FROM
          TT_BENHNHAN BN,
          TT_NGOAITRU_KHAMBENH KB,
          TT_NGOAITRU_KHAMBENH_TOATHUOC KBTT
          WHERE
          KB.KHAMBENH_ID = KBTT.KHAMBENH_ID
          AND KB.BENHNHAN_ID = BN.BENHNHAN_ID
          AND KBTT.DUYET = '$DUYET$'
          AND KBTT.CHUNGTUPHATTHUOC_ID is NULL
          AND KBTT.KHOXUAT_ID = '$KHOXUAT_ID$'
          AND LOAITOATHUOC = '$LOAITOATHUOC$'
          and KB.BENHVIEN_ID = '$BENHVIEN_ID$'          
          AND trunc(KBTT.NGAYTOATHUOC) BETWEEN  trunc(#TUNGAY#) and  trunc(#DENNGAY#)
          AND (KBTT.SOTHUTUTOA LIKE '%$KEYWORD$%' or BN.TENBENHNHAN LIKE '%$KEYWORD$%' or BN.SOVAOVIEN LIKE '%$KEYWORD$%')
          UNION ALL
          SELECT DISTINCT
          BN.TENBENHNHAN,
          BN.MAYTE,
          BN.SOVAOVIEN,
          CASE
          WHEN BN.GIOITINH = 1 THEN 'Nam'
          WHEN BN.GIOITINH = 2 THEN 'Nữ'
          END  AS GIOITINH,
          BN.NAMSINH,
          BN.DIACHILIENLAC as DIACHI,
          TT.KHAMBENH_ID as KHAMBENH_TOATHUOC_ID,
          TT.SOTHUTUTOA,
          KB.PHONGBAN_ID,
          KB.BACSIKHAM_ID,
          CASE
          WHEN TT.TRANGTHAI	= 'CHUAXUAT'  THEN NULL
          WHEN TT.TRANGTHAI	= 'DADUYET'  THEN KB.NGUOICAPNHAT_ID
          END  AS NGUOIDUYET_ID,
          null as NGAYDUYET,
          CASE
          WHEN TT.TRANGTHAI	= 'CHUAXUAT'  THEN NULL
          WHEN TT.TRANGTHAI	= 'DADUYET'  THEN KB.NGAYCAPNHAT
          END  AS THOIGIANDUYET,
          TT.TRANGTHAI AS TRANGTHAI,
          TT.GHICHU AS LYDOHUY,
          'NOITRU' as MALOAITOA,
          'Nội trú ra việ' as TENLOAITOA
          FROM
          TT_BENHNHAN BN,
          TT_NOITRU_KHAMBENH KB,
          TT_NOITRU_TOATHUOC TT,
          TT_NOITRU_BENHAN BA
          WHERE
          KB.KHAMBENH_ID = TT.KHAMBENH_ID
          AND BA.BENHAN_ID = KB.BENHAN_ID
          AND BA.BENHNHAN_ID = BN.BENHNHAN_ID
          AND KB.ISTHUOCBV = '$ISTHUOCBV$'
          AND TT.KHOPHAT_ID = '$KHOXUAT_ID$'
          and TT.BENHVIEN_ID = '$BENHVIEN_ID$'
          <isNotEmpty prepend="and" property="TRANGTHAI_CHUAXUAT">
                TT.TRANGTHAI	= '$TRANGTHAI_CHUAXUAT$'
            </isNotEmpty>
            <isNotEmpty prepend="and" property="TRANGTHAI_DAXUAT">
                TT.TRANGTHAI	!= 'CHUAXUAT'
            </isNotEmpty>
          AND KB.RAVIEN = '1'          
          AND trunc(TT.NGAYTAO) BETWEEN  trunc(#TUNGAY#) and  trunc(#DENNGAY#)
          AND (TT.SOTHUTUTOA LIKE '%$KEYWORD$%' or BN.TENBENHNHAN LIKE '%$KEYWORD$%' or BN.SOVAOVIEN LIKE '%$KEYWORD$%')
          ) lst
        </statement>
        <statement id="DAO00030_KiemTraBenhNhanNoiTru" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
          SELECT BENHNHAN_ID
          FROM TT_NOITRU_BENHAN
          WHERE BENHNHAN_ID = #BENHNHAN_ID#
        </statement>
        <!--Revision:0-->
        <statement id="DAO00030_TOATHUOC_GetThongTinDuyet_NgoaiTru_Page" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
          select
          ROW_NUMBER() over (order by SOTHUTUTOA) as ROWNUMBER, *
          from
          (
          SELECT
          BN.TENBENHNHAN,
          BN.MAYTE,
          BN.SOVAOVIEN,
          CASE
          WHEN BN.GIOITINH = 1 THEN 'Nam'
          WHEN BN.GIOITINH = 2 THEN 'Nữ'
          END  AS GIOITINH,
          BN.NAMSINH,
          BN.DIACHILIENLAC as DIACHI,
          KBTT.KHAMBENH_TOATHUOC_ID,
          KBTT.SOTHUTUTOA,
          KB.PHONGBAN_ID,
          KB.BACSIKHAM_ID,
          KBTT.NGUOIDUYET_ID,
          KBTT.NGAYDUYET,
          KBTT.THOIGIANDUYET,
          KBTT.TRANGTHAI,
          KBTT.LYDOHUY,
          'NGOAITRU' as MALOAITOA,
          'Ngoại trú BHYT' as TENLOAITOA
          FROM
          TT_BENHNHAN BN,
          TT_NGOAITRU_KHAMBENH KB,
          TT_NGOAITRU_KHAMBENH_TOATHUOC KBTT
          WHERE
          KB.KHAMBENH_ID = KBTT.KHAMBENH_ID
          AND KB.BENHNHAN_ID = BN.BENHNHAN_ID
          AND KBTT.DUYET = '$DUYET$'
          AND KBTT.CHUNGTUPHATTHUOC_ID is NULL
          AND KBTT.KHOXUAT_ID = '$KHOXUAT_ID$'
          AND LOAITOATHUOC = '$LOAITOATHUOC$'
          and KB.BENHVIEN_ID = '$BENHVIEN_ID$'          
          AND trunc(KBTT.NGAYTOATHUOC) BETWEEN  trunc(#TUNGAY#) and  trunc(#DENNGAY#)
          AND (KBTT.SOTHUTUTOA LIKE '%$KEYWORD$%' or BN.TENBENHNHAN LIKE '%$KEYWORD$%' or BN.SOVAOVIEN LIKE '%$KEYWORD$%')
          UNION ALL
          SELECT DISTINCT
          BN.TENBENHNHAN,
          BN.MAYTE,
          BN.SOVAOVIEN,
          CASE
          WHEN BN.GIOITINH = 1 THEN 'Nam'
          WHEN BN.GIOITINH = 2 THEN 'Nữ'
          END  AS GIOITINH,
          BN.NAMSINH,
          BN.DIACHILIENLAC as DIACHI,
          TT.KHAMBENH_ID as KHAMBENH_TOATHUOC_ID,
          TT.SOTHUTUTOA,
          KB.PHONGBAN_ID,
          KB.BACSIKHAM_ID,
          CASE
          WHEN TT.TRANGTHAI	= 'CHUAXUAT'  THEN NULL
          WHEN TT.TRANGTHAI	= 'DADUYET'  THEN KB.NGUOICAPNHAT_ID
          END  AS NGUOIDUYET_ID,
          null as NGAYDUYET,
          CASE
          WHEN TT.TRANGTHAI	= 'CHUAXUAT'  THEN NULL
          WHEN TT.TRANGTHAI	= 'DADUYET'  THEN KB.NGAYCAPNHAT
          END  AS THOIGIANDUYET,
          TT.TRANGTHAI AS TRANGTHAI,
          TT.GHICHU AS LYDOHUY,
          'NOITRU' as MALOAITOA,
          'Nội trú ra việ' as TENLOAITOA
          FROM
          TT_BENHNHAN BN,
          TT_NOITRU_KHAMBENH KB,
          TT_NOITRU_TOATHUOC TT,
          TT_NOITRU_BENHAN BA
          WHERE
          KB.KHAMBENH_ID = TT.KHAMBENH_ID
          AND BA.BENHAN_ID = KB.BENHAN_ID
          AND BA.BENHNHAN_ID = BN.BENHNHAN_ID
          AND KB.ISTHUOCBV = '$ISTHUOCBV$'
          AND TT.KHOPHAT_ID = '$KHOXUAT_ID$'
          and TT.BENHVIEN_ID = '$BENHVIEN_ID$'
          <isNotEmpty prepend="and" property="TRANGTHAI_CHUAXUAT">
                TT.TRANGTHAI	= '$TRANGTHAI_CHUAXUAT$'
            </isNotEmpty>
            <isNotEmpty prepend="and" property="TRANGTHAI_DAXUAT">
                TT.TRANGTHAI	!= 'CHUAXUAT'
            </isNotEmpty>
          AND KB.RAVIEN = '1'          
          AND trunc(TT.NGAYTAO) BETWEEN  trunc(#TUNGAY#) and  trunc(#DENNGAY#)
          AND (TT.SOTHUTUTOA LIKE '%$KEYWORD$%' or BN.TENBENHNHAN LIKE '%$KEYWORD$%' or BN.SOVAOVIEN LIKE '%$KEYWORD$%')
          ) lst
          <isNotEmpty prepend="" property="FROMROW">
                where
                lst.ROWNUMBER between $FROMROW$ and $TOROW$
            </isNotEmpty>
        </statement>
        <!--Revision:0-->
        <insert id="DAO00030_TT_NGOAITRU_TOATHUOC_NGUOIMUA_Add" parameterClass="HashTable" resultClass="System.Int64">
          <selectKey property="NGOAITRU_TOATHUOC_NGUOIMUA_ID" type="pre" resultClass="System.Int64">
            select TT_NGOAITRU_TOATHUOC_NMUA_S.nextval as value from dual
          </selectKey>
          INSERT INTO TT_NGOAITRU_TOATHUOC_NGUOIMUA
          (
          NGOAITRU_TOATHUOC_NGUOIMUA_ID
          ,TENNGUOIMUA
          ,HO
          ,TEN
          ,GIOITINH
          ,NGAYSINH
          ,NAMSINH
          ,SODIENTHOAI
          ,SONHA
          ,DIACHI
          ,DIACHICOQUAN
          ,TINHTHANH_ID
          ,QUANHUYEN_ID
          ,XAPHUONG_ID
          ,NGHENGHIEP_ID
          ,QUOCTICH_ID
          ,DANTOC_ID
          ,BENHVIEN_ID
          ,NGAYTAO
          ,NGUOITAO_ID
          ,NGAYCAPNHAT
          ,NGUOICAPNHAT_ID
          )
          VALUES
          (
          ,#NGOAITRU_TOATHUOC_NGUOIMUA_ID#
          ,#TENNGUOIMUA#
          ,#HO#
          ,#TEN#
          ,#GIOITINH#
          ,#NGAYSINH#
          ,#NAMSINH#
          ,#SODIENTHOAI#
          ,#SONHA#
          ,#DIACHI#
          ,#DIACHICOQUAN#
          ,#TINHTHANH_ID#
          ,#QUANHUYEN_ID#
          ,#XAPHUONG_ID#
          ,#NGHENGHIEP_ID#
          ,#QUOCTICH_ID#
          ,#DANTOC_ID#
          ,#BENHVIEN_ID#
          ,#NGAYTAO#
          ,#NGUOITAO_ID#
          ,#NGAYCAPNHAT#
          ,#NGUOICAPNHAT_ID#
          )          
          </insert>
        <!--Revision:0-->
        <update id="DAO00030_TT_NGOAITRU_TOATHUOC_NGUOIMUA_Upd" parameterClass="System.Collections.IDictionary">
            UPDATE TT_NGOAITRU_TOATHUOC_NGUOIMUA
            SET
            TENNGUOIMUA = #TENNGUOIMUA#
            ,HO = #HO#
            ,TEN = #TEN#
            ,GIOITINH = #GIOITINH#
            ,NGAYSINH = #NGAYSINH#
            ,NAMSINH = #NAMSINH#
            ,SODIENTHOAI = #SODIENTHOAI#
            ,SONHA = #SONHA#
            ,DIACHI = #DIACHI#
            ,DIACHICOQUAN = #DIACHICOQUAN#
            ,TINHTHANH_ID = #TINHTHANH_ID#
            ,QUANHUYEN_ID = #QUANHUYEN_ID#
            ,XAPHUONG_ID = #XAPHUONG_ID#
            ,NGHENGHIEP_ID = #NGHENGHIEP_ID#
            ,QUOCTICH_ID = #QUOCTICH_ID#
            ,DANTOC_ID = #DANTOC_ID#
            ,NGAYCAPNHAT = #NGAYCAPNHAT#
            ,NGUOICAPNHAT_ID = #NGUOICAPNHAT_ID#
            WHERE
            NGOAITRU_TOATHUOC_NGUOIMUA_ID = #NGOAITRU_TOATHUOC_NGUOIMUA_ID#
        </update>
        <!--Revision:0-->
        <statement id="DAO00030_Search_PhieuMuaHang" resultClass="DataObject">
            SELECT
            DISTINCT
            ct.CHUNGTU_ID
            ,MACHUNGTU
            ,NGAYLAPCHUNGTU as NGAYCHUNGTU
            ,ct.NGAYTAO
            ,nv.TENNHANVIEN as NGUOITAO
            ,
            CASE
            WHEN ct.STATE_CODE = 5 THEN 'Chờ nhập kho'
            WHEN ct.STATE_CODE = 6 THEN 'Đã nhập kho'
            END as TRANGTHAI
            FROM TT_PUR_CHUNGTU ct
            INNER JOIN TT_PUR_CHUNGTUCHITIET ctct on ct.CHUNGTU_ID = ctct.CHUNGTU_ID
            INNER JOIN TM_NHANVIEN nv on nv.NHANVIEN_ID = ct.NGUOITAO_ID
            WHERE
            ct.MALOAIPHIEU = 'DP'
            and ct.PROCESS_CODE = 'PO'
            and (ct.STATE_CODE = 5 or (ct.STATE_CODE = 6 and ctct.SOLUONGDANHAP &lt; ctct.SOLUONGYEUCAU))
            <isNotEmpty prepend="and" property="TUNGAY">              
              trunc(CT.NGAYLAPCHUNGTU) BETWEEN  trunc(#TUNGAY#) and  trunc(#DENNGAY#)
            </isNotEmpty>
            <isNotEmpty prepend="and" property="TUKHOA">
                ct.MACHUNGTU LIKE '%$TUKHOA$%'
            </isNotEmpty>
            and ct.BENHVIEN_ID =  '$BENHVIEN_ID$'
            ORDER BY NGAYCHUNGTU
        </statement>
        <!--Revision:0-->
        <statement id="DAO00030_GetList_PO" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
            select *
            from TT_PUR_CHUNGTU
            where BENHVIEN_ID = '$BENHVIEN_ID$'
            <isParameterPresent>
                <isNotEmpty prepend="and" property="CHUNGTU_ID">
                    CHUNGTU_ID = '$CHUNGTU_ID$'
                </isNotEmpty>
                <isNotEmpty prepend="and" property="MACHUNGTU">
                    MACHUNGTU = '$MACHUNGTU$'
                </isNotEmpty>
            </isParameterPresent>
            order by CHUNGTU_ID
        </statement>
        <!--Revision:0-->
        <statement id="DAO00030_GetList_PO_CT" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
            SELECT
            ctct.*
            FROM
            TT_PUR_CHUNGTUCHITIET ctct
            inner join TM_PUR_LOAI loai on loai.ID = ctct.LOAI_ID
            WHERE
            CHUNGTU_ID = '$CHUNGTU_ID$'
            AND loai.MA = 'DP'
            and NVL(ctct.SOLUONGDANHAP,0) &lt; NVL(ctct.SOLUONGYEUCAU,0)
            and ctct.BENHVIEN_ID =  '$BENHVIEN_ID$'
        </statement>
        <!--Revision:0-->
        <update id="DAO00030_UpdateSoLuongDaNhap_PO" parameterClass="System.Collections.IDictionary">
            SELECT * INTO ##TempTable FROM
            (
            SELECT
            ctct.DONDATHANG_ID as CHUNGTUCHITIET_ID,
            SUM(ctct.SOLUONGTHUCTE) as SOLUONGDANHAP
            FROM
            TT_DUOC_CHUNGTU_CHITIET ctct
            INNER JOIN TT_DUOC_CHUNGTU ct on ct.CHUNGTU_ID = ctct.CHUNGTU_ID
            WHERE
            ctct.DONDATHANG_ID  IN ($LIST_CHUNGTUCHITIET_ID$)
            AND ct.TRANGTHAI = 'PNDNK'
            AND ct.BENHVIEN_ID = '$BENHVIEN_ID$'
            GROUP BY
            ctct.DONDATHANG_ID
            ) TEMP
            DECLARE @CHUNGTUCHITIET_ID int, @SOLUONGDANHAP int
            DECLARE _CURSOR CURSOR FOR  SELECT CHUNGTUCHITIET_ID, SOLUONGDANHAP FROM ##TempTable
            OPEN _CURSOR
            FETCH NEXT FROM _CURSOR
            INTO @CHUNGTUCHITIET_ID, @SOLUONGDANHAP
            WHILE @@FETCH_STATUS = 0
            BEGIN
            UPDATE TT_PUR_CHUNGTUCHITIET
            SET
            SOLUONGDANHAP = @SOLUONGDANHAP,
            NGUOICAPNHAT_ID = #NGUOICAPNHAT_ID#,
            NGAYCAPNHAT = SYSTIMESTAMP
            WHERE
            CHUNGTUCHITIET_ID = @CHUNGTUCHITIET_ID
            AND BENHVIEN_ID = '$BENHVIEN_ID$'
            FETCH NEXT FROM _CURSOR
            INTO @CHUNGTUCHITIET_ID, @SOLUONGDANHAP;
            END
            CLOSE _CURSOR
            DEALLOCATE _CURSOR
            Drop table  ##TempTable
        </update>
        <!--Revision:0-->
        <update id="DAO00030_DeleteSoLuongDaNhap_PO" parameterClass="System.Collections.IDictionary">
            UPDATE TT_PUR_CHUNGTUCHITIET
            SET
            SOLUONGDANHAP =  SOLUONGDANHAP - #SOLUONGDANHAP#,
            NGUOICAPNHAT_ID = #NGUOICAPNHAT_ID#,
            NGAYCAPNHAT = SYSTIMESTAMP
            WHERE
            CHUNGTUCHITIET_ID = #CHUNGTUCHITIET_ID#
            AND  SOLUONGDANHAP &gt;= #SOLUONGDANHAP#
            AND BENHVIEN_ID = '$BENHVIEN_ID$'
        </update>
        <!--Revision:0-->
        <update id="DAO00030_UpdateTrangThai_PO" parameterClass="System.Collections.IDictionary">
            IF EXISTS
            (
            SELECT ctct.CHUNGTU_ID
            FROM
            TT_PUR_CHUNGTUCHITIET ctct
            inner join TM_PUR_LOAI loai on loai.ID = ctct.LOAI_ID
            WHERE
            CHUNGTU_ID = '$CHUNGTU_ID$'
            AND loai.MA = 'DP'
            and NVL(ctct.SOLUONGDANHAP,0) &lt; NVL(ctct.SOLUONGYEUCAU,0)
            and ctct.BENHVIEN_ID =  '$BENHVIEN_ID$'
            )
            BEGIN
            UPDATE TT_PUR_CHUNGTU
            SET
            STATE_CODE = 6,
            STATE_NAME = 'Đã nhập kho',
            NGUOICAPNHAT_ID = #NGUOICAPNHAT_ID#,
            NGAYCAPNHAT = SYSTIMESTAMP
            WHERE
            CHUNGTU_ID = '$CHUNGTU_ID$'
            END
            ELSE
            BEGIN
            UPDATE TT_PUR_CHUNGTU
            SET
            STATE_CODE = 8,
            STATE_NAME = 'Đã hoàn tất',
            NGUOICAPNHAT_ID = #NGUOICAPNHAT_ID#,
            NGAYCAPNHAT = SYSTIMESTAMP
            WHERE
            CHUNGTU_ID = '$CHUNGTU_ID$'
            END
        </update>
        <!--Revision:0-->
        <statement id="DAO00030_KiemTraSoLoNhapDaPhatSinhLienQuan" resultClass="DataObject">
            SELECT row_count from
            (
            SELECT count(*) AS row_count
            FROM TT_DUOC_CHUNGTU_CHITIET
            WHERE SOLONHAP_ID IN ($LIST_SOLONHAP_ID$)
            and CHUNGTU_ID &gt; '$CHUNGTU_ID$'
            and BENHVIEN_ID = '$BENHVIEN_ID$'
            group by SOLONHAP_ID
            ) a
            WHERE row_count &gt;= 1
        </statement>
        <!--Revision:0-->
        <statement id="DAO00030_GetLOAITINHGIADUOC" resultClass="DataObject">
            select A.VALUE as LOAITINHGIADUOC, B.VALUE as SAPXEPTHEO
            from TM_SYS_APPSETTINGS A
            left join TM_SYS_APPSETTINGS B on B.CODE = 'PHA_CACHTINHGIADUOC_THEOLO'
            where A.CODE = 'APP_QUYTRINH_TINHGIADUOC'
        </statement>
        <!--Revision:0-->
        <statement id="DAO00030_KiemTraChungTuKhoaSo" resultClass="DataObject">
            SELECT ct.CHUNGTU_ID
            FROM TT_DUOC_CHUNGTU ct,
            (
            SELECT
            TO_DATE(TO_CHAR(KHOADENNGAY,'MM/DD/YYYY'), 'MM/DD/YYYY')  NGAYKHOASO
            FROM TT_DUOC_KHOASOCHUNGTU
            WHERE
            KHODUOC_ID = '$KHODUOC_ID$'
            AND BENHVIEN_ID = '$BENHVIEN_ID$'
            AND KHOASO = '1'
            AND ROWNUM = 1
            ORDER BY KHOADENNGAY DESC
            ) ks
            WHERE
            ct.MACHUNGTU = '$MACHUNGTU$'
            and ct.BENHVIEN_ID = '$BENHVIEN_ID$'
            and TO_DATE(TO_CHAR(ct.NGAYCHUNGTU,'MM/DD/YYYY'), 'MM/DD/YYYY') &lt;= ks.NGAYKHOASO
        </statement>
        <statement id="DAO00030_KiemTraChungTuDaChuyenKeToan" resultClass="DataObject">
          SELECT CHUNGTU_ID
          FROM TT_DUOC_CHUNGTU
          WHERE
          CHUNGTU_ID = '$CHUNGTU_ID$'
          and IDCHUYEN IS NOT NULL
          and BENHVIEN_ID = '$BENHVIEN_ID$'
        </statement>
        <!--Revision:0-->
        <statement id="DAO00030_LayNgayKhoaSoCuoi" resultClass="DataObject">
            SELECT KHOADENNGAY
            FROM TT_DUOC_KHOASOCHUNGTU
            WHERE
            KHODUOC_ID = '$KHODUOC_ID$'
            and BENHVIEN_ID = '$BENHVIEN_ID$'
            and KHOASO = '1'
            and ROWNUM = 1
            ORDER BY KHOADENNGAY DESC
        </statement>
        <!--Revision:0-->
        <statement id="DAO00030_KiemTraPhatSinhChungTuLienQuan" resultClass="DataObject">
            SELECT CHUNGTU_ID
            FROM TT_DUOC_CHUNGTU
            WHERE
            CHUNGTULIENQUAN_ID = '$CHUNGTU_ID$'
            and BENHVIEN_ID = '$BENHVIEN_ID$'
        </statement>
        <!--Revision:0-->
        <statement id="DAO00030_GetGoiThau" resultClass="DataObject">
            SELECT DISTINCT DIC.*, HD.NHACUNGCAP_ID, HD.NGAYHETHAN, HD.GIAHOPDONG_ID
            FROM
            LST_DICTIONARY DIC inner join TM_GIAHOPDONG HD on DIC.DICTIONARY_ID = HD.GOITHAU_ID
            WHERE
            DICTIONARY_TYPE_CODE = 'DM_goithau'
            and HD.NHACUNGCAP_ID = '$NHACUNGCAP_ID$'
            and TO_DATE(HD.NGAYHETHAN,'MM/DD/YYYY') &gt;= SYSDATE
            <!--and DIC.BENHVIEN_ID = '$BENHVIEN_ID$'-->
            ORDER BY HD.NGAYHETHAN DESC
        </statement>
        <!--Revision:0-->
        <statement id="DAO00030_GetGiaThauChiTiet" resultClass="DataObject">
            SELECT hdct.*
            FROM TM_GIAHOPDONGCHITIET hdct
            inner join TM_GIAHOPDONG hd on hd.GIAHOPDONG_ID = hdct.GIAHOPDONG_ID
            WHERE
            hd.NHACUNGCAP_ID = '$NHACUNGCAP_ID$'
            AND SYSDATE &gt;= TO_DATE(hd.NGAYCUNGCAP,'MM/DD/YYYY')
            AND TO_DATE(hd.NGAYHETHAN,'MM/DD/YYYY') &gt; SYSDATE
            AND hdct.DUOC_ID =  '$DUOC_ID$'
            AND hdct.DONVITINH_ID = '$DONVITINH_ID$'
            AND hdct.BENHVIEN_ID = '$BENHVIEN_ID$'
            <isNotEmpty prepend="and" property="GIAHOPDONG_ID">
                hd.GIAHOPDONG_ID = '$GIAHOPDONG_ID$'
            </isNotEmpty>
            AND ROWNUM = 1
            ORDER BY hdct.DONGIAHOPDONG
        </statement>
        <!--Revision:0-->
        <statement id="DAO00030_GetSoViSa" resultClass="DataObject">
            select *
            from TM_DUOC
            where
            DUOC_ID = '$DUOC_ID$'
            and BENHVIEN_ID = '$BENHVIEN_ID$'
        </statement>
        <!--Revision:0-->
        <statement id="DAO00030_GetDVTQuyDoi" resultClass="DataObject">
            select *
            from TM_DONVITINH
            where
            DONVICOBAN_ID = '$DONVITINH_ID$'
            and BENHVIEN_ID = '$BENHVIEN_ID$'
            order by DONVITINH_ID
        </statement>
        <!--Revision:0-->
        <statement id="DAO00030_GetGiaMarkup" resultClass="DataObject">
            DECLARE @TYLE NUMERIC(5,2)
            DECLARE @DONGIABAN NUMERIC(18,2)
            DECLARE @DECLAMTRON INT
            SELECT TOP 1  @DECLAMTRON = LAMTRON
            FROM  TM_DONGIA_DEFINITIONS_LAMTRON
            WHERE DONGIA &gt;=  $GIAVAO$
            ORDER BY DONGIA ASC
            SELECT TOP 1  @TYLE = TYLE
            FROM TM_DUOC_DONGIA_DEFINITIONS
            WHERE DONGIA &gt;=  $GIAVAO$ AND LOAIVATTU_ID IN (SELECT LOAIVATTU_ID FROM TM_DUOC D
            JOIN TM_LOAIDUOC LD ON D.LOAIDUOC_ID = LD.LOAIDUOC_ID
            WHERE D.DUOC_ID= $DUOC_ID$ )
            ORDER BY DONGIA ASC
            SET @DONGIABAN= ROUND(($GIAVAO$ * (1 || (@TYLE ) / 100))/@DECLAMTRON,2)*@DECLAMTRON
            SELECT @DONGIABAN
        </statement>
        <!--Revision:0-->
        <statement id="DAO00030_GetGiaMarkup_LaySoLamTron" resultClass="DataObject">
            SELECT LAMTRON
            FROM  TM_DONGIA_DEF_LAMTRON
            WHERE DONGIA &gt;=  $GIAVAO$
            AND ROWNUM = 1
            ORDER BY DONGIA ASC
        </statement>
        <!--Revision:0-->
        <statement id="DAO00030_GetGiaMarkup_LayTyLe" resultClass="DataObject">
            SELECT TYLE
            FROM TM_DUOC_DONGIA_DEFINITIONS
            WHERE DONGIA &gt;=  $GIAVAO$ AND LOAIVATTU_ID IN (SELECT LOAIVATTU_ID FROM TM_DUOC D
            JOIN TM_LOAIDUOC LD ON D.LOAIDUOC_ID = LD.LOAIDUOC_ID
            WHERE D.DUOC_ID= $DUOC_ID$ )
            AND ROWNUM = 1
            ORDER BY DONGIA ASC
        </statement>
        <!--Revision:0-->
        <statement id="DAO00030_GetGiaNhapDuocGanNhat" resultClass="DataObject">
            SELECT DONGIAMUA
            FROM
            TT_DUOC_CHUNGTU CT
            inner join TT_DUOC_CHUNGTU_CHITIET CTCT on CT.CHUNGTU_ID = CTCT.CHUNGTU_ID
            inner join LST_DICTIONARY md on md.DICTIONARY_ID = ct.MUCDICHCHUNGTU_ID
            WHERE
            CTCT.DUOC_ID = '$DUOC_ID$'
            and CTCT.DONVITINH_ID = '$DONVITINH_ID$'
            and CT.BENHVIEN_ID = '$BENHVIEN_ID$'
            and md.DICTIONARY_CODE = 'N01'
            and md.DICTIONARY_TYPE_CODE = 'MucDichChungTu'
            and RowNum = 1
            ORDER BY CTCT.SOLONHAP_ID DESC
        </statement>
        <!--Revision:0-->
        <statement id="DAO00030_GetDuocVAT" resultClass="DataObject">
            SELECT *
            FROM
            TM_DUOC_VAT
            WHERE
            KHODUOC_ID = '$KHODUOC_ID$'
            AND LOAIDUOC = '$LOAIDUOC$'
            AND BENHVIEN_ID = '$BENHVIEN_ID$'
        </statement>
        <!--Revision:0-->
        <statement id="DAO00030_GetHoiDongKiemNhap" resultClass="DataObject">
            select *
            from TM_HOIDONG_KIEMNHAP
            where
            HIEULUC = '1'
            AND BENHVIEN_ID = '$BENHVIEN_ID$'
        </statement>
        <!--Revision:0-->
        <statement id="DAO00030_GetHoiDongThanhLy" resultClass="DataObject">
            select *
            from TM_HOIDONG_THANHLY
            where
            HIEULUC = '1'
            AND BENHVIEN_ID = '$BENHVIEN_ID$'
        </statement>
        <!--Revision:0-->
        <statement id="DAO00030_GetHoiDongKiemKe" resultClass="DataObject">
            select *
            from TM_HOIDONG_KIEMKE
            where
            HIEULUC = '1'
            AND BENHVIEN_ID = '$BENHVIEN_ID$'
        </statement>
        <!--Revision:0-->
        <statement id="DAO00030_GetMucDichChungTuID" resultClass="DataObject">
            SELECT DICTIONARY_ID
            FROM
            LST_DICTIONARY
            WHERE
            DICTIONARY_TYPE_CODE = 'MucDichChungTu'
            and DICTIONARY_CODE = '$MUCDICHCHUNGTU_CODE$'
            <!--and BENHVIEN_ID = '$BENHVIEN_ID$'-->
        </statement>
        <statement id="DAO00030_GetNguonDuocMienPhi" resultClass="DataObject">
          SELECT NGUONDUOC_ID
          FROM
          TM_NGUONHANG
          WHERE
          TINHTIEN = 0
          AND BENHVIEN_ID = '$BENHVIEN_ID$'
        </statement>
        <!--Revision:0-->
        <statement id="DAO00030_LayChungTuChuaPhatSinhTrongKy" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
            SELECT
            CHUNGTU_ID
            FROM TT_DUOC_CHUNGTU
            WHERE
            MONTH(NGAYCHUNGTU) = month('$KHOADENNGAY$')
            AND YEAR(NGAYCHUNGTU) = year('$KHOADENNGAY$')
            AND (KHOXUAT_ID = '$KHODUOC_ID$' OR KHONHAP_ID = '$KHODUOC_ID$')
            and BENHVIEN_ID = '$BENHVIEN_ID$'
        </statement>
        <!--Revision:0-->
        <statement id="DAO00030_LayChungTuPhatSinhTrongKyChuaHoanThien" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
            SELECT
            CHUNGTU_ID
            FROM TT_DUOC_CHUNGTU
            WHERE
            MONTH(NGAYCHUNGTU) = month('$KHOADENNGAY$')
            AND YEAR(NGAYCHUNGTU) = year('$KHOADENNGAY$')
            AND (KHOXUAT_ID = '$KHODUOC_ID$' OR KHONHAP_ID = '$KHODUOC_ID$')
            AND (TRANGTHAI = 'PNCNK' or TRANGTHAI = 'CHUATHANHTOA' or  TRANGTHAI = 'CX')
            and BENHVIEN_ID = '$BENHVIEN_ID$'
        </statement>
        <!--Revision:0-->
        <statement id="DAO00030_KiemTraChungTuNhapNCCChuaHoanTat" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
            SELECT
            CHUNGTU_ID,
            mdct.DICTIONARY_CODE
            FROM TT_DUOC_CHUNGTU ct
            INNER JOIN LST_DICTIONARY mdct ON mdct.DICTIONARY_ID = ct.MUCDICHCHUNGTU_ID
            WHERE
            EXTRACT(MONTH FROM ct.NGAYCHUNGTU) = EXTRACT(MONTH FROM trunc(#KHOADENNGAY#)) and EXTRACT(YEAR FROM ct.NGAYCHUNGTU) = EXTRACT(YEAR FROM trunc(#KHOADENNGAY#)) 
            AND mdct.DICTIONARY_CODE = 'N01'
            AND ct.KHONHAP_ID = '$KHODUOC_ID$'
            AND ct.TRANGTHAI = 'PNCNK'
            AND ct.BENHVIEN_ID = '$BENHVIEN_ID$'                  
        </statement>
        <!--Revision:0-->
        <statement id="DAO00030_KiemTraChungTuTraNCCChuaHoanTat" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
            SELECT
            CHUNGTU_ID,
            mdct.DICTIONARY_CODE
            FROM TT_DUOC_CHUNGTU ct
            INNER JOIN LST_DICTIONARY mdct ON mdct.DICTIONARY_ID = ct.MUCDICHCHUNGTU_ID
            WHERE            
            EXTRACT(MONTH FROM ct.NGAYCHUNGTU) = EXTRACT(MONTH FROM trunc(#KHOADENNGAY#)) and EXTRACT(YEAR FROM ct.NGAYCHUNGTU) = EXTRACT(YEAR FROM trunc(#KHOADENNGAY#)) 
            AND mdct.DICTIONARY_CODE = 'X01'
            AND ct.KHOXUAT_ID = '$KHODUOC_ID$'
            AND ct.TRANGTHAI = 'CX'
            AND ct.BENHVIEN_ID = '$BENHVIEN_ID$'
        </statement>
        <!--Revision:0-->
        <statement id="DAO00030_KiemTraChungTuXuatNoiBoChuaNhapKho" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
            SELECT
            CHUNGTU_ID,
            mdct.DICTIONARY_CODE
            FROM TT_DUOC_CHUNGTU ct
            INNER JOIN LST_DICTIONARY mdct ON mdct.DICTIONARY_ID = ct.MUCDICHCHUNGTU_ID
            WHERE            
            EXTRACT(MONTH FROM ct.NGAYCHUNGTU) = EXTRACT(MONTH FROM trunc(#KHOADENNGAY#)) and EXTRACT(YEAR FROM ct.NGAYCHUNGTU) = EXTRACT(YEAR FROM trunc(#KHOADENNGAY#)) 
            AND mdct.DICTIONARY_CODE = 'X07'
            AND ct.CHUNGTULIENQUAN_ID is null
            AND ct.KHONHAP_ID = '$KHODUOC_ID$'
            AND ct.BENHVIEN_ID = '$BENHVIEN_ID$'
        </statement>
        <!--Revision:0-->
        <statement id="DAO00030_KiemTraChungTuHoanTraChuaNhapKho" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
            SELECT
            CHUNGTU_ID,
            mdct.DICTIONARY_CODE
            FROM TT_DUOC_CHUNGTU ct
            INNER JOIN LST_DICTIONARY mdct ON mdct.DICTIONARY_ID = ct.MUCDICHCHUNGTU_ID
            WHERE
            EXTRACT(MONTH FROM ct.NGAYCHUNGTU) = EXTRACT(MONTH FROM trunc(#KHOADENNGAY#)) and EXTRACT(YEAR FROM ct.NGAYCHUNGTU) = EXTRACT(YEAR FROM trunc(#KHOADENNGAY#)) 
            AND mdct.DICTIONARY_CODE = 'X05'
            AND ct.CHUNGTULIENQUAN_ID is null
            AND ct.KHONHAP_ID = '$KHODUOC_ID$'
            AND ct.BENHVIEN_ID = '$BENHVIEN_ID$'
        </statement>
        <statement id="DAO00030_GetChungTuChuaHoanTat" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
          SELECT
          CHUNGTU_ID,
          MACHUNGTU,
          NGAYCHUNGTU,
          CASE
          WHEN MUCDICHCHUNGTU_CODE = 'N01' THEN KN.TENKHO
          WHEN MUCDICHCHUNGTU_CODE = 'X01' THEN KX.TENKHO
          WHEN MUCDICHCHUNGTU_CODE = 'X07' THEN KN.TENKHO
          WHEN MUCDICHCHUNGTU_CODE = 'X05' THEN KN.TENKHO
          END  AS KHOTHUCHIEN,

          CASE
          WHEN MUCDICHCHUNGTU_CODE = 'N01' THEN N'Chuyển trạng thái nhập kho hoặc xóa'
          WHEN MUCDICHCHUNGTU_CODE = 'X01' THEN N'Chuyển trạng thái xác nhận hoặc xóa'
          WHEN MUCDICHCHUNGTU_CODE = 'X07' THEN N'Nhập nội bộ'
          WHEN MUCDICHCHUNGTU_CODE = 'X05' THEN N'Nhập hoàn trả'
          END  AS HANHDONG

          FROM TT_DUOC_CHUNGTU ct
          LEFT JOIN TM_KHODUOC KN ON KN.KHODUOC_ID = ct.KHONHAP_ID
          LEFT JOIN TM_KHODUOC KX ON KX.KHODUOC_ID = ct.KHOXUAT_ID
          WHERE
          CT.CHUNGTU_ID IN ($LIST_CHUNGTU_ID$)
        </statement>
        <!--Revision:0-->
        <statement id="DAO00030_LayKyKhoaSoTheoKho" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
            SELECT
            KHODUOC_ID
            FROM TT_DUOC_KHOASOCHUNGTU
            WHERE
            KYTONKHO = '$KYTONKHO$'
            AND KHODUOC_ID = '$KHODUOC_ID$'
            AND KHOASO = '1'
            and BENHVIEN_ID = '$BENHVIEN_ID$'
        </statement>
        <!--Revision:0-->
        <statement id="DAO00030_GetKhoDuocDoiTuong" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
            select kd.* from TM_DOITUONG_KHODUOC kd
            inner join TM_DOITUONG dt on dt.DOITUONG_ID = kd.DOITUONG_ID
            WHERE
            kd.NGAYTRONGTUAN = '$NGAYTRONGTUAN$'
            and dt.MADOITUONG = '$MADOITUONG$'
            and kd.BENHVIEN_ID = '$BENHVIEN_ID$'
        </statement>
        <!--Revision:0-->
        <statement id="DAO00030_GetDanhSachToaThuoc" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
          SELECT CT.CHUNGTU_ID, CT.TIEPNHAN_ID,KB.DICHVU_ID,YC.DVYEUCAU_ID ,TT.SOLUONG_BUOISANG ,TT.SOLUONG_BUOICHIEU ,TT.SOLUONG_BUOITRUA ,TT.SOLUONG_BUOITOI
          ,TT.SONGAY,TT.SOLUONG,TT.DUONGDUNG_ID,TT.GHICHU, TT.DUOC_ID, KBTT.BACSI_ID,KBTT.KHAMBENH_TOATHUOC_ID	  ,BN.TENBENHNHAN,BN.BENHNHAN_ID
          ,BN.MAYTE,BN.NAMSINH,BN.GIOITINH AS GIOITINH_ID,TN.SOTIEPNHAN,NVL(CT.DAXACNHAN,'0') DAXACNHAN, TO_CHAR(KBTT.NGAYTOATHUOC,'DD/MM/YYYY') NGAYTOATHUOC
          FROM TT_DUOC_CHUNGTU CT
          INNER JOIN TT_NGOAITRU_KHAMBENH_TOATHUOC KBTT ON (CT.CHUNGTU_ID =KBTT.CHUNGTUPHATTHUOC_ID AND KBTT.LOAITOATHUOC = 'BV')
          INNER JOIN TT_NGOAITRU_TOATHUOC TT ON KBTT.KHAMBENH_TOATHUOC_ID = TT.KHAMBENH_TOATHUOC_ID
          INNER JOIN TT_TIEPNHAN TN ON CT.TIEPNHAN_ID =TN.TIEPNHAN_ID
          INNER JOIN TT_BENHNHAN BN ON TN.BENHNHAN_ID =BN.BENHNHAN_ID
          LEFT JOIN TT_NGOAITRU_KHAMBENH KB ON TT.KHAMBENH_ID=KB.KHAMBENH_ID
          LEFT JOIN TT_DVYEUCAU YC ON KB.KHAMBENH_ID =YC.KHAMBENH_NGOAITRU_ID
          <dynamic prepend="where">
                <isParameterPresent>
                    <isNotEmpty prepend="and" property="DAXACNHAN">
                        NVL(CT.DAXACNHAN,'0') = '$DAXACNHAN$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="TUNGAY">                        
                      trunc(BK.NGAYTAO) BETWEEN  trunc(#TUNGAY#) and  trunc(#DENNGAY#)
                    </isNotEmpty>                  
                    <isNotEmpty prepend="and" property="BENHVIEN_ID">
                        CT.BENHVIEN_ID = '$BENHVIEN_ID$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="MAYTE">
                        BN.MAYTE LIKE '%$MAYTE$%' OR  BN.TENBENHNHAN LIKE '%$MAYTE$%'
                    </isNotEmpty>
                </isParameterPresent>
            </dynamic>
        </statement>
        <!--Revision:0-->
        <statement id="DAO00030_GetDetailToaThuoc" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
            SELECT CTCT.DUOC_ID,CTCT.DONVITINH_ID,CTCT.HANDUNG,SOLO.SOLONHAP,CTCT.SOLUONGDAXUAT,SOLO.SOLOSANPHAM SOCHUNGTUGOC,CT.KHOXUAT_ID,TO_CHAR(CT.NGAYCHUNGTU,'MM/DD/YYYY') NGAYCHUNGTU,CT.MACHUNGTU
            FROM TT_DUOC_CHUNGTU CT
            INNER JOIN TT_DUOC_CHUNGTU_CHITIET CTCT ON CT.CHUNGTU_ID=CTCT.CHUNGTU_ID
            INNER JOIN TT_DUOC_CHUNGTU_SOLONHAP SOLO ON CTCT.SOLONHAP_ID=SOLO.SOLONHAP_ID
            WHERE CT.CHUNGTU_ID='$CHUNGTU_ID$' AND CT.BENHVIEN_ID='$BENHVIEN_ID$'
        </statement>
        <!--Revision:0-->
        <update id="DAO00030_XacNhanPhatThuoc" parameterClass="System.Collections.IDictionary">
            update TT_DUOC_CHUNGTU set
            DAXACNHAN = #STATUS#
            , NGAYCAPNHAT = #NGAYCAPNHAT#
            , NGUOICAPNHAT_ID = #NGUOICAPNHAT_ID#
            where
            CHUNGTU_ID = '$CHUNGTU_ID$'
        </update>
    
    </statements>
</sqlMap>
