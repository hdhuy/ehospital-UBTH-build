<?xml version="1.0" encoding="utf-8" ?>
<!--iBatis Map File-->
<sqlMap namespace="eHospital" xmlns="http://ibatis.apache.org/mapping" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
    <statements>
        <!--Revision:0,33aaeb3169e3d8ff15aa9b18462dd626-->
        <statement id="DAO00214_ETT04_DOITUONG_GetList" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
            SELECT DT.DOITUONG_ID AS CATEGORY_ID, DT.MADOITUONG AS CATEGORY_CODE, DT.TENDOITUONG AS CATEGORY_NAME, 1 AS FOLDER_LEVEL, 0 AS PARENT_ID, '0' AS IS_FOLDER
            FROM TM_DOITUONG DT
            WHERE DT.ACTIVE = '1' AND DT.BENHVIEN_ID = '$BENHVIEN_ID$'
        </statement>
        <!--Revision:0,626ef960e45f994734c735c5e5b17dcf-->
        <statement id="DAO00214_ETT04_DOITUONG_GIADICHVU_GetList" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
            WITH TABLE_PIVOT(DICHVU_ID, MADICHVU, TENDICHVU, NHOMDICHVU_ID, TENNHOMDICHVU, LOAIGIA_ID, TENLOAIGIA, MALOAIGIA, DONGIA, SELECTED, DOITUONG_GIADICHVU_ID) AS
            (
            SELECT D.DICHVU_ID, D.MADICHVU, D.TENDICHVU, D.NHOMDICHVU_ID, ND.TENNHOMDICHVU, L.LOAIGIA_ID, L.TENLOAIGIA, L.MALOAIGIA
            , DD.DONGIA, (CASE WHEN DG.DOITUONG_GIADICHVU_ID IS NULL THEN 0 ELSE 1 END) AS SELECTED, DG.DOITUONG_GIADICHVU_ID
            FROM TM_DICHVU D
            INNER JOIN TM_NHOMDICHVU ND ON ND.NHOMDICHVU_ID = D.NHOMDICHVU_ID AND ND.BENHVIEN_ID = '$BENHVIEN_ID$' AND ND.TAMNGUNG = '0'
            INNER JOIN (SELECT * FROM TM_LOAIGIA WHERE TAMNGUNG = '0' AND BENHVIEN_ID = '$BENHVIEN_ID$' AND LOAIGIA_ID IN ($COLUMNID_LIST$)) L ON 1=1
            LEFT JOIN TM_BANGGIA B ON B.LOAIGIA_ID = L.LOAIGIA_ID AND B.TAMNGUNG = '0' AND B.BENHVIEN_ID = '$BENHVIEN_ID$'
            LEFT JOIN TM_DICHVU_DONGIA DD ON DD.DICHVU_ID = D.DICHVU_ID AND DD.LOAIGIA_ID = L.LOAIGIA_ID AND DD.BANGGIA_ID = B.BANGGIA_ID AND DD.TAMNGUNG = '0' AND DD.BENHVIEN_ID = '$BENHVIEN_ID$'
            LEFT JOIN TM_DOITUONG_GIADICHVU DG ON DG.DOITUONG_ID = '$DOITUONG_ID$' AND DG.DICHVU_ID = D.DICHVU_ID AND L.LOAIGIA_ID = DG.LOAIGIA_ID AND DG.TAMNGUNG = '0' AND DG.BENHVIEN_ID = '$BENHVIEN_ID$'
            WHERE D.TAMNGUNG = '0' AND D.BENHVIEN_ID = '$BENHVIEN_ID$'
            )
            SELECT DICHVU_ID, MADICHVU, TENDICHVU, NHOMDICHVU_ID, TENNHOMDICHVU
            $SELECT_LIST$
            FROM TABLE_PIVOT
            GROUP BY DICHVU_ID, MADICHVU, TENDICHVU, NHOMDICHVU_ID, TENNHOMDICHVU
        </statement>
        <!--Revision:0,46abde002f86a8ba6c67d12ddd0e4e25-->
        <statement id="DAO00214_ETT04_GETLOAIGIADICHVU_GetList" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
            SELECT L1.* FROM TM_LOAIGIA L1
            INNER JOIN TM_LOAIGIA L2 ON L1.CAPTREN_ID = L2.LOAIGIA_ID AND L2.MALOAIGIA = 'GiaDichVu' AND L2.TAMNGUNG = '0' AND L2.BENHVIEN_ID = '$BENHVIEN_ID$'
            WHERE L1.TAMNGUNG = '0' AND L1.BENHVIEN_ID = '$BENHVIEN_ID$'
        </statement>
        <!--Revision:0,e7eec09d43d1262daa2cd9bbcee53c79-->
        <insert id="DAO00214_ETT04_Add" parameterClass="System.Collections.IDictionary" resultClass="System.Int64">
            <selectKey property="ID" type="pre" resultClass="System.Int64">
                select TM_DOITUONG_GIADICHVU_S.nextval as value from dual
            </selectKey>
            insert into TM_DOITUONG_GIADICHVU (
            DOITUONG_GIADICHVU_ID
            , DOITUONG_ID
            , DICHVU_ID
            , LOAIGIA_ID
            , TIENTE_ID
            , TRANGTHAI
            , TAMNGUNG
            , NGUOITAO_ID
            , NGAYTAO
            , NGUOICAPNHAT_ID
            , NGAYCAPNHAT
            , BENHVIEN_ID
            ) values (
            #ID#
            , #DOITUONG_ID#
            , #DICHVU_ID#
            , #LOAIGIA_ID#
            , #TIENTE_ID#
            , #TRANGTHAI#
            , #TAMNGUNG#
            , #NGUOITAO_ID#
            , #NGAYTAO#
            , #NGUOICAPNHAT_ID#
            , #NGAYCAPNHAT#
            , #BENHVIEN_ID#
            )
        </insert>
        <!--Revision:0,37b69a66fde2a55af642a5bce6c71869-->
        <update id="DAO00214_ETT04_Update" parameterClass="System.Collections.IDictionary">
            update TM_DOITUONG_GIADICHVU set
            DOITUONG_ID = #DOITUONG_ID#
            , DICHVU_ID = #DICHVU_ID#
            , LOAIGIA_ID = #LOAIGIA_ID#
            , TIENTE_ID = #TIENTE_ID#
            , TRANGTHAI = #TRANGTHAI#
            , TAMNGUNG = #TAMNGUNG#
            , NGUOICAPNHAT_ID = #NGUOICAPNHAT_ID#
            , NGAYCAPNHAT = #NGAYCAPNHAT#
            , BENHVIEN_ID = #BENHVIEN_ID#
            where
            DOITUONG_GIADICHVU_ID = '$DOITUONG_GIADICHVU_ID$'
        </update>
        <!--Revision:0,4728bc88cd6b7766aad2de16ac6b6612-->
        <statement id="DAO00214_ETT04_Delete" parameterClass="System.Collections.IDictionary" resultClass="System.Int32">
            DELETE FROM TM_DOITUONG_GIADICHVU
            WHERE DOITUONG_ID = '$DOITUONG_ID$' AND LOAIGIA_ID = '$LOAIGIA_ID$' AND DICHVU_ID = '$DICHVU_ID$' AND BENHVIEN_ID = '$BENHVIEN_ID$'
        </statement>
        <!--Revision:0,a65058fb4b49cd596678d3bd8154355b-->
        <statement id="DAO00214_ETT04_GetDetail" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
            SELECT *
            FROM TM_DOITUONG_GIADICHVU
            WHERE DOITUONG_ID = '$DOITUONG_ID$' AND LOAIGIA_ID = '$LOAIGIA_ID$' AND DICHVU_ID = '$DICHVU_ID$' AND BENHVIEN_ID = '$BENHVIEN_ID$'
        </statement>
        <!--Revision:0,f2f9884418314d301cc62fbc89ff7a58-->
        <statement id="DAO00214_ETT05_DOITUONG_GetList" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
            SELECT DT.DOITUONG_ID AS CATEGORY_ID, DT.MADOITUONG AS CATEGORY_CODE, DT.TENDOITUONG AS CATEGORY_NAME, 1 AS FOLDER_LEVEL, 0 AS PARENT_ID, '0' AS IS_FOLDER
            FROM TM_DOITUONG DT
            WHERE DT.ACTIVE = '1' AND DT.BENHVIEN_ID = '$BENHVIEN_ID$'
        </statement>
        <!--Revision:0,d23042f6a93a62fc65453368cfe2baee-->
        <statement id="DAO00214_ETT05_DOITUONG_GIAPHONGBENH_GetList" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
            WITH TABLE_PIVOT(PHONGBENH_ID, TENPHONGBENH, KHOA_ID, TENKHOA, LOAIGIA_ID, TENLOAIGIA, MALOAIGIA, DONGIA, SELECTED, DOITUONG_GIAPHONGBENH_ID) AS
            (
            SELECT PB.PHONGBAN_ID AS PHONGBENH_ID, PB.TENPHONGBAN AS TENPHONGBENH, PB2.PHONGBAN_ID AS KHOA_ID, PB2.TENPHONGBAN AS TENKHOA, L.LOAIGIA_ID, L.TENLOAIGIA, L.MALOAIGIA
            , PD.DONGIA, (CASE WHEN DG.DOITUONG_GIAPHONGBENH_ID IS NULL THEN 0 ELSE 1 END) AS SELECTED, DG.DOITUONG_GIAPHONGBENH_ID
            FROM TM_PHONGBAN PB
            INNER JOIN LST_DICTIONARY D ON D.DICTIONARY_ID = PB.LOAIPHONGBAN_ID AND D.DICTIONARY_CODE IN ('PhongBenh') AND D.ENABLED = '1'
            <!--AND D.BENHVIEN_ID = '$BENHVIEN_ID$'-->
            INNER JOIN TM_PHONGBAN PB2 ON PB2.PHONGBAN_ID = PB.CAPTREN_ID AND PB2.TAMNGUNG = '0' AND PB2.BENHVIEN_ID = '$BENHVIEN_ID$'
            INNER JOIN (SELECT * FROM TM_LOAIGIA WHERE TAMNGUNG = '0' AND BENHVIEN_ID = '$BENHVIEN_ID$' AND LOAIGIA_ID IN ($COLUMNID_LIST$)) L ON 1=1
            INNER JOIN TM_BANGGIA B ON B.LOAIGIA_ID = L.LOAIGIA_ID AND B.TAMNGUNG = '0' AND B.BENHVIEN_ID = '$BENHVIEN_ID$'
            LEFT JOIN TM_PHONGBENH_DONGIA PD ON PD.PHONGBENH_ID = PB.PHONGBAN_ID AND PD.LOAIGIA_ID = L.LOAIGIA_ID AND PD.BANGGIA_ID = B.BANGGIA_ID AND PD.TAMNGUNG = '0' AND PD.BENHVIEN_ID = '$BENHVIEN_ID$'
            LEFT JOIN TM_DOITUONG_GIAPHONGBENH DG ON DG.DOITUONG_ID = '$DOITUONG_ID$' AND DG.PHONGBENH_ID = PB.PHONGBAN_ID AND L.LOAIGIA_ID = DG.LOAIGIA_ID AND DG.TAMNGUNG = '0' AND DG.BENHVIEN_ID = '$BENHVIEN_ID$'
            WHERE PB.TAMNGUNG = '0' AND PB.BENHVIEN_ID = '$BENHVIEN_ID$'
            )
            SELECT PHONGBENH_ID, TENPHONGBENH, KHOA_ID, TENKHOA
            $SELECT_LIST$
            FROM TABLE_PIVOT
            GROUP BY PHONGBENH_ID, TENPHONGBENH, KHOA_ID, TENKHOA
        </statement>
        <!--Revision:0,9d0051aa8fba0a7b214d6eff2e06b02e-->
        <statement id="DAO00214_ETT05_GETLOAIGIAPHONGBENH_GetList" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
            SELECT L1.* FROM TM_LOAIGIA L1
            INNER JOIN TM_LOAIGIA L2 ON L1.CAPTREN_ID = L2.LOAIGIA_ID AND L2.MALOAIGIA = 'GiaPhong' AND L2.TAMNGUNG = '0' AND L2.BENHVIEN_ID = '$BENHVIEN_ID$'
            WHERE L1.TAMNGUNG = '0' AND L1.BENHVIEN_ID = '$BENHVIEN_ID$'
        </statement>
        <!--Revision:0,8251d9a20700b04ab58a1c58f14861c3-->
        <insert id="DAO00214_ETT05_Add" parameterClass="System.Collections.IDictionary" resultClass="System.Int64">
            <selectKey property="ID" type="pre" resultClass="System.Int64">
                select TM_DOITUONG_GIAPHONGBENH_S.nextval as value from dual
            </selectKey>
            insert into TM_DOITUONG_GIAPHONGBENH (
            DOITUONG_GIAPHONGBENH_ID
            , DOITUONG_ID
            , PHONGBENH_ID
            , LOAIGIA_ID
            , TIENTE_ID
            , TRANGTHAI
            , TAMNGUNG
            , NGUOITAO_ID
            , NGAYTAO
            , NGUOICAPNHAT_ID
            , NGAYCAPNHAT
            , BENHVIEN_ID
            ) values (
            #ID#
            , #DOITUONG_ID#
            , #PHONGBENH_ID#
            , #LOAIGIA_ID#
            , #TIENTE_ID#
            , #TRANGTHAI#
            , #TAMNGUNG#
            , #NGUOITAO_ID#
            , #NGAYTAO#
            , #NGUOICAPNHAT_ID#
            , #NGAYCAPNHAT#
            , #BENHVIEN_ID#
            )
        </insert>
        <!--Revision:0,43362bc723feca45fd6dd820911e8da5-->
        <update id="DAO00214_ETT05_Update" parameterClass="System.Collections.IDictionary">
            update TM_DOITUONG_GIAPHONGBENH set
            DOITUONG_ID = #DOITUONG_ID#
            , PHONGBENH_ID = #PHONGBENH_ID#
            , LOAIGIA_ID = #LOAIGIA_ID#
            , TIENTE_ID = #TIENTE_ID#
            , TRANGTHAI = #TRANGTHAI#
            , TAMNGUNG = #TAMNGUNG#
            , NGUOICAPNHAT_ID = #NGUOICAPNHAT_ID#
            , NGAYCAPNHAT = #NGAYCAPNHAT#
            , BENHVIEN_ID = #BENHVIEN_ID#
            where
            DOITUONG_GIAPHONGBENH_ID = '$DOITUONG_GIAPHONGBENH_ID$'
        </update>
        <!--Revision:0,5e7d9f9d212a1f681d28413b03134c99-->
        <statement id="DAO00214_ETT05_Delete" parameterClass="System.Collections.IDictionary" resultClass="System.Int32">
            DELETE FROM TM_DOITUONG_GIAPHONGBENH
            WHERE DOITUONG_ID = '$DOITUONG_ID$' AND LOAIGIA_ID = '$LOAIGIA_ID$' AND PHONGBENH_ID = '$PHONGBENH_ID$' AND BENHVIEN_ID = '$BENHVIEN_ID$'
        </statement>
        <!--Revision:0,9bd987e5d4f37d6bb99dc3b7b1e6f252-->
        <statement id="DAO00214_ETT05_GetDetail" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
            SELECT *
            FROM TM_DOITUONG_GIAPHONGBENH
            WHERE DOITUONG_ID = '$DOITUONG_ID$' AND LOAIGIA_ID = '$LOAIGIA_ID$' AND PHONGBENH_ID = '$PHONGBENH_ID$' AND BENHVIEN_ID = '$BENHVIEN_ID$'
        </statement>
        <!--Revision:0,9dc99269f91760f4bbe4e4993e4515b3-->
        <statement id="DAO00214_ETT06_DOITUONG_GetList" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
            SELECT DT.DOITUONG_ID AS CATEGORY_ID, DT.MADOITUONG AS CATEGORY_CODE, DT.TENDOITUONG AS CATEGORY_NAME, 1 AS FOLDER_LEVEL, 0 AS PARENT_ID, '0' AS IS_FOLDER
            FROM TM_DOITUONG DT
            WHERE DT.ACTIVE = '1' AND DT.BENHVIEN_ID = '$BENHVIEN_ID$'
        </statement>
        <!--Revision:0,4e1ebde6385f2db245d22edc8cd86f83-->
        <statement id="DAO00214_ETT06_DOITUONG_GIAGIUONGBENH_GetList" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
            WITH TABLE_PIVOT(GIUONGBENH_ID, MAGIUONG, PHONGBENH_ID, TENPHONGBENH, KHOA_ID, TENKHOA, LOAIGIA_ID, TENLOAIGIA, MALOAIGIA, DONGIA, SELECTED, DOITUONG_GIAGIUONG_ID) AS
            (
            SELECT GB.GIUONGBENH_ID, GB.MAGIUONG, PB1.PHONGBAN_ID AS PHONGBENH_ID, PB1.TENPHONGBAN AS TENPHONGBENH, PB2.PHONGBAN_ID AS KHOA_ID, PB2.TENPHONGBAN AS TENKHOA
            , L.LOAIGIA_ID, L.TENLOAIGIA, L.MALOAIGIA, GD.DONGIA, (CASE WHEN DG.DOITUONG_GIAGIUONG_ID IS NULL THEN 0 ELSE 1 END) AS SELECTED, DG.DOITUONG_GIAGIUONG_ID
            FROM TM_GIUONGBENH GB
            INNER JOIN TM_PHONGBAN PB1 ON PB1.PHONGBAN_ID = GB.PHONGBENH_ID AND PB1.TAMNGUNG = '0' AND PB1.BENHVIEN_ID = '$BENHVIEN_ID$'
            INNER JOIN TM_PHONGBAN PB2 ON PB2.PHONGBAN_ID = GB.KHOADIEUTRI_ID AND PB2.TAMNGUNG = '0' AND PB2.BENHVIEN_ID = '$BENHVIEN_ID$'
            INNER JOIN (SELECT * FROM TM_LOAIGIA WHERE TAMNGUNG = '0' AND BENHVIEN_ID = '$BENHVIEN_ID$' AND LOAIGIA_ID IN ($COLUMNID_LIST$)) L ON 1=1
            INNER JOIN TM_BANGGIA B ON B.LOAIGIA_ID = L.LOAIGIA_ID AND B.TAMNGUNG = '0' AND B.BENHVIEN_ID = '$BENHVIEN_ID$'
            LEFT JOIN TM_GIUONGBENH_DONGIA GD ON GB.GIUONGBENH_ID = GD.GIUONGBENH_ID AND GD.LOAIGIA_ID = L.LOAIGIA_ID AND GD.BANGGIA_ID = B.BANGGIA_ID AND GD.TAMNGUNG = '0' AND GD.BENHVIEN_ID = '$BENHVIEN_ID$'
            LEFT JOIN TM_DOITUONG_GIAGIUONG DG ON DG.DOITUONG_ID = '$DOITUONG_ID$' AND DG.GIUONGBENH_ID = GB.GIUONGBENH_ID AND L.LOAIGIA_ID = DG.LOAIGIA_ID AND DG.TAMNGUNG = '0' AND DG.BENHVIEN_ID = '$BENHVIEN_ID$'
            WHERE GB.TAMNGUNG = '0' AND GB.BENHVIEN_ID = '$BENHVIEN_ID$'
            )
            SELECT GIUONGBENH_ID, MAGIUONG, PHONGBENH_ID, TENPHONGBENH, KHOA_ID, TENKHOA
            $SELECT_LIST$
            FROM TABLE_PIVOT
            GROUP BY GIUONGBENH_ID, MAGIUONG, PHONGBENH_ID, TENPHONGBENH, KHOA_ID, TENKHOA
        </statement>
        <!--Revision:0,02bc96d0af8b827bd40a03e8d47a8248-->
        <statement id="DAO00214_ETT06_GETLOAIGIAGIUONGBENH_GetList" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
            SELECT L1.* FROM TM_LOAIGIA L1
            INNER JOIN TM_LOAIGIA L2 ON L1.CAPTREN_ID = L2.LOAIGIA_ID AND L2.MALOAIGIA = 'GiaGiuong' AND L2.TAMNGUNG = '0' AND L2.BENHVIEN_ID = '$BENHVIEN_ID$'
            WHERE L1.TAMNGUNG = '0' AND L1.BENHVIEN_ID = '$BENHVIEN_ID$'
        </statement>
        <!--Revision:0,efff7efaab164112eb9bafaf71fcc3fc-->
        <insert id="DAO00214_ETT06_Add" parameterClass="System.Collections.IDictionary" resultClass="System.Int64">
            <selectKey property="ID" type="pre" resultClass="System.Int64">
                select TM_DOITUONG_GIAGIUONG_S.nextval as value from dual
            </selectKey>
            insert into TM_DOITUONG_GIAGIUONG (
            DOITUONG_GIAGIUONG_ID
            , DOITUONG_ID
            , GIUONGBENH_ID
            , LOAIGIA_ID
            , TIENTE_ID
            , TRANGTHAI
            , TAMNGUNG
            , NGUOITAO_ID
            , NGAYTAO
            , NGUOICAPNHAT_ID
            , NGAYCAPNHAT
            , BENHVIEN_ID
            ) values (
            #ID#
            , #DOITUONG_ID#
            , #GIUONGBENH_ID#
            , #LOAIGIA_ID#
            , #TIENTE_ID#
            , #TRANGTHAI#
            , #TAMNGUNG#
            , #NGUOITAO_ID#
            , #NGAYTAO#
            , #NGUOICAPNHAT_ID#
            , #NGAYCAPNHAT#
            , #BENHVIEN_ID#
            )
        </insert>
        <!--Revision:0,791afdc563630de94b88a34bba6e412e-->
        <update id="DAO00214_ETT06_Update" parameterClass="System.Collections.IDictionary">
            update TM_DOITUONG_GIAGIUONG set
            DOITUONG_ID = #DOITUONG_ID#
            , GIUONGBENH_ID = #GIUONGBENH_ID#
            , LOAIGIA_ID = #LOAIGIA_ID#
            , TIENTE_ID = #TIENTE_ID#
            , TRANGTHAI = #TRANGTHAI#
            , TAMNGUNG = #TAMNGUNG#
            , NGUOICAPNHAT_ID = #NGUOICAPNHAT_ID#
            , NGAYCAPNHAT = #NGAYCAPNHAT#
            , BENHVIEN_ID = #BENHVIEN_ID#
            where
            DOITUONG_GIAGIUONG_ID = '$DOITUONG_GIAGIUONG_ID$'
        </update>
        <!--Revision:0,6736e6de49ee3b33469f9f29fc756313-->
        <statement id="DAO00214_ETT06_Delete" parameterClass="System.Collections.IDictionary" resultClass="System.Int32">
            DELETE FROM TM_DOITUONG_GIAGIUONG
            WHERE DOITUONG_ID = '$DOITUONG_ID$' AND LOAIGIA_ID = '$LOAIGIA_ID$' AND GIUONGBENH_ID = '$GIUONGBENH_ID$' AND BENHVIEN_ID = '$BENHVIEN_ID$'
        </statement>
        <!--Revision:0,f5ddb44602d86f5b69d001449ef48704-->
        <statement id="DAO00214_ETT06_GetDetail" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
            SELECT *
            FROM TM_DOITUONG_GIAGIUONG
            WHERE DOITUONG_ID = '$DOITUONG_ID$' AND LOAIGIA_ID = '$LOAIGIA_ID$' AND GIUONGBENH_ID = '$GIUONGBENH_ID$' AND BENHVIEN_ID = '$BENHVIEN_ID$'
        </statement>
    </statements>
</sqlMap>
