<?xml version="1.0" encoding="utf-8" ?>
<sqlMap namespace="eHospital" xmlns="http://ibatis.apache.org/mapping" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" >

  <statements>
    <statement id="DAO00400_GetList" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
      select HH.*,HH.ID AS HANGHOA_ID, HH.MA AS MAHANGHOA, HH.TEN AS TENHANGHOA from TM_PUR_HANGHOA HH where HH.BENHVIEN_ID = '$BENHVIEN_ID$'
      order by TEN
    </statement>
    <statement id="DAO00400_PUR001_GetQuyTrinh" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
      select * from TM_PUR_PROCESS where BENHVIEN_ID = '$BENHVIEN_ID$'
      order by PROCESS_CODE
    </statement>
    <update id="DAO00400_PUR001_UpdateQuyTrinh" parameterClass="DataObject">
      update TM_PUR_PROCESS SET PROCESS_CODE = #PROCESS_CODE#,NAME = #NAME#,START_STATE_CODE = #START_STATE_CODE#,ACTIVE = #ACTIVE#,BENHVIEN_ID = #BENHVIEN_ID#
      where ID = '$ID$'
    </update>
    <insert id="DAO00400_PUR001_AddQuyTrinh" parameterClass="DataObject" resultClass="System.Int64">
      <selectKey property="ID" type="pre" resultClass="System.Int64">
        select TM_PUR_PROCESS_S.nextval as value from dual
      </selectKey>
      INSERT INTO TM_PUR_PROCESS (ID,PROCESS_CODE,NAME,START_STATE_CODE,ACTIVE,BENHVIEN_ID) VALUES (#ID#,#PROCESS_CODE#,#NAME#,#START_STATE_CODE#,#ACTIVE#,#BENHVIEN_ID#)      
    </insert>
    <statement id="DAO00400_PUR001_DeleteQuyTrinh" parameterClass="System.String" resultClass="System.Int32">
      delete from TM_PUR_PROCESS where ID = '$ID$'
    </statement>
    <statement id="DAO00400_PUR001_GetTrangThai" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
      select * from TM_PUR_STATE where BENHVIEN_ID = '$BENHVIEN_ID$'
      order by PROCESS_CODE
    </statement>
    <update id="DAO00400_PUR001_UpdateTrangThai" parameterClass="DataObject">
      update TM_PUR_STATE SET PROCESS_CODE = #PROCESS_CODE#,STATE_CODE = #STATE_CODE#,NAME = #NAME#,ACTIVE = #ACTIVE#,BENHVIEN_ID = #BENHVIEN_ID#
      where ID = '$ID$'
    </update>
    <insert id="DAO00400_PUR001_AddTrangThai" parameterClass="DataObject" resultClass="System.Int64">
      <selectKey property="ID" type="pre" resultClass="System.Int64">
        select TM_PUR_STATE_S.nextval as value from dual
      </selectKey>
      INSERT INTO TM_PUR_STATE (ID,PROCESS_CODE,STATE_CODE,NAME,ACTIVE,BENHVIEN_ID) VALUES (#ID#,#PROCESS_CODE#,#STATE_CODE#,#NAME#,#ACTIVE#,#BENHVIEN_ID#)      
    </insert>
    <statement id="DAO00400_PUR001_DeleteTrangThai" parameterClass="System.String" resultClass="System.Int32">
      delete from TM_PUR_STATE where ID = '$ID$'
    </statement>
    <statement id="DAO00400_PUR001_GetTrangThaiHanhDong" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
      select * from TM_PUR_STATE_ACTION where BENHVIEN_ID = '$BENHVIEN_ID$'
      order by PROCESS_CODE
    </statement>
    <update id="DAO00400_PUR001_UpdateTrangThaiHanhDong" parameterClass="DataObject">
      update TM_PUR_STATE_ACTION SET PROCESS_CODE = #PROCESS_CODE#,CURR_STATE_CODE = #CURR_STATE_CODE#,NEXT_STATE_CODE = #NEXT_STATE_CODE#,ORDER_ID = #ORDER_ID#,BENHVIEN_ID = #BENHVIEN_ID#
      where ID = '$ID$'
    </update>
    <insert id="DAO00400_PUR001_AddTrangThaiHanhDong" parameterClass="DataObject" resultClass="System.Int64">
      <selectKey property="ID" type="pre" resultClass="System.Int64">
        select TM_PUR_STATE_ACTION_S.nextval as value from dual
      </selectKey>
      INSERT INTO TM_PUR_STATE_ACTION (ID,PROCESS_CODE,CURR_STATE_CODE,NEXT_STATE_CODE,ORDER_ID,BENHVIEN_ID) VALUES (#ID#,#PROCESS_CODE#,#CURR_STATE_CODE#,#NEXT_STATE_CODE#,#ORDER_ID#,#BENHVIEN_ID#)      
    </insert>
    <statement id="DAO00400_PUR001_DeleteTrangThaiHanhDong" parameterClass="System.String" resultClass="System.Int32">
      delete from TM_PUR_STATE_ACTION where ID = '$ID$'
    </statement>
    <statement id="DAO00400_PUR001_GetLuaChonGia" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
      SELECT DICTIONARY_CODE AS MACHONGIA,DICTIONARY_NAME AS TENCHONGIA, ENABLED AS ACTIVE FROM LST_DICTIONARY
      WHERE DICTIONARY_TYPE_CODE = 'LoaiLuaChonGia' AND ENABLED=1 ORDER BY DICTIONARY_NAME
    </statement>
    <update id="DAO00400_PUR001_UpdateLuaChonGia" parameterClass="DataObject">
      update TM_PUR_LUACHONGIA SET MA = #MA#,TEN = #TEN#,ACTIVE = #ACTIVE#,BENHVIEN_ID = #BENHVIEN_ID#
      where ID = '$ID$'
    </update>
    <insert id="DAO00400_PUR001_AddLuaChonGia" parameterClass="DataObject" resultClass="System.Int64">
      <selectKey property="ID" type="pre" resultClass="System.Int64">
        select TM_PUR_LUACHONGIA_S.nextval as value from dual
      </selectKey>
      INSERT INTO TM_PUR_LUACHONGIA (ID,MA,TEN,ACTIVE,BENHVIEN_ID) VALUES (#ID#,#MA#,#TEN#,#ACTIVE#,#BENHVIEN_ID#)      
    </insert>
    <statement id="DAO00400_PUR001_DeleteLuaChonGia" parameterClass="System.String" resultClass="System.Int32">
      delete from TM_PUR_LUACHONGIA where ID = '$ID$'
    </statement>
    <statement id="DAO00400_PUR001_GetDanhMucLoaiTheoNguoiDuyet" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
      select DISTINCT A.ID,A.MA,A.TEN,A.ACTIVE, A.ID AS LOAI_ID, A.TEN AS TENLOAI
      from TM_PUR_LOAI A <!--INNER JOIN TBL_USER B ON A.NHANVIEN_ID=B.EMPLOYEEID-->
      where A.BENHVIEN_ID = '$BENHVIEN_ID$' AND A.NHANVIEN_ID = '$ACCOUNTID$'
      order by A.TEN
    </statement>
    <statement id="DAO00400_PUR001_GetDanhMucLoai" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
      select A.ID,A.MA,A.TEN,A.ACTIVE,NVL(B.NHANVIEN_ID,-1) AS NHANVIEN_ID,B.TENNHANVIEN, NVL(C.NHANVIEN_ID,-1) AS NHANVIENPHANCONG_ID,C.TENNHANVIEN AS TENNHANVIEN_PHANCONG, A.ID AS LOAI_ID, A.TEN AS TENLOAI from TM_PUR_LOAI A LEFT JOIN TM_NHANVIEN B ON A.NHANVIEN_ID=B.NHANVIEN_ID
      LEFT JOIN TM_NHANVIEN C ON A.NHANVIENPHANCONG_ID = C.NHANVIEN_ID
      where A.BENHVIEN_ID = '$BENHVIEN_ID$' AND A.ACTIVE='1'
      order by A.TEN
    </statement>
    <statement id="DAO00400_PUR001_GetDanhMucLoaiAll" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
      select A.ID,A.MA,A.TEN,A.ACTIVE,NVL(B.NHANVIEN_ID,-1) AS NHANVIEN_ID,B.TENNHANVIEN, NVL(C.NHANVIEN_ID,-1) AS NHANVIENPHANCONG_ID,C.TENNHANVIEN AS TENNHANVIEN_PHANCONG, A.ID AS LOAI_ID, A.TEN AS TENLOAI from TM_PUR_LOAI A
      LEFT JOIN TM_NHANVIEN B ON A.NHANVIEN_ID=B.NHANVIEN_ID
      LEFT JOIN TM_NHANVIEN C ON A.NHANVIENPHANCONG_ID = C.NHANVIEN_ID
      where A.BENHVIEN_ID = '$BENHVIEN_ID$'
      order by A.TEN
    </statement>
    <update id="DAO00400_PUR001_UpdateDanhMucLoai" parameterClass="DataObject">
      update TM_PUR_LOAI SET MA = #MA#,TEN = #TEN#,ACTIVE = #ACTIVE#,NHANVIEN_ID = #NHANVIEN_ID#,NHANVIENPHANCONG_ID = #NHANVIENPHANCONG_ID#,BENHVIEN_ID = #BENHVIEN_ID#
      where ID = '$ID$'
    </update>
    <insert id="DAO00400_PUR001_AddDanhMucLoai" parameterClass="DataObject" resultClass="System.Int64">
      <selectKey property="ID" type="pre" resultClass="System.Int64">
        select TM_PUR_LOAI_S.nextval as value from dual
      </selectKey>
      INSERT INTO TM_PUR_LOAI (ID,MA,TEN,ACTIVE,NHANVIEN_ID,NHANVIENPHANCONG_ID,BENHVIEN_ID) VALUES (#ID#,#MA#,#TEN#,#ACTIVE#,#NHANVIEN_ID#,#NHANVIENPHANCONG_ID#,#BENHVIEN_ID#)      
    </insert>
    <statement id="DAO00400_PUR001_DeleteDanhMucLoai" parameterClass="System.String" resultClass="System.Int32">
      delete from TM_PUR_LOAI where ID = '$ID$'
    </statement>
    <statement id="DAO00400_PUR001_GetNhanVien" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
      select DISTINCT N.*<!--,NHANVIENMAP.USERID AS USER_ID-->
      ,N.NHANVIEN_ID AS NGUOIPHANCONG_ID,N.TENNHANVIEN AS TENNGUOIPHANCONG FROM TM_NHANVIEN N
      <!--LEFT JOIN TBL_USER NHANVIENMAP ON NHANVIENMAP.EMPLOYEEID = N.NHANVIEN_ID-->
      order by TENNHANVIEN
    </statement>
    <statement id="DAO00400_PUR001_GetNhanVienPhongBanDuyet" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
      select DISTINCT N.*,N.NHANVIEN_ID AS NGUOIPHANCONG_ID,N.TENNHANVIEN AS TENNGUOIPHANCONG from TM_NHANVIEN N
      <!--INNER JOIN TBL_USER NHANVIENMAP ON NHANVIENMAP.EMPLOYEEID = N.NHANVIEN_ID-->
      order by N.TENNHANVIEN
    </statement>
    <statement id="DAO00400_PUR001_GetNhanVien_PR" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
      select DISTINCT N.*,N.NHANVIEN_ID AS NGUOIPHANCONG_ID,N.TENNHANVIEN AS TENNGUOIPHANCONG from TM_NHANVIEN N
      <!--LEFT JOIN TBL_USER NHANVIENMAP ON NHANVIENMAP.EMPLOYEEID = N.NHANVIEN_ID-->
      order by TENNHANVIEN
    </statement>
    <statement id="DAO00400_PUR001_GetNhanVien_TiepNhanPR" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
      select DISTINCT N.*,N.NHANVIEN_ID AS NGUOIPHANCONG_ID,N.TENNHANVIEN AS TENNGUOIPHANCONG from TM_NHANVIEN N
      <!--LEFT JOIN TBL_USER NHANVIENMAP ON NHANVIENMAP.EMPLOYEEID = N.NHANVIEN_ID-->
      order by TEN
    </statement>
    <statement id="DAO00400_PUR001_GetNhanVien_PhanCongPR" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
      select DISTINCT N.*,N.NHANVIEN_ID AS NGUOIPHANCONG_ID,N.TENNHANVIEN AS TENNGUOIPHANCONG from TM_NHANVIEN N
      <!--LEFT JOIN TBL_USER NHANVIENMAP ON NHANVIENMAP.EMPLOYEEID = N.NHANVIEN_ID-->
      order by TEN
    </statement>
    <statement id="DAO00400_PUR001_GetPhongBan" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
      WITH PhongbanRec AS
      (
      SELECT P.PHONGBAN_ID AS CATEGORY_ID, P.MAPHONGBAN AS CATEGORY_CODE, P.TENPHONGBAN AS CATEGORY_NAME, P.CAP AS FOLDER_LEVEL, NVL(P.CAPTREN_ID,0) AS PARENT_ID, '0' AS IS_FOLDER, P.LOAIPHONGBAN_ID,
      P.PHONGBAN_ID, P.MAPHONGBAN, P.TENPHONGBAN
      FROM TM_PHONGBAN  P
      WHERE P.CAP = 1 AND NVL(P.CAPTREN_ID,0) = 0 AND P.BENHVIEN_ID = '$BENHVIEN_ID$' AND P.TAMNGUNG = '0'
      UNION ALL
      SELECT P.PHONGBAN_ID AS CATEGORY_ID, P.MAPHONGBAN AS CATEGORY_CODE, P.TENPHONGBAN AS CATEGORY_NAME, P.CAP AS FOLDER_LEVEL, P.CAPTREN_ID AS PARENT_ID, '0' AS IS_FOLDER, P.LOAIPHONGBAN_ID,
      P.PHONGBAN_ID, P.MAPHONGBAN, P.TENPHONGBAN
      FROM PhongbanRec  PR
      INNER JOIN TM_PHONGBAN  P ON P.CAPTREN_ID = PR.CATEGORY_ID AND P.BENHVIEN_ID = '$BENHVIEN_ID$' AND P.TAMNGUNG = '0'
      )
      SELECT  0 AS MAPPED, P.* FROM PhongbanRec  P
      INNER JOIN LST_DICTIONARY  D on P.LOAIPHONGBAN_ID = D.DICTIONARY_ID AND D.DICTIONARY_TYPE_CODE = 'LoaiPhongBan'
    </statement>
    <statement id="DAO00400_PUR001_GetNhanVienDuyet" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
      SELECT 0 AS MAPPED, N.NHANVIEN_ID AS CATEGORY_ID, N.MANHANVIEN AS CATEGORY_CODE, N.TENNHANVIEN AS CATEGORY_NAME, 0 AS FOLDER_LEVEL, 0 AS PARENT_ID, '0' AS IS_FOLDER
      , TO_CHAR(N.NGAYSINH,'DD/MM/YYYY') AS NGAYSINH, G.DESCRIPTION AS GIOITINH, D.DICTIONARY_NAME AS CHUCVU, '' AS TREE_COLUMN,
      0 AS PHONGBAN_ID, '' AS TENPHONGBAN, '' AS BENHVIEN_ID, 0 AS GIATRI, N.NHANVIEN_ID, N.TENNHANVIEN
      FROM TM_NHANVIEN  N
      LEFT JOIN LST_DICTIONARY  D ON D.DICTIONARY_ID = N.CHUCVU_ID AND D.DICTIONARY_TYPE_CODE = 'ChucVu'
      LEFT JOIN TM_GENDER  G ON G.ID = N.GIOITINH
      WHERE N.TAMNGUNG = 0 AND N.BENHVIEN_ID = '$BENHVIEN_ID$'
    </statement>
    <statement id="DAO00400_PUR001_GetPhongBanNguoiDuyet" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
      SELECT AA.* FROM TM_PUR_PHONGBAN_NGUOIDUYET AA <!--INNER JOIN TBL_USER BB ON AA.NHANVIEN_ID = BB.EMPLOYEEID-->
      WHERE AA.BENHVIEN_ID ='$BENHVIEN_ID$' AND AA.NHANVIEN_ID='$ACCOUNTID$'
    </statement>
    <statement id="DAO00400_PUR001_GetListNhanVienDuyet_ID" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
      SELECT * FROM TM_PUR_PHONGBAN_NGUOIDUYET WHERE PHONGBAN_ID = '$PHONGBAN_ID$' AND BENHVIEN_ID ='$BENHVIEN_ID$'
    </statement>
    <insert id="DAO00400_PUR001_AddPhongBanNguoiDuyet" parameterClass="DataObject" resultClass="System.Int64">     
      INSERT INTO TM_PUR_PHONGBAN_NGUOIDUYET (PHONGBAN_ID,TENPHONGBAN,NHANVIEN_ID,TENNHANVIEN,BENHVIEN_ID) VALUES (#PHONGBAN_ID#,#TENPHONGBAN#,#CATEGORY_ID#,#CATEGORY_NAME#,#BENHVIEN_ID#)      
    </insert>
    <statement id="DAO00400_PUR001_DeletePhongBanNguoiDuyet" parameterClass="System.String" resultClass="System.Int32">
      DELETE FROM TM_PUR_PHONGBAN_NGUOIDUYET WHERE PHONGBAN_ID = '$PHONGBAN_ID$' AND BENHVIEN_ID ='$BENHVIEN_ID$'
    </statement>
    <statement id="DAO00400_PUR001_GetListNguoiDuyetPR" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
      SELECT * FROM TM_PUR_NGUOIDUYET WHERE LOAI = 'PR' AND BENHVIEN_ID ='$BENHVIEN_ID$'
      ORDER BY STTDUYET
    </statement>
    <update id="DAO00400_PUR001_UpdateNguoiDuyetPR" parameterClass="DataObject">
      update TM_PUR_NGUOIDUYET SET GIATRI = #GIATRI#,NHANVIEN_ID = #NHANVIEN_ID#,TENNHANVIEN = #TENNHANVIEN#
      where LOAI = 'PR' AND ID = '$ID$'
    </update>
    <statement id="DAO00400_PUR001_GetListNguoiDuyetPO" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
      SELECT * FROM TM_PUR_NGUOIDUYET WHERE LOAI = 'PO' AND BENHVIEN_ID ='$BENHVIEN_ID$'
    </statement>
    <update id="DAO00400_PUR001_UpdateNguoiDuyetPO" parameterClass="DataObject">
      update TM_PUR_NGUOIDUYET SET GIATRI = #GIATRI#,NHANVIEN_ID = #NHANVIEN_ID#,TENNHANVIEN = #TENNHANVIEN#
      where LOAI = 'PO' AND ID = '$ID$'
    </update>
    <statement id="DAO00400_PUR001_GetDanhMucNhom" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
      select NH.*,NH.ID AS NHOM_ID, NH.TEN AS TENNHOM from TM_PUR_NHOM NH where NH.BENHVIEN_ID = '$BENHVIEN_ID$'
      order by TEN
    </statement>
    <update id="DAO00400_PUR001_UpdateDanhMucNhom" parameterClass="DataObject">
      update TM_PUR_NHOM SET MA = #MA#,TEN = #TEN#,ACTIVE = #ACTIVE#,BENHVIEN_ID = #BENHVIEN_ID#
      where ID = '$ID$'
    </update>
    <insert id="DAO00400_PUR001_AddDanhMucNhom" parameterClass="DataObject" resultClass="System.Int64">
      <selectKey property="ID" type="pre" resultClass="System.Int64">
        select TM_PUR_NHOM_S.nextval as value from dual
      </selectKey>
      INSERT INTO TM_PUR_NHOM (ID,MA,TEN,ACTIVE,BENHVIEN_ID) VALUES (#ID#,#MA#,#TEN#,#ACTIVE#,#BENHVIEN_ID#)      
    </insert>
    <statement id="DAO00400_PUR001_DeleteDanhMucNhom" parameterClass="System.String" resultClass="System.Int32">
      delete from TM_PUR_NHOM where ID = '$ID$'
    </statement>
    <statement id="DAO00400_PUR001_GetDMDonViTinh" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
      select * from TM_DONVITINH where LOAIVATTU_ID = 'O' AND  BENHVIEN_ID = '$BENHVIEN_ID$' ORDER BY TENDONVITINH
    </statement>
    <statement id="DAO00400_PUR001_GetDMDonViTinhTSCD" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
      SELECT * FROM VIEW_DANHMUCDONVITINH ORDER BY TENDONVITINH
    </statement>
    <statement id="DAO00400_PUR001_GetDMNhaCungCap" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
      select * from TM_NHACUNGCAP where BENHVIEN_ID = '$BENHVIEN_ID$' ORDER BY TENNHACUNGCAP
    </statement>
    <statement id="DAO00400_PUR001_GetDanhMucHangHoaAll" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
      select HH.*,HH.ID AS HANGHOA_ID, HH.MA AS MAHANGHOA, HH.TEN AS TENHANGHOA from TM_PUR_HANGHOA HH where HH.BENHVIEN_ID = '$BENHVIEN_ID$'
      order by TEN
    </statement>
    <statement id="DAO00400_PUR001_GetDanhMucHangHoa" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
      select HH.*,HH.ID AS HANGHOA_ID, HH.MA AS MAHANGHOA, HH.TEN AS TENHANGHOA from TM_PUR_HANGHOA HH where HH.BENHVIEN_ID = '$BENHVIEN_ID$' AND ACTIVE='1'
      order by TEN
    </statement>
    <statement id="DAO00400_PUR001_GetDanhMucHangHoaTSCD" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
      SELECT * FROM VIEW_DANHMUCTAISAN ORDER BY MAHANGHOA
    </statement>
    <statement id="DAO00400_PUR001_DeleteHangHoa" parameterClass="System.String" resultClass="System.Int32">
      delete from TM_PUR_HANGHOA where ID = '$ID$'
    </statement>
    <update id="DAO00400_PUR001_UpdateHangHoa" parameterClass="DataObject">
      update TM_PUR_HANGHOA SET MA=#MAHANGHOA#,TEN=#TENHANGHOA#,DONVITINH_ID=#DONVITINH_ID#,TENDONVITINH=#TENDONVITINH#,SOLUONGTOITHIEU=#SOLUONGTOITHIEU#,NHOM_ID=#NHOM_ID#,TENNHOM=#TENNHOM#,LOAI_ID=#LOAI_ID#,TENLOAI=#TENLOAI#,
      THUONGHIEU=#THUONGHIEU#,KICHTHUOC=#KICHTHUOC#,VATLIEU=#VATLIEU#,MOTA=#MOTA#,NHACUNGCAP_ID=#NHACUNGCAP_ID#,TENNHACUNGCAP=#TENNHACUNGCAP#,GIAHOPDONG=#GIAHOPDONG#,TUNGAY=#TUNGAY#,DENNGAY=#DENNGAY#,ACTIVE=#ACTIVE#,BENHVIEN_ID=#BENHVIEN_ID#
      where ID = '$ID$'
    </update>
    <insert id="DAO00400_PUR001_AddHangHoa" parameterClass="DataObject" resultClass="System.Int64">
      <selectKey property="ID" type="pre" resultClass="System.Int64">
        select TM_PUR_HANGHOA_S.nextval as value from dual
      </selectKey>
      INSERT INTO TM_PUR_HANGHOA (ID,MA,TEN,DONVITINH_ID,TENDONVITINH,SOLUONGTOITHIEU,NHOM_ID,TENNHOM,LOAI_ID,TENLOAI,THUONGHIEU,KICHTHUOC,VATLIEU,MOTA,NHACUNGCAP_ID,TENNHACUNGCAP,GIAHOPDONG,TUNGAY,DENNGAY,ACTIVE,BENHVIEN_ID)
      VALUES (#ID#,#MAHANGHOA#,#TENHANGHOA#,#DONVITINH_ID#,#TENDONVITINH#,#SOLUONGTOITHIEU#,#NHOM_ID#,#TENNHOM#,#LOAI_ID#,#TENLOAI#,#THUONGHIEU#,#KICHTHUOC#,#VATLIEU#,#MOTA#,#NHACUNGCAP_ID#,#TENNHACUNGCAP#,#GIAHOPDONG#,#TUNGAY#,#DENNGAY#,#ACTIVE#,#BENHVIEN_ID#)      
    </insert>
    <statement id="DAO00400_PUR001_GetPhieuYeuCauPO" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
      select CT.CHUNGTU_ID,CT.MACHUNGTU,CT.NGAYLAPCHUNGTU,CT.NGAYGIOLAPCHUNGTU,CT.PROCESS_CODE,CT.PROCESS_NAME,CT.STATE_CODE,CT.STATE_NAME,CT.NGUOITAO_ID,CT.TENNGUOITAO,CT.PHONGBAN_ID,
      CT.TENPHONGBAN,CT.NGUOIDUYETCAP1_ID,CT.TENNGUOIDUYETCAP1,CT.NGAYGIODUYETCAP1,CT.NGUOIDUYETCAP2_ID,CT.TENNGUOIDUYETCAP2,CT.NGAYGIODUYETCAP2,CT.NGUOIDUYETCAP3_ID,CT.TENNGUOIDUYETCAP3,CT.NGAYGIODUYETCAP3,CT.CAPDUYET,CT.THOIGIANGIAOHANG,CT.NHACUNGCAP_ID,CT.TENNHACUNGCAP,CT.HINHTHUCGIAOHANG,
      CT.HINHTHUCTHANHTOAN,CT.TONGTIEN,CT.GHICHU,CT.DIENGIAI,CT.TIEUDE,CT.NGANSACH,CT.GIATRITHEONGANSACH,CT.GIATRIDASUDUNG,CT.GIATRICONLAI,CT.NGUOIPHANCONG_ID,CT.TENNGUOIPHANCONG,CT.NGAYPHANCONG,CT.NGAYCHAPNHAN,CT.NGAYTUCHOI,CT.THANHTOAN1,CT.THANHTOAN2,CT.THANHTOAN3,CT.THANHTOAN4,CT.THANHTOAN5,CT.THANHTOAN6,
      CT.TRONGNGANSACH,CT.MALOAIPHIEU,(CASE WHEN CT.MALOAIPHIEU='DP' THEN 'Dược phẩm' ELSE CT.TENLOAIPHIEU END) AS TENLOAIPHIEU,CT.BENHVIEN_ID,CT.NGAYTAO,CT.NGAYCAPNHAT,CT.NGUOICAPNHAT_ID,CT.TENNGUOICAPNHAT,
      CTCT.CHUNGTUCHITIET_ID,CTCT.HANGHOA_ID,CTCT.MAHANGHOA,CTCT.TENHANGHOA,CTCT.DONVITINH_ID,CTCT.TENDONVITINH,CTCT.LOAI_ID,CTCT.TENLOAI,
      CTCT.SOLUONGYEUCAU,CTPR.SOLUONGYEUCAU AS SOLUONGPR,CTRQ.SOLUONGYEUCAU AS SOLUONGYEUCAUBANDAU,CTCT.MOTA,
      CTCT.THUONGHIEU,CTCT.KICHTHUOC,CTCT.VATLIEU,CTCT.GHICHU AS CT_GHICHU,CTCT.FILE_NAME,CTCT.FULLPATHSERVER,CTCT.FULLPATHLOCAL,CTCT.SIZE,CTCT.FILE_NAME_PO,CTCT.FULLPATHSERVER_PO,CTCT.FULLPATHLOCAL_PO,CTCT.SIZE_PO,CTCT.STATE_CODE AS CT_STATE_CODE,CTCT.STATE_NAME AS CT_STATE_NAME,CTCT.NGUOIDUYET_ID AS CT_NGUOIDUYET_ID,CTCT.TENNGUOIDUYET AS CT_TENNGUOIDUYET,
      CTCT.MACHONGIA,CTCT.TENCHONGIA,CTCT.DONGIA,CTCT.TYLEVAT,CTCT.GIATRIVAT,CTCT.DONGIASAUVAT,CTCT.THANHTIEN,CTCT.NHACUNGCAP_ID AS CT_NHACUNGCAP_ID,CTCT.TENNHACUNGCAP AS CT_TENNHACUNGCAP,CTCT.DONGIAHOPDONG,CTCT.TUNGAYHOPDONG, CTCT.DENNGAYHOPDONG,CTCT.MATONGHOP,
      CTCT.CHUNGTUTONGHOP_ID,CTCT.BAOHANHTUNGAY,CTCT.BAOHANHDENNGAY,CTCT.NGAYCAPNHAT AS CT_NGAYCAPNHAT,CTCT.NGUOICAPNHAT_ID AS CT_NGUOICAPNHAT_ID,CTCT.TENNGUOICAPNHAT AS CT_TENNGUOICAPNHAT,CTCT.NGUOITAO_ID AS CT_NGUOITAO_ID,CTCT.TENNGUOITAO AS CT_TENNGUOITAO,HH.DONGIA AS DMDONGIA, '' AS MACHUNGTU_RQ
      from TT_PUR_CHUNGTU CT INNER JOIN TT_PUR_CHUNGTUCHITIET CTCT ON CT.CHUNGTU_ID = CTCT.CHUNGTU_ID INNER JOIN (
      SELECT ID AS HANGHOA_ID,MA AS MAHANGHOA,TEN AS TENHANGHOA,NHACUNGCAP_ID,TENNHACUNGCAP,GIAHOPDONG,TUNGAY, DENNGAY,'VPP' AS LOAIDM,DONGIA FROM TM_PUR_HANGHOA UNION ALL
      SELECT HANGHOA_ID,MAHANGHOA,TENHANGHOA,NULL AS NHACUNGCAP_ID,NULL AS TENNHACUNGCAP,NULL AS GIAHOPDONG,NULL AS TUNGAY,NULL AS DENNGAY,LOAIDM,DONGIA FROM VIEW_DANHMUCTAISAN UNION ALL
      SELECT DUOC_ID AS HANGHOA_ID,MADUOC AS MAHANGHOA,TENDUOCDAYDU AS TENHANGHOA,NULL AS NHACUNGCAP_ID,NULL AS TENNHACUNGCAP,NULL AS GIAHOPDONG,NULL AS TUNGAY,NULL AS DENNGAY,'DP' AS LOAIDM,0 AS DONGIA FROM TM_DUOC
      ) HH ON CTCT.HANGHOA_ID = HH.HANGHOA_ID
      INNER JOIN TT_PUR_CHUNGTUCHITIET CTPR ON CTCT.CHUNGTUTONGHOP_ID=CTPR.CHUNGTUCHITIET_ID
      LEFT JOIN TT_PUR_CHUNGTUCHITIET CTRQ ON CTPR.CHUNGTUTONGHOP_ID=CTRQ.CHUNGTUCHITIET_ID
      <!--LEFT JOIN
      (
      SELECT DISTINCT A.CHUNGTU_ID, A.MACHUNGTU AS MACHUNGTU_PR, B.MATONGHOP AS MACHUNGTU_RQ FROM TT_PUR_CHUNGTU A INNER JOIN TT_PUR_CHUNGTUCHITIET B ON B.CHUNGTU_ID = A.CHUNGTU_ID  WHERE A.PROCESS_CODE = 'PR'
      ) C ON C.MACHUNGTU_PR = CTCT.MATONGHOP-->
      where CT.BENHVIEN_ID = '$BENHVIEN_ID$' AND CT.PROCESS_CODE = 'PO' AND CT.MACHUNGTU = '$MACHUNGTU$'
      <isNotEmpty prepend="AND" property="PHONGBAN_ID">
        CT.PHONGBAN_ID='$PHONGBAN_ID$'
      </isNotEmpty>
      <isNotEmpty prepend="AND" property="NGUOITAO_ID">
        CT.NGUOITAO_ID='$NGUOITAO_ID$'
      </isNotEmpty>
      ORDER BY TENHANGHOA
    </statement>
    <statement id="DAO00400_PUR001_DelChungTuChiTietTheoID" parameterClass="System.String" resultClass="System.Int32">
      INSERT INTO TT_PUR_CHUNGTUHISTORY
      (TENNGUOITAO,TRANGTHAIHANHDONG,CT_CHUNGTU_ID,CT_MACHUNGTU,CT_NGAYLAPCHUNGTU,CT_NGAYGIOLAPCHUNGTU,
      CT_PROCESS_CODE,CT_PROCESS_NAME,CT_STATE_CODE,CT_STATE_NAME,CT_PHONGBAN_ID,
      CT_TENPHONGBAN,CT_NGUOIDUYETCAP1_ID,CT_TENNGUOIDUYETCAP1,CT_NGAYGIODUYETCAP1,CT_NGUOIDUYETCAP2_ID,CT_TENNGUOIDUYETCAP2,CT_NGAYGIODUYETCAP2,CT_NGUOIDUYETCAP3_ID,CT_TENNGUOIDUYETCAP3,CT_NGAYGIODUYETCAP3,CT_CAPDUYET,CT_THOIGIANGIAOHANG,CT_NHACUNGCAP_ID,CT_TENNHACUNGCAP,
      CT_HINHTHUCGIAOHANG,CT_HINHTHUCTHANHTOAN,CT_TONGTIEN,CT_GHICHU,CT_TIEUDE,CT_DIENGIAI,CT_LYDOTUCHOINHAN,CT_NGANSACH,CT_GIATRITHEONGANSACH,CT_GIATRIDASUDUNG,CT_GIATRICONLAI,CT_NGUOIPHANCONG_ID,CT_TENNGUOIPHANCONG,CT_NGAYPHANCONG,CT_NGAYCHAPNHAN,CT_NGAYTUCHOI,CT_THANHTOAN1,CT_THANHTOAN2,
      CT_THANHTOAN3,CT_THANHTOAN4,CT_THANHTOAN5,CT_THANHTOAN6,CT_TRONGNGANSACH,CT_MALOAIPHIEU,CT_TENLOAIPHIEU,CT_MACHUNGTUPOMOI,CT_CHUNGTU_IDPOMOI,CT_TENNGUOITAO,CT_TENNGUOICAPNHAT,CT_NGAYTAO,CT_NGUOITAO_ID,CT_NGAYCAPNHAT,CT_NGUOICAPNHAT_ID,
      CTCT_CHUNGTUCHITIET_ID,CTCT_CHUNGTU_ID,CTCT_HANGHOA_ID,CTCT_MAHANGHOA,CTCT_TENHANGHOA,CTCT_DONVITINH_ID,CTCT_TENDONVITINH,CTCT_LOAI_ID,CTCT_TENLOAI,CTCT_SOLUONGYEUCAU,CTCT_MOTA,CTCT_THUONGHIEU,CTCT_KICHTHUOC,CTCT_VATLIEU,CTCT_GHICHU,
      CTCT_FILE_NAME,CTCT_FULLPATHSERVER,CTCT_FULLPATHLOCAL,CTCT_SIZE,CTCT_FILE_NAME_PO,CTCT_FULLPATHSERVER_PO,CTCT_FULLPATHLOCAL_PO,CTCT_SIZE_PO,CTCT_STATE_CODE,CTCT_STATE_NAME,CTCT_NGUOIDUYET_ID,CTCT_TENNGUOIDUYET,CTCT_NGAYGIODUYET,CTCT_MACHONGIA,CTCT_TENCHONGIA,
      CTCT_DONGIA,CTCT_TYLEVAT,CTCT_GIATRIVAT,CTCT_DONGIASAUVAT,CTCT_THANHTIEN,CTCT_NHACUNGCAP_ID,CTCT_TENNHACUNGCAP,CTCT_DONGIAHOPDONG,CTCT_TUNGAYHOPDONG, CTCT_DENNGAYHOPDONG,CTCT_GIAHOPDONG_ID,CTCT_GIAHOPDONGCHITIET_ID,
      CTCT_MATONGHOP,CTCT_CHUNGTUTONGHOP_ID,CTCT_MALOAIPHIEU,CTCT_BAOHANHTUNGAY,CTCT_BAOHANHDENNGAY,CTCT_TENNGUOITAO,CTCT_TENNGUOICAPNHAT,CTCT_NGAYTAO,CTCT_NGUOITAO_ID,CTCT_NGAYCAPNHAT,
      CTCT_NGUOICAPNHAT_ID,BENHVIEN_ID,NGAYTAO,NGUOITAO_ID,NGAYCAPNHAT,NGUOICAPNHAT_ID)
      SELECT
      #ACCOUNTNAME#,#TRANGTHAIHANHDONG#,CT.CHUNGTU_ID,CT.MACHUNGTU,CT.NGAYLAPCHUNGTU,CT.NGAYGIOLAPCHUNGTU,
      CT.PROCESS_CODE,CT.PROCESS_NAME,CT.STATE_CODE,CT.STATE_NAME,CT.PHONGBAN_ID,CT.TENPHONGBAN,CT.NGUOIDUYETCAP1_ID,CT.TENNGUOIDUYETCAP1,CT.NGAYGIODUYETCAP1,
      CT.NGUOIDUYETCAP2_ID,CT.TENNGUOIDUYETCAP2,CT.NGAYGIODUYETCAP2,CT.NGUOIDUYETCAP3_ID,CT.TENNGUOIDUYETCAP3,CT.NGAYGIODUYETCAP3,CT.CAPDUYET,
      CT.THOIGIANGIAOHANG,CT.NHACUNGCAP_ID,CT.TENNHACUNGCAP,CT.HINHTHUCGIAOHANG,CT.HINHTHUCTHANHTOAN,CT.TONGTIEN,CT.GHICHU,CT.TIEUDE,CT.DIENGIAI,CT.LYDOTUCHOINHAN,CT.NGANSACH,CT.GIATRITHEONGANSACH,CT.GIATRIDASUDUNG,
      CT.GIATRICONLAI,CT.NGUOIPHANCONG_ID,CT.TENNGUOIPHANCONG,CT.NGAYPHANCONG,CT.NGAYCHAPNHAN,CT.NGAYTUCHOI,CT.THANHTOAN1,CT.THANHTOAN2,CT.THANHTOAN3,CT.THANHTOAN4,CT.THANHTOAN5,CT.THANHTOAN6,CT.TRONGNGANSACH,
      CT.MALOAIPHIEU,(CASE WHEN CT.MALOAIPHIEU='DP' THEN 'Dược phẩm' ELSE CT.TENLOAIPHIEU END) AS TENLOAIPHIEU,CT.MACHUNGTUPOMOI,CT.CHUNGTU_IDPOMOI,CT.TENNGUOITAO,CT.TENNGUOICAPNHAT,CT.NGAYTAO,CT.NGUOITAO_ID,CT.NGAYCAPNHAT,CT.NGUOICAPNHAT_ID,
      CTCT.CHUNGTUCHITIET_ID,CTCT.CHUNGTU_ID,CTCT.HANGHOA_ID,CTCT.MAHANGHOA,CTCT.TENHANGHOA,CTCT.DONVITINH_ID,CTCT.TENDONVITINH,CTCT.LOAI_ID,CTCT.TENLOAI,CTCT.SOLUONGYEUCAU,CTCT.MOTA,CTCT.THUONGHIEU,CTCT.KICHTHUOC,CTCT.VATLIEU,CTCT.GHICHU,
      CTCT.FILE_NAME,CTCT.FULLPATHSERVER,CTCT.FULLPATHLOCAL,CTCT.SIZE,CTCT.FILE_NAME_PO,CTCT.FULLPATHSERVER_PO,CTCT.FULLPATHLOCAL_PO,CTCT.SIZE_PO,CTCT.STATE_CODE,
      CTCT.STATE_NAME,CTCT.NGUOIDUYET_ID,CTCT.TENNGUOIDUYET,CTCT.NGAYGIODUYET,CTCT.MACHONGIA,CTCT.TENCHONGIA,CTCT.DONGIA,CTCT.TYLEVAT,CTCT.GIATRIVAT,CTCT.DONGIASAUVAT,CTCT.THANHTIEN,
      CTCT.NHACUNGCAP_ID,CTCT.TENNHACUNGCAP,CTCT.DONGIAHOPDONG,CTCT.TUNGAYHOPDONG, CTCT.DENNGAYHOPDONG,CTCT.GIAHOPDONG_ID,CTCT.GIAHOPDONGCHITIET_ID,CTCT.MATONGHOP,CTCT.CHUNGTUTONGHOP_ID,CTCT.MALOAIPHIEU,CTCT.BAOHANHTUNGAY,CTCT.BAOHANHDENNGAY,CTCT.TENNGUOITAO,CTCT.TENNGUOICAPNHAT,CTCT.NGAYTAO,
      CTCT.NGUOITAO_ID,CTCT.NGAYCAPNHAT,CTCT.NGUOICAPNHAT_ID,#BENHVIEN_ID#,SYSDATE,#ACCOUNTID#,SYSDATE,#ACCOUNTID#
      FROM TT_PUR_CHUNGTU CT,TT_PUR_CHUNGTUCHITIET CTCT WHERE CT.CHUNGTU_ID=CTCT.CHUNGTU_ID AND CTCT.CHUNGTUCHITIET_ID='$CHUNGTUCHITIET_ID$'
      delete from TT_PUR_CHUNGTUCHITIET where CHUNGTUCHITIET_ID = '$CHUNGTUCHITIET_ID$' AND BENHVIEN_ID = '$BENHVIEN_ID$'
    </statement>
    <statement id="DAO00400_PUR001_DelPhieuYeuCau" parameterClass="System.String" resultClass="System.Int32">
      INSERT INTO TT_PUR_CHUNGTUHISTORY
      (TENNGUOITAO,TRANGTHAIHANHDONG,CT_CHUNGTU_ID,CT_MACHUNGTU,CT_NGAYLAPCHUNGTU,CT_NGAYGIOLAPCHUNGTU,
      CT_PROCESS_CODE,CT_PROCESS_NAME,CT_STATE_CODE,CT_STATE_NAME,CT_PHONGBAN_ID,
      CT_TENPHONGBAN,CT_NGUOIDUYETCAP1_ID,CT_TENNGUOIDUYETCAP1,CT_NGAYGIODUYETCAP1,CT_NGUOIDUYETCAP2_ID,CT_TENNGUOIDUYETCAP2,CT_NGAYGIODUYETCAP2,CT_NGUOIDUYETCAP3_ID,CT_TENNGUOIDUYETCAP3,CT_NGAYGIODUYETCAP3,CT_CAPDUYET,CT_THOIGIANGIAOHANG,CT_NHACUNGCAP_ID,CT_TENNHACUNGCAP,
      CT_HINHTHUCGIAOHANG,CT_HINHTHUCTHANHTOAN,CT_TONGTIEN,CT_GHICHU,CT_TIEUDE,CT_DIENGIAI,CT_LYDOTUCHOINHAN,CT_NGANSACH,CT_GIATRITHEONGANSACH,CT_GIATRIDASUDUNG,CT_GIATRICONLAI,CT_NGUOIPHANCONG_ID,CT_TENNGUOIPHANCONG,CT_NGAYPHANCONG,CT_NGAYCHAPNHAN,CT_NGAYTUCHOI,CT_THANHTOAN1,CT_THANHTOAN2,
      CT_THANHTOAN3,CT_THANHTOAN4,CT_THANHTOAN5,CT_THANHTOAN6,CT_TRONGNGANSACH,CT_MALOAIPHIEU,CT_TENLOAIPHIEU,CT_MACHUNGTUPOMOI,CT_CHUNGTU_IDPOMOI,CT_TENNGUOITAO,CT_TENNGUOICAPNHAT,CT_NGAYTAO,CT_NGUOITAO_ID,CT_NGAYCAPNHAT,CT_NGUOICAPNHAT_ID,
      CTCT_CHUNGTUCHITIET_ID,CTCT_CHUNGTU_ID,CTCT_HANGHOA_ID,CTCT_MAHANGHOA,CTCT_TENHANGHOA,CTCT_DONVITINH_ID,CTCT_TENDONVITINH,CTCT_LOAI_ID,CTCT_TENLOAI,CTCT_SOLUONGYEUCAU,CTCT_MOTA,CTCT_THUONGHIEU,CTCT_KICHTHUOC,CTCT_VATLIEU,CTCT_GHICHU,
      CTCT_FILE_NAME,CTCT_FULLPATHSERVER,CTCT_FULLPATHLOCAL,CTCT_SIZE,CTCT_FILE_NAME_PO,CTCT_FULLPATHSERVER_PO,CTCT_FULLPATHLOCAL_PO,CTCT_SIZE_PO,CTCT_STATE_CODE,CTCT_STATE_NAME,CTCT_NGUOIDUYET_ID,CTCT_TENNGUOIDUYET,CTCT_NGAYGIODUYET,CTCT_MACHONGIA,CTCT_TENCHONGIA,
      CTCT_DONGIA,CTCT_TYLEVAT,CTCT_GIATRIVAT,CTCT_DONGIASAUVAT,CTCT_THANHTIEN,CTCT_NHACUNGCAP_ID,CTCT_TENNHACUNGCAP,CTCT_DONGIAHOPDONG,CTCT_TUNGAYHOPDONG, CTCT_DENNGAYHOPDONG,CTCT_GIAHOPDONG_ID,CTCT_GIAHOPDONGCHITIET_ID,
      CTCT_MATONGHOP,CTCT_CHUNGTUTONGHOP_ID,CTCT_MALOAIPHIEU,CTCT_BAOHANHTUNGAY,CTCT_BAOHANHDENNGAY,CTCT_TENNGUOITAO,CTCT_TENNGUOICAPNHAT,CTCT_NGAYTAO,CTCT_NGUOITAO_ID,CTCT_NGAYCAPNHAT,
      CTCT_NGUOICAPNHAT_ID,BENHVIEN_ID,NGAYTAO,NGUOITAO_ID,NGAYCAPNHAT,NGUOICAPNHAT_ID)
      SELECT
      #ACCOUNTNAME#,#TRANGTHAIHANHDONG#,CT.CHUNGTU_ID,CT.MACHUNGTU,CT.NGAYLAPCHUNGTU,CT.NGAYGIOLAPCHUNGTU,
      CT.PROCESS_CODE,CT.PROCESS_NAME,CT.STATE_CODE,CT.STATE_NAME,CT.PHONGBAN_ID,CT.TENPHONGBAN,CT.NGUOIDUYETCAP1_ID,CT.TENNGUOIDUYETCAP1,CT.NGAYGIODUYETCAP1,
      CT.NGUOIDUYETCAP2_ID,CT.TENNGUOIDUYETCAP2,CT.NGAYGIODUYETCAP2,CT.NGUOIDUYETCAP3_ID,CT.TENNGUOIDUYETCAP3,CT.NGAYGIODUYETCAP3,CT.CAPDUYET,
      CT.THOIGIANGIAOHANG,CT.NHACUNGCAP_ID,CT.TENNHACUNGCAP,CT.HINHTHUCGIAOHANG,CT.HINHTHUCTHANHTOAN,CT.TONGTIEN,CT.GHICHU,CT.TIEUDE,CT.DIENGIAI,CT.LYDOTUCHOINHAN,CT.NGANSACH,CT.GIATRITHEONGANSACH,CT.GIATRIDASUDUNG,
      CT.GIATRICONLAI,CT.NGUOIPHANCONG_ID,CT.TENNGUOIPHANCONG,CT.NGAYPHANCONG,CT.NGAYCHAPNHAN,CT.NGAYTUCHOI,CT.THANHTOAN1,CT.THANHTOAN2,CT.THANHTOAN3,CT.THANHTOAN4,CT.THANHTOAN5,CT.THANHTOAN6,CT.TRONGNGANSACH,
      CT.MALOAIPHIEU,(CASE WHEN CT.MALOAIPHIEU='DP' THEN 'Dược phẩm' ELSE CT.TENLOAIPHIEU END) AS TENLOAIPHIEU,CT.MACHUNGTUPOMOI,CT.CHUNGTU_IDPOMOI,CT.TENNGUOITAO,CT.TENNGUOICAPNHAT,CT.NGAYTAO,CT.NGUOITAO_ID,CT.NGAYCAPNHAT,CT.NGUOICAPNHAT_ID,
      CTCT.CHUNGTUCHITIET_ID,CTCT.CHUNGTU_ID,CTCT.HANGHOA_ID,CTCT.MAHANGHOA,CTCT.TENHANGHOA,CTCT.DONVITINH_ID,CTCT.TENDONVITINH,CTCT.LOAI_ID,CTCT.TENLOAI,CTCT.SOLUONGYEUCAU,CTCT.MOTA,CTCT.THUONGHIEU,CTCT.KICHTHUOC,CTCT.VATLIEU,CTCT.GHICHU,
      CTCT.FILE_NAME,CTCT.FULLPATHSERVER,CTCT.FULLPATHLOCAL,CTCT.SIZE,CTCT.FILE_NAME_PO,CTCT.FULLPATHSERVER_PO,CTCT.FULLPATHLOCAL_PO,CTCT.SIZE_PO,CTCT.STATE_CODE,
      CTCT.STATE_NAME,CTCT.NGUOIDUYET_ID,CTCT.TENNGUOIDUYET,CTCT.NGAYGIODUYET,CTCT.MACHONGIA,CTCT.TENCHONGIA,CTCT.DONGIA,CTCT.TYLEVAT,CTCT.GIATRIVAT,CTCT.DONGIASAUVAT,CTCT.THANHTIEN,
      CTCT.NHACUNGCAP_ID,CTCT.TENNHACUNGCAP,CTCT.DONGIAHOPDONG,CTCT.TUNGAYHOPDONG, CTCT.DENNGAYHOPDONG,CTCT.GIAHOPDONG_ID,CTCT.GIAHOPDONGCHITIET_ID,CTCT.MATONGHOP,CTCT.CHUNGTUTONGHOP_ID,CTCT.MALOAIPHIEU,CTCT.BAOHANHTUNGAY,CTCT.BAOHANHDENNGAY,CTCT.TENNGUOITAO,CTCT.TENNGUOICAPNHAT,CTCT.NGAYTAO,
      CTCT.NGUOITAO_ID,CTCT.NGAYCAPNHAT,CTCT.NGUOICAPNHAT_ID,#BENHVIEN_ID#,SYSDATE,#ACCOUNTID#,SYSDATE,#ACCOUNTID#
      FROM TT_PUR_CHUNGTU CT,TT_PUR_CHUNGTUCHITIET CTCT WHERE CT.CHUNGTU_ID=CTCT.CHUNGTU_ID AND CT.CHUNGTU_ID='$CHUNGTU_ID$'
      delete from TT_PUR_CHUNGTUCHITIET where CHUNGTU_ID = '$CHUNGTU_ID$' AND BENHVIEN_ID = '$BENHVIEN_ID$'
      delete from TT_PUR_CHUNGTU where CHUNGTU_ID = '$CHUNGTU_ID$' AND BENHVIEN_ID = '$BENHVIEN_ID$'
      UPDATE TT_PUR_CHUNGTU SET CHUNGTU_IDPOMOI = NULL, MACHUNGTUPOMOI = NULL WHERE CHUNGTU_IDPOMOI='$CHUNGTU_ID$' AND MACHUNGTUPOMOI='$MACHUNGTU$'
    </statement>
    <statement id="DAO00400_PUR001_AddChungTuHistory" parameterClass="System.String" resultClass="System.Int32">
      INSERT INTO TT_PUR_CHUNGTUHISTORY
      (TENNGUOITAO,TRANGTHAIHANHDONG,CT_CHUNGTU_ID,CT_MACHUNGTU,CT_NGAYLAPCHUNGTU,CT_NGAYGIOLAPCHUNGTU,
      CT_PROCESS_CODE,CT_PROCESS_NAME,CT_STATE_CODE,CT_STATE_NAME,CT_PHONGBAN_ID,
      CT_TENPHONGBAN,CT_NGUOIDUYETCAP1_ID,CT_TENNGUOIDUYETCAP1,CT_NGAYGIODUYETCAP1,CT_NGUOIDUYETCAP2_ID,CT_TENNGUOIDUYETCAP2,CT_NGAYGIODUYETCAP2,CT_NGUOIDUYETCAP3_ID,CT_TENNGUOIDUYETCAP3,CT_NGAYGIODUYETCAP3,CT_CAPDUYET,CT_THOIGIANGIAOHANG,CT_NHACUNGCAP_ID,CT_TENNHACUNGCAP,
      CT_HINHTHUCGIAOHANG,CT_HINHTHUCTHANHTOAN,CT_TONGTIEN,CT_GHICHU,CT_TIEUDE,CT_DIENGIAI,CT_LYDOTUCHOINHAN,CT_NGANSACH,CT_GIATRITHEONGANSACH,CT_GIATRIDASUDUNG,CT_GIATRICONLAI,CT_NGUOIPHANCONG_ID,CT_TENNGUOIPHANCONG,CT_NGAYPHANCONG,CT_NGAYCHAPNHAN,CT_NGAYTUCHOI,CT_THANHTOAN1,CT_THANHTOAN2,
      CT_THANHTOAN3,CT_THANHTOAN4,CT_THANHTOAN5,CT_THANHTOAN6,CT_TRONGNGANSACH,CT_MALOAIPHIEU,CT_TENLOAIPHIEU,CT_MACHUNGTUPOMOI,CT_CHUNGTU_IDPOMOI,CT_TENNGUOITAO,CT_TENNGUOICAPNHAT,CT_NGAYTAO,CT_NGUOITAO_ID,CT_NGAYCAPNHAT,CT_NGUOICAPNHAT_ID,
      CTCT_CHUNGTUCHITIET_ID,CTCT_CHUNGTU_ID,CTCT_HANGHOA_ID,CTCT_MAHANGHOA,CTCT_TENHANGHOA,CTCT_DONVITINH_ID,CTCT_TENDONVITINH,CTCT_LOAI_ID,CTCT_TENLOAI,CTCT_SOLUONGYEUCAU,CTCT_MOTA,CTCT_THUONGHIEU,CTCT_KICHTHUOC,CTCT_VATLIEU,CTCT_GHICHU,
      CTCT_FILE_NAME,CTCT_FULLPATHSERVER,CTCT_FULLPATHLOCAL,CTCT_SIZE,CTCT_FILE_NAME_PO,CTCT_FULLPATHSERVER_PO,CTCT_FULLPATHLOCAL_PO,CTCT_SIZE_PO,CTCT_STATE_CODE,CTCT_STATE_NAME,CTCT_NGUOIDUYET_ID,CTCT_TENNGUOIDUYET,CTCT_NGAYGIODUYET,CTCT_MACHONGIA,CTCT_TENCHONGIA,
      CTCT_DONGIA,CTCT_TYLEVAT,CTCT_GIATRIVAT,CTCT_DONGIASAUVAT,CTCT_THANHTIEN,CTCT_NHACUNGCAP_ID,CTCT_TENNHACUNGCAP,CTCT_DONGIAHOPDONG,CTCT_TUNGAYHOPDONG, CTCT_DENNGAYHOPDONG,CTCT_GIAHOPDONG_ID,CTCT_GIAHOPDONGCHITIET_ID,
      CTCT_MATONGHOP,CTCT_CHUNGTUTONGHOP_ID,CTCT_MALOAIPHIEU,CTCT_BAOHANHTUNGAY,CTCT_BAOHANHDENNGAY,CTCT_TENNGUOITAO,CTCT_TENNGUOICAPNHAT,CTCT_NGAYTAO,CTCT_NGUOITAO_ID,CTCT_NGAYCAPNHAT,
      CTCT_NGUOICAPNHAT_ID,BENHVIEN_ID,NGAYTAO,NGUOITAO_ID,NGAYCAPNHAT,NGUOICAPNHAT_ID)
      SELECT
      #ACCOUNTNAME#,#TRANGTHAIHANHDONG#,CT.CHUNGTU_ID,CT.MACHUNGTU,CT.NGAYLAPCHUNGTU,CT.NGAYGIOLAPCHUNGTU,
      CT.PROCESS_CODE,CT.PROCESS_NAME,CT.STATE_CODE,CT.STATE_NAME,CT.PHONGBAN_ID,CT.TENPHONGBAN,CT.NGUOIDUYETCAP1_ID,CT.TENNGUOIDUYETCAP1,CT.NGAYGIODUYETCAP1,
      CT.NGUOIDUYETCAP2_ID,CT.TENNGUOIDUYETCAP2,CT.NGAYGIODUYETCAP2,CT.NGUOIDUYETCAP3_ID,CT.TENNGUOIDUYETCAP3,CT.NGAYGIODUYETCAP3,CT.CAPDUYET,
      CT.THOIGIANGIAOHANG,CT.NHACUNGCAP_ID,CT.TENNHACUNGCAP,CT.HINHTHUCGIAOHANG,CT.HINHTHUCTHANHTOAN,CT.TONGTIEN,CT.GHICHU,CT.TIEUDE,CT.DIENGIAI,CT.LYDOTUCHOINHAN,CT.NGANSACH,CT.GIATRITHEONGANSACH,CT.GIATRIDASUDUNG,
      CT.GIATRICONLAI,CT.NGUOIPHANCONG_ID,CT.TENNGUOIPHANCONG,CT.NGAYPHANCONG,CT.NGAYCHAPNHAN,CT.NGAYTUCHOI,CT.THANHTOAN1,CT.THANHTOAN2,CT.THANHTOAN3,CT.THANHTOAN4,CT.THANHTOAN5,CT.THANHTOAN6,CT.TRONGNGANSACH,
      CT.MALOAIPHIEU,(CASE WHEN CT.MALOAIPHIEU='DP' THEN 'Dược phẩm' ELSE CT.TENLOAIPHIEU END) AS TENLOAIPHIEU,CT.MACHUNGTUPOMOI,CT.CHUNGTU_IDPOMOI,CT.TENNGUOITAO,CT.TENNGUOICAPNHAT,CT.NGAYTAO,CT.NGUOITAO_ID,CT.NGAYCAPNHAT,CT.NGUOICAPNHAT_ID,
      CTCT.CHUNGTUCHITIET_ID,CTCT.CHUNGTU_ID,CTCT.HANGHOA_ID,CTCT.MAHANGHOA,CTCT.TENHANGHOA,CTCT.DONVITINH_ID,CTCT.TENDONVITINH,CTCT.LOAI_ID,CTCT.TENLOAI,CTCT.SOLUONGYEUCAU,CTCT.MOTA,CTCT.THUONGHIEU,CTCT.KICHTHUOC,CTCT.VATLIEU,CTCT.GHICHU,
      CTCT.FILE_NAME,CTCT.FULLPATHSERVER,CTCT.FULLPATHLOCAL,CTCT.SIZE,CTCT.FILE_NAME_PO,CTCT.FULLPATHSERVER_PO,CTCT.FULLPATHLOCAL_PO,CTCT.SIZE_PO,CTCT.STATE_CODE,
      CTCT.STATE_NAME,CTCT.NGUOIDUYET_ID,CTCT.TENNGUOIDUYET,CTCT.NGAYGIODUYET,CTCT.MACHONGIA,CTCT.TENCHONGIA,CTCT.DONGIA,CTCT.TYLEVAT,CTCT.GIATRIVAT,CTCT.DONGIASAUVAT,CTCT.THANHTIEN,
      CTCT.NHACUNGCAP_ID,CTCT.TENNHACUNGCAP,CTCT.DONGIAHOPDONG,CTCT.TUNGAYHOPDONG, CTCT.DENNGAYHOPDONG,CTCT.GIAHOPDONG_ID,CTCT.GIAHOPDONGCHITIET_ID,CTCT.MATONGHOP,CTCT.CHUNGTUTONGHOP_ID,CTCT.MALOAIPHIEU,CTCT.BAOHANHTUNGAY,CTCT.BAOHANHDENNGAY,CTCT.TENNGUOITAO,CTCT.TENNGUOICAPNHAT,CTCT.NGAYTAO,
      CTCT.NGUOITAO_ID,CTCT.NGAYCAPNHAT,CTCT.NGUOICAPNHAT_ID,#BENHVIEN_ID#,SYSDATE,#ACCOUNTID#,SYSDATE,#ACCOUNTID#
      FROM TT_PUR_CHUNGTU CT,TT_PUR_CHUNGTUCHITIET CTCT WHERE CT.CHUNGTU_ID=CTCT.CHUNGTU_ID AND CT.CHUNGTU_ID='$CHUNGTU_ID$'
    </statement>
    <statement id="DAO00400_PUR001_AddChungTuChiTietHistory" parameterClass="System.String" resultClass="System.Int32">
      INSERT INTO TT_PUR_CHUNGTUHISTORY
      (TENNGUOITAO,TRANGTHAIHANHDONG,CT_CHUNGTU_ID,CT_MACHUNGTU,CT_NGAYLAPCHUNGTU,CT_NGAYGIOLAPCHUNGTU,
      CT_PROCESS_CODE,CT_PROCESS_NAME,CT_STATE_CODE,CT_STATE_NAME,CT_PHONGBAN_ID,
      CT_TENPHONGBAN,CT_NGUOIDUYETCAP1_ID,CT_TENNGUOIDUYETCAP1,CT_NGAYGIODUYETCAP1,CT_NGUOIDUYETCAP2_ID,CT_TENNGUOIDUYETCAP2,CT_NGAYGIODUYETCAP2,CT_NGUOIDUYETCAP3_ID,CT_TENNGUOIDUYETCAP3,CT_NGAYGIODUYETCAP3,CT_CAPDUYET,CT_THOIGIANGIAOHANG,CT_NHACUNGCAP_ID,CT_TENNHACUNGCAP,
      CT_HINHTHUCGIAOHANG,CT_HINHTHUCTHANHTOAN,CT_TONGTIEN,CT_GHICHU,CT_TIEUDE,CT_DIENGIAI,CT_LYDOTUCHOINHAN,CT_NGANSACH,CT_GIATRITHEONGANSACH,CT_GIATRIDASUDUNG,CT_GIATRICONLAI,CT_NGUOIPHANCONG_ID,CT_TENNGUOIPHANCONG,CT_NGAYPHANCONG,CT_NGAYCHAPNHAN,CT_NGAYTUCHOI,CT_THANHTOAN1,CT_THANHTOAN2,
      CT_THANHTOAN3,CT_THANHTOAN4,CT_THANHTOAN5,CT_THANHTOAN6,CT_TRONGNGANSACH,CT_MALOAIPHIEU,CT_TENLOAIPHIEU,CT_MACHUNGTUPOMOI,CT_CHUNGTU_IDPOMOI,CT_TENNGUOITAO,CT_TENNGUOICAPNHAT,CT_NGAYTAO,CT_NGUOITAO_ID,CT_NGAYCAPNHAT,CT_NGUOICAPNHAT_ID,
      CTCT_CHUNGTUCHITIET_ID,CTCT_CHUNGTU_ID,CTCT_HANGHOA_ID,CTCT_MAHANGHOA,CTCT_TENHANGHOA,CTCT_DONVITINH_ID,CTCT_TENDONVITINH,CTCT_LOAI_ID,CTCT_TENLOAI,CTCT_SOLUONGYEUCAU,CTCT_MOTA,CTCT_THUONGHIEU,CTCT_KICHTHUOC,CTCT_VATLIEU,CTCT_GHICHU,
      CTCT_FILE_NAME,CTCT_FULLPATHSERVER,CTCT_FULLPATHLOCAL,CTCT_SIZE,CTCT_FILE_NAME_PO,CTCT_FULLPATHSERVER_PO,CTCT_FULLPATHLOCAL_PO,CTCT_SIZE_PO,CTCT_STATE_CODE,CTCT_STATE_NAME,CTCT_NGUOIDUYET_ID,CTCT_TENNGUOIDUYET,CTCT_NGAYGIODUYET,CTCT_MACHONGIA,CTCT_TENCHONGIA,
      CTCT_DONGIA,CTCT_TYLEVAT,CTCT_GIATRIVAT,CTCT_DONGIASAUVAT,CTCT_THANHTIEN,CTCT_NHACUNGCAP_ID,CTCT_TENNHACUNGCAP,CTCT_DONGIAHOPDONG,CTCT_TUNGAYHOPDONG, CTCT_DENNGAYHOPDONG,CTCT_GIAHOPDONG_ID,CTCT_GIAHOPDONGCHITIET_ID,
      CTCT_MATONGHOP,CTCT_CHUNGTUTONGHOP_ID,CTCT_MALOAIPHIEU,CTCT_BAOHANHTUNGAY,CTCT_BAOHANHDENNGAY,CTCT_TENNGUOITAO,CTCT_TENNGUOICAPNHAT,CTCT_NGAYTAO,CTCT_NGUOITAO_ID,CTCT_NGAYCAPNHAT,
      CTCT_NGUOICAPNHAT_ID,BENHVIEN_ID,NGAYTAO,NGUOITAO_ID,NGAYCAPNHAT,NGUOICAPNHAT_ID)
      SELECT
      #ACCOUNTNAME#,#TRANGTHAIHANHDONG#,CT.CHUNGTU_ID,CT.MACHUNGTU,CT.NGAYLAPCHUNGTU,CT.NGAYGIOLAPCHUNGTU,
      CT.PROCESS_CODE,CT.PROCESS_NAME,CT.STATE_CODE,CT.STATE_NAME,CT.PHONGBAN_ID,CT.TENPHONGBAN,CT.NGUOIDUYETCAP1_ID,CT.TENNGUOIDUYETCAP1,CT.NGAYGIODUYETCAP1,
      CT.NGUOIDUYETCAP2_ID,CT.TENNGUOIDUYETCAP2,CT.NGAYGIODUYETCAP2,CT.NGUOIDUYETCAP3_ID,CT.TENNGUOIDUYETCAP3,CT.NGAYGIODUYETCAP3,CT.CAPDUYET,
      CT.THOIGIANGIAOHANG,CT.NHACUNGCAP_ID,CT.TENNHACUNGCAP,CT.HINHTHUCGIAOHANG,CT.HINHTHUCTHANHTOAN,CT.TONGTIEN,CT.GHICHU,CT.TIEUDE,CT.DIENGIAI,CT.LYDOTUCHOINHAN,CT.NGANSACH,CT.GIATRITHEONGANSACH,CT.GIATRIDASUDUNG,
      CT.GIATRICONLAI,CT.NGUOIPHANCONG_ID,CT.TENNGUOIPHANCONG,CT.NGAYPHANCONG,CT.NGAYCHAPNHAN,CT.NGAYTUCHOI,CT.THANHTOAN1,CT.THANHTOAN2,CT.THANHTOAN3,CT.THANHTOAN4,CT.THANHTOAN5,CT.THANHTOAN6,CT.TRONGNGANSACH,
      CT.MALOAIPHIEU,(CASE WHEN CT.MALOAIPHIEU='DP' THEN 'Dược phẩm' ELSE CT.TENLOAIPHIEU END) AS TENLOAIPHIEU,CT.MACHUNGTUPOMOI,CT.CHUNGTU_IDPOMOI,CT.TENNGUOITAO,CT.TENNGUOICAPNHAT,CT.NGAYTAO,CT.NGUOITAO_ID,CT.NGAYCAPNHAT,CT.NGUOICAPNHAT_ID,
      CTCT.CHUNGTUCHITIET_ID,CTCT.CHUNGTU_ID,CTCT.HANGHOA_ID,CTCT.MAHANGHOA,CTCT.TENHANGHOA,CTCT.DONVITINH_ID,CTCT.TENDONVITINH,CTCT.LOAI_ID,CTCT.TENLOAI,CTCT.SOLUONGYEUCAU,CTCT.MOTA,CTCT.THUONGHIEU,CTCT.KICHTHUOC,CTCT.VATLIEU,CTCT.GHICHU,
      CTCT.FILE_NAME,CTCT.FULLPATHSERVER,CTCT.FULLPATHLOCAL,CTCT.SIZE,CTCT.FILE_NAME_PO,CTCT.FULLPATHSERVER_PO,CTCT.FULLPATHLOCAL_PO,CTCT.SIZE_PO,CTCT.STATE_CODE,
      CTCT.STATE_NAME,CTCT.NGUOIDUYET_ID,CTCT.TENNGUOIDUYET,CTCT.NGAYGIODUYET,CTCT.MACHONGIA,CTCT.TENCHONGIA,CTCT.DONGIA,CTCT.TYLEVAT,CTCT.GIATRIVAT,CTCT.DONGIASAUVAT,CTCT.THANHTIEN,
      CTCT.NHACUNGCAP_ID,CTCT.TENNHACUNGCAP,CTCT.DONGIAHOPDONG,CTCT.TUNGAYHOPDONG, CTCT.DENNGAYHOPDONG,CTCT.GIAHOPDONG_ID,CTCT.GIAHOPDONGCHITIET_ID,CTCT.MATONGHOP,CTCT.CHUNGTUTONGHOP_ID,CTCT.MALOAIPHIEU,CTCT.BAOHANHTUNGAY,CTCT.BAOHANHDENNGAY,CTCT.TENNGUOITAO,CTCT.TENNGUOICAPNHAT,CTCT.NGAYTAO,
      CTCT.NGUOITAO_ID,CTCT.NGAYCAPNHAT,CTCT.NGUOICAPNHAT_ID,#BENHVIEN_ID#,SYSDATE,#ACCOUNTID#,SYSDATE,#ACCOUNTID#
      FROM TT_PUR_CHUNGTU CT,TT_PUR_CHUNGTUCHITIET CTCT WHERE CT.CHUNGTU_ID=CTCT.CHUNGTU_ID AND CTCT.CHUNGTUCHITIET_ID='$CHUNGTUCHITIET_ID$'
    </statement>
    <insert id="DAO00400_PUR001_AddChungTu" parameterClass="System.Collections.IDictionary" resultClass="System.Int64">
      <selectKey property="ID" type="pre" resultClass="System.Int64">
        select TT_PUR_CHUNGTU_S.nextval as value from dual
      </selectKey>
      INSERT INTO TT_PUR_CHUNGTU
      (CHUNGTU_ID,MACHUNGTU,NGAYLAPCHUNGTU,NGAYGIOLAPCHUNGTU,PROCESS_CODE,PROCESS_NAME,STATE_CODE,STATE_NAME,PHONGBAN_ID,TENPHONGBAN
      ,THOIGIANGIAOHANG,NHACUNGCAP_ID,TENNHACUNGCAP,HINHTHUCGIAOHANG,HINHTHUCTHANHTOAN,TONGTIEN,GHICHU,TIEUDE,DIENGIAI,TENNGUOITAO,NGANSACH,GIATRITHEONGANSACH,GIATRIDASUDUNG,GIATRICONLAI,
      NGUOIPHANCONG_ID,TENNGUOIPHANCONG,NGAYPHANCONG,NGAYCHAPNHAN,NGAYTUCHOI,THANHTOAN1,THANHTOAN2,THANHTOAN3,THANHTOAN4,THANHTOAN5,THANHTOAN6,TRONGNGANSACH,MALOAIPHIEU,TENLOAIPHIEU,BENHVIEN_ID,NGAYTAO,NGUOITAO_ID)
      VALUES
      (#ID#,#MACHUNGTU#,#NGAYLAPCHUNGTU#,#NGAYGIOLAPCHUNGTU#,#PROCESS_CODE#,#PROCESS_NAME#,#STATE_CODE#,#STATE_NAME#,#PHONGBAN_ID#,#TENPHONGBAN#
      ,#THOIGIANGIAOHANG#,#NHACUNGCAP_ID#,#TENNHACUNGCAP#,#HINHTHUCGIAOHANG#,#HINHTHUCTHANHTOAN#,#TONGTIEN#,#GHICHU#,#TIEUDE#,#DIENGIAI#,#TENNGUOITAO#,#NGANSACH#,#GIATRITHEONGANSACH#,#GIATRIDASUDUNG#,#GIATRICONLAI#,
      #NGUOIPHANCONG_ID#,#TENNGUOIPHANCONG#,#NGAYPHANCONG#,#NGAYCHAPNHAN#,#NGAYTUCHOI#,#THANHTOAN1#,#THANHTOAN2#,#THANHTOAN3#,#THANHTOAN4#,#THANHTOAN5#,#THANHTOAN6#,#TRONGNGANSACH#,#MALOAIPHIEU#,#TENLOAIPHIEU#,#BENHVIEN_ID#,SYSDATE,#NGUOITAO_ID#)      
    </insert>
    <update id="DAO00400_PUR001_UpdTrangThaiChungTu" parameterClass="DataObject">
      UPDATE TT_PUR_CHUNGTU
      SET STATE_CODE = #STATE_CODE#,STATE_NAME = #STATE_NAME#, NGAYCAPNHAT = SYSDATE, NGUOICAPNHAT_ID = #ACCOUNTID#, TENNGUOICAPNHAT = #ACCOUNTNAME#
      WHERE CHUNGTU_ID = '$CHUNGTU_ID$' AND BENHVIEN_ID = '$BENHVIEN_ID$'
    </update>
    <update id="DAO00400_PUR001_UpdTrangThaiChungTuDuyet" parameterClass="DataObject">
      UPDATE TT_PUR_CHUNGTU
      SET STATE_CODE = #STATE_CODE#,STATE_NAME = #STATE_NAME#,NGUOIDUYETCAP1_ID = #NGUOIDUYETCAP1_ID#,TENNGUOIDUYETCAP1 = #TENNGUOIDUYETCAP1#,NGAYGIODUYETCAP1 = #NGAYGIODUYETCAP1#,
      NGUOIDUYETCAP2_ID = #NGUOIDUYETCAP2_ID#,TENNGUOIDUYETCAP2 = #TENNGUOIDUYETCAP2#,NGAYGIODUYETCAP2 = #NGAYGIODUYETCAP2#,
      NGUOIDUYETCAP3_ID = #NGUOIDUYETCAP3_ID#,TENNGUOIDUYETCAP3 = #TENNGUOIDUYETCAP3#,NGAYGIODUYETCAP3 = #NGAYGIODUYETCAP3#,CAPDUYET = #CAPDUYET#,DIENGIAI = #DIENGIAI#,
      NGAYCAPNHAT = SYSDATE, NGUOICAPNHAT_ID = #ACCOUNTID#, TENNGUOICAPNHAT = #ACCOUNTNAME#
      WHERE CHUNGTU_ID = '$CHUNGTU_ID$' AND BENHVIEN_ID = '$BENHVIEN_ID$'
    </update>
    <update id="DAO00400_PUR001_UpdPhanCongNhanVien" parameterClass="DataObject">
      UPDATE TT_PUR_CHUNGTU
      SET STATE_CODE = #STATE_CODE#,STATE_NAME = #STATE_NAME#,NGUOIPHANCONG_ID = #NGUOIPHANCONG_ID#,TENNGUOIPHANCONG = #TENNGUOIPHANCONG#,NGAYPHANCONG = #NGAYPHANCONG#,NGAYCHAPNHAN = #NGAYCHAPNHAN#,NGAYTUCHOI = #NGAYTUCHOI#,LYDOTUCHOINHAN=#LYDOTUCHOINHAN#
      WHERE CHUNGTU_ID = '$CHUNGTU_ID$' AND BENHVIEN_ID = '$BENHVIEN_ID$'
    </update>
    <update id="DAO00400_PUR001_UpdTrangThaiDuyet" parameterClass="DataObject">
      UPDATE TT_PUR_CHUNGTU SET TRANGTHAI_DUYET=#TRANGTHAI_DUYET# WHERE CHUNGTU_ID = '$CHUNGTU_ID$' AND BENHVIEN_ID = '$BENHVIEN_ID$'
    </update>
    <update id="DAO00400_PUR001_UpdTrangThaiPO" parameterClass="DataObject">
      UPDATE TT_PUR_CHUNGTU
      SET STATE_CODE = #STATE_CODE#,STATE_NAME = #STATE_NAME#
      WHERE CHUNGTU_ID = '$CHUNGTU_ID$' AND BENHVIEN_ID = '$BENHVIEN_ID$'
    </update>
    <update id="DAO00400_PUR001_UpdPOHuy" parameterClass="DataObject">
      UPDATE TT_PUR_CHUNGTU
      SET CHUNGTU_IDPOMOI = #CHUNGTU_IDPOMOI#,MACHUNGTUPOMOI = #MACHUNGTUPOMOI#
      WHERE MACHUNGTU = '$MACHUNGTUPOHUY$' AND BENHVIEN_ID = '$BENHVIEN_ID$'
    </update>
    <update id="DAO00400_PUR001_UpdChungTu" parameterClass="DataObject">
      UPDATE TT_PUR_CHUNGTU
      SET NGAYLAPCHUNGTU = #NGAYLAPCHUNGTU#
      ,NGAYGIOLAPCHUNGTU = #NGAYGIOLAPCHUNGTU#
      ,PROCESS_CODE = #PROCESS_CODE#
      ,PROCESS_NAME = #PROCESS_NAME#
      ,STATE_CODE = #STATE_CODE#
      ,STATE_NAME = #STATE_NAME#
      ,PHONGBAN_ID = #PHONGBAN_ID#
      ,TENPHONGBAN = #TENPHONGBAN#
      ,NGUOIDUYETCAP1_ID = #NGUOIDUYETCAP1_ID#
      ,TENNGUOIDUYETCAP1 = #TENNGUOIDUYETCAP1#
      ,NGAYGIODUYETCAP1 = #NGAYGIODUYETCAP1#
      ,NGUOIDUYETCAP2_ID = #NGUOIDUYETCAP2_ID#
      ,TENNGUOIDUYETCAP2 = #TENNGUOIDUYETCAP2#
      ,NGAYGIODUYETCAP2 = #NGAYGIODUYETCAP2#
      ,NGUOIDUYETCAP3_ID = #NGUOIDUYETCAP3_ID#
      ,TENNGUOIDUYETCAP3 = #TENNGUOIDUYETCAP3#
      ,NGAYGIODUYETCAP3 = #NGAYGIODUYETCAP3#
      ,CAPDUYET = #CAPDUYET#
      ,THOIGIANGIAOHANG = #THOIGIANGIAOHANG#
      ,NHACUNGCAP_ID = #NHACUNGCAP_ID#
      ,TENNHACUNGCAP = #TENNHACUNGCAP#
      ,HINHTHUCGIAOHANG = #HINHTHUCGIAOHANG#
      ,HINHTHUCTHANHTOAN = #HINHTHUCTHANHTOAN#
      ,TONGTIEN = #TONGTIEN#
      ,GHICHU = #GHICHU#
      ,TIEUDE = #TIEUDE#
      ,DIENGIAI = #DIENGIAI#
      ,TENNGUOITAO = #TENNGUOITAO#
      ,TENNGUOICAPNHAT = #ACCOUNTNAME#
      ,NGANSACH = #NGANSACH#
      ,GIATRITHEONGANSACH = #GIATRITHEONGANSACH#
      ,GIATRIDASUDUNG = #GIATRIDASUDUNG#
      ,GIATRICONLAI = #GIATRICONLAI#
      ,NGUOIPHANCONG_ID = #NGUOIPHANCONG_ID#
      ,TENNGUOIPHANCONG = #TENNGUOIPHANCONG#
      ,NGAYPHANCONG = #NGAYPHANCONG#
      ,NGAYCHAPNHAN = #NGAYCHAPNHAN#
      ,NGAYTUCHOI = #NGAYTUCHOI#
      ,THANHTOAN1 = #THANHTOAN1#
      ,THANHTOAN2 = #THANHTOAN2#
      ,THANHTOAN3 = #THANHTOAN3#
      ,THANHTOAN4 = #THANHTOAN4#
      ,THANHTOAN5 = #THANHTOAN5#
      ,THANHTOAN6 = #THANHTOAN6#
      ,TRONGNGANSACH = #TRONGNGANSACH#
      ,MALOAIPHIEU = #MALOAIPHIEU#
      ,TENLOAIPHIEU = #TENLOAIPHIEU#
      ,BENHVIEN_ID = #BENHVIEN_ID#
      ,NGAYCAPNHAT = SYSDATE
      ,NGUOICAPNHAT_ID = #ACCOUNTID#
      WHERE CHUNGTU_ID = '$CHUNGTU_ID$'
    </update>
  <update id="DAO00400_PUR001_UpdChungTuChiTiet" parameterClass="DataObject">
    UPDATE TT_PUR_CHUNGTUCHITIET
    SET CHUNGTU_ID = #CHUNGTU_ID#
    ,HANGHOA_ID = #HANGHOA_ID#
    ,MAHANGHOA = #MAHANGHOA#
    ,TENHANGHOA = #TENHANGHOA#
    ,DONVITINH_ID = #DONVITINH_ID#
    ,TENDONVITINH = #TENDONVITINH#
    ,LOAI_ID = #LOAI_ID#
    ,TENLOAI = #TENLOAI#
    ,SOLUONGYEUCAU = #SOLUONGYEUCAU#
    ,MOTA = #MOTA#
    ,THUONGHIEU = #THUONGHIEU#
    ,KICHTHUOC = #KICHTHUOC#
    ,VATLIEU = #VATLIEU#
    ,GHICHU = #CT_GHICHU#
    ,FILE_NAME = #FILE_NAME#
    ,FULLPATHSERVER = #FULLPATHSERVER#
    ,FULLPATHLOCAL = #FULLPATHLOCAL#
    ,SIZE = #SIZE#
    ,FILE_NAME_PO = #FILE_NAME_PO#
    ,FULLPATHSERVER_PO = #FULLPATHSERVER_PO#
    ,FULLPATHLOCAL_PO = #FULLPATHLOCAL_PO#
    ,SIZE_PO = #SIZE_PO#
    ,STATE_CODE = #CT_STATE_CODE#
    ,STATE_NAME = #CT_STATE_NAME#
    ,NGUOIDUYET_ID = #CT_NGUOIDUYET_ID#
    ,TENNGUOIDUYET = #CT_TENNGUOIDUYET#
    ,NGAYGIODUYET = #CT_NGAYGIODUYET#
    ,MACHONGIA = #MACHONGIA#
    ,TENCHONGIA = #TENCHONGIA#
    ,DONGIA = #DONGIA#
    ,TYLEVAT = #TYLEVAT#
    ,GIATRIVAT = #GIATRIVAT#
    ,DONGIASAUVAT = #DONGIASAUVAT#
    ,THANHTIEN = #THANHTIEN#
    ,NHACUNGCAP_ID = #CT_NHACUNGCAP_ID#
    ,TENNHACUNGCAP = #CT_TENNHACUNGCAP#
    ,DONGIAHOPDONG = #DONGIAHOPDONG#
    ,TUNGAYHOPDONG = #TUNGAYHOPDONG#
    ,DENNGAYHOPDONG = #DENNGAYHOPDONG#
    ,GIAHOPDONG_ID = #GIAHOPDONG_ID#
    ,GIAHOPDONGCHITIET_ID = #GIAHOPDONGCHITIET_ID#
    ,MATONGHOP = #MATONGHOP#
    ,CHUNGTUTONGHOP_ID = #CHUNGTUTONGHOP_ID#
    ,MALOAIPHIEU = #MALOAIPHIEU#
    ,BAOHANHTUNGAY = #BAOHANHTUNGAY#
    ,BAOHANHDENNGAY = #BAOHANHDENNGAY#
    ,TENNGUOICAPNHAT = #ACCOUNTNAME#
    ,BENHVIEN_ID = #BENHVIEN_ID#
    ,NGAYCAPNHAT = SYSDATE
    ,NGUOICAPNHAT_ID = #ACCOUNTID#
    WHERE CHUNGTUCHITIET_ID = '$CHUNGTUCHITIET_ID$'
  </update>
    <insert id="DAO00400_PUR001_AddChungTuChiTiet" parameterClass="System.String" resultClass="System.Int64">
      <selectKey property="ID" type="pre" resultClass="System.Int64">
        select TT_PUR_CHUNGTUCHITIET_S.nextval as value from dual
      </selectKey>
      INSERT INTO TT_PUR_CHUNGTUCHITIET
      (CHUNGTUCHITIET_ID,CHUNGTU_ID,HANGHOA_ID,MAHANGHOA,TENHANGHOA,DONVITINH_ID,TENDONVITINH,LOAI_ID,TENLOAI,SOLUONGYEUCAU,MOTA,THUONGHIEU,KICHTHUOC,VATLIEU,GHICHU,FILE_NAME,FULLPATHSERVER,FULLPATHLOCAL,SIZE,FILE_NAME_PO,FULLPATHSERVER_PO,FULLPATHLOCAL_PO,SIZE_PO,
      STATE_CODE,STATE_NAME,NGUOIDUYET_ID,TENNGUOIDUYET,NGAYGIODUYET,MACHONGIA,TENCHONGIA,DONGIA,TYLEVAT,GIATRIVAT,DONGIASAUVAT,THANHTIEN,NHACUNGCAP_ID,TENNHACUNGCAP,DONGIAHOPDONG,TUNGAYHOPDONG,DENNGAYHOPDONG,GIAHOPDONG_ID,GIAHOPDONGCHITIET_ID,MATONGHOP,
      CHUNGTUTONGHOP_ID,MALOAIPHIEU,BAOHANHTUNGAY,BAOHANHDENNGAY,TENNGUOITAO,BENHVIEN_ID,NGAYTAO,NGUOITAO_ID)
      VALUES
      (#ID#,#CHUNGTU_ID#,#HANGHOA_ID#,#MAHANGHOA#,#TENHANGHOA#,#DONVITINH_ID#,#TENDONVITINH#,#LOAI_ID#,#TENLOAI#,#SOLUONGYEUCAU#,#MOTA#,#THUONGHIEU#,#KICHTHUOC#,#VATLIEU#,#CT_GHICHU#,
      #FILE_NAME#,#FULLPATHSERVER#,#FULLPATHLOCAL#,#SIZE#,#FILE_NAME_PO#,#FULLPATHSERVER_PO#,#FULLPATHLOCAL_PO#,#SIZE_PO#,#CT_STATE_CODE#,#CT_STATE_NAME#,#CT_NGUOIDUYET_ID#,#CT_TENNGUOIDUYET#,#CT_NGAYGIODUYET#,#MACHONGIA#,#TENCHONGIA#,#DONGIA#,#TYLEVAT#,#GIATRIVAT#,#DONGIASAUVAT#,
      #THANHTIEN#,#CT_NHACUNGCAP_ID#,#CT_TENNHACUNGCAP#,#DONGIAHOPDONG#,#TUNGAYHOPDONG#,#DENNGAYHOPDONG#,#GIAHOPDONG_ID#,#GIAHOPDONGCHITIET_ID#,#MATONGHOP#,#CHUNGTUTONGHOP_ID#,#MALOAIPHIEU#,#BAOHANHTUNGAY#,#BAOHANHDENNGAY#,#ACCOUNTNAME#,#BENHVIEN_ID#,SYSDATE,#ACCOUNTID#)      
    </insert>
    <statement id="DAO00400_PUR001_ChungTuDuyetPhongBan" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
      select DISTINCT 0 AS CHON,CT.CHUNGTU_ID,CT.MACHUNGTU,CT.NGAYLAPCHUNGTU,CT.NGAYGIOLAPCHUNGTU,CT.PROCESS_CODE,CT.PROCESS_NAME,CT.STATE_CODE,CT.STATE_NAME,CT.PHONGBAN_ID,
      CT.TENPHONGBAN,CT.NGUOIDUYETCAP1_ID,CT.TENNGUOIDUYETCAP1,CT.NGAYGIODUYETCAP1,CT.NGUOIDUYETCAP2_ID,CT.TENNGUOIDUYETCAP2,CT.NGAYGIODUYETCAP2,CT.NGUOIDUYETCAP3_ID,
      CT.TENNGUOIDUYETCAP3,CT.NGAYGIODUYETCAP3,CT.CAPDUYET,CT.THOIGIANGIAOHANG,CT.NHACUNGCAP_ID,CT.TENNHACUNGCAP,CT.HINHTHUCGIAOHANG,CT.HINHTHUCTHANHTOAN,CT.TONGTIEN,CT.GHICHU,CT.DIENGIAI,
      CT.TENNGUOITAO,CT.TENNGUOICAPNHAT,CT.NGUOIPHANCONG_ID,CT.TENNGUOIPHANCONG,CT.NGAYPHANCONG,CT.NGAYCHAPNHAN,CT.NGAYTUCHOI,CT.THANHTOAN1,CT.THANHTOAN2,CT.THANHTOAN3,CT.THANHTOAN4,
      CT.THANHTOAN5,CT.THANHTOAN6,CT.BENHVIEN_ID,CT.NGAYTAO,CT.NGUOITAO_ID,CT.NGAYCAPNHAT,CT.NGUOICAPNHAT_ID,
      (CASE WHEN CT.STATE_CODE='3' THEN 'Đã duyệt bởi '+CT.TENNGUOIDUYETCAP1 ELSE CASE WHEN CT.STATE_CODE='4' THEN 'Đã từ chối bởi '+CT.TENNGUOIDUYETCAP1 ELSE CT.STATE_NAME END END) AS TRANGTHAI,
      PR.MATONGHOP
      from TT_PUR_CHUNGTU CT INNER JOIN TT_PUR_CHUNGTUCHITIET CTCT ON CT.CHUNGTU_ID=CTCT.CHUNGTU_ID
      LEFT JOIN (
      SELECT DISTINCT YY.MATONGHOP
      FROM TT_PUR_CHUNGTU XX INNER JOIN TT_PUR_CHUNGTUCHITIET YY ON XX.CHUNGTU_ID=YY.CHUNGTU_ID
      WHERE XX.PROCESS_CODE='PR' AND XX.BENHVIEN_ID = '$BENHVIEN_ID$'
      <isNotEmpty prepend="AND" property="MACHUNGTU">
        YY.MATONGHOP = '$MACHUNGTU$'
      </isNotEmpty>
      ) PR ON CT.MACHUNGTU=PR.MATONGHOP
      where CT.BENHVIEN_ID = '$BENHVIEN_ID$' AND CT.PHONGBAN_ID IN ($LISTPHONGBANID$)
      <isNotEmpty prepend="AND" property="TUNGAY">
        CT.NGAYLAPCHUNGTU BETWEEN '$TUNGAY$' AND '$DENNGAY$'
      </isNotEmpty>
      <isNotEmpty prepend="AND" property="PROCESS_CODE">
        CT.PROCESS_CODE='$PROCESS_CODE$'
      </isNotEmpty>
      <isNotEmpty prepend="AND" property="NGUOITAO_ID">
        CT.NGUOITAO_ID='$NGUOITAO_ID$'
      </isNotEmpty>
      <isNotEmpty prepend="AND" property="MACHUNGTU">
        CT.MACHUNGTU LIKE '%$MACHUNGTU$%'
      </isNotEmpty>
      ORDER BY CT.NGAYLAPCHUNGTU
    </statement>
    <statement id="DAO00400_PUR001_GetLichSuMaChungTu" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
      select ROW_NUMBER() OVER(ORDER BY  CT.CHUNGTU_ID) as STT, CT.TENNGUOIDUYETCAP1,(CASE WHEN CT.TENNGUOIDUYETCAP1 IS NULL THEN NULL ELSE CASE WHEN CT.TENNGUOIDUYETCAP2 IS NOT NULL THEN 'Đã duyệt' ELSE CASE WHEN CT.STATE_CODE NOT IN('4') THEN 'Đã duyệt' ELSE 'Từ chối' END END END) AS TRANGTHAI1,
      CT.NGAYGIODUYETCAP1,CT.TENNGUOIDUYETCAP2,(CASE WHEN CT.TENNGUOIDUYETCAP2 IS NULL THEN NULL ELSE CASE WHEN CT.TENNGUOIDUYETCAP3 IS NOT NULL THEN 'Đã duyệt' ELSE
      CASE WHEN CT.STATE_CODE NOT IN('4') THEN 'Đã duyệt' ELSE 'Từ chối' END END END) AS TRANGTHAI2,CT.NGAYGIODUYETCAP2,CT.TENNGUOIDUYETCAP3,(CASE WHEN CT.TENNGUOIDUYETCAP3 IS NULL THEN NULL ELSE CASE WHEN CT.TENNGUOIDUYETCAP2 IS NULL THEN NULL ELSE
      CASE WHEN CT.STATE_CODE NOT IN('4') THEN 'Đã duyệt' ELSE 'Từ chối' END END END) AS STATE_NAME,CT.NGAYGIODUYETCAP3
      from TT_PUR_CHUNGTU CT
      where CT.BENHVIEN_ID = '$BENHVIEN_ID$' AND CT.PROCESS_CODE='$PROCESS_CODE$' AND CT.MACHUNGTU='$MACHUNGTU$'
    </statement>
    <statement id="DAO00400_PUR001_ChungTuSearchP01" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
      select 0 AS CHON,CT.CHUNGTU_ID,CT.MACHUNGTU,CT.NGAYLAPCHUNGTU,CT.NGAYGIOLAPCHUNGTU,CT.PROCESS_CODE,CT.PROCESS_NAME,CT.STATE_CODE,CT.STATE_NAME,CT.PHONGBAN_ID,
      CT.TENPHONGBAN,CT.NGUOIDUYETCAP1_ID,CT.TENNGUOIDUYETCAP1,CT.NGAYGIODUYETCAP1,CT.NGUOIDUYETCAP2_ID,CT.TENNGUOIDUYETCAP2,CT.NGAYGIODUYETCAP2,CT.NGUOIDUYETCAP3_ID,
      CT.TENNGUOIDUYETCAP3,CT.NGAYGIODUYETCAP3,CT.CAPDUYET,CT.THOIGIANGIAOHANG,CT.NHACUNGCAP_ID,CT.TENNHACUNGCAP,CT.HINHTHUCGIAOHANG,CT.HINHTHUCTHANHTOAN,CT.TONGTIEN,CT.GHICHU,CT.DIENGIAI,
      CT.LYDOTUCHOINHAN,CT.TENNGUOITAO,CT.TENNGUOICAPNHAT,CT.NGUOIPHANCONG_ID,CT.TENNGUOIPHANCONG,CT.NGAYPHANCONG,CT.NGAYCHAPNHAN,CT.NGAYTUCHOI,CT.THANHTOAN1,CT.THANHTOAN2,CT.THANHTOAN3,CT.THANHTOAN4,
      CT.THANHTOAN5,CT.THANHTOAN6,CT.MALOAIPHIEU,(CASE WHEN CT.MALOAIPHIEU='DP' THEN 'Dược phẩm' ELSE CT.TENLOAIPHIEU END) AS TENLOAIPHIEU,CT.BENHVIEN_ID,CT.NGAYTAO,CT.NGUOITAO_ID,CT.NGAYCAPNHAT,CT.NGUOICAPNHAT_ID,
      (CASE WHEN CT.STATE_CODE='3' THEN 'Đã duyệt bởi '+CT.TENNGUOIDUYETCAP1 ELSE CASE WHEN CT.STATE_CODE='4' THEN 'Đã từ chối bởi '+CT.TENNGUOIDUYETCAP1 ELSE CT.STATE_NAME END END) AS TRANGTHAI,
      PO.MATONGHOP, DT.MACHUNGTU AS MACHUNGTUDUOC
      from TT_PUR_CHUNGTU CT
      LEFT JOIN TT_DUOC_DUTRU DT ON DT.MACHUNGTUMUAHANG = CT.MACHUNGTU
      LEFT JOIN (
      SELECT DISTINCT YY.MATONGHOP
      FROM TT_PUR_CHUNGTU XX INNER JOIN TT_PUR_CHUNGTUCHITIET YY ON XX.CHUNGTU_ID=YY.CHUNGTU_ID
      WHERE XX.PROCESS_CODE='PO' AND XX.BENHVIEN_ID = '$BENHVIEN_ID$'
      <isNotEmpty prepend="AND" property="MACHUNGTU">
        YY.MATONGHOP = '$MACHUNGTU$'
      </isNotEmpty>
      ) PO ON CT.MACHUNGTU=PO.MATONGHOP
      where CT.BENHVIEN_ID = '$BENHVIEN_ID$'
      <isNotEmpty prepend="AND" property="PROCESS_CODE">
        CT.PROCESS_CODE='$PROCESS_CODE$'
      </isNotEmpty>
      <isNotEmpty prepend="AND" property="STATE_CODE">
        CT.STATE_CODE='$STATE_CODE$' AND CT.MACHUNGTUPOMOI IS NULL
      </isNotEmpty>
      <isNotEmpty prepend="AND" property="PHONGBAN_ID">
        CT.PHONGBAN_ID='$PHONGBAN_ID$'
      </isNotEmpty>
      <isNotEmpty prepend="AND" property="NGUOITAO_ID">
        CT.NGUOITAO_ID='$NGUOITAO_ID$'
      </isNotEmpty>
      <isNotEmpty prepend="AND" property="NGUOIPHANCONG_ID">
        CT.NGUOIPHANCONG_ID='$NGUOIPHANCONG_ID$'
      </isNotEmpty>
      <isNotEmpty prepend="AND" property="MACHUNGTU">
        CT.MACHUNGTU LIKE '%$MACHUNGTU$%'
      </isNotEmpty>
      <isNotEmpty prepend="AND" property="TUNGAY">
        CT.NGAYLAPCHUNGTU BETWEEN '$TUNGAY$' AND '$DENNGAY$'
      </isNotEmpty>
      ORDER BY NGAYLAPCHUNGTU
    </statement>
    <statement id="DAO00400_PUR001_ChungTuSearchP01_PO" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
      select 0 AS CHON,CT.CHUNGTU_ID,CT.MACHUNGTU,CT.NGAYLAPCHUNGTU,CT.NGAYGIOLAPCHUNGTU,CT.PROCESS_CODE,CT.PROCESS_NAME,CT.STATE_CODE,CT.STATE_NAME,CT.PHONGBAN_ID,
      CT.TENPHONGBAN,CT.NGUOIDUYETCAP1_ID,CT.TENNGUOIDUYETCAP1,CT.NGAYGIODUYETCAP1,CT.NGUOIDUYETCAP2_ID,CT.TENNGUOIDUYETCAP2,CT.NGAYGIODUYETCAP2,CT.NGUOIDUYETCAP3_ID,
      CT.TENNGUOIDUYETCAP3,CT.NGAYGIODUYETCAP3,CT.CAPDUYET,CT.THOIGIANGIAOHANG,CT.NHACUNGCAP_ID,CT.TENNHACUNGCAP,CT.HINHTHUCGIAOHANG,CT.HINHTHUCTHANHTOAN,CT.TONGTIEN,CT.GHICHU,CT.DIENGIAI,
      CT.LYDOTUCHOINHAN,CT.TENNGUOITAO,CT.TENNGUOICAPNHAT,CT.NGUOIPHANCONG_ID,CT.TENNGUOIPHANCONG,CT.NGAYPHANCONG,CT.NGAYCHAPNHAN,CT.NGAYTUCHOI,CT.THANHTOAN1,CT.THANHTOAN2,CT.THANHTOAN3,CT.THANHTOAN4,
      CT.THANHTOAN5,CT.THANHTOAN6,CT.MALOAIPHIEU,(CASE WHEN CT.MALOAIPHIEU='DP' THEN 'Dược phẩm' ELSE CT.TENLOAIPHIEU END) AS TENLOAIPHIEU,CT.BENHVIEN_ID,CT.NGAYTAO,CT.NGUOITAO_ID,CT.NGAYCAPNHAT,CT.NGUOICAPNHAT_ID,
      (CASE WHEN CT.STATE_CODE='3' THEN 'Đã duyệt bởi '+CT.TENNGUOIDUYETCAP1 ELSE CASE WHEN CT.STATE_CODE='4' THEN 'Đã từ chối bởi '+CT.TENNGUOIDUYETCAP1 ELSE CT.STATE_NAME END END) AS TRANGTHAI,
      sum(CTCT.SOLUONGDANHAP) SOLUONGDANHAP
      from TT_PUR_CHUNGTU CT INNER JOIN TT_PUR_CHUNGTUCHITIET CTCT ON CT.CHUNGTU_ID=CTCT.CHUNGTU_ID
      where CT.BENHVIEN_ID = '$BENHVIEN_ID$'
      <isNotEmpty prepend="AND" property="PROCESS_CODE">
        CT.PROCESS_CODE='$PROCESS_CODE$'
      </isNotEmpty>
      <isNotEmpty prepend="AND" property="STATE_CODE">
        CT.STATE_CODE='$STATE_CODE$' AND CT.MACHUNGTUPOMOI IS NULL
      </isNotEmpty>
      <isNotEmpty prepend="AND" property="PHONGBAN_ID">
        CT.PHONGBAN_ID='$PHONGBAN_ID$'
      </isNotEmpty>
      <isNotEmpty prepend="AND" property="NGUOITAO_ID">
        CT.NGUOITAO_ID='$NGUOITAO_ID$'
      </isNotEmpty>
      <isNotEmpty prepend="AND" property="NGUOIPHANCONG_ID">
        CT.NGUOIPHANCONG_ID='$NGUOIPHANCONG_ID$'
      </isNotEmpty>
      <isNotEmpty prepend="AND" property="MACHUNGTU">
        CT.MACHUNGTU LIKE '%$MACHUNGTU$%'
      </isNotEmpty>
      <isNotEmpty prepend="AND" property="TUNGAY">
        CT.NGAYLAPCHUNGTU BETWEEN '$TUNGAY$' AND '$DENNGAY$'
      </isNotEmpty>
      GROUP BY CT.CHUNGTU_ID,CT.MACHUNGTU,CT.NGAYLAPCHUNGTU,CT.NGAYGIOLAPCHUNGTU,CT.PROCESS_CODE,CT.PROCESS_NAME,CT.STATE_CODE,CT.STATE_NAME,CT.PHONGBAN_ID,
      CT.TENPHONGBAN,CT.NGUOIDUYETCAP1_ID,CT.TENNGUOIDUYETCAP1,CT.NGAYGIODUYETCAP1,CT.NGUOIDUYETCAP2_ID,CT.TENNGUOIDUYETCAP2,CT.NGAYGIODUYETCAP2,CT.NGUOIDUYETCAP3_ID,
      CT.TENNGUOIDUYETCAP3,CT.NGAYGIODUYETCAP3,CT.CAPDUYET,CT.THOIGIANGIAOHANG,CT.NHACUNGCAP_ID,CT.TENNHACUNGCAP,CT.HINHTHUCGIAOHANG,CT.HINHTHUCTHANHTOAN,CT.TONGTIEN,CT.GHICHU,CT.DIENGIAI,
      CT.LYDOTUCHOINHAN,CT.TENNGUOITAO,CT.TENNGUOICAPNHAT,CT.NGUOIPHANCONG_ID,CT.TENNGUOIPHANCONG,CT.NGAYPHANCONG,CT.NGAYCHAPNHAN,CT.NGAYTUCHOI,CT.THANHTOAN1,CT.THANHTOAN2,CT.THANHTOAN3,CT.THANHTOAN4,
      CT.THANHTOAN5,CT.THANHTOAN6,CT.MALOAIPHIEU,CT.MALOAIPHIEU,CT.TENLOAIPHIEU,CT.BENHVIEN_ID,CT.NGAYTAO,CT.NGUOITAO_ID,CT.NGAYCAPNHAT,CT.NGUOICAPNHAT_ID
      ORDER BY CT.NGAYLAPCHUNGTU
    </statement>
    <statement id="DAO00400_PUR001_GetPhieuYeuCau" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
      select CT.CHUNGTU_ID,CT.MACHUNGTU,CT.NGAYLAPCHUNGTU,CT.NGAYGIOLAPCHUNGTU,CT.PROCESS_CODE,CT.PROCESS_NAME,CT.STATE_CODE,CT.STATE_NAME,CT.NGUOITAO_ID,CT.TENNGUOITAO,CT.PHONGBAN_ID,
      CT.TENPHONGBAN,CT.NGUOIDUYETCAP1_ID,CT.TENNGUOIDUYETCAP1,CT.NGAYGIODUYETCAP1,CT.NGUOIDUYETCAP2_ID,CT.TENNGUOIDUYETCAP2,CT.NGAYGIODUYETCAP2,CT.NGUOIDUYETCAP3_ID,CT.TENNGUOIDUYETCAP3,CT.NGAYGIODUYETCAP3,CT.CAPDUYET,CT.THOIGIANGIAOHANG,CT.NHACUNGCAP_ID,CT.TENNHACUNGCAP,CT.HINHTHUCGIAOHANG,
      CT.HINHTHUCTHANHTOAN,CT.TONGTIEN,CT.GHICHU,CT.DIENGIAI,CT.TIEUDE,CT.NGANSACH,CT.GIATRITHEONGANSACH,CT.GIATRIDASUDUNG,CT.GIATRICONLAI,CT.NGUOIPHANCONG_ID,CT.TENNGUOIPHANCONG,CT.NGAYPHANCONG,CT.NGAYCHAPNHAN,CT.NGAYTUCHOI,CT.THANHTOAN1,CT.THANHTOAN2,CT.THANHTOAN3,CT.THANHTOAN4,CT.THANHTOAN5,CT.THANHTOAN6,
      CT.TRONGNGANSACH,CT.MALOAIPHIEU,(CASE WHEN CT.MALOAIPHIEU='DP' THEN 'Dược phẩm' ELSE CT.TENLOAIPHIEU END) AS TENLOAIPHIEU,CT.BENHVIEN_ID,CT.NGAYTAO,CT.NGAYCAPNHAT,CT.NGUOICAPNHAT_ID,CT.TENNGUOICAPNHAT,
      NVL(CT.TENNGUOIDUYETCAP3,NVL(CT.TENNGUOIDUYETCAP2,CT.TENNGUOIDUYETCAP1)) AS TENNGUOIDUYET,NVL(CT.NGAYGIODUYETCAP3,NVL(CT.NGAYGIODUYETCAP2,CT.NGAYGIODUYETCAP1)) AS NGAYGIODUYET,
      CTCT.CHUNGTUCHITIET_ID,CTCT.HANGHOA_ID,CTCT.MAHANGHOA,CTCT.TENHANGHOA,CTCT.DONVITINH_ID,CTCT.TENDONVITINH,CTCT.LOAI_ID,CTCT.TENLOAI,SOLUONGYEUCAU,CTCT.MOTA,
      CTCT.THUONGHIEU,CTCT.KICHTHUOC,CTCT.VATLIEU,CTCT.GHICHU AS CT_GHICHU,CTCT.FILE_NAME,CTCT.FULLPATHSERVER,CTCT.FULLPATHLOCAL,CTCT.SIZE,CTCT.FILE_NAME_PO,CTCT.FULLPATHSERVER_PO,CTCT.FULLPATHLOCAL_PO,CTCT.SIZE_PO,CTCT.STATE_CODE AS CT_STATE_CODE,CTCT.STATE_NAME AS CT_STATE_NAME,CTCT.NGUOIDUYET_ID AS CT_NGUOIDUYET_ID,CTCT.TENNGUOIDUYET AS CT_TENNGUOIDUYET,
      CTCT.MACHONGIA,CTCT.TENCHONGIA,CTCT.DONGIA,CTCT.TYLEVAT,CTCT.GIATRIVAT,DONGIASAUVAT,CTCT.THANHTIEN,CTCT.NHACUNGCAP_ID AS CT_NHACUNGCAP_ID,CTCT.TENNHACUNGCAP AS CT_TENNHACUNGCAP,CTCT.DONGIAHOPDONG,CTCT.TUNGAYHOPDONG, CTCT.DENNGAYHOPDONG,CTCT.MATONGHOP,
      CTCT.CHUNGTUTONGHOP_ID,CTCT.BAOHANHTUNGAY,CTCT.BAOHANHDENNGAY,CTCT.NGAYCAPNHAT AS CT_NGAYCAPNHAT,CTCT.NGUOICAPNHAT_ID AS CT_NGUOICAPNHAT_ID,CTCT.TENNGUOICAPNHAT AS CT_TENNGUOICAPNHAT,CTCT.NGUOITAO_ID AS CT_NGUOITAO_ID,CTCT.TENNGUOITAO AS CT_TENNGUOITAO
      ,PR.MACHUNGTUPR,(CASE WHEN PR.MATRANGTHAIPR != '1' AND PR.MATRANGTHAIPR != '2' THEN NVL(CT.TENNGUOIDUYETCAP3,NVL(CT.TENNGUOIDUYETCAP2,CT.TENNGUOIDUYETCAP1))+' '+PR.TENTRANGTHAIPR ELSE PR.TENTRANGTHAIPR END) AS TENTRANGTHAIPR,PO.MACHUNGTUPO,
      (CASE WHEN PO.MATRANGTHAIPO != '1' AND PO.MATRANGTHAIPO != '2' THEN NVL(CT.TENNGUOIDUYETCAP3,NVL(CT.TENNGUOIDUYETCAP2,CT.TENNGUOIDUYETCAP1))+' '+PO.TENTRANGTHAIPO ELSE PO.TENTRANGTHAIPO END) AS TENTRANGTHAIPO,HH.DONGIA AS DMDONGIA
      FROM TT_PUR_CHUNGTU CT INNER JOIN TT_PUR_CHUNGTUCHITIET CTCT ON CT.CHUNGTU_ID = CTCT.CHUNGTU_ID INNER JOIN (
      SELECT ID AS HANGHOA_ID,MA AS MAHANGHOA,TEN AS TENHANGHOA,NHACUNGCAP_ID,TENNHACUNGCAP,GIAHOPDONG,TUNGAY, DENNGAY,'VPP' AS LOAIDM,DONGIA FROM TM_PUR_HANGHOA UNION ALL
      SELECT HANGHOA_ID,MAHANGHOA,TENHANGHOA,NULL AS NHACUNGCAP_ID,NULL AS TENNHACUNGCAP,NULL AS GIAHOPDONG,NULL AS TUNGAY,NULL AS DENNGAY,LOAIDM,DONGIA FROM VIEW_DANHMUCTAISAN UNION ALL
      SELECT DUOC_ID AS HANGHOA_ID,MADUOC AS MAHANGHOA,TENDUOCDAYDU AS TENHANGHOA,NULL AS NHACUNGCAP_ID,NULL AS TENNHACUNGCAP,NULL AS GIAHOPDONG,NULL AS TUNGAY,NULL AS DENNGAY,'DP' AS LOAIDM,0 AS DONGIA FROM TM_DUOC
      ) HH ON CTCT.HANGHOA_ID = HH.HANGHOA_ID
      LEFT JOIN (
      SELECT XX.MACHUNGTU AS MACHUNGTUPR,XX.STATE_CODE AS MATRANGTHAIPR,YY.MATONGHOP AS MACHUNGTU,YY.CHUNGTUTONGHOP_ID AS CHUNGTUCHITIET_ID,YY.CHUNGTUCHITIET_ID AS CHUNGTUCHITIET_IDPR,
      (CASE WHEN XX.STATE_CODE='1' THEN'Tạo mới' ELSE CASE WHEN XX.STATE_CODE='2' THEN 'Gởi duyệt' ELSE CASE WHEN XX.STATE_CODE='4' THEN 'đã từ chối' ELSE 'Đã duyệt' END END END) AS TENTRANGTHAIPR
      FROM TT_PUR_CHUNGTU XX INNER JOIN TT_PUR_CHUNGTUCHITIET YY ON XX.CHUNGTU_ID=YY.CHUNGTU_ID
      WHERE XX.PROCESS_CODE='PR' AND XX.BENHVIEN_ID = '$BENHVIEN_ID$'
      <isNotEmpty prepend="AND" property="MACHUNGTU">
        YY.MATONGHOP = '$MACHUNGTU$'
      </isNotEmpty>
      ) PR ON CT.MACHUNGTU=PR.MACHUNGTU AND CTCT.CHUNGTUCHITIET_ID=PR.CHUNGTUCHITIET_ID
      LEFT JOIN (
      SELECT XX.MACHUNGTU AS MACHUNGTUPO,XX.STATE_CODE AS MATRANGTHAIPO,YY.MATONGHOP AS MACHUNGTUPR, YY.CHUNGTUTONGHOP_ID AS CHUNGTUCHITIET_IDPR,
      (CASE WHEN XX.STATE_CODE='1' THEN'Tạo mới' ELSE CASE WHEN XX.STATE_CODE='2' THEN 'Gởi duyệt' ELSE CASE WHEN XX.STATE_CODE='4' THEN 'đã từ chối' ELSE 'Đã duyệt' END END END) AS TENTRANGTHAIPO
      FROM TT_PUR_CHUNGTU XX INNER JOIN TT_PUR_CHUNGTUCHITIET YY ON XX.CHUNGTU_ID=YY.CHUNGTU_ID
      INNER JOIN TT_PUR_CHUNGTU ZZ ON YY.MATONGHOP=ZZ.MACHUNGTU INNER JOIN TT_PUR_CHUNGTUCHITIET ZZ1 ON ZZ.CHUNGTU_ID=ZZ1.CHUNGTU_ID AND ZZ1.CHUNGTUCHITIET_ID=YY.CHUNGTUTONGHOP_ID
      WHERE XX.PROCESS_CODE='PO' AND XX.BENHVIEN_ID = '$BENHVIEN_ID$'
      <isNotEmpty prepend="AND" property="MACHUNGTU">
        ZZ1.MATONGHOP = '$MACHUNGTU$'
      </isNotEmpty>
      ) PO ON PR.MACHUNGTUPR=PO.MACHUNGTUPR AND PR.CHUNGTUCHITIET_IDPR=PO.CHUNGTUCHITIET_IDPR
      where CT.BENHVIEN_ID = '$BENHVIEN_ID$'
      <isNotEmpty prepend="AND" property="MACHUNGTU">
        CT.MACHUNGTU = '$MACHUNGTU$'
      </isNotEmpty>
      <isNotEmpty prepend="AND" property="PROCESS_CODE">
        CT.PROCESS_CODE = '$PROCESS_CODE$' 
      </isNotEmpty>
      <isNotEmpty prepend="AND" property="PHONGBAN_ID">
        CT.PHONGBAN_ID='$PHONGBAN_ID$'
      </isNotEmpty>
      <isNotEmpty prepend="AND" property="TUNGAY">
        CT.NGAYLAPCHUNGTU BETWEEN '$TUNGAY$' AND '$DENNGAY$' 
      </isNotEmpty>
      ORDER BY TENHANGHOA
    </statement>
    <statement id="DAO00400_PUR001_GetChungTuChiTiet_ChungTuID" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
      select CTCT.CHUNGTUCHITIET_ID,CTCT.CHUNGTU_ID,CTCT.HANGHOA_ID,CTCT.MAHANGHOA,CTCT.TENHANGHOA,CTCT.DONVITINH_ID,CTCT.TENDONVITINH,CTCT.LOAI_ID,CTCT.TENLOAI,SOLUONGYEUCAU,CTCT.MOTA,
      CTCT.THUONGHIEU,CTCT.KICHTHUOC,CTCT.VATLIEU,CTCT.GHICHU,CTCT.FILE_NAME,CTCT.FULLPATHSERVER,CTCT.FULLPATHLOCAL,CTCT.SIZE,CTCT.FILE_NAME_PO,CTCT.FULLPATHSERVER_PO,CTCT.FULLPATHLOCAL_PO,CTCT.SIZE_PO,CTCT.STATE_CODE AS CT_STATE_CODE,CTCT.STATE_NAME AS CT_STATE_NAME,CTCT.NGUOIDUYET_ID AS CT_NGUOIDUYET_ID,CTCT.TENNGUOIDUYET AS CT_TENNGUOIDUYET,CTCT.NGAYGIODUYET AS CT_NGAYGIODUYET,
      CTCT.MACHONGIA,CTCT.TENCHONGIA,CTCT.DONGIA,CTCT.TYLEVAT,CTCT.GIATRIVAT,CTCT.DONGIASAUVAT,CTCT.THANHTIEN,CTCT.NHACUNGCAP_ID AS CT_NHACUNGCAP_ID,CTCT.TENNHACUNGCAP AS CT_TENNHACUNGCAP,CTCT.DONGIAHOPDONG,CTCT.TUNGAYHOPDONG, CTCT.DENNGAYHOPDONG,CTCT.MATONGHOP,
      CTCT.CHUNGTUTONGHOP_ID,CTCT.MALOAIPHIEU,CTCT.BAOHANHTUNGAY,CTCT.BAOHANHDENNGAY,CTCT.TENNGUOITAO,CTCT.TENNGUOICAPNHAT,CTCT.NGAYTAO,CTCT.NGUOITAO_ID,CTCT.NGAYCAPNHAT,CTCT.NGUOICAPNHAT_ID,
      PR.MACHUNGTUPR,(CASE WHEN PR.MATRANGTHAIPR != '1' AND PR.MATRANGTHAIPR != '2' THEN NVL(CT.TENNGUOIDUYETCAP3,NVL(CT.TENNGUOIDUYETCAP2,CT.TENNGUOIDUYETCAP1))+' '+PR.TENTRANGTHAIPR ELSE PR.TENTRANGTHAIPR END) AS TENTRANGTHAIPR,PO.MACHUNGTUPO,
      (CASE WHEN PO.MATRANGTHAIPO != '1' AND PO.MATRANGTHAIPO != '2' THEN NVL(CT.TENNGUOIDUYETCAP3,NVL(CT.TENNGUOIDUYETCAP2,CT.TENNGUOIDUYETCAP1))+' '+PO.TENTRANGTHAIPO ELSE PO.TENTRANGTHAIPO END) AS TENTRANGTHAIPO
      FROM TT_PUR_CHUNGTU CT INNER JOIN TT_PUR_CHUNGTUCHITIET CTCT ON CT.CHUNGTU_ID = CTCT.CHUNGTU_ID
      LEFT JOIN (
      SELECT XX.MACHUNGTU AS MACHUNGTUPR,XX.STATE_CODE AS MATRANGTHAIPR,YY.MATONGHOP AS MACHUNGTU,YY.CHUNGTUTONGHOP_ID AS CHUNGTUCHITIET_ID,YY.CHUNGTUCHITIET_ID AS CHUNGTUCHITIET_IDPR,
      (CASE WHEN XX.STATE_CODE='1' THEN'Tạo mới' ELSE CASE WHEN XX.STATE_CODE='2' THEN 'Gởi duyệt' ELSE CASE WHEN XX.STATE_CODE='4' THEN 'đã từ chối' ELSE 'Đã duyệt' END END END) AS TENTRANGTHAIPR
      FROM TT_PUR_CHUNGTU XX INNER JOIN TT_PUR_CHUNGTUCHITIET YY ON XX.CHUNGTU_ID=YY.CHUNGTU_ID
      WHERE XX.PROCESS_CODE='PR' AND XX.BENHVIEN_ID = '$BENHVIEN_ID$'
      <isNotEmpty prepend="AND" property="MACHUNGTU">
        YY.MATONGHOP = '$MACHUNGTU$'
      </isNotEmpty>
      ) PR ON CT.MACHUNGTU=PR.MACHUNGTU AND CTCT.CHUNGTUCHITIET_ID=PR.CHUNGTUCHITIET_ID
      LEFT JOIN (
      SELECT XX.MACHUNGTU AS MACHUNGTUPO,XX.STATE_CODE AS MATRANGTHAIPO,YY.MATONGHOP AS MACHUNGTUPR, YY.CHUNGTUTONGHOP_ID AS CHUNGTUCHITIET_IDPR,
      (CASE WHEN XX.STATE_CODE='1' THEN'Tạo mới' ELSE CASE WHEN XX.STATE_CODE='2' THEN 'Gởi duyệt' ELSE CASE WHEN XX.STATE_CODE='4' THEN 'đã từ chối' ELSE 'Đã duyệt' END END END) AS TENTRANGTHAIPO
      FROM TT_PUR_CHUNGTU XX INNER JOIN TT_PUR_CHUNGTUCHITIET YY ON XX.CHUNGTU_ID=YY.CHUNGTU_ID
      INNER JOIN TT_PUR_CHUNGTU ZZ ON YY.MATONGHOP=ZZ.MACHUNGTU INNER JOIN TT_PUR_CHUNGTUCHITIET ZZ1 ON ZZ.CHUNGTU_ID=ZZ1.CHUNGTU_ID AND ZZ1.CHUNGTUCHITIET_ID=YY.CHUNGTUTONGHOP_ID
      WHERE XX.PROCESS_CODE='PO' AND XX.BENHVIEN_ID = '$BENHVIEN_ID$'
      <isNotEmpty prepend="AND" property="MACHUNGTU">
        ZZ1.MATONGHOP = '$MACHUNGTU$'
      </isNotEmpty>
      ) PO ON PR.MACHUNGTUPR=PO.MACHUNGTUPR AND PR.CHUNGTUCHITIET_IDPR=PO.CHUNGTUCHITIET_IDPR
      where CTCT.BENHVIEN_ID = '$BENHVIEN_ID$' AND CTCT.CHUNGTU_ID = '$CHUNGTU_ID$'
      ORDER BY TENHANGHOA
    </statement>
    <statement id="DAO00400_PUR001_GetChungTuChiTiet_ID" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
      select CTCT.CHUNGTUCHITIET_ID,CTCT.CHUNGTU_ID,CTCT.HANGHOA_ID,CTCT.MAHANGHOA,CTCT.TENHANGHOA,CTCT.DONVITINH_ID,CTCT.TENDONVITINH,CTCT.LOAI_ID,CTCT.TENLOAI,SOLUONGYEUCAU,CTCT.MOTA,
      CTCT.THUONGHIEU,CTCT.KICHTHUOC,CTCT.VATLIEU,CTCT.GHICHU AS CT_GHICHU,CTCT.FILE_NAME,CTCT.FULLPATHSERVER,CTCT.FULLPATHLOCAL,CTCT.SIZE,CTCT.FILE_NAME_PO,CTCT.FULLPATHSERVER_PO,CTCT.FULLPATHLOCAL_PO,CTCT.SIZE_PO,CTCT.STATE_CODE AS CT_STATE_CODE,CTCT.STATE_NAME AS CT_STATE_NAME,CTCT.NGUOIDUYET_ID AS CT_NGUOIDUYET_ID,CTCT.TENNGUOIDUYET AS CT_TENNGUOIDUYET,CTCT.NGAYGIODUYET AS CT_NGAYGIODUYET,
      CTCT.MACHONGIA,CTCT.TENCHONGIA,CTCT.DONGIA,CTCT.TYLEVAT,CTCT.GIATRIVAT,CTCT.DONGIASAUVAT,CTCT.THANHTIEN,CTCT.NHACUNGCAP_ID AS CT_NHACUNGCAP_ID,CTCT.TENNHACUNGCAP AS CT_TENNHACUNGCAP,CTCT.DONGIAHOPDONG,CTCT.TUNGAYHOPDONG, CTCT.DENNGAYHOPDONG,CTCT.MATONGHOP,
      CTCT.CHUNGTUTONGHOP_ID,CTCT.MALOAIPHIEU,CTCT.BAOHANHTUNGAY,CTCT.BAOHANHDENNGAY,CTCT.TENNGUOITAO,CTCT.TENNGUOICAPNHAT,CTCT.NGAYTAO,CTCT.NGUOITAO_ID,CTCT.NGAYCAPNHAT,CTCT.NGUOICAPNHAT_ID
      from TT_PUR_CHUNGTUCHITIET CTCT
      where CTCT.BENHVIEN_ID = '$BENHVIEN_ID$' AND CTCT.CHUNGTUCHITIET_ID = '$CHUNGTUCHITIET_ID$'
    </statement>
    <statement id="DAO00400_PUR001_ChungTuSearchP01_Ngay" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
      select 0 AS CHON,CT.CHUNGTU_ID,CT.MACHUNGTU,FORMAT(CT.NGAYLAPCHUNGTU, 'dd/MM/yyyy HH:mm:ss') AS GROUPNGAYLAPCHUNGTU,CT.NGAYLAPCHUNGTU,CT.NGAYGIOLAPCHUNGTU,CT.PROCESS_CODE,CT.PROCESS_NAME,CT.STATE_CODE,CT.STATE_NAME,CT.PHONGBAN_ID,
      CT.TENPHONGBAN,CT.NGUOIDUYETCAP1_ID,CT.TENNGUOIDUYETCAP1,CT.NGAYGIODUYETCAP1,CT.NGUOIDUYETCAP2_ID,CT.TENNGUOIDUYETCAP2,CT.NGAYGIODUYETCAP2,CT.NGUOIDUYETCAP3_ID,CT.TENNGUOIDUYETCAP3,CT.NGAYGIODUYETCAP3,CT.CAPDUYET
      ,CT.THOIGIANGIAOHANG,CT.NHACUNGCAP_ID,CT.TENNHACUNGCAP,CT.HINHTHUCGIAOHANG,CT.HINHTHUCTHANHTOAN,CT.TONGTIEN,CT.GHICHU,CT.TIEUDE,CT.DIENGIAI,CT.NGANSACH,CT.GIATRITHEONGANSACH,CT.GIATRIDASUDUNG,CT.GIATRICONLAI,CT.TENNGUOITAO,CT.TENNGUOICAPNHAT,CT.NGUOIPHANCONG_ID,CT.TENNGUOIPHANCONG,CT.NGAYPHANCONG,CT.NGAYCHAPNHAN,CT.BENHVIEN_ID,CT.NGAYTAO,CT.NGUOITAO_ID,CT.NGAYCAPNHAT,CT.NGUOICAPNHAT_ID,
      (CASE WHEN CTCT.STATE_CODE='5' THEN 'Đã duyệt bởi '+CT.TENNGUOIDUYETCAP1 ELSE CASE WHEN CTCT.STATE_CODE='6' THEN 'Đã từ chối bởi '+CT.TENNGUOIDUYETCAP1 ELSE CASE WHEN CTCT.STATE_CODE='7' THEN 'Đã lập phiếu PR' ELSE 'Chờ duyệt' END END END) AS TRANGTHAI,
      CTCT.CHUNGTUCHITIET_ID,CTCT.HANGHOA_ID,CTCT.MAHANGHOA,CTCT.TENHANGHOA,CTCT.DONVITINH_ID,CTCT.TENDONVITINH,CTCT.LOAI_ID,CTCT.TENLOAI,SOLUONGYEUCAU,CTCT.MOTA,
      CTCT.THUONGHIEU,CTCT.KICHTHUOC,CTCT.VATLIEU,CTCT.GHICHU AS CT_GHICHU,CTCT.FILE_NAME,CTCT.FULLPATHSERVER,CTCT.FULLPATHLOCAL,CTCT.SIZE,CTCT.STATE_CODE AS CT_STATE_CODE,CTCT.STATE_NAME AS CT_STATE_NAME,CTCT.NGUOIDUYET_ID AS CT_NGUOIDUYET_ID,CTCT.TENNGUOIDUYET AS CT_TENNGUOIDUYET,CTCT.NGAYGIODUYET AS CT_NGAYGIODUYET,
      CTCT.DIENGIAI AS CT_DIENGIAI,CTCT.MACHONGIA,CTCT.TENCHONGIA,CTCT.DONGIA,CTCT.TYLEVAT,CTCT.GIATRIVAT,DONGIASAUVAT,CTCT.THANHTIEN,CTCT.NHACUNGCAP_ID AS CT_NHACUNGCAP_ID,CTCT.TENNHACUNGCAP AS CT_TENNHACUNGCAP,CTCT.DONGIAHOPDONG,CTCT.TUNGAYHOPDONG, CTCT.DENNGAYHOPDONG,CTCT.MATONGHOP,
      CTCT.CHUNGTUTONGHOP_ID,CTCT.MALOAIPHIEU,CTCT.BAOHANHTUNGAY,CTCT.BAOHANHDENNGAY,CTCT.TENNGUOITAO AS CT_TENNGUOITAO,CTCT.TENNGUOICAPNHAT AS CT_TENNGUOICAPNHAT,CTCT.NGAYTAO AS CT_NGAYTAO,CTCT.NGUOITAO_ID AS CT_NGUOITAO_ID,CTCT.NGAYCAPNHAT AS CT_NGAYCAPNHAT,CTCT.NGUOICAPNHAT_ID AS CT_NGUOICAPNHAT_ID
      from TT_PUR_CHUNGTU CT INNER JOIN TT_PUR_CHUNGTUCHITIET CTCT ON CT.CHUNGTU_ID = CTCT.CHUNGTU_ID
      <!--LEFT JOIN (
      SELECT DISTINCT M1.USER_ID,NV1.TENNHANVIEN FROM TT_PUR_CHUNGTUCHITIET CT1 JOIN TM_NHANVIEN_USER_MAPPING M1 ON M1.USER_ID = CT1.NGUOIDUYET_ID INNER JOIN TM_NHANVIEN NV1 ON M1.NHANVIEN_ID = NV1.NHANVIEN_ID
      ) DUYET1 ON CTCT.NGUOIDUYET_ID = DUYET1.USER_ID-->
      where CT.BENHVIEN_ID = '$BENHVIEN_ID$' AND CT.MALOAIPHIEU='$MALOAIPHIEU$' AND CTCT.LOAI_ID='$LOAI_ID$' AND CT.NGAYLAPCHUNGTU BETWEEN '$TUNGAY$' AND '$DENNGAY$'
      <isNotEmpty prepend="AND" property="PROCESS_CODE">
        CT.PROCESS_CODE='$PROCESS_CODE$'
      </isNotEmpty>
      <isNotEmpty prepend="AND" property="STATE_CODE">
        CT.STATE_CODE='$STATE_CODE$'
      </isNotEmpty>
      ORDER BY NGAYLAPCHUNGTU
    </statement>
    <statement id="DAO00400_PUR001_ChungTuSearchP01_LoaiNhomHang" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
      select 0 AS CHON,CT.CHUNGTU_ID,CT.MACHUNGTU,FORMAT(CT.NGAYLAPCHUNGTU, 'dd/MM/yyyy HH:mm:ss') AS GROUPNGAYLAPCHUNGTU,CT.NGAYLAPCHUNGTU,CT.NGAYGIOLAPCHUNGTU,CT.PROCESS_CODE,CT.PROCESS_NAME,CT.STATE_CODE,CT.STATE_NAME,CT.PHONGBAN_ID,
      CT.TENPHONGBAN,CT.NGUOIDUYETCAP1_ID,CT.TENNGUOIDUYETCAP1,CT.NGAYGIODUYETCAP1,CT.NGUOIDUYETCAP2_ID,CT.TENNGUOIDUYETCAP2,CT.NGAYGIODUYETCAP2,CT.NGUOIDUYETCAP3_ID,CT.TENNGUOIDUYETCAP3,CT.NGAYGIODUYETCAP3,CT.CAPDUYET
      ,CT.THOIGIANGIAOHANG,CT.NHACUNGCAP_ID,CT.TENNHACUNGCAP,CT.HINHTHUCGIAOHANG,CT.HINHTHUCTHANHTOAN,CT.TONGTIEN,CT.GHICHU,CT.TIEUDE,CT.DIENGIAI,CT.NGANSACH,CT.GIATRITHEONGANSACH,CT.GIATRIDASUDUNG,CT.GIATRICONLAI,CT.TENNGUOITAO,CT.TENNGUOICAPNHAT,CT.NGUOIPHANCONG_ID,CT.TENNGUOIPHANCONG,CT.NGAYPHANCONG,CT.NGAYCHAPNHAN,CT.BENHVIEN_ID,CT.NGAYTAO,CT.NGUOITAO_ID,CT.NGAYCAPNHAT,CT.NGUOICAPNHAT_ID,
      (CASE WHEN CTCT.STATE_CODE='5' THEN 'Đã duyệt bởi '+CT.TENNGUOIDUYETCAP1 ELSE CASE WHEN CTCT.STATE_CODE='6' THEN 'Đã từ chối bởi '+CT.TENNGUOIDUYETCAP1 ELSE CASE WHEN CTCT.STATE_CODE='7' THEN 'Đã lập phiếu PR' ELSE 'Chờ duyệt' END END END) AS TRANGTHAI,
      CTCT.CHUNGTUCHITIET_ID,CTCT.HANGHOA_ID,CTCT.MAHANGHOA,CTCT.TENHANGHOA,CTCT.DONVITINH_ID,CTCT.TENDONVITINH,CTCT.LOAI_ID,CTCT.TENLOAI,SOLUONGYEUCAU,CTCT.MOTA,
      CTCT.THUONGHIEU,CTCT.KICHTHUOC,CTCT.VATLIEU,CTCT.GHICHU AS CT_GHICHU,CTCT.FILE_NAME,CTCT.FULLPATHSERVER,CTCT.FULLPATHLOCAL,CTCT.SIZE,CTCT.STATE_CODE AS CT_STATE_CODE,CTCT.STATE_NAME AS CT_STATE_NAME,CTCT.NGUOIDUYET_ID AS CT_NGUOIDUYET_ID,CTCT.TENNGUOIDUYET AS CT_TENNGUOIDUYET,CTCT.NGAYGIODUYET AS CT_NGAYGIODUYET,
      CTCT.DIENGIAI AS CT_DIENGIAI,CTCT.MACHONGIA,CTCT.TENCHONGIA,CTCT.DONGIA,CTCT.TYLEVAT,CTCT.GIATRIVAT,DONGIASAUVAT,CTCT.THANHTIEN,CTCT.NHACUNGCAP_ID AS CT_NHACUNGCAP_ID,CTCT.TENNHACUNGCAP AS CT_TENNHACUNGCAP,CTCT.DONGIAHOPDONG,CTCT.TUNGAYHOPDONG, CTCT.DENNGAYHOPDONG,CTCT.MATONGHOP,
      CTCT.CHUNGTUTONGHOP_ID,CTCT.MALOAIPHIEU,CTCT.BAOHANHTUNGAY,CTCT.BAOHANHDENNGAY,CTCT.TENNGUOITAO AS CT_TENNGUOITAO,CTCT.TENNGUOICAPNHAT AS CT_TENNGUOICAPNHAT,CTCT.NGAYTAO AS CT_NGAYTAO,CTCT.NGUOITAO_ID AS CT_NGUOITAO_ID,CTCT.NGAYCAPNHAT AS CT_NGAYCAPNHAT,CTCT.NGUOICAPNHAT_ID AS CT_NGUOICAPNHAT_ID
      from TT_PUR_CHUNGTU CT INNER JOIN TT_PUR_CHUNGTUCHITIET CTCT ON CT.CHUNGTU_ID = CTCT.CHUNGTU_ID
      <!--LEFT JOIN (
      SELECT DISTINCT M1.USER_ID,NV1.TENNHANVIEN FROM TT_PUR_CHUNGTUCHITIET CT1 JOIN TM_NHANVIEN_USER_MAPPING M1 ON M1.USER_ID = CT1.NGUOIDUYET_ID INNER JOIN TM_NHANVIEN NV1 ON M1.NHANVIEN_ID = NV1.NHANVIEN_ID
      ) DUYET1 ON CTCT.NGUOIDUYET_ID = DUYET1.USER_ID-->
      where CT.BENHVIEN_ID = '$BENHVIEN_ID$' AND CTCT.LOAI_ID='$LOAI_ID$'
      <isNotEmpty prepend="AND" property="MALOAIPHIEU">
        CT.MALOAIPHIEU='$MALOAIPHIEU$'
      </isNotEmpty>
      <isNotEmpty prepend="AND" property="PROCESS_CODE">
        CT.PROCESS_CODE='$PROCESS_CODE$'
      </isNotEmpty>
      <isNotEmpty prepend="AND" property="CT_STATE_CODE">
        CTCT.STATE_CODE='$CT_STATE_CODE$'
      </isNotEmpty>
      <isNotEmpty prepend="AND" property="TUNGAY">
        CT.NGAYLAPCHUNGTU BETWEEN '$TUNGAY$' AND '$DENNGAY$'
      </isNotEmpty>
      <isNotEmpty prepend="AND" property="MACHUNGTU">
        CT.MACHUNGTU LIKE '%$MACHUNGTU$%'
      </isNotEmpty>
      ORDER BY NGAYLAPCHUNGTU
    </statement>
    <statement id="DAO00400_PUR001_GetStatecodeCTCT" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
      select CT.STATE_CODE, CTCT.STATE_CODE AS CT_STATE_CODE FROM TT_PUR_CHUNGTU CT INNER JOIN TT_PUR_CHUNGTUCHITIET CTCT ON CT.CHUNGTU_ID=CTCT.CHUNGTU_ID
      where CTCT.BENHVIEN_ID = '$BENHVIEN_ID$' AND CT.BENHVIEN_ID = '$BENHVIEN_ID$' AND CTCT.CHUNGTUCHITIET_ID IN ($LISTCHUNGTUCHITIET_ID$)
    </statement>
    <statement id="DAO00400_PUR001_ChungTuSearchP01_Loai" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
      select 0 AS CHON,CT.CHUNGTU_ID,CT.MACHUNGTU,FORMAT(CT.NGAYLAPCHUNGTU, 'dd/MM/yyyy HH:mm:ss') AS GROUPNGAYLAPCHUNGTU,CT.NGAYLAPCHUNGTU,CT.NGAYGIOLAPCHUNGTU,CT.PROCESS_CODE,CT.PROCESS_NAME,CT.STATE_CODE,CT.STATE_NAME,CT.PHONGBAN_ID,
      CT.TENPHONGBAN,CT.NGUOIDUYETCAP1_ID,CT.TENNGUOIDUYETCAP1,CT.NGAYGIODUYETCAP1,CT.NGUOIDUYETCAP2_ID,CT.TENNGUOIDUYETCAP2,CT.NGAYGIODUYETCAP2,CT.NGUOIDUYETCAP3_ID,CT.TENNGUOIDUYETCAP3,CT.NGAYGIODUYETCAP3,CT.CAPDUYET
      ,CT.THOIGIANGIAOHANG,CT.NHACUNGCAP_ID,CT.TENNHACUNGCAP,CT.HINHTHUCGIAOHANG,CT.HINHTHUCTHANHTOAN,CT.TONGTIEN,CT.GHICHU,CT.TIEUDE,CT.DIENGIAI,CT.NGANSACH,CT.GIATRITHEONGANSACH,CT.GIATRIDASUDUNG,CT.GIATRICONLAI,CT.TENNGUOITAO,CT.TENNGUOICAPNHAT,CT.NGUOIPHANCONG_ID,CT.TENNGUOIPHANCONG,CT.NGAYPHANCONG,CT.NGAYCHAPNHAN,CT.BENHVIEN_ID,CT.NGAYTAO,CT.NGUOITAO_ID,CT.NGAYCAPNHAT,CT.NGUOICAPNHAT_ID,
      (CASE WHEN CTCT.STATE_CODE='5' THEN 'Đã duyệt bởi '+CT.TENNGUOIDUYETCAP1 ELSE CASE WHEN CTCT.STATE_CODE='6' THEN 'Đã từ chối bởi '+CT.TENNGUOIDUYETCAP1 ELSE CASE WHEN CTCT.STATE_CODE='7' THEN 'Đã lập phiếu PR' ELSE 'Chờ duyệt' END END END) AS TRANGTHAI,
      CTCT.CHUNGTUCHITIET_ID,CTCT.HANGHOA_ID,CTCT.MAHANGHOA,CTCT.TENHANGHOA,CTCT.DONVITINH_ID,CTCT.TENDONVITINH,CTCT.LOAI_ID,CTCT.TENLOAI,SOLUONGYEUCAU,CTCT.MOTA,
      CTCT.THUONGHIEU,CTCT.KICHTHUOC,CTCT.VATLIEU,CTCT.GHICHU AS CT_GHICHU,CTCT.FILE_NAME,CTCT.FULLPATHSERVER,CTCT.FULLPATHLOCAL,CTCT.SIZE,CTCT.STATE_CODE AS CT_STATE_CODE,CTCT.STATE_NAME AS CT_STATE_NAME,CTCT.NGUOIDUYET_ID AS CT_NGUOIDUYET_ID,CTCT.TENNGUOIDUYET AS CT_TENNGUOIDUYET,CTCT.NGAYGIODUYET AS CT_NGAYGIODUYET,
      CTCT.DIENGIAI AS CT_DIENGIAI,CTCT.MACHONGIA,CTCT.TENCHONGIA,CTCT.DONGIA,CTCT.TYLEVAT,CTCT.GIATRIVAT,DONGIASAUVAT,CTCT.THANHTIEN,CTCT.NHACUNGCAP_ID AS CT_NHACUNGCAP_ID,CTCT.TENNHACUNGCAP AS CT_TENNHACUNGCAP,CTCT.DONGIAHOPDONG,CTCT.TUNGAYHOPDONG, CTCT.DENNGAYHOPDONG,CTCT.MATONGHOP,
      CTCT.CHUNGTUTONGHOP_ID,CTCT.MALOAIPHIEU,CTCT.BAOHANHTUNGAY,CTCT.BAOHANHDENNGAY,CTCT.TENNGUOITAO AS CT_TENNGUOITAO,CTCT.TENNGUOICAPNHAT AS CT_TENNGUOICAPNHAT,CTCT.NGAYTAO AS CT_NGAYTAO,CTCT.NGUOITAO_ID AS CT_NGUOITAO_ID,CTCT.NGAYCAPNHAT AS CT_NGAYCAPNHAT,CTCT.NGUOICAPNHAT_ID AS CT_NGUOICAPNHAT_ID
      from TT_PUR_CHUNGTU CT INNER JOIN TT_PUR_CHUNGTUCHITIET CTCT ON CT.CHUNGTU_ID = CTCT.CHUNGTU_ID
      <!--LEFT JOIN (
      SELECT DISTINCT M1.USER_ID,NV1.TENNHANVIEN FROM TT_PUR_CHUNGTUCHITIET CT1 JOIN TM_NHANVIEN_USER_MAPPING M1 ON M1.USER_ID = CT1.NGUOIDUYET_ID INNER JOIN TM_NHANVIEN NV1 ON M1.NHANVIEN_ID = NV1.NHANVIEN_ID
      ) DUYET1 ON CTCT.NGUOIDUYET_ID = DUYET1.USER_ID-->
      where CT.BENHVIEN_ID = '$BENHVIEN_ID$' AND CT.MALOAIPHIEU='$MALOAIPHIEU$' AND CTCT.LOAI_ID='$LOAI_ID$'
      <isNotEmpty prepend="AND" property="PROCESS_CODE">
        CT.PROCESS_CODE='$PROCESS_CODE$'
      </isNotEmpty>
      <isNotEmpty prepend="AND" property="CT_STATE_CODE">
        CTCT.STATE_CODE='$CT_STATE_CODE$'
      </isNotEmpty>
      <isNotEmpty prepend="AND" property="TUNGAY">
        CT.NGAYLAPCHUNGTU BETWEEN '$TUNGAY$' AND '$DENNGAY$'
      </isNotEmpty>
      <isNotEmpty prepend="AND" property="MACHUNGTU">
        CT.MACHUNGTU LIKE '%$MACHUNGTU$%'
      </isNotEmpty>
      ORDER BY NGAYLAPCHUNGTU
    </statement>
    <statement id="DAO00400_PUR001_GetTrangThai_EX" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
      select BB.NEXT_STATE_CODE AS STATE_CODE,AA.NAME AS STATE_NAME
      from TM_PUR_STATE AA INNER JOIN TM_PUR_STATE_ACTION BB ON AA.PROCESS_CODE = BB.PROCESS_CODE AND AA.STATE_CODE = BB.NEXT_STATE_CODE
      where AA.BENHVIEN_ID = '$BENHVIEN_ID$' AND AA.ACTIVE=1
      <isNotEmpty prepend="AND" property="PROCESS_CODE">
        AA.PROCESS_CODE='$PROCESS_CODE$'
      </isNotEmpty>
      <isNotEmpty prepend="AND" property="CURR_STATE_CODE">
        BB.CURR_STATE_CODE='$CURR_STATE_CODE$'
      </isNotEmpty>
      ORDER BY BB.ORDER_ID
    </statement>
    <update id="DAO00400_PUR001_UpdTrangThaiChungTuChiTietDuyet" parameterClass="DataObject">
      UPDATE TT_PUR_CHUNGTUCHITIET
      SET STATE_CODE = #CT_STATE_CODE#
      ,STATE_NAME = #CT_STATE_NAME#
      ,NGUOIDUYET_ID = #CT_NGUOIDUYET_ID#
      ,TENNGUOIDUYET = #CT_TENNGUOIDUYET#
      ,NGAYGIODUYET = SYSDATE
      ,DIENGIAI = #CT_DIENGIAI#
      ,NGAYCAPNHAT = SYSDATE
      ,NGUOICAPNHAT_ID = #CT_NGUOIDUYET_ID#
      ,TENNGUOICAPNHAT = #CT_TENNGUOIDUYET#
      WHERE CHUNGTUCHITIET_ID = '$CHUNGTUCHITIET_ID$' AND BENHVIEN_ID = '$BENHVIEN_ID$'
    </update>
    <statement id="DAO00400_PUR001_KiemTraMaChungTuTonTai" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
      select CT.STATE_CODE from TT_PUR_CHUNGTU CT
      where CT.MACHUNGTU = '$MACHUNGTU$' AND CT.BENHVIEN_ID = '$BENHVIEN_ID$'
    </statement>
    <statement id="DAO00400_PUR001_GetPhieuTongHopRQ" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
      select NULL AS CHUNGTU_ID,NULL AS MACHUNGTU,NULL AS NGAYLAPCHUNGTU,NULL AS NGAYGIOLAPCHUNGTU,NULL AS PROCESS_CODE,NULL AS PROCESS_NAME,NULL AS STATE_CODE,NULL AS STATE_NAME,NULL AS PHONGBAN_ID,
      NULL AS TENPHONGBAN,NULL AS NGUOIDUYETCAP1_ID,NULL AS TENNGUOIDUYETCAP1,NULL AS NGAYGIODUYETCAP1,NULL AS THOIGIANGIAOHANG,NULL AS NHACUNGCAP_ID,NULL AS TENNHACUNGCAP,NULL AS HINHTHUCGIAOHANG,
      CT.HINHTHUCTHANHTOAN,CT.TONGTIEN,CT.GHICHU,NULL AS TIEUDE,NULL AS DIENGIAI,CT.NGANSACH,CT.GIATRITHEONGANSACH,CT.GIATRIDASUDUNG,CT.GIATRICONLAI,CT.THANHTOAN1,CT.THANHTOAN2,CT.THANHTOAN3,CT.THANHTOAN4,CT.THANHTOAN5,CT.THANHTOAN6,
      CT.MALOAIPHIEU,(CASE WHEN CT.MALOAIPHIEU='DP' THEN 'Dược phẩm' ELSE CT.TENLOAIPHIEU END) AS TENLOAIPHIEU,NULL AS TENNGUOITAO,NULL AS TENNGUOICAPNHAT,CT.BENHVIEN_ID,NULL AS NGAYTAO,NULL AS NGUOITAO_ID,NULL AS NGAYCAPNHAT,NULL AS NGUOICAPNHAT_ID,'' AS TRANGTHAI,
      NULL AS CHUNGTUCHITIET_ID,CTCT.HANGHOA_ID,CTCT.MAHANGHOA,CTCT.TENHANGHOA,CTCT.DONVITINH_ID,CTCT.TENDONVITINH,CTCT.LOAI_ID,CTCT.TENLOAI,
      CTCT.SOLUONGYEUCAU,CTCT.SOLUONGYEUCAU AS SOLUONGPR,CTTH.SOLUONGYEUCAU AS SOLUONGYEUCAUBANDAU,CTCT.MOTA,
      CTCT.THUONGHIEU,CTCT.KICHTHUOC,CTCT.VATLIEU,CTCT.GHICHU AS CT_GHICHU,CTCT.FILE_NAME,CTCT.FULLPATHSERVER,CTCT.FULLPATHLOCAL,CTCT.SIZE,NULL AS CT_STATE_CODE,NULL AS CT_STATE_NAME,NULL AS CT_NGUOIDUYET_ID,NULL AS CT_TENNGUOIDUYET,NULL AS CT_NGAYGIODUYET,
      CTCT.DIENGIAI AS CT_DIENGIAI,CTCT.MACHONGIA,CTCT.TENCHONGIA,CTCT.DONGIA,CTCT.TYLEVAT,CTCT.GIATRIVAT,CTCT.DONGIASAUVAT,CTCT.THANHTIEN,NULL AS CT_NHACUNGCAP_ID,NULL AS CT_TENNHACUNGCAP,NULL AS DONGIAHOPDONG, NULL AS TUNGAYHOPDONG, NULL AS DENNGAYHOPDONG,CT.MACHUNGTU AS MATONGHOP,
      CTCT.CHUNGTUCHITIET_ID AS CHUNGTUTONGHOP_ID,CTCT.BAOHANHTUNGAY,CTCT.BAOHANHDENNGAY,NULL AS CT_TENNGUOITAO,NULL AS CT_TENNGUOICAPNHAT,NULL AS CT_NGAYTAO,CTCT.NGUOITAO_ID AS CT_NGUOITAO_ID,CTCT.NGAYCAPNHAT AS CT_NGAYCAPNHAT,CTCT.NGUOICAPNHAT_ID AS CT_NGUOICAPNHAT_ID,
      HH.NHACUNGCAP_ID AS DMNHACUNGCAP_ID,HH.TENNHACUNGCAP AS DMTENNHACUNGCAP,HH.GIAHOPDONG AS DMDONGIAHOPDONG,HH.TUNGAY AS DMTUNGAYHOPDONG, HH.DENNGAY AS DMDENNGAYHOPDONG,HH.DONGIA AS DMDONGIA
      from TT_PUR_CHUNGTU CT INNER JOIN TT_PUR_CHUNGTUCHITIET CTCT ON CT.CHUNGTU_ID = CTCT.CHUNGTU_ID
      INNER JOIN (
      SELECT ID AS HANGHOA_ID,MA AS MAHANGHOA,TEN AS TENHANGHOA,NHACUNGCAP_ID,TENNHACUNGCAP,GIAHOPDONG,TUNGAY, DENNGAY,'VPP' AS LOAIDM,DONGIA FROM TM_PUR_HANGHOA UNION ALL
      SELECT HANGHOA_ID,MAHANGHOA,TENHANGHOA,NULL AS NHACUNGCAP_ID,NULL AS TENNHACUNGCAP,NULL AS GIAHOPDONG,NULL AS TUNGAY,NULL AS DENNGAY,LOAIDM,DONGIA FROM VIEW_DANHMUCTAISAN UNION ALL
      SELECT DUOC_ID AS HANGHOA_ID,MADUOC AS MAHANGHOA,TENDUOCDAYDU AS TENHANGHOA,NULL AS NHACUNGCAP_ID,NULL AS TENNHACUNGCAP,NULL AS GIAHOPDONG,NULL AS TUNGAY,NULL AS DENNGAY,'DP' AS LOAIDM,0 AS DONGIA FROM TM_DUOC
      ) HH ON CTCT.HANGHOA_ID = HH.HANGHOA_ID
      LEFT JOIN TT_PUR_CHUNGTUCHITIET CTTH ON CTCT.CHUNGTUTONGHOP_ID=CTTH.CHUNGTUCHITIET_ID
      where CT.BENHVIEN_ID = '$BENHVIEN_ID$' AND CTCT.CHUNGTUCHITIET_ID IN ($LISTCHUNGTUCHITIET_ID$)
      ORDER BY TENHANGHOA
    </statement>
    <update id="DAO00400_PUR001_UpdTrangThaiChungTuChiTiet" parameterClass="DataObject">
      UPDATE TT_PUR_CHUNGTUCHITIET
      SET STATE_CODE = #CT_STATE_CODE#
      ,STATE_NAME = #CT_STATE_NAME#
      WHERE CHUNGTUCHITIET_ID = '$CHUNGTUTONGHOP_ID$' AND BENHVIEN_ID = '$BENHVIEN_ID$'
    </update>
  <statement id="DAO00400_PUR001_GetLoaiKetNoi" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
    select LKN.* from TM_PUR_LOAIKETNOI LKN
    where LKN.ACTIVE = 1 AND LKN.BENHVIEN_ID = '$BENHVIEN_ID$'
    ORDER BY LKN.LOAIKETNOI_ID
  </statement>
  <statement id="DAO00400_PUR001_GetCauHinhEmail" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
    select CH.* from TM_PUR_CAUHINHEMAIL CH
    where CH.BENHVIEN_ID = '$BENHVIEN_ID$'
    ORDER BY CH.CAUHINHEMAIL_ID
  </statement>
  <statement id="DAO00400_PUR001_DeleteCauhinhEmail" parameterClass="System.String" resultClass="System.Int32">
    delete from TM_PUR_CAUHINHEMAIL where CAUHINHEMAIL_ID = '$CAUHINHEMAIL_ID$'
  </statement>
  <insert id="DAO00400_PUR001_AddCauHinhEmail" parameterClass="DataObject" resultClass="System.Int64">
    <selectKey property="ID" type="pre" resultClass="System.Int64">
      select TM_PUR_CAUHINHEMAIL_S.nextval as value from dual
    </selectKey>
    INSERT INTO TM_PUR_CAUHINHEMAIL
    (
    CAUHINHEMAIL_ID
    ,TENCAUHINHEMAIL
    ,SMTPSERVER
    ,LOAIKETNOI_ID
    ,TENLOAIKETNOI
    ,PORT
    ,TAIKHOAN
    ,MATKHAU
    ,ENABLESSL
    ,EMAILMACDINH
    ,BENHVIEN_ID
    ,ACTIVE)
    VALUES
    (
    #ID#
    ,#TENCAUHINHEMAIL#
    ,#SMTPSERVER#
    ,#LOAIKETNOI_ID#
    ,#TENLOAIKETNOI#
    ,#PORT#
    ,#TAIKHOAN#
    ,#MATKHAU#
    ,#ENABLESSL#
    ,#EMAILMACDINH#
    ,#BENHVIEN_ID#
    ,'1')    
  </insert>
  <update id="DAO00400_PUR001_UpdateCauhinhEmail" parameterClass="DataObject">
    UPDATE TM_PUR_CAUHINHEMAIL
   SET TenCauHinhEMAIL = #TENCAUHINHEMAIL#
      ,SMTPSERVER = #SMTPSERVER#
      ,LOAIKETNOI_ID = #LOAIKETNOI_ID#
      ,TENLOAIKETNOI = #TENLOAIKETNOI#
      ,PORT = #PORT#
      ,TAIKHOAN = #TAIKHOAN#
      ,MATKHAU = #MATKHAU#
      ,ENABLESSL = #ENABLESSL#
      ,EMAILMACDINH = #EMAILMACDINH#
      ,BENHVIEN_ID = #BENHVIEN_ID#
  where CAUHINHEMAIL_ID = '$CAUHINHEMAIL_ID$'
  </update>
    <statement id="DAO00400_PUR001_GetHinhThucGiaoHang" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
      select HTGH.*,HTGH.TENHINHTHUCGIAOHANG AS HINHTHUCGIAOHANG from TM_PUR_HINHTHUCGIAOHANG HTGH
      where HTGH.ACTIVE = 1 AND HTGH.BENHVIEN_ID = '$BENHVIEN_ID$'
      ORDER BY HTGH.TENHINHTHUCGIAOHANG
    </statement>
    <statement id="DAO00400_PUR001_GetHinhThucThanhToan" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
      select HTTT.*,HTTT.TENHINHTHUCTHANHTOAN AS HINHTHUCTHANHTOAN from TM_PUR_HINHTHUCTHANHTOAN HTTT
      where HTTT.ACTIVE = 1 AND HTTT.BENHVIEN_ID = '$BENHVIEN_ID$'
      ORDER BY HTTT.TENHINHTHUCTHANHTOAN
    </statement>
    <statement id="DAO00400_PUR001_GetLoaiPhieuMuaHang" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
      SELECT DICTIONARY_CODE AS MALOAIPHIEU,DICTIONARY_NAME AS TENLOAIPHIEU FROM LST_DICTIONARY WHERE DICTIONARY_TYPE_CODE = 'NhomPhieuMH' AND ENABLED=1
    </statement>
    <statement id="DAO00400_PUR001_GetLoaiPhieuMuaHangPO" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
      SELECT DICTIONARY_CODE AS MALOAIPHIEU,DICTIONARY_NAME AS TENLOAIPHIEU FROM LST_DICTIONARY WHERE DICTIONARY_TYPE_CODE = 'NhomPhieuMH'
    </statement>
  <statement id="DAO00400_PUR001_GIAHOPDONG_GetList" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
    SELECT G.GIAHOPDONG_ID,G.GIAHOPDONG_ID AS CATEGORY_ID, (TO_CHAR(G.NGAYHOPDONG,'DD/MM/YYYY') + ' - ' + NCC.TENNHACUNGCAP) AS TENGIAHOPDONG, 1 AS FOLDER_LEVEL, 0 AS PARENT_ID, '0' AS IS_FOLDER,
    G.NHACUNGCAP_ID, G.TENNHACUNGCAP, G.NGAYHOPDONG,G.TUNGAY,G.DENNGAY,G.MALOAIPHIEU,G.TENLOAIPHIEU
    FROM TM_PUR_GIAHOPDONG  G
    INNER JOIN TM_NHACUNGCAP  NCC ON NCC.NHACUNGCAP_ID = G.NHACUNGCAP_ID AND NCC.BENHVIEN_ID = '$BENHVIEN_ID$'
    WHERE G.BENHVIEN_ID = '$BENHVIEN_ID$'
  </statement>
  <statement id="DAO00400_PUR001_GIAHOPDONGCHITIET_GetList" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
    SELECT GC.GIAHOPDONGCHITIET_ID,G.GIAHOPDONG_ID, GC.HANGHOA_ID, GC.MAHANGHOA, GC.TENHANGHOA, GC.DONVITINH_ID, GC.TENDONVITINH, GC.DONGIA, GC.VAT, GC.GIASAUVAT, GC.SOLUONG, G.NHACUNGCAP_ID, G.TENNHACUNGCAP, G.NGAYHOPDONG,G.TUNGAY,G.DENNGAY,GC.KHONGDUNG
    FROM TM_PUR_GIAHOPDONG  G
    INNER JOIN TM_PUR_GIAHOPDONGCHITIET AS GC ON GC.GIAHOPDONG_ID = G.GIAHOPDONG_ID AND GC.BENHVIEN_ID = '$BENHVIEN_ID$'
    INNER JOIN (
    SELECT ID AS HANGHOA_ID,MA AS MAHANGHOA,TEN AS TENHANGHOA,NHACUNGCAP_ID,TENNHACUNGCAP,GIAHOPDONG,TUNGAY, DENNGAY,'VPP' AS LOAIDM,DONGIA FROM TM_PUR_HANGHOA UNION ALL
    SELECT HANGHOA_ID,MAHANGHOA,TENHANGHOA,NULL AS NHACUNGCAP_ID,NULL AS TENNHACUNGCAP,NULL AS GIAHOPDONG,NULL AS TUNGAY,NULL AS DENNGAY,LOAIDM,DONGIA FROM VIEW_DANHMUCTAISAN
    )  HH ON GC.HANGHOA_ID = HH.HANGHOA_ID AND GC.BENHVIEN_ID = '$BENHVIEN_ID$'
    WHERE G.BENHVIEN_ID = '$BENHVIEN_ID$' AND G.GIAHOPDONG_ID = '$GIAHOPDONG_ID$'
  </statement>
    <insert id="DAO00400_PUR001_AddGiaHopDong" parameterClass="System.Collections.IDictionary" resultClass="System.Int64">
      <selectKey property="ID" type="pre" resultClass="System.Int64">
        select TM_PUR_GIAHOPDONG_S.nextval as value from dual
      </selectKey>
      INSERT INTO TM_PUR_GIAHOPDONG(GIAHOPDONG_ID,NHACUNGCAP_ID,TENNHACUNGCAP,NGAYHOPDONG,TUNGAY,DENNGAY,MALOAIPHIEU,TENLOAIPHIEU,BENHVIEN_ID,NGAYTAO,NGUOITAO_ID)
      VALUES(#ID#,#NHACUNGCAP_ID#,#TENNHACUNGCAP#,#NGAYHOPDONG#,#TUNGAY#,#DENNGAY#,#MALOAIPHIEU#,#TENLOAIPHIEU#,#BENHVIEN_ID#,SYSDATE,#NGUOITAO_ID#)      
    </insert>
    <update id="DAO00400_PUR001_UpdGiaHopDong" parameterClass="DataObject">
      UPDATE TM_PUR_GIAHOPDONG SET NHACUNGCAP_ID = #NHACUNGCAP_ID#,TENNHACUNGCAP = #TENNHACUNGCAP#,NGAYHOPDONG = #NGAYHOPDONG#,TUNGAY = #TUNGAY#,DENNGAY = #DENNGAY#,MALOAIPHIEU = #MALOAIPHIEU#,TENLOAIPHIEU = #TENLOAIPHIEU#,NGAYCAPNHAT = SYSDATE,NGUOICAPNHAT_ID = #NGUOICAPNHAT_ID#
      WHERE GIAHOPDONG_ID = '$GIAHOPDONG_ID$' AND BENHVIEN_ID = '$BENHVIEN_ID$'
    </update>
    <statement id="DAO00400_PUR001_AddGiaHopDongChiTiet" parameterClass="System.Collections.IDictionary" resultClass="System.Int64">
      INSERT INTO TM_PUR_GIAHOPDONGCHITIET (GIAHOPDONG_ID,HANGHOA_ID,MAHANGHOA,TENHANGHOA,DONGIA,SOLUONG,DONVITINH_ID,TENDONVITINH,VAT,GIASAUVAT,KHONGDUNG,BENHVIEN_ID,NGAYTAO,NGUOITAO_ID)
      VALUES(#GIAHOPDONG_ID#,#HANGHOA_ID#,#MAHANGHOA#,#TENHANGHOA#,#DONGIA#,#SOLUONG#,#DONVITINH_ID#,#TENDONVITINH#,#VAT#,#GIASAUVAT#,#KHONGDUNG#,#BENHVIEN_ID#,SYSDATE,#NGUOITAO_ID#)
    </statement>
    <update id="DAO00400_PUR001_UpdGiaHopDongChiTiet" parameterClass="DataObject">
      UPDATE TM_PUR_GIAHOPDONGCHITIET SET GIAHOPDONG_ID = #GIAHOPDONG_ID#,HANGHOA_ID = #HANGHOA_ID#,MAHANGHOA = #MAHANGHOA#,TENHANGHOA = #TENHANGHOA#,DONGIA = #DONGIA#,SOLUONG = #SOLUONG#,DONVITINH_ID = #DONVITINH_ID#,TENDONVITINH = #TENDONVITINH#,VAT = #VAT#,GIASAUVAT = #GIASAUVAT#,KHONGDUNG = #KHONGDUNG#,NGAYCAPNHAT = SYSDATE,NGUOICAPNHAT_ID = #NGUOICAPNHAT_ID#
      WHERE GIAHOPDONGCHITIET_ID = '$GIAHOPDONGCHITIET_ID$' AND BENHVIEN_ID = '$BENHVIEN_ID$'
    </update>
    <statement id="DAO00400_PUR001_DelGiaHopDongChiTietTheoID" parameterClass="System.String" resultClass="System.Int32">
      delete from TM_PUR_GIAHOPDONGCHITIET where GIAHOPDONGCHITIET_ID = '$GIAHOPDONGCHITIET_ID$' AND BENHVIEN_ID = '$BENHVIEN_ID$'
    </statement>
    <statement id="DAO00400_PUR001_DelGiaHopDongAll" parameterClass="System.String" resultClass="System.Int32">
      delete from TM_PUR_GIAHOPDONGCHITIET where GIAHOPDONG_ID = '$GIAHOPDONG_ID$' AND BENHVIEN_ID = '$BENHVIEN_ID$'
      delete from TM_PUR_GIAHOPDONG where GIAHOPDONG_ID = '$GIAHOPDONG_ID$' AND BENHVIEN_ID = '$BENHVIEN_ID$'
    </statement>
    <statement id="DAO00400_PUR001_KTXoaGiaHopDong" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
      select CTCT.GIAHOPDONG_ID from TT_PUR_CHUNGTUCHITIET CTCT
      where CTCT.GIAHOPDONG_ID = '$GIAHOPDONG_ID$' AND CTCT.BENHVIEN_ID = '$BENHVIEN_ID$' and ROWNUM = 1
    </statement>
    <statement id="DAO00400_PUR001_GetGiaHopDong_HangHoaID" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
      SELECT DISTINCT G.GIAHOPDONG_ID,G.NHACUNGCAP_ID,G.TENNHACUNGCAP,G.NGAYHOPDONG,G.TUNGAY,G.DENNGAY,GC.DONGIA,GC.VAT,GC.GIAHOPDONGCHITIET_ID
      FROM TM_PUR_GIAHOPDONG G INNER JOIN TM_PUR_GIAHOPDONGCHITIET GC ON G.GIAHOPDONG_ID=GC.GIAHOPDONG_ID
      WHERE GC.HANGHOA_ID='$HANGHOA_ID$'
      AND ('$NGAYLAPCHUNGTU$' BETWEEN G.TUNGAY AND G.DENNGAY)
      TO_DATE(TO_CHAR(BK.NGAYTAO,'MM/DD/YYYY'), 'MM/DD/YYYY') BETWEEN  TRUNC(TO_DATE('$TUNGAY$','MM/DD/YYYY HH:Mi:SS AM')) and TRUNC(TO_DATE('$DENNGAY$','MM/DD/YYYY HH:Mi:SS AM'))
      AND G.BENHVIEN_ID='$BENHVIEN_ID$' and ROWNUM = 1
      ORDER BY GC.DONGIA ASC
    </statement>
    <statement id="DAO00400_PUR001_GetChungTuTheoHangHoaID" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
      SELECT CHUNGTU_ID, CHUNGTUCHITIET_ID, HANGHOA_ID FROM TT_PUR_CHUNGTUCHITIET WHERE HANGHOA_ID = '$HANGHOA_ID$' AND BENHVIEN_ID='$BENHVIEN_ID$'
      UNION ALL
      SELECT A.CHUNGTUNHAP_ID AS CHUNGTU_ID, A.CHUNGTUNHAPCHITIET_ID AS CHUNGTUCHITIET_ID, B.HANGHOA_ID FROM TT_INV_CHUNGTUNHAPCHITIET A LEFT JOIN TT_INV_THEODOI B ON B.THEODOI_ID = A.THEODOI_ID WHERE B.HANGHOA_ID = '$HANGHOA_ID$' AND A.BENHVIEN_ID='$BENHVIEN_ID$'
    </statement>
    <statement id="DAO00400_PUR001_GetCapDuyet" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
      select CT.CAPDUYET FROM TT_PUR_CHUNGTU CT
      where CT.BENHVIEN_ID = '$BENHVIEN_ID$' AND CT.MACHUNGTU = '$MACHUNGTU$'
    </statement>
    <statement id="DAO00400_GetPurWithID" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
      select *
      from TT_PUR_CHUNGTU
      where CHUNGTU_ID = '$CHUNGTU_ID$'
      <isNotEmpty prepend="and" property="STATE_CODE">
        STATE_CODE = '$STATE_CODE$'
      </isNotEmpty>
      <isNotEmpty prepend="and" property="PROCESS_CODE">
        PROCESS_CODE = '$PROCESS_CODE$'
      </isNotEmpty>
      <isNotEmpty prepend="and" property="BENHVIEN_ID">
        BENHVIEN_ID = '$BENHVIEN_ID$'
      </isNotEmpty>
    </statement>
  </statements>
</sqlMap>