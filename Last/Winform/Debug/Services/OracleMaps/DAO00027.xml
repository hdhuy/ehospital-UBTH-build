<?xml version="1.0" encoding="utf-8" ?>
<!--iBatis Map File-->
<sqlMap namespace="eHospital" xmlns="http://ibatis.apache.org/mapping" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
    <statements>
        <!--Revision:0,1040bedfc72b7cd886d4fc9d9d1a657f-->
        <statement id="DAO00027_GetLOAITINHGIADUOC" resultClass="DataObject">
            select A.VALUE as LOAITINHGIADUOC, B.VALUE as SAPXEPTHEO
            from TM_SYS_APPSETTINGS A
            left join TM_SYS_APPSETTINGS B on B.CODE = 'PHA_CACHTINHGIADUOC_THEOLO'
            where A.CODE = 'APP_QUYTRINH_TINHGIADUOC'
        </statement>
        <!--Revision:0,a0f482055c88598b712e453f16965a9c-->
        <statement id="DAO00027_GetGIADUOCTHEOLO" resultClass="DataObject">
            select B.DONGIAVONVAT as DONGIA_KHAC,
            ROUND(B.DONGIABAN + B.DONGIABAN*tmduoc.TYLE_VAT/100, 0) as DONGIA_DOANHTHU,
            B.DONGIAVON, tmduoc.TYLE_VAT, dg.DONGIA as DONGIATHAU, tmduoc.BHYT
            from TT_DUOC_CHUNGTU_SOLONHAP A
            inner join TT_DUOC_SOLONHAP_GIABAN B on A.SOLONHAP_ID = B.SOLONHAP_ID
            inner join TM_DUOC tmduoc on A.DUOC_ID = tmduoc.DUOC_ID
            left JOIN TM_DUOC_DONGIA dg on dg.DUOC_ID = A.DUOC_ID
            left JOIN TM_BANGGIA bg on (bg.BANGGIA_ID = dg.BANGGIA_ID)
            where A.DUOC_ID = '$DUOC_ID$' and ROWNUM = 1
            order by
            <isEqual prepend="" property="SAPXEPTHEO" compareValue="0">
                A.NGAYNHAP
            </isEqual>
            <isEqual prepend="" property="SAPXEPTHEO" compareValue="1">
                A.HANSUDUNG
            </isEqual>
        </statement>
        <!--Revision:0,c965436a1c21e6e89d5ef48a45000e2f-->
        <statement id="DAO00027_GetList" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
            select distinct A.*, B.DESCRIPTION as TENGIOITINH
            from TT_BENHNHAN A
            left join TM_GENDER B on A.GIOITINH = B.ID
            where
            <!--A.BENHVIEN_ID = '$BENHVIEN_ID$' and-->
            ACTIVE = '1'
        </statement>
        <!--Revision:0,21ca5a5a0a34ca42fdb46e412eeb3380-->
        <statement id="DAO00027_GetListTiepNhan" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
          select distinct TO_CHAR(C.NGAYYEUCAU,'DD/MM/YYYY') as NGAYYEUCAU, C.DICHVU_ID, C.DVYEUCAU_ID, D.TENDICHVU, C.NOITHUCHIEN_ID, A.SOTIEPNHAN, A.TRAITUYEN, A.NGAYMIENDONGCHITRA, A.TIEPNHAN_ID, A.DOITUONG_ID, A.TRANGTHAI,
          A.LOAITHANHVIEN_ID, A.SUDUNG_BHTN, A.THE_ID, A.THANHVIEN_ID, A.VIP, A.NGUON_BENHNHAN_ID, A.BAOLANH_VIENPHI,
          CASE WHEN (A.TRANGTHAI = 'NOITRU' OR A.TRANGTHAI = 'CAPCUU' OR A.TRANGTHAI = 'NGOAITRU') THEN 'IN' ELSE 'OUT' END AS LOAIBENHAN,
          CASE WHEN (C.TRANGTHAI = 'CHUAKETQUA') THEN 'CHUAKETQUA' ELSE 'HOANTAT' END AS TRANGTHAIDICHVU, A.SOBHYT,
          B.*,
          CASE WHEN SUBSTR(E.MANHOMDICHVU,0,2) = '03' THEN '02' ELSE SUBSTR(E.MANHOMDICHVU,0,2) END AS MANHOMDICHVU
          from TT_TIEPNHAN A
          inner join TT_BENHNHAN B on B.BENHNHAN_ID = A.BENHNHAN_ID and (A.TRANGTHAI = 'DATIEPNHAN' or A.TRANGTHAI = 'NOITRU' or A.TRANGTHAI = 'CAPCUU'  or A.TRANGTHAI = 'NGOAITRU') and B.ACTIVE = '1'
          inner join TT_DVYEUCAU C on C.TIEPNHAN_ID = A.TIEPNHAN_ID
          left join TM_DICHVU D on D.DICHVU_ID = C.DICHVU_ID
          left join TM_NHOMDICHVU E on E.NHOMDICHVU_ID = D.NHOMDICHVU_ID
          where C.NGAYHENCLS is NULL and A.BENHVIEN_ID = '$BENHVIEN_ID$'
          <!--where A.BENHNHAN_ID not in (select BENHNHAN_ID from TT_NOITRU_BENHAN where (TRANGTHAI='DATHANHTOAN' OR TRANGTHAI='DANGDIEUTRI'))-->
        </statement>
        <!--Revision:0,7b7f9e2d7ca7561ad41e54d39d512c7d-->
        <statement id="DAO00027_GetListTiepNhanCOM015" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
          SELECT distinct a.* FROM
          (
          SELECT
          (A.SOTIEPNHAN || (CASE WHEN SUBSTR(E.MANHOMDICHVU,0,2) = '03' THEN '02' ELSE SUBSTR(E.MANHOMDICHVU,0,2) END) || LTRIM(C.NOITHUCHIEN_ID)) AS acss_lookupID,
          ROW_NUMBER() OVER
          (PARTITION BY (A.SOTIEPNHAN || (CASE WHEN SUBSTR(E.MANHOMDICHVU,0,2) = '03' THEN '02' ELSE SUBSTR(E.MANHOMDICHVU,0,2) END) || LTRIM(C.NOITHUCHIEN_ID))
          ORDER BY (A.SOTIEPNHAN || (CASE WHEN SUBSTR(E.MANHOMDICHVU,0,2) = '03' THEN '02' ELSE SUBSTR(E.MANHOMDICHVU,0,2) END) || LTRIM(C.NOITHUCHIEN_ID)))
          as num,
          A.SOTIEPNHAN || (CASE WHEN SUBSTR(E.MANHOMDICHVU,0,2) = '03' THEN '02' ELSE SUBSTR(E.MANHOMDICHVU,0,2) END) || LTRIM(C.NOITHUCHIEN_ID) as KEYCOM15,
          C.NOITHUCHIEN_ID, A.SOTIEPNHAN, A.TRAITUYEN, A.NGAYMIENDONGCHITRA, A.TIEPNHAN_ID, A.DOITUONG_ID, A.TRANGTHAI,
          A.LOAITHANHVIEN_ID, A.SUDUNG_BHTN, A.THE_ID, A.THANHVIEN_ID, A.VIP, A.NGUON_BENHNHAN_ID, A.BAOLANH_VIENPHI,
          CASE WHEN (A.TRANGTHAI = 'NOITRU' OR A.TRANGTHAI = 'CAPCUU') THEN 'IN' ELSE 'OUT' END AS LOAIBENHAN,
          CASE WHEN (C.TRANGTHAI = 'CHUAKETQUA') THEN 'CHUAKETQUA' ELSE 'HOANTAT' END AS TRANGTHAIDICHVU, A.SOBHYT,
          B.*, F.TRANGTHAI as TRANGTHAI_BENHAN_NOITRU,
          CASE WHEN SUBSTR(E.MANHOMDICHVU,0,2) = '03' THEN '02' ELSE SUBSTR(E.MANHOMDICHVU,0,2) END AS MANHOMDICHVU
          from TT_TIEPNHAN A
          inner join TT_BENHNHAN B on B.BENHNHAN_ID = A.BENHNHAN_ID and (A.TRANGTHAI = 'DATIEPNHAN' or A.TRANGTHAI = 'NOITRU' or A.TRANGTHAI = 'CAPCUU' or A.TRANGTHAI = 'NGOAITRU') and B.ACTIVE = '1'
          inner join TT_DVYEUCAU C on C.TIEPNHAN_ID = A.TIEPNHAN_ID
          left join TM_DICHVU D on D.DICHVU_ID = C.DICHVU_ID
          left join TM_NHOMDICHVU E on E.NHOMDICHVU_ID = D.NHOMDICHVU_ID
          left join TT_NOITRU_BENHAN F on F.TIEPNHAN_ID = A.TIEPNHAN_ID
          where C.NGAYHENCLS is NULL and A.BENHVIEN_ID = '$BENHVIEN_ID$'
          ) a WHERE a.num = 1
          <!--where A.BENHNHAN_ID not in (select BENHNHAN_ID from TT_NOITRU_BENHAN where (TRANGTHAI='DATHANHTOAN' OR TRANGTHAI='DANGDIEUTRI'))-->
        </statement>
        <!--Revision:0,bde4700fc18c82d74f62a4cc52709ebb-->
        <statement id="DAO00027_GetListTiepNhanAll" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
            select distinct A.SOTIEPNHAN, A.TRAITUYEN, A.NGAYMIENDONGCHITRA, A.TIEPNHAN_ID, A.DOITUONG_ID, NVL(C.SOBENHAN,NULL) as SOBENHAN,
            A.LOAITHANHVIEN_ID, A.SUDUNG_BHTN, A.THE_ID, A.THANHVIEN_ID, A.VIP, A.NGUON_BENHNHAN_ID, A.BAOLANH_VIENPHI, A.SOBHYT,
            B.*
            from TT_TIEPNHAN A
            inner join TT_BENHNHAN B on B.BENHNHAN_ID = A.BENHNHAN_ID and (A.TRANGTHAI = 'DATIEPNHAN') and B.ACTIVE = '1'
            left join TT_NOITRU_BENHAN C on C.TIEPNHAN_ID = A.TIEPNHAN_ID
            where A.BENHVIEN_ID = '$BENHVIEN_ID$'
        </statement>
        <!--Revision:0,d2891adf71af27b466ed1b74db7b6ec9-->
        <statement id="DAO00027_GetListTiepNhanNoiTru" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
          select distinct B.*, C.SOBENHAN, C.BENHAN_ID, A.SOTIEPNHAN, A.TRAITUYEN, A.NGAYMIENDONGCHITRA, A.TIEPNHAN_ID,
          NVL(C.KHOACHUYENDEN_ID,C.KHOAVAO_ID) as KHOACHUYENDEN_ID, A.TRANGTHAI, A.DOITUONG_ID, C.TRANGTHAI as TRANGTHAI_BENHAN,
          A.LOAITHANHVIEN_ID, A.SUDUNG_BHTN, A.THE_ID, A.THANHVIEN_ID, A.VIP, A.NGUON_BENHNHAN_ID, A.BAOLANH_VIENPHI, A.SOBHYT,
          CASE WHEN SUBSTR(C.SOBENHAN,-2) = 'CC' THEN 'CC' ELSE 'NT' END AS LOAIBENHAN
          from TT_TIEPNHAN A
          inner join TT_BENHNHAN B on B.BENHNHAN_ID = A.BENHNHAN_ID and (A.TRANGTHAI = 'CAPCUU' or A.TRANGTHAI = 'NOITRU' or A.TRANGTHAI = 'HOANTHANH' or A.TRANGTHAI = 'NGOAITRU') and B.ACTIVE = '1'
          inner join TT_NOITRU_BENHAN C on C.TIEPNHAN_ID = A.TIEPNHAN_ID and (C.TRANGTHAI='DAXUATVIEN' or C.TRANGTHAI='DATHANHTOAN' OR C.TRANGTHAI='DANGDIEUTRI')
          <!--inner join TT_NOITRU_BENHAN C on C.TIEPNHAN_ID = A.TIEPNHAN_ID and (C.TRANGTHAI='DAXUATVIEN' or C.TRANGTHAI='DATHANHTOAN' OR C.TRANGTHAI='DANGDIEUTRI')-->
            where A.BENHVIEN_ID = '$BENHVIEN_ID$' and C.LOAIBENHAN != 2
        </statement>
        <!--Revision:0,d6ea4d8257930a8ec29448f69c1a1637-->
        <statement id="DAO00027_GetListTiepNhanNoiTruWithTiepNhanId" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
          select distinct B.*, C.SOBENHAN, C.BENHAN_ID, A.SOTIEPNHAN, A.TRAITUYEN, A.NGAYMIENDONGCHITRA, A.TIEPNHAN_ID,
          NVL(C.KHOACHUYENDEN_ID,C.KHOAVAO_ID) as KHOACHUYENDEN_ID, A.TRANGTHAI, A.DOITUONG_ID, C.TRANGTHAI as TRANGTHAI_BENHAN,
          A.LOAITHANHVIEN_ID, A.SUDUNG_BHTN, A.THE_ID, A.THANHVIEN_ID, A.VIP, A.NGUON_BENHNHAN_ID, A.BAOLANH_VIENPHI, A.SOBHYT,
          CASE WHEN SUBSTR(C.SOBENHAN,-2) = 'CC' THEN 'CC' ELSE 'NT' END AS LOAIBENHAN
          from TT_TIEPNHAN A
          inner join TT_BENHNHAN B on B.BENHNHAN_ID = A.BENHNHAN_ID and (A.TRANGTHAI = 'CAPCUU' or A.TRANGTHAI = 'NOITRU' or A.TRANGTHAI = 'HOANTHANH' or A.TRANGTHAI = 'NGOAITRU') and B.ACTIVE = '1'
          inner join TT_NOITRU_BENHAN C on C.TIEPNHAN_ID = A.TIEPNHAN_ID and (C.TRANGTHAI='DAXUATVIEN' or C.TRANGTHAI='DATHANHTOAN' OR C.TRANGTHAI='DANGDIEUTRI')
          where
          A.TIEPNHAN_ID = '$TIEPNHAN_ID$' and A.BENHVIEN_ID = '$BENHVIEN_ID$'  and C.LOAIBENHAN != 2
        </statement>
        <!--Revision:0,6fbd302e459d814ad25dd4c4c3977b99-->
        <statement id="DAO00027_GetListTiepNhanNoiTruWithBenhAnId" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
          select distinct B.*, C.SOBENHAN, C.BENHAN_ID, A.SOTIEPNHAN, A.TRAITUYEN, A.NGAYMIENDONGCHITRA, A.TIEPNHAN_ID,
          NVL(C.KHOACHUYENDEN_ID,C.KHOAVAO_ID) as KHOACHUYENDEN_ID, A.TRANGTHAI, A.DOITUONG_ID, C.TRANGTHAI as TRANGTHAI_BENHAN,
          A.LOAITHANHVIEN_ID, A.SUDUNG_BHTN, A.THE_ID, A.THANHVIEN_ID, A.VIP, A.NGUON_BENHNHAN_ID, A.BAOLANH_VIENPHI, A.SOBHYT,
          CASE WHEN SUBSTR(C.SOBENHAN,-2) = 'CC' THEN 'CC' ELSE 'NT' END AS LOAIBENHAN
          from TT_TIEPNHAN A
          inner join TT_BENHNHAN B on B.BENHNHAN_ID = A.BENHNHAN_ID and (A.TRANGTHAI = 'CAPCUU' or A.TRANGTHAI = 'NOITRU' or A.TRANGTHAI = 'HOANTHANH' or A.TRANGTHAI = 'NGOAITRU') and B.ACTIVE = '1'
          inner join TT_NOITRU_BENHAN C on C.TIEPNHAN_ID = A.TIEPNHAN_ID and (C.TRANGTHAI='DAXUATVIEN' or C.TRANGTHAI='DATHANHTOAN' OR C.TRANGTHAI='DANGDIEUTRI')
          where
          C.BENHAN_ID = '$BENHAN_ID$' and A.BENHVIEN_ID = '$BENHVIEN_ID$'  and C.LOAIBENHAN != 2
        </statement>
        <!--Revision:0,4110a7c2abc418677731718da483dc08-->
        <statement id="DAO00027_GetListTiepNhanNoiTruWithSoBenhAn" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
          select distinct B.*, C.SOBENHAN, C.BENHAN_ID, A.SOTIEPNHAN, A.TRAITUYEN, A.NGAYMIENDONGCHITRA, A.TIEPNHAN_ID,
          NVL(C.KHOACHUYENDEN_ID,C.KHOAVAO_ID) as KHOACHUYENDEN_ID, A.TRANGTHAI, A.DOITUONG_ID, C.TRANGTHAI as TRANGTHAI_BENHAN,
          A.LOAITHANHVIEN_ID, A.SUDUNG_BHTN, A.THE_ID, A.THANHVIEN_ID, A.VIP, A.NGUON_BENHNHAN_ID, A.BAOLANH_VIENPHI, A.SOBHYT,
          CASE WHEN SUBSTR(SOBENHAN,-2) = 'CC' THEN 'CC' ELSE 'NT' END AS LOAIBENHAN
          from TT_TIEPNHAN A
          inner join TT_BENHNHAN B on B.BENHNHAN_ID = A.BENHNHAN_ID and (A.TRANGTHAI = 'CAPCUU' or A.TRANGTHAI = 'NOITRU' or A.TRANGTHAI = 'HOANTHANH' or A.TRANGTHAI = 'NGOAITRU') and B.ACTIVE = '1'
          inner join TT_NOITRU_BENHAN C on C.TIEPNHAN_ID = A.TIEPNHAN_ID and (C.TRANGTHAI='DAXUATVIEN' or C.TRANGTHAI='DATHANHTOAN' OR C.TRANGTHAI='DANGDIEUTRI')
          where
          A.BENHVIEN_ID = '$BENHVIEN_ID$' and  and C.LOAIBENHAN != 2
          <isNotEmpty prepend="and" property="SOBENHAN">
                C.SOBENHAN = '$SOBENHAN$'
            </isNotEmpty>
            <isNotEmpty prepend="and" property="SOCAPCUU">
                C.SOCAPCUU = '$SOCAPCUU$'
            </isNotEmpty>
        </statement>
        <!--Revision:0,584a801f6607f28e6566eccd1422b932-->
        <statement id="DAO00027_GetListTiepNhanAllWithId" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
          select distinct A.SOTIEPNHAN, A.TRAITUYEN, A.NGAYMIENDONGCHITRA, A.TIEPNHAN_ID, A.DOITUONG_ID, NVL(C.SOBENHAN,NULL) as SOBENHAN,
          A.LOAITHANHVIEN_ID, A.SUDUNG_BHTN, A.THE_ID, A.THANHVIEN_ID, A.VIP, A.NGUON_BENHNHAN_ID, A.BAOLANH_VIENPHI, A.SOBHYT,
          B.*
          from TT_TIEPNHAN A
          inner join TT_BENHNHAN B on B.BENHNHAN_ID = A.BENHNHAN_ID and (A.TRANGTHAI = 'DATIEPNHAN') and B.ACTIVE = '1'
          left join TT_NOITRU_BENHAN C on C.TIEPNHAN_ID = A.TIEPNHAN_ID
          where A.TIEPNHAN_ID = '$TIEPNHAN_ID$' and A.BENHVIEN_ID = '$BENHVIEN_ID$'
        </statement>
        <!--Revision:0,85603fe0fa23a83f833bed887c872bf7-->
        <statement id="DAO00027_GetThongTinBenhNhanDichVu" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
            select * from TT_BENHNHAN A
            where A.BENHNHAN_ID = '$BENHNHAN_ID$'
        </statement>
        <!--Revision:0,81ba2ce2d70e2b21a376de1a39ca63da-->
        <statement id="DAO00027_GetTUOITREEMANDTHANHTHIEUNIEN" resultClass="DataObject">
            select VALUE as TUOITREEM, '0' as TUOITHANHTHIEUNIEN
            from TM_SYS_APPSETTINGS
            where CODE = 'MPI_TUOI_TRE_EM'
            UNION
            select '0' as TUOITREEM, VALUE as TUOITHANHTHIEUNIEN
            from TM_SYS_APPSETTINGS
            where CODE = 'MPI_TUOI_TRE_THANH_THIEU_NIEN'
        </statement>
        <!--Revision:0,1bb82cba907c7152d89a730f455f409b-->
        <statement id="DAO00027_ThongTinTiepNhanCOM006" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
          select distinct TO_CHAR(A.NGAYTIEPNHAN,'DD/MM/YYYY') as NGAYYEUCAU, C.DICHVU_ID, C.DVYEUCAU_ID, D.TENDICHVU, C.NOITHUCHIEN_ID,
          A.SOTIEPNHAN, A.TRAITUYEN, A.NGAYMIENDONGCHITRA, A.TIEPNHAN_ID, A.DOITUONG_ID, A.TRANGTHAI,
          A.LOAITHANHVIEN_ID, A.SUDUNG_BHTN, A.THE_ID, A.THANHVIEN_ID, A.VIP, A.NGUON_BENHNHAN_ID, A.BAOLANH_VIENPHI,
          CASE WHEN (A.TRANGTHAI = 'NOITRU' OR A.TRANGTHAI = 'CAPCUU'   or A.TRANGTHAI = 'NGOAITRU') THEN 'IN' ELSE 'OUT' END AS LOAIBENHAN,
          CASE WHEN (C.TRANGTHAI = 'CHUAKETQUA') THEN 'CHUAKETQUA' ELSE 'HOANTAT' END AS TRANGTHAIDICHVU, A.SOBHYT,
          B.*,
          CASE WHEN SUBSTR(E.MANHOMDICHVU,0,2) = '03' THEN '02' ELSE SUBSTR(E.MANHOMDICHVU,0,2) END AS MANHOMDICHVU
          from TT_TIEPNHAN A
          inner join TT_BENHNHAN B on B.BENHNHAN_ID = A.BENHNHAN_ID and (A.TRANGTHAI = 'DATIEPNHAN' or A.TRANGTHAI = 'NOITRU' or A.TRANGTHAI = 'CAPCUU'  or A.TRANGTHAI = 'NGOAITRU') and B.ACTIVE = '1'
          inner join TT_DVYEUCAU C on C.TIEPNHAN_ID = A.TIEPNHAN_ID
          left join TM_DICHVU D on D.DICHVU_ID = C.DICHVU_ID
          left join TM_NHOMDICHVU E on E.NHOMDICHVU_ID = D.NHOMDICHVU_ID
          where C.NGAYHENCLS is NULL and A.TIEPNHAN_ID = '$TIEPNHAN_ID$' and C.DICHVU_ID = '$DICHVU_ID$' and A.BENHVIEN_ID = '$BENHVIEN_ID$'
          <isNotEmpty prepend="and" property="DVYEUCAU_ID">
                C.DVYEUCAU_ID = '$DVYEUCAU_ID$'
            </isNotEmpty>
            <!--where A.BENHNHAN_ID not in (select BENHNHAN_ID from TT_NOITRU_BENHAN where (TRANGTHAI='DATHANHTOAN' OR TRANGTHAI='DANGDIEUTRI'))-->
        </statement>
        <!--Revision:0,b2070d1635b0608f5d9d43565305c017-->
        <statement id="DAO00027_ThongTinTiepNhanCOM006List" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
          select distinct TO_CHAR(A.NGAYTIEPNHAN,'DD/MM/YYYY') as NGAYYEUCAU, C.DICHVU_ID, C.DVYEUCAU_ID, D.TENDICHVU, C.NOITHUCHIEN_ID,
          A.SOTIEPNHAN, A.TRAITUYEN, A.NGAYMIENDONGCHITRA, A.TIEPNHAN_ID, A.DOITUONG_ID, A.TRANGTHAI,
          A.LOAITHANHVIEN_ID, A.SUDUNG_BHTN, A.THE_ID, A.THANHVIEN_ID, A.VIP, A.NGUON_BENHNHAN_ID, A.BAOLANH_VIENPHI,
          CASE WHEN (A.TRANGTHAI = 'NOITRU' OR A.TRANGTHAI = 'CAPCUU'   or A.TRANGTHAI = 'NGOAITRU') THEN 'IN' ELSE 'OUT' END AS LOAIBENHAN,
          CASE WHEN (C.TRANGTHAI = 'CHUAKETQUA') THEN 'CHUAKETQUA' ELSE 'HOANTAT' END AS TRANGTHAIDICHVU, A.SOBHYT,
          B.*,
          CASE WHEN SUBSTR(E.MANHOMDICHVU,0,2) = '03' THEN '02' ELSE SUBSTR(E.MANHOMDICHVU,0,2) END AS MANHOMDICHVU
          from TT_TIEPNHAN A
          inner join TT_BENHNHAN B on B.BENHNHAN_ID = A.BENHNHAN_ID and (A.TRANGTHAI = 'DATIEPNHAN' or A.TRANGTHAI = 'NOITRU' or A.TRANGTHAI = 'CAPCUU'  or A.TRANGTHAI = 'NGOAITRU') and B.ACTIVE = '1'
          inner join TT_DVYEUCAU C on C.TIEPNHAN_ID = A.TIEPNHAN_ID
          left join TM_DICHVU D on D.DICHVU_ID = C.DICHVU_ID
          left join TM_NHOMDICHVU E on E.NHOMDICHVU_ID = D.NHOMDICHVU_ID
          where C.NGAYHENCLS is NULL and A.TIEPNHAN_ID = '$TIEPNHAN_ID$' and C.DICHVU_ID in ($LST_DICHVU_ID$) and A.BENHVIEN_ID = '$BENHVIEN_ID$'
          <!--where A.BENHNHAN_ID not in (select BENHNHAN_ID from TT_NOITRU_BENHAN where (TRANGTHAI='DATHANHTOAN' OR TRANGTHAI='DANGDIEUTRI'))-->
        </statement>
        <!--Revision:0,967fff67d88f010f453785c2f807df84-->
        <statement id="DAO00027_ThongTinTiepNhanCOM015" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
            SELECT distinct * FROM
            (
            SELECT
            (A.SOTIEPNHAN || (CASE WHEN SUBSTR(E.MANHOMDICHVU, 0,2) = '03' THEN '02' ELSE SUBSTR(E.MANHOMDICHVU,0,2) END) || LTRIM(C.NOITHUCHIEN_ID)) AS acss_lookupID,
            ROW_NUMBER() OVER
            (PARTITION BY (A.SOTIEPNHAN || (CASE WHEN SUBSTR(E.MANHOMDICHVU, 0,2) = '03' THEN '02' ELSE SUBSTR(E.MANHOMDICHVU, 0,2) END) || LTRIM(C.NOITHUCHIEN_ID))
            ORDER BY (A.SOTIEPNHAN || (CASE WHEN SUBSTR(E.MANHOMDICHVU, 0,2) = '03' THEN '02' ELSE SUBSTR(E.MANHOMDICHVU, 0,2) END) || LTRIM(C.NOITHUCHIEN_ID)))
            as num,
            A.SOTIEPNHAN || (CASE WHEN SUBSTR(E.MANHOMDICHVU, 0,2) = '03' THEN '02' ELSE SUBSTR(E.MANHOMDICHVU, 0,2) END) || LTRIM(C.NOITHUCHIEN_ID) as KEYCOM15,
            C.NOITHUCHIEN_ID, A.SOTIEPNHAN, A.TRAITUYEN, A.NGAYMIENDONGCHITRA, A.TIEPNHAN_ID, A.DOITUONG_ID, A.TRANGTHAI,
            CASE WHEN (A.TRANGTHAI = 'NOITRU' OR A.TRANGTHAI = 'CAPCUU' or A.TRANGTHAI = 'NGOAITRU') THEN 'IN' ELSE 'OUT' END AS LOAIBENHAN,
            CASE WHEN (C.TRANGTHAI = 'CHUAKETQUA') THEN 'CHUAKETQUA' ELSE 'HOANTAT' END AS TRANGTHAIDICHVU,
            B.*, F.TRANGTHAI as TRANGTHAI_BENHAN_NOITRU,
            A.LOAITHANHVIEN_ID, A.SUDUNG_BHTN, A.THE_ID, A.THANHVIEN_ID, A.VIP, A.NGUON_BENHNHAN_ID, A.BAOLANH_VIENPHI,
            CASE WHEN SUBSTR(E.MANHOMDICHVU, 0,2) = '03' THEN '02' ELSE SUBSTR(E.MANHOMDICHVU, 0,2) END AS MANHOMDICHVU
            from TT_TIEPNHAN A
            inner join TT_BENHNHAN B on B.BENHNHAN_ID = A.BENHNHAN_ID and (A.TRANGTHAI = 'DATIEPNHAN' or A.TRANGTHAI = 'NOITRU' or A.TRANGTHAI = 'CAPCUU' or A.TRANGTHAI = 'NGOAITRU') and B.ACTIVE = '1'
            inner join TT_DVYEUCAU C on C.TIEPNHAN_ID = A.TIEPNHAN_ID
            left join TM_DICHVU D on D.DICHVU_ID = C.DICHVU_ID
            left join TM_NHOMDICHVU E on E.NHOMDICHVU_ID = D.NHOMDICHVU_ID
            left join TT_NOITRU_BENHAN F on F.TIEPNHAN_ID = A.TIEPNHAN_ID
            where C.NGAYHENCLS is NULL and A.TIEPNHAN_ID = '$TIEPNHAN_ID$' and A.BENHVIEN_ID = '$BENHVIEN_ID$'
            ) a where a.num = 1
            <!--where C.NGAYHENCLS is NULL and A.SOTIEPNHAN = '$SOTIEPNHAN$' and A.BENHVIEN_ID = '$BENHVIEN_ID$'-->
            <!--where A.BENHNHAN_ID not in (select BENHNHAN_ID from TT_NOITRU_BENHAN where (TRANGTHAI='DATHANHTOAN' OR TRANGTHAI='DANGDIEUTRI'))-->
        </statement>
        <!--Revision:0,a1b40a6c7e1ab0d146ada062c55c99ef-->
        <statement id="DAO00027_ThongTinTiepNhanCOM015All" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
          select distinct
          A.SOTIEPNHAN || (CASE WHEN SUBSTR(E.MANHOMDICHVU,0,2) = '03' THEN '02' ELSE SUBSTR(E.MANHOMDICHVU,0,2) END) || LTRIM(C.NOITHUCHIEN_ID) as KEYCOM15,
          C.NOITHUCHIEN_ID, A.SOTIEPNHAN, A.TIEPNHAN_ID, A.DOITUONG_ID, A.TRANGTHAI,
          CASE WHEN (A.TRANGTHAI = 'NOITRU' OR A.TRANGTHAI = 'CAPCUU' or A.TRANGTHAI = 'NGOAITRU') THEN 'IN' ELSE 'OUT' END AS LOAIBENHAN,
          CASE WHEN (C.TRANGTHAI = 'CHUAKETQUA') THEN 'CHUAKETQUA' ELSE 'HOANTAT' END AS TRANGTHAIDICHVU, A.SOBHYT,
          B.*, F.TRANGTHAI as TRANGTHAI_BENHAN_NOITRU,
          A.LOAITHANHVIEN_ID, A.SUDUNG_BHTN, A.THE_ID, A.THANHVIEN_ID, A.VIP, A.NGUON_BENHNHAN_ID, A.BAOLANH_VIENPHI,
          CASE WHEN SUBSTR(E.MANHOMDICHVU, 0,2) = '03' THEN '02' ELSE SUBSTR(E.MANHOMDICHVU, 0,2) END AS MANHOMDICHVU
          from TT_TIEPNHAN A
          inner join TT_BENHNHAN B on B.BENHNHAN_ID = A.BENHNHAN_ID and B.ACTIVE = '1'
          inner join TT_DVYEUCAU C on C.TIEPNHAN_ID = A.TIEPNHAN_ID
          left join TM_DICHVU D on D.DICHVU_ID = C.DICHVU_ID
          left join TM_NHOMDICHVU E on E.NHOMDICHVU_ID = D.NHOMDICHVU_ID
          left join TT_NOITRU_BENHAN F on F.TIEPNHAN_ID = A.TIEPNHAN_ID
          where C.NGAYHENCLS is NULL and A.TIEPNHAN_ID = '$TIEPNHAN_ID$' and A.BENHVIEN_ID = '$BENHVIEN_ID$'
          <!--where C.NGAYHENCLS is NULL and A.SOTIEPNHAN = '$SOTIEPNHAN$' and A.BENHVIEN_ID = '$BENHVIEN_ID$'-->
            <!--where A.BENHNHAN_ID not in (select BENHNHAN_ID from TT_NOITRU_BENHAN where (TRANGTHAI='DATHANHTOAN' OR TRANGTHAI='DANGDIEUTRI'))-->
        </statement>
        <!--Revision:0,a9cb238142cad53a7070e4174ee5f54b-->
        <statement id="DAO00027_GetListTiepNhanAllCOM30" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
          select distinct A.SOTIEPNHAN, A.TRAITUYEN, A.NGAYMIENDONGCHITRA, A.TIEPNHAN_ID, A.DOITUONG_ID, NVL(C.SOBENHAN,NULL) as SOBENHAN,
          A.LOAITHANHVIEN_ID, A.SUDUNG_BHTN, A.THE_ID, A.THANHVIEN_ID, A.VIP, A.NGUON_BENHNHAN_ID, A.BAOLANH_VIENPHI, A.SOBHYT,
          B.*
          from TT_TIEPNHAN A
          inner join TT_BENHNHAN B on B.BENHNHAN_ID = A.BENHNHAN_ID and (A.TRANGTHAI = 'DATIEPNHAN') and B.ACTIVE = '1'
          left join TT_NOITRU_BENHAN C on C.TIEPNHAN_ID = A.TIEPNHAN_ID
          where A.TIEPNHAN_ID = '$TIEPNHAN_ID$' and A.BENHVIEN_ID = '$BENHVIEN_ID$'
        </statement>
        <!--Revision:0,2aa425753a6ca9bbfdeb269edb8a2142-->
        <statement id="DAO00027_GetListDuocTonKho" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
          <!--select distinct  'MN' || LTRIM(TM_DUOC.DUOC_ID) as DUOC_KEY, 'MN' as KHODUOC_ID, TM_DUOC.DUOC_ID, TM_LOAIDUOC.MALOAIDUOC,TM_DUOC.SOVISA,TM_DUOC.TYLE_VAT,TM_DUOC.COTOA,
          TM_DUOC.MADUOC, TM_DUOC.TENHANG, TO_CHAR(TM_DUOC.TENDUOCDAYDU) TENDUOCDAYDU, TM_DUOC.DONVITINH, TM_DUOC.DONVITINH_ID, TM_DUOC.BHYT,
          TM_DUOC.TENHOATCHAT, TM_DUOC.HAMLUONG, TM_DUOC.HANGSANXUAT, TM_DUOC.QUOCGIA, TM_DUOC.LOAIDUOC_ID, TM_DUOC.DUONGDUNG_ID,
          TO_CHAR(TM_TENDUOC.TENDUOC) AS TENDUOC, TM_TENDUOC.TENDUOC_EN, TM_TENDUOC.MAQUOCTE, TM_TENDUOC.MAQUOCTEBT,
          TM_LOAIDUOC.LOAIVATTU_ID, TM_DUOC.BENHVIEN_ID,
          0 as SOLUONG, TM_DUOC.VTYT_PHANLOAI
          from TM_DUOC
          left join TM_TENDUOC on TM_DUOC.TENDUOC_ID = TM_TENDUOC.TENDUOC_ID and TM_DUOC.BENHVIEN_ID = '$BENHVIEN_ID$'
          left join TM_LOAIDUOC on TM_LOAIDUOC.LOAIDUOC_ID = TM_DUOC.LOAIDUOC_ID and TM_LOAIDUOC.BENHVIEN_ID = '$BENHVIEN_ID$'
          left join TM_DUOC_HANDUNG on (TM_LOAIDUOC.LOAIVATTU_ID = TM_DUOC_HANDUNG.LOAIDUOC and TM_DUOC_HANDUNG.BENHVIEN_ID = '$BENHVIEN_ID$')
          where TM_DUOC.BENHVIEN_ID = '$BENHVIEN_ID$' and TM_DUOC.TAMNGUNG = '0'
          union-->
          select distinct TT_TONKHO.DUOC_KEY, LTRIM(TT_TONKHO.KHODUOC_ID) as KHODUOC_ID, TM_DUOC.DUOC_ID, TM_LOAIDUOC.MALOAIDUOC,TM_DUOC.SOVISA,TM_DUOC.TYLE_VAT,TM_DUOC.COTOA,
          TM_DUOC.MADUOC, TM_DUOC.TENHANG, TO_CHAR(TM_DUOC.TENDUOCDAYDU) TENDUOCDAYDU, TM_DUOC.DONVITINH,  TM_DUOC.DONVITINH_ID,TM_DUOC.BHYT,
          TM_DUOC.TENHOATCHAT, TM_DUOC.HAMLUONG, TM_DUOC.HANGSANXUAT, TM_DUOC.QUOCGIA, TM_DUOC.LOAIDUOC_ID, TM_DUOC.DUONGDUNG_ID,
          TO_CHAR(TM_TENDUOC.TENDUOC) AS TENDUOC, TM_TENDUOC.TENDUOC_EN, TM_TENDUOC.MAQUOCTE, TM_TENDUOC.MAQUOCTEBT,
          TM_LOAIDUOC.LOAIVATTU_ID, TM_DUOC.BENHVIEN_ID,
          TT_TONKHO.SOLUONG, TM_DUOC.VTYT_PHANLOAI
          from TM_DUOC
          left join TM_TENDUOC on TM_DUOC.TENDUOC_ID = TM_TENDUOC.TENDUOC_ID and TM_DUOC.BENHVIEN_ID = '$BENHVIEN_ID$' and TM_DUOC.TAMNGUNG = '0'
          left join TM_LOAIDUOC on TM_LOAIDUOC.LOAIDUOC_ID = TM_DUOC.LOAIDUOC_ID and TM_LOAIDUOC.BENHVIEN_ID = '$BENHVIEN_ID$'
          left join TM_DUOC_HANDUNG on (TM_LOAIDUOC.LOAIVATTU_ID = TM_DUOC_HANDUNG.LOAIDUOC and TM_DUOC_HANDUNG.BENHVIEN_ID = '$BENHVIEN_ID$')
          inner join
          (select LTRIM(A.KHODUOC_ID) || '_' || LTRIM(A.DUOC_ID) || '_' || LTRIM(NVL(A.NGUONDUOC_ID,'')) as DUOC_KEY, A.KHODUOC_ID, A.DUOC_ID,
          SUM(NVL(A.SOLUONG,0)) as SOLUONG
          from
          (select SUM(SOLUONG) as SOLUONG, KHODUOC_ID, DUOC_ID, NGUONDUOC_ID from TT_DUOC_TONKHO
          where BENHVIEN_ID = '$BENHVIEN_ID$' group by KHODUOC_ID, DUOC_ID, NGUONDUOC_ID) A
          group by LTRIM(A.KHODUOC_ID) || '_' || LTRIM(A.DUOC_ID) || '_' || LTRIM(NVL(A.NGUONDUOC_ID,'')) , A.KHODUOC_ID, A.DUOC_ID
          )
          TT_TONKHO on TT_TONKHO.DUOC_ID = TM_DUOC.DUOC_ID
          where TT_TONKHO.SOLUONG &gt;= 0 and TM_DUOC.BENHVIEN_ID = '$BENHVIEN_ID$'  and TM_DUOC.TAMNGUNG = '0'
        </statement>
        <!--Revision:0,99519aa171e260ed786226cdf307ec6c-->
        <statement id="DAO00027_GetListDuocTonKho_NhaThuoc" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
          select distinct TT_TONKHO.DUOC_KEY, LTRIM(TT_TONKHO.KHODUOC_ID) as KHODUOC_ID, TM_DUOC.DUOC_ID, TM_LOAIDUOC.MALOAIDUOC,TM_DUOC.SOVISA,TM_DUOC.TYLE_VAT,TM_DUOC.COTOA,
          CASE WHEN TM_DUOC.COTOA = 1 THEN N'Có'ELSE N'Không'END  as COTOA_NAME,
          TM_DUOC.MADUOC, TM_DUOC.TENHANG, TO_CHAR(TM_DUOC.TENDUOCDAYDU) TENDUOCDAYDU, TM_DUOC.DONVITINH,  TM_DUOC.DONVITINH_ID,TM_DUOC.BHYT,
          TM_DUOC.TENHOATCHAT, TM_DUOC.HAMLUONG, TM_DUOC.HANGSANXUAT, TM_DUOC.QUOCGIA, TM_DUOC.LOAIDUOC_ID, TM_DUOC.DUONGDUNG_ID,
          TO_CHAR(TM_TENDUOC.TENDUOC) AS TENDUOC, TM_TENDUOC.TENDUOC_EN, TM_TENDUOC.MAQUOCTE, TM_TENDUOC.MAQUOCTEBT,
          TM_LOAIDUOC.LOAIVATTU_ID, TM_DUOC.BENHVIEN_ID,
          TT_TONKHO.SOLUONG, TM_DUOC.VTYT_PHANLOAI
          from TM_DUOC
          left join TM_TENDUOC on TM_DUOC.TENDUOC_ID = TM_TENDUOC.TENDUOC_ID and TM_DUOC.BENHVIEN_ID = '$BENHVIEN_ID$' and TM_DUOC.TAMNGUNG = '0'  and TM_DUOC.NHATHUOC = '1'
          left join TM_LOAIDUOC on TM_LOAIDUOC.LOAIDUOC_ID = TM_DUOC.LOAIDUOC_ID and TM_LOAIDUOC.BENHVIEN_ID = '$BENHVIEN_ID$'
          left join TM_DUOC_HANDUNG on (TM_LOAIDUOC.LOAIVATTU_ID = TM_DUOC_HANDUNG.LOAIDUOC and TM_DUOC_HANDUNG.BENHVIEN_ID = '$BENHVIEN_ID$')
          inner join
          (select LTRIM(A.KHODUOC_ID) || '_' || LTRIM(A.DUOC_ID)  || '_' || LTRIM(NVL(A.NGUONDUOC_ID,'')) as DUOC_KEY, A.KHODUOC_ID, A.DUOC_ID,
          SUM(NVL(A.SOLUONG,0)) as SOLUONG
          from
          (select SUM(SOLUONG) as SOLUONG, KHODUOC_ID, DUOC_ID, NGUONDUOC_ID from TT_DUOC_TONKHO
          where BENHVIEN_ID = '$BENHVIEN_ID$' group by KHODUOC_ID, DUOC_ID, NGUONDUOC_ID) A
          group by LTRIM(A.KHODUOC_ID) || '_' || LTRIM(A.DUOC_ID)  || '_' || LTRIM(NVL(A.NGUONDUOC_ID,'')) , A.KHODUOC_ID, A.DUOC_ID
          )
          TT_TONKHO on TT_TONKHO.DUOC_ID = TM_DUOC.DUOC_ID
          where TT_TONKHO.SOLUONG &gt;= 0 and TM_DUOC.BENHVIEN_ID = '$BENHVIEN_ID$'  and TM_DUOC.TAMNGUNG = '0' and TM_DUOC.NHATHUOC = '1'
        </statement>
        <!--Revision:0,accdae7b0b1eeec60016ab760d04acd2-->
        <statement id="DAO00027_GetListDuocKyGuiTonKho" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
          select  distinct TT_TONKHO.DUOC_KEY, LTRIM(TT_TONKHO.KHODUOC_ID) as KHODUOC_ID, TM_DUOC.DUOC_ID, TM_LOAIDUOC.MALOAIDUOC,TM_DUOC.SOVISA,TM_DUOC.TYLE_VAT,TM_DUOC.COTOA,
          TM_DUOC.MADUOC, TM_DUOC.TENHANG, TO_CHAR(TM_DUOC.TENDUOCDAYDU) AS TENDUOCDAYDU, TM_DUOC.DONVITINH,  TM_DUOC.DONVITINH_ID,TM_DUOC.BHYT,
          TM_DUOC.TENHOATCHAT, TM_DUOC.HAMLUONG, TM_DUOC.HANGSANXUAT, TM_DUOC.QUOCGIA, TM_DUOC.LOAIDUOC_ID, TM_DUOC.DUONGDUNG_ID,
          TO_CHAR(TM_TENDUOC.TENDUOC) AS TENDUOC, TM_TENDUOC.TENDUOC_EN, TM_TENDUOC.MAQUOCTE, TM_TENDUOC.MAQUOCTEBT,
          TM_LOAIDUOC.LOAIVATTU_ID, TM_DUOC.BENHVIEN_ID,
          TT_TONKHO.SOLUONG
          from TM_DUOC
          left join TM_TENDUOC on TM_DUOC.TENDUOC_ID = TM_TENDUOC.TENDUOC_ID and TM_DUOC.BENHVIEN_ID = '$BENHVIEN_ID$' and TM_DUOC.TAMNGUNG = '0'  and TM_DUOC.BENHVIEN = '1'
          left join TM_LOAIDUOC on TM_LOAIDUOC.LOAIDUOC_ID = TM_DUOC.LOAIDUOC_ID and TM_LOAIDUOC.BENHVIEN_ID = '$BENHVIEN_ID$'
          left join TM_DUOC_HANDUNG on (TM_LOAIDUOC.LOAIVATTU_ID = TM_DUOC_HANDUNG.LOAIDUOC and TM_DUOC_HANDUNG.BENHVIEN_ID = '$BENHVIEN_ID$')
          inner join
          (select LTRIM(A.KHODUOC_ID) || '_' || LTRIM(A.DUOC_ID) || '_' || LTRIM(NVL(A.NGUONDUOC_ID,'')) as DUOC_KEY, A.KHODUOC_ID, A.DUOC_ID,
          SUM(NVL(A.SOLUONG,0)) as SOLUONG
          from
          (select SUM(SOLUONG) as SOLUONG, KHODUOC_ID, DUOC_ID, NGUONDUOC_ID from TT_DUOC_KYGUI_TONKHO
          where BENHVIEN_ID = '$BENHVIEN_ID$' group by KHODUOC_ID, DUOC_ID, NGUONDUOC_ID) A
          group by LTRIM(A.KHODUOC_ID) || '_' || LTRIM(A.DUOC_ID) || '_' || LTRIM(NVL(A.NGUONDUOC_ID,'')) , A.KHODUOC_ID, A.DUOC_ID)
          TT_TONKHO on TT_TONKHO.DUOC_ID = TM_DUOC.DUOC_ID  and TM_DUOC.BENHVIEN = '1'
          where TT_TONKHO.SOLUONG &gt;= 0 and TM_DUOC.BENHVIEN_ID = '$BENHVIEN_ID$' AND  TM_DUOC.TAMNGUNG = '0'
        </statement>
        <!--Revision:0,2a24907b1ef50f1a5fab2d9b17dabf66-->
        <statement id="DAO00027_GetListDuocKyGuiTonKhoCOM33" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
          select  distinct TT_TONKHO.DUOC_KEY, LTRIM(TT_TONKHO.KHODUOC_ID) as KHODUOC_ID, TM_DUOC.DUOC_ID, TM_LOAIDUOC.MALOAIDUOC,TM_DUOC.SOVISA,TM_DUOC.TYLE_VAT,TM_DUOC.COTOA,
          TM_DUOC.MADUOC, TM_DUOC.TENHANG, TO_CHAR(TM_DUOC.TENDUOCDAYDU) AS TENDUOCDAYDU, TM_DUOC.DONVITINH,  TM_DUOC.DONVITINH_ID,TM_DUOC.BHYT,
          TM_DUOC.TENHOATCHAT, TM_DUOC.HAMLUONG, TM_DUOC.HANGSANXUAT, TM_DUOC.QUOCGIA, TM_DUOC.LOAIDUOC_ID, TM_DUOC.DUONGDUNG_ID,
          TO_CHAR(TM_TENDUOC.TENDUOC) AS TENDUOC, TM_TENDUOC.TENDUOC_EN, TM_TENDUOC.MAQUOCTE, TM_TENDUOC.MAQUOCTEBT,
          TM_LOAIDUOC.LOAIVATTU_ID, TM_DUOC.BENHVIEN_ID,
          TT_TONKHO.SOLUONG
          from TM_DUOC
          left join TM_TENDUOC on TM_DUOC.TENDUOC_ID = TM_TENDUOC.TENDUOC_ID and TM_DUOC.BENHVIEN_ID = '$BENHVIEN_ID$' and TM_DUOC.TAMNGUNG = '0'  and TM_DUOC.BENHVIEN = '1'
          left join TM_LOAIDUOC on TM_LOAIDUOC.LOAIDUOC_ID = TM_DUOC.LOAIDUOC_ID and TM_LOAIDUOC.BENHVIEN_ID = '$BENHVIEN_ID$'
          left join TM_DUOC_HANDUNG on (TM_LOAIDUOC.LOAIVATTU_ID = TM_DUOC_HANDUNG.LOAIDUOC and TM_DUOC_HANDUNG.BENHVIEN_ID = '$BENHVIEN_ID$')
          inner join
          (select LTRIM(A.KHODUOC_ID) || '_' || LTRIM(A.DUOC_ID) || '_' || LTRIM(NVL(A.NGUONDUOC_ID,'')) as DUOC_KEY, A.KHODUOC_ID, A.DUOC_ID ,
          SUM(NVL(A.SOLUONG,0)) as SOLUONG
          from
          (select SUM(SOLUONG) as SOLUONG, KHODUOC_ID, DUOC_ID, NGUONDUOC_ID from TT_DUOC_KYGUI_TONKHO
          where BENHVIEN_ID = '$BENHVIEN_ID$' group by KHODUOC_ID, DUOC_ID, NGUONDUOC_ID) A
          group by LTRIM(A.KHODUOC_ID) || '_' || LTRIM(A.DUOC_ID) || '_' || LTRIM(NVL(A.NGUONDUOC_ID,'')) , A.KHODUOC_ID, A.DUOC_ID)
          TT_TONKHO on TT_TONKHO.DUOC_ID = TM_DUOC.DUOC_ID
          where TT_TONKHO.SOLUONG &gt;= 0 and TM_DUOC.BENHVIEN_ID = '$BENHVIEN_ID$' and TM_DUOC.DUOC_ID = '$DUOC_ID$'  and TM_DUOC.TAMNGUNG = '0'  and TM_DUOC.BENHVIEN = '1'
        </statement>
        <!--Revision:0,d2c7d609ec8e218806635c000663c103-->
        <statement id="DAO00027_GetListDuocTonKhoCOM18" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
          select  distinct TT_TONKHO.DUOC_KEY, LTRIM(TT_TONKHO.KHODUOC_ID) as KHODUOC_ID, TM_DUOC.DUOC_ID, TM_LOAIDUOC.MALOAIDUOC,TM_DUOC.SOVISA,TM_DUOC.TYLE_VAT,TM_DUOC.COTOA,
          TM_DUOC.MADUOC, TM_DUOC.TENHANG, TM_DUOC.TENDUOCDAYDU, TM_DUOC.DONVITINH, TM_DUOC.DONVITINH_ID, TM_DUOC.BHYT,
          TM_DUOC.TENHOATCHAT, TM_DUOC.HAMLUONG, TM_DUOC.HANGSANXUAT, TM_DUOC.QUOCGIA, TM_DUOC.LOAIDUOC_ID, TM_DUOC.DUONGDUNG_ID,
          TO_CHAR(TM_TENDUOC.TENDUOC) TENDUOC, TM_TENDUOC.TENDUOC_EN, TM_TENDUOC.MAQUOCTE, TM_TENDUOC.MAQUOCTEBT,
          TM_LOAIDUOC.LOAIVATTU_ID, TM_DUOC.BENHVIEN_ID,
          TT_TONKHO.SOLUONG, TM_DUOC.VTYT_PHANLOAI, TM_DUOC.PHAMVI, TT_TONKHO.NGUONDUOC_ID, NG.TENNGUONDUOC
          from TM_DUOC
          left join TM_TENDUOC on TM_DUOC.TENDUOC_ID = TM_TENDUOC.TENDUOC_ID and TM_DUOC.BENHVIEN_ID = '$BENHVIEN_ID$'  and TM_DUOC.TAMNGUNG = '0'
          left join TM_LOAIDUOC on TM_LOAIDUOC.LOAIDUOC_ID = TM_DUOC.LOAIDUOC_ID and TM_LOAIDUOC.BENHVIEN_ID = '$BENHVIEN_ID$'
          left join TM_DUOC_HANDUNG on (TM_LOAIDUOC.LOAIVATTU_ID = TM_DUOC_HANDUNG.LOAIDUOC and TM_DUOC_HANDUNG.BENHVIEN_ID = '$BENHVIEN_ID$')
          inner join
          (select LTRIM(A.KHODUOC_ID) || '_' || LTRIM(A.DUOC_ID) || '_' || LTRIM(NVL(A.NGUONDUOC_ID,'')) as DUOC_KEY, A.KHODUOC_ID, A.DUOC_ID ,a.NGUONDUOC_ID,
          SUM(NVL(A.SOLUONG,0)) as SOLUONG
          from
          (select SUM(SOLUONG) as SOLUONG, KHODUOC_ID, DUOC_ID, NGUONDUOC_ID from TT_DUOC_TONKHO
          where KHODUOC_ID in ($KHODUOC_ID$) and DUOC_ID in ($DUOC_ID$) group by KHODUOC_ID, DUOC_ID, NGUONDUOC_ID
          ) A
          where A.KHODUOC_ID in ($KHODUOC_ID$) and A.DUOC_ID in ($DUOC_ID$)
          group by LTRIM(A.KHODUOC_ID) || '_' ||  LTRIM(A.DUOC_ID) || '_' || LTRIM(A.NGUONDUOC_ID), A.KHODUOC_ID, A.DUOC_ID, A.NGUONDUOC_ID)
          TT_TONKHO on TT_TONKHO.DUOC_ID = TM_DUOC.DUOC_ID
          LEFT JOIN TM_NGUONHANG NG ON NG.NGUONDUOC_ID = TT_TONKHO.NGUONDUOC_ID
          where TM_DUOC.BENHVIEN_ID = '$BENHVIEN_ID$' and TM_DUOC.DUOC_ID in ($DUOC_ID$)  and TM_DUOC.TAMNGUNG = '0'
        </statement>
        <!--Revision:0,a615893b0b2a42d70e634fe46eee43d2-->
        <statement id="DAO00027_GetListDuocTonKhoCOM70" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
          select  distinct TT_TONKHO.DUOC_KEY, LTRIM(TT_TONKHO.KHODUOC_ID) as KHODUOC_ID, TM_DUOC.DUOC_ID, TM_LOAIDUOC.MALOAIDUOC,TM_DUOC.SOVISA,TM_DUOC.TYLE_VAT,TM_DUOC.COTOA,
          TM_DUOC.MADUOC, TM_DUOC.TENHANG, TM_DUOC.TENDUOCDAYDU, TM_DUOC.DONVITINH, TM_DUOC.DONVITINH_ID, TM_DUOC.BHYT,
          TM_DUOC.TENHOATCHAT, TM_DUOC.HAMLUONG, TM_DUOC.HANGSANXUAT, TM_DUOC.QUOCGIA, TM_DUOC.LOAIDUOC_ID, TM_DUOC.DUONGDUNG_ID,
          TO_CHAR(TM_TENDUOC.TENDUOC) TENDUOC, TM_TENDUOC.TENDUOC_EN, TM_TENDUOC.MAQUOCTE, TM_TENDUOC.MAQUOCTEBT,
          TM_LOAIDUOC.LOAIVATTU_ID, TM_DUOC.BENHVIEN_ID,
          TT_TONKHO.SOLUONG, TM_DUOC.VTYT_PHANLOAI, TM_DUOC.PHAMVI, TT_TONKHO.NGUONDUOC_ID, NG.TENNGUONDUOC
          from TM_DUOC
          left join TM_TENDUOC on TM_DUOC.TENDUOC_ID = TM_TENDUOC.TENDUOC_ID and TM_DUOC.BENHVIEN_ID = '$BENHVIEN_ID$'  and TM_DUOC.TAMNGUNG = '0'
          left join TM_LOAIDUOC on TM_LOAIDUOC.LOAIDUOC_ID = TM_DUOC.LOAIDUOC_ID and TM_LOAIDUOC.BENHVIEN_ID = '$BENHVIEN_ID$'
          left join TM_DUOC_HANDUNG on (TM_LOAIDUOC.LOAIVATTU_ID = TM_DUOC_HANDUNG.LOAIDUOC and TM_DUOC_HANDUNG.BENHVIEN_ID = '$BENHVIEN_ID$')
          inner join
          (select LTRIM(A.KHODUOC_ID) || '_' || LTRIM(A.DUOC_ID) || '_' || LTRIM(NVL(A.NGUONDUOC_ID,'')) as DUOC_KEY, A.KHODUOC_ID, A.DUOC_ID,A.NGUONDUOC_ID,
          SUM(NVL(A.SOLUONG,0)) as SOLUONG
          from
          (select SUM(SOLUONG) as SOLUONG, KHODUOC_ID, DUOC_ID, NGUONDUOC_ID from TT_DUOC_TONKHO
          where KHODUOC_ID in ($KHODUOC_ID$) and DUOC_ID in ($DUOC_ID$) group by KHODUOC_ID, DUOC_ID, NGUONDUOC_ID
          ) A
          where A.KHODUOC_ID in ($KHODUOC_ID$) and A.DUOC_ID in ($DUOC_ID$)
          group by LTRIM(A.KHODUOC_ID) || '_' ||  LTRIM(A.DUOC_ID) || '_' || LTRIM(A.NGUONDUOC_ID), A.KHODUOC_ID, A.DUOC_ID, A.NGUONDUOC_ID)
          TT_TONKHO on TT_TONKHO.DUOC_ID = TM_DUOC.DUOC_ID
          LEFT JOIN TM_NGUONHANG NG ON NG.NGUONDUOC_ID = TT_TONKHO.NGUONDUOC_ID
          where TM_DUOC.BENHVIEN_ID = '$BENHVIEN_ID$' and TM_DUOC.DUOC_ID in ($DUOC_ID$)  and TM_DUOC.TAMNGUNG = '0'
        </statement>
        <!--Revision:0,48866e28666c1553c72b5f006e5849a6-->
        <statement id="DAO00027_GetListDuocTonKhoVaBooking" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
          select  distinct tk.DUOC_KEY, LTRIM(tk.KHODUOC_ID) as KHODUOC_ID, tk.NGUONDUOC_ID, nh.TENNGUONDUOC, nh.TINHTIEN, d.DUOC_ID, ld.MALOAIDUOC,
          d.SOVISA,d.TYLE_VAT,d.COTOA, d.MADUOC, d.TENHANG, TO_CHAR(d.TENDUOCDAYDU) TENDUOCDAYDU, d.DONVITINH, d.BHYT,
          d.TENHOATCHAT, d.HAMLUONG, d.HANGSANXUAT, d.QUOCGIA, d.LOAIDUOC_ID, d.DUONGDUNG_ID, d.TINHTIEN_PTTT,
          TO_CHAR(ten.TENDUOC) AS TENDUOC, ten.TENDUOC_EN, ten.MAQUOCTE, ten.MAQUOCTEBT,
          CASE WHEN d.BHYT = '1' THEN 'BHYT' ELSE '' END as BHYT_TEXT
          , ld.LOAIVATTU_ID
          , d.BENHVIEN_ID,
          tk.SOLUONG, d.TAMNGUNG, d.VTYT_PHANLOAI, d.PHAMVI
          from TM_DUOC d
          left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID and d.BENHVIEN_ID = '$BENHVIEN_ID$'  and d.TAMNGUNG = '0'  and d.BENHVIEN = '1'
          left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = '$BENHVIEN_ID$'
          left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = '$BENHVIEN_ID$')
          inner join
          (
          select LTRIM(A.KHODUOC_ID) || '_' || LTRIM(A.DUOC_ID) || '_' || LTRIM(NVL(A.NGUONDUOC_ID,'')) as DUOC_KEY, A.KHODUOC_ID, A.NGUONDUOC_ID, A.DUOC_ID, SUM(NVL(A.SOLUONG,0) - NVL(E.SOLUONG,0) - NVL(F.SOLUONG,0)) as SOLUONG
          from
          (
          select SUM(SOLUONG) as SOLUONG, KHODUOC_ID, NGUONDUOC_ID, DUOC_ID
          from TT_DUOC_TONKHO where BENHVIEN_ID = '$BENHVIEN_ID$' group by KHODUOC_ID, NGUONDUOC_ID, DUOC_ID
          ) A
          left join
          (
          select SUM(SOLUONG) as SOLUONG, KHODUOC_ID, DUOC_ID
          from TT_DUOC_TONKHO_BOOK_NGOAITRU where TRANGTHAI != 'HUY' and BENHVIEN_ID = '$BENHVIEN_ID$' group by KHODUOC_ID, DUOC_ID
          ) E on A.KHODUOC_ID = E.KHODUOC_ID and A.DUOC_ID = E.DUOC_ID
          left join
          (
          select SUM(SOLUONG) as SOLUONG, KHODUOC_ID, DUOC_ID
          from TT_DUOC_TONKHO_BOOK_NOITRU where TRANGTHAI != 'HUY' and BENHVIEN_ID = '$BENHVIEN_ID$' group by KHODUOC_ID, DUOC_ID
          ) F on A.KHODUOC_ID = F.KHODUOC_ID and A.DUOC_ID = F.DUOC_ID
          group by LTRIM(A.KHODUOC_ID) || '_' || LTRIM(A.DUOC_ID) || '_' || LTRIM(NVL(A.NGUONDUOC_ID,'')), A.KHODUOC_ID, A.NGUONDUOC_ID, A.DUOC_ID
          ) tk on tk.DUOC_ID = d.DUOC_ID
          left join TM_KHODUOC kd on kd.KHODUOC_ID = tk.KHODUOC_ID and kd.BENHVIEN_ID = '$BENHVIEN_ID$'
          left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = tk.NGUONDUOC_ID and nh.BENHVIEN_ID = '$BENHVIEN_ID$'
          where tk.SOLUONG &gt;= 0 and d.BENHVIEN_ID = '$BENHVIEN_ID$'
            <!--and d.TAMNGUNG = '0'-->
            <!--
      and ((ld.LOAIVATTU_ID = 'V' and kd.MAKHO = '$MAKHO_VTYT$')
      or (ld.LOAIVATTU_ID = 'H' and kd.MAKHO = '$MAKHO_HC$')
      or (ld.LOAIVATTU_ID = 'T' and kd.MAKHO not in ('$MAKHO_VTYT$', '$MAKHO_HC$')))
      -->
        </statement>
        <!--Revision:0,5cc90e0a00b6e1b07d1ec2a07e0f4f84-->
        <statement id="DAO00027_GetListDuocTonKhoVaBookingCOM23" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
          select  distinct tk.DUOC_KEY, LTRIM(tk.KHODUOC_ID) as KHODUOC_ID, tk.NGUONDUOC_ID, nh.TENNGUONDUOC, nh.TINHTIEN, d.DUOC_ID, ld.MALOAIDUOC,
          d.SOVISA,d.TYLE_VAT,d.COTOA, d.MADUOC, d.TENHANG, TO_CHAR(d.TENDUOCDAYDU) TENDUOCDAYDU, d.DONVITINH, d.BHYT,
          d.TENHOATCHAT, d.HAMLUONG, d.HANGSANXUAT, d.QUOCGIA, d.LOAIDUOC_ID, d.DUONGDUNG_ID, d.TINHTIEN_PTTT,
          TO_CHAR(ten.TENDUOC) AS TENDUOC, ten.TENDUOC_EN, ten.MAQUOCTE, ten.MAQUOCTEBT,
          CASE WHEN d.BHYT = '1' THEN 'BHYT' ELSE '' END as BHYT_TEXT
          , ld.LOAIVATTU_ID
          , d.BENHVIEN_ID,
          tk.SOLUONG, d.TAMNGUNG, d.VTYT_PHANLOAI, d.PHAMVI
          from TM_DUOC d
          left join TM_TENDUOC ten on d.TENDUOC_ID = ten.TENDUOC_ID and d.BENHVIEN_ID = '$BENHVIEN_ID$'  and d.TAMNGUNG = '0'  and d.BENHVIEN = '1'
          left join TM_LOAIDUOC ld on ld.LOAIDUOC_ID = d.LOAIDUOC_ID and ld.BENHVIEN_ID = '$BENHVIEN_ID$'
          left join TM_DUOC_HANDUNG hd on (ld.LOAIVATTU_ID = hd.LOAIDUOC  and hd.BENHVIEN_ID = '$BENHVIEN_ID$')
          inner join
          (
          select LTRIM(A.KHODUOC_ID) || '_' || LTRIM(A.DUOC_ID) || '_' || LTRIM(NVL(A.NGUONDUOC_ID,'')) as DUOC_KEY, A.KHODUOC_ID, A.NGUONDUOC_ID, A.DUOC_ID, SUM(NVL(A.SOLUONG,0) - NVL(E.SOLUONG,0) - NVL(F.SOLUONG,0)) as SOLUONG
          from
          (
          select SUM(SOLUONG) as SOLUONG, KHODUOC_ID, NGUONDUOC_ID, DUOC_ID
          from TT_DUOC_TONKHO where BENHVIEN_ID = '$BENHVIEN_ID$' group by KHODUOC_ID, NGUONDUOC_ID, DUOC_ID
          ) A
          left join
          (
          select SUM(SOLUONG) as SOLUONG, KHODUOC_ID, DUOC_ID
          from TT_DUOC_TONKHO_BOOK_NGOAITRU where TRANGTHAI != 'HUY' and BENHVIEN_ID = '$BENHVIEN_ID$' group by KHODUOC_ID, DUOC_ID
          ) E on A.KHODUOC_ID = E.KHODUOC_ID and A.DUOC_ID = E.DUOC_ID
          left join
          (
          select SUM(SOLUONG) as SOLUONG, KHODUOC_ID, DUOC_ID
          from TT_DUOC_TONKHO_BOOK_NOITRU where TRANGTHAI != 'HUY' and BENHVIEN_ID = '$BENHVIEN_ID$' group by KHODUOC_ID, DUOC_ID
          ) F on A.KHODUOC_ID = F.KHODUOC_ID and A.DUOC_ID = F.DUOC_ID
          group by LTRIM(A.KHODUOC_ID) || '_' || LTRIM(A.DUOC_ID) || '_' || LTRIM(NVL(A.NGUONDUOC_ID,'')), A.KHODUOC_ID, A.NGUONDUOC_ID, A.DUOC_ID
          ) tk on tk.DUOC_ID = d.DUOC_ID
          left join TM_KHODUOC kd on kd.KHODUOC_ID = tk.KHODUOC_ID and kd.BENHVIEN_ID = '$BENHVIEN_ID$'
          left join TM_NGUONHANG nh on nh.NGUONDUOC_ID = tk.NGUONDUOC_ID and nh.BENHVIEN_ID = '$BENHVIEN_ID$'
          where tk.SOLUONG &gt;= 0 and d.BENHVIEN_ID = '$BENHVIEN_ID$' and d.DUOC_ID in ($DUOC_ID$) and TK.KHODUOC_ID in ($KHODUOC_ID$)
       
        </statement>
        <!--Revision:0,3969e186d69a87544867f07fbd748c33-->
        <statement id="DAO00027_GetListDuyetToaThuoc" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
            select distinct A.SOTIEPNHAN, A.TRAITUYEN, A.NGAYMIENDONGCHITRA, A.TIEPNHAN_ID, A.DOITUONG_ID,
            A.LOAITHANHVIEN_ID, A.SUDUNG_BHTN, A.THE_ID, A.THANHVIEN_ID, A.VIP, A.NGUON_BENHNHAN_ID, A.BAOLANH_VIENPHI,
            B.*, 'NGOAITRU' as LOAITOA, C.KHOXUAT_ID as KHOXUAT_ID
            from TT_NGOAITRU_KHAMBENH_TOATHUOC C
            inner join TT_NGOAITRU_KHAMBENH D on C.KHAMBENH_ID = D.KHAMBENH_ID
            inner join TT_TIEPNHAN A on D.TIEPNHAN_ID = A.TIEPNHAN_ID <!--and (A.TRANGTHAI = 'DATIEPNHAN' or A.TRANGTHAI = 'NOITRU' or A.TRANGTHAI = 'CAPCUU' or A.TRANGTHAI = 'NGOAITRU')-->
            inner join TT_BENHNHAN B on B.BENHNHAN_ID = A.BENHNHAN_ID
            where C.DUYET = '1' and C.TRANGTHAI = 'CHUAXUAT' and C.BENHVIEN_ID = '$BENHVIEN_ID$' and (C.LOAITOATHUOC = 'BV' or C.LOAITOATHUOC = 'MP')
            union
            select distinct A.SOTIEPNHAN, A.TRAITUYEN, A.NGAYMIENDONGCHITRA, A.TIEPNHAN_ID, A.DOITUONG_ID,
            A.LOAITHANHVIEN_ID, A.SUDUNG_BHTN, A.THE_ID, A.THANHVIEN_ID, A.VIP, A.NGUON_BENHNHAN_ID, A.BAOLANH_VIENPHI,
            B.*, 'MUANGOAI' as LOAITOA, C.KHOXUAT_ID as KHOXUAT_ID
            from TT_NGOAITRU_KHAMBENH_TOATHUOC C
            inner join TT_NGOAITRU_KHAMBENH D on C.KHAMBENH_ID = D.KHAMBENH_ID
            inner join TT_TIEPNHAN A on D.TIEPNHAN_ID = A.TIEPNHAN_ID <!--and (A.TRANGTHAI = 'DATIEPNHAN' or A.TRANGTHAI = 'NOITRU' or A.TRANGTHAI = 'CAPCUU' or A.TRANGTHAI = 'NGOAITRU')-->
            inner join TT_BENHNHAN B on B.BENHNHAN_ID = A.BENHNHAN_ID
            where C.DUYET = '1' and C.TRANGTHAI = 'CHUAXUAT' and C.BENHVIEN_ID = '$BENHVIEN_ID$' and (A.SOBHYT is null or A.SOBHYT = '')
            union
            select distinct A.SOTIEPNHAN, A.TRAITUYEN, A.NGAYMIENDONGCHITRA, A.TIEPNHAN_ID, A.DOITUONG_ID,
            A.LOAITHANHVIEN_ID, A.SUDUNG_BHTN, A.THE_ID, A.THANHVIEN_ID, A.VIP, A.NGUON_BENHNHAN_ID, A.BAOLANH_VIENPHI,
            B.*, 'NOITRU' as LOAITOA, C.KHOPHAT_ID as KHOXUAT_ID
            from TT_NOITRU_TOATHUOC C
            inner join TT_TIEPNHAN A on C.TIEPNHAN_ID = A.TIEPNHAN_ID and (A.TRANGTHAI = 'DATIEPNHAN' or A.TRANGTHAI = 'NOITRU' or A.TRANGTHAI = 'CAPCUU' or A.TRANGTHAI = 'NGOAITRU')
            inner join TT_BENHNHAN B on B.BENHNHAN_ID = A.BENHNHAN_ID
            where (C.TRANGTHAI = 'DADUYET' or C.TRANGTHAI = 'CHUAXUAT') and C.BENHVIEN_ID = '$BENHVIEN_ID$' and (A.SOBHYT is not null)
            union
            select distinct A.SOTIEPNHAN, A.TRAITUYEN, A.NGAYMIENDONGCHITRA, A.TIEPNHAN_ID, A.DOITUONG_ID,
            A.LOAITHANHVIEN_ID, A.SUDUNG_BHTN, A.THE_ID, A.THANHVIEN_ID, A.VIP, A.NGUON_BENHNHAN_ID, A.BAOLANH_VIENPHI,
            B.*, 'MUANGOAI' as LOAITOA, C.KHOPHAT_ID as KHOXUAT_ID
            from TT_NOITRU_TOATHUOC C
            inner join TT_TIEPNHAN A on C.TIEPNHAN_ID = A.TIEPNHAN_ID and (A.TRANGTHAI = 'DATIEPNHAN' or A.TRANGTHAI = 'NOITRU' or A.TRANGTHAI = 'CAPCUU' or A.TRANGTHAI = 'NGOAITRU')
            inner join TT_BENHNHAN B on B.BENHNHAN_ID = A.BENHNHAN_ID
            inner join TT_NOITRU_BENHAN D on D.TIEPNHAN_ID = C.TIEPNHAN_ID
            where (C.TRANGTHAI = 'DADUYET' or C.TRANGTHAI = 'CHUAXUAT') and C.BENHVIEN_ID = '$BENHVIEN_ID$' and (A.SOBHYT is null or A.SOBHYT = '') and D.TRANGTHAI != 'DANGDIEUTRI'
        </statement>
        <!--Revision:0,a45a294c852dc27877ee9971a8d3c9d7-->
        <statement id="DAO00027_GetListDuyetToaThuocBHYTCOM24_Ngoai" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
            select distinct A.SOTIEPNHAN, A.TRAITUYEN, A.NGAYMIENDONGCHITRA, A.TIEPNHAN_ID, A.DOITUONG_ID,
            A.LOAITHANHVIEN_ID, A.SUDUNG_BHTN, A.THE_ID, A.THANHVIEN_ID, A.VIP, A.NGUON_BENHNHAN_ID, A.BAOLANH_VIENPHI,
            B.*, 'NGOAITRU' as LOAITOA, C.KHOXUAT_ID as KHOXUAT_ID
            from TT_NGOAITRU_KHAMBENH_TOATHUOC C
            inner join TT_NGOAITRU_KHAMBENH D on C.KHAMBENH_ID = D.KHAMBENH_ID
            inner join TT_TIEPNHAN A on D.TIEPNHAN_ID = A.TIEPNHAN_ID and (A.TRANGTHAI = 'DATIEPNHAN' or A.TRANGTHAI = 'NOITRU' or A.TRANGTHAI = 'CAPCUU' or A.TRANGTHAI = 'NGOAITRU')
            inner join TT_BENHNHAN B on B.BENHNHAN_ID = A.BENHNHAN_ID
            where C.DUYET = '1' and C.TRANGTHAI = 'CHUAXUAT' and C.BENHVIEN_ID = '$BENHVIEN_ID$' and C.KHAMBENH_TOATHUOC_ID = '$KHAMBENH_TOATHUOC_ID$' and (C.LOAITOATHUOC = 'BV' or C.LOAITOATHUOC = 'MP')
            <!--(A.SOBHYT is not null or A.SOBHYT != '')-->
        </statement>
        <!--Revision:0,d4880d456ee7e65c764680ff080348cc-->
        <statement id="DAO00027_GetListDuyetToaThuocBHYTCOM24_Noi" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
          select distinct A.SOTIEPNHAN, A.TRAITUYEN, A.NGAYMIENDONGCHITRA, A.TIEPNHAN_ID, A.DOITUONG_ID,
          A.LOAITHANHVIEN_ID, A.SUDUNG_BHTN, A.THE_ID, A.THANHVIEN_ID, A.VIP, A.NGUON_BENHNHAN_ID, A.BAOLANH_VIENPHI,
          B.*, 'NOITRU' as LOAITOA, C.KHOPHAT_ID as KHOXUAT_ID
          from TT_NOITRU_TOATHUOC C
          inner join TT_TIEPNHAN A on C.TIEPNHAN_ID = A.TIEPNHAN_ID and (A.TRANGTHAI = 'DATIEPNHAN' or A.TRANGTHAI = 'NOITRU' or A.TRANGTHAI = 'CAPCUU' or A.TRANGTHAI = 'NGOAITRU')
          inner join TT_BENHNHAN B on B.BENHNHAN_ID = A.BENHNHAN_ID
          where (C.TRANGTHAI = 'DADUYET' or C.TRANGTHAI = 'CHUAXUAT' or C.TRANGTHAI = 'DAXUAT') and C.BENHVIEN_ID = '$BENHVIEN_ID$' and C.KHAMBENH_ID = '$KHAMBENH_TOATHUOC_ID$' and (A.SOBHYT is not null)
        </statement>
        <!--Revision:0,81905d86b92156c8cf6580b005b98405-->
        <statement id="DAO00027_GetListDuyetToaThuocBHYTCOM24_MuaNgoai" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
          select distinct A.SOTIEPNHAN, A.TRAITUYEN, A.NGAYMIENDONGCHITRA, A.TIEPNHAN_ID, A.DOITUONG_ID,
          A.LOAITHANHVIEN_ID, A.SUDUNG_BHTN, A.THE_ID, A.THANHVIEN_ID, A.VIP, A.NGUON_BENHNHAN_ID, A.BAOLANH_VIENPHI,
          B.*, 'MUANGOAI' as LOAITOA, C.KHOXUAT_ID as KHOXUAT_ID
          from TT_NGOAITRU_KHAMBENH_TOATHUOC C
          inner join TT_NGOAITRU_KHAMBENH D on C.KHAMBENH_ID = D.KHAMBENH_ID
          inner join TT_TIEPNHAN A on D.TIEPNHAN_ID = A.TIEPNHAN_ID and (A.TRANGTHAI = 'DATIEPNHAN' or A.TRANGTHAI = 'NOITRU' or A.TRANGTHAI = 'CAPCUU' or A.TRANGTHAI = 'NGOAITRU')
          inner join TT_BENHNHAN B on B.BENHNHAN_ID = A.BENHNHAN_ID
          where C.DUYET = '1' and C.TRANGTHAI = 'CHUAXUAT' and C.BENHVIEN_ID = '$BENHVIEN_ID$' and C.KHAMBENH_TOATHUOC_ID = '$KHAMBENH_TOATHUOC_ID$' and C.LOAITOATHUOC = 'MN'
          union
          select distinct A.SOTIEPNHAN, A.TRAITUYEN, A.NGAYMIENDONGCHITRA, A.TIEPNHAN_ID, A.DOITUONG_ID,
          A.LOAITHANHVIEN_ID, A.SUDUNG_BHTN, A.THE_ID, A.THANHVIEN_ID, A.VIP, A.NGUON_BENHNHAN_ID, A.BAOLANH_VIENPHI,
          B.*, 'MUANGOAI' as LOAITOA, C.KHOPHAT_ID as KHOXUAT_ID
          from TT_NOITRU_TOATHUOC C
          inner join TT_TIEPNHAN A on C.TIEPNHAN_ID = A.TIEPNHAN_ID and (A.TRANGTHAI = 'DATIEPNHAN' or A.TRANGTHAI = 'NOITRU' or A.TRANGTHAI = 'CAPCUU' or A.TRANGTHAI = 'NGOAITRU')
          inner join TT_BENHNHAN B on B.BENHNHAN_ID = A.BENHNHAN_ID
          inner join TT_NOITRU_BENHAN D on D.TIEPNHAN_ID = C.TIEPNHAN_ID
          inner join TT_NOITRU_KHAMBENH KB on KB.KHAMBENH_ID = C.KHAMBENH_ID
          where (C.TRANGTHAI = 'DADUYET' or C.TRANGTHAI = 'CHUAXUAT' or C.TRANGTHAI = 'DAXUAT') and C.BENHVIEN_ID = '$BENHVIEN_ID$' and C.KHAMBENH_ID = '$KHAMBENH_TOATHUOC_ID$' and KB.ISTHUOCBV = '0' and D.TRANGTHAI != 'DANGDIEUTRI'
        </statement>
        <!--Revision:0,0b99c2cb54a7c2224237eab97485db8b-->
        <statement id="DAO00027_GetListVatTuYteKTC" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
            SELECT DV.*
            FROM TM_DICHVU_VATTU DV
            INNER JOIN TM_DUOC D ON D.DUOC_ID = DV.DUOC_ID AND D.TAMNGUNG = '0' AND D.BENHVIEN_ID = '$BENHVIEN_ID$'
            WHERE
            DV.TAMNGUNG = '0'
            AND DICHVU_ID in
            (
            select DICHVU_ID from TM_DICHVU_PHANNHOMDICHVU
            where PHANNHOMDICHVU_ID in (select PHANNHOMDICHVU_ID from TM_PHANNHOMDICHVU where MAPHANNHOMDICHVU = 'KTC')
            )
            AND DV.BENHVIEN_ID = '$BENHVIEN_ID$'
        </statement>
        <!--Revision:0,28db8ed05a8bb33560704ad7e42926a6-->
        <statement id="DAO00027_GetListVatTuYtelaStent" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
            select * from TM_DUOC where TAMNGUNG = '0' AND BENHVIEN_ID = '$BENHVIEN_ID$' and VTYT_PHANLOAI = '1'
        </statement>
        <!--Revision:0,3be57b869d2beeb2aadaa8766d5c366c-->
        <statement id="DAO00027_GetListVatTuYtelaHatViCau" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
            select * from TM_DUOC where TAMNGUNG = '0' AND BENHVIEN_ID = '$BENHVIEN_ID$' and VTYT_PHANLOAI = '2'
        </statement>
        <!--Revision:0,f4aa26c70eb750b98e42c0f18dfd6805-->
        <statement id="DAO00027_GetListDichVuPhauThuat" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
            select * from TM_DICHVU
            where
            NHOMDICHVU_ID in (select NHOMDICHVU_ID from TM_NHOMDICHVU where SUBSTR(MANHOMDICHVU, 0, 2) = '05' and BENHVIEN_ID = '$BENHVIEN_ID$')
        </statement>
        <!--Revision:0,7d506d7f88e088d51d0dc806dc4469e8-->
        <statement id="DAO00027_GetSysAppSettings_WithCode" resultClass="DataObject">
            select VALUE
            from TM_SYS_APPSETTINGS
            where CODE = '$CODE$' and BENHVIEN_ID = '$BENHVIEN_ID$'
        </statement>
        <!--Revision:0,76b50b0ab7d42ca5e83f0c9269bc109d-->
        <statement id="DAO00027_GetWORKFLOWPROCESS_NOITRU" resultClass="DataObject">
            select VALUE
            from TM_SYS_APPSETTINGS
            where CODE = 'WorkFlow_NoiTru_Process';
        </statement>
        <!--Revision:0,506cdeecf9d7dad3b23207fbc72e3401-->
        <statement id="DAO00027_GetList_Ex" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
            select *
            from TM_SYS_APPSETTINGS
            <dynamic prepend="where">
                <isParameterPresent>
                    <isNotEmpty prepend="and" property="SETTING_ID">
                        TM_SYS_APPSETTINGS.SETTING_ID = '$SETTING_ID$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="CODE">
                        TM_SYS_APPSETTINGS.CODE = '$CODE$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="LANGUAGE_ID">
                        TM_SYS_APPSETTINGS.LANGUAGE_ID = '$LANGUAGE_ID$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="VALUE">
                        TM_SYS_APPSETTINGS.VALUE = '$VALUE$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="DESCRIPTION">
                        TM_SYS_APPSETTINGS.DESCRIPTION = '$DESCRIPTION$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="LOCKED">
                        TM_SYS_APPSETTINGS.LOCKED = '$LOCKED$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="TYPE">
                        TM_SYS_APPSETTINGS.TYPE = '$TYPE$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="CREATIONDATE">
                        TM_SYS_APPSETTINGS.CREATIONDATE = '$CREATIONDATE$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="CREATEDBY">
                        TM_SYS_APPSETTINGS.CREATEDBY = '$CREATEDBY$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="LASTUPDATEDATE">
                        TM_SYS_APPSETTINGS.LASTUPDATEDATE = '$LASTUPDATEDATE$'
                    </isNotEmpty>
                    <isNotEmpty prepend="and" property="LASTUPDATEDBY">
                        TM_SYS_APPSETTINGS.LASTUPDATEDBY = '$LASTUPDATEDBY$'
                    </isNotEmpty>
                </isParameterPresent>
            </dynamic>
            order by SETTING_ID
        </statement>
        <!--Revision:0,b700e4d6e1e5f37afd0001e24fd5b691-->
        <statement id="DAO00027_GetListDichVuLoaiThanhVien" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
            select *
            from TT_CSKH_THETHANHVIEN_SUDUNG
            where THE_ID = '$THE_ID$' and  BENHVIEN_ID = '$BENHVIEN_ID$'
            <!--and ((SOLANDINHMUC - SOLANDASUDUNG) > 0)-->
        </statement>
        <!--Revision:0,188635f2b5b1bcce3735248d39b8a350-->
        <update id="DAO00027_UpdateDoiTuongTiepNhan" parameterClass="System.Collections.IDictionary">
            update TT_TIEPNHAN set
            BENHNHAN_ID = '$BENHNHAN_ID$'
            <isNotEmpty prepend="," property="DOITUONG_ID">
                DOITUONG_ID = #DOITUONG_ID#
                , SOBHYT = #SOBHYT#
                , BHYTTUNGAY = #BHYTTUNGAY#
                , BHYTDENNGAY = #BHYTDENNGAY#
                , BHYTNGAYCAP = #BHYTNGAYCAP#
                , TRAITUYEN = #TRAITUYEN#
                , NGUON_BENHNHAN_ID = #NGUON_BENHNHAN_ID#
                , NGAYCAPNHAT = #NGAYCAPNHAT#
                , NGUOICAPNHAT_ID = #NGUOICAPNHAT_ID#
            </isNotEmpty>
            <isNotEmpty prepend="," property="SUDUNG_BHTN">
                SUDUNG_BHTN = #SUDUNG_BHTN#
            </isNotEmpty>
            <isNotEmpty prepend="," property="BAOLANH_VIENPHI">
                BAOLANH_VIENPHI = #BAOLANH_VIENPHI#
            </isNotEmpty>
            <isNotEmpty prepend="," property="BHYTTREN5NAM">
                BHYTTREN5NAM = #BHYTTREN5NAM#
            </isNotEmpty>
            <isNotEmpty prepend="," property="NGAYMIENDONGCHITRA">
                NGAYMIENDONGCHITRA = #NGAYMIENDONGCHITRA#
            </isNotEmpty>
            where
            TIEPNHAN_ID = '$TIEPNHAN_ID$'
        </update>
        <!--Revision:0,4a1d6ada8de2bb626da50df5e2715d66-->
        <update id="DAO00027_UpdateTheThanhVienTiepNhan" parameterClass="System.Collections.IDictionary">
            update TT_TIEPNHAN set
            BENHNHAN_ID = '$BENHNHAN_ID$'
            , THANHVIEN_ID = '$THANHVIEN_ID$'
            , LOAITHANHVIEN_ID = '$LOAITHANHVIEN_ID$'
            , THE_ID = '$THE_ID$'
            , NGAYCAPNHAT = #NGAYCAPNHAT#
            , NGUOICAPNHAT_ID = #NGUOICAPNHAT_ID#
            where
            TIEPNHAN_ID = '$TIEPNHAN_ID$'
        </update>
        <!--Revision:0,e37bac2cbcb6ec5ee0b9ada133ca1812-->
        <statement id="DAO00027_GetListCacheTiepNhanNgoaiTru" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
          select distinct B.*, C.SOBENHAN, C.BENHAN_ID, A.SOTIEPNHAN, A.TRAITUYEN, A.NGAYMIENDONGCHITRA, A.TIEPNHAN_ID,
          NVL(C.KHOACHUYENDEN_ID,C.KHOAVAO_ID) as KHOACHUYENDEN_ID, A.TRANGTHAI, A.DOITUONG_ID, C.TRANGTHAI as TRANGTHAI_BENHAN,
          A.LOAITHANHVIEN_ID, A.SUDUNG_BHTN, A.THE_ID, A.THANHVIEN_ID, A.VIP, A.NGUON_BENHNHAN_ID, A.BAOLANH_VIENPHI,
          'NGOAITRU' AS LOAIBENHAN, CONVERT(VARCHAR(11),C.NGAYVAOKHOA,103) as NGAYVAOKHOA
          from TT_TIEPNHAN A
          inner join TT_BENHNHAN B on B.BENHNHAN_ID = A.BENHNHAN_ID and (A.TRANGTHAI = 'HOANTHANH' or A.TRANGTHAI = 'NGOAITRU') and B.ACTIVE = '1'
          inner join TT_NOITRU_BENHAN C on C.TIEPNHAN_ID = A.TIEPNHAN_ID and (C.TRANGTHAI='DAXUATVIEN' or C.TRANGTHAI='DATHANHTOAN' OR C.TRANGTHAI='DANGDIEUTRI')
          where A.BENHVIEN_ID = '$BENHVIEN_ID$' and C.LOAIBENHAN = 2
        </statement>
        <!--Revision:0,b2bc6399598355e050f4d8202816b901-->
        <statement id="DAO00027_GetListCacheTiepNhanNgoaiTruWithTiepNhanId_COM68" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
          select distinct B.*, C.SOBENHAN, C.BENHAN_ID, A.SOTIEPNHAN, A.TRAITUYEN, A.NGAYMIENDONGCHITRA, A.TIEPNHAN_ID,
          NVL(C.KHOACHUYENDEN_ID,C.KHOAVAO_ID) as KHOACHUYENDEN_ID, A.TRANGTHAI, A.DOITUONG_ID, C.TRANGTHAI as TRANGTHAI_BENHAN,
          A.LOAITHANHVIEN_ID, A.SUDUNG_BHTN, A.THE_ID, A.THANHVIEN_ID, A.VIP, A.NGUON_BENHNHAN_ID, A.BAOLANH_VIENPHI,
          'NGOAITRU' AS LOAIBENHAN, CONVERT(VARCHAR(11),C.NGAYVAOKHOA,103) as NGAYVAOKHOA
          from TT_TIEPNHAN A
          inner join TT_BENHNHAN B on B.BENHNHAN_ID = A.BENHNHAN_ID and (A.TRANGTHAI = 'HOANTHANH' or A.TRANGTHAI = 'NGOAITRU') and B.ACTIVE = '1'
          inner join TT_NOITRU_BENHAN C on C.TIEPNHAN_ID = A.TIEPNHAN_ID and (C.TRANGTHAI='DAXUATVIEN' or C.TRANGTHAI='DATHANHTOAN' OR C.TRANGTHAI='DANGDIEUTRI')
          where
          A.TIEPNHAN_ID = '$TIEPNHAN_ID$' and A.BENHVIEN_ID = '$BENHVIEN_ID$' and C.LOAIBENHAN = 2
        </statement>
        <!--Revision:0,44bebbb8cd37b35ed482310797184be4-->
        <statement id="DAO00027_GetListCacheTiepNhanNgoaiTruWithBenhAnId_COM68" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
          select distinct B.*, C.SOBENHAN, C.BENHAN_ID, A.SOTIEPNHAN, A.TRAITUYEN, A.NGAYMIENDONGCHITRA, A.TIEPNHAN_ID,
          NVL(C.KHOACHUYENDEN_ID,C.KHOAVAO_ID) as KHOACHUYENDEN_ID, A.TRANGTHAI, A.DOITUONG_ID, C.TRANGTHAI as TRANGTHAI_BENHAN,
          A.LOAITHANHVIEN_ID, A.SUDUNG_BHTN, A.THE_ID, A.THANHVIEN_ID, A.VIP, A.NGUON_BENHNHAN_ID, A.BAOLANH_VIENPHI,
          'NGOAITRU' AS LOAIBENHAN, CONVERT(VARCHAR(11),C.NGAYVAOKHOA,103) as NGAYVAOKHOA
          from TT_TIEPNHAN A
          inner join TT_BENHNHAN B on B.BENHNHAN_ID = A.BENHNHAN_ID and (A.TRANGTHAI = 'HOANTHANH' or A.TRANGTHAI = 'NGOAITRU') and B.ACTIVE = '1'
          inner join TT_NOITRU_BENHAN C on C.TIEPNHAN_ID = A.TIEPNHAN_ID and (C.TRANGTHAI='DAXUATVIEN' or C.TRANGTHAI='DATHANHTOAN' OR C.TRANGTHAI='DANGDIEUTRI')
          where
          C.BENHAN_ID = '$BENHAN_ID$' and A.BENHVIEN_ID = '$BENHVIEN_ID$' and C.LOAIBENHAN = 2
        </statement>
        <!--Revision:0,dfb09403bcea0d8ff6183fcdcc049695-->
        <statement id="DAO00027_GetListTuongTrinhDichVuPhauThuatCuaTiepNhan" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
            select distinct * from TT_PHAUTHUAT_YEUCAU
            where
            PHAUTHUAT_ID in (select PHAUTHUAT_ID from TT_PHAUTHUAT where TIEPNHAN_ID = '$TIEPNHAN_ID$')
            and NHOMDICHVU_ID in (select NHOMDICHVU_ID from TM_NHOMDICHVU where SUBSTR(MANHOMDICHVU, 0, 2) = '05' and BENHVIEN_ID = '$BENHVIEN_ID$')
        </statement>
        <!--Revision:0,75c6bbd718ee75ffeb45ea256ef6e5e1-->
        <statement id="DAO00027_GetListTuongTrinhVTYTPhauThuatCuaTiepNhan" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
            select distinct * from TT_PHAUTHUAT_VTYT
            where PHAUTHUAT_ID in (select distinct PHAUTHUAT_ID from TT_PHAUTHUAT_YEUCAU
            where
            PHAUTHUAT_ID in (select PHAUTHUAT_ID from TT_PHAUTHUAT where TIEPNHAN_ID = '$TIEPNHAN_ID$')
            and NHOMDICHVU_ID in (select NHOMDICHVU_ID from TM_NHOMDICHVU where SUBSTR(MANHOMDICHVU,0, 2) = '05' and BENHVIEN_ID = '$BENHVIEN_ID$'))
            order by PHAUTHUAT_VTYT_ID asc
        </statement>
        <!--Revision:0,a70a42fe40cf2b79f3508467eaa708e0-->
        <statement id="DAO00027_GetListTiepNhanNgoaiTru" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
            select distinct B.*, C.SOBENHAN, C.BENHAN_ID, A.SOTIEPNHAN, A.TRAITUYEN, A.NGAYMIENDONGCHITRA, A.TIEPNHAN_ID,
            NVL(C.KHOACHUYENDEN_ID,C.KHOAVAO_ID) as KHOACHUYENDEN_ID, A.TRANGTHAI, A.DOITUONG_ID, C.TRANGTHAI as TRANGTHAI_BENHAN,
            A.LOAITHANHVIEN_ID, A.SUDUNG_BHTN, A.THE_ID, A.THANHVIEN_ID, A.VIP, A.NGUON_BENHNHAN_ID, A.BAOLANH_VIENPHI,
            'NGOAITRU' AS LOAIBENHAN
            from TT_TIEPNHAN A
            inner join TT_BENHNHAN B on B.BENHNHAN_ID = A.BENHNHAN_ID and (A.TRANGTHAI = 'HOANTHANH' or A.TRANGTHAI = 'NGOAITRU') and B.ACTIVE = '1'
            inner join TT_NOITRU_BENHAN C on C.TIEPNHAN_ID = A.TIEPNHAN_ID and (C.TRANGTHAI='DAXUATVIEN' or C.TRANGTHAI='DATHANHTOAN' OR C.TRANGTHAI='DANGDIEUTRI')
            where A.BENHVIEN_ID = '$BENHVIEN_ID$' and C.LOAIBENHAN = 2
        </statement>
    </statements>
</sqlMap>
