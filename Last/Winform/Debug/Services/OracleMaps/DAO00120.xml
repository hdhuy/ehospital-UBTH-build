<?xml version="1.0" encoding="utf-8" ?>
<!--============================================================================
//	CAUTION: This file is generated by IBatisNetGen.3.SQLMap.cst at 11/11/2015 9:27:48 AM
//				Any manual editing will be lost in re-generation.
//===========================================================================-->
<sqlMap namespace="eHospital" xmlns="http://ibatis.apache.org/mapping" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" >

  <statements>
    <!--Region Viện phí-->
    <update id="DAO00120_TT_VIENPHI_Update" parameterClass="System.Collections.IDictionary">
      update TT_VIENPHI set
      REF_ID = #REF_ID#
      , REF_TABLE = #REF_TABLE#
      , BHYT_TL = #BHYT_TL#
      , BHYT_DONGIA = #BHYT_DONGIA#
      , BHYT_THANHTIEN = #BHYT_THANHTIEN#
      , BHYT_DONGIA_CHITRA = #BHYT_DONGIA_CHITRA#
      , BHYT_THANHTIEN_CHITRA = #BHYT_THANHTIEN_CHITRA#
      , BENHNHAN_PHAITHANHTOAN = #BENHNHAN_PHAITHANHTOAN#
      , GIATRI_HOADON = #GIATRI_HOADON#
      , GIATRI_HOADON_DATHANHTOAN = #GIATRI_HOADON_DATHANHTOAN#
      , GIATRI_BIENLAI = #GIATRI_BIENLAI#
      , GIATRI_BIENLAI_DATHANHTOAN = #GIATRI_BIENLAI_DATHANHTOAN#
      , GIATRI_BENHNHAN_DATHANHTOAN = #GIATRI_BENHNHAN_DATHANHTOAN#
      , GIATRI_THATTHU = #GIATRI_THATTHU#
      , MIENGIAM_TL = #MIENGIAM_TL#
      , MIENGIAM_GIATRI = #MIENGIAM_GIATRI#
      , BHTN_TL = #BHTN_TL#
      , BHTN_DONGIA = #BHTN_DONGIA#
      , BHTN_THANHTIEN = #BHTN_THANHTIEN#
      , BHTN_DONGIA_CHITRA = #BHTN_DONGIA_CHITRA#
      , BHTN_THANHTIEN_CHITRA = #BHTN_THANHTIEN_CHITRA#
      , NGUOICAPNHAT_ID = #NGUOICAPNHAT_ID#
      , NGAYCAPNHAT = #NGAYCAPNHAT#
      where
      VIENPHI_ID = '$VIENPHI_ID$' AND BENHVIEN_ID = '$BENHVIEN_ID$'
    </update>
    <statement id="DAO00120_TT_VIENPHI_GetList" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
      SELECT VP.*, MG_STATUS.MIENGIAM_STATUS, MG_STATUS.MIENGIAM_DUYET_STATUS
      , MG.MIENGIAM_CHITRA, MGCT.CONGTY_CHITRA, MGTV.THEHOIVIEN_CHITRA, MG_BHTN.BHTN_CHITRA, 0 AS GIATRI_CHITRA, 0 AS TYLE_CHITRA
      , DVYC.HUYYEUCAU, DV.MADICHVU, DV.TENDICHVU, D.MADUOC, D.TENDUOCDAYDU AS TENDUOC, LD.LOAIVATTU_ID, NDV.MANHOMDICHVU
      , NK.MAKHAUPHANAN, NK.TENKHAUPHANAN
      , DATAOBIENLAI = CASE WHEN NVL(HD.SOHOADON,0) != 0 THEN '1' ELSE '0' END  <!--Check tồn tại biên lai tạm hay không-->
      FROM TT_VIENPHI AS VP
      LEFT JOIN TM_DICHVU AS DV ON DV.DICHVU_ID = VP.DICHVU_ID AND VP.REF_TABLE != 'TT_NUT_XACNHANSUATAN_CHITIET'
      LEFT JOIN TM_NUT_KHAUPHANAN AS NK ON NK.KHAUPHANAN_ID = VP.DICHVU_ID AND VP.REF_TABLE = 'TT_NUT_XACNHANSUATAN_CHITIET'
      LEFT JOIN TM_NHOMDICHVU AS NDV ON NDV.NHOMDICHVU_ID = DV.NHOMDICHVU_ID
      LEFT JOIN TM_DUOC AS D ON D.DUOC_ID = VP.DUOC_ID
      LEFT JOIN TM_LOAIDUOC AS LD ON LD.LOAIDUOC_ID = D.LOAIDUOC_ID
      LEFT JOIN TT_DVYEUCAU AS DVYC ON DVYC.DVYEUCAU_ID = VP.REF_ID AND VP.REF_TABLE = 'TT_DVYEUCAU'
      LEFT JOIN TT_NOITRU_TOATHUOC AS IT ON IT.TOATHUOC_ID = VP.REF_ID AND VP.REF_TABLE = 'TT_NOITRU_TOATHUOC'
      LEFT JOIN TT_NGOAITRU_TOATHUOC AS OT ON OT.TOATHUOC_ID = VP.REF_ID AND VP.REF_TABLE = 'TT_NGOAITRU_TOATHUOC'
      LEFT JOIN TT_NGOAITRU_KHAMBENH_TOATHUOC AS OKT ON OKT.KHAMBENH_TOATHUOC_ID = OT.KHAMBENH_TOATHUOC_ID
      LEFT JOIN TT_PHAUTHUAT_VTYT AS PV ON PV.PHAUTHUAT_VTYT_ID = VP.REF_ID AND VP.REF_TABLE = 'TT_PHAUTHUAT_VTYT'
      LEFT JOIN TT_CLSKETQUA_VTYT AS CV ON CV.CLSKETQUA_VTYT_ID = VP.REF_ID AND VP.REF_TABLE = 'TT_CLSKETQUA_VTYT'
      LEFT JOIN TT_NGOAITRU_KHAMBENH_VTYT AS OKV ON OKV.KHAMBENH_VTYT_ID = VP.REF_ID AND VP.REF_TABLE = 'TT_NGOAITRU_KHAMBENH_VTYT'
      LEFT JOIN TT_NUT_XACNHANSUATAN_CHITIET AS NXC ON NXC.XACNHANSUATANCHITIET_ID = VP.REF_ID AND VP.REF_TABLE = 'TT_NUT_XACNHANSUATAN_CHITIET'
      LEFT JOIN
      (
      SELECT VIENPHI_ID, SUM(MGCT.GIATRIMIENGIAM) AS BHTN_CHITRA
      FROM TT_MIENGIAM_BHTN AS MG INNER JOIN TT_MIENGIAM_CHITIET AS MGCT ON MG.MIENGIAM_BHTN_ID = MGCT.MIENGIAM_ID
      WHERE MG.TIEPNHAN_ID= '$TIEPNHAN_ID$'AND MGCT.REF_TABLE = 'TT_MIENGIAM_BHTN' <!--AND MG.TINHTRANG = '1'-->
      GROUP BY VIENPHI_ID
      ) AS MG_BHTN ON VP.VIENPHI_ID = MG_BHTN.VIENPHI_ID

      LEFT JOIN
      (
      SELECT VIENPHI_ID, SUM(MGCT.GIATRIMIENGIAM) AS MIENGIAM_CHITRA
      FROM TT_MIENGIAM AS MG INNER JOIN TT_MIENGIAM_CHITIET AS MGCT ON MG.MIENGIAM_ID = MGCT.MIENGIAM_ID
      WHERE MG.TIEPNHAN_ID= '$TIEPNHAN_ID$'AND MGCT.REF_TABLE = 'TT_MIENGIAM' <!--AND MG.TINHTRANG = '1'-->
      GROUP BY VIENPHI_ID
      ) AS MG ON VP.VIENPHI_ID = MG.VIENPHI_ID

      LEFT JOIN
      (
      SELECT VIENPHI_ID, SUM(MGCT.GIATRIMIENGIAM) AS THEHOIVIEN_CHITRA
      FROM TT_MIENGIAM_THANHVIEN AS MG INNER JOIN TT_MIENGIAM_CHITIET AS MGCT ON MG.MIENGIAM_THANHVIEN_ID = MGCT.MIENGIAM_ID
      WHERE MG.TIEPNHAN_ID= '$TIEPNHAN_ID$' AND MGCT.REF_TABLE = 'TT_MIENGIAM_THANHVIEN' <!--AND MG.TINHTRANG = '1'-->
      GROUP BY VIENPHI_ID
      ) AS MGTV ON VP.VIENPHI_ID = MGTV.VIENPHI_ID

      LEFT JOIN
      (
      SELECT VIENPHI_ID, SUM(MGCT.GIATRIMIENGIAM) AS CONGTY_CHITRA
      FROM TT_MIENGIAM_CONGTY AS MG INNER JOIN TT_MIENGIAM_CHITIET AS MGCT ON MG.MIENGIAM_CONGTY_ID = MGCT.MIENGIAM_ID
      WHERE MG.TIEPNHAN_ID= '$TIEPNHAN_ID$' and MGCT.REF_TABLE = 'TT_MIENGIAM_CONGTY' <!--and MG.TINHTRANG = '1'-->
      GROUP BY VIENPHI_ID
      ) AS MGCT ON VP.VIENPHI_ID = MGCT.VIENPHI_ID

      LEFT JOIN
      (
      SELECT VP.VIENPHI_ID, TO_CHAR(MAX(CASE WHEN MC_BHTN.MIENGIAMCHITIET_ID IS NULL THEN 0 ELSE 1 END))
      + TO_CHAR(MAX(CASE WHEN MC_CTCT.MIENGIAMCHITIET_ID IS NULL THEN 0 ELSE 1 END))
      + TO_CHAR(MAX(CASE WHEN MC_MG.MIENGIAMCHITIET_ID IS NULL THEN 0 ELSE 1 END)) AS MIENGIAM_STATUS
      , TO_CHAR(MIN(NVL(M1.TINHTRANG,1)))
      + TO_CHAR(MIN(NVL(M2.TINHTRANG,1)))
      + TO_CHAR(MIN(NVL(M3.TINHTRANG,1))) AS MIENGIAM_DUYET_STATUS
      FROM TT_VIENPHI AS VP
      LEFT JOIN TT_MIENGIAM_CHITIET AS MC_BHTN ON MC_BHTN.REF_TABLE = 'TT_MIENGIAM_BHTN' AND MC_BHTN.VIENPHI_ID = VP.VIENPHI_ID
      LEFT JOIN TT_MIENGIAM_BHTN AS M1 ON M1.MIENGIAM_BHTN_ID = MC_BHTN.MIENGIAM_ID
      LEFT JOIN TT_MIENGIAM_CHITIET AS MC_CTCT ON MC_CTCT.REF_TABLE = 'TT_MIENGIAM_CONGTY' AND MC_CTCT.VIENPHI_ID = VP.VIENPHI_ID
      LEFT JOIN TT_MIENGIAM_CONGTY AS M2 ON M2.MIENGIAM_CONGTY_ID = MC_CTCT.MIENGIAM_ID
      LEFT JOIN TT_MIENGIAM_CHITIET AS MC_MG ON MC_MG.REF_TABLE = 'TT_MIENGIAM' AND MC_MG.VIENPHI_ID = VP.VIENPHI_ID
      LEFT JOIN TT_MIENGIAM AS M3 ON M3.MIENGIAM_ID = MC_MG.MIENGIAM_ID
      WHERE VP.TIEPNHAN_ID = '$TIEPNHAN_ID$' AND VP.BENHVIEN_ID = '$BENHVIEN_ID$'
      GROUP BY VP.VIENPHI_ID
      ) AS MG_STATUS ON MG_STATUS.VIENPHI_ID = VP.VIENPHI_ID

      LEFT JOIN
      (
      SELECT NVL(HCO.VIENPHI_ID, HCI.VIENPHI_ID) AS VIENPHI_ID, COUNT(H.HOADON_ID) AS SOHOADON
      FROM TT_HOADON AS H
      LEFT JOIN TT_HOADON_CHITIET_NGOAITRU AS HCO ON HCO.HOADON_ID = H.HOADON_ID
      LEFT JOIN TT_HOADON_CHITIET_NOITRU AS HCI ON HCI.HOADON_ID = H.HOADON_ID
      WHERE H.TIEPNHAN_ID = '$TIEPNHAN_ID$' AND H.BENHVIEN_ID = '$BENHVIEN_ID$' AND H.HUYHOADON = '0' AND H.HOANTRA = '0'
      GROUP BY HCO.VIENPHI_ID, HCI.VIENPHI_ID
      ) AS HD ON HD.VIENPHI_ID = VP.VIENPHI_ID
      

      WHERE VP.BENHNHAN_PHAITHANHTOAN >= 0 AND VP.TIEPNHAN_ID = '$TIEPNHAN_ID$' <!--AND ('$TYPE$' = '0' OR ('$TYPE$' = '1' AND VP.BENHAN_ID IS NOT NULL))-->
      <isParameterPresent>
        <isNotEmpty prepend="and" property="DATHANHTOAN">
          VP.DATHANHTOAN = '$DATHANHTOAN$'
        </isNotEmpty>
      </isParameterPresent>
      AND VP.KHONGTHUTIEN = '$KHONGTHUTIEN$' AND VP.BENHVIEN_ID = '$BENHVIEN_ID$'
      AND (DVYC.DVYEUCAU_ID IS NULL OR DVYC.HUYYEUCAU != '1')
      AND (IT.TOATHUOC_ID IS NULL OR IT.CHUNGTU_ID IS NOT NULL)
      AND (OT.TOATHUOC_ID IS NULL OR OKT.CHUNGTUPHATTHUOC_ID IS NOT NULL)
      AND (PV.PHAUTHUAT_VTYT_ID IS NULL OR PV.CHUNGTU_ID IS NOT NULL)
      AND (CV.CLSKETQUA_VTYT_ID IS NULL OR CV.CHUNGTU_ID IS NOT NULL)
      AND (OKV.KHAMBENH_VTYT_ID IS NULL OR OKV.CHUNGTU_ID IS NOT NULL)
      AND (NXC.XACNHANSUATANCHITIET_ID IS NULL OR NXC.TONGHOPSUATANCHITIET_ID IS NOT NULL)
    </statement>
    <statement id="DAO00120_MIENGIAM_GetTotalList" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
      SELECT T.TIEPNHAN_ID, TO_CHAR(MAX(CASE WHEN VP1.VIENPHI_ID IS NULL THEN 0 ELSE 1 END))
      + TO_CHAR(MAX(CASE WHEN VP2.VIENPHI_ID IS NULL THEN 0 ELSE 1 END))
      + TO_CHAR(MAX(CASE WHEN VP3.VIENPHI_ID IS NULL THEN 0 ELSE 1 END)) AS MIENGIAM_STATUS
      , TO_CHAR(MIN(NVL(M1.TINHTRANG,1)))
      + TO_CHAR(MIN(NVL(M2.TINHTRANG,1)))
      + TO_CHAR(MIN(NVL(M3.TINHTRANG,1))) AS MIENGIAM_DUYET_STATUS
      FROM TT_TIEPNHAN AS T
      
      LEFT JOIN TT_MIENGIAM_BHTN AS M1 ON M1.TIEPNHAN_ID = T.TIEPNHAN_ID
      LEFT JOIN TT_MIENGIAM_CHITIET AS MC1 ON MC1.MIENGIAM_ID = M1.MIENGIAM_BHTN_ID AND MC1.REF_TABLE = 'TT_MIENGIAM_BHTN'
      LEFT JOIN TT_VIENPHI AS VP1 ON VP1.VIENPHI_ID = MC1.VIENPHI_ID AND VP1.DATHANHTOAN = '0'
      
      LEFT JOIN TT_MIENGIAM_CONGTY AS M2 ON M2.TIEPNHAN_ID = T.TIEPNHAN_ID
      LEFT JOIN TT_MIENGIAM_CHITIET AS MC2 ON MC2.MIENGIAM_ID = M2.MIENGIAM_CONGTY_ID AND MC2.REF_TABLE = 'TT_MIENGIAM_CONGTY'
      LEFT JOIN TT_VIENPHI AS VP2 ON VP2.VIENPHI_ID = MC2.VIENPHI_ID AND VP2.DATHANHTOAN = '0'
      
      LEFT JOIN TT_MIENGIAM AS M3 ON M3.TIEPNHAN_ID = T.TIEPNHAN_ID
      LEFT JOIN TT_MIENGIAM_CHITIET AS MC3 ON MC3.MIENGIAM_ID = M3.MIENGIAM_ID AND MC3.REF_TABLE = 'TT_MIENGIAM'
      LEFT JOIN TT_VIENPHI AS VP3 ON VP3.VIENPHI_ID = MC3.VIENPHI_ID AND VP3.DATHANHTOAN = '0'
      
      WHERE T.TIEPNHAN_ID = '$TIEPNHAN_ID$' AND T.BENHVIEN_ID = '$BENHVIEN_ID$'
      GROUP BY T.TIEPNHAN_ID
    </statement>
    <statement id="DAO00120_MIENGIAM_GetTotalDVList" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
      SELECT VP.VIENPHI_ID, TO_CHAR(MAX(CASE WHEN MC_BHTN.MIENGIAMCHITIET_ID IS NULL THEN 0 ELSE 1 END))
      + TO_CHAR(MAX(CASE WHEN MC_CTCT.MIENGIAMCHITIET_ID IS NULL THEN 0 ELSE 1 END))
      + TO_CHAR(MAX(CASE WHEN MC_MG.MIENGIAMCHITIET_ID IS NULL THEN 0 ELSE 1 END)) AS MIENGIAM_STATUS
      , TO_CHAR(MIN(NVL(M1.TINHTRANG,1)))
      + TO_CHAR(MIN(NVL(M2.TINHTRANG,1)))
      + TO_CHAR(MIN(NVL(M3.TINHTRANG,1))) AS MIENGIAM_DUYET_STATUS
      FROM TT_VIENPHI AS VP
      LEFT JOIN TT_MIENGIAM_CHITIET AS MC_BHTN ON MC_BHTN.REF_TABLE = 'TT_MIENGIAM_BHTN' AND MC_BHTN.VIENPHI_ID = VP.VIENPHI_ID
      LEFT JOIN TT_MIENGIAM_BHTN AS M1 ON M1.MIENGIAM_BHTN_ID = MC_BHTN.MIENGIAM_ID
      LEFT JOIN TT_MIENGIAM_CHITIET AS MC_CTCT ON MC_CTCT.REF_TABLE = 'TT_MIENGIAM_CONGTY' AND MC_CTCT.VIENPHI_ID = VP.VIENPHI_ID
      LEFT JOIN TT_MIENGIAM_CONGTY AS M2 ON M2.MIENGIAM_CONGTY_ID = MC_CTCT.MIENGIAM_ID
      LEFT JOIN TT_MIENGIAM_CHITIET AS MC_MG ON MC_MG.REF_TABLE = 'TT_MIENGIAM' AND MC_MG.VIENPHI_ID = VP.VIENPHI_ID
      LEFT JOIN TT_MIENGIAM AS M3 ON M3.MIENGIAM_ID = MC_MG.MIENGIAM_ID
      WHERE VP.TIEPNHAN_ID = '$TIEPNHAN_ID$' AND VP.BENHVIEN_ID = '$BENHVIEN_ID$'
      GROUP BY VP.VIENPHI_ID
    </statement>
    
    
    <!--Region Miễn giảm chi tiết-->
    <insert id="DAO00120_TT_MIENGIAM_CHITIET_Add" parameterClass="System.Collections.IDictionary" resultClass="System.Int64">
      <selectKey property="ID" type="pre" resultClass="System.Int64">
        select TT_MIENGIAM_CHITIET_S.nextval as value from dual
      </selectKey>
      insert into TT_MIENGIAM_CHITIET (
      MIENGIAMCHITIET_ID
      , MIENGIAM_ID
      , REF_TABLE
      , VIENPHI_ID
      , TYLEMIENGIAM
      , GIATRIMIENGIAM
      , BENHVIEN_ID
      , NGUOITAO_ID
      , NGAYTAO
      , NGUOICAPNHAT_ID
      , NGAYCAPNHAT
      , GIATRISAUMIENGIAM
      ) values (
      #ID#
      , #MIENGIAM_ID#
      , #REF_TABLE#
      , #VIENPHI_ID#
      , #TYLEMIENGIAM#
      , #GIATRIMIENGIAM#
      , #BENHVIEN_ID#
      , #NGUOITAO_ID#
      , #NGAYTAO#
      , #NGUOICAPNHAT_ID#
      , #NGAYCAPNHAT#
      , #GIATRISAUMIENGIAM#
      )      
    </insert>
    <update id="DAO00120_TT_MIENGIAM_CHITIET_Update" parameterClass="System.Collections.IDictionary">
      update TT_MIENGIAM_CHITIET set
      MIENGIAM_ID = #MIENGIAM_ID#
      , VIENPHI_ID = #VIENPHI_ID#
      , TYLEMIENGIAM = #TYLEMIENGIAM#
      , GIATRIMIENGIAM = #GIATRIMIENGIAM#
      , BENHVIEN_ID = #BENHVIEN_ID#
      , NGUOICAPNHAT_ID = #NGUOICAPNHAT_ID#
      , NGAYCAPNHAT = #NGAYCAPNHAT#
      , GIATRISAUMIENGIAM = #GIATRISAUMIENGIAM#
      where
      MIENGIAMCHITIET_ID = '$MIENGIAMCHITIET_ID$'
    </update>
    <statement id="DAO00120_TT_MIENGIAM_CHITIET_Delete" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
      DELETE FROM TT_MIENGIAM_CHITIET
      WHERE MIENGIAM_ID = '$MIENGIAM_ID$'
    </statement>
    <statement id="DAO00120_TT_MIENGIAM_CHITIET_GetList" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
      SELECT * FROM TT_MIENGIAM_CHITIET
      WHERE MIENGIAM_ID = '$MIENGIAM_ID$' AND REF_TABLE = '$REF_TABLE$' AND BENHVIEN_ID = '$BENHVIEN_ID$'
    </statement>
    
    
    <!--Region Miễn giảm bảo hiểm tư nhân-->
    <insert id="DAO00120_TT_MIENGIAM_BHTN_Add" parameterClass="System.Collections.IDictionary" resultClass="System.Int64">
      <selectKey property="ID" type="pre" resultClass="System.Int64">
        select TT_MIENGIAM_BHTN_S.nextval as value from dual
      </selectKey>
      insert into TT_MIENGIAM_BHTN (
      MIENGIAM_BHTN_ID
      , SOPHIEUBHTN
      , TIEPNHAN_ID
      , BENHAN_ID
      , BENHNHAN_ID
      , CONGTYBHTN_ID
      , SOTHEBHTN
      , NGAYHIEULUC
      , NGAYHETHAN
      , TYLE_BHTN_CHITRA
      , GIATRI_BHTN_CHITRA
      , LYDO_ID
      , NGUOIDUYET_ID
      , GHICHU
      , TINHTRANG
      , BENHVIEN_ID
      , NGUOITAO_ID
      , NGAYTAO
      , NGUOICAPNHAT_ID
      , NGAYCAPNHAT
      ) values (
      #ID#
      , #SOPHIEUBHTN#
      , #TIEPNHAN_ID#
      , #BENHAN_ID#
      , #BENHNHAN_ID#
      , #CONGTYBHTN_ID#
      , #SOTHEBHTN#
      , #NGAYHIEULUC#
      , #NGAYHETHAN#
      , #TYLE_BHTN_CHITRA#
      , #GIATRI_BHTN_CHITRA#
      , #LYDO_ID#
      , #NGUOIDUYET_ID#
      , #GHICHU#
      , #TINHTRANG#
      , #BENHVIEN_ID#
      , #NGUOITAO_ID#
      , #NGAYTAO#
      , #NGUOICAPNHAT_ID#
      , #NGAYCAPNHAT#
      )      
    </insert>
    <update id="DAO00120_TT_MIENGIAM_BHTN_Update" parameterClass="System.Collections.IDictionary">
      update TT_MIENGIAM_BHTN
      set
      SOPHIEUBHTN = #SOPHIEU#
      , TIEPNHAN_ID=#TIEPNHAN_ID#
      , BENHAN_ID=#BENHAN_ID#
      , BENHNHAN_ID=#BENHNHAN_ID#
      , CONGTYBHTN_ID=#CONGTYBHTN_ID#
      , SOTHEBHTN=#SOTHEBHTN#
      , NGAYHIEULUC= #NGAYHIEULUC#
      , NGAYHETHAN=#NGAYHETHAN#
      , TYLE_BHTN_CHITRA=#TYLE_BHTN_CHITRA#
      , GIATRI_BHTN_CHITRA= #GIATRI_BHTN_CHITRA#
      , NGUOIDUYET_ID=#NGUOIDUYET_ID#
      , GHICHU=#GHICHU#
      , TINHTRANG=#TINHTRANG#
      , LYDO_ID = #LYDO_ID#
      , BENHVIEN_ID= #BENHVIEN_ID#
      , NGUOICAPNHAT_ID=#NGUOICAPNHAT_ID#
      , NGAYCAPNHAT=#NGAYCAPNHAT#
      WHERE
      MIENGIAM_BHTN_ID = #MIENGIAM_ID#
    </update>
    <statement id="DAO00120_TT_MIENGIAM_BHTN_Delete" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
      DELETE FROM TT_MIENGIAM_BHTN
      WHERE MIENGIAM_BHTN_ID = '$MIENGIAM_ID$'
    </statement> 
    <statement id="DAO00120_TT_MIENGIAM_BHTN_Search" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
      select MG.*, MG.MIENGIAM_BHTN_ID AS MIENGIAM_ID, MG.SOPHIEUBHTN AS SOPHIEU, MG.SOTHEBHTN AS SOTHE, MG.TYLE_BHTN_CHITRA AS TYLE_CHITRA
      , MG.GIATRI_BHTN_CHITRA AS GIATRI_CHITRA, TN.SOTIEPNHAN, BA.SOBENHAN, BN.TENBENHNHAN, BN.MAYTE, gt.DESCRIPTION as GIOITINH
      , CASE NVL(TO_CHAR(BN.NGAYSINH),'') WHEN '' THEN TO_CHAR(BN.NAMSINH)
      ELSE TO_CHAR(BN.NGAYSINH,'DD/MM/YYYY') END AS NAMSINH
      , BA.LOAIBENHAN
      from TT_MIENGIAM_BHTN MG
      left join TT_TIEPNHAN TN on TN.TIEPNHAN_ID = MG.TIEPNHAN_ID
      left join TT_NOITRU_BENHAN BA on BA.BENHAN_ID = MG.BENHAN_ID
      left join TT_BENHNHAN BN on BN.BENHNHAN_ID = MG.BENHNHAN_ID
      left join TM_GENDER gt on gt.ID = bn.GIOITINH
      <dynamic prepend="where">
        <isParameterPresent>
          <isNotEmpty prepend="and" property="TUKHOA">
            MG.SOPHIEUBHTN like '%$TUKHOA$%' or BN.TENBENHNHAN like '%$TUKHOA$%' or BN.MAYTE like '%$TUKHOA$%'
          </isNotEmpty>
          <isNotEmpty prepend="and" property="BENHVIEN_ID">
            MG.BENHVIEN_ID = '$BENHVIEN_ID$'
          </isNotEmpty>
          <isNotEmpty prepend="and" property="TINHTRANG">
            MG.TINHTRANG = '$TINHTRANG$'
          </isNotEmpty>
          <isNotEmpty prepend="and" property="BENHNHAN_ID">
            TN.BENHNHAN_ID = '$BENHNHAN_ID$'
          </isNotEmpty>
          <isNotEmpty prepend="and" property="TUNGAY">
            trunc(MG.NGAYTAO) BETWEEN BETWEEN  trunc(#TUNGAY#) and  trunc(#DENNGAY#)
          </isNotEmpty>       
        </isParameterPresent>
      </dynamic>
      order by MG.MIENGIAM_BHTN_ID DESC
    </statement>
    <statement id="DAO00120_SEARCH_BHTN_MIENGIAM" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
      select MG.*, MG.MIENGIAM_BHTN_ID AS MIENGIAM_ID, MG.SOPHIEUBHTN AS SOPHIEU, MG.SOTHEBHTN AS SOTHE, MG.TYLE_BHTN_CHITRA AS TYLE_CHITRA
      , MG.GIATRI_BHTN_CHITRA AS GIATRI_CHITRA, TN.SOTIEPNHAN, BA.SOBENHAN, BN.TENBENHNHAN, BN.MAYTE, gt.DESCRIPTION as GIOITINH
      , CASE NVL(TO_CHAR(BN.NGAYSINH),'') WHEN '' THEN TO_CHAR(BN.NAMSINH)
      ELSE TO_CHAR(BN.NGAYSINH,'DD/MM/YYYY') END AS NAMSINH
      , BA.LOAIBENHAN, TN.TRANGTHAI AS TRANGTHAITIEPNHAN
      from TT_MIENGIAM_BHTN MG
      left join TT_TIEPNHAN TN on TN.TIEPNHAN_ID = MG.TIEPNHAN_ID
      left join TT_NOITRU_BENHAN BA on BA.BENHAN_ID = MG.BENHAN_ID
      left join TT_BENHNHAN BN on BN.BENHNHAN_ID = MG.BENHNHAN_ID
      left join TM_GENDER gt on gt.ID = bn.GIOITINH
      <dynamic prepend="where">
        <isParameterPresent>
          <isNotEmpty prepend="and" property="TUKHOA1">
            BN.TENBENHNHAN like '%$TUKHOA1$%' or BN.MAYTE like '%$TUKHOA1$%'
          </isNotEmpty>
          <isNotEmpty prepend="and" property="TUKHOA2">
            MG.SOPHIEUBHTN like '%$TUKHOA2$%'
          </isNotEmpty>
          <isNotEmpty prepend="and" property="BENHVIEN_ID">
            MG.BENHVIEN_ID = '$BENHVIEN_ID$'
          </isNotEmpty>
          <isNotEmpty prepend="and" property="TINHTRANG">
            MG.TINHTRANG = '$TINHTRANG$'
          </isNotEmpty>
          <isNotEmpty prepend="and" property="TUNGAY">
            trunc(MG.NGAYTAO) BETWEEN  trunc(#TUNGAY#) and  trunc(#DENNGAY#)
          </isNotEmpty>
        </isParameterPresent>
      </dynamic>
      order by MG.MIENGIAM_BHTN_ID DESC
    </statement>
    <statement id="DAO00120_TT_MIENGIAM_BHTN_Get" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
      SELECT M.*, M.GIATRI_BHTN_CHITRA AS GIATRI_CHITRA, M.TYLE_BHTN_CHITRA AS TYLE_CHITRA, NVL(HD.HOADON_CHUNGTU_ID,0) AS HOADON_ID
      , T.TRANGTHAI AS TRANGTHAITIEPNHAN
      FROM TT_MIENGIAM_BHTN M
      INNER JOIN TT_TIEPNHAN T ON M.TIEPNHAN_ID = T.TIEPNHAN_ID
      LEFT JOIN
      (
      SELECT H.HOADON_CHUNGTU_ID
      FROM TT_HOADON_CHUNGTU_CHITIET HC
      INNER JOIN TT_HOADON_CHUNGTU H ON H.HOADON_CHUNGTU_ID = HC.HOADON_CHUNGTU_ID AND NVL(H.TRANGTHAI,'') != 'HUY'
      WHERE HC.HOADONLIENQUAN_ID = '$MIENGIAM_ID$' AND HC.REF_TABLE = 'TT_MIENGIAM_BHTN' AND ROWNUM = 1
      ORDER BY H.HOADON_CHUNGTU_ID DESC
      ) HD ON 1=1

      WHERE M.MIENGIAM_BHTN_ID = '$MIENGIAM_ID$' AND M.BENHVIEN_ID = '$BENHVIEN_ID$'
    </statement>
    <update id="DAO00120_TT_MIENGIAM_BHTN_Approve" parameterClass="System.Collections.IDictionary">
      update TT_MIENGIAM_BHTN set
      NGUOIDUYET_ID = #NGUOIDUYET_ID#
      , TINHTRANG = #TINHTRANG#
      , NGAYDUYET = #NGAYCAPNHAT#
      , NGUOICAPNHAT_ID = #NGUOICAPNHAT_ID#
      , NGAYCAPNHAT = #NGAYCAPNHAT#
      where
      MIENGIAM_BHTN_ID = '$MIENGIAM_ID$' AND BENHVIEN_ID = '$BENHVIEN_ID$'
    </update>
    <statement id="DAO00120_TT_MIENGIAM_BHTN_CHECK_Cty_Dv" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
      SELECT MC.*
      FROM TT_MIENGIAM_BHTN AS MB
      INNER JOIN TT_MIENGIAM_CHITIET AS MC ON MC.MIENGIAM_ID = MB.MIENGIAM_BHTN_ID
      WHERE MB.MIENGIAM_BHTN_ID != '$MIENGIAM_ID$' AND MB.TIEPNHAN_ID = '$TIEPNHAN_ID$'
      AND MB.BENHVIEN_ID = '$BENHVIEN_ID$' AND MC.VIENPHI_ID = '$VIENPHI_ID$'
      <isNotEmpty prepend="and" property="CONGTYBHTN_ID">
        MB.CONGTYBHTN_ID = '$CONGTYBHTN_ID$'
      </isNotEmpty>
    </statement>

    <!-- Region Miễn giảm công ty chi trả-->
    <statement id="DAO00120_TM_CONGTYCHITRA_GetList" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
      select * from TM_CONGTYCHITRA
      where BENHVIEN_ID = '$BENHVIEN_ID$'
      and TAMNGUNG = '0'
    </statement>
    <insert id="DAO00120_TT_MIENGIAM_CONGTY_Add" parameterClass="System.Collections.IDictionary" resultClass="System.Int64">
      <selectKey property="ID" type="pre" resultClass="System.Int64">
        select TT_MIENGIAM_CONGTY_S.nextval as value from dual
      </selectKey>
      insert into TT_MIENGIAM_CONGTY (
      MIENGIAM_CONGTY_ID
      , MAMIENGIAM
      , SOPHIEUMIENGIAM
      , TIEPNHAN_ID
      , BENHAN_ID
      , BENHNHAN_ID
      , TYLEMIENGIAM
      , GIATRIMIENGIAM
      , CONGTYCHITRA_ID
      , NGAYLAP
      , NGUOIDUYET_ID
      , GHICHU
      , TINHTRANG
      , BENHVIEN_ID
      , NGUOITAO_ID
      , NGAYTAO
      , NGUOICAPNHAT_ID
      , NGAYCAPNHAT
      , HOADON_CHUNGTU_LIENQUAN_ID
      ) values (
      #ID#
      , #MAMIENGIAM#
      , #SOPHIEUMIENGIAM#
      , #TIEPNHAN_ID#
      , #BENHAN_ID#
      , #BENHNHAN_ID#
      , #TYLEMIENGIAM#
      , #GIATRIMIENGIAM#
      , #CONGTYCHITRA_ID#
      , #NGAYTAO#
      , #NGUOIDUYET_ID#
      , #GHICHU#
      , #TINHTRANG#
      , #BENHVIEN_ID#
      , #NGUOITAO_ID#
      , #NGAYTAO#
      , #NGUOICAPNHAT_ID#
      , #NGAYCAPNHAT#
      , #HOADON_CHUNGTU_LIENQUAN_ID#
      )      
    </insert>
    <update id="DAO00120_TT_MIENGIAM_CONGTY_Update" parameterClass="System.Collections.IDictionary">
      update TT_MIENGIAM_CONGTY
      set
      MAMIENGIAM = #MAMIENGIAM#
      , SOPHIEUMIENGIAM = #SOPHIEU#
      , TIEPNHAN_ID=#TIEPNHAN_ID#
      , BENHAN_ID=#BENHAN_ID#
      , BENHNHAN_ID=#BENHNHAN_ID#
      , CONGTYCHITRA_ID=#CONGTYCHITRA_ID#
      , TYLEMIENGIAM=#TYLEMIENGIAM#
      , GIATRIMIENGIAM= #GIATRIMIENGIAM#
      , NGAYLAP = #NGAYTAO#
      , NGUOIDUYET_ID=#NGUOIDUYET_ID#
      , GHICHU=#GHICHU#
      , TINHTRANG=#TINHTRANG#
      , BENHVIEN_ID= #BENHVIEN_ID#
      , NGUOICAPNHAT_ID=#NGUOICAPNHAT_ID#
      , NGAYCAPNHAT=#NGAYCAPNHAT#
      , HOADON_CHUNGTU_LIENQUAN_ID = #HOADON_CHUNGTU_LIENQUAN_ID#
      WHERE
      MIENGIAM_CONGTY_ID = #MIENGIAM_ID#
    </update>
    <statement id="DAO00120_TT_MIENGIAM_CONGTY_Delete" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
      DELETE FROM TT_MIENGIAM_CONGTY
      WHERE MIENGIAM_CONGTY_ID = '$MIENGIAM_ID$'
    </statement>
    <statement id="DAO00120_TT_MIENGIAM_CONGTY_Search" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
      select MG.*, MG.MIENGIAM_CONGTY_ID AS MIENGIAM_ID, MG.SOPHIEUMIENGIAM AS SOPHIEU, MG.TYLEMIENGIAM AS TYLE_CHITRA
      , MG.GIATRIMIENGIAM AS GIATRI_CHITRA, TN.SOTIEPNHAN, BA.SOBENHAN, BN.TENBENHNHAN, BN.MAYTE, gt.DESCRIPTION as GIOITINH
      , CASE NVL(TO_CHAR(BN.NGAYSINH),'') WHEN '' THEN TO_CHAR(BN.NAMSINH)
      ELSE TO_CHAR(BN.NGAYSINH,'DD/MM/YYYY') END AS NAMSINH
      from TT_MIENGIAM_CONGTY MG
      left join TT_TIEPNHAN TN on TN.TIEPNHAN_ID = MG.TIEPNHAN_ID
      left join TT_NOITRU_BENHAN BA on BA.BENHAN_ID = MG.BENHAN_ID
      left join TT_BENHNHAN BN on BN.BENHNHAN_ID = MG.BENHNHAN_ID
      left join TM_GENDER gt on gt.ID = bn.GIOITINH
      <dynamic prepend="where">
        <isParameterPresent>
          <isNotEmpty prepend="and" property="TUKHOA">
            MG.SOPHIEUMIENGIAM like '%$TUKHOA$%' or BN.TENBENHNHAN like '%$TUKHOA$%' or BN.MAYTE like '%$TUKHOA$%'
          </isNotEmpty>
          <isNotEmpty prepend="and" property="BENHVIEN_ID">
            MG.BENHVIEN_ID = '$BENHVIEN_ID$'
          </isNotEmpty>
          <isNotEmpty prepend="and" property="TINHTRANG">
            MG.TINHTRANG = '$TINHTRANG$'
          </isNotEmpty>
          <isNotEmpty prepend="and" property="BENHNHAN_ID">
            TN.BENHNHAN_ID = '$BENHNHAN_ID$'
          </isNotEmpty>
          <isNotEmpty prepend="and" property="TUNGAY">
            trunc(MG.NGAYTAO) BETWEEN  trunc(#TUNGAY#) and  trunc(#DENNGAY#)
          </isNotEmpty>
        </isParameterPresent>
      </dynamic>
      order by MG.MIENGIAM_CONGTY_ID DESC
    </statement>
    <statement id="DAO00120_SEARCH_CTCT_MIENGIAM" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
      select MG.*, MG.MIENGIAM_CONGTY_ID AS MIENGIAM_ID, MG.SOPHIEUMIENGIAM AS SOPHIEU, MG.TYLEMIENGIAM AS TYLE_CHITRA
      , MG.GIATRIMIENGIAM AS GIATRI_CHITRA, TN.SOTIEPNHAN, BA.SOBENHAN, BN.TENBENHNHAN, BN.MAYTE, gt.DESCRIPTION as GIOITINH
      , CASE NVL(TO_CHAR(BN.NGAYSINH),'') WHEN '' THEN TO_CHAR(BN.NAMSINH) 
                                            ELSE TO_CHAR(BN.NGAYSINH,'DD/MM/YYYY') END AS NAMSINH    
      , TN.TRANGTHAI AS TRANGTHAITIEPNHAN
      from TT_MIENGIAM_CONGTY MG
      left join TT_TIEPNHAN TN on TN.TIEPNHAN_ID = MG.TIEPNHAN_ID
      left join TT_NOITRU_BENHAN BA on BA.BENHAN_ID = MG.BENHAN_ID
      left join TT_BENHNHAN BN on BN.BENHNHAN_ID = MG.BENHNHAN_ID
      left join TM_GENDER gt on gt.ID = bn.GIOITINH
      <dynamic prepend="where">
        <isParameterPresent>
          <isNotEmpty prepend="and" property="TUKHOA1">
            BN.TENBENHNHAN like '%$TUKHOA1$%' or BN.MAYTE like '%$TUKHOA1$%'
          </isNotEmpty>
          <isNotEmpty prepend="and" property="TUKHOA2">
            MG.SOPHIEUBHTN like '%$TUKHOA2$%'
          </isNotEmpty>
          <isNotEmpty prepend="and" property="BENHVIEN_ID">
            MG.BENHVIEN_ID = '$BENHVIEN_ID$'
          </isNotEmpty>
          <isNotEmpty prepend="and" property="TINHTRANG">
            MG.TINHTRANG = '$TINHTRANG$'
          </isNotEmpty>
          <isNotEmpty prepend="and" property="TUNGAY">
            trunc(MG.NGAYTAO) BETWEEN  trunc(#TUNGAY#) and  trunc(#DENNGAY#)
          </isNotEmpty>
        </isParameterPresent>
      </dynamic>
      order by MG.MIENGIAM_CONGTY_ID DESC
    </statement>
    <statement id="DAO00120_TT_MIENGIAM_CONGTY_Get" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
      SELECT M.*, M.GIATRIMIENGIAM AS GIATRI_CHITRA, M.TYLEMIENGIAM AS TYLE_CHITRA, NVL(HD.HOADON_CHUNGTU_ID,0) AS HOADON_ID
      , T.TRANGTHAI AS TRANGTHAITIEPNHAN
      FROM TT_MIENGIAM_CONGTY M
      INNER JOIN TT_TIEPNHAN T ON M.TIEPNHAN_ID = T.TIEPNHAN_ID
      LEFT JOIN
      (
      SELECT H.HOADON_CHUNGTU_ID
      FROM TT_HOADON_CHUNGTU_CHITIET HC
      INNER JOIN TT_HOADON_CHUNGTU H ON H.HOADON_CHUNGTU_ID = HC.HOADON_CHUNGTU_ID AND NVL(H.TRANGTHAI,'') != 'HUY'
      WHERE HC.HOADONLIENQUAN_ID = '$MIENGIAM_ID$' AND HC.REF_TABLE = 'TT_MIENGIAM_CONGTY' AND ROWNUM = 1
      ORDER BY H.HOADON_CHUNGTU_ID DESC
      ) HD ON 1=1
      WHERE M.MIENGIAM_CONGTY_ID = '$MIENGIAM_ID$' AND M.BENHVIEN_ID = '$BENHVIEN_ID$'
    </statement>
    <update id="DAO00120_TT_MIENGIAM_CONGTY_Approve" parameterClass="System.Collections.IDictionary">
      update TT_MIENGIAM_CONGTY set
      NGUOIDUYET_ID = #NGUOIDUYET_ID#
      , NGAYDUYET = #NGAYCAPNHAT#
      , TINHTRANG = #TINHTRANG#
      , NGUOICAPNHAT_ID = #NGUOICAPNHAT_ID#
      , NGAYCAPNHAT = #NGAYCAPNHAT#
      where
      MIENGIAM_CONGTY_ID = '$MIENGIAM_ID$' AND BENHVIEN_ID = '$BENHVIEN_ID$'
    </update>

    <!--Region Miễn giảm hỗ trợ-->
    <insert id="DAO00120_TT_MIENGIAM_Add" parameterClass="System.Collections.IDictionary" resultClass="System.Int64">
      <selectKey property="ID" type="pre" resultClass="System.Int64">
        select TT_MIENGIAM_S.nextval as value from dual
      </selectKey>
      insert into TT_MIENGIAM (
      MIENGIAM_ID
      , MAMIENGIAM
      , SOPHIEUMIENGIAM
      , TIEPNHAN_ID
      , BENHAN_ID
      , BENHNHAN_ID
      , TYLEMIENGIAM
      , GIATRIMIENGIAM
      , LYDO_ID
      , NGAYLAP
      , NGUOIDUYET_ID
      , GHICHU
      , NGAYDUYET
      , TINHTRANG
      , BENHVIEN_ID
      , NGUOITAO_ID
      , NGAYTAO
      , NGUOICAPNHAT_ID
      , NGAYCAPNHAT
      ) values (
      #ID#
      , #MAMIENGIAM#
      , #SOPHIEUMIENGIAM#
      , #TIEPNHAN_ID#
      , #BENHAN_ID#
      , #BENHNHAN_ID#
      , #TYLEMIENGIAM#
      , #GIATRIMIENGIAM#
      , #LYDO_ID#
      , #NGAYTAO#
      , #NGUOIDUYET_ID#
      , #GHICHU#
      , #NGAYDUYET#
      , #TINHTRANG#
      , #BENHVIEN_ID#
      , #NGUOITAO_ID#
      , #NGAYTAO#
      , #NGUOICAPNHAT_ID#
      , #NGAYCAPNHAT#
      )      
    </insert>
    <update id="DAO00120_TT_MIENGIAM_Update" parameterClass="System.Collections.IDictionary">
      update TT_MIENGIAM
      set
      MAMIENGIAM = #MAMIENGIAM#
      , SOPHIEUMIENGIAM = #SOPHIEU#
      , TIEPNHAN_ID=#TIEPNHAN_ID#
      , BENHAN_ID=#BENHAN_ID#
      , BENHNHAN_ID=#BENHNHAN_ID#
      , LYDO_ID=#LYDO_ID#
      , TYLEMIENGIAM=#TYLEMIENGIAM#
      , GIATRIMIENGIAM= #GIATRIMIENGIAM#
      , NGAYLAP = #NGAYTAO#
      , NGUOIDUYET_ID=#NGUOIDUYET_ID#
      , GHICHU=#GHICHU#
      , TINHTRANG=#TINHTRANG#
      , BENHVIEN_ID= #BENHVIEN_ID#
      , NGUOICAPNHAT_ID=#NGUOICAPNHAT_ID#
      , NGAYCAPNHAT=#NGAYCAPNHAT#
      WHERE
      MIENGIAM_ID = #MIENGIAM_ID#
    </update>
    <statement id="DAO00120_TT_MIENGIAM_Delete" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
      DELETE FROM TT_MIENGIAM
      WHERE MIENGIAM_ID = '$MIENGIAM_ID$'
    </statement>
    <statement id="DAO00120_TT_MIENGIAM_Search" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
      select MG.*, MG.SOPHIEUMIENGIAM AS SOPHIEU, MG.TYLEMIENGIAM AS TYLE_CHITRA
      , MG.GIATRIMIENGIAM AS GIATRI_CHITRA, TN.SOTIEPNHAN, BA.SOBENHAN, BN.TENBENHNHAN, BN.MAYTE, gt.DESCRIPTION as GIOITINH
      , CASE NVL(TO_CHAR(BN.NGAYSINH),'') WHEN '' THEN TO_CHAR(BN.NAMSINH)
      ELSE TO_CHAR(BN.NGAYSINH,'DD/MM/YYYY') END AS NAMSINH
      from TT_MIENGIAM MG
      left join TT_TIEPNHAN TN on TN.TIEPNHAN_ID = MG.TIEPNHAN_ID
      left join TT_NOITRU_BENHAN BA on BA.BENHAN_ID = MG.BENHAN_ID
      left join TT_BENHNHAN BN on BN.BENHNHAN_ID = MG.BENHNHAN_ID
      left join TM_GENDER gt on gt.ID = bn.GIOITINH
      <dynamic prepend="where">
        <isParameterPresent>
          <isNotEmpty prepend="and" property="TUKHOA">
            MG.SOPHIEUMIENGIAM like '%$TUKHOA$%' or BN.TENBENHNHAN like '%$TUKHOA$%' or BN.MAYTE like '%$TUKHOA$%'
          </isNotEmpty>
          <isNotEmpty prepend="and" property="BENHVIEN_ID">
            MG.BENHVIEN_ID = '$BENHVIEN_ID$'
          </isNotEmpty>
          <isNotEmpty prepend="and" property="TINHTRANG">
            MG.TINHTRANG = '$TINHTRANG$'
          </isNotEmpty>
          <isNotEmpty prepend="and" property="BENHNHAN_ID">
            TN.BENHNHAN_ID = '$BENHNHAN_ID$'
          </isNotEmpty>
          <isNotEmpty prepend="and" property="TUNGAY">
            trunc(MG.NGAYTAO) BETWEEN  trunc(#TUNGAY#) and  trunc(#DENNGAY#)
          </isNotEmpty>
        </isParameterPresent>
      </dynamic>
      order by MG.MIENGIAM_ID DESC
    </statement>
    <statement id="DAO00120_SEARCH_MG_MIENGIAM" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
      select MG.*, MG.SOPHIEUMIENGIAM AS SOPHIEU, MG.TYLEMIENGIAM AS TYLE_CHITRA
      , MG.GIATRIMIENGIAM AS GIATRI_CHITRA, TN.SOTIEPNHAN, BA.SOBENHAN, BN.TENBENHNHAN, BN.MAYTE, gt.DESCRIPTION as GIOITINH
      , CASE NVL(TO_CHAR(BN.NGAYSINH),'') WHEN '' THEN TO_CHAR(BN.NAMSINH) 
                                            ELSE TO_CHAR(BN.NGAYSINH,'DD/MM/YYYY') END AS NAMSINH
      , TN.TRANGTHAI AS TRANGTHAITIEPNHAN
      from TT_MIENGIAM MG
      left join TT_TIEPNHAN TN on TN.TIEPNHAN_ID = MG.TIEPNHAN_ID
      left join TT_NOITRU_BENHAN BA on BA.BENHAN_ID = MG.BENHAN_ID
      left join TT_BENHNHAN BN on BN.BENHNHAN_ID = MG.BENHNHAN_ID
      left join TM_GENDER gt on gt.ID = bn.GIOITINH
      <dynamic prepend="where">
        <isParameterPresent>
          <isNotEmpty prepend="and" property="TUKHOA1">
            BN.TENBENHNHAN like '%$TUKHOA1$%' or BN.MAYTE like '%$TUKHOA1$%'
          </isNotEmpty>
          <isNotEmpty prepend="and" property="TUKHOA2">
            MG.SOPHIEUBHTN like '%$TUKHOA2$%'
          </isNotEmpty>
          <isNotEmpty prepend="and" property="BENHVIEN_ID">
            MG.BENHVIEN_ID = '$BENHVIEN_ID$'
          </isNotEmpty>
          <isNotEmpty prepend="and" property="TINHTRANG">
            MG.TINHTRANG = '$TINHTRANG$'
          </isNotEmpty>
          <isNotEmpty prepend="and" property="TUNGAY">
            trunc(MG.NGAYTAO) BETWEEN  trunc(#TUNGAY#) and  trunc(#DENNGAY#)
          </isNotEmpty>
        </isParameterPresent>
      </dynamic>
      order by MG.MIENGIAM_ID DESC
    </statement>
    <statement id="DAO00120_TT_MIENGIAM_Get" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
      SELECT MG.*, MG.GIATRIMIENGIAM AS GIATRI_CHITRA, MG.TYLEMIENGIAM AS TYLE_CHITRA, 0 AS HOADON_ID, T.TRANGTHAI AS TRANGTHAITIEPNHAN
      FROM TT_MIENGIAM MG
      INNER JOIN TT_TIEPNHAN T ON M.TIEPNHAN_ID = T.TIEPNHAN_ID
      WHERE MG.MIENGIAM_ID = '$MIENGIAM_ID$' AND MG.BENHVIEN_ID = '$BENHVIEN_ID$'
    </statement>
    <update id="DAO00120_TT_MIENGIAM_Approve" parameterClass="System.Collections.IDictionary">
      update TT_MIENGIAM set
      NGUOIDUYET_ID = #NGUOIDUYET_ID#
      , NGAYDUYET = #NGAYCAPNHAT#
      , TINHTRANG = #TINHTRANG#
      , NGUOICAPNHAT_ID = #NGUOICAPNHAT_ID#
      , NGAYCAPNHAT = #NGAYCAPNHAT#
      where
      MIENGIAM_ID = '$MIENGIAM_ID$' AND BENHVIEN_ID = '$BENHVIEN_ID$'
    </update>
  </statements>   
</sqlMap>