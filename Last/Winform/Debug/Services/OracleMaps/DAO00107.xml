<?xml version="1.0" encoding="utf-8" ?>
<!--============================================================================
//	CAUTION: This file is generated by IBatisNetGen.3.SQLMap.cst at 5/27/2016 9:04:28 AM
//				Any manual editing will be lost in re-generation.
//===========================================================================-->
<sqlMap namespace="eHospital" xmlns="http://ibatis.apache.org/mapping" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">

  <statements>
    <statement id="DAO00107_GetLoaiHangHoaByCode" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
      select *
      from TM_PUR_LOAI
      WHERE BENHVIEN_ID = '$BENHVIEN_ID$' AND MA = '$MA$'
    </statement>
    <statement id="DAO00107_GetLuaChonGiaByCode" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
      select *
      from TM_PUR_LUACHONGIA 
      WHERE BENHVIEN_ID = '$BENHVIEN_ID$' AND MA = '$MA$'
    </statement>
    <statement id="DAO00107_GetAll" resultClass="DataObject">
      select *
      from TT_DUOC_DUTRU
      order by DUTRU_ID
    </statement>
    <statement id="DAO00107_GetList" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
      select DD.*, NV.TENNHANVIEN AS NGUOINHAP
      from TT_DUOC_DUTRU DD
      inner join TM_NHANVIEN AS NV ON NV.NHANVIEN_ID = DD.NGUOINHAP_ID
      WHERE DD.BENHVIEN_ID = '$BENHVIEN_ID$'
    </statement>
    <statement id="DAO00107_GetDetail" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
      select DD.*, NVL(PC.TRANGTHAI_DUYET, '0') AS TRANGTHAI_DUYET, NVL(PC.STATE_CODE, '0') AS STATE_CODE, PC.NGUOIDUYETCAP1_ID
      from TT_DUOC_DUTRU DD
      LEFT JOIN TT_PUR_CHUNGTU AS PC ON PC.MACHUNGTU = DD.MACHUNGTUMUAHANG
      where DD.DUTRU_ID  = '$DUTRU_ID$'
      order by DD.DUTRU_ID
    </statement>
    <statement id="DAO00107_GetDuTru" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
      select DD.*, NVL(PC.TRANGTHAI_DUYET, '0') AS TRANGTHAI_DUYET, NVL(PC.NGAYGIODUYETCAP3,NVL(PC.NGAYGIODUYETCAP2, PC.NGAYGIODUYETCAP1)) AS NGAYDUYETMUAHANG
      , NVL(PC.NGUOIDUYETCAP3_ID, NVL(PC.NGUOIDUYETCAP2_ID, PC.NGUOIDUYETCAP1_ID)) AS NGUOIDUYETMUAHANG
      from TT_DUOC_DUTRU DD
      LEFT JOIN TT_PUR_CHUNGTU PC ON PC.MACHUNGTU = DD.MACHUNGTUMUAHANG
      where DD.MACHUNGTU = '$MACHUNGTU$' AND DD.BENHVIEN_ID = '$BENHVIEN_ID$'
    </statement>
    <statement id="DAO00107_GetDuTruDetailByDuTruID" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
      select DDC.*, D.TENDUOCDAYDU AS TENDUOC, DVT.TENDONVITINH AS TENDONVICOBAN, DVT2.TENDONVITINH, DVT2.GIATRIQUIDOI AS TYLEQUYDOI
      , D.MADUOC, NCC.TENNHACUNGCAP
      from TT_DUOC_DUTRU_CHITIET DDC
      inner join TM_DUOC D ON D.DUOC_ID = DDC.DUOC_ID
      inner join TM_DONVITINH DVT ON DVT.DONVITINH_ID = D.DONVITINH_ID
      inner join TM_DONVITINH DVT2 ON DVT2.DONVITINH_ID = DDC.DONVITINH_ID
      inner join TM_NHACUNGCAP NCC ON NCC.NHACUNGCAP_ID = DDC.NHACUNGCAP_ID
      where DDC.DUTRU_ID = '$DUTRU_ID$' AND DDC.BENHVIEN_ID = '$BENHVIEN_ID$'
    </statement>
    <statement id="DAO00107_GetMaKho" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
      select MAKHO
      from TM_KHODUOC
      where KHODUOC_ID = '$KHODUOC_ID$' AND BENHVIEN_ID = '$BENHVIEN_ID$'
    </statement>
    <statement id="DAO00107_GetMaxSoCT" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
      select NVL(MAX(SOCHUNGTU),'000000') AS SOCT
      from TT_DUOC_DUTRU
      where BENHVIEN_ID = '$BENHVIEN_ID$'
    </statement>
    <statement id="DAO00107_GetDetailP" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
      select *
      from TT_DUOC_DUTRU
      where DUTRU_ID  = '$DUTRU_ID$'
      order by DUTRU_ID
    </statement>
    <update id="DAO00107_UpdateTrangThai" parameterClass="System.Collections.IDictionary">
      update TT_DUOC_DUTRU set
      TRANGTHAI = #TRANGTHAI#
      , MACHUNGTUMUAHANG = #MACHUNGTUMUAHANG#
      where DUTRU_ID = '$DUTRU_ID$' 
      AND BENHVIEN_ID = '$BENHVIEN_ID$'
    </update>
    <statement id="DAO00107_UpdateTrangThaiPR" parameterClass="System.Collections.IDictionary">
      update TT_PUR_CHUNGTU set
      STATE_CODE = #STATE_CODE#
      , STATE_NAME = #STATE_NAME#
      , NGAYCAPNHAT = SYSDATE
      , NGUOICAPNHAT_ID = #NGUOICAPNHAT_ID#
      where MACHUNGTU = '$MACHUNGTUMUAHANG$' 
      AND BENHVIEN_ID = '$BENHVIEN_ID$'
    </statement>
    <statement id="DAO00107_GetListByTrangThai" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
      select DD.DUTRU_ID, DD.MACHUNGTU, DD.NGAYCHUNGTU, DD.NGAYBAOCAO, KD.TENKHO, NV1.TENNHANVIEN AS NGUOINHAP, NV2.TENNHANVIEN AS NGUOINHAN
      from TT_DUOC_DUTRU DD
      inner join TM_NHANVIEN NV1 ON DD.NGUOINHAP_ID = NV1.NHANVIEN_ID
      inner join TM_NHANVIEN NV2 ON DD.NGUOINHAN_ID = NV2.NHANVIEN_ID
      inner join TM_KHODUOC KD ON DD.KHONHAP_ID = KD.KHODUOC_ID
      <dynamic prepend="where">
        <isParameterPresent>
          <isNotEmpty prepend="and" property="BENHVIEN_ID">
            DD.BENHVIEN_ID = '$BENHVIEN_ID$'
          </isNotEmpty>
          <isNotEmpty prepend="and" property="NGAYCHUNGTU">            
            TO_DATE(TO_CHAR(DD.NGAYCHUNGTU,'MM/DD/YYYY'), 'MM/DD/YYYY') = TO_DATE('$NGAYCHUNGTU$', 'MM/DD/YYYY')
          </isNotEmpty>
          <isNotEmpty prepend="and" property="TRANGTHAI">
            DD.TRANGTHAI = '$TRANGTHAI$'
          </isNotEmpty>
          <isNotEmpty prepend="and" property="KHONHAP_ID">
            DD.KHONHAP_ID = '$KHONHAP_ID$'
          </isNotEmpty>
        </isParameterPresent>
      </dynamic>
      order by DUTRU_ID
    </statement>
    <statement id="DAO00107_GetListByCondition" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
      WITH LIST_CHUNGTU AS
      (
      select ROW_NUMBER() OVER(ORDER BY DD.DUTRU_ID) as ROWNUMBER
      , DD.MACHUNGTU, DD.NGAYCHUNGTU, DD.NGAYBAOCAO, NV.TENNHANVIEN AS NGUOINHAP, DD.GIATRITHANHTOAN
      from TT_DUOC_DUTRU DD
      inner join TM_NHANVIEN NV ON DD.NGUOINHAP_ID = NV.NHANVIEN_ID
      left join TT_PUR_CHUNGTU PC ON PC.MACHUNGTU = DD.MACHUNGTUMUAHANG
      <dynamic prepend="where">
        <isParameterPresent>
          <isNotEmpty prepend="and" property="BENHVIEN_ID">
            DD.BENHVIEN_ID = '$BENHVIEN_ID$'
          </isNotEmpty>
          <isNotEmpty prepend="and" property="TUNGAY">            
            TO_DATE(TO_CHAR(DD.NGAYCHUNGTU,'MM/DD/YYYY'), 'MM/DD/YYYY') &gt;= TO_DATE('$SEARCH_TUNGAY$', 'MM/DD/YYYY')
        </isNotEmpty>
          <isNotEmpty prepend="and" property="DENNGAY">            
            TO_DATE(TO_CHAR(DD.NGAYCHUNGTU,'MM/DD/YYYY'), 'MM/DD/YYYY') &lt;= TO_DATE('$SEARCH_DENNGAY$', 'MM/DD/YYYY')
          </isNotEmpty>
          <isNotEmpty prepend="and" property="KHODUOC_ID">
            DD.KHONHAP_ID = '$KHODUOC_ID$'
          </isNotEmpty>
          <isNotEmpty prepend="and" property="TRANGTHAI">
            ('$TRANGTHAI$' = 'New' AND DD.TRANGTHAI = '$TRANGTHAI$')
            OR ('$TRANGTHAI$' = 'Purchased' AND PC.TRANGTHAI_DUYET != '1')
            OR ('$TRANGTHAI$' = 'Approved' AND PC.TRANGTHAI_DUYET = '1')
          </isNotEmpty>
        </isParameterPresent>
      </dynamic>
      )
      SELECT *
      FROM LIST_CHUNGTU
      WHERE ROWNUMBER BETWEEN '$FROM_ROW$' AND '$TO_ROW$'
    </statement>
    <statement id="DAO00107_GetTotalByCondition" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
      select COUNT(DD.MACHUNGTU) AS TOTAL
      from TT_DUOC_DUTRU DD
      left join TM_NHANVIEN NV ON DD.NGUOINHAP_ID = NV.NHANVIEN_ID
      left join TT_PUR_CHUNGTU PC ON PC.MACHUNGTU = DD.MACHUNGTUMUAHANG
      <dynamic prepend="where">
        <isParameterPresent>
          <isNotEmpty prepend="and" property="BENHVIEN_ID">
            DD.BENHVIEN_ID = '$BENHVIEN_ID$'
          </isNotEmpty>
          <isNotEmpty prepend="and" property="TUNGAY">            
            trunc(DD.NGAYCHUNGTU) BETWEEN  trunc(#TUNGAY#) and  trunc(#DENNGAY#)
          </isNotEmpty>         
          <isNotEmpty prepend="and" property="KHODUOC_ID">
            DD.KHONHAP_ID = '$KHODUOC_ID$'
          </isNotEmpty>
          <isNotEmpty prepend="and" property="TRANGTHAI">
            ('$TRANGTHAI$' = 'New' AND DD.TRANGTHAI = '$TRANGTHAI$')
            OR ('$TRANGTHAI$' = 'Purchased' AND PC.TRANGTHAI_DUYET != '1')
            OR ('$TRANGTHAI$' = 'Approved' AND PC.TRANGTHAI_DUYET = '1')
          </isNotEmpty>       
      </isParameterPresent>
      </dynamic>
    </statement>
    <insert id="DAO00107_Add" parameterClass="System.Collections.IDictionary" resultClass="System.Int64">
      <selectKey property="DUTRU_ID" type="pre" resultClass="System.Int64">
        select TT_DUOC_DUTRU_S.nextval as value from dual
      </selectKey>
      insert into TT_DUOC_DUTRU (
      DUTRU_ID
      , MACHUNGTU
      , SOCHUNGTU
      , NGAYCHUNGTU
      , NGAYBAOCAO
      , MUCDICHCHUNGTU_ID
      , TONGHOP_TUNGAY
      , TONGHOP_DENNGAY
      , NGAYNHAP
      , NGUONDUOC_ID
      , KHONHAP_ID
      , NGUOINHAP_ID
      , NGUOINHAN_ID
      , NGUOINHAN
      , DONVIGIAO_ID
      , NHOMLOAIDUOC_ID
      , LOAIVATTU_ID
      , TONKHODAUKY
      , GIATRI
      , GIATRITHANHTOAN
      , TYLEVAT
      , GIATRIVAT
      , TIENTE_ID
      , TYGIA
      , DIENGIAI
      , DIENGIAINGHIEPVUPHATSINH
      , CHUNGTULIENQUAN_ID
      , TRANGTHAI
      , NGAYDUYET
      , NGUOIDUYET_ID
      , PHAMVI_ID
      , BENHVIEN_ID
      , NGAYTAO
      , NGUOITAO_ID
      , NGAYCAPNHAT
      , NGUOICAPNHAT_ID
      ) values (
      #DUTRU_ID#
      , #MACHUNGTU#
      , #SOCHUNGTU#
      , #NGAYCHUNGTU#
      , #NGAYBAOCAO#
      , #MUCDICHCHUNGTU_ID#
      , #TONGHOP_TUNGAY#
      , #TONGHOP_DENNGAY#
      , #NGAYNHAP#
      , #NGUONDUOC_ID#
      , #KHONHAP_ID#
      , #NGUOINHAP_ID#
      , #NGUOINHAN_ID#
      , #NGUOINHAN#
      , #DONVIGIAO_ID#
      , #NHOMLOAIDUOC_ID#
      , #LOAIVATTU_ID#
      , #TONKHODAUKY#
      , #GIATRI#
      , #GIATRITHANHTOAN#
      , #TYLEVAT#
      , #GIATRIVAT#
      , #TIENTE_ID#
      , #TYGIA#
      , #DIENGIAI#
      , #DIENGIAINGHIEPVUPHATSINH#
      , #CHUNGTULIENQUAN_ID#
      , #TRANGTHAI#
      , #NGAYDUYET#
      , #NGUOIDUYET_ID#
      , #PHAMVI_ID#
      , #BENHVIEN_ID#
      , #NGAYTAO#
      , #NGUOITAO_ID#
      , #NGAYCAPNHAT#
      , #NGUOICAPNHAT_ID#
      )      
    </insert>
    <insert id="DAO00107_Detail_Add" parameterClass="System.Collections.IDictionary" resultClass="System.Int64">
      <selectKey property="DUTRUCHITIET_ID" type="pre" resultClass="System.Int64">
        select TT_DUOC_DUTRU_CHITIET_S.nextval as value from dual
      </selectKey>
      insert into TT_DUOC_DUTRU_CHITIET (
      DUTRUCHITIET_ID
      , DUTRU_ID
      , DUOC_ID
      , DONVITINH_ID
      , HESONHANHANG
      , SOLUONGTON
      , SLHANGCHO
      , SLXUAT1
      , SLXUAT2
      , SLXUAT3
      , SLXUAT4
      , SLTRUNGBINHXUAT
      , SLLYTHUYET
      , SLDONGGOI
      , SLTRON
      , SLDADAT
      , NHACUNGCAP_ID
      , LUACHONGIA_ID
      , UUTIEN
      , NGUYENTE
      , TIENTE_ID
      , TYGIA
      , DONGIA
      , VAT
      , DONGIAVAT
      , THANHTIEN
      , GHICHUCHITIET
      , BENHVIEN_ID
      , NGAYTAO
      , NGUOITAO_ID
      , NGAYCAPNHAT
      , NGUOICAPNHAT_ID
      ) values (
        #DUTRUCHITIET_ID#
      , #DUTRU_ID#
      , #DUOC_ID#
      , #DONVITINH_ID#
      , #HESONHANHANG#
      , #SOLUONGTON#
      , #SLHANGCHO#
      , #SLXUAT1#
      , #SLXUAT2#
      , #SLXUAT3#
      , #SLXUAT4#
      , #SLTRUNGBINHXUAT#
      , #SLLYTHUYET#
      , #SLDONGGOI#
      , #SLTRON#
      , #SLDADAT#
      , #NHACUNGCAP_ID#
      , #LUACHONGIA_ID#
      , #UUTIEN#
      , #NGUYENTE#
      , #TIENTE_ID#
      , #TYGIA#
      , #DONGIA#
      , #VAT#
      , #DONGIAVAT#
      , #THANHTIEN#
      , #GHICHUCHITIET#
      , #BENHVIEN_ID#
      , #NGAYTAO#
      , #NGUOITAO_ID#
      , #NGAYCAPNHAT#
      , #NGUOICAPNHAT_ID#
      )      
    </insert>
    <update id="DAO00107_Update" parameterClass="System.Collections.IDictionary">
      update TT_DUOC_DUTRU set
      MACHUNGTU = #MACHUNGTU#
      , SOCHUNGTU = #SOCHUNGTU#
      , NGAYCHUNGTU = #NGAYCHUNGTU#
      , NGAYBAOCAO = #NGAYBAOCAO#
      , MUCDICHCHUNGTU_ID = #MUCDICHCHUNGTU_ID#
      , TONGHOP_TUNGAY = #TONGHOP_TUNGAY#
      , TONGHOP_DENNGAY = #TONGHOP_DENNGAY#
      , NGAYNHAP = #NGAYNHAP#
      , NGUONDUOC_ID = #NGUONDUOC_ID#
      , KHONHAP_ID = #KHONHAP_ID#
      , NGUOINHAP_ID = #NGUOINHAP_ID#
      , NGUOINHAN_ID = #NGUOINHAN_ID#
      , NGUOINHAN = #NGUOINHAN#
      , DONVIGIAO_ID = #DONVIGIAO_ID#
      , NHOMLOAIDUOC_ID = #NHOMLOAIDUOC_ID#
      , LOAIVATTU_ID = #LOAIVATTU_ID#
      , TONKHODAUKY = #TONKHODAUKY#
      , GIATRI = #GIATRI#
      , GIATRITHANHTOAN = #GIATRITHANHTOAN#
      , TYLEVAT = #TYLEVAT#
      , GIATRIVAT = #GIATRIVAT#
      , TIENTE_ID = #TIENTE_ID#
      , TYGIA = #TYGIA#
      , DIENGIAI = #DIENGIAI#
      , DIENGIAINGHIEPVUPHATSINH = #DIENGIAINGHIEPVUPHATSINH#
      , CHUNGTULIENQUAN_ID = #CHUNGTULIENQUAN_ID#
      , MACHUNGTUMUAHANG = #MACHUNGTUMUAHANG#
      , TRANGTHAI = #TRANGTHAI#
      , NGAYDUYET = #NGAYDUYET#
      , NGUOIDUYET_ID = #NGUOIDUYET_ID#
      , PHAMVI_ID = #PHAMVI_ID#
      , BENHVIEN_ID = #BENHVIEN_ID#
      , NGAYCAPNHAT = SYSDATE
      , NGUOICAPNHAT_ID = #NGUOICAPNHAT_ID#
      where
      DUTRU_ID = '$DUTRU_ID$'
    </update>
    <update id="DAO00107_Detail_Update" parameterClass="System.Collections.IDictionary">
      update TT_DUOC_DUTRU_CHITIET set
				 DUTRU_ID = #DUTRU_ID#
				, DUOC_ID = #DUOC_ID#
				, DONVITINH_ID = #DONVITINH_ID#
				, HESONHANHANG = #HESONHANHANG#
				, SOLUONGTON = #SOLUONGTON#
				, SLHANGCHO = #SLHANGCHO#
				, SLXUAT1 = #SLXUAT1#
				, SLXUAT2 = #SLXUAT2#
				, SLXUAT3 = #SLXUAT3#
				, SLXUAT4 = #SLXUAT4#
				, SLTRUNGBINHXUAT = #SLTRUNGBINHXUAT#
				, SLLYTHUYET = #SLLYTHUYET#
				, SLDONGGOI = #SLDONGGOI#
				, SLTRON = #SLTRON#
				, SLDADAT = #SLDADAT#
				, NHACUNGCAP_ID = #NHACUNGCAP_ID#
        , LUACHONGIA_ID = #LUACHONGIA_ID#
				, UUTIEN = #UUTIEN#
				, NGUYENTE = #NGUYENTE#
				, TIENTE_ID = #TIENTE_ID#
				, TYGIA = #TYGIA#
				, DONGIA = #DONGIA#
				, VAT = #VAT#
				, DONGIAVAT = #DONGIAVAT#
				, THANHTIEN = #THANHTIEN#
				, GHICHUCHITIET = #GHICHUCHITIET#
				, BENHVIEN_ID = #BENHVIEN_ID#
				, NGAYCAPNHAT = SYSDATE
				, NGUOICAPNHAT_ID = #NGUOICAPNHAT_ID#
			where
    				DUTRUCHITIET_ID = '$DUTRUCHITIET_ID$'
    </update>
    <statement id="DAO00107_Delete" parameterClass="System.Collections.IDictionary" resultClass="System.Int32">
      delete from TT_DUOC_DUTRU
      where
      DUTRU_ID = '$DUTRU_ID$' AND BENHVIEN_ID = '$BENHVIEN_ID$'
    </statement>
    <statement id="DAO00107_Detail_Delete" parameterClass="System.Collections.IDictionary" resultClass="System.Int32">
      delete from TT_DUOC_DUTRU_CHITIET
      where
      DUTRU_ID = '$DUTRU_ID$' AND BENHVIEN_ID = '$BENHVIEN_ID$'
    </statement>
    <statement id="DAO00107_Detail_DeleteByDetailID" parameterClass="System.Collections.IDictionary" resultClass="System.Int32">
      delete from TT_DUOC_DUTRU_CHITIET
      where
      DUTRUCHITIET_ID = '$DUTRUCHITIET_ID$' AND BENHVIEN_ID = '$BENHVIEN_ID$'
    </statement>
    <statement id="DAO00107_GetDuocDetail" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
      select D.DUOC_ID, TO_CHAR(D.TENDUOCDAYDU) TENDUOCDAYDU, D.TENHOATCHAT, D.DONVITINH, D.DONVITINH_ID, NVL(DVT.TENDONVITINH,D.DONVITINH) AS QUYCACH
      , NVL(DVT.DONVITINH_ID,D.DONVITINH_ID) AS QUYCACH_ID, DVT.GIATRIQUIDOI, GC.DONGIAHOPDONG, GC.GIATRUOCTHUE, GC.VAT, G.NHACUNGCAP_ID, NCC.TENNHACUNGCAP
      , G.GOITHAU_ID, 0 AS SLDADAT
      from TM_DUOC D
      left join TM_GIAHOPDONGCHITIET GC ON GC.DUOC_ID = D.DUOC_ID
      left join TM_GIAHOPDONG G ON G.GIAHOPDONG_ID = GC.GIAHOPDONG_ID
      left join TM_DONVITINH DVT ON GC.DONVITINH_ID = DVT.DONVITINH_ID
      left join TM_NHACUNGCAP NCC ON NCC.NHACUNGCAP_ID = G.NHACUNGCAP_ID
      where D.DUOC_ID = '$DUOC_ID$' AND D.BENHVIEN_ID = '$BENHVIEN_ID$'
      ORDER BY G.GOITHAU_ID
    </statement>
    <statement id="DAO00107_GetDanhSachNCC" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
      SELECT D.DUOC_ID, D.TENDUOCDAYDU, D.DONVITINH, D.DONVITINH_ID, G.NHACUNGCAP_ID, NCC.TENNHACUNGCAP
      , NVL(DVT.TENDONVITINH,D.DONVITINH) AS QUYCACH, NVL(DVT.DONVITINH_ID,D.DONVITINH_ID) AS QUYCACH_ID
      , DVT.GIATRIQUIDOI, GC.DONGIAHOPDONG, GC.GIATRUOCTHUE, GC.VAT, G.GOITHAU_ID, 0 AS SLDADAT
      FROM TM_GIAHOPDONGCHITIET GC
      INNER JOIN TM_GIAHOPDONG G ON G.GIAHOPDONG_ID = GC.GIAHOPDONG_ID
      INNER JOIN TM_NHACUNGCAP NCC ON NCC.NHACUNGCAP_ID = G.NHACUNGCAP_ID
      INNER JOIN TM_DUOC D ON D.DUOC_ID = GC.DUOC_ID
      INNER JOIN TM_DONVITINH DVT ON DVT.DONVITINH_ID = GC.DONVITINH_ID
      WHERE GC.BENHVIEN_ID = '$BENHVIEN_ID$' AND GC.DUOC_ID = '$DUOC_ID$'
      AND TO_DATE(SYSDATE,'MM/DD/YYYY') BETWEEN TO_DATE(G.NGAYCUNGCAP,'MM/DD/YYYY') AND TO_DATE(G.NGAYHETHAN, 'MM/DD/YYYY')
      ORDER BY (GC.DONGIAHOPDONG / NVL(DVT.GIATRIQUIDOI,1))
    </statement>
    <statement id="DAO00107_GetGiaChungTuGanNhat" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
      SELECT D.DUOC_ID, D.TENDUOCDAYDU, D.DONVITINH, D.DONVITINH_ID, DC.NHACUNGCAP_ID, NCC.TENNHACUNGCAP
      , NVL(DVT.TENDONVITINH,D.DONVITINH) AS QUYCACH, NVL(DVT.DONVITINH_ID,D.DONVITINH_ID) AS QUYCACH_ID
      , DVT.GIATRIQUIDOI, (DCC.DONGIAVON + DCC.DONGIAVONVAT) AS DONGIAHOPDONG, DCC.DONGIAMUA AS GIATRUOCTHUE, DCC.TYLEVAT AS VAT
      , NULL AS GOITHAU_ID, 0 AS SLDADAT
      FROM TT_DUOC_CHUNGTU DC
      INNER JOIN TT_DUOC_CHUNGTU_CHITIET DCC ON DCC.CHUNGTU_ID = DC.CHUNGTU_ID
      INNER JOIN TM_NHACUNGCAP NCC ON NCC.NHACUNGCAP_ID = DC.NHACUNGCAP_ID
      INNER JOIN TM_DUOC D ON D.DUOC_ID = DCC.DUOC_ID
      INNER JOIN TM_DONVITINH DVT ON DVT.DONVITINH_ID = DCC.DONVITINH_ID
      INNER JOIN LST_DICTIONARY DIC ON DIC.DICTIONARY_ID = DC.MUCDICHCHUNGTU_ID AND DIC.DICTIONARY_TYPE_CODE = 'MucDichChungTu' AND DIC.DICTIONARY_CODE = 'N01'
      WHERE 
      DC.BENHVIEN_ID = '$BENHVIEN_ID$' AND DCC.DUOC_ID = '$DUOC_ID$'
      AND ROWNUM = 1
      ORDER BY DC.NGAYCHUNGTU DESC
    </statement>
    <statement id="DAO00107_GetGiaGanNhat" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
      SELECT D.DUOC_ID, D.TENDUOCDAYDU, D.DONVITINH, D.DONVITINH_ID, DC.NHACUNGCAP_ID, NCC.TENNHACUNGCAP
      , NVL(DVT.TENDONVITINH,D.DONVITINH) AS QUYCACH, NVL(DVT.DONVITINH_ID,D.DONVITINH_ID) AS QUYCACH_ID
      , DVT.GIATRIQUIDOI, (DCC.DONGIAVON + DCC.DONGIAVONVAT) AS DONGIAHOPDONG, DCC.DONGIAMUA AS GIATRUOCTHUE, NVL(DCC.TYLEVAT,0) AS VAT
      , NULL AS GOITHAU_ID, 0 AS SLDADAT
      FROM TT_DUOC_CHUNGTU DC
      INNER JOIN TT_DUOC_CHUNGTU_CHITIET DCC ON DCC.CHUNGTU_ID = DC.CHUNGTU_ID
      INNER JOIN TM_NHACUNGCAP NCC ON NCC.NHACUNGCAP_ID = DC.NHACUNGCAP_ID
      INNER JOIN TM_DUOC D ON D.DUOC_ID = DCC.DUOC_ID
      INNER JOIN TM_DONVITINH DVT ON DVT.DONVITINH_ID = DCC.DONVITINH_ID
      INNER JOIN LST_DICTIONARY DIC ON DIC.DICTIONARY_ID = DC.MUCDICHCHUNGTU_ID AND DIC.DICTIONARY_TYPE_CODE = 'MucDichChungTu' AND DIC.DICTIONARY_CODE = 'N01'
      WHERE DC.BENHVIEN_ID = '$BENHVIEN_ID$' AND DCC.DUOC_ID = '$DUOC_ID$' AND DC.NHACUNGCAP_ID = '$NHACUNGCAP_ID$' AND ROWNUM = 1
      ORDER BY DC.NGAYCHUNGTU DESC
    </statement>
    <statement id="DAO00107_GetPhamvi" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
      SELECT * FROM TM_PHAMVI
      WHERE TAMNGUNG = '0' AND BENHVIEN_ID = '$BENHVIEN_ID$'
    </statement>
    <statement id="DAO00107_GetTrangThaiDuTru" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
      SELECT DICTIONARY_CODE AS MATRANGTHAI, DICTIONARY_NAME AS TENTRANGTHAI FROM LST_DICTIONARY
      WHERE ENABLED = '1' <!--AND BENHVIEN_ID = '$BENHVIEN_ID$'--> AND DICTIONARY_TYPE_CODE = 'TrangThai_DuTru'
      ORDER BY IDX
    </statement>
    <statement id="DAO00107_SoLuongXuatTrongKy" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
      SELECT DCC.DUOC_ID, NVL(DVT2.DONVITINH_ID,DCC.DONVITINH_ID) AS DONVITINH_ID
      , SUM((CASE WHEN DVT2.DONVITINH_ID IS NULL THEN 1 ELSE NVL(DVT.GIATRIQUIDOI,0) END) * NVL(DCC.SOLUONGDAXUAT,0)) AS SOLUONG
      FROM TT_DUOC_CHUNGTU DC
      INNER JOIN TM_KHODUOC K ON K.KHODUOC_ID = DC.KHOXUAT_ID
      LEFT JOIN TM_KHODUOC K2 ON K2.KHODUOC_ID = DC.KHONHAP_ID
      INNER JOIN LST_DICTIONARY D ON D.DICTIONARY_ID = DC.MUCDICHCHUNGTU_ID AND D.DICTIONARY_TYPE_CODE = 'MucDichChungTu'
      INNER JOIN TM_PHAMVI P ON P.PHAMVI_ID = K.PHAMVI_ID AND P.PHAMVI_ID = '$PHAMVI_ID$'
      INNER JOIN TT_DUOC_CHUNGTU_CHITIET DCC ON DC.CHUNGTU_ID = DCC.CHUNGTU_ID
      INNER JOIN TM_DUOC DUOC ON DUOC.DUOC_ID = DCC.DUOC_ID
      INNER JOIN TM_LOAIDUOC LD ON LD.LOAIDUOC_ID = DUOC.LOAIDUOC_ID
      INNER JOIN TM_DONVITINH DVT ON DVT.DONVITINH_ID = DCC.DONVITINH_ID
      LEFT JOIN TM_DONVITINH DVT2 ON DVT2.DONVITINH_ID = DVT.DONVICOBAN_ID
      WHERE
      DC.BENHVIEN_ID = '$BENHVIEN_ID$'
      AND TO_DATE(TO_CHAR(DC.NGAYCHUNGTU,'MM/DD/YYYY'), 'MM/DD/YYYY') BETWEEN TO_DATE('$TUNGAY$', 'MM/DD/YYYY') AND TO_DATE('$DENNGAY$', 'MM/DD/YYYY')
      AND ((P.MAPHAMVI = 'BV' AND D.DICTIONARY_CODE IN ($BV_CODE$)  AND (D.DICTIONARY_CODE NOT IN ('X05', 'X07') OR K2.PHAMVI_ID != '$PHAMVI_ID$'))
      OR (P.MAPHAMVI = 'NT' AND D.DICTIONARY_CODE IN ($NT_CODE$)  AND (D.DICTIONARY_CODE NOT IN ('X05', 'X07') OR K2.PHAMVI_ID != '$PHAMVI_ID$')))
      AND DC.TRANGTHAI NOT IN ('HUY', 'CXN', 'PNDCNK') AND ('$LOAIVATTU_ID$' = '' OR LD.LOAIVATTU_ID = '$LOAIVATTU_ID$')
      GROUP BY DCC.DUOC_ID, NVL(DVT2.DONVITINH_ID,DCC.DONVITINH_ID)
    </statement>
    <statement id="DAO00107_SoLuongNhapTrongKy" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
      SELECT DCC.DUOC_ID, NVL(DVT2.DONVITINH_ID,DCC.DONVITINH_ID) AS DONVITINH_ID
      , SUM((CASE WHEN DVT2.DONVITINH_ID IS NULL THEN 1 ELSE NVL(DVT.GIATRIQUIDOI,0) END) * NVL(DCC.SOLUONGTHUCTE,0)) AS SOLUONG
      FROM TT_DUOC_CHUNGTU DC
      INNER JOIN TM_KHODUOC K ON K.KHODUOC_ID = DC.KHONHAP_ID
      LEFT JOIN TM_KHODUOC K2 ON K2.KHODUOC_ID = DC.KHOXUAT_ID
      INNER JOIN LST_DICTIONARY D ON D.DICTIONARY_ID = DC.MUCDICHCHUNGTU_ID AND D.DICTIONARY_TYPE_CODE = 'MucDichChungTu'
      INNER JOIN TM_PHAMVI P ON P.PHAMVI_ID = K.PHAMVI_ID AND P.PHAMVI_ID = '$PHAMVI_ID$'
      INNER JOIN TT_DUOC_CHUNGTU_CHITIET DCC ON DC.CHUNGTU_ID = DCC.CHUNGTU_ID
      INNER JOIN TM_DUOC DUOC ON DUOC.DUOC_ID = DCC.DUOC_ID
      INNER JOIN TM_LOAIDUOC LD ON LD.LOAIDUOC_ID = DUOC.LOAIDUOC_ID
      INNER JOIN TM_DONVITINH DVT ON DVT.DONVITINH_ID = DCC.DONVITINH_ID
      LEFT JOIN TM_DONVITINH DVT2 ON DVT2.DONVITINH_ID = DVT.DONVICOBAN_ID
      WHERE DC.BENHVIEN_ID = '$BENHVIEN_ID$'
      AND TO_DATE(TO_CHAR(DC.NGAYCHUNGTU,'MM/DD/YYYY'), 'MM/DD/YYYY') BETWEEN TO_DATE('$TUNGAY$', 'MM/DD/YYYY') AND TO_DATE('$DENNGAY$', 'MM/DD/YYYY')
      AND ((P.MAPHAMVI = 'BV' AND D.DICTIONARY_CODE IN ($BV_CODE$) AND (D.DICTIONARY_CODE NOT IN ('N05', 'N10') OR K2.PHAMVI_ID != '$PHAMVI_ID$'))
      OR (P.MAPHAMVI = 'NT' AND D.DICTIONARY_CODE IN ($NT_CODE$)  AND (D.DICTIONARY_CODE NOT IN ('N05', 'N10') OR K2.PHAMVI_ID != '$PHAMVI_ID$')))
      AND DC.TRANGTHAI NOT IN ('HUY', 'CXN', 'PNCNK') AND ('$LOAIVATTU_ID$' = '' OR LD.LOAIVATTU_ID = '$LOAIVATTU_ID$')
      GROUP BY DCC.DUOC_ID, NVL(DVT2.DONVITINH_ID,DCC.DONVITINH_ID)
    </statement>
    <statement id="DAO00107_SoLuongTonKhoDauThang" parameterClass="System.Collections.IDictionary" resultClass="DataObject">
      SELECT DT.DUOC_ID, SUM(NVL(DT.SOLUONG,0)) AS SOLUONG
      FROM TT_DUOC_TONDAUKY DT
      INNER JOIN TM_KHODUOC K ON K.KHODUOC_ID = DT.KHODUOC_ID
      INNER JOIN TT_DUOC_KYTONKHO DK ON DK.DUOCKYTONKHO_ID = DT.DUOCKYTONKHO_ID
      INNER JOIN TM_DUOC DUOC ON DUOC.DUOC_ID = DT.DUOC_ID
      INNER JOIN TM_LOAIDUOC LD ON LD.LOAIDUOC_ID = DUOC.LOAIDUOC_ID
      WHERE K.PHAMVI_ID = '$PHAMVI_ID$' AND DT.BENHVIEN_ID = '$BENHVIEN_ID$' AND DK.THANG = '$THANG$' AND DK.NAM = '$NAM$'
      AND ('$LOAIVATTU_ID$' = '' OR LD.LOAIVATTU_ID = '$LOAIVATTU_ID$')
      GROUP BY DT.DUOC_ID
    </statement>
  </statements>

</sqlMap>
